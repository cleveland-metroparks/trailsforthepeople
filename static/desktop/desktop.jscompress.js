function highlightToolbarButton(e){var t=$("#toolbar img.button");if(t.each(function(){var e=$(this).prop("src");e=e.replace("_active_","_"),$(this).prop("src",e)}),e){var i=$('#toolbar img.button[target="'+e+'"]'),o=i.prop("src");o=o.replace("_","_active_"),i.prop("src",o)}}function switchToMap(e){$(".dialog").dialog("close"),e&&setTimeout(e,100)}function showPhoto(e){$("#photo").prop("src",e),$("#gallery").dialog("open")}function hidePhoto(){$("#gallery").dialog("close")}function showElevation(e){$("#elevation").prop("src",e),$("#elevationprofile").dialog("open")}function searchByKeyword(e){var t=strToLatLng(e);if(t)return MAP.setView(t,16),void placeTargetMarker(t.lat,t.lng);var i=$("#keyword_results");i.empty(),disableKeywordButton(),$.get("../ajax/keyword",{keyword:e,limit:100},function(t){if(enableKeywordButton(),!t.length)return $("<li></li>").text("No Cleveland Metroparks results found. Trying an address search.").appendTo(i),void zoomToAddress(e);for(var o=0,a=t.length;a>o;o++){var n=t[o],l=$("<span></span>").addClass("ui-li-heading").text(n.name),s=$("<span></span>").addClass("ui-li-desc").text(n.description),r=$("<li></li>").addClass("zoom").append(l).append(s);r.attr("w",n.w),r.attr("s",n.s),r.attr("e",n.e),r.attr("n",n.n),r.attr("lat",n.lat),r.attr("lng",n.lng),r.attr("type",n.type),r.attr("gid",n.gid),r.attr("title",n.name),i.append(r),r.data("sort",n.name),r.click(function(){zoomElementClick($(this))})}i.children("li").sort(function(e,t){return $(e).data("sort")-$(t).data("sort")})},"json")}function zoomElementClick(e){var t=e.attr("type"),i=e.attr("gid");if($(".dialog").dialog("close"),$("#info").dialog("open"),$("#show_on_map").data("zoomelement",e),$("#directions_target_lat").val(e.attr("lat")),$("#directions_target_lng").val(e.attr("lng")),$("#directions_target_type").val(e.attr("type")),$("#directions_target_gid").val(e.attr("gid")),$("#directions_target_title").text(e.attr("title")),$("#getdirections_disabled").hide(),$("#getdirections_enabled").show(),$("#show_on_map").data("wkt",null),$("#info-content").text("Loading..."),t&&i){var o={};o.type=t,o.gid=i,$.get("../ajax/moreinfo",o,function(e){$("#info-content").html(e);var t=$("#info-content").find("div.wkt");t&&($("#show_on_map").data("wkt",t.text()),t.remove()),SKIP_TO_DIRECTIONS&&($("#directions_car").click(),SKIP_TO_DIRECTIONS=!1)},"html")}else $("#info-content").html($("<h1></h1>").text(e.attr("title"))),$("#directions_car").click()}function filterLoops(){$("#loops_list li").show();var e=$("#loops_filter_type").val(),t=$("#loops_filter_paved").val(),i=60*parseFloat($("#loops_filter_time_slider").slider("values",0)),o=60*parseFloat($("#loops_filter_time_slider").slider("values",1)),a=5280*parseFloat($("#loops_filter_distance_slider").slider("values",0)),n=5280*parseFloat($("#loops_filter_distance_slider").slider("values",1)),l=$("#loops_filter_reservation").val(),s=0;$("#loops_list li").each(function(){var r="Yes"==$(this).attr("hike"),c="Yes"==$(this).attr("bike"),d="Yes"==$(this).attr("bridle"),g="Yes"==$(this).attr("exercise"),h="Yes"==$(this).attr("mountainbike"),p=$(this).attr("paved"),u=$(this).attr("difficulty"),_=$(this).attr("length_feet"),f=$(this).attr("duration_hike"),b=$(this).attr("duration_bike"),m=$(this).attr("duration_bridle"),k=0,v=!0;if(v&&l&&-1==$.inArray(l,$(this).data("reservations"))&&(v=!1),v&&t&&t!=p&&(v=!1),v&&e)switch(e){case"hike":r||(v=!1),k=f;break;case"bridle":d||(v=!1),k=m;break;case"bike":c||(v=!1),k=b;break;case"bike_Novice":c||(v=!1),"Novice"!=u&&(v=!1),k=b;break;case"bike_Beginner":c||(v=!1),"Novice"!=u&&"Beginner"!=u&&(v=!1),k=b;break;case"bike_Intermediate":c||(v=!1),"Novice"!=u&&"Beginner"!=u&&"Intermediate"!=u&&(v=!1),k=b;break;case"bike_Advanced":c||(v=!1),k=b;break;case"mountainbike":h||(v=!1),k=b;break;case"exercise":g||(v=!1),k=f;break;default:v=!1}v&&k&&(i>k||k>o)&&(v=!1),v&&(a>_||_>n)&&(v=!1),v?s++:$(this).hide()}),s?$("#loops_nomatches").hide():$("#loops_nomatches").show()}function stopMeasure(){MARKER_FROM.setLatLng(L.latLng(0,0)),MARKER_TO.setLatLng(L.latLng(0,0)),MAP.removeLayer(MARKER_FROM),MAP.removeLayer(MARKER_TO),MARKER_FROM.dragging.disable(),MARKER_TO.dragging.disable(),clearDirectionsLine(),$("#measure_steps").empty()}function startMeasure(){if(!MARKER_FROM.getLatLng().lat||!MARKER_TO.getLatLng().lat){var e=MAP.getBounds().getSouthWest(),t=MAP.getBounds().getNorthEast(),i=(e.lat+t.lat)/2,o=.25*(t.lng-e.lng),a=L.latLng(i,e.lng+o),n=L.latLng(i,t.lng-o);MARKER_FROM.setLatLng(a).addTo(MAP),MARKER_TO.setLatLng(n).addTo(MAP),MARKER_FROM.dragging.enable(),MARKER_TO.dragging.enable()}}function performMeasure(e,t,i){var o=$("#measure_steps");o.empty();var a=$("#measure_button");a.prop("disabled",!0),a.val(a.attr("value0"));var n={sourcelat:e.lat,sourcelng:e.lng,targetlat:t.lat,targetlng:t.lng,tofrom:"to",via:i};$.get("../ajax/directions",n,function(e){if(a.prop("disabled",!1),a.val(a.attr("value1")),!e||!e.wkt){var t="Could not find directions.";return"hike"!=i&&(t+="\nTry a different type of trail, terrain, or difficulty."),alert(t)}renderDirectionsStructure(e,o,{noshare:!0})},"json")}var MOBILE=!1,LAST_KNOWN_LOCATION=L.latLng(0,0),EMBED_DIALOG_WIDTH=550,EMBED_DIALOG_HEIGHT=475;$(window).load(function(){URL_PARAMS=$.url(),URL_PARAMS.param("embed")&&(MIN_ZOOM-=1),URL_PARAMS.param("embed")&&$("#toolbar img.logo").hide(),URL_PARAMS.param("embed")||$("#button_fullscreen").hide(),URL_PARAMS.param("measure")||$("#button_measure").hide(),initMap()}),$(window).load(function(){$(".button").click(function(){var e=$("#"+$(this).attr("target"));e.length&&(e.dialog("option","modal")||$(".dialog").dialog("close"),e.dialog("open"))}),$("#welcome").dialog({modal:!0,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:450,height:400,title:"Welcome",buttons:{Close:function(){$(this).dialog("close")}}}),$("#share").dialog({modal:!0,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:700,height:140,title:"Share your map",buttons:{Close:function(){$(this).dialog("close")}},open:function(){populateShareBox()}}),$("#geocode").dialog({modal:!1,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:420,height:150,title:"Zoom to an address or landmark",buttons:{Back:function(){$("#button_find").click()}},open:function(){highlightToolbarButton("directions")},close:function(){highlightToolbarButton(null)}}),$("#browse").dialog({modal:!1,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:550,height:550,title:"Find",buttons:{Close:function(){$(this).dialog("close")}},open:function(){highlightToolbarButton("browse")},close:function(){highlightToolbarButton(null)}}),$("#search").dialog({modal:!1,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:550,height:425,title:"Search by Keyword",buttons:{Back:function(){$("#button_find").click()}},open:function(){highlightToolbarButton("browse")},close:function(){highlightToolbarButton(null)}}),$("#gallery").dialog({modal:!0,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:825,height:575,title:"Photo",buttons:{Close:function(){$(this).dialog("close")}},open:function(){highlightToolbarButton("browse")},close:function(){highlightToolbarButton(null)}}),$("#elevationprofile").dialog({modal:!0,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:500,height:325,title:"Elevation Profile",buttons:{Close:function(){$(this).dialog("close")}},open:function(){highlightToolbarButton("browse")},close:function(){highlightToolbarButton(null)}}),$("#settings").dialog({modal:!1,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:500,height:500,title:"Map Layers &amp; Features",buttons:{Close:function(){$(this).dialog("close")}},open:function(){highlightToolbarButton("settings")},close:function(){highlightToolbarButton(null)}}),$("#info").dialog({modal:!1,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:650,height:600,title:"Details",buttons:{Back:function(){$("#button_find").click()}},open:function(){highlightToolbarButton("browse")},close:function(){highlightToolbarButton(null)}}),$("#getdirections").dialog({modal:!1,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:500,height:500,title:"Get Directions",buttons:{Back:function(){$("#button_find").click()}},open:function(){highlightToolbarButton("directions")},close:function(){highlightToolbarButton(null)}}),$("#loops").dialog({modal:!1,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:550,height:500,title:"Featured Hikes and Routes",buttons:{Back:function(){$("#button_find").click()}},open:function(){highlightToolbarButton("browse")},close:function(){highlightToolbarButton(null)}}),$("#loops_button").click(function(){$(".dialog").dialog("close"),$("#loops").dialog("open")}),$("#trailfinder").dialog({modal:!1,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:550,height:500,title:"Trail Finder",buttons:{Back:function(){$("#button_find").click()}},open:function(){highlightToolbarButton("browse")},close:function(){highlightToolbarButton(null)}}),$("#trailfinder_button").click(function(){$(".dialog").dialog("close"),$("#trailfinder").dialog("open")}),$("#print").dialog({modal:!1,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:525,height:350,title:"Print",buttons:{Print:function(){printMap()},Close:function(){$(this).dialog("close")}},open:function(){highlightToolbarButton("print"),$("#print_ready").hide(),$("#print_waiting").hide()},close:function(){highlightToolbarButton(null)}}),$("#measure").dialog({modal:!1,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:575,height:450,title:"Measure distance between two points",buttons:{Close:function(){$(this).dialog("close")}},open:function(){highlightToolbarButton("measure"),startMeasure()},close:function(){highlightToolbarButton(null)}}),$("#credits").dialog({modal:!1,closeOnEscape:!0,resizable:!0,autoOpen:!1,zIndex:1e3,width:550,height:375,title:"About this app",buttons:{Close:function(){$(this).dialog("close")}}}),URL_PARAMS.param("embed")&&$(".dialog").each(function(){var e=$(this).dialog("option","width"),t=$(this).dialog("option","height");e>EMBED_DIALOG_WIDTH&&$(this).dialog("option","width",EMBED_DIALOG_WIDTH),t>EMBED_DIALOG_HEIGHT&&$(this).dialog("option","height",EMBED_DIALOG_HEIGHT)});var e=cookieGet("show_welcome");URL_PARAMS.param("embed")&&(e=!1),e&&$("#welcome").dialog("open")}),$(window).load(function(){function e(){$(this).parent().siblings("li").children("ul").hide();var e=$(this).siblings("ul");e.is(":visible")?(e.hide(),e.removeClass("expanded")):(e.show(),e.addClass("expanded"))}var t={Archery:"archery.png",Beach:"beach.png",Boating:"boat.png","Drinking Fountain":"drinkingfountain.png","Exploring Culture & History":"history.png","Exploring Nature":"nature.png",Facilities:"facility.png","Fishing & Ice Fishing":"fish.png",Food:"food.png","Geologic Feature":"geology.png",Golfing:"golf.png","Horseback Riding":"horse.png",Kayaking:"kayak.png","Mountain Biking":"mtnbike.png",Picnicking:"picnic.png","Play Areas":"play.png",Restroom:"restroom.png",Shelter:"shelter.png","Sledding & Tobogganing":"sled.png",Snowshoeing:"sled.png",Swimming:"swim.png","Viewing Wildlife":"wildlife.png"};$.get("../desktop/fetch_activitypois",{},function(i){var o=$("#activitypois");for(var a in i){var n=$("<li></li>").appendTo(o),l="/static/wms/pois/"+t[a],s=$("<img></img>").prop("src",l);$("<div></div>").addClass("head").text(a).prepend(s).appendTo(n).click(e);for(var r=$("<ul></ul>").appendTo(n).hide(),c=i[a],d=0,g=c.length;g>d;d++){var h=$("<li></li>").appendTo(r).text(c[d].use_area).addClass("zoom");h.attr("type","poi"),h.attr("title",c[d].use_area),h.attr("gid",c[d].gid),h.attr("lat",c[d].lat),h.attr("lng",c[d].lng),h.attr("w",c[d].boxw),h.attr("s",c[d].boxs),h.attr("e",c[d].boxe),h.attr("n",c[d].boxn),h.click(function(){zoomElementClick($(this))})}}},"json"),$.get("../desktop/fetch_loops",{},function(e){for(var t=$("#loops_list"),i=0,o=e.length;o>i;i++)for(var i=(e[i],0),o=e.length;o>i;i++){var a=$("<li></li>").appendTo(t).addClass("zoom");a.attr("type","loop"),a.attr("title",e[i].name),a.attr("gid",e[i].id),a.attr("lat",e[i].lat),a.attr("lng",e[i].lng),a.attr("w",e[i].boxw),a.attr("s",e[i].boxs),a.attr("e",e[i].boxe),a.attr("n",e[i].boxn),a.attr("hike",e[i].hike),a.attr("bike",e[i].bike),a.attr("bridle",e[i].bridle),a.attr("mountainbike",e[i].mountainbike),a.attr("difficulty",e[i].difficulty),a.attr("length_feet",e[i].length_feet),a.attr("duration_hike",e[i].duration_hike),a.attr("duration_bike",e[i].duration_bike),a.attr("duration_bridle",e[i].duration_bridle),a.attr("paved",e[i].paved),a.data("reservations",e[i].reservations),$("<span></span>").addClass("ui-li-heading").text(e[i].name).appendTo(a),$("<span></span>").addClass("ui-li-desc").text("Length: "+e[i].distancetext).appendTo(a),$("<br></br>").appendTo(a);var n=$("<span></span>").addClass("ui-li-desc").addClass("time_estimate").addClass("time_hike").text(e[i].durationtext_hike).appendTo(a),l=$("<span></span>").addClass("ui-li-desc").addClass("time_estimate").addClass("time_bike").text(e[i].durationtext_bike).appendTo(a),s=$("<span></span>").addClass("ui-li-desc").addClass("time_estimate").addClass("time_bridle").text(e[i].durationtext_bridle).appendTo(a);$("<span></span>").addClass("time_estimate_prefix").text("Walking:").prependTo(n),$("<span></span>").addClass("time_estimate_prefix").text("Bicycling:").prependTo(l),$("<span></span>").addClass("time_estimate_prefix").text("Horseback:").prependTo(s),a.click(function(){zoomElementClick($(this))})}},"json"),$("#browse div.head").click(e),$("#browse ul").hide(),$("#browse > ul").show(),$("#browse_keyword_button").click(function(){$(".dialog").dialog("close"),$("#search").dialog("open"),$("#search_keyword").val($("#browse_keyword").val()),$("#search_keyword_button").click()}),$("#browse_keyword").keydown(function(e){13==e.keyCode&&$("#browse_keyword_button").click()}),$("#return_to_basic_search").click(function(){$(".dialog").dialog("close"),$("#browse").dialog("open")}),$("#search_keyword_button").click(function(){var e=$("#search_keyword").val();searchByKeyword(e)}),$("#search_keyword").keydown(function(e){13==e.keyCode&&$("#search_keyword_button").click()}),$("#button_directions").click(function(){$(".dialog").dialog("close"),$("#getdirections").dialog("open")})}),$(window).load(function(){$("#directions_hike").click(function(){$("#directions_via").val("hike"),$("#directions_via").trigger("change"),$(".dialog").dialog("close"),$("#getdirections").dialog("open")}),$("#directions_bike").click(function(){$("#directions_via").val("bike"),$("#directions_via").trigger("change"),$(".dialog").dialog("close"),$("#getdirections").dialog("open")}),$("#directions_bridle").click(function(){$("#directions_via").val("bridle"),$("#directions_via").trigger("change"),$(".dialog").dialog("close"),$("#getdirections").dialog("open")}),$("#directions_car").click(function(){$("#directions_via").val("car"),$("#directions_via").trigger("change"),$(".dialog").dialog("close"),$("#getdirections").dialog("open")}),$("#directions_bus").click(function(){$("#directions_via").val("bus"),$("#directions_via").trigger("change"),$(".dialog").dialog("close"),$("#getdirections").dialog("open")}),$("#directions_type").click(function(){var e=$(this).val(),t=$("#directions_type_geocode_wrap");"gps"==e?t.hide():t.show()}),$("#directions_reverse").change(function(){var e="to"==$(this).val()?"from":"to";$("#directions_type option").each(function(){var t=$(this).text();t=e+" "+t.replace(/^to /,"").replace(/^from /,""),$(this).text(t)})}),$("#directions_button").click(function(){$("#directions_steps").empty(),processGetDirectionsForm()}),$("#directions_address").keydown(function(e){13==e.keyCode&&$("#directions_button").click()}),$("#change_directions_target").click(function(){$('img[target="browse"]').click()}),$("#change_directions_target2").click(function(){$('img[target="browse"]').click(),SKIP_TO_DIRECTIONS=!0})}),$(window).load(function(){$.get("../ajax/autocomplete_keywords",{},function(e){$("#search_keyword").autocomplete({source:e,select:function(e,t){$("#search_keyword").val(t.item.value),$("#search_keyword_button").click()}}),$("#browse_keyword").autocomplete({source:e,select:function(e,t){$("#browse_keyword").val(t.item.value),$("#browse_keyword_button").click()}})},"json")}),$(window).load(function(){$("#loops_filter_distance_slider").slider({range:!0,min:0,max:100,step:1,values:[0,100],slide:function(e,t){var i=t.values[0],o=t.values[1];$("#loops_filter_distance_min").text(i),$("#loops_filter_distance_max").text(o)}}),$("#loops_filter_time_slider").slider({range:!0,min:0,max:300,step:15,values:[0,300],slide:function(e,t){var i=t.values[0],o=t.values[1],a=i+" minutes",n=o+" minutes";i>=60&&(a=Math.floor(i/60)+" hours "+i%60+" minutes"),o>=60&&(n=Math.floor(o/60)+" hours "+o%60+" minutes"),$("#loops_filter_time_min").text(a),$("#loops_filter_time_max").text(n)}}),$("#loops_filter_type").change(function(){var e=$(this).val();switch(e){case"hike":$(".time_estimate").hide(),$(".time_hike").show(),$(".time_estimate_prefix").hide();break;case"bridle":$(".time_estimate").hide(),$(".time_bridle").show(),$(".time_estimate_prefix").hide();break;case"bike":$(".time_estimate").hide(),$(".time_bike").show(),$(".time_estimate_prefix").hide();break;case"bike_Novice":$(".time_estimate").hide(),$(".time_bike").show(),$(".time_estimate_prefix").hide();break;case"bike_Beginner":$(".time_estimate").hide(),$(".time_bike").show(),$(".time_estimate_prefix").hide();break;case"bike_Intermediate":$(".time_estimate").hide(),$(".time_bike").show(),$(".time_estimate_prefix").hide();break;case"bike_Advanced":$(".time_estimate").hide(),$(".time_bike").show(),$(".time_estimate_prefix").hide();break;case"mountainbike":$(".time_estimate").hide(),$(".time_bike").show(),$(".time_estimate_prefix").hide();break;default:$(".time_estimate").show(),$(".time_estimate_prefix").show()}}),$("#loops_typeicons img").click(function(){var e=$(this),t=e.attr("data-value");$("#loops_filter_type").val(t).trigger("change"),$("#loops_typeicons img").each(function(){var t=$(this).prop("src");t=$(this).is(e)?t.replace("_off.png","_on.png"):t.replace("_on.png","_off.png"),$(this).prop("src",t)})}).first().click(),$("#loops_filter_distancepicker img").click(function(){var e=$(this),t=e.attr("data-min"),i=e.attr("data-max");$("#loops_filter_distance_slider").slider("values",[t,i]),$("#loops_filter_distancepicker img").each(function(){var t=$(this).prop("src");t=$(this).is(e)?t.replace("_off.png","_on.png"):t.replace("_on.png","_off.png"),$(this).prop("src",t)}),$("#loops_filter_button").click()}).first().click(),$("#loops_filter_button").click(filterLoops),$("#loops_filter_reservation").change(filterLoops),$("#loops_filter_paved").change(filterLoops),$("#loops_filter_type").change(filterLoops)}),$(window).load(function(){$("#measure_button").click(function(){var e=$("#measure_via").val();"trail"==e&&(e=$("#measure_via_trail").val()),performMeasure(MARKER_FROM.getLatLng(),MARKER_TO.getLatLng(),e)}),$("#measure_clear").click(function(){stopMeasure(),startMeasure(),$("#measure_steps").empty()}),$("#measure_via").change(function(){var e="trail"==$(this).val();e?$("#measure_via_trail").show():$("#measure_via_trail").hide()})});
