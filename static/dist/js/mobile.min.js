function createStartHereTooltip(){var a=$(".sidebar-tabs ul li:first")[0],b=$("body > div.ui-page")[0];return new Tooltip(a,{title:"Start exploring here!",container:b,placement:"right",trigger:"manual"})}function disableClicksMomentarily(){}function disableClicks(){MAP&&(ENABLE_MAPCLICK=!1,MAP.dragging.removeHooks(),MAP.touchZoom.removeHooks())}function enableClicks(){MAP&&(ENABLE_MAPCLICK=!0,MAP.dragging.addHooks(),MAP.touchZoom.addHooks())}function switchToMap(a){sidebarCoversMap()&&sidebar.close(),a&&setTimeout(a,0)}function showPhoto(a){$("#photo").prop("src",a),sidebar.open("pane-photo")}function showElevation(a){$("#elevation").prop("src",a),sidebar.open("pane-elevationprofile")}function showAttractionInfo(a,b){if($("#directions_target_lat").val(b.lat),$("#directions_target_lng").val(b.lng),$("#directions_target_type").val(b.type),$("#directions_target_gid").val(b.gid),$("#directions_target_title").text(b.title),sidebar.open("pane-info"),set_pane_back_button("#pane-info","#pane-browse"),$("#getdirections_disabled").hide(),$("#getdirections_enabled").show(),$("#show_on_map").data("wkt",null),$("#info-content").text("Loading..."),b.gid||b.record_id){var c={};c.type=a,c.gid=b.gid||b.record_id,$.get(API_BASEPATH+"ajax/moreinfo",c,function(a){$("#info-content").html(a)},"html")}}function zoomElementClick(a){if(ENABLE_MAPCLICK){disableClicksMomentarily();var b=a.attr("type"),c=a.attr("gid");"reservation_new"==b&&(c=a.attr("record_id")),$("#show_on_map").data("zoomelement",a),$("#directions_target_lat").val(a.attr("lat")),$("#directions_target_lng").val(a.attr("lng")),$("#directions_target_type").val(a.attr("type")),$("#directions_target_gid").val(a.attr("gid")),$("#directions_target_title").text(a.attr("title")),sidebar.open("pane-info");var d=a.attr("backbutton");if(d||(d="#pane-browse"),set_pane_back_button("#pane-info",d),$("#getdirections_disabled").hide(),$("#getdirections_enabled").show(),$("#show_on_map").data("wkt",null),$("#info-content").text("Loading..."),b&&c){var e={};e.type=b,e.gid=c,e.lat=LAST_KNOWN_LOCATION.lat,e.lng=LAST_KNOWN_LOCATION.lng,$.get(API_BASEPATH+"ajax/moreinfo",e,function(a){$("#info-content").html(a);var b=$("#info-content").find("div.wkt");b&&($("#show_on_map").data("wkt",b.text()),b.remove()),SKIP_TO_DIRECTIONS&&($("#directions_car").click(),SKIP_TO_DIRECTIONS=!1)},"html")}else $("#info-content").html($("<h1></h1>").text(a.attr("title"))),$("#directions_car").click()}}function sortLists(a){if(a||(a=$(".sidebar-pane.active ul.distance_sortable").eq(0),a.length)){switch(a.find(".zoom_distance").each(function(){var a=$(this).parent().parent(),b=L.latLng(a.attr("lat"),a.attr("lng")),c=LAST_KNOWN_LOCATION.distanceTo(b),d=LAST_KNOWN_LOCATION.bearingWordTo(b),e=c/1609.344,f=3.2808399*c,g=f>900?e.toFixed(1)+" mi":f.toFixed(0)+" ft";g+=" "+d,$(this).text(g),a.data("meters",c)}),DEFAULT_SORT){case"distance":a.children("li").sort(function(a,b){return $(a).data("meters")>$(b).data("meters")?1:-1});break;case"alphabetical":a.children("li").sort(function(a,b){return $(a).attr("title")>$(b).attr("title")?1:-1})}a.children("li.ui-first-child").removeClass("ui-first-child"),a.children("li").first().addClass("ui-first-child"),a.children("li.ui-last-child").removeClass("ui-last-child"),a.children("li").last().addClass("ui-last-child")}}function zoomToAddress(a){if(!a)return!1;var b={};b.address=a,b.bing_key=BING_API_KEY,b.bbox=GEOCODE_BIAS_BOX,$.get(API_BASEPATH+"ajax/geocode",b,function(a){if(!a)return alert("We couldn't find that address or city.\nPlease try again.");var b=L.latLng(a.lat,a.lng);if(!MAX_BOUNDS.contains(b))return alert("The only results we could find are too far away to zoom the map there.");switchToMap(function(){MAP.setView(b,16),placeTargetMarker(a.lat,a.lng);var c="";c+='<h3 class="popup_title">'+a.title+"</h3>",c+='<span class="fakelink zoom" title="'+a.title+'" lat="'+a.lat+'" lng="'+a.lng+'" w="'+a.w+'" s="'+a.s+'" e="'+a.e+'" n="'+a.n+'" onClick="zoomElementClick( $(this) );">Directions</span>';var d=new L.Popup;d.setLatLng(b),d.setContent(c),MAP.openPopup(d)})},"json")}function createCopiedToClipboardTooltip(a,b){return new Tooltip(a,{title:"Copied to clipboard.",container:b,placement:"bottom",trigger:"manual"})}function setupWindowUrlUpdates(){MAP.on("zoomend",updateWindowURLZoom),MAP.on("moveend",updateWindowURLCenter),MAP.on("layerremove",updateWindowURLLayer),MAP.on("layeradd",updateWindowURLLayer)}function updateWindowURLCenter(){var a=MAP.getCenter(),b=a.lat.toFixed(7),c=a.lng.toFixed(7);invalidateMapURL(),setWindowURLQueryStringParameter("lat",b),setWindowURLQueryStringParameter("lng",c)}function updateWindowURLZoom(){var a=MAP.getZoom().toFixed(1);invalidateMapURL(),setWindowURLQueryStringParameter("zoom",a)}function updateWindowURLLayer(){var a="map";MAP.hasLayer(AVAILABLE_LAYERS.photo)&&(a="photo"),invalidateMapURL(),setWindowURLQueryStringParameter("base",a)}function invalidateMapURL(){hideShareURL()}function updateWindowURLAll(){updateWindowURLCenter(),updateWindowURLZoom(),updateWindowURLLayer()}function setWindowURLQueryStringParameter(a,b){const c=new URLSearchParams(location.search);c.set(a,b),c.has("y")&&"lat"==a&&c.delete("y"),c.has("x")&&"lng"==a&&c.delete("x"),c.has("z")&&"zoom"==a&&c.delete("z"),WINDOW_URL=decodeURIComponent(location.pathname+"?"+c),window.history.replaceState(null,null,WINDOW_URL)}function WSENtoBounds(a,b,c,d){return L.latLngBounds([[b,a],[d,c]])}function changeCoordinateFormat(a){SETTINGS.coordinate_format=a,setSessionCoordinateFormat(a)}function getSessionCoordinateFormat(){$.get(API_BASEPATH+"ajax/get_session_coordinate_format",{},function(a){return a?(SETTINGS.coordinate_format=a,update_user_latlon_display(),a):void console.log("Error: get_session_coordinate_format: Could not get coordinate format.")},"json")}function setSessionCoordinateFormat(a){var b={coordinate_format:a};$.get(API_BASEPATH+"ajax/set_session_coordinate_format",b,function(a){a||console.log("Error: set_session_coordinate_format: No reply.")},"json")}function wmsGetFeatureInfoByPoint(a){var b=MAP.layerPointToLatLng(new L.Point(a.x-20,a.y+20)),c=MAP.layerPointToLatLng(new L.Point(a.x+20,a.y-20));wmsGetFeatureInfoByLatLngBBOX({w:b.lng,s:b.lat,e:c.lng,n:c.lat},MAP.layerPointToLatLng(new L.Point(a.x,a.y)))}function wmsGetFeatureInfoByLatLng(a){wmsGetFeatureInfoByLatLngBBOX({w:a.lng,s:a.lat,e:a.lng,n:a.lat},a)}function wmsGetFeatureInfoByLatLngBBOX(a,b){var c=a;c.zoom=MAP.getZoom(),$.get(API_BASEPATH+"ajax/query",c,function(a){if(a){var c={};c.maxHeight=parseInt($("#map_canvas").height()),c.maxWidth=parseInt($("#map_canvas").width());var d=new L.Popup(c);d.setLatLng(b),d.setContent(a),MAP.openPopup(d)}},"html")}var WINDOW_URL=null,sidebar=null,LAST_BEEP_IDS=[],LAST_KNOWN_LOCATION=L.latLng(41.3953,-81.673),AUTO_CENTER_ON_LOCATION=!1,DEFAULT_SORT="distance",URL_PARAMS=null;$(document).on("mapInitialized",function(){if(sidebar=L.control.sidebar("sidebar").addTo(MAP),"/"!=window.location.pathname&&!window.location.pathname.endsWith("index.html")||""!=window.location.search||sidebarCoversMap()){var a=createStartHereTooltip();setTimeout(a.show,2500),setTimeout(a.dispose,15e3),$(document).click(function(){a.hide()})}else sidebar.open("pane-welcome")}),$(document).on("mapInitialized",function(){$(window).bind("orientationchange pageshow resize",function(){MAP.invalidateSize()})}),$(document).ready(function(){URL_PARAMS=$.url();var a=URL_PARAMS.param("lat")||URL_PARAMS.param("y"),b=URL_PARAMS.param("lng")||URL_PARAMS.param("x"),c=URL_PARAMS.param("zoom")||URL_PARAMS.param("z");if(mapOptions={base:URL_PARAMS.param("base"),lat:a,lng:b,zoom:c,drop_marker:!1},initMap(mapOptions),URL_PARAMS.param("type")&&URL_PARAMS.param("name")){var d={type:URL_PARAMS.param("type"),name:URL_PARAMS.param("name")};$.get(API_BASEPATH+"ajax/exactnamesearch",d,function(a){if(!(a&&a.s&&a.w&&a.n&&a.e))return alert("Cound not find that feature.");var b=L.latLngBounds(L.latLng(a.s,a.w),L.latLng(a.n,a.e));MAP.fitBounds(b),a.lat&&a.lng?placeTargetMarker(a.lat,a.lng):a.wkt&&(HIGHLIGHT_LINE=lineWKTtoFeature(a.wkt,HIGHLIGHT_LINE_STYLE),MAP.addLayer(HIGHLIGHT_LINE))},"json")}if(URL_PARAMS.param("type")&&URL_PARAMS.param("gid"))if("attraction"==URL_PARAMS.param("type")){var d={gid:URL_PARAMS.param("gid")};$.get(API_BASEPATH+"ajax/get_attraction",d,function(a){if(!a||!a.lat||!a.lng)return alert("Cound not find that feature.");placeTargetMarker(a.lat,a.lng),MAP.flyTo(L.latLng(a.lat,a.lng),DEFAULT_POI_ZOOM),showAttractionInfo(URL_PARAMS.param("type"),a)},"json")}else if("reservation_new"==URL_PARAMS.param("type")){var d={gid:URL_PARAMS.param("gid")};$.get(API_BASEPATH+"ajax/get_reservation",d,function(a){if(!a||!a.lat||!a.lng)return alert("Cound not find that reservation.");MAP.flyTo(L.latLng(a.lat,a.lng),DEFAULT_POI_ZOOM),showAttractionInfo(URL_PARAMS.param("type"),a)},"json")}if(URL_PARAMS.param("routefrom")&&URL_PARAMS.param("routeto")&&URL_PARAMS.param("routevia")){var e=URL_PARAMS.param("routefrom").split(",")[0],f=URL_PARAMS.param("routefrom").split(",")[1],g=URL_PARAMS.param("routeto").split(",")[0],h=URL_PARAMS.param("routeto").split(",")[1],i=URL_PARAMS.param("routevia");sidebar.open("pane-getdirections"),$("#getdirections_disabled").hide(),$("#getdirections_enabled").show(),$("#directions_target_title").text(URL_PARAMS.param("routetitle")),$("#directions_via").val(URL_PARAMS.param("routevia")),$("#directions_via").selectmenu("refresh"),$("#directions_type").val("geocode"),$("#directions_type").selectmenu("refresh"),$("#directions_type_geocode_wrap").show(),$("#directions_address").val(URL_PARAMS.param("routefrom")),$("#directions_target_lat").val(g),$("#directions_target_lng").val(h),$("#directions_via").trigger("change"),$("#directions_address").val(URL_PARAMS.param("fromaddr")),$("#directions_reverse").val(URL_PARAMS.param("whichway")),$("#directions_via_bike").val(URL_PARAMS.param("routevia_bike")),setTimeout(function(){$("#directions_reverse").trigger("change")},1e3),$("#directions_type").val(URL_PARAMS.param("loctype")),getDirections(e,f,g,h,"to",i)}var j=URL_PARAMS.param("base")||"map",k=$('input[name="basemap"][value="photo"]'),l=$('input[name="basemap"][value="map"]');switch(j){case"photo":k.prop("checked",!0).checkboxradio("refresh"),l.prop("checked",!1).checkboxradio("refresh");break;case"map":default:k.prop("checked",!1).checkboxradio("refresh"),l.prop("checked",!0).checkboxradio("refresh")}$.event.trigger({type:"mapReady"})}),$(document).ready(function(){$('input[type="radio"][name="basemap"]').change(function(){var a=$(this).val();changeBasemap(a)})}),$(document).ready(function(){$("div.sortpicker span").click(function(){DEFAULT_SORT=$(this).attr("value"),sortLists()})}),$(document).ready(function(){$(".zoom").click(function(){zoomElementClick($(this))})}),$(document).ready(function(){var a=function(){zoomToAddress($("#geocode_text").val())};$("#geocode_button").click(a),$("#geocode_text").keydown(function(a){13==a.keyCode&&$("#geocode_button").click()})}),$(document).ready(function(){$("#show_on_map").click(showOnMap)});var showOnMap=function(){var a=$(this).data("zoomelement");if(a){var b=a.attr("w"),c=a.attr("s"),d=a.attr("e"),e=a.attr("n"),f=a.attr("lng"),g=a.attr("lat"),h=a.attr("type"),i=$(this).data("wkt"),j=a.attr("gid");"reservation_new"==h&&(j=a.attr("record_id")),h&&setWindowURLQueryStringParameter("type",h),j&&0!=j&&setWindowURLQueryStringParameter("gid",j),clearTargetMarker(),MAP.hasLayer(HIGHLIGHT_LINE)&&MAP.removeLayer(HIGHLIGHT_LINE),switchToMap(function(){if(0!=b&&0!=c&&0!=d&&0!=e){var a=L.latLngBounds(L.latLng(c,b),L.latLng(e,d));a=a.pad(.15),MAP.flyToBounds(a)}else MAP.flyTo(L.latLng(g,f),DEFAULT_POI_ZOOM);"poi"!=h&&"attraction"!=h&&"loop"!=h||placeTargetMarker(g,f),i&&(HIGHLIGHT_LINE=lineWKTtoFeature(i,HIGHLIGHT_LINE_STYLE),MAP.addLayer(HIGHLIGHT_LINE))})}};$(document).ready(function(){$(".copy-to-clipboard").click(function(){var a=$(this).attr("data-copy-id"),b=$(this).closest(".sidebar-pane")[0],c=$("#"+a),d=createCopiedToClipboardTooltip(c[0],b);d.show(),$(document).on("click",function(a){$(a.target).closest(".copy-to-clipboard").length||d.hide()}),c.focus(),c.select(),c[0].setSelectionRange(0,9999),document.execCommand("copy")})}),$(document).on("mapReady",setupWindowUrlUpdates),$(document).ready(function(){$('input[type="radio"][name="coordinate_format"]').change(function(){changeCoordinateFormat($(this).val()),update_user_latlon_display()})}),$(document).ready(function(){getSessionCoordinateFormat()}),$(document).on("mapReady",function(){MAP.on("click",function(a){if(ENABLE_MAPCLICK)return $(".leaflet-popup").length?MAP.closePopup():void wmsGetFeatureInfoByPoint(a.layerPoint)})});