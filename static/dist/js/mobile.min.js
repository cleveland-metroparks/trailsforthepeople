function createStartHereTooltip(){var a=$(".sidebar-tabs ul li:first")[0],b=$("body > div.ui-page")[0];return new Tooltip(a,{title:"Start exploring here!",container:b,placement:"right",trigger:"manual"})}function disableClicksMomentarily(){}function disableClicks(){MAP&&(ENABLE_MAPCLICK=!1,MAP.dragging.removeHooks(),MAP.touchZoom.removeHooks())}function enableClicks(){MAP&&(ENABLE_MAPCLICK=!0,MAP.dragging.addHooks(),MAP.touchZoom.addHooks())}function switchToMap(a){sidebarCoversMap()&&sidebar.close(),a&&setTimeout(a,100)}function showPhoto(a){$("#photo").prop("src",a),sidebar.open("pane-photo")}function showElevation(a){$("#elevation").prop("src",a),sidebar.open("pane-elevationprofile")}function showAttractionInfo(a){if($("#directions_target_lat").val(a.lat),$("#directions_target_lng").val(a.lng),$("#directions_target_type").val(a.type),$("#directions_target_gid").val(a.gid),$("#directions_target_title").text(a.title),sidebar.open("pane-info"),set_pane_back_button("#pane-info","#pane-browse"),$("#getdirections_disabled").hide(),$("#getdirections_enabled").show(),$("#show_on_map").data("wkt",null),$("#info-content").text("Loading..."),a.gid){var b={};b.type="attraction",b.gid=a.gid,$.get(API_BASEPATH+"ajax/moreinfo",b,function(a){$("#info-content").html(a)},"html")}}function zoomElementClick(a){if(ENABLE_MAPCLICK){disableClicksMomentarily();var b=a.attr("type"),c=a.attr("gid");"reservation_new"==b&&(c=a.attr("record_id")),$("#show_on_map").data("zoomelement",a),$("#directions_target_lat").val(a.attr("lat")),$("#directions_target_lng").val(a.attr("lng")),$("#directions_target_type").val(a.attr("type")),$("#directions_target_gid").val(a.attr("gid")),$("#directions_target_title").text(a.attr("title")),sidebar.open("pane-info");var d=a.attr("backbutton");if(d||(d="#pane-browse"),set_pane_back_button("#pane-info",d),$("#getdirections_disabled").hide(),$("#getdirections_enabled").show(),$("#show_on_map").data("wkt",null),$("#info-content").text("Loading..."),b&&c){var e={};e.type=b,e.gid=c,e.lat=LAST_KNOWN_LOCATION.lat,e.lng=LAST_KNOWN_LOCATION.lng,$.get(API_BASEPATH+"ajax/moreinfo",e,function(a){$("#info-content").html(a);var b=$("#info-content").find("div.wkt");b&&($("#show_on_map").data("wkt",b.text()),b.remove()),SKIP_TO_DIRECTIONS&&($("#directions_car").click(),SKIP_TO_DIRECTIONS=!1)},"html")}else $("#info-content").html($("<h1></h1>").text(a.attr("title"))),$("#directions_car").click()}}function sortLists(a){if(a||(a=$(".sidebar-pane.active ul.distance_sortable").eq(0),a.length)){switch(a.find(".zoom_distance").each(function(){var a=$(this).parent().parent(),b=L.latLng(a.attr("lat"),a.attr("lng")),c=LAST_KNOWN_LOCATION.distanceTo(b),d=LAST_KNOWN_LOCATION.bearingWordTo(b),e=c/1609.344,f=3.2808399*c,g=f>900?e.toFixed(1)+" mi":f.toFixed(0)+" ft";g+=" "+d,$(this).text(g),a.data("meters",c)}),DEFAULT_SORT){case"distance":a.children("li").sort(function(a,b){return $(a).data("meters")>$(b).data("meters")?1:-1});break;case"alphabetical":a.children("li").sort(function(a,b){return $(a).attr("title")>$(b).attr("title")?1:-1})}a.children("li.ui-first-child").removeClass("ui-first-child"),a.children("li").first().addClass("ui-first-child"),a.children("li.ui-last-child").removeClass("ui-last-child"),a.children("li").last().addClass("ui-last-child")}}function zoomToAddress(a){if(!a)return!1;var b={};b.address=a,b.bing_key=BING_API_KEY,b.bbox=GEOCODE_BIAS_BOX,$.get(API_BASEPATH+"ajax/geocode",b,function(a){if(!a)return alert("We couldn't find that address or city.\nPlease try again.");var b=L.latLng(a.lat,a.lng);if(!MAX_BOUNDS.contains(b))return alert("The only results we could find are too far away to zoom the map there.");switchToMap(function(){MAP.setView(b,16),placeTargetMarker(a.lat,a.lng);var c="";c+='<h3 class="popup_title">'+a.title+"</h3>",c+='<span class="fakelink zoom" title="'+a.title+'" lat="'+a.lat+'" lng="'+a.lng+'" w="'+a.w+'" s="'+a.s+'" e="'+a.e+'" n="'+a.n+'" onClick="zoomElementClick( $(this) );">Directions</span>';var d=new L.Popup;d.setLatLng(b),d.setContent(c),MAP.openPopup(d)})},"json")}function WSENtoBounds(a,b,c,d){return L.latLngBounds([[b,a],[d,c]])}var sidebar=null;$(document).on("mapInitialized",function(){if(sidebar=L.control.sidebar("sidebar").addTo(MAP),"/"!=window.location.pathname&&!window.location.pathname.endsWith("index.html")||""!=window.location.search||sidebarCoversMap()){var a=createStartHereTooltip();setTimeout(a.show,2500),setTimeout(a.dispose,15e3),document.onclick=a.hide}else sidebar.open("pane-welcome")});var LAST_BEEP_IDS=[],LAST_KNOWN_LOCATION=L.latLng(41.3953,-81.673),AUTO_CENTER_ON_LOCATION=!1,DEFAULT_SORT="distance",URL_PARAMS=null;$(window).bind("orientationchange pageshow resize",function(){var a=$(":jqmData(role='page'):visible"),b=$(":jqmData(role='header'):visible"),c=($(":jqmData(role='c=ontent'):visible"),$(window).height()),d=c-b.outerHeight();a.height(d+1),$(":jqmData(role='content')").first().height(d),$("#map_canvas").is(":visible")&&($("#map_canvas").height(d),MAP&&MAP.invalidateSize())}),$(document).ready(function(){if(URL_PARAMS=$.url(),mapOptions={base:URL_PARAMS.param("base"),x:URL_PARAMS.param("x"),y:URL_PARAMS.param("y"),z:URL_PARAMS.param("z")},initMap(mapOptions),URL_PARAMS.param("type")&&URL_PARAMS.param("name")){var a={type:URL_PARAMS.param("type"),name:URL_PARAMS.param("name")};$.get(API_BASEPATH+"ajax/exactnamesearch",a,function(a){if(!(a&&a.s&&a.w&&a.n&&a.e))return alert("Cound not find that feature.");var b=L.latLngBounds(L.latLng(a.s,a.w),L.latLng(a.n,a.e));MAP.fitBounds(b),a.lat&&a.lng?placeTargetMarker(a.lat,a.lng):a.wkt&&(HIGHLIGHT_LINE=lineWKTtoFeature(a.wkt,HIGHLIGHT_LINE_STYLE),MAP.addLayer(HIGHLIGHT_LINE))},"json")}if(URL_PARAMS.param("type")&&URL_PARAMS.param("gid")&&"attraction"==URL_PARAMS.param("type")){var a={gid:URL_PARAMS.param("gid")};$.get(API_BASEPATH+"ajax/get_attraction",a,function(a){if(!a||!a.lat||!a.lng)return alert("Cound not find that feature.");placeTargetMarker(a.lat,a.lng),MAP.flyTo(L.latLng(a.lat,a.lng),DEFAULT_POI_ZOOM),showAttractionInfo(a)},"json")}if(URL_PARAMS.param("routefrom")&&URL_PARAMS.param("routeto")&&URL_PARAMS.param("routevia")){var b=URL_PARAMS.param("routefrom").split(",")[0],c=URL_PARAMS.param("routefrom").split(",")[1],d=URL_PARAMS.param("routeto").split(",")[0],e=URL_PARAMS.param("routeto").split(",")[1],f=URL_PARAMS.param("routevia");sidebar.open("pane-getdirections"),$("#getdirections_disabled").hide(),$("#getdirections_enabled").show(),$("#directions_target_title").text(URL_PARAMS.param("routetitle")),$("#directions_via").val(URL_PARAMS.param("routevia")),$("#directions_via").selectmenu("refresh"),$("#directions_type").val("geocode"),$("#directions_type").selectmenu("refresh"),$("#directions_type_geocode_wrap").show(),$("#directions_address").val(URL_PARAMS.param("routefrom")),$("#directions_target_lat").val(d),$("#directions_target_lng").val(e),$("#directions_via").trigger("change"),$("#directions_address").val(URL_PARAMS.param("fromaddr")),$("#directions_reverse").val(URL_PARAMS.param("whichway")),$("#directions_via_bike").val(URL_PARAMS.param("routevia_bike")),setTimeout(function(){$("#directions_reverse").trigger("change")},1e3),$("#directions_type").val(URL_PARAMS.param("loctype")),getDirections(b,c,d,e,"to",f)}var g=URL_PARAMS.param("base")||"map",h=$('input[name="basemap"][value="photo"]'),i=$('input[name="basemap"][value="map"]');switch(g){case"photo":h.prop("checked",!0).checkboxradio("refresh"),i.prop("checked",!1).checkboxradio("refresh");break;case"map":default:h.prop("checked",!1).checkboxradio("refresh"),i.prop("checked",!0).checkboxradio("refresh")}$.event.trigger({type:"mapReady"})}),$(document).ready(function(){$('input[type="radio"][name="basemap"]').change(function(){var a=$(this).val();changeBasemap(a)})}),$(document).ready(function(){$("div.sortpicker span").click(function(){DEFAULT_SORT=$(this).attr("value"),sortLists()})}),$(document).ready(function(){var a=function(){zoomToAddress($("#geocode_text").val())};$("#geocode_button").click(a),$("#geocode_text").keydown(function(a){13==a.keyCode&&$("#geocode_button").click()})});var showOnMap=function(){var a=$(this).data("zoomelement");if(a){var b=a.attr("w"),c=a.attr("s"),d=a.attr("e"),e=a.attr("n"),f=a.attr("lng"),g=a.attr("lat"),h=a.attr("type"),i=$(this).data("wkt");switchToMap(function(){if(0!=b&&0!=c&&0!=d&&0!=e){var a=L.latLngBounds(L.latLng(c,b),L.latLng(e,d));a=a.pad(.15),MAP.flyToBounds(a)}else MAP.flyTo(L.latLng(g,f),DEFAULT_POI_ZOOM);"poi"!=h&&"attraction"!=h&&"loop"!=h||placeTargetMarker(g,f),i&&(HIGHLIGHT_LINE&&(MAP.removeLayer(HIGHLIGHT_LINE),HIGHLIGHT_LINE=null),HIGHLIGHT_LINE=lineWKTtoFeature(i,HIGHLIGHT_LINE_STYLE),MAP.addLayer(HIGHLIGHT_LINE))})}};$(document).ready(function(){$("#show_on_map").click(showOnMap)}),$(document).ready(function(){var a=function(){zoomElementClick($(this))};$(".zoom").click(a)});