(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
(function (process){
/**
 * @popperjs/core v2.2.1 - MIT License
 */

'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

function getBoundingClientRect(element) {
  var rect = element.getBoundingClientRect();
  return {
    width: rect.width,
    height: rect.height,
    top: rect.top,
    right: rect.right,
    bottom: rect.bottom,
    left: rect.left,
    x: rect.left,
    y: rect.top
  };
}

/*:: import type { Window } from '../types'; */

/*:: declare function getWindow(node: Node | Window): Window; */
function getWindow(node) {
  if (node.toString() !== '[object Window]') {
    var ownerDocument = node.ownerDocument;
    return ownerDocument ? ownerDocument.defaultView : window;
  }

  return node;
}

function getWindowScroll(node) {
  var win = getWindow(node);
  var scrollLeft = win.pageXOffset;
  var scrollTop = win.pageYOffset;
  return {
    scrollLeft: scrollLeft,
    scrollTop: scrollTop
  };
}

/*:: declare function isElement(node: mixed): boolean %checks(node instanceof
  Element); */

function isElement(node) {
  var OwnElement = getWindow(node).Element;
  return node instanceof OwnElement || node instanceof Element;
}
/*:: declare function isHTMLElement(node: mixed): boolean %checks(node instanceof
  HTMLElement); */


function isHTMLElement(node) {
  var OwnElement = getWindow(node).HTMLElement;
  return node instanceof OwnElement || node instanceof HTMLElement;
}

function getHTMLElementScroll(element) {
  return {
    scrollLeft: element.scrollLeft,
    scrollTop: element.scrollTop
  };
}

function getNodeScroll(node) {
  if (node === getWindow(node) || !isHTMLElement(node)) {
    return getWindowScroll(node);
  } else {
    return getHTMLElementScroll(node);
  }
}

function getNodeName(element) {
  return element ? (element.nodeName || '').toLowerCase() : null;
}

function getDocumentElement(element) {
  // $FlowFixMe: assume body is always available
  return (isElement(element) ? element.ownerDocument : element.document).documentElement;
}

function getWindowScrollBarX(element) {
  // If <html> has a CSS width greater than the viewport, then this will be
  // incorrect for RTL.
  // Popper 1 is broken in this case and never had a bug report so let's assume
  // it's not an issue. I don't think anyone ever specifies width on <html>
  // anyway.
  // Browsers where the left scrollbar doesn't cause an issue report `0` for
  // this (e.g. Edge 2019, IE11, Safari)
  return getBoundingClientRect(getDocumentElement(element)).left + getWindowScroll(element).scrollLeft;
}

// Composite means it takes into account transforms as well as layout.

function getCompositeRect(elementOrVirtualElement, offsetParent, isFixed) {
  if (isFixed === void 0) {
    isFixed = false;
  }

  var documentElement;
  var rect = getBoundingClientRect(elementOrVirtualElement);
  var scroll = {
    scrollLeft: 0,
    scrollTop: 0
  };
  var offsets = {
    x: 0,
    y: 0
  };

  if (!isFixed) {
    if (getNodeName(offsetParent) !== 'body') {
      scroll = getNodeScroll(offsetParent);
    }

    if (isHTMLElement(offsetParent)) {
      offsets = getBoundingClientRect(offsetParent);
      offsets.x += offsetParent.clientLeft;
      offsets.y += offsetParent.clientTop;
    } else if (documentElement = getDocumentElement(offsetParent)) {
      offsets.x = getWindowScrollBarX(documentElement);
    }
  }

  return {
    x: rect.left + scroll.scrollLeft - offsets.x,
    y: rect.top + scroll.scrollTop - offsets.y,
    width: rect.width,
    height: rect.height
  };
}

// Returns the layout rect of an element relative to its offsetParent. Layout
// means it doesn't take into account transforms.
function getLayoutRect(element) {
  return {
    x: element.offsetLeft,
    y: element.offsetTop,
    width: element.offsetWidth,
    height: element.offsetHeight
  };
}

function getParentNode(element) {
  if (getNodeName(element) === 'html') {
    return element;
  }

  return element.parentNode || // DOM Element detected
  // $FlowFixMe: need a better way to handle this...
  element.host || // ShadowRoot detected
  document.ownerDocument || // Fallback to ownerDocument if available
  document.documentElement // Or to documentElement if everything else fails
  ;
}

function getComputedStyle(element) {
  return getWindow(element).getComputedStyle(element);
}

function getScrollParent(node) {
  if (['html', 'body', '#document'].indexOf(getNodeName(node)) >= 0) {
    // $FlowFixMe: assume body is always available
    return node.ownerDocument.body;
  }

  if (isHTMLElement(node)) {
    // Firefox wants us to check `-x` and `-y` variations as well
    var _getComputedStyle = getComputedStyle(node),
        overflow = _getComputedStyle.overflow,
        overflowX = _getComputedStyle.overflowX,
        overflowY = _getComputedStyle.overflowY;

    if (/auto|scroll|overlay|hidden/.test(overflow + overflowY + overflowX)) {
      return node;
    }
  }

  return getScrollParent(getParentNode(node));
}

function listScrollParents(element, list) {
  if (list === void 0) {
    list = [];
  }

  var scrollParent = getScrollParent(element);
  var isBody = getNodeName(scrollParent) === 'body';
  var target = isBody ? getWindow(scrollParent) : scrollParent;
  var updatedList = list.concat(target);
  return isBody ? updatedList : // $FlowFixMe: isBody tells us target will be an HTMLElement here
  updatedList.concat(listScrollParents(getParentNode(target)));
}

function isTableElement(element) {
  return ['table', 'td', 'th'].indexOf(getNodeName(element)) >= 0;
}

function getTrueOffsetParent(element) {
  if (!isHTMLElement(element) || // https://github.com/popperjs/popper-core/issues/837
  getComputedStyle(element).position === 'fixed') {
    return null;
  }

  return element.offsetParent;
}

function getOffsetParent(element) {
  var window = getWindow(element);
  var offsetParent = getTrueOffsetParent(element); // Find the nearest non-table offsetParent

  while (offsetParent && isTableElement(offsetParent)) {
    offsetParent = getTrueOffsetParent(offsetParent);
  }

  if (offsetParent && getNodeName(offsetParent) === 'body' && getComputedStyle(offsetParent).position === 'static') {
    return window;
  }

  return offsetParent || window;
}

var top = 'top';
var bottom = 'bottom';
var right = 'right';
var left = 'left';
var auto = 'auto';
var basePlacements = [top, bottom, right, left];
var start = 'start';
var end = 'end';
var clippingParents = 'clippingParents';
var viewport = 'viewport';
var popper = 'popper';
var reference = 'reference';
var variationPlacements =
/*#__PURE__*/
basePlacements.reduce(function (acc, placement) {
  return acc.concat([placement + "-" + start, placement + "-" + end]);
}, []);
var placements =
/*#__PURE__*/
[].concat(basePlacements, [auto]).reduce(function (acc, placement) {
  return acc.concat([placement, placement + "-" + start, placement + "-" + end]);
}, []); // modifiers that need to read the DOM

var beforeRead = 'beforeRead';
var read = 'read';
var afterRead = 'afterRead'; // pure-logic modifiers

var beforeMain = 'beforeMain';
var main = 'main';
var afterMain = 'afterMain'; // modifier with the purpose to write to the DOM (or write into a framework state)

var beforeWrite = 'beforeWrite';
var write = 'write';
var afterWrite = 'afterWrite';
var modifierPhases = [beforeRead, read, afterRead, beforeMain, main, afterMain, beforeWrite, write, afterWrite];

function order(modifiers) {
  var map = new Map();
  var visited = new Set();
  var result = [];
  modifiers.forEach(function (modifier) {
    map.set(modifier.name, modifier);
  }); // On visiting object, check for its dependencies and visit them recursively

  function sort(modifier) {
    visited.add(modifier.name);
    var requires = [].concat(modifier.requires || [], modifier.requiresIfExists || []);
    requires.forEach(function (dep) {
      if (!visited.has(dep)) {
        var depModifier = map.get(dep);

        if (depModifier) {
          sort(depModifier);
        }
      }
    });
    result.push(modifier);
  }

  modifiers.forEach(function (modifier) {
    if (!visited.has(modifier.name)) {
      // check for visited object
      sort(modifier);
    }
  });
  return result;
}

function orderModifiers(modifiers) {
  // order based on dependencies
  var orderedModifiers = order(modifiers); // order based on phase

  return modifierPhases.reduce(function (acc, phase) {
    return acc.concat(orderedModifiers.filter(function (modifier) {
      return modifier.phase === phase;
    }));
  }, []);
}

function debounce(fn) {
  var pending;
  return function () {
    if (!pending) {
      pending = new Promise(function (resolve) {
        Promise.resolve().then(function () {
          pending = undefined;
          resolve(fn());
        });
      });
    }

    return pending;
  };
}

function format(str) {
  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    args[_key - 1] = arguments[_key];
  }

  return [].concat(args).reduce(function (p, c) {
    return p.replace(/%s/, c);
  }, str);
}

var INVALID_MODIFIER_ERROR = 'Popper: modifier "%s" provided an invalid %s property, expected %s but got %s';
var MISSING_DEPENDENCY_ERROR = 'Popper: modifier "%s" requires "%s", but "%s" modifier is not available';
var VALID_PROPERTIES = ['name', 'enabled', 'phase', 'fn', 'effect', 'requires', 'options'];
function validateModifiers(modifiers) {
  modifiers.forEach(function (modifier) {
    Object.keys(modifier).forEach(function (key) {
      switch (key) {
        case 'name':
          if (typeof modifier.name !== 'string') {
            console.error(format(INVALID_MODIFIER_ERROR, String(modifier.name), '"name"', '"string"', "\"" + String(modifier.name) + "\""));
          }

          break;

        case 'enabled':
          if (typeof modifier.enabled !== 'boolean') {
            console.error(format(INVALID_MODIFIER_ERROR, modifier.name, '"enabled"', '"boolean"', "\"" + String(modifier.enabled) + "\""));
          }

        case 'phase':
          if (modifierPhases.indexOf(modifier.phase) < 0) {
            console.error(format(INVALID_MODIFIER_ERROR, modifier.name, '"phase"', "either " + modifierPhases.join(', '), "\"" + String(modifier.phase) + "\""));
          }

          break;

        case 'fn':
          if (typeof modifier.fn !== 'function') {
            console.error(format(INVALID_MODIFIER_ERROR, modifier.name, '"fn"', '"function"', "\"" + String(modifier.fn) + "\""));
          }

          break;

        case 'effect':
          if (typeof modifier.effect !== 'function') {
            console.error(format(INVALID_MODIFIER_ERROR, modifier.name, '"effect"', '"function"', "\"" + String(modifier.fn) + "\""));
          }

          break;

        case 'requires':
          if (!Array.isArray(modifier.requires)) {
            console.error(format(INVALID_MODIFIER_ERROR, modifier.name, '"requires"', '"array"', "\"" + String(modifier.requires) + "\""));
          }

          break;

        case 'requiresIfExists':
          if (!Array.isArray(modifier.requiresIfExists)) {
            console.error(format(INVALID_MODIFIER_ERROR, modifier.name, '"requiresIfExists"', '"array"', "\"" + String(modifier.requiresIfExists) + "\""));
          }

          break;

        case 'options':
        case 'data':
          break;

        default:
          console.error("PopperJS: an invalid property has been provided to the \"" + modifier.name + "\" modifier, valid properties are " + VALID_PROPERTIES.map(function (s) {
            return "\"" + s + "\"";
          }).join(', ') + "; but \"" + key + "\" was provided.");
      }

      modifier.requires && modifier.requires.forEach(function (requirement) {
        if (modifiers.find(function (mod) {
          return mod.name === requirement;
        }) == null) {
          console.error(format(MISSING_DEPENDENCY_ERROR, String(modifier.name), requirement, requirement));
        }
      });
    });
  });
}

function uniqueBy(arr, fn) {
  var identifiers = new Set();
  return arr.filter(function (item) {
    var identifier = fn(item);

    if (!identifiers.has(identifier)) {
      identifiers.add(identifier);
      return true;
    }
  });
}

function getBasePlacement(placement) {
  return placement.split('-')[0];
}

function mergeByName(modifiers) {
  var merged = modifiers.reduce(function (merged, current) {
    var existing = merged[current.name];
    merged[current.name] = existing ? Object.assign({}, existing, {}, current, {
      options: Object.assign({}, existing.options, {}, current.options),
      data: Object.assign({}, existing.data, {}, current.data)
    }) : current;
    return merged;
  }, {}); // IE11 does not support Object.values

  return Object.keys(merged).map(function (key) {
    return merged[key];
  });
}

var INVALID_ELEMENT_ERROR = 'Popper: Invalid reference or popper argument provided. They must be either a DOM element or virtual element.';
var INFINITE_LOOP_ERROR = 'Popper: An infinite loop in the modifiers cycle has been detected! The cycle has been interrupted to prevent a browser crash.';
var DEFAULT_OPTIONS = {
  placement: 'bottom',
  modifiers: [],
  strategy: 'absolute'
};

function areValidElements() {
  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
    args[_key] = arguments[_key];
  }

  return !args.some(function (element) {
    return !(element && typeof element.getBoundingClientRect === 'function');
  });
}

function popperGenerator(generatorOptions) {
  if (generatorOptions === void 0) {
    generatorOptions = {};
  }

  var _generatorOptions = generatorOptions,
      _generatorOptions$def = _generatorOptions.defaultModifiers,
      defaultModifiers = _generatorOptions$def === void 0 ? [] : _generatorOptions$def,
      _generatorOptions$def2 = _generatorOptions.defaultOptions,
      defaultOptions = _generatorOptions$def2 === void 0 ? DEFAULT_OPTIONS : _generatorOptions$def2;
  return function createPopper(reference, popper, options) {
    if (options === void 0) {
      options = defaultOptions;
    }

    var state = {
      placement: 'bottom',
      orderedModifiers: [],
      options: Object.assign({}, DEFAULT_OPTIONS, {}, defaultOptions),
      modifiersData: {},
      elements: {
        reference: reference,
        popper: popper
      },
      attributes: {},
      styles: {}
    };
    var effectCleanupFns = [];
    var isDestroyed = false;
    var instance = {
      state: state,
      setOptions: function setOptions(options) {
        cleanupModifierEffects();
        state.options = Object.assign({}, defaultOptions, {}, state.options, {}, options);
        state.scrollParents = {
          reference: isElement(reference) ? listScrollParents(reference) : reference.contextElement ? listScrollParents(reference.contextElement) : [],
          popper: listScrollParents(popper)
        }; // Orders the modifiers based on their dependencies and `phase`
        // properties

        var orderedModifiers = orderModifiers(mergeByName([].concat(defaultModifiers, state.options.modifiers))); // Strip out disabled modifiers

        state.orderedModifiers = orderedModifiers.filter(function (m) {
          return m.enabled;
        }); // Validate the provided modifiers so that the consumer will get warned
        // if one of the modifiers is invalid for any reason

        if (process.env.NODE_ENV !== "production") {
          var modifiers = uniqueBy([].concat(orderedModifiers, state.options.modifiers), function (_ref) {
            var name = _ref.name;
            return name;
          });
          validateModifiers(modifiers);

          if (getBasePlacement(state.options.placement) === auto) {
            var flipModifier = state.orderedModifiers.find(function (_ref2) {
              var name = _ref2.name;
              return name === 'flip';
            });

            if (!flipModifier) {
              console.error(['Popper: "auto" placements require the "flip" modifier be', 'present and enabled to work.'].join(' '));
            }
          }

          var _getComputedStyle = getComputedStyle(popper),
              marginTop = _getComputedStyle.marginTop,
              marginRight = _getComputedStyle.marginRight,
              marginBottom = _getComputedStyle.marginBottom,
              marginLeft = _getComputedStyle.marginLeft; // We no longer take into account `margins` on the popper, and it can
          // cause bugs with positioning, so we'll warn the consumer


          if ([marginTop, marginRight, marginBottom, marginLeft].some(function (margin) {
            return parseFloat(margin);
          })) {
            console.warn(['Popper: CSS "margin" styles cannot be used to apply padding', 'between the popper and its reference element or boundary.', 'To replicate margin, use the `offset` modifier, as well as', 'the `padding` option in the `preventOverflow` and `flip`', 'modifiers.'].join(' '));
          }
        }

        runModifierEffects();
        return instance.update();
      },
      // Sync update – it will always be executed, even if not necessary. This
      // is useful for low frequency updates where sync behavior simplifies the
      // logic.
      // For high frequency updates (e.g. `resize` and `scroll` events), always
      // prefer the async Popper#update method
      forceUpdate: function forceUpdate() {
        if (isDestroyed) {
          return;
        }

        var _state$elements = state.elements,
            reference = _state$elements.reference,
            popper = _state$elements.popper; // Don't proceed if `reference` or `popper` are not valid elements
        // anymore

        if (!areValidElements(reference, popper)) {
          if (process.env.NODE_ENV !== "production") {
            console.error(INVALID_ELEMENT_ERROR);
          }

          return;
        } // Store the reference and popper rects to be read by modifiers


        state.rects = {
          reference: getCompositeRect(reference, getOffsetParent(popper), state.options.strategy === 'fixed'),
          popper: getLayoutRect(popper)
        }; // Modifiers have the ability to reset the current update cycle. The
        // most common use case for this is the `flip` modifier changing the
        // placement, which then needs to re-run all the modifiers, because the
        // logic was previously ran for the previous placement and is therefore
        // stale/incorrect

        state.reset = false;
        state.placement = state.options.placement; // On each update cycle, the `modifiersData` property for each modifier
        // is filled with the initial data specified by the modifier. This means
        // it doesn't persist and is fresh on each update.
        // To ensure persistent data, use `${name}#persistent`

        state.orderedModifiers.forEach(function (modifier) {
          return state.modifiersData[modifier.name] = Object.assign({}, modifier.data);
        });
        var __debug_loops__ = 0;

        for (var index = 0; index < state.orderedModifiers.length; index++) {
          if (process.env.NODE_ENV !== "production") {
            __debug_loops__ += 1;

            if (__debug_loops__ > 100) {
              console.error(INFINITE_LOOP_ERROR);
              break;
            }
          }

          if (state.reset === true) {
            state.reset = false;
            index = -1;
            continue;
          }

          var _state$orderedModifie = state.orderedModifiers[index],
              fn = _state$orderedModifie.fn,
              _state$orderedModifie2 = _state$orderedModifie.options,
              _options = _state$orderedModifie2 === void 0 ? {} : _state$orderedModifie2,
              name = _state$orderedModifie.name;

          if (typeof fn === 'function') {
            state = fn({
              state: state,
              options: _options,
              name: name,
              instance: instance
            }) || state;
          }
        }
      },
      // Async and optimistically optimized update – it will not be executed if
      // not necessary (debounced to run at most once-per-tick)
      update: debounce(function () {
        return new Promise(function (resolve) {
          instance.forceUpdate();
          resolve(state);
        });
      }),
      destroy: function destroy() {
        cleanupModifierEffects();
        isDestroyed = true;
      }
    };

    if (!areValidElements(reference, popper)) {
      if (process.env.NODE_ENV !== "production") {
        console.error(INVALID_ELEMENT_ERROR);
      }

      return instance;
    }

    instance.setOptions(options).then(function (state) {
      if (!isDestroyed && options.onFirstUpdate) {
        options.onFirstUpdate(state);
      }
    }); // Modifiers have the ability to execute arbitrary code before the first
    // update cycle runs. They will be executed in the same order as the update
    // cycle. This is useful when a modifier adds some persistent data that
    // other modifiers need to use, but the modifier is run after the dependent
    // one.

    function runModifierEffects() {
      state.orderedModifiers.forEach(function (_ref3) {
        var name = _ref3.name,
            _ref3$options = _ref3.options,
            options = _ref3$options === void 0 ? {} : _ref3$options,
            effect = _ref3.effect;

        if (typeof effect === 'function') {
          var cleanupFn = effect({
            state: state,
            name: name,
            instance: instance,
            options: options
          });

          var noopFn = function noopFn() {};

          effectCleanupFns.push(cleanupFn || noopFn);
        }
      });
    }

    function cleanupModifierEffects() {
      effectCleanupFns.forEach(function (fn) {
        return fn();
      });
      effectCleanupFns = [];
    }

    return instance;
  };
}

var passive = {
  passive: true
};

function effect(_ref) {
  var state = _ref.state,
      instance = _ref.instance,
      options = _ref.options;
  var _options$scroll = options.scroll,
      scroll = _options$scroll === void 0 ? true : _options$scroll,
      _options$resize = options.resize,
      resize = _options$resize === void 0 ? true : _options$resize;
  var window = getWindow(state.elements.popper);
  var scrollParents = [].concat(state.scrollParents.reference, state.scrollParents.popper);

  if (scroll) {
    scrollParents.forEach(function (scrollParent) {
      scrollParent.addEventListener('scroll', instance.update, passive);
    });
  }

  if (resize) {
    window.addEventListener('resize', instance.update, passive);
  }

  return function () {
    if (scroll) {
      scrollParents.forEach(function (scrollParent) {
        scrollParent.removeEventListener('scroll', instance.update, passive);
      });
    }

    if (resize) {
      window.removeEventListener('resize', instance.update, passive);
    }
  };
}

var eventListeners = {
  name: 'eventListeners',
  enabled: true,
  phase: 'write',
  fn: function fn() {},
  effect: effect,
  data: {}
};

function getVariation(placement) {
  return placement.split('-')[1];
}

function getMainAxisFromPlacement(placement) {
  return ['top', 'bottom'].indexOf(placement) >= 0 ? 'x' : 'y';
}

function computeOffsets(_ref) {
  var reference = _ref.reference,
      element = _ref.element,
      placement = _ref.placement;
  var basePlacement = placement ? getBasePlacement(placement) : null;
  var variation = placement ? getVariation(placement) : null;
  var commonX = reference.x + reference.width / 2 - element.width / 2;
  var commonY = reference.y + reference.height / 2 - element.height / 2;
  var offsets;

  switch (basePlacement) {
    case top:
      offsets = {
        x: commonX,
        y: reference.y - element.height
      };
      break;

    case bottom:
      offsets = {
        x: commonX,
        y: reference.y + reference.height
      };
      break;

    case right:
      offsets = {
        x: reference.x + reference.width,
        y: commonY
      };
      break;

    case left:
      offsets = {
        x: reference.x - element.width,
        y: commonY
      };
      break;

    default:
      offsets = {
        x: reference.x,
        y: reference.y
      };
  }

  var mainAxis = basePlacement ? getMainAxisFromPlacement(basePlacement) : null;

  if (mainAxis != null) {
    var len = mainAxis === 'y' ? 'height' : 'width';

    switch (variation) {
      case start:
        offsets[mainAxis] = Math.floor(offsets[mainAxis]) - Math.floor(reference[len] / 2 - element[len] / 2);
        break;

      case end:
        offsets[mainAxis] = Math.floor(offsets[mainAxis]) + Math.ceil(reference[len] / 2 - element[len] / 2);
        break;
    }
  }

  return offsets;
}

function popperOffsets(_ref) {
  var state = _ref.state,
      name = _ref.name;
  // Offsets are the actual position the popper needs to have to be
  // properly positioned near its reference element
  // This is the most basic placement, and will be adjusted by
  // the modifiers in the next step
  state.modifiersData[name] = computeOffsets({
    reference: state.rects.reference,
    element: state.rects.popper,
    strategy: 'absolute',
    placement: state.placement
  });
}

var popperOffsets$1 = {
  name: 'popperOffsets',
  enabled: true,
  phase: 'read',
  fn: popperOffsets,
  data: {}
};

var unsetSides = {
  top: 'auto',
  right: 'auto',
  bottom: 'auto',
  left: 'auto'
}; // Round the offsets to the nearest suitable subpixel based on the DPR.
// Zooming can change the DPR, but it seems to report a value that will
// cleanly divide the values into the appropriate subpixels.

function roundOffsets(_ref) {
  var x = _ref.x,
      y = _ref.y;
  var win = window;
  var dpr = win.devicePixelRatio || 1;
  return {
    x: Math.round(x * dpr) / dpr || 0,
    y: Math.round(y * dpr) / dpr || 0
  };
}

function mapToStyles(_ref2) {
  var _Object$assign2;

  var popper = _ref2.popper,
      popperRect = _ref2.popperRect,
      placement = _ref2.placement,
      offsets = _ref2.offsets,
      position = _ref2.position,
      gpuAcceleration = _ref2.gpuAcceleration,
      adaptive = _ref2.adaptive;

  var _roundOffsets = roundOffsets(offsets),
      x = _roundOffsets.x,
      y = _roundOffsets.y;

  var hasX = offsets.hasOwnProperty('x');
  var hasY = offsets.hasOwnProperty('y');
  var sideX = left;
  var sideY = top;
  var win = window;

  if (adaptive) {
    var offsetParent = getOffsetParent(popper);

    if (offsetParent === getWindow(popper)) {
      offsetParent = getDocumentElement(popper);
    } // $FlowFixMe: force type refinement, we compare offsetParent with window above, but Flow doesn't detect it

    /*:: offsetParent = (offsetParent: Element); */


    if (placement === top) {
      sideY = bottom;
      y -= offsetParent.clientHeight - popperRect.height;
      y *= gpuAcceleration ? 1 : -1;
    }

    if (placement === left) {
      sideX = right;
      x -= offsetParent.clientWidth - popperRect.width;
      x *= gpuAcceleration ? 1 : -1;
    }
  }

  var commonStyles = Object.assign({
    position: position
  }, adaptive && unsetSides);

  if (gpuAcceleration) {
    var _Object$assign;

    return Object.assign({}, commonStyles, (_Object$assign = {}, _Object$assign[sideY] = hasY ? '0' : '', _Object$assign[sideX] = hasX ? '0' : '', _Object$assign.transform = (win.devicePixelRatio || 1) < 2 ? "translate(" + x + "px, " + y + "px)" : "translate3d(" + x + "px, " + y + "px, 0)", _Object$assign));
  }

  return Object.assign({}, commonStyles, (_Object$assign2 = {}, _Object$assign2[sideY] = hasY ? y + "px" : '', _Object$assign2[sideX] = hasX ? x + "px" : '', _Object$assign2.transform = '', _Object$assign2));
}

function computeStyles(_ref3) {
  var state = _ref3.state,
      options = _ref3.options;
  var _options$gpuAccelerat = options.gpuAcceleration,
      gpuAcceleration = _options$gpuAccelerat === void 0 ? true : _options$gpuAccelerat,
      _options$adaptive = options.adaptive,
      adaptive = _options$adaptive === void 0 ? true : _options$adaptive;

  if (process.env.NODE_ENV !== "production") {
    var _getComputedStyle = getComputedStyle(state.elements.popper),
        transitionProperty = _getComputedStyle.transitionProperty;

    if (adaptive && ['transform', 'top', 'right', 'bottom', 'left'].some(function (property) {
      return transitionProperty.indexOf(property) >= 0;
    })) {
      console.warn(['Popper: Detected CSS transitions on at least one of the following', 'CSS properties: "transform", "top", "right", "bottom", "left".', '\n\n', 'Disable the "computeStyles" modifier\'s `adaptive` option to allow', 'for smooth transitions, or remove these properties from the CSS', 'transition declaration on the popper element if only transitioning', 'opacity or background-color for example.', '\n\n', 'We recommend using the popper element as a wrapper around an inner', 'element that can have any CSS property transitioned for animations.'].join(' '));
    }
  }

  var commonStyles = {
    placement: getBasePlacement(state.placement),
    popper: state.elements.popper,
    popperRect: state.rects.popper,
    gpuAcceleration: gpuAcceleration
  }; // popper offsets are always available

  state.styles.popper = Object.assign({}, state.styles.popper, {}, mapToStyles(Object.assign({}, commonStyles, {
    offsets: state.modifiersData.popperOffsets,
    position: state.options.strategy,
    adaptive: adaptive
  }))); // arrow offsets may not be available

  if (state.modifiersData.arrow != null) {
    state.styles.arrow = Object.assign({}, state.styles.arrow, {}, mapToStyles(Object.assign({}, commonStyles, {
      offsets: state.modifiersData.arrow,
      position: 'absolute',
      adaptive: false
    })));
  }

  state.attributes.popper = Object.assign({}, state.attributes.popper, {
    'data-popper-placement': state.placement
  });
}

var computeStyles$1 = {
  name: 'computeStyles',
  enabled: true,
  phase: 'beforeWrite',
  fn: computeStyles,
  data: {}
};

// and applies them to the HTMLElements such as popper and arrow

function applyStyles(_ref) {
  var state = _ref.state;
  Object.keys(state.elements).forEach(function (name) {
    var style = state.styles[name] || {};
    var attributes = state.attributes[name] || {};
    var element = state.elements[name]; // arrow is optional + virtual elements

    if (!isHTMLElement(element) || !getNodeName(element)) {
      return;
    } // Flow doesn't support to extend this property, but it's the most
    // effective way to apply styles to an HTMLElement
    // $FlowFixMe


    Object.assign(element.style, style);
    Object.keys(attributes).forEach(function (name) {
      var value = attributes[name];

      if (value === false) {
        element.removeAttribute(name);
      } else {
        element.setAttribute(name, value === true ? '' : value);
      }
    });
  });
}

function effect$1(_ref2) {
  var state = _ref2.state;
  var initialStyles = {
    popper: {
      position: 'absolute',
      left: '0',
      top: '0',
      margin: '0'
    },
    arrow: {
      position: 'absolute'
    },
    reference: {}
  };
  Object.assign(state.elements.popper.style, initialStyles.popper);

  if (state.elements.arrow) {
    Object.assign(state.elements.arrow.style, initialStyles.arrow);
  }

  return function () {
    Object.keys(state.elements).forEach(function (name) {
      var element = state.elements[name];
      var attributes = state.attributes[name] || {};
      var styleProperties = Object.keys(state.styles.hasOwnProperty(name) ? state.styles[name] : initialStyles[name]); // Set all values to an empty string to unset them

      var style = styleProperties.reduce(function (style, property) {
        style[property] = '';
        return style;
      }, {}); // arrow is optional + virtual elements

      if (!isHTMLElement(element) || !getNodeName(element)) {
        return;
      } // Flow doesn't support to extend this property, but it's the most
      // effective way to apply styles to an HTMLElement
      // $FlowFixMe


      Object.assign(element.style, style);
      Object.keys(attributes).forEach(function (attribute) {
        element.removeAttribute(attribute);
      });
    });
  };
}

var applyStyles$1 = {
  name: 'applyStyles',
  enabled: true,
  phase: 'write',
  fn: applyStyles,
  effect: effect$1,
  requires: ['computeStyles']
};

function distanceAndSkiddingToXY(placement, rects, offset) {
  var basePlacement = getBasePlacement(placement);
  var invertDistance = [left, top].indexOf(basePlacement) >= 0 ? -1 : 1;

  var _ref = typeof offset === 'function' ? offset(Object.assign({}, rects, {
    placement: placement
  })) : offset,
      skidding = _ref[0],
      distance = _ref[1];

  skidding = skidding || 0;
  distance = (distance || 0) * invertDistance;
  return [left, right].indexOf(basePlacement) >= 0 ? {
    x: distance,
    y: skidding
  } : {
    x: skidding,
    y: distance
  };
}

function offset(_ref2) {
  var state = _ref2.state,
      options = _ref2.options,
      name = _ref2.name;
  var _options$offset = options.offset,
      offset = _options$offset === void 0 ? [0, 0] : _options$offset;
  var data = placements.reduce(function (acc, placement) {
    acc[placement] = distanceAndSkiddingToXY(placement, state.rects, offset);
    return acc;
  }, {});
  var _data$state$placement = data[state.placement],
      x = _data$state$placement.x,
      y = _data$state$placement.y;
  state.modifiersData.popperOffsets.x += x;
  state.modifiersData.popperOffsets.y += y;
  state.modifiersData[name] = data;
}

var offset$1 = {
  name: 'offset',
  enabled: true,
  phase: 'main',
  requires: ['popperOffsets'],
  fn: offset
};

var hash = {
  left: 'right',
  right: 'left',
  bottom: 'top',
  top: 'bottom'
};
function getOppositePlacement(placement) {
  return placement.replace(/left|right|bottom|top/g, function (matched) {
    return hash[matched];
  });
}

var hash$1 = {
  start: 'end',
  end: 'start'
};
function getOppositeVariationPlacement(placement) {
  return placement.replace(/start|end/g, function (matched) {
    return hash$1[matched];
  });
}

function getViewportRect(element) {
  var win = getWindow(element);
  return {
    width: win.innerWidth,
    height: win.innerHeight,
    x: 0,
    y: 0
  };
}

function getDocumentRect(element) {
  var win = getWindow(element);
  var winScroll = getWindowScroll(element);
  var documentRect = getCompositeRect(getDocumentElement(element), win);
  documentRect.height = Math.max(documentRect.height, win.innerHeight);
  documentRect.width = Math.max(documentRect.width, win.innerWidth);
  documentRect.x = -winScroll.scrollLeft;
  documentRect.y = -winScroll.scrollTop;
  return documentRect;
}

function toNumber(cssValue) {
  return parseFloat(cssValue) || 0;
}

function getBorders(element) {
  var computedStyle = isHTMLElement(element) ? getComputedStyle(element) : {};
  return {
    top: toNumber(computedStyle.borderTopWidth),
    right: toNumber(computedStyle.borderRightWidth),
    bottom: toNumber(computedStyle.borderBottomWidth),
    left: toNumber(computedStyle.borderLeftWidth)
  };
}

function getDecorations(element) {
  var win = getWindow(element);
  var borders = getBorders(element);
  var isHTML = getNodeName(element) === 'html';
  var winScrollBarX = getWindowScrollBarX(element);
  var x = element.clientWidth + borders.right;
  var y = element.clientHeight + borders.bottom; // HACK:
  // document.documentElement.clientHeight on iOS reports the height of the
  // viewport including the bottom bar, even if the bottom bar isn't visible.
  // If the difference between window innerHeight and html clientHeight is more
  // than 50, we assume it's a mobile bottom bar and ignore scrollbars.
  // * A 50px thick scrollbar is likely non-existent (macOS is 15px and Windows
  //   is about 17px)
  // * The mobile bar is 114px tall

  if (isHTML && win.innerHeight - element.clientHeight > 50) {
    y = win.innerHeight - borders.bottom;
  }

  return {
    top: isHTML ? 0 : element.clientTop,
    right: // RTL scrollbar (scrolling containers only)
    element.clientLeft > borders.left ? borders.right : // LTR scrollbar
    isHTML ? win.innerWidth - x - winScrollBarX : element.offsetWidth - x,
    bottom: isHTML ? win.innerHeight - y : element.offsetHeight - y,
    left: isHTML ? winScrollBarX : element.clientLeft
  };
}

function contains(parent, child) {
  // $FlowFixMe: hasOwnProperty doesn't seem to work in tests
  var isShadow = Boolean(child.getRootNode && child.getRootNode().host); // First, attempt with faster native method

  if (parent.contains(child)) {
    return true;
  } // then fallback to custom implementation with Shadow DOM support
  else if (isShadow) {
      var next = child;

      do {
        if (next && parent.isSameNode(next)) {
          return true;
        } // $FlowFixMe: need a better way to handle this...


        next = next.parentNode || next.host;
      } while (next);
    } // Give up, the result is false


  return false;
}

function rectToClientRect(rect) {
  return Object.assign({}, rect, {
    left: rect.x,
    top: rect.y,
    right: rect.x + rect.width,
    bottom: rect.y + rect.height
  });
}

function getClientRectFromMixedType(element, clippingParent) {
  return clippingParent === viewport ? rectToClientRect(getViewportRect(element)) : isHTMLElement(clippingParent) ? getBoundingClientRect(clippingParent) : rectToClientRect(getDocumentRect(getDocumentElement(element)));
} // A "clipping parent" is an overflowable container with the characteristic of
// clipping (or hiding) overflowing elements with a position different from
// `initial`


function getClippingParents(element) {
  var clippingParents = listScrollParents(element);
  var canEscapeClipping = ['absolute', 'fixed'].indexOf(getComputedStyle(element).position) >= 0;
  var clipperElement = canEscapeClipping && isHTMLElement(element) ? getOffsetParent(element) : element;

  if (!isElement(clipperElement)) {
    return [];
  } // $FlowFixMe: https://github.com/facebook/flow/issues/1414


  return clippingParents.filter(function (clippingParent) {
    return isElement(clippingParent) && contains(clippingParent, clipperElement);
  });
} // Gets the maximum area that the element is visible in due to any number of
// clipping parents


function getClippingRect(element, boundary, rootBoundary) {
  var mainClippingParents = boundary === 'clippingParents' ? getClippingParents(element) : [].concat(boundary);
  var clippingParents = [].concat(mainClippingParents, [rootBoundary]);
  var firstClippingParent = clippingParents[0];
  var clippingRect = clippingParents.reduce(function (accRect, clippingParent) {
    var rect = getClientRectFromMixedType(element, clippingParent);
    var decorations = getDecorations(isHTMLElement(clippingParent) ? clippingParent : getDocumentElement(element));
    accRect.top = Math.max(rect.top + decorations.top, accRect.top);
    accRect.right = Math.min(rect.right - decorations.right, accRect.right);
    accRect.bottom = Math.min(rect.bottom - decorations.bottom, accRect.bottom);
    accRect.left = Math.max(rect.left + decorations.left, accRect.left);
    return accRect;
  }, getClientRectFromMixedType(element, firstClippingParent));
  clippingRect.width = clippingRect.right - clippingRect.left;
  clippingRect.height = clippingRect.bottom - clippingRect.top;
  clippingRect.x = clippingRect.left;
  clippingRect.y = clippingRect.top;
  return clippingRect;
}

function getFreshSideObject() {
  return {
    top: 0,
    right: 0,
    bottom: 0,
    left: 0
  };
}

function mergePaddingObject(paddingObject) {
  return Object.assign({}, getFreshSideObject(), {}, paddingObject);
}

function expandToHashMap(value, keys) {
  return keys.reduce(function (hashMap, key) {
    hashMap[key] = value;
    return hashMap;
  }, {});
}

function detectOverflow(state, options) {
  if (options === void 0) {
    options = {};
  }

  var _options = options,
      _options$placement = _options.placement,
      placement = _options$placement === void 0 ? state.placement : _options$placement,
      _options$boundary = _options.boundary,
      boundary = _options$boundary === void 0 ? clippingParents : _options$boundary,
      _options$rootBoundary = _options.rootBoundary,
      rootBoundary = _options$rootBoundary === void 0 ? viewport : _options$rootBoundary,
      _options$elementConte = _options.elementContext,
      elementContext = _options$elementConte === void 0 ? popper : _options$elementConte,
      _options$altBoundary = _options.altBoundary,
      altBoundary = _options$altBoundary === void 0 ? false : _options$altBoundary,
      _options$padding = _options.padding,
      padding = _options$padding === void 0 ? 0 : _options$padding;
  var paddingObject = mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements));
  var altContext = elementContext === popper ? reference : popper;
  var referenceElement = state.elements.reference;
  var popperRect = state.rects.popper;
  var element = state.elements[altBoundary ? altContext : elementContext];
  var clippingClientRect = getClippingRect(isElement(element) ? element : element.contextElement || getDocumentElement(state.elements.popper), boundary, rootBoundary);
  var referenceClientRect = getBoundingClientRect(referenceElement);
  var popperOffsets = computeOffsets({
    reference: referenceClientRect,
    element: popperRect,
    strategy: 'absolute',
    placement: placement
  });
  var popperClientRect = rectToClientRect(Object.assign({}, popperRect, {}, popperOffsets));
  var elementClientRect = elementContext === popper ? popperClientRect : referenceClientRect; // positive = overflowing the clipping rect
  // 0 or negative = within the clipping rect

  var overflowOffsets = {
    top: clippingClientRect.top - elementClientRect.top + paddingObject.top,
    bottom: elementClientRect.bottom - clippingClientRect.bottom + paddingObject.bottom,
    left: clippingClientRect.left - elementClientRect.left + paddingObject.left,
    right: elementClientRect.right - clippingClientRect.right + paddingObject.right
  };
  var offsetData = state.modifiersData.offset; // Offsets can be applied only to the popper element

  if (elementContext === popper && offsetData) {
    var offset = offsetData[placement];
    Object.keys(overflowOffsets).forEach(function (key) {
      var multiply = [right, bottom].indexOf(key) >= 0 ? 1 : -1;
      var axis = [top, bottom].indexOf(key) >= 0 ? 'y' : 'x';
      overflowOffsets[key] += offset[axis] * multiply;
    });
  }

  return overflowOffsets;
}

function computeAutoPlacement(state, options) {
  if (options === void 0) {
    options = {};
  }

  var _options = options,
      placement = _options.placement,
      boundary = _options.boundary,
      rootBoundary = _options.rootBoundary,
      padding = _options.padding,
      flipVariations = _options.flipVariations;
  var variation = getVariation(placement);
  var placements = variation ? flipVariations ? variationPlacements : variationPlacements.filter(function (placement) {
    return getVariation(placement) === variation;
  }) : basePlacements; // $FlowFixMe: Flow seems to have problems with two array unions...

  var overflows = placements.reduce(function (acc, placement) {
    acc[placement] = detectOverflow(state, {
      placement: placement,
      boundary: boundary,
      rootBoundary: rootBoundary,
      padding: padding
    })[getBasePlacement(placement)];
    return acc;
  }, {});
  return Object.keys(overflows).sort(function (a, b) {
    return overflows[a] - overflows[b];
  });
}

function getExpandedFallbackPlacements(placement) {
  if (getBasePlacement(placement) === auto) {
    return [];
  }

  var oppositePlacement = getOppositePlacement(placement);
  return [getOppositeVariationPlacement(placement), oppositePlacement, getOppositeVariationPlacement(oppositePlacement)];
}

function flip(_ref) {
  var state = _ref.state,
      options = _ref.options,
      name = _ref.name;

  if (state.modifiersData[name]._skip) {
    return;
  }

  var specifiedFallbackPlacements = options.fallbackPlacements,
      padding = options.padding,
      boundary = options.boundary,
      rootBoundary = options.rootBoundary,
      altBoundary = options.altBoundary,
      _options$flipVariatio = options.flipVariations,
      flipVariations = _options$flipVariatio === void 0 ? true : _options$flipVariatio;
  var preferredPlacement = state.options.placement;
  var basePlacement = getBasePlacement(preferredPlacement);
  var isBasePlacement = basePlacement === preferredPlacement;
  var fallbackPlacements = specifiedFallbackPlacements || (isBasePlacement || !flipVariations ? [getOppositePlacement(preferredPlacement)] : getExpandedFallbackPlacements(preferredPlacement));
  var placements = [preferredPlacement].concat(fallbackPlacements).reduce(function (acc, placement) {
    return acc.concat(getBasePlacement(placement) === auto ? computeAutoPlacement(state, {
      placement: placement,
      boundary: boundary,
      rootBoundary: rootBoundary,
      padding: padding,
      flipVariations: flipVariations
    }) : placement);
  }, []);
  var referenceRect = state.rects.reference;
  var popperRect = state.rects.popper;
  var checksMap = new Map();
  var makeFallbackChecks = true;
  var firstFittingPlacement = placements[0];

  for (var i = 0; i < placements.length; i++) {
    var placement = placements[i];

    var _basePlacement = getBasePlacement(placement);

    var isStartVariation = getVariation(placement) === start;
    var isVertical = [top, bottom].indexOf(_basePlacement) >= 0;
    var len = isVertical ? 'width' : 'height';
    var overflow = detectOverflow(state, {
      placement: placement,
      boundary: boundary,
      rootBoundary: rootBoundary,
      altBoundary: altBoundary,
      padding: padding
    });
    var mainVariationSide = isVertical ? isStartVariation ? right : left : isStartVariation ? bottom : top;

    if (referenceRect[len] > popperRect[len]) {
      mainVariationSide = getOppositePlacement(mainVariationSide);
    }

    var altVariationSide = getOppositePlacement(mainVariationSide);
    var checks = [overflow[_basePlacement] <= 0, overflow[mainVariationSide] <= 0, overflow[altVariationSide] <= 0];

    if (checks.every(function (check) {
      return check;
    })) {
      firstFittingPlacement = placement;
      makeFallbackChecks = false;
      break;
    }

    checksMap.set(placement, checks);
  }

  if (makeFallbackChecks) {
    // `2` may be desired in some cases – research later
    var numberOfChecks = flipVariations ? 3 : 1;

    var _loop = function _loop(_i) {
      var fittingPlacement = placements.find(function (placement) {
        var checks = checksMap.get(placement);

        if (checks) {
          return checks.slice(0, _i).every(function (check) {
            return check;
          });
        }
      });

      if (fittingPlacement) {
        firstFittingPlacement = fittingPlacement;
        return "break";
      }
    };

    for (var _i = numberOfChecks; _i > 0; _i--) {
      var _ret = _loop(_i);

      if (_ret === "break") break;
    }
  }

  if (state.placement !== firstFittingPlacement) {
    state.modifiersData[name]._skip = true;
    state.placement = firstFittingPlacement;
    state.reset = true;
  }
}

var flip$1 = {
  name: 'flip',
  enabled: true,
  phase: 'main',
  fn: flip,
  requiresIfExists: ['offset'],
  data: {
    _skip: false
  }
};

function getAltAxis(axis) {
  return axis === 'x' ? 'y' : 'x';
}

function within(min, value, max) {
  return Math.max(min, Math.min(value, max));
}

function preventOverflow(_ref) {
  var state = _ref.state,
      options = _ref.options,
      name = _ref.name;
  var _options$mainAxis = options.mainAxis,
      checkMainAxis = _options$mainAxis === void 0 ? true : _options$mainAxis,
      _options$altAxis = options.altAxis,
      checkAltAxis = _options$altAxis === void 0 ? false : _options$altAxis,
      boundary = options.boundary,
      rootBoundary = options.rootBoundary,
      altBoundary = options.altBoundary,
      padding = options.padding,
      _options$tether = options.tether,
      tether = _options$tether === void 0 ? true : _options$tether,
      _options$tetherOffset = options.tetherOffset,
      tetherOffset = _options$tetherOffset === void 0 ? 0 : _options$tetherOffset;
  var overflow = detectOverflow(state, {
    boundary: boundary,
    rootBoundary: rootBoundary,
    padding: padding,
    altBoundary: altBoundary
  });
  var basePlacement = getBasePlacement(state.placement);
  var variation = getVariation(state.placement);
  var isBasePlacement = !variation;
  var mainAxis = getMainAxisFromPlacement(basePlacement);
  var altAxis = getAltAxis(mainAxis);
  var popperOffsets = state.modifiersData.popperOffsets;
  var referenceRect = state.rects.reference;
  var popperRect = state.rects.popper;
  var tetherOffsetValue = typeof tetherOffset === 'function' ? tetherOffset(Object.assign({}, state.rects, {
    placement: state.placement
  })) : tetherOffset;
  var data = {
    x: 0,
    y: 0
  };

  if (checkMainAxis) {
    var mainSide = mainAxis === 'y' ? top : left;
    var altSide = mainAxis === 'y' ? bottom : right;
    var len = mainAxis === 'y' ? 'height' : 'width';
    var offset = popperOffsets[mainAxis];
    var min = popperOffsets[mainAxis] + overflow[mainSide];
    var max = popperOffsets[mainAxis] - overflow[altSide];
    var additive = tether ? -popperRect[len] / 2 : 0;
    var minLen = variation === start ? referenceRect[len] : popperRect[len];
    var maxLen = variation === start ? -popperRect[len] : -referenceRect[len]; // We need to include the arrow in the calculation so the arrow doesn't go
    // outside the reference bounds

    var arrowElement = state.elements.arrow;
    var arrowRect = tether && arrowElement ? getLayoutRect(arrowElement) : {
      width: 0,
      height: 0
    };
    var arrowPaddingObject = state.modifiersData['arrow#persistent'] ? state.modifiersData['arrow#persistent'].padding : getFreshSideObject();
    var arrowPaddingMin = arrowPaddingObject[mainSide];
    var arrowPaddingMax = arrowPaddingObject[altSide]; // If the reference length is smaller than the arrow length, we don't want
    // to include its full size in the calculation. If the reference is small
    // and near the edge of a boundary, the popper can overflow even if the
    // reference is not overflowing as well (e.g. virtual elements with no
    // width or height)

    var arrowLen = within(0, referenceRect[len], arrowRect[len]);
    var minOffset = isBasePlacement ? referenceRect[len] / 2 - additive - arrowLen - arrowPaddingMin - tetherOffsetValue : minLen - arrowLen - arrowPaddingMin - tetherOffsetValue;
    var maxOffset = isBasePlacement ? -referenceRect[len] / 2 + additive + arrowLen + arrowPaddingMax + tetherOffsetValue : maxLen + arrowLen + arrowPaddingMax + tetherOffsetValue;
    var arrowOffsetParent = state.elements.arrow && getOffsetParent(state.elements.arrow);
    var clientOffset = arrowOffsetParent ? mainAxis === 'y' ? arrowOffsetParent.clientTop || 0 : arrowOffsetParent.clientLeft || 0 : 0;
    var offsetModifierValue = state.modifiersData.offset ? state.modifiersData.offset[state.placement][mainAxis] : 0;
    var tetherMin = popperOffsets[mainAxis] + minOffset - offsetModifierValue - clientOffset;
    var tetherMax = popperOffsets[mainAxis] + maxOffset - offsetModifierValue;
    var preventedOffset = within(tether ? Math.min(min, tetherMin) : min, offset, tether ? Math.max(max, tetherMax) : max);
    popperOffsets[mainAxis] = preventedOffset;
    data[mainAxis] = preventedOffset - offset;
  }

  if (checkAltAxis) {
    var _mainSide = mainAxis === 'x' ? top : left;

    var _altSide = mainAxis === 'x' ? bottom : right;

    var _offset = popperOffsets[altAxis];

    var _min = _offset + overflow[_mainSide];

    var _max = _offset - overflow[_altSide];

    var _preventedOffset = within(_min, _offset, _max);

    state.modifiersData.popperOffsets[altAxis] = _preventedOffset;
    data[altAxis] = _preventedOffset - _offset;
  }

  state.modifiersData[name] = data;
}

var preventOverflow$1 = {
  name: 'preventOverflow',
  enabled: true,
  phase: 'main',
  fn: preventOverflow,
  requiresIfExists: ['offset']
};

function arrow(_ref) {
  var _state$modifiersData$;

  var state = _ref.state,
      name = _ref.name;
  var arrowElement = state.elements.arrow;
  var popperOffsets = state.modifiersData.popperOffsets;
  var basePlacement = getBasePlacement(state.placement);
  var axis = getMainAxisFromPlacement(basePlacement);
  var isVertical = [left, right].indexOf(basePlacement) >= 0;
  var len = isVertical ? 'height' : 'width';

  if (!arrowElement) {
    return;
  }

  var paddingObject = state.modifiersData[name + "#persistent"].padding;
  var arrowRect = getLayoutRect(arrowElement);
  var minProp = axis === 'y' ? top : left;
  var maxProp = axis === 'y' ? bottom : right;
  var endDiff = state.rects.reference[len] + state.rects.reference[axis] - popperOffsets[axis] - state.rects.popper[len];
  var startDiff = popperOffsets[axis] - state.rects.reference[axis];
  var arrowOffsetParent = state.elements.arrow && getOffsetParent(state.elements.arrow);
  var clientSize = arrowOffsetParent ? axis === 'y' ? arrowOffsetParent.clientHeight || 0 : arrowOffsetParent.clientWidth || 0 : 0;
  var centerToReference = endDiff / 2 - startDiff / 2; // Make sure the arrow doesn't overflow the popper if the center point is
  // outside of the popper bounds

  var min = paddingObject[minProp];
  var max = clientSize - arrowRect[len] - paddingObject[maxProp];
  var center = clientSize / 2 - arrowRect[len] / 2 + centerToReference;
  var offset = within(min, center, max); // Prevents breaking syntax highlighting...

  var axisProp = axis;
  state.modifiersData[name] = (_state$modifiersData$ = {}, _state$modifiersData$[axisProp] = offset, _state$modifiersData$.centerOffset = offset - center, _state$modifiersData$);
}

function effect$2(_ref2) {
  var state = _ref2.state,
      options = _ref2.options,
      name = _ref2.name;
  var _options$element = options.element,
      arrowElement = _options$element === void 0 ? '[data-popper-arrow]' : _options$element,
      _options$padding = options.padding,
      padding = _options$padding === void 0 ? 0 : _options$padding; // CSS selector

  if (typeof arrowElement === 'string') {
    arrowElement = state.elements.popper.querySelector(arrowElement);

    if (!arrowElement) {
      return;
    }
  }

  if (!contains(state.elements.popper, arrowElement)) {
    if (process.env.NODE_ENV !== "production") {
      console.error(['Popper: "arrow" modifier\'s `element` must be a child of the popper', 'element.'].join(' '));
    }

    return;
  }

  state.elements.arrow = arrowElement;
  state.modifiersData[name + "#persistent"] = {
    padding: mergePaddingObject(typeof padding !== 'number' ? padding : expandToHashMap(padding, basePlacements))
  };
}

var arrow$1 = {
  name: 'arrow',
  enabled: true,
  phase: 'main',
  fn: arrow,
  effect: effect$2,
  requires: ['popperOffsets'],
  requiresIfExists: ['preventOverflow']
};

function getSideOffsets(overflow, rect, preventedOffsets) {
  if (preventedOffsets === void 0) {
    preventedOffsets = {
      x: 0,
      y: 0
    };
  }

  return {
    top: overflow.top - rect.height - preventedOffsets.y,
    right: overflow.right - rect.width + preventedOffsets.x,
    bottom: overflow.bottom - rect.height + preventedOffsets.y,
    left: overflow.left - rect.width - preventedOffsets.x
  };
}

function isAnySideFullyClipped(overflow) {
  return [top, right, bottom, left].some(function (side) {
    return overflow[side] >= 0;
  });
}

function hide(_ref) {
  var state = _ref.state,
      name = _ref.name;
  var referenceRect = state.rects.reference;
  var popperRect = state.rects.popper;
  var preventedOffsets = state.modifiersData.preventOverflow;
  var referenceOverflow = detectOverflow(state, {
    elementContext: 'reference'
  });
  var popperAltOverflow = detectOverflow(state, {
    altBoundary: true
  });
  var referenceClippingOffsets = getSideOffsets(referenceOverflow, referenceRect);
  var popperEscapeOffsets = getSideOffsets(popperAltOverflow, popperRect, preventedOffsets);
  var isReferenceHidden = isAnySideFullyClipped(referenceClippingOffsets);
  var hasPopperEscaped = isAnySideFullyClipped(popperEscapeOffsets);
  state.modifiersData[name] = {
    referenceClippingOffsets: referenceClippingOffsets,
    popperEscapeOffsets: popperEscapeOffsets,
    isReferenceHidden: isReferenceHidden,
    hasPopperEscaped: hasPopperEscaped
  };
  state.attributes.popper = Object.assign({}, state.attributes.popper, {
    'data-popper-reference-hidden': isReferenceHidden,
    'data-popper-escaped': hasPopperEscaped
  });
}

var hide$1 = {
  name: 'hide',
  enabled: true,
  phase: 'main',
  requiresIfExists: ['preventOverflow'],
  fn: hide
};

var defaultModifiers = [eventListeners, popperOffsets$1, computeStyles$1, applyStyles$1, offset$1, flip$1, preventOverflow$1, arrow$1, hide$1];
var createPopper =
/*#__PURE__*/
popperGenerator({
  defaultModifiers: defaultModifiers
}); // eslint-disable-next-line import/no-unused-modules

exports.createPopper = createPopper;
exports.defaultModifiers = defaultModifiers;
exports.detectOverflow = detectOverflow;
exports.popperGenerator = popperGenerator;


}).call(this,require('_process'))
},{"_process":8}],2:[function(require,module,exports){
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.turf={})}(this,function(t){"use strict";function e(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.bbox,i=n.id;if(void 0===t)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");r&&N(r),i&&C(i);var o={type:"Feature"};return i&&(o.id=i),r&&(o.bbox=r),o.properties=e||{},o.geometry=t,o}function n(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var i=n.bbox;if(!t)throw new Error("type is required");if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");i&&N(i);var s;switch(t){case"Point":s=r(e).geometry;break;case"LineString":s=a(e).geometry;break;case"Polygon":s=o(e).geometry;break;case"MultiPoint":s=l(e).geometry;break;case"MultiLineString":s=h(e).geometry;break;case"MultiPolygon":s=p(e).geometry;break;default:throw new Error(t+" is invalid")}return i&&(s.bbox=i),s}function r(t,n,r){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!b(t[0])||!b(t[1]))throw new Error("coordinates must contain numbers");return e({type:"Point",coordinates:t},n,r)}function i(t,e,n){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");return c(t.map(function(t){return r(t,e)}),n)}function o(t,n,r){if(!t)throw new Error("coordinates is required");for(var i=0;i<t.length;i++){var o=t[i];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<o[o.length-1].length;s++){if(0===i&&0===s&&!b(o[0][0])||!b(o[0][1]))throw new Error("coordinates must contain numbers");if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}}return e({type:"Polygon",coordinates:t},n,r)}function s(t,e,n){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");return c(t.map(function(t){return o(t,e)}),n)}function a(t,n,r){if(!t)throw new Error("coordinates is required");if(t.length<2)throw new Error("coordinates must be an array of two or more positions");if(!b(t[0][1])||!b(t[0][1]))throw new Error("coordinates must contain numbers");return e({type:"LineString",coordinates:t},n,r)}function u(t,e,n){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");return c(t.map(function(t){return a(t,e)}),n)}function c(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.bbox,r=e.id;if(!t)throw new Error("No features passed");if(!Array.isArray(t))throw new Error("features must be an Array");n&&N(n),r&&C(r);var i={type:"FeatureCollection"};return r&&(i.id=r),n&&(i.bbox=n),i.features=t,i}function h(t,n,r){if(!t)throw new Error("coordinates is required");return e({type:"MultiLineString",coordinates:t},n,r)}function l(t,n,r){if(!t)throw new Error("coordinates is required");return e({type:"MultiPoint",coordinates:t},n,r)}function p(t,n,r){if(!t)throw new Error("coordinates is required");return e({type:"MultiPolygon",coordinates:t},n,r)}function f(t,n,r){if(!t)throw new Error("geometries is required");if(!Array.isArray(t))throw new Error("geometries must be an Array");return e({type:"GeometryCollection",geometries:t},n,r)}function g(t,e){if(void 0===t||null===t||isNaN(t))throw new Error("num is required");if(e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n}function d(t,e){if(void 0===t||null===t)throw new Error("radians is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var n=qo[e||"kilometers"];if(!n)throw new Error(e+" units is invalid");return t*n}function y(t,e){if(void 0===t||null===t)throw new Error("distance is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var n=qo[e||"kilometers"];if(!n)throw new Error(e+" units is invalid");return t/n}function _(t,e){return v(y(t,e))}function m(t){if(null===t||void 0===t)throw new Error("bearing is required");var e=t%360;return e<0&&(e+=360),e}function v(t){if(null===t||void 0===t)throw new Error("radians is required");return 180*(t%(2*Math.PI))/Math.PI}function x(t){if(null===t||void 0===t)throw new Error("degrees is required");return t%360*Math.PI/180}function E(t,e,n){if(null===t||void 0===t)throw new Error("length is required");if(!(t>=0))throw new Error("length must be a positive number");return d(y(t,e),n||"kilometers")}function w(t,e,n){if(null===t||void 0===t)throw new Error("area is required");if(!(t>=0))throw new Error("area must be a positive number");var r=Bo[e||"meters"];if(!r)throw new Error("invalid original units");var i=Bo[n||"kilometers"];if(!i)throw new Error("invalid final units");return t/r*i}function b(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function I(t){return!!t&&t.constructor===Object}function N(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(t){if(!b(t))throw new Error("bbox must only contain numbers")})}function C(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}function S(t,e,n){if(null!==t)for(var r,i,o,s,a,u,c,h,l=0,p=0,f=t.type,g="FeatureCollection"===f,d="Feature"===f,y=g?t.features.length:1,_=0;_<y;_++){a=(h=!!(c=g?t.features[_].geometry:d?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var m=0;m<a;m++){var v=0,x=0;if(null!==(s=h?c.geometries[m]:c)){u=s.coordinates;var E=s.type;switch(l=!n||"Polygon"!==E&&"MultiPolygon"!==E?0:1,E){case null:break;case"Point":e(u,p,_,v,x),p++,v++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++)e(u[r],p,_,v,x),p++,"MultiPoint"===E&&v++;"LineString"===E&&v++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-l;i++)e(u[r][i],p,_,v,x),p++;"MultiLineString"===E&&v++,"Polygon"===E&&x++}"Polygon"===E&&v++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for("MultiPolygon"===E&&(x=0),i=0;i<u[r].length;i++){for(o=0;o<u[r][i].length-l;o++)e(u[r][i][o],p,_,v,x),p++;x++}v++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)S(s.geometries[r],e,n);break;default:throw new Error("Unknown Geometry Type")}}}}}function M(t,e,n,r){var i=n;return S(t,function(t,r,o,s,a){i=0===r&&void 0===n?t:e(i,t,r,o,s,a)},r),i}function L(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length;n++)e(t.features[n].properties,n);break;case"Feature":e(t.properties,0)}}function P(t,e,n){var r=n;return L(t,function(t,i){r=0===i&&void 0===n?t:e(r,t,i)}),r}function O(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)e(t.features[n],n)}function R(t,e,n){var r=n;return O(t,function(t,i){r=0===i&&void 0===n?t:e(r,t,i)}),r}function T(t){var e=[];return S(t,function(t){e.push(t)}),e}function A(t,e){var n,r,i,o,s,a,u,c,h,l,p=0,f="FeatureCollection"===t.type,g="Feature"===t.type,d=f?t.features.length:1;for(n=0;n<d;n++){for(a=f?t.features[n].geometry:g?t.geometry:t,c=f?t.features[n].properties:g?t.properties:{},h=f?t.features[n].bbox:g?t.bbox:void 0,l=f?t.features[n].id:g?t.id:void 0,s=(u=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,i=0;i<s;i++)if(null!==(o=u?a.geometries[i]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":e(o,p,c,h,l);break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)e(o.geometries[r],p,c,h,l);break;default:throw new Error("Unknown Geometry Type")}else e(null,p,c,h,l);p++}}function D(t,e,n){var r=n;return A(t,function(t,i,o,s,a){r=0===i&&void 0===n?t:e(r,t,i,o,s,a)}),r}function F(t,n){A(t,function(t,r,i,o,s){var a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return void n(e(t,i,{bbox:o,id:s}),r,0)}var u;switch(a){case"MultiPoint":u="Point";break;case"MultiLineString":u="LineString";break;case"MultiPolygon":u="Polygon"}t.coordinates.forEach(function(t,o){n(e({type:u,coordinates:t},i),r,o)})})}function q(t,e,n){var r=n;return F(t,function(t,i,o){r=0===i&&0===o&&void 0===n?t:e(r,t,i,o)}),r}function G(t,e){F(t,function(t,n,r){var i=0;if(t.geometry){var o=t.geometry.type;"Point"!==o&&"MultiPoint"!==o&&M(t,function(o,s,u,c,h,l){var p=a([o,s],t.properties);return e(p,n,r,l,i),i++,s})}})}function B(t,e,n){var r=n,i=!1;return G(t,function(t,o,s,a,u){r=!1===i&&void 0===n?t:e(r,t,o,s,a,u),i=!0}),r}function k(t,e){if(!t)throw new Error("geojson is required");F(t,function(t,n,r){if(null!==t.geometry){var i=t.geometry.type,o=t.geometry.coordinates;switch(i){case"LineString":e(t,n,r,0,0);break;case"Polygon":for(var s=0;s<o.length;s++)e(a(o[s],t.properties),n,r,s)}}})}function z(t,e,n){var r=n;return k(t,function(t,i,o,s){r=0===i&&void 0===n?t:e(r,t,i,o,s)}),r}function j(t){var e=[1/0,1/0,-1/0,-1/0];return S(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}function X(t){if(!t)throw new Error("obj is required");var e=U(t);if(e.length>1&&b(e[0])&&b(e[1]))return e;throw new Error("Coordinate is not a valid Point")}function U(t){if(!t)throw new Error("obj is required");var e;if(t.length?e=t:t.coordinates?e=t.coordinates:t.geometry&&t.geometry.coordinates&&(e=t.geometry.coordinates),e)return Y(e),e;throw new Error("No valid coordinates")}function Y(t){if(t.length>1&&b(t[0])&&b(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Y(t[0]);throw new Error("coordinates must only contain numbers")}function V(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}function H(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}function W(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||"FeatureCollection"!==t.type)throw new Error("Invalid input to "+n+", FeatureCollection required");for(var r=0;r<t.features.length;r++){var i=t.features[r];if(!i||"Feature"!==i.type||!i.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!i.geometry||i.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+i.geometry.type)}}function J(t){if(!t)throw new Error("geojson is required");if(void 0!==t.geometry)return t.geometry;if(t.coordinates||t.geometries)return t;throw new Error("geojson must be a valid Feature or Geometry Object")}function Z(){throw new Error("invariant.getGeomType has been deprecated in v5.0 in favor of invariant.getType")}function K(t,e){if(!t)throw new Error((e||"geojson")+" is required");if(t.geometry&&t.geometry.type)return t.geometry.type;if(t.type)return t.type;throw new Error((e||"geojson")+" is invalid")}function Q(t,e,n){n=n||{};for(var r=Object.keys(Xo),i=0;i<r.length;i++){var o=r[i],s=n[o];s=void 0!==s&&null!==s?s:Xo[o],Uo[o]=s}Uo.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+e);var a=function(t){var e=[],n=0;t.rows,t.cols;return t.cells.forEach(function(r,i){r.forEach(function(r,o){if(void 0!==r&&!function(t){return 5===t.cval||10===t.cval}(r)&&!tt(r)){var s=function(t,e,n){var r,i,o,s=t.length,a=[],u=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],c=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],h=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],l=(t[e][n],t[e][n]),p=l.cval,f=nt(l,o=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"][p]);a.push([n+f[0],e+f[1]]),f=nt(l,o=h[p]),a.push([n+f[0],e+f[1]]),et(l);for(var g=n+u[p],d=e+c[p],y=p;g>=0&&d>=0&&d<s&&(g!=n||d!=e)&&void 0!==(l=t[d][g]);){if(0===(p=l.cval)||15===p)return{path:a,info:"mergeable"};o=h[p],r=u[p],i=c[p],5!==p&&10!==p||(5===p?l.flipped?-1===c[y]?(o="left",r=-1,i=0):(o="right",r=1,i=0):-1===u[y]&&(o="bottom",r=0,i=-1):10===p&&(l.flipped?-1===u[y]?(o="top",r=0,i=1):(o="bottom",r=0,i=-1):1===c[y]&&(o="left",r=-1,i=0))),f=nt(l,o),a.push([g+f[0],d+f[1]]),et(l),g+=r,d+=i,y=p}return{path:a,info:"closed"}}(t.cells,i,o),a=!1;if("mergeable"===s.info)for(var u=s.path[s.path.length-1][0],c=s.path[s.path.length-1][1],h=n-1;h>=0;h--)if(Math.abs(e[h][0][0]-u)<=1e-7&&Math.abs(e[h][0][1]-c)<=1e-7){for(var l=s.path.length-2;l>=0;--l)e[h].unshift(s.path[l]);a=!0;break}a||(e[n++]=s.path)}})}),e}(function(t,e){for(var n=t.length-1,r=t[0].length-1,i={rows:n,cols:r,cells:[]},o=0;o<n;++o){i.cells[o]=[];for(var s=0;s<r;++s){var a=0,u=t[o+1][s],c=t[o+1][s+1],h=t[o][s+1],l=t[o][s];if(!(isNaN(u)||isNaN(c)||isNaN(h)||isNaN(l))){a|=u>=e?8:0,a|=c>=e?4:0,a|=h>=e?2:0;var p=!1;if(5===(a|=l>=e?1:0)||10===a){var f=(u+c+h+l)/4;5===a&&f<e?(a=10,p=!0):10===a&&f<e&&(a=5,p=!0)}if(0!==a&&15!==a){var g,d,y,_;g=d=y=_=.5,1===a?(y=1-$(e,u,l),d=1-$(e,h,l)):2===a?(d=$(e,l,h),_=1-$(e,c,h)):3===a?(y=1-$(e,u,l),_=1-$(e,c,h)):4===a?(g=$(e,u,c),_=$(e,h,c)):5===a?(g=$(e,u,c),_=$(e,h,c),d=1-$(e,h,l),y=1-$(e,u,l)):6===a?(d=$(e,l,h),g=$(e,u,c)):7===a?(y=1-$(e,u,l),g=$(e,u,c)):8===a?(y=$(e,l,u),g=1-$(e,c,u)):9===a?(d=1-$(e,h,l),g=1-$(e,c,u)):10===a?(g=1-$(e,c,u),_=1-$(e,c,h),d=$(e,l,h),y=$(e,l,u)):11===a?(g=1-$(e,c,u),_=1-$(e,c,h)):12===a?(y=$(e,l,u),_=$(e,h,c)):13===a?(d=1-$(e,h,l),_=$(e,h,c)):14===a?(y=$(e,l,u),d=$(e,l,h)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+a),i.cells[o][s]={cval:a,flipped:p,top:g,right:_,bottom:d,left:y}}}}}return i}(t,e));return"function"==typeof Uo.successCallback&&Uo.successCallback(a),a}function $(t,e,n){return(t-e)/(n-e)}function tt(t){return 0===t.cval||15===t.cval}function et(t){tt(t)||5===t.cval||10===t.cval||(t.cval=15)}function nt(t,e){return"top"===e?[t.top,1]:"bottom"===e?[t.bottom,0]:"right"===e?[1,t.right]:"left"===e?[0,t.left]:void 0}function rt(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.zProperty||"elevation",r=e.flip,i=e.flags;W(t,"Point","input must contain Points");for(var o=function(t,e){var n={};O(t,function(t){var e=U(t)[1];n[e]||(n[e]=[]),n[e].push(t)});return Object.keys(n).map(function(t){var e=n[t],r=e.sort(function(t,e){return U(t)[0]-U(e)[0]});return r}).sort(function(t,n){return e?U(t[0])[1]-U(n[0])[1]:U(n[0])[1]-U(t[0])[1]})}(t,r),s=[],a=0;a<o.length;a++){for(var u=o[a],c=[],h=0;h<u.length;h++){var l=u[h];l.properties[n]?c.push(l.properties[n]):c.push(0),!0===i&&(l.properties.matrixPosition=[a,h])}s.push(c)}return s}function it(t,e,n,r,i){for(n=n||0,r=r||t.length-1,i=i||function(t,e){return t<e?-1:t>e?1:0};r>n;){if(r-n>600){var o=r-n+1,s=e-n+1,a=Math.log(o),u=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*u*(o-u)/o)*(s-o/2<0?-1:1);it(t,e,Math.max(n,Math.floor(e-s*u/o+c)),Math.min(r,Math.floor(e+(o-s)*u/o+c)),i)}var h=t[e],l=n,p=r;for(ot(t,n,e),i(t[r],h)>0&&ot(t,n,r);l<p;){for(ot(t,l,p),l++,p--;i(t[l],h)<0;)l++;for(;i(t[p],h)>0;)p--}0===i(t[n],h)?ot(t,n,p):ot(t,++p,r),p<=e&&(n=p+1),e<=p&&(r=p-1)}}function ot(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function st(t,e){if(!(this instanceof st))return new st(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function at(t,e){ut(t,0,t.children.length,e,t)}function ut(t,e,n,r,i){i||(i=yt(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,s=e;s<n;s++)o=t.children[s],ct(i,t.leaf?r(o):o);return i}function ct(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function ht(t,e){return t.minX-e.minX}function lt(t,e){return t.minY-e.minY}function pt(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function ft(t){return t.maxX-t.minX+(t.maxY-t.minY)}function gt(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function dt(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function yt(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _t(t,e,n,r,i){for(var o,s=[e,n];s.length;)(n=s.pop())-(e=s.pop())<=r||(o=e+Math.ceil((n-e)/r/2)*r,Yo(t,o,e,n,i),s.push(e,o,o,n))}function mt(t,e){return e={exports:{}},t(e,e.exports),e.exports}function vt(t,e){if(!(this instanceof vt))return new vt(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||function(t,e){return t<e?-1:t>e?1:0},this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function xt(t,e,n){e=Math.max(0,void 0===e?2:e),n=n||0;for(var r,i=function(t){for(var e=t[0],n=t[0],r=t[0],i=t[0],o=0;o<t.length;o++){var s=t[o];s[0]<e[0]&&(e=s),s[0]>r[0]&&(r=s),s[1]<n[1]&&(n=s),s[1]>i[1]&&(i=s)}var a=[e,n,r,i],u=a.slice();for(o=0;o<t.length;o++)is(t[o],a)||u.push(t[o]);var c=ts(u),h=[];for(o=0;o<c.length;o++)h.push(u[c[o]]);return h}(t),o=Vo(16,["[0]","[1]","[0]","[1]"]).load(t),s=[],a=0;a<i.length;a++){var u=i[a];o.remove(u),r=Nt(u,r),s.push(r)}var c=Vo(16);for(a=0;a<s.length;a++)c.insert(It(s[a]));for(var h=e*e,l=n*n;s.length;){var p=s.shift(),f=p.p,g=p.next.p,d=Ct(f,g);if(!(d<l)){var y=d/h;(u=function(t,e,n,r,i,o,s){var a=new ns(null,Et),u=t.data;for(;u;){for(var c=0;c<u.children.length;c++){var h=u.children[c],l=u.leaf?St(h,n,r):function(t,e,n){if(wt(t,n)||wt(e,n))return 0;var r=Mt(t[0],t[1],e[0],e[1],n.minX,n.minY,n.maxX,n.minY);if(0===r)return 0;var i=Mt(t[0],t[1],e[0],e[1],n.minX,n.minY,n.minX,n.maxY);if(0===i)return 0;var o=Mt(t[0],t[1],e[0],e[1],n.maxX,n.minY,n.maxX,n.maxY);if(0===o)return 0;var s=Mt(t[0],t[1],e[0],e[1],n.minX,n.maxY,n.maxX,n.maxY);return 0===s?0:Math.min(r,i,o,s)}(n,r,h);l>o||a.push({node:h,dist:l})}for(;a.length&&!a.peek().node.children;){var p=a.pop(),f=p.node,g=St(f,e,n),d=St(f,r,i);if(p.dist<g&&p.dist<d&&bt(n,f,s)&&bt(r,f,s))return f}(u=a.pop())&&(u=u.node)}return null}(o,p.prev.p,f,g,p.next.next.p,y,c))&&Math.min(Ct(u,f),Ct(u,g))<=y&&(s.push(p),s.push(Nt(u,p)),o.remove(u),c.remove(p),c.insert(It(p)),c.insert(It(p.next)))}}p=r;var _=[];do{_.push(p.p),p=p.next}while(p!==r);return _.push(p.p),_}function Et(t,e){return t.dist-e.dist}function wt(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function bt(t,e,n){for(var r=Math.min(t[0],e[0]),i=Math.min(t[1],e[1]),o=Math.max(t[0],e[0]),s=Math.max(t[1],e[1]),a=n.search({minX:r,minY:i,maxX:o,maxY:s}),u=0;u<a.length;u++)if(function(t,e,n,r){return t!==r&&e!==n&&os(t,e,n)>0!=os(t,e,r)>0&&os(n,r,t)>0!=os(n,r,e)>0}(a[u].p,a[u].next.p,t,e))return!1;return!0}function It(t){var e=t.p,n=t.next.p;return t.minX=Math.min(e[0],n[0]),t.minY=Math.min(e[1],n[1]),t.maxX=Math.max(e[0],n[0]),t.maxY=Math.max(e[1],n[1]),t}function Nt(t,e){var n={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(n.next=e.next,n.prev=e,e.next.prev=n,e.next=n):(n.prev=n,n.next=n),n}function Ct(t,e){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function St(t,e,n){var r=e[0],i=e[1],o=n[0]-r,s=n[1]-i;if(0!==o||0!==s){var a=((t[0]-r)*o+(t[1]-i)*s)/(o*o+s*s);a>1?(r=n[0],i=n[1]):a>0&&(r+=o*a,i+=s*a)}return o=t[0]-r,s=t[1]-i,o*o+s*s}function Mt(t,e,n,r,i,o,s,a){var u,c,h,l,p=n-t,f=r-e,g=s-i,d=a-o,y=t-i,_=e-o,m=p*p+f*f,v=p*g+f*d,x=g*g+d*d,E=p*y+f*_,w=g*y+d*_,b=m*x-v*v,I=b,N=b;0===b?(c=0,I=1,l=w,N=x):(l=m*w-v*E,(c=v*w-x*E)<0?(c=0,l=w,N=x):c>I&&(c=I,l=w+v,N=x)),l<0?(l=0,-E<0?c=0:-E>m?c=I:(c=-E,I=m)):l>N&&(l=N,-E+v<0?c=0:-E+v>m?c=I:(c=-E+v,I=m)),u=0===c?0:c/I;var C=(1-(h=0===l?0:l/N))*i+h*s-((1-u)*t+u*n),S=(1-h)*o+h*a-((1-u)*e+u*r);return C*C+S*S}function Lt(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.concavity||1/0,r=[];if(S(t,function(t){r.push([t[0],t[1]])}),!r.length)return null;var i=ss(r,n);return i.length>3?o([i]):null}function Pt(t,e,n){if("object"!=typeof(n=n||{}))throw new Error("options is invalid");var r=n.ignoreBoundary;if(!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var i=X(t),o=U(e),s=e.geometry?e.geometry.type:e.type,a=e.bbox;if(a&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(i,a))return!1;"Polygon"===s&&(o=[o]);for(var u=0,c=!1;u<o.length&&!c;u++)if(Ot(i,o[u][0],r)){for(var h=!1,l=1;l<o[u].length&&!h;)Ot(i,o[u][l],!r)&&(h=!0),l++;h||(c=!0)}return c}function Ot(t,e,n){var r=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var i=0,o=e.length-1;i<e.length;o=i++){var s=e[i][0],a=e[i][1],u=e[o][0],c=e[o][1];if(t[1]*(s-u)+a*(u-t[0])+c*(t[0]-s)==0&&(s-t[0])*(u-t[0])<=0&&(a-t[1])*(c-t[1])<=0)return!n;a>t[1]!=c>t[1]&&t[0]<(u-s)*(t[1]-a)/(c-a)+s&&(r=!r)}return r}function Rt(t,e){var n=[];return A(e,function(e){O(t,function(t){Pt(t,e)&&n.push(t)})}),c(n)}function Tt(t,e){if("FeatureCollection"!==t.type)throw new Error("points must be a FeatureCollection");var n=!1;return c(function(t){if(t.length<3)return[];t.sort(Dt);var e,n,r,i,o,s,a=t.length-1,u=t[a].x,c=t[0].x,h=t[a].y,l=h;for(;a--;)t[a].y<h&&(h=t[a].y),t[a].y>l&&(l=t[a].y);var p,f=c-u,g=l-h,d=f>g?f:g,y=.5*(c+u),_=.5*(l+h),m=[new At({x:y-20*d,y:_-d,__sentinel:!0},{x:y,y:_+20*d,__sentinel:!0},{x:y+20*d,y:_-d,__sentinel:!0})],v=[],x=[];a=t.length;for(;a--;){for(x.length=0,p=m.length;p--;)(f=t[a].x-m[p].x)>0&&f*f>m[p].r?(v.push(m[p]),m.splice(p,1)):(g=t[a].y-m[p].y,f*f+g*g>m[p].r||(x.push(m[p].a,m[p].b,m[p].b,m[p].c,m[p].c,m[p].a),m.splice(p,1)));for(Ft(x),p=x.length;p;)n=x[--p],e=x[--p],r=t[a],i=n.x-e.x,o=n.y-e.y,s=2*(i*(r.y-n.y)-o*(r.x-n.x)),Math.abs(s)>1e-12&&m.push(new At(e,n,r))}Array.prototype.push.apply(v,m),a=v.length;for(;a--;)(v[a].a.__sentinel||v[a].b.__sentinel||v[a].c.__sentinel)&&v.splice(a,1);return v}(t.features.map(function(t){var r={x:t.geometry.coordinates[0],y:t.geometry.coordinates[1]};return e?r.z=t.properties[e]:3===t.geometry.coordinates.length&&(n=!0,r.z=t.geometry.coordinates[2]),r})).map(function(t){var e=[t.a.x,t.a.y],r=[t.b.x,t.b.y],i=[t.c.x,t.c.y],s={};return n?(e.push(t.a.z),r.push(t.b.z),i.push(t.c.z)):s={a:t.a.z,b:t.b.z,c:t.c.z},o([[e,r,i,e]],s)}))}function At(t,e,n){this.a=t,this.b=e,this.c=n;var r,i,o=e.x-t.x,s=e.y-t.y,a=n.x-t.x,u=n.y-t.y,c=o*(t.x+e.x)+s*(t.y+e.y),h=a*(t.x+n.x)+u*(t.y+n.y),l=2*(o*(n.y-e.y)-s*(n.x-e.x));this.x=(u*c-s*h)/l,this.y=(o*h-a*c)/l,r=this.x-t.x,i=this.y-t.y,this.r=r*r+i*i}function Dt(t,e){return e.x-t.x}function Ft(t){var e,n,r,i,o,s=t.length;t:for(;s;)for(n=t[--s],e=t[--s],r=s;r;)if(o=t[--r],i=t[--r],e===i&&n===o||e===o&&n===i){t.splice(s,2),t.splice(r,2),s-=2;continue t}}function qt(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.units,i=X(t),o=X(e),s=x(o[1]-i[1]),a=x(o[0]-i[0]),u=x(i[1]),c=x(o[1]),h=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(u)*Math.cos(c);return d(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),r)}function Gt(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return Bt(t);case"FeatureCollection":return function(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"features":return;default:e[n]=t[n]}}),e.features=t.features.map(function(t){return Bt(t)}),e}(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return zt(t);default:throw new Error("unknown GeoJSON type")}}function Bt(t){var e={type:"Feature"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}}),e.properties=kt(t.properties),e.geometry=zt(t.geometry),e}function kt(t){var e={};return t?(Object.keys(t).forEach(function(n){var r=t[n];"object"==typeof r?null===r?e[n]=null:r.length?e[n]=r.map(function(t){return t}):e[n]=kt(r):e[n]=r}),e):e}function zt(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?(e.geometries=t.geometries.map(function(t){return zt(t)}),e):(e.coordinates=jt(t.coordinates),e)}function jt(t){return"object"!=typeof t[0]?t.slice():t.map(function(t){return jt(t)})}function Xt(t,e){function n(t,e){e.length&&e.pop();for(var n=c[t<0?~t:t],r=0,i=n.length;r<i;++r)e.push(u(n[r],r));t<0&&hs(e,i)}function r(t){return u(t)}function i(t){for(var e=[],r=0,i=t.length;r<i;++r)n(t[r],e);return e.length<2&&e.push(e[0]),e}function o(t){for(var e=i(t);e.length<4;)e.push(e[0]);return e}function s(t){return t.map(o)}function a(t){var e,n=t.type;switch(n){case"GeometryCollection":return{type:n,geometries:t.geometries.map(a)};case"Point":e=r(t.coordinates);break;case"MultiPoint":e=t.coordinates.map(r);break;case"LineString":e=i(t.arcs);break;case"MultiLineString":e=t.arcs.map(i);break;case"Polygon":e=s(t.arcs);break;case"MultiPolygon":e=t.arcs.map(s);break;default:return null}return{type:n,coordinates:e}}var u=cs(t.transform),c=t.arcs;return a(e)}function Ut(t,e){function n(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(n);break;case"Polygon":r(t.arcs);break;case"MultiPolygon":t.arcs.forEach(r)}}function r(t){t.forEach(function(e){e.forEach(function(e){(o[e=e<0?~e:e]||(o[e]=[])).push(t)})}),s.push(t)}function i(e){return function(t){for(var e,n=-1,r=t.length,i=t[r-1],o=0;++n<r;)e=i,i=t[n],o+=e[0]*i[1]-e[1]*i[0];return Math.abs(o)}(Xt(t,{type:"Polygon",arcs:[e]}).coordinates[0])}var o={},s=[],a=[];return e.forEach(n),s.forEach(function(t){if(!t._){var e=[],n=[t];for(t._=1,a.push(e);t=n.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){o[t<0?~t:t].forEach(function(t){t._||(t._=1,n.push(t))})})})}}),s.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:a.map(function(e){var n,r=[];if(e.forEach(function(t){t.forEach(function(t){t.forEach(function(t){o[t<0?~t:t].length<2&&r.push(t)})})}),r=ls(t,r),(n=r.length)>1)for(var s,a,u=1,c=i(r[0]);u<n;++u)(s=i(r[u]))>c&&(a=r[0],r[0]=r[u],r[u]=a,c=s);return r})}}function Yt(t,e,n){for(var r,i=e+(n---e>>1);e<i;++e,--n)r=t[e],t[e]=t[n],t[n]=r}function Vt(t){return null==t?{type:null}:("FeatureCollection"===t.type?function(t){var e={type:"GeometryCollection",geometries:t.features.map(Ht)};null!=t.bbox&&(e.bbox=t.bbox);return e}:"Feature"===t.type?Ht:Wt)(t)}function Ht(t){var e,n=Wt(t.geometry);null!=t.id&&(n.id=t.id),null!=t.bbox&&(n.bbox=t.bbox);for(e in t.properties){n.properties=t.properties;break}return n}function Wt(t){if(null==t)return{type:null};var e="GeometryCollection"===t.type?{type:"GeometryCollection",geometries:t.geometries.map(Wt)}:"Point"===t.type||"MultiPoint"===t.type?{type:t.type,coordinates:t.coordinates}:{type:t.type,arcs:t.coordinates};return null!=t.bbox&&(e.bbox=t.bbox),e}function Jt(t){var e,n=t[0],r=t[1];return r<n&&(e=n,n=r,r=e),n+31*r}function Zt(t,e){var n,r=t[0],i=t[1],o=e[0],s=e[1];return i<r&&(n=r,r=i,i=n),s<o&&(n=o,o=s,s=n),r===o&&i===s}function Kt(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.mutate;if("FeatureCollection"!==K(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==n&&void 0!==n||(t=Gt(t));var r=[],i=z(t,function(t,e){var n=function(t,e){var n,r=t.geometry.coordinates,i=e.geometry.coordinates,o=Qt(r[0]),s=Qt(r[r.length-1]),u=Qt(i[0]),c=Qt(i[i.length-1]);if(o===c)n=i.concat(r.slice(1));else if(u===s)n=r.concat(i.slice(1));else if(o===u)n=r.slice(1).reverse().concat(i);else{if(s!==c)return null;n=r.concat(i.reverse().slice(1))}return a(n)}(t,e);return n||(r.push(t),e)});return i&&r.push(i),r.length?1===r.length?r[0]:h(r.map(function(t){return t.coordinates})):null}function Qt(t){return t[0].toString()+","+t[1].toString()}function $t(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.mutate;if("FeatureCollection"!==K(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==n&&void 0!==n||(t=Gt(t));var r=function(t){var e={};F(t,function(t){e[t.geometry.type]=!0});var n=Object.keys(e);return 1===n.length?n[0]:null}(t);if(!r)throw new Error("geojson must be homogenous");switch(r){case"LineString":return Kt(t,e);case"Polygon":return function(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.mutate;if("FeatureCollection"!==K(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==n&&void 0!==n||(t=Gt(t));var r=[];F(t,function(t){r.push(t.geometry)});var i=ws({geoms:f(r).geometry});return ps(i,i.objects.geoms.geometries)}(t,e);default:throw new Error(r+" is not supported")}}function te(t,n){var r="object"==typeof n?n.mutate:n;if(!t)throw new Error("geojson is required");var i=K(t),o=[];switch(i){case"LineString":o=ee(t);break;case"MultiLineString":case"Polygon":U(t).forEach(function(t){o.push(ee(t))});break;case"MultiPolygon":U(t).forEach(function(t){var e=[];t.forEach(function(t){e.push(ee(t))}),o.push(e)});break;case"Point":return t;case"MultiPoint":var s={};U(t).forEach(function(t){var e=t.join("-");s.hasOwnProperty(e)||(o.push(t),s[e]=!0)});break;default:throw new Error(i+" geometry not supported")}return t.coordinates?!0===r?(t.coordinates=o,t):{type:i,coordinates:o}:!0===r?(t.geometry.coordinates=o,t):e({type:i,coordinates:o},t.properties,t.bbox,t.id)}function ee(t){var e=U(t);if(2===e.length&&!function(t,e){return t[0]===e[0]&&t[1]===e[1]}(e[0],e[1]))return e;var n,r,i,o=[],s=e.length-1;o.push(e[0]);for(var a=1;a<s;a++)n=e[a-1],r=e[a],function(t,e,n){var r=n[0],i=n[1],o=t[0],s=t[1],a=e[0],u=e[1],c=a-o,h=u-s;return(r-o)*h-(i-s)*c==0&&(Math.abs(c)>=Math.abs(h)?c>0?o<=r&&r<=a:a<=r&&r<=o:h>0?s<=i&&i<=u:u<=i&&i<=s)}(n,i=e[a+1],r)||o.push(r);return o.push(i),o}function ne(t,e){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r}function re(t,e,n){var r=e.x,i=e.y,o=n.x-r,s=n.y-i;if(0!==o||0!==s){var a=((t.x-r)*o+(t.y-i)*s)/(o*o+s*s);a>1?(r=n.x,i=n.y):a>0&&(r+=o*a,i+=s*a)}return o=t.x-r,s=t.y-i,o*o+s*s}function ie(t,e,n,r,i){for(var o,s=r,a=e+1;a<n;a++){var u=re(t[a],t[e],t[n]);u>s&&(o=a,s=u)}s>r&&(o-e>1&&ie(t,e,o,r,i),i.push(t[o]),n-o>1&&ie(t,o,n,r,i))}function oe(t,e,n){if(t.length<=2)return t;var r=void 0!==e?e*e:1;return t=n?t:function(t,e){for(var n,r=t[0],i=[r],o=1,s=t.length;o<s;o++)ne(n=t[o],r)>e&&(i.push(n),r=n);return r!==n&&i.push(n),i}(t,r),t=function(t,e){var n=t.length-1,r=[t[0]];return ie(t,0,n,e,r),r.push(t[n]),r}(t,r)}function se(t,e,n){return oe(t.map(function(t){return{x:t[0],y:t[1],z:t[2]}}),e,n).map(function(t){return t.z?[t.x,t.y,t.z]:[t.x,t.y]})}function ae(t,e,n){return t.map(function(t){var r=t.map(function(t){return{x:t[0],y:t[1]}});if(r.length<4)throw new Error("invalid polygon");for(var i=oe(r,e,n).map(function(t){return[t.x,t.y]});!function(t){return!(t.length<3||3===t.length&&t[2][0]===t[0][0]&&t[2][1]===t[0][1])}(i);)i=oe(r,e-=.01*e,n).map(function(t){return[t.x,t.y]});return i[i.length-1][0]===i[0][0]&&i[i.length-1][1]===i[0][1]||i.push(i[0]),i})}function ue(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.resolution||1e4,r=e.sharpness||.85;if(!t)throw new Error("line is required");if(!b(n))throw new Error("resolution must be an number");if(!b(r))throw new Error("sharpness must be an number");for(var i=[],o=new bs({points:J(t).coordinates.map(function(t){return{x:t[0],y:t[1]}}),duration:n,sharpness:r}),s=0;s<o.duration;s+=10){var u=o.pos(s);Math.floor(s/100)%2==0&&i.push([u.x,u.y])}return a(i,t.properties)}function ce(t){N(t);var e=Number(t[0]),n=Number(t[1]),r=Number(t[2]),i=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[e,n];return o([[s,[r,n],[r,i],[e,i],s]])}function he(t){return ce(j(t))}function le(t){var e=t[0],n=t[1],r=t[2],i=t[3];if(qt(t.slice(0,2),[r,n])>=qt(t.slice(0,2),[e,i])){var o=(n+i)/2;return[e,o-(r-e)/2,r,o+(r-e)/2]}var s=(e+r)/2;return[s-(i-n)/2,n,s+(i-n)/2,i]}function pe(t,e,n,i){if(i=i||{},!I(i))throw new Error("options is invalid");var o=i.units,s=i.properties,a=X(t),u=x(a[0]),c=x(a[1]),h=x(n),l=y(e,o),p=Math.asin(Math.sin(c)*Math.cos(l)+Math.cos(c)*Math.sin(l)*Math.cos(h));return r([v(u+Math.atan2(Math.sin(h)*Math.sin(l)*Math.cos(c),Math.cos(l)-Math.sin(c)*Math.sin(p))),v(p)],s)}function fe(t,e,n){var r=(n=n||{}).steps||64,i=n.properties;if(!t)throw new Error("center is required");if(!e)throw new Error("radius is required");if("object"!=typeof n)throw new Error("options must be an object");if("number"!=typeof r)throw new Error("steps must be a number");r=r||64,i=i||t.properties||{};for(var s=[],a=0;a<r;a++)s.push(pe(t,e,-360*a/r,n).geometry.coordinates);return s.push(s[0]),o([s],i)}function ge(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");if(!0===n.final)return function(t,e){var n=ge(e,t);return n=(n+180)%360}(t,e);var r=X(t),i=X(e),o=x(r[0]),s=x(i[0]),a=x(r[1]),u=x(i[1]),c=Math.sin(s-o)*Math.cos(u),h=Math.cos(a)*Math.sin(u)-Math.sin(a)*Math.cos(u)*Math.cos(s-o);return v(Math.atan2(c,h))}function de(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.properties;if(!t)throw new Error("geojson is required");var i=j(t);return r([(i[0]+i[2])/2,(i[1]+i[3])/2],n)}function ye(t,e){var n=0,i=0,o=0;return S(t,function(t){n+=t[0],i+=t[1],o++},!0),r([n/o,i/o],e)}function _e(t,e){switch(K(t)){case"Point":return t;case"Polygon":var n=[];S(t,function(t){n.push(t)});var i,o,s,a,u,c,h,l,p=ye(t,e),f=p.geometry.coordinates,g=0,d=0,y=0,_=n.map(function(t){return[t[0]-f[0],t[1]-f[1]]});for(i=0;i<n.length-1;i++)a=(o=_[i])[0],c=o[1],u=(s=_[i+1])[0],y+=l=a*(h=s[1])-u*c,g+=(a+u)*l,d+=(c+h)*l;if(0===y)return p;var m=1/(6*(.5*y));return r([f[0]+m*g,f[1]+m*d],e);default:var v=Lt(t);return v?_e(v,e):ye(t,e)}}function me(t){var e=[];return"FeatureCollection"===t.type?O(t,function(t){S(t,function(n){e.push(r(n,t.properties))})}):S(t,function(n){e.push(r(n,t.properties))}),c(e)}function ve(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,o=xe(t,0,i,n,!0),s=[];if(!o)return s;var a,u,c,h,l,p,f;if(r&&(o=function(t,e,n,r){var i,o,s,a,u,c=[];for(i=0,o=e.length;i<o;i++)s=e[i]*r,a=i<o-1?e[i+1]*r:t.length,(u=xe(t,s,a,r,!1))===u.next&&(u.steiner=!0),c.push(function(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}(u));for(c.sort(be),i=0;i<c.length;i++)!function(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s){if(s=a,a===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===s)return n.prev;var u,c=n,h=n.x,l=n.y,p=1/0;for(r=n.next;r!==c;)i>=r.x&&r.x>=h&&i!==r.x&&Ne(o<l?i:s,o,h,l,o<l?s:i,o,r.x,r.y)&&((u=Math.abs(o-r.y)/(i-r.x))<p||u===p&&r.x>n.x)&&Le(r,t)&&(n=r,p=u),r=r.next;return n}(t,e)){var n=Pe(e,t);Ee(n,n.next)}}(c[i],n),n=Ee(n,n.next);return n}(t,e,o,n)),t.length>80*n){a=c=t[0],u=h=t[1];for(var g=n;g<i;g+=n)l=t[g],p=t[g+1],l<a&&(a=l),p<u&&(u=p),l>c&&(c=l),p>h&&(h=p);f=0!==(f=Math.max(c-a,h-u))?1/f:0}return we(o,s,n,a,u,f),s}function xe(t,e,n,r,i){var o,s;if(i===Ae(t,e,n,r)>0)for(o=e;o<n;o+=r)s=Oe(o,t[o],t[o+1],s);else for(o=n-r;o>=e;o-=r)s=Oe(o,t[o],t[o+1],s);return s&&Se(s,s.next)&&(Re(s),s=s.next),s}function Ee(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!Se(r,r.next)&&0!==Ce(r.prev,r,r.next))r=r.next;else{if(Re(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function we(t,e,n,r,i,o,s){if(t){!s&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=Ie(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,s,a,u,c=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,r=n,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(u=c;a>0||u>0&&r;)0!==a&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(s>1)}(i)}(t,r,i,o);for(var a,u,c=t;t.prev!==t.next;)if(a=t.prev,u=t.next,o?function(t,e,n,r){var i=t.prev,o=t,s=t.next;if(Ce(i,o,s)>=0)return!1;var a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,u=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,c=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,h=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,l=Ie(a,u,e,n,r),p=Ie(c,h,e,n,r),f=t.nextZ;for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&Ne(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Ce(f.prev,f,f.next)>=0)return!1;f=f.nextZ}f=t.prevZ;for(;f&&f.z>=l;){if(f!==t.prev&&f!==t.next&&Ne(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Ce(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}(t,r,i,o):function(t){var e=t.prev,n=t,r=t.next;if(Ce(e,n,r)>=0)return!1;var i=t.next.next;for(;i!==t.prev;){if(Ne(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Ce(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}(t))e.push(a.i/n),e.push(t.i/n),e.push(u.i/n),Re(t),t=u.next,c=u.next;else if((t=u)===c){s?1===s?we(t=function(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!Se(i,o)&&Me(i,r,r.next,o)&&Le(i,o)&&Le(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),Re(r),Re(r.next),r=t=o),r=r.next}while(r!==t);return r}(t,e,n),e,n,r,i,o,2):2===s&&function(t,e,n,r,i,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Me(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&Le(t,e)&&Le(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)}(s,a)){var u=Pe(s,a);return s=Ee(s,s.next),u=Ee(u,u.next),we(s,e,n,r,i,o),void we(u,e,n,r,i,o)}a=a.next}s=s.next}while(s!==t)}(t,e,n,r,i,o):we(Ee(t),e,n,r,i,o,1);break}}}function be(t,e){return t.x-e.x}function Ie(t,e,n,r,i){return t=32767*(t-n)*i,e=32767*(e-r)*i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function Ne(t,e,n,r,i,o,s,a){return(i-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(r-a)-(n-s)*(e-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function Ce(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Se(t,e){return t.x===e.x&&t.y===e.y}function Me(t,e,n,r){return!!(Se(t,e)&&Se(n,r)||Se(t,r)&&Se(n,e))||Ce(t,e,n)>0!=Ce(t,e,r)>0&&Ce(n,r,t)>0!=Ce(n,r,e)>0}function Le(t,e){return Ce(t.prev,t,t.next)<0?Ce(t,e,t.next)>=0&&Ce(t,t.prev,e)>=0:Ce(t,e,t.prev)<0||Ce(t,t.next,e)<0}function Pe(t,e){var n=new Te(t.i,t.x,t.y),r=new Te(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Oe(t,e,n,r){var i=new Te(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Re(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Te(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ae(t,e,n,r){for(var i=0,o=e,s=n-r;o<n;o+=r)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}function De(t){var e=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[i][o][s]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}(t),n=Is(e.vertices,e.holes,2),r=[],i=[];n.forEach(function(t,r){var o=n[r];i.push([e.vertices[2*o],e.vertices[2*o+1]])});for(var s=0;s<i.length;s+=3){var a=i.slice(s,s+3);a.push(i[s]),r.push(o([a]))}return r}function Fe(t,e){if(!t)throw new Error("targetPoint is required");if(!e)throw new Error("points is required");var n,r=1/0;return O(e,function(e,i){var o=qt(t,e);o<r&&((n=Gt(e)).properties.featureIndex=i,n.properties.distanceToPoint=o,r=o)}),n}function qe(t,e,n,r,i){Ge(t,e,n||0,r||t.length-1,i||function(t,e){return t<e?-1:t>e?1:0})}function Ge(t,e,n,r,i){for(;r>n;){if(r-n>600){var o=r-n+1,s=e-n+1,a=Math.log(o),u=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*u*(o-u)/o)*(s-o/2<0?-1:1);Ge(t,e,Math.max(n,Math.floor(e-s*u/o+c)),Math.min(r,Math.floor(e+(o-s)*u/o+c)),i)}var h=t[e],l=n,p=r;for(Be(t,n,e),i(t[r],h)>0&&Be(t,n,r);l<p;){for(Be(t,l,p),l++,p--;i(t[l],h)<0;)l++;for(;i(t[p],h)>0;)p--}0===i(t[n],h)?Be(t,n,p):Be(t,++p,r),p<=e&&(n=p+1),e<=p&&(r=p-1)}}function Be(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function ke(t,e){if(!(this instanceof ke))return new ke(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function ze(t,e){je(t,0,t.children.length,e,t)}function je(t,e,n,r,i){i||(i=Ze(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,s=e;s<n;s++)o=t.children[s],Xe(i,t.leaf?r(o):o);return i}function Xe(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Ue(t,e){return t.minX-e.minX}function Ye(t,e){return t.minY-e.minY}function Ve(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function He(t){return t.maxX-t.minX+(t.maxY-t.minY)}function We(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Je(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Ze(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ke(t,e,n,r,i){for(var o,s=[e,n];s.length;)(n=s.pop())-(e=s.pop())<=r||(qe(t,o=e+Math.ceil((n-e)/r/2)*r,e,n,i),s.push(e,o,o,n))}function Qe(t){var e=ke(t);return e.insert=function(t){if(Array.isArray(t)){var e=t;(t=$e(e)).bbox=e}else t.bbox=t.bbox?t.bbox:tn(t);return ke.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach(function(t){var n=$e(t);n.bbox=t,e.push(n)}):O(t,function(t){t.bbox=t.bbox?t.bbox:tn(t),e.push(t)}),ke.prototype.load.call(this,e)},e.remove=function(t){if(Array.isArray(t)){var e=t;(t=$e(e)).bbox=e}return ke.prototype.remove.call(this,t)},e.clear=function(){return ke.prototype.clear.call(this)},e.search=function(t){return{type:"FeatureCollection",features:ke.prototype.search.call(this,this.toBBox(t))}},e.collides=function(t){return ke.prototype.collides.call(this,this.toBBox(t))},e.all=function(){return{type:"FeatureCollection",features:ke.prototype.all.call(this)}},e.toJSON=function(){return ke.prototype.toJSON.call(this)},e.fromJSON=function(t){return ke.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;return e=t.bbox?t.bbox:Array.isArray(t)&&4===t.length?t:tn(t),{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}function $e(t){var e=[t[0],t[1]],n=[t[0],t[3]],r=[t[2],t[3]];return{type:"Feature",bbox:t,properties:{},geometry:{type:"Polygon",coordinates:[[e,[t[2],t[1]],r,n,e]]}}}function tn(t){var e=[1/0,1/0,-1/0,-1/0];return S(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}function en(t){if(!t)throw new Error("geojson is required");var e=[];return F(t,function(t){!function(t,e){var n=[],r=t.geometry;switch(r.type){case"Polygon":n=U(r);break;case"LineString":n=[U(r)]}n.forEach(function(n){var r=function(t,e){var n=[];return t.reduce(function(t,r){var i=a([t,r],e);return i.bbox=function(t,e){var n=t[0],r=t[1],i=e[0],o=e[1];return[n<i?n:i,r<o?r:o,n>i?n:i,r>o?r:o]}(t,r),n.push(i),r}),n}(n,t.properties);r.forEach(function(t){t.id=e.length,e.push(t)})})}(t,e)}),c(e)}function nn(t,n){var r={},i=[];if("LineString"===t.type&&(t=e(t)),"LineString"===n.type&&(n=e(n)),"Feature"===t.type&&"Feature"===n.type&&"LineString"===t.geometry.type&&"LineString"===n.geometry.type&&2===t.geometry.coordinates.length&&2===n.geometry.coordinates.length){var o=rn(t,n);return o&&i.push(o),c(i)}var s=Qe();return s.load(en(n)),O(en(t),function(t){O(s.search(t),function(e){var n=rn(t,e);if(n){var o=U(n).join(",");r[o]||(r[o]=!0,i.push(n))}})}),c(i)}function rn(t,e){var n=U(t),i=U(e);if(2!==n.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==i.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=n[0][0],s=n[0][1],a=n[1][0],u=n[1][1],c=i[0][0],h=i[0][1],l=i[1][0],p=i[1][1],f=(p-h)*(a-o)-(l-c)*(u-s),g=(l-c)*(s-h)-(p-h)*(o-c),d=(a-o)*(s-h)-(u-s)*(o-c);if(0===f)return null;var y=g/f,_=d/f;if(y>=0&&y<=1&&_>=0&&_<=1){return r([o+y*(a-o),s+y*(u-s)])}return null}function on(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var i=t.geometry?t.geometry.type:t.type;if("LineString"!==i&&"MultiLineString"!==i)throw new Error("lines must be LineString or MultiLineString");var o=r([1/0,1/0],{dist:1/0}),s=0;return F(t,function(t){for(var i=U(t),u=0;u<i.length-1;u++){var c=r(i[u]);c.properties.dist=qt(e,c,n);var h=r(i[u+1]);h.properties.dist=qt(e,h,n);var l=qt(c,h,n),p=Math.max(c.properties.dist,h.properties.dist),f=ge(c,h),g=pe(e,p,f+90,n),d=pe(e,p,f-90,n),y=nn(a([g.geometry.coordinates,d.geometry.coordinates]),a([c.geometry.coordinates,h.geometry.coordinates])),_=null;y.features.length>0&&((_=y.features[0]).properties.dist=qt(e,_,n),_.properties.location=s+qt(c,_,n)),c.properties.dist<o.properties.dist&&((o=c).properties.index=u,o.properties.location=s),h.properties.dist<o.properties.dist&&((o=h).properties.index=u+1,o.properties.location=s+l),_&&_.properties.dist<o.properties.dist&&((o=_).properties.index=u),s+=l}}),o}function sn(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.final;if(!t)throw new Error("start point is required");if(!e)throw new Error("end point is required");var i;return(i=r?an(X(e),X(t)):an(X(t),X(e)))>180?-(360-i):i}function an(t,e){var n=x(t[1]),r=x(e[1]),i=x(e[0]-t[0]);i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI);var o=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(n/2+Math.PI/4));return(v(Math.atan2(i,o))+360)%360}function un(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.units;if(!t)throw new Error("from point is required");if(!e)throw new Error("to point is required");var i=X(t),o=X(e);o[0]+=o[0]-i[0]>180?-360:i[0]-o[0]>180?360:0;return E(function(t,e,n){var r=n=void 0===n?Fo:Number(n),i=t[1]*Math.PI/180,o=e[1]*Math.PI/180,s=o-i,a=Math.abs(e[0]-t[0])*Math.PI/180;a>Math.PI&&(a-=2*Math.PI);var u=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),c=Math.abs(u)>1e-11?s/u:Math.cos(i);return Math.sqrt(s*s+c*c*a*a)*r}(i,o),"meters",r)}function cn(t,e){return ln(t,"mercator",e)}function hn(t,e){return ln(t,"wgs84",e)}function ln(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.mutate;if(!t)throw new Error("geojson is required");return Array.isArray(t)&&b(t[0])?t="mercator"===e?pn(t):fn(t):(!0!==r&&(t=Gt(t)),S(t,function(t){var n="mercator"===e?pn(t):fn(t);t[0]=n[0],t[1]=n[1]})),t}function pn(t){var e=Math.PI/180,n=20037508.342789244,r=[6378137*(Math.abs(t[0])<=180?t[0]:t[0]-360*function(t){return t<0?-1:t>0?1:0}(t[0]))*e,6378137*Math.log(Math.tan(.25*Math.PI+.5*t[1]*e))];return r[0]>n&&(r[0]=n),r[0]<-n&&(r[0]=-n),r[1]>n&&(r[1]=n),r[1]<-n&&(r[1]=-n),r}function fn(t){var e=180/Math.PI;return[t[0]*e/6378137,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/6378137)))*e]}function gn(t,n,i){if(i=i||{},!I(i))throw new Error("options is invalid");if(!t)throw new Error("pt is required");if(Array.isArray(t)?t=r(t):"Point"===t.type?t=e(t):H(t,"Point","point"),!n)throw new Error("line is required");Array.isArray(n)?n=a(n):"LineString"===n.type?n=e(n):H(n,"LineString","line");var o=1/0,s=t.geometry.coordinates;return G(n,function(t){var e=t.geometry.coordinates[0],n=t.geometry.coordinates[1],a=function(t,e,n,i){var o=i.mercator,s=!0!==o?qt(e,t,i):dn(e,t,i),a=m(!0!==o?ge(e,t):sn(e,t)),u=m(!0!==o?ge(e,n):sn(e,n)),c=Math.abs(a-u);if(c>90)return s;var h=(u+180)%360,l=m(!0!==o?ge(n,t):sn(n,t)),p=Math.abs(l-h);p>180&&(p=Math.abs(p-360));return p>90?!0!==o?qt(t,n,i):dn(t,n,i):!0!==o?s*Math.sin(x(c)):function(t,e,n,i){var o=0;(Math.abs(t[0])>=180||Math.abs(e[0])>=180||Math.abs(n[0])>=180)&&(o=t[0]>0||e[0]>0||n[0]>0?-180:180);var s=r(n),a=cn([t[0]+o,t[1]]),u=cn([e[0]+o,e[1]]),c=cn([n[0]+o,n[1]]),h=hn(function(t,e,n){var r=t[0],i=t[1],o=e[0],s=e[1],a=n[0],u=n[1],c=o-r,h=s-i,l=((a-r)*c+(u-i)*h)/(c*c+h*h);return[r+l*c,i+l*h]}(a,u,c));return 0!==o&&(h[0]-=o),un(s,h,i)}(e,n,t,i)}(s,e,n,i);o>a&&(o=a)}),o}function dn(t,e,n){var r=n.units,i=0;Math.abs(t[0])>=180&&(i=t[0]>0?-180:180),Math.abs(e[0])>=180&&(i=e[0]>0?-180:180);var o=cn([t[0]+i,t[1]]),s=cn([e[0]+i,e[1]]),a=function(t){return t*t},u=a(o[0]-s[0])+a(o[1]-s[1]);return E(Math.sqrt(u),"meters",r)}function yn(t){for(var n=function(t){if("FeatureCollection"!==t.type)return"Feature"!==t.type?c([e(t)]):c([t]);return t}(t),i=de(n),o=!1,s=0;!o&&s<n.features.length;){var a,u=n.features[s].geometry,h=!1;if("Point"===u.type)i.geometry.coordinates[0]===u.coordinates[0]&&i.geometry.coordinates[1]===u.coordinates[1]&&(o=!0);else if("MultiPoint"===u.type){var l=!1;for(a=0;!l&&a<u.coordinates.length;)i.geometry.coordinates[0]===u.coordinates[a][0]&&i.geometry.coordinates[1]===u.coordinates[a][1]&&(o=!0,l=!0),a++}else if("LineString"===u.type)for(a=0;!h&&a<u.coordinates.length-1;)_n(i.geometry.coordinates[0],i.geometry.coordinates[1],u.coordinates[a][0],u.coordinates[a][1],u.coordinates[a+1][0],u.coordinates[a+1][1])&&(h=!0,o=!0),a++;else if("MultiLineString"===u.type)for(var p=0;p<u.coordinates.length;){h=!1,a=0;for(var f=u.coordinates[p];!h&&a<f.length-1;)_n(i.geometry.coordinates[0],i.geometry.coordinates[1],f[a][0],f[a][1],f[a+1][0],f[a+1][1])&&(h=!0,o=!0),a++;p++}else"Polygon"!==u.type&&"MultiPolygon"!==u.type||Pt(i,u)&&(o=!0);s++}if(o)return i;var g=c([]);for(s=0;s<n.features.length;s++)g.features=g.features.concat(me(n.features[s]).features);return r(Fe(i,g).geometry.coordinates)}function _n(t,e,n,r,i,o){return Math.sqrt((i-n)*(i-n)+(o-r)*(o-r))===Math.sqrt((t-n)*(t-n)+(e-r)*(e-r))+Math.sqrt((i-t)*(i-t)+(o-e)*(o-e))}function mn(t){return D(t,function(t,e){return t+vn(e)},0)}function vn(t){var e,n=0;switch(t.type){case"Polygon":return xn(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)n+=xn(t.coordinates[e]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(e=0;e<t.geometries.length;e++)n+=vn(t.geometries[e]);return n}}function xn(t){var e=0;if(t&&t.length>0){e+=Math.abs(En(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(En(t[n]))}return e}function En(t){var e,n,r,i,o,s,a=0,u=t.length;if(u>2){for(s=0;s<u;s++)s===u-2?(r=u-2,i=u-1,o=0):s===u-1?(r=u-1,i=0,o=1):(r=s,i=s+1,o=s+2),e=t[r],n=t[i],a+=(wn(t[o][0])-wn(e[0]))*Math.sin(wn(n[1]));a=a*Ss*Ss/2}return a}function wn(t){return t*Math.PI/180}function bn(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");if(!t)throw new Error("geojson is required");return B(t,function(t,n){var r=n.geometry.coordinates;return t+qt(r[0],r[1],e)},0)}function In(t,e,n,r){if(r=r||{},!I(r))throw new Error("options is invalid");var i,o=[];if("Feature"===t.type)i=t.geometry.coordinates;else{if("LineString"!==t.type)throw new Error("input must be a LineString Feature or Geometry");i=t.coordinates}for(var s,u,c,h=0,l=0;l<i.length&&!(e>=h&&l===i.length-1);l++){if(h>e&&0===o.length){if(!(s=e-h))return o.push(i[l]),a(o);u=ge(i[l],i[l-1])-180,c=pe(i[l],s,u,r),o.push(c.geometry.coordinates)}if(h>=n)return(s=n-h)?(u=ge(i[l],i[l-1])-180,c=pe(i[l],s,u,r),o.push(c.geometry.coordinates),a(o)):(o.push(i[l]),a(o));if(h>=e&&o.push(i[l]),l===i.length-1)return a(o);h+=qt(i[l],i[l+1],r)}return a(i[i.length-1])}function Nn(t,e,n){var r=(n=n||{}).ignoreEndVertices;if(!I(n))throw new Error("invalid options");if(!t)throw new Error("pt is required");if(!e)throw new Error("line is required");for(var i=X(t),o=U(e),s=0;s<o.length-1;s++){var a=!1;if(r&&(0===s&&(a="start"),s===o.length-2&&(a="end"),0===s&&s+1===o.length-1&&(a="both")),function(t,e,n,r){var i=n[0],o=n[1],s=t[0],a=t[1],u=e[0],c=e[1],h=n[0]-s,l=n[1]-a,p=u-s,f=c-a;if(h*f-l*p!=0)return!1;{if(!r)return Math.abs(p)>=Math.abs(f)?p>0?s<=i&&i<=u:u<=i&&i<=s:f>0?a<=o&&o<=c:c<=o&&o<=a;if("start"===r)return Math.abs(p)>=Math.abs(f)?p>0?s<i&&i<=u:u<=i&&i<s:f>0?a<o&&o<=c:c<=o&&o<a;if("end"===r)return Math.abs(p)>=Math.abs(f)?p>0?s<=i&&i<u:u<i&&i<=s:f>0?a<=o&&o<c:c<o&&o<=a;if("both"===r)return Math.abs(p)>=Math.abs(f)?p>0?s<i&&i<u:u<i&&i<s:f>0?a<o&&o<c:c<o&&o<a}}(o[s],o[s+1],i,a))return!0}return!1}function Cn(t,e){var n=K(t),r=K(e),i=J(t),o=J(e);switch(n){case"Point":switch(r){case"MultiPoint":return function(t,e){var n,r=!1;for(n=0;n<e.coordinates.length;n++)if(Mn(e.coordinates[n],t.coordinates)){r=!0;break}return r}(i,o);case"LineString":return Nn(i,o,{ignoreEndVertices:!0});case"Polygon":return Pt(i,o,{ignoreBoundary:!0});default:throw new Error("feature2 "+r+" geometry not supported")}case"MultiPoint":switch(r){case"MultiPoint":return function(t,e){for(var n=0;n<t.coordinates.length;n++){for(var r=!1,i=0;i<e.coordinates.length;i++)Mn(t.coordinates[n],e.coordinates[i])&&(r=!0);if(!r)return!1}return!0}(i,o);case"LineString":return function(t,e){for(var n=!1,r=0;r<t.coordinates.length;r++){if(!Nn(t.coordinates[r],e))return!1;n||(n=Nn(t.coordinates[r],e,{ignoreEndVertices:!0}))}return n}(i,o);case"Polygon":return function(t,e){for(var n=!0,r=0;r<t.coordinates.length;r++){var i=Pt(t.coordinates[1],e);if(!i){n=!1;break}i=Pt(t.coordinates[1],e,{ignoreBoundary:!0})}return n&&i}(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"LineString":switch(r){case"LineString":return function(t,e){for(var n=0;n<t.coordinates.length;n++)if(!Nn(t.coordinates[n],e))return!1;return!0}(i,o);case"Polygon":return function(t,e){var n=j(e),r=j(t);if(!Sn(n,r))return!1;for(var i=!1,o=0;o<t.coordinates.length-1;o++){if(!Pt(t.coordinates[o],e))return!1;if(i||(i=Pt(t.coordinates[o],e,{ignoreBoundary:!0})),!i){var s=function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}(t.coordinates[o],t.coordinates[o+1]);i=Pt(s,e,{ignoreBoundary:!0})}}return i}(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"Polygon":switch(r){case"Polygon":return function(t,e){var n=j(t);if(!Sn(j(e),n))return!1;for(var r=0;r<t.coordinates[0].length;r++)if(!Pt(t.coordinates[0][r],e))return!1;return!0}(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}}function Sn(t,e){return!(t[0]>e[0])&&(!(t[2]<e[2])&&(!(t[1]>e[1])&&!(t[3]<e[3])))}function Mn(t,e){return t[0]===e[0]&&t[1]===e[1]}function Ln(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var i=n.mask,o=n.properties,s=[];if(null===e||void 0===e)throw new Error("cellSide is required");if(!b(e))throw new Error("cellSide is invalid");if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be array");if(4!==t.length)throw new Error("bbox must contain 4 numbers");if(i&&-1===["Polygon","MultiPolygon"].indexOf(K(i)))throw new Error("options.mask must be a (Multi)Polygon");for(var a=t[0],u=t[1],h=t[2],l=t[3],p=e/qt([a,u],[h,u],n)*(h-a),f=e/qt([a,u],[a,l],n)*(l-u),g=h-a,d=l-u,y=Math.floor(g/p),_=(d-Math.floor(d/f)*f)/2,m=a+(g-y*p)/2;m<=h;){for(var v=u+_;v<=l;){var x=r([m,v],o);i?Cn(x,i)&&s.push(x):s.push(x),v+=f}m+=p}return c(s)}function Pn(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.precision,r=e.coordinates,i=e.mutate;if(n=void 0===n||null===n||isNaN(n)?6:n,r=void 0===r||null===r||isNaN(r)?3:r,!t)throw new Error("<geojson> is required");if("number"!=typeof n)throw new Error("<precision> must be a number");if("number"!=typeof r)throw new Error("<coordinates> must be a number");!1!==i&&void 0!==i||(t=JSON.parse(JSON.stringify(t)));var o=Math.pow(10,n);return S(t,function(t){!function(t,e,n){t.length>n&&t.splice(n,t.length);for(var r=0;r<t.length;r++)t[r]=Math.round(t[r]*e)/e}(t,o,r)}),t}function On(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!On(t[n],e[n]))return!1}else if(t[n]!==e[n])return!1;return!0}function Rn(t,e){if(void 0===e&&(e=!0),3!=t.length)throw new Error("This function requires an array of three points [x,y]");return(t[1][0]-t[0][0])*(t[2][1]-t[0][1])-(t[1][1]-t[0][1])*(t[2][0]-t[0][0])>=0==e}function Tn(t,e){if(!t||!e)return!1;if(t.length!=e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!Tn(t[n],e[n]))return!1}else if(t[n]!=e[n])return!1;return!0}function An(t,e){var n=[],r=Qe();return F(e,function(e){if(n.forEach(function(t,e){t.id=e}),n.length){var i=r.search(e);if(i.features.length){var o=Fn(e,i);n=n.filter(function(t){return t.id!==o.id}),r.remove(o),O(Dn(o,e),function(t){n.push(t),r.insert(t)})}}else(n=Dn(t,e).features).forEach(function(t){t.bbox||(t.bbox=le(j(t)))}),r.load(c(n))}),c(n)}function Dn(t,e){var n=[],r=U(t)[0],i=U(t)[t.geometry.coordinates.length-1];if(qn(r,X(e))||qn(i,X(e)))return c([t]);var o=Qe(),s=en(t);o.load(s);var u=o.search(e);if(!u.features.length)return c([t]);var h=Fn(e,u),l=R(s,function(t,r,i){var o=U(r)[1],s=X(e);return i===h.id?(t.push(s),n.push(a(t)),qn(s,o)?[s]:[s,o]):(t.push(o),t)},[r]);return l.length>1&&n.push(a(l)),c(n)}function Fn(t,e){if(!e.features.length)throw new Error("lines must contain features");if(1===e.features.length)return e.features[0];var n,r=1/0;return O(e,function(e){var i=on(e,t).properties.dist;i<r&&(n=e,r=i)}),n}function qn(t,e){return t[0]===e[0]&&t[1]===e[1]}function Gn(t,e,n,r,i){if(i=i||{},!I(i))throw new Error("options is invalid");var o=i.steps,s=i.units;if(!t)throw new Error("center is required");if(!e)throw new Error("radius is required");if(void 0===n||null===n)throw new Error("bearing1 is required");if(void 0===r||null===r)throw new Error("bearing2 is required");if("object"!=typeof i)throw new Error("options must be an object");o=o||64;var u=Bn(n),c=Bn(r),h=t.properties;if(u===c)return a(fe(t,e,i).geometry.coordinates[0],h);for(var l=u,p=u<c?c:c+360,f=l,g=[],d=0;f<p;)g.push(pe(t,e,f,s).geometry.coordinates),f=l+360*++d/o;return f>p&&g.push(pe(t,e,p,s).geometry.coordinates),a(g,h)}function Bn(t){var e=t%360;return e<0&&(e+=360),e}function kn(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.properties,r=K(t),i=U(t);if(n=n||t.properties||{},!i.length)throw new Error("polygon must contain coordinates");switch(r){case"Polygon":return zn(i,n);case"MultiPolygon":var o=[];return i.forEach(function(t){o.push(zn(t,n))}),c(o);default:throw new Error("geom "+r+" not supported")}}function zn(t,e){return t.length>1?h(t,e):a(t[0],e)}function jn(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.properties,r=e.autoComplete,i=e.orderCoords;if(!t)throw new Error("lines is required");r=void 0===r||r,i=void 0===i||i;switch(K(t)){case"FeatureCollection":case"GeometryCollection":var o=[];return(t.features?t.features:t.geometries).forEach(function(t){o.push(U(Xn(t,{},r,i)))}),p(o,n)}return Xn(t,n,r,i)}function Xn(t,e,n,r){e=e||t.properties||{};var i=U(t),s=K(t);if(!i.length)throw new Error("line must contain coordinates");switch(s){case"LineString":return n&&(i=Un(i)),o([i],e);case"MultiLineString":var u=[],c=0;return i.forEach(function(t){if(n&&(t=Un(t)),r){var e=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.abs(e-r)*Math.abs(n-i)}(j(a(t)));e>c?(u.unshift(t),c=e):u.push(t)}else u.push(t)}),o(u,e);default:throw new Error("geometry type "+s+" is not supported")}}function Un(t){var e=t[0],n=e[0],r=e[1],i=t[t.length-1],o=i[0],s=i[1];return n===o&&r===s||t.push(e),t}function Yn(t,e,n){var r,i,o,s,a,u=t.length,c=Hn(t[0],e),h=[];for(n||(n=[]),r=1;r<u;r++){for(i=t[r-1],s=a=Hn(o=t[r],e);;){if(!(c|s)){h.push(i),s!==a?(h.push(o),r<u-1&&(n.push(h),h=[])):r===u-1&&h.push(o);break}if(c&s)break;c?c=Hn(i=Vn(i,o,c,e),e):s=Hn(o=Vn(i,o,s,e),e)}c=a}return h.length&&n.push(h),n}function Vn(t,e,n,r){return 8&n?[t[0]+(e[0]-t[0])*(r[3]-t[1])/(e[1]-t[1]),r[3]]:4&n?[t[0]+(e[0]-t[0])*(r[1]-t[1])/(e[1]-t[1]),r[1]]:2&n?[r[2],t[1]+(e[1]-t[1])*(r[2]-t[0])/(e[0]-t[0])]:1&n?[r[0],t[1]+(e[1]-t[1])*(r[0]-t[0])/(e[0]-t[0])]:null}function Hn(t,e){var n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function Wn(t,e){for(var n=[],r=0;r<t.length;r++){var i=Gs.polygon(t[r],e);i.length>0&&(i[0][0]===i[i.length-1][0]&&i[0][1]===i[i.length-1][1]||i.push(i[0]),i.length>=4&&n.push(i))}return n}function Jn(t){return"[object Arguments]"===Object.prototype.toString.call(t)}function Zn(t,e,n){return n||(n={}),t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():!t||!e||"object"!=typeof t&&"object"!=typeof e?(n.strict,t===e):function(t,e,n){var r,i;if(Kn(t)||Kn(e))return!1;if(t.prototype!==e.prototype)return!1;if(Jn(t))return!!Jn(e)&&(t=Bs.call(t),e=Bs.call(e),Zn(t,e,n));if(Qn(t)){if(!Qn(e))return!1;if(t.length!==e.length)return!1;for(r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}try{var o=Object.keys(t),s=Object.keys(e)}catch(t){return!1}if(o.length!==s.length)return!1;for(o.sort(),s.sort(),r=o.length-1;r>=0;r--)if(o[r]!==s[r])return!1;for(r=o.length-1;r>=0;r--)if(i=o[r],!Zn(t[i],e[i],n))return!1;return typeof t==typeof e}(t,e,n))}function Kn(t){return null===t||void 0===t}function Qn(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length)&&("function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0]))}function $n(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.tolerance||0,i=[],o=Qe();o.load(en(t));var s;return G(e,function(t){var e=!1;O(o.search(t),function(n){if(!1===e){var i=U(t).sort(),o=U(n).sort();Zn(i,o)?(e=!0,s=s?tr(s,t):t):(0===r?Nn(i[0],n)&&Nn(i[1],n):on(n,i[0]).properties.dist<=r&&on(n,i[1]).properties.dist<=r)?(e=!0,s=s?tr(s,t):t):(0===r?Nn(o[0],t)&&Nn(o[1],t):on(t,o[0]).properties.dist<=r&&on(t,o[1]).properties.dist<=r)&&(s=s?tr(s,n):n)}}),!1===e&&s&&(i.push(s),s=void 0)}),s&&i.push(s),c(i)}function tr(t,e){var n=U(e),r=U(t),i=r[0],o=r[r.length-1],s=t.geometry.coordinates;return Zn(n[0],i)?s.unshift(n[1]):Zn(n[0],o)?s.push(n[1]):Zn(n[1],i)?s.unshift(n[0]):Zn(n[1],o)&&s.push(n[0]),t}function er(t){var e=t%360;return e<0&&(e+=360),e}function nr(t,e,n,i){if(i=i||{},!I(i))throw new Error("options is invalid");var o=i.units,s=i.properties;if(!t)throw new Error("origin is required");if(void 0===e||null===e)throw new Error("distance is required");if(void 0===n||null===n)throw new Error("bearing is required");if(!(e>=0))throw new Error("distance must be greater than 0");var a=E(e,o,"meters"),u=X(t),c=function(t,e,n,r){r=void 0===r?Fo:Number(r);var i=e/r,o=t[0]*Math.PI/180,s=x(t[1]),a=x(n),u=i*Math.cos(a),c=s+u;Math.abs(c)>Math.PI/2&&(c=c>0?Math.PI-c:-Math.PI-c);var h=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),l=Math.abs(h)>1e-11?u/h:Math.cos(s),p=i*Math.sin(a)/l;return[(180*(o+p)/Math.PI+540)%360-180,180*c/Math.PI]}(u,a,n);return c[0]+=c[0]-u[0]>180?-360:u[0]-c[0]>180?360:0,r(c,s)}function rr(t,e,n,r,i,o){for(var s=0;s<t.length;s++){var a=t[s],u=t[s+1];s===t.length-1&&(u=t[0]),r=ir(a,u,e),n<=0&&r>0?function(t,e,n){return ir(t,e,n)<0}(e,a,i)||(i=a):n>0&&r<=0&&(function(t,e,n){return ir(t,e,n)>0}(e,a,o)||(o=a)),n=r}return[i,o]}function ir(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1])}function or(t){if(!t)throw new Error("line is required");var e=t.geometry?t.geometry.type:t.type;if(!Array.isArray(t)&&"LineString"!==e)throw new Error("geometry must be a LineString");for(var n,r,i=U(t),o=0,s=1;s<i.length;)n=r||i[0],o+=((r=i[s])[0]-n[0])*(r[1]+n[1]),s++;return o>0}function sr(t,e){switch("Feature"===t.type?t.geometry.type:t.type){case"GeometryCollection":return A(t,function(t){sr(t,e)}),t;case"LineString":return ar(U(t),e),t;case"Polygon":return ur(U(t),e),t;case"MultiLineString":return U(t).forEach(function(t){ar(t,e)}),t;case"MultiPolygon":return U(t).forEach(function(t){ur(t,e)}),t;case"Point":case"MultiPoint":return t}}function ar(t,e){or(t)===e&&t.reverse()}function ur(t,e){or(t[0])!==e&&t[0].reverse();for(var n=1;n<t.length;n++)or(t[n])===e&&t[n].reverse()}function cr(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.zProperty||"elevation",r=e.flip,i=e.flags;W(t,"Point","input must contain Points");for(var o=function(t,e){var n={};O(t,function(t){var e=U(t)[1];n[e]||(n[e]=[]),n[e].push(t)});return Object.keys(n).map(function(t){var e=n[t],r=e.sort(function(t,e){return U(t)[0]-U(e)[0]});return r}).sort(function(t,n){return e?U(t[0])[1]-U(n[0])[1]:U(n[0])[1]-U(t[0])[1]})}(t,r),s=[],a=0;a<o.length;a++){for(var u=o[a],c=[],h=0;h<u.length;h++){var l=u[h];l.properties[n]?c.push(l.properties[n]):c.push(0),!0===i&&(l.properties.matrixPosition=[a,h])}s.push(c)}return s}function hr(t,e,n,r){r=r||{};for(var i=Object.keys(ks),o=0;o<i.length;o++){var s=i[o],a=r[s];a=void 0!==a&&null!==a?a:ks[s],zs[s]=a}zs.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+e+":"+(e+n)+"]");var u,c=function(t,e,n){for(var r=t.length-1,i=t[0].length-1,o={rows:r,cols:i,cells:[]},s=e+Math.abs(n),a=0;a<r;++a){o.cells[a]=[];for(var u=0;u<i;++u){var c=0,h=t[a+1][u],l=t[a+1][u+1],p=t[a][u+1],f=t[a][u];if(!(isNaN(h)||isNaN(l)||isNaN(p)||isNaN(f))){c|=h<e?0:h>s?128:64,c|=l<e?0:l>s?32:16,c|=p<e?0:p>s?8:4;var g=+(c|=f<e?0:f>s?2:1),d=0;if(17===c||18===c||33===c||34===c||38===c||68===c||72===c||98===c||102===c||132===c||136===c||137===c||152===c||153===c){var y=(h+l+p+f)/4;d=y>s?2:y<e?0:1,34===c?1===d?c=35:0===d&&(c=136):136===c?1===d?(c=35,d=4):0===d&&(c=34):17===c?1===d?(c=155,d=4):0===d&&(c=153):68===c?1===d?(c=103,d=4):0===d&&(c=102):153===c?1===d&&(c=155):102===c?1===d&&(c=103):152===c?d<2&&(c=156,d=1):137===c?d<2&&(c=139,d=1):98===c?d<2&&(c=99,d=1):38===c?d<2&&(c=39,d=1):18===c?d>0?(c=156,d=4):c=152:33===c?d>0?(c=139,d=4):c=137:72===c?d>0?(c=99,d=4):c=98:132===c&&(d>0?(c=39,d=4):c=38)}if(0!=c&&170!=c){var _,m,v,x,E,w,b,I;_=m=v=x=E=w=b=I=.5;var N=[];1===c?(v=1-lr(e,p,f),I=1-lr(e,h,f),N.push(Sa[c])):169===c?(v=lr(s,f,p),I=lr(s,f,h),N.push(Sa[c])):4===c?(w=1-lr(e,l,p),x=lr(e,f,p),N.push(Na[c])):166===c?(w=lr(s,p,l),x=1-lr(s,p,f),N.push(Na[c])):16===c?(E=lr(e,p,l),m=lr(e,h,l),N.push(Ia[c])):154===c?(E=1-lr(s,l,p),m=1-lr(s,l,h),N.push(Ia[c])):64===c?(b=lr(e,f,h),_=1-lr(e,l,h),N.push(La[c])):106===c?(b=1-lr(s,h,f),_=lr(s,h,l),N.push(La[c])):168===c?(x=lr(s,f,p),v=lr(e,f,p),I=lr(e,f,h),b=lr(s,f,h),N.push(Ca[c]),N.push(Sa[c])):2===c?(x=1-lr(e,p,f),v=1-lr(s,p,f),I=1-lr(s,h,f),b=1-lr(e,h,f),N.push(Ca[c]),N.push(Sa[c])):162===c?(E=lr(s,p,l),w=lr(e,p,l),x=1-lr(e,p,f),v=1-lr(s,p,f),N.push(Ca[c]),N.push(Sa[c])):8===c?(E=1-lr(e,l,p),w=1-lr(s,l,p),x=lr(s,f,p),v=lr(e,f,p),N.push(Ia[c]),N.push(Na[c])):138===c?(E=1-lr(e,l,p),w=1-lr(s,l,p),_=1-lr(s,l,h),m=1-lr(e,l,h),N.push(Ia[c]),N.push(Na[c])):32===c?(E=lr(s,p,l),w=lr(e,p,l),_=lr(e,h,l),m=lr(s,h,l),N.push(Ia[c]),N.push(Na[c])):42===c?(I=1-lr(s,h,f),b=1-lr(e,h,f),_=lr(e,h,l),m=lr(s,h,l),N.push(Ma[c]),N.push(La[c])):128===c&&(I=lr(e,f,h),b=lr(s,f,h),_=1-lr(s,l,h),m=1-lr(e,l,h),N.push(Ma[c]),N.push(La[c])),5===c?(w=1-lr(e,l,p),I=1-lr(e,h,f),N.push(Na[c])):165===c?(w=lr(s,p,l),I=lr(s,f,h),N.push(Na[c])):20===c?(x=lr(e,f,p),m=lr(e,h,l),N.push(Ca[c])):150===c?(x=1-lr(s,p,f),m=1-lr(s,l,h),N.push(Ca[c])):80===c?(E=lr(e,p,l),b=lr(e,f,h),N.push(Ia[c])):90===c?(E=1-lr(s,l,p),b=1-lr(s,h,f),N.push(Ia[c])):65===c?(v=1-lr(e,p,f),_=1-lr(e,l,h),N.push(Sa[c])):105===c?(v=lr(s,f,p),_=lr(s,h,l),N.push(Sa[c])):160===c?(E=lr(s,p,l),w=lr(e,p,l),I=lr(e,f,h),b=lr(s,f,h),N.push(Ia[c]),N.push(Na[c])):10===c?(E=1-lr(e,l,p),w=1-lr(s,l,p),I=1-lr(s,h,f),b=1-lr(e,h,f),N.push(Ia[c]),N.push(Na[c])):130===c?(x=1-lr(e,p,f),v=1-lr(s,p,f),_=1-lr(s,l,h),m=1-lr(e,l,h),N.push(Ca[c]),N.push(Sa[c])):40===c?(x=lr(s,f,p),v=lr(e,f,p),_=lr(e,h,l),m=lr(s,h,l),N.push(Ca[c]),N.push(Sa[c])):101===c?(w=lr(s,p,l),_=lr(s,h,l),N.push(Na[c])):69===c?(w=1-lr(e,l,p),_=1-lr(e,l,h),N.push(Na[c])):149===c?(I=lr(s,f,h),m=1-lr(s,l,h),N.push(Ma[c])):21===c?(I=1-lr(e,h,f),m=lr(e,h,l),N.push(Ma[c])):86===c?(x=1-lr(s,p,f),b=1-lr(s,h,f),N.push(Ca[c])):84===c?(x=lr(e,f,p),b=lr(e,f,h),N.push(Ca[c])):89===c?(E=1-lr(s,l,p),v=lr(s,f,p),N.push(Sa[c])):81===c?(E=lr(e,p,l),v=1-lr(e,p,f),N.push(Sa[c])):96===c?(E=lr(s,p,l),w=lr(e,p,l),b=lr(e,f,h),_=lr(s,h,l),N.push(Ia[c]),N.push(Na[c])):74===c?(E=1-lr(e,l,p),w=1-lr(s,l,p),b=1-lr(s,h,f),_=1-lr(e,l,h),N.push(Ia[c]),N.push(Na[c])):24===c?(E=1-lr(s,l,p),x=lr(s,f,p),v=lr(e,f,p),m=lr(e,h,l),N.push(Ia[c]),N.push(Sa[c])):146===c?(E=lr(e,p,l),x=1-lr(e,p,f),v=1-lr(s,p,f),m=1-lr(s,l,h),N.push(Ia[c]),N.push(Sa[c])):6===c?(w=1-lr(e,l,p),x=1-lr(s,p,f),I=1-lr(s,h,f),b=1-lr(e,h,f),N.push(Na[c]),N.push(Ca[c])):164===c?(w=lr(s,p,l),x=lr(e,f,p),I=lr(e,f,h),b=lr(s,f,h),N.push(Na[c]),N.push(Ca[c])):129===c?(v=1-lr(e,p,f),I=lr(s,f,h),_=1-lr(s,l,h),m=1-lr(e,l,h),N.push(Sa[c]),N.push(Ma[c])):41===c?(v=lr(s,f,p),I=1-lr(e,h,f),_=lr(e,h,l),m=lr(s,h,l),N.push(Sa[c]),N.push(Ma[c])):66===c?(x=1-lr(e,p,f),v=1-lr(s,p,f),b=1-lr(s,h,f),_=1-lr(e,l,h),N.push(Ca[c]),N.push(Sa[c])):104===c?(x=lr(s,f,p),v=lr(e,f,p),b=lr(e,f,h),_=lr(s,h,l),N.push(Sa[c]),N.push(Pa[c])):144===c?(E=lr(e,p,l),I=lr(e,f,h),b=lr(s,f,h),m=1-lr(s,l,h),N.push(Ia[c]),N.push(La[c])):26===c?(E=1-lr(s,l,p),I=1-lr(s,h,f),b=1-lr(e,h,f),m=lr(e,h,l),N.push(Ia[c]),N.push(La[c])):36===c?(w=lr(s,p,l),x=lr(e,f,p),_=lr(e,h,l),m=lr(s,h,l),N.push(Na[c]),N.push(Ca[c])):134===c?(w=1-lr(e,l,p),x=1-lr(s,p,f),_=1-lr(s,l,h),m=1-lr(e,l,h),N.push(Na[c]),N.push(Ca[c])):9===c?(E=1-lr(e,l,p),w=1-lr(s,l,p),v=lr(s,f,p),I=1-lr(e,h,f),N.push(Ia[c]),N.push(Na[c])):161===c?(E=lr(s,p,l),w=lr(e,p,l),v=1-lr(e,p,f),I=lr(s,f,h),N.push(Ia[c]),N.push(Na[c])):37===c?(w=lr(s,p,l),I=1-lr(e,h,f),_=lr(e,h,l),m=lr(s,h,l),N.push(Na[c]),N.push(Ma[c])):133===c?(w=1-lr(e,l,p),I=lr(s,f,h),_=1-lr(s,l,h),m=1-lr(e,l,h),N.push(Na[c]),N.push(Ma[c])):148===c?(x=lr(e,f,p),I=lr(e,f,h),b=lr(s,f,h),m=1-lr(s,l,h),N.push(Ca[c]),N.push(La[c])):22===c?(x=1-lr(s,p,f),I=1-lr(s,h,f),b=1-lr(e,h,f),m=lr(e,h,l),N.push(Ca[c]),N.push(La[c])):82===c?(E=lr(e,p,l),x=1-lr(e,p,f),v=1-lr(s,p,f),b=1-lr(s,h,f),N.push(Ia[c]),N.push(Sa[c])):88===c?(E=1-lr(s,l,p),x=lr(s,f,p),v=lr(e,f,p),b=lr(e,f,h),N.push(Ia[c]),N.push(Sa[c])):73===c?(E=1-lr(e,l,p),w=1-lr(s,l,p),v=lr(s,f,p),_=1-lr(e,l,h),N.push(Ia[c]),N.push(Na[c])):97===c?(E=lr(s,p,l),w=lr(e,p,l),v=1-lr(e,p,f),_=lr(s,h,l),N.push(Ia[c]),N.push(Na[c])):145===c?(E=lr(e,p,l),v=1-lr(e,p,f),I=lr(s,f,h),m=1-lr(s,l,h),N.push(Ia[c]),N.push(Ma[c])):25===c?(E=1-lr(s,l,p),v=lr(s,f,p),I=1-lr(e,h,f),m=lr(e,h,l),N.push(Ia[c]),N.push(Ma[c])):70===c?(w=1-lr(e,l,p),x=1-lr(s,p,f),b=1-lr(s,h,f),_=1-lr(e,l,h),N.push(Na[c]),N.push(Ca[c])):100===c?(w=lr(s,p,l),x=lr(e,f,p),b=lr(e,f,h),_=lr(s,h,l),N.push(Na[c]),N.push(Ca[c])):34===c?(0===d?(E=1-lr(e,l,p),w=1-lr(s,l,p),x=lr(s,f,p),v=lr(e,f,p),I=lr(e,f,h),b=lr(s,f,h),_=1-lr(s,l,h),m=1-lr(e,l,h)):(E=lr(s,p,l),w=lr(e,p,l),x=1-lr(e,p,f),v=1-lr(s,p,f),I=1-lr(s,h,f),b=1-lr(e,h,f),_=lr(e,h,l),m=lr(s,h,l)),N.push(Ia[c]),N.push(Na[c]),N.push(Ma[c]),N.push(La[c])):35===c?(4===d?(E=1-lr(e,l,p),w=1-lr(s,l,p),x=lr(s,f,p),v=lr(e,f,p),I=lr(e,f,h),b=lr(s,f,h),_=1-lr(s,l,h),m=1-lr(e,l,h)):(E=lr(s,p,l),w=lr(e,p,l),x=1-lr(e,p,f),v=1-lr(s,p,f),I=1-lr(s,h,f),b=1-lr(e,h,f),_=lr(e,h,l),m=lr(s,h,l)),N.push(Ia[c]),N.push(Na[c]),N.push(Sa[c]),N.push(La[c])):136===c?(0===d?(E=lr(s,p,l),w=lr(e,p,l),x=1-lr(e,p,f),v=1-lr(s,p,f),I=1-lr(s,h,f),b=1-lr(e,h,f),_=lr(e,h,l),m=lr(s,h,l)):(E=1-lr(e,l,p),w=1-lr(s,l,p),x=lr(s,f,p),v=lr(e,f,p),I=lr(e,f,h),b=lr(s,f,h),_=1-lr(s,l,h),m=1-lr(e,l,h)),N.push(Ia[c]),N.push(Na[c]),N.push(Ma[c]),N.push(La[c])):153===c?(0===d?(E=lr(e,p,l),v=1-lr(e,p,f),I=1-lr(e,h,f),m=lr(e,h,l)):(E=1-lr(s,l,p),v=lr(s,f,p),I=lr(s,f,h),m=1-lr(s,l,h)),N.push(Ia[c]),N.push(Sa[c])):102===c?(0===d?(w=1-lr(e,l,p),x=lr(e,f,p),b=lr(e,f,h),_=1-lr(e,l,h)):(w=lr(s,p,l),x=1-lr(s,p,f),b=1-lr(s,h,f),_=lr(s,h,l)),N.push(Na[c]),N.push(La[c])):155===c?(4===d?(E=lr(e,p,l),v=1-lr(e,p,f),I=1-lr(e,h,f),m=lr(e,h,l)):(E=1-lr(s,l,p),v=lr(s,f,p),I=lr(s,f,h),m=1-lr(s,l,h)),N.push(Ia[c]),N.push(Ma[c])):103===c?(4===d?(w=1-lr(e,l,p),x=lr(e,f,p),b=lr(e,f,h),_=1-lr(e,l,h)):(w=lr(s,p,l),x=1-lr(s,p,f),b=1-lr(s,h,f),_=lr(s,h,l)),N.push(Na[c]),N.push(Ca[c])):152===c?(0===d?(E=lr(e,p,l),x=1-lr(e,p,f),v=1-lr(s,p,f),I=1-lr(s,h,f),b=1-lr(e,h,f),m=lr(e,h,l)):(E=1-lr(s,l,p),x=lr(s,f,p),v=lr(e,f,p),I=lr(e,f,h),b=lr(s,f,h),m=1-lr(s,l,h)),N.push(Ia[c]),N.push(Ca[c]),N.push(Sa[c])):156===c?(4===d?(E=lr(e,p,l),x=1-lr(e,p,f),v=1-lr(s,p,f),I=1-lr(s,h,f),b=1-lr(e,h,f),m=lr(e,h,l)):(E=1-lr(s,l,p),x=lr(s,f,p),v=lr(e,f,p),I=lr(e,f,h),b=lr(s,f,h),m=1-lr(s,l,h)),N.push(Ia[c]),N.push(Sa[c]),N.push(La[c])):137===c?(0===d?(E=lr(s,p,l),w=lr(e,p,l),v=1-lr(e,p,f),I=1-lr(e,h,f),_=lr(e,h,l),m=lr(s,h,l)):(E=1-lr(e,l,p),w=1-lr(s,l,p),v=lr(s,f,p),I=lr(s,f,h),_=1-lr(s,l,h),m=1-lr(e,l,h)),N.push(Ia[c]),N.push(Na[c]),N.push(Sa[c])):139===c?(4===d?(E=lr(s,p,l),w=lr(e,p,l),v=1-lr(e,p,f),I=1-lr(e,h,f),_=lr(e,h,l),m=lr(s,h,l)):(E=1-lr(e,l,p),w=1-lr(s,l,p),v=lr(s,f,p),I=lr(s,f,h),_=1-lr(s,l,h),m=1-lr(e,l,h)),N.push(Ia[c]),N.push(Na[c]),N.push(Ma[c])):98===c?(0===d?(E=1-lr(e,l,p),w=1-lr(s,l,p),x=lr(s,f,p),v=lr(e,f,p),b=lr(e,f,h),_=1-lr(e,l,h)):(E=lr(s,p,l),w=lr(e,p,l),x=1-lr(e,p,f),v=1-lr(s,p,f),b=1-lr(s,h,f),_=lr(s,h,l)),N.push(Ia[c]),N.push(Na[c]),N.push(La[c])):99===c?(4===d?(E=1-lr(e,l,p),w=1-lr(s,l,p),x=lr(s,f,p),v=lr(e,f,p),b=lr(e,f,h),_=1-lr(e,l,h)):(E=lr(s,p,l),w=lr(e,p,l),x=1-lr(e,p,f),v=1-lr(s,p,f),b=1-lr(s,h,f),_=lr(s,h,l)),N.push(Ia[c]),N.push(Na[c]),N.push(Sa[c])):38===c?(0===d?(w=1-lr(e,l,p),x=lr(e,f,p),I=lr(e,f,h),b=lr(s,f,h),_=1-lr(s,l,h),m=1-lr(e,l,h)):(w=lr(s,p,l),x=1-lr(s,p,f),I=1-lr(s,h,f),b=1-lr(e,h,f),_=lr(e,h,l),m=lr(s,h,l)),N.push(Na[c]),N.push(Ma[c]),N.push(La[c])):39===c?(4===d?(w=1-lr(e,l,p),x=lr(e,f,p),I=lr(e,f,h),b=lr(s,f,h),_=1-lr(s,l,h),m=1-lr(e,l,h)):(w=lr(s,p,l),x=1-lr(s,p,f),I=1-lr(s,h,f),b=1-lr(e,h,f),_=lr(e,h,l),m=lr(s,h,l)),N.push(Na[c]),N.push(Ca[c]),N.push(La[c])):85===c&&(E=1,w=0,x=1,v=0,I=0,b=1,_=0,m=1),(_<0||_>1||m<0||m>1||E<0||E>1||x<0||x>1||I<0||I>1||b<0||b>1)&&console.log("MarchingSquaresJS-isoBands: "+c+" "+g+" "+h+","+l+","+p+","+f+" "+d+" "+_+" "+m+" "+E+" "+w+" "+x+" "+v+" "+I+" "+b),o.cells[a][u]={cval:c,cval_real:g,flipped:d,topleft:_,topright:m,righttop:E,rightbottom:w,bottomright:x,bottomleft:v,leftbottom:I,lefttop:b,edges:N}}}}}return o}(t,e,n);return zs.polygons?(zs.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),u=function(t){var e=[],n=0;return t.cells.forEach(function(t,r){t.forEach(function(t,i){if(void 0!==t){var o=Ra[t.cval](t);"object"==typeof o&&pr(o)?"object"==typeof o[0]&&pr(o[0])?"object"==typeof o[0][0]&&pr(o[0][0])?o.forEach(function(t){t.forEach(function(t){t[0]+=i,t[1]+=r}),e[n++]=t}):(o.forEach(function(t){t[0]+=i,t[1]+=r}),e[n++]=o):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates")}})}),e}(c)):(zs.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),u=function(t){for(var e=[],n=t.rows,r=t.cols,i=[],o=0;o<n;o++)for(var s=0;s<r;s++)if(void 0!==t.cells[o][s]&&t.cells[o][s].edges.length>0){var a=t.cells[o][s],u=function(t){if(t.edges.length>0){var e=t.edges[t.edges.length-1],n=t.cval_real;switch(e){case 0:return n&Xs?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 1:return n&Us?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 2:return n&Us?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 3:return n&Ys?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 4:return n&Xs?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 5:return n&Us?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 6:return n&Us?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 7:return n&Ys?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 8:return n&Us?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.righttop],x:-1,y:0,o:1};case 9:return n&Ys?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 10:return n&Ys?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.righttop],x:-1,y:0,o:1};case 11:return n&js?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 12:return n&Us?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 13:return n&Ys?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 14:return n&Ys?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 15:return n&js?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 16:return n&Us?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 17:return n&js?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 18:return n&Ys?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 19:return n&js?{p:[t.bottomleft,0],x:0,y:1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 20:return n&js?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 21:return n&Xs?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.topright,1],x:0,y:-1,o:1};case 22:return n&js?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 23:return n&Xs?{p:[0,t.lefttop],x:1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t)}}return null}(a),c=null,h=s,l=o;null!==u&&i.push([u.p[0]+h,u.p[1]+l]);do{if(null===(c=function(t,e,n,r){var i,o,s,a,u,c=t.cval;switch(e){case-1:switch(r){case 0:i=Na[c],s=ea[c],a=na[c],u=ra[c];break;default:i=Ia[c],s=Qs[c],a=$s[c],u=ta[c]}break;case 1:switch(r){case 0:i=Ma[c],s=fa[c],a=ga[c],u=da[c];break;default:i=La[c],s=ha[c],a=la[c],u=pa[c]}break;default:switch(n){case-1:switch(r){case 0:i=Pa[c],s=Vs[c],a=Hs[c],u=Ws[c];break;default:i=Oa[c],s=Js[c],a=Zs[c],u=Ks[c]}break;case 1:switch(r){case 0:i=Sa[c],s=ia[c],a=oa[c],u=sa[c];break;default:i=Ca[c],s=aa[c],a=ua[c],u=ca[c]}}}{if(o=t.edges.indexOf(i),void 0===t.edges[o])return null;!function(t,e){delete t.edges[e];for(var n=e+1;n<t.edges.length;n++)t.edges[n-1]=t.edges[n];t.edges.pop()}(t,o)}switch(c=t.cval_real,i){case 0:c&Xs?(e=t.topleft,n=1):(e=1,n=t.righttop);break;case 1:c&Us?(e=1,n=t.rightbottom):(e=t.topleft,n=1);break;case 2:c&Us?(e=t.topleft,n=1):(e=t.bottomright,n=0);break;case 3:c&Ys?(e=t.bottomleft,n=0):(e=t.topleft,n=1);break;case 4:c&Xs?(e=t.topright,n=1):(e=1,n=t.righttop);break;case 5:c&Us?(e=1,n=t.rightbottom):(e=t.topright,n=1);break;case 6:c&Us?(e=t.topright,n=1):(e=t.bottomright,n=0);break;case 7:c&Ys?(e=t.bottomleft,n=0):(e=t.topright,n=1);break;case 8:c&Us?(e=1,n=t.righttop):(e=t.bottomright,n=0);break;case 9:c&Ys?(e=t.bottomleft,n=0):(e=1,n=t.righttop);break;case 10:c&Ys?(e=1,n=t.righttop):(e=0,n=t.leftbottom);break;case 11:c&js?(e=0,n=t.lefttop):(e=1,n=t.righttop);break;case 12:c&Us?(e=1,n=t.rightbottom):(e=t.bottomright,n=0);break;case 13:c&Ys?(e=t.bottomleft,n=0):(e=1,n=t.rightbottom);break;case 14:c&Ys?(e=1,n=t.rightbottom):(e=0,n=t.leftbottom);break;case 15:c&js?(e=0,n=t.lefttop):(e=1,n=t.rightbottom);break;case 16:c&Us?(e=0,n=t.leftbottom):(e=t.bottomright,n=0);break;case 17:c&js?(e=0,n=t.lefttop):(e=t.bottomright,n=0);break;case 18:c&Ys?(e=t.bottomleft,n=0):(e=0,n=t.leftbottom);break;case 19:c&js?(e=0,n=t.lefttop):(e=t.bottomleft,n=0);break;case 20:c&js?(e=0,n=t.leftbottom):(e=t.topleft,n=1);break;case 21:c&Xs?(e=t.topright,n=1):(e=0,n=t.leftbottom);break;case 22:c&js?(e=0,n=t.lefttop):(e=t.topleft,n=1);break;case 23:c&Xs?(e=t.topright,n=1):(e=0,n=t.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t),null}void 0!==e&&void 0!==n&&void 0!==s&&void 0!==a&&void 0!==u||(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(t),console.log(e+" "+n+" "+s+" "+a+" "+u));return{p:[e,n],x:s,y:a,o:u}}(t.cells[l][h],u.x,u.y,u.o)))break;if(i.push([c.p[0]+h,c.p[1]+l]),h+=c.x,l+=c.y,u=c,l<0||l>=n||h<0||h>=r||void 0===t.cells[l][h]){h-=c.x,l-=c.y;var p=function(t,e,n,r,i,o){var s=t.cells[n][e],a=s.cval_real,u=e+r,c=n+i,h=[],l=!1;for(;!l;){if(void 0===t.cells[c]||void 0===t.cells[c][u])if(c-=i,u-=r,s=t.cells[c][u],a=s.cval_real,-1===i)if(0===o)if(a&Ys)h.push([u,c]),r=-1,i=0,o=0;else{if(!(a&Us)){h.push([u+s.bottomright,c]),r=0,i=1,o=1,l=!0;break}h.push([u+1,c]),r=1,i=0,o=0}else{if(!(a&Ys)){if(a&Us){h.push([u+s.bottomright,c]),r=0,i=1,o=1,l=!0;break}h.push([u+s.bottomleft,c]),r=0,i=1,o=0,l=!0;break}h.push([u,c]),r=-1,i=0,o=0}else if(1===i)if(0===o){if(!(a&Xs)){if(a&js){h.push([u+s.topleft,c+1]),r=0,i=-1,o=0,l=!0;break}h.push([u+s.topright,c+1]),r=0,i=-1,o=1,l=!0;break}h.push([u+1,c+1]),r=1,i=0,o=1}else h.push([u+1,c+1]),r=1,i=0,o=1;else if(-1===r)if(0===o){if(!(a&js)){if(a&Ys){h.push([u,c+s.leftbottom]),r=1,i=0,o=0,l=!0;break}h.push([u,c+s.lefttop]),r=1,i=0,o=1,l=!0;break}h.push([u,c+1]),r=0,i=1,o=0}else{if(!(a&js)){console.log("MarchingSquaresJS-isoBands: wtf");break}h.push([u,c+1]),r=0,i=1,o=0}else{if(1!==r){console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}if(0===o){if(!(a&Us)){h.push([u+1,c+s.rightbottom]),r=-1,i=0,o=0,l=!0;break}h.push([u+1,c]),r=0,i=-1,o=1}else{if(!(a&Us)){if(a&Xs){h.push([u+1,c+s.righttop]),r=-1,i=0,o=1;break}h.push([u+1,c+s.rightbottom]),r=-1,i=0,o=0,l=!0;break}h.push([u+1,c]),r=0,i=-1,o=1}}else if(s=t.cells[c][u],a=s.cval_real,-1===r)if(0===o)if(void 0!==t.cells[c-1]&&void 0!==t.cells[c-1][u])r=0,i=-1,o=1;else{if(!(a&Ys)){h.push([u+s.bottomright,c]),r=0,i=1,o=1,l=!0;break}h.push([u,c])}else{if(!(a&js)){console.log("MarchingSquaresJS-isoBands: found entry from top at "+u+","+c);break}console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!")}else if(1===r){if(0===o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[c+1]&&void 0!==t.cells[c+1][u])r=0,i=1,o=0;else{if(!(a&Xs)){h.push([u+s.topleft,c+1]),r=0,i=-1,o=0,l=!0;break}h.push([u+1,c+1]),r=1,i=0,o=1}}else if(-1===i){if(1!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[c][u+1])r=1,i=0,o=1;else{if(!(a&Us)){h.push([u+1,c+s.righttop]),r=-1,i=0,o=1,l=!0;break}h.push([u+1,c]),r=0,i=-1,o=1}}else{if(1!==i){console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(0!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[c][u-1])r=-1,i=0,o=0;else{if(!(a&js)){h.push([u,c+s.leftbottom]),r=1,i=0,o=0,l=!0;break}h.push([u,c+1]),r=0,i=1,o=0}}if(u+=r,c+=i,u===e&&c===n)break}return{path:h,i:u,j:c,x:r,y:i,o:o}}(t,h,l,c.x,c.y,c.o);if(null===p)break;p.path.forEach(function(t){i.push(t)}),h=p.i,l=p.j,u=p}}while(void 0!==t.cells[l][h]&&t.cells[l][h].edges.length>0);e.push(i),i=[],t.cells[o][s].edges.length>0&&s--}return e}(c)),"function"==typeof zs.successCallback&&zs.successCallback(u),u}function lr(t,e,n){return(t-e)/(n-e)}function pr(t){return t.constructor.toString().indexOf("Array")>-1}function fr(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.pivot,i=n.mutate;if(!t)throw new Error("geojson is required");if(void 0===e||null===e||isNaN(e))throw new Error("angle is required");return 0===e?t:(r||(r=ye(t)),!1!==i&&void 0!==i||(t=Gt(t)),S(t,function(t){var n=sn(r,t)+e,i=un(r,t),o=U(nr(r,i,n));t[0]=o[0],t[1]=o[1]}),t)}function gr(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.origin,i=n.mutate;if(!t)throw new Error("geojson required");if("number"!=typeof e||0===e)throw new Error("invalid factor");var o=Array.isArray(r)||"object"==typeof r;return!0!==i&&(t=Gt(t)),"FeatureCollection"!==t.type||o?dr(t,e,r):(O(t,function(n,i){t.features[i]=dr(n,e,r)}),t)}function dr(t,e,n){var i="Point"===K(t);return n=function(t,e){void 0!==e&&null!==e||(e="centroid");if(Array.isArray(e)||"object"==typeof e)return X(e);var n=t.bbox?t.bbox:j(t),i=n[0],o=n[1],s=n[2],a=n[3];switch(e){case"sw":case"southwest":case"westsouth":case"bottomleft":return r([i,o]);case"se":case"southeast":case"eastsouth":case"bottomright":return r([s,o]);case"nw":case"northwest":case"westnorth":case"topleft":return r([i,a]);case"ne":case"northeast":case"eastnorth":case"topright":return r([s,a]);case"center":return de(t);case void 0:case null:case"centroid":return ye(t);default:throw new Error("invalid origin")}}(t,n),1===e||i?t:(S(t,function(t){var r=un(n,t),i=sn(n,t),o=U(nr(n,r*e,i));t[0]=o[0],t[1]=o[1],3===t.length&&(t[2]*=e)}),t)}function yr(t){var e=t[0],n=t[1];return[n[0]-e[0],n[1]-e[1]]}function _r(t,e){return t[0]*e[1]-e[0]*t[1]}function mr(t,e){return!function(t,e){return 0===_r(yr(t),yr(e))}(t,e)&&function(t,e){var n=t[0],r=yr(t),i=e[0],o=yr(e),s=_r(r,o);return function(t,e){return[t[0]+e[0],t[1]+e[1]]}(n,function(t,e){return[t*e[0],t*e[1]]}(_r(function(t,e){return[t[0]-e[0],t[1]-e[1]]}(i,n),o)/s,r))}(t,e)}function vr(t,e,n){var r=[],i=_(e,n),o=U(t),s=[];return o.forEach(function(t,e){if(e!==o.length-1){var n=function(t,e,n){var r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),i=t[0]+n*(e[1]-t[1])/r,o=e[0]+n*(e[1]-t[1])/r,s=t[1]+n*(t[0]-e[0])/r,a=e[1]+n*(t[0]-e[0])/r;return[[i,s],[o,a]]}(t,o[e+1],i);if(r.push(n),e>0){var a=r[e-1],u=mr(n,a);!1!==u&&(a[1]=u,n[0]=u),s.push(a[0]),e===o.length-2&&(s.push(n[0]),s.push(n[1]))}2===o.length&&(s.push(n[0]),s.push(n[1]))}}),a(s,t.properties)}function xr(t,e,n){var r=e[0]-t[0],i=e[1]-t[1],o=n[0]-e[0],s=n[1]-e[1];return Math.sign(r*s-o*i)}function Er(t,e){return e.geometry.coordinates[0].every(function(e){return Pt(r(e),t)})}function wr(t,e){for(var n=0;n<t.coordinates.length-1;n++)if(function(t,e,n){var r=n[0]-t[0],i=n[1]-t[1],o=e[0]-t[0],s=e[1]-t[1];if(r*s-i*o!=0)return!1;return Math.abs(o)>=Math.abs(s)?o>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:s>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1]}(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function br(t,e){return nn(e,kn(t)).features.length>0}function Ir(t,e){return!(t[0]>e[0])&&(!(t[2]<e[2])&&(!(t[1]>e[1])&&!(t[3]<e[3])))}function Nr(t,e){return t[0]===e[0]&&t[1]===e[1]}function Cr(t,e){for(var n=!1,r=!1,i=t.coordinates.length,o=0;o<i&&!n&&!r;){for(var s=0;s<e.coordinates.length-1;s++){var a=!0;0!==s&&s!==e.coordinates.length-2||(a=!1),Lr(e.coordinates[s],e.coordinates[s+1],t.coordinates[o],a)?n=!0:r=!0}o++}return n&&r}function Sr(t,e){return nn(t,kn(e)).features.length>0}function Mr(t,e){for(var n=!1,i=!1,o=t.coordinates[0].length,s=0;s<o&&n&&i;)Pt(r(t.coordinates[0][s]),e)?n=!0:i=!0,s++;return i&&i}function Lr(t,e,n,r){var i=n[0]-t[0],o=n[1]-t[1],s=e[0]-t[0],a=e[1]-t[1];return 0==i*a-o*s&&(r?Math.abs(s)>=Math.abs(a)?s>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:a>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1]:Math.abs(s)>=Math.abs(a)?s>0?t[0]<n[0]&&n[0]<e[0]:e[0]<n[0]&&n[0]<t[0]:a>0?t[1]<n[1]&&n[1]<e[1]:e[1]<n[1]&&n[1]<t[1])}function Pr(t){return t.coordinates.map(function(e){return{type:t.type.replace("Multi",""),coordinates:e}})}function Or(t,e){return t.hasOwnProperty("coordinates")?t.coordinates.length===e.coordinates.length:t.length===e.length}function Rr(t,e){return ka(t,e,{strict:!0})}function Tr(t,e){if(!t)throw new Error("feature1 is required");if(!e)throw new Error("feature2 is required");var n=K(t);if(n!==K(e))throw new Error("features must be of the same type");if("Point"===n)throw new Error("Point geometry not supported");if(new ja({precision:6}).compare(t,e))return!1;var r=0;switch(n){case"MultiPoint":var i=T(t),o=T(e);i.forEach(function(t){o.forEach(function(e){t[0]===e[0]&&t[1]===e[1]&&r++})});break;case"LineString":case"MultiLineString":G(t,function(t){G(e,function(e){$n(t,e).features.length&&r++})});break;case"Polygon":case"MultiPolygon":G(t,function(t){G(e,function(e){nn(t,e).features.length&&r++})})}return r>0}function Ar(t,e,n){n=n||[];for(var r=0;r<t;r++)n[r]=e;return n}function Dr(t,e){if(t.geometry&&t.geometry.type)return t.geometry.type;if(t.type)return t.type;throw new Error("Invalid GeoJSON object for "+e)}function Fr(t){for(var e=t,n=[];e.parent;)n.unshift(e),e=e.parent;return n}function qr(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var n=0;n<t.length;n++){this.grid[n]=[];for(var r=0,i=t[n];r<i.length;r++){var o=new Gr(n,r,i[r]);this.grid[n][r]=o,this.nodes.push(o)}}this.init()}function Gr(t,e,n){this.x=t,this.y=e,this.weight=n}function Br(t){this.content=[],this.scoreFunction=t}function kr(t){return t[0]}function zr(t){return t[1]}function jr(){this._=null}function Xr(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function Ur(t,e){var n=e,r=e.R,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function Yr(t,e){var n=e,r=e.L,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function Vr(t){for(;t.L;)t=t.L;return t}function Hr(t,e,n,r){var i=[null,null],o=uu.push(i)-1;return i.left=t,i.right=e,n&&Jr(i,t,e,n),r&&Jr(i,e,t,r),su[t.index].halfedges.push(o),su[e.index].halfedges.push(o),i}function Wr(t,e,n){var r=[e,n];return r.left=t,r}function Jr(t,e,n,r){t[0]||t[1]?t.left===n?t[1]=r:t[0]=r:(t[0]=r,t.left=e,t.right=n)}function Zr(t,e,n,r,i){var o,s=t[0],a=t[1],u=s[0],c=s[1],h=0,l=1,p=a[0]-u,f=a[1]-c;if(o=e-u,p||!(o>0)){if(o/=p,p<0){if(o<h)return;o<l&&(l=o)}else if(p>0){if(o>l)return;o>h&&(h=o)}if(o=r-u,p||!(o<0)){if(o/=p,p<0){if(o>l)return;o>h&&(h=o)}else if(p>0){if(o<h)return;o<l&&(l=o)}if(o=n-c,f||!(o>0)){if(o/=f,f<0){if(o<h)return;o<l&&(l=o)}else if(f>0){if(o>l)return;o>h&&(h=o)}if(o=i-c,f||!(o<0)){if(o/=f,f<0){if(o>l)return;o>h&&(h=o)}else if(f>0){if(o<h)return;o<l&&(l=o)}return!(h>0||l<1)||(h>0&&(t[0]=[u+h*p,c+h*f]),l<1&&(t[1]=[u+l*p,c+l*f]),!0)}}}}}function Kr(t,e,n,r,i){var o=t[1];if(o)return!0;var s,a,u=t[0],c=t.left,h=t.right,l=c[0],p=c[1],f=h[0],g=h[1],d=(l+f)/2,y=(p+g)/2;if(g===p){if(d<e||d>=r)return;if(l>f){if(u){if(u[1]>=i)return}else u=[d,n];o=[d,i]}else{if(u){if(u[1]<n)return}else u=[d,i];o=[d,n]}}else if(s=(l-f)/(g-p),a=y-s*d,s<-1||s>1)if(l>f){if(u){if(u[1]>=i)return}else u=[(n-a)/s,n];o=[(i-a)/s,i]}else{if(u){if(u[1]<n)return}else u=[(i-a)/s,i];o=[(n-a)/s,n]}else if(p<g){if(u){if(u[0]>=r)return}else u=[e,s*e+a];o=[r,s*r+a]}else{if(u){if(u[0]<e)return}else u=[r,s*r+a];o=[e,s*e+a]}return t[0]=u,t[1]=o,!0}function Qr(t,e){var n=t.site,r=e.left,i=e.right;return n===i&&(i=r,r=n),i?Math.atan2(i[1]-r[1],i[0]-r[0]):(n===r?(r=e[1],i=e[0]):(r=e[0],i=e[1]),Math.atan2(r[0]-i[0],i[1]-r[1]))}function $r(t,e){return e[+(e.left!==t.site)]}function ti(t,e){return e[+(e.left===t.site)]}function ei(t){var e=t.P,n=t.N;if(e&&n){var r=e.site,i=t.site,o=n.site;if(r!==o){var s=i[0],a=i[1],u=r[0]-s,c=r[1]-a,h=o[0]-s,l=o[1]-a,p=2*(u*l-c*h);if(!(p>=-pu)){var f=u*u+c*c,g=h*h+l*l,d=(l*f-c*g)/p,y=(u*g-h*f)/p,_=cu.pop()||new function(){Xr(this),this.x=this.y=this.arc=this.site=this.cy=null};_.arc=t,_.site=i,_.x=d+s,_.y=(_.cy=y+a)+Math.sqrt(d*d+y*y),t.circle=_;for(var m=null,v=au._;v;)if(_.y<v.y||_.y===v.y&&_.x<=v.x){if(!v.L){m=v.P;break}v=v.L}else{if(!v.R){m=v;break}v=v.R}au.insert(m,_),m||(iu=_)}}}}function ni(t){var e=t.circle;e&&(e.P||(iu=e.N),au.remove(e),cu.push(e),Xr(e),t.circle=null)}function ri(t){var e=hu.pop()||new function(){Xr(this),this.edge=this.site=this.circle=null};return e.site=t,e}function ii(t){ni(t),ou.remove(t),hu.push(t),Xr(t)}function oi(t){var e=t.circle,n=e.x,r=e.cy,i=[n,r],o=t.P,s=t.N,a=[t];ii(t);for(var u=o;u.circle&&Math.abs(n-u.circle.x)<lu&&Math.abs(r-u.circle.cy)<lu;)o=u.P,a.unshift(u),ii(u),u=o;a.unshift(u),ni(u);for(var c=s;c.circle&&Math.abs(n-c.circle.x)<lu&&Math.abs(r-c.circle.cy)<lu;)s=c.N,a.push(c),ii(c),c=s;a.push(c),ni(c);var h,l=a.length;for(h=1;h<l;++h)c=a[h],u=a[h-1],Jr(c.edge,u.site,c.site,i);u=a[0],(c=a[l-1]).edge=Hr(u.site,c.site,null,i),ei(u),ei(c)}function si(t){for(var e,n,r,i,o=t[0],s=t[1],a=ou._;a;)if((r=ai(a,s)-o)>lu)a=a.L;else{if(!((i=o-function(t,e){var n=t.N;if(n)return ai(n,e);var r=t.site;return r[1]===e?r[0]:1/0}(a,s))>lu)){r>-lu?(e=a.P,n=a):i>-lu?(e=a,n=a.N):e=n=a;break}if(!a.R){e=a;break}a=a.R}!function(t){su[t.index]={site:t,halfedges:[]}}(t);var u=ri(t);if(ou.insert(e,u),e||n){if(e===n)return ni(e),n=ri(e.site),ou.insert(u,n),u.edge=n.edge=Hr(e.site,u.site),ei(e),void ei(n);if(n){ni(e),ni(n);var c=e.site,h=c[0],l=c[1],p=t[0]-h,f=t[1]-l,g=n.site,d=g[0]-h,y=g[1]-l,_=2*(p*y-f*d),m=p*p+f*f,v=d*d+y*y,x=[(y*m-f*v)/_+h,(p*v-d*m)/_+l];Jr(n.edge,c,g,x),u.edge=Hr(c,t,null,x),n.edge=Hr(t,g,null,x),ei(e),ei(n)}else u.edge=Hr(e.site,u.site)}}function ai(t,e){var n=t.site,r=n[0],i=n[1],o=i-e;if(!o)return r;var s=t.P;if(!s)return-1/0;var a=(n=s.site)[0],u=n[1],c=u-e;if(!c)return a;var h=a-r,l=1/o-1/c,p=h/c;return l?(-p+Math.sqrt(p*p-2*l*(h*h/(-2*c)-u+c/2+i-o/2)))/l+r:(r+a)/2}function ui(t,e,n){return(t[0]-n[0])*(e[1]-t[1])-(t[0]-e[0])*(n[1]-t[1])}function ci(t,e){return e[1]-t[1]||e[0]-t[0]}function hi(t,e){var n,r,i,o=t.sort(ci).pop();for(uu=[],su=new Array(t.length),ou=new jr,au=new jr;;)if(i=iu,o&&(!i||o[1]<i.y||o[1]===i.y&&o[0]<i.x))o[0]===n&&o[1]===r||(si(o),n=o[0],r=o[1]),o=t.pop();else{if(!i)break;oi(i.arc)}if(function(){for(var t,e,n,r,i=0,o=su.length;i<o;++i)if((t=su[i])&&(r=(e=t.halfedges).length)){var s=new Array(r),a=new Array(r);for(n=0;n<r;++n)s[n]=n,a[n]=Qr(t,uu[e[n]]);for(s.sort(function(t,e){return a[e]-a[t]}),n=0;n<r;++n)a[n]=e[s[n]];for(n=0;n<r;++n)e[n]=a[n]}}(),e){var s=+e[0][0],a=+e[0][1],u=+e[1][0],c=+e[1][1];!function(t,e,n,r){for(var i,o=uu.length;o--;)Kr(i=uu[o],t,e,n,r)&&Zr(i,t,e,n,r)&&(Math.abs(i[0][0]-i[1][0])>lu||Math.abs(i[0][1]-i[1][1])>lu)||delete uu[o]}(s,a,u,c),function(t,e,n,r){var i,o,s,a,u,c,h,l,p,f,g,d,y=su.length,_=!0;for(i=0;i<y;++i)if(o=su[i]){for(s=o.site,a=(u=o.halfedges).length;a--;)uu[u[a]]||u.splice(a,1);for(a=0,c=u.length;a<c;)g=(f=ti(o,uu[u[a]]))[0],d=f[1],l=(h=$r(o,uu[u[++a%c]]))[0],p=h[1],(Math.abs(g-l)>lu||Math.abs(d-p)>lu)&&(u.splice(a,0,uu.push(Wr(s,f,Math.abs(g-t)<lu&&r-d>lu?[t,Math.abs(l-t)<lu?p:r]:Math.abs(d-r)<lu&&n-g>lu?[Math.abs(p-r)<lu?l:n,r]:Math.abs(g-n)<lu&&d-e>lu?[n,Math.abs(l-n)<lu?p:e]:Math.abs(d-e)<lu&&g-t>lu?[Math.abs(p-e)<lu?l:t,e]:null))-1),++c);c&&(_=!1)}if(_){var m,v,x,E=1/0;for(i=0,_=null;i<y;++i)(o=su[i])&&(x=(m=(s=o.site)[0]-t)*m+(v=s[1]-e)*v)<E&&(E=x,_=o);if(_){var w=[t,e],b=[t,r],I=[n,r],N=[n,e];_.halfedges.push(uu.push(Wr(s=_.site,w,b))-1,uu.push(Wr(s,b,I))-1,uu.push(Wr(s,I,N))-1,uu.push(Wr(s,N,w))-1)}}for(i=0;i<y;++i)(o=su[i])&&(o.halfedges.length||delete su[i])}(s,a,u,c)}this.edges=uu,this.cells=su,ou=au=uu=su=null}function li(t){return(t=t.slice()).push(t[0]),o([t])}function pi(t,e,n,r){var i=(r=r||{}).steps||64,s=r.units||"kilometers",a=r.angle||0,u=r.pivot||t,c=r.properties||t.properties||{};if(!t)throw new Error("center is required");if(!e)throw new Error("xSemiAxis is required");if(!n)throw new Error("ySemiAxis is required");if(!I(r))throw new Error("options must be an object");if(!b(i))throw new Error("steps must be a number");if(!b(a))throw new Error("angle must be a number");var h=X(t);if("degrees"===s)var l=x(a);else e=nr(t,e,90,{units:s}),n=nr(t,n,0,{units:s}),e=X(e)[0]-h[0],n=X(n)[1]-h[1];for(var p=[],f=0;f<i;f+=1){var g=-360*f/i,d=e*n/Math.sqrt(Math.pow(n,2)+Math.pow(e,2)*Math.pow(fi(g),2)),y=e*n/Math.sqrt(Math.pow(e,2)+Math.pow(n,2)/Math.pow(fi(g),2));if(g<-90&&g>=-270&&(d=-d),g<-180&&g>=-360&&(y=-y),"degrees"===s){var _=d*Math.cos(l)+y*Math.sin(l),m=y*Math.cos(l)-d*Math.sin(l);d=_,y=m}p.push([d+h[0],y+h[1]])}return p.push(p[0]),"degrees"===s?o([p],c):fr(o([p],c),a,{pivot:u})}function fi(t){var e=t*Math.PI/180;return Math.tan(e)}function gi(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.properties,i=e.weight;if(!t)throw new Error("geojson is required");var o=0,s=0,a=0;return A(t,function(t,e,n){var r=n[i];if(r=void 0===r||null===r?1:r,!b(r))throw new Error("weight value must be a number for feature index "+e);(r=Number(r))>0&&S(t,function(t){o+=t[0]*r,s+=t[1]*r,a+=r})}),r([o/a,s/a],n)}function di(t,e,n,i){var o=n.properties.tolerance||.001,s=0,a=0,u=0,c=0;if(O(n,function(e){var n=e.properties.weight,r=void 0===n||null===n?1:n;if(r=Number(r),!b(r))throw new Error("weight value must be a number");if(r>0){c+=1;var i=r*qt(e,t);0===i&&(i=1);var o=r/i;s+=e.geometry.coordinates[0]*o,a+=e.geometry.coordinates[1]*o,u+=o}}),c<1)throw new Error("no features to measure");var h=s/u,l=a/u;return 1===c||0===i||Math.abs(h-e[0])<o&&Math.abs(l-e[1])<o?r([h,l],{medianCandidates:n.properties.medianCandidates}):(n.properties.medianCandidates.push([h,l]),di([h,l],t,n,i-1))}function yi(t,e){return{x:t[0]-e[0],y:t[1]-e[1]}}function _i(t){if(I(t)&&(t=t.bbox),t&&!Array.isArray(t))throw new Error("bbox is invalid");return t?function(t){return[Math.random()*(t[2]-t[0])+t[0],Math.random()*(t[3]-t[1])+t[1]]}(t):[360*Ei(),180*Ei()]}function mi(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.bbox;void 0!==t&&null!==t||(t=1);for(var i=[],o=0;o<t;o++)i.push(r(_i(n)));return c(i)}function vi(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.bbox,r=e.num_vertices,i=e.max_radial_length;void 0!==t&&null!==t||(t=1),b(r)||(r=10),b(i)||(i=10);for(var s=[],a=0;a<t;a++){var u=[],h=Array.apply(null,new Array(r+1)).map(Math.random);h.forEach(function(t,e,n){n[e]=e>0?t+n[e-1]:t}),h.forEach(function(t){t=2*t*Math.PI/h[h.length-1];var e=Math.random();u.push([e*i*Math.sin(t),e*i*Math.cos(t)])}),u[u.length-1]=u[0],u=u.map(function(t){return function(e){return[e[0]+t[0],e[1]+t[1]]}}(_i(n))),s.push(o([u]))}return c(s)}function xi(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.bbox,r=e.num_vertices,i=e.max_length,o=e.max_rotation;void 0!==t&&null!==t||(t=1),(!b(r)||r<2)&&(r=10),b(i)||(i=1e-4),b(o)||(o=Math.PI/8);for(var s=[],u=0;u<t;u++){for(var h=[_i(n)],l=0;l<r-1;l++){var p=(0===l?2*Math.random()*Math.PI:Math.tan((h[l][1]-h[l-1][1])/(h[l][0]-h[l-1][0])))+(Math.random()-.5)*o*2,f=Math.random()*i;h.push([h[l][0]+f*Math.cos(p),h[l][1]+f*Math.sin(p)])}s.push(a(h))}return c(s)}function Ei(){return Math.random()-.5}function wi(t,e){if(!t)throw new Error("geojson is required");if("FeatureCollection"!==t.type)throw new Error("geojson must be a FeatureCollection");if(void 0===e||null===e)throw new Error("filter is required");var n=[];return O(t,function(t){Ci(t.properties,e)&&n.push(t)}),c(n)}function bi(t,e,n){if(!t)throw new Error("geojson is required");if("FeatureCollection"!==t.type)throw new Error("geojson must be a FeatureCollection");if(void 0===e||null===e)throw new Error("property is required");for(var r=Ni(t,e),i=Object.keys(r),o=0;o<i.length;o++){for(var s=i[o],a=r[s],u=[],h=0;h<a.length;h++)u.push(t.features[a[h]]);n(c(u),s,o)}}function Ii(t,e,n,r){var i=r;return bi(t,e,function(t,e,o){i=0===o&&void 0===r?t:n(i,t,e,o)}),i}function Ni(t,e){var n={};return O(t,function(t,r){var i=t.properties||{};if(i.hasOwnProperty(e)){var o=i[e];n.hasOwnProperty(o)?n[o].push(r):n[o]=[r]}}),n}function Ci(t,e){if(void 0===t)return!1;var n=typeof e;if("number"===n||"string"===n)return t.hasOwnProperty(e);if(Array.isArray(e)){for(var r=0;r<e.length;r++)if(!Ci(t,e[r]))return!1;return!0}return Si(t,e)}function Si(t,e){for(var n=Object.keys(e),r=0;r<n.length;r++){var i=n[r];if(t[i]!==e[i])return!1}return!0}function Mi(t,e){if(!e)return{};if(!e.length)return{};for(var n={},r=0;r<e.length;r++){var i=e[r];t.hasOwnProperty(i)&&(n[i]=t[i])}return n}function Li(){}function Pi(t){this.message=t||""}function Oi(t){this.message=t||""}function Ri(){}function Ti(t){return null===t?Ac:t.color}function Ai(t){return null===t?null:t.parent}function Di(t,e){null!==t&&(t.color=e)}function Fi(t){return null===t?null:t.left}function qi(t){return null===t?null:t.right}function Gi(){this.root_=null,this.size_=0}function Bi(){}function ki(){this.array_=[],arguments[0]instanceof vc&&this.addAll(arguments[0])}function zi(){}function ji(t){this.message=t||""}function Xi(){this.array_=[]}function Ui(t){switch(t.type){case"Polygon":return mn(t)>1?t:null;case"MultiPolygon":var e=[];if(F(t,function(t){mn(t)>1&&e.push(t.geometry.coordinates)}),e.length)return{type:"MultiPolygon",coordinates:e}}}function Yi(){this.reset()}function Vi(t,e,n){var r=t.s=e+n,i=r-e,o=r-i;t.t=e-o+(n-i)}function Hi(t){return t>1?kf:t<-1?-kf:Math.asin(t)}function Wi(){}function Ji(t,e){t&&eg.hasOwnProperty(t.type)&&eg[t.type](t,e)}function Zi(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function Ki(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)Zi(t[n],e,1);e.polygonEnd()}function Qi(t){return[Hf(t[1],t[0]),Hi(t[2])]}function $i(t){var e=t[0],n=t[1],r=Wf(n);return[r*Wf(e),r*Kf(e),Kf(n)]}function to(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function eo(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function no(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function ro(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function io(t){var e=Qf(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function oo(t,e){return[t>Bf?t-jf:t<-Bf?t+jf:t,e]}function so(t,e,n){return(t%=jf)?e||n?rg(uo(t),co(e,n)):uo(t):e||n?co(e,n):oo}function ao(t){return function(e,n){return e+=t,[e>Bf?e-jf:e<-Bf?e+jf:e,n]}}function uo(t){var e=ao(t);return e.invert=ao(-t),e}function co(t,e){function n(t,e){var n=Wf(e),a=Wf(t)*n,u=Kf(t)*n,c=Kf(e),h=c*r+a*i;return[Hf(u*o-h*s,a*r-c*i),Hi(h*o+u*s)]}var r=Wf(t),i=Kf(t),o=Wf(e),s=Kf(e);return n.invert=function(t,e){var n=Wf(e),a=Wf(t)*n,u=Kf(t)*n,c=Kf(e),h=c*o-u*s;return[Hf(u*o+c*s,a*r+h*i),Hi(h*r-a*i)]},n}function ho(t,e){(e=$i(e))[0]-=t,io(e);var n=function(t){return t>1?0:t<-1?Bf:Math.acos(t)}(-e[1]);return((-e[2]<0?-n:n)+jf-Gf)%jf}function lo(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function po(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}function fo(t,e,n,r){function i(i,o){return t<=i&&i<=n&&e<=o&&o<=r}function o(i,o,a,c){var h=0,l=0;if(null==i||(h=s(i,a))!==(l=s(o,a))||u(i,o)<0^a>0)do{c.point(0===h||3===h?t:n,h>1?r:e)}while((h=(h+a+4)%4)!==l);else c.point(o[0],o[1])}function s(r,i){return Yf(r[0]-t)<Gf?i>0?0:3:Yf(r[0]-n)<Gf?i>0?2:1:Yf(r[1]-e)<Gf?i>0?1:0:i>0?3:2}function a(t,e){return u(t.x,e.x)}function u(t,e){var n=s(t,1),r=s(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(s){function u(t,e){i(t,e)&&E.point(t,e)}function c(o,s){var a=i(o,s);if(l&&p.push([o,s]),v)f=o,g=s,d=a,v=!1,a&&(E.lineStart(),E.point(o,s));else if(a&&m)E.point(o,s);else{var u=[y=Math.max(pg,Math.min(lg,y)),_=Math.max(pg,Math.min(lg,_))],c=[o=Math.max(pg,Math.min(lg,o)),s=Math.max(pg,Math.min(lg,s))];sg(u,c,t,e,n,r)?(m||(E.lineStart(),E.point(u[0],u[1])),E.point(c[0],c[1]),a||E.lineEnd(),x=!1):a&&(E.lineStart(),E.point(o,s),x=!1)}y=o,_=s,m=a}var h,l,p,f,g,d,y,_,m,v,x,E=s,w=og(),b={point:u,lineStart:function(){b.point=c,l&&l.push(p=[]),v=!0,m=!1,y=_=NaN},lineEnd:function(){h&&(c(f,g),d&&m&&w.rejoin(),h.push(w.result())),b.point=u,m&&E.lineEnd()},polygonStart:function(){E=w,h=[],l=[],x=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,i=l.length;n<i;++n)for(var o,s,a=l[n],u=1,c=a.length,h=a[0],p=h[0],f=h[1];u<c;++u)o=p,s=f,p=(h=a[u])[0],f=h[1],s<=r?f>r&&(p-o)*(r-s)>(f-s)*(t-o)&&++e:f<=r&&(p-o)*(r-s)<(f-s)*(t-o)&&--e;return e}(),n=x&&e,i=(h=hg(h)).length;(n||i)&&(s.polygonStart(),n&&(s.lineStart(),o(null,null,1,s),s.lineEnd()),i&&ug(h,a,e,o,s),s.polygonEnd()),E=s,h=l=p=null}};return b}}function go(t){return t.length>1}function yo(t,e){return((t=t.x)[0]<0?t[1]-kf-Gf:kf-t[1])-((e=e.x)[0]<0?e[1]-kf-Gf:kf-e[1])}function _o(t){return function(e){var n=new mo;for(var r in t)n[r]=t[r];return n.stream=e,n}}function mo(){}function vo(t,e,n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],o=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),null!=o&&t.clipExtent(null),ng(n,t.stream(vg));var s=vg.result(),a=Math.min(r/(s[1][0]-s[0][0]),i/(s[1][1]-s[0][1])),u=+e[0][0]+(r-a*(s[1][0]+s[0][0]))/2,c=+e[0][1]+(i-a*(s[1][1]+s[0][1]))/2;return null!=o&&t.clipExtent(o),t.scale(150*a).translate([u,c])}function xo(t){return function(t){function e(t){return t=c(t[0]*Uf,t[1]*Uf),[t[0]*d+s,a-t[1]*d]}function n(t,e){return t=o(t,e),[t[0]*d+s,a-t[1]*d]}function r(){c=rg(u=so(x,E,w),o);var t=o(m,v);return s=y-t[0]*d,a=_+t[1]*d,i()}function i(){return f=g=null,e}var o,s,a,u,c,h,l,p,f,g,d=150,y=480,_=250,m=0,v=0,x=0,E=0,w=0,b=null,I=Eg,N=null,C=gg,S=.5,M=Ng(n,S);e.stream=function(t){return f&&g===t?f:f=Cg(I(u,M(C(g=t))))},e.clipAngle=function(t){return arguments.length?(I=+t?wg(b=t*Uf,6*Uf):(b=null,Eg),i()):b*Xf},e.clipExtent=function(t){return arguments.length?(C=null==t?(N=h=l=p=null,gg):fo(N=+t[0][0],h=+t[0][1],l=+t[1][0],p=+t[1][1]),i()):null==N?null:[[N,h],[l,p]]},e.scale=function(t){return arguments.length?(d=+t,r()):d},e.translate=function(t){return arguments.length?(y=+t[0],_=+t[1],r()):[y,_]},e.center=function(t){return arguments.length?(m=t[0]%360*Uf,v=t[1]%360*Uf,r()):[m*Xf,v*Xf]},e.rotate=function(t){return arguments.length?(x=t[0]%360*Uf,E=t[1]%360*Uf,w=t.length>2?t[2]%360*Uf:0,r()):[x*Xf,E*Xf,w*Xf]},e.precision=function(t){return arguments.length?(M=Ng(n,S=t*t),i()):Qf(S)},e.fitExtent=function(t,n){return vo(e,t,n)},e.fitSize=function(t,n){return function(t,e,n){return vo(t,[[0,0],e],n)}(e,t,n)};return function(){return o=t.apply(this,arguments),e.invert=o.invert&&function(t){return(t=c.invert((t[0]-s)/d,(a-t[1])/d))&&[t[0]*Xf,t[1]*Xf]},r()}}(function(){return t})()}function Eo(t,e){return[t,Zf($f((kf+e)/2))]}function wo(t,e){return[Zf($f((kf+e)/2)),-t]}function bo(t,n,r,i){var o=t.properties||{},s="Feature"===t.type?t.geometry:t;if("GeometryCollection"===s.type){var a=[];return A(t,function(t){var e=bo(t,n,r,i);e&&a.push(e)}),c(a)}var u,h=j(t),l=h[1]>50&&h[3]>50;u=l?{type:s.type,coordinates:No(s.coordinates,So(s))}:cn(s);var p=(new bh).read(u),f=d(y(n,r),"meters"),g=gp.bufferOp(p,f);if(g=(new Ih).write(g),!Io(g.coordinates)){var _;return(_=l?{type:g.type,coordinates:Co(g.coordinates,So(s))}:hn(g)).geometry?_:e(_,o)}}function Io(t){return Array.isArray(t[0])?Io(t[0]):isNaN(t[0])}function No(t,e){return"object"!=typeof t[0]?e(t):t.map(function(t){return No(t,e)})}function Co(t,e){return"object"!=typeof t[0]?e.invert(t):t.map(function(t){return Co(t,e)})}function So(t){var e=de(t).geometry.coordinates.reverse(),n=e.map(function(t){return-t});return Sg().center(e).rotate(n).scale(Fo)}function Mo(){for(var t=new bh,e=t.read(JSON.stringify(arguments[0].geometry)),n=1;n<arguments.length;n++)e=Df.union(e,t.read(JSON.stringify(arguments[n].geometry)));return e=(new Ih).write(e),{type:"Feature",geometry:e,properties:arguments[0].properties}}function Lo(t,n){var r=J(t),i=J(n);if(te(Pn(i,{precision:4})).coordinates[0].length<4)return null;if(te(Pn(r,{precision:4})).coordinates[0].length<4)return null;var o=new bh,s=o.read(Pn(r)),a=o.read(Pn(i)),u=Cf.intersection(s,a);if(u.isEmpty())return null;return e((new Ih).write(u))}function Po(t,e){return function(t,e,n){var r,i;if(!Array.isArray(e))throw new Error("Get closest expects an array as second argument");return e.forEach(function(e,o){var s=n(e,t);s>=0&&(void 0===i||s<i)&&(i=s,r=o)}),r}(t,e,function(t,e){return t-e})}function Oo(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.properties||{},i=n.triangles,s=n.mask;if(null===e||void 0===e)throw new Error("cellSide is required");if(!b(e))throw new Error("cellSide is invalid");if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be array");if(4!==t.length)throw new Error("bbox must contain 4 numbers");if(s&&-1===["Polygon","MultiPolygon"].indexOf(K(s)))throw new Error("options.mask must be a (Multi)Polygon");var a=t[0],u=t[1],h=t[2],l=t[3],p=(u+l)/2,f=(a+h)/2,g=2*e/qt([a,p],[h,p],n)*(h-a),d=2*e/qt([f,u],[f,l],n)*(l-u),y=g/2,_=2*y,m=Math.sqrt(3)/2*d,v=h-a,x=l-u,E=.75*_,w=m,N=(v-_)/(_-y/2),C=Math.floor(N),S=(C*E-y/2-v)/2-y/2+E/2,M=Math.floor((x-m)/m),L=(x-M*m)/2,P=M*m-x>m/2;P&&(L-=m/4);for(var O=[],R=[],T=0;T<6;T++){var A=2*Math.PI/6*T;O.push(Math.cos(A)),R.push(Math.sin(A))}for(var D=[],F=0;F<=C;F++)for(var q=0;q<=M;q++){var G=F%2==1;if((0!==q||!G)&&(0!==q||!P)){var B=F*E+a-S,k=q*w+u+L;if(G&&(k-=m/2),!0===i)(function(t,e,n,r,i,s){for(var a=[],u=0;u<6;u++){var c=[];c.push(t),c.push([t[0]+e*i[u],t[1]+n*s[u]]),c.push([t[0]+e*i[(u+1)%6],t[1]+n*s[(u+1)%6]]),c.push(t),a.push(o([c],r))}return a})([B,k],g/2,d/2,r,O,R).forEach(function(t){s?Lo(s,t)&&D.push(t):D.push(t)});else{var z=function(t,e,n,r,i,s){for(var a=[],u=0;u<6;u++){var c=t[0]+e*i[u],h=t[1]+n*s[u];a.push([c,h])}return a.push(a[0].slice()),o([a],r)}([B,k],g/2,d/2,r,O,R);s?Lo(s,z)&&D.push(z):D.push(z)}}}return c(D)}function Ro(t){if(t.features.length<=1)return t;var e=function(t){var e=Vo(),n=[];return F(t,function(t,e){var r=j(t);n.push({minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],geojson:t,index:e})}),e.load(n),e}(t),n=[],r={};return F(t,function(t,i){if(r[i])return!0;for(e.remove({index:i},To),r[i]=!0;;){var o=j(t),s=e.search({minX:o[0],minY:o[1],maxX:o[2],maxY:o[3]});if(s.length>0){var a=s.map(function(t){return r[t.index]=!0,e.remove({index:t.index},To),t.geojson});a.push(t),t=Mo.apply(this,a)}if(0===s.length)break}n.push(t)}),c(n)}function To(t,e){return t.index===e.index}function Ao(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.properties,i=n.mask,s=[];if(null===e||void 0===e)throw new Error("cellSide is required");if(!b(e))throw new Error("cellSide is invalid");if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be array");if(4!==t.length)throw new Error("bbox must contain 4 numbers");if(i&&-1===["Polygon","MultiPolygon"].indexOf(K(i)))throw new Error("options.mask must be a (Multi)Polygon");for(var a=t[0],u=t[1],h=t[2],l=t[3],p=e/qt([a,u],[h,u],n)*(h-a),f=e/qt([a,u],[a,l],n)*(l-u),g=h-a,d=l-u,y=Math.floor(g/p),_=Math.floor(d/f),m=(d-_*f)/2,v=a+(g-y*p)/2,x=0;x<y;x++){for(var E=u+m,w=0;w<_;w++){var N=o([[[v,E],[v,E+f],[v+p,E+f],[v+p,E],[v,E]]],r);i?Lo(i,N)&&s.push(N):s.push(N),E+=f}v+=p}return c(s)}function Do(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.properties,i=n.mask,s=[];if(null===e||void 0===e)throw new Error("cellSide is required");if(!b(e))throw new Error("cellSide is invalid");if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be array");if(4!==t.length)throw new Error("bbox must contain 4 numbers");if(i&&-1===["Polygon","MultiPolygon"].indexOf(K(i)))throw new Error("options.mask must be a (Multi)Polygon");for(var a=e/qt([t[0],t[1]],[t[2],t[1]],n)*(t[2]-t[0]),u=e/qt([t[0],t[1]],[t[0],t[3]],n)*(t[3]-t[1]),h=0,l=t[0];l<=t[2];){for(var p=0,f=t[1];f<=t[3];){var g=null,d=null;h%2==0&&p%2==0?(g=o([[[l,f],[l,f+u],[l+a,f],[l,f]]],r),d=o([[[l,f+u],[l+a,f+u],[l+a,f],[l,f+u]]],r)):h%2==0&&p%2==1?(g=o([[[l,f],[l+a,f+u],[l+a,f],[l,f]]],r),d=o([[[l,f],[l,f+u],[l+a,f+u],[l,f]]],r)):p%2==0&&h%2==1?(g=o([[[l,f],[l,f+u],[l+a,f+u],[l,f]]],r),d=o([[[l,f],[l+a,f+u],[l+a,f],[l,f]]],r)):p%2==1&&h%2==1&&(g=o([[[l,f],[l,f+u],[l+a,f],[l,f]]],r),d=o([[[l,f+u],[l+a,f+u],[l+a,f],[l,f+u]]],r)),i?(Lo(i,g)&&s.push(g),Lo(i,d)&&s.push(d)):(s.push(g),s.push(d)),f+=u,p++}h++,l+=a}return c(s)}var Fo=6371008.8,qo={meters:Fo,metres:Fo,millimeters:1e3*Fo,millimetres:1e3*Fo,centimeters:100*Fo,centimetres:100*Fo,kilometers:Fo/1e3,kilometres:Fo/1e3,miles:Fo/1609.344,nauticalmiles:Fo/1852,inches:39.37*Fo,yards:Fo/1.0936,feet:3.28084*Fo,radians:1,degrees:Fo/111325},Go={meters:1,metres:1,millimeters:1e3,millimetres:1e3,centimeters:100,centimetres:100,kilometers:.001,kilometres:.001,miles:1/1609.344,nauticalmiles:1/1852,inches:39.37,yards:1/1.0936,feet:3.28084,radians:1/Fo,degrees:1/111325},Bo={meters:1,metres:1,millimeters:1e6,millimetres:1e6,centimeters:1e4,centimetres:1e4,kilometers:1e-6,kilometres:1e-6,acres:247105e-9,miles:3.86e-7,yards:1.195990046,feet:10.763910417,inches:1550.003100006},ko=Object.freeze({earthRadius:Fo,factors:qo,unitsFactors:Go,areaFactors:Bo,feature:e,geometry:n,point:r,points:i,polygon:o,polygons:s,lineString:a,lineStrings:u,featureCollection:c,multiLineString:h,multiPoint:l,multiPolygon:p,geometryCollection:f,round:g,radiansToLength:d,lengthToRadians:y,lengthToDegrees:_,bearingToAzimuth:m,radiansToDegrees:v,degreesToRadians:x,convertLength:E,convertArea:w,isNumber:b,isObject:I,validateBBox:N,validateId:C,radians2degrees:function(){throw new Error("method has been renamed to `radiansToDegrees`")},degrees2radians:function(){throw new Error("method has been renamed to `degreesToRadians`")},distanceToDegrees:function(){throw new Error("method has been renamed to `lengthToDegrees`")},distanceToRadians:function(){throw new Error("method has been renamed to `lengthToRadians`")},radiansToDistance:function(){throw new Error("method has been renamed to `radiansToLength`")},bearingToAngle:function(){throw new Error("method has been renamed to `bearingToAzimuth`")},convertDistance:function(){throw new Error("method has been renamed to `convertLength`")}}),zo=Object.freeze({coordEach:S,coordReduce:M,propEach:L,propReduce:P,featureEach:O,featureReduce:R,coordAll:T,geomEach:A,geomReduce:D,flattenEach:F,flattenReduce:q,segmentEach:G,segmentReduce:B,lineEach:k,lineReduce:z}),jo=Object.freeze({getCoord:X,getCoords:U,containsNumber:Y,geojsonType:V,featureOf:H,collectionOf:W,getGeom:J,getGeomType:Z,getType:K}),Xo={successCallback:null,verbose:!1},Uo={},Yo=it,Vo=st;st.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],r=this.toBBox;if(!dt(t,e))return n;for(var i,o,s,a,u=[];e;){for(i=0,o=e.children.length;i<o;i++)s=e.children[i],dt(t,a=e.leaf?r(s):s)&&(e.leaf?n.push(s):gt(t,a)?this._all(s,n):u.push(s));e=u.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!dt(t,e))return!1;for(var r,i,o,s,a=[];e;){for(r=0,i=e.children.length;r<i;r++)if(o=e.children[r],s=e.leaf?n(o):o,dt(t,s)){if(e.leaf||gt(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=yt([]),this},remove:function(t,e){if(!t)return this;for(var n,r,i,o,s=this.data,a=this.toBBox(t),u=[],c=[];s||u.length;){if(s||(s=u.pop(),r=u[u.length-1],n=c.pop(),o=!0),s.leaf&&-1!==(i=function(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}(t,s.children,e)))return s.children.splice(i,1),u.push(s),this._condense(u),this;o||s.leaf||!gt(s,a)?r?(n++,s=r.children[n],o=!1):s=null:(u.push(s),c.push(n),n=0,r=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:ht,compareMinY:lt,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,r){var i,o=n-e+1,s=this._maxEntries;if(o<=s)return i=yt(t.slice(e,n+1)),at(i,this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),(i=yt([])).leaf=!1,i.height=r;var a,u,c,h,l=Math.ceil(o/s),p=l*Math.ceil(Math.sqrt(s));for(_t(t,e,n,p,this.compareMinX),a=e;a<=n;a+=p)for(_t(t,a,c=Math.min(a+p-1,n),l,this.compareMinY),u=a;u<=c;u+=l)h=Math.min(u+l-1,c),i.children.push(this._build(t,u,h,r-1));return at(i,this.toBBox),i},_chooseSubtree:function(t,e,n,r){for(var i,o,s,a,u,c,h,l;r.push(e),!e.leaf&&r.length-1!==n;){for(h=l=1/0,i=0,o=e.children.length;i<o;i++)u=pt(s=e.children[i]),(c=function(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}(t,s)-u)<l?(l=c,h=u<h?u:h,a=s):c===l&&u<h&&(h=u,a=s);e=a||e.children[0]}return e},_insert:function(t,e,n){var r=this.toBBox,i=n?t:r(t),o=[],s=this._chooseSubtree(i,this.data,e,o);for(s.children.push(t),ct(s,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),s=yt(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,at(n,this.toBBox),at(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,e){this.data=yt([t,e]),this.data.height=t.height+1,this.data.leaf=!1,at(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var r,i,o,s,a,u,c,h;for(u=c=1/0,r=e;r<=n-e;r++)s=function(t,e){var n=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),i=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,i-n)*Math.max(0,o-r)}(i=ut(t,0,r,this.toBBox),o=ut(t,r,n,this.toBBox)),a=pt(i)+pt(o),s<u?(u=s,h=r,c=a<c?a:c):s===u&&a<c&&(c=a,h=r);return h},_chooseSplitAxis:function(t,e,n){var r=t.leaf?this.compareMinX:ht,i=t.leaf?this.compareMinY:lt;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,i)&&t.children.sort(r)},_allDistMargin:function(t,e,n,r){t.children.sort(r);var i,o,s=this.toBBox,a=ut(t,0,e,s),u=ut(t,n-e,n,s),c=ft(a)+ft(u);for(i=e;i<n-e;i++)o=t.children[i],ct(a,t.leaf?s(o):o),c+=ft(a);for(i=n-e-1;i>=e;i--)o=t.children[i],ct(u,t.leaf?s(o):o),c+=ft(u);return c},_adjustParentBBoxes:function(t,e,n){for(var r=n;r>=0;r--)ct(e[r],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():at(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};var Ho=function(t,e,n){var r=t*e,i=Wo*t,o=i-(i-t),s=t-o,a=Wo*e,u=a-(a-e),c=e-u,h=s*c-(r-o*u-s*u-o*c);return n?(n[0]=h,n[1]=r,n):[h,r]},Wo=+(Math.pow(2,27)+1),Jo=function(t,e){var n=0|t.length,r=0|e.length;if(1===n&&1===r)return function(t,e){var n=t+e,r=n-t,i=t-(n-r)+(e-r);return i?[i,n]:[n]}(t[0],e[0]);var i,o,s=n+r,a=new Array(s),u=0,c=0,h=0,l=Math.abs,p=t[c],f=l(p),g=e[h],d=l(g);f<d?(o=p,(c+=1)<n&&(f=l(p=t[c]))):(o=g,(h+=1)<r&&(d=l(g=e[h]))),c<n&&f<d||h>=r?(i=p,(c+=1)<n&&(f=l(p=t[c]))):(i=g,(h+=1)<r&&(d=l(g=e[h])));for(var y,_,m=i+o,v=m-i,x=o-v,E=x,w=m;c<n&&h<r;)f<d?(i=p,(c+=1)<n&&(f=l(p=t[c]))):(i=g,(h+=1)<r&&(d=l(g=e[h]))),(x=(o=E)-(v=(m=i+o)-i))&&(a[u++]=x),E=w-((y=w+m)-(_=y-w))+(m-_),w=y;for(;c<n;)(x=(o=E)-(v=(m=(i=p)+o)-i))&&(a[u++]=x),E=w-((y=w+m)-(_=y-w))+(m-_),w=y,(c+=1)<n&&(p=t[c]);for(;h<r;)(x=(o=E)-(v=(m=(i=g)+o)-i))&&(a[u++]=x),E=w-((y=w+m)-(_=y-w))+(m-_),w=y,(h+=1)<r&&(g=e[h]);return E&&(a[u++]=E),w&&(a[u++]=w),u||(a[u++]=0),a.length=u,a},Zo=function(t,e,n){var r=t+e,i=r-t,o=e-i,s=t-(r-i);return n?(n[0]=s+o,n[1]=r,n):[s+o,r]},Ko=function(t,e){var n=t.length;if(1===n){var r=Ho(t[0],e);return r[0]?r:[r[1]]}var i=new Array(2*n),o=[.1,.1],s=[.1,.1],a=0;Ho(t[0],e,o),o[0]&&(i[a++]=o[0]);for(var u=1;u<n;++u){Ho(t[u],e,s);var c=o[1];Zo(c,s[0],o),o[0]&&(i[a++]=o[0]);var h=s[1],l=o[1],p=h+l,f=l-(p-h);o[1]=p,f&&(i[a++]=f)}return o[1]&&(i[a++]=o[1]),0===a&&(i[a++]=0),i.length=a,i},Qo=function(t,e){var n=0|t.length,r=0|e.length;if(1===n&&1===r)return function(t,e){var n=t+e,r=n-t,i=t-(n-r)+(e-r);return i?[i,n]:[n]}(t[0],-e[0]);var i,o,s=n+r,a=new Array(s),u=0,c=0,h=0,l=Math.abs,p=t[c],f=l(p),g=-e[h],d=l(g);f<d?(o=p,(c+=1)<n&&(f=l(p=t[c]))):(o=g,(h+=1)<r&&(d=l(g=-e[h]))),c<n&&f<d||h>=r?(i=p,(c+=1)<n&&(f=l(p=t[c]))):(i=g,(h+=1)<r&&(d=l(g=-e[h])));for(var y,_,m=i+o,v=m-i,x=o-v,E=x,w=m;c<n&&h<r;)f<d?(i=p,(c+=1)<n&&(f=l(p=t[c]))):(i=g,(h+=1)<r&&(d=l(g=-e[h]))),(x=(o=E)-(v=(m=i+o)-i))&&(a[u++]=x),E=w-((y=w+m)-(_=y-w))+(m-_),w=y;for(;c<n;)(x=(o=E)-(v=(m=(i=p)+o)-i))&&(a[u++]=x),E=w-((y=w+m)-(_=y-w))+(m-_),w=y,(c+=1)<n&&(p=t[c]);for(;h<r;)(x=(o=E)-(v=(m=(i=g)+o)-i))&&(a[u++]=x),E=w-((y=w+m)-(_=y-w))+(m-_),w=y,(h+=1)<r&&(g=-e[h]);return E&&(a[u++]=E),w&&(a[u++]=w),u||(a[u++]=0),a.length=u,a},$o=mt(function(t){function e(t,e){for(var n=new Array(t.length-1),r=1;r<t.length;++r)for(var i=n[r-1]=new Array(t.length-1),o=0,s=0;o<t.length;++o)o!==e&&(i[s++]=t[r][o]);return n}function n(t){return 1&t?"-":""}function r(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",r(t.slice(0,e)),",",r(t.slice(e)),")"].join("")}function i(t){if(2===t.length)return[["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("")];for(var o=[],s=0;s<t.length;++s)o.push(["scale(",r(i(e(t,s))),",",n(s),t[0][s],")"].join(""));return o}function o(t){for(var n=[],o=[],s=function(t){for(var e=new Array(t),n=0;n<t;++n){e[n]=new Array(t);for(var r=0;r<t;++r)e[n][r]=["m",r,"[",t-n-1,"]"].join("")}return e}(t),a=[],u=0;u<t;++u)0==(1&u)?n.push.apply(n,i(e(s,u))):o.push.apply(o,i(e(s,u))),a.push("m"+u);var c=r(n),h=r(o),l="orientation"+t+"Exact",p=["function ",l,"(",a.join(),"){var p=",c,",n=",h,",d=sub(p,n);return d[d.length-1];};return ",l].join("");return new Function("sum","prod","scale","sub",p)(Jo,Ho,Ko,Qo)}var s=5,a=o(3),u=o(4),c=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,n){var r,i=(t[1]-n[1])*(e[0]-n[0]),o=(t[0]-n[0])*(e[1]-n[1]),s=i-o;if(i>0){if(o<=0)return s;r=i+o}else{if(!(i<0))return s;if(o>=0)return s;r=-(i+o)}var u=3.3306690738754716e-16*r;return s>=u||s<=-u?s:a(t,e,n)},function(t,e,n,r){var i=t[0]-r[0],o=e[0]-r[0],s=n[0]-r[0],a=t[1]-r[1],c=e[1]-r[1],h=n[1]-r[1],l=t[2]-r[2],p=e[2]-r[2],f=n[2]-r[2],g=o*h,d=s*c,y=s*a,_=i*h,m=i*c,v=o*a,x=l*(g-d)+p*(y-_)+f*(m-v),E=7.771561172376103e-16*((Math.abs(g)+Math.abs(d))*Math.abs(l)+(Math.abs(y)+Math.abs(_))*Math.abs(p)+(Math.abs(m)+Math.abs(v))*Math.abs(f));return x>E||-x>E?x:u(t,e,n,r)}];!function(){for(;c.length<=s;)c.push(o(c.length));for(var e=[],n=["slow"],r=0;r<=s;++r)e.push("a"+r),n.push("o"+r);var i=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(r=2;r<=s;++r)i.push("case ",r,":return o",r,"(",e.slice(0,r).join(),");");i.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),n.push(i.join(""));var a=Function.apply(void 0,n);for(t.exports=a.apply(void 0,[function(t){var e=c[t.length];return e||(e=c[t.length]=o(t.length)),e.apply(void 0,t)}].concat(c)),r=0;r<=s;++r)t.exports[r]=c[r]}()}),ts=function(t){var e=t.length;if(e<3){for(var n=new Array(e),r=0;r<e;++r)n[r]=r;return 2===e&&t[0][0]===t[1][0]&&t[0][1]===t[1][1]?[0]:n}var i=new Array(e);for(r=0;r<e;++r)i[r]=r;i.sort(function(e,n){var r=t[e][0]-t[n][0];return r||t[e][1]-t[n][1]});var o=[i[0],i[1]],s=[i[0],i[1]];for(r=2;r<e;++r){for(var a=i[r],u=t[a],c=o.length;c>1&&es(t[o[c-2]],t[o[c-1]],u)<=0;)c-=1,o.pop();for(o.push(a),c=s.length;c>1&&es(t[s[c-2]],t[s[c-1]],u)>=0;)c-=1,s.pop();s.push(a)}n=new Array(s.length+o.length-2);for(var h=0,l=(r=0,o.length);r<l;++r)n[h++]=o[r];for(var p=s.length-2;p>0;--p)n[h++]=s[p];return n},es=$o[3],ns=vt,rs=vt;vt.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,n=this.compare,r=e[t];t>0;){var i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r},_down:function(t){for(var e=this.data,n=this.compare,r=this.length>>1,i=e[t];t<r;){var o=1+(t<<1),s=o+1,a=e[o];if(s<this.length&&n(e[s],a)<0&&(o=s,a=e[s]),n(a,i)>=0)break;e[t]=a,t=o}e[t]=i}},ns.default=rs;var is=function(t,e){for(var n=t[0],r=t[1],i=!1,o=0,s=e.length-1;o<e.length;s=o++){var a=e[o][0],u=e[o][1],c=e[s][0],h=e[s][1];u>r!=h>r&&n<(c-a)*(r-u)/(h-u)+a&&(i=!i)}return i},os=$o[3],ss=xt,as=xt;ss.default=as;var us=function(t){return t},cs=function(t){if(null==t)return us;var e,n,r=t.scale[0],i=t.scale[1],o=t.translate[0],s=t.translate[1];return function(t,a){a||(e=n=0);var u=2,c=t.length,h=new Array(c);for(h[0]=(e+=t[0])*r+o,h[1]=(n+=t[1])*i+s;u<c;)h[u]=t[u],++u;return h}},hs=function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n},ls=function(t,e){function n(t,e){for(var n in t){var i=t[n];delete e[i.start],delete i.start,delete i.end,i.forEach(function(t){r[t<0?~t:t]=1}),s.push(i)}}var r={},i={},o={},s=[],a=-1;return e.forEach(function(n,r){var i,o=t.arcs[n<0?~n:n];o.length<3&&!o[1][0]&&!o[1][1]&&(i=e[++a],e[a]=n,e[r]=i)}),e.forEach(function(e){var n,r,s=function(e){var n,r=t.arcs[e<0?~e:e],i=r[0];return t.transform?(n=[0,0],r.forEach(function(t){n[0]+=t[0],n[1]+=t[1]})):n=r[r.length-1],e<0?[n,i]:[i,n]}(e),a=s[0],u=s[1];if(n=o[a])if(delete o[n.end],n.push(e),n.end=u,r=i[u]){delete i[r.start];var c=r===n?n:n.concat(r);i[c.start=n.start]=o[c.end=r.end]=c}else i[n.start]=o[n.end]=n;else if(n=i[u])if(delete i[n.start],n.unshift(e),n.start=a,r=o[a]){delete o[r.end];var h=r===n?n:r.concat(n);i[h.start=r.start]=o[h.end=n.end]=h}else i[n.start]=o[n.end]=n;else i[(n=[e]).start=a]=o[n.end=u]=n}),n(o,i),n(i,o),e.forEach(function(t){r[t<0?~t:t]||s.push([t])}),s},ps=function(t){return Xt(t,Ut.apply(this,arguments))},fs=function(t,e,n,r,i,o){3===arguments.length&&(r=o=Array,i=null);for(var s=new r(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),a=new o(t),u=t-1,c=0;c<t;++c)s[c]=i;return{set:function(r,o){for(var c=e(r)&u,h=s[c],l=0;h!=i;){if(n(h,r))return a[c]=o;if(++l>=t)throw new Error("full hashmap");h=s[c=c+1&u]}return s[c]=r,a[c]=o,o},maybeSet:function(r,o){for(var c=e(r)&u,h=s[c],l=0;h!=i;){if(n(h,r))return a[c];if(++l>=t)throw new Error("full hashmap");h=s[c=c+1&u]}return s[c]=r,a[c]=o,o},get:function(r,o){for(var c=e(r)&u,h=s[c],l=0;h!=i;){if(n(h,r))return a[c];if(++l>=t)break;h=s[c=c+1&u]}return o},keys:function(){for(var t=[],e=0,n=s.length;e<n;++e){var r=s[e];r!=i&&t.push(r)}return t}}},gs=function(t,e){return t[0]===e[0]&&t[1]===e[1]},ds=new ArrayBuffer(16),ys=new Float64Array(ds),_s=new Uint32Array(ds),ms=function(t){ys[0]=t[0],ys[1]=t[1];var e=_s[0]^_s[1];return 2147483647&(e=e<<5^e>>7^_s[2]^_s[3])},vs=function(t){function e(t,e,n,r){if(p[n]!==t){p[n]=t;var i=f[n];if(i>=0){var o=g[n];i===e&&o===r||i===r&&o===e||(++y,d[n]=1)}else f[n]=e,g[n]=r}}function n(t){return ms(u[t])}function r(t,e){return gs(u[t],u[e])}var i,o,s,a,u=t.coordinates,c=t.lines,h=t.rings,l=function(){for(var t=fs(1.4*u.length,n,r,Int32Array,-1,Int32Array),e=new Int32Array(u.length),i=0,o=u.length;i<o;++i)e[i]=t.maybeSet(i,i);return e}(),p=new Int32Array(u.length),f=new Int32Array(u.length),g=new Int32Array(u.length),d=new Int8Array(u.length),y=0;for(i=0,o=u.length;i<o;++i)p[i]=f[i]=g[i]=-1;for(i=0,o=c.length;i<o;++i){var _=c[i],m=_[0],v=_[1];for(s=l[m],a=l[++m],++y,d[s]=1;++m<=v;)e(i,s,s=a,a=l[m]);++y,d[a]=1}for(i=0,o=u.length;i<o;++i)p[i]=-1;for(i=0,o=h.length;i<o;++i){var x=h[i],E=x[0]+1,w=x[1];for(e(i,l[w-1],s=l[E-1],a=l[E]);++E<=w;)e(i,s,s=a,a=l[E])}p=f=g=null;var b,I=function(t,e,n,r,i){3===arguments.length&&(r=Array,i=null);for(var o=new r(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),s=t-1,a=0;a<t;++a)o[a]=i;return{add:function(r){for(var a=e(r)&s,u=o[a],c=0;u!=i;){if(n(u,r))return!0;if(++c>=t)throw new Error("full hashset");u=o[a=a+1&s]}return o[a]=r,!0},has:function(r){for(var a=e(r)&s,u=o[a],c=0;u!=i;){if(n(u,r))return!0;if(++c>=t)break;u=o[a=a+1&s]}return!1},values:function(){for(var t=[],e=0,n=o.length;e<n;++e){var r=o[e];r!=i&&t.push(r)}return t}}}(1.4*y,ms,gs);for(i=0,o=u.length;i<o;++i)d[b=l[i]]&&I.add(u[b]);return I},xs=function(t){var e,n,r,i=vs(t),o=t.coordinates,s=t.lines,a=t.rings;for(n=0,r=s.length;n<r;++n)for(var u=s[n],c=u[0],h=u[1];++c<h;)i.has(o[c])&&(e={0:c,1:u[1]},u[1]=c,u=u.next=e);for(n=0,r=a.length;n<r;++n)for(var l=a[n],p=l[0],f=p,g=l[1],d=i.has(o[p]);++f<g;)i.has(o[f])&&(d?(e={0:f,1:l[1]},l[1]=f,l=l.next=e):(!function(t,e,n,r){Yt(t,e,n),Yt(t,e,e+r),Yt(t,e+r,n)}(o,p,g,g-f),o[g]=o[p],d=!0,f=p));return t},Es=function(t){function e(t){var e,n,r,i,o,s,a,u;if(r=f.get(e=c[t[0]]))for(a=0,u=r.length;a<u;++a)if(i=r[a],function(t,e){var n=t[0],r=e[0],i=t[1],o=e[1];if(n-i!=r-o)return!1;for(;n<=i;++n,++r)if(!gs(c[n],c[r]))return!1;return!0}(i,t))return t[0]=i[0],void(t[1]=i[1]);if(o=f.get(n=c[t[1]]))for(a=0,u=o.length;a<u;++a)if(s=o[a],function(t,e){var n=t[0],r=e[0],i=t[1],o=e[1];if(n-i!=r-o)return!1;for(;n<=i;++n,--o)if(!gs(c[n],c[o]))return!1;return!0}(s,t))return t[1]=s[0],void(t[0]=s[1]);r?r.push(t):f.set(e,[t]),o?o.push(t):f.set(n,[t]),g.push(t)}function n(t,e){var n=t[0],r=e[0],o=t[1]-n;if(o!==e[1]-r)return!1;for(var s=i(t),a=i(e),u=0;u<o;++u)if(!gs(c[n+(u+s)%o],c[r+(u+a)%o]))return!1;return!0}function r(t,e){var n=t[0],r=e[0],o=t[1],s=e[1],a=o-n;if(a!==s-r)return!1;for(var u=i(t),h=a-i(e),l=0;l<a;++l)if(!gs(c[n+(l+u)%a],c[s-(l+h)%a]))return!1;return!0}function i(t){for(var e=t[0],n=t[1],r=e,i=r,o=c[r];++r<n;){var s=c[r];(s[0]<o[0]||s[0]===o[0]&&s[1]<o[1])&&(i=r,o=s)}return i-e}var o,s,a,u,c=t.coordinates,h=t.lines,l=t.rings,p=h.length+l.length;for(delete t.lines,delete t.rings,a=0,u=h.length;a<u;++a)for(o=h[a];o=o.next;)++p;for(a=0,u=l.length;a<u;++a)for(s=l[a];s=s.next;)++p;var f=fs(2*p*1.4,ms,gs),g=t.arcs=[];for(a=0,u=h.length;a<u;++a){o=h[a];do{e(o)}while(o=o.next)}for(a=0,u=l.length;a<u;++a)if((s=l[a]).next)do{e(s)}while(s=s.next);else!function(t){var e,o,s,a,u;if(o=f.get(e=c[t[0]]))for(a=0,u=o.length;a<u;++a){if(s=o[a],n(s,t))return t[0]=s[0],void(t[1]=s[1]);if(r(s,t))return t[0]=s[1],void(t[1]=s[0])}if(o=f.get(e=c[t[0]+i(t)]))for(a=0,u=o.length;a<u;++a){if(s=o[a],n(s,t))return t[0]=s[0],void(t[1]=s[1]);if(r(s,t))return t[0]=s[1],void(t[1]=s[0])}o?o.push(t):f.set(e,[t]),g.push(t)}(s);return t},ws=function(t,e){function n(t){t&&h.hasOwnProperty(t.type)&&h[t.type](t)}function r(t){var e=[];do{var n=c.get(t);e.push(t[0]<t[1]?n:~n)}while(t=t.next);return e}function i(t){return t.map(r)}var o=function(t){function e(t){null!=t&&c.hasOwnProperty(t.type)&&c[t.type](t)}function n(t){var e=t[0],n=t[1];e<o&&(o=e),e>a&&(a=e),n<s&&(s=n),n>u&&(u=n)}function r(t){t.forEach(n)}function i(t){t.forEach(r)}var o=1/0,s=1/0,a=-1/0,u=-1/0,c={GeometryCollection:function(t){t.geometries.forEach(e)},Point:function(t){n(t.coordinates)},MultiPoint:function(t){t.coordinates.forEach(n)},LineString:function(t){r(t.arcs)},MultiLineString:function(t){t.arcs.forEach(r)},Polygon:function(t){t.arcs.forEach(r)},MultiPolygon:function(t){t.arcs.forEach(i)}};for(var h in t)e(t[h]);return a>=o&&u>=s?[o,s,a,u]:void 0}(t=function(t){var e,n={};for(e in t)n[e]=Vt(t[e]);return n}(t)),s=e>0&&o&&function(t,e,n){function r(t){return[Math.round((t[0]-c)*f),Math.round((t[1]-h)*g)]}function i(t,e){for(var n,r,i,o,s,a=-1,u=0,l=t.length,p=new Array(l);++a<l;)n=t[a],o=Math.round((n[0]-c)*f),s=Math.round((n[1]-h)*g),o===r&&s===i||(p[u++]=[r=o,i=s]);for(p.length=u;u<e;)u=p.push([p[0][0],p[0][1]]);return p}function o(t){return i(t,2)}function s(t){return i(t,4)}function a(t){return t.map(s)}function u(t){null!=t&&d.hasOwnProperty(t.type)&&d[t.type](t)}var c=e[0],h=e[1],l=e[2],p=e[3],f=l-c?(n-1)/(l-c):1,g=p-h?(n-1)/(p-h):1,d={GeometryCollection:function(t){t.geometries.forEach(u)},Point:function(t){t.coordinates=r(t.coordinates)},MultiPoint:function(t){t.coordinates=t.coordinates.map(r)},LineString:function(t){t.arcs=o(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(o)},Polygon:function(t){t.arcs=a(t.arcs)},MultiPolygon:function(t){t.arcs=t.arcs.map(a)}};for(var y in t)u(t[y]);return{scale:[1/f,1/g],translate:[c,h]}}(t,o,e),a=Es(xs(function(t){function e(t){t&&c.hasOwnProperty(t.type)&&c[t.type](t)}function n(t){for(var e=0,n=t.length;e<n;++e)u[++o]=t[e];var r={0:o-n+1,1:o};return s.push(r),r}function r(t){for(var e=0,n=t.length;e<n;++e)u[++o]=t[e];var r={0:o-n+1,1:o};return a.push(r),r}function i(t){return t.map(r)}var o=-1,s=[],a=[],u=[],c={GeometryCollection:function(t){t.geometries.forEach(e)},LineString:function(t){t.arcs=n(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(n)},Polygon:function(t){t.arcs=t.arcs.map(r)},MultiPolygon:function(t){t.arcs=t.arcs.map(i)}};for(var h in t)e(t[h]);return{type:"Topology",coordinates:u,lines:s,rings:a,objects:t}}(t))),u=a.coordinates,c=fs(1.4*a.arcs.length,Jt,Zt);t=a.objects,a.bbox=o,a.arcs=a.arcs.map(function(t,e){return c.set(t,e),u.slice(t[0],t[1]+1)}),delete a.coordinates,u=null;var h={GeometryCollection:function(t){t.geometries.forEach(n)},LineString:function(t){t.arcs=r(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(r)},Polygon:function(t){t.arcs=t.arcs.map(r)},MultiPolygon:function(t){t.arcs=t.arcs.map(i)}};for(var l in t)n(t[l]);return s&&(a.transform=s,a.arcs=function(t){for(var e=-1,n=t.length;++e<n;){for(var r,i,o=t[e],s=0,a=1,u=o.length,c=o[0],h=c[0],l=c[1];++s<u;)r=(c=o[s])[0],i=c[1],r===h&&i===l||(o[a++]=[r-h,i-l],h=r,l=i);1===a&&(o[a++]=[0,0]),o.length=a}return t}(a.arcs)),a},bs=function(t){this.points=t.points||[],this.duration=t.duration||1e4,this.sharpness=t.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=t.stepLength||60,this.length=this.points.length,this.delay=0;for(var e=0;e<this.length;e++)this.points[e].z=this.points[e].z||0;for(e=0;e<this.length-1;e++){var n=this.points[e],r=this.points[e+1];this.centers.push({x:(n.x+r.x)/2,y:(n.y+r.y)/2,z:(n.z+r.z)/2})}this.controls.push([this.points[0],this.points[0]]);for(e=0;e<this.centers.length-1;e++){n=this.centers[e],r=this.centers[e+1];var i=this.points[e+1].x-(this.centers[e].x+this.centers[e+1].x)/2,o=this.points[e+1].y-(this.centers[e].y+this.centers[e+1].y)/2,s=this.points[e+1].z-(this.centers[e].y+this.centers[e+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e].z+s)},{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e+1].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e+1].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e+1].z+s)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this};bs.prototype.cacheSteps=function(t){var e=[],n=this.pos(0);e.push(0);for(var r=0;r<this.duration;r+=10){var i=this.pos(r);Math.sqrt((i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y)+(i.z-n.z)*(i.z-n.z))>t&&(e.push(r),n=i)}return e},bs.prototype.vector=function(t){var e=this.pos(t+10),n=this.pos(t-10);return{angle:180*Math.atan2(e.y-n.y,e.x-n.x)/3.14,speed:Math.sqrt((n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y)+(n.z-e.z)*(n.z-e.z))}},bs.prototype.pos=function(t){var e=t-this.delay;e<0&&(e=0),e>this.duration&&(e=this.duration-1);var n=e/this.duration;if(n>=1)return this.points[this.length-1];var r=Math.floor((this.points.length-1)*n);return function(t,e,n,r,i){var o=function(t){var e=t*t;return[e*t,3*e*(1-t),3*t*(1-t)*(1-t),(1-t)*(1-t)*(1-t)]}(t);return{x:i.x*o[0]+r.x*o[1]+n.x*o[2]+e.x*o[3],y:i.y*o[0]+r.y*o[1]+n.y*o[2]+e.y*o[3],z:i.z*o[0]+r.z*o[1]+n.z*o[2]+e.z*o[3]}}((this.length-1)*n-r,this.points[r],this.controls[r][1],this.controls[r+1][0],this.points[r+1])};var Is=ve,Ns=ve;ve.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,s=Math.abs(Ae(t,0,o,n));if(i)for(var a=0,u=e.length;a<u;a++){var c=e[a]*n,h=a<u-1?e[a+1]*n:t.length;s-=Math.abs(Ae(t,c,h,n))}var l=0;for(a=0;a<r.length;a+=3){var p=r[a]*n,f=r[a+1]*n,g=r[a+2]*n;l+=Math.abs((t[p]-t[g])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[g+1]-t[p+1]))}return 0===s&&0===l?0:Math.abs((l-s)/s)},ve.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[i][o][s]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n},Is.default=Ns,ke.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],r=this.toBBox;if(!Je(t,e))return n;for(var i,o,s,a,u=[];e;){for(i=0,o=e.children.length;i<o;i++)s=e.children[i],Je(t,a=e.leaf?r(s):s)&&(e.leaf?n.push(s):We(t,a)?this._all(s,n):u.push(s));e=u.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!Je(t,e))return!1;for(var r,i,o,s,a=[];e;){for(r=0,i=e.children.length;r<i;r++)if(o=e.children[r],s=e.leaf?n(o):o,Je(t,s)){if(e.leaf||We(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=Ze([]),this},remove:function(t,e){if(!t)return this;for(var n,r,i,o,s=this.data,a=this.toBBox(t),u=[],c=[];s||u.length;){if(s||(s=u.pop(),r=u[u.length-1],n=c.pop(),o=!0),s.leaf&&-1!==(i=function(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}(t,s.children,e)))return s.children.splice(i,1),u.push(s),this._condense(u),this;o||s.leaf||!We(s,a)?r?(n++,s=r.children[n],o=!1):s=null:(u.push(s),c.push(n),n=0,r=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:Ue,compareMinY:Ye,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,r){var i,o=n-e+1,s=this._maxEntries;if(o<=s)return i=Ze(t.slice(e,n+1)),ze(i,this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),(i=Ze([])).leaf=!1,i.height=r;var a,u,c,h,l=Math.ceil(o/s),p=l*Math.ceil(Math.sqrt(s));for(Ke(t,e,n,p,this.compareMinX),a=e;a<=n;a+=p)for(Ke(t,a,c=Math.min(a+p-1,n),l,this.compareMinY),u=a;u<=c;u+=l)h=Math.min(u+l-1,c),i.children.push(this._build(t,u,h,r-1));return ze(i,this.toBBox),i},_chooseSubtree:function(t,e,n,r){for(var i,o,s,a,u,c,h,l;r.push(e),!e.leaf&&r.length-1!==n;){for(h=l=1/0,i=0,o=e.children.length;i<o;i++)u=Ve(s=e.children[i]),(c=function(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}(t,s)-u)<l?(l=c,h=u<h?u:h,a=s):c===l&&u<h&&(h=u,a=s);e=a||e.children[0]}return e},_insert:function(t,e,n){var r=this.toBBox,i=n?t:r(t),o=[],s=this._chooseSubtree(i,this.data,e,o);for(s.children.push(t),Xe(s,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),s=Ze(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,ze(n,this.toBBox),ze(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,e){this.data=Ze([t,e]),this.data.height=t.height+1,this.data.leaf=!1,ze(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var r,i,o,s,a,u,c,h;for(u=c=1/0,r=e;r<=n-e;r++)s=function(t,e){var n=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),i=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,i-n)*Math.max(0,o-r)}(i=je(t,0,r,this.toBBox),o=je(t,r,n,this.toBBox)),a=Ve(i)+Ve(o),s<u?(u=s,h=r,c=a<c?a:c):s===u&&a<c&&(c=a,h=r);return h},_chooseSplitAxis:function(t,e,n){var r=t.leaf?this.compareMinX:Ue,i=t.leaf?this.compareMinY:Ye;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,i)&&t.children.sort(r)},_allDistMargin:function(t,e,n,r){t.children.sort(r);var i,o,s=this.toBBox,a=je(t,0,e,s),u=je(t,n-e,n,s),c=He(a)+He(u);for(i=e;i<n-e;i++)o=t.children[i],Xe(a,t.leaf?s(o):o),c+=He(a);for(i=n-e-1;i>=e;i--)o=t.children[i],Xe(u,t.leaf?s(o):o),c+=He(u);return c},_adjustParentBBoxes:function(t,e,n){for(var r=n;r>=0;r--)Xe(e[r],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():ze(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};var Cs=Object.freeze({toMercator:cn,toWgs84:hn}),Ss=6378137,Ms=function(t,e,n){function r(t,n,r,i){var u=o[t][n],c=o[t][n+1],h=o[r][i],l=o[r][i+1],p=function(t,e,n,r){if(On(t,n)||On(t,r)||On(e,n)||On(r,n))return null;var i=t[0],o=t[1],s=e[0],a=e[1],u=n[0],c=n[1],h=r[0],l=r[1],p=(i-s)*(c-l)-(o-a)*(u-h);return 0===p?null:[((i*a-o*s)*(u-h)-(i-s)*(u*l-c*h))/p,((i*a-o*s)*(c-l)-(o-a)*(u*l-c*h))/p]}(u,c,h,l);if(null!==p){var f,g;if(f=c[0]!==u[0]?(p[0]-u[0])/(c[0]-u[0]):(p[1]-u[1])/(c[1]-u[1]),g=l[0]!==h[0]?(p[0]-h[0])/(l[0]-h[0]):(p[1]-h[1])/(l[1]-h[1]),!(f>=1||f<=0||g>=1||g<=0)){var d=p,y=!a[d];y&&(a[d]=!0),e?s.push(e(p,t,n,u,c,f,r,i,h,l,g,y)):s.push(p)}}}function i(t,e){var n,r,i,s,a=o[t][e],u=o[t][e+1];return a[0]<u[0]?(n=a[0],r=u[0]):(n=u[0],r=a[0]),a[1]<u[1]?(i=a[1],s=u[1]):(i=u[1],s=a[1]),{minX:n,minY:i,maxX:r,maxY:s,ring:t,edge:e}}if("Polygon"!==t.geometry.type)throw new Error("The input feature must be a Polygon");void 0===n&&(n=1);var o=t.geometry.coordinates,s=[],a={};if(n){for(var u=[],c=0;c<o.length;c++)for(var h=0;h<o[c].length-1;h++)u.push(i(c,h));var l=Vo();l.load(u)}for(var p=0;p<o.length;p++)for(var f=0;f<o[p].length-1;f++)if(n){l.search(i(p,f)).forEach(function(t){var e=t.ring,n=t.edge;r(p,f,e,n)})}else for(var g=0;g<o.length;g++)for(var d=0;d<o[g].length-1;d++)r(p,f,g,d);return e||(s={type:"Feature",geometry:{type:"MultiPoint",coordinates:s}}),s},Ls=function(t){function e(){for(var t=[],e=0;e<g.features.length;e++)-1==g.features[e].properties.parent&&t.push(e);if(t.length>1)for(e=0;e<t.length;e++){for(var n=-1,r=0;r<g.features.length;r++)t[e]!=r&&Pt(g.features[t[e]].geometry.coordinates[0][0],g.features[r],{ignoreBoundary:!0})&&mn(g.features[r])<1/0&&(n=r);g.features[t[e]].properties.parent=n}}function n(){for(var t=0;t<g.features.length;t++)if(-1==g.features[t].properties.parent){var e=g.features[t].properties.winding;g.features[t].properties.netWinding=e,r(t,e)}}function r(t,e){for(var n=0;n<g.features.length;n++)if(g.features[n].properties.parent==t){var i=e+g.features[n].properties.winding;g.features[n].properties.netWinding=i,r(n,i)}}if("Feature"!=t.type)throw new Error("The input must a geojson object of type Feature");if(void 0===t.geometry||null==t.geometry)throw new Error("The input must a geojson object with a non-empty geometry");if("Polygon"!=t.geometry.type)throw new Error("The input must be a geojson Polygon");for(var i=t.geometry.coordinates.length,s=[],a=0;a<i;a++){var u=t.geometry.coordinates[a];Tn(u[0],u[u.length-1])||u.push(u[0]),s.push.apply(s,u.slice(0,u.length-1))}if(!function(t){for(var e={},n=1,r=0,i=t.length;r<i;++r){if(e.hasOwnProperty(t[r])){n=0;break}e[t[r]]=1}return n}(s))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var h=s.length,l=Ms(t,function(t,e,n,r,i,o,s,a,u,c,h,l){return[t,e,n,r,i,o,s,a,u,c,h,l]}),p=l.length;if(0==p){var f=[];for(a=0;a<i;a++)f.push(o([t.geometry.coordinates[a]],{parent:-1,winding:function(t){for(var e=0,n=0;n<t.length-1;n++)t[n][0]<t[e][0]&&(e=n);if(Rn([t[(e-1).modulo(t.length-1)],t[e],t[(e+1).modulo(t.length-1)]],!0))var r=1;else r=-1;return r}(t.geometry.coordinates[a])}));var g=c(f);return e(),n(),g}var d=[],y=[];for(a=0;a<i;a++){d.push([]);for(var _=0;_<t.geometry.coordinates[a].length-1;_++)d[a].push([new Ps(t.geometry.coordinates[a][(_+1).modulo(t.geometry.coordinates[a].length-1)],1,[a,_],[a,(_+1).modulo(t.geometry.coordinates[a].length-1)],void 0)]),y.push(new Os(t.geometry.coordinates[a][_],[a,(_-1).modulo(t.geometry.coordinates[a].length-1)],[a,_],void 0,void 0,!1,!0))}for(a=0;a<p;a++)d[l[a][1]][l[a][2]].push(new Ps(l[a][0],l[a][5],[l[a][1],l[a][2]],[l[a][6],l[a][7]],void 0)),l[a][11]&&y.push(new Os(l[a][0],[l[a][1],l[a][2]],[l[a][6],l[a][7]],void 0,void 0,!0,!0));var m=y.length;for(a=0;a<d.length;a++)for(_=0;_<d[a].length;_++)d[a][_].sort(function(t,e){return t.param<e.param?-1:1});var v=[];for(a=0;a<m;a++)v.push({minX:y[a].coord[0],minY:y[a].coord[1],maxX:y[a].coord[0],maxY:y[a].coord[1],index:a});var x=Vo();x.load(v);for(a=0;a<d.length;a++)for(_=0;_<d[a].length;_++)for(var E=0;E<d[a][_].length;E++){b=E==d[a][_].length-1?d[a][(_+1).modulo(t.geometry.coordinates[a].length-1)][0].coord:d[a][_][E+1].coord;var w=x.search({minX:b[0],minY:b[1],maxX:b[0],maxY:b[1]})[0];d[a][_][E].nxtIsectAlongEdgeIn=w.index}for(a=0;a<d.length;a++)for(_=0;_<d[a].length;_++)for(E=0;E<d[a][_].length;E++){var b=d[a][_][E].coord,I=(w=x.search({minX:b[0],minY:b[1],maxX:b[0],maxY:b[1]})[0]).index;I<h?y[I].nxtIsectAlongRingAndEdge2=d[a][_][E].nxtIsectAlongEdgeIn:Tn(y[I].ringAndEdge1,d[a][_][E].ringAndEdgeIn)?y[I].nxtIsectAlongRingAndEdge1=d[a][_][E].nxtIsectAlongEdgeIn:y[I].nxtIsectAlongRingAndEdge2=d[a][_][E].nxtIsectAlongEdgeIn}var N=[];for(a=0,_=0;_<i;_++){var C=a;for(E=0;E<t.geometry.coordinates[_].length-1;E++)y[a].coord[0]<y[C].coord[0]&&(C=a),a++;var S=y[C].nxtIsectAlongRingAndEdge2;for(E=0;E<y.length;E++)if(y[E].nxtIsectAlongRingAndEdge1==C||y[E].nxtIsectAlongRingAndEdge2==C){var M=E;break}var L=Rn([y[M].coord,y[C].coord,y[S].coord],!0)?1:-1;N.push({isect:C,parent:-1,winding:L})}N.sort(function(t,e){return y[t.isect].coord>y[e.isect].coord?-1:1});for(f=[];N.length>0;){var P=N.pop(),O=P.isect,R=P.parent,T=P.winding,A=f.length,D=[y[O].coord],F=O;if(y[O].ringAndEdge1Walkable)var q=y[O].ringAndEdge1,G=y[O].nxtIsectAlongRingAndEdge1;else q=y[O].ringAndEdge2,G=y[O].nxtIsectAlongRingAndEdge2;for(;!Tn(y[O].coord,y[G].coord);){D.push(y[G].coord);var B=void 0;for(a=0;a<N.length;a++)if(N[a].isect==G){B=a;break}if(void 0!=B&&N.splice(B,1),Tn(q,y[G].ringAndEdge1)){if(q=y[G].ringAndEdge2,y[G].ringAndEdge2Walkable=!1,y[G].ringAndEdge1Walkable){var k={isect:G};Rn([y[F].coord,y[G].coord,y[y[G].nxtIsectAlongRingAndEdge2].coord],1==T)?(k.parent=R,k.winding=-T):(k.parent=A,k.winding=T),N.push(k)}F=G,G=y[G].nxtIsectAlongRingAndEdge2}else{if(q=y[G].ringAndEdge1,y[G].ringAndEdge1Walkable=!1,y[G].ringAndEdge2Walkable){k={isect:G};Rn([y[F].coord,y[G].coord,y[y[G].nxtIsectAlongRingAndEdge1].coord],1==T)?(k.parent=R,k.winding=-T):(k.parent=A,k.winding=T),N.push(k)}F=G,G=y[G].nxtIsectAlongRingAndEdge1}}D.push(y[G].coord),f.push(o([D],{index:A,parent:R,winding:T,netWinding:void 0}))}g=c(f);return e(),n(),g},Ps=function(t,e,n,r,i){this.coord=t,this.param=e,this.ringAndEdgeIn=n,this.ringAndEdgeOut=r,this.nxtIsectAlongEdgeIn=i},Os=function(t,e,n,r,i,o,s){this.coord=t,this.ringAndEdge1=e,this.ringAndEdge2=n,this.nxtIsectAlongRingAndEdge1=r,this.nxtIsectAlongRingAndEdge2=i,this.ringAndEdge1Walkable=o,this.ringAndEdge2Walkable=s};Number.prototype.modulo=function(t){return(this%t+t)%t};var Rs=Math.PI/180,Ts=180/Math.PI,As=function(t,e){this.lon=t,this.lat=e,this.x=Rs*t,this.y=Rs*e};As.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},As.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:-1*(180-this.lon);return new As(e,t)};var Ds=function(){this.coords=[],this.length=0};Ds.prototype.move_to=function(t){this.length++,this.coords.push(t)};var Fs=function(t){this.properties=t||{},this.geometries=[]};Fs.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},Fs.prototype.wkt=function(){for(var t="",e="LINESTRING(",n=function(t){e+=t[0]+" "+t[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(n),t+=e.substring(0,e.length-1)+")"}return t};var qs=function(t,e,n){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new As(t.x,t.y),this.end=new As(e.x,e.y),this.properties=n||{};var r=this.start.x-this.end.x,i=this.start.y-this.end.y,o=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g===Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};qs.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),n=Math.sin(t*this.g)/Math.sin(this.g),r=e*Math.cos(this.start.y)*Math.cos(this.start.x)+n*Math.cos(this.end.y)*Math.cos(this.end.x),i=e*Math.cos(this.start.y)*Math.sin(this.start.x)+n*Math.cos(this.end.y)*Math.sin(this.end.x),o=e*Math.sin(this.start.y)+n*Math.sin(this.end.y),s=Ts*Math.atan2(o,Math.sqrt(Math.pow(r,2)+Math.pow(i,2)));return[Ts*Math.atan2(i,r),s]},qs.prototype.Arc=function(t,e){var n=[];if(!t||t<=2)n.push([this.start.lon,this.start.lat]),n.push([this.end.lon,this.end.lat]);else for(var r=1/(t-1),i=0;i<t;++i){var o=r*i,s=this.interpolate(o);n.push(s)}for(var a=!1,u=0,c=e&&e.offset?e.offset:10,h=180-c,l=-180+c,p=360-c,f=1;f<n.length;++f){var g=n[f-1][0],d=n[f][0],y=Math.abs(d-g);y>p&&(d>h&&g<l||g>h&&d<l)?a=!0:y>u&&(u=y)}var _=[];if(a&&u<c){var m=[];_.push(m);for(var v=0;v<n.length;++v){var x=parseFloat(n[v][0]);if(v>0&&Math.abs(x-n[v-1][0])>p){var E=parseFloat(n[v-1][0]),w=parseFloat(n[v-1][1]),b=parseFloat(n[v][0]),I=parseFloat(n[v][1]);if(E>-180&&E<l&&180===b&&v+1<n.length&&n[v-1][0]>-180&&n[v-1][0]<l){m.push([-180,n[v][1]]),v++,m.push([n[v][0],n[v][1]]);continue}if(E>h&&E<180&&-180===b&&v+1<n.length&&n[v-1][0]>h&&n[v-1][0]<180){m.push([180,n[v][1]]),v++,m.push([n[v][0],n[v][1]]);continue}if(E<l&&b>h){var N=E;E=b,b=N;var C=w;w=I,I=C}if(E>h&&b<l&&(b+=360),E<=180&&b>=180&&E<b){var S=(180-E)/(b-E),M=S*I+(1-S)*w;m.push([n[v-1][0]>h?180:-180,M]),(m=[]).push([n[v-1][0]>h?-180:180,M]),_.push(m)}else m=[],_.push(m);m.push([x,n[v][1]])}else m.push([n[v][0],n[v][1]])}}else{var L=[];_.push(L);for(var P=0;P<n.length;++P)L.push([n[P][0],n[P][1]])}for(var O=new Fs(this.properties),R=0;R<_.length;++R){var T=new Ds;O.geometries.push(T);for(var A=_[R],D=0;D<A.length;++D)T.move_to(A[D])}return O};var Gs=Yn;Yn.polyline=Yn,Yn.polygon=function(t,e){var n,r,i,o,s,a,u;for(r=1;r<=8;r*=2){for(n=[],o=!(Hn(i=t[t.length-1],e)&r),s=0;s<t.length;s++)(u=!(Hn(a=t[s],e)&r))!==o&&n.push(Vn(i,a,r,e)),u&&n.push(a),i=a,o=u;if(!(t=n).length)break}return n};var Bs=Array.prototype.slice,ks={successCallback:null,verbose:!1,polygons:!1},zs={},js=64,Xs=16,Us=4,Ys=1,Vs=[],Hs=[],Ws=[],Js=[],Zs=[],Ks=[],Qs=[],$s=[],ta=[],ea=[],na=[],ra=[],ia=[],oa=[],sa=[],aa=[],ua=[],ca=[],ha=[],la=[],pa=[],fa=[],ga=[],da=[];Qs[85]=ea[85]=-1,$s[85]=na[85]=0,ta[85]=ra[85]=1,ha[85]=fa[85]=1,la[85]=ga[85]=0,pa[85]=da[85]=1,Vs[85]=Js[85]=0,Hs[85]=Zs[85]=-1,Ws[85]=sa[85]=0,aa[85]=ia[85]=0,ua[85]=oa[85]=1,Ks[85]=ca[85]=1,fa[1]=fa[169]=0,ga[1]=ga[169]=-1,da[1]=da[169]=0,ia[1]=ia[169]=-1,oa[1]=oa[169]=0,sa[1]=sa[169]=0,ea[4]=ea[166]=0,na[4]=na[166]=-1,ra[4]=ra[166]=1,aa[4]=aa[166]=1,ua[4]=ua[166]=0,ca[4]=ca[166]=0,Qs[16]=Qs[154]=0,$s[16]=$s[154]=1,ta[16]=ta[154]=1,Js[16]=Js[154]=1,Zs[16]=Zs[154]=0,Ks[16]=Ks[154]=1,ha[64]=ha[106]=0,la[64]=la[106]=1,pa[64]=pa[106]=0,Vs[64]=Vs[106]=-1,Hs[64]=Hs[106]=0,Ws[64]=Ws[106]=1,ha[2]=ha[168]=0,la[2]=la[168]=-1,pa[2]=pa[168]=1,fa[2]=fa[168]=0,ga[2]=ga[168]=-1,da[2]=da[168]=0,ia[2]=ia[168]=-1,oa[2]=oa[168]=0,sa[2]=sa[168]=0,aa[2]=aa[168]=-1,ua[2]=ua[168]=0,ca[2]=ca[168]=1,Qs[8]=Qs[162]=0,$s[8]=$s[162]=-1,ta[8]=ta[162]=0,ea[8]=ea[162]=0,na[8]=na[162]=-1,ra[8]=ra[162]=1,ia[8]=ia[162]=1,oa[8]=oa[162]=0,sa[8]=sa[162]=1,aa[8]=aa[162]=1,ua[8]=ua[162]=0,ca[8]=ca[162]=0,Qs[32]=Qs[138]=0,$s[32]=$s[138]=1,ta[32]=ta[138]=1,ea[32]=ea[138]=0,na[32]=na[138]=1,ra[32]=ra[138]=0,Vs[32]=Vs[138]=1,Hs[32]=Hs[138]=0,Ws[32]=Ws[138]=0,Js[32]=Js[138]=1,Zs[32]=Zs[138]=0,Ks[32]=Ks[138]=1,fa[128]=fa[42]=0,ga[128]=ga[42]=1,da[128]=da[42]=1,ha[128]=ha[42]=0,la[128]=la[42]=1,pa[128]=pa[42]=0,Vs[128]=Vs[42]=-1,Hs[128]=Hs[42]=0,Ws[128]=Ws[42]=1,Js[128]=Js[42]=-1,Zs[128]=Zs[42]=0,Ks[128]=Ks[42]=0,ea[5]=ea[165]=-1,na[5]=na[165]=0,ra[5]=ra[165]=0,fa[5]=fa[165]=1,ga[5]=ga[165]=0,da[5]=da[165]=0,aa[20]=aa[150]=0,ua[20]=ua[150]=1,ca[20]=ca[150]=1,Js[20]=Js[150]=0,Zs[20]=Zs[150]=-1,Ks[20]=Ks[150]=1,Qs[80]=Qs[90]=-1,$s[80]=$s[90]=0,ta[80]=ta[90]=1,ha[80]=ha[90]=1,la[80]=la[90]=0,pa[80]=pa[90]=1,ia[65]=ia[105]=0,oa[65]=oa[105]=1,sa[65]=sa[105]=0,Vs[65]=Vs[105]=0,Hs[65]=Hs[105]=-1,Ws[65]=Ws[105]=0,Qs[160]=Qs[10]=-1,$s[160]=$s[10]=0,ta[160]=ta[10]=1,ea[160]=ea[10]=-1,na[160]=na[10]=0,ra[160]=ra[10]=0,fa[160]=fa[10]=1,ga[160]=ga[10]=0,da[160]=da[10]=0,ha[160]=ha[10]=1,la[160]=la[10]=0,pa[160]=pa[10]=1,aa[130]=aa[40]=0,ua[130]=ua[40]=1,ca[130]=ca[40]=1,ia[130]=ia[40]=0,oa[130]=oa[40]=1,sa[130]=sa[40]=0,Vs[130]=Vs[40]=0,Hs[130]=Hs[40]=-1,Ws[130]=Ws[40]=0,Js[130]=Js[40]=0,Zs[130]=Zs[40]=-1,Ks[130]=Ks[40]=1,ea[37]=ea[133]=0,na[37]=na[133]=1,ra[37]=ra[133]=1,fa[37]=fa[133]=0,ga[37]=ga[133]=1,da[37]=da[133]=0,Vs[37]=Vs[133]=-1,Hs[37]=Hs[133]=0,Ws[37]=Ws[133]=0,Js[37]=Js[133]=1,Zs[37]=Zs[133]=0,Ks[37]=Ks[133]=0,aa[148]=aa[22]=-1,ua[148]=ua[22]=0,ca[148]=ca[22]=0,fa[148]=fa[22]=0,ga[148]=ga[22]=-1,da[148]=da[22]=1,ha[148]=ha[22]=0,la[148]=la[22]=1,pa[148]=pa[22]=1,Js[148]=Js[22]=-1,Zs[148]=Zs[22]=0,Ks[148]=Ks[22]=1,Qs[82]=Qs[88]=0,$s[82]=$s[88]=-1,ta[82]=ta[88]=1,aa[82]=aa[88]=1,ua[82]=ua[88]=0,ca[82]=ca[88]=1,ia[82]=ia[88]=-1,oa[82]=oa[88]=0,sa[82]=sa[88]=1,ha[82]=ha[88]=0,la[82]=la[88]=-1,pa[82]=pa[88]=0,Qs[73]=Qs[97]=0,$s[73]=$s[97]=1,ta[73]=ta[97]=0,ea[73]=ea[97]=0,na[73]=na[97]=-1,ra[73]=ra[97]=0,ia[73]=ia[97]=1,oa[73]=oa[97]=0,sa[73]=sa[97]=0,Vs[73]=Vs[97]=1,Hs[73]=Hs[97]=0,Ws[73]=Ws[97]=1,Qs[145]=Qs[25]=0,$s[145]=$s[25]=-1,ta[145]=ta[25]=0,ia[145]=ia[25]=1,oa[145]=oa[25]=0,sa[145]=sa[25]=1,fa[145]=fa[25]=0,ga[145]=ga[25]=1,da[145]=da[25]=1,Js[145]=Js[25]=-1,Zs[145]=Zs[25]=0,Ks[145]=Ks[25]=0,ea[70]=ea[100]=0,na[70]=na[100]=1,ra[70]=ra[100]=0,aa[70]=aa[100]=-1,ua[70]=ua[100]=0,ca[70]=ca[100]=1,ha[70]=ha[100]=0,la[70]=la[100]=-1,pa[70]=pa[100]=1,Vs[70]=Vs[100]=1,Hs[70]=Hs[100]=0,Ws[70]=Ws[100]=0,ea[101]=ea[69]=0,na[101]=na[69]=1,ra[101]=ra[69]=0,Vs[101]=Vs[69]=1,Hs[101]=Hs[69]=0,Ws[101]=Ws[69]=0,fa[149]=fa[21]=0,ga[149]=ga[21]=1,da[149]=da[21]=1,Js[149]=Js[21]=-1,Zs[149]=Zs[21]=0,Ks[149]=Ks[21]=0,aa[86]=aa[84]=-1,ua[86]=ua[84]=0,ca[86]=ca[84]=1,ha[86]=ha[84]=0,la[86]=la[84]=-1,pa[86]=pa[84]=1,Qs[89]=Qs[81]=0,$s[89]=$s[81]=-1,ta[89]=ta[81]=0,ia[89]=ia[81]=1,oa[89]=oa[81]=0,sa[89]=sa[81]=1,Qs[96]=Qs[74]=0,$s[96]=$s[74]=1,ta[96]=ta[74]=0,ea[96]=ea[74]=-1,na[96]=na[74]=0,ra[96]=ra[74]=1,ha[96]=ha[74]=1,la[96]=la[74]=0,pa[96]=pa[74]=0,Vs[96]=Vs[74]=1,Hs[96]=Hs[74]=0,Ws[96]=Ws[74]=1,Qs[24]=Qs[146]=0,$s[24]=$s[146]=-1,ta[24]=ta[146]=1,aa[24]=aa[146]=1,ua[24]=ua[146]=0,ca[24]=ca[146]=1,ia[24]=ia[146]=0,oa[24]=oa[146]=1,sa[24]=sa[146]=1,Js[24]=Js[146]=0,Zs[24]=Zs[146]=-1,Ks[24]=Ks[146]=0,ea[6]=ea[164]=-1,na[6]=na[164]=0,ra[6]=ra[164]=1,aa[6]=aa[164]=-1,ua[6]=ua[164]=0,ca[6]=ca[164]=0,fa[6]=fa[164]=0,ga[6]=ga[164]=-1,da[6]=da[164]=1,ha[6]=ha[164]=1,la[6]=la[164]=0,pa[6]=pa[164]=0,ia[129]=ia[41]=0,oa[129]=oa[41]=1,sa[129]=sa[41]=1,fa[129]=fa[41]=0,ga[129]=ga[41]=1,da[129]=da[41]=0,Vs[129]=Vs[41]=-1,Hs[129]=Hs[41]=0,Ws[129]=Ws[41]=0,Js[129]=Js[41]=0,Zs[129]=Zs[41]=-1,Ks[129]=Ks[41]=0,aa[66]=aa[104]=0,ua[66]=ua[104]=1,ca[66]=ca[104]=0,ia[66]=ia[104]=-1,oa[66]=oa[104]=0,sa[66]=sa[104]=1,ha[66]=ha[104]=0,la[66]=la[104]=-1,pa[66]=pa[104]=0,Vs[66]=Vs[104]=0,Hs[66]=Hs[104]=-1,Ws[66]=Ws[104]=1,Qs[144]=Qs[26]=-1,$s[144]=$s[26]=0,ta[144]=ta[26]=0,fa[144]=fa[26]=1,ga[144]=ga[26]=0,da[144]=da[26]=1,ha[144]=ha[26]=0,la[144]=la[26]=1,pa[144]=pa[26]=1,Js[144]=Js[26]=-1,Zs[144]=Zs[26]=0,Ks[144]=Ks[26]=1,ea[36]=ea[134]=0,na[36]=na[134]=1,ra[36]=ra[134]=1,aa[36]=aa[134]=0,ua[36]=ua[134]=1,ca[36]=ca[134]=0,Vs[36]=Vs[134]=0,Hs[36]=Hs[134]=-1,Ws[36]=Ws[134]=1,Js[36]=Js[134]=1,Zs[36]=Zs[134]=0,Ks[36]=Ks[134]=0,Qs[9]=Qs[161]=-1,$s[9]=$s[161]=0,ta[9]=ta[161]=0,ea[9]=ea[161]=0,na[9]=na[161]=-1,ra[9]=ra[161]=0,ia[9]=ia[161]=1,oa[9]=oa[161]=0,sa[9]=sa[161]=0,fa[9]=fa[161]=1,ga[9]=ga[161]=0,da[9]=da[161]=1,Qs[136]=0,$s[136]=1,ta[136]=1,ea[136]=0,na[136]=1,ra[136]=0,aa[136]=-1,ua[136]=0,ca[136]=1,ia[136]=-1,oa[136]=0,sa[136]=0,fa[136]=0,ga[136]=-1,da[136]=0,ha[136]=0,la[136]=-1,pa[136]=1,Vs[136]=1,Hs[136]=0,Ws[136]=0,Js[136]=1,Zs[136]=0,Ks[136]=1,Qs[34]=0,$s[34]=-1,ta[34]=0,ea[34]=0,na[34]=-1,ra[34]=1,aa[34]=1,ua[34]=0,ca[34]=0,ia[34]=1,oa[34]=0,sa[34]=1,fa[34]=0,ga[34]=1,da[34]=1,ha[34]=0,la[34]=1,pa[34]=0,Vs[34]=-1,Hs[34]=0,Ws[34]=1,Js[34]=-1,Zs[34]=0,Ks[34]=0,Qs[35]=0,$s[35]=1,ta[35]=1,ea[35]=0,na[35]=-1,ra[35]=1,aa[35]=1,ua[35]=0,ca[35]=0,ia[35]=-1,oa[35]=0,sa[35]=0,fa[35]=0,ga[35]=-1,da[35]=0,ha[35]=0,la[35]=1,pa[35]=0,Vs[35]=-1,Hs[35]=0,Ws[35]=1,Js[35]=1,Zs[35]=0,Ks[35]=1,Qs[153]=0,$s[153]=1,ta[153]=1,ia[153]=-1,oa[153]=0,sa[153]=0,fa[153]=0,ga[153]=-1,da[153]=0,Js[153]=1,Zs[153]=0,Ks[153]=1,ea[102]=0,na[102]=-1,ra[102]=1,aa[102]=1,ua[102]=0,ca[102]=0,ha[102]=0,la[102]=1,pa[102]=0,Vs[102]=-1,Hs[102]=0,Ws[102]=1,Qs[155]=0,$s[155]=-1,ta[155]=0,ia[155]=1,oa[155]=0,sa[155]=1,fa[155]=0,ga[155]=1,da[155]=1,Js[155]=-1,Zs[155]=0,Ks[155]=0,ea[103]=0,na[103]=1,ra[103]=0,aa[103]=-1,ua[103]=0,ca[103]=1,ha[103]=0,la[103]=-1,pa[103]=1,Vs[103]=1,Hs[103]=0,Ws[103]=0,Qs[152]=0,$s[152]=1,ta[152]=1,aa[152]=-1,ua[152]=0,ca[152]=1,ia[152]=-1,oa[152]=0,sa[152]=0,fa[152]=0,ga[152]=-1,da[152]=0,ha[152]=0,la[152]=-1,pa[152]=1,Js[152]=1,Zs[152]=0,Ks[152]=1,Qs[156]=0,$s[156]=-1,ta[156]=1,aa[156]=1,ua[156]=0,ca[156]=1,ia[156]=-1,oa[156]=0,sa[156]=0,fa[156]=0,ga[156]=-1,da[156]=0,ha[156]=0,la[156]=1,pa[156]=1,Js[156]=-1,Zs[156]=0,Ks[156]=1,Qs[137]=0,$s[137]=1,ta[137]=1,ea[137]=0,na[137]=1,ra[137]=0,ia[137]=-1,oa[137]=0,sa[137]=0,fa[137]=0,ga[137]=-1,da[137]=0,Vs[137]=1,Hs[137]=0,Ws[137]=0,Js[137]=1,Zs[137]=0,Ks[137]=1,Qs[139]=0,$s[139]=1,ta[139]=1,ea[139]=0,na[139]=-1,ra[139]=0,ia[139]=1,oa[139]=0,sa[139]=0,fa[139]=0,ga[139]=1,da[139]=0,Vs[139]=-1,Hs[139]=0,Ws[139]=0,Js[139]=1,Zs[139]=0,Ks[139]=1,Qs[98]=0,$s[98]=-1,ta[98]=0,ea[98]=0,na[98]=-1,ra[98]=1,aa[98]=1,ua[98]=0,ca[98]=0,ia[98]=1,oa[98]=0,sa[98]=1,ha[98]=0,la[98]=1,pa[98]=0,Vs[98]=-1,Hs[98]=0,Ws[98]=1,Qs[99]=0,$s[99]=1,ta[99]=0,ea[99]=0,na[99]=-1,ra[99]=1,aa[99]=1,ua[99]=0,ca[99]=0,ia[99]=-1,oa[99]=0,sa[99]=1,ha[99]=0,la[99]=-1,pa[99]=0,Vs[99]=1,Hs[99]=0,Ws[99]=1,ea[38]=0,na[38]=-1,ra[38]=1,aa[38]=1,ua[38]=0,ca[38]=0,fa[38]=0,ga[38]=1,da[38]=1,ha[38]=0,la[38]=1,pa[38]=0,Vs[38]=-1,Hs[38]=0,Ws[38]=1,Js[38]=-1,Zs[38]=0,Ks[38]=0,ea[39]=0,na[39]=1,ra[39]=1,aa[39]=-1,ua[39]=0,ca[39]=0,fa[39]=0,ga[39]=-1,da[39]=1,ha[39]=0,la[39]=1,pa[39]=0,Vs[39]=-1,Hs[39]=0,Ws[39]=1,Js[39]=1,Zs[39]=0,Ks[39]=0;var ya=function(t){return[[t.bottomleft,0],[0,0],[0,t.leftbottom]]},_a=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0]]},ma=function(t){return[[t.topright,1],[1,1],[1,t.righttop]]},va=function(t){return[[0,t.lefttop],[0,1],[t.topleft,1]]},xa=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop]]},Ea=function(t){return[[t.bottomright,0],[t.bottomleft,0],[1,t.righttop],[1,t.rightbottom]]},wa=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.topleft,1],[t.topright,1]]},ba=function(t){return[[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Ia=[],Na=[],Ca=[],Sa=[],Ma=[],La=[],Pa=[],Oa=[];Sa[1]=Ma[1]=18,Sa[169]=Ma[169]=18,Ca[4]=Na[4]=12,Ca[166]=Na[166]=12,Ia[16]=Oa[16]=4,Ia[154]=Oa[154]=4,La[64]=Pa[64]=22,La[106]=Pa[106]=22,Ca[2]=La[2]=17,Sa[2]=Ma[2]=18,Ca[168]=La[168]=17,Sa[168]=Ma[168]=18,Ia[8]=Sa[8]=9,Na[8]=Ca[8]=12,Ia[162]=Sa[162]=9,Na[162]=Ca[162]=12,Ia[32]=Oa[32]=4,Na[32]=Pa[32]=1,Ia[138]=Oa[138]=4,Na[138]=Pa[138]=1,Ma[128]=Oa[128]=21,La[128]=Pa[128]=22,Ma[42]=Oa[42]=21,La[42]=Pa[42]=22,Na[5]=Ma[5]=14,Na[165]=Ma[165]=14,Ca[20]=Oa[20]=6,Ca[150]=Oa[150]=6,Ia[80]=La[80]=11,Ia[90]=La[90]=11,Sa[65]=Pa[65]=3,Sa[105]=Pa[105]=3,Ia[160]=La[160]=11,Na[160]=Ma[160]=14,Ia[10]=La[10]=11,Na[10]=Ma[10]=14,Ca[130]=Oa[130]=6,Sa[130]=Pa[130]=3,Ca[40]=Oa[40]=6,Sa[40]=Pa[40]=3,Na[101]=Pa[101]=1,Na[69]=Pa[69]=1,Ma[149]=Oa[149]=21,Ma[21]=Oa[21]=21,Ca[86]=La[86]=17,Ca[84]=La[84]=17,Ia[89]=Sa[89]=9,Ia[81]=Sa[81]=9,Ia[96]=Pa[96]=0,Na[96]=La[96]=15,Ia[74]=Pa[74]=0,Na[74]=La[74]=15,Ia[24]=Ca[24]=8,Sa[24]=Oa[24]=7,Ia[146]=Ca[146]=8,Sa[146]=Oa[146]=7,Na[6]=La[6]=15,Ca[6]=Ma[6]=16,Na[164]=La[164]=15,Ca[164]=Ma[164]=16,Sa[129]=Oa[129]=7,Ma[129]=Pa[129]=20,Sa[41]=Oa[41]=7,Ma[41]=Pa[41]=20,Ca[66]=Pa[66]=2,Sa[66]=La[66]=19,Ca[104]=Pa[104]=2,Sa[104]=La[104]=19,Ia[144]=Ma[144]=10,La[144]=Oa[144]=23,Ia[26]=Ma[26]=10,La[26]=Oa[26]=23,Na[36]=Oa[36]=5,Ca[36]=Pa[36]=2,Na[134]=Oa[134]=5,Ca[134]=Pa[134]=2,Ia[9]=Ma[9]=10,Na[9]=Sa[9]=13,Ia[161]=Ma[161]=10,Na[161]=Sa[161]=13,Na[37]=Oa[37]=5,Ma[37]=Pa[37]=20,Na[133]=Oa[133]=5,Ma[133]=Pa[133]=20,Ca[148]=Ma[148]=16,La[148]=Oa[148]=23,Ca[22]=Ma[22]=16,La[22]=Oa[22]=23,Ia[82]=Ca[82]=8,Sa[82]=La[82]=19,Ia[88]=Ca[88]=8,Sa[88]=La[88]=19,Ia[73]=Pa[73]=0,Na[73]=Sa[73]=13,Ia[97]=Pa[97]=0,Na[97]=Sa[97]=13,Ia[145]=Sa[145]=9,Ma[145]=Oa[145]=21,Ia[25]=Sa[25]=9,Ma[25]=Oa[25]=21,Na[70]=Pa[70]=1,Ca[70]=La[70]=17,Na[100]=Pa[100]=1,Ca[100]=La[100]=17,Ia[34]=Sa[34]=9,Na[34]=Ca[34]=12,Ma[34]=Oa[34]=21,La[34]=Pa[34]=22,Ia[136]=Oa[136]=4,Na[136]=Pa[136]=1,Ca[136]=La[136]=17,Sa[136]=Ma[136]=18,Ia[35]=Oa[35]=4,Na[35]=Ca[35]=12,Sa[35]=Ma[35]=18,La[35]=Pa[35]=22,Ia[153]=Oa[153]=4,Sa[153]=Ma[153]=18,Na[102]=Ca[102]=12,La[102]=Pa[102]=22,Ia[155]=Sa[155]=9,Ma[155]=Oa[155]=23,Na[103]=Pa[103]=1,Ca[103]=La[103]=17,Ia[152]=Oa[152]=4,Ca[152]=La[152]=17,Sa[152]=Ma[152]=18,Ia[156]=Ca[156]=8,Sa[156]=Ma[156]=18,La[156]=Oa[156]=23,Ia[137]=Oa[137]=4,Na[137]=Pa[137]=1,Sa[137]=Ma[137]=18,Ia[139]=Oa[139]=4,Na[139]=Sa[139]=13,Ma[139]=Pa[139]=20,Ia[98]=Sa[98]=9,Na[98]=Ca[98]=12,La[98]=Pa[98]=22,Ia[99]=Pa[99]=0,Na[99]=Ca[99]=12,Sa[99]=La[99]=19,Na[38]=Ca[38]=12,Ma[38]=Oa[38]=21,La[38]=Pa[38]=22,Na[39]=Oa[39]=5,Ca[39]=Ma[39]=16,La[39]=Pa[39]=22;var Ra=[];Ra[1]=Ra[169]=ya,Ra[4]=Ra[166]=_a,Ra[16]=Ra[154]=ma,Ra[64]=Ra[106]=va,Ra[168]=Ra[2]=xa,Ra[162]=Ra[8]=Ea,Ra[138]=Ra[32]=wa,Ra[42]=Ra[128]=ba,Ra[5]=Ra[165]=function(t){return[[0,0],[0,t.leftbottom],[1,t.rightbottom],[1,0]]},Ra[20]=Ra[150]=function(t){return[[1,0],[t.bottomright,0],[t.topright,1],[1,1]]},Ra[80]=Ra[90]=function(t){return[[1,1],[1,t.righttop],[0,t.lefttop],[0,1]]},Ra[65]=Ra[105]=function(t){return[[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},Ra[160]=Ra[10]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.leftbottom],[0,t.lefttop]]},Ra[130]=Ra[40]=function(t){return[[t.topleft,1],[t.topright,1],[t.bottomright,0],[t.bottomleft,0]]},Ra[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},Ra[101]=Ra[69]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,1],[t.topleft,1]]},Ra[149]=Ra[21]=function(t){return[[t.topright,1],[1,1],[1,0],[0,0],[0,t.leftbottom]]},Ra[86]=Ra[84]=function(t){return[[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[1,1]]},Ra[89]=Ra[81]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,1]]},Ra[96]=Ra[74]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.lefttop],[0,1],[t.topleft,1]]},Ra[24]=Ra[146]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[t.topright,1]]},Ra[6]=Ra[164]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop]]},Ra[129]=Ra[41]=function(t){return[[t.topright,1],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1]]},Ra[66]=Ra[104]=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Ra[144]=Ra[26]=function(t){return[[1,1],[1,t.righttop],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Ra[36]=Ra[134]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[t.topleft,1],[t.topright,1]]},Ra[9]=Ra[161]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom]]},Ra[37]=Ra[133]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},Ra[148]=Ra[22]=function(t){return[[1,1],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Ra[82]=Ra[88]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1]]},Ra[73]=Ra[97]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},Ra[145]=Ra[25]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},Ra[70]=Ra[100]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Ra[34]=function(t){return[ba(t),Ea(t)]},Ra[35]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Ra[136]=function(t){return[wa(t),xa(t)]},Ra[153]=function(t){return[ma(t),ya(t)]},Ra[102]=function(t){return[_a(t),va(t)]},Ra[155]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},Ra[103]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Ra[152]=function(t){return[ma(t),xa(t)]},Ra[156]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},Ra[137]=function(t){return[wa(t),ya(t)]},Ra[139]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},Ra[98]=function(t){return[Ea(t),va(t)]},Ra[99]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},Ra[38]=function(t){return[_a(t),ba(t)]},Ra[39]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]};var Ta=function t(e){this.id=t.buildId(e),this.coordinates=e,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1};Ta.buildId=function(t){return t.join(",")},Ta.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter(function(e){return e.from.id!==t.from.id})},Ta.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter(function(e){return e.to.id!==t.to.id})},Ta.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1},Ta.prototype.sortOuterEdges=function(){var t=this;this.outerEdgesSorted||(this.outerEdges.sort(function(e,n){var r=e.to,i=n.to;if(r.coordinates[0]-t.coordinates[0]>=0&&i.coordinates[0]-t.coordinates[0]<0)return 1;if(r.coordinates[0]-t.coordinates[0]<0&&i.coordinates[0]-t.coordinates[0]>=0)return-1;if(r.coordinates[0]-t.coordinates[0]==0&&i.coordinates[0]-t.coordinates[0]==0)return r.coordinates[1]-t.coordinates[1]>=0||i.coordinates[1]-t.coordinates[1]>=0?r.coordinates[1]-i.coordinates[1]:i.coordinates[1]-r.coordinates[1];var o=xr(t.coordinates,r.coordinates,i.coordinates);if(o<0)return 1;if(o>0)return-1;return Math.pow(r.coordinates[0]-t.coordinates[0],2)+Math.pow(r.coordinates[1]-t.coordinates[1],2)-(Math.pow(i.coordinates[0]-t.coordinates[0],2)+Math.pow(i.coordinates[1]-t.coordinates[1],2))}),this.outerEdgesSorted=!0)},Ta.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},Ta.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]},Ta.prototype.addInnerEdge=function(t){this.innerEdges.push(t)};var Aa=function(t,e){this.from=t,this.to=e,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)};Aa.prototype.getSymetric=function(){return this.symetric||(this.symetric=new Aa(this.to,this.from),this.symetric.symetric=this),this.symetric},Aa.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},Aa.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id},Aa.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},Aa.prototype.toLineString=function(){return a([this.from.coordinates,this.to.coordinates])},Aa.prototype.compareTo=function(t){return xr(t.from.coordinates,t.to.coordinates,this.to.coordinates)};var Da=function(){this.edges=[],this.polygon=void 0,this.envelope=void 0},Fa={length:{configurable:!0}};Da.prototype.push=function(t){this[this.edges.length]=t,this.edges.push(t),this.polygon=this.envelope=void 0},Da.prototype.get=function(t){return this.edges[t]},Fa.length.get=function(){return this.edges.length},Da.prototype.forEach=function(t){this.edges.forEach(t)},Da.prototype.map=function(t){return this.edges.map(t)},Da.prototype.some=function(t){return this.edges.some(t)},Da.prototype.isValid=function(){return!0},Da.prototype.isHole=function(){var t=this,e=this.edges.reduce(function(e,n,r){return n.from.coordinates[1]>t.edges[e].from.coordinates[1]&&(e=r),e},0),n=(0===e?this.length:e)-1,r=(e+1)%this.length,i=xr(this.edges[n].from.coordinates,this.edges[e].from.coordinates,this.edges[r].from.coordinates);return 0===i?this.edges[n].from.coordinates[0]>this.edges[r].from.coordinates[0]:i>0},Da.prototype.toMultiPoint=function(){return l(this.edges.map(function(t){return t.from.coordinates}))},Da.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map(function(t){return t.from.coordinates});return t.push(this.edges[0].from.coordinates),this.polygon=o([t])},Da.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=he(this.toPolygon())},Da.findEdgeRingContaining=function(t,e){var n,i,o=t.getEnvelope();return e.forEach(function(e){var s=e.getEnvelope();if(i&&(n=i.getEnvelope()),!function(t,e){var n=t.geometry.coordinates.map(function(t){return t[0]}),r=t.geometry.coordinates.map(function(t){return t[1]}),i=e.geometry.coordinates.map(function(t){return t[0]}),o=e.geometry.coordinates.map(function(t){return t[1]});return Math.max(null,n)===Math.max(null,i)&&Math.max(null,r)===Math.max(null,o)&&Math.min(null,n)===Math.min(null,i)&&Math.min(null,r)===Math.min(null,o)}(s,o)&&Er(s,o)){var a=t.map(function(t){return t.from.coordinates}).find(function(t){return!e.some(function(e){return function(t,e){return t[0]===e[0]&&t[1]===e[1]}(t,e.from.coordinates)})});a&&e.inside(r(a))&&(i&&!Er(n,s)||(i=e))}}),i},Da.prototype.inside=function(t){return Pt(t,this.toPolygon())},Object.defineProperties(Da.prototype,Fa);var qa=function(){this.edges=[],this.nodes={}};qa.fromGeoJson=function(t){!function(t){if(!t)throw new Error("No geojson passed");if("FeatureCollection"!==t.type&&"GeometryCollection"!==t.type&&"MultiLineString"!==t.type&&"LineString"!==t.type&&"Feature"!==t.type)throw new Error("Invalid input type '"+t.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(t);var e=new qa;return F(t,function(t){H(t,"LineString","Graph::fromGeoJson"),M(t,function(t,n){if(t){var r=e.getNode(t),i=e.getNode(n);e.addEdge(r,i)}return n})}),e},qa.prototype.getNode=function(t){var e=Ta.buildId(t),n=this.nodes[e];return n||(n=this.nodes[e]=new Ta(t)),n},qa.prototype.addEdge=function(t,e){var n=new Aa(t,e),r=n.getSymetric();this.edges.push(n),this.edges.push(r)},qa.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map(function(e){return t.nodes[e]}).forEach(function(e){return t._removeIfDangle(e)})},qa.prototype._removeIfDangle=function(t){var e=this;if(t.innerEdges.length<=1){var n=t.getOuterEdges().map(function(t){return t.to});this.removeNode(t),n.forEach(function(t){return e._removeIfDangle(t)})}},qa.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(e){e.label===e.symetric.label&&(t.removeEdge(e.symetric),t.removeEdge(e))})},qa.prototype._computeNextCWEdges=function(t){var e=this;void 0===t?Object.keys(this.nodes).forEach(function(t){return e._computeNextCWEdges(e.nodes[t])}):t.getOuterEdges().forEach(function(e,n){t.getOuterEdge((0===n?t.getOuterEdges().length:n)-1).symetric.next=e})},qa.prototype._computeNextCCWEdges=function(t,e){for(var n,r,i=t.getOuterEdges(),o=i.length-1;o>=0;--o){var s=i[o],a=s.symetric,u=void 0,c=void 0;s.label===e&&(u=s),a.label===e&&(c=a),u&&c&&(c&&(r=c),u&&(r&&(r.next=u,r=void 0),n||(n=u)))}r&&(r.next=n)},qa.prototype._findLabeledEdgeRings=function(){var t=[],e=0;return this.edges.forEach(function(n){if(!(n.label>=0)){t.push(n);var r=n;do{r.label=e,r=r.next}while(!n.isEqual(r));e++}}),t},qa.prototype.getEdgeRings=function(){var t=this;this._computeNextCWEdges(),this.edges.forEach(function(t){t.label=void 0}),this._findLabeledEdgeRings().forEach(function(e){t._findIntersectionNodes(e).forEach(function(n){t._computeNextCCWEdges(n,e.label)})});var e=[];return this.edges.forEach(function(n){n.ring||e.push(t._findEdgeRing(n))}),e},qa.prototype._findIntersectionNodes=function(t){var e=[],n=t,r=function(){var r=0;n.from.getOuterEdges().forEach(function(e){e.label===t.label&&++r}),r>1&&e.push(n.from),n=n.next};do{r()}while(!t.isEqual(n));return e},qa.prototype._findEdgeRing=function(t){var e=t,n=new Da;do{n.push(e),e.ring=n,e=e.next}while(!t.isEqual(e));return n},qa.prototype.removeNode=function(t){var e=this;t.getOuterEdges().forEach(function(t){return e.removeEdge(t)}),t.innerEdges.forEach(function(t){return e.removeEdge(t)}),delete this.nodes[t.id]},qa.prototype.removeEdge=function(t){this.edges=this.edges.filter(function(e){return!e.isEqual(t)}),t.deleteEdge()};var Ga=mt(function(t,e){function n(t){var e=[];for(var n in t)e.push(n);return e}(t.exports="function"==typeof Object.keys?Object.keys:n).shim=n}),Ba=(Ga.shim,mt(function(t,e){function n(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function r(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Object.prototype.hasOwnProperty.call(t,"callee")&&!Object.prototype.propertyIsEnumerable.call(t,"callee")||!1}var i="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();(e=t.exports=i?n:r).supported=n,e.unsupported=r})),ka=(Ba.supported,Ba.unsupported,mt(function(t){function e(t){return null===t||void 0===t}function n(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length)&&("function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0]))}var r=Array.prototype.slice,i=t.exports=function(t,o,s){return s||(s={}),t===o||(t instanceof Date&&o instanceof Date?t.getTime()===o.getTime():!t||!o||"object"!=typeof t&&"object"!=typeof o?s.strict?t===o:t==o:function(t,o,s){var a,u;if(e(t)||e(o))return!1;if(t.prototype!==o.prototype)return!1;if(Ba(t))return!!Ba(o)&&(t=r.call(t),o=r.call(o),i(t,o,s));if(n(t)){if(!n(o))return!1;if(t.length!==o.length)return!1;for(a=0;a<t.length;a++)if(t[a]!==o[a])return!1;return!0}try{var c=Ga(t),h=Ga(o)}catch(t){return!1}if(c.length!=h.length)return!1;for(c.sort(),h.sort(),a=c.length-1;a>=0;a--)if(c[a]!=h[a])return!1;for(a=c.length-1;a>=0;a--)if(u=c[a],!i(t[u],o[u],s))return!1;return typeof t==typeof o}(t,o,s))}})),za=function(t){this.precision=t&&t.precision?t.precision:17,this.direction=!(!t||!t.direction)&&t.direction,this.pseudoNode=!(!t||!t.pseudoNode)&&t.pseudoNode,this.objectComparator=t&&t.objectComparator?t.objectComparator:Rr};za.prototype.compare=function(t,e){if(t.type!==e.type||!Or(t,e))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,e.coordinates);case"LineString":return this.compareLine(t.coordinates,e.coordinates,0,!1);case"Polygon":return this.comparePolygon(t,e);case"Feature":return this.compareFeature(t,e);default:if(0===t.type.indexOf("Multi")){var n=this,r=Pr(t),i=Pr(e);return r.every(function(t){return this.some(function(e){return n.compare(t,e)})},i)}}return!1},za.prototype.compareCoord=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n].toFixed(this.precision)!==e[n].toFixed(this.precision))return!1;return!0},za.prototype.compareLine=function(t,e,n,r){if(!Or(t,e))return!1;var i=this.pseudoNode?t:this.removePseudo(t),o=this.pseudoNode?e:this.removePseudo(e);if(!r||this.compareCoord(i[0],o[0])||(o=this.fixStartIndex(o,i))){var s=this.compareCoord(i[n],o[n]);return this.direction||s?this.comparePath(i,o):!!this.compareCoord(i[n],o[o.length-(1+n)])&&this.comparePath(i.slice().reverse(),o)}},za.prototype.fixStartIndex=function(t,e){for(var n,r=-1,i=0;i<t.length;i++)if(this.compareCoord(t[i],e[0])){r=i;break}return r>=0&&(n=[].concat(t.slice(r,t.length),t.slice(1,r+1))),n},za.prototype.comparePath=function(t,e){var n=this;return t.every(function(t,e){return n.compareCoord(t,this[e])},e)},za.prototype.comparePolygon=function(t,e){if(this.compareLine(t.coordinates[0],e.coordinates[0],1,!0)){var n=t.coordinates.slice(1,t.coordinates.length),r=e.coordinates.slice(1,e.coordinates.length),i=this;return n.every(function(t){return this.some(function(e){return i.compareLine(t,e,1,!0)})},r)}return!1},za.prototype.compareFeature=function(t,e){return!(t.id!==e.id||!this.objectComparator(t.properties,e.properties)||!this.compareBBox(t,e))&&this.compare(t.geometry,e.geometry)},za.prototype.compareBBox=function(t,e){return!!(!t.bbox&&!e.bbox||t.bbox&&e.bbox&&this.compareCoord(t.bbox,e.bbox))},za.prototype.removePseudo=function(t){return t};var ja=za,Xa=mt(function(t){function e(t,e,n,r){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(t,e,n,r)}e.prototype.run=function(t,e,n,r){this._init(t,e,n,r);for(var i=0;i<this._datasetLength;i++)if(1!==this._visited[i]){this._visited[i]=1;var o=this._regionQuery(i);if(o.length<this.minPts)this.noise.push(i);else{var s=this.clusters.length;this.clusters.push([]),this._addToCluster(i,s),this._expandCluster(s,o)}}return this.clusters},e.prototype._init=function(t,e,n,r){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this.noise=[],this._datasetLength=t.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}e&&(this.epsilon=e),n&&(this.minPts=n),r&&(this.distance=r)},e.prototype._expandCluster=function(t,e){for(var n=0;n<e.length;n++){var r=e[n];if(1!==this._visited[r]){this._visited[r]=1;var i=this._regionQuery(r);i.length>=this.minPts&&(e=this._mergeArrays(e,i))}1!==this._assigned[r]&&this._addToCluster(r,t)}},e.prototype._addToCluster=function(t,e){this.clusters[e].push(t),this._assigned[t]=1},e.prototype._regionQuery=function(t){for(var e=[],n=0;n<this._datasetLength;n++){this.distance(this.dataset[t],this.dataset[n])<this.epsilon&&e.push(n)}return e},e.prototype._mergeArrays=function(t,e){for(var n=e.length,r=0;r<n;r++){var i=e[r];t.indexOf(i)<0&&t.push(i)}return t},e.prototype._euclideanDistance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;)n+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(n)},t.exports&&(t.exports=e)}),Ua=mt(function(t){function e(t,e,n){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(t,e,n)}e.prototype.init=function(t,e,n){this.assignments=[],this.centroids=[],void 0!==t&&(this.dataset=t),void 0!==e&&(this.k=e),void 0!==n&&(this.distance=n)},e.prototype.run=function(t,e){this.init(t,e);for(var n=this.dataset.length,r=0;r<this.k;r++)this.centroids[r]=this.randomCentroid();for(var i=!0;i;){i=this.assign();for(var o=0;o<this.k;o++){for(var s=new Array(h),a=0,u=0;u<h;u++)s[u]=0;for(var c=0;c<n;c++){var h=this.dataset[c].length;if(o===this.assignments[c]){for(u=0;u<h;u++)s[u]+=this.dataset[c][u];a++}}if(a>0){for(u=0;u<h;u++)s[u]/=a;this.centroids[o]=s}else this.centroids[o]=this.randomCentroid(),i=!0}}return this.getClusters()},e.prototype.randomCentroid=function(){var t,e,n=this.dataset.length-1;do{e=Math.round(Math.random()*n),t=this.dataset[e]}while(this.centroids.indexOf(t)>=0);return t},e.prototype.assign=function(){for(var t,e=!1,n=this.dataset.length,r=0;r<n;r++)(t=this.argmin(this.dataset[r],this.centroids,this.distance))!=this.assignments[r]&&(this.assignments[r]=t,e=!0);return e},e.prototype.getClusters=function(){for(var t,e=new Array(this.k),n=0;n<this.assignments.length;n++)void 0===e[t=this.assignments[n]]&&(e[t]=[]),e[t].push(n);return e},e.prototype.argmin=function(t,e,n){for(var r,i=Number.MAX_VALUE,o=0,s=e.length,a=0;a<s;a++)(r=n(t,e[a]))<i&&(i=r,o=a);return o},e.prototype.distance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;){var i=t[r]-e[r];n+=i*i}return Math.sqrt(n)},t.exports&&(t.exports=e)}),Ya=mt(function(t){function e(t,e,n){this._queue=[],this._priorities=[],this._sorting="desc",this._init(t,e,n)}e.prototype.insert=function(t,e){for(var n=this._queue.length,r=n;r--;){var i=this._priorities[r];"desc"===this._sorting?e>i&&(n=r):e<i&&(n=r)}this._insertAt(t,e,n)},e.prototype.remove=function(t){for(var e=this._queue.length;e--;){if(t===this._queue[e]){this._queue.splice(e,1),this._priorities.splice(e,1);break}}},e.prototype.forEach=function(t){this._queue.forEach(t)},e.prototype.getElements=function(){return this._queue},e.prototype.getElementPriority=function(t){return this._priorities[t]},e.prototype.getPriorities=function(){return this._priorities},e.prototype.getElementsWithPriorities=function(){for(var t=[],e=0,n=this._queue.length;e<n;e++)t.push([this._queue[e],this._priorities[e]]);return t},e.prototype._init=function(t,e,n){if(t&&e){if(this._queue=[],this._priorities=[],t.length!==e.length)throw new Error("Arrays must have the same length");for(var r=0;r<t.length;r++)this.insert(t[r],e[r])}n&&(this._sorting=n)},e.prototype._insertAt=function(t,e,n){this._queue.length===n?(this._queue.push(t),this._priorities.push(e)):(this._queue.splice(n,0,t),this._priorities.splice(n,0,e))},t.exports&&(t.exports=e)}),Va=mt(function(t){function e(t,e,n,r){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(t,e,n,r)}if(t.exports)var n=Ya;e.prototype.run=function(t,e,r,i){this._init(t,e,r,i);for(var o=0,s=this.dataset.length;o<s;o++)if(1!==this._processed[o]){this._processed[o]=1,this.clusters.push([o]);var a=this.clusters.length-1;this._orderedList.push(o);var u=new n(null,null,"asc"),c=this._regionQuery(o);void 0!==this._distanceToCore(o)&&(this._updateQueue(o,c,u),this._expandCluster(a,u))}return this.clusters},e.prototype.getReachabilityPlot=function(){for(var t=[],e=0,n=this._orderedList.length;e<n;e++){var r=this._orderedList[e],i=this._reachability[r];t.push([r,i])}return t},e.prototype._init=function(t,e,n,r){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}e&&(this.epsilon=e),n&&(this.minPts=n),r&&(this.distance=r)},e.prototype._updateQueue=function(t,e,n){var r=this;this._coreDistance=this._distanceToCore(t),e.forEach(function(e){if(void 0===r._processed[e]){var i=r.distance(r.dataset[t],r.dataset[e]),o=Math.max(r._coreDistance,i);void 0===r._reachability[e]?(r._reachability[e]=o,n.insert(e,o)):o<r._reachability[e]&&(r._reachability[e]=o,n.remove(e),n.insert(e,o))}})},e.prototype._expandCluster=function(t,e){for(var n=e.getElements(),r=0,i=n.length;r<i;r++){var o=n[r];if(void 0===this._processed[o]){var s=this._regionQuery(o);this._processed[o]=1,this.clusters[t].push(o),this._orderedList.push(o),void 0!==this._distanceToCore(o)&&(this._updateQueue(o,s,e),this._expandCluster(t,e))}}},e.prototype._distanceToCore=function(t){for(var e=this.epsilon,n=0;n<e;n++){if(this._regionQuery(t,n).length>=this.minPts)return n}},e.prototype._regionQuery=function(t,e){e=e||this.epsilon;for(var n=[],r=0,i=this.dataset.length;r<i;r++)this.distance(this.dataset[t],this.dataset[r])<e&&n.push(r);return n},e.prototype._euclideanDistance=function(t,e){for(var n=0,r=Math.min(t.length,e.length);r--;)n+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(n)},t.exports&&(t.exports=e)}),Ha=mt(function(t){t.exports&&(t.exports={DBSCAN:Xa,KMEANS:Ua,OPTICS:Va,PriorityQueue:Ya})}),Wa=(Ha.DBSCAN,Ha.KMEANS,Ha.OPTICS,Ha.PriorityQueue,function(t,e,n){for(var r=t.length,i=0,o=0;o<r;o++){var s=(t[o]||0)-(e[o]||0);i+=s*s}return n?Math.sqrt(i):i}),Ja=Wa,Za=function(t,e,n){var r=Math.abs(t-e);return n?r:r*r},Ka=Wa,Qa=function(t,e){for(var n={},r=[],i=e<<2,o=t.length,s=t[0].length>0;r.length<e&&i-- >0;){var a=t[Math.floor(Math.random()*o)],u=s?a.join("_"):""+a;n[u]||(n[u]=!0,r.push(a))}if(r.length<e)throw new Error("Error initializating clusters");return r},$a=function(t,e){var n=t[0].length?Ja:Za,r=[],i=t.length,o=t[0].length>0,s=t[Math.floor(Math.random()*i)];o&&s.join("_");for(r.push(s);r.length<e;){for(var a=[],u=r.length,c=0,h=[],l=0;l<i;l++){for(var p=1/0,f=0;f<u;f++){var g=n(t[l],r[f]);g<=p&&(p=g)}a[l]=p}for(var d=0;d<i;d++)c+=a[d];for(var y=0;y<i;y++)h[y]={i:y,v:t[y],pr:a[y]/c,cs:0};h.sort(function(t,e){return t.pr-e.pr}),h[0].cs=h[0].pr;for(var _=1;_<i;_++)h[_].cs=h[_-1].cs+h[_].pr;for(var m=Math.random(),v=0;v<i-1&&h[v++].cs<m;);r.push(h[v-1].v)}return r},tu=1e4,eu=function(t,e,n,r){var i=[],o=[],s=[],a=[],u=!1,c=r||tu,h=t.length,l=t[0].length,p=l>0,f=[];if(n)i="kmrand"==n?Qa(t,e):"kmpp"==n?$a(t,e):n;else for(var g={};i.length<e;){var d=Math.floor(Math.random()*h);g[d]||(g[d]=!0,i.push(t[d]))}do{Ar(e,0,f);for(var y=0;y<h;y++){for(var _=1/0,m=0,v=0;v<e;v++)(a=p?Ka(t[y],i[v]):Math.abs(t[y]-i[v]))<=_&&(_=a,m=v);s[y]=m,f[m]++}for(var x=[],E=(o=[],0);E<e;E++)x[E]=p?Ar(l,0,x[E]):0,o[E]=i[E];if(p){for(var w=0;w<e;w++)i[w]=[];for(var b=0;b<h;b++)for(var I=x[s[b]],N=t[b],C=0;C<l;C++)I[C]+=N[C];u=!0;for(var S=0;S<e;S++){for(var M=i[S],L=x[S],P=o[S],O=f[S],R=0;R<l;R++)M[R]=L[R]/O||0;if(u)for(var T=0;T<l;T++)if(P[T]!=M[T]){u=!1;break}}}else{for(var A=0;A<h;A++)x[s[A]]+=t[A];for(var D=0;D<e;D++)i[D]=x[D]/f[D]||0;u=!0;for(var F=0;F<e;F++)if(o[F]!=i[F]){u=!1;break}}u=u||--c<=0}while(!u);return{it:tu-c,k:e,idxs:s,centroids:i}},nu={search:function(t,e,n,r){t.cleanDirty();var i=(r=r||{}).heuristic||nu.heuristics.manhattan,o=r.closest||!1,s=new Br(function(t){return t.f}),a=e;for(e.h=i(e,n),s.push(e);s.size()>0;){var u=s.pop();if(u===n)return Fr(u);u.closed=!0;for(var c=t.neighbors(u),h=0,l=c.length;h<l;++h){var p=c[h];if(!p.closed&&!p.isWall()){var f=u.g+p.getCost(u),g=p.visited;(!g||f<p.g)&&(p.visited=!0,p.parent=u,p.h=p.h||i(p,n),p.g=f,p.f=p.g+p.h,t.markDirty(p),o&&(p.h<a.h||p.h===a.h&&p.g<a.g)&&(a=p),g?s.rescoreElement(p):s.push(p))}}}return o?Fr(a):[]},heuristics:{manhattan:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},diagonal:function(t,e){var n=Math.sqrt(2),r=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return 1*(r+i)+(n-2)*Math.min(r,i)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};qr.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)nu.cleanNode(this.nodes[t])},qr.prototype.cleanDirty=function(){for(var t=0;t<this.dirtyNodes.length;t++)nu.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]},qr.prototype.markDirty=function(t){this.dirtyNodes.push(t)},qr.prototype.neighbors=function(t){var e=[],n=t.x,r=t.y,i=this.grid;return i[n-1]&&i[n-1][r]&&e.push(i[n-1][r]),i[n+1]&&i[n+1][r]&&e.push(i[n+1][r]),i[n]&&i[n][r-1]&&e.push(i[n][r-1]),i[n]&&i[n][r+1]&&e.push(i[n][r+1]),this.diagonal&&(i[n-1]&&i[n-1][r-1]&&e.push(i[n-1][r-1]),i[n+1]&&i[n+1][r-1]&&e.push(i[n+1][r-1]),i[n-1]&&i[n-1][r+1]&&e.push(i[n-1][r+1]),i[n+1]&&i[n+1][r+1]&&e.push(i[n+1][r+1])),e},qr.prototype.toString=function(){for(var t,e,n,r,i=[],o=this.grid,s=0,a=o.length;s<a;s++){for(t=[],n=0,r=(e=o[s]).length;n<r;n++)t.push(e[n].weight);i.push(t.join(" "))}return i.join("\n")},Gr.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},Gr.prototype.getCost=function(t){return t&&t.x!==this.x&&t.y!==this.y?1.41421*this.weight:this.weight},Gr.prototype.isWall=function(){return 0===this.weight},Br.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),n=this.content.pop();e!==this.content.length-1&&(this.content[e]=n,this.scoreFunction(n)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var n=(t+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(r)))break;this.content[n]=e,this.content[t]=r,t=n}},bubbleUp:function(t){for(var e=this.content.length,n=this.content[t],r=this.scoreFunction(n);;){var i,o=t+1<<1,s=o-1,a=null;if(s<e){var u=this.content[s];(i=this.scoreFunction(u))<r&&(a=s)}if(o<e){var c=this.content[o];this.scoreFunction(c)<(null===a?r:i)&&(a=o)}if(null===a)break;this.content[t]=this.content[a],this.content[a]=n,t=a}}};var ru=function(t){return function(){return t}};jr.prototype={constructor:jr,insert:function(t,e){var n,r,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=Vr(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)n===(r=n.U).L?(i=r.R)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.R&&(Ur(this,n),n=(t=n).U),n.C=!1,r.C=!0,Yr(this,r)):(i=r.L)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.L&&(Yr(this,n),n=(t=n).U),n.C=!1,r.C=!0,Ur(this,r)),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,r,i=t.U,o=t.L,s=t.R;if(n=o?s?Vr(s):o:s,i?i.L===t?i.L=n:i.R=n:this._=n,o&&s?(r=n.C,n.C=t.C,n.L=o,o.U=n,n!==s?(i=n.U,n.U=t.U,t=n.R,i.L=t,n.R=s,s.U=n):(n.U=i,i=n,t=n.R)):(r=t.C,t=n),t&&(t.U=i),!r)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===i.L){if((e=i.R).C&&(e.C=!1,i.C=!0,Ur(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,Yr(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,Ur(this,i),t=this._;break}}else if((e=i.L).C&&(e.C=!1,i.C=!0,Yr(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,Ur(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,Yr(this,i),t=this._;break}e.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}};var iu,ou,su,au,uu,cu=[],hu=[],lu=1e-6,pu=1e-12;hi.prototype={constructor:hi,polygons:function(){var t=this.edges;return this.cells.map(function(e){var n=e.halfedges.map(function(n){return $r(e,t[n])});return n.data=e.site.data,n})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(n,r){if(o=(i=n.halfedges).length)for(var i,o,s,a=n.site,u=-1,c=e[i[o-1]],h=c.left===a?c.right:c.left;++u<o;)s=h,h=(c=e[i[u]]).left===a?c.right:c.left,s&&h&&r<s.index&&r<h.index&&ui(a,s,h)<0&&t.push([a.data,s.data,h.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,n){for(var r,i,o=this,s=o._found||0,a=o.cells.length;!(i=o.cells[s]);)if(++s>=a)return null;var u=t-i.site[0],c=e-i.site[1],h=u*u+c*c;do{i=o.cells[r=s],s=null,i.halfedges.forEach(function(n){var r=o.edges[n],a=r.left;if(a!==i.site&&a||(a=r.right)){var u=t-a[0],c=e-a[1],l=u*u+c*c;l<h&&(h=l,s=a.index)}})}while(null!==s);return o._found=r,null==n||h<=n*n?i.site:null}};var fu=function(){function t(t){return new hi(t.map(function(r,i){var o=[Math.round(e(r,i,t)/lu)*lu,Math.round(n(r,i,t)/lu)*lu];return o.index=i,o.data=r,o}),r)}var e=kr,n=zr,r=null;return t.polygons=function(e){return t(e).polygons()},t.links=function(e){return t(e).links()},t.triangles=function(e){return t(e).triangles()},t.x=function(n){return arguments.length?(e="function"==typeof n?n:ru(+n),t):e},t.y=function(e){return arguments.length?(n="function"==typeof e?e:ru(+e),t):n},t.extent=function(e){return arguments.length?(r=null==e?null:[[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]],t):r&&[[r[0][0],r[0][1]],[r[1][0],r[1][1]]]},t.size=function(e){return arguments.length?(r=null==e?null:[[0,0],[+e[0],+e[1]]],t):r&&[r[1][0]-r[0][0],r[1][1]-r[0][1]]},t},gu=Object.freeze({randomPosition:_i,randomPoint:mi,randomPolygon:vi,randomLineString:xi}),du=Object.freeze({getCluster:wi,clusterEach:bi,clusterReduce:Ii,createBins:Ni,applyFilter:Ci,propertiesContainsFilter:Si,filterProperties:Mi});"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(void 0===this||null===this)throw new TypeError(this+" is not an object");var e=Object(this),n=Math.max(Math.min(e.length,9007199254740991),0)||0,r=1 in arguments?parseInt(Number(arguments[1]),10)||0:0;r=r<0?Math.max(n+r,0):Math.min(r,n);var i=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:n;for(i=i<0?Math.max(n+arguments[2],0):Math.min(i,n);r<i;)e[r]=t,++r;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!=t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var yu=function(){};yu.prototype.interfaces_=function(){return[]},yu.prototype.getClass=function(){return yu},yu.prototype.equalsWithTolerance=function(t,e,n){return Math.abs(t-e)<=n};var _u=function(){},mu=function(){},vu={MAX_VALUE:{configurable:!0}};mu.isNaN=function(t){return Number.isNaN(t)},mu.doubleToLongBits=function(t){return t},mu.longBitsToDouble=function(t){return t},mu.isInfinite=function(t){return!Number.isFinite(t)},vu.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(mu,vu);var xu=function(){},Eu=function(){},wu=function(){},bu=function t(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},Iu={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};bu.prototype.setOrdinate=function(t,e){switch(t){case bu.X:this.x=e;break;case bu.Y:this.y=e;break;case bu.Z:this.z=e;break;default:throw new _u("Invalid ordinate index: "+t)}},bu.prototype.equals2D=function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!yu.equalsWithTolerance(this.x,e.x,n)&&!!yu.equalsWithTolerance(this.y,e.y,n)}},bu.prototype.getOrdinate=function(t){switch(t){case bu.X:return this.x;case bu.Y:return this.y;case bu.Z:return this.z}throw new _u("Invalid ordinate index: "+t)},bu.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||mu.isNaN(this.z))&&mu.isNaN(t.z)},bu.prototype.equals=function(t){return t instanceof bu&&this.equals2D(t)},bu.prototype.equalInZ=function(t,e){return yu.equalsWithTolerance(this.z,t.z,e)},bu.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},bu.prototype.clone=function(){},bu.prototype.copy=function(){return new bu(this)},bu.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},bu.prototype.distance3D=function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return Math.sqrt(e*e+n*n+r*r)},bu.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},bu.prototype.hashCode=function(){var t=17;return t=37*t+bu.hashCode(this.x),t=37*t+bu.hashCode(this.y)},bu.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z},bu.prototype.interfaces_=function(){return[xu,Eu,Li]},bu.prototype.getClass=function(){return bu},bu.hashCode=function(){if(1===arguments.length){var t=arguments[0],e=mu.doubleToLongBits(t);return Math.trunc((e^e)>>>32)}},Iu.DimensionalComparator.get=function(){return Nu},Iu.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},Iu.NULL_ORDINATE.get=function(){return mu.NaN},Iu.X.get=function(){return 0},Iu.Y.get=function(){return 1},Iu.Z.get=function(){return 2},Object.defineProperties(bu,Iu);var Nu=function(t){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(2!==e&&3!==e)throw new _u("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};Nu.prototype.compare=function(t,e){var n=t,r=e,i=Nu.compare(n.x,r.x);if(0!==i)return i;var o=Nu.compare(n.y,r.y);if(0!==o)return o;if(this._dimensionsToTest<=2)return 0;return Nu.compare(n.z,r.z)},Nu.prototype.interfaces_=function(){return[wu]},Nu.prototype.getClass=function(){return Nu},Nu.compare=function(t,e){return t<e?-1:t>e?1:mu.isNaN(t)?mu.isNaN(e)?0:-1:mu.isNaN(e)?1:0};var Cu=function(){};Cu.prototype.create=function(){},Cu.prototype.interfaces_=function(){return[]},Cu.prototype.getClass=function(){return Cu};var Su=function(){},Mu={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Su.prototype.interfaces_=function(){return[]},Su.prototype.getClass=function(){return Su},Su.toLocationSymbol=function(t){switch(t){case Su.EXTERIOR:return"e";case Su.BOUNDARY:return"b";case Su.INTERIOR:return"i";case Su.NONE:return"-"}throw new _u("Unknown location value: "+t)},Mu.INTERIOR.get=function(){return 0},Mu.BOUNDARY.get=function(){return 1},Mu.EXTERIOR.get=function(){return 2},Mu.NONE.get=function(){return-1},Object.defineProperties(Su,Mu);var Lu=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},Pu=function(){},Ou={LOG_10:{configurable:!0}};Pu.prototype.interfaces_=function(){return[]},Pu.prototype.getClass=function(){return Pu},Pu.log10=function(t){var e=Math.log(t);return mu.isInfinite(e)?e:mu.isNaN(e)?e:e/Pu.LOG_10},Pu.min=function(t,e,n,r){var i=t;return e<i&&(i=e),n<i&&(i=n),r<i&&(i=r),i},Pu.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],i=arguments[1],o=arguments[2];return r<i?i:r>o?o:r}},Pu.wrap=function(t,e){return t<0?e- -t%e:t%e},Pu.max=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],r=t;return e>r&&(r=e),n>r&&(r=n),r}if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],u=i;return o>u&&(u=o),s>u&&(u=s),a>u&&(u=a),u}},Pu.average=function(t,e){return(t+e)/2},Ou.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(Pu,Ou);var Ru=function(t){this.str=t};Ru.prototype.append=function(t){this.str+=t},Ru.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},Ru.prototype.toString=function(t){return this.str};var Tu=function(t){this.value=t};Tu.prototype.intValue=function(){return this.value},Tu.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},Tu.isNaN=function(t){return Number.isNaN(t)};var Au=function(){};Au.isWhitespace=function(t){return t<=32&&t>=0||127===t},Au.toUpperCase=function(t){return t.toUpperCase()};var Du=function t(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}else if("string"==typeof arguments[0]){var r=arguments[0];t.call(this,t.parse(r))}}else if(2===arguments.length){var i=arguments[0],o=arguments[1];this.init(i,o)}},Fu={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Du.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo},Du.prototype.extractSignificantDigits=function(t,e){var n=this.abs(),r=Du.magnitude(n._hi),i=Du.TEN.pow(r);(n=n.divide(i)).gt(Du.TEN)?(n=n.divide(Du.TEN),r+=1):n.lt(Du.ONE)&&(n=n.multiply(Du.TEN),r-=1);for(var o=r+1,s=new Ru,a=Du.MAX_PRINT_DIGITS-1,u=0;u<=a;u++){t&&u===o&&s.append(".");var c=Math.trunc(n._hi);if(c<0)break;var h=!1,l=0;c>9?(h=!0,l="9"):l="0"+c,s.append(l),n=n.subtract(Du.valueOf(c)).multiply(Du.TEN),h&&n.selfAdd(Du.TEN);var p=!0,f=Du.magnitude(n._hi);if(f<0&&Math.abs(f)>=a-u&&(p=!1),!p)break}return e[0]=r,s.toString()},Du.prototype.sqr=function(){return this.multiply(this)},Du.prototype.doubleValue=function(){return this._hi+this._lo},Du.prototype.subtract=function(){if(arguments[0]instanceof Du){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},Du.prototype.equals=function(){if(1===arguments.length){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}},Du.prototype.isZero=function(){return 0===this._hi&&0===this._lo},Du.prototype.selfSubtract=function(){if(arguments[0]instanceof Du){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},Du.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},Du.prototype.min=function(t){return this.le(t)?this:t},Du.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof Du){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1],i=null,o=null,s=null,a=null,u=null,c=null,h=null,l=null;return u=this._hi/n,c=Du.SPLIT*u,i=c-u,l=Du.SPLIT*n,i=c-i,o=u-i,s=l-n,h=u*n,s=l-s,a=n-s,l=i*s-h+i*a+o*s+o*a,c=(this._hi-h-l+this._lo-u*r)/n,l=u+c,this._hi=l,this._lo=u-l+c,this}},Du.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},Du.prototype.divide=function(){if(arguments[0]instanceof Du){var t=arguments[0],e=null,n=null,r=null,i=null,o=null,s=null,a=null,u=null;n=(o=this._hi/t._hi)-(e=(s=Du.SPLIT*o)-(e=s-o)),u=e*(r=(u=Du.SPLIT*t._hi)-(r=u-t._hi))-(a=o*t._hi)+e*(i=t._hi-r)+n*r+n*i,s=(this._hi-a-u+this._lo-o*t._lo)/t._hi;return new Du(u=o+s,o-u+s)}if("number"==typeof arguments[0]){var c=arguments[0];return mu.isNaN(c)?Du.createNaN():Du.copy(this).selfDivide(c,0)}},Du.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo},Du.prototype.pow=function(t){if(0===t)return Du.valueOf(1);var e=new Du(this),n=Du.valueOf(1),r=Math.abs(t);if(r>1)for(;r>0;)r%2==1&&n.selfMultiply(e),(r/=2)>0&&(e=e.sqr());else n=e;return t<0?n.reciprocal():n},Du.prototype.ceil=function(){if(this.isNaN())return Du.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new Du(t,e)},Du.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0},Du.prototype.rint=function(){if(this.isNaN())return this;return this.add(.5).floor()},Du.prototype.setValue=function(){if(arguments[0]instanceof Du){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},Du.prototype.max=function(t){return this.ge(t)?this:t},Du.prototype.sqrt=function(){if(this.isZero())return Du.valueOf(0);if(this.isNegative())return Du.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,n=Du.valueOf(e),r=this.subtract(n.sqr())._hi*(.5*t);return n.add(r)},Du.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof Du){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0],n=null,r=null,i=null,o=null,s=null,a=null;return i=this._hi+e,s=i-this._hi,o=i-s,o=e-s+(this._hi-o),a=o+this._lo,n=i+a,r=a+(i-n),this._hi=n+r,this._lo=r+(n-this._hi),this}}else if(2===arguments.length){var u=arguments[0],c=arguments[1],h=null,l=null,p=null,f=null,g=null,d=null,y=null;f=this._hi+u,l=this._lo+c,g=f-(d=f-this._hi),p=l-(y=l-this._lo);var _=(h=f+(d=(g=u-d+(this._hi-g))+l))+(d=(p=c-y+(this._lo-p))+(d+(f-h))),m=d+(h-_);return this._hi=_,this._lo=m,this}},Du.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof Du){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1],i=null,o=null,s=null,a=null,u=null,c=null;i=(u=Du.SPLIT*this._hi)-this._hi,c=Du.SPLIT*n,i=u-i,o=this._hi-i,s=c-n;var h=(u=this._hi*n)+(c=i*(s=c-s)-u+i*(a=n-s)+o*s+o*a+(this._hi*r+this._lo*n)),l=c+(i=u-h);return this._hi=h,this._lo=l,this}},Du.prototype.selfSqr=function(){return this.selfMultiply(this)},Du.prototype.floor=function(){if(this.isNaN())return Du.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new Du(t,e)},Du.prototype.negate=function(){return this.isNaN()?this:new Du(-this._hi,-this._lo)},Du.prototype.clone=function(){},Du.prototype.multiply=function(){if(arguments[0]instanceof Du){var t=arguments[0];return t.isNaN()?Du.createNaN():Du.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return mu.isNaN(e)?Du.createNaN():Du.copy(this).selfMultiply(e,0)}},Du.prototype.isNaN=function(){return mu.isNaN(this._hi)},Du.prototype.intValue=function(){return Math.trunc(this._hi)},Du.prototype.toString=function(){var t=Du.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()},Du.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),r=e[0]+1,i=n;if("."===n.charAt(0))i="0"+n;else if(r<0)i="0."+Du.stringOfChar("0",-r)+n;else if(-1===n.indexOf(".")){var o=r-n.length;i=n+Du.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+i:i},Du.prototype.reciprocal=function(){var t=null,e=null,n=null,r=null,i=null,o=null,s=null,a=null;e=(i=1/this._hi)-(t=(o=Du.SPLIT*i)-(t=o-i)),n=(a=Du.SPLIT*this._hi)-this._hi;var u=i+(o=(1-(s=i*this._hi)-(a=t*(n=a-n)-s+t*(r=this._hi-n)+e*n+e*r)-i*this._lo)/this._hi);return new Du(u,i-u+o)},Du.prototype.toSciNotation=function(){if(this.isZero())return Du.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),r=Du.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===n.charAt(0))throw new Error("Found leading zero: "+n);var i="";n.length>1&&(i=n.substring(1));var o=n.charAt(0)+"."+i;return this.isNegative()?"-"+o+r:o+r},Du.prototype.abs=function(){return this.isNaN()?Du.NaN:this.isNegative()?this.negate():new Du(this)},Du.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},Du.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo},Du.prototype.add=function(){if(arguments[0]instanceof Du){var t=arguments[0];return Du.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return Du.copy(this).selfAdd(e)}},Du.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof Du){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this._hi=n,this._lo=r}},Du.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo},Du.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},Du.prototype.trunc=function(){return this.isNaN()?Du.NaN:this.isPositive()?this.floor():this.ceil()},Du.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},Du.prototype.interfaces_=function(){return[Li,xu,Eu]},Du.prototype.getClass=function(){return Du},Du.sqr=function(t){return Du.valueOf(t).selfMultiply(t)},Du.valueOf=function(){if("string"==typeof arguments[0]){var t=arguments[0];return Du.parse(t)}if("number"==typeof arguments[0]){var e=arguments[0];return new Du(e)}},Du.sqrt=function(t){return Du.valueOf(t).sqrt()},Du.parse=function(t){for(var e=0,n=t.length;Au.isWhitespace(t.charAt(e));)e++;var r=!1;if(e<n){var i=t.charAt(e);"-"!==i&&"+"!==i||(e++,"-"===i&&(r=!0))}for(var o=new Du,s=0,a=0,u=0;!(e>=n);){var c=t.charAt(e);if(e++,Au.isDigit(c)){var h=c-"0";o.selfMultiply(Du.TEN),o.selfAdd(h),s++}else{if("."!==c){if("e"===c||"E"===c){var l=t.substring(e);try{u=Tu.parseInt(l)}catch(e){throw e instanceof Error?new Error("Invalid exponent "+l+" in string "+t):e}break}throw new Error("Unexpected character '"+c+"' at position "+e+" in string "+t)}a=s}}var p=o,f=s-a-u;if(0===f)p=o;else if(f>0){var g=Du.TEN.pow(f);p=o.divide(g)}else if(f<0){var d=Du.TEN.pow(-f);p=o.multiply(d)}return r?p.negate():p},Du.createNaN=function(){return new Du(mu.NaN,mu.NaN)},Du.copy=function(t){return new Du(t)},Du.magnitude=function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),r=Math.trunc(Math.floor(n));return 10*Math.pow(10,r)<=e&&(r+=1),r},Du.stringOfChar=function(t,e){for(var n=new Ru,r=0;r<e;r++)n.append(t);return n.toString()},Fu.PI.get=function(){return new Du(3.141592653589793,1.2246467991473532e-16)},Fu.TWO_PI.get=function(){return new Du(6.283185307179586,2.4492935982947064e-16)},Fu.PI_2.get=function(){return new Du(1.5707963267948966,6.123233995736766e-17)},Fu.E.get=function(){return new Du(2.718281828459045,1.4456468917292502e-16)},Fu.NaN.get=function(){return new Du(mu.NaN,mu.NaN)},Fu.EPS.get=function(){return 1.23259516440783e-32},Fu.SPLIT.get=function(){return 134217729},Fu.MAX_PRINT_DIGITS.get=function(){return 32},Fu.TEN.get=function(){return Du.valueOf(10)},Fu.ONE.get=function(){return Du.valueOf(1)},Fu.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},Fu.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(Du,Fu);var qu=function(){},Gu={DP_SAFE_EPSILON:{configurable:!0}};qu.prototype.interfaces_=function(){return[]},qu.prototype.getClass=function(){return qu},qu.orientationIndex=function(t,e,n){var r=qu.orientationIndexFilter(t,e,n);if(r<=1)return r;var i=Du.valueOf(e.x).selfAdd(-t.x),o=Du.valueOf(e.y).selfAdd(-t.y),s=Du.valueOf(n.x).selfAdd(-e.x),a=Du.valueOf(n.y).selfAdd(-e.y);return i.selfMultiply(a).selfSubtract(o.selfMultiply(s)).signum()},qu.signOfDet2x2=function(t,e,n,r){return t.multiply(r).selfSubtract(e.multiply(n)).signum()},qu.intersection=function(t,e,n,r){var i=Du.valueOf(r.y).selfSubtract(n.y).selfMultiply(Du.valueOf(e.x).selfSubtract(t.x)),o=Du.valueOf(r.x).selfSubtract(n.x).selfMultiply(Du.valueOf(e.y).selfSubtract(t.y)),s=i.subtract(o),a=Du.valueOf(r.x).selfSubtract(n.x).selfMultiply(Du.valueOf(t.y).selfSubtract(n.y)),u=Du.valueOf(r.y).selfSubtract(n.y).selfMultiply(Du.valueOf(t.x).selfSubtract(n.x)),c=a.subtract(u).selfDivide(s).doubleValue(),h=Du.valueOf(t.x).selfAdd(Du.valueOf(e.x).selfSubtract(t.x).selfMultiply(c)).doubleValue(),l=Du.valueOf(e.x).selfSubtract(t.x).selfMultiply(Du.valueOf(t.y).selfSubtract(n.y)),p=Du.valueOf(e.y).selfSubtract(t.y).selfMultiply(Du.valueOf(t.x).selfSubtract(n.x)),f=l.subtract(p).selfDivide(s).doubleValue(),g=Du.valueOf(n.y).selfAdd(Du.valueOf(r.y).selfSubtract(n.y).selfMultiply(f)).doubleValue();return new bu(h,g)},qu.orientationIndexFilter=function(t,e,n){var r=null,i=(t.x-n.x)*(e.y-n.y),o=(t.y-n.y)*(e.x-n.x),s=i-o;if(i>0){if(o<=0)return qu.signum(s);r=i+o}else{if(!(i<0))return qu.signum(s);if(o>=0)return qu.signum(s);r=-i-o}var a=qu.DP_SAFE_EPSILON*r;return s>=a||-s>=a?qu.signum(s):2},qu.signum=function(t){return t>0?1:t<0?-1:0},Gu.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(qu,Gu);var Bu=function(){},ku={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};ku.X.get=function(){return 0},ku.Y.get=function(){return 1},ku.Z.get=function(){return 2},ku.M.get=function(){return 3},Bu.prototype.setOrdinate=function(t,e,n){},Bu.prototype.size=function(){},Bu.prototype.getOrdinate=function(t,e){},Bu.prototype.getCoordinate=function(){},Bu.prototype.getCoordinateCopy=function(t){},Bu.prototype.getDimension=function(){},Bu.prototype.getX=function(t){},Bu.prototype.clone=function(){},Bu.prototype.expandEnvelope=function(t){},Bu.prototype.copy=function(){},Bu.prototype.getY=function(t){},Bu.prototype.toCoordinateArray=function(){},Bu.prototype.interfaces_=function(){return[Eu]},Bu.prototype.getClass=function(){return Bu},Object.defineProperties(Bu,ku);var zu=function(){},ju=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(zu),Xu=function(){};Xu.arraycopy=function(t,e,n,r,i){for(var o=0,s=e;s<e+i;s++)n[r+o]=t[s],o++},Xu.getProperty=function(t){return{"line.separator":"\n"}[t]};var Uu=function t(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var i=arguments[0],o=arguments[1];this.x=i.y*o.w-o.y*i.w,this.y=o.x*i.w-i.x*o.w,this.w=i.x*o.y-o.x*i.y}else if(arguments[0]instanceof bu&&arguments[1]instanceof bu){var s=arguments[0],a=arguments[1];this.x=s.y-a.y,this.y=a.x-s.x,this.w=s.x*a.y-a.x*s.y}}else if(3===arguments.length){var u=arguments[0],c=arguments[1],h=arguments[2];this.x=u,this.y=c,this.w=h}else if(4===arguments.length){var l=arguments[0],p=arguments[1],f=arguments[2],g=arguments[3],d=l.y-p.y,y=p.x-l.x,_=l.x*p.y-p.x*l.y,m=f.y-g.y,v=g.x-f.x,x=f.x*g.y-g.x*f.y;this.x=y*x-v*_,this.y=m*_-d*x,this.w=d*v-m*y}};Uu.prototype.getY=function(){var t=this.y/this.w;if(mu.isNaN(t)||mu.isInfinite(t))throw new ju;return t},Uu.prototype.getX=function(){var t=this.x/this.w;if(mu.isNaN(t)||mu.isInfinite(t))throw new ju;return t},Uu.prototype.getCoordinate=function(){var t=new bu;return t.x=this.getX(),t.y=this.getY(),t},Uu.prototype.interfaces_=function(){return[]},Uu.prototype.getClass=function(){return Uu},Uu.intersection=function(t,e,n,r){var i=t.y-e.y,o=e.x-t.x,s=t.x*e.y-e.x*t.y,a=n.y-r.y,u=r.x-n.x,c=n.x*r.y-r.x*n.y,h=i*u-a*o,l=(o*c-u*s)/h,p=(a*s-i*c)/h;if(mu.isNaN(l)||mu.isInfinite(l)||mu.isNaN(p)||mu.isInfinite(p))throw new ju;return new bu(l,p)};var Yu=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof bu){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],u=arguments[3];this.init(o,s,a,u)}},Vu={serialVersionUID:{configurable:!0}};Yu.prototype.getArea=function(){return this.getWidth()*this.getHeight()},Yu.prototype.equals=function(t){if(!(t instanceof Yu))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()},Yu.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new Yu;var e=this._minx>t._minx?this._minx:t._minx,n=this._miny>t._miny?this._miny:t._miny,r=this._maxx<t._maxx?this._maxx:t._maxx,i=this._maxy<t._maxy?this._maxy:t._maxy;return new Yu(e,r,n,i)},Yu.prototype.isNull=function(){return this._maxx<this._minx},Yu.prototype.getMaxX=function(){return this._maxx},Yu.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof bu){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof Yu){var e=arguments[0];return!this.isNull()&&!e.isNull()&&(e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return!this.isNull()&&(n>=this._minx&&n<=this._maxx&&r>=this._miny&&r<=this._maxy)}},Yu.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof Yu){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof bu){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return!this.isNull()&&!(n>this._maxx||n<this._minx||r>this._maxy||r<this._miny)}},Yu.prototype.getMinY=function(){return this._miny},Yu.prototype.getMinX=function(){return this._minx},Yu.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof bu){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof Yu){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}},Yu.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},Yu.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},Yu.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0},Yu.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},Yu.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},Yu.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},Yu.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},Yu.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e},Yu.prototype.expandBy=function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},Yu.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof Yu){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof bu){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return this.covers(n,r)}},Yu.prototype.centre=function(){return this.isNull()?null:new bu((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},Yu.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof bu){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof Yu){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];i<o?(this._minx=i,this._maxx=o):(this._minx=o,this._maxx=i),s<a?(this._miny=s,this._maxy=a):(this._miny=a,this._maxy=s)}},Yu.prototype.getMaxY=function(){return this._maxy},Yu.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var n=0;return this._maxy<t._miny?n=t._miny-this._maxy:this._miny>t._maxy&&(n=this._miny-t._maxy),0===e?n:0===n?e:Math.sqrt(e*e+n*n)},Yu.prototype.hashCode=function(){var t=17;return t=37*t+bu.hashCode(this._minx),t=37*t+bu.hashCode(this._maxx),t=37*t+bu.hashCode(this._miny),t=37*t+bu.hashCode(this._maxy)},Yu.prototype.interfaces_=function(){return[xu,Li]},Yu.prototype.getClass=function(){return Yu},Yu.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],s=arguments[3],a=Math.min(o.x,s.x),u=Math.max(o.x,s.x),c=Math.min(r.x,i.x),h=Math.max(r.x,i.x);return!(c>u)&&(!(h<a)&&(a=Math.min(o.y,s.y),u=Math.max(o.y,s.y),c=Math.min(r.y,i.y),h=Math.max(r.y,i.y),!(c>u)&&!(h<a)))}},Vu.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(Yu,Vu);var Hu={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Wu=function(t){this.geometryFactory=t||new _h};Wu.prototype.read=function(t){var e,n,r;t=t.replace(/[\n\r]/g," ");var i=Hu.typeStr.exec(t);if(-1!==t.search("EMPTY")&&((i=Hu.emptyTypeStr.exec(t))[2]=void 0),i&&(n=i[1].toLowerCase(),r=i[2],Zu[n]&&(e=Zu[n].apply(this,[r]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},Wu.prototype.write=function(t){return this.extractGeometry(t)},Wu.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!Ju[e])return null;var n=e.toUpperCase();return t.isEmpty()?n+" EMPTY":n+"("+Ju[e].apply(this,[t])+")"};var Ju={coordinate:function(t){return t.x+" "+t.y},point:function(t){return Ju.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push("("+Ju.point.apply(this,[t._geometries[n]])+")");return e.join(",")},linestring:function(t){for(var e=[],n=0,r=t._points._coordinates.length;n<r;++n)e.push(Ju.coordinate.apply(this,[t._points._coordinates[n]]));return e.join(",")},linearring:function(t){for(var e=[],n=0,r=t._points._coordinates.length;n<r;++n)e.push(Ju.coordinate.apply(this,[t._points._coordinates[n]]));return e.join(",")},multilinestring:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push("("+Ju.linestring.apply(this,[t._geometries[n]])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+Ju.linestring.apply(this,[t._shell])+")");for(var n=0,r=t._holes.length;n<r;++n)e.push("("+Ju.linestring.apply(this,[t._holes[n]])+")");return e.join(",")},multipolygon:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push("("+Ju.polygon.apply(this,[t._geometries[n]])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],n=0,r=t._geometries.length;n<r;++n)e.push(this.extractGeometry(t._geometries[n]));return e.join(",")}},Zu={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split(Hu.spaces);return this.geometryFactory.createPoint(new bu(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){if(void 0===t)return this.geometryFactory.createMultiPoint();for(var e,n=t.trim().split(","),r=[],i=0,o=n.length;i<o;++i)e=n[i].replace(Hu.trimParens,"$1"),r.push(Zu.point.apply(this,[e]));return this.geometryFactory.createMultiPoint(r)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,n=t.trim().split(","),r=[],i=0,o=n.length;i<o;++i)e=n[i].trim().split(Hu.spaces),r.push(new bu(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(r)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,n=t.trim().split(","),r=[],i=0,o=n.length;i<o;++i)e=n[i].trim().split(Hu.spaces),r.push(new bu(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(t){if(void 0===t)return this.geometryFactory.createMultiLineString();for(var e,n=t.trim().split(Hu.parenComma),r=[],i=0,o=n.length;i<o;++i)e=n[i].replace(Hu.trimParens,"$1"),r.push(Zu.linestring.apply(this,[e]));return this.geometryFactory.createMultiLineString(r)},polygon:function(t){if(void 0===t)return this.geometryFactory.createPolygon();for(var e,n,r,i,o=t.trim().split(Hu.parenComma),s=[],a=0,u=o.length;a<u;++a)e=o[a].replace(Hu.trimParens,"$1"),n=Zu.linestring.apply(this,[e]),r=this.geometryFactory.createLinearRing(n._points),0===a?i=r:s.push(r);return this.geometryFactory.createPolygon(i,s)},multipolygon:function(t){if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var e,n=t.trim().split(Hu.doubleParenComma),r=[],i=0,o=n.length;i<o;++i)e=n[i].replace(Hu.trimParens,"$1"),r.push(Zu.polygon.apply(this,[e]));return this.geometryFactory.createMultiPolygon(r)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();for(var e=(t=t.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),n=[],r=0,i=e.length;r<i;++r)n.push(this.read(e[r]));return this.geometryFactory.createGeometryCollection(n)}},Ku=function(t){this.parser=new Wu(t)};Ku.prototype.write=function(t){return this.parser.write(t)},Ku.toLineString=function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var Qu=function(t){function e(e){t.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),$u=function(t){function e(){if(t.call(this),0===arguments.length)t.call(this);else if(1===arguments.length){var e=arguments[0];t.call(this,e)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Qu),tc=function(){};tc.prototype.interfaces_=function(){return[]},tc.prototype.getClass=function(){return tc},tc.shouldNeverReachHere=function(){if(0===arguments.length)tc.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new $u("Should never reach here"+(null!==t?": "+t:""))}},tc.isTrue=function(){var t,e;if(1===arguments.length)t=arguments[0],tc.isTrue(t,null);else if(2===arguments.length&&(t=arguments[0],e=arguments[1],!t))throw null===e?new $u:new $u(e)},tc.equals=function(){var t,e,n;if(2===arguments.length)t=arguments[0],e=arguments[1],tc.equals(t,e,null);else if(3===arguments.length&&(t=arguments[0],e=arguments[1],n=arguments[2],!e.equals(t)))throw new $u("Expected "+t+" but encountered "+e+(null!==n?": "+n:""))};var ec=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new bu,this._intPt[1]=new bu,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},nc={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};ec.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]},ec.prototype.getTopologySummary=function(){var t=new Ru;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},ec.prototype.computeIntersection=function(t,e,n,r){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(t,e,n,r)},ec.prototype.getIntersectionNum=function(){return this._result},ec.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0];this.getEdgeDistance(t,0)>this.getEdgeDistance(t,1)?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}},ec.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},ec.prototype.setPrecisionModel=function(t){this._precisionModel=t},ec.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=arguments[0],e=0;e<this._result;e++)if(!this._intPt[e].equals2D(this._inputLines[t][0])&&!this._intPt[e].equals2D(this._inputLines[t][1]))return!0;return!1}},ec.prototype.getIntersection=function(t){return this._intPt[t]},ec.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},ec.prototype.hasIntersection=function(){return this._result!==ec.NO_INTERSECTION},ec.prototype.getEdgeDistance=function(t,e){return ec.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])},ec.prototype.isCollinear=function(){return this._result===ec.COLLINEAR_INTERSECTION},ec.prototype.toString=function(){return Ku.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Ku.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},ec.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]},ec.prototype.isIntersection=function(t){for(var e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1},ec.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]},ec.prototype.interfaces_=function(){return[]},ec.prototype.getClass=function(){return ec},ec.computeEdgeDistance=function(t,e,n){var r=Math.abs(n.x-e.x),i=Math.abs(n.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(n))o=r>i?r:i;else{var s=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);0!==(o=r>i?s:a)||t.equals(e)||(o=Math.max(s,a))}return tc.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o},ec.nonRobustComputeEdgeDistance=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,o=Math.sqrt(r*r+i*i);return tc.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o},nc.DONT_INTERSECT.get=function(){return 0},nc.DO_INTERSECT.get=function(){return 1},nc.COLLINEAR.get=function(){return 2},nc.NO_INTERSECTION.get=function(){return 0},nc.POINT_INTERSECTION.get=function(){return 1},nc.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(ec,nc);var rc=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(t){var e=new Yu(this._inputLines[0][0],this._inputLines[0][1]),n=new Yu(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&n.contains(t)},e.prototype.computeIntersection=function(){if(3!==arguments.length)return t.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],n=arguments[1],r=arguments[2];if(this._isProper=!1,Yu.intersects(n,r,e)&&0===sc.orientationIndex(n,r,e)&&0===sc.orientationIndex(r,n,e))return this._isProper=!0,(e.equals(n)||e.equals(r))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION},e.prototype.normalizeToMinimum=function(t,e,n,r,i){i.x=this.smallestInAbsValue(t.x,e.x,n.x,r.x),i.y=this.smallestInAbsValue(t.y,e.y,n.y,r.y),t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,n.x-=i.x,n.y-=i.y,r.x-=i.x,r.y-=i.y},e.prototype.safeHCoordinateIntersection=function(t,n,r,i){var o=null;try{o=Uu.intersection(t,n,r,i)}catch(s){if(!(s instanceof ju))throw s;o=e.nearestEndpoint(t,n,r,i)}return o},e.prototype.intersection=function(t,n,r,i){var o=this.intersectionWithNormalization(t,n,r,i);return this.isInSegmentEnvelopes(o)||(o=new bu(e.nearestEndpoint(t,n,r,i))),null!==this._precisionModel&&this._precisionModel.makePrecise(o),o},e.prototype.smallestInAbsValue=function(t,e,n,r){var i=t,o=Math.abs(i);return Math.abs(e)<o&&(i=e,o=Math.abs(e)),Math.abs(n)<o&&(i=n,o=Math.abs(n)),Math.abs(r)<o&&(i=r),i},e.prototype.checkDD=function(t,e,n,r,i){var o=qu.intersection(t,e,n,r),s=this.isInSegmentEnvelopes(o);Xu.out.println("DD in env = "+s+"  --------------------- "+o),i.distance(o)>1e-4&&Xu.out.println("Distance = "+i.distance(o))},e.prototype.intersectionWithNormalization=function(t,e,n,r){var i=new bu(t),o=new bu(e),s=new bu(n),a=new bu(r),u=new bu;this.normalizeToEnvCentre(i,o,s,a,u);var c=this.safeHCoordinateIntersection(i,o,s,a);return c.x+=u.x,c.y+=u.y,c},e.prototype.computeCollinearIntersection=function(e,n,r,i){var o=Yu.intersects(e,n,r),s=Yu.intersects(e,n,i),a=Yu.intersects(r,i,e),u=Yu.intersects(r,i,n);return o&&s?(this._intPt[0]=r,this._intPt[1]=i,t.COLLINEAR_INTERSECTION):a&&u?(this._intPt[0]=e,this._intPt[1]=n,t.COLLINEAR_INTERSECTION):o&&a?(this._intPt[0]=r,this._intPt[1]=e,!r.equals(e)||s||u?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):o&&u?(this._intPt[0]=r,this._intPt[1]=n,!r.equals(n)||s||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&a?(this._intPt[0]=i,this._intPt[1]=e,!i.equals(e)||o||u?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&u?(this._intPt[0]=i,this._intPt[1]=n,!i.equals(n)||o||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(t,e,n,r,i){var o=t.x<e.x?t.x:e.x,s=t.y<e.y?t.y:e.y,a=t.x>e.x?t.x:e.x,u=t.y>e.y?t.y:e.y,c=n.x<r.x?n.x:r.x,h=n.y<r.y?n.y:r.y,l=n.x>r.x?n.x:r.x,p=n.y>r.y?n.y:r.y,f=((o>c?o:c)+(a<l?a:l))/2,g=((s>h?s:h)+(u<p?u:p))/2;i.x=f,i.y=g,t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,n.x-=i.x,n.y-=i.y,r.x-=i.x,r.y-=i.y},e.prototype.computeIntersect=function(e,n,r,i){if(this._isProper=!1,!Yu.intersects(e,n,r,i))return t.NO_INTERSECTION;var o=sc.orientationIndex(e,n,r),s=sc.orientationIndex(e,n,i);if(o>0&&s>0||o<0&&s<0)return t.NO_INTERSECTION;var a=sc.orientationIndex(r,i,e),u=sc.orientationIndex(r,i,n);if(a>0&&u>0||a<0&&u<0)return t.NO_INTERSECTION;return 0===o&&0===s&&0===a&&0===u?this.computeCollinearIntersection(e,n,r,i):(0===o||0===s||0===a||0===u?(this._isProper=!1,e.equals2D(r)||e.equals2D(i)?this._intPt[0]=e:n.equals2D(r)||n.equals2D(i)?this._intPt[0]=n:0===o?this._intPt[0]=new bu(r):0===s?this._intPt[0]=new bu(i):0===a?this._intPt[0]=new bu(e):0===u&&(this._intPt[0]=new bu(n))):(this._isProper=!0,this._intPt[0]=this.intersection(e,n,r,i)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(t,e,n,r){var i=t,o=sc.distancePointLine(t,n,r),s=sc.distancePointLine(e,n,r);return s<o&&(o=s,i=e),(s=sc.distancePointLine(n,t,e))<o&&(o=s,i=n),(s=sc.distancePointLine(r,t,e))<o&&(o=s,i=r),i},e}(ec),ic=function(){};ic.prototype.interfaces_=function(){return[]},ic.prototype.getClass=function(){return ic},ic.orientationIndex=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=n.x-e.x,s=n.y-e.y;return ic.signOfDet2x2(r,i,o,s)},ic.signOfDet2x2=function(t,e,n,r){var i=null,o=null,s=null;if(i=1,0===t||0===r)return 0===e||0===n?0:e>0?n>0?-i:i:n>0?i:-i;if(0===e||0===n)return r>0?t>0?i:-i:t>0?-i:i;if(e>0?r>0?e<=r||(i=-i,o=t,t=n,n=o,o=e,e=r,r=o):e<=-r?(i=-i,n=-n,r=-r):(o=t,t=-n,n=o,o=e,e=-r,r=o):r>0?-e<=r?(i=-i,t=-t,e=-e):(o=-t,t=n,n=o,o=-e,e=r,r=o):e>=r?(t=-t,e=-e,n=-n,r=-r):(i=-i,o=-t,t=-n,n=o,o=-e,e=-r,r=o),t>0){if(!(n>0))return i;if(!(t<=n))return i}else{if(n>0)return-i;if(!(t>=n))return-i;i=-i,t=-t,n=-n}for(;;){if(s=Math.floor(n/t),n-=s*t,(r-=s*e)<0)return-i;if(r>e)return i;if(t>n+n){if(e<r+r)return i}else{if(e>r+r)return-i;n=t-n,r=e-r,i=-i}if(0===r)return 0===n?0:-i;if(0===n)return i;if(s=Math.floor(t/n),t-=s*n,(e-=s*r)<0)return i;if(e>r)return-i;if(n>t+t){if(r<e+e)return-i}else{if(r>e+e)return i;t=n-t,e=r-e,i=-i}if(0===e)return 0===t?0:i;if(0===t)return-i}};var oc=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};oc.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var n=t.x,r=e.x;return n>r&&(n=e.x,r=t.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var i=t.x-this._p.x,o=t.y-this._p.y,s=e.x-this._p.x,a=e.y-this._p.y,u=ic.signOfDet2x2(i,o,s,a);if(0===u)return this._isPointOnSegment=!0,null;a<o&&(u=-u),u>0&&this._crossingCount++}},oc.prototype.isPointInPolygon=function(){return this.getLocation()!==Su.EXTERIOR},oc.prototype.getLocation=function(){return this._isPointOnSegment?Su.BOUNDARY:this._crossingCount%2==1?Su.INTERIOR:Su.EXTERIOR},oc.prototype.isOnSegment=function(){return this._isPointOnSegment},oc.prototype.interfaces_=function(){return[]},oc.prototype.getClass=function(){return oc},oc.locatePointInRing=function(){if(arguments[0]instanceof bu&&Lu(arguments[1],Bu)){for(var t=arguments[0],e=arguments[1],n=new oc(t),r=new bu,i=new bu,o=1;o<e.size();o++)if(e.getCoordinate(o,r),e.getCoordinate(o-1,i),n.countSegment(r,i),n.isOnSegment())return n.getLocation();return n.getLocation()}if(arguments[0]instanceof bu&&arguments[1]instanceof Array){for(var s=arguments[0],a=arguments[1],u=new oc(s),c=1;c<a.length;c++){var h=a[c],l=a[c-1];if(u.countSegment(h,l),u.isOnSegment())return u.getLocation()}return u.getLocation()}};var sc=function(){},ac={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};sc.prototype.interfaces_=function(){return[]},sc.prototype.getClass=function(){return sc},sc.orientationIndex=function(t,e,n){return qu.orientationIndex(t,e,n)},sc.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,r=1;r<t.length-1;r++){var i=t[r].x-n,o=t[r+1].y;e+=i*(t[r-1].y-o)}return e/2}if(Lu(arguments[0],Bu)){var s=arguments[0],a=s.size();if(a<3)return 0;var u=new bu,c=new bu,h=new bu;s.getCoordinate(0,c),s.getCoordinate(1,h);var l=c.x;h.x-=l;for(var p=0,f=1;f<a-1;f++)u.y=c.y,c.x=h.x,c.y=h.y,s.getCoordinate(f+1,h),h.x-=l,p+=c.x*(u.y-h.y);return p/2}},sc.distanceLineLine=function(t,e,n,r){if(t.equals(e))return sc.distancePointLine(t,n,r);if(n.equals(r))return sc.distancePointLine(r,t,e);var i=!1;if(Yu.intersects(t,e,n,r)){var o=(e.x-t.x)*(r.y-n.y)-(e.y-t.y)*(r.x-n.x);if(0===o)i=!0;else{var s=(t.y-n.y)*(r.x-n.x)-(t.x-n.x)*(r.y-n.y),a=((t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y))/o,u=s/o;(u<0||u>1||a<0||a>1)&&(i=!0)}}else i=!0;return i?Pu.min(sc.distancePointLine(t,n,r),sc.distancePointLine(e,n,r),sc.distancePointLine(n,t,e),sc.distancePointLine(r,t,e)):0},sc.isPointInRing=function(t,e){return sc.locatePointInRing(t,e)!==Su.EXTERIOR},sc.computeLength=function(t){var e=t.size();if(e<=1)return 0;var n=0,r=new bu;t.getCoordinate(0,r);for(var i=r.x,o=r.y,s=1;s<e;s++){t.getCoordinate(s,r);var a=r.x,u=r.y,c=a-i,h=u-o;n+=Math.sqrt(c*c+h*h),i=a,o=u}return n},sc.isCCW=function(t){var e=t.length-1;if(e<3)throw new _u("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],r=0,i=1;i<=e;i++){var o=t[i];o.y>n.y&&(n=o,r=i)}var s=r;do{(s-=1)<0&&(s=e)}while(t[s].equals2D(n)&&s!==r);var a=r;do{a=(a+1)%e}while(t[a].equals2D(n)&&a!==r);var u=t[s],c=t[a];if(u.equals2D(n)||c.equals2D(n)||u.equals2D(c))return!1;var h=sc.computeOrientation(u,n,c),l=!1;return l=0===h?u.x>c.x:h>0,l},sc.locatePointInRing=function(t,e){return oc.locatePointInRing(t,e)},sc.distancePointLinePerpendicular=function(t,e,n){var r=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),i=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/r;return Math.abs(i)*Math.sqrt(r)},sc.computeOrientation=function(t,e,n){return sc.orientationIndex(t,e,n)},sc.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new _u("Line array must contain at least one vertex");for(var n=t.distance(e[0]),r=0;r<e.length-1;r++){var i=sc.distancePointLine(t,e[r],e[r+1]);i<n&&(n=i)}return n}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];if(s.x===a.x&&s.y===a.y)return o.distance(s);var u=(a.x-s.x)*(a.x-s.x)+(a.y-s.y)*(a.y-s.y),c=((o.x-s.x)*(a.x-s.x)+(o.y-s.y)*(a.y-s.y))/u;if(c<=0)return o.distance(s);if(c>=1)return o.distance(a);var h=((s.y-o.y)*(a.x-s.x)-(s.x-o.x)*(a.y-s.y))/u;return Math.abs(h)*Math.sqrt(u)}},sc.isOnLine=function(t,e){for(var n=new rc,r=1;r<e.length;r++){var i=e[r-1],o=e[r];if(n.computeIntersection(t,i,o),n.hasIntersection())return!0}return!1},ac.CLOCKWISE.get=function(){return-1},ac.RIGHT.get=function(){return sc.CLOCKWISE},ac.COUNTERCLOCKWISE.get=function(){return 1},ac.LEFT.get=function(){return sc.COUNTERCLOCKWISE},ac.COLLINEAR.get=function(){return 0},ac.STRAIGHT.get=function(){return sc.COLLINEAR},Object.defineProperties(sc,ac);var uc=function(){};uc.prototype.filter=function(t){},uc.prototype.interfaces_=function(){return[]},uc.prototype.getClass=function(){return uc};var cc=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},hc={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};cc.prototype.isGeometryCollection=function(){return this.getSortIndex()===cc.SORTINDEX_GEOMETRYCOLLECTION},cc.prototype.getFactory=function(){return this._factory},cc.prototype.getGeometryN=function(t){return this},cc.prototype.getArea=function(){return 0},cc.prototype.isRectangle=function(){return!1},cc.prototype.equals=function(){if(arguments[0]instanceof cc){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof cc))return!1;var n=e;return this.equalsExact(n)}},cc.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)},cc.prototype.geometryChanged=function(){this.apply(cc.geometryChangedFilter)},cc.prototype.geometryChangedAction=function(){this._envelope=null},cc.prototype.equalsNorm=function(t){return null!==t&&this.norm().equalsExact(t.norm())},cc.prototype.getLength=function(){return 0},cc.prototype.getNumGeometries=function(){return 1},cc.prototype.compareTo=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var n=arguments[0],r=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,r)}},cc.prototype.getUserData=function(){return this._userData},cc.prototype.getSRID=function(){return this._SRID},cc.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},cc.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===cc.SORTINDEX_GEOMETRYCOLLECTION)throw new _u("This method does not support GeometryCollection arguments")},cc.prototype.equal=function(t,e,n){return 0===n?t.equals(e):t.distance(e)<=n},cc.prototype.norm=function(){var t=this.copy();return t.normalize(),t},cc.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},cc.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new Yu(this._envelope)},cc.prototype.setSRID=function(t){this._SRID=t},cc.prototype.setUserData=function(t){this._userData=t},cc.prototype.compare=function(t,e){for(var n=t.iterator(),r=e.iterator();n.hasNext()&&r.hasNext();){var i=n.next(),o=r.next(),s=i.compareTo(o);if(0!==s)return s}return n.hasNext()?1:r.hasNext()?-1:0},cc.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},cc.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===cc.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===cc.SORTINDEX_MULTIPOINT||this.getSortIndex()===cc.SORTINDEX_MULTILINESTRING||this.getSortIndex()===cc.SORTINDEX_MULTIPOLYGON},cc.prototype.interfaces_=function(){return[Eu,xu,Li]},cc.prototype.getClass=function(){return cc},cc.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},cc.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},hc.serialVersionUID.get=function(){return 0x799ea46522854c00},hc.SORTINDEX_POINT.get=function(){return 0},hc.SORTINDEX_MULTIPOINT.get=function(){return 1},hc.SORTINDEX_LINESTRING.get=function(){return 2},hc.SORTINDEX_LINEARRING.get=function(){return 3},hc.SORTINDEX_MULTILINESTRING.get=function(){return 4},hc.SORTINDEX_POLYGON.get=function(){return 5},hc.SORTINDEX_MULTIPOLYGON.get=function(){return 6},hc.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},hc.geometryChangedFilter.get=function(){return lc},Object.defineProperties(cc,hc);var lc=function(){};lc.interfaces_=function(){return[uc]},lc.filter=function(t){t.geometryChangedAction()};var pc=function(){};pc.prototype.filter=function(t){},pc.prototype.interfaces_=function(){return[]},pc.prototype.getClass=function(){return pc};var fc=function(){},gc={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};fc.prototype.isInBoundary=function(t){},fc.prototype.interfaces_=function(){return[]},fc.prototype.getClass=function(){return fc},gc.Mod2BoundaryNodeRule.get=function(){return dc},gc.EndPointBoundaryNodeRule.get=function(){return yc},gc.MultiValentEndPointBoundaryNodeRule.get=function(){return _c},gc.MonoValentEndPointBoundaryNodeRule.get=function(){return mc},gc.MOD2_BOUNDARY_RULE.get=function(){return new dc},gc.ENDPOINT_BOUNDARY_RULE.get=function(){return new yc},gc.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new _c},gc.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new mc},gc.OGC_SFS_BOUNDARY_RULE.get=function(){return fc.MOD2_BOUNDARY_RULE},Object.defineProperties(fc,gc);var dc=function(){};dc.prototype.isInBoundary=function(t){return t%2==1},dc.prototype.interfaces_=function(){return[fc]},dc.prototype.getClass=function(){return dc};var yc=function(){};yc.prototype.isInBoundary=function(t){return t>0},yc.prototype.interfaces_=function(){return[fc]},yc.prototype.getClass=function(){return yc};var _c=function(){};_c.prototype.isInBoundary=function(t){return t>1},_c.prototype.interfaces_=function(){return[fc]},_c.prototype.getClass=function(){return _c};var mc=function(){};mc.prototype.isInBoundary=function(t){return 1===t},mc.prototype.interfaces_=function(){return[fc]},mc.prototype.getClass=function(){return mc};var vc=function(){};vc.prototype.add=function(){},vc.prototype.addAll=function(){},vc.prototype.isEmpty=function(){},vc.prototype.iterator=function(){},vc.prototype.size=function(){},vc.prototype.toArray=function(){},vc.prototype.remove=function(){};var xc=function(t){function e(e){t.call(this),this.message=e||""}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={name:{configurable:!0}};return n.name.get=function(){return"IndexOutOfBoundsException"},Object.defineProperties(e,n),e}(Error),Ec=function(){};Ec.prototype.hasNext=function(){},Ec.prototype.next=function(){},Ec.prototype.remove=function(){};var wc=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(vc);(Pi.prototype=new Error).name="NoSuchElementException";var bc=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof vc&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,vc]},e.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.set=function(t,e){var n=this.array_[t];return this.array_[t]=e,n},e.prototype.iterator=function(){return new Ic(this)},e.prototype.get=function(t){if(t<0||t>=this.size())throw new xc;return this.array_[t]},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},e.prototype.remove=function(t){for(var e=!1,n=0,r=this.array_.length;n<r;n++)if(this.array_[n]===t){this.array_.splice(n,1),e=!0;break}return e},e}(wc),Ic=function(t){function e(e){t.call(this),this.arrayList_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Pi;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(Ec),Nc=function(t){function e(){if(t.call(this),0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.ensureCapacity(n.length),this.add(n,r)}}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(t){return this.get(t)},e.prototype.addAll=function(){if(2===arguments.length){for(var e=arguments[0],n=arguments[1],r=!1,i=e.iterator();i.hasNext();)this.add(i.next(),n),r=!0;return r}return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var e=t.prototype.clone.call(this),n=0;n<this.size();n++)e.add(n,this.get(n).copy());return e},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){if(1===arguments.length){var e=arguments[0];t.prototype.add.call(this,e)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var n=arguments[0],r=arguments[1];return this.add(n,r,!0),!0}if(arguments[0]instanceof bu&&"boolean"==typeof arguments[1]){var i=arguments[0];if(!arguments[1]&&this.size()>=1){if(this.get(this.size()-1).equals2D(i))return null}t.prototype.add.call(this,i)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1];return this.add(o,s),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var a=arguments[0],u=arguments[1];if(arguments[2])for(var c=0;c<a.length;c++)this.add(a[c],u);else for(var h=a.length-1;h>=0;h--)this.add(a[h],u);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof bu){var l=arguments[0],p=arguments[1];if(!arguments[2]){var f=this.size();if(f>0){if(l>0){if(this.get(l-1).equals2D(p))return null}if(l<f){if(this.get(l).equals2D(p))return null}}}t.prototype.add.call(this,l,p)}}else if(4===arguments.length){var g=arguments[0],d=arguments[1],y=arguments[2],_=arguments[3],m=1;y>_&&(m=-1);for(var v=y;v!==_;v+=m)this.add(g[v],d);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new bu(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,n),e}(bc),Cc=function(){},Sc={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Sc.ForwardComparator.get=function(){return Mc},Sc.BidirectionalComparator.get=function(){return Lc},Sc.coordArrayType.get=function(){return new Array(0).fill(null)},Cc.prototype.interfaces_=function(){return[]},Cc.prototype.getClass=function(){return Cc},Cc.isRing=function(t){return!(t.length<4)&&!!t[0].equals2D(t[t.length-1])},Cc.ptNotInList=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(Cc.indexOf(r,e)<0)return r}return null},Cc.scroll=function(t,e){var n=Cc.indexOf(e,t);if(n<0)return null;var r=new Array(t.length).fill(null);Xu.arraycopy(t,n,r,0,t.length-n),Xu.arraycopy(t,0,r,t.length-n,n),Xu.arraycopy(r,0,t,0,t.length)},Cc.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];if(r===i)return!0;if(null===r||null===i)return!1;if(r.length!==i.length)return!1;for(var s=0;s<r.length;s++)if(0!==o.compare(r[s],i[s]))return!1;return!0}},Cc.intersection=function(t,e){for(var n=new Nc,r=0;r<t.length;r++)e.intersects(t[r])&&n.add(t[r],!0);return n.toCoordinateArray()},Cc.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},Cc.removeRepeatedPoints=function(t){if(!Cc.hasRepeatedPoints(t))return t;return new Nc(t,!1).toCoordinateArray()},Cc.reverse=function(t){for(var e=t.length-1,n=Math.trunc(e/2),r=0;r<=n;r++){var i=t[r];t[r]=t[e-r],t[e-r]=i}},Cc.removeNull=function(t){for(var e=0,n=0;n<t.length;n++)null!==t[n]&&e++;var r=new Array(e).fill(null);if(0===e)return r;for(var i=0,o=0;o<t.length;o++)null!==t[o]&&(r[i++]=t[o]);return r},Cc.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=new bu(t[n]);return e}if(5===arguments.length)for(var r=arguments[0],i=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],u=0;u<a;u++)o[s+u]=new bu(r[i+u])},Cc.isEqualReversed=function(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=e[t.length-n-1];if(0!==r.compareTo(i))return!1}return!0},Cc.envelope=function(t){for(var e=new Yu,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e},Cc.toCoordinateArray=function(t){return t.toArray(Cc.coordArrayType)},Cc.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},Cc.indexOf=function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1},Cc.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t.length-1-e,r=t[e].compareTo(t[n]);if(0!==r)return r}return 1},Cc.compare=function(t,e){for(var n=0;n<t.length&&n<e.length;){var r=t[n].compareTo(e[n]);if(0!==r)return r;n++}return n<e.length?-1:n<t.length?1:0},Cc.minCoordinate=function(t){for(var e=null,n=0;n<t.length;n++)(null===e||e.compareTo(t[n])>0)&&(e=t[n]);return e},Cc.extract=function(t,e,n){e=Pu.clamp(e,0,t.length);var r=(n=Pu.clamp(n,-1,t.length))-e+1;n<0&&(r=0),e>=t.length&&(r=0),n<e&&(r=0);var i=new Array(r).fill(null);if(0===r)return i;for(var o=0,s=e;s<=n;s++)i[o++]=t[s];return i},Object.defineProperties(Cc,Sc);var Mc=function(){};Mc.prototype.compare=function(t,e){return Cc.compare(t,e)},Mc.prototype.interfaces_=function(){return[wu]},Mc.prototype.getClass=function(){return Mc};var Lc=function(){};Lc.prototype.compare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;var i=Cc.compare(n,r);return Cc.isEqualReversed(n,r)?0:i},Lc.prototype.OLDcompare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;for(var i=Cc.increasingDirection(n),o=Cc.increasingDirection(r),s=i>0?0:n.length-1,a=o>0?0:n.length-1,u=0;u<n.length;u++){var c=n[s].compareTo(r[a]);if(0!==c)return c;s+=i,a+=o}return 0},Lc.prototype.interfaces_=function(){return[wu]},Lc.prototype.getClass=function(){return Lc};var Pc=function(){};Pc.prototype.get=function(){},Pc.prototype.put=function(){},Pc.prototype.size=function(){},Pc.prototype.values=function(){},Pc.prototype.entrySet=function(){};var Oc=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Pc);(Oi.prototype=new Error).name="OperationNotSupported",(Ri.prototype=new vc).contains=function(){};var Rc=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof vc&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(t){for(var e=0,n=this.array_.length;e<n;e++){if(this.array_[e]===t)return!0}return!1},e.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.remove=function(t){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},e.prototype.iterator=function(){return new Tc(this)},e}(Ri),Tc=function(t){function e(e){t.call(this),this.hashSet_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Pi;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new Oi},e}(Ec),Ac=0;(Gi.prototype=new Oc).get=function(t){for(var e=this.root_;null!==e;){var n=t.compareTo(e.key);if(n<0)e=e.left;else{if(!(n>0))return e.value;e=e.right}}return null},Gi.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Ac,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,r,i=this.root_;do{if(n=i,(r=t.compareTo(i.key))<0)i=i.left;else{if(!(r>0)){var o=i.value;return i.value=e,o}i=i.right}}while(null!==i);var s={key:t,left:null,right:null,value:e,parent:n,color:Ac,getValue:function(){return this.value},getKey:function(){return this.key}};return r<0?n.left=s:n.right=s,this.fixAfterInsertion(s),this.size_++,null},Gi.prototype.fixAfterInsertion=function(t){for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)if(Ai(t)===Fi(Ai(Ai(t)))){var e=qi(Ai(Ai(t)));1===Ti(e)?(Di(Ai(t),Ac),Di(e,Ac),Di(Ai(Ai(t)),1),t=Ai(Ai(t))):(t===qi(Ai(t))&&(t=Ai(t),this.rotateLeft(t)),Di(Ai(t),Ac),Di(Ai(Ai(t)),1),this.rotateRight(Ai(Ai(t))))}else{var n=Fi(Ai(Ai(t)));1===Ti(n)?(Di(Ai(t),Ac),Di(n,Ac),Di(Ai(Ai(t)),1),t=Ai(Ai(t))):(t===Fi(Ai(t))&&(t=Ai(t),this.rotateRight(t)),Di(Ai(t),Ac),Di(Ai(Ai(t)),1),this.rotateLeft(Ai(Ai(t))))}this.root_.color=Ac},Gi.prototype.values=function(){var t=new bc,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=Gi.successor(e));)t.add(e.value);return t},Gi.prototype.entrySet=function(){var t=new Rc,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=Gi.successor(e));)t.add(e);return t},Gi.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}},Gi.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}},Gi.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},Gi.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var n=t.parent,r=t;null!==n&&r===n.right;)r=n,n=n.parent;return n},Gi.prototype.size=function(){return this.size_};var Dc=function(){};Dc.prototype.interfaces_=function(){return[]},Dc.prototype.getClass=function(){return Dc},Bi.prototype=new Ri,(ki.prototype=new Bi).contains=function(t){for(var e=0,n=this.array_.length;e<n;e++){if(0===this.array_[e].compareTo(t))return!0}return!1},ki.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,n=this.array_.length;e<n;e++){if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0}return this.array_.push(t),!0},ki.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},ki.prototype.remove=function(t){throw new Oi},ki.prototype.size=function(){return this.array_.length},ki.prototype.isEmpty=function(){return 0===this.array_.length},ki.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},ki.prototype.iterator=function(){return new Fc(this)};var Fc=function(t){this.treeSet_=t,this.position_=0};Fc.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Pi;return this.treeSet_.array_[this.position_++]},Fc.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Fc.prototype.remove=function(){throw new Oi};var qc=function(){};qc.sort=function(){var t,e,n,r,i=arguments[0];if(1===arguments.length)r=function(t,e){return t.compareTo(e)},i.sort(r);else if(2===arguments.length)n=arguments[1],r=function(t,e){return n.compare(t,e)},i.sort(r);else if(3===arguments.length){(e=i.slice(arguments[1],arguments[2])).sort();var o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length));for(i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])}else if(4===arguments.length)for(e=i.slice(arguments[1],arguments[2]),n=arguments[3],r=function(t,e){return n.compare(t,e)},e.sort(r),o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length)),i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])},qc.asList=function(t){for(var e=new bc,n=0,r=t.length;n<r;n++)e.add(t[n]);return e};var Gc=function(){},Bc={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Bc.P.get=function(){return 0},Bc.L.get=function(){return 1},Bc.A.get=function(){return 2},Bc.FALSE.get=function(){return-1},Bc.TRUE.get=function(){return-2},Bc.DONTCARE.get=function(){return-3},Bc.SYM_FALSE.get=function(){return"F"},Bc.SYM_TRUE.get=function(){return"T"},Bc.SYM_DONTCARE.get=function(){return"*"},Bc.SYM_P.get=function(){return"0"},Bc.SYM_L.get=function(){return"1"},Bc.SYM_A.get=function(){return"2"},Gc.prototype.interfaces_=function(){return[]},Gc.prototype.getClass=function(){return Gc},Gc.toDimensionSymbol=function(t){switch(t){case Gc.FALSE:return Gc.SYM_FALSE;case Gc.TRUE:return Gc.SYM_TRUE;case Gc.DONTCARE:return Gc.SYM_DONTCARE;case Gc.P:return Gc.SYM_P;case Gc.L:return Gc.SYM_L;case Gc.A:return Gc.SYM_A}throw new _u("Unknown dimension value: "+t)},Gc.toDimensionValue=function(t){switch(Au.toUpperCase(t)){case Gc.SYM_FALSE:return Gc.FALSE;case Gc.SYM_TRUE:return Gc.TRUE;case Gc.SYM_DONTCARE:return Gc.DONTCARE;case Gc.SYM_P:return Gc.P;case Gc.SYM_L:return Gc.L;case Gc.SYM_A:return Gc.A}throw new _u("Unknown dimension symbol: "+t)},Object.defineProperties(Gc,Bc);var kc=function(){};kc.prototype.filter=function(t){},kc.prototype.interfaces_=function(){return[]},kc.prototype.getClass=function(){return kc};var zc=function(){};zc.prototype.filter=function(t,e){},zc.prototype.isDone=function(){},zc.prototype.isGeometryChanged=function(){},zc.prototype.interfaces_=function(){return[]},zc.prototype.getClass=function(){return zc};var jc=function(t){function e(e,n){if(t.call(this,n),this._geometries=e||[],t.hasNullElements(this._geometries))throw new _u("geometries must not contain null elements")}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var t=new Yu,e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t},e.prototype.getGeometryN=function(t){return this._geometries[t]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=0;n<this._geometries.length;n++)for(var r=this._geometries[n].getCoordinates(),i=0;i<r.length;i++)t[++e]=r[i];return t},e.prototype.getArea=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];if(!this.isEquivalentClass(e))return!1;var r=e;if(this._geometries.length!==r._geometries.length)return!1;for(var i=0;i<this._geometries.length;i++)if(!this._geometries[i].equalsExact(r._geometries[i],n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<this._geometries.length;t++)this._geometries[t].normalize();qc.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var t=Gc.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t},e.prototype.getDimension=function(){for(var t=Gc.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t},e.prototype.getLength=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[n]=this._geometries[n].reverse();return this.getFactory().createGeometryCollection(e)},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=new ki(qc.asList(this._geometries)),n=new ki(qc.asList(t._geometries));return this.compare(e,n)}if(2===arguments.length){for(var r=arguments[0],i=arguments[1],o=r,s=this.getNumGeometries(),a=o.getNumGeometries(),u=0;u<s&&u<a;){var c=this.getGeometryN(u),h=o.getGeometryN(u),l=c.compareToSameClass(h,i);if(0!==l)return l;u++}return u<s?1:u<a?-1:0}},e.prototype.apply=function(){if(Lu(arguments[0],pc))for(var t=arguments[0],e=0;e<this._geometries.length;e++)this._geometries[e].apply(t);else if(Lu(arguments[0],zc)){var n=arguments[0];if(0===this._geometries.length)return null;for(var r=0;r<this._geometries.length&&(this._geometries[r].apply(n),!n.isDone());r++);n.isGeometryChanged()&&this.geometryChanged()}else if(Lu(arguments[0],kc)){var i=arguments[0];i.filter(this);for(var o=0;o<this._geometries.length;o++)this._geometries[o].apply(i)}else if(Lu(arguments[0],uc)){var s=arguments[0];s.filter(this);for(var a=0;a<this._geometries.length;a++)this._geometries[a].apply(s)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),tc.shouldNeverReachHere(),null},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._geometries=new Array(this._geometries.length).fill(null);for(var n=0;n<this._geometries.length;n++)e._geometries[n]=this._geometries[n].clone();return e},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.isEmpty=function(){for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(e,n),e}(cc),Xc=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return cc.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Gc.FALSE:0},e.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[t-1-n]=this._geometries[n].reverse();return this.getFactory().createMultiLineString(e)},e.prototype.getBoundary=function(){return new Uc(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Dc]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(e,n),e}(jc),Uc=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var t=arguments[0],e=fc.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=r}};Uc.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)},Uc.prototype.getBoundary=function(){return this._geom instanceof Jc?this.boundaryLineString(this._geom):this._geom instanceof Xc?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Uc.prototype.boundaryLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(t.isClosed()){return this._bnRule.isInBoundary(2)?t.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},Uc.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Uc.prototype.computeBoundaryCoordinates=function(t){var e=new bc;this._endpointMap=new Gi;for(var n=0;n<t.getNumGeometries();n++){var r=t.getGeometryN(n);0!==r.getNumPoints()&&(this.addEndpoint(r.getCoordinateN(0)),this.addEndpoint(r.getCoordinateN(r.getNumPoints()-1)))}for(var i=this._endpointMap.entrySet().iterator();i.hasNext();){var o=i.next(),s=o.getValue().count;this._bnRule.isInBoundary(s)&&e.add(o.getKey())}return Cc.toCoordinateArray(e)},Uc.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);null===e&&(e=new Yc,this._endpointMap.put(t,e)),e.count++},Uc.prototype.interfaces_=function(){return[]},Uc.prototype.getClass=function(){return Uc},Uc.getBoundary=function(){if(1===arguments.length){var t=arguments[0];return new Uc(t).getBoundary()}if(2===arguments.length){var e=arguments[0],n=arguments[1];return new Uc(e,n).getBoundary()}};var Yc=function(){this.count=null};Yc.prototype.interfaces_=function(){return[]},Yc.prototype.getClass=function(){return Yc};var Vc=function(){},Hc={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Vc.prototype.interfaces_=function(){return[]},Vc.prototype.getClass=function(){return Vc},Vc.chars=function(t,e){for(var n=new Array(e).fill(null),r=0;r<e;r++)n[r]=t;return String(n)},Vc.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new function(){},n=new function(){}(e);return t.printStackTrace(n),e.toString()}if(2===arguments.length){for(var r=arguments[0],i=arguments[1],o="",s=new function(){}(new function(){}(Vc.getStackTrace(r))),a=0;a<i;a++)try{o+=s.readLine()+Vc.NEWLINE}catch(t){if(!(t instanceof zi))throw t;tc.shouldNeverReachHere()}return o}},Vc.split=function(t,e){for(var n=e.length,r=new bc,i=""+t,o=i.indexOf(e);o>=0;){var s=i.substring(0,o);r.add(s),o=(i=i.substring(o+n)).indexOf(e)}i.length>0&&r.add(i);for(var a=new Array(r.size()).fill(null),u=0;u<a.length;u++)a[u]=r.get(u);return a},Vc.toString=function(){if(1===arguments.length){var t=arguments[0];return Vc.SIMPLE_ORDINATE_FORMAT.format(t)}},Vc.spaces=function(t){return Vc.chars(" ",t)},Hc.NEWLINE.get=function(){return Xu.getProperty("line.separator")},Hc.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(Vc,Hc);var Wc=function(){};Wc.prototype.interfaces_=function(){return[]},Wc.prototype.getClass=function(){return Wc},Wc.copyCoord=function(t,e,n,r){for(var i=Math.min(t.getDimension(),n.getDimension()),o=0;o<i;o++)n.setOrdinate(r,o,t.getOrdinate(e,o))},Wc.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&(t.getOrdinate(0,Bu.X)===t.getOrdinate(e-1,Bu.X)&&t.getOrdinate(0,Bu.Y)===t.getOrdinate(e-1,Bu.Y))},Wc.isEqual=function(t,e){var n=t.size();if(n!==e.size())return!1;for(var r=Math.min(t.getDimension(),e.getDimension()),i=0;i<n;i++)for(var o=0;o<r;o++){var s=t.getOrdinate(i,o),a=e.getOrdinate(i,o);if(t.getOrdinate(i,o)!==e.getOrdinate(i,o)&&(!mu.isNaN(s)||!mu.isNaN(a)))return!1}return!0},Wc.extend=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();if(Wc.copy(e,0,r,0,i),i>0)for(var o=i;o<n;o++)Wc.copy(e,i-1,r,o,1);return r},Wc.reverse=function(t){for(var e=t.size()-1,n=Math.trunc(e/2),r=0;r<=n;r++)Wc.swap(t,r,e-r)},Wc.swap=function(t,e,n){if(e===n)return null;for(var r=0;r<t.getDimension();r++){var i=t.getOrdinate(e,r);t.setOrdinate(e,r,t.getOrdinate(n,r)),t.setOrdinate(n,r,i)}},Wc.copy=function(t,e,n,r,i){for(var o=0;o<i;o++)Wc.copyCoord(t,e+o,n,r+o)},Wc.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var n=t.getDimension(),r=new Ru;r.append("(");for(var i=0;i<e;i++){i>0&&r.append(" ");for(var o=0;o<n;o++)o>0&&r.append(","),r.append(Vc.toString(t.getOrdinate(i,o)))}return r.append(")"),r.toString()}},Wc.ensureValidRing=function(t,e){var n=e.size();if(0===n)return e;if(n<=3)return Wc.createClosedRing(t,e,4);return e.getOrdinate(0,Bu.X)===e.getOrdinate(n-1,Bu.X)&&e.getOrdinate(0,Bu.Y)===e.getOrdinate(n-1,Bu.Y)?e:Wc.createClosedRing(t,e,n+1)},Wc.createClosedRing=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();Wc.copy(e,0,r,0,i);for(var o=i;o<n;o++)Wc.copy(e,0,r,o,1);return r};var Jc=function(t){function e(e,n){t.call(this,n),this._points=null,this.init(e)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Yu:this._points.expandEnvelope(new Yu)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];if(!this.isEquivalentClass(e))return!1;var r=e;if(this._points.size()!==r._points.size())return!1;for(var i=0;i<this._points.size();i++)if(!this.equal(this._points.getCoordinate(i),r._points.getCoordinate(i),n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<Math.trunc(this._points.size()/2);t++){var e=this._points.size()-1-t;if(!this._points.getCoordinate(t).equals(this._points.getCoordinate(e)))return this._points.getCoordinate(t).compareTo(this._points.getCoordinate(e))>0&&Wc.reverse(this._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Gc.FALSE:0},e.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return sc.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var t=this._points.copy();Wc.reverse(t);return this.getFactory().createLineString(t)},e.prototype.compareToSameClass=function(){if(1===arguments.length){for(var t=arguments[0],e=0,n=0;e<this._points.size()&&n<t._points.size();){var r=this._points.getCoordinate(e).compareTo(t._points.getCoordinate(n));if(0!==r)return r;e++,n++}return e<this._points.size()?1:n<t._points.size()?-1:0}if(2===arguments.length){var i=arguments[0];return arguments[1].compare(this._points,i._points)}},e.prototype.apply=function(){if(Lu(arguments[0],pc))for(var t=arguments[0],e=0;e<this._points.size();e++)t.filter(this._points.getCoordinate(e));else if(Lu(arguments[0],zc)){var n=arguments[0];if(0===this._points.size())return null;for(var r=0;r<this._points.size()&&(n.filter(this._points,r),!n.isDone());r++);n.isGeometryChanged()&&this.geometryChanged()}else if(Lu(arguments[0],kc)){arguments[0].filter(this)}else if(Lu(arguments[0],uc)){arguments[0].filter(this)}},e.prototype.getBoundary=function(){return new Uc(this).getBoundary()},e.prototype.isEquivalentClass=function(t){return t instanceof e},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._points=this._points.clone(),e},e.prototype.getCoordinateN=function(t){return this._points.getCoordinate(t)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return 0===this._points.size()},e.prototype.init=function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new _u("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t},e.prototype.isCoordinate=function(t){for(var e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(t){return this.getFactory().createPoint(this._points.getCoordinate(t))},e.prototype.interfaces_=function(){return[Dc]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,n),e}(cc),Zc=function(){};Zc.prototype.interfaces_=function(){return[]},Zc.prototype.getClass=function(){return Zc};var Kc=function(t){function e(e,n){t.call(this,n),this._coordinates=e||null,this.init(this._coordinates)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Yu;var t=new Yu;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),n))}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Gc.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0];return this.getCoordinate().compareTo(t.getCoordinate())}if(2===arguments.length){var e=arguments[0];return arguments[1].compare(this._coordinates,e._coordinates)}},e.prototype.apply=function(){if(Lu(arguments[0],pc)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(Lu(arguments[0],zc)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this._coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else if(Lu(arguments[0],kc)){arguments[0].filter(this)}else if(Lu(arguments[0],uc)){arguments[0].filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._coordinates=this._coordinates.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this._coordinates.size()},e.prototype.init=function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),tc.isTrue(t.size()<=1),this._coordinates=t},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Zc]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,n),e}(cc),Qc=function(){};Qc.prototype.interfaces_=function(){return[]},Qc.prototype.getClass=function(){return Qc};var $c=function(t){function e(e,n,r){if(t.call(this,r),this._shell=null,this._holes=null,null===e&&(e=this.getFactory().createLinearRing()),null===n&&(n=[]),t.hasNullElements(n))throw new _u("holes must not contain null elements");if(e.isEmpty()&&t.hasNonEmptyElements(n))throw new _u("shell is empty but holes are not");this._shell=e,this._holes=n}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=this._shell.getCoordinates(),r=0;r<n.length;r++)t[++e]=n[r];for(var i=0;i<this._holes.length;i++)for(var o=this._holes[i].getCoordinates(),s=0;s<o.length;s++)t[++e]=o[s];return t},e.prototype.getArea=function(){var t=0;t+=Math.abs(sc.signedArea(this._shell.getCoordinateSequence()));for(var e=0;e<this._holes.length;e++)t-=Math.abs(sc.signedArea(this._holes[e].getCoordinateSequence()));return t},e.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),n=0;n<5;n++){var r=t.getX(n);if(r!==e.getMinX()&&r!==e.getMaxX())return!1;var i=t.getY(n);if(i!==e.getMinY()&&i!==e.getMaxY())return!1}for(var o=t.getX(0),s=t.getY(0),a=1;a<=4;a++){var u=t.getX(a),c=t.getY(a);if(u!==o===(c!==s))return!1;o=u,s=c}return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];if(!this.isEquivalentClass(e))return!1;var r=e,i=this._shell,o=r._shell;if(!i.equalsExact(o,n))return!1;if(this._holes.length!==r._holes.length)return!1;for(var s=0;s<this._holes.length;s++)if(!this._holes[s].equalsExact(r._holes[s],n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var t=0;t<this._holes.length;t++)this.normalize(this._holes[t],!1);qc.sort(this._holes)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(e.isEmpty())return null;var r=new Array(e.getCoordinates().length-1).fill(null);Xu.arraycopy(e.getCoordinates(),0,r,0,r.length);var i=Cc.minCoordinate(e.getCoordinates());Cc.scroll(r,i),Xu.arraycopy(r,0,e.getCoordinates(),0,r.length),e.getCoordinates()[r.length]=r[0],sc.isCCW(e.getCoordinates())===n&&Cc.reverse(e.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var t=0;t+=this._shell.getLength();for(var e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=this._shell.getNumPoints(),e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t},e.prototype.reverse=function(){var t=this.copy();t._shell=this._shell.copy().reverse(),t._holes=new Array(this._holes.length).fill(null);for(var e=0;e<this._holes.length;e++)t._holes[e]=this._holes[e].copy().reverse();return t},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=this._shell,n=t._shell;return e.compareToSameClass(n)}if(2===arguments.length){var r=arguments[0],i=arguments[1],o=r,s=this._shell,a=o._shell,u=s.compareToSameClass(a,i);if(0!==u)return u;for(var c=this.getNumInteriorRing(),h=o.getNumInteriorRing(),l=0;l<c&&l<h;){var p=this.getInteriorRingN(l),f=o.getInteriorRingN(l),g=p.compareToSameClass(f,i);if(0!==g)return g;l++}return l<c?1:l<h?-1:0}},e.prototype.apply=function(t){if(Lu(t,pc)){this._shell.apply(t);for(var e=0;e<this._holes.length;e++)this._holes[e].apply(t)}else if(Lu(t,zc)){if(this._shell.apply(t),!t.isDone())for(var n=0;n<this._holes.length&&(this._holes[n].apply(t),!t.isDone());n++);t.isGeometryChanged()&&this.geometryChanged()}else if(Lu(t,kc))t.filter(this);else if(Lu(t,uc)){t.filter(this),this._shell.apply(t);for(var r=0;r<this._holes.length;r++)this._holes[r].apply(t)}},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(var e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._shell=this._shell.clone(),e._holes=new Array(this._holes.length).fill(null);for(var n=0;n<this._holes.length;n++)e._holes[n]=this._holes[n].clone();return e},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var t=this._shell.copy(),n=new Array(this._holes.length).fill(null),r=0;r<n.length;r++)n[r]=this._holes[r].copy();return new e(t,n,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(t){return this._holes[t]},e.prototype.interfaces_=function(){return[Qc]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,n),e}(cc),th=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return cc.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._geometries[e].getCoordinate()}return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return Gc.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Zc]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(e,n),e}(jc),eh=function(t){function e(e,n){e instanceof bu&&n instanceof _h&&(e=n.getCoordinateSequenceFactory().create(e)),t.call(this,e,n),this.validateConstruction()}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return cc.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Gc.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var t=this._points.copy();Wc.reverse(t);return this.getFactory().createLinearRing(t)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new _u("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new _u("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,n),e}(Jc),nh=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return cc.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[n]=this._geometries[n].reverse();return this.getFactory().createMultiPolygon(e)},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new bc,e=0;e<this._geometries.length;e++)for(var n=this._geometries[e].getBoundary(),r=0;r<n.getNumGeometries();r++)t.add(n.getGeometryN(r));var i=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(i))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),n=0;n<t.length;n++)t[n]=this._geometries[n].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Qc]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,n),e}(jc),rh=function(t){this._factory=t||null,this._isUserDataCopied=!1},ih={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};rh.prototype.setCopyUserData=function(t){this._isUserDataCopied=t},rh.prototype.edit=function(t,e){if(null===t)return null;var n=this.editInternal(t,e);return this._isUserDataCopied&&n.setUserData(t.getUserData()),n},rh.prototype.editInternal=function(t,e){return null===this._factory&&(this._factory=t.getFactory()),t instanceof jc?this.editGeometryCollection(t,e):t instanceof $c?this.editPolygon(t,e):t instanceof Kc?e.edit(t,this._factory):t instanceof Jc?e.edit(t,this._factory):(tc.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},rh.prototype.editGeometryCollection=function(t,e){for(var n=e.edit(t,this._factory),r=new bc,i=0;i<n.getNumGeometries();i++){var o=this.edit(n.getGeometryN(i),e);null===o||o.isEmpty()||r.add(o)}return n.getClass()===th?this._factory.createMultiPoint(r.toArray([])):n.getClass()===Xc?this._factory.createMultiLineString(r.toArray([])):n.getClass()===nh?this._factory.createMultiPolygon(r.toArray([])):this._factory.createGeometryCollection(r.toArray([]))},rh.prototype.editPolygon=function(t,e){var n=e.edit(t,this._factory);if(null===n&&(n=this._factory.createPolygon(null)),n.isEmpty())return n;var r=this.edit(n.getExteriorRing(),e);if(null===r||r.isEmpty())return this._factory.createPolygon();for(var i=new bc,o=0;o<n.getNumInteriorRing();o++){var s=this.edit(n.getInteriorRingN(o),e);null===s||s.isEmpty()||i.add(s)}return this._factory.createPolygon(r,i.toArray([]))},rh.prototype.interfaces_=function(){return[]},rh.prototype.getClass=function(){return rh},rh.GeometryEditorOperation=function(){},ih.NoOpGeometryOperation.get=function(){return oh},ih.CoordinateOperation.get=function(){return sh},ih.CoordinateSequenceOperation.get=function(){return ah},Object.defineProperties(rh,ih);var oh=function(){};oh.prototype.edit=function(t,e){return t},oh.prototype.interfaces_=function(){return[rh.GeometryEditorOperation]},oh.prototype.getClass=function(){return oh};var sh=function(){};sh.prototype.edit=function(t,e){var n=this.editCoordinates(t.getCoordinates(),t);return null===n?t:t instanceof eh?e.createLinearRing(n):t instanceof Jc?e.createLineString(n):t instanceof Kc?n.length>0?e.createPoint(n[0]):e.createPoint():t},sh.prototype.interfaces_=function(){return[rh.GeometryEditorOperation]},sh.prototype.getClass=function(){return sh};var ah=function(){};ah.prototype.edit=function(t,e){return t instanceof eh?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Jc?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Kc?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},ah.prototype.interfaces_=function(){return[rh.GeometryEditorOperation]},ah.prototype.getClass=function(){return ah};var uh=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var e=0;e<t;e++)this._coordinates[e]=new bu}else if(Lu(arguments[0],Bu)){var n=arguments[0];if(null===n)return this._coordinates=new Array(0).fill(null),null;this._dimension=n.getDimension(),this._coordinates=new Array(n.size()).fill(null);for(var r=0;r<this._coordinates.length;r++)this._coordinates[r]=n.getCoordinateCopy(r)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var i=arguments[0],o=arguments[1];this._coordinates=i,this._dimension=o,null===i&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var s=arguments[0],a=arguments[1];this._coordinates=new Array(s).fill(null),this._dimension=a;for(var u=0;u<s;u++)this._coordinates[u]=new bu}},ch={serialVersionUID:{configurable:!0}};uh.prototype.setOrdinate=function(t,e,n){switch(e){case Bu.X:this._coordinates[t].x=n;break;case Bu.Y:this._coordinates[t].y=n;break;case Bu.Z:this._coordinates[t].z=n;break;default:throw new _u("invalid ordinateIndex")}},uh.prototype.size=function(){return this._coordinates.length},uh.prototype.getOrdinate=function(t,e){switch(e){case Bu.X:return this._coordinates[t].x;case Bu.Y:return this._coordinates[t].y;case Bu.Z:return this._coordinates[t].z}return mu.NaN},uh.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this._coordinates[t]}if(2===arguments.length){var e=arguments[0],n=arguments[1];n.x=this._coordinates[e].x,n.y=this._coordinates[e].y,n.z=this._coordinates[e].z}},uh.prototype.getCoordinateCopy=function(t){return new bu(this._coordinates[t])},uh.prototype.getDimension=function(){return this._dimension},uh.prototype.getX=function(t){return this._coordinates[t].x},uh.prototype.clone=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].clone();return new uh(t,this._dimension)},uh.prototype.expandEnvelope=function(t){for(var e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t},uh.prototype.copy=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].copy();return new uh(t,this._dimension)},uh.prototype.toString=function(){if(this._coordinates.length>0){var t=new Ru(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}return"()"},uh.prototype.getY=function(t){return this._coordinates[t].y},uh.prototype.toCoordinateArray=function(){return this._coordinates},uh.prototype.interfaces_=function(){return[Bu,Li]},uh.prototype.getClass=function(){return uh},ch.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(uh,ch);var hh=function(){},lh={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};hh.prototype.readResolve=function(){return hh.instance()},hh.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return new uh(t)}if(Lu(arguments[0],Bu)){var e=arguments[0];return new uh(e)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return r>3&&(r=3),r<2?new uh(n):new uh(n,r)}},hh.prototype.interfaces_=function(){return[Cu,Li]},hh.prototype.getClass=function(){return hh},hh.instance=function(){return hh.instanceObject},lh.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},lh.instanceObject.get=function(){return new hh},Object.defineProperties(hh,lh);var ph=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return this.map_.get(t)||null},e.prototype.put=function(t,e){return this.map_.set(t,e),e},e.prototype.values=function(){for(var t=new bc,e=this.map_.values(),n=e.next();!n.done;)t.add(n.value),n=e.next();return t},e.prototype.entrySet=function(){var t=new Rc;return this.map_.entries().forEach(function(e){return t.add(e)}),t},e.prototype.size=function(){return this.map_.size()},e}(Pc),fh=function t(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=t.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof dh){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this._modelType=t.FIXED,this.setScale(n)}else if(arguments[0]instanceof t){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}},gh={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};fh.prototype.equals=function(t){if(!(t instanceof fh))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale},fh.prototype.compareTo=function(t){var e=t,n=this.getMaximumSignificantDigits(),r=e.getMaximumSignificantDigits();return new Tu(n).compareTo(new Tu(r))},fh.prototype.getScale=function(){return this._scale},fh.prototype.isFloating=function(){return this._modelType===fh.FLOATING||this._modelType===fh.FLOATING_SINGLE},fh.prototype.getType=function(){return this._modelType},fh.prototype.toString=function(){var t="UNKNOWN";return this._modelType===fh.FLOATING?t="Floating":this._modelType===fh.FLOATING_SINGLE?t="Floating-Single":this._modelType===fh.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},fh.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var t=arguments[0];if(mu.isNaN(t))return t;if(this._modelType===fh.FLOATING_SINGLE){return t}return this._modelType===fh.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof bu){var e=arguments[0];if(this._modelType===fh.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},fh.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===fh.FLOATING?t=16:this._modelType===fh.FLOATING_SINGLE?t=6:this._modelType===fh.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},fh.prototype.setScale=function(t){this._scale=Math.abs(t)},fh.prototype.interfaces_=function(){return[Li,xu]},fh.prototype.getClass=function(){return fh},fh.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e},gh.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},gh.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(fh,gh);var dh=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},yh={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};dh.prototype.readResolve=function(){return dh.nameToTypeMap.get(this._name)},dh.prototype.toString=function(){return this._name},dh.prototype.interfaces_=function(){return[Li]},dh.prototype.getClass=function(){return dh},yh.serialVersionUID.get=function(){return-552860263173159e4},yh.nameToTypeMap.get=function(){return new ph},Object.defineProperties(dh,yh),fh.Type=dh,fh.FIXED=new dh("FIXED"),fh.FLOATING=new dh("FLOATING"),fh.FLOATING_SINGLE=new dh("FLOATING SINGLE");var _h=function t(){this._precisionModel=new fh,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?Lu(arguments[0],Cu)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof fh&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},mh={serialVersionUID:{configurable:!0}};_h.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new bu(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new bu(t.getMinX(),t.getMinY()),new bu(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new bu(t.getMinX(),t.getMinY()),new bu(t.getMinX(),t.getMaxY()),new bu(t.getMaxX(),t.getMaxY()),new bu(t.getMaxX(),t.getMinY()),new bu(t.getMinX(),t.getMinY())]),null)},_h.prototype.createLineString=function(t){return t?t instanceof Array?new Jc(this.getCoordinateSequenceFactory().create(t),this):Lu(t,Bu)?new Jc(t,this):void 0:new Jc(this.getCoordinateSequenceFactory().create([]),this)},_h.prototype.createMultiLineString=function(){if(0===arguments.length)return new Xc(null,this);if(1===arguments.length){var t=arguments[0];return new Xc(t,this)}},_h.prototype.buildGeometry=function(t){for(var e=null,n=!1,r=!1,i=t.iterator();i.hasNext();){var o=i.next(),s=o.getClass();null===e&&(e=s),s!==e&&(n=!0),o.isGeometryCollectionOrDerived()&&(r=!0)}if(null===e)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection(_h.toGeometryArray(t));var a=t.iterator().next();if(t.size()>1){if(a instanceof $c)return this.createMultiPolygon(_h.toPolygonArray(t));if(a instanceof Jc)return this.createMultiLineString(_h.toLineStringArray(t));if(a instanceof Kc)return this.createMultiPoint(_h.toPointArray(t));tc.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a},_h.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},_h.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof bu){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(Lu(arguments[0],Bu)){var e=arguments[0];return new Kc(e,this)}}},_h.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},_h.prototype.createPolygon=function(){if(0===arguments.length)return new $c(null,null,this);if(1===arguments.length){if(Lu(arguments[0],Bu)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof eh){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];return new $c(r,i,this)}},_h.prototype.getSRID=function(){return this._SRID},_h.prototype.createGeometryCollection=function(){if(0===arguments.length)return new jc(null,this);if(1===arguments.length){var t=arguments[0];return new jc(t,this)}},_h.prototype.createGeometry=function(t){return new rh(this).edit(t,{edit:function(){if(2===arguments.length){var t=arguments[0];return this._coordinateSequenceFactory.create(t)}}})},_h.prototype.getPrecisionModel=function(){return this._precisionModel},_h.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(Lu(arguments[0],Bu)){var e=arguments[0];return new eh(e,this)}}},_h.prototype.createMultiPolygon=function(){if(0===arguments.length)return new nh(null,this);if(1===arguments.length){var t=arguments[0];return new nh(t,this)}},_h.prototype.createMultiPoint=function(){if(0===arguments.length)return new th(null,this);if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return new th(t,this)}if(arguments[0]instanceof Array){var e=arguments[0];return this.createMultiPoint(null!==e?this.getCoordinateSequenceFactory().create(e):null)}if(Lu(arguments[0],Bu)){var n=arguments[0];if(null===n)return this.createMultiPoint(new Array(0).fill(null));for(var r=new Array(n.size()).fill(null),i=0;i<n.size();i++){var o=this.getCoordinateSequenceFactory().create(1,n.getDimension());Wc.copy(n,i,o,0,1),r[i]=this.createPoint(o)}return this.createMultiPoint(r)}}},_h.prototype.interfaces_=function(){return[Li]},_h.prototype.getClass=function(){return _h},_h.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.getDefaultCoordinateSequenceFactory=function(){return hh.instance()},_h.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_h.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},mh.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(_h,mh);var vh=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],xh=function(t){this.geometryFactory=t||new _h};xh.prototype.read=function(t){var e,n=(e="string"==typeof t?JSON.parse(t):t).type;if(!Eh[n])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==vh.indexOf(n)?Eh[n].apply(this,[e.coordinates]):"GeometryCollection"===n?Eh[n].apply(this,[e.geometries]):Eh[n].apply(this,[e])},xh.prototype.write=function(t){var e=t.getGeometryType();if(!wh[e])throw new Error("Geometry is not supported");return wh[e].apply(this,[t])};var Eh={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var r=t.geometry.type;if(!Eh[r])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=Eh.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var n=0;n<t.features.length;++n)e.features.push(this.read(t.features[n]))}return t.bbox&&(e.bbox=this.parse.bbox.apply(this,[t.bbox])),e},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(new bu(r[0],r[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new bu(t[0],t[1]),new bu(t[2],t[1]),new bu(t[2],t[3]),new bu(t[0],t[3]),new bu(t[0],t[1])])},Point:function(t){var e=new bu(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],n=0;n<t.length;++n)e.push(Eh.Point.apply(this,[t[n]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=Eh.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],n=0;n<t.length;++n)e.push(Eh.LineString.apply(this,[t[n]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=Eh.coordinates.apply(this,[t[0]]),n=this.geometryFactory.createLinearRing(e),r=[],i=1;i<t.length;++i){var o=t[i],s=Eh.coordinates.apply(this,[o]),a=this.geometryFactory.createLinearRing(s);r.push(a)}return this.geometryFactory.createPolygon(n,r)},MultiPolygon:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(Eh.Polygon.apply(this,[r]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(this.read(r))}return this.geometryFactory.createGeometryCollection(e)}},wh={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:wh.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=wh.Point.apply(this,[r]);e.push(i.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],n=t.getCoordinates(),r=0;r<n.length;++r){var i=n[r];e.push(wh.coordinate.apply(this,[i]))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=wh.LineString.apply(this,[r]);e.push(i.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],n=wh.LineString.apply(this,[t._shell]);e.push(n.coordinates);for(var r=0;r<t._holes.length;++r){var i=t._holes[r],o=wh.LineString.apply(this,[i]);e.push(o.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=wh.Polygon.apply(this,[r]);e.push(i.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var r=t._geometries[n],i=r.getGeometryType();e.push(wh[i].apply(this,[r]))}return{type:"GeometryCollection",geometries:e}}},bh=function(t){this.geometryFactory=t||new _h,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new xh(this.geometryFactory)};bh.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===fh.FIXED&&this.reducePrecision(e),e},bh.prototype.reducePrecision=function(t){var e,n;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,n=t.points.length;e<n;e++)this.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,n=t.geometries.length;e<n;e++)this.reducePrecision(t.geometries[e])};var Ih=function(){this.parser=new xh(this.geometryFactory)};Ih.prototype.write=function(t){return this.parser.write(t)};var Nh=function(){},Ch={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};Nh.prototype.interfaces_=function(){return[]},Nh.prototype.getClass=function(){return Nh},Nh.opposite=function(t){return t===Nh.LEFT?Nh.RIGHT:t===Nh.RIGHT?Nh.LEFT:t},Ch.ON.get=function(){return 0},Ch.LEFT.get=function(){return 1},Ch.RIGHT.get=function(){return 2},Object.defineProperties(Nh,Ch),(ji.prototype=new Error).name="EmptyStackException",(Xi.prototype=new wc).add=function(t){return this.array_.push(t),!0},Xi.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]},Xi.prototype.push=function(t){return this.array_.push(t),t},Xi.prototype.pop=function(t){if(0===this.array_.length)throw new ji;return this.array_.pop()},Xi.prototype.peek=function(){if(0===this.array_.length)throw new ji;return this.array_[this.array_.length-1]},Xi.prototype.empty=function(){return 0===this.array_.length},Xi.prototype.isEmpty=function(){return this.empty()},Xi.prototype.search=function(t){return this.array_.indexOf(t)},Xi.prototype.size=function(){return this.array_.length},Xi.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t};var Sh=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Sh.prototype.getCoordinate=function(){return this._minCoord},Sh.prototype.getRightmostSide=function(t,e){var n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),n},Sh.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();tc.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],n=t[this._minIndex+1],r=sc.computeOrientation(this._minCoord,n,e),i=!1;e.y<this._minCoord.y&&n.y<this._minCoord.y&&r===sc.COUNTERCLOCKWISE?i=!0:e.y>this._minCoord.y&&n.y>this._minCoord.y&&r===sc.CLOCKWISE&&(i=!0),i&&(this._minIndex=this._minIndex-1)},Sh.prototype.getRightmostSideOfSegment=function(t,e){var n=t.getEdge().getCoordinates();if(e<0||e+1>=n.length)return-1;if(n[e].y===n[e+1].y)return-1;var r=Nh.LEFT;return n[e].y<n[e+1].y&&(r=Nh.RIGHT),r},Sh.prototype.getEdge=function(){return this._orientedDe},Sh.prototype.checkForRightmostCoordinate=function(t){for(var e=t.getEdge().getCoordinates(),n=0;n<e.length-1;n++)(null===this._minCoord||e[n].x>this._minCoord.x)&&(this._minDe=t,this._minIndex=n,this._minCoord=e[n])},Sh.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode().getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},Sh.prototype.findEdge=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();n.isForward()&&this.checkForRightmostCoordinate(n)}tc.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;this.getRightmostSide(this._minDe,this._minIndex)===Nh.LEFT&&(this._orientedDe=this._minDe.getSym())},Sh.prototype.interfaces_=function(){return[]},Sh.prototype.getClass=function(){return Sh};var Mh=function(t){function e(n,r){t.call(this,e.msgWithCoord(n,r)),this.pt=r?new bu(r):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(t,e){return e?t:t+" [ "+e+" ]"},e}(Qu),Lh=function(){this.array_=[]};Lh.prototype.addLast=function(t){this.array_.push(t)},Lh.prototype.removeFirst=function(){return this.array_.shift()},Lh.prototype.isEmpty=function(){return 0===this.array_.length};var Ph=function(){this._finder=null,this._dirEdgeList=new bc,this._nodes=new bc,this._rightMostCoord=null,this._env=null,this._finder=new Sh};Ph.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){t.next().setVisited(!1)}},Ph.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},Ph.prototype.computeNodeDepth=function(t){for(var e=null,n=t.getEdges().iterator();n.hasNext();){var r=n.next();if(r.isVisited()||r.getSym().isVisited()){e=r;break}}if(null===e)throw new Mh("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var i=t.getEdges().iterator();i.hasNext();){var o=i.next();o.setVisited(!0),this.copySymDepths(o)}},Ph.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(Nh.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},Ph.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},Ph.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(Nh.RIGHT)>=1&&e.getDepth(Nh.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},Ph.prototype.computeDepths=function(t){var e=new Rc,n=new Lh,r=t.getNode();for(n.addLast(r),e.add(r),t.setVisited(!0);!n.isEmpty();){var i=n.removeFirst();e.add(i),this.computeNodeDepth(i);for(var o=i.getEdges().iterator();o.hasNext();){var s=o.next().getSym();if(!s.isVisited()){var a=s.getNode();e.contains(a)||(n.addLast(a),e.add(a))}}}},Ph.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0},Ph.prototype.getEnvelope=function(){if(null===this._env){for(var t=new Yu,e=this._dirEdgeList.iterator();e.hasNext();)for(var n=e.next().getEdge().getCoordinates(),r=0;r<n.length-1;r++)t.expandToInclude(n[r]);this._env=t}return this._env},Ph.prototype.addReachable=function(t){var e=new Xi;for(e.add(t);!e.empty();){var n=e.pop();this.add(n,e)}},Ph.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(Nh.LEFT,t.getDepth(Nh.RIGHT)),e.setDepth(Nh.RIGHT,t.getDepth(Nh.LEFT))},Ph.prototype.add=function(t,e){t.setVisited(!0),this._nodes.add(t);for(var n=t.getEdges().iterator();n.hasNext();){var r=n.next();this._dirEdgeList.add(r);var i=r.getSym().getNode();i.isVisited()||e.push(i)}},Ph.prototype.getNodes=function(){return this._nodes},Ph.prototype.getDirectedEdges=function(){return this._dirEdgeList},Ph.prototype.interfaces_=function(){return[xu]},Ph.prototype.getClass=function(){return Ph};var Oh=function t(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];this.init(e.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[Nh.ON]=n}else if(arguments[0]instanceof t){var r=arguments[0];if(this.init(r.location.length),null!==r)for(var i=0;i<this.location.length;i++)this.location[i]=r.location[i]}}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.init(3),this.location[Nh.ON]=o,this.location[Nh.LEFT]=s,this.location[Nh.RIGHT]=a}};Oh.prototype.setAllLocations=function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},Oh.prototype.isNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==Su.NONE)return!1;return!0},Oh.prototype.setAllLocationsIfNull=function(t){for(var e=0;e<this.location.length;e++)this.location[e]===Su.NONE&&(this.location[e]=t)},Oh.prototype.isLine=function(){return 1===this.location.length},Oh.prototype.merge=function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[Nh.ON]=this.location[Nh.ON],e[Nh.LEFT]=Su.NONE,e[Nh.RIGHT]=Su.NONE,this.location=e}for(var n=0;n<this.location.length;n++)this.location[n]===Su.NONE&&n<t.location.length&&(this.location[n]=t.location[n])},Oh.prototype.getLocations=function(){return this.location},Oh.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[Nh.LEFT];this.location[Nh.LEFT]=this.location[Nh.RIGHT],this.location[Nh.RIGHT]=t},Oh.prototype.toString=function(){var t=new Ru;return this.location.length>1&&t.append(Su.toLocationSymbol(this.location[Nh.LEFT])),t.append(Su.toLocationSymbol(this.location[Nh.ON])),this.location.length>1&&t.append(Su.toLocationSymbol(this.location[Nh.RIGHT])),t.toString()},Oh.prototype.setLocations=function(t,e,n){this.location[Nh.ON]=t,this.location[Nh.LEFT]=e,this.location[Nh.RIGHT]=n},Oh.prototype.get=function(t){return t<this.location.length?this.location[t]:Su.NONE},Oh.prototype.isArea=function(){return this.location.length>1},Oh.prototype.isAnyNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===Su.NONE)return!0;return!1},Oh.prototype.setLocation=function(){if(1===arguments.length){var t=arguments[0];this.setLocation(Nh.ON,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.location[e]=n}},Oh.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(Su.NONE)},Oh.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]},Oh.prototype.allPositionsEqual=function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},Oh.prototype.interfaces_=function(){return[]},Oh.prototype.getClass=function(){return Oh};var Rh=function t(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new Oh(e),this.elt[1]=new Oh(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.elt[0]=new Oh(n.elt[0]),this.elt[1]=new Oh(n.elt[1])}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.elt[0]=new Oh(Su.NONE),this.elt[1]=new Oh(Su.NONE),this.elt[r].setLocation(i)}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.elt[0]=new Oh(o,s,a),this.elt[1]=new Oh(o,s,a)}else if(4===arguments.length){var u=arguments[0],c=arguments[1],h=arguments[2],l=arguments[3];this.elt[0]=new Oh(Su.NONE,Su.NONE,Su.NONE),this.elt[1]=new Oh(Su.NONE,Su.NONE,Su.NONE),this.elt[u].setLocations(c,h,l)}};Rh.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},Rh.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)},Rh.prototype.isNull=function(t){return this.elt[t].isNull()},Rh.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.elt[e].setAllLocationsIfNull(n)}},Rh.prototype.isLine=function(t){return this.elt[t].isLine()},Rh.prototype.merge=function(t){for(var e=0;e<2;e++)null===this.elt[e]&&null!==t.elt[e]?this.elt[e]=new Oh(t.elt[e]):this.elt[e].merge(t.elt[e])},Rh.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Rh.prototype.getLocation=function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(Nh.ON)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return this.elt[e].get(n)}},Rh.prototype.toString=function(){var t=new Ru;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},Rh.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},Rh.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()},Rh.prototype.setLocation=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(Nh.ON,e)}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this.elt[n].setLocation(r,i)}},Rh.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},Rh.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)},Rh.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Oh(this.elt[t].location[0]))},Rh.prototype.interfaces_=function(){return[]},Rh.prototype.getClass=function(){return Rh},Rh.toLineLabel=function(t){for(var e=new Rh(Su.NONE),n=0;n<2;n++)e.setLocation(n,t.getLocation(n));return e};var Th=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new bc,this._pts=new bc,this._label=new Rh(Su.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new bc,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};Th.prototype.computeRing=function(){if(null!==this._ring)return null;for(var t=new Array(this._pts.size()).fill(null),e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=sc.isCCW(this._ring.getCoordinates())},Th.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Th.prototype.computePoints=function(t){this._startDe=t;var e=t,n=!0;do{if(null===e)throw new Mh("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new Mh("Directed Edge visited twice during ring-building at "+e.getCoordinate());this._edges.add(e);var r=e.getLabel();tc.isTrue(r.isArea()),this.mergeLabel(r),this.addPoints(e.getEdge(),e.isForward(),n),n=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this._startDe)},Th.prototype.getLinearRing=function(){return this._ring},Th.prototype.getCoordinate=function(t){return this._pts.get(t)},Th.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var t=this._startDe;do{var e=t.getNode().getEdges().getOutgoingDegree(this);e>this._maxNodeDegree&&(this._maxNodeDegree=e),t=this.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2},Th.prototype.addPoints=function(t,e,n){var r=t.getCoordinates();if(e){var i=1;n&&(i=0);for(var o=i;o<r.length;o++)this._pts.add(r[o])}else{var s=r.length-2;n&&(s=r.length-1);for(var a=s;a>=0;a--)this._pts.add(r[a])}},Th.prototype.isHole=function(){return this._isHole},Th.prototype.setInResult=function(){var t=this._startDe;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this._startDe)},Th.prototype.containsPoint=function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!sc.isPointInRing(t,e.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();){if(n.next().containsPoint(t))return!1}return!0},Th.prototype.addHole=function(t){this._holes.add(t)},Th.prototype.isShell=function(){return null===this._shell},Th.prototype.getLabel=function(){return this._label},Th.prototype.getEdges=function(){return this._edges},Th.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Th.prototype.getShell=function(){return this._shell},Th.prototype.mergeLabel=function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],r=e.getLocation(n,Nh.RIGHT);if(r===Su.NONE)return null;if(this._label.getLocation(n)===Su.NONE)return this._label.setLocation(n,r),null}},Th.prototype.setShell=function(t){this._shell=t,null!==t&&t.addHole(this)},Th.prototype.toPolygon=function(t){for(var e=new Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)e[n]=this._holes.get(n).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},Th.prototype.interfaces_=function(){return[]},Th.prototype.getClass=function(){return Th};var Ah=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(t,e){t.setMinEdgeRing(e)},e.prototype.getNext=function(t){return t.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Th),Dh=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var t=new bc,e=this._startDe;do{if(null===e.getMinEdgeRing()){var n=new Ah(e,this._geometryFactory);t.add(n)}e=e.getNext()}while(e!==this._startDe);return t},e.prototype.setEdgeRing=function(t,e){t.setEdgeRing(e)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var t=this._startDe;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this._startDe)},e.prototype.getNext=function(t){return t.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Th),Fh=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._label=t}};Fh.prototype.setVisited=function(t){this._isVisited=t},Fh.prototype.setInResult=function(t){this._isInResult=t},Fh.prototype.isCovered=function(){return this._isCovered},Fh.prototype.isCoveredSet=function(){return this._isCoveredSet},Fh.prototype.setLabel=function(t){this._label=t},Fh.prototype.getLabel=function(){return this._label},Fh.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0},Fh.prototype.updateIM=function(t){tc.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)},Fh.prototype.isInResult=function(){return this._isInResult},Fh.prototype.isVisited=function(){return this._isVisited},Fh.prototype.interfaces_=function(){return[]},Fh.prototype.getClass=function(){return Fh};var qh=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var e=arguments[0],n=arguments[1];this._coord=e,this._edges=n,this._label=new Rh(0,Su.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();){if(t.next().getEdge().isInResult())return!0}return!1},e.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(t){t.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(t){},e.prototype.computeMergedLocation=function(t,e){var n=Su.NONE;if(n=this._label.getLocation(e),!t.isNull(e)){var r=t.getLocation(e);n!==Su.BOUNDARY&&(n=r)}return n},e.prototype.setLabel=function(){if(2!==arguments.length)return t.prototype.setLabel.apply(this,arguments);var e=arguments[0],n=arguments[1];null===this._label?this._label=new Rh(e,n):this._label.setLocation(e,n)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){if(arguments[0]instanceof e){var t=arguments[0];this.mergeLabel(t._label)}else if(arguments[0]instanceof Rh)for(var n=arguments[0],r=0;r<2;r++){var i=this.computeMergedLocation(n,r);this._label.getLocation(r)===Su.NONE&&this._label.setLocation(r,i)}},e.prototype.add=function(t){this._edges.insert(t),t.setNode(this)},e.prototype.setLabelBoundary=function(t){if(null===this._label)return null;var e=Su.NONE;null!==this._label&&(e=this._label.getLocation(t));var n=null;switch(e){case Su.BOUNDARY:n=Su.INTERIOR;break;case Su.INTERIOR:default:n=Su.BOUNDARY}this._label.setLocation(t,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Fh),Gh=function(){this.nodeMap=new Gi,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};Gh.prototype.find=function(t){return this.nodeMap.get(t)},Gh.prototype.addNode=function(){if(arguments[0]instanceof bu){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof qh){var n=arguments[0],r=this.nodeMap.get(n.getCoordinate());return null===r?(this.nodeMap.put(n.getCoordinate(),n),n):(r.mergeLabel(n),r)}},Gh.prototype.print=function(t){for(var e=this.iterator();e.hasNext();){e.next().print(t)}},Gh.prototype.iterator=function(){return this.nodeMap.values().iterator()},Gh.prototype.values=function(){return this.nodeMap.values()},Gh.prototype.getBoundaryNodes=function(t){for(var e=new bc,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(t)===Su.BOUNDARY&&e.add(r)}return e},Gh.prototype.add=function(t){var e=t.getCoordinate();this.addNode(e).add(t)},Gh.prototype.interfaces_=function(){return[]},Gh.prototype.getClass=function(){return Gh};var Bh=function(){},kh={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Bh.prototype.interfaces_=function(){return[]},Bh.prototype.getClass=function(){return Bh},Bh.isNorthern=function(t){return t===Bh.NE||t===Bh.NW},Bh.isOpposite=function(t,e){if(t===e)return!1;return 2===(t-e+4)%4},Bh.commonHalfPlane=function(t,e){if(t===e)return t;if(2===(t-e+4)%4)return-1;var n=t<e?t:e;return 0===n&&3===(t>e?t:e)?3:n},Bh.isInHalfPlane=function(t,e){return e===Bh.SE?t===Bh.SE||t===Bh.SW:t===e||t===e+1},Bh.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new _u("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Bh.NE:Bh.SE:e>=0?Bh.NW:Bh.SW}if(arguments[0]instanceof bu&&arguments[1]instanceof bu){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new _u("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?Bh.NE:Bh.SE:r.y>=n.y?Bh.NW:Bh.SW}},kh.NE.get=function(){return 0},kh.NW.get=function(){return 1},kh.SW.get=function(){return 2},kh.SE.get=function(){return 3},Object.defineProperties(Bh,kh);var zh=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2];this._edge=e,this.init(n,r),this._label=null}else if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this._edge=i,this.init(o,s),this._label=a}};zh.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:sc.computeOrientation(t._p0,t._p1,this._p1)},zh.prototype.getDy=function(){return this._dy},zh.prototype.getCoordinate=function(){return this._p0},zh.prototype.setNode=function(t){this._node=t},zh.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),i=n.substring(r+1);t.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)},zh.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)},zh.prototype.getDirectedCoordinate=function(){return this._p1},zh.prototype.getDx=function(){return this._dx},zh.prototype.getLabel=function(){return this._label},zh.prototype.getEdge=function(){return this._edge},zh.prototype.getQuadrant=function(){return this._quadrant},zh.prototype.getNode=function(){return this._node},zh.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),n=e.lastIndexOf(".");return"  "+e.substring(n+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label},zh.prototype.computeLabel=function(t){},zh.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Bh.quadrant(this._dx,this._dy),tc.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},zh.prototype.interfaces_=function(){return[xu]},zh.prototype.getClass=function(){return zh};var jh=function(t){function e(){var e=arguments[0],n=arguments[1];if(t.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=n,n)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var r=e.getNumPoints()-1;this.init(e.getCoordinate(r),e.getCoordinate(r-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(t){return this._depth[t]},e.prototype.setVisited=function(t){this._isVisited=t},e.prototype.computeDirectedLabel=function(){this._label=new Rh(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(t,e){if(-999!==this._depth[t]&&this._depth[t]!==e)throw new Mh("assigned depths do not match",this.getCoordinate());this._depth[t]=e},e.prototype.isInteriorAreaEdge=function(){for(var t=!0,e=0;e<2;e++)this._label.isArea(e)&&this._label.getLocation(e,Nh.LEFT)===Su.INTERIOR&&this._label.getLocation(e,Nh.RIGHT)===Su.INTERIOR||(t=!1);return t},e.prototype.setNextMin=function(t){this._nextMin=t},e.prototype.print=function(e){t.prototype.print.call(this,e),e.print(" "+this._depth[Nh.LEFT]+"/"+this._depth[Nh.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},e.prototype.setMinEdgeRing=function(t){this._minEdgeRing=t},e.prototype.isLineEdge=function(){var t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,Su.EXTERIOR),n=!this._label.isArea(1)||this._label.allPositionsEqual(1,Su.EXTERIOR);return t&&e&&n},e.prototype.setEdgeRing=function(t){this._edgeRing=t},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t},e.prototype.setInResult=function(t){this._isInResult=t},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)},e.prototype.setSym=function(t){this._sym=t},e.prototype.setVisitedEdge=function(t){this.setVisited(t),this._sym.setVisited(t)},e.prototype.setEdgeDepths=function(t,e){var n=this.getEdge().getDepthDelta();this._isForward||(n=-n);var r=1;t===Nh.LEFT&&(r=-1);var i=Nh.opposite(t),o=e+n*r;this.setDepth(t,e),this.setDepth(i,o)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(t){this._next=t},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(t,e){return t===Su.EXTERIOR&&e===Su.INTERIOR?1:t===Su.INTERIOR&&e===Su.EXTERIOR?-1:0},e}(zh),Xh=function(){};Xh.prototype.createNode=function(t){return new qh(t,null)},Xh.prototype.interfaces_=function(){return[]},Xh.prototype.getClass=function(){return Xh};var Uh=function(){if(this._edges=new bc,this._nodes=null,this._edgeEndList=new bc,0===arguments.length)this._nodes=new Gh(new Xh);else if(1===arguments.length){var t=arguments[0];this._nodes=new Gh(t)}};Uh.prototype.printEdges=function(t){t.println("Edges:");for(var e=0;e<this._edges.size();e++){t.println("edge "+e+":");var n=this._edges.get(e);n.print(t),n.eiList.print(t)}},Uh.prototype.find=function(t){return this._nodes.find(t)},Uh.prototype.addNode=function(){if(arguments[0]instanceof qh){var t=arguments[0];return this._nodes.addNode(t)}if(arguments[0]instanceof bu){var e=arguments[0];return this._nodes.addNode(e)}},Uh.prototype.getNodeIterator=function(){return this._nodes.iterator()},Uh.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){t.next().getEdges().linkResultDirectedEdges()}},Uh.prototype.debugPrintln=function(t){Xu.out.println(t)},Uh.prototype.isBoundaryNode=function(t,e){var n=this._nodes.find(e);if(null===n)return!1;var r=n.getLabel();return null!==r&&r.getLocation(t)===Su.BOUNDARY},Uh.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){t.next().getEdges().linkAllDirectedEdges()}},Uh.prototype.matchInSameDirection=function(t,e,n,r){return!!t.equals(n)&&(sc.computeOrientation(t,e,r)===sc.COLLINEAR&&Bh.quadrant(t,e)===Bh.quadrant(n,r))},Uh.prototype.getEdgeEnds=function(){return this._edgeEndList},Uh.prototype.debugPrint=function(t){Xu.out.print(t)},Uh.prototype.getEdgeIterator=function(){return this._edges.iterator()},Uh.prototype.findEdgeInSameDirection=function(t,e){for(var n=0;n<this._edges.size();n++){var r=this._edges.get(n),i=r.getCoordinates();if(this.matchInSameDirection(t,e,i[0],i[1]))return r;if(this.matchInSameDirection(t,e,i[i.length-1],i[i.length-2]))return r}return null},Uh.prototype.insertEdge=function(t){this._edges.add(t)},Uh.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null},Uh.prototype.addEdges=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this._edges.add(n);var r=new jh(n,!0),i=new jh(n,!1);r.setSym(i),i.setSym(r),this.add(r),this.add(i)}},Uh.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)},Uh.prototype.getNodes=function(){return this._nodes.values()},Uh.prototype.findEdge=function(t,e){for(var n=0;n<this._edges.size();n++){var r=this._edges.get(n),i=r.getCoordinates();if(t.equals(i[0])&&e.equals(i[1]))return r}return null},Uh.prototype.interfaces_=function(){return[]},Uh.prototype.getClass=function(){return Uh},Uh.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();){e.next().getEdges().linkResultDirectedEdges()}};var Yh=function(){this._geometryFactory=null,this._shellList=new bc;var t=arguments[0];this._geometryFactory=t};Yh.prototype.sortShellsAndHoles=function(t,e,n){for(var r=t.iterator();r.hasNext();){var i=r.next();i.isHole()?n.add(i):e.add(i)}},Yh.prototype.computePolygons=function(t){for(var e=new bc,n=t.iterator();n.hasNext();){var r=n.next().toPolygon(this._geometryFactory);e.add(r)}return e},Yh.prototype.placeFreeHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();if(null===r.getShell()){var i=this.findEdgeRingContaining(r,t);if(null===i)throw new Mh("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(i)}}},Yh.prototype.buildMinimalEdgeRings=function(t,e,n){for(var r=new bc,i=t.iterator();i.hasNext();){var o=i.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var s=o.buildMinimalRings(),a=this.findShell(s);null!==a?(this.placePolygonHoles(a,s),e.add(a)):n.addAll(s)}else r.add(o)}return r},Yh.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();){if(e.next().containsPoint(t))return!0}return!1},Yh.prototype.buildMaximalEdgeRings=function(t){for(var e=new bc,n=t.iterator();n.hasNext();){var r=n.next();if(r.isInResult()&&r.getLabel().isArea()&&null===r.getEdgeRing()){var i=new Dh(r,this._geometryFactory);e.add(i),i.setInResult()}}return e},Yh.prototype.placePolygonHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(t)}},Yh.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},Yh.prototype.findEdgeRingContaining=function(t,e){for(var n=t.getLinearRing(),r=n.getEnvelopeInternal(),i=n.getCoordinateN(0),o=null,s=null,a=e.iterator();a.hasNext();){var u=a.next(),c=u.getLinearRing(),h=c.getEnvelopeInternal();null!==o&&(s=o.getLinearRing().getEnvelopeInternal());var l=!1;h.contains(r)&&sc.isPointInRing(i,c.getCoordinates())&&(l=!0),l&&(null===o||s.contains(h))&&(o=u)}return o},Yh.prototype.findShell=function(t){for(var e=0,n=null,r=t.iterator();r.hasNext();){var i=r.next();i.isHole()||(n=i,e++)}return tc.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n},Yh.prototype.add=function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0],n=arguments[1];Uh.linkResultDirectedEdges(n);var r=this.buildMaximalEdgeRings(e),i=new bc,o=this.buildMinimalEdgeRings(r,this._shellList,i);this.sortShellsAndHoles(o,this._shellList,i),this.placeFreeHoles(this._shellList,i)}},Yh.prototype.interfaces_=function(){return[]},Yh.prototype.getClass=function(){return Yh};var Vh=function(){};Vh.prototype.getBounds=function(){},Vh.prototype.interfaces_=function(){return[]},Vh.prototype.getClass=function(){return Vh};var Hh=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};Hh.prototype.getItem=function(){return this._item},Hh.prototype.getBounds=function(){return this._bounds},Hh.prototype.interfaces_=function(){return[Vh,Li]},Hh.prototype.getClass=function(){return Hh};var Wh=function(){this._size=null,this._items=null,this._size=0,this._items=new bc,this._items.add(null)};Wh.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t},Wh.prototype.size=function(){return this._size},Wh.prototype.reorder=function(t){for(var e=null,n=this._items.get(t);2*t<=this._size&&((e=2*t)!==this._size&&this._items.get(e+1).compareTo(this._items.get(e))<0&&e++,this._items.get(e).compareTo(n)<0);t=e)this._items.set(t,this._items.get(e));this._items.set(t,n)},Wh.prototype.clear=function(){this._size=0,this._items.clear()},Wh.prototype.isEmpty=function(){return 0===this._size},Wh.prototype.add=function(t){this._items.add(null),this._size+=1;var e=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,t)},Wh.prototype.interfaces_=function(){return[]},Wh.prototype.getClass=function(){return Wh};var Jh=function(){};Jh.prototype.visitItem=function(t){},Jh.prototype.interfaces_=function(){return[]},Jh.prototype.getClass=function(){return Jh};var Zh=function(){};Zh.prototype.insert=function(t,e){},Zh.prototype.remove=function(t,e){},Zh.prototype.query=function(){},Zh.prototype.interfaces_=function(){return[]},Zh.prototype.getClass=function(){return Zh};var Kh=function(){if(this._childBoundables=new bc,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._level=t}},Qh={serialVersionUID:{configurable:!0}};Kh.prototype.getLevel=function(){return this._level},Kh.prototype.size=function(){return this._childBoundables.size()},Kh.prototype.getChildBoundables=function(){return this._childBoundables},Kh.prototype.addChildBoundable=function(t){tc.isTrue(null===this._bounds),this._childBoundables.add(t)},Kh.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},Kh.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},Kh.prototype.interfaces_=function(){return[Vh,Li]},Kh.prototype.getClass=function(){return Kh},Qh.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(Kh,Qh);var $h=function(){};$h.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}},$h.min=function(t){return $h.sort(t),t.get(0)},$h.sort=function(t,e){var n=t.toArray();e?qc.sort(n,e):qc.sort(n);for(var r=t.iterator(),i=0,o=n.length;i<o;i++)r.next(),r.set(n[i])},$h.singletonList=function(t){var e=new bc;return e.add(t),e};var tl=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],n=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=n,this._distance=this.distance()};tl.prototype.expandToQueue=function(t,e){var n=tl.isComposite(this._boundable1),r=tl.isComposite(this._boundable2);if(n&&r)return tl.area(this._boundable1)>tl.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(n)return this.expand(this._boundable1,this._boundable2,t,e),null;if(r)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new _u("neither boundable is composite")},tl.prototype.isLeaves=function(){return!(tl.isComposite(this._boundable1)||tl.isComposite(this._boundable2))},tl.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},tl.prototype.expand=function(t,e,n,r){for(var i=t.getChildBoundables().iterator();i.hasNext();){var o=i.next(),s=new tl(o,e,this._itemDistance);s.getDistance()<r&&n.add(s)}},tl.prototype.getBoundable=function(t){return 0===t?this._boundable1:this._boundable2},tl.prototype.getDistance=function(){return this._distance},tl.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},tl.prototype.interfaces_=function(){return[xu]},tl.prototype.getClass=function(){return tl},tl.area=function(t){return t.getBounds().getArea()},tl.isComposite=function(t){return t instanceof Kh};var el=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new bc,this._nodeCapacity=null,0===arguments.length){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(1===arguments.length){var n=arguments[0];tc.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},nl={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};el.prototype.getNodeCapacity=function(){return this._nodeCapacity},el.prototype.lastNode=function(t){return t.get(t.size()-1)},el.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var n=e.next();n instanceof Kh?t+=this.size(n):n instanceof Hh&&(t+=1)}return t}},el.prototype.removeItem=function(t,e){for(var n=null,r=t.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof Hh&&i.getItem()===e&&(n=i)}return null!==n&&(t.getChildBoundables().remove(n),!0)},el.prototype.itemsTree=function(){if(0===arguments.length){this.build();var t=this.itemsTree(this._root);return null===t?new bc:t}if(1===arguments.length){for(var e=arguments[0],n=new bc,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();if(i instanceof Kh){var o=this.itemsTree(i);null!==o&&n.add(o)}else i instanceof Hh?n.add(i.getItem()):tc.shouldNeverReachHere()}return n.size()<=0?null:n}},el.prototype.insert=function(t,e){tc.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Hh(t,e))},el.prototype.boundablesAtLevel=function(){if(1===arguments.length){var t=arguments[0],e=new bc;return this.boundablesAtLevel(t,this._root,e),e}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];if(tc.isTrue(n>-2),r.getLevel()===n)return i.add(r),null;for(var o=r.getChildBoundables().iterator();o.hasNext();){var s=o.next();s instanceof Kh?this.boundablesAtLevel(n,s,i):(tc.isTrue(s instanceof Hh),-1===n&&i.add(s))}return null}},el.prototype.query=function(){if(1===arguments.length){var t=arguments[0];this.build();var e=new bc;return this.isEmpty()?e:(this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,e),e)}if(2===arguments.length){var n=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.query(n,this._root,r)}else if(3===arguments.length)if(Lu(arguments[2],Jh)&&arguments[0]instanceof Object&&arguments[1]instanceof Kh)for(var i=arguments[0],o=arguments[1],s=arguments[2],a=o.getChildBoundables(),u=0;u<a.size();u++){var c=a.get(u);this.getIntersectsOp().intersects(c.getBounds(),i)&&(c instanceof Kh?this.query(i,c,s):c instanceof Hh?s.visitItem(c.getItem()):tc.shouldNeverReachHere())}else if(Lu(arguments[2],wc)&&arguments[0]instanceof Object&&arguments[1]instanceof Kh)for(var h=arguments[0],l=arguments[1],p=arguments[2],f=l.getChildBoundables(),g=0;g<f.size();g++){var d=f.get(g);this.getIntersectsOp().intersects(d.getBounds(),h)&&(d instanceof Kh?this.query(h,d,p):d instanceof Hh?p.add(d.getItem()):tc.shouldNeverReachHere())}},el.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},el.prototype.getRoot=function(){return this.build(),this._root},el.prototype.remove=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.remove(t,this._root,e)}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=this.removeItem(r,i);if(o)return!0;for(var s=null,a=r.getChildBoundables().iterator();a.hasNext();){var u=a.next();if(this.getIntersectsOp().intersects(u.getBounds(),n)&&(u instanceof Kh&&(o=this.remove(n,u,i)))){s=u;break}}return null!==s&&s.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(s),o}},el.prototype.createHigherLevels=function(t,e){tc.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,e+1)},el.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var n=e.next();if(n instanceof Kh){var r=this.depth(n);r>t&&(t=r)}}return t+1}},el.prototype.createParentBoundables=function(t,e){tc.isTrue(!t.isEmpty());var n=new bc;n.add(this.createNode(e));var r=new bc(t);$h.sort(r,this.getComparator());for(var i=r.iterator();i.hasNext();){var o=i.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(e)),this.lastNode(n).addChildBoundable(o)}return n},el.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},el.prototype.interfaces_=function(){return[Li]},el.prototype.getClass=function(){return el},el.compareDoubles=function(t,e){return t>e?1:t<e?-1:0},nl.IntersectsOp.get=function(){return rl},nl.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},nl.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(el,nl);var rl=function(){},il=function(){};il.prototype.distance=function(t,e){},il.prototype.interfaces_=function(){return[]},il.prototype.getClass=function(){return il};var ol=function(t){function e(n){n=n||e.DEFAULT_NODE_CAPACITY,t.call(this,n)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(t,e){tc.isTrue(t.length>0);for(var n=new bc,r=0;r<t.length;r++)n.addAll(this.createParentBoundablesFromVerticalSlice(t[r],e));return n},e.prototype.createNode=function(t){return new sl(t)},e.prototype.size=function(){return 0===arguments.length?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(2!==arguments.length)return t.prototype.insert.apply(this,arguments);var e=arguments[0],n=arguments[1];if(e.isNull())return null;t.prototype.insert.call(this,e,n)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(t,e){for(var n=Math.trunc(Math.ceil(t.size()/e)),r=new Array(e).fill(null),i=t.iterator(),o=0;o<e;o++){r[o]=new bc;for(var s=0;i.hasNext()&&s<n;){var a=i.next();r[o].add(a),s++}}return r},e.prototype.query=function(){if(1===arguments.length){var e=arguments[0];return t.prototype.query.call(this,e)}if(2===arguments.length){var n=arguments[0],r=arguments[1];t.prototype.query.call(this,n,r)}else if(3===arguments.length)if(Lu(arguments[2],Jh)&&arguments[0]instanceof Object&&arguments[1]instanceof Kh){var i=arguments[0],o=arguments[1],s=arguments[2];t.prototype.query.call(this,i,o,s)}else if(Lu(arguments[2],wc)&&arguments[0]instanceof Object&&arguments[1]instanceof Kh){var a=arguments[0],u=arguments[1],c=arguments[2];t.prototype.query.call(this,a,u,c)}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(e,n){return t.prototype.createParentBoundables.call(this,e,n)},e.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return t.prototype.remove.call(this,e,n)}return t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return 0===arguments.length?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(t,n){tc.isTrue(!t.isEmpty());var r=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),i=new bc(t);$h.sort(i,e.xComparator);var o=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(r))));return this.createParentBoundablesFromVerticalSlices(o,n)},e.prototype.nearestNeighbour=function(){if(1===arguments.length){if(Lu(arguments[0],il)){var t=arguments[0],n=new tl(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(n)}if(arguments[0]instanceof tl){var r=arguments[0];return this.nearestNeighbour(r,mu.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof e&&Lu(arguments[1],il)){var i=arguments[0],o=arguments[1],s=new tl(this.getRoot(),i.getRoot(),o);return this.nearestNeighbour(s)}if(arguments[0]instanceof tl&&"number"==typeof arguments[1]){var a=arguments[0],u=arguments[1],c=null,h=new Wh;for(h.add(a);!h.isEmpty()&&u>0;){var l=h.poll(),p=l.getDistance();if(p>=u)break;l.isLeaves()?(u=p,c=l):l.expandToQueue(h,u)}return[c.getBoundable(0).getItem(),c.getBoundable(1).getItem()]}}else if(3===arguments.length){var f=arguments[0],g=arguments[1],d=arguments[2],y=new Hh(f,g),_=new tl(this.getRoot(),y,d);return this.nearestNeighbour(_)[0]}},e.prototype.interfaces_=function(){return[Zh,Li]},e.prototype.getClass=function(){return e},e.centreX=function(t){return e.avg(t.getMinX(),t.getMaxX())},e.avg=function(t,e){return(t+e)/2},e.centreY=function(t){return e.avg(t.getMinY(),t.getMaxY())},n.STRtreeNode.get=function(){return sl},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[wu]},compare:function(n,r){return t.compareDoubles(e.centreX(n.getBounds()),e.centreX(r.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[wu]},compare:function(n,r){return t.compareDoubles(e.centreY(n.getBounds()),e.centreY(r.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(t,e){return t.intersects(e)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,n),e}(el),sl=function(t){function e(){var e=arguments[0];t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var n=e.next();null===t?t=new Yu(n.getBounds()):t.expandToInclude(n.getBounds())}return t},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Kh),al=function(){};al.prototype.interfaces_=function(){return[]},al.prototype.getClass=function(){return al},al.relativeSign=function(t,e){return t<e?-1:t>e?1:0},al.compare=function(t,e,n){if(e.equals2D(n))return 0;var r=al.relativeSign(e.x,n.x),i=al.relativeSign(e.y,n.y);switch(t){case 0:return al.compareValue(r,i);case 1:return al.compareValue(i,r);case 2:return al.compareValue(i,-r);case 3:return al.compareValue(-r,i);case 4:return al.compareValue(-r,-i);case 5:return al.compareValue(-i,-r);case 6:return al.compareValue(-i,r);case 7:return al.compareValue(r,-i)}return tc.shouldNeverReachHere("invalid octant value"),0},al.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var ul=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._segString=t,this.coord=new bu(e),this.segmentIndex=n,this._segmentOctant=r,this._isInterior=!e.equals2D(t.getCoordinate(n))};ul.prototype.getCoordinate=function(){return this.coord},ul.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},ul.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:al.compare(this._segmentOctant,this.coord,e.coord)},ul.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},ul.prototype.isInterior=function(){return this._isInterior},ul.prototype.interfaces_=function(){return[xu]},ul.prototype.getClass=function(){return ul};var cl=function(){this._nodeMap=new Gi,this._edge=null;var t=arguments[0];this._edge=t};cl.prototype.getSplitCoordinates=function(){var t=new Nc;this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var r=e.next();this.addEdgeCoordinates(n,r,t),n=r}return t.toCoordinateArray()},cl.prototype.addCollapsedNodes=function(){var t=new bc;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var n=e.next().intValue();this.add(this._edge.getCoordinate(n),n)}},cl.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){e.next().print(t)}},cl.prototype.findCollapsesFromExistingVertices=function(t){for(var e=0;e<this._edge.size()-2;e++){var n=this._edge.getCoordinate(e),r=this._edge.getCoordinate(e+2);n.equals2D(r)&&t.add(new Tu(e+1))}},cl.prototype.addEdgeCoordinates=function(t,e,n){var r=this._edge.getCoordinate(e.segmentIndex),i=e.isInterior()||!e.coord.equals2D(r);n.add(new bu(t.coord),!1);for(var o=t.segmentIndex+1;o<=e.segmentIndex;o++)n.add(this._edge.getCoordinate(o));i&&n.add(new bu(e.coord))},cl.prototype.iterator=function(){return this._nodeMap.values().iterator()},cl.prototype.addSplitEdges=function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),n=e.next();e.hasNext();){var r=e.next(),i=this.createSplitEdge(n,r);t.add(i),n=r}},cl.prototype.findCollapseIndex=function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var r=e.segmentIndex-t.segmentIndex;return e.isInterior()||r--,1===r&&(n[0]=t.segmentIndex+1,!0)},cl.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=new Array(1).fill(null),n=this.iterator(),r=n.next();n.hasNext();){var i=n.next();this.findCollapseIndex(r,i,e)&&t.add(new Tu(e[0])),r=i}},cl.prototype.getEdge=function(){return this._edge},cl.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)},cl.prototype.createSplitEdge=function(t,e){var n=e.segmentIndex-t.segmentIndex+2,r=this._edge.getCoordinate(e.segmentIndex),i=e.isInterior()||!e.coord.equals2D(r);i||n--;var o=new Array(n).fill(null),s=0;o[s++]=new bu(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this._edge.getCoordinate(a);return i&&(o[s]=new bu(e.coord)),new fl(o,this._edge.getData())},cl.prototype.add=function(t,e){var n=new ul(this._edge,t,e,this._edge.getSegmentOctant(e)),r=this._nodeMap.get(n);return null!==r?(tc.isTrue(r.coord.equals2D(t),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)},cl.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),n=t.get(0).getCoordinate(0);if(!n.equals2D(e[0]))throw new Qu("bad split edge start point at "+n);var r=t.get(t.size()-1).getCoordinates(),i=r[r.length-1];if(!i.equals2D(e[e.length-1]))throw new Qu("bad split edge end point at "+i)},cl.prototype.interfaces_=function(){return[]},cl.prototype.getClass=function(){return cl};var hl=function(){};hl.prototype.interfaces_=function(){return[]},hl.prototype.getClass=function(){return hl},hl.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new _u("Cannot compute the octant for point ( "+t+", "+e+" )");var n=Math.abs(t),r=Math.abs(e);return t>=0?e>=0?n>=r?0:1:n>=r?7:6:e>=0?n>=r?3:2:n>=r?4:5}if(arguments[0]instanceof bu&&arguments[1]instanceof bu){var i=arguments[0],o=arguments[1],s=o.x-i.x,a=o.y-i.y;if(0===s&&0===a)throw new _u("Cannot compute the octant for two identical points "+i);return hl.octant(s,a)}};var ll=function(){};ll.prototype.getCoordinates=function(){},ll.prototype.size=function(){},ll.prototype.getCoordinate=function(t){},ll.prototype.isClosed=function(){},ll.prototype.setData=function(t){},ll.prototype.getData=function(){},ll.prototype.interfaces_=function(){return[]},ll.prototype.getClass=function(){return ll};var pl=function(){};pl.prototype.addIntersection=function(t,e){},pl.prototype.interfaces_=function(){return[ll]},pl.prototype.getClass=function(){return pl};var fl=function(){this._nodeList=new cl(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};fl.prototype.getCoordinates=function(){return this._pts},fl.prototype.size=function(){return this._pts.length},fl.prototype.getCoordinate=function(t){return this._pts[t]},fl.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},fl.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},fl.prototype.setData=function(t){this._data=t},fl.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:hl.octant(t,e)},fl.prototype.getData=function(){return this._data},fl.prototype.addIntersection=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[3],o=new bu(n.getIntersection(i));this.addIntersection(o,r)}},fl.prototype.toString=function(){return Ku.toLineString(new uh(this._pts))},fl.prototype.getNodeList=function(){return this._nodeList},fl.prototype.addIntersectionNode=function(t,e){var n=e,r=n+1;if(r<this._pts.length){var i=this._pts[r];t.equals2D(i)&&(n=r)}return this._nodeList.add(t,n)},fl.prototype.addIntersections=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++)this.addIntersection(t,e,n,r)},fl.prototype.interfaces_=function(){return[pl]},fl.prototype.getClass=function(){return fl},fl.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new bc;return fl.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var n=arguments[0],r=arguments[1],i=n.iterator();i.hasNext();){i.next().getNodeList().addSplitEdges(r)}};var gl=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new bu,this.p1=new bu;else if(1===arguments.length){var t=arguments[0];this.p0=new bu(t.p0),this.p1=new bu(t.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];this.p0=new bu(e,n),this.p1=new bu(r,i)}},dl={serialVersionUID:{configurable:!0}};gl.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},gl.prototype.orientationIndex=function(){if(arguments[0]instanceof gl){var t=arguments[0],e=sc.orientationIndex(this.p0,this.p1,t.p0),n=sc.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&n>=0?Math.max(e,n):e<=0&&n<=0?Math.max(e,n):0}if(arguments[0]instanceof bu){var r=arguments[0];return sc.orientationIndex(this.p0,this.p1,r)}},gl.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])},gl.prototype.isVertical=function(){return this.p0.x===this.p1.x},gl.prototype.equals=function(t){if(!(t instanceof gl))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},gl.prototype.intersection=function(t){var e=new rc;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},gl.prototype.project=function(){if(arguments[0]instanceof bu){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new bu(t);var e=this.projectionFactor(t),n=new bu;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof gl){var r=arguments[0],i=this.projectionFactor(r.p0),o=this.projectionFactor(r.p1);if(i>=1&&o>=1)return null;if(i<=0&&o<=0)return null;var s=this.project(r.p0);i<0&&(s=this.p0),i>1&&(s=this.p1);var a=this.project(r.p1);return o<0&&(a=this.p0),o>1&&(a=this.p1),new gl(s,a)}},gl.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},gl.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},gl.prototype.getCoordinate=function(t){return 0===t?this.p0:this.p1},gl.prototype.distancePerpendicular=function(t){return sc.distancePointLinePerpendicular(t,this.p0,this.p1)},gl.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},gl.prototype.midPoint=function(){return gl.midPoint(this.p0,this.p1)},gl.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=e*e+n*n;if(r<=0)return mu.NaN;return((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/r},gl.prototype.closestPoints=function(t){var e=this.intersection(t);if(null!==e)return[e,e];var n=new Array(2).fill(null),r=mu.MAX_VALUE,i=null,o=this.closestPoint(t.p0);r=o.distance(t.p0),n[0]=o,n[1]=t.p0;var s=this.closestPoint(t.p1);(i=s.distance(t.p1))<r&&(r=i,n[0]=s,n[1]=t.p1);var a=t.closestPoint(this.p0);(i=a.distance(this.p0))<r&&(r=i,n[0]=this.p0,n[1]=a);var u=t.closestPoint(this.p1);return(i=u.distance(this.p1))<r&&(r=i,n[0]=this.p1,n[1]=u),n},gl.prototype.closestPoint=function(t){var e=this.projectionFactor(t);if(e>0&&e<1)return this.project(t);return this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},gl.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},gl.prototype.getLength=function(){return this.p0.distance(this.p1)},gl.prototype.compareTo=function(t){var e=t,n=this.p0.compareTo(e.p0);return 0!==n?n:this.p1.compareTo(e.p1)},gl.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t},gl.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)},gl.prototype.lineIntersection=function(t){try{return Uu.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof ju))throw t}return null},gl.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},gl.prototype.pointAlongOffset=function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),r=this.p0.y+t*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,s=Math.sqrt(i*i+o*o),a=0,u=0;if(0!==e){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");a=e*i/s,u=e*o/s}return new bu(n-u,r+a)},gl.prototype.setCoordinates=function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}},gl.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||mu.isNaN(e))&&(e=1),e},gl.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},gl.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},gl.prototype.distance=function(){if(arguments[0]instanceof gl){var t=arguments[0];return sc.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof bu){var e=arguments[0];return sc.distancePointLine(e,this.p0,this.p1)}},gl.prototype.pointAlong=function(t){var e=new bu;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},gl.prototype.hashCode=function(){var t=mu.doubleToLongBits(this.p0.x);t^=31*mu.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),n=mu.doubleToLongBits(this.p1.x);n^=31*mu.doubleToLongBits(this.p1.y);return e^(Math.trunc(n)^Math.trunc(n>>32))},gl.prototype.interfaces_=function(){return[xu,Li]},gl.prototype.getClass=function(){return gl},gl.midPoint=function(t,e){return new bu((t.x+e.x)/2,(t.y+e.y)/2)},dl.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(gl,dl);var yl=function(){this.tempEnv1=new Yu,this.tempEnv2=new Yu,this._overlapSeg1=new gl,this._overlapSeg2=new gl};yl.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];t.getLineSegment(e,this._overlapSeg1),n.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},yl.prototype.interfaces_=function(){return[]},yl.prototype.getClass=function(){return yl};var _l=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._pts=t,this._start=e,this._end=n,this._context=r};_l.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]},_l.prototype.computeSelect=function(t,e,n,r){var i=this._pts[e],o=this._pts[n];if(r.tempEnv1.init(i,o),n-e==1)return r.select(this,e),null;if(!t.intersects(r.tempEnv1))return null;var s=Math.trunc((e+n)/2);e<s&&this.computeSelect(t,e,s,r),s<n&&this.computeSelect(t,s,n,r)},_l.prototype.getCoordinates=function(){for(var t=new Array(this._end-this._start+1).fill(null),e=0,n=this._start;n<=this._end;n++)t[e++]=this._pts[n];return t},_l.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)},_l.prototype.setId=function(t){this._id=t},_l.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)},_l.prototype.getEnvelope=function(){if(null===this._env){var t=this._pts[this._start],e=this._pts[this._end];this._env=new Yu(t,e)}return this._env},_l.prototype.getEndIndex=function(){return this._end},_l.prototype.getStartIndex=function(){return this._start},_l.prototype.getContext=function(){return this._context},_l.prototype.getId=function(){return this._id},_l.prototype.computeOverlapsInternal=function(t,e,n,r,i,o){var s=this._pts[t],a=this._pts[e],u=n._pts[r],c=n._pts[i];if(e-t==1&&i-r==1)return o.overlap(this,t,n,r),null;if(o.tempEnv1.init(s,a),o.tempEnv2.init(u,c),!o.tempEnv1.intersects(o.tempEnv2))return null;var h=Math.trunc((t+e)/2),l=Math.trunc((r+i)/2);t<h&&(r<l&&this.computeOverlapsInternal(t,h,n,r,l,o),l<i&&this.computeOverlapsInternal(t,h,n,l,i,o)),h<e&&(r<l&&this.computeOverlapsInternal(h,e,n,r,l,o),l<i&&this.computeOverlapsInternal(h,e,n,l,i,o))},_l.prototype.interfaces_=function(){return[]},_l.prototype.getClass=function(){return _l};var ml=function(){};ml.prototype.interfaces_=function(){return[]},ml.prototype.getClass=function(){return ml},ml.getChainStartIndices=function(t){var e=0,n=new bc;n.add(new Tu(e));do{var r=ml.findChainEnd(t,e);n.add(new Tu(r)),e=r}while(e<t.length-1);return ml.toIntArray(n)},ml.findChainEnd=function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var r=Bh.quadrant(t[n],t[n+1]),i=e+1;i<t.length;){if(!t[i-1].equals2D(t[i])){if(Bh.quadrant(t[i-1],t[i])!==r)break}i++}return i-1},ml.getChains=function(){if(1===arguments.length){var t=arguments[0];return ml.getChains(t,null)}if(2===arguments.length){for(var e=arguments[0],n=arguments[1],r=new bc,i=ml.getChainStartIndices(e),o=0;o<i.length-1;o++){var s=new _l(e,i[o],i[o+1],n);r.add(s)}return r}},ml.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var vl=function(){};vl.prototype.computeNodes=function(t){},vl.prototype.getNodedSubstrings=function(){},vl.prototype.interfaces_=function(){return[]},vl.prototype.getClass=function(){return vl};var xl=function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}};xl.prototype.setSegmentIntersector=function(t){this._segInt=t},xl.prototype.interfaces_=function(){return[vl]},xl.prototype.getClass=function(){return xl};var El=function(t){function e(e){e?t.call(this,e):t.call(this),this._monoChains=new bc,this._index=new ol,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return fl.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(t){for(var e=ml.getChains(t.getCoordinates(),t).iterator();e.hasNext();){var n=e.next();n.setId(this._idCounter++),this._index.insert(n.getEnvelope(),n),this._monoChains.add(n)}},e.prototype.computeNodes=function(t){this._nodedSegStrings=t;for(var e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var t=new wl(this._segInt),e=this._monoChains.iterator();e.hasNext();)for(var n=e.next(),r=this._index.query(n.getEnvelope()).iterator();r.hasNext();){var i=r.next();if(i.getId()>n.getId()&&(n.computeOverlaps(i,t),this._nOverlaps++),this._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.SegmentOverlapAction.get=function(){return wl},Object.defineProperties(e,n),e}(xl),wl=function(t){function e(){t.call(this),this._si=null;var e=arguments[0];this._si=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(4!==arguments.length)return t.prototype.overlap.apply(this,arguments);var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3],o=e.getContext(),s=r.getContext();this._si.processIntersections(o,n,s,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(yl),bl=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setQuadrantSegments(e)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(o),this.setJoinStyle(s),this.setMitreLimit(a)}},Il={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};bl.prototype.getEndCapStyle=function(){return this._endCapStyle},bl.prototype.isSingleSided=function(){return this._isSingleSided},bl.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=bl.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=bl.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==bl.JOIN_ROUND&&(this._quadrantSegments=bl.DEFAULT_QUADRANT_SEGMENTS)},bl.prototype.getJoinStyle=function(){return this._joinStyle},bl.prototype.setJoinStyle=function(t){this._joinStyle=t},bl.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t},bl.prototype.getSimplifyFactor=function(){return this._simplifyFactor},bl.prototype.getQuadrantSegments=function(){return this._quadrantSegments},bl.prototype.setEndCapStyle=function(t){this._endCapStyle=t},bl.prototype.getMitreLimit=function(){return this._mitreLimit},bl.prototype.setMitreLimit=function(t){this._mitreLimit=t},bl.prototype.setSingleSided=function(t){this._isSingleSided=t},bl.prototype.interfaces_=function(){return[]},bl.prototype.getClass=function(){return bl},bl.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},Il.CAP_ROUND.get=function(){return 1},Il.CAP_FLAT.get=function(){return 2},Il.CAP_SQUARE.get=function(){return 3},Il.JOIN_ROUND.get=function(){return 1},Il.JOIN_MITRE.get=function(){return 2},Il.JOIN_BEVEL.get=function(){return 3},Il.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Il.DEFAULT_MITRE_LIMIT.get=function(){return 5},Il.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(bl,Il);var Nl=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=sc.COUNTERCLOCKWISE,this._inputLine=t||null},Cl={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Nl.prototype.isDeletable=function(t,e,n,r){var i=this._inputLine[t],o=this._inputLine[e],s=this._inputLine[n];return!!this.isConcave(i,o,s)&&(!!this.isShallow(i,o,s,r)&&this.isShallowSampled(i,o,t,n,r))},Nl.prototype.deleteShallowConcavities=function(){for(var t=1,e=this.findNextNonDeletedIndex(t),n=this.findNextNonDeletedIndex(e),r=!1;n<this._inputLine.length;){var i=!1;this.isDeletable(t,e,n,this._distanceTol)&&(this._isDeleted[e]=Nl.DELETE,i=!0,r=!0),t=i?n:e,e=this.findNextNonDeletedIndex(t),n=this.findNextNonDeletedIndex(e)}return r},Nl.prototype.isShallowConcavity=function(t,e,n,r){if(!(sc.computeOrientation(t,e,n)===this._angleOrientation))return!1;return sc.distancePointLine(e,t,n)<r},Nl.prototype.isShallowSampled=function(t,e,n,r,i){var o=Math.trunc((r-n)/Nl.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var s=n;s<r;s+=o)if(!this.isShallow(t,e,this._inputLine[s],i))return!1;return!0},Nl.prototype.isConcave=function(t,e,n){var r=sc.computeOrientation(t,e,n)===this._angleOrientation;return r},Nl.prototype.simplify=function(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=sc.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var e=!1;do{e=this.deleteShallowConcavities()}while(e);return this.collapseLine()},Nl.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===Nl.DELETE;)e++;return e},Nl.prototype.isShallow=function(t,e,n,r){return sc.distancePointLine(e,t,n)<r},Nl.prototype.collapseLine=function(){for(var t=new Nc,e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==Nl.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()},Nl.prototype.interfaces_=function(){return[]},Nl.prototype.getClass=function(){return Nl},Nl.simplify=function(t,e){return new Nl(t).simplify(e)},Cl.INIT.get=function(){return 0},Cl.DELETE.get=function(){return 1},Cl.KEEP.get=function(){return 1},Cl.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Nl,Cl);var Sl=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new bc},Ml={COORDINATE_ARRAY_TYPE:{configurable:!0}};Sl.prototype.getCoordinates=function(){return this._ptList.toArray(Sl.COORDINATE_ARRAY_TYPE)},Sl.prototype.setPrecisionModel=function(t){this._precisionModel=t},Sl.prototype.addPt=function(t){var e=new bu(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)},Sl.prototype.revere=function(){},Sl.prototype.addPts=function(t,e){if(e)for(var n=0;n<t.length;n++)this.addPt(t[n]);else for(var r=t.length-1;r>=0;r--)this.addPt(t[r])},Sl.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance},Sl.prototype.toString=function(){return(new _h).createLineString(this.getCoordinates()).toString()},Sl.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new bu(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)},Sl.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t},Sl.prototype.interfaces_=function(){return[]},Sl.prototype.getClass=function(){return Sl},Ml.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Sl,Ml);var Ll=function(){},Pl={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Ll.prototype.interfaces_=function(){return[]},Ll.prototype.getClass=function(){return Ll},Ll.toDegrees=function(t){return 180*t/Math.PI},Ll.normalize=function(t){for(;t>Math.PI;)t-=Ll.PI_TIMES_2;for(;t<=-Math.PI;)t+=Ll.PI_TIMES_2;return t},Ll.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],n=arguments[1],r=n.x-e.x,i=n.y-e.y;return Math.atan2(i,r)}},Ll.isAcute=function(t,e,n){var r=t.x-e.x,i=t.y-e.y;return r*(n.x-e.x)+i*(n.y-e.y)>0},Ll.isObtuse=function(t,e,n){var r=t.x-e.x,i=t.y-e.y;return r*(n.x-e.x)+i*(n.y-e.y)<0},Ll.interiorAngle=function(t,e,n){var r=Ll.angle(e,t),i=Ll.angle(e,n);return Math.abs(i-r)},Ll.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Ll.PI_TIMES_2;t>=Ll.PI_TIMES_2&&(t=0)}else{for(;t>=Ll.PI_TIMES_2;)t-=Ll.PI_TIMES_2;t<0&&(t=0)}return t},Ll.angleBetween=function(t,e,n){var r=Ll.angle(e,t),i=Ll.angle(e,n);return Ll.diff(r,i)},Ll.diff=function(t,e){var n=null;return(n=t<e?e-t:t-e)>Math.PI&&(n=2*Math.PI-n),n},Ll.toRadians=function(t){return t*Math.PI/180},Ll.getTurn=function(t,e){var n=Math.sin(e-t);return n>0?Ll.COUNTERCLOCKWISE:n<0?Ll.CLOCKWISE:Ll.NONE},Ll.angleBetweenOriented=function(t,e,n){var r=Ll.angle(e,t),i=Ll.angle(e,n)-r;return i<=-Math.PI?i+Ll.PI_TIMES_2:i>Math.PI?i-Ll.PI_TIMES_2:i},Pl.PI_TIMES_2.get=function(){return 2*Math.PI},Pl.PI_OVER_2.get=function(){return Math.PI/2},Pl.PI_OVER_4.get=function(){return Math.PI/4},Pl.COUNTERCLOCKWISE.get=function(){return sc.COUNTERCLOCKWISE},Pl.CLOCKWISE.get=function(){return sc.CLOCKWISE},Pl.NONE.get=function(){return sc.COLLINEAR},Object.defineProperties(Ll,Pl);var Ol=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new gl,this._seg1=new gl,this._offset0=new gl,this._offset1=new gl,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=e,this._bufParams=n,this._li=new rc,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===bl.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},Rl={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Ol.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=sc.computeOrientation(this._s0,this._s1,this._s2),r=n===sc.CLOCKWISE&&this._side===Nh.LEFT||n===sc.COUNTERCLOCKWISE&&this._side===Nh.RIGHT;0===n?this.addCollinear(e):r?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)},Ol.prototype.addLineEndCap=function(t,e){var n=new gl(t,e),r=new gl;this.computeOffsetSegment(n,Nh.LEFT,this._distance,r);var i=new gl;this.computeOffsetSegment(n,Nh.RIGHT,this._distance,i);var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o);switch(this._bufParams.getEndCapStyle()){case bl.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(e,a+Math.PI/2,a-Math.PI/2,sc.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case bl.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(i.p1);break;case bl.CAP_SQUARE:var u=new bu;u.x=Math.abs(this._distance)*Math.cos(a),u.y=Math.abs(this._distance)*Math.sin(a);var c=new bu(r.p1.x+u.x,r.p1.y+u.y),h=new bu(i.p1.x+u.x,i.p1.y+u.y);this._segList.addPt(c),this._segList.addPt(h)}},Ol.prototype.getCoordinates=function(){return this._segList.getCoordinates()},Ol.prototype.addMitreJoin=function(t,e,n,r){var i=!0,o=null;try{o=Uu.intersection(e.p0,e.p1,n.p0,n.p1);(r<=0?1:o.distance(t)/Math.abs(r))>this._bufParams.getMitreLimit()&&(i=!1)}catch(t){if(!(t instanceof ju))throw t;o=new bu(0,0),i=!1}i?this._segList.addPt(o):this.addLimitedMitreJoin(e,n,r,this._bufParams.getMitreLimit())},Ol.prototype.addFilletCorner=function(t,e,n,r,i){var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o),u=n.x-t.x,c=n.y-t.y,h=Math.atan2(c,u);r===sc.CLOCKWISE?a<=h&&(a+=2*Math.PI):a>=h&&(a-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,a,h,r,i),this._segList.addPt(n)},Ol.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Ol.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===bl.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===bl.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))},Ol.prototype.createSquare=function(t){this._segList.addPt(new bu(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new bu(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new bu(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new bu(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()},Ol.prototype.addSegments=function(t,e){this._segList.addPts(t,e)},Ol.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},Ol.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},Ol.prototype.initSideSegments=function(t,e,n){this._s1=t,this._s2=e,this._side=n,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)},Ol.prototype.addLimitedMitreJoin=function(t,e,n,r){var i=this._seg0.p1,o=Ll.angle(i,this._seg0.p0),s=Ll.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1)/2,a=Ll.normalize(o+s),u=Ll.normalize(a+Math.PI),c=r*n,h=n-c*Math.abs(Math.sin(s)),l=i.x+c*Math.cos(u),p=i.y+c*Math.sin(u),f=new bu(l,p),g=new gl(i,f),d=g.pointAlongOffset(1,h),y=g.pointAlongOffset(1,-h);this._side===Nh.LEFT?(this._segList.addPt(d),this._segList.addPt(y)):(this._segList.addPt(y),this._segList.addPt(d))},Ol.prototype.computeOffsetSegment=function(t,e,n,r){var i=e===Nh.LEFT?1:-1,o=t.p1.x-t.p0.x,s=t.p1.y-t.p0.y,a=Math.sqrt(o*o+s*s),u=i*n*o/a,c=i*n*s/a;r.p0.x=t.p0.x-c,r.p0.y=t.p0.y+u,r.p1.x=t.p1.x-c,r.p1.y=t.p1.y+u},Ol.prototype.addFilletArc=function(t,e,n,r,i){var o=r===sc.CLOCKWISE?-1:1,s=Math.abs(e-n),a=Math.trunc(s/this._filletAngleQuantum+.5);if(a<1)return null;for(var u=s/a,c=0,h=new bu;c<s;){var l=e+o*c;h.x=t.x+i*Math.cos(l),h.y=t.y+i*Math.sin(l),this._segList.addPt(h),c+=u}},Ol.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Ol.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new bu((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var r=new bu((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},Ol.prototype.createCircle=function(t){var e=new bu(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},Ol.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)},Ol.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Sl,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Ol.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Ol.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===bl.JOIN_BEVEL||this._bufParams.getJoinStyle()===bl.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,sc.CLOCKWISE,this._distance))},Ol.prototype.closeRing=function(){this._segList.closeRing()},Ol.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},Ol.prototype.interfaces_=function(){return[]},Ol.prototype.getClass=function(){return Ol},Rl.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Rl.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Rl.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Rl.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Ol,Rl);var Tl=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};Tl.prototype.getOffsetCurve=function(t,e){if(this._distance=e,0===e)return null;var n=e<0,r=Math.abs(e),i=this.getSegGen(r);t.length<=1?this.computePointCurve(t[0],i):this.computeOffsetCurve(t,n,i);var o=i.getCoordinates();return n&&Cc.reverse(o),o},Tl.prototype.computeSingleSidedBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){n.addSegments(t,!0);var i=Nl.simplify(t,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],Nh.LEFT),n.addFirstSegment();for(var s=o-2;s>=0;s--)n.addNextSegment(i[s],!0)}else{n.addSegments(t,!1);var a=Nl.simplify(t,r),u=a.length-1;n.initSideSegments(a[0],a[1],Nh.LEFT),n.addFirstSegment();for(var c=2;c<=u;c++)n.addNextSegment(a[c],!0)}n.addLastSegment(),n.closeRing()},Tl.prototype.computeRingBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);e===Nh.RIGHT&&(r=-r);var i=Nl.simplify(t,r),o=i.length-1;n.initSideSegments(i[o-1],i[0],e);for(var s=1;s<=o;s++){var a=1!==s;n.addNextSegment(i[s],a)}n.closeRing()},Tl.prototype.computeLineBufferCurve=function(t,e){var n=this.simplifyTolerance(this._distance),r=Nl.simplify(t,n),i=r.length-1;e.initSideSegments(r[0],r[1],Nh.LEFT);for(var o=2;o<=i;o++)e.addNextSegment(r[o],!0);e.addLastSegment(),e.addLineEndCap(r[i-1],r[i]);var s=Nl.simplify(t,-n),a=s.length-1;e.initSideSegments(s[a],s[a-1],Nh.LEFT);for(var u=a-2;u>=0;u--)e.addNextSegment(s[u],!0);e.addLastSegment(),e.addLineEndCap(s[1],s[0]),e.closeRing()},Tl.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case bl.CAP_ROUND:e.createCircle(t);break;case bl.CAP_SQUARE:e.createSquare(t)}},Tl.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided())return null;if(0===e)return null;var n=Math.abs(e),r=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],r);else if(this._bufParams.isSingleSided()){var i=e<0;this.computeSingleSidedBufferCurve(t,i,r)}else this.computeLineBufferCurve(t,r);return r.getCoordinates()},Tl.prototype.getBufferParameters=function(){return this._bufParams},Tl.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()},Tl.prototype.getRingCurve=function(t,e,n){if(this._distance=n,t.length<=2)return this.getLineCurve(t,n);if(0===n)return Tl.copyCoordinates(t);var r=this.getSegGen(n);return this.computeRingBufferCurve(t,e,r),r.getCoordinates()},Tl.prototype.computeOffsetCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){var i=Nl.simplify(t,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],Nh.LEFT),n.addFirstSegment();for(var s=o-2;s>=0;s--)n.addNextSegment(i[s],!0)}else{var a=Nl.simplify(t,r),u=a.length-1;n.initSideSegments(a[0],a[1],Nh.LEFT),n.addFirstSegment();for(var c=2;c<=u;c++)n.addNextSegment(a[c],!0)}n.addLastSegment()},Tl.prototype.getSegGen=function(t){return new Ol(this._precisionModel,this._bufParams,t)},Tl.prototype.interfaces_=function(){return[]},Tl.prototype.getClass=function(){return Tl},Tl.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new bu(t[n]);return e};var Al=function(){this._subgraphs=null,this._seg=new gl,this._cga=new sc;var t=arguments[0];this._subgraphs=t},Dl={DepthSegment:{configurable:!0}};Al.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var t=arguments[0],e=new bc,n=this._subgraphs.iterator();n.hasNext();){var r=n.next(),i=r.getEnvelope();t.y<i.getMinY()||t.y>i.getMaxY()||this.findStabbedSegments(t,r.getDirectedEdges(),e)}return e}if(3===arguments.length)if(Lu(arguments[2],wc)&&arguments[0]instanceof bu&&arguments[1]instanceof jh)for(var o=arguments[0],s=arguments[1],a=arguments[2],u=s.getEdge().getCoordinates(),c=0;c<u.length-1;c++){this._seg.p0=u[c],this._seg.p1=u[c+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse();if(!(Math.max(this._seg.p0.x,this._seg.p1.x)<o.x)&&!(this._seg.isHorizontal()||o.y<this._seg.p0.y||o.y>this._seg.p1.y||sc.computeOrientation(this._seg.p0,this._seg.p1,o)===sc.RIGHT)){var h=s.getDepth(Nh.LEFT);this._seg.p0.equals(u[c])||(h=s.getDepth(Nh.RIGHT));var l=new Fl(this._seg,h);a.add(l)}}else if(Lu(arguments[2],wc)&&arguments[0]instanceof bu&&Lu(arguments[1],wc))for(var p=arguments[0],f=arguments[1],g=arguments[2],d=f.iterator();d.hasNext();){var y=d.next();y.isForward()&&this.findStabbedSegments(p,y,g)}},Al.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);if(0===e.size())return 0;return $h.min(e)._leftDepth},Al.prototype.interfaces_=function(){return[]},Al.prototype.getClass=function(){return Al},Dl.DepthSegment.get=function(){return Fl},Object.defineProperties(Al,Dl);var Fl=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new gl(t),this._leftDepth=e};Fl.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(e._upwardSeg);return 0!==n?n:0!=(n=-1*e._upwardSeg.orientationIndex(this._upwardSeg))?n:this._upwardSeg.compareTo(e._upwardSeg)},Fl.prototype.compareX=function(t,e){var n=t.p0.compareTo(e.p0);return 0!==n?n:t.p1.compareTo(e.p1)},Fl.prototype.toString=function(){return this._upwardSeg.toString()},Fl.prototype.interfaces_=function(){return[xu]},Fl.prototype.getClass=function(){return Fl};var ql=function(t,e,n){this.p0=t||null,this.p1=e||null,this.p2=n||null};ql.prototype.area=function(){return ql.area(this.p0,this.p1,this.p2)},ql.prototype.signedArea=function(){return ql.signedArea(this.p0,this.p1,this.p2)},ql.prototype.interpolateZ=function(t){if(null===t)throw new _u("Supplied point is null.");return ql.interpolateZ(t,this.p0,this.p1,this.p2)},ql.prototype.longestSideLength=function(){return ql.longestSideLength(this.p0,this.p1,this.p2)},ql.prototype.isAcute=function(){return ql.isAcute(this.p0,this.p1,this.p2)},ql.prototype.circumcentre=function(){return ql.circumcentre(this.p0,this.p1,this.p2)},ql.prototype.area3D=function(){return ql.area3D(this.p0,this.p1,this.p2)},ql.prototype.centroid=function(){return ql.centroid(this.p0,this.p1,this.p2)},ql.prototype.inCentre=function(){return ql.inCentre(this.p0,this.p1,this.p2)},ql.prototype.interfaces_=function(){return[]},ql.prototype.getClass=function(){return ql},ql.area=function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)},ql.signedArea=function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2},ql.det=function(t,e,n,r){return t*r-e*n},ql.interpolateZ=function(t,e,n,r){var i=e.x,o=e.y,s=n.x-i,a=r.x-i,u=n.y-o,c=r.y-o,h=s*c-a*u,l=t.x-i,p=t.y-o,f=(c*l-a*p)/h,g=(-u*l+s*p)/h;return e.z+f*(n.z-e.z)+g*(r.z-e.z)},ql.longestSideLength=function(t,e,n){var r=t.distance(e),i=e.distance(n),o=n.distance(t),s=r;return i>s&&(s=i),o>s&&(s=o),s},ql.isAcute=function(t,e,n){return!!Ll.isAcute(t,e,n)&&(!!Ll.isAcute(e,n,t)&&!!Ll.isAcute(n,t,e))},ql.circumcentre=function(t,e,n){var r=n.x,i=n.y,o=t.x-r,s=t.y-i,a=e.x-r,u=e.y-i,c=2*ql.det(o,s,a,u),h=ql.det(s,o*o+s*s,u,a*a+u*u),l=ql.det(o,o*o+s*s,a,a*a+u*u);return new bu(r-h/c,i+l/c)},ql.perpendicularBisector=function(t,e){var n=e.x-t.x,r=e.y-t.y,i=new Uu(t.x+n/2,t.y+r/2,1),o=new Uu(t.x-r+n/2,t.y+n+r/2,1);return new Uu(i,o)},ql.angleBisector=function(t,e,n){var r=e.distance(t),i=r/(r+e.distance(n)),o=n.x-t.x,s=n.y-t.y;return new bu(t.x+i*o,t.y+i*s)},ql.area3D=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,o=e.z-t.z,s=n.x-t.x,a=n.y-t.y,u=n.z-t.z,c=i*u-o*a,h=o*s-r*u,l=r*a-i*s,p=c*c+h*h+l*l,f=Math.sqrt(p)/2;return f},ql.centroid=function(t,e,n){var r=(t.x+e.x+n.x)/3,i=(t.y+e.y+n.y)/3;return new bu(r,i)},ql.inCentre=function(t,e,n){var r=e.distance(n),i=t.distance(n),o=t.distance(e),s=r+i+o,a=(r*t.x+i*e.x+o*n.x)/s,u=(r*t.y+i*e.y+o*n.y)/s;return new bu(a,u)};var Gl=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new bc;var t=arguments[0],e=arguments[1],n=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=n};Gl.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,Su.EXTERIOR,Su.INTERIOR)},Gl.prototype.addPolygon=function(t){var e=this._distance,n=Nh.LEFT;this._distance<0&&(e=-this._distance,n=Nh.RIGHT);var r=t.getExteriorRing(),i=Cc.removeRepeatedPoints(r.getCoordinates());if(this._distance<0&&this.isErodedCompletely(r,this._distance))return null;if(this._distance<=0&&i.length<3)return null;this.addPolygonRing(i,e,n,Su.EXTERIOR,Su.INTERIOR);for(var o=0;o<t.getNumInteriorRing();o++){var s=t.getInteriorRingN(o),a=Cc.removeRepeatedPoints(s.getCoordinates());this._distance>0&&this.isErodedCompletely(s,-this._distance)||this.addPolygonRing(a,e,Nh.opposite(n),Su.INTERIOR,Su.EXTERIOR)}},Gl.prototype.isTriangleErodedCompletely=function(t,e){var n=new ql(t[0],t[1],t[2]),r=n.inCentre();return sc.distancePointLine(r,n.p0,n.p1)<Math.abs(e)},Gl.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=Cc.removeRepeatedPoints(t.getCoordinates()),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,Su.EXTERIOR,Su.INTERIOR)},Gl.prototype.addCurve=function(t,e,n){if(null===t||t.length<2)return null;var r=new fl(t,new Rh(0,Su.BOUNDARY,e,n));this._curveList.add(r)},Gl.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Gl.prototype.addPolygonRing=function(t,e,n,r,i){if(0===e&&t.length<eh.MINIMUM_VALID_SIZE)return null;var o=r,s=i;t.length>=eh.MINIMUM_VALID_SIZE&&sc.isCCW(t)&&(o=i,s=r,n=Nh.opposite(n));var a=this._curveBuilder.getRingCurve(t,n,e);this.addCurve(a,o,s)},Gl.prototype.add=function(t){if(t.isEmpty())return null;t instanceof $c?this.addPolygon(t):t instanceof Jc?this.addLineString(t):t instanceof Kc?this.addPoint(t):t instanceof th?this.addCollection(t):t instanceof Xc?this.addCollection(t):t instanceof nh?this.addCollection(t):t instanceof jc&&this.addCollection(t)},Gl.prototype.isErodedCompletely=function(t,e){var n=t.getCoordinates();if(n.length<4)return e<0;if(4===n.length)return this.isTriangleErodedCompletely(n,e);var r=t.getEnvelopeInternal(),i=Math.min(r.getHeight(),r.getWidth());return e<0&&2*Math.abs(e)>i},Gl.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},Gl.prototype.interfaces_=function(){return[]},Gl.prototype.getClass=function(){return Gl};var Bl=function(){};Bl.prototype.locate=function(t){},Bl.prototype.interfaces_=function(){return[]},Bl.prototype.getClass=function(){return Bl};var kl=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};kl.prototype.next=function(){if(this._atStart)return this._atStart=!1,kl.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Pi;var t=this._parent.getGeometryN(this._index++);return t instanceof jc?(this._subcollectionIterator=new kl(t),this._subcollectionIterator.next()):t},kl.prototype.remove=function(){throw new Error(this.getClass().getName())},kl.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},kl.prototype.interfaces_=function(){return[Ec]},kl.prototype.getClass=function(){return kl},kl.isAtomic=function(t){return!(t instanceof jc)};var zl=function(){this._geom=null;var t=arguments[0];this._geom=t};zl.prototype.locate=function(t){return zl.locate(t,this._geom)},zl.prototype.interfaces_=function(){return[Bl]},zl.prototype.getClass=function(){return zl},zl.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&sc.isPointInRing(t,e.getCoordinates())},zl.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var n=e.getExteriorRing();if(!zl.isPointInRing(t,n))return!1;for(var r=0;r<e.getNumInteriorRing();r++){var i=e.getInteriorRingN(r);if(zl.isPointInRing(t,i))return!1}return!0},zl.containsPoint=function(t,e){if(e instanceof $c)return zl.containsPointInPolygon(t,e);if(e instanceof jc)for(var n=new kl(e);n.hasNext();){var r=n.next();if(r!==e&&zl.containsPoint(t,r))return!0}return!1},zl.locate=function(t,e){return e.isEmpty()?Su.EXTERIOR:zl.containsPoint(t,e)?Su.INTERIOR:Su.EXTERIOR};var jl=function(){this._edgeMap=new Gi,this._edgeList=null,this._ptInAreaLocation=[Su.NONE,Su.NONE]};jl.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),n=e-1;return 0===e&&(n=this._edgeList.size()-1),this._edgeList.get(n)},jl.prototype.propagateSideLabels=function(t){for(var e=Su.NONE,n=this.iterator();n.hasNext();){var r=n.next().getLabel();r.isArea(t)&&r.getLocation(t,Nh.LEFT)!==Su.NONE&&(e=r.getLocation(t,Nh.LEFT))}if(e===Su.NONE)return null;for(var i=e,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getLabel();if(a.getLocation(t,Nh.ON)===Su.NONE&&a.setLocation(t,Nh.ON,i),a.isArea(t)){var u=a.getLocation(t,Nh.LEFT),c=a.getLocation(t,Nh.RIGHT);if(c!==Su.NONE){if(c!==i)throw new Mh("side location conflict",s.getCoordinate());u===Su.NONE&&tc.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),i=u}else tc.isTrue(a.getLocation(t,Nh.LEFT)===Su.NONE,"found single null side"),a.setLocation(t,Nh.RIGHT,i),a.setLocation(t,Nh.LEFT,i)}}},jl.prototype.getCoordinate=function(){var t=this.iterator();if(!t.hasNext())return null;return t.next().getCoordinate()},jl.prototype.print=function(t){Xu.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){e.next().print(t)}},jl.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},jl.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,r=e.get(n).getLabel().getLocation(t,Nh.LEFT);tc.isTrue(r!==Su.NONE,"Found unlabelled area edge");for(var i=r,o=this.iterator();o.hasNext();){var s=o.next().getLabel();tc.isTrue(s.isArea(t),"Found non-area edge");var a=s.getLocation(t,Nh.LEFT),u=s.getLocation(t,Nh.RIGHT);if(a===u)return!1;if(u!==i)return!1;i=a}return!0},jl.prototype.findIndex=function(t){this.iterator();for(var e=0;e<this._edgeList.size();e++){if(this._edgeList.get(e)===t)return e}return-1},jl.prototype.iterator=function(){return this.getEdges().iterator()},jl.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new bc(this._edgeMap.values())),this._edgeList},jl.prototype.getLocation=function(t,e,n){return this._ptInAreaLocation[t]===Su.NONE&&(this._ptInAreaLocation[t]=zl.locate(e,n[t].getGeometry())),this._ptInAreaLocation[t]},jl.prototype.toString=function(){var t=new Ru;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append("\n")}return t.toString()},jl.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();){e.next().computeLabel(t)}},jl.prototype.computeLabelling=function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],n=this.iterator();n.hasNext();)for(var r=n.next().getLabel(),i=0;i<2;i++)r.isLine(i)&&r.getLocation(i)===Su.BOUNDARY&&(e[i]=!0);for(var o=this.iterator();o.hasNext();)for(var s=o.next(),a=s.getLabel(),u=0;u<2;u++)if(a.isAnyNull(u)){var c=Su.NONE;if(e[u])c=Su.EXTERIOR;else{var h=s.getCoordinate();c=this.getLocation(u,h,t)}a.setAllLocationsIfNull(u,c)}},jl.prototype.getDegree=function(){return this._edgeMap.size()},jl.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null},jl.prototype.interfaces_=function(){return[]},jl.prototype.getClass=function(){return jl};var Xl=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var t=null,e=null,n=this._SCANNING_FOR_INCOMING,r=0;r<this._resultAreaEdgeList.size();r++){var i=this._resultAreaEdgeList.get(r),o=i.getSym();if(i.getLabel().isArea())switch(null===t&&i.isInResult()&&(t=i),n){case this._SCANNING_FOR_INCOMING:if(!o.isInResult())continue;e=o,n=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!i.isInResult())continue;e.setNext(i),n=this._SCANNING_FOR_INCOMING}}if(n===this._LINKING_TO_OUTGOING){if(null===t)throw new Mh("no outgoing dirEdge found",this.getCoordinate());tc.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),e.setNext(t)}},e.prototype.insert=function(t){var e=t;this.insertEdgeEnd(e,e)},e.prototype.getRightmostEdge=function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var n=t.get(0);if(1===e)return n;var r=t.get(e-1),i=n.getQuadrant(),o=r.getQuadrant();return Bh.isNorthern(i)&&Bh.isNorthern(o)?n:Bh.isNorthern(i)||Bh.isNorthern(o)?0!==n.getDy()?n:0!==r.getDy()?r:(tc.shouldNeverReachHere("found two horizontal edges incident on node"),null):r},e.prototype.print=function(t){Xu.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();t.print("out "),n.print(t),t.println(),t.print("in "),n.getSym().print(t),t.println()}},e.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new bc;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next().getLabel();n.setAllLocationsIfNull(0,t.getLocation(0)),n.setAllLocationsIfNull(1,t.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var t=null,e=null,n=this._edgeList.size()-1;n>=0;n--){var r=this._edgeList.get(n),i=r.getSym();null===e&&(e=i),null!==t&&i.setNext(t),t=r}e.setNext(t)},e.prototype.computeDepths=function(){if(1===arguments.length){var t=arguments[0],e=this.findIndex(t),n=t.getDepth(Nh.LEFT),r=t.getDepth(Nh.RIGHT),i=this.computeDepths(e+1,this._edgeList.size(),n);if(this.computeDepths(0,e,i)!==r)throw new Mh("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var o=arguments[0],s=arguments[1],a=arguments[2],u=o;u<s;u++){var c=this._edgeList.get(u);c.setEdgeDepths(Nh.RIGHT,a),a=c.getDepth(Nh.LEFT)}return a}},e.prototype.mergeSymLabels=function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(t){for(var e=null,n=null,r=this._SCANNING_FOR_INCOMING,i=this._resultAreaEdgeList.size()-1;i>=0;i--){var o=this._resultAreaEdgeList.get(i),s=o.getSym();switch(null===e&&o.getEdgeRing()===t&&(e=o),r){case this._SCANNING_FOR_INCOMING:if(s.getEdgeRing()!==t)continue;n=s,r=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(o.getEdgeRing()!==t)continue;n.setNextMin(o),r=this._SCANNING_FOR_INCOMING}}r===this._LINKING_TO_OUTGOING&&(tc.isTrue(null!==e,"found null for first outgoing dirEdge"),tc.isTrue(e.getEdgeRing()===t,"unable to link last incoming dirEdge"),n.setNextMin(e))},e.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();){e.next().isInResult()&&t++}return t}if(1===arguments.length){for(var n=arguments[0],r=0,i=this.iterator();i.hasNext();){i.next().getEdgeRing()===n&&r++}return r}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var t=Su.NONE,e=this.iterator();e.hasNext();){var n=e.next(),r=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){t=Su.INTERIOR;break}if(r.isInResult()){t=Su.EXTERIOR;break}}}if(t===Su.NONE)return null;for(var i=t,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getSym();s.isLineEdge()?s.getEdge().setCovered(i===Su.INTERIOR):(s.isInResult()&&(i=Su.EXTERIOR),a.isInResult()&&(i=Su.INTERIOR))}},e.prototype.computeLabelling=function(e){t.prototype.computeLabelling.call(this,e),this._label=new Rh(Su.NONE);for(var n=this.iterator();n.hasNext();)for(var r=n.next().getEdge().getLabel(),i=0;i<2;i++){var o=r.getLocation(i);o!==Su.INTERIOR&&o!==Su.BOUNDARY||this._label.setLocation(i,Su.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(jl),Ul=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(t){return new qh(t,new Xl)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Xh),Yl=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};Yl.prototype.compareTo=function(t){var e=t;return Yl.compareOriented(this._pts,this._orientation,e._pts,e._orientation)},Yl.prototype.interfaces_=function(){return[xu]},Yl.prototype.getClass=function(){return Yl},Yl.orientation=function(t){return 1===Cc.increasingDirection(t)},Yl.compareOriented=function(t,e,n,r){for(var i=e?1:-1,o=r?1:-1,s=e?t.length:-1,a=r?n.length:-1,u=e?0:t.length-1,c=r?0:n.length-1;;){var h=t[u].compareTo(n[c]);if(0!==h)return h;var l=(u+=i)===s,p=(c+=o)===a;if(l&&!p)return-1;if(!l&&p)return 1;if(l&&p)return 0}};var Vl=function(){this._edges=new bc,this._ocaMap=new Gi};Vl.prototype.print=function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this._edges.size();e++){var n=this._edges.get(e);e>0&&t.print(","),t.print("(");for(var r=n.getCoordinates(),i=0;i<r.length;i++)i>0&&t.print(","),t.print(r[i].x+" "+r[i].y);t.println(")")}t.print(")  ")},Vl.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},Vl.prototype.findEdgeIndex=function(t){for(var e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1},Vl.prototype.iterator=function(){return this._edges.iterator()},Vl.prototype.getEdges=function(){return this._edges},Vl.prototype.get=function(t){return this._edges.get(t)},Vl.prototype.findEqualEdge=function(t){var e=new Yl(t.getCoordinates());return this._ocaMap.get(e)},Vl.prototype.add=function(t){this._edges.add(t);var e=new Yl(t.getCoordinates());this._ocaMap.put(e,t)},Vl.prototype.interfaces_=function(){return[]},Vl.prototype.getClass=function(){return Vl};var Hl=function(){};Hl.prototype.processIntersections=function(t,e,n,r){},Hl.prototype.isDone=function(){},Hl.prototype.interfaces_=function(){return[]},Hl.prototype.getClass=function(){return Hl};var Wl=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Wl.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&1===this._li.getIntersectionNum()){if(Wl.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.size()-1;if(0===e&&r===i||0===r&&e===i)return!0}}return!1},Wl.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Wl.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Wl.prototype.getLineIntersector=function(){return this._li},Wl.prototype.hasProperIntersection=function(){return this._hasProper},Wl.prototype.processIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Wl.prototype.hasIntersection=function(){return this._hasIntersection},Wl.prototype.isDone=function(){return!1},Wl.prototype.hasInteriorIntersection=function(){return this._hasInterior},Wl.prototype.interfaces_=function(){return[Hl]},Wl.prototype.getClass=function(){return Wl},Wl.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var Jl=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new bu(t),this.segmentIndex=e,this.dist=n};Jl.prototype.getSegmentIndex=function(){return this.segmentIndex},Jl.prototype.getCoordinate=function(){return this.coord},Jl.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},Jl.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},Jl.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},Jl.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Jl.prototype.getDistance=function(){return this.dist},Jl.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},Jl.prototype.interfaces_=function(){return[xu]},Jl.prototype.getClass=function(){return Jl};var Zl=function(){this._nodeMap=new Gi,this.edge=null;var t=arguments[0];this.edge=t};Zl.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){e.next().print(t)}},Zl.prototype.iterator=function(){return this._nodeMap.values().iterator()},Zl.prototype.addSplitEdges=function(t){this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var r=e.next(),i=this.createSplitEdge(n,r);t.add(i),n=r}},Zl.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},Zl.prototype.createSplitEdge=function(t,e){var n=e.segmentIndex-t.segmentIndex+2,r=this.edge.pts[e.segmentIndex],i=e.dist>0||!e.coord.equals2D(r);i||n--;var o=new Array(n).fill(null),s=0;o[s++]=new bu(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this.edge.pts[a];return i&&(o[s]=e.coord),new ep(o,new Rh(this.edge._label))},Zl.prototype.add=function(t,e,n){var r=new Jl(t,e,n),i=this._nodeMap.get(r);return null!==i?i:(this._nodeMap.put(r,r),r)},Zl.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();){if(e.next().coord.equals(t))return!0}return!1},Zl.prototype.interfaces_=function(){return[]},Zl.prototype.getClass=function(){return Zl};var Kl=function(){};Kl.prototype.getChainStartIndices=function(t){var e=0,n=new bc;n.add(new Tu(e));do{var r=this.findChainEnd(t,e);n.add(new Tu(r)),e=r}while(e<t.length-1);return Kl.toIntArray(n)},Kl.prototype.findChainEnd=function(t,e){for(var n=Bh.quadrant(t[e],t[e+1]),r=e+1;r<t.length;){if(Bh.quadrant(t[r-1],t[r])!==n)break;r++}return r-1},Kl.prototype.interfaces_=function(){return[]},Kl.prototype.getClass=function(){return Kl},Kl.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var Ql=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Yu,this.env2=new Yu;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new Kl;this.startIndex=e.getChainStartIndices(this.pts)};Ql.prototype.getCoordinates=function(){return this.pts},Ql.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n},Ql.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n},Ql.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],r)}else if(6===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],u=arguments[4],c=arguments[5],h=this.pts[i],l=this.pts[o],p=s.pts[a],f=s.pts[u];if(o-i==1&&u-a==1)return c.addIntersections(this.e,i,s.e,a),null;if(this.env1.init(h,l),this.env2.init(p,f),!this.env1.intersects(this.env2))return null;var g=Math.trunc((i+o)/2),d=Math.trunc((a+u)/2);i<g&&(a<d&&this.computeIntersectsForChain(i,g,s,a,d,c),d<u&&this.computeIntersectsForChain(i,g,s,d,u,c)),g<o&&(a<d&&this.computeIntersectsForChain(g,o,s,a,d,c),d<u&&this.computeIntersectsForChain(g,o,s,d,u,c))}},Ql.prototype.getStartIndexes=function(){return this.startIndex},Ql.prototype.computeIntersects=function(t,e){for(var n=0;n<this.startIndex.length-1;n++)for(var r=0;r<t.startIndex.length-1;r++)this.computeIntersectsForChain(n,t,r,e)},Ql.prototype.interfaces_=function(){return[]},Ql.prototype.getClass=function(){return Ql};var $l=function t(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var e=0;e<2;e++)for(var n=0;n<3;n++)this._depth[e][n]=t.NULL_VALUE},tp={NULL_VALUE:{configurable:!0}};$l.prototype.getDepth=function(t,e){return this._depth[t][e]},$l.prototype.setDepth=function(t,e,n){this._depth[t][e]=n},$l.prototype.isNull=function(){if(0===arguments.length){for(var t=0;t<2;t++)for(var e=0;e<3;e++)if(this._depth[t][e]!==$l.NULL_VALUE)return!1;return!0}if(1===arguments.length){var n=arguments[0];return this._depth[n][1]===$l.NULL_VALUE}if(2===arguments.length){var r=arguments[0],i=arguments[1];return this._depth[r][i]===$l.NULL_VALUE}},$l.prototype.normalize=function(){for(var t=0;t<2;t++)if(!this.isNull(t)){var e=this._depth[t][1];this._depth[t][2]<e&&(e=this._depth[t][2]),e<0&&(e=0);for(var n=1;n<3;n++){var r=0;this._depth[t][n]>e&&(r=1),this._depth[t][n]=r}}},$l.prototype.getDelta=function(t){return this._depth[t][Nh.RIGHT]-this._depth[t][Nh.LEFT]},$l.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?Su.EXTERIOR:Su.INTERIOR},$l.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},$l.prototype.add=function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<2;e++)for(var n=1;n<3;n++){var r=t.getLocation(e,n);r!==Su.EXTERIOR&&r!==Su.INTERIOR||(this.isNull(e,n)?this._depth[e][n]=$l.depthAtLocation(r):this._depth[e][n]+=$l.depthAtLocation(r))}else if(3===arguments.length){var i=arguments[0],o=arguments[1];arguments[2]===Su.INTERIOR&&this._depth[i][o]++}},$l.prototype.interfaces_=function(){return[]},$l.prototype.getClass=function(){return $l},$l.depthAtLocation=function(t){return t===Su.EXTERIOR?0:t===Su.INTERIOR?1:$l.NULL_VALUE},tp.NULL_VALUE.get=function(){return-1},Object.defineProperties($l,tp);var ep=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new Zl(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new $l,this._depthDelta=0,1===arguments.length){var n=arguments[0];e.call(this,n,null)}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.pts=r,this._label=i}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var t=new Array(2).fill(null);t[0]=this.pts[0],t[1]=this.pts[1];return new e(t,Rh.toLineLabel(this._label))},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(t){this._isIsolated=t},e.prototype.setName=function(t){this._name=t},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var n=t;if(this.pts.length!==n.pts.length)return!1;for(var r=!0,i=!0,o=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(n.pts[s])||(r=!1),this.pts[s].equals2D(n.pts[--o])||(i=!1),!r&&!i)return!1;return!0},e.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},e.prototype.print=function(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(t){e.updateIM(this._label,t)},e.prototype.isCollapsed=function(){return!!this._label.isArea()&&(3===this.pts.length&&!!this.pts[0].equals(this.pts[2]))},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(t){t.print("edge "+this._name+": ");for(var e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")},e.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new Ql(this)),this._mce},e.prototype.getEnvelope=function(){if(null===this._env){this._env=new Yu;for(var t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env},e.prototype.addIntersection=function(t,e,n,r){var i=new bu(t.getIntersection(r)),o=e,s=t.getEdgeDistance(n,r),a=o+1;if(a<this.pts.length){var u=this.pts[a];i.equals2D(u)&&(o=a,s=0)}this.eiList.add(i,o,s)},e.prototype.toString=function(){var t=new Ru;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()},e.prototype.isPointwiseEqual=function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},e.prototype.setDepthDelta=function(t){this._depthDelta=t},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++)this.addIntersection(t,e,n,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(2!==arguments.length)return t.prototype.updateIM.apply(this,arguments);var e=arguments[0],n=arguments[1];n.setAtLeastIfValid(e.getLocation(0,Nh.ON),e.getLocation(1,Nh.ON),1),e.isArea()&&(n.setAtLeastIfValid(e.getLocation(0,Nh.LEFT),e.getLocation(1,Nh.LEFT),2),n.setAtLeastIfValid(e.getLocation(0,Nh.RIGHT),e.getLocation(1,Nh.RIGHT),2))},e}(Fh),np=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Vl,this._bufParams=t||null};np.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t},np.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new Rh(t.getLabel())).flip(),n.merge(r);var i=np.depthDelta(r),o=e.getDepthDelta()+i;e.setDepthDelta(o)}else this._edgeList.add(t),t.setDepthDelta(np.depthDelta(t.getLabel()))},np.prototype.buildSubgraphs=function(t,e){for(var n=new bc,r=t.iterator();r.hasNext();){var i=r.next(),o=i.getRightmostCoordinate(),s=new Al(n).getDepth(o);i.computeDepth(s),i.findResultEdges(),n.add(i),e.add(i.getDirectedEdges(),i.getNodes())}},np.prototype.createSubgraphs=function(t){for(var e=new bc,n=t.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var i=new Ph;i.create(r),e.add(i)}}return $h.sort(e,$h.reverseOrder()),e},np.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},np.prototype.getNoder=function(t){if(null!==this._workingNoder)return this._workingNoder;var e=new El,n=new rc;return n.setPrecisionModel(t),e.setSegmentIntersector(new Wl(n)),e},np.prototype.buffer=function(t,e){var n=this._workingPrecisionModel;null===n&&(n=t.getPrecisionModel()),this._geomFact=t.getFactory();var r=new Tl(n,this._bufParams),i=new Gl(t,e,r).getCurves();if(i.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(i,n),this._graph=new Uh(new Ul),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),s=new Yh(this._geomFact);this.buildSubgraphs(o,s);var a=s.getPolygons();if(a.size()<=0)return this.createEmptyResultGeometry();return this._geomFact.buildGeometry(a)},np.prototype.computeNodedEdges=function(t,e){var n=this.getNoder(e);n.computeNodes(t);for(var r=n.getNodedSubstrings().iterator();r.hasNext();){var i=r.next(),o=i.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var s=i.getData(),a=new ep(i.getCoordinates(),new Rh(s));this.insertUniqueEdge(a)}}},np.prototype.setNoder=function(t){this._workingNoder=t},np.prototype.interfaces_=function(){return[]},np.prototype.getClass=function(){return np},np.depthDelta=function(t){var e=t.getLocation(0,Nh.LEFT),n=t.getLocation(0,Nh.RIGHT);return e===Su.INTERIOR&&n===Su.EXTERIOR?1:e===Su.EXTERIOR&&n===Su.INTERIOR?-1:0},np.convertSegStrings=function(t){for(var e=new _h,n=new bc;t.hasNext();){var r=t.next(),i=e.createLineString(r.getCoordinates());n.add(i)}return e.buildGeometry(n)};var rp=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=arguments[3];this._noder=n,this._scaleFactor=r,this._offsetX=i,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}};rp.prototype.rescale=function(){if(Lu(arguments[0],vc))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.rescale(e.getCoordinates())}else if(arguments[0]instanceof Array){for(var n=arguments[0],r=0;r<n.length;r++)n[r].x=n[r].x/this._scaleFactor+this._offsetX,n[r].y=n[r].y/this._scaleFactor+this._offsetY;2===n.length&&n[0].equals2D(n[1])&&Xu.out.println(n)}},rp.prototype.scale=function(){if(Lu(arguments[0],vc)){for(var t=arguments[0],e=new bc,n=t.iterator();n.hasNext();){var r=n.next();e.add(new fl(this.scale(r.getCoordinates()),r.getData()))}return e}if(arguments[0]instanceof Array){for(var i=arguments[0],o=new Array(i.length).fill(null),s=0;s<i.length;s++)o[s]=new bu(Math.round((i[s].x-this._offsetX)*this._scaleFactor),Math.round((i[s].y-this._offsetY)*this._scaleFactor),i[s].z);return Cc.removeRepeatedPoints(o)}},rp.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},rp.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t},rp.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)},rp.prototype.interfaces_=function(){return[vl]},rp.prototype.getClass=function(){return rp};var ip=function(){this._li=new rc,this._segStrings=null;var t=arguments[0];this._segStrings=t},op={fact:{configurable:!0}};ip.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next().getCoordinates();this.checkEndPtVertexIntersections(e[0],this._segStrings),this.checkEndPtVertexIntersections(e[e.length-1],this._segStrings)}else if(2===arguments.length)for(var n=arguments[0],r=arguments[1].iterator();r.hasNext();)for(var i=r.next().getCoordinates(),o=1;o<i.length-1;o++)if(i[o].equals(n))throw new Qu("found endpt/interior pt intersection at index "+o+" :pt "+n)},ip.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();)for(var e=t.next(),n=this._segStrings.iterator();n.hasNext();){var r=n.next();this.checkInteriorIntersections(e,r)}else if(2===arguments.length)for(var i=arguments[0],o=arguments[1],s=i.getCoordinates(),a=o.getCoordinates(),u=0;u<s.length-1;u++)for(var c=0;c<a.length-1;c++)this.checkInteriorIntersections(i,u,o,c);else if(4===arguments.length){var h=arguments[0],l=arguments[1],p=arguments[2],f=arguments[3];if(h===p&&l===f)return null;var g=h.getCoordinates()[l],d=h.getCoordinates()[l+1],y=p.getCoordinates()[f],_=p.getCoordinates()[f+1];if(this._li.computeIntersection(g,d,y,_),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,g,d)||this.hasInteriorIntersection(this._li,y,_)))throw new Qu("found non-noded intersection at "+g+"-"+d+" and "+y+"-"+_)}},ip.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},ip.prototype.checkCollapses=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next();this.checkCollapses(e)}else if(1===arguments.length)for(var n=arguments[0].getCoordinates(),r=0;r<n.length-2;r++)this.checkCollapse(n[r],n[r+1],n[r+2])},ip.prototype.hasInteriorIntersection=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++){var i=t.getIntersection(r);if(!i.equals(e)&&!i.equals(n))return!0}return!1},ip.prototype.checkCollapse=function(t,e,n){if(t.equals(n))throw new Qu("found non-noded collapse at "+ip.fact.createLineString([t,e,n]))},ip.prototype.interfaces_=function(){return[]},ip.prototype.getClass=function(){return ip},op.fact.get=function(){return new _h},Object.defineProperties(ip,op);var sp=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=n,e<=0)throw new _u("Scale factor must be non-zero");1!==e&&(this._pt=new bu(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new bu,this._p1Scaled=new bu),this.initCorners(this._pt)},ap={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};sp.prototype.intersectsScaled=function(t,e){var n=Math.min(t.x,e.x),r=Math.max(t.x,e.x),i=Math.min(t.y,e.y),o=Math.max(t.y,e.y),s=this._maxx<n||this._minx>r||this._maxy<i||this._miny>o;if(s)return!1;var a=this.intersectsToleranceSquare(t,e);return tc.isTrue(!(s&&a),"Found bad envelope test"),a},sp.prototype.initCorners=function(t){this._minx=t.x-.5,this._maxx=t.x+.5,this._miny=t.y-.5,this._maxy=t.y+.5,this._corner[0]=new bu(this._maxx,this._maxy),this._corner[1]=new bu(this._minx,this._maxy),this._corner[2]=new bu(this._minx,this._miny),this._corner[3]=new bu(this._maxx,this._miny)},sp.prototype.intersects=function(t,e){return 1===this._scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},sp.prototype.scale=function(t){return Math.round(t*this._scaleFactor)},sp.prototype.getCoordinate=function(){return this._originalPt},sp.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},sp.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var t=sp.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Yu(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv},sp.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))},sp.prototype.intersectsToleranceSquare=function(t,e){var n=!1,r=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),!!this._li.isProper()||(!(!n||!r)||(!!t.equals(this._pt)||!!e.equals(this._pt))))))},sp.prototype.addSnappedNode=function(t,e){var n=t.getCoordinate(e),r=t.getCoordinate(e+1);return!!this.intersects(n,r)&&(t.addIntersection(this.getCoordinate(),e),!0)},sp.prototype.interfaces_=function(){return[]},sp.prototype.getClass=function(){return sp},ap.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(sp,ap);var up=function(){this.tempEnv1=new Yu,this.selectedSegment=new gl};up.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}},up.prototype.interfaces_=function(){return[]},up.prototype.getClass=function(){return up};var cp=function(){this._index=null;var t=arguments[0];this._index=t},hp={HotPixelSnapAction:{configurable:!0}};cp.prototype.snap=function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2],i=e.getSafeEnvelope(),o=new lp(e,n,r);return this._index.query(i,{interfaces_:function(){return[Jh]},visitItem:function(t){t.select(i,o)}}),o.isNodeAdded()}},cp.prototype.interfaces_=function(){return[]},cp.prototype.getClass=function(){return cp},hp.HotPixelSnapAction.get=function(){return lp},Object.defineProperties(cp,hp);var lp=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._hotPixel=e,this._parentEdge=n,this._hotPixelVertexIndex=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(2!==arguments.length)return t.prototype.select.apply(this,arguments);var e=arguments[0],n=arguments[1],r=e.getContext();if(null!==this._parentEdge&&r===this._parentEdge&&n===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(r,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(up),pp=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new bc};pp.prototype.processIntersections=function(t,e,n,r){if(t===n&&e===r)return null;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];if(this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var u=0;u<this._li.getIntersectionNum();u++)this._interiorIntersections.add(this._li.getIntersection(u));t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)}},pp.prototype.isDone=function(){return!1},pp.prototype.getInteriorIntersections=function(){return this._interiorIntersections},pp.prototype.interfaces_=function(){return[Hl]},pp.prototype.getClass=function(){return pp};var fp=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new rc,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};fp.prototype.checkCorrectness=function(t){var e=fl.getNodedSubstrings(t),n=new ip(e);try{n.checkValid()}catch(t){if(!(t instanceof zu))throw t;t.printStackTrace()}},fp.prototype.getNodedSubstrings=function(){return fl.getNodedSubstrings(this._nodedSegStrings)},fp.prototype.snapRound=function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)},fp.prototype.findInteriorIntersections=function(t,e){var n=new pp(e);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(t),n.getInteriorIntersections()},fp.prototype.computeVertexSnaps=function(){if(Lu(arguments[0],vc))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.computeVertexSnaps(e)}else if(arguments[0]instanceof fl)for(var n=arguments[0],r=n.getCoordinates(),i=0;i<r.length;i++){var o=new sp(r[i],this._scaleFactor,this._li);this._pointSnapper.snap(o,n,i)&&n.addIntersection(r[i],i)}},fp.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new El,this._pointSnapper=new cp(this._noder.getIndex()),this.snapRound(t,this._li)},fp.prototype.computeIntersectionSnaps=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),r=new sp(n,this._scaleFactor,this._li);this._pointSnapper.snap(r)}},fp.prototype.interfaces_=function(){return[vl]},fp.prototype.getClass=function(){return fp};var gp=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new bl,this._resultGeometry=null,this._saveException=null,1===arguments.length){var t=arguments[0];this._argGeom=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._argGeom=e,this._bufParams=n}},dp={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};gp.prototype.bufferFixedPrecision=function(t){var e=new rp(new fp(new fh(1)),t.getScale()),n=new np(this._bufParams);n.setWorkingPrecisionModel(t),n.setNoder(e),this._resultGeometry=n.buffer(this._argGeom,this._distance)},gp.prototype.bufferReducedPrecision=function(){var t=this;if(0===arguments.length){for(var e=gp.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(e){if(!(e instanceof Mh))throw e;t._saveException=e}if(null!==t._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var n=arguments[0],r=gp.precisionScaleFactor(this._argGeom,this._distance,n),i=new fh(r);this.bufferFixedPrecision(i)}},gp.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===fh.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},gp.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)},gp.prototype.bufferOriginalPrecision=function(){try{var t=new np(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof Qu))throw t;this._saveException=t}},gp.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry},gp.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)},gp.prototype.interfaces_=function(){return[]},gp.prototype.getClass=function(){return gp},gp.bufferOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return new gp(t).getResultGeometry(e)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof cc&&"number"==typeof arguments[1]){var n=arguments[0],r=arguments[1],i=arguments[2],o=new gp(n);o.setQuadrantSegments(i);return o.getResultGeometry(r)}if(arguments[2]instanceof bl&&arguments[0]instanceof cc&&"number"==typeof arguments[1]){var s=arguments[0],a=arguments[1],u=arguments[2];return new gp(s,u).getResultGeometry(a)}}else if(4===arguments.length){var c=arguments[0],h=arguments[1],l=arguments[2],p=arguments[3],f=new gp(c);f.setQuadrantSegments(l),f.setEndCapStyle(p);return f.getResultGeometry(h)}},gp.precisionScaleFactor=function(t,e,n){var r=t.getEnvelopeInternal(),i=Pu.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY()))+2*(e>0?e:0),o=n-Math.trunc(Math.log(i)/Math.log(10)+1);return Math.pow(10,o)},dp.CAP_ROUND.get=function(){return bl.CAP_ROUND},dp.CAP_BUTT.get=function(){return bl.CAP_FLAT},dp.CAP_FLAT.get=function(){return bl.CAP_FLAT},dp.CAP_SQUARE.get=function(){return bl.CAP_SQUARE},dp.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(gp,dp);var yp=function(){this._pt=[new bu,new bu],this._distance=mu.NaN,this._isNull=!0};yp.prototype.getCoordinates=function(){return this._pt},yp.prototype.getCoordinate=function(t){return this._pt[t]},yp.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}},yp.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}},yp.prototype.getDistance=function(){return this._distance},yp.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}},yp.prototype.interfaces_=function(){return[]},yp.prototype.getClass=function(){return yp};var _p=function(){};_p.prototype.interfaces_=function(){return[]},_p.prototype.getClass=function(){return _p},_p.computeDistance=function(){if(arguments[2]instanceof yp&&arguments[0]instanceof Jc&&arguments[1]instanceof bu)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=t.getCoordinates(),i=new gl,o=0;o<r.length-1;o++){i.setCoordinates(r[o],r[o+1]);var s=i.closestPoint(e);n.setMinimum(s,e)}else if(arguments[2]instanceof yp&&arguments[0]instanceof $c&&arguments[1]instanceof bu){var a=arguments[0],u=arguments[1],c=arguments[2];_p.computeDistance(a.getExteriorRing(),u,c);for(var h=0;h<a.getNumInteriorRing();h++)_p.computeDistance(a.getInteriorRingN(h),u,c)}else if(arguments[2]instanceof yp&&arguments[0]instanceof cc&&arguments[1]instanceof bu){var l=arguments[0],p=arguments[1],f=arguments[2];if(l instanceof Jc)_p.computeDistance(l,p,f);else if(l instanceof $c)_p.computeDistance(l,p,f);else if(l instanceof jc)for(var g=l,d=0;d<g.getNumGeometries();d++){var y=g.getGeometryN(d);_p.computeDistance(y,p,f)}else f.setMinimum(l.getCoordinate(),p)}else if(arguments[2]instanceof yp&&arguments[0]instanceof gl&&arguments[1]instanceof bu){var _=arguments[0],m=arguments[1],v=arguments[2],x=_.closestPoint(m);v.setMinimum(x,m)}};var mp=function(t){this._maxPtDist=new yp,this._inputGeom=t||null},vp={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};mp.prototype.computeMaxMidpointDistance=function(t){var e=new Ep(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},mp.prototype.computeMaxVertexDistance=function(t){var e=new xp(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},mp.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()},mp.prototype.getDistancePoints=function(){return this._maxPtDist},mp.prototype.interfaces_=function(){return[]},mp.prototype.getClass=function(){return mp},vp.MaxPointDistanceFilter.get=function(){return xp},vp.MaxMidpointDistanceFilter.get=function(){return Ep},Object.defineProperties(mp,vp);var xp=function(t){this._maxPtDist=new yp,this._minPtDist=new yp,this._geom=t||null};xp.prototype.filter=function(t){this._minPtDist.initialize(),_p.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},xp.prototype.getMaxPointDistance=function(){return this._maxPtDist},xp.prototype.interfaces_=function(){return[pc]},xp.prototype.getClass=function(){return xp};var Ep=function(t){this._maxPtDist=new yp,this._minPtDist=new yp,this._geom=t||null};Ep.prototype.filter=function(t,e){if(0===e)return null;var n=t.getCoordinate(e-1),r=t.getCoordinate(e),i=new bu((n.x+r.x)/2,(n.y+r.y)/2);this._minPtDist.initialize(),_p.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Ep.prototype.isDone=function(){return!1},Ep.prototype.isGeometryChanged=function(){return!1},Ep.prototype.getMaxPointDistance=function(){return this._maxPtDist},Ep.prototype.interfaces_=function(){return[zc]},Ep.prototype.getClass=function(){return Ep};var wp=function(t){this._comps=t||null};wp.prototype.filter=function(t){t instanceof $c&&this._comps.add(t)},wp.prototype.interfaces_=function(){return[kc]},wp.prototype.getClass=function(){return wp},wp.getPolygons=function(){if(1===arguments.length){var t=arguments[0];return wp.getPolygons(t,new bc)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof $c?n.add(e):e instanceof jc&&e.apply(new wp(n)),n}};var bp=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this._lines=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._lines=e,this._isForcedToLineString=n}};bp.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof eh){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof Jc&&this._lines.add(t)},bp.prototype.setForceToLineString=function(t){this._isForcedToLineString=t},bp.prototype.interfaces_=function(){return[uc]},bp.prototype.getClass=function(){return bp},bp.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(bp.getLines(t))}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e.getFactory().buildGeometry(bp.getLines(e,n))}},bp.getLines=function(){if(1===arguments.length){var t=arguments[0];return bp.getLines(t,!1)}if(2===arguments.length){if(Lu(arguments[0],vc)&&Lu(arguments[1],vc)){for(var e=arguments[0],n=arguments[1],r=e.iterator();r.hasNext();){var i=r.next();bp.getLines(i,n)}return n}if(arguments[0]instanceof cc&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1],a=new bc;return o.apply(new bp(a,s)),a}if(arguments[0]instanceof cc&&Lu(arguments[1],vc)){var u=arguments[0],c=arguments[1];return u instanceof Jc?c.add(u):u.apply(new bp(c)),c}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&Lu(arguments[0],vc)&&Lu(arguments[1],vc)){for(var h=arguments[0],l=arguments[1],p=arguments[2],f=h.iterator();f.hasNext();){var g=f.next();bp.getLines(g,l,p)}return l}if("boolean"==typeof arguments[2]&&arguments[0]instanceof cc&&Lu(arguments[1],vc)){var d=arguments[0],y=arguments[1],_=arguments[2];return d.apply(new bp(y,_)),y}}};var Ip=function(){if(this._boundaryRule=fc.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new _u("Rule must be non-null");this._boundaryRule=t}};Ip.prototype.locateInternal=function(){if(arguments[0]instanceof bu&&arguments[1]instanceof $c){var t=arguments[0],e=arguments[1];if(e.isEmpty())return Su.EXTERIOR;var n=e.getExteriorRing(),r=this.locateInPolygonRing(t,n);if(r===Su.EXTERIOR)return Su.EXTERIOR;if(r===Su.BOUNDARY)return Su.BOUNDARY;for(var i=0;i<e.getNumInteriorRing();i++){var o=e.getInteriorRingN(i),s=this.locateInPolygonRing(t,o);if(s===Su.INTERIOR)return Su.EXTERIOR;if(s===Su.BOUNDARY)return Su.BOUNDARY}return Su.INTERIOR}if(arguments[0]instanceof bu&&arguments[1]instanceof Jc){var a=arguments[0],u=arguments[1];if(!u.getEnvelopeInternal().intersects(a))return Su.EXTERIOR;var c=u.getCoordinates();return u.isClosed()||!a.equals(c[0])&&!a.equals(c[c.length-1])?sc.isOnLine(a,c)?Su.INTERIOR:Su.EXTERIOR:Su.BOUNDARY}if(arguments[0]instanceof bu&&arguments[1]instanceof Kc){var h=arguments[0];return arguments[1].getCoordinate().equals2D(h)?Su.INTERIOR:Su.EXTERIOR}},Ip.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?sc.locatePointInRing(t,e.getCoordinates()):Su.EXTERIOR},Ip.prototype.intersects=function(t,e){return this.locate(t,e)!==Su.EXTERIOR},Ip.prototype.updateLocationInfo=function(t){t===Su.INTERIOR&&(this._isIn=!0),t===Su.BOUNDARY&&this._numBoundaries++},Ip.prototype.computeLocation=function(t,e){if(e instanceof Kc&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof Jc)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof $c)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Xc)for(var n=e,r=0;r<n.getNumGeometries();r++){var i=n.getGeometryN(r);this.updateLocationInfo(this.locateInternal(t,i))}else if(e instanceof nh)for(var o=e,s=0;s<o.getNumGeometries();s++){var a=o.getGeometryN(s);this.updateLocationInfo(this.locateInternal(t,a))}else if(e instanceof jc)for(var u=new kl(e);u.hasNext();){var c=u.next();c!==e&&this.computeLocation(t,c)}},Ip.prototype.locate=function(t,e){return e.isEmpty()?Su.EXTERIOR:e instanceof Jc?this.locateInternal(t,e):e instanceof $c?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?Su.BOUNDARY:this._numBoundaries>0||this._isIn?Su.INTERIOR:Su.EXTERIOR)},Ip.prototype.interfaces_=function(){return[]},Ip.prototype.getClass=function(){return Ip};var Np=function t(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length){var e=arguments[0],n=arguments[1];t.call(this,e,t.INSIDE_AREA,n)}else if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._component=r,this._segIndex=i,this._pt=o}},Cp={INSIDE_AREA:{configurable:!0}};Np.prototype.isInsideArea=function(){return this._segIndex===Np.INSIDE_AREA},Np.prototype.getCoordinate=function(){return this._pt},Np.prototype.getGeometryComponent=function(){return this._component},Np.prototype.getSegmentIndex=function(){return this._segIndex},Np.prototype.interfaces_=function(){return[]},Np.prototype.getClass=function(){return Np},Cp.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Np,Cp);var Sp=function(t){this._pts=t||null};Sp.prototype.filter=function(t){t instanceof Kc&&this._pts.add(t)},Sp.prototype.interfaces_=function(){return[kc]},Sp.prototype.getClass=function(){return Sp},Sp.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof Kc?$h.singletonList(t):Sp.getPoints(t,new bc)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof Kc?n.add(e):e instanceof jc&&e.apply(new Sp(n)),n}};var Mp=function(){this._locations=null;var t=arguments[0];this._locations=t};Mp.prototype.filter=function(t){(t instanceof Kc||t instanceof Jc||t instanceof $c)&&this._locations.add(new Np(t,0,t.getCoordinate()))},Mp.prototype.interfaces_=function(){return[kc]},Mp.prototype.getClass=function(){return Mp},Mp.getLocations=function(t){var e=new bc;return t.apply(new Mp(e)),e};var Lp=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Ip,this._minDistanceLocation=null,this._minDistance=mu.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=r,this._terminateDistance=i}};Lp.prototype.computeContainmentDistance=function(){if(0===arguments.length){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],r=1-e,i=wp.getPolygons(this._geom[e]);if(i.size()>0){var o=Mp.getLocations(this._geom[r]);if(this.computeContainmentDistance(o,i,n),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[r]=n[0],this._minDistanceLocation[e]=n[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&Lu(arguments[0],wc)&&Lu(arguments[1],wc)){for(var s=arguments[0],a=arguments[1],u=arguments[2],c=0;c<s.size();c++)for(var h=s.get(c),l=0;l<a.size();l++)if(this.computeContainmentDistance(h,a.get(l),u),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Np&&arguments[1]instanceof $c){var p=arguments[0],f=arguments[1],g=arguments[2],d=p.getCoordinate();if(Su.EXTERIOR!==this._ptLocator.locate(d,f))return this._minDistance=0,g[0]=p,g[1]=new Np(f,d),null}},Lp.prototype.computeMinDistanceLinesPoints=function(t,e,n){for(var r=0;r<t.size();r++)for(var i=t.get(r),o=0;o<e.size();o++){var s=e.get(o);if(this.computeMinDistance(i,s,n),this._minDistance<=this._terminateDistance)return null}},Lp.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=bp.getLines(this._geom[0]),n=bp.getLines(this._geom[1]),r=Sp.getPoints(this._geom[0]),i=Sp.getPoints(this._geom[1]);return this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,r,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(r,i,t),void this.updateMinDistance(t,!1))))},Lp.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Lp.prototype.updateMinDistance=function(t,e){if(null===t[0])return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])},Lp.prototype.nearestPoints=function(){this.computeMinDistance();return[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Lp.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof Jc&&arguments[1]instanceof Kc){var t=arguments[0],e=arguments[1],n=arguments[2];if(t.getEnvelopeInternal().distance(e.getEnvelopeInternal())>this._minDistance)return null;for(var r=t.getCoordinates(),i=e.getCoordinate(),o=0;o<r.length-1;o++){var s=sc.distancePointLine(i,r[o],r[o+1]);if(s<this._minDistance){this._minDistance=s;var a=new gl(r[o],r[o+1]).closestPoint(i);n[0]=new Np(t,o,a),n[1]=new Np(e,0,i)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Jc&&arguments[1]instanceof Jc){var u=arguments[0],c=arguments[1],h=arguments[2];if(u.getEnvelopeInternal().distance(c.getEnvelopeInternal())>this._minDistance)return null;for(var l=u.getCoordinates(),p=c.getCoordinates(),f=0;f<l.length-1;f++)for(var g=0;g<p.length-1;g++){var d=sc.distanceLineLine(l[f],l[f+1],p[g],p[g+1]);if(d<this._minDistance){this._minDistance=d;var y=new gl(l[f],l[f+1]),_=new gl(p[g],p[g+1]),m=y.closestPoints(_);h[0]=new Np(u,f,m[0]),h[1]=new Np(c,g,m[1])}if(this._minDistance<=this._terminateDistance)return null}}},Lp.prototype.computeMinDistancePoints=function(t,e,n){for(var r=0;r<t.size();r++)for(var i=t.get(r),o=0;o<e.size();o++){var s=e.get(o),a=i.getCoordinate().distance(s.getCoordinate());if(a<this._minDistance&&(this._minDistance=a,n[0]=new Np(i,0,i.getCoordinate()),n[1]=new Np(s,0,s.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},Lp.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new _u("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Lp.prototype.computeMinDistanceLines=function(t,e,n){for(var r=0;r<t.size();r++)for(var i=t.get(r),o=0;o<e.size();o++){var s=e.get(o);if(this.computeMinDistance(i,s,n),this._minDistance<=this._terminateDistance)return null}},Lp.prototype.interfaces_=function(){return[]},Lp.prototype.getClass=function(){return Lp},Lp.distance=function(t,e){return new Lp(t,e).distance()},Lp.isWithinDistance=function(t,e,n){return new Lp(t,e,n).distance()<=n},Lp.nearestPoints=function(t,e){return new Lp(t,e).nearestPoints()};var Pp=function(){this._pt=[new bu,new bu],this._distance=mu.NaN,this._isNull=!0};Pp.prototype.getCoordinates=function(){return this._pt},Pp.prototype.getCoordinate=function(t){return this._pt[t]},Pp.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}},Pp.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}},Pp.prototype.toString=function(){return Ku.toLineString(this._pt[0],this._pt[1])},Pp.prototype.getDistance=function(){return this._distance},Pp.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}},Pp.prototype.interfaces_=function(){return[]},Pp.prototype.getClass=function(){return Pp};var Op=function(){};Op.prototype.interfaces_=function(){return[]},Op.prototype.getClass=function(){return Op},Op.computeDistance=function(){if(arguments[2]instanceof Pp&&arguments[0]instanceof Jc&&arguments[1]instanceof bu)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=new gl,i=t.getCoordinates(),o=0;o<i.length-1;o++){r.setCoordinates(i[o],i[o+1]);var s=r.closestPoint(e);n.setMinimum(s,e)}else if(arguments[2]instanceof Pp&&arguments[0]instanceof $c&&arguments[1]instanceof bu){var a=arguments[0],u=arguments[1],c=arguments[2];Op.computeDistance(a.getExteriorRing(),u,c);for(var h=0;h<a.getNumInteriorRing();h++)Op.computeDistance(a.getInteriorRingN(h),u,c)}else if(arguments[2]instanceof Pp&&arguments[0]instanceof cc&&arguments[1]instanceof bu){var l=arguments[0],p=arguments[1],f=arguments[2];if(l instanceof Jc)Op.computeDistance(l,p,f);else if(l instanceof $c)Op.computeDistance(l,p,f);else if(l instanceof jc)for(var g=l,d=0;d<g.getNumGeometries();d++){var y=g.getGeometryN(d);Op.computeDistance(y,p,f)}else f.setMinimum(l.getCoordinate(),p)}else if(arguments[2]instanceof Pp&&arguments[0]instanceof gl&&arguments[1]instanceof bu){var _=arguments[0],m=arguments[1],v=arguments[2],x=_.closestPoint(m);v.setMinimum(x,m)}};var Rp=function(){this._g0=null,this._g1=null,this._ptDist=new Pp,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},Tp={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Rp.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},Rp.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new _u("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t},Rp.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)},Rp.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},Rp.prototype.computeOrientedDistance=function(t,e,n){var r=new Ap(e);if(t.apply(r),n.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var i=new Dp(e,this._densifyFrac);t.apply(i),n.setMaximum(i.getMaxPointDistance())}},Rp.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},Rp.prototype.interfaces_=function(){return[]},Rp.prototype.getClass=function(){return Rp},Rp.distance=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return new Rp(t,e).distance()}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=new Rp(n,r);return o.setDensifyFraction(i),o.distance()}},Tp.MaxPointDistanceFilter.get=function(){return Ap},Tp.MaxDensifiedByFractionDistanceFilter.get=function(){return Dp},Object.defineProperties(Rp,Tp);var Ap=function(){this._maxPtDist=new Pp,this._minPtDist=new Pp,this._euclideanDist=new Op,this._geom=null;var t=arguments[0];this._geom=t};Ap.prototype.filter=function(t){this._minPtDist.initialize(),Op.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Ap.prototype.getMaxPointDistance=function(){return this._maxPtDist},Ap.prototype.interfaces_=function(){return[pc]},Ap.prototype.getClass=function(){return Ap};var Dp=function(){this._maxPtDist=new Pp,this._minPtDist=new Pp,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};Dp.prototype.filter=function(t,e){if(0===e)return null;for(var n=t.getCoordinate(e-1),r=t.getCoordinate(e),i=(r.x-n.x)/this._numSubSegs,o=(r.y-n.y)/this._numSubSegs,s=0;s<this._numSubSegs;s++){var a=n.x+s*i,u=n.y+s*o,c=new bu(a,u);this._minPtDist.initialize(),Op.computeDistance(this._geom,c,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},Dp.prototype.isDone=function(){return!1},Dp.prototype.isGeometryChanged=function(){return!1},Dp.prototype.getMaxPointDistance=function(){return this._maxPtDist},Dp.prototype.interfaces_=function(){return[zc]},Dp.prototype.getClass=function(){return Dp};var Fp=function(t,e,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=n||null},qp={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Fp.prototype.checkMaximumDistance=function(t,e,n){var r=new Rp(e,t);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var i=r.getCoordinates();this._errorLocation=i[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Ku.toLineString(i[0],i[1])+")"}},Fp.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=Fp.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Fp.VERBOSE&&Xu.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Fp.prototype.checkNegativeValid=function(){if(!(this._input instanceof $c||this._input instanceof nh||this._input instanceof jc))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)},Fp.prototype.getErrorIndicator=function(){return this._errorIndicator},Fp.prototype.checkMinimumDistance=function(t,e,n){var r=new Lp(t,e,n);if(this._minDistanceFound=r.distance(),this._minDistanceFound<n){this._isValid=!1;var i=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Ku.toLineString(i[0],i[1])+" )"}},Fp.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)},Fp.prototype.getErrorLocation=function(){return this._errorLocation},Fp.prototype.getPolygonLines=function(t){for(var e=new bc,n=new bp(e),r=wp.getPolygons(t).iterator();r.hasNext();){r.next().apply(n)}return t.getFactory().buildGeometry(e)},Fp.prototype.getErrorMessage=function(){return this._errMsg},Fp.prototype.interfaces_=function(){return[]},Fp.prototype.getClass=function(){return Fp},qp.VERBOSE.get=function(){return!1},qp.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Fp,qp);var Gp=function(t,e,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=n||null},Bp={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Gp.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},Gp.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*Gp.MAX_ENV_DIFF_FRAC;0===t&&(t=.001);var e=new Yu(this._input.getEnvelopeInternal());e.expandBy(this._distance);var n=new Yu(this._result.getEnvelopeInternal());n.expandBy(t),n.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")},Gp.prototype.checkDistance=function(){var t=new Fp(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")},Gp.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},Gp.prototype.checkPolygonal=function(){this._result instanceof $c||this._result instanceof nh||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},Gp.prototype.getErrorIndicator=function(){return this._errorIndicator},Gp.prototype.getErrorLocation=function(){return this._errorLocation},Gp.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2?null:this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},Gp.prototype.report=function(t){if(!Gp.VERBOSE)return null;Xu.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))},Gp.prototype.getErrorMessage=function(){return this._errorMsg},Gp.prototype.interfaces_=function(){return[]},Gp.prototype.getClass=function(){return Gp},Gp.isValidMsg=function(t,e,n){var r=new Gp(t,e,n);return r.isValid()?null:r.getErrorMessage()},Gp.isValid=function(t,e,n){return!!new Gp(t,e,n).isValid()},Bp.VERBOSE.get=function(){return!1},Bp.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Gp,Bp);var kp=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};kp.prototype.getCoordinates=function(){return this._pts},kp.prototype.size=function(){return this._pts.length},kp.prototype.getCoordinate=function(t){return this._pts[t]},kp.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},kp.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:hl.octant(this.getCoordinate(t),this.getCoordinate(t+1))},kp.prototype.setData=function(t){this._data=t},kp.prototype.getData=function(){return this._data},kp.prototype.toString=function(){return Ku.toLineString(new uh(this._pts))},kp.prototype.interfaces_=function(){return[ll]},kp.prototype.getClass=function(){return kp};var zp=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new bc,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};zp.prototype.getInteriorIntersection=function(){return this._interiorIntersection},zp.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t},zp.prototype.getIntersectionSegments=function(){return this._intSegments},zp.prototype.count=function(){return this._intersectionCount},zp.prototype.getIntersections=function(){return this._intersections},zp.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},zp.prototype.setKeepIntersections=function(t){this._keepIntersections=t},zp.prototype.processIntersections=function(t,e,n,r){if(!this._findAllIntersections&&this.hasIntersection())return null;if(t===n&&e===r)return null;if(this._isCheckEndSegmentsOnly){if(!(this.isEndSegment(t,e)||this.isEndSegment(n,r)))return null}var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=i,this._intSegments[1]=o,this._intSegments[2]=s,this._intSegments[3]=a,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},zp.prototype.isEndSegment=function(t,e){return 0===e||e>=t.size()-2},zp.prototype.hasIntersection=function(){return null!==this._interiorIntersection},zp.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},zp.prototype.interfaces_=function(){return[Hl]},zp.prototype.getClass=function(){return zp},zp.createAllIntersectionsFinder=function(t){var e=new zp(t);return e.setFindAllIntersections(!0),e},zp.createAnyIntersectionFinder=function(t){return new zp(t)},zp.createIntersectionCounter=function(t){var e=new zp(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var jp=function(){this._li=new rc,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};jp.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},jp.prototype.getIntersections=function(){return this._segInt.getIntersections()},jp.prototype.isValid=function(){return this.execute(),this._isValid},jp.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},jp.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new zp(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new El;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},jp.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Mh(this.getErrorMessage(),this._segInt.getInteriorIntersection())},jp.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Ku.toLineString(t[0],t[1])+" and "+Ku.toLineString(t[2],t[3])},jp.prototype.interfaces_=function(){return[]},jp.prototype.getClass=function(){return jp},jp.computeIntersections=function(t){var e=new jp(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var Xp=function t(){this._nv=null;var e=arguments[0];this._nv=new jp(t.toSegmentStrings(e))};Xp.prototype.checkValid=function(){this._nv.checkValid()},Xp.prototype.interfaces_=function(){return[]},Xp.prototype.getClass=function(){return Xp},Xp.toSegmentStrings=function(t){for(var e=new bc,n=t.iterator();n.hasNext();){var r=n.next();e.add(new kp(r.getCoordinates(),r))}return e},Xp.checkValid=function(t){new Xp(t).checkValid()};var Up=function(t){this._mapOp=t};Up.prototype.map=function(t){for(var e=new bc,n=0;n<t.getNumGeometries();n++){var r=this._mapOp.map(t.getGeometryN(n));r.isEmpty()||e.add(r)}return t.getFactory().createGeometryCollection(_h.toGeometryArray(e))},Up.prototype.interfaces_=function(){return[]},Up.prototype.getClass=function(){return Up},Up.map=function(t,e){return new Up(e).map(t)};var Yp=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new bc,this._resultLineList=new bc;var t=arguments[0],e=arguments[1],n=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=n};Yp.prototype.collectLines=function(t){for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var n=e.next();this.collectLineEdge(n,t,this._lineEdgesList),this.collectBoundaryTouchEdge(n,t,this._lineEdgesList)}},Yp.prototype.labelIsolatedLine=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,n)},Yp.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList},Yp.prototype.collectLineEdge=function(t,e,n){var r=t.getLabel(),i=t.getEdge();t.isLineEdge()&&(t.isVisited()||!Cf.isResultOfOp(r,e)||i.isCovered()||(n.add(i),t.setVisitedEdge(!0)))},Yp.prototype.findCoveredLineEdges=function(){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();){t.next().getEdges().findCoveredLineEdges()}for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var n=e.next(),r=n.getEdge();if(n.isLineEdge()&&!r.isCoveredSet()){var i=this._op.isCoveredByA(n.getCoordinate());r.setCovered(i)}}},Yp.prototype.labelIsolatedLines=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),r=n.getLabel();n.isIsolated()&&(r.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}},Yp.prototype.buildLines=function(t){for(var e=this._lineEdgesList.iterator();e.hasNext();){var n=e.next(),r=this._geometryFactory.createLineString(n.getCoordinates());this._resultLineList.add(r),n.setInResult(!0)}},Yp.prototype.collectBoundaryTouchEdge=function(t,e,n){var r=t.getLabel();return t.isLineEdge()?null:t.isVisited()?null:t.isInteriorAreaEdge()?null:t.getEdge().isInResult()?null:(tc.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(Cf.isResultOfOp(r,e)&&e===Cf.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))))},Yp.prototype.interfaces_=function(){return[]},Yp.prototype.getClass=function(){return Yp};var Vp=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new bc;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};Vp.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var n=this._geometryFactory.createPoint(e);this._resultPointList.add(n)}},Vp.prototype.extractNonCoveredResultNodes=function(t){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();){var n=e.next();if(!n.isInResult()&&(!n.isIncidentEdgeInResult()&&(0===n.getEdges().getDegree()||t===Cf.INTERSECTION))){var r=n.getLabel();Cf.isResultOfOp(r,t)&&this.filterCoveredNodeToPoint(n)}}},Vp.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList},Vp.prototype.interfaces_=function(){return[]},Vp.prototype.getClass=function(){return Vp};var Hp=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Hp.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},Hp.prototype.transformPolygon=function(t,e){var n=!0,r=this.transformLinearRing(t.getExteriorRing(),t);null!==r&&r instanceof eh&&!r.isEmpty()||(n=!1);for(var i=new bc,o=0;o<t.getNumInteriorRing();o++){var s=this.transformLinearRing(t.getInteriorRingN(o),t);null===s||s.isEmpty()||(s instanceof eh||(n=!1),i.add(s))}if(n)return this._factory.createPolygon(r,i.toArray([]));var a=new bc;return null!==r&&a.add(r),a.addAll(i),this._factory.buildGeometry(a)},Hp.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)},Hp.prototype.getInputGeometry=function(){return this._inputGeom},Hp.prototype.transformMultiLineString=function(t,e){for(var n=new bc,r=0;r<t.getNumGeometries();r++){var i=this.transformLineString(t.getGeometryN(r),t);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},Hp.prototype.transformCoordinates=function(t,e){return this.copy(t)},Hp.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},Hp.prototype.transformMultiPoint=function(t,e){for(var n=new bc,r=0;r<t.getNumGeometries();r++){var i=this.transformPoint(t.getGeometryN(r),t);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},Hp.prototype.transformMultiPolygon=function(t,e){for(var n=new bc,r=0;r<t.getNumGeometries();r++){var i=this.transformPolygon(t.getGeometryN(r),t);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},Hp.prototype.copy=function(t){return t.copy()},Hp.prototype.transformGeometryCollection=function(t,e){for(var n=new bc,r=0;r<t.getNumGeometries();r++){var i=this.transform(t.getGeometryN(r));null!==i&&(this._pruneEmptyGeometry&&i.isEmpty()||n.add(i))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(_h.toGeometryArray(n)):this._factory.buildGeometry(n)},Hp.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof Kc)return this.transformPoint(t,null);if(t instanceof th)return this.transformMultiPoint(t,null);if(t instanceof eh)return this.transformLinearRing(t,null);if(t instanceof Jc)return this.transformLineString(t,null);if(t instanceof Xc)return this.transformMultiLineString(t,null);if(t instanceof $c)return this.transformPolygon(t,null);if(t instanceof nh)return this.transformMultiPolygon(t,null);if(t instanceof jc)return this.transformGeometryCollection(t,null);throw new _u("Unknown Geometry subtype: "+t.getClass().getName())},Hp.prototype.transformLinearRing=function(t,e){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===n)return this._factory.createLinearRing(null);var r=n.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)},Hp.prototype.interfaces_=function(){return[]},Hp.prototype.getClass=function(){return Hp};var Wp=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new gl,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Jc&&"number"==typeof arguments[1]){var e=arguments[0],n=arguments[1];t.call(this,e.getCoordinates(),n)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var r=arguments[0],i=arguments[1];this._srcPts=r,this._isClosed=t.isClosed(r),this._snapTolerance=i}};Wp.prototype.snapVertices=function(t,e){for(var n=this._isClosed?t.size()-1:t.size(),r=0;r<n;r++){var i=t.get(r),o=this.findSnapForVertex(i,e);null!==o&&(t.set(r,new bu(o)),0===r&&this._isClosed&&t.set(t.size()-1,new bu(o)))}},Wp.prototype.findSnapForVertex=function(t,e){for(var n=0;n<e.length;n++){if(t.equals2D(e[n]))return null;if(t.distance(e[n])<this._snapTolerance)return e[n]}return null},Wp.prototype.snapTo=function(t){var e=new Nc(this._srcPts);this.snapVertices(e,t),this.snapSegments(e,t);return e.toCoordinateArray()},Wp.prototype.snapSegments=function(t,e){if(0===e.length)return null;var n=e.length;e[0].equals2D(e[e.length-1])&&(n=e.length-1);for(var r=0;r<n;r++){var i=e[r],o=this.findSegmentIndexToSnap(i,t);o>=0&&t.add(o+1,new bu(i),!1)}},Wp.prototype.findSegmentIndexToSnap=function(t,e){for(var n=mu.MAX_VALUE,r=-1,i=0;i<e.size()-1;i++){if(this._seg.p0=e.get(i),this._seg.p1=e.get(i+1),this._seg.p0.equals2D(t)||this._seg.p1.equals2D(t)){if(this._allowSnappingToSourceVertices)continue;return-1}var o=this._seg.distance(t);o<this._snapTolerance&&o<n&&(n=o,r=i)}return r},Wp.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t},Wp.prototype.interfaces_=function(){return[]},Wp.prototype.getClass=function(){return Wp},Wp.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])};var Jp=function(t){this._srcGeom=t||null},Zp={SNAP_PRECISION_FACTOR:{configurable:!0}};Jp.prototype.snapTo=function(t,e){var n=this.extractTargetCoordinates(t);return new Kp(e,n).transform(this._srcGeom)},Jp.prototype.snapToSelf=function(t,e){var n=this.extractTargetCoordinates(this._srcGeom),r=new Kp(t,n,!0).transform(this._srcGeom),i=r;return e&&Lu(i,Qc)&&(i=r.buffer(0)),i},Jp.prototype.computeSnapTolerance=function(t){return this.computeMinimumSegmentLength(t)/10},Jp.prototype.extractTargetCoordinates=function(t){for(var e=new ki,n=t.getCoordinates(),r=0;r<n.length;r++)e.add(n[r]);return e.toArray(new Array(0).fill(null))},Jp.prototype.computeMinimumSegmentLength=function(t){for(var e=mu.MAX_VALUE,n=0;n<t.length-1;n++){var r=t[n].distance(t[n+1]);r<e&&(e=r)}return e},Jp.prototype.interfaces_=function(){return[]},Jp.prototype.getClass=function(){return Jp},Jp.snap=function(t,e,n){var r=new Array(2).fill(null),i=new Jp(t);r[0]=i.snapTo(e,n);var o=new Jp(e);return r[1]=o.snapTo(r[0],n),r},Jp.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=Jp.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===fh.FIXED){var r=1/n.getScale()*2/1.415;r>e&&(e=r)}return e}if(2===arguments.length){var i=arguments[0],o=arguments[1];return Math.min(Jp.computeOverlaySnapTolerance(i),Jp.computeOverlaySnapTolerance(o))}},Jp.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*Jp.SNAP_PRECISION_FACTOR},Jp.snapToSelf=function(t,e,n){return new Jp(t).snapToSelf(e,n)},Zp.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(Jp,Zp);var Kp=function(t){function e(e,n,r){t.call(this),this._snapTolerance=e||null,this._snapPts=n||null,this._isSelfSnap=void 0!==r&&r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(t,e){var n=new Wp(t,this._snapTolerance);return n.setAllowSnappingToSourceVertices(this._isSelfSnap),n.snapTo(e)},e.prototype.transformCoordinates=function(t,e){var n=t.toCoordinateArray(),r=this.snapLine(n,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Hp),Qp=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Qp.prototype.getCommon=function(){return mu.longBitsToDouble(this._commonBits)},Qp.prototype.add=function(t){var e=mu.doubleToLongBits(t);if(this._isFirst)return this._commonBits=e,this._commonSignExp=Qp.signExpBits(this._commonBits),this._isFirst=!1,null;if(Qp.signExpBits(e)!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=Qp.numCommonMostSigMantissaBits(this._commonBits,e),this._commonBits=Qp.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))},Qp.prototype.toString=function(){if(1===arguments.length){var t=arguments[0],e=mu.longBitsToDouble(t),n="0000000000000000000000000000000000000000000000000000000000000000"+mu.toBinaryString(t),r=n.substring(n.length-64);return r.substring(0,1)+"  "+r.substring(1,12)+"(exp) "+r.substring(12)+" [ "+e+" ]"}},Qp.prototype.interfaces_=function(){return[]},Qp.prototype.getClass=function(){return Qp},Qp.getBit=function(t,e){return 0!=(t&1<<e)?1:0},Qp.signExpBits=function(t){return t>>52},Qp.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},Qp.numCommonMostSigMantissaBits=function(t,e){for(var n=0,r=52;r>=0;r--){if(Qp.getBit(t,r)!==Qp.getBit(e,r))return n;n++}return 52};var $p=function(){this._commonCoord=null,this._ccFilter=new ef},tf={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};$p.prototype.addCommonBits=function(t){var e=new nf(this._commonCoord);t.apply(e),t.geometryChanged()},$p.prototype.removeCommonBits=function(t){if(0===this._commonCoord.x&&0===this._commonCoord.y)return t;var e=new bu(this._commonCoord);e.x=-e.x,e.y=-e.y;var n=new nf(e);return t.apply(n),t.geometryChanged(),t},$p.prototype.getCommonCoordinate=function(){return this._commonCoord},$p.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},$p.prototype.interfaces_=function(){return[]},$p.prototype.getClass=function(){return $p},tf.CommonCoordinateFilter.get=function(){return ef},tf.Translater.get=function(){return nf},Object.defineProperties($p,tf);var ef=function(){this._commonBitsX=new Qp,this._commonBitsY=new Qp};ef.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)},ef.prototype.getCommonCoordinate=function(){return new bu(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},ef.prototype.interfaces_=function(){return[pc]},ef.prototype.getClass=function(){return ef};var nf=function(){this.trans=null;var t=arguments[0];this.trans=t};nf.prototype.filter=function(t,e){var n=t.getOrdinate(e,0)+this.trans.x,r=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,r)},nf.prototype.isDone=function(){return!1},nf.prototype.isGeometryChanged=function(){return!0},nf.prototype.interfaces_=function(){return[zc]},nf.prototype.getClass=function(){return nf};var rf=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};rf.prototype.selfSnap=function(t){return new Jp(t).snapTo(t,this._snapTolerance)},rf.prototype.removeCommonBits=function(t){this._cbr=new $p,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e},rf.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t},rf.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),n=Cf.overlayOp(e[0],e[1],t);return this.prepareResult(n)},rf.prototype.checkValid=function(t){t.isValid()||Xu.out.println("Snapped geometry is invalid")},rf.prototype.computeSnapTolerance=function(){this._snapTolerance=Jp.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},rf.prototype.snap=function(t){var e=this.removeCommonBits(t);return Jp.snap(e[0],e[1],this._snapTolerance)},rf.prototype.interfaces_=function(){return[]},rf.prototype.getClass=function(){return rf},rf.overlayOp=function(t,e,n){return new rf(t,e).getResultGeometry(n)},rf.union=function(t,e){return rf.overlayOp(t,e,Cf.UNION)},rf.intersection=function(t,e){return rf.overlayOp(t,e,Cf.INTERSECTION)},rf.symDifference=function(t,e){return rf.overlayOp(t,e,Cf.SYMDIFFERENCE)},rf.difference=function(t,e){return rf.overlayOp(t,e,Cf.DIFFERENCE)};var of=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};of.prototype.getResultGeometry=function(t){var e=null,n=!1,r=null;try{e=Cf.overlayOp(this._geom[0],this._geom[1],t);n=!0}catch(t){if(!(t instanceof Qu))throw t;r=t}if(!n)try{e=rf.overlayOp(this._geom[0],this._geom[1],t)}catch(t){throw t instanceof Qu?r:t}return e},of.prototype.interfaces_=function(){return[]},of.prototype.getClass=function(){return of},of.overlayOp=function(t,e,n){return new of(t,e).getResultGeometry(n)},of.union=function(t,e){return of.overlayOp(t,e,Cf.UNION)},of.intersection=function(t,e){return of.overlayOp(t,e,Cf.INTERSECTION)},of.symDifference=function(t,e){return of.overlayOp(t,e,Cf.SYMDIFFERENCE)},of.difference=function(t,e){return of.overlayOp(t,e,Cf.DIFFERENCE)};var sf=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};sf.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},sf.prototype.interfaces_=function(){return[]},sf.prototype.getClass=function(){return sf};var af=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var e=arguments[0],n=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=n}else if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._eventType=t.INSERT,this._label=r,this._xValue=i,this._obj=o}},uf={INSERT:{configurable:!0},DELETE:{configurable:!0}};af.prototype.isDelete=function(){return this._eventType===af.DELETE},af.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t},af.prototype.getObject=function(){return this._obj},af.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0},af.prototype.getInsertEvent=function(){return this._insertEvent},af.prototype.isInsert=function(){return this._eventType===af.INSERT},af.prototype.isSameLabel=function(t){return null!==this._label&&this._label===t._label},af.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},af.prototype.interfaces_=function(){return[xu]},af.prototype.getClass=function(){return af},uf.INSERT.get=function(){return 1},uf.DELETE.get=function(){return 2},Object.defineProperties(af,uf);var cf=function(){};cf.prototype.interfaces_=function(){return[]},cf.prototype.getClass=function(){return cf};var hf=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=n};hf.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&1===this._li.getIntersectionNum()){if(hf.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.getNumPoints()-1;if(0===e&&r===i||0===r&&e===i)return!0}}return!1},hf.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},hf.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t},hf.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},hf.prototype.isBoundaryPointInternal=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next().getCoordinate();if(t.isIntersection(r))return!0}return!1},hf.prototype.hasProperIntersection=function(){return this._hasProper},hf.prototype.hasIntersection=function(){return this._hasIntersection},hf.prototype.isDone=function(){return this._isDone},hf.prototype.isBoundaryPoint=function(t,e){return null!==e&&(!!this.isBoundaryPointInternal(t,e[0])||!!this.isBoundaryPointInternal(t,e[1]))},hf.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e},hf.prototype.addIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},hf.prototype.interfaces_=function(){return[]},hf.prototype.getClass=function(){return hf},hf.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var lf=function(t){function e(){t.call(this),this.events=new bc,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){$h.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},e.prototype.computeIntersections=function(){if(1===arguments.length){var t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var e=0;e<this.events.size();e++){var n=this.events.get(e);if(n.isInsert()&&this.processOverlaps(e,n.getDeleteEventIndex(),n,t),t.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof hf&&Lu(arguments[0],wc)&&Lu(arguments[1],wc)){var r=arguments[0],i=arguments[1],o=arguments[2];this.addEdges(r,r),this.addEdges(i,i),this.computeIntersections(o)}else if("boolean"==typeof arguments[2]&&Lu(arguments[0],wc)&&arguments[1]instanceof hf){var s=arguments[0],a=arguments[1];arguments[2]?this.addEdges(s,null):this.addEdges(s),this.computeIntersections(a)}},e.prototype.addEdge=function(t,e){for(var n=t.getMonotoneChainEdge(),r=n.getStartIndexes(),i=0;i<r.length-1;i++){var o=new sf(n,i),s=new af(e,n.getMinX(i),o);this.events.add(s),this.events.add(new af(n.getMaxX(i),s))}},e.prototype.processOverlaps=function(t,e,n,r){for(var i=n.getObject(),o=t;o<e;o++){var s=this.events.get(o);if(s.isInsert()){var a=s.getObject();n.isSameLabel(s)||(i.computeIntersections(a,r),this.nOverlaps++)}}},e.prototype.addEdges=function(){if(1===arguments.length)for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.addEdge(e,e)}else if(2===arguments.length)for(var n=arguments[0],r=arguments[1],i=n.iterator();i.hasNext();){var o=i.next();this.addEdge(o,r)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(cf),pf=function(){this._min=mu.POSITIVE_INFINITY,this._max=mu.NEGATIVE_INFINITY},ff={NodeComparator:{configurable:!0}};pf.prototype.getMin=function(){return this._min},pf.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)},pf.prototype.getMax=function(){return this._max},pf.prototype.toString=function(){return Ku.toLineString(new bu(this._min,0),new bu(this._max,0))},pf.prototype.interfaces_=function(){return[]},pf.prototype.getClass=function(){return pf},ff.NodeComparator.get=function(){return gf},Object.defineProperties(pf,ff);var gf=function(){};gf.prototype.compare=function(t,e){var n=t,r=e,i=(n._min+n._max)/2,o=(r._min+r._max)/2;return i<o?-1:i>o?1:0},gf.prototype.interfaces_=function(){return[wu]},gf.prototype.getClass=function(){return gf};var df=function(t){function e(){t.call(this),this._item=null;var e=arguments[0],n=arguments[1],r=arguments[2];this._min=e,this._max=n,this._item=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(t,e,n){if(!this.intersects(t,e))return null;n.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pf),yf=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var e=arguments[0],n=arguments[1];this._node1=e,this._node2=n,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(t,e){this._min=Math.min(t._min,e._min),this._max=Math.max(t._max,e._max)},e.prototype.query=function(t,e,n){if(!this.intersects(t,e))return null;null!==this._node1&&this._node1.query(t,e,n),null!==this._node2&&this._node2.query(t,e,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pf),_f=function(){this._leaves=new bc,this._root=null,this._level=0};_f.prototype.buildTree=function(){$h.sort(this._leaves,new pf.NodeComparator);for(var t=this._leaves,e=null,n=new bc;;){if(this.buildLevel(t,n),1===n.size())return n.get(0);e=t,t=n,n=e}},_f.prototype.insert=function(t,e,n){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new df(t,e,n))},_f.prototype.query=function(t,e,n){this.init(),this._root.query(t,e,n)},_f.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},_f.prototype.printNode=function(t){Xu.out.println(Ku.toLineString(new bu(t._min,this._level),new bu(t._max,this._level)))},_f.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},_f.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var n=0;n<t.size();n+=2){var r=t.get(n);if(null===(n+1<t.size()?t.get(n):null))e.add(r);else{var i=new yf(t.get(n),t.get(n+1));e.add(i)}}},_f.prototype.interfaces_=function(){return[]},_f.prototype.getClass=function(){return _f};var mf=function(){this._items=new bc};mf.prototype.visitItem=function(t){this._items.add(t)},mf.prototype.getItems=function(){return this._items},mf.prototype.interfaces_=function(){return[Jh]},mf.prototype.getClass=function(){return mf};var vf=function(){this._index=null;var t=arguments[0];if(!Lu(t,Qc))throw new _u("Argument must be Polygonal");this._index=new wf(t)},xf={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};vf.prototype.locate=function(t){var e=new oc(t),n=new Ef(e);return this._index.query(t.y,t.y,n),e.getLocation()},vf.prototype.interfaces_=function(){return[Bl]},vf.prototype.getClass=function(){return vf},xf.SegmentVisitor.get=function(){return Ef},xf.IntervalIndexedGeometry.get=function(){return wf},Object.defineProperties(vf,xf);var Ef=function(){this._counter=null;var t=arguments[0];this._counter=t};Ef.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},Ef.prototype.interfaces_=function(){return[Jh]},Ef.prototype.getClass=function(){return Ef};var wf=function(){this._index=new _f;var t=arguments[0];this.init(t)};wf.prototype.init=function(t){for(var e=bp.getLines(t).iterator();e.hasNext();){var n=e.next().getCoordinates();this.addLine(n)}},wf.prototype.addLine=function(t){for(var e=1;e<t.length;e++){var n=new gl(t[e-1],t[e]),r=Math.min(n.p0.y,n.p1.y),i=Math.max(n.p0.y,n.p1.y);this._index.insert(r,i,n)}},wf.prototype.query=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new mf;return this._index.query(t,e,n),n.getItems()}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._index.query(r,i,o)}},wf.prototype.interfaces_=function(){return[]},wf.prototype.getClass=function(){return wf};var bf=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new ph,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Ip,2===arguments.length){var e=arguments[0],n=arguments[1],r=fc.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=n,this._boundaryNodeRule=r,null!==n&&this.add(n)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];this._argIndex=i,this._parentGeom=o,this._boundaryNodeRule=s,null!==o&&this.add(o)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(t,n){var r=this._nodes.addNode(n).getLabel(),i=1;Su.NONE;r.getLocation(t,Nh.ON)===Su.BOUNDARY&&i++;var o=e.determineBoundary(this._boundaryNodeRule,i);r.setLocation(t,o)},e.prototype.computeSelfNodes=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=new hf(n,!0,!1);o.setIsDoneIfProperInt(i);var s=this.createEdgeSetIntersector(),a=this._parentGeom instanceof eh||this._parentGeom instanceof $c||this._parentGeom instanceof nh,u=r||!a;return s.computeIntersections(this._edges,o,u),this.addSelfIntersectionNodes(this._argIndex),o}},e.prototype.computeSplitEdges=function(t){for(var e=this._edges.iterator();e.hasNext();){e.next().eiList.addSplitEdges(t)}},e.prototype.computeEdgeIntersections=function(t,e,n){var r=new hf(e,n,!0);r.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes());return this.createEdgeSetIntersector().computeIntersections(this._edges,t._edges,r),r},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof Kc){var t=arguments[0].getCoordinate();this.insertPoint(this._argIndex,t,Su.INTERIOR)}else if(arguments[0]instanceof bu){var e=arguments[0];this.insertPoint(this._argIndex,e,Su.INTERIOR)}},e.prototype.addPolygon=function(t){this.addPolygonRing(t.getExteriorRing(),Su.EXTERIOR,Su.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var n=t.getInteriorRingN(e);this.addPolygonRing(n,Su.INTERIOR,Su.EXTERIOR)}},e.prototype.addEdge=function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this._argIndex,e[0],Su.BOUNDARY),this.insertPoint(this._argIndex,e[e.length-1],Su.BOUNDARY)},e.prototype.addLineString=function(t){var e=Cc.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=e[0],null;var n=new ep(e,new Rh(this._argIndex,Su.INTERIOR));this._lineEdgeMap.put(t,n),this.insertEdge(n),tc.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,e[0]),this.insertBoundaryPoint(this._argIndex,e[e.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),n=0,r=t.iterator();r.hasNext();){var i=r.next();e[n++]=i.getCoordinate().copy()}return e},e.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(t,e,n){if(this.isBoundaryNode(t,e))return null;n===Su.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,n)},e.prototype.addPolygonRing=function(t,e,n){if(t.isEmpty())return null;var r=Cc.removeRepeatedPoints(t.getCoordinates());if(r.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var i=e,o=n;sc.isCCW(r)&&(i=n,o=e);var s=new ep(r,new Rh(this._argIndex,Su.BOUNDARY,i,o));this._lineEdgeMap.put(t,s),this.insertEdge(s),this.insertPoint(this._argIndex,r[0],Su.BOUNDARY)},e.prototype.insertPoint=function(t,e,n){var r=this._nodes.addNode(e),i=r.getLabel();null===i?r._label=new Rh(t,n):i.setLocation(t,n)},e.prototype.createEdgeSetIntersector=function(){return new lf},e.prototype.addSelfIntersectionNodes=function(t){for(var e=this._edges.iterator();e.hasNext();)for(var n=e.next(),r=n.getLabel().getLocation(t),i=n.eiList.iterator();i.hasNext();){var o=i.next();this.addSelfIntersectionNode(t,o.coord,r)}},e.prototype.add=function(){if(1!==arguments.length)return t.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof nh&&(this._useBoundaryDeterminationRule=!1),e instanceof $c)this.addPolygon(e);else if(e instanceof Jc)this.addLineString(e);else if(e instanceof Kc)this.addPoint(e);else if(e instanceof th)this.addCollection(e);else if(e instanceof Xc)this.addCollection(e);else if(e instanceof nh)this.addCollection(e);else{if(!(e instanceof jc))throw new Error(e.getClass().getName());this.addCollection(e)}},e.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},e.prototype.locate=function(t){return Lu(this._parentGeom,Qc)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new vf(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)},e.prototype.findEdge=function(){if(1===arguments.length){var e=arguments[0];return this._lineEdgeMap.get(e)}return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(t,e){return t.isInBoundary(e)?Su.BOUNDARY:Su.INTERIOR},e}(Uh),If=function(){if(this._li=new rc,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new bf(0,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],r=fc.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new bf(0,e,r),this._arg[1]=new bf(1,n,r)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];i.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new bf(0,i,s),this._arg[1]=new bf(1,o,s)}};If.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()},If.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)},If.prototype.interfaces_=function(){return[]},If.prototype.getClass=function(){return If};var Nf=function(){};Nf.prototype.interfaces_=function(){return[]},Nf.prototype.getClass=function(){return Nf},Nf.map=function(){if(arguments[0]instanceof cc&&Lu(arguments[1],Nf.MapOp)){for(var t=arguments[0],e=arguments[1],n=new bc,r=0;r<t.getNumGeometries();r++){var i=e.map(t.getGeometryN(r));null!==i&&n.add(i)}return t.getFactory().buildGeometry(n)}if(Lu(arguments[0],vc)&&Lu(arguments[1],Nf.MapOp)){for(var o=arguments[0],s=arguments[1],a=new bc,u=o.iterator();u.hasNext();){var c=u.next(),h=s.map(c);null!==h&&a.add(h)}return a}},Nf.MapOp=function(){};var Cf=function(t){function e(){var e=arguments[0],n=arguments[1];t.call(this,e,n),this._ptLocator=new Ip,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Vl,this._resultPolyList=new bc,this._resultLineList=new bc,this._resultPointList=new bc,this._graph=new Uh(new Ul),this._geomFact=e.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new Rh(t.getLabel())).flip();var i=e.getDepth();i.isNull()&&i.add(n),i.add(r),n.merge(r)}else this._edgeList.add(t)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),n=e.getSym();e.isInResult()&&n.isInResult()&&(e.setInResult(!1),n.setInResult(!1))}},e.prototype.isCoveredByLA=function(t){return!!this.isCovered(t,this._resultLineList)||!!this.isCovered(t,this._resultPolyList)},e.prototype.computeGeometry=function(t,n,r,i){var o=new bc;return o.addAll(t),o.addAll(n),o.addAll(r),o.isEmpty()?e.createEmptyResult(i,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(o)},e.prototype.mergeSymLabels=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){t.next().getEdges().mergeSymLabels()}},e.prototype.isCovered=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();if(this._ptLocator.locate(t,r)!==Su.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var t=new bc,e=this._edgeList.iterator();e.hasNext();){var n=e.next();n.isCollapsed()&&(e.remove(),t.add(n.getCollapsedEdge()))}this._edgeList.addAll(t)},e.prototype.updateNodeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getEdges().getLabel();e.getLabel().merge(n)}},e.prototype.getResultGeometry=function(t){return this.computeOverlay(t),this._resultGeom},e.prototype.insertUniqueEdges=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.insertUniqueEdge(n)}},e.prototype.computeOverlay=function(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var e=new bc;this._arg[0].computeSplitEdges(e),this._arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Xp.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var n=new Yh(this._geomFact);n.add(this._graph),this._resultPolyList=n.getPolygons();var r=new Yp(this,this._geomFact,this._ptLocator);this._resultLineList=r.build(t);var i=new Vp(this,this._geomFact,this._ptLocator);this._resultPointList=i.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)},e.prototype.labelIncompleteNode=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setLocation(e,n)},e.prototype.copyPoints=function(t){for(var e=this._arg[t].getNodeIterator();e.hasNext();){var n=e.next();this._graph.addNode(n.getCoordinate()).setLabel(t,n.getLabel().getLocation(t))}},e.prototype.findResultAreaEdges=function(t){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.isArea()&&!r.isInteriorAreaEdge()&&e.isResultOfOp(i.getLocation(0,Nh.RIGHT),i.getLocation(1,Nh.RIGHT),t)&&r.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var t=this._edgeList.iterator();t.hasNext();){var e=t.next(),n=e.getLabel(),r=e.getDepth();if(!r.isNull()){r.normalize();for(var i=0;i<2;i++)n.isNull(i)||!n.isArea()||r.isNull(i)||(0===r.getDelta(i)?n.toLine(i):(tc.isTrue(!r.isNull(i,Nh.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(i,Nh.LEFT,r.getLocation(i,Nh.LEFT)),tc.isTrue(!r.isNull(i,Nh.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(i,Nh.RIGHT,r.getLocation(i,Nh.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){t.next().getEdges().computeLabelling(this._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getLabel();e.isIsolated()&&(n.isNull(0)?this.labelIncompleteNode(e,0):this.labelIncompleteNode(e,1)),e.getEdges().updateLabelling(n)}},e.prototype.isCoveredByA=function(t){return!!this.isCovered(t,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(If);Cf.overlayOp=function(t,e,n){return new Cf(t,e).getResultGeometry(n)},Cf.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return Cf.createEmptyResult(Cf.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return Up.map(t,{interfaces_:function(){return[Nf.MapOp]},map:function(t){return t.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),of.overlayOp(t,e,Cf.INTERSECTION)},Cf.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Cf.createEmptyResult(Cf.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),of.overlayOp(t,e,Cf.SYMDIFFERENCE)},Cf.resultDimension=function(t,e,n){var r=e.getDimension(),i=n.getDimension(),o=-1;switch(t){case Cf.INTERSECTION:o=Math.min(r,i);break;case Cf.UNION:o=Math.max(r,i);break;case Cf.DIFFERENCE:o=r;break;case Cf.SYMDIFFERENCE:o=Math.max(r,i)}return o},Cf.createEmptyResult=function(t,e,n,r){var i=null;switch(Cf.resultDimension(t,e,n)){case-1:i=r.createGeometryCollection(new Array(0).fill(null));break;case 0:i=r.createPoint();break;case 1:i=r.createLineString();break;case 2:i=r.createPolygon()}return i},Cf.difference=function(t,e){return t.isEmpty()?Cf.createEmptyResult(Cf.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),of.overlayOp(t,e,Cf.DIFFERENCE))},Cf.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=t.getLocation(0),r=t.getLocation(1);return Cf.isResultOfOp(n,r,e)}if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];switch(i===Su.BOUNDARY&&(i=Su.INTERIOR),o===Su.BOUNDARY&&(o=Su.INTERIOR),s){case Cf.INTERSECTION:return i===Su.INTERIOR&&o===Su.INTERIOR;case Cf.UNION:return i===Su.INTERIOR||o===Su.INTERIOR;case Cf.DIFFERENCE:return i===Su.INTERIOR&&o!==Su.INTERIOR;case Cf.SYMDIFFERENCE:return i===Su.INTERIOR&&o!==Su.INTERIOR||i!==Su.INTERIOR&&o===Su.INTERIOR}return!1}},Cf.INTERSECTION=1,Cf.UNION=2,Cf.DIFFERENCE=3,Cf.SYMDIFFERENCE=4;var Sf=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Ip,this._seg=new gl;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};Sf.prototype.isWithinToleranceOfBoundary=function(t){for(var e=0;e<this._linework.getNumGeometries();e++)for(var n=this._linework.getGeometryN(e).getCoordinateSequence(),r=0;r<n.size()-1;r++){n.getCoordinate(r,this._seg.p0),n.getCoordinate(r+1,this._seg.p1);if(this._seg.distance(t)<=this._boundaryDistanceTolerance)return!0}return!1},Sf.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?Su.BOUNDARY:this._ptLocator.locate(t,this._g)},Sf.prototype.extractLinework=function(t){var e=new Mf;t.apply(e);var n=e.getLinework(),r=_h.toLineStringArray(n);return t.getFactory().createMultiLineString(r)},Sf.prototype.interfaces_=function(){return[]},Sf.prototype.getClass=function(){return Sf};var Mf=function(){this._linework=null,this._linework=new bc};Mf.prototype.getLinework=function(){return this._linework},Mf.prototype.filter=function(t){if(t instanceof $c){var e=t;this._linework.add(e.getExteriorRing());for(var n=0;n<e.getNumInteriorRing();n++)this._linework.add(e.getInteriorRingN(n))}},Mf.prototype.interfaces_=function(){return[kc]},Mf.prototype.getClass=function(){return Mf};var Lf=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};Lf.prototype.extractPoints=function(t,e,n){for(var r=t.getCoordinates(),i=0;i<r.length-1;i++)this.computeOffsetPoints(r[i],r[i+1],e,n)},Lf.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e},Lf.prototype.getPoints=function(t){for(var e=new bc,n=bp.getLines(this._g).iterator();n.hasNext();){var r=n.next();this.extractPoints(r,t,e)}return e},Lf.prototype.computeOffsetPoints=function(t,e,n,r){var i=e.x-t.x,o=e.y-t.y,s=Math.sqrt(i*i+o*o),a=n*i/s,u=n*o/s,c=(e.x+t.x)/2,h=(e.y+t.y)/2;if(this._doLeft){var l=new bu(c-u,h+a);r.add(l)}if(this._doRight){var p=new bu(c+u,h-a);r.add(p)}},Lf.prototype.interfaces_=function(){return[]},Lf.prototype.getClass=function(){return Lf};var Pf=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new bc;var e=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,n),this._geom=[e,n,r],this._locFinder=[new Sf(this._geom[0],this._boundaryDistanceTolerance),new Sf(this._geom[1],this._boundaryDistanceTolerance),new Sf(this._geom[2],this._boundaryDistanceTolerance)]},Of={TOLERANCE:{configurable:!0}};Pf.prototype.reportResult=function(t,e,n){Xu.out.println("Overlay result invalid - A:"+Su.toLocationSymbol(e[0])+" B:"+Su.toLocationSymbol(e[1])+" expected:"+(n?"i":"e")+" actual:"+Su.toLocationSymbol(e[2]))},Pf.prototype.isValid=function(t){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var e=this.checkValid(t);return e},Pf.prototype.checkValid=function(){if(1===arguments.length){for(var t=arguments[0],e=0;e<this._testCoords.size();e++){var n=this._testCoords.get(e);if(!this.checkValid(t,n))return this._invalidLocation=n,!1}return!0}if(2===arguments.length){var r=arguments[0],i=arguments[1];return this._location[0]=this._locFinder[0].getLocation(i),this._location[1]=this._locFinder[1].getLocation(i),this._location[2]=this._locFinder[2].getLocation(i),!!Pf.hasLocation(this._location,Su.BOUNDARY)||this.isValidResult(r,this._location)}},Pf.prototype.addTestPts=function(t){var e=new Lf(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))},Pf.prototype.isValidResult=function(t,e){var n=Cf.isResultOfOp(e[0],e[1],t),r=!(n^e[2]===Su.INTERIOR);return r||this.reportResult(t,e,n),r},Pf.prototype.getInvalidLocation=function(){return this._invalidLocation},Pf.prototype.interfaces_=function(){return[]},Pf.prototype.getClass=function(){return Pf},Pf.hasLocation=function(t,e){for(var n=0;n<3;n++)if(t[n]===e)return!0;return!1},Pf.computeBoundaryDistanceTolerance=function(t,e){return Math.min(Jp.computeSizeBasedSnapTolerance(t),Jp.computeSizeBasedSnapTolerance(e))},Pf.isValid=function(t,e,n,r){return new Pf(t,e,r).isValid(n)},Of.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Pf,Of);var Rf=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};Rf.prototype.extractElements=function(t,e){if(null===t)return null;for(var n=0;n<t.getNumGeometries();n++){var r=t.getGeometryN(n);this._skipEmpty&&r.isEmpty()||e.add(r)}},Rf.prototype.combine=function(){for(var t=new bc,e=this._inputGeoms.iterator();e.hasNext();){var n=e.next();this.extractElements(n,t)}return 0===t.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)},Rf.prototype.interfaces_=function(){return[]},Rf.prototype.getClass=function(){return Rf},Rf.combine=function(){if(1===arguments.length){var t=arguments[0];return new Rf(t).combine()}if(2===arguments.length){var e=arguments[0],n=arguments[1];return new Rf(Rf.createList(e,n)).combine()}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];return new Rf(Rf.createList(r,i,o)).combine()}},Rf.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},Rf.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new bc;return n.add(t),n.add(e),n}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],s=new bc;return s.add(r),s.add(i),s.add(o),s}};var Tf=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,null===this._inputPolys&&(this._inputPolys=new bc)},Af={STRTREE_NODE_CAPACITY:{configurable:!0}};Tf.prototype.reduceToGeometries=function(t){for(var e=new bc,n=t.iterator();n.hasNext();){var r=n.next(),i=null;Lu(r,wc)?i=this.unionTree(r):r instanceof cc&&(i=r),e.add(i)}return e},Tf.prototype.extractByEnvelope=function(t,e,n){for(var r=new bc,i=0;i<e.getNumGeometries();i++){var o=e.getGeometryN(i);o.getEnvelopeInternal().intersects(t)?r.add(o):n.add(o)}return this._geomFactory.buildGeometry(r)},Tf.prototype.unionOptimized=function(t,e){var n=t.getEnvelopeInternal(),r=e.getEnvelopeInternal();if(!n.intersects(r)){return Rf.combine(t,e)}if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var i=n.intersection(r);return this.unionUsingEnvelopeIntersection(t,e,i)},Tf.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new ol(Tf.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var n=e.next();t.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var r=t.itemsTree();return this.unionTree(r)},Tf.prototype.binaryUnion=function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],n=arguments[1],r=arguments[2];if(r-n<=1){var i=Tf.getGeometry(e,n);return this.unionSafe(i,null)}if(r-n==2)return this.unionSafe(Tf.getGeometry(e,n),Tf.getGeometry(e,n+1));var o=Math.trunc((r+n)/2),s=this.binaryUnion(e,n,o),a=this.binaryUnion(e,o,r);return this.unionSafe(s,a)}},Tf.prototype.repeatedUnion=function(t){for(var e=null,n=t.iterator();n.hasNext();){var r=n.next();e=null===e?r.copy():e.union(r)}return e},Tf.prototype.unionSafe=function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},Tf.prototype.unionActual=function(t,e){return Tf.restrictToPolygons(t.union(e))},Tf.prototype.unionTree=function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},Tf.prototype.unionUsingEnvelopeIntersection=function(t,e,n){var r=new bc,i=this.extractByEnvelope(n,t,r),o=this.extractByEnvelope(n,e,r),s=this.unionActual(i,o);r.add(s);return Rf.combine(r)},Tf.prototype.bufferUnion=function(){if(1===arguments.length){var t=arguments[0];return t.get(0).getFactory().buildGeometry(t).buffer(0)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e.getFactory().createGeometryCollection([e,n]).buffer(0)}},Tf.prototype.interfaces_=function(){return[]},Tf.prototype.getClass=function(){return Tf},Tf.restrictToPolygons=function(t){if(Lu(t,Qc))return t;var e=wp.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(_h.toPolygonArray(e))},Tf.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},Tf.union=function(t){return new Tf(t).union()},Af.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Tf,Af);var Df=function(){};Df.prototype.interfaces_=function(){return[]},Df.prototype.getClass=function(){return Df},Df.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Cf.createEmptyResult(Cf.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),of.overlayOp(t,e,Cf.UNION)};var Ff=function(){return new Yi};Yi.prototype={constructor:Yi,reset:function(){this.s=this.t=0},add:function(t){Vi(qf,t,this.t),Vi(this,qf.s,this.s),this.s?this.t+=qf.t:this.s=qf.t},valueOf:function(){return this.s}};var qf=new Yi,Gf=1e-6,Bf=Math.PI,kf=Bf/2,zf=Bf/4,jf=2*Bf,Xf=180/Bf,Uf=Bf/180,Yf=Math.abs,Vf=Math.atan,Hf=Math.atan2,Wf=Math.cos,Jf=Math.exp,Zf=Math.log,Kf=Math.sin,Qf=Math.sqrt,$f=Math.tan,tg={Feature:function(t,e){Ji(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)Ji(n[r].geometry,e)}},eg={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){Zi(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Zi(n[r],e,0)},Polygon:function(t,e){Ki(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Ki(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)Ji(n[r],e)}},ng=function(t,e){t&&tg.hasOwnProperty(t.type)?tg[t.type](t,e):Ji(t,e)},rg=(Ff(),Ff(),Ff(),function(t,e){function n(n,r){return n=t(n,r),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,r){return(n=e.invert(n,r))&&t.invert(n[0],n[1])}),n});oo.invert=oo;var ig=function(t){function e(e){return e=t(e[0]*Uf,e[1]*Uf),e[0]*=Xf,e[1]*=Xf,e}return t=so(t[0]*Uf,t[1]*Uf,t.length>2?t[2]*Uf:0),e.invert=function(e){return e=t.invert(e[0]*Uf,e[1]*Uf),e[0]*=Xf,e[1]*=Xf,e},e},og=function(){var t,e=[];return{point:function(e,n){t.push([e,n])},lineStart:function(){e.push(t=[])},lineEnd:Wi,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}},sg=function(t,e,n,r,i,o){var s,a=t[0],u=t[1],c=0,h=1,l=e[0]-a,p=e[1]-u;if(s=n-a,l||!(s>0)){if(s/=l,l<0){if(s<c)return;s<h&&(h=s)}else if(l>0){if(s>h)return;s>c&&(c=s)}if(s=i-a,l||!(s<0)){if(s/=l,l<0){if(s>h)return;s>c&&(c=s)}else if(l>0){if(s<c)return;s<h&&(h=s)}if(s=r-u,p||!(s>0)){if(s/=p,p<0){if(s<c)return;s<h&&(h=s)}else if(p>0){if(s>h)return;s>c&&(c=s)}if(s=o-u,p||!(s<0)){if(s/=p,p<0){if(s>h)return;s>c&&(c=s)}else if(p>0){if(s<c)return;s<h&&(h=s)}return c>0&&(t[0]=a+c*l,t[1]=u+c*p),h<1&&(e[0]=a+h*l,e[1]=u+h*p),!0}}}}},ag=function(t,e){return Yf(t[0]-e[0])<Gf&&Yf(t[1]-e[1])<Gf},ug=function(t,e,n,r,i){var o,s,a=[],u=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n,r=t[0],s=t[e];if(ag(r,s)){for(i.lineStart(),o=0;o<e;++o)i.point((r=t[o])[0],r[1]);i.lineEnd()}else a.push(n=new lo(r,t,null,!0)),u.push(n.o=new lo(r,null,n,!1)),a.push(n=new lo(s,t,null,!1)),u.push(n.o=new lo(s,null,n,!0))}}),a.length){for(u.sort(e),po(a),po(u),o=0,s=u.length;o<s;++o)u[o].e=n=!n;for(var c,h,l=a[0];;){for(var p=l,f=!0;p.v;)if((p=p.n)===l)return;c=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(f)for(o=0,s=c.length;o<s;++o)i.point((h=c[o])[0],h[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(f)for(c=p.p.z,o=c.length-1;o>=0;--o)i.point((h=c[o])[0],h[1]);else r(p.x,p.p.x,-1,i);p=p.p}c=(p=p.o).z,f=!f}while(!p.v);i.lineEnd()}}},cg=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},hg=(function(t){1===t.length&&(t=function(t){return function(e,n){return cg(t(e),n)}}(t))}(cg),function(t){for(var e,n,r,i=t.length,o=-1,s=0;++o<i;)s+=t[o].length;for(n=new Array(s);--i>=0;)for(e=(r=t[i]).length;--e>=0;)n[--s]=r[e];return n}),lg=1e9,pg=-lg,fg=Ff(),gg=(Ff(),function(t){return t}),dg=(Ff(),Ff(),1/0),yg=dg,_g=-dg,mg=_g,vg={point:function(t,e){t<dg&&(dg=t),t>_g&&(_g=t),e<yg&&(yg=e),e>mg&&(mg=e)},lineStart:Wi,lineEnd:Wi,polygonStart:Wi,polygonEnd:Wi,result:function(){var t=[[dg,yg],[_g,mg]];return _g=mg=-(yg=dg=1/0),t}},xg=(Ff(),function(t,e,n,r){return function(i,o){function s(e,n){var r=i(e,n);t(e=r[0],n=r[1])&&o.point(e,n)}function a(t,e){var n=i(t,e);y.point(n[0],n[1])}function u(){E.point=a,y.lineStart()}function c(){E.point=s,y.lineEnd()}function h(t,e){d.push([t,e]);var n=i(t,e);v.point(n[0],n[1])}function l(){v.lineStart(),d=[]}function p(){h(d[0][0],d[0][1]),v.lineEnd();var t,e,n,r,i=v.clean(),s=m.result(),a=s.length;if(d.pop(),f.push(d),d=null,a)if(1&i){if(n=s[0],(e=n.length-1)>0){for(x||(o.polygonStart(),x=!0),o.lineStart(),t=0;t<e;++t)o.point((r=n[t])[0],r[1]);o.lineEnd()}}else a>1&&2&i&&s.push(s.pop().concat(s.shift())),g.push(s.filter(go))}var f,g,d,y=e(o),_=i.invert(r[0],r[1]),m=og(),v=e(m),x=!1,E={point:s,lineStart:u,lineEnd:c,polygonStart:function(){E.point=h,E.lineStart=l,E.lineEnd=p,g=[],f=[]},polygonEnd:function(){E.point=s,E.lineStart=u,E.lineEnd=c,g=hg(g);var t=function(t,e){var n=e[0],r=e[1],i=[Kf(n),-Wf(n),0],o=0,s=0;fg.reset();for(var a=0,u=t.length;a<u;++a)if(h=(c=t[a]).length)for(var c,h,l=c[h-1],p=l[0],f=l[1]/2+zf,g=Kf(f),d=Wf(f),y=0;y<h;++y,p=m,g=x,d=E,l=_){var _=c[y],m=_[0],v=_[1]/2+zf,x=Kf(v),E=Wf(v),w=m-p,b=w>=0?1:-1,I=b*w,N=I>Bf,C=g*x;if(fg.add(Hf(C*b*Kf(I),d*E+C*Wf(I))),o+=N?w+b*jf:w,N^p>=n^m>=n){var S=eo($i(l),$i(_));io(S);var M=eo(i,S);io(M);var L=(N^w>=0?-1:1)*Hi(M[2]);(r>L||r===L&&(S[0]||S[1]))&&(s+=N^w>=0?1:-1)}}return(o<-Gf||o<Gf&&fg<-Gf)^1&s}(f,_);g.length?(x||(o.polygonStart(),x=!0),ug(g,yo,t,n,o)):t&&(x||(o.polygonStart(),x=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),x&&(o.polygonEnd(),x=!1),g=f=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}};return E}}),Eg=xg(function(){return!0},function(t){var e,n=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,s){var a=o>0?Bf:-Bf,u=Yf(o-n);Yf(u-Bf)<Gf?(t.point(n,r=(r+s)/2>0?kf:-kf),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),t.point(o,r),e=0):i!==a&&u>=Bf&&(Yf(n-i)<Gf&&(n-=i*Gf),Yf(o-a)<Gf&&(o-=a*Gf),r=function(t,e,n,r){var i,o,s=Kf(t-n);return Yf(s)>Gf?Vf((Kf(e)*(o=Wf(r))*Kf(n)-Kf(r)*(i=Wf(e))*Kf(t))/(i*o*s)):(e+r)/2}(n,r,o,s),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),e=0),t.point(n=o,r=s),i=a},lineEnd:function(){t.lineEnd(),n=r=NaN},clean:function(){return 2-e}}},function(t,e,n,r){var i;if(null==t)i=n*kf,r.point(-Bf,i),r.point(0,i),r.point(Bf,i),r.point(Bf,0),r.point(Bf,-i),r.point(0,-i),r.point(-Bf,-i),r.point(-Bf,0),r.point(-Bf,i);else if(Yf(t[0]-e[0])>Gf){var o=t[0]<e[0]?Bf:-Bf;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(e[0],e[1])},[-Bf,-kf]),wg=function(t,e){function n(t,e){return Wf(t)*Wf(e)>o}function r(t,e,n){var r=[1,0,0],i=eo($i(t),$i(e)),s=to(i,i),a=i[0],u=s-a*a;if(!u)return!n&&t;var c=o*s/u,h=-o*a/u,l=eo(r,i),p=ro(r,c);no(p,ro(i,h));var f=l,g=to(p,f),d=to(f,f),y=g*g-d*(to(p,p)-1);if(!(y<0)){var _=Qf(y),m=ro(f,(-g-_)/d);if(no(m,p),m=Qi(m),!n)return m;var v,x=t[0],E=e[0],w=t[1],b=e[1];E<x&&(v=x,x=E,E=v);var I=E-x,N=Yf(I-Bf)<Gf;if(!N&&b<w&&(v=w,w=b,b=v),N||I<Gf?N?w+b>0^m[1]<(Yf(m[0]-x)<Gf?w:b):w<=m[1]&&m[1]<=b:I>Bf^(x<=m[0]&&m[0]<=E)){var C=ro(f,(-g+_)/d);return no(C,p),[m,Qi(C)]}}}function i(e,n){var r=s?t:Bf-t,i=0;return e<-r?i|=1:e>r&&(i|=2),n<-r?i|=4:n>r&&(i|=8),i}var o=Wf(t),s=o>0,a=Yf(o)>Gf;return xg(n,function(t){var e,o,u,c,h;return{lineStart:function(){c=u=!1,h=1},point:function(l,p){var f,g=[l,p],d=n(l,p),y=s?d?0:i(l,p):d?i(l+(l<0?Bf:-Bf),p):0;if(!e&&(c=u=d)&&t.lineStart(),d!==u&&(!(f=r(e,g))||ag(e,f)||ag(g,f))&&(g[0]+=Gf,g[1]+=Gf,d=n(g[0],g[1])),d!==u)h=0,d?(t.lineStart(),f=r(g,e),t.point(f[0],f[1])):(f=r(e,g),t.point(f[0],f[1]),t.lineEnd()),e=f;else if(a&&e&&s^d){var _;y&o||!(_=r(g,e,!0))||(h=0,s?(t.lineStart(),t.point(_[0][0],_[0][1]),t.point(_[1][0],_[1][1]),t.lineEnd()):(t.point(_[1][0],_[1][1]),t.lineEnd(),t.lineStart(),t.point(_[0][0],_[0][1])))}!d||e&&ag(e,g)||t.point(g[0],g[1]),e=g,u=d,o=y},lineEnd:function(){u&&t.lineEnd(),e=null},clean:function(){return h|(c&&u)<<1}}},function(n,r,i,o){!function(t,e,n,r,i,o){if(n){var s=Wf(e),a=Kf(e),u=r*n;null==i?(i=e+r*jf,o=e-u/2):(i=ho(s,i),o=ho(s,o),(r>0?i<o:i>o)&&(i+=r*jf));for(var c,h=i;r>0?h>o:h<o;h-=u)c=Qi([s,-a*Wf(h),-a*Kf(h)]),t.point(c[0],c[1])}}(o,t,e,i,n,r)},s?[0,-t]:[-Bf,t-Bf])};mo.prototype={constructor:mo,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var bg=16,Ig=Wf(30*Uf),Ng=function(t,e){return+e?function(t,e){function n(r,i,o,s,a,u,c,h,l,p,f,g,d,y){var _=c-r,m=h-i,v=_*_+m*m;if(v>4*e&&d--){var x=s+p,E=a+f,w=u+g,b=Qf(x*x+E*E+w*w),I=Hi(w/=b),N=Yf(Yf(w)-1)<Gf||Yf(o-l)<Gf?(o+l)/2:Hf(E,x),C=t(N,I),S=C[0],M=C[1],L=S-r,P=M-i,O=m*L-_*P;(O*O/v>e||Yf((_*L+m*P)/v-.5)>.3||s*p+a*f+u*g<Ig)&&(n(r,i,o,s,a,u,S,M,N,x/=b,E/=b,w,d,y),y.point(S,M),n(S,M,N,x,E,w,c,h,l,p,f,g,d,y))}}return function(e){function r(n,r){n=t(n,r),e.point(n[0],n[1])}function i(){_=NaN,w.point=o,e.lineStart()}function o(r,i){var o=$i([r,i]),s=t(r,i);n(_,m,y,v,x,E,_=s[0],m=s[1],y=r,v=o[0],x=o[1],E=o[2],bg,e),e.point(_,m)}function s(){w.point=r,e.lineEnd()}function a(){i(),w.point=u,w.lineEnd=c}function u(t,e){o(h=t,e),l=_,p=m,f=v,g=x,d=E,w.point=o}function c(){n(_,m,y,v,x,E,l,p,h,f,g,d,bg,e),w.lineEnd=s,s()}var h,l,p,f,g,d,y,_,m,v,x,E,w={point:r,lineStart:i,lineEnd:s,polygonStart:function(){e.polygonStart(),w.lineStart=a},polygonEnd:function(){e.polygonEnd(),w.lineStart=i}};return w}}(t,e):function(t){return _o({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}(t)},Cg=_o({point:function(t,e){this.stream.point(t*Uf,e*Uf)}});Eo.invert=function(t,e){return[t,2*Vf(Jf(e))-kf]},wo.invert=function(t,e){return[-e,2*Vf(Jf(t))-kf]};var Sg=function(){var t=function(t){function e(){var e=Bf*a(),s=o(ig(o.rotate()).invert([0,0]));return c(null==h?[[s[0]-e,s[1]-e],[s[0]+e,s[1]+e]]:t===Eo?[[Math.max(s[0]-e,h),n],[Math.min(s[0]+e,r),i]]:[[h,Math.max(s[1]-e,n)],[r,Math.min(s[1]+e,i)]])}var n,r,i,o=xo(t),s=o.center,a=o.scale,u=o.translate,c=o.clipExtent,h=null;return o.scale=function(t){return arguments.length?(a(t),e()):a()},o.translate=function(t){return arguments.length?(u(t),e()):u()},o.center=function(t){return arguments.length?(s(t),e()):s()},o.clipExtent=function(t){return arguments.length?(null==t?h=n=r=i=null:(h=+t[0][0],n=+t[0][1],r=+t[1][0],i=+t[1][1]),e()):null==h?null:[[h,n],[r,i]]},e()}(wo),e=t.center,n=t.rotate;return t.center=function(t){return arguments.length?e([-t[1],t[0]]):(t=e(),[t[1],-t[0]])},t.rotate=function(t){return arguments.length?n([t[0],t[1],t.length>2?t[2]+90:90]):(t=n(),[t[0],t[1],t[2]-90])},n([0,0,90]).scale(159.155)};t.projection=Cs,t.random=gu,t.clusters=du,t.helpers=ko,t.invariant=jo,t.meta=zo,t.isolines=function(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.zProperty||"elevation",i=n.commonProperties||{},o=n.breaksProperties||[];if(W(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks must be an Array");if(!I(i))throw new Error("commonProperties must be an Object");if(!Array.isArray(o))throw new Error("breaksProperties must be an Array");var s=rt(t,{zProperty:r,flip:!0});return c(function(t,e,n){var r=j(n),i=r[2]-r[0],o=r[3]-r[1],s=r[0],a=r[1],u=e[0].length-1,c=e.length-1,h=i/u,l=o/c,p=function(t){t[0]=t[0]*h+s,t[1]=t[1]*l+a};return t.forEach(function(t){S(t,p)}),t}(function(t,e,n,r,i){for(var o=[],s=1;s<e.length;s++){var a=+e[s],u=Object.assign({},r,i[s]);u[n]=a;var c=h(Q(t,a),u);o.push(c)}return o}(s,e,r,i,o),s,t))},t.convex=Lt,t.pointsWithinPolygon=Rt,t.concave=function(t,n){if(n=n||{},!I(n))throw new Error("options is invalid");if(!t)throw new Error("points is required");var r=n.maxEdge||1/0;if(!b(r))throw new Error("maxEdge is invalid");var i=Tt(function(t){var e=[],n={};return O(t,function(t){if(t.geometry){var r=t.geometry.coordinates.join("-");n.hasOwnProperty(r)||(e.push(t),n[r]=!0)}}),c(e)}(t));if(i.features=i.features.filter(function(t){var e=t.geometry.coordinates[0][0],i=t.geometry.coordinates[0][1],o=t.geometry.coordinates[0][2],s=qt(e,i,n),a=qt(i,o,n),u=qt(e,o,n);return s<=r&&a<=r&&u<=r}),i.features.length<1)return null;var o=$t(i,n);return 1===o.coordinates.length&&(o.coordinates=o.coordinates[0],o.type="Polygon"),e(o)},t.collect=function(t,e,n,r){var i=Vo(6),o=e.features.map(function(t){return{minX:t.geometry.coordinates[0],minY:t.geometry.coordinates[1],maxX:t.geometry.coordinates[0],maxY:t.geometry.coordinates[1],property:t.properties[n]}});return i.load(o),t.features.forEach(function(t){t.properties||(t.properties={});var e=j(t),n=[];i.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}).forEach(function(e){Pt([e.minX,e.minY],t)&&n.push(e.property)}),t.properties[r]=n}),t},t.flip=function(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.mutate;if(!t)throw new Error("geojson is required");return!1!==n&&void 0!==n||(t=Gt(t)),S(t,function(t){var e=t[0],n=t[1];t[0]=n,t[1]=e}),t},t.simplify=function(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=void 0!==e.tolerance?e.tolerance:1,r=e.highQuality||!1,i=e.mutate||!1;if(!t)throw new Error("geojson is required");if(n&&n<0)throw new Error("invalid tolerance");return!0!==i&&(t=Gt(t)),A(t,function(t){!function(t,e,n){var r=t.type;if("Point"===r||"MultiPoint"===r)return t;te(t,!0);var i=t.coordinates;switch(r){case"LineString":t.coordinates=se(i,e,n);break;case"MultiLineString":t.coordinates=i.map(function(t){return se(t,e,n)});break;case"Polygon":t.coordinates=ae(i,e,n);break;case"MultiPolygon":t.coordinates=i.map(function(t){return ae(t,e,n)})}}(t,n,r)}),t},t.bezierSpline=ue,t.tag=function(t,e,n,r){return t=Gt(t),e=Gt(e),O(t,function(t){t.properties||(t.properties={}),O(e,function(e){void 0===t.properties[r]&&Pt(t,e)&&(t.properties[r]=e.properties[n])})}),t},t.sample=function(t,e){if(!t)throw new Error("featurecollection is required");if(null===e||void 0===e)throw new Error("num is required");if("number"!=typeof e)throw new Error("num must be a number");return c(function(t,e){for(var n,r,i=t.slice(0),o=t.length,s=o-e;o-- >s;)r=Math.floor((o+1)*Math.random()),n=i[r],i[r]=i[o],i[o]=n;return i.slice(s)}(t.features,e))},t.envelope=he,t.square=le,t.circle=fe,t.midpoint=function(t,e){return pe(t,qt(t,e)/2,ge(t,e))},t.center=de,t.centerOfMass=_e,t.centroid=ye,t.combine=function(t){function n(t,e,n){n?r[e].coordinates=r[e].coordinates.concat(t.geometry.coordinates):r[e].coordinates.push(t.geometry.coordinates),r[e].properties.push(t.properties)}var r={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}},i=Object.keys(r).reduce(function(t,e){return t[e.replace("Multi","")]=e,t},{});return O(t,function(t){t.geometry&&(r[t.geometry.type]?n(t,t.geometry.type,!0):i[t.geometry.type]&&n(t,i[t.geometry.type],!1))}),c(Object.keys(r).filter(function(t){return r[t].coordinates.length}).sort().map(function(t){return e({type:t,coordinates:r[t].coordinates},{collectedProperties:r[t].properties})}))},t.distance=qt,t.explode=me,t.bbox=j,t.tesselate=function(t){if(!t.geometry||"Polygon"!==t.geometry.type&&"MultiPolygon"!==t.geometry.type)throw new Error("input must be a Polygon or MultiPolygon");var e={type:"FeatureCollection",features:[]};return"Polygon"===t.geometry.type?e.features=De(t.geometry.coordinates):t.geometry.coordinates.forEach(function(t){e.features=e.features.concat(De(t))}),e},t.bboxPolygon=ce,t.booleanPointInPolygon=Pt,t.nearestPoint=Fe,t.nearestPointOnLine=on,t.nearestPointToLine=function(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.units,i=n.properties||{};if(!t)throw new Error("points is required");if(!(t=function(t){var e=[];switch(t.geometry?t.geometry.type:t.type){case"GeometryCollection":return A(t,function(t){"Point"===t.type&&e.push({type:"Feature",properties:{},geometry:t})}),{type:"FeatureCollection",features:e};case"FeatureCollection":return t.features=t.features.filter(function(t){return"Point"===t.geometry.type}),t;default:throw new Error("points must be a Point Collection")}}(t)).features.length)throw new Error("points must contain features");if(!e)throw new Error("line is required");if("LineString"!==K(e))throw new Error("line must be a LineString");var o=1/0,s=null;return O(t,function(t){var n=gn(t,e,{units:r});n<o&&(o=n,s=t)}),s&&(s.properties=Object.assign({dist:o},s.properties,i)),s},t.planepoint=function(t,e){var n=X(t),r=J(e).coordinates[0];if(r.length<4)throw new Error("OuterRing of a Polygon must have 4 or more Positions.");var i=e.properties||{},o=i.a,s=i.b,a=i.c,u=n[0],c=n[1],h=r[0][0],l=r[0][1],p=void 0!==o?o:r[0][2],f=r[1][0],g=r[1][1],d=void 0!==s?s:r[1][2],y=r[2][0],_=r[2][1],m=void 0!==a?a:r[2][2];return(m*(u-h)*(c-g)+p*(u-f)*(c-_)+d*(u-y)*(c-l)-d*(u-h)*(c-_)-m*(u-f)*(c-l)-p*(u-y)*(c-g))/((u-h)*(c-g)+(u-f)*(c-_)+(u-y)*(c-l)-(u-h)*(c-_)-(u-f)*(c-l)-(u-y)*(c-g))},t.tin=Tt,t.bearing=ge,t.destination=pe,t.kinks=function(t){var e,n,i={type:"FeatureCollection",features:[]};if("LineString"===(n="Feature"===t.type?t.geometry:t).type)e=[n.coordinates];else if("MultiLineString"===n.type)e=n.coordinates;else if("MultiPolygon"===n.type)e=[].concat.apply([],n.coordinates);else{if("Polygon"!==n.type)throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");e=n.coordinates}return e.forEach(function(t){e.forEach(function(e){for(var n=0;n<t.length-1;n++)for(var o=n;o<e.length-1;o++){if(t===e){if(1===Math.abs(n-o))continue;if(0===n&&o===t.length-2&&t[n][0]===t[t.length-1][0]&&t[n][1]===t[t.length-1][1])continue}var s=function(t,e,n,r,i,o,s,a){var u,c,h,l,p,f={x:null,y:null,onLine1:!1,onLine2:!1};return 0==(u=(a-o)*(n-t)-(s-i)*(r-e))?null!==f.x&&null!==f.y&&f:(c=e-o,h=t-i,l=(s-i)*c-(a-o)*h,p=(n-t)*c-(r-e)*h,c=l/u,h=p/u,f.x=t+c*(n-t),f.y=e+c*(r-e),c>=0&&c<=1&&(f.onLine1=!0),h>=0&&h<=1&&(f.onLine2=!0),!(!f.onLine1||!f.onLine2)&&[f.x,f.y])}(t[n][0],t[n][1],t[n+1][0],t[n+1][1],e[o][0],e[o][1],e[o+1][0],e[o+1][1]);s&&i.features.push(r([s[0],s[1]]))}})}),i},t.pointOnFeature=yn,t.area=mn,t.along=function(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var i;if("Feature"===t.type)i=t.geometry.coordinates;else{if("LineString"!==t.type)throw new Error("input must be a LineString Feature or Geometry");i=t.coordinates}if(!b(e))throw new Error("distance must be a number");for(var o=0,s=0;s<i.length&&!(e>=o&&s===i.length-1);s++){if(o>=e){var a=e-o;if(a){var u=ge(i[s],i[s-1])-180;return pe(i[s],a,u,n)}return r(i[s])}o+=qt(i[s],i[s+1],n)}return r(i[i.length-1])},t.length=bn,t.lineSlice=function(t,e,n){var r=U(n);if("LineString"!==K(n))throw new Error("line must be a LineString");for(var i,o=on(n,t),s=on(n,e),u=[(i=o.properties.index<=s.properties.index?[o,s]:[s,o])[0].geometry.coordinates],c=i[0].properties.index+1;c<i[1].properties.index+1;c++)u.push(r[c]);return u.push(i[1].geometry.coordinates),a(u,n.properties)},t.lineSliceAlong=In,t.pointGrid=Ln,t.truncate=Pn,t.flatten=function(t){if(!t)throw new Error("geojson is required");var e=[];return F(t,function(t){e.push(t)}),c(e)},t.lineIntersect=nn,t.lineChunk=function(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.units,i=n.reverse;if(!t)throw new Error("geojson is required");if(e<=0)throw new Error("segmentLength must be greater than 0");var o=[];return F(t,function(t){i&&(t.geometry.coordinates=t.geometry.coordinates.reverse()),function(t,e,n,r){var i=bn(t,{units:n});if(i<=e)return r(t);var o=i/e;Number.isInteger(o)||(o=Math.floor(o)+1);for(var s=0;s<o;s++){var a=In(t,e*s,e*(s+1),{units:n});r(a,s)}}(t,e,r,function(t){o.push(t)})}),c(o)},t.unkinkPolygon=function(t){var e=[];return F(t,function(t){"Polygon"===t.geometry.type&&O(Ls(t),function(n){e.push(o(n.geometry.coordinates,t.properties))})}),c(e)},t.greatCircle=function(t,e,n){if("object"!=typeof(n=n||{}))throw new Error("options is invalid");var r=n.properties,i=n.npoints,o=n.offset;return t=X(t),e=X(e),r=r||{},i=i||100,o=o||10,new qs({x:t[0],y:t[1]},{x:e[0],y:e[1]},r).Arc(i,{offset:o}).json()},t.lineSegment=en,t.lineSplit=function(t,e){if(!t)throw new Error("line is required");if(!e)throw new Error("splitter is required");var n=K(t),r=K(e);if("LineString"!==n)throw new Error("line must be LineString");if("FeatureCollection"===r)throw new Error("splitter cannot be a FeatureCollection");if("GeometryCollection"===r)throw new Error("splitter cannot be a GeometryCollection");var i=Pn(e,{precision:7});switch(r){case"Point":return Dn(t,i);case"MultiPoint":return An(t,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return An(t,nn(t,i))}},t.lineArc=Gn,t.polygonToLine=kn,t.lineToPolygon=jn,t.bboxClip=function(t,e){var n=function(t){return t.geometry?t.geometry.type:t.type}(t),r=U(t),i=t.properties;switch(n){case"LineString":case"MultiLineString":var s=[];return"LineString"===n&&(r=[r]),r.forEach(function(t){Gs(t,e,s)}),1===s.length?a(s[0],i):h(s,i);case"Polygon":return o(Wn(r,e),i);case"MultiPolygon":return p(r.map(function(t){return Wn(t,e)}),i);default:throw new Error("geometry "+n+" not supported")}},t.lineOverlap=$n,t.sector=function(t,e,n,r,i){if(i=i||{},!I(i))throw new Error("options is invalid");if(!t)throw new Error("center is required");if(void 0===n||null===n)throw new Error("bearing1 is required");if(void 0===r||null===r)throw new Error("bearing2 is required");if(!e)throw new Error("radius is required");if("object"!=typeof i)throw new Error("options must be an object");if(er(n)===er(r))return fe(t,e,i);var s=U(t),a=[[s]];return S(Gn(t,e,n,r,i),function(t){a[0].push(t)}),a[0].push(s),o(a)},t.rhumbBearing=sn,t.rhumbDistance=un,t.rhumbDestination=nr,t.polygonTangents=function(t,e){var n,i,o,s=U(t),a=U(e);switch(K(e)){case"Polygon":n=a[0][0],i=a[0][0],o=ir(a[0][0],a[0][a[0].length-1],s);var u=rr(a[0],s,o,void 0,n,i);n=u[0],i=u[1];break;case"MultiPolygon":n=a[0][0][0],i=a[0][0][0],o=ir(a[0][0][0],a[0][0][a[0][0].length-1],s),a.forEach(function(t){var e=rr(t[0],s,o,void 0,n,i);n=e[0],i=e[1]})}return c([r(n),r(i)])},t.rewind=function(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.reverse||!1,r=e.mutate||!1;if(!t)throw new Error("<geojson> is required");if("boolean"!=typeof n)throw new Error("<reverse> must be a boolean");if("boolean"!=typeof r)throw new Error("<mutate> must be a boolean");!1===r&&(t=Gt(t));var i=[];switch(t.type){case"GeometryCollection":return A(t,function(t){sr(t,n)}),t;case"FeatureCollection":return O(t,function(t){O(sr(t,n),function(t){i.push(t)})}),c(i)}return sr(t,n)},t.isobands=function(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.zProperty||"elevation",i=n.commonProperties||{},s=n.breaksProperties||[];if(W(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks is not an Array");if(!I(i))throw new Error("commonProperties is not an Object");if(!Array.isArray(s))throw new Error("breaksProperties is not an Array");var a=cr(t,{zProperty:r,flip:!0}),u=function(t,e,n){for(var r=[],i=1;i<e.length;i++){var s=+e[i-1],a=+e[i],u=hr(t,s,a-s),c=function(t){var e=[],n=[];t.forEach(function(t){var r=mn(o([t]));n.push(r),e.push({ring:t,area:r})}),n.sort(function(t,e){return e-t});var r=[];return n.forEach(function(t){for(var n=0;n<e.length;n++)if(e[n].area===t){r.push(e[n].ring),e.splice(n,1);break}}),r}(u),h=function(t){for(var e=t.map(function(t){return{lrCoordinates:t,grouped:!1}}),n=[];!function(t){for(var e=0;e<t.length;e++)if(!1===t[e].grouped)return!1;return!0}(e);)for(var r=0;r<e.length;r++)if(!e[r].grouped){var i=[];i.push(e[r].lrCoordinates),e[r].grouped=!0;for(var s=o([e[r].lrCoordinates]),a=r+1;a<e.length;a++)if(!e[a].grouped){var u=o([e[a].lrCoordinates]);(function(t,e){for(var n=me(t),r=0;r<n.features.length;r++)if(!Pt(n.features[r],e))return!1;return!0})(u,s)&&(i.push(e[a].lrCoordinates),e[a].grouped=!0)}n.push(i)}return n}(c),l={};l.groupedRings=h,l[n]=s+"-"+a,r.push(l)}return r}(a,e,r);return c((u=function(t,e,n){var r=j(n),i=r[2]-r[0],o=r[3]-r[1],s=r[0],a=r[1],u=e[0].length-1,c=e.length-1,h=i/u,l=o/c,p=function(t){t[0]=t[0]*h+s,t[1]=t[1]*l+a};return t.forEach(function(t){t.groupedRings.forEach(function(t){t.forEach(function(t){t.forEach(p)})})}),t}(u,a,t)).map(function(t,e){if(s[e]&&!I(s[e]))throw new Error("Each mappedProperty is required to be an Object");var n=Object.assign({},i,s[e]);return n[r]=t[r],p(t.groupedRings,n)}))},t.transformRotate=fr,t.transformScale=gr,t.transformTranslate=function(t,e,n,r){if(r=r||{},!I(r))throw new Error("options is invalid");var i=r.units,o=r.zTranslation,s=r.mutate;if(!t)throw new Error("geojson is required");if(void 0===e||null===e||isNaN(e))throw new Error("distance is required");if(o&&"number"!=typeof o&&isNaN(o))throw new Error("zTranslation is not a number");if(o=void 0!==o?o:0,0===e&&0===o)return t;if(void 0===n||null===n||isNaN(n))throw new Error("direction is required");return e<0&&(e=-e,n=-n),!1!==s&&void 0!==s||(t=Gt(t)),S(t,function(t){var r=U(nr(t,e,n,{units:i}));t[0]=r[0],t[1]=r[1],o&&3===t.length&&(t[2]+=o)}),t},t.lineOffset=function(t,e,n){if(n=n||{},!I(n))throw new Error("options is invalid");var r=n.units;if(!t)throw new Error("geojson is required");if(void 0===e||null===e||isNaN(e))throw new Error("distance is required");var i=K(t),o=t.properties;switch(i){case"LineString":return vr(t,e,r);case"MultiLineString":var s=[];return F(t,function(t){s.push(vr(t,e,r).geometry.coordinates)}),h(s,o);default:throw new Error("geometry "+i+" is not supported")}},t.polygonize=function(t){var e=qa.fromGeoJson(t);e.deleteDangles(),e.deleteCutEdges();var n=[],r=[];return e.getEdgeRings().filter(function(t){return t.isValid()}).forEach(function(t){t.isHole()?n.push(t):r.push(t)}),n.forEach(function(t){Da.findEdgeRingContaining(t,r)&&r.push(t)}),c(r.map(function(t){return t.toPolygon()}))},t.booleanDisjoint=function(t,e){var n;return F(t,function(t){F(e,function(e){if(!1===n)return!1;n=function(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return!function(t,e){return t[0]===e[0]&&t[1]===e[1]}(t.coordinates,e.coordinates);case"LineString":return!wr(e,t);case"Polygon":return!Pt(t,e)}break;case"LineString":switch(e.type){case"Point":return!wr(t,e);case"LineString":return!function(t,e){return nn(t,e).features.length>0}(t,e);case"Polygon":return!br(e,t)}break;case"Polygon":switch(e.type){case"Point":return!Pt(e,t);case"LineString":return!br(t,e);case"Polygon":return!function(t,e){for(var n=0;n<t.coordinates[0].length;n++)if(Pt(t.coordinates[0][n],e))return!0;for(var r=0;r<e.coordinates[0].length;r++)if(Pt(e.coordinates[0][r],t))return!0;return!1}(e,t)}}}(t.geometry,e.geometry)})}),n},t.booleanContains=function(t,e){var n=K(t),r=K(e),i=J(t),o=J(e),s=U(t),a=U(e);switch(n){case"Point":switch(r){case"Point":return Nr(s,a);default:throw new Error("feature2 "+r+" geometry not supported")}case"MultiPoint":switch(r){case"Point":return function(t,e){var n,r=!1;for(n=0;n<t.coordinates.length;n++)if(Nr(t.coordinates[n],e.coordinates)){r=!0;break}return r}(i,o);case"MultiPoint":return function(t,e){for(var n=0;n<e.coordinates.length;n++){for(var r=!1,i=0;i<t.coordinates.length;i++)if(Nr(e.coordinates[n],t.coordinates[i])){r=!0;break}if(!r)return!1}return!0}(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"LineString":switch(r){case"Point":return Nn(o,i,{ignoreEndVertices:!0});case"LineString":return function(t,e){for(var n=!1,r=0;r<e.coordinates.length;r++)if(Nn({type:"Point",coordinates:e.coordinates[r]},t,{ignoreEndVertices:!0})&&(n=!0),!Nn({type:"Point",coordinates:e.coordinates[r]},t,{ignoreEndVertices:!1}))return!1;return n}(i,o);case"MultiPoint":return function(t,e){for(var n=!1,r=0;r<e.coordinates.length;r++)if(Nn(e.coordinates[r],t,{ignoreEndVertices:!0})&&(n=!0),!Nn(e.coordinates[r],t))return!1;return!!n}(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"Polygon":switch(r){case"Point":return Pt(o,i,{ignoreBoundary:!0});case"LineString":return function(t,e){var n=!1,r=0,i=j(t),o=j(e);if(!Ir(i,o))return!1;for(;r<e.coordinates.length-1;r++){var s=function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}(e.coordinates[r],e.coordinates[r+1]);if(Pt({type:"Point",coordinates:s},t,{ignoreBoundary:!0})){n=!0;break}}return n}(i,o);case"Polygon":return function(t,e){var n=j(t),r=j(e);if(!Ir(n,r))return!1;for(var i=0;i<e.coordinates[0].length;i++)if(!Pt(e.coordinates[0][i],t))return!1;return!0}(i,o);case"MultiPoint":return function(t,e){for(var n=0;n<e.coordinates.length;n++)if(!Pt(e.coordinates[n],t,{ignoreBoundary:!0}))return!1;return!0}(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}},t.booleanCrosses=function(t,e){var n=K(t),r=K(e),i=J(t),o=J(e);switch(n){case"MultiPoint":switch(r){case"LineString":return Cr(i,o);case"Polygon":return Mr(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"LineString":switch(r){case"MultiPoint":return Cr(o,i);case"LineString":return function(t,e){if(nn(t,e).features.length>0)for(var n=0;n<t.coordinates.length-1;n++)for(var r=0;r<e.coordinates.length-1;r++){var i=!0;if(0!==r&&r!==e.coordinates.length-2||(i=!1),Lr(t.coordinates[n],t.coordinates[n+1],e.coordinates[r],i))return!0}return!1}(i,o);case"Polygon":return Sr(i,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"Polygon":switch(r){case"MultiPoint":return Mr(o,i);case"LineString":return Sr(o,i);default:throw new Error("feature2 "+r+" geometry not supported")}default:throw new Error("feature1 "+n+" geometry not supported")}},t.booleanClockwise=or,t.booleanOverlap=Tr,t.booleanPointOnLine=Nn,t.booleanEqual=function(t,e){if(!t)throw new Error("feature1 is required");if(!e)throw new Error("feature2 is required");return K(t)===K(e)&&new ja({precision:6}).compare(te(t),te(e))},t.booleanWithin=Cn,t.clone=Gt,t.cleanCoords=te,t.clustersDbscan=function(t,e,n){if("object"!=typeof(n=n||{}))throw new Error("options is invalid");var r=n.minPoints,i=n.units;if(W(t,"Point","Input must contain Points"),null===e||void 0===e)throw new Error("maxDistance is required");if(!(Math.sign(e)>0))throw new Error("Invalid maxDistance");if(!(void 0===r||null===r||Math.sign(r)>0))throw new Error("Invalid minPoints");t=Gt(t),r=r||3;var o=new Ha.DBSCAN,s=-1;return o.run(T(t),E(e,i),r,qt).forEach(function(e){s++,e.forEach(function(e){var n=t.features[e];n.properties||(n.properties={}),n.properties.cluster=s,n.properties.dbscan="core"})}),o.noise.forEach(function(e){var n=t.features[e];n.properties||(n.properties={}),n.properties.cluster?n.properties.dbscan="edge":n.properties.dbscan="noise"}),t},t.clustersKmeans=function(t,e){if("object"!=typeof(e=e||{}))throw new Error("options is invalid");var n=e.numberOfClusters,r=e.mutate;W(t,"Point","Input must contain Points");var i=t.features.length;(n=n||Math.round(Math.sqrt(i/2)))>i&&(n=i),!1!==r&&void 0!==r||(t=Gt(t));var o=T(t),s=o.slice(0,n),a=eu(o,n,s),u={};return a.centroids.forEach(function(t,e){u[e]=t}),O(t,function(t,e){var n=a.idxs[e];t.properties.cluster=n,t.properties.centroid=u[n]}),t},t.pointToLineDistance=gn,t.booleanParallel=function(t,e){if(!t)throw new Error("line1 is required");if(!e)throw new Error("line2 is required");if("LineString"!==Dr(t,"line1"))throw new Error("line1 must be a LineString");if("LineString"!==Dr(e,"line2"))throw new Error("line2 must be a LineString");for(var n=en(te(t)).features,r=en(te(e)).features,i=0;i<n.length;i++){var o=n[i].geometry.coordinates;if(!r[i])break;if(!function(t,e){var n=m(sn(t[0],t[1])),r=m(sn(e[0],e[1]));return n===r}(o,r[i].geometry.coordinates))return!1}return!0},t.shortestPath=function(t,n,i){if(i=i||{},!I(i))throw new Error("options is invalid");var o=i.resolution,s=i.minDistance,u=i.obstacles||c([]);if(!t)throw new Error("start is required");if(!n)throw new Error("end is required");if(o&&!b(o)||o<=0)throw new Error("options.resolution must be a number, greater than 0");if(s)throw new Error("options.minDistance is not yet implemented");var h=X(t),l=X(n);switch(t=r(h),n=r(l),K(u)){case"FeatureCollection":if(0===u.features.length)return a([h,l]);break;case"Polygon":u=c([e(J(u))]);break;default:throw new Error("invalid obstacles")}var p=u;p.features.push(t),p.features.push(n);var f=j(gr(ce(j(p)),1.15));o||(o=qt([f[0],f[1]],[f[2],f[1]],i)/100);p.features.pop(),p.features.pop();for(var g=f[0],d=f[1],y=f[2],_=f[3],m=o/qt([g,d],[y,d],i)*(y-g),v=o/qt([g,d],[g,_],i)*(_-d),x=y-g,E=_-d,w=(x-Math.floor(x/m)*m)/2,N=[],C=[],S=[],M=[],L=1/0,P=1/0,O=_-(E-Math.floor(E/v)*v)/2,R=0;O>=d;){for(var T=[],A=[],D=g+w,F=0;D<=y;){var q=r([D,O]),G=function(t,e){for(var n=0;n<e.features.length;n++)if(Pt(t,e.features[n]))return!0;return!1}(q,u);T.push(G?0:1),A.push(D+"|"+O);var B=qt(q,t);!G&&B<L&&(L=B,S={x:F,y:R});var k=qt(q,n);!G&&k<P&&(P=k,M={x:F,y:R}),D+=m,F++}C.push(T),N.push(A),O-=v,R++}var z=new qr(C,{diagonal:!0}),U=z.grid[S.y][S.x],Y=z.grid[M.y][M.x],V=[h];return nu.search(z,U,Y).forEach(function(t){var e=N[t.x][t.y].split("|");V.push([+e[0],+e[1]])}),V.push(l),te(a(V))},t.voronoi=function(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.bbox||[-180,-85,180,85];if(!t)throw new Error("points is required");if(!Array.isArray(n))throw new Error("bbox is invalid");return W(t,"Point","points"),c(fu().x(function(t){return t.geometry.coordinates[0]}).y(function(t){return t.geometry.coordinates[1]}).extent([[n[0],n[1]],[n[2],n[3]]]).polygons(t.features).map(li))},t.ellipse=pi,t.centerMean=gi,t.centerMedian=function(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.counter||10;if(!b(n))throw new Error("counter must be a number");var r=e.weight,i=gi(t,{weight:e.weight}),o=c([]);return O(t,function(t){o.features.push(ye(t,{weight:t.properties[r]}))}),o.properties={tolerance:e.tolerance,medianCandidates:[]},di(i.geometry.coordinates,[0,0],o,n)},t.standardDeviationalEllipse=function(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.steps||64,r=e.weight,i=e.properties||{};if(!b(n))throw new Error("steps must be a number");if(!I(i))throw new Error("properties must be a number");var o=T(t).length,s=gi(t,{weight:r}),a=0,u=0,h=0;O(t,function(t){var e=t.properties[r]||1,n=yi(U(t),U(s));a+=Math.pow(n.x,2)*e,u+=Math.pow(n.y,2)*e,h+=n.x*n.y*e});var l=a-u,p=Math.sqrt(Math.pow(l,2)+4*Math.pow(h,2)),f=2*h,g=Math.atan((l+p)/f),d=180*g/Math.PI,y=0,_=0,m=0;O(t,function(t){var e=t.properties[r]||1,n=yi(U(t),U(s));y+=Math.pow(n.x*Math.cos(g)-n.y*Math.sin(g),2)*e,_+=Math.pow(n.x*Math.sin(g)+n.y*Math.cos(g),2)*e,m+=e});var v=Math.sqrt(2*y/m),x=Math.sqrt(2*_/m),E=pi(s,v,x,{units:"degrees",angle:d,steps:n,properties:i}),w=Rt(t,c([E])),N={meanCenterCoordinates:U(s),semiMajorAxis:v,semiMinorAxis:x,numberOfFeatures:o,angle:d,percentageWithinEllipse:100*T(w).length/o};return E.properties.standardDeviationalEllipse=N,E},t.difference=function(t,n){var r=J(t),i=J(n),o=t.properties||{};if(r=Ui(r),i=Ui(i),!r)return null;if(!i)return e(r,o);var s=new bh,a=s.read(r),u=s.read(i),c=Cf.difference(a,u);return c.isEmpty()?null:e((new Ih).write(c),o)},t.buffer=function(t,e,n){var r=(n=n||{}).units,i=n.steps||64;if(!t)throw new Error("geojson is required");if("object"!=typeof n)throw new Error("options must be an object");if("number"!=typeof i)throw new Error("steps must be an number");if(void 0===e)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");i=i||64,r=r||"kilometers";var o=[];switch(t.type){case"GeometryCollection":return A(t,function(t){var n=bo(t,e,r,i);n&&o.push(n)}),c(o);case"FeatureCollection":return O(t,function(t){var n=bo(t,e,r,i);n&&O(n,function(t){t&&o.push(t)})}),c(o)}return bo(t,e,r,i)},t.union=Mo,t.intersect=Lo,t.dissolve=function(t,e){if(e=e||{},!I(e))throw new Error("options is invalid");var n=e.propertyName;W(t,"Polygon","dissolve");var r=Gt(t),i=r.features,o=[];i.forEach(function(t,e){t.properties.origIndexPosition=e});var s=Qe();s.load(r);for(var u in i){var c=i[u],h=!1;if(s.search(c).features.forEach(function(t){c=i[u];var e=t.properties.origIndexPosition;if(o.length>0&&0!==e)if(e>o[o.length-1])e-=o.length;else{var r=Po(e,o);0!==r&&(e-=r)}if(e!==+u){var l=i[e];l&&c&&(void 0!==n&&l.properties[n]!==c.properties[n]||Tr(c,l)&&function(t,e){var n=a(T(t)),r=a(T(e));return nn(n,r).features.length>0}(c,l)&&(i[u]=Mo(c,l),o.push(t.properties.origIndexPosition),o.sort(function(t,e){return t-e}),s.remove(t),i.splice(e,1),c.properties.origIndexPosition=u,s.remove(c,function(t,e){return t.properties.origIndexPosition===e.properties.origIndexPosition}),h=!0))}}),h){if(!c)continue;c.properties.origIndexPosition=u,s.insert(c),u--}}return i.forEach(function(t){delete t.properties.origIndexPosition,delete t.bbox}),r},t.hexGrid=Oo,t.mask=function(t,e){var n=function(t){return o(t&&t.geometry.coordinates||[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]])}(e),r=function(t){var e=[],n=[];return F(t,function(t){var r=t.geometry.coordinates,i=r[0],s=r.slice(1);e.push(o([i])),s.forEach(function(t){n.push(o([t]))})}),[c(e),c(n)]}(t),i=r[0],s=r[1];return function(t,e,n){var r=[];return r.push(t.geometry.coordinates[0]),F(e,function(t){r.push(t.geometry.coordinates[0])}),F(n,function(t){r.push(t.geometry.coordinates[0])}),o(r)}(n,i=Ro(i),s=Ro(s))},t.squareGrid=Ao,t.triangleGrid=Do,t.interpolate=function(t,e,n){if("object"!=typeof(n=n||{}))throw new Error("options is invalid");var r=n.gridType,i=n.property,o=n.weight;if(!t)throw new Error("points is required");if(W(t,"Point","input must contain Points"),!e)throw new Error("cellSize is required");if(void 0!==o&&"number"!=typeof o)throw new Error("weight must be a number");i=i||"elevation",r=r||"square",o=o||1;var s,a=j(t);switch(r){case"point":case"points":s=Ln(a,e,n);break;case"square":case"squares":s=Ao(a,e,n);break;case"hex":case"hexes":s=Oo(a,e,n);break;case"triangle":case"triangles":s=Do(a,e,n);break;default:throw new Error("invalid gridType")}var u=[];return O(s,function(e){var s=0,a=0;O(t,function(t){var u,c=qt("point"===r?e:ye(e),t,n);if(void 0!==i&&(u=t.properties[i]),void 0===u&&(u=t.geometry.coordinates[2]),void 0===u)throw new Error("zValue is missing");0===c&&(s=u);var h=1/Math.pow(c,o);a+=h,s+=h*u});var c=Gt(e);c.properties[i]=s/a,u.push(c)}),c(u)},t.pointOnSurface=yn,t.polygonToLineString=kn,t.lineStringToPolygon=jn,t.inside=Pt,t.within=Rt,t.bezier=ue,t.nearest=Fe,t.pointOnLine=on,t.lineDistance=bn,t.radians2degrees=v,t.degrees2radians=x,t.distanceToDegrees=_,t.distanceToRadians=y,t.radiansToDistance=d,t.bearingToAngle=m,t.convertDistance=E,t.toMercator=cn,t.toWgs84=hn,t.randomPosition=_i,t.randomPoint=mi,t.randomPolygon=vi,t.randomLineString=xi,t.getCluster=wi,t.clusterEach=bi,t.clusterReduce=Ii,t.createBins=Ni,t.applyFilter=Ci,t.propertiesContainsFilter=Si,t.filterProperties=Mi,t.earthRadius=Fo,t.factors=qo,t.unitsFactors=Go,t.areaFactors=Bo,t.feature=e,t.geometry=n,t.point=r,t.points=i,t.polygon=o,t.polygons=s,t.lineString=a,t.lineStrings=u,t.featureCollection=c,t.multiLineString=h,t.multiPoint=l,t.multiPolygon=p,t.geometryCollection=f,t.round=g,t.radiansToLength=d,t.lengthToRadians=y,t.lengthToDegrees=_,t.bearingToAzimuth=m,t.radiansToDegrees=v,t.degreesToRadians=x,t.convertLength=E,t.convertArea=w,t.isNumber=b,t.isObject=I,t.validateBBox=N,t.validateId=C,t.getCoord=X,t.getCoords=U,t.containsNumber=Y,t.geojsonType=V,t.featureOf=H,t.collectionOf=W,t.getGeom=J,t.getGeomType=Z,t.getType=K,t.coordEach=S,t.coordReduce=M,t.propEach=L,t.propReduce=P,t.featureEach=O,t.featureReduce=R,t.coordAll=T,t.geomEach=A,t.geomReduce=D,t.flattenEach=F,t.flattenReduce=q,t.segmentEach=G,t.segmentReduce=B,t.lineEach=k,t.lineReduce=z,Object.defineProperty(t,"__esModule",{value:!0})});

},{}],3:[function(require,module,exports){
;(function () {
	'use strict';

	/**
	 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
	 *
	 * @codingstandard ftlabs-jsv2
	 * @copyright The Financial Times Limited [All Rights Reserved]
	 * @license MIT License (see LICENSE.txt)
	 */

	/*jslint browser:true, node:true*/
	/*global define, Event, Node*/


	/**
	 * Instantiate fast-clicking listeners on the specified layer.
	 *
	 * @constructor
	 * @param {Element} layer The layer to listen on
	 * @param {Object} [options={}] The options to override the defaults
	 */
	function FastClick(layer, options) {
		var oldOnClick;

		options = options || {};

		/**
		 * Whether a click is currently being tracked.
		 *
		 * @type boolean
		 */
		this.trackingClick = false;


		/**
		 * Timestamp for when click tracking started.
		 *
		 * @type number
		 */
		this.trackingClickStart = 0;


		/**
		 * The element being tracked for a click.
		 *
		 * @type EventTarget
		 */
		this.targetElement = null;


		/**
		 * X-coordinate of touch start event.
		 *
		 * @type number
		 */
		this.touchStartX = 0;


		/**
		 * Y-coordinate of touch start event.
		 *
		 * @type number
		 */
		this.touchStartY = 0;


		/**
		 * ID of the last touch, retrieved from Touch.identifier.
		 *
		 * @type number
		 */
		this.lastTouchIdentifier = 0;


		/**
		 * Touchmove boundary, beyond which a click will be cancelled.
		 *
		 * @type number
		 */
		this.touchBoundary = options.touchBoundary || 10;


		/**
		 * The FastClick layer.
		 *
		 * @type Element
		 */
		this.layer = layer;

		/**
		 * The minimum time between tap(touchstart and touchend) events
		 *
		 * @type number
		 */
		this.tapDelay = options.tapDelay || 200;

		/**
		 * The maximum time for a tap
		 *
		 * @type number
		 */
		this.tapTimeout = options.tapTimeout || 700;

		if (FastClick.notNeeded(layer)) {
			return;
		}

		// Some old versions of Android don't have Function.prototype.bind
		function bind(method, context) {
			return function() { return method.apply(context, arguments); };
		}


		var methods = ['onMouse', 'onClick', 'onTouchStart', 'onTouchMove', 'onTouchEnd', 'onTouchCancel'];
		var context = this;
		for (var i = 0, l = methods.length; i < l; i++) {
			context[methods[i]] = bind(context[methods[i]], context);
		}

		// Set up event handlers as required
		if (deviceIsAndroid) {
			layer.addEventListener('mouseover', this.onMouse, true);
			layer.addEventListener('mousedown', this.onMouse, true);
			layer.addEventListener('mouseup', this.onMouse, true);
		}

		layer.addEventListener('click', this.onClick, true);
		layer.addEventListener('touchstart', this.onTouchStart, false);
		layer.addEventListener('touchmove', this.onTouchMove, false);
		layer.addEventListener('touchend', this.onTouchEnd, false);
		layer.addEventListener('touchcancel', this.onTouchCancel, false);

		// Hack is required for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)
		// which is how FastClick normally stops click events bubbling to callbacks registered on the FastClick
		// layer when they are cancelled.
		if (!Event.prototype.stopImmediatePropagation) {
			layer.removeEventListener = function(type, callback, capture) {
				var rmv = Node.prototype.removeEventListener;
				if (type === 'click') {
					rmv.call(layer, type, callback.hijacked || callback, capture);
				} else {
					rmv.call(layer, type, callback, capture);
				}
			};

			layer.addEventListener = function(type, callback, capture) {
				var adv = Node.prototype.addEventListener;
				if (type === 'click') {
					adv.call(layer, type, callback.hijacked || (callback.hijacked = function(event) {
						if (!event.propagationStopped) {
							callback(event);
						}
					}), capture);
				} else {
					adv.call(layer, type, callback, capture);
				}
			};
		}

		// If a handler is already declared in the element's onclick attribute, it will be fired before
		// FastClick's onClick handler. Fix this by pulling out the user-defined handler function and
		// adding it as listener.
		if (typeof layer.onclick === 'function') {

			// Android browser on at least 3.2 requires a new reference to the function in layer.onclick
			// - the old one won't work if passed to addEventListener directly.
			oldOnClick = layer.onclick;
			layer.addEventListener('click', function(event) {
				oldOnClick(event);
			}, false);
			layer.onclick = null;
		}
	}

	/**
	* Windows Phone 8.1 fakes user agent string to look like Android and iPhone.
	*
	* @type boolean
	*/
	var deviceIsWindowsPhone = navigator.userAgent.indexOf("Windows Phone") >= 0;

	/**
	 * Android requires exceptions.
	 *
	 * @type boolean
	 */
	var deviceIsAndroid = navigator.userAgent.indexOf('Android') > 0 && !deviceIsWindowsPhone;


	/**
	 * iOS requires exceptions.
	 *
	 * @type boolean
	 */
	var deviceIsIOS = /iP(ad|hone|od)/.test(navigator.userAgent) && !deviceIsWindowsPhone;


	/**
	 * iOS 4 requires an exception for select elements.
	 *
	 * @type boolean
	 */
	var deviceIsIOS4 = deviceIsIOS && (/OS 4_\d(_\d)?/).test(navigator.userAgent);


	/**
	 * iOS 6.0-7.* requires the target element to be manually derived
	 *
	 * @type boolean
	 */
	var deviceIsIOSWithBadTarget = deviceIsIOS && (/OS [6-7]_\d/).test(navigator.userAgent);

	/**
	 * BlackBerry requires exceptions.
	 *
	 * @type boolean
	 */
	var deviceIsBlackBerry10 = navigator.userAgent.indexOf('BB10') > 0;

	/**
	 * Determine whether a given element requires a native click.
	 *
	 * @param {EventTarget|Element} target Target DOM element
	 * @returns {boolean} Returns true if the element needs a native click
	 */
	FastClick.prototype.needsClick = function(target) {
		switch (target.nodeName.toLowerCase()) {

		// Don't send a synthetic click to disabled inputs (issue #62)
		case 'button':
		case 'select':
		case 'textarea':
			if (target.disabled) {
				return true;
			}

			break;
		case 'input':

			// File inputs need real clicks on iOS 6 due to a browser bug (issue #68)
			if ((deviceIsIOS && target.type === 'file') || target.disabled) {
				return true;
			}

			break;
		case 'label':
		case 'iframe': // iOS8 homescreen apps can prevent events bubbling into frames
		case 'video':
			return true;
		}

		return (/\bneedsclick\b/).test(target.className);
	};


	/**
	 * Determine whether a given element requires a call to focus to simulate click into element.
	 *
	 * @param {EventTarget|Element} target Target DOM element
	 * @returns {boolean} Returns true if the element requires a call to focus to simulate native click.
	 */
	FastClick.prototype.needsFocus = function(target) {
		switch (target.nodeName.toLowerCase()) {
		case 'textarea':
			return true;
		case 'select':
			return !deviceIsAndroid;
		case 'input':
			switch (target.type) {
			case 'button':
			case 'checkbox':
			case 'file':
			case 'image':
			case 'radio':
			case 'submit':
				return false;
			}

			// No point in attempting to focus disabled inputs
			return !target.disabled && !target.readOnly;
		default:
			return (/\bneedsfocus\b/).test(target.className);
		}
	};


	/**
	 * Send a click event to the specified element.
	 *
	 * @param {EventTarget|Element} targetElement
	 * @param {Event} event
	 */
	FastClick.prototype.sendClick = function(targetElement, event) {
		var clickEvent, touch;

		// On some Android devices activeElement needs to be blurred otherwise the synthetic click will have no effect (#24)
		if (document.activeElement && document.activeElement !== targetElement) {
			document.activeElement.blur();
		}

		touch = event.changedTouches[0];

		// Synthesise a click event, with an extra attribute so it can be tracked
		clickEvent = document.createEvent('MouseEvents');
		clickEvent.initMouseEvent(this.determineEventType(targetElement), true, true, window, 1, touch.screenX, touch.screenY, touch.clientX, touch.clientY, false, false, false, false, 0, null);
		clickEvent.forwardedTouchEvent = true;
		targetElement.dispatchEvent(clickEvent);
	};

	FastClick.prototype.determineEventType = function(targetElement) {

		//Issue #159: Android Chrome Select Box does not open with a synthetic click event
		if (deviceIsAndroid && targetElement.tagName.toLowerCase() === 'select') {
			return 'mousedown';
		}

		return 'click';
	};


	/**
	 * @param {EventTarget|Element} targetElement
	 */
	FastClick.prototype.focus = function(targetElement) {
		var length;

		// Issue #160: on iOS 7, some input elements (e.g. date datetime month) throw a vague TypeError on setSelectionRange. These elements don't have an integer value for the selectionStart and selectionEnd properties, but unfortunately that can't be used for detection because accessing the properties also throws a TypeError. Just check the type instead. Filed as Apple bug #15122724.
		if (deviceIsIOS && targetElement.setSelectionRange && targetElement.type.indexOf('date') !== 0 && targetElement.type !== 'time' && targetElement.type !== 'month') {
			length = targetElement.value.length;
			targetElement.setSelectionRange(length, length);
		} else {
			targetElement.focus();
		}
	};


	/**
	 * Check whether the given target element is a child of a scrollable layer and if so, set a flag on it.
	 *
	 * @param {EventTarget|Element} targetElement
	 */
	FastClick.prototype.updateScrollParent = function(targetElement) {
		var scrollParent, parentElement;

		scrollParent = targetElement.fastClickScrollParent;

		// Attempt to discover whether the target element is contained within a scrollable layer. Re-check if the
		// target element was moved to another parent.
		if (!scrollParent || !scrollParent.contains(targetElement)) {
			parentElement = targetElement;
			do {
				if (parentElement.scrollHeight > parentElement.offsetHeight) {
					scrollParent = parentElement;
					targetElement.fastClickScrollParent = parentElement;
					break;
				}

				parentElement = parentElement.parentElement;
			} while (parentElement);
		}

		// Always update the scroll top tracker if possible.
		if (scrollParent) {
			scrollParent.fastClickLastScrollTop = scrollParent.scrollTop;
		}
	};


	/**
	 * @param {EventTarget} targetElement
	 * @returns {Element|EventTarget}
	 */
	FastClick.prototype.getTargetElementFromEventTarget = function(eventTarget) {

		// On some older browsers (notably Safari on iOS 4.1 - see issue #56) the event target may be a text node.
		if (eventTarget.nodeType === Node.TEXT_NODE) {
			return eventTarget.parentNode;
		}

		return eventTarget;
	};


	/**
	 * On touch start, record the position and scroll offset.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onTouchStart = function(event) {
		var targetElement, touch, selection;

		// Ignore multiple touches, otherwise pinch-to-zoom is prevented if both fingers are on the FastClick element (issue #111).
		if (event.targetTouches.length > 1) {
			return true;
		}

		targetElement = this.getTargetElementFromEventTarget(event.target);
		touch = event.targetTouches[0];

		if (deviceIsIOS) {

			// Only trusted events will deselect text on iOS (issue #49)
			selection = window.getSelection();
			if (selection.rangeCount && !selection.isCollapsed) {
				return true;
			}

			if (!deviceIsIOS4) {

				// Weird things happen on iOS when an alert or confirm dialog is opened from a click event callback (issue #23):
				// when the user next taps anywhere else on the page, new touchstart and touchend events are dispatched
				// with the same identifier as the touch event that previously triggered the click that triggered the alert.
				// Sadly, there is an issue on iOS 4 that causes some normal touch events to have the same identifier as an
				// immediately preceeding touch event (issue #52), so this fix is unavailable on that platform.
				// Issue 120: touch.identifier is 0 when Chrome dev tools 'Emulate touch events' is set with an iOS device UA string,
				// which causes all touch events to be ignored. As this block only applies to iOS, and iOS identifiers are always long,
				// random integers, it's safe to to continue if the identifier is 0 here.
				if (touch.identifier && touch.identifier === this.lastTouchIdentifier) {
					event.preventDefault();
					return false;
				}

				this.lastTouchIdentifier = touch.identifier;

				// If the target element is a child of a scrollable layer (using -webkit-overflow-scrolling: touch) and:
				// 1) the user does a fling scroll on the scrollable layer
				// 2) the user stops the fling scroll with another tap
				// then the event.target of the last 'touchend' event will be the element that was under the user's finger
				// when the fling scroll was started, causing FastClick to send a click event to that layer - unless a check
				// is made to ensure that a parent layer was not scrolled before sending a synthetic click (issue #42).
				this.updateScrollParent(targetElement);
			}
		}

		this.trackingClick = true;
		this.trackingClickStart = event.timeStamp;
		this.targetElement = targetElement;

		this.touchStartX = touch.pageX;
		this.touchStartY = touch.pageY;

		// Prevent phantom clicks on fast double-tap (issue #36)
		if ((event.timeStamp - this.lastClickTime) < this.tapDelay) {
			event.preventDefault();
		}

		return true;
	};


	/**
	 * Based on a touchmove event object, check whether the touch has moved past a boundary since it started.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.touchHasMoved = function(event) {
		var touch = event.changedTouches[0], boundary = this.touchBoundary;

		if (Math.abs(touch.pageX - this.touchStartX) > boundary || Math.abs(touch.pageY - this.touchStartY) > boundary) {
			return true;
		}

		return false;
	};


	/**
	 * Update the last position.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onTouchMove = function(event) {
		if (!this.trackingClick) {
			return true;
		}

		// If the touch has moved, cancel the click tracking
		if (this.targetElement !== this.getTargetElementFromEventTarget(event.target) || this.touchHasMoved(event)) {
			this.trackingClick = false;
			this.targetElement = null;
		}

		return true;
	};


	/**
	 * Attempt to find the labelled control for the given label element.
	 *
	 * @param {EventTarget|HTMLLabelElement} labelElement
	 * @returns {Element|null}
	 */
	FastClick.prototype.findControl = function(labelElement) {

		// Fast path for newer browsers supporting the HTML5 control attribute
		if (labelElement.control !== undefined) {
			return labelElement.control;
		}

		// All browsers under test that support touch events also support the HTML5 htmlFor attribute
		if (labelElement.htmlFor) {
			return document.getElementById(labelElement.htmlFor);
		}

		// If no for attribute exists, attempt to retrieve the first labellable descendant element
		// the list of which is defined here: http://www.w3.org/TR/html5/forms.html#category-label
		return labelElement.querySelector('button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea');
	};


	/**
	 * On touch end, determine whether to send a click event at once.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onTouchEnd = function(event) {
		var forElement, trackingClickStart, targetTagName, scrollParent, touch, targetElement = this.targetElement;

		if (!this.trackingClick) {
			return true;
		}

		// Prevent phantom clicks on fast double-tap (issue #36)
		if ((event.timeStamp - this.lastClickTime) < this.tapDelay) {
			this.cancelNextClick = true;
			return true;
		}

		if ((event.timeStamp - this.trackingClickStart) > this.tapTimeout) {
			return true;
		}

		// Reset to prevent wrong click cancel on input (issue #156).
		this.cancelNextClick = false;

		this.lastClickTime = event.timeStamp;

		trackingClickStart = this.trackingClickStart;
		this.trackingClick = false;
		this.trackingClickStart = 0;

		// On some iOS devices, the targetElement supplied with the event is invalid if the layer
		// is performing a transition or scroll, and has to be re-detected manually. Note that
		// for this to function correctly, it must be called *after* the event target is checked!
		// See issue #57; also filed as rdar://13048589 .
		if (deviceIsIOSWithBadTarget) {
			touch = event.changedTouches[0];

			// In certain cases arguments of elementFromPoint can be negative, so prevent setting targetElement to null
			targetElement = document.elementFromPoint(touch.pageX - window.pageXOffset, touch.pageY - window.pageYOffset) || targetElement;
			targetElement.fastClickScrollParent = this.targetElement.fastClickScrollParent;
		}

		targetTagName = targetElement.tagName.toLowerCase();
		if (targetTagName === 'label') {
			forElement = this.findControl(targetElement);
			if (forElement) {
				this.focus(targetElement);
				if (deviceIsAndroid) {
					return false;
				}

				targetElement = forElement;
			}
		} else if (this.needsFocus(targetElement)) {

			// Case 1: If the touch started a while ago (best guess is 100ms based on tests for issue #36) then focus will be triggered anyway. Return early and unset the target element reference so that the subsequent click will be allowed through.
			// Case 2: Without this exception for input elements tapped when the document is contained in an iframe, then any inputted text won't be visible even though the value attribute is updated as the user types (issue #37).
			if ((event.timeStamp - trackingClickStart) > 100 || (deviceIsIOS && window.top !== window && targetTagName === 'input')) {
				this.targetElement = null;
				return false;
			}

			this.focus(targetElement);
			this.sendClick(targetElement, event);

			// Select elements need the event to go through on iOS 4, otherwise the selector menu won't open.
			// Also this breaks opening selects when VoiceOver is active on iOS6, iOS7 (and possibly others)
			if (!deviceIsIOS || targetTagName !== 'select') {
				this.targetElement = null;
				event.preventDefault();
			}

			return false;
		}

		if (deviceIsIOS && !deviceIsIOS4) {

			// Don't send a synthetic click event if the target element is contained within a parent layer that was scrolled
			// and this tap is being used to stop the scrolling (usually initiated by a fling - issue #42).
			scrollParent = targetElement.fastClickScrollParent;
			if (scrollParent && scrollParent.fastClickLastScrollTop !== scrollParent.scrollTop) {
				return true;
			}
		}

		// Prevent the actual click from going though - unless the target node is marked as requiring
		// real clicks or if it is in the whitelist in which case only non-programmatic clicks are permitted.
		if (!this.needsClick(targetElement)) {
			event.preventDefault();
			this.sendClick(targetElement, event);
		}

		return false;
	};


	/**
	 * On touch cancel, stop tracking the click.
	 *
	 * @returns {void}
	 */
	FastClick.prototype.onTouchCancel = function() {
		this.trackingClick = false;
		this.targetElement = null;
	};


	/**
	 * Determine mouse events which should be permitted.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onMouse = function(event) {

		// If a target element was never set (because a touch event was never fired) allow the event
		if (!this.targetElement) {
			return true;
		}

		if (event.forwardedTouchEvent) {
			return true;
		}

		// Programmatically generated events targeting a specific element should be permitted
		if (!event.cancelable) {
			return true;
		}

		// Derive and check the target element to see whether the mouse event needs to be permitted;
		// unless explicitly enabled, prevent non-touch click events from triggering actions,
		// to prevent ghost/doubleclicks.
		if (!this.needsClick(this.targetElement) || this.cancelNextClick) {

			// Prevent any user-added listeners declared on FastClick element from being fired.
			if (event.stopImmediatePropagation) {
				event.stopImmediatePropagation();
			} else {

				// Part of the hack for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)
				event.propagationStopped = true;
			}

			// Cancel the event
			event.stopPropagation();
			event.preventDefault();

			return false;
		}

		// If the mouse event is permitted, return true for the action to go through.
		return true;
	};


	/**
	 * On actual clicks, determine whether this is a touch-generated click, a click action occurring
	 * naturally after a delay after a touch (which needs to be cancelled to avoid duplication), or
	 * an actual click which should be permitted.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onClick = function(event) {
		var permitted;

		// It's possible for another FastClick-like library delivered with third-party code to fire a click event before FastClick does (issue #44). In that case, set the click-tracking flag back to false and return early. This will cause onTouchEnd to return early.
		if (this.trackingClick) {
			this.targetElement = null;
			this.trackingClick = false;
			return true;
		}

		// Very odd behaviour on iOS (issue #18): if a submit element is present inside a form and the user hits enter in the iOS simulator or clicks the Go button on the pop-up OS keyboard the a kind of 'fake' click event will be triggered with the submit-type input element as the target.
		if (event.target.type === 'submit' && event.detail === 0) {
			return true;
		}

		permitted = this.onMouse(event);

		// Only unset targetElement if the click is not permitted. This will ensure that the check for !targetElement in onMouse fails and the browser's click doesn't go through.
		if (!permitted) {
			this.targetElement = null;
		}

		// If clicks are permitted, return true for the action to go through.
		return permitted;
	};


	/**
	 * Remove all FastClick's event listeners.
	 *
	 * @returns {void}
	 */
	FastClick.prototype.destroy = function() {
		var layer = this.layer;

		if (deviceIsAndroid) {
			layer.removeEventListener('mouseover', this.onMouse, true);
			layer.removeEventListener('mousedown', this.onMouse, true);
			layer.removeEventListener('mouseup', this.onMouse, true);
		}

		layer.removeEventListener('click', this.onClick, true);
		layer.removeEventListener('touchstart', this.onTouchStart, false);
		layer.removeEventListener('touchmove', this.onTouchMove, false);
		layer.removeEventListener('touchend', this.onTouchEnd, false);
		layer.removeEventListener('touchcancel', this.onTouchCancel, false);
	};


	/**
	 * Check whether FastClick is needed.
	 *
	 * @param {Element} layer The layer to listen on
	 */
	FastClick.notNeeded = function(layer) {
		var metaViewport;
		var chromeVersion;
		var blackberryVersion;
		var firefoxVersion;

		// Devices that don't support touch don't need FastClick
		if (typeof window.ontouchstart === 'undefined') {
			return true;
		}

		// Chrome version - zero for other browsers
		chromeVersion = +(/Chrome\/([0-9]+)/.exec(navigator.userAgent) || [,0])[1];

		if (chromeVersion) {

			if (deviceIsAndroid) {
				metaViewport = document.querySelector('meta[name=viewport]');

				if (metaViewport) {
					// Chrome on Android with user-scalable="no" doesn't need FastClick (issue #89)
					if (metaViewport.content.indexOf('user-scalable=no') !== -1) {
						return true;
					}
					// Chrome 32 and above with width=device-width or less don't need FastClick
					if (chromeVersion > 31 && document.documentElement.scrollWidth <= window.outerWidth) {
						return true;
					}
				}

			// Chrome desktop doesn't need FastClick (issue #15)
			} else {
				return true;
			}
		}

		if (deviceIsBlackBerry10) {
			blackberryVersion = navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);

			// BlackBerry 10.3+ does not require Fastclick library.
			// https://github.com/ftlabs/fastclick/issues/251
			if (blackberryVersion[1] >= 10 && blackberryVersion[2] >= 3) {
				metaViewport = document.querySelector('meta[name=viewport]');

				if (metaViewport) {
					// user-scalable=no eliminates click delay.
					if (metaViewport.content.indexOf('user-scalable=no') !== -1) {
						return true;
					}
					// width=device-width (or less than device-width) eliminates click delay.
					if (document.documentElement.scrollWidth <= window.outerWidth) {
						return true;
					}
				}
			}
		}

		// IE10 with -ms-touch-action: none or manipulation, which disables double-tap-to-zoom (issue #97)
		if (layer.style.msTouchAction === 'none' || layer.style.touchAction === 'manipulation') {
			return true;
		}

		// Firefox version - zero for other browsers
		firefoxVersion = +(/Firefox\/([0-9]+)/.exec(navigator.userAgent) || [,0])[1];

		if (firefoxVersion >= 27) {
			// Firefox 27+ does not have tap delay if the content is not zoomable - https://bugzilla.mozilla.org/show_bug.cgi?id=922896

			metaViewport = document.querySelector('meta[name=viewport]');
			if (metaViewport && (metaViewport.content.indexOf('user-scalable=no') !== -1 || document.documentElement.scrollWidth <= window.outerWidth)) {
				return true;
			}
		}

		// IE11: prefixed -ms-touch-action is no longer supported and it's recomended to use non-prefixed version
		// http://msdn.microsoft.com/en-us/library/windows/apps/Hh767313.aspx
		if (layer.style.touchAction === 'none' || layer.style.touchAction === 'manipulation') {
			return true;
		}

		return false;
	};


	/**
	 * Factory method for creating a FastClick object
	 *
	 * @param {Element} layer The layer to listen on
	 * @param {Object} [options={}] The options to override the defaults
	 */
	FastClick.attach = function(layer, options) {
		return new FastClick(layer, options);
	};


	if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {

		// AMD. Register as an anonymous module.
		define(function() {
			return FastClick;
		});
	} else if (typeof module !== 'undefined' && module.exports) {
		module.exports = FastClick.attach;
		module.exports.FastClick = FastClick;
	} else {
		window.FastClick = FastClick;
	}
}());

},{}],4:[function(require,module,exports){
/*!
 * jQuery JavaScript Library v1.12.4
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2016-05-20T17:17Z
 */

(function( global, factory ) {

	if ( typeof module === "object" && typeof module.exports === "object" ) {
		// For CommonJS and CommonJS-like environments where a proper `window`
		// is present, execute the factory and get jQuery.
		// For environments that do not have a `window` with a `document`
		// (such as Node.js), expose a factory as module.exports.
		// This accentuates the need for the creation of a real `window`.
		// e.g. var jQuery = require("jquery")(window);
		// See ticket #14549 for more info.
		module.exports = global.document ?
			factory( global, true ) :
			function( w ) {
				if ( !w.document ) {
					throw new Error( "jQuery requires a window with a document" );
				}
				return factory( w );
			};
	} else {
		factory( global );
	}

// Pass this if window is not defined yet
}(typeof window !== "undefined" ? window : this, function( window, noGlobal ) {

// Support: Firefox 18+
// Can't be in strict mode, several libs including ASP.NET trace
// the stack via arguments.caller.callee and Firefox dies if
// you try to trace through "use strict" call chains. (#13335)
//"use strict";
var deletedIds = [];

var document = window.document;

var slice = deletedIds.slice;

var concat = deletedIds.concat;

var push = deletedIds.push;

var indexOf = deletedIds.indexOf;

var class2type = {};

var toString = class2type.toString;

var hasOwn = class2type.hasOwnProperty;

var support = {};



var
	version = "1.12.4",

	// Define a local copy of jQuery
	jQuery = function( selector, context ) {

		// The jQuery object is actually just the init constructor 'enhanced'
		// Need init if jQuery is called (just allow error to be thrown if not included)
		return new jQuery.fn.init( selector, context );
	},

	// Support: Android<4.1, IE<9
	// Make sure we trim BOM and NBSP
	rtrim = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,

	// Matches dashed string for camelizing
	rmsPrefix = /^-ms-/,
	rdashAlpha = /-([\da-z])/gi,

	// Used by jQuery.camelCase as callback to replace()
	fcamelCase = function( all, letter ) {
		return letter.toUpperCase();
	};

jQuery.fn = jQuery.prototype = {

	// The current version of jQuery being used
	jquery: version,

	constructor: jQuery,

	// Start with an empty selector
	selector: "",

	// The default length of a jQuery object is 0
	length: 0,

	toArray: function() {
		return slice.call( this );
	},

	// Get the Nth element in the matched element set OR
	// Get the whole matched element set as a clean array
	get: function( num ) {
		return num != null ?

			// Return just the one element from the set
			( num < 0 ? this[ num + this.length ] : this[ num ] ) :

			// Return all the elements in a clean array
			slice.call( this );
	},

	// Take an array of elements and push it onto the stack
	// (returning the new matched element set)
	pushStack: function( elems ) {

		// Build a new jQuery matched element set
		var ret = jQuery.merge( this.constructor(), elems );

		// Add the old object onto the stack (as a reference)
		ret.prevObject = this;
		ret.context = this.context;

		// Return the newly-formed element set
		return ret;
	},

	// Execute a callback for every element in the matched set.
	each: function( callback ) {
		return jQuery.each( this, callback );
	},

	map: function( callback ) {
		return this.pushStack( jQuery.map( this, function( elem, i ) {
			return callback.call( elem, i, elem );
		} ) );
	},

	slice: function() {
		return this.pushStack( slice.apply( this, arguments ) );
	},

	first: function() {
		return this.eq( 0 );
	},

	last: function() {
		return this.eq( -1 );
	},

	eq: function( i ) {
		var len = this.length,
			j = +i + ( i < 0 ? len : 0 );
		return this.pushStack( j >= 0 && j < len ? [ this[ j ] ] : [] );
	},

	end: function() {
		return this.prevObject || this.constructor();
	},

	// For internal use only.
	// Behaves like an Array's method, not like a jQuery method.
	push: push,
	sort: deletedIds.sort,
	splice: deletedIds.splice
};

jQuery.extend = jQuery.fn.extend = function() {
	var src, copyIsArray, copy, name, options, clone,
		target = arguments[ 0 ] || {},
		i = 1,
		length = arguments.length,
		deep = false;

	// Handle a deep copy situation
	if ( typeof target === "boolean" ) {
		deep = target;

		// skip the boolean and the target
		target = arguments[ i ] || {};
		i++;
	}

	// Handle case when target is a string or something (possible in deep copy)
	if ( typeof target !== "object" && !jQuery.isFunction( target ) ) {
		target = {};
	}

	// extend jQuery itself if only one argument is passed
	if ( i === length ) {
		target = this;
		i--;
	}

	for ( ; i < length; i++ ) {

		// Only deal with non-null/undefined values
		if ( ( options = arguments[ i ] ) != null ) {

			// Extend the base object
			for ( name in options ) {
				src = target[ name ];
				copy = options[ name ];

				// Prevent never-ending loop
				if ( target === copy ) {
					continue;
				}

				// Recurse if we're merging plain objects or arrays
				if ( deep && copy && ( jQuery.isPlainObject( copy ) ||
					( copyIsArray = jQuery.isArray( copy ) ) ) ) {

					if ( copyIsArray ) {
						copyIsArray = false;
						clone = src && jQuery.isArray( src ) ? src : [];

					} else {
						clone = src && jQuery.isPlainObject( src ) ? src : {};
					}

					// Never move original objects, clone them
					target[ name ] = jQuery.extend( deep, clone, copy );

				// Don't bring in undefined values
				} else if ( copy !== undefined ) {
					target[ name ] = copy;
				}
			}
		}
	}

	// Return the modified object
	return target;
};

jQuery.extend( {

	// Unique for each copy of jQuery on the page
	expando: "jQuery" + ( version + Math.random() ).replace( /\D/g, "" ),

	// Assume jQuery is ready without the ready module
	isReady: true,

	error: function( msg ) {
		throw new Error( msg );
	},

	noop: function() {},

	// See test/unit/core.js for details concerning isFunction.
	// Since version 1.3, DOM methods and functions like alert
	// aren't supported. They return false on IE (#2968).
	isFunction: function( obj ) {
		return jQuery.type( obj ) === "function";
	},

	isArray: Array.isArray || function( obj ) {
		return jQuery.type( obj ) === "array";
	},

	isWindow: function( obj ) {
		/* jshint eqeqeq: false */
		return obj != null && obj == obj.window;
	},

	isNumeric: function( obj ) {

		// parseFloat NaNs numeric-cast false positives (null|true|false|"")
		// ...but misinterprets leading-number strings, particularly hex literals ("0x...")
		// subtraction forces infinities to NaN
		// adding 1 corrects loss of precision from parseFloat (#15100)
		var realStringObj = obj && obj.toString();
		return !jQuery.isArray( obj ) && ( realStringObj - parseFloat( realStringObj ) + 1 ) >= 0;
	},

	isEmptyObject: function( obj ) {
		var name;
		for ( name in obj ) {
			return false;
		}
		return true;
	},

	isPlainObject: function( obj ) {
		var key;

		// Must be an Object.
		// Because of IE, we also have to check the presence of the constructor property.
		// Make sure that DOM nodes and window objects don't pass through, as well
		if ( !obj || jQuery.type( obj ) !== "object" || obj.nodeType || jQuery.isWindow( obj ) ) {
			return false;
		}

		try {

			// Not own constructor property must be Object
			if ( obj.constructor &&
				!hasOwn.call( obj, "constructor" ) &&
				!hasOwn.call( obj.constructor.prototype, "isPrototypeOf" ) ) {
				return false;
			}
		} catch ( e ) {

			// IE8,9 Will throw exceptions on certain host objects #9897
			return false;
		}

		// Support: IE<9
		// Handle iteration over inherited properties before own properties.
		if ( !support.ownFirst ) {
			for ( key in obj ) {
				return hasOwn.call( obj, key );
			}
		}

		// Own properties are enumerated firstly, so to speed up,
		// if last one is own, then all properties are own.
		for ( key in obj ) {}

		return key === undefined || hasOwn.call( obj, key );
	},

	type: function( obj ) {
		if ( obj == null ) {
			return obj + "";
		}
		return typeof obj === "object" || typeof obj === "function" ?
			class2type[ toString.call( obj ) ] || "object" :
			typeof obj;
	},

	// Workarounds based on findings by Jim Driscoll
	// http://weblogs.java.net/blog/driscoll/archive/2009/09/08/eval-javascript-global-context
	globalEval: function( data ) {
		if ( data && jQuery.trim( data ) ) {

			// We use execScript on Internet Explorer
			// We use an anonymous function so that context is window
			// rather than jQuery in Firefox
			( window.execScript || function( data ) {
				window[ "eval" ].call( window, data ); // jscs:ignore requireDotNotation
			} )( data );
		}
	},

	// Convert dashed to camelCase; used by the css and data modules
	// Microsoft forgot to hump their vendor prefix (#9572)
	camelCase: function( string ) {
		return string.replace( rmsPrefix, "ms-" ).replace( rdashAlpha, fcamelCase );
	},

	nodeName: function( elem, name ) {
		return elem.nodeName && elem.nodeName.toLowerCase() === name.toLowerCase();
	},

	each: function( obj, callback ) {
		var length, i = 0;

		if ( isArrayLike( obj ) ) {
			length = obj.length;
			for ( ; i < length; i++ ) {
				if ( callback.call( obj[ i ], i, obj[ i ] ) === false ) {
					break;
				}
			}
		} else {
			for ( i in obj ) {
				if ( callback.call( obj[ i ], i, obj[ i ] ) === false ) {
					break;
				}
			}
		}

		return obj;
	},

	// Support: Android<4.1, IE<9
	trim: function( text ) {
		return text == null ?
			"" :
			( text + "" ).replace( rtrim, "" );
	},

	// results is for internal usage only
	makeArray: function( arr, results ) {
		var ret = results || [];

		if ( arr != null ) {
			if ( isArrayLike( Object( arr ) ) ) {
				jQuery.merge( ret,
					typeof arr === "string" ?
					[ arr ] : arr
				);
			} else {
				push.call( ret, arr );
			}
		}

		return ret;
	},

	inArray: function( elem, arr, i ) {
		var len;

		if ( arr ) {
			if ( indexOf ) {
				return indexOf.call( arr, elem, i );
			}

			len = arr.length;
			i = i ? i < 0 ? Math.max( 0, len + i ) : i : 0;

			for ( ; i < len; i++ ) {

				// Skip accessing in sparse arrays
				if ( i in arr && arr[ i ] === elem ) {
					return i;
				}
			}
		}

		return -1;
	},

	merge: function( first, second ) {
		var len = +second.length,
			j = 0,
			i = first.length;

		while ( j < len ) {
			first[ i++ ] = second[ j++ ];
		}

		// Support: IE<9
		// Workaround casting of .length to NaN on otherwise arraylike objects (e.g., NodeLists)
		if ( len !== len ) {
			while ( second[ j ] !== undefined ) {
				first[ i++ ] = second[ j++ ];
			}
		}

		first.length = i;

		return first;
	},

	grep: function( elems, callback, invert ) {
		var callbackInverse,
			matches = [],
			i = 0,
			length = elems.length,
			callbackExpect = !invert;

		// Go through the array, only saving the items
		// that pass the validator function
		for ( ; i < length; i++ ) {
			callbackInverse = !callback( elems[ i ], i );
			if ( callbackInverse !== callbackExpect ) {
				matches.push( elems[ i ] );
			}
		}

		return matches;
	},

	// arg is for internal usage only
	map: function( elems, callback, arg ) {
		var length, value,
			i = 0,
			ret = [];

		// Go through the array, translating each of the items to their new values
		if ( isArrayLike( elems ) ) {
			length = elems.length;
			for ( ; i < length; i++ ) {
				value = callback( elems[ i ], i, arg );

				if ( value != null ) {
					ret.push( value );
				}
			}

		// Go through every key on the object,
		} else {
			for ( i in elems ) {
				value = callback( elems[ i ], i, arg );

				if ( value != null ) {
					ret.push( value );
				}
			}
		}

		// Flatten any nested arrays
		return concat.apply( [], ret );
	},

	// A global GUID counter for objects
	guid: 1,

	// Bind a function to a context, optionally partially applying any
	// arguments.
	proxy: function( fn, context ) {
		var args, proxy, tmp;

		if ( typeof context === "string" ) {
			tmp = fn[ context ];
			context = fn;
			fn = tmp;
		}

		// Quick check to determine if target is callable, in the spec
		// this throws a TypeError, but we will just return undefined.
		if ( !jQuery.isFunction( fn ) ) {
			return undefined;
		}

		// Simulated bind
		args = slice.call( arguments, 2 );
		proxy = function() {
			return fn.apply( context || this, args.concat( slice.call( arguments ) ) );
		};

		// Set the guid of unique handler to the same of original handler, so it can be removed
		proxy.guid = fn.guid = fn.guid || jQuery.guid++;

		return proxy;
	},

	now: function() {
		return +( new Date() );
	},

	// jQuery.support is not used in Core but other projects attach their
	// properties to it so it needs to exist.
	support: support
} );

// JSHint would error on this code due to the Symbol not being defined in ES5.
// Defining this global in .jshintrc would create a danger of using the global
// unguarded in another place, it seems safer to just disable JSHint for these
// three lines.
/* jshint ignore: start */
if ( typeof Symbol === "function" ) {
	jQuery.fn[ Symbol.iterator ] = deletedIds[ Symbol.iterator ];
}
/* jshint ignore: end */

// Populate the class2type map
jQuery.each( "Boolean Number String Function Array Date RegExp Object Error Symbol".split( " " ),
function( i, name ) {
	class2type[ "[object " + name + "]" ] = name.toLowerCase();
} );

function isArrayLike( obj ) {

	// Support: iOS 8.2 (not reproducible in simulator)
	// `in` check used to prevent JIT error (gh-2145)
	// hasOwn isn't used here due to false negatives
	// regarding Nodelist length in IE
	var length = !!obj && "length" in obj && obj.length,
		type = jQuery.type( obj );

	if ( type === "function" || jQuery.isWindow( obj ) ) {
		return false;
	}

	return type === "array" || length === 0 ||
		typeof length === "number" && length > 0 && ( length - 1 ) in obj;
}
var Sizzle =
/*!
 * Sizzle CSS Selector Engine v2.2.1
 * http://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2015-10-17
 */
(function( window ) {

var i,
	support,
	Expr,
	getText,
	isXML,
	tokenize,
	compile,
	select,
	outermostContext,
	sortInput,
	hasDuplicate,

	// Local document vars
	setDocument,
	document,
	docElem,
	documentIsHTML,
	rbuggyQSA,
	rbuggyMatches,
	matches,
	contains,

	// Instance-specific data
	expando = "sizzle" + 1 * new Date(),
	preferredDoc = window.document,
	dirruns = 0,
	done = 0,
	classCache = createCache(),
	tokenCache = createCache(),
	compilerCache = createCache(),
	sortOrder = function( a, b ) {
		if ( a === b ) {
			hasDuplicate = true;
		}
		return 0;
	},

	// General-purpose constants
	MAX_NEGATIVE = 1 << 31,

	// Instance methods
	hasOwn = ({}).hasOwnProperty,
	arr = [],
	pop = arr.pop,
	push_native = arr.push,
	push = arr.push,
	slice = arr.slice,
	// Use a stripped-down indexOf as it's faster than native
	// http://jsperf.com/thor-indexof-vs-for/5
	indexOf = function( list, elem ) {
		var i = 0,
			len = list.length;
		for ( ; i < len; i++ ) {
			if ( list[i] === elem ) {
				return i;
			}
		}
		return -1;
	},

	booleans = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",

	// Regular expressions

	// http://www.w3.org/TR/css3-selectors/#whitespace
	whitespace = "[\\x20\\t\\r\\n\\f]",

	// http://www.w3.org/TR/CSS21/syndata.html#value-def-identifier
	identifier = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",

	// Attribute selectors: http://www.w3.org/TR/selectors/#attribute-selectors
	attributes = "\\[" + whitespace + "*(" + identifier + ")(?:" + whitespace +
		// Operator (capture 2)
		"*([*^$|!~]?=)" + whitespace +
		// "Attribute values must be CSS identifiers [capture 5] or strings [capture 3 or capture 4]"
		"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + identifier + "))|)" + whitespace +
		"*\\]",

	pseudos = ":(" + identifier + ")(?:\\((" +
		// To reduce the number of selectors needing tokenize in the preFilter, prefer arguments:
		// 1. quoted (capture 3; capture 4 or capture 5)
		"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|" +
		// 2. simple (capture 6)
		"((?:\\\\.|[^\\\\()[\\]]|" + attributes + ")*)|" +
		// 3. anything else (capture 2)
		".*" +
		")\\)|)",

	// Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter
	rwhitespace = new RegExp( whitespace + "+", "g" ),
	rtrim = new RegExp( "^" + whitespace + "+|((?:^|[^\\\\])(?:\\\\.)*)" + whitespace + "+$", "g" ),

	rcomma = new RegExp( "^" + whitespace + "*," + whitespace + "*" ),
	rcombinators = new RegExp( "^" + whitespace + "*([>+~]|" + whitespace + ")" + whitespace + "*" ),

	rattributeQuotes = new RegExp( "=" + whitespace + "*([^\\]'\"]*?)" + whitespace + "*\\]", "g" ),

	rpseudo = new RegExp( pseudos ),
	ridentifier = new RegExp( "^" + identifier + "$" ),

	matchExpr = {
		"ID": new RegExp( "^#(" + identifier + ")" ),
		"CLASS": new RegExp( "^\\.(" + identifier + ")" ),
		"TAG": new RegExp( "^(" + identifier + "|[*])" ),
		"ATTR": new RegExp( "^" + attributes ),
		"PSEUDO": new RegExp( "^" + pseudos ),
		"CHILD": new RegExp( "^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + whitespace +
			"*(even|odd|(([+-]|)(\\d*)n|)" + whitespace + "*(?:([+-]|)" + whitespace +
			"*(\\d+)|))" + whitespace + "*\\)|)", "i" ),
		"bool": new RegExp( "^(?:" + booleans + ")$", "i" ),
		// For use in libraries implementing .is()
		// We use this for POS matching in `select`
		"needsContext": new RegExp( "^" + whitespace + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" +
			whitespace + "*((?:-\\d)?\\d*)" + whitespace + "*\\)|)(?=[^-]|$)", "i" )
	},

	rinputs = /^(?:input|select|textarea|button)$/i,
	rheader = /^h\d$/i,

	rnative = /^[^{]+\{\s*\[native \w/,

	// Easily-parseable/retrievable ID or TAG or CLASS selectors
	rquickExpr = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,

	rsibling = /[+~]/,
	rescape = /'|\\/g,

	// CSS escapes http://www.w3.org/TR/CSS21/syndata.html#escaped-characters
	runescape = new RegExp( "\\\\([\\da-f]{1,6}" + whitespace + "?|(" + whitespace + ")|.)", "ig" ),
	funescape = function( _, escaped, escapedWhitespace ) {
		var high = "0x" + escaped - 0x10000;
		// NaN means non-codepoint
		// Support: Firefox<24
		// Workaround erroneous numeric interpretation of +"0x"
		return high !== high || escapedWhitespace ?
			escaped :
			high < 0 ?
				// BMP codepoint
				String.fromCharCode( high + 0x10000 ) :
				// Supplemental Plane codepoint (surrogate pair)
				String.fromCharCode( high >> 10 | 0xD800, high & 0x3FF | 0xDC00 );
	},

	// Used for iframes
	// See setDocument()
	// Removing the function wrapper causes a "Permission Denied"
	// error in IE
	unloadHandler = function() {
		setDocument();
	};

// Optimize for push.apply( _, NodeList )
try {
	push.apply(
		(arr = slice.call( preferredDoc.childNodes )),
		preferredDoc.childNodes
	);
	// Support: Android<4.0
	// Detect silently failing push.apply
	arr[ preferredDoc.childNodes.length ].nodeType;
} catch ( e ) {
	push = { apply: arr.length ?

		// Leverage slice if possible
		function( target, els ) {
			push_native.apply( target, slice.call(els) );
		} :

		// Support: IE<9
		// Otherwise append directly
		function( target, els ) {
			var j = target.length,
				i = 0;
			// Can't trust NodeList.length
			while ( (target[j++] = els[i++]) ) {}
			target.length = j - 1;
		}
	};
}

function Sizzle( selector, context, results, seed ) {
	var m, i, elem, nid, nidselect, match, groups, newSelector,
		newContext = context && context.ownerDocument,

		// nodeType defaults to 9, since context defaults to document
		nodeType = context ? context.nodeType : 9;

	results = results || [];

	// Return early from calls with invalid selector or context
	if ( typeof selector !== "string" || !selector ||
		nodeType !== 1 && nodeType !== 9 && nodeType !== 11 ) {

		return results;
	}

	// Try to shortcut find operations (as opposed to filters) in HTML documents
	if ( !seed ) {

		if ( ( context ? context.ownerDocument || context : preferredDoc ) !== document ) {
			setDocument( context );
		}
		context = context || document;

		if ( documentIsHTML ) {

			// If the selector is sufficiently simple, try using a "get*By*" DOM method
			// (excepting DocumentFragment context, where the methods don't exist)
			if ( nodeType !== 11 && (match = rquickExpr.exec( selector )) ) {

				// ID selector
				if ( (m = match[1]) ) {

					// Document context
					if ( nodeType === 9 ) {
						if ( (elem = context.getElementById( m )) ) {

							// Support: IE, Opera, Webkit
							// TODO: identify versions
							// getElementById can match elements by name instead of ID
							if ( elem.id === m ) {
								results.push( elem );
								return results;
							}
						} else {
							return results;
						}

					// Element context
					} else {

						// Support: IE, Opera, Webkit
						// TODO: identify versions
						// getElementById can match elements by name instead of ID
						if ( newContext && (elem = newContext.getElementById( m )) &&
							contains( context, elem ) &&
							elem.id === m ) {

							results.push( elem );
							return results;
						}
					}

				// Type selector
				} else if ( match[2] ) {
					push.apply( results, context.getElementsByTagName( selector ) );
					return results;

				// Class selector
				} else if ( (m = match[3]) && support.getElementsByClassName &&
					context.getElementsByClassName ) {

					push.apply( results, context.getElementsByClassName( m ) );
					return results;
				}
			}

			// Take advantage of querySelectorAll
			if ( support.qsa &&
				!compilerCache[ selector + " " ] &&
				(!rbuggyQSA || !rbuggyQSA.test( selector )) ) {

				if ( nodeType !== 1 ) {
					newContext = context;
					newSelector = selector;

				// qSA looks outside Element context, which is not what we want
				// Thanks to Andrew Dupont for this workaround technique
				// Support: IE <=8
				// Exclude object elements
				} else if ( context.nodeName.toLowerCase() !== "object" ) {

					// Capture the context ID, setting it first if necessary
					if ( (nid = context.getAttribute( "id" )) ) {
						nid = nid.replace( rescape, "\\$&" );
					} else {
						context.setAttribute( "id", (nid = expando) );
					}

					// Prefix every selector in the list
					groups = tokenize( selector );
					i = groups.length;
					nidselect = ridentifier.test( nid ) ? "#" + nid : "[id='" + nid + "']";
					while ( i-- ) {
						groups[i] = nidselect + " " + toSelector( groups[i] );
					}
					newSelector = groups.join( "," );

					// Expand context for sibling selectors
					newContext = rsibling.test( selector ) && testContext( context.parentNode ) ||
						context;
				}

				if ( newSelector ) {
					try {
						push.apply( results,
							newContext.querySelectorAll( newSelector )
						);
						return results;
					} catch ( qsaError ) {
					} finally {
						if ( nid === expando ) {
							context.removeAttribute( "id" );
						}
					}
				}
			}
		}
	}

	// All others
	return select( selector.replace( rtrim, "$1" ), context, results, seed );
}

/**
 * Create key-value caches of limited size
 * @returns {function(string, object)} Returns the Object data after storing it on itself with
 *	property name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)
 *	deleting the oldest entry
 */
function createCache() {
	var keys = [];

	function cache( key, value ) {
		// Use (key + " ") to avoid collision with native prototype properties (see Issue #157)
		if ( keys.push( key + " " ) > Expr.cacheLength ) {
			// Only keep the most recent entries
			delete cache[ keys.shift() ];
		}
		return (cache[ key + " " ] = value);
	}
	return cache;
}

/**
 * Mark a function for special use by Sizzle
 * @param {Function} fn The function to mark
 */
function markFunction( fn ) {
	fn[ expando ] = true;
	return fn;
}

/**
 * Support testing using an element
 * @param {Function} fn Passed the created div and expects a boolean result
 */
function assert( fn ) {
	var div = document.createElement("div");

	try {
		return !!fn( div );
	} catch (e) {
		return false;
	} finally {
		// Remove from its parent by default
		if ( div.parentNode ) {
			div.parentNode.removeChild( div );
		}
		// release memory in IE
		div = null;
	}
}

/**
 * Adds the same handler for all of the specified attrs
 * @param {String} attrs Pipe-separated list of attributes
 * @param {Function} handler The method that will be applied
 */
function addHandle( attrs, handler ) {
	var arr = attrs.split("|"),
		i = arr.length;

	while ( i-- ) {
		Expr.attrHandle[ arr[i] ] = handler;
	}
}

/**
 * Checks document order of two siblings
 * @param {Element} a
 * @param {Element} b
 * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b
 */
function siblingCheck( a, b ) {
	var cur = b && a,
		diff = cur && a.nodeType === 1 && b.nodeType === 1 &&
			( ~b.sourceIndex || MAX_NEGATIVE ) -
			( ~a.sourceIndex || MAX_NEGATIVE );

	// Use IE sourceIndex if available on both nodes
	if ( diff ) {
		return diff;
	}

	// Check if b follows a
	if ( cur ) {
		while ( (cur = cur.nextSibling) ) {
			if ( cur === b ) {
				return -1;
			}
		}
	}

	return a ? 1 : -1;
}

/**
 * Returns a function to use in pseudos for input types
 * @param {String} type
 */
function createInputPseudo( type ) {
	return function( elem ) {
		var name = elem.nodeName.toLowerCase();
		return name === "input" && elem.type === type;
	};
}

/**
 * Returns a function to use in pseudos for buttons
 * @param {String} type
 */
function createButtonPseudo( type ) {
	return function( elem ) {
		var name = elem.nodeName.toLowerCase();
		return (name === "input" || name === "button") && elem.type === type;
	};
}

/**
 * Returns a function to use in pseudos for positionals
 * @param {Function} fn
 */
function createPositionalPseudo( fn ) {
	return markFunction(function( argument ) {
		argument = +argument;
		return markFunction(function( seed, matches ) {
			var j,
				matchIndexes = fn( [], seed.length, argument ),
				i = matchIndexes.length;

			// Match elements found at the specified indexes
			while ( i-- ) {
				if ( seed[ (j = matchIndexes[i]) ] ) {
					seed[j] = !(matches[j] = seed[j]);
				}
			}
		});
	});
}

/**
 * Checks a node for validity as a Sizzle context
 * @param {Element|Object=} context
 * @returns {Element|Object|Boolean} The input node if acceptable, otherwise a falsy value
 */
function testContext( context ) {
	return context && typeof context.getElementsByTagName !== "undefined" && context;
}

// Expose support vars for convenience
support = Sizzle.support = {};

/**
 * Detects XML nodes
 * @param {Element|Object} elem An element or a document
 * @returns {Boolean} True iff elem is a non-HTML XML node
 */
isXML = Sizzle.isXML = function( elem ) {
	// documentElement is verified for cases where it doesn't yet exist
	// (such as loading iframes in IE - #4833)
	var documentElement = elem && (elem.ownerDocument || elem).documentElement;
	return documentElement ? documentElement.nodeName !== "HTML" : false;
};

/**
 * Sets document-related variables once based on the current document
 * @param {Element|Object} [doc] An element or document object to use to set the document
 * @returns {Object} Returns the current document
 */
setDocument = Sizzle.setDocument = function( node ) {
	var hasCompare, parent,
		doc = node ? node.ownerDocument || node : preferredDoc;

	// Return early if doc is invalid or already selected
	if ( doc === document || doc.nodeType !== 9 || !doc.documentElement ) {
		return document;
	}

	// Update global variables
	document = doc;
	docElem = document.documentElement;
	documentIsHTML = !isXML( document );

	// Support: IE 9-11, Edge
	// Accessing iframe documents after unload throws "permission denied" errors (jQuery #13936)
	if ( (parent = document.defaultView) && parent.top !== parent ) {
		// Support: IE 11
		if ( parent.addEventListener ) {
			parent.addEventListener( "unload", unloadHandler, false );

		// Support: IE 9 - 10 only
		} else if ( parent.attachEvent ) {
			parent.attachEvent( "onunload", unloadHandler );
		}
	}

	/* Attributes
	---------------------------------------------------------------------- */

	// Support: IE<8
	// Verify that getAttribute really returns attributes and not properties
	// (excepting IE8 booleans)
	support.attributes = assert(function( div ) {
		div.className = "i";
		return !div.getAttribute("className");
	});

	/* getElement(s)By*
	---------------------------------------------------------------------- */

	// Check if getElementsByTagName("*") returns only elements
	support.getElementsByTagName = assert(function( div ) {
		div.appendChild( document.createComment("") );
		return !div.getElementsByTagName("*").length;
	});

	// Support: IE<9
	support.getElementsByClassName = rnative.test( document.getElementsByClassName );

	// Support: IE<10
	// Check if getElementById returns elements by name
	// The broken getElementById methods don't pick up programatically-set names,
	// so use a roundabout getElementsByName test
	support.getById = assert(function( div ) {
		docElem.appendChild( div ).id = expando;
		return !document.getElementsByName || !document.getElementsByName( expando ).length;
	});

	// ID find and filter
	if ( support.getById ) {
		Expr.find["ID"] = function( id, context ) {
			if ( typeof context.getElementById !== "undefined" && documentIsHTML ) {
				var m = context.getElementById( id );
				return m ? [ m ] : [];
			}
		};
		Expr.filter["ID"] = function( id ) {
			var attrId = id.replace( runescape, funescape );
			return function( elem ) {
				return elem.getAttribute("id") === attrId;
			};
		};
	} else {
		// Support: IE6/7
		// getElementById is not reliable as a find shortcut
		delete Expr.find["ID"];

		Expr.filter["ID"] =  function( id ) {
			var attrId = id.replace( runescape, funescape );
			return function( elem ) {
				var node = typeof elem.getAttributeNode !== "undefined" &&
					elem.getAttributeNode("id");
				return node && node.value === attrId;
			};
		};
	}

	// Tag
	Expr.find["TAG"] = support.getElementsByTagName ?
		function( tag, context ) {
			if ( typeof context.getElementsByTagName !== "undefined" ) {
				return context.getElementsByTagName( tag );

			// DocumentFragment nodes don't have gEBTN
			} else if ( support.qsa ) {
				return context.querySelectorAll( tag );
			}
		} :

		function( tag, context ) {
			var elem,
				tmp = [],
				i = 0,
				// By happy coincidence, a (broken) gEBTN appears on DocumentFragment nodes too
				results = context.getElementsByTagName( tag );

			// Filter out possible comments
			if ( tag === "*" ) {
				while ( (elem = results[i++]) ) {
					if ( elem.nodeType === 1 ) {
						tmp.push( elem );
					}
				}

				return tmp;
			}
			return results;
		};

	// Class
	Expr.find["CLASS"] = support.getElementsByClassName && function( className, context ) {
		if ( typeof context.getElementsByClassName !== "undefined" && documentIsHTML ) {
			return context.getElementsByClassName( className );
		}
	};

	/* QSA/matchesSelector
	---------------------------------------------------------------------- */

	// QSA and matchesSelector support

	// matchesSelector(:active) reports false when true (IE9/Opera 11.5)
	rbuggyMatches = [];

	// qSa(:focus) reports false when true (Chrome 21)
	// We allow this because of a bug in IE8/9 that throws an error
	// whenever `document.activeElement` is accessed on an iframe
	// So, we allow :focus to pass through QSA all the time to avoid the IE error
	// See http://bugs.jquery.com/ticket/13378
	rbuggyQSA = [];

	if ( (support.qsa = rnative.test( document.querySelectorAll )) ) {
		// Build QSA regex
		// Regex strategy adopted from Diego Perini
		assert(function( div ) {
			// Select is set to empty string on purpose
			// This is to test IE's treatment of not explicitly
			// setting a boolean content attribute,
			// since its presence should be enough
			// http://bugs.jquery.com/ticket/12359
			docElem.appendChild( div ).innerHTML = "<a id='" + expando + "'></a>" +
				"<select id='" + expando + "-\r\\' msallowcapture=''>" +
				"<option selected=''></option></select>";

			// Support: IE8, Opera 11-12.16
			// Nothing should be selected when empty strings follow ^= or $= or *=
			// The test attribute must be unknown in Opera but "safe" for WinRT
			// http://msdn.microsoft.com/en-us/library/ie/hh465388.aspx#attribute_section
			if ( div.querySelectorAll("[msallowcapture^='']").length ) {
				rbuggyQSA.push( "[*^$]=" + whitespace + "*(?:''|\"\")" );
			}

			// Support: IE8
			// Boolean attributes and "value" are not treated correctly
			if ( !div.querySelectorAll("[selected]").length ) {
				rbuggyQSA.push( "\\[" + whitespace + "*(?:value|" + booleans + ")" );
			}

			// Support: Chrome<29, Android<4.4, Safari<7.0+, iOS<7.0+, PhantomJS<1.9.8+
			if ( !div.querySelectorAll( "[id~=" + expando + "-]" ).length ) {
				rbuggyQSA.push("~=");
			}

			// Webkit/Opera - :checked should return selected option elements
			// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
			// IE8 throws error here and will not see later tests
			if ( !div.querySelectorAll(":checked").length ) {
				rbuggyQSA.push(":checked");
			}

			// Support: Safari 8+, iOS 8+
			// https://bugs.webkit.org/show_bug.cgi?id=136851
			// In-page `selector#id sibing-combinator selector` fails
			if ( !div.querySelectorAll( "a#" + expando + "+*" ).length ) {
				rbuggyQSA.push(".#.+[+~]");
			}
		});

		assert(function( div ) {
			// Support: Windows 8 Native Apps
			// The type and name attributes are restricted during .innerHTML assignment
			var input = document.createElement("input");
			input.setAttribute( "type", "hidden" );
			div.appendChild( input ).setAttribute( "name", "D" );

			// Support: IE8
			// Enforce case-sensitivity of name attribute
			if ( div.querySelectorAll("[name=d]").length ) {
				rbuggyQSA.push( "name" + whitespace + "*[*^$|!~]?=" );
			}

			// FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)
			// IE8 throws error here and will not see later tests
			if ( !div.querySelectorAll(":enabled").length ) {
				rbuggyQSA.push( ":enabled", ":disabled" );
			}

			// Opera 10-11 does not throw on post-comma invalid pseudos
			div.querySelectorAll("*,:x");
			rbuggyQSA.push(",.*:");
		});
	}

	if ( (support.matchesSelector = rnative.test( (matches = docElem.matches ||
		docElem.webkitMatchesSelector ||
		docElem.mozMatchesSelector ||
		docElem.oMatchesSelector ||
		docElem.msMatchesSelector) )) ) {

		assert(function( div ) {
			// Check to see if it's possible to do matchesSelector
			// on a disconnected node (IE 9)
			support.disconnectedMatch = matches.call( div, "div" );

			// This should fail with an exception
			// Gecko does not error, returns false instead
			matches.call( div, "[s!='']:x" );
			rbuggyMatches.push( "!=", pseudos );
		});
	}

	rbuggyQSA = rbuggyQSA.length && new RegExp( rbuggyQSA.join("|") );
	rbuggyMatches = rbuggyMatches.length && new RegExp( rbuggyMatches.join("|") );

	/* Contains
	---------------------------------------------------------------------- */
	hasCompare = rnative.test( docElem.compareDocumentPosition );

	// Element contains another
	// Purposefully self-exclusive
	// As in, an element does not contain itself
	contains = hasCompare || rnative.test( docElem.contains ) ?
		function( a, b ) {
			var adown = a.nodeType === 9 ? a.documentElement : a,
				bup = b && b.parentNode;
			return a === bup || !!( bup && bup.nodeType === 1 && (
				adown.contains ?
					adown.contains( bup ) :
					a.compareDocumentPosition && a.compareDocumentPosition( bup ) & 16
			));
		} :
		function( a, b ) {
			if ( b ) {
				while ( (b = b.parentNode) ) {
					if ( b === a ) {
						return true;
					}
				}
			}
			return false;
		};

	/* Sorting
	---------------------------------------------------------------------- */

	// Document order sorting
	sortOrder = hasCompare ?
	function( a, b ) {

		// Flag for duplicate removal
		if ( a === b ) {
			hasDuplicate = true;
			return 0;
		}

		// Sort on method existence if only one input has compareDocumentPosition
		var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;
		if ( compare ) {
			return compare;
		}

		// Calculate position if both inputs belong to the same document
		compare = ( a.ownerDocument || a ) === ( b.ownerDocument || b ) ?
			a.compareDocumentPosition( b ) :

			// Otherwise we know they are disconnected
			1;

		// Disconnected nodes
		if ( compare & 1 ||
			(!support.sortDetached && b.compareDocumentPosition( a ) === compare) ) {

			// Choose the first element that is related to our preferred document
			if ( a === document || a.ownerDocument === preferredDoc && contains(preferredDoc, a) ) {
				return -1;
			}
			if ( b === document || b.ownerDocument === preferredDoc && contains(preferredDoc, b) ) {
				return 1;
			}

			// Maintain original order
			return sortInput ?
				( indexOf( sortInput, a ) - indexOf( sortInput, b ) ) :
				0;
		}

		return compare & 4 ? -1 : 1;
	} :
	function( a, b ) {
		// Exit early if the nodes are identical
		if ( a === b ) {
			hasDuplicate = true;
			return 0;
		}

		var cur,
			i = 0,
			aup = a.parentNode,
			bup = b.parentNode,
			ap = [ a ],
			bp = [ b ];

		// Parentless nodes are either documents or disconnected
		if ( !aup || !bup ) {
			return a === document ? -1 :
				b === document ? 1 :
				aup ? -1 :
				bup ? 1 :
				sortInput ?
				( indexOf( sortInput, a ) - indexOf( sortInput, b ) ) :
				0;

		// If the nodes are siblings, we can do a quick check
		} else if ( aup === bup ) {
			return siblingCheck( a, b );
		}

		// Otherwise we need full lists of their ancestors for comparison
		cur = a;
		while ( (cur = cur.parentNode) ) {
			ap.unshift( cur );
		}
		cur = b;
		while ( (cur = cur.parentNode) ) {
			bp.unshift( cur );
		}

		// Walk down the tree looking for a discrepancy
		while ( ap[i] === bp[i] ) {
			i++;
		}

		return i ?
			// Do a sibling check if the nodes have a common ancestor
			siblingCheck( ap[i], bp[i] ) :

			// Otherwise nodes in our document sort first
			ap[i] === preferredDoc ? -1 :
			bp[i] === preferredDoc ? 1 :
			0;
	};

	return document;
};

Sizzle.matches = function( expr, elements ) {
	return Sizzle( expr, null, null, elements );
};

Sizzle.matchesSelector = function( elem, expr ) {
	// Set document vars if needed
	if ( ( elem.ownerDocument || elem ) !== document ) {
		setDocument( elem );
	}

	// Make sure that attribute selectors are quoted
	expr = expr.replace( rattributeQuotes, "='$1']" );

	if ( support.matchesSelector && documentIsHTML &&
		!compilerCache[ expr + " " ] &&
		( !rbuggyMatches || !rbuggyMatches.test( expr ) ) &&
		( !rbuggyQSA     || !rbuggyQSA.test( expr ) ) ) {

		try {
			var ret = matches.call( elem, expr );

			// IE 9's matchesSelector returns false on disconnected nodes
			if ( ret || support.disconnectedMatch ||
					// As well, disconnected nodes are said to be in a document
					// fragment in IE 9
					elem.document && elem.document.nodeType !== 11 ) {
				return ret;
			}
		} catch (e) {}
	}

	return Sizzle( expr, document, null, [ elem ] ).length > 0;
};

Sizzle.contains = function( context, elem ) {
	// Set document vars if needed
	if ( ( context.ownerDocument || context ) !== document ) {
		setDocument( context );
	}
	return contains( context, elem );
};

Sizzle.attr = function( elem, name ) {
	// Set document vars if needed
	if ( ( elem.ownerDocument || elem ) !== document ) {
		setDocument( elem );
	}

	var fn = Expr.attrHandle[ name.toLowerCase() ],
		// Don't get fooled by Object.prototype properties (jQuery #13807)
		val = fn && hasOwn.call( Expr.attrHandle, name.toLowerCase() ) ?
			fn( elem, name, !documentIsHTML ) :
			undefined;

	return val !== undefined ?
		val :
		support.attributes || !documentIsHTML ?
			elem.getAttribute( name ) :
			(val = elem.getAttributeNode(name)) && val.specified ?
				val.value :
				null;
};

Sizzle.error = function( msg ) {
	throw new Error( "Syntax error, unrecognized expression: " + msg );
};

/**
 * Document sorting and removing duplicates
 * @param {ArrayLike} results
 */
Sizzle.uniqueSort = function( results ) {
	var elem,
		duplicates = [],
		j = 0,
		i = 0;

	// Unless we *know* we can detect duplicates, assume their presence
	hasDuplicate = !support.detectDuplicates;
	sortInput = !support.sortStable && results.slice( 0 );
	results.sort( sortOrder );

	if ( hasDuplicate ) {
		while ( (elem = results[i++]) ) {
			if ( elem === results[ i ] ) {
				j = duplicates.push( i );
			}
		}
		while ( j-- ) {
			results.splice( duplicates[ j ], 1 );
		}
	}

	// Clear input after sorting to release objects
	// See https://github.com/jquery/sizzle/pull/225
	sortInput = null;

	return results;
};

/**
 * Utility function for retrieving the text value of an array of DOM nodes
 * @param {Array|Element} elem
 */
getText = Sizzle.getText = function( elem ) {
	var node,
		ret = "",
		i = 0,
		nodeType = elem.nodeType;

	if ( !nodeType ) {
		// If no nodeType, this is expected to be an array
		while ( (node = elem[i++]) ) {
			// Do not traverse comment nodes
			ret += getText( node );
		}
	} else if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {
		// Use textContent for elements
		// innerText usage removed for consistency of new lines (jQuery #11153)
		if ( typeof elem.textContent === "string" ) {
			return elem.textContent;
		} else {
			// Traverse its children
			for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {
				ret += getText( elem );
			}
		}
	} else if ( nodeType === 3 || nodeType === 4 ) {
		return elem.nodeValue;
	}
	// Do not include comment or processing instruction nodes

	return ret;
};

Expr = Sizzle.selectors = {

	// Can be adjusted by the user
	cacheLength: 50,

	createPseudo: markFunction,

	match: matchExpr,

	attrHandle: {},

	find: {},

	relative: {
		">": { dir: "parentNode", first: true },
		" ": { dir: "parentNode" },
		"+": { dir: "previousSibling", first: true },
		"~": { dir: "previousSibling" }
	},

	preFilter: {
		"ATTR": function( match ) {
			match[1] = match[1].replace( runescape, funescape );

			// Move the given value to match[3] whether quoted or unquoted
			match[3] = ( match[3] || match[4] || match[5] || "" ).replace( runescape, funescape );

			if ( match[2] === "~=" ) {
				match[3] = " " + match[3] + " ";
			}

			return match.slice( 0, 4 );
		},

		"CHILD": function( match ) {
			/* matches from matchExpr["CHILD"]
				1 type (only|nth|...)
				2 what (child|of-type)
				3 argument (even|odd|\d*|\d*n([+-]\d+)?|...)
				4 xn-component of xn+y argument ([+-]?\d*n|)
				5 sign of xn-component
				6 x of xn-component
				7 sign of y-component
				8 y of y-component
			*/
			match[1] = match[1].toLowerCase();

			if ( match[1].slice( 0, 3 ) === "nth" ) {
				// nth-* requires argument
				if ( !match[3] ) {
					Sizzle.error( match[0] );
				}

				// numeric x and y parameters for Expr.filter.CHILD
				// remember that false/true cast respectively to 0/1
				match[4] = +( match[4] ? match[5] + (match[6] || 1) : 2 * ( match[3] === "even" || match[3] === "odd" ) );
				match[5] = +( ( match[7] + match[8] ) || match[3] === "odd" );

			// other types prohibit arguments
			} else if ( match[3] ) {
				Sizzle.error( match[0] );
			}

			return match;
		},

		"PSEUDO": function( match ) {
			var excess,
				unquoted = !match[6] && match[2];

			if ( matchExpr["CHILD"].test( match[0] ) ) {
				return null;
			}

			// Accept quoted arguments as-is
			if ( match[3] ) {
				match[2] = match[4] || match[5] || "";

			// Strip excess characters from unquoted arguments
			} else if ( unquoted && rpseudo.test( unquoted ) &&
				// Get excess from tokenize (recursively)
				(excess = tokenize( unquoted, true )) &&
				// advance to the next closing parenthesis
				(excess = unquoted.indexOf( ")", unquoted.length - excess ) - unquoted.length) ) {

				// excess is a negative index
				match[0] = match[0].slice( 0, excess );
				match[2] = unquoted.slice( 0, excess );
			}

			// Return only captures needed by the pseudo filter method (type and argument)
			return match.slice( 0, 3 );
		}
	},

	filter: {

		"TAG": function( nodeNameSelector ) {
			var nodeName = nodeNameSelector.replace( runescape, funescape ).toLowerCase();
			return nodeNameSelector === "*" ?
				function() { return true; } :
				function( elem ) {
					return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;
				};
		},

		"CLASS": function( className ) {
			var pattern = classCache[ className + " " ];

			return pattern ||
				(pattern = new RegExp( "(^|" + whitespace + ")" + className + "(" + whitespace + "|$)" )) &&
				classCache( className, function( elem ) {
					return pattern.test( typeof elem.className === "string" && elem.className || typeof elem.getAttribute !== "undefined" && elem.getAttribute("class") || "" );
				});
		},

		"ATTR": function( name, operator, check ) {
			return function( elem ) {
				var result = Sizzle.attr( elem, name );

				if ( result == null ) {
					return operator === "!=";
				}
				if ( !operator ) {
					return true;
				}

				result += "";

				return operator === "=" ? result === check :
					operator === "!=" ? result !== check :
					operator === "^=" ? check && result.indexOf( check ) === 0 :
					operator === "*=" ? check && result.indexOf( check ) > -1 :
					operator === "$=" ? check && result.slice( -check.length ) === check :
					operator === "~=" ? ( " " + result.replace( rwhitespace, " " ) + " " ).indexOf( check ) > -1 :
					operator === "|=" ? result === check || result.slice( 0, check.length + 1 ) === check + "-" :
					false;
			};
		},

		"CHILD": function( type, what, argument, first, last ) {
			var simple = type.slice( 0, 3 ) !== "nth",
				forward = type.slice( -4 ) !== "last",
				ofType = what === "of-type";

			return first === 1 && last === 0 ?

				// Shortcut for :nth-*(n)
				function( elem ) {
					return !!elem.parentNode;
				} :

				function( elem, context, xml ) {
					var cache, uniqueCache, outerCache, node, nodeIndex, start,
						dir = simple !== forward ? "nextSibling" : "previousSibling",
						parent = elem.parentNode,
						name = ofType && elem.nodeName.toLowerCase(),
						useCache = !xml && !ofType,
						diff = false;

					if ( parent ) {

						// :(first|last|only)-(child|of-type)
						if ( simple ) {
							while ( dir ) {
								node = elem;
								while ( (node = node[ dir ]) ) {
									if ( ofType ?
										node.nodeName.toLowerCase() === name :
										node.nodeType === 1 ) {

										return false;
									}
								}
								// Reverse direction for :only-* (if we haven't yet done so)
								start = dir = type === "only" && !start && "nextSibling";
							}
							return true;
						}

						start = [ forward ? parent.firstChild : parent.lastChild ];

						// non-xml :nth-child(...) stores cache data on `parent`
						if ( forward && useCache ) {

							// Seek `elem` from a previously-cached index

							// ...in a gzip-friendly way
							node = parent;
							outerCache = node[ expando ] || (node[ expando ] = {});

							// Support: IE <9 only
							// Defend against cloned attroperties (jQuery gh-1709)
							uniqueCache = outerCache[ node.uniqueID ] ||
								(outerCache[ node.uniqueID ] = {});

							cache = uniqueCache[ type ] || [];
							nodeIndex = cache[ 0 ] === dirruns && cache[ 1 ];
							diff = nodeIndex && cache[ 2 ];
							node = nodeIndex && parent.childNodes[ nodeIndex ];

							while ( (node = ++nodeIndex && node && node[ dir ] ||

								// Fallback to seeking `elem` from the start
								(diff = nodeIndex = 0) || start.pop()) ) {

								// When found, cache indexes on `parent` and break
								if ( node.nodeType === 1 && ++diff && node === elem ) {
									uniqueCache[ type ] = [ dirruns, nodeIndex, diff ];
									break;
								}
							}

						} else {
							// Use previously-cached element index if available
							if ( useCache ) {
								// ...in a gzip-friendly way
								node = elem;
								outerCache = node[ expando ] || (node[ expando ] = {});

								// Support: IE <9 only
								// Defend against cloned attroperties (jQuery gh-1709)
								uniqueCache = outerCache[ node.uniqueID ] ||
									(outerCache[ node.uniqueID ] = {});

								cache = uniqueCache[ type ] || [];
								nodeIndex = cache[ 0 ] === dirruns && cache[ 1 ];
								diff = nodeIndex;
							}

							// xml :nth-child(...)
							// or :nth-last-child(...) or :nth(-last)?-of-type(...)
							if ( diff === false ) {
								// Use the same loop as above to seek `elem` from the start
								while ( (node = ++nodeIndex && node && node[ dir ] ||
									(diff = nodeIndex = 0) || start.pop()) ) {

									if ( ( ofType ?
										node.nodeName.toLowerCase() === name :
										node.nodeType === 1 ) &&
										++diff ) {

										// Cache the index of each encountered element
										if ( useCache ) {
											outerCache = node[ expando ] || (node[ expando ] = {});

											// Support: IE <9 only
											// Defend against cloned attroperties (jQuery gh-1709)
											uniqueCache = outerCache[ node.uniqueID ] ||
												(outerCache[ node.uniqueID ] = {});

											uniqueCache[ type ] = [ dirruns, diff ];
										}

										if ( node === elem ) {
											break;
										}
									}
								}
							}
						}

						// Incorporate the offset, then check against cycle size
						diff -= last;
						return diff === first || ( diff % first === 0 && diff / first >= 0 );
					}
				};
		},

		"PSEUDO": function( pseudo, argument ) {
			// pseudo-class names are case-insensitive
			// http://www.w3.org/TR/selectors/#pseudo-classes
			// Prioritize by case sensitivity in case custom pseudos are added with uppercase letters
			// Remember that setFilters inherits from pseudos
			var args,
				fn = Expr.pseudos[ pseudo ] || Expr.setFilters[ pseudo.toLowerCase() ] ||
					Sizzle.error( "unsupported pseudo: " + pseudo );

			// The user may use createPseudo to indicate that
			// arguments are needed to create the filter function
			// just as Sizzle does
			if ( fn[ expando ] ) {
				return fn( argument );
			}

			// But maintain support for old signatures
			if ( fn.length > 1 ) {
				args = [ pseudo, pseudo, "", argument ];
				return Expr.setFilters.hasOwnProperty( pseudo.toLowerCase() ) ?
					markFunction(function( seed, matches ) {
						var idx,
							matched = fn( seed, argument ),
							i = matched.length;
						while ( i-- ) {
							idx = indexOf( seed, matched[i] );
							seed[ idx ] = !( matches[ idx ] = matched[i] );
						}
					}) :
					function( elem ) {
						return fn( elem, 0, args );
					};
			}

			return fn;
		}
	},

	pseudos: {
		// Potentially complex pseudos
		"not": markFunction(function( selector ) {
			// Trim the selector passed to compile
			// to avoid treating leading and trailing
			// spaces as combinators
			var input = [],
				results = [],
				matcher = compile( selector.replace( rtrim, "$1" ) );

			return matcher[ expando ] ?
				markFunction(function( seed, matches, context, xml ) {
					var elem,
						unmatched = matcher( seed, null, xml, [] ),
						i = seed.length;

					// Match elements unmatched by `matcher`
					while ( i-- ) {
						if ( (elem = unmatched[i]) ) {
							seed[i] = !(matches[i] = elem);
						}
					}
				}) :
				function( elem, context, xml ) {
					input[0] = elem;
					matcher( input, null, xml, results );
					// Don't keep the element (issue #299)
					input[0] = null;
					return !results.pop();
				};
		}),

		"has": markFunction(function( selector ) {
			return function( elem ) {
				return Sizzle( selector, elem ).length > 0;
			};
		}),

		"contains": markFunction(function( text ) {
			text = text.replace( runescape, funescape );
			return function( elem ) {
				return ( elem.textContent || elem.innerText || getText( elem ) ).indexOf( text ) > -1;
			};
		}),

		// "Whether an element is represented by a :lang() selector
		// is based solely on the element's language value
		// being equal to the identifier C,
		// or beginning with the identifier C immediately followed by "-".
		// The matching of C against the element's language value is performed case-insensitively.
		// The identifier C does not have to be a valid language name."
		// http://www.w3.org/TR/selectors/#lang-pseudo
		"lang": markFunction( function( lang ) {
			// lang value must be a valid identifier
			if ( !ridentifier.test(lang || "") ) {
				Sizzle.error( "unsupported lang: " + lang );
			}
			lang = lang.replace( runescape, funescape ).toLowerCase();
			return function( elem ) {
				var elemLang;
				do {
					if ( (elemLang = documentIsHTML ?
						elem.lang :
						elem.getAttribute("xml:lang") || elem.getAttribute("lang")) ) {

						elemLang = elemLang.toLowerCase();
						return elemLang === lang || elemLang.indexOf( lang + "-" ) === 0;
					}
				} while ( (elem = elem.parentNode) && elem.nodeType === 1 );
				return false;
			};
		}),

		// Miscellaneous
		"target": function( elem ) {
			var hash = window.location && window.location.hash;
			return hash && hash.slice( 1 ) === elem.id;
		},

		"root": function( elem ) {
			return elem === docElem;
		},

		"focus": function( elem ) {
			return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);
		},

		// Boolean properties
		"enabled": function( elem ) {
			return elem.disabled === false;
		},

		"disabled": function( elem ) {
			return elem.disabled === true;
		},

		"checked": function( elem ) {
			// In CSS3, :checked should return both checked and selected elements
			// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
			var nodeName = elem.nodeName.toLowerCase();
			return (nodeName === "input" && !!elem.checked) || (nodeName === "option" && !!elem.selected);
		},

		"selected": function( elem ) {
			// Accessing this property makes selected-by-default
			// options in Safari work properly
			if ( elem.parentNode ) {
				elem.parentNode.selectedIndex;
			}

			return elem.selected === true;
		},

		// Contents
		"empty": function( elem ) {
			// http://www.w3.org/TR/selectors/#empty-pseudo
			// :empty is negated by element (1) or content nodes (text: 3; cdata: 4; entity ref: 5),
			//   but not by others (comment: 8; processing instruction: 7; etc.)
			// nodeType < 6 works because attributes (2) do not appear as children
			for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {
				if ( elem.nodeType < 6 ) {
					return false;
				}
			}
			return true;
		},

		"parent": function( elem ) {
			return !Expr.pseudos["empty"]( elem );
		},

		// Element/input types
		"header": function( elem ) {
			return rheader.test( elem.nodeName );
		},

		"input": function( elem ) {
			return rinputs.test( elem.nodeName );
		},

		"button": function( elem ) {
			var name = elem.nodeName.toLowerCase();
			return name === "input" && elem.type === "button" || name === "button";
		},

		"text": function( elem ) {
			var attr;
			return elem.nodeName.toLowerCase() === "input" &&
				elem.type === "text" &&

				// Support: IE<8
				// New HTML5 attribute values (e.g., "search") appear with elem.type === "text"
				( (attr = elem.getAttribute("type")) == null || attr.toLowerCase() === "text" );
		},

		// Position-in-collection
		"first": createPositionalPseudo(function() {
			return [ 0 ];
		}),

		"last": createPositionalPseudo(function( matchIndexes, length ) {
			return [ length - 1 ];
		}),

		"eq": createPositionalPseudo(function( matchIndexes, length, argument ) {
			return [ argument < 0 ? argument + length : argument ];
		}),

		"even": createPositionalPseudo(function( matchIndexes, length ) {
			var i = 0;
			for ( ; i < length; i += 2 ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"odd": createPositionalPseudo(function( matchIndexes, length ) {
			var i = 1;
			for ( ; i < length; i += 2 ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"lt": createPositionalPseudo(function( matchIndexes, length, argument ) {
			var i = argument < 0 ? argument + length : argument;
			for ( ; --i >= 0; ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"gt": createPositionalPseudo(function( matchIndexes, length, argument ) {
			var i = argument < 0 ? argument + length : argument;
			for ( ; ++i < length; ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		})
	}
};

Expr.pseudos["nth"] = Expr.pseudos["eq"];

// Add button/input type pseudos
for ( i in { radio: true, checkbox: true, file: true, password: true, image: true } ) {
	Expr.pseudos[ i ] = createInputPseudo( i );
}
for ( i in { submit: true, reset: true } ) {
	Expr.pseudos[ i ] = createButtonPseudo( i );
}

// Easy API for creating new setFilters
function setFilters() {}
setFilters.prototype = Expr.filters = Expr.pseudos;
Expr.setFilters = new setFilters();

tokenize = Sizzle.tokenize = function( selector, parseOnly ) {
	var matched, match, tokens, type,
		soFar, groups, preFilters,
		cached = tokenCache[ selector + " " ];

	if ( cached ) {
		return parseOnly ? 0 : cached.slice( 0 );
	}

	soFar = selector;
	groups = [];
	preFilters = Expr.preFilter;

	while ( soFar ) {

		// Comma and first run
		if ( !matched || (match = rcomma.exec( soFar )) ) {
			if ( match ) {
				// Don't consume trailing commas as valid
				soFar = soFar.slice( match[0].length ) || soFar;
			}
			groups.push( (tokens = []) );
		}

		matched = false;

		// Combinators
		if ( (match = rcombinators.exec( soFar )) ) {
			matched = match.shift();
			tokens.push({
				value: matched,
				// Cast descendant combinators to space
				type: match[0].replace( rtrim, " " )
			});
			soFar = soFar.slice( matched.length );
		}

		// Filters
		for ( type in Expr.filter ) {
			if ( (match = matchExpr[ type ].exec( soFar )) && (!preFilters[ type ] ||
				(match = preFilters[ type ]( match ))) ) {
				matched = match.shift();
				tokens.push({
					value: matched,
					type: type,
					matches: match
				});
				soFar = soFar.slice( matched.length );
			}
		}

		if ( !matched ) {
			break;
		}
	}

	// Return the length of the invalid excess
	// if we're just parsing
	// Otherwise, throw an error or return tokens
	return parseOnly ?
		soFar.length :
		soFar ?
			Sizzle.error( selector ) :
			// Cache the tokens
			tokenCache( selector, groups ).slice( 0 );
};

function toSelector( tokens ) {
	var i = 0,
		len = tokens.length,
		selector = "";
	for ( ; i < len; i++ ) {
		selector += tokens[i].value;
	}
	return selector;
}

function addCombinator( matcher, combinator, base ) {
	var dir = combinator.dir,
		checkNonElements = base && dir === "parentNode",
		doneName = done++;

	return combinator.first ?
		// Check against closest ancestor/preceding element
		function( elem, context, xml ) {
			while ( (elem = elem[ dir ]) ) {
				if ( elem.nodeType === 1 || checkNonElements ) {
					return matcher( elem, context, xml );
				}
			}
		} :

		// Check against all ancestor/preceding elements
		function( elem, context, xml ) {
			var oldCache, uniqueCache, outerCache,
				newCache = [ dirruns, doneName ];

			// We can't set arbitrary data on XML nodes, so they don't benefit from combinator caching
			if ( xml ) {
				while ( (elem = elem[ dir ]) ) {
					if ( elem.nodeType === 1 || checkNonElements ) {
						if ( matcher( elem, context, xml ) ) {
							return true;
						}
					}
				}
			} else {
				while ( (elem = elem[ dir ]) ) {
					if ( elem.nodeType === 1 || checkNonElements ) {
						outerCache = elem[ expando ] || (elem[ expando ] = {});

						// Support: IE <9 only
						// Defend against cloned attroperties (jQuery gh-1709)
						uniqueCache = outerCache[ elem.uniqueID ] || (outerCache[ elem.uniqueID ] = {});

						if ( (oldCache = uniqueCache[ dir ]) &&
							oldCache[ 0 ] === dirruns && oldCache[ 1 ] === doneName ) {

							// Assign to newCache so results back-propagate to previous elements
							return (newCache[ 2 ] = oldCache[ 2 ]);
						} else {
							// Reuse newcache so results back-propagate to previous elements
							uniqueCache[ dir ] = newCache;

							// A match means we're done; a fail means we have to keep checking
							if ( (newCache[ 2 ] = matcher( elem, context, xml )) ) {
								return true;
							}
						}
					}
				}
			}
		};
}

function elementMatcher( matchers ) {
	return matchers.length > 1 ?
		function( elem, context, xml ) {
			var i = matchers.length;
			while ( i-- ) {
				if ( !matchers[i]( elem, context, xml ) ) {
					return false;
				}
			}
			return true;
		} :
		matchers[0];
}

function multipleContexts( selector, contexts, results ) {
	var i = 0,
		len = contexts.length;
	for ( ; i < len; i++ ) {
		Sizzle( selector, contexts[i], results );
	}
	return results;
}

function condense( unmatched, map, filter, context, xml ) {
	var elem,
		newUnmatched = [],
		i = 0,
		len = unmatched.length,
		mapped = map != null;

	for ( ; i < len; i++ ) {
		if ( (elem = unmatched[i]) ) {
			if ( !filter || filter( elem, context, xml ) ) {
				newUnmatched.push( elem );
				if ( mapped ) {
					map.push( i );
				}
			}
		}
	}

	return newUnmatched;
}

function setMatcher( preFilter, selector, matcher, postFilter, postFinder, postSelector ) {
	if ( postFilter && !postFilter[ expando ] ) {
		postFilter = setMatcher( postFilter );
	}
	if ( postFinder && !postFinder[ expando ] ) {
		postFinder = setMatcher( postFinder, postSelector );
	}
	return markFunction(function( seed, results, context, xml ) {
		var temp, i, elem,
			preMap = [],
			postMap = [],
			preexisting = results.length,

			// Get initial elements from seed or context
			elems = seed || multipleContexts( selector || "*", context.nodeType ? [ context ] : context, [] ),

			// Prefilter to get matcher input, preserving a map for seed-results synchronization
			matcherIn = preFilter && ( seed || !selector ) ?
				condense( elems, preMap, preFilter, context, xml ) :
				elems,

			matcherOut = matcher ?
				// If we have a postFinder, or filtered seed, or non-seed postFilter or preexisting results,
				postFinder || ( seed ? preFilter : preexisting || postFilter ) ?

					// ...intermediate processing is necessary
					[] :

					// ...otherwise use results directly
					results :
				matcherIn;

		// Find primary matches
		if ( matcher ) {
			matcher( matcherIn, matcherOut, context, xml );
		}

		// Apply postFilter
		if ( postFilter ) {
			temp = condense( matcherOut, postMap );
			postFilter( temp, [], context, xml );

			// Un-match failing elements by moving them back to matcherIn
			i = temp.length;
			while ( i-- ) {
				if ( (elem = temp[i]) ) {
					matcherOut[ postMap[i] ] = !(matcherIn[ postMap[i] ] = elem);
				}
			}
		}

		if ( seed ) {
			if ( postFinder || preFilter ) {
				if ( postFinder ) {
					// Get the final matcherOut by condensing this intermediate into postFinder contexts
					temp = [];
					i = matcherOut.length;
					while ( i-- ) {
						if ( (elem = matcherOut[i]) ) {
							// Restore matcherIn since elem is not yet a final match
							temp.push( (matcherIn[i] = elem) );
						}
					}
					postFinder( null, (matcherOut = []), temp, xml );
				}

				// Move matched elements from seed to results to keep them synchronized
				i = matcherOut.length;
				while ( i-- ) {
					if ( (elem = matcherOut[i]) &&
						(temp = postFinder ? indexOf( seed, elem ) : preMap[i]) > -1 ) {

						seed[temp] = !(results[temp] = elem);
					}
				}
			}

		// Add elements to results, through postFinder if defined
		} else {
			matcherOut = condense(
				matcherOut === results ?
					matcherOut.splice( preexisting, matcherOut.length ) :
					matcherOut
			);
			if ( postFinder ) {
				postFinder( null, results, matcherOut, xml );
			} else {
				push.apply( results, matcherOut );
			}
		}
	});
}

function matcherFromTokens( tokens ) {
	var checkContext, matcher, j,
		len = tokens.length,
		leadingRelative = Expr.relative[ tokens[0].type ],
		implicitRelative = leadingRelative || Expr.relative[" "],
		i = leadingRelative ? 1 : 0,

		// The foundational matcher ensures that elements are reachable from top-level context(s)
		matchContext = addCombinator( function( elem ) {
			return elem === checkContext;
		}, implicitRelative, true ),
		matchAnyContext = addCombinator( function( elem ) {
			return indexOf( checkContext, elem ) > -1;
		}, implicitRelative, true ),
		matchers = [ function( elem, context, xml ) {
			var ret = ( !leadingRelative && ( xml || context !== outermostContext ) ) || (
				(checkContext = context).nodeType ?
					matchContext( elem, context, xml ) :
					matchAnyContext( elem, context, xml ) );
			// Avoid hanging onto element (issue #299)
			checkContext = null;
			return ret;
		} ];

	for ( ; i < len; i++ ) {
		if ( (matcher = Expr.relative[ tokens[i].type ]) ) {
			matchers = [ addCombinator(elementMatcher( matchers ), matcher) ];
		} else {
			matcher = Expr.filter[ tokens[i].type ].apply( null, tokens[i].matches );

			// Return special upon seeing a positional matcher
			if ( matcher[ expando ] ) {
				// Find the next relative operator (if any) for proper handling
				j = ++i;
				for ( ; j < len; j++ ) {
					if ( Expr.relative[ tokens[j].type ] ) {
						break;
					}
				}
				return setMatcher(
					i > 1 && elementMatcher( matchers ),
					i > 1 && toSelector(
						// If the preceding token was a descendant combinator, insert an implicit any-element `*`
						tokens.slice( 0, i - 1 ).concat({ value: tokens[ i - 2 ].type === " " ? "*" : "" })
					).replace( rtrim, "$1" ),
					matcher,
					i < j && matcherFromTokens( tokens.slice( i, j ) ),
					j < len && matcherFromTokens( (tokens = tokens.slice( j )) ),
					j < len && toSelector( tokens )
				);
			}
			matchers.push( matcher );
		}
	}

	return elementMatcher( matchers );
}

function matcherFromGroupMatchers( elementMatchers, setMatchers ) {
	var bySet = setMatchers.length > 0,
		byElement = elementMatchers.length > 0,
		superMatcher = function( seed, context, xml, results, outermost ) {
			var elem, j, matcher,
				matchedCount = 0,
				i = "0",
				unmatched = seed && [],
				setMatched = [],
				contextBackup = outermostContext,
				// We must always have either seed elements or outermost context
				elems = seed || byElement && Expr.find["TAG"]( "*", outermost ),
				// Use integer dirruns iff this is the outermost matcher
				dirrunsUnique = (dirruns += contextBackup == null ? 1 : Math.random() || 0.1),
				len = elems.length;

			if ( outermost ) {
				outermostContext = context === document || context || outermost;
			}

			// Add elements passing elementMatchers directly to results
			// Support: IE<9, Safari
			// Tolerate NodeList properties (IE: "length"; Safari: <number>) matching elements by id
			for ( ; i !== len && (elem = elems[i]) != null; i++ ) {
				if ( byElement && elem ) {
					j = 0;
					if ( !context && elem.ownerDocument !== document ) {
						setDocument( elem );
						xml = !documentIsHTML;
					}
					while ( (matcher = elementMatchers[j++]) ) {
						if ( matcher( elem, context || document, xml) ) {
							results.push( elem );
							break;
						}
					}
					if ( outermost ) {
						dirruns = dirrunsUnique;
					}
				}

				// Track unmatched elements for set filters
				if ( bySet ) {
					// They will have gone through all possible matchers
					if ( (elem = !matcher && elem) ) {
						matchedCount--;
					}

					// Lengthen the array for every element, matched or not
					if ( seed ) {
						unmatched.push( elem );
					}
				}
			}

			// `i` is now the count of elements visited above, and adding it to `matchedCount`
			// makes the latter nonnegative.
			matchedCount += i;

			// Apply set filters to unmatched elements
			// NOTE: This can be skipped if there are no unmatched elements (i.e., `matchedCount`
			// equals `i`), unless we didn't visit _any_ elements in the above loop because we have
			// no element matchers and no seed.
			// Incrementing an initially-string "0" `i` allows `i` to remain a string only in that
			// case, which will result in a "00" `matchedCount` that differs from `i` but is also
			// numerically zero.
			if ( bySet && i !== matchedCount ) {
				j = 0;
				while ( (matcher = setMatchers[j++]) ) {
					matcher( unmatched, setMatched, context, xml );
				}

				if ( seed ) {
					// Reintegrate element matches to eliminate the need for sorting
					if ( matchedCount > 0 ) {
						while ( i-- ) {
							if ( !(unmatched[i] || setMatched[i]) ) {
								setMatched[i] = pop.call( results );
							}
						}
					}

					// Discard index placeholder values to get only actual matches
					setMatched = condense( setMatched );
				}

				// Add matches to results
				push.apply( results, setMatched );

				// Seedless set matches succeeding multiple successful matchers stipulate sorting
				if ( outermost && !seed && setMatched.length > 0 &&
					( matchedCount + setMatchers.length ) > 1 ) {

					Sizzle.uniqueSort( results );
				}
			}

			// Override manipulation of globals by nested matchers
			if ( outermost ) {
				dirruns = dirrunsUnique;
				outermostContext = contextBackup;
			}

			return unmatched;
		};

	return bySet ?
		markFunction( superMatcher ) :
		superMatcher;
}

compile = Sizzle.compile = function( selector, match /* Internal Use Only */ ) {
	var i,
		setMatchers = [],
		elementMatchers = [],
		cached = compilerCache[ selector + " " ];

	if ( !cached ) {
		// Generate a function of recursive functions that can be used to check each element
		if ( !match ) {
			match = tokenize( selector );
		}
		i = match.length;
		while ( i-- ) {
			cached = matcherFromTokens( match[i] );
			if ( cached[ expando ] ) {
				setMatchers.push( cached );
			} else {
				elementMatchers.push( cached );
			}
		}

		// Cache the compiled function
		cached = compilerCache( selector, matcherFromGroupMatchers( elementMatchers, setMatchers ) );

		// Save selector and tokenization
		cached.selector = selector;
	}
	return cached;
};

/**
 * A low-level selection function that works with Sizzle's compiled
 *  selector functions
 * @param {String|Function} selector A selector or a pre-compiled
 *  selector function built with Sizzle.compile
 * @param {Element} context
 * @param {Array} [results]
 * @param {Array} [seed] A set of elements to match against
 */
select = Sizzle.select = function( selector, context, results, seed ) {
	var i, tokens, token, type, find,
		compiled = typeof selector === "function" && selector,
		match = !seed && tokenize( (selector = compiled.selector || selector) );

	results = results || [];

	// Try to minimize operations if there is only one selector in the list and no seed
	// (the latter of which guarantees us context)
	if ( match.length === 1 ) {

		// Reduce context if the leading compound selector is an ID
		tokens = match[0] = match[0].slice( 0 );
		if ( tokens.length > 2 && (token = tokens[0]).type === "ID" &&
				support.getById && context.nodeType === 9 && documentIsHTML &&
				Expr.relative[ tokens[1].type ] ) {

			context = ( Expr.find["ID"]( token.matches[0].replace(runescape, funescape), context ) || [] )[0];
			if ( !context ) {
				return results;

			// Precompiled matchers will still verify ancestry, so step up a level
			} else if ( compiled ) {
				context = context.parentNode;
			}

			selector = selector.slice( tokens.shift().value.length );
		}

		// Fetch a seed set for right-to-left matching
		i = matchExpr["needsContext"].test( selector ) ? 0 : tokens.length;
		while ( i-- ) {
			token = tokens[i];

			// Abort if we hit a combinator
			if ( Expr.relative[ (type = token.type) ] ) {
				break;
			}
			if ( (find = Expr.find[ type ]) ) {
				// Search, expanding context for leading sibling combinators
				if ( (seed = find(
					token.matches[0].replace( runescape, funescape ),
					rsibling.test( tokens[0].type ) && testContext( context.parentNode ) || context
				)) ) {

					// If seed is empty or no tokens remain, we can return early
					tokens.splice( i, 1 );
					selector = seed.length && toSelector( tokens );
					if ( !selector ) {
						push.apply( results, seed );
						return results;
					}

					break;
				}
			}
		}
	}

	// Compile and execute a filtering function if one is not provided
	// Provide `match` to avoid retokenization if we modified the selector above
	( compiled || compile( selector, match ) )(
		seed,
		context,
		!documentIsHTML,
		results,
		!context || rsibling.test( selector ) && testContext( context.parentNode ) || context
	);
	return results;
};

// One-time assignments

// Sort stability
support.sortStable = expando.split("").sort( sortOrder ).join("") === expando;

// Support: Chrome 14-35+
// Always assume duplicates if they aren't passed to the comparison function
support.detectDuplicates = !!hasDuplicate;

// Initialize against the default document
setDocument();

// Support: Webkit<537.32 - Safari 6.0.3/Chrome 25 (fixed in Chrome 27)
// Detached nodes confoundingly follow *each other*
support.sortDetached = assert(function( div1 ) {
	// Should return 1, but returns 4 (following)
	return div1.compareDocumentPosition( document.createElement("div") ) & 1;
});

// Support: IE<8
// Prevent attribute/property "interpolation"
// http://msdn.microsoft.com/en-us/library/ms536429%28VS.85%29.aspx
if ( !assert(function( div ) {
	div.innerHTML = "<a href='#'></a>";
	return div.firstChild.getAttribute("href") === "#" ;
}) ) {
	addHandle( "type|href|height|width", function( elem, name, isXML ) {
		if ( !isXML ) {
			return elem.getAttribute( name, name.toLowerCase() === "type" ? 1 : 2 );
		}
	});
}

// Support: IE<9
// Use defaultValue in place of getAttribute("value")
if ( !support.attributes || !assert(function( div ) {
	div.innerHTML = "<input/>";
	div.firstChild.setAttribute( "value", "" );
	return div.firstChild.getAttribute( "value" ) === "";
}) ) {
	addHandle( "value", function( elem, name, isXML ) {
		if ( !isXML && elem.nodeName.toLowerCase() === "input" ) {
			return elem.defaultValue;
		}
	});
}

// Support: IE<9
// Use getAttributeNode to fetch booleans when getAttribute lies
if ( !assert(function( div ) {
	return div.getAttribute("disabled") == null;
}) ) {
	addHandle( booleans, function( elem, name, isXML ) {
		var val;
		if ( !isXML ) {
			return elem[ name ] === true ? name.toLowerCase() :
					(val = elem.getAttributeNode( name )) && val.specified ?
					val.value :
				null;
		}
	});
}

return Sizzle;

})( window );



jQuery.find = Sizzle;
jQuery.expr = Sizzle.selectors;
jQuery.expr[ ":" ] = jQuery.expr.pseudos;
jQuery.uniqueSort = jQuery.unique = Sizzle.uniqueSort;
jQuery.text = Sizzle.getText;
jQuery.isXMLDoc = Sizzle.isXML;
jQuery.contains = Sizzle.contains;



var dir = function( elem, dir, until ) {
	var matched = [],
		truncate = until !== undefined;

	while ( ( elem = elem[ dir ] ) && elem.nodeType !== 9 ) {
		if ( elem.nodeType === 1 ) {
			if ( truncate && jQuery( elem ).is( until ) ) {
				break;
			}
			matched.push( elem );
		}
	}
	return matched;
};


var siblings = function( n, elem ) {
	var matched = [];

	for ( ; n; n = n.nextSibling ) {
		if ( n.nodeType === 1 && n !== elem ) {
			matched.push( n );
		}
	}

	return matched;
};


var rneedsContext = jQuery.expr.match.needsContext;

var rsingleTag = ( /^<([\w-]+)\s*\/?>(?:<\/\1>|)$/ );



var risSimple = /^.[^:#\[\.,]*$/;

// Implement the identical functionality for filter and not
function winnow( elements, qualifier, not ) {
	if ( jQuery.isFunction( qualifier ) ) {
		return jQuery.grep( elements, function( elem, i ) {
			/* jshint -W018 */
			return !!qualifier.call( elem, i, elem ) !== not;
		} );

	}

	if ( qualifier.nodeType ) {
		return jQuery.grep( elements, function( elem ) {
			return ( elem === qualifier ) !== not;
		} );

	}

	if ( typeof qualifier === "string" ) {
		if ( risSimple.test( qualifier ) ) {
			return jQuery.filter( qualifier, elements, not );
		}

		qualifier = jQuery.filter( qualifier, elements );
	}

	return jQuery.grep( elements, function( elem ) {
		return ( jQuery.inArray( elem, qualifier ) > -1 ) !== not;
	} );
}

jQuery.filter = function( expr, elems, not ) {
	var elem = elems[ 0 ];

	if ( not ) {
		expr = ":not(" + expr + ")";
	}

	return elems.length === 1 && elem.nodeType === 1 ?
		jQuery.find.matchesSelector( elem, expr ) ? [ elem ] : [] :
		jQuery.find.matches( expr, jQuery.grep( elems, function( elem ) {
			return elem.nodeType === 1;
		} ) );
};

jQuery.fn.extend( {
	find: function( selector ) {
		var i,
			ret = [],
			self = this,
			len = self.length;

		if ( typeof selector !== "string" ) {
			return this.pushStack( jQuery( selector ).filter( function() {
				for ( i = 0; i < len; i++ ) {
					if ( jQuery.contains( self[ i ], this ) ) {
						return true;
					}
				}
			} ) );
		}

		for ( i = 0; i < len; i++ ) {
			jQuery.find( selector, self[ i ], ret );
		}

		// Needed because $( selector, context ) becomes $( context ).find( selector )
		ret = this.pushStack( len > 1 ? jQuery.unique( ret ) : ret );
		ret.selector = this.selector ? this.selector + " " + selector : selector;
		return ret;
	},
	filter: function( selector ) {
		return this.pushStack( winnow( this, selector || [], false ) );
	},
	not: function( selector ) {
		return this.pushStack( winnow( this, selector || [], true ) );
	},
	is: function( selector ) {
		return !!winnow(
			this,

			// If this is a positional/relative selector, check membership in the returned set
			// so $("p:first").is("p:last") won't return true for a doc with two "p".
			typeof selector === "string" && rneedsContext.test( selector ) ?
				jQuery( selector ) :
				selector || [],
			false
		).length;
	}
} );


// Initialize a jQuery object


// A central reference to the root jQuery(document)
var rootjQuery,

	// A simple way to check for HTML strings
	// Prioritize #id over <tag> to avoid XSS via location.hash (#9521)
	// Strict HTML recognition (#11290: must start with <)
	rquickExpr = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,

	init = jQuery.fn.init = function( selector, context, root ) {
		var match, elem;

		// HANDLE: $(""), $(null), $(undefined), $(false)
		if ( !selector ) {
			return this;
		}

		// init accepts an alternate rootjQuery
		// so migrate can support jQuery.sub (gh-2101)
		root = root || rootjQuery;

		// Handle HTML strings
		if ( typeof selector === "string" ) {
			if ( selector.charAt( 0 ) === "<" &&
				selector.charAt( selector.length - 1 ) === ">" &&
				selector.length >= 3 ) {

				// Assume that strings that start and end with <> are HTML and skip the regex check
				match = [ null, selector, null ];

			} else {
				match = rquickExpr.exec( selector );
			}

			// Match html or make sure no context is specified for #id
			if ( match && ( match[ 1 ] || !context ) ) {

				// HANDLE: $(html) -> $(array)
				if ( match[ 1 ] ) {
					context = context instanceof jQuery ? context[ 0 ] : context;

					// scripts is true for back-compat
					// Intentionally let the error be thrown if parseHTML is not present
					jQuery.merge( this, jQuery.parseHTML(
						match[ 1 ],
						context && context.nodeType ? context.ownerDocument || context : document,
						true
					) );

					// HANDLE: $(html, props)
					if ( rsingleTag.test( match[ 1 ] ) && jQuery.isPlainObject( context ) ) {
						for ( match in context ) {

							// Properties of context are called as methods if possible
							if ( jQuery.isFunction( this[ match ] ) ) {
								this[ match ]( context[ match ] );

							// ...and otherwise set as attributes
							} else {
								this.attr( match, context[ match ] );
							}
						}
					}

					return this;

				// HANDLE: $(#id)
				} else {
					elem = document.getElementById( match[ 2 ] );

					// Check parentNode to catch when Blackberry 4.6 returns
					// nodes that are no longer in the document #6963
					if ( elem && elem.parentNode ) {

						// Handle the case where IE and Opera return items
						// by name instead of ID
						if ( elem.id !== match[ 2 ] ) {
							return rootjQuery.find( selector );
						}

						// Otherwise, we inject the element directly into the jQuery object
						this.length = 1;
						this[ 0 ] = elem;
					}

					this.context = document;
					this.selector = selector;
					return this;
				}

			// HANDLE: $(expr, $(...))
			} else if ( !context || context.jquery ) {
				return ( context || root ).find( selector );

			// HANDLE: $(expr, context)
			// (which is just equivalent to: $(context).find(expr)
			} else {
				return this.constructor( context ).find( selector );
			}

		// HANDLE: $(DOMElement)
		} else if ( selector.nodeType ) {
			this.context = this[ 0 ] = selector;
			this.length = 1;
			return this;

		// HANDLE: $(function)
		// Shortcut for document ready
		} else if ( jQuery.isFunction( selector ) ) {
			return typeof root.ready !== "undefined" ?
				root.ready( selector ) :

				// Execute immediately if ready is not present
				selector( jQuery );
		}

		if ( selector.selector !== undefined ) {
			this.selector = selector.selector;
			this.context = selector.context;
		}

		return jQuery.makeArray( selector, this );
	};

// Give the init function the jQuery prototype for later instantiation
init.prototype = jQuery.fn;

// Initialize central reference
rootjQuery = jQuery( document );


var rparentsprev = /^(?:parents|prev(?:Until|All))/,

	// methods guaranteed to produce a unique set when starting from a unique set
	guaranteedUnique = {
		children: true,
		contents: true,
		next: true,
		prev: true
	};

jQuery.fn.extend( {
	has: function( target ) {
		var i,
			targets = jQuery( target, this ),
			len = targets.length;

		return this.filter( function() {
			for ( i = 0; i < len; i++ ) {
				if ( jQuery.contains( this, targets[ i ] ) ) {
					return true;
				}
			}
		} );
	},

	closest: function( selectors, context ) {
		var cur,
			i = 0,
			l = this.length,
			matched = [],
			pos = rneedsContext.test( selectors ) || typeof selectors !== "string" ?
				jQuery( selectors, context || this.context ) :
				0;

		for ( ; i < l; i++ ) {
			for ( cur = this[ i ]; cur && cur !== context; cur = cur.parentNode ) {

				// Always skip document fragments
				if ( cur.nodeType < 11 && ( pos ?
					pos.index( cur ) > -1 :

					// Don't pass non-elements to Sizzle
					cur.nodeType === 1 &&
						jQuery.find.matchesSelector( cur, selectors ) ) ) {

					matched.push( cur );
					break;
				}
			}
		}

		return this.pushStack( matched.length > 1 ? jQuery.uniqueSort( matched ) : matched );
	},

	// Determine the position of an element within
	// the matched set of elements
	index: function( elem ) {

		// No argument, return index in parent
		if ( !elem ) {
			return ( this[ 0 ] && this[ 0 ].parentNode ) ? this.first().prevAll().length : -1;
		}

		// index in selector
		if ( typeof elem === "string" ) {
			return jQuery.inArray( this[ 0 ], jQuery( elem ) );
		}

		// Locate the position of the desired element
		return jQuery.inArray(

			// If it receives a jQuery object, the first element is used
			elem.jquery ? elem[ 0 ] : elem, this );
	},

	add: function( selector, context ) {
		return this.pushStack(
			jQuery.uniqueSort(
				jQuery.merge( this.get(), jQuery( selector, context ) )
			)
		);
	},

	addBack: function( selector ) {
		return this.add( selector == null ?
			this.prevObject : this.prevObject.filter( selector )
		);
	}
} );

function sibling( cur, dir ) {
	do {
		cur = cur[ dir ];
	} while ( cur && cur.nodeType !== 1 );

	return cur;
}

jQuery.each( {
	parent: function( elem ) {
		var parent = elem.parentNode;
		return parent && parent.nodeType !== 11 ? parent : null;
	},
	parents: function( elem ) {
		return dir( elem, "parentNode" );
	},
	parentsUntil: function( elem, i, until ) {
		return dir( elem, "parentNode", until );
	},
	next: function( elem ) {
		return sibling( elem, "nextSibling" );
	},
	prev: function( elem ) {
		return sibling( elem, "previousSibling" );
	},
	nextAll: function( elem ) {
		return dir( elem, "nextSibling" );
	},
	prevAll: function( elem ) {
		return dir( elem, "previousSibling" );
	},
	nextUntil: function( elem, i, until ) {
		return dir( elem, "nextSibling", until );
	},
	prevUntil: function( elem, i, until ) {
		return dir( elem, "previousSibling", until );
	},
	siblings: function( elem ) {
		return siblings( ( elem.parentNode || {} ).firstChild, elem );
	},
	children: function( elem ) {
		return siblings( elem.firstChild );
	},
	contents: function( elem ) {
		return jQuery.nodeName( elem, "iframe" ) ?
			elem.contentDocument || elem.contentWindow.document :
			jQuery.merge( [], elem.childNodes );
	}
}, function( name, fn ) {
	jQuery.fn[ name ] = function( until, selector ) {
		var ret = jQuery.map( this, fn, until );

		if ( name.slice( -5 ) !== "Until" ) {
			selector = until;
		}

		if ( selector && typeof selector === "string" ) {
			ret = jQuery.filter( selector, ret );
		}

		if ( this.length > 1 ) {

			// Remove duplicates
			if ( !guaranteedUnique[ name ] ) {
				ret = jQuery.uniqueSort( ret );
			}

			// Reverse order for parents* and prev-derivatives
			if ( rparentsprev.test( name ) ) {
				ret = ret.reverse();
			}
		}

		return this.pushStack( ret );
	};
} );
var rnotwhite = ( /\S+/g );



// Convert String-formatted options into Object-formatted ones
function createOptions( options ) {
	var object = {};
	jQuery.each( options.match( rnotwhite ) || [], function( _, flag ) {
		object[ flag ] = true;
	} );
	return object;
}

/*
 * Create a callback list using the following parameters:
 *
 *	options: an optional list of space-separated options that will change how
 *			the callback list behaves or a more traditional option object
 *
 * By default a callback list will act like an event callback list and can be
 * "fired" multiple times.
 *
 * Possible options:
 *
 *	once:			will ensure the callback list can only be fired once (like a Deferred)
 *
 *	memory:			will keep track of previous values and will call any callback added
 *					after the list has been fired right away with the latest "memorized"
 *					values (like a Deferred)
 *
 *	unique:			will ensure a callback can only be added once (no duplicate in the list)
 *
 *	stopOnFalse:	interrupt callings when a callback returns false
 *
 */
jQuery.Callbacks = function( options ) {

	// Convert options from String-formatted to Object-formatted if needed
	// (we check in cache first)
	options = typeof options === "string" ?
		createOptions( options ) :
		jQuery.extend( {}, options );

	var // Flag to know if list is currently firing
		firing,

		// Last fire value for non-forgettable lists
		memory,

		// Flag to know if list was already fired
		fired,

		// Flag to prevent firing
		locked,

		// Actual callback list
		list = [],

		// Queue of execution data for repeatable lists
		queue = [],

		// Index of currently firing callback (modified by add/remove as needed)
		firingIndex = -1,

		// Fire callbacks
		fire = function() {

			// Enforce single-firing
			locked = options.once;

			// Execute callbacks for all pending executions,
			// respecting firingIndex overrides and runtime changes
			fired = firing = true;
			for ( ; queue.length; firingIndex = -1 ) {
				memory = queue.shift();
				while ( ++firingIndex < list.length ) {

					// Run callback and check for early termination
					if ( list[ firingIndex ].apply( memory[ 0 ], memory[ 1 ] ) === false &&
						options.stopOnFalse ) {

						// Jump to end and forget the data so .add doesn't re-fire
						firingIndex = list.length;
						memory = false;
					}
				}
			}

			// Forget the data if we're done with it
			if ( !options.memory ) {
				memory = false;
			}

			firing = false;

			// Clean up if we're done firing for good
			if ( locked ) {

				// Keep an empty list if we have data for future add calls
				if ( memory ) {
					list = [];

				// Otherwise, this object is spent
				} else {
					list = "";
				}
			}
		},

		// Actual Callbacks object
		self = {

			// Add a callback or a collection of callbacks to the list
			add: function() {
				if ( list ) {

					// If we have memory from a past run, we should fire after adding
					if ( memory && !firing ) {
						firingIndex = list.length - 1;
						queue.push( memory );
					}

					( function add( args ) {
						jQuery.each( args, function( _, arg ) {
							if ( jQuery.isFunction( arg ) ) {
								if ( !options.unique || !self.has( arg ) ) {
									list.push( arg );
								}
							} else if ( arg && arg.length && jQuery.type( arg ) !== "string" ) {

								// Inspect recursively
								add( arg );
							}
						} );
					} )( arguments );

					if ( memory && !firing ) {
						fire();
					}
				}
				return this;
			},

			// Remove a callback from the list
			remove: function() {
				jQuery.each( arguments, function( _, arg ) {
					var index;
					while ( ( index = jQuery.inArray( arg, list, index ) ) > -1 ) {
						list.splice( index, 1 );

						// Handle firing indexes
						if ( index <= firingIndex ) {
							firingIndex--;
						}
					}
				} );
				return this;
			},

			// Check if a given callback is in the list.
			// If no argument is given, return whether or not list has callbacks attached.
			has: function( fn ) {
				return fn ?
					jQuery.inArray( fn, list ) > -1 :
					list.length > 0;
			},

			// Remove all callbacks from the list
			empty: function() {
				if ( list ) {
					list = [];
				}
				return this;
			},

			// Disable .fire and .add
			// Abort any current/pending executions
			// Clear all callbacks and values
			disable: function() {
				locked = queue = [];
				list = memory = "";
				return this;
			},
			disabled: function() {
				return !list;
			},

			// Disable .fire
			// Also disable .add unless we have memory (since it would have no effect)
			// Abort any pending executions
			lock: function() {
				locked = true;
				if ( !memory ) {
					self.disable();
				}
				return this;
			},
			locked: function() {
				return !!locked;
			},

			// Call all callbacks with the given context and arguments
			fireWith: function( context, args ) {
				if ( !locked ) {
					args = args || [];
					args = [ context, args.slice ? args.slice() : args ];
					queue.push( args );
					if ( !firing ) {
						fire();
					}
				}
				return this;
			},

			// Call all the callbacks with the given arguments
			fire: function() {
				self.fireWith( this, arguments );
				return this;
			},

			// To know if the callbacks have already been called at least once
			fired: function() {
				return !!fired;
			}
		};

	return self;
};


jQuery.extend( {

	Deferred: function( func ) {
		var tuples = [

				// action, add listener, listener list, final state
				[ "resolve", "done", jQuery.Callbacks( "once memory" ), "resolved" ],
				[ "reject", "fail", jQuery.Callbacks( "once memory" ), "rejected" ],
				[ "notify", "progress", jQuery.Callbacks( "memory" ) ]
			],
			state = "pending",
			promise = {
				state: function() {
					return state;
				},
				always: function() {
					deferred.done( arguments ).fail( arguments );
					return this;
				},
				then: function( /* fnDone, fnFail, fnProgress */ ) {
					var fns = arguments;
					return jQuery.Deferred( function( newDefer ) {
						jQuery.each( tuples, function( i, tuple ) {
							var fn = jQuery.isFunction( fns[ i ] ) && fns[ i ];

							// deferred[ done | fail | progress ] for forwarding actions to newDefer
							deferred[ tuple[ 1 ] ]( function() {
								var returned = fn && fn.apply( this, arguments );
								if ( returned && jQuery.isFunction( returned.promise ) ) {
									returned.promise()
										.progress( newDefer.notify )
										.done( newDefer.resolve )
										.fail( newDefer.reject );
								} else {
									newDefer[ tuple[ 0 ] + "With" ](
										this === promise ? newDefer.promise() : this,
										fn ? [ returned ] : arguments
									);
								}
							} );
						} );
						fns = null;
					} ).promise();
				},

				// Get a promise for this deferred
				// If obj is provided, the promise aspect is added to the object
				promise: function( obj ) {
					return obj != null ? jQuery.extend( obj, promise ) : promise;
				}
			},
			deferred = {};

		// Keep pipe for back-compat
		promise.pipe = promise.then;

		// Add list-specific methods
		jQuery.each( tuples, function( i, tuple ) {
			var list = tuple[ 2 ],
				stateString = tuple[ 3 ];

			// promise[ done | fail | progress ] = list.add
			promise[ tuple[ 1 ] ] = list.add;

			// Handle state
			if ( stateString ) {
				list.add( function() {

					// state = [ resolved | rejected ]
					state = stateString;

				// [ reject_list | resolve_list ].disable; progress_list.lock
				}, tuples[ i ^ 1 ][ 2 ].disable, tuples[ 2 ][ 2 ].lock );
			}

			// deferred[ resolve | reject | notify ]
			deferred[ tuple[ 0 ] ] = function() {
				deferred[ tuple[ 0 ] + "With" ]( this === deferred ? promise : this, arguments );
				return this;
			};
			deferred[ tuple[ 0 ] + "With" ] = list.fireWith;
		} );

		// Make the deferred a promise
		promise.promise( deferred );

		// Call given func if any
		if ( func ) {
			func.call( deferred, deferred );
		}

		// All done!
		return deferred;
	},

	// Deferred helper
	when: function( subordinate /* , ..., subordinateN */ ) {
		var i = 0,
			resolveValues = slice.call( arguments ),
			length = resolveValues.length,

			// the count of uncompleted subordinates
			remaining = length !== 1 ||
				( subordinate && jQuery.isFunction( subordinate.promise ) ) ? length : 0,

			// the master Deferred.
			// If resolveValues consist of only a single Deferred, just use that.
			deferred = remaining === 1 ? subordinate : jQuery.Deferred(),

			// Update function for both resolve and progress values
			updateFunc = function( i, contexts, values ) {
				return function( value ) {
					contexts[ i ] = this;
					values[ i ] = arguments.length > 1 ? slice.call( arguments ) : value;
					if ( values === progressValues ) {
						deferred.notifyWith( contexts, values );

					} else if ( !( --remaining ) ) {
						deferred.resolveWith( contexts, values );
					}
				};
			},

			progressValues, progressContexts, resolveContexts;

		// add listeners to Deferred subordinates; treat others as resolved
		if ( length > 1 ) {
			progressValues = new Array( length );
			progressContexts = new Array( length );
			resolveContexts = new Array( length );
			for ( ; i < length; i++ ) {
				if ( resolveValues[ i ] && jQuery.isFunction( resolveValues[ i ].promise ) ) {
					resolveValues[ i ].promise()
						.progress( updateFunc( i, progressContexts, progressValues ) )
						.done( updateFunc( i, resolveContexts, resolveValues ) )
						.fail( deferred.reject );
				} else {
					--remaining;
				}
			}
		}

		// if we're not waiting on anything, resolve the master
		if ( !remaining ) {
			deferred.resolveWith( resolveContexts, resolveValues );
		}

		return deferred.promise();
	}
} );


// The deferred used on DOM ready
var readyList;

jQuery.fn.ready = function( fn ) {

	// Add the callback
	jQuery.ready.promise().done( fn );

	return this;
};

jQuery.extend( {

	// Is the DOM ready to be used? Set to true once it occurs.
	isReady: false,

	// A counter to track how many items to wait for before
	// the ready event fires. See #6781
	readyWait: 1,

	// Hold (or release) the ready event
	holdReady: function( hold ) {
		if ( hold ) {
			jQuery.readyWait++;
		} else {
			jQuery.ready( true );
		}
	},

	// Handle when the DOM is ready
	ready: function( wait ) {

		// Abort if there are pending holds or we're already ready
		if ( wait === true ? --jQuery.readyWait : jQuery.isReady ) {
			return;
		}

		// Remember that the DOM is ready
		jQuery.isReady = true;

		// If a normal DOM Ready event fired, decrement, and wait if need be
		if ( wait !== true && --jQuery.readyWait > 0 ) {
			return;
		}

		// If there are functions bound, to execute
		readyList.resolveWith( document, [ jQuery ] );

		// Trigger any bound ready events
		if ( jQuery.fn.triggerHandler ) {
			jQuery( document ).triggerHandler( "ready" );
			jQuery( document ).off( "ready" );
		}
	}
} );

/**
 * Clean-up method for dom ready events
 */
function detach() {
	if ( document.addEventListener ) {
		document.removeEventListener( "DOMContentLoaded", completed );
		window.removeEventListener( "load", completed );

	} else {
		document.detachEvent( "onreadystatechange", completed );
		window.detachEvent( "onload", completed );
	}
}

/**
 * The ready event handler and self cleanup method
 */
function completed() {

	// readyState === "complete" is good enough for us to call the dom ready in oldIE
	if ( document.addEventListener ||
		window.event.type === "load" ||
		document.readyState === "complete" ) {

		detach();
		jQuery.ready();
	}
}

jQuery.ready.promise = function( obj ) {
	if ( !readyList ) {

		readyList = jQuery.Deferred();

		// Catch cases where $(document).ready() is called
		// after the browser event has already occurred.
		// Support: IE6-10
		// Older IE sometimes signals "interactive" too soon
		if ( document.readyState === "complete" ||
			( document.readyState !== "loading" && !document.documentElement.doScroll ) ) {

			// Handle it asynchronously to allow scripts the opportunity to delay ready
			window.setTimeout( jQuery.ready );

		// Standards-based browsers support DOMContentLoaded
		} else if ( document.addEventListener ) {

			// Use the handy event callback
			document.addEventListener( "DOMContentLoaded", completed );

			// A fallback to window.onload, that will always work
			window.addEventListener( "load", completed );

		// If IE event model is used
		} else {

			// Ensure firing before onload, maybe late but safe also for iframes
			document.attachEvent( "onreadystatechange", completed );

			// A fallback to window.onload, that will always work
			window.attachEvent( "onload", completed );

			// If IE and not a frame
			// continually check to see if the document is ready
			var top = false;

			try {
				top = window.frameElement == null && document.documentElement;
			} catch ( e ) {}

			if ( top && top.doScroll ) {
				( function doScrollCheck() {
					if ( !jQuery.isReady ) {

						try {

							// Use the trick by Diego Perini
							// http://javascript.nwbox.com/IEContentLoaded/
							top.doScroll( "left" );
						} catch ( e ) {
							return window.setTimeout( doScrollCheck, 50 );
						}

						// detach all dom ready events
						detach();

						// and execute any waiting functions
						jQuery.ready();
					}
				} )();
			}
		}
	}
	return readyList.promise( obj );
};

// Kick off the DOM ready check even if the user does not
jQuery.ready.promise();




// Support: IE<9
// Iteration over object's inherited properties before its own
var i;
for ( i in jQuery( support ) ) {
	break;
}
support.ownFirst = i === "0";

// Note: most support tests are defined in their respective modules.
// false until the test is run
support.inlineBlockNeedsLayout = false;

// Execute ASAP in case we need to set body.style.zoom
jQuery( function() {

	// Minified: var a,b,c,d
	var val, div, body, container;

	body = document.getElementsByTagName( "body" )[ 0 ];
	if ( !body || !body.style ) {

		// Return for frameset docs that don't have a body
		return;
	}

	// Setup
	div = document.createElement( "div" );
	container = document.createElement( "div" );
	container.style.cssText = "position:absolute;border:0;width:0;height:0;top:0;left:-9999px";
	body.appendChild( container ).appendChild( div );

	if ( typeof div.style.zoom !== "undefined" ) {

		// Support: IE<8
		// Check if natively block-level elements act like inline-block
		// elements when setting their display to 'inline' and giving
		// them layout
		div.style.cssText = "display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1";

		support.inlineBlockNeedsLayout = val = div.offsetWidth === 3;
		if ( val ) {

			// Prevent IE 6 from affecting layout for positioned elements #11048
			// Prevent IE from shrinking the body in IE 7 mode #12869
			// Support: IE<8
			body.style.zoom = 1;
		}
	}

	body.removeChild( container );
} );


( function() {
	var div = document.createElement( "div" );

	// Support: IE<9
	support.deleteExpando = true;
	try {
		delete div.test;
	} catch ( e ) {
		support.deleteExpando = false;
	}

	// Null elements to avoid leaks in IE.
	div = null;
} )();
var acceptData = function( elem ) {
	var noData = jQuery.noData[ ( elem.nodeName + " " ).toLowerCase() ],
		nodeType = +elem.nodeType || 1;

	// Do not set data on non-element DOM nodes because it will not be cleared (#8335).
	return nodeType !== 1 && nodeType !== 9 ?
		false :

		// Nodes accept data unless otherwise specified; rejection can be conditional
		!noData || noData !== true && elem.getAttribute( "classid" ) === noData;
};




var rbrace = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,
	rmultiDash = /([A-Z])/g;

function dataAttr( elem, key, data ) {

	// If nothing was found internally, try to fetch any
	// data from the HTML5 data-* attribute
	if ( data === undefined && elem.nodeType === 1 ) {

		var name = "data-" + key.replace( rmultiDash, "-$1" ).toLowerCase();

		data = elem.getAttribute( name );

		if ( typeof data === "string" ) {
			try {
				data = data === "true" ? true :
					data === "false" ? false :
					data === "null" ? null :

					// Only convert to a number if it doesn't change the string
					+data + "" === data ? +data :
					rbrace.test( data ) ? jQuery.parseJSON( data ) :
					data;
			} catch ( e ) {}

			// Make sure we set the data so it isn't changed later
			jQuery.data( elem, key, data );

		} else {
			data = undefined;
		}
	}

	return data;
}

// checks a cache object for emptiness
function isEmptyDataObject( obj ) {
	var name;
	for ( name in obj ) {

		// if the public data object is empty, the private is still empty
		if ( name === "data" && jQuery.isEmptyObject( obj[ name ] ) ) {
			continue;
		}
		if ( name !== "toJSON" ) {
			return false;
		}
	}

	return true;
}

function internalData( elem, name, data, pvt /* Internal Use Only */ ) {
	if ( !acceptData( elem ) ) {
		return;
	}

	var ret, thisCache,
		internalKey = jQuery.expando,

		// We have to handle DOM nodes and JS objects differently because IE6-7
		// can't GC object references properly across the DOM-JS boundary
		isNode = elem.nodeType,

		// Only DOM nodes need the global jQuery cache; JS object data is
		// attached directly to the object so GC can occur automatically
		cache = isNode ? jQuery.cache : elem,

		// Only defining an ID for JS objects if its cache already exists allows
		// the code to shortcut on the same path as a DOM node with no cache
		id = isNode ? elem[ internalKey ] : elem[ internalKey ] && internalKey;

	// Avoid doing any more work than we need to when trying to get data on an
	// object that has no data at all
	if ( ( !id || !cache[ id ] || ( !pvt && !cache[ id ].data ) ) &&
		data === undefined && typeof name === "string" ) {
		return;
	}

	if ( !id ) {

		// Only DOM nodes need a new unique ID for each element since their data
		// ends up in the global cache
		if ( isNode ) {
			id = elem[ internalKey ] = deletedIds.pop() || jQuery.guid++;
		} else {
			id = internalKey;
		}
	}

	if ( !cache[ id ] ) {

		// Avoid exposing jQuery metadata on plain JS objects when the object
		// is serialized using JSON.stringify
		cache[ id ] = isNode ? {} : { toJSON: jQuery.noop };
	}

	// An object can be passed to jQuery.data instead of a key/value pair; this gets
	// shallow copied over onto the existing cache
	if ( typeof name === "object" || typeof name === "function" ) {
		if ( pvt ) {
			cache[ id ] = jQuery.extend( cache[ id ], name );
		} else {
			cache[ id ].data = jQuery.extend( cache[ id ].data, name );
		}
	}

	thisCache = cache[ id ];

	// jQuery data() is stored in a separate object inside the object's internal data
	// cache in order to avoid key collisions between internal data and user-defined
	// data.
	if ( !pvt ) {
		if ( !thisCache.data ) {
			thisCache.data = {};
		}

		thisCache = thisCache.data;
	}

	if ( data !== undefined ) {
		thisCache[ jQuery.camelCase( name ) ] = data;
	}

	// Check for both converted-to-camel and non-converted data property names
	// If a data property was specified
	if ( typeof name === "string" ) {

		// First Try to find as-is property data
		ret = thisCache[ name ];

		// Test for null|undefined property data
		if ( ret == null ) {

			// Try to find the camelCased property
			ret = thisCache[ jQuery.camelCase( name ) ];
		}
	} else {
		ret = thisCache;
	}

	return ret;
}

function internalRemoveData( elem, name, pvt ) {
	if ( !acceptData( elem ) ) {
		return;
	}

	var thisCache, i,
		isNode = elem.nodeType,

		// See jQuery.data for more information
		cache = isNode ? jQuery.cache : elem,
		id = isNode ? elem[ jQuery.expando ] : jQuery.expando;

	// If there is already no cache entry for this object, there is no
	// purpose in continuing
	if ( !cache[ id ] ) {
		return;
	}

	if ( name ) {

		thisCache = pvt ? cache[ id ] : cache[ id ].data;

		if ( thisCache ) {

			// Support array or space separated string names for data keys
			if ( !jQuery.isArray( name ) ) {

				// try the string as a key before any manipulation
				if ( name in thisCache ) {
					name = [ name ];
				} else {

					// split the camel cased version by spaces unless a key with the spaces exists
					name = jQuery.camelCase( name );
					if ( name in thisCache ) {
						name = [ name ];
					} else {
						name = name.split( " " );
					}
				}
			} else {

				// If "name" is an array of keys...
				// When data is initially created, via ("key", "val") signature,
				// keys will be converted to camelCase.
				// Since there is no way to tell _how_ a key was added, remove
				// both plain key and camelCase key. #12786
				// This will only penalize the array argument path.
				name = name.concat( jQuery.map( name, jQuery.camelCase ) );
			}

			i = name.length;
			while ( i-- ) {
				delete thisCache[ name[ i ] ];
			}

			// If there is no data left in the cache, we want to continue
			// and let the cache object itself get destroyed
			if ( pvt ? !isEmptyDataObject( thisCache ) : !jQuery.isEmptyObject( thisCache ) ) {
				return;
			}
		}
	}

	// See jQuery.data for more information
	if ( !pvt ) {
		delete cache[ id ].data;

		// Don't destroy the parent cache unless the internal data object
		// had been the only thing left in it
		if ( !isEmptyDataObject( cache[ id ] ) ) {
			return;
		}
	}

	// Destroy the cache
	if ( isNode ) {
		jQuery.cleanData( [ elem ], true );

	// Use delete when supported for expandos or `cache` is not a window per isWindow (#10080)
	/* jshint eqeqeq: false */
	} else if ( support.deleteExpando || cache != cache.window ) {
		/* jshint eqeqeq: true */
		delete cache[ id ];

	// When all else fails, undefined
	} else {
		cache[ id ] = undefined;
	}
}

jQuery.extend( {
	cache: {},

	// The following elements (space-suffixed to avoid Object.prototype collisions)
	// throw uncatchable exceptions if you attempt to set expando properties
	noData: {
		"applet ": true,
		"embed ": true,

		// ...but Flash objects (which have this classid) *can* handle expandos
		"object ": "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
	},

	hasData: function( elem ) {
		elem = elem.nodeType ? jQuery.cache[ elem[ jQuery.expando ] ] : elem[ jQuery.expando ];
		return !!elem && !isEmptyDataObject( elem );
	},

	data: function( elem, name, data ) {
		return internalData( elem, name, data );
	},

	removeData: function( elem, name ) {
		return internalRemoveData( elem, name );
	},

	// For internal use only.
	_data: function( elem, name, data ) {
		return internalData( elem, name, data, true );
	},

	_removeData: function( elem, name ) {
		return internalRemoveData( elem, name, true );
	}
} );

jQuery.fn.extend( {
	data: function( key, value ) {
		var i, name, data,
			elem = this[ 0 ],
			attrs = elem && elem.attributes;

		// Special expections of .data basically thwart jQuery.access,
		// so implement the relevant behavior ourselves

		// Gets all values
		if ( key === undefined ) {
			if ( this.length ) {
				data = jQuery.data( elem );

				if ( elem.nodeType === 1 && !jQuery._data( elem, "parsedAttrs" ) ) {
					i = attrs.length;
					while ( i-- ) {

						// Support: IE11+
						// The attrs elements can be null (#14894)
						if ( attrs[ i ] ) {
							name = attrs[ i ].name;
							if ( name.indexOf( "data-" ) === 0 ) {
								name = jQuery.camelCase( name.slice( 5 ) );
								dataAttr( elem, name, data[ name ] );
							}
						}
					}
					jQuery._data( elem, "parsedAttrs", true );
				}
			}

			return data;
		}

		// Sets multiple values
		if ( typeof key === "object" ) {
			return this.each( function() {
				jQuery.data( this, key );
			} );
		}

		return arguments.length > 1 ?

			// Sets one value
			this.each( function() {
				jQuery.data( this, key, value );
			} ) :

			// Gets one value
			// Try to fetch any internally stored data first
			elem ? dataAttr( elem, key, jQuery.data( elem, key ) ) : undefined;
	},

	removeData: function( key ) {
		return this.each( function() {
			jQuery.removeData( this, key );
		} );
	}
} );


jQuery.extend( {
	queue: function( elem, type, data ) {
		var queue;

		if ( elem ) {
			type = ( type || "fx" ) + "queue";
			queue = jQuery._data( elem, type );

			// Speed up dequeue by getting out quickly if this is just a lookup
			if ( data ) {
				if ( !queue || jQuery.isArray( data ) ) {
					queue = jQuery._data( elem, type, jQuery.makeArray( data ) );
				} else {
					queue.push( data );
				}
			}
			return queue || [];
		}
	},

	dequeue: function( elem, type ) {
		type = type || "fx";

		var queue = jQuery.queue( elem, type ),
			startLength = queue.length,
			fn = queue.shift(),
			hooks = jQuery._queueHooks( elem, type ),
			next = function() {
				jQuery.dequeue( elem, type );
			};

		// If the fx queue is dequeued, always remove the progress sentinel
		if ( fn === "inprogress" ) {
			fn = queue.shift();
			startLength--;
		}

		if ( fn ) {

			// Add a progress sentinel to prevent the fx queue from being
			// automatically dequeued
			if ( type === "fx" ) {
				queue.unshift( "inprogress" );
			}

			// clear up the last queue stop function
			delete hooks.stop;
			fn.call( elem, next, hooks );
		}

		if ( !startLength && hooks ) {
			hooks.empty.fire();
		}
	},

	// not intended for public consumption - generates a queueHooks object,
	// or returns the current one
	_queueHooks: function( elem, type ) {
		var key = type + "queueHooks";
		return jQuery._data( elem, key ) || jQuery._data( elem, key, {
			empty: jQuery.Callbacks( "once memory" ).add( function() {
				jQuery._removeData( elem, type + "queue" );
				jQuery._removeData( elem, key );
			} )
		} );
	}
} );

jQuery.fn.extend( {
	queue: function( type, data ) {
		var setter = 2;

		if ( typeof type !== "string" ) {
			data = type;
			type = "fx";
			setter--;
		}

		if ( arguments.length < setter ) {
			return jQuery.queue( this[ 0 ], type );
		}

		return data === undefined ?
			this :
			this.each( function() {
				var queue = jQuery.queue( this, type, data );

				// ensure a hooks for this queue
				jQuery._queueHooks( this, type );

				if ( type === "fx" && queue[ 0 ] !== "inprogress" ) {
					jQuery.dequeue( this, type );
				}
			} );
	},
	dequeue: function( type ) {
		return this.each( function() {
			jQuery.dequeue( this, type );
		} );
	},
	clearQueue: function( type ) {
		return this.queue( type || "fx", [] );
	},

	// Get a promise resolved when queues of a certain type
	// are emptied (fx is the type by default)
	promise: function( type, obj ) {
		var tmp,
			count = 1,
			defer = jQuery.Deferred(),
			elements = this,
			i = this.length,
			resolve = function() {
				if ( !( --count ) ) {
					defer.resolveWith( elements, [ elements ] );
				}
			};

		if ( typeof type !== "string" ) {
			obj = type;
			type = undefined;
		}
		type = type || "fx";

		while ( i-- ) {
			tmp = jQuery._data( elements[ i ], type + "queueHooks" );
			if ( tmp && tmp.empty ) {
				count++;
				tmp.empty.add( resolve );
			}
		}
		resolve();
		return defer.promise( obj );
	}
} );


( function() {
	var shrinkWrapBlocksVal;

	support.shrinkWrapBlocks = function() {
		if ( shrinkWrapBlocksVal != null ) {
			return shrinkWrapBlocksVal;
		}

		// Will be changed later if needed.
		shrinkWrapBlocksVal = false;

		// Minified: var b,c,d
		var div, body, container;

		body = document.getElementsByTagName( "body" )[ 0 ];
		if ( !body || !body.style ) {

			// Test fired too early or in an unsupported environment, exit.
			return;
		}

		// Setup
		div = document.createElement( "div" );
		container = document.createElement( "div" );
		container.style.cssText = "position:absolute;border:0;width:0;height:0;top:0;left:-9999px";
		body.appendChild( container ).appendChild( div );

		// Support: IE6
		// Check if elements with layout shrink-wrap their children
		if ( typeof div.style.zoom !== "undefined" ) {

			// Reset CSS: box-sizing; display; margin; border
			div.style.cssText =

				// Support: Firefox<29, Android 2.3
				// Vendor-prefix box-sizing
				"-webkit-box-sizing:content-box;-moz-box-sizing:content-box;" +
				"box-sizing:content-box;display:block;margin:0;border:0;" +
				"padding:1px;width:1px;zoom:1";
			div.appendChild( document.createElement( "div" ) ).style.width = "5px";
			shrinkWrapBlocksVal = div.offsetWidth !== 3;
		}

		body.removeChild( container );

		return shrinkWrapBlocksVal;
	};

} )();
var pnum = ( /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/ ).source;

var rcssNum = new RegExp( "^(?:([+-])=|)(" + pnum + ")([a-z%]*)$", "i" );


var cssExpand = [ "Top", "Right", "Bottom", "Left" ];

var isHidden = function( elem, el ) {

		// isHidden might be called from jQuery#filter function;
		// in that case, element will be second argument
		elem = el || elem;
		return jQuery.css( elem, "display" ) === "none" ||
			!jQuery.contains( elem.ownerDocument, elem );
	};



function adjustCSS( elem, prop, valueParts, tween ) {
	var adjusted,
		scale = 1,
		maxIterations = 20,
		currentValue = tween ?
			function() { return tween.cur(); } :
			function() { return jQuery.css( elem, prop, "" ); },
		initial = currentValue(),
		unit = valueParts && valueParts[ 3 ] || ( jQuery.cssNumber[ prop ] ? "" : "px" ),

		// Starting value computation is required for potential unit mismatches
		initialInUnit = ( jQuery.cssNumber[ prop ] || unit !== "px" && +initial ) &&
			rcssNum.exec( jQuery.css( elem, prop ) );

	if ( initialInUnit && initialInUnit[ 3 ] !== unit ) {

		// Trust units reported by jQuery.css
		unit = unit || initialInUnit[ 3 ];

		// Make sure we update the tween properties later on
		valueParts = valueParts || [];

		// Iteratively approximate from a nonzero starting point
		initialInUnit = +initial || 1;

		do {

			// If previous iteration zeroed out, double until we get *something*.
			// Use string for doubling so we don't accidentally see scale as unchanged below
			scale = scale || ".5";

			// Adjust and apply
			initialInUnit = initialInUnit / scale;
			jQuery.style( elem, prop, initialInUnit + unit );

		// Update scale, tolerating zero or NaN from tween.cur()
		// Break the loop if scale is unchanged or perfect, or if we've just had enough.
		} while (
			scale !== ( scale = currentValue() / initial ) && scale !== 1 && --maxIterations
		);
	}

	if ( valueParts ) {
		initialInUnit = +initialInUnit || +initial || 0;

		// Apply relative offset (+=/-=) if specified
		adjusted = valueParts[ 1 ] ?
			initialInUnit + ( valueParts[ 1 ] + 1 ) * valueParts[ 2 ] :
			+valueParts[ 2 ];
		if ( tween ) {
			tween.unit = unit;
			tween.start = initialInUnit;
			tween.end = adjusted;
		}
	}
	return adjusted;
}


// Multifunctional method to get and set values of a collection
// The value/s can optionally be executed if it's a function
var access = function( elems, fn, key, value, chainable, emptyGet, raw ) {
	var i = 0,
		length = elems.length,
		bulk = key == null;

	// Sets many values
	if ( jQuery.type( key ) === "object" ) {
		chainable = true;
		for ( i in key ) {
			access( elems, fn, i, key[ i ], true, emptyGet, raw );
		}

	// Sets one value
	} else if ( value !== undefined ) {
		chainable = true;

		if ( !jQuery.isFunction( value ) ) {
			raw = true;
		}

		if ( bulk ) {

			// Bulk operations run against the entire set
			if ( raw ) {
				fn.call( elems, value );
				fn = null;

			// ...except when executing function values
			} else {
				bulk = fn;
				fn = function( elem, key, value ) {
					return bulk.call( jQuery( elem ), value );
				};
			}
		}

		if ( fn ) {
			for ( ; i < length; i++ ) {
				fn(
					elems[ i ],
					key,
					raw ? value : value.call( elems[ i ], i, fn( elems[ i ], key ) )
				);
			}
		}
	}

	return chainable ?
		elems :

		// Gets
		bulk ?
			fn.call( elems ) :
			length ? fn( elems[ 0 ], key ) : emptyGet;
};
var rcheckableType = ( /^(?:checkbox|radio)$/i );

var rtagName = ( /<([\w:-]+)/ );

var rscriptType = ( /^$|\/(?:java|ecma)script/i );

var rleadingWhitespace = ( /^\s+/ );

var nodeNames = "abbr|article|aside|audio|bdi|canvas|data|datalist|" +
		"details|dialog|figcaption|figure|footer|header|hgroup|main|" +
		"mark|meter|nav|output|picture|progress|section|summary|template|time|video";



function createSafeFragment( document ) {
	var list = nodeNames.split( "|" ),
		safeFrag = document.createDocumentFragment();

	if ( safeFrag.createElement ) {
		while ( list.length ) {
			safeFrag.createElement(
				list.pop()
			);
		}
	}
	return safeFrag;
}


( function() {
	var div = document.createElement( "div" ),
		fragment = document.createDocumentFragment(),
		input = document.createElement( "input" );

	// Setup
	div.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";

	// IE strips leading whitespace when .innerHTML is used
	support.leadingWhitespace = div.firstChild.nodeType === 3;

	// Make sure that tbody elements aren't automatically inserted
	// IE will insert them into empty tables
	support.tbody = !div.getElementsByTagName( "tbody" ).length;

	// Make sure that link elements get serialized correctly by innerHTML
	// This requires a wrapper element in IE
	support.htmlSerialize = !!div.getElementsByTagName( "link" ).length;

	// Makes sure cloning an html5 element does not cause problems
	// Where outerHTML is undefined, this still works
	support.html5Clone =
		document.createElement( "nav" ).cloneNode( true ).outerHTML !== "<:nav></:nav>";

	// Check if a disconnected checkbox will retain its checked
	// value of true after appended to the DOM (IE6/7)
	input.type = "checkbox";
	input.checked = true;
	fragment.appendChild( input );
	support.appendChecked = input.checked;

	// Make sure textarea (and checkbox) defaultValue is properly cloned
	// Support: IE6-IE11+
	div.innerHTML = "<textarea>x</textarea>";
	support.noCloneChecked = !!div.cloneNode( true ).lastChild.defaultValue;

	// #11217 - WebKit loses check when the name is after the checked attribute
	fragment.appendChild( div );

	// Support: Windows Web Apps (WWA)
	// `name` and `type` must use .setAttribute for WWA (#14901)
	input = document.createElement( "input" );
	input.setAttribute( "type", "radio" );
	input.setAttribute( "checked", "checked" );
	input.setAttribute( "name", "t" );

	div.appendChild( input );

	// Support: Safari 5.1, iOS 5.1, Android 4.x, Android 2.3
	// old WebKit doesn't clone checked state correctly in fragments
	support.checkClone = div.cloneNode( true ).cloneNode( true ).lastChild.checked;

	// Support: IE<9
	// Cloned elements keep attachEvent handlers, we use addEventListener on IE9+
	support.noCloneEvent = !!div.addEventListener;

	// Support: IE<9
	// Since attributes and properties are the same in IE,
	// cleanData must set properties to undefined rather than use removeAttribute
	div[ jQuery.expando ] = 1;
	support.attributes = !div.getAttribute( jQuery.expando );
} )();


// We have to close these tags to support XHTML (#13200)
var wrapMap = {
	option: [ 1, "<select multiple='multiple'>", "</select>" ],
	legend: [ 1, "<fieldset>", "</fieldset>" ],
	area: [ 1, "<map>", "</map>" ],

	// Support: IE8
	param: [ 1, "<object>", "</object>" ],
	thead: [ 1, "<table>", "</table>" ],
	tr: [ 2, "<table><tbody>", "</tbody></table>" ],
	col: [ 2, "<table><tbody></tbody><colgroup>", "</colgroup></table>" ],
	td: [ 3, "<table><tbody><tr>", "</tr></tbody></table>" ],

	// IE6-8 can't serialize link, script, style, or any html5 (NoScope) tags,
	// unless wrapped in a div with non-breaking characters in front of it.
	_default: support.htmlSerialize ? [ 0, "", "" ] : [ 1, "X<div>", "</div>" ]
};

// Support: IE8-IE9
wrapMap.optgroup = wrapMap.option;

wrapMap.tbody = wrapMap.tfoot = wrapMap.colgroup = wrapMap.caption = wrapMap.thead;
wrapMap.th = wrapMap.td;


function getAll( context, tag ) {
	var elems, elem,
		i = 0,
		found = typeof context.getElementsByTagName !== "undefined" ?
			context.getElementsByTagName( tag || "*" ) :
			typeof context.querySelectorAll !== "undefined" ?
				context.querySelectorAll( tag || "*" ) :
				undefined;

	if ( !found ) {
		for ( found = [], elems = context.childNodes || context;
			( elem = elems[ i ] ) != null;
			i++
		) {
			if ( !tag || jQuery.nodeName( elem, tag ) ) {
				found.push( elem );
			} else {
				jQuery.merge( found, getAll( elem, tag ) );
			}
		}
	}

	return tag === undefined || tag && jQuery.nodeName( context, tag ) ?
		jQuery.merge( [ context ], found ) :
		found;
}


// Mark scripts as having already been evaluated
function setGlobalEval( elems, refElements ) {
	var elem,
		i = 0;
	for ( ; ( elem = elems[ i ] ) != null; i++ ) {
		jQuery._data(
			elem,
			"globalEval",
			!refElements || jQuery._data( refElements[ i ], "globalEval" )
		);
	}
}


var rhtml = /<|&#?\w+;/,
	rtbody = /<tbody/i;

function fixDefaultChecked( elem ) {
	if ( rcheckableType.test( elem.type ) ) {
		elem.defaultChecked = elem.checked;
	}
}

function buildFragment( elems, context, scripts, selection, ignored ) {
	var j, elem, contains,
		tmp, tag, tbody, wrap,
		l = elems.length,

		// Ensure a safe fragment
		safe = createSafeFragment( context ),

		nodes = [],
		i = 0;

	for ( ; i < l; i++ ) {
		elem = elems[ i ];

		if ( elem || elem === 0 ) {

			// Add nodes directly
			if ( jQuery.type( elem ) === "object" ) {
				jQuery.merge( nodes, elem.nodeType ? [ elem ] : elem );

			// Convert non-html into a text node
			} else if ( !rhtml.test( elem ) ) {
				nodes.push( context.createTextNode( elem ) );

			// Convert html into DOM nodes
			} else {
				tmp = tmp || safe.appendChild( context.createElement( "div" ) );

				// Deserialize a standard representation
				tag = ( rtagName.exec( elem ) || [ "", "" ] )[ 1 ].toLowerCase();
				wrap = wrapMap[ tag ] || wrapMap._default;

				tmp.innerHTML = wrap[ 1 ] + jQuery.htmlPrefilter( elem ) + wrap[ 2 ];

				// Descend through wrappers to the right content
				j = wrap[ 0 ];
				while ( j-- ) {
					tmp = tmp.lastChild;
				}

				// Manually add leading whitespace removed by IE
				if ( !support.leadingWhitespace && rleadingWhitespace.test( elem ) ) {
					nodes.push( context.createTextNode( rleadingWhitespace.exec( elem )[ 0 ] ) );
				}

				// Remove IE's autoinserted <tbody> from table fragments
				if ( !support.tbody ) {

					// String was a <table>, *may* have spurious <tbody>
					elem = tag === "table" && !rtbody.test( elem ) ?
						tmp.firstChild :

						// String was a bare <thead> or <tfoot>
						wrap[ 1 ] === "<table>" && !rtbody.test( elem ) ?
							tmp :
							0;

					j = elem && elem.childNodes.length;
					while ( j-- ) {
						if ( jQuery.nodeName( ( tbody = elem.childNodes[ j ] ), "tbody" ) &&
							!tbody.childNodes.length ) {

							elem.removeChild( tbody );
						}
					}
				}

				jQuery.merge( nodes, tmp.childNodes );

				// Fix #12392 for WebKit and IE > 9
				tmp.textContent = "";

				// Fix #12392 for oldIE
				while ( tmp.firstChild ) {
					tmp.removeChild( tmp.firstChild );
				}

				// Remember the top-level container for proper cleanup
				tmp = safe.lastChild;
			}
		}
	}

	// Fix #11356: Clear elements from fragment
	if ( tmp ) {
		safe.removeChild( tmp );
	}

	// Reset defaultChecked for any radios and checkboxes
	// about to be appended to the DOM in IE 6/7 (#8060)
	if ( !support.appendChecked ) {
		jQuery.grep( getAll( nodes, "input" ), fixDefaultChecked );
	}

	i = 0;
	while ( ( elem = nodes[ i++ ] ) ) {

		// Skip elements already in the context collection (trac-4087)
		if ( selection && jQuery.inArray( elem, selection ) > -1 ) {
			if ( ignored ) {
				ignored.push( elem );
			}

			continue;
		}

		contains = jQuery.contains( elem.ownerDocument, elem );

		// Append to fragment
		tmp = getAll( safe.appendChild( elem ), "script" );

		// Preserve script evaluation history
		if ( contains ) {
			setGlobalEval( tmp );
		}

		// Capture executables
		if ( scripts ) {
			j = 0;
			while ( ( elem = tmp[ j++ ] ) ) {
				if ( rscriptType.test( elem.type || "" ) ) {
					scripts.push( elem );
				}
			}
		}
	}

	tmp = null;

	return safe;
}


( function() {
	var i, eventName,
		div = document.createElement( "div" );

	// Support: IE<9 (lack submit/change bubble), Firefox (lack focus(in | out) events)
	for ( i in { submit: true, change: true, focusin: true } ) {
		eventName = "on" + i;

		if ( !( support[ i ] = eventName in window ) ) {

			// Beware of CSP restrictions (https://developer.mozilla.org/en/Security/CSP)
			div.setAttribute( eventName, "t" );
			support[ i ] = div.attributes[ eventName ].expando === false;
		}
	}

	// Null elements to avoid leaks in IE.
	div = null;
} )();


var rformElems = /^(?:input|select|textarea)$/i,
	rkeyEvent = /^key/,
	rmouseEvent = /^(?:mouse|pointer|contextmenu|drag|drop)|click/,
	rfocusMorph = /^(?:focusinfocus|focusoutblur)$/,
	rtypenamespace = /^([^.]*)(?:\.(.+)|)/;

function returnTrue() {
	return true;
}

function returnFalse() {
	return false;
}

// Support: IE9
// See #13393 for more info
function safeActiveElement() {
	try {
		return document.activeElement;
	} catch ( err ) { }
}

function on( elem, types, selector, data, fn, one ) {
	var origFn, type;

	// Types can be a map of types/handlers
	if ( typeof types === "object" ) {

		// ( types-Object, selector, data )
		if ( typeof selector !== "string" ) {

			// ( types-Object, data )
			data = data || selector;
			selector = undefined;
		}
		for ( type in types ) {
			on( elem, type, selector, data, types[ type ], one );
		}
		return elem;
	}

	if ( data == null && fn == null ) {

		// ( types, fn )
		fn = selector;
		data = selector = undefined;
	} else if ( fn == null ) {
		if ( typeof selector === "string" ) {

			// ( types, selector, fn )
			fn = data;
			data = undefined;
		} else {

			// ( types, data, fn )
			fn = data;
			data = selector;
			selector = undefined;
		}
	}
	if ( fn === false ) {
		fn = returnFalse;
	} else if ( !fn ) {
		return elem;
	}

	if ( one === 1 ) {
		origFn = fn;
		fn = function( event ) {

			// Can use an empty set, since event contains the info
			jQuery().off( event );
			return origFn.apply( this, arguments );
		};

		// Use same guid so caller can remove using origFn
		fn.guid = origFn.guid || ( origFn.guid = jQuery.guid++ );
	}
	return elem.each( function() {
		jQuery.event.add( this, types, fn, data, selector );
	} );
}

/*
 * Helper functions for managing events -- not part of the public interface.
 * Props to Dean Edwards' addEvent library for many of the ideas.
 */
jQuery.event = {

	global: {},

	add: function( elem, types, handler, data, selector ) {
		var tmp, events, t, handleObjIn,
			special, eventHandle, handleObj,
			handlers, type, namespaces, origType,
			elemData = jQuery._data( elem );

		// Don't attach events to noData or text/comment nodes (but allow plain objects)
		if ( !elemData ) {
			return;
		}

		// Caller can pass in an object of custom data in lieu of the handler
		if ( handler.handler ) {
			handleObjIn = handler;
			handler = handleObjIn.handler;
			selector = handleObjIn.selector;
		}

		// Make sure that the handler has a unique ID, used to find/remove it later
		if ( !handler.guid ) {
			handler.guid = jQuery.guid++;
		}

		// Init the element's event structure and main handler, if this is the first
		if ( !( events = elemData.events ) ) {
			events = elemData.events = {};
		}
		if ( !( eventHandle = elemData.handle ) ) {
			eventHandle = elemData.handle = function( e ) {

				// Discard the second event of a jQuery.event.trigger() and
				// when an event is called after a page has unloaded
				return typeof jQuery !== "undefined" &&
					( !e || jQuery.event.triggered !== e.type ) ?
					jQuery.event.dispatch.apply( eventHandle.elem, arguments ) :
					undefined;
			};

			// Add elem as a property of the handle fn to prevent a memory leak
			// with IE non-native events
			eventHandle.elem = elem;
		}

		// Handle multiple events separated by a space
		types = ( types || "" ).match( rnotwhite ) || [ "" ];
		t = types.length;
		while ( t-- ) {
			tmp = rtypenamespace.exec( types[ t ] ) || [];
			type = origType = tmp[ 1 ];
			namespaces = ( tmp[ 2 ] || "" ).split( "." ).sort();

			// There *must* be a type, no attaching namespace-only handlers
			if ( !type ) {
				continue;
			}

			// If event changes its type, use the special event handlers for the changed type
			special = jQuery.event.special[ type ] || {};

			// If selector defined, determine special event api type, otherwise given type
			type = ( selector ? special.delegateType : special.bindType ) || type;

			// Update special based on newly reset type
			special = jQuery.event.special[ type ] || {};

			// handleObj is passed to all event handlers
			handleObj = jQuery.extend( {
				type: type,
				origType: origType,
				data: data,
				handler: handler,
				guid: handler.guid,
				selector: selector,
				needsContext: selector && jQuery.expr.match.needsContext.test( selector ),
				namespace: namespaces.join( "." )
			}, handleObjIn );

			// Init the event handler queue if we're the first
			if ( !( handlers = events[ type ] ) ) {
				handlers = events[ type ] = [];
				handlers.delegateCount = 0;

				// Only use addEventListener/attachEvent if the special events handler returns false
				if ( !special.setup ||
					special.setup.call( elem, data, namespaces, eventHandle ) === false ) {

					// Bind the global event handler to the element
					if ( elem.addEventListener ) {
						elem.addEventListener( type, eventHandle, false );

					} else if ( elem.attachEvent ) {
						elem.attachEvent( "on" + type, eventHandle );
					}
				}
			}

			if ( special.add ) {
				special.add.call( elem, handleObj );

				if ( !handleObj.handler.guid ) {
					handleObj.handler.guid = handler.guid;
				}
			}

			// Add to the element's handler list, delegates in front
			if ( selector ) {
				handlers.splice( handlers.delegateCount++, 0, handleObj );
			} else {
				handlers.push( handleObj );
			}

			// Keep track of which events have ever been used, for event optimization
			jQuery.event.global[ type ] = true;
		}

		// Nullify elem to prevent memory leaks in IE
		elem = null;
	},

	// Detach an event or set of events from an element
	remove: function( elem, types, handler, selector, mappedTypes ) {
		var j, handleObj, tmp,
			origCount, t, events,
			special, handlers, type,
			namespaces, origType,
			elemData = jQuery.hasData( elem ) && jQuery._data( elem );

		if ( !elemData || !( events = elemData.events ) ) {
			return;
		}

		// Once for each type.namespace in types; type may be omitted
		types = ( types || "" ).match( rnotwhite ) || [ "" ];
		t = types.length;
		while ( t-- ) {
			tmp = rtypenamespace.exec( types[ t ] ) || [];
			type = origType = tmp[ 1 ];
			namespaces = ( tmp[ 2 ] || "" ).split( "." ).sort();

			// Unbind all events (on this namespace, if provided) for the element
			if ( !type ) {
				for ( type in events ) {
					jQuery.event.remove( elem, type + types[ t ], handler, selector, true );
				}
				continue;
			}

			special = jQuery.event.special[ type ] || {};
			type = ( selector ? special.delegateType : special.bindType ) || type;
			handlers = events[ type ] || [];
			tmp = tmp[ 2 ] &&
				new RegExp( "(^|\\.)" + namespaces.join( "\\.(?:.*\\.|)" ) + "(\\.|$)" );

			// Remove matching events
			origCount = j = handlers.length;
			while ( j-- ) {
				handleObj = handlers[ j ];

				if ( ( mappedTypes || origType === handleObj.origType ) &&
					( !handler || handler.guid === handleObj.guid ) &&
					( !tmp || tmp.test( handleObj.namespace ) ) &&
					( !selector || selector === handleObj.selector ||
						selector === "**" && handleObj.selector ) ) {
					handlers.splice( j, 1 );

					if ( handleObj.selector ) {
						handlers.delegateCount--;
					}
					if ( special.remove ) {
						special.remove.call( elem, handleObj );
					}
				}
			}

			// Remove generic event handler if we removed something and no more handlers exist
			// (avoids potential for endless recursion during removal of special event handlers)
			if ( origCount && !handlers.length ) {
				if ( !special.teardown ||
					special.teardown.call( elem, namespaces, elemData.handle ) === false ) {

					jQuery.removeEvent( elem, type, elemData.handle );
				}

				delete events[ type ];
			}
		}

		// Remove the expando if it's no longer used
		if ( jQuery.isEmptyObject( events ) ) {
			delete elemData.handle;

			// removeData also checks for emptiness and clears the expando if empty
			// so use it instead of delete
			jQuery._removeData( elem, "events" );
		}
	},

	trigger: function( event, data, elem, onlyHandlers ) {
		var handle, ontype, cur,
			bubbleType, special, tmp, i,
			eventPath = [ elem || document ],
			type = hasOwn.call( event, "type" ) ? event.type : event,
			namespaces = hasOwn.call( event, "namespace" ) ? event.namespace.split( "." ) : [];

		cur = tmp = elem = elem || document;

		// Don't do events on text and comment nodes
		if ( elem.nodeType === 3 || elem.nodeType === 8 ) {
			return;
		}

		// focus/blur morphs to focusin/out; ensure we're not firing them right now
		if ( rfocusMorph.test( type + jQuery.event.triggered ) ) {
			return;
		}

		if ( type.indexOf( "." ) > -1 ) {

			// Namespaced trigger; create a regexp to match event type in handle()
			namespaces = type.split( "." );
			type = namespaces.shift();
			namespaces.sort();
		}
		ontype = type.indexOf( ":" ) < 0 && "on" + type;

		// Caller can pass in a jQuery.Event object, Object, or just an event type string
		event = event[ jQuery.expando ] ?
			event :
			new jQuery.Event( type, typeof event === "object" && event );

		// Trigger bitmask: & 1 for native handlers; & 2 for jQuery (always true)
		event.isTrigger = onlyHandlers ? 2 : 3;
		event.namespace = namespaces.join( "." );
		event.rnamespace = event.namespace ?
			new RegExp( "(^|\\.)" + namespaces.join( "\\.(?:.*\\.|)" ) + "(\\.|$)" ) :
			null;

		// Clean up the event in case it is being reused
		event.result = undefined;
		if ( !event.target ) {
			event.target = elem;
		}

		// Clone any incoming data and prepend the event, creating the handler arg list
		data = data == null ?
			[ event ] :
			jQuery.makeArray( data, [ event ] );

		// Allow special events to draw outside the lines
		special = jQuery.event.special[ type ] || {};
		if ( !onlyHandlers && special.trigger && special.trigger.apply( elem, data ) === false ) {
			return;
		}

		// Determine event propagation path in advance, per W3C events spec (#9951)
		// Bubble up to document, then to window; watch for a global ownerDocument var (#9724)
		if ( !onlyHandlers && !special.noBubble && !jQuery.isWindow( elem ) ) {

			bubbleType = special.delegateType || type;
			if ( !rfocusMorph.test( bubbleType + type ) ) {
				cur = cur.parentNode;
			}
			for ( ; cur; cur = cur.parentNode ) {
				eventPath.push( cur );
				tmp = cur;
			}

			// Only add window if we got to document (e.g., not plain obj or detached DOM)
			if ( tmp === ( elem.ownerDocument || document ) ) {
				eventPath.push( tmp.defaultView || tmp.parentWindow || window );
			}
		}

		// Fire handlers on the event path
		i = 0;
		while ( ( cur = eventPath[ i++ ] ) && !event.isPropagationStopped() ) {

			event.type = i > 1 ?
				bubbleType :
				special.bindType || type;

			// jQuery handler
			handle = ( jQuery._data( cur, "events" ) || {} )[ event.type ] &&
				jQuery._data( cur, "handle" );

			if ( handle ) {
				handle.apply( cur, data );
			}

			// Native handler
			handle = ontype && cur[ ontype ];
			if ( handle && handle.apply && acceptData( cur ) ) {
				event.result = handle.apply( cur, data );
				if ( event.result === false ) {
					event.preventDefault();
				}
			}
		}
		event.type = type;

		// If nobody prevented the default action, do it now
		if ( !onlyHandlers && !event.isDefaultPrevented() ) {

			if (
				( !special._default ||
				 special._default.apply( eventPath.pop(), data ) === false
				) && acceptData( elem )
			) {

				// Call a native DOM method on the target with the same name name as the event.
				// Can't use an .isFunction() check here because IE6/7 fails that test.
				// Don't do default actions on window, that's where global variables be (#6170)
				if ( ontype && elem[ type ] && !jQuery.isWindow( elem ) ) {

					// Don't re-trigger an onFOO event when we call its FOO() method
					tmp = elem[ ontype ];

					if ( tmp ) {
						elem[ ontype ] = null;
					}

					// Prevent re-triggering of the same event, since we already bubbled it above
					jQuery.event.triggered = type;
					try {
						elem[ type ]();
					} catch ( e ) {

						// IE<9 dies on focus/blur to hidden element (#1486,#12518)
						// only reproducible on winXP IE8 native, not IE9 in IE8 mode
					}
					jQuery.event.triggered = undefined;

					if ( tmp ) {
						elem[ ontype ] = tmp;
					}
				}
			}
		}

		return event.result;
	},

	dispatch: function( event ) {

		// Make a writable jQuery.Event from the native event object
		event = jQuery.event.fix( event );

		var i, j, ret, matched, handleObj,
			handlerQueue = [],
			args = slice.call( arguments ),
			handlers = ( jQuery._data( this, "events" ) || {} )[ event.type ] || [],
			special = jQuery.event.special[ event.type ] || {};

		// Use the fix-ed jQuery.Event rather than the (read-only) native event
		args[ 0 ] = event;
		event.delegateTarget = this;

		// Call the preDispatch hook for the mapped type, and let it bail if desired
		if ( special.preDispatch && special.preDispatch.call( this, event ) === false ) {
			return;
		}

		// Determine handlers
		handlerQueue = jQuery.event.handlers.call( this, event, handlers );

		// Run delegates first; they may want to stop propagation beneath us
		i = 0;
		while ( ( matched = handlerQueue[ i++ ] ) && !event.isPropagationStopped() ) {
			event.currentTarget = matched.elem;

			j = 0;
			while ( ( handleObj = matched.handlers[ j++ ] ) &&
				!event.isImmediatePropagationStopped() ) {

				// Triggered event must either 1) have no namespace, or 2) have namespace(s)
				// a subset or equal to those in the bound event (both can have no namespace).
				if ( !event.rnamespace || event.rnamespace.test( handleObj.namespace ) ) {

					event.handleObj = handleObj;
					event.data = handleObj.data;

					ret = ( ( jQuery.event.special[ handleObj.origType ] || {} ).handle ||
						handleObj.handler ).apply( matched.elem, args );

					if ( ret !== undefined ) {
						if ( ( event.result = ret ) === false ) {
							event.preventDefault();
							event.stopPropagation();
						}
					}
				}
			}
		}

		// Call the postDispatch hook for the mapped type
		if ( special.postDispatch ) {
			special.postDispatch.call( this, event );
		}

		return event.result;
	},

	handlers: function( event, handlers ) {
		var i, matches, sel, handleObj,
			handlerQueue = [],
			delegateCount = handlers.delegateCount,
			cur = event.target;

		// Support (at least): Chrome, IE9
		// Find delegate handlers
		// Black-hole SVG <use> instance trees (#13180)
		//
		// Support: Firefox<=42+
		// Avoid non-left-click in FF but don't block IE radio events (#3861, gh-2343)
		if ( delegateCount && cur.nodeType &&
			( event.type !== "click" || isNaN( event.button ) || event.button < 1 ) ) {

			/* jshint eqeqeq: false */
			for ( ; cur != this; cur = cur.parentNode || this ) {
				/* jshint eqeqeq: true */

				// Don't check non-elements (#13208)
				// Don't process clicks on disabled elements (#6911, #8165, #11382, #11764)
				if ( cur.nodeType === 1 && ( cur.disabled !== true || event.type !== "click" ) ) {
					matches = [];
					for ( i = 0; i < delegateCount; i++ ) {
						handleObj = handlers[ i ];

						// Don't conflict with Object.prototype properties (#13203)
						sel = handleObj.selector + " ";

						if ( matches[ sel ] === undefined ) {
							matches[ sel ] = handleObj.needsContext ?
								jQuery( sel, this ).index( cur ) > -1 :
								jQuery.find( sel, this, null, [ cur ] ).length;
						}
						if ( matches[ sel ] ) {
							matches.push( handleObj );
						}
					}
					if ( matches.length ) {
						handlerQueue.push( { elem: cur, handlers: matches } );
					}
				}
			}
		}

		// Add the remaining (directly-bound) handlers
		if ( delegateCount < handlers.length ) {
			handlerQueue.push( { elem: this, handlers: handlers.slice( delegateCount ) } );
		}

		return handlerQueue;
	},

	fix: function( event ) {
		if ( event[ jQuery.expando ] ) {
			return event;
		}

		// Create a writable copy of the event object and normalize some properties
		var i, prop, copy,
			type = event.type,
			originalEvent = event,
			fixHook = this.fixHooks[ type ];

		if ( !fixHook ) {
			this.fixHooks[ type ] = fixHook =
				rmouseEvent.test( type ) ? this.mouseHooks :
				rkeyEvent.test( type ) ? this.keyHooks :
				{};
		}
		copy = fixHook.props ? this.props.concat( fixHook.props ) : this.props;

		event = new jQuery.Event( originalEvent );

		i = copy.length;
		while ( i-- ) {
			prop = copy[ i ];
			event[ prop ] = originalEvent[ prop ];
		}

		// Support: IE<9
		// Fix target property (#1925)
		if ( !event.target ) {
			event.target = originalEvent.srcElement || document;
		}

		// Support: Safari 6-8+
		// Target should not be a text node (#504, #13143)
		if ( event.target.nodeType === 3 ) {
			event.target = event.target.parentNode;
		}

		// Support: IE<9
		// For mouse/key events, metaKey==false if it's undefined (#3368, #11328)
		event.metaKey = !!event.metaKey;

		return fixHook.filter ? fixHook.filter( event, originalEvent ) : event;
	},

	// Includes some event props shared by KeyEvent and MouseEvent
	props: ( "altKey bubbles cancelable ctrlKey currentTarget detail eventPhase " +
		"metaKey relatedTarget shiftKey target timeStamp view which" ).split( " " ),

	fixHooks: {},

	keyHooks: {
		props: "char charCode key keyCode".split( " " ),
		filter: function( event, original ) {

			// Add which for key events
			if ( event.which == null ) {
				event.which = original.charCode != null ? original.charCode : original.keyCode;
			}

			return event;
		}
	},

	mouseHooks: {
		props: ( "button buttons clientX clientY fromElement offsetX offsetY " +
			"pageX pageY screenX screenY toElement" ).split( " " ),
		filter: function( event, original ) {
			var body, eventDoc, doc,
				button = original.button,
				fromElement = original.fromElement;

			// Calculate pageX/Y if missing and clientX/Y available
			if ( event.pageX == null && original.clientX != null ) {
				eventDoc = event.target.ownerDocument || document;
				doc = eventDoc.documentElement;
				body = eventDoc.body;

				event.pageX = original.clientX +
					( doc && doc.scrollLeft || body && body.scrollLeft || 0 ) -
					( doc && doc.clientLeft || body && body.clientLeft || 0 );
				event.pageY = original.clientY +
					( doc && doc.scrollTop  || body && body.scrollTop  || 0 ) -
					( doc && doc.clientTop  || body && body.clientTop  || 0 );
			}

			// Add relatedTarget, if necessary
			if ( !event.relatedTarget && fromElement ) {
				event.relatedTarget = fromElement === event.target ?
					original.toElement :
					fromElement;
			}

			// Add which for click: 1 === left; 2 === middle; 3 === right
			// Note: button is not normalized, so don't use it
			if ( !event.which && button !== undefined ) {
				event.which = ( button & 1 ? 1 : ( button & 2 ? 3 : ( button & 4 ? 2 : 0 ) ) );
			}

			return event;
		}
	},

	special: {
		load: {

			// Prevent triggered image.load events from bubbling to window.load
			noBubble: true
		},
		focus: {

			// Fire native event if possible so blur/focus sequence is correct
			trigger: function() {
				if ( this !== safeActiveElement() && this.focus ) {
					try {
						this.focus();
						return false;
					} catch ( e ) {

						// Support: IE<9
						// If we error on focus to hidden element (#1486, #12518),
						// let .trigger() run the handlers
					}
				}
			},
			delegateType: "focusin"
		},
		blur: {
			trigger: function() {
				if ( this === safeActiveElement() && this.blur ) {
					this.blur();
					return false;
				}
			},
			delegateType: "focusout"
		},
		click: {

			// For checkbox, fire native event so checked state will be right
			trigger: function() {
				if ( jQuery.nodeName( this, "input" ) && this.type === "checkbox" && this.click ) {
					this.click();
					return false;
				}
			},

			// For cross-browser consistency, don't fire native .click() on links
			_default: function( event ) {
				return jQuery.nodeName( event.target, "a" );
			}
		},

		beforeunload: {
			postDispatch: function( event ) {

				// Support: Firefox 20+
				// Firefox doesn't alert if the returnValue field is not set.
				if ( event.result !== undefined && event.originalEvent ) {
					event.originalEvent.returnValue = event.result;
				}
			}
		}
	},

	// Piggyback on a donor event to simulate a different one
	simulate: function( type, elem, event ) {
		var e = jQuery.extend(
			new jQuery.Event(),
			event,
			{
				type: type,
				isSimulated: true

				// Previously, `originalEvent: {}` was set here, so stopPropagation call
				// would not be triggered on donor event, since in our own
				// jQuery.event.stopPropagation function we had a check for existence of
				// originalEvent.stopPropagation method, so, consequently it would be a noop.
				//
				// Guard for simulated events was moved to jQuery.event.stopPropagation function
				// since `originalEvent` should point to the original event for the
				// constancy with other events and for more focused logic
			}
		);

		jQuery.event.trigger( e, null, elem );

		if ( e.isDefaultPrevented() ) {
			event.preventDefault();
		}
	}
};

jQuery.removeEvent = document.removeEventListener ?
	function( elem, type, handle ) {

		// This "if" is needed for plain objects
		if ( elem.removeEventListener ) {
			elem.removeEventListener( type, handle );
		}
	} :
	function( elem, type, handle ) {
		var name = "on" + type;

		if ( elem.detachEvent ) {

			// #8545, #7054, preventing memory leaks for custom events in IE6-8
			// detachEvent needed property on element, by name of that event,
			// to properly expose it to GC
			if ( typeof elem[ name ] === "undefined" ) {
				elem[ name ] = null;
			}

			elem.detachEvent( name, handle );
		}
	};

jQuery.Event = function( src, props ) {

	// Allow instantiation without the 'new' keyword
	if ( !( this instanceof jQuery.Event ) ) {
		return new jQuery.Event( src, props );
	}

	// Event object
	if ( src && src.type ) {
		this.originalEvent = src;
		this.type = src.type;

		// Events bubbling up the document may have been marked as prevented
		// by a handler lower down the tree; reflect the correct value.
		this.isDefaultPrevented = src.defaultPrevented ||
				src.defaultPrevented === undefined &&

				// Support: IE < 9, Android < 4.0
				src.returnValue === false ?
			returnTrue :
			returnFalse;

	// Event type
	} else {
		this.type = src;
	}

	// Put explicitly provided properties onto the event object
	if ( props ) {
		jQuery.extend( this, props );
	}

	// Create a timestamp if incoming event doesn't have one
	this.timeStamp = src && src.timeStamp || jQuery.now();

	// Mark it as fixed
	this[ jQuery.expando ] = true;
};

// jQuery.Event is based on DOM3 Events as specified by the ECMAScript Language Binding
// http://www.w3.org/TR/2003/WD-DOM-Level-3-Events-20030331/ecma-script-binding.html
jQuery.Event.prototype = {
	constructor: jQuery.Event,
	isDefaultPrevented: returnFalse,
	isPropagationStopped: returnFalse,
	isImmediatePropagationStopped: returnFalse,

	preventDefault: function() {
		var e = this.originalEvent;

		this.isDefaultPrevented = returnTrue;
		if ( !e ) {
			return;
		}

		// If preventDefault exists, run it on the original event
		if ( e.preventDefault ) {
			e.preventDefault();

		// Support: IE
		// Otherwise set the returnValue property of the original event to false
		} else {
			e.returnValue = false;
		}
	},
	stopPropagation: function() {
		var e = this.originalEvent;

		this.isPropagationStopped = returnTrue;

		if ( !e || this.isSimulated ) {
			return;
		}

		// If stopPropagation exists, run it on the original event
		if ( e.stopPropagation ) {
			e.stopPropagation();
		}

		// Support: IE
		// Set the cancelBubble property of the original event to true
		e.cancelBubble = true;
	},
	stopImmediatePropagation: function() {
		var e = this.originalEvent;

		this.isImmediatePropagationStopped = returnTrue;

		if ( e && e.stopImmediatePropagation ) {
			e.stopImmediatePropagation();
		}

		this.stopPropagation();
	}
};

// Create mouseenter/leave events using mouseover/out and event-time checks
// so that event delegation works in jQuery.
// Do the same for pointerenter/pointerleave and pointerover/pointerout
//
// Support: Safari 7 only
// Safari sends mouseenter too often; see:
// https://code.google.com/p/chromium/issues/detail?id=470258
// for the description of the bug (it existed in older Chrome versions as well).
jQuery.each( {
	mouseenter: "mouseover",
	mouseleave: "mouseout",
	pointerenter: "pointerover",
	pointerleave: "pointerout"
}, function( orig, fix ) {
	jQuery.event.special[ orig ] = {
		delegateType: fix,
		bindType: fix,

		handle: function( event ) {
			var ret,
				target = this,
				related = event.relatedTarget,
				handleObj = event.handleObj;

			// For mouseenter/leave call the handler if related is outside the target.
			// NB: No relatedTarget if the mouse left/entered the browser window
			if ( !related || ( related !== target && !jQuery.contains( target, related ) ) ) {
				event.type = handleObj.origType;
				ret = handleObj.handler.apply( this, arguments );
				event.type = fix;
			}
			return ret;
		}
	};
} );

// IE submit delegation
if ( !support.submit ) {

	jQuery.event.special.submit = {
		setup: function() {

			// Only need this for delegated form submit events
			if ( jQuery.nodeName( this, "form" ) ) {
				return false;
			}

			// Lazy-add a submit handler when a descendant form may potentially be submitted
			jQuery.event.add( this, "click._submit keypress._submit", function( e ) {

				// Node name check avoids a VML-related crash in IE (#9807)
				var elem = e.target,
					form = jQuery.nodeName( elem, "input" ) || jQuery.nodeName( elem, "button" ) ?

						// Support: IE <=8
						// We use jQuery.prop instead of elem.form
						// to allow fixing the IE8 delegated submit issue (gh-2332)
						// by 3rd party polyfills/workarounds.
						jQuery.prop( elem, "form" ) :
						undefined;

				if ( form && !jQuery._data( form, "submit" ) ) {
					jQuery.event.add( form, "submit._submit", function( event ) {
						event._submitBubble = true;
					} );
					jQuery._data( form, "submit", true );
				}
			} );

			// return undefined since we don't need an event listener
		},

		postDispatch: function( event ) {

			// If form was submitted by the user, bubble the event up the tree
			if ( event._submitBubble ) {
				delete event._submitBubble;
				if ( this.parentNode && !event.isTrigger ) {
					jQuery.event.simulate( "submit", this.parentNode, event );
				}
			}
		},

		teardown: function() {

			// Only need this for delegated form submit events
			if ( jQuery.nodeName( this, "form" ) ) {
				return false;
			}

			// Remove delegated handlers; cleanData eventually reaps submit handlers attached above
			jQuery.event.remove( this, "._submit" );
		}
	};
}

// IE change delegation and checkbox/radio fix
if ( !support.change ) {

	jQuery.event.special.change = {

		setup: function() {

			if ( rformElems.test( this.nodeName ) ) {

				// IE doesn't fire change on a check/radio until blur; trigger it on click
				// after a propertychange. Eat the blur-change in special.change.handle.
				// This still fires onchange a second time for check/radio after blur.
				if ( this.type === "checkbox" || this.type === "radio" ) {
					jQuery.event.add( this, "propertychange._change", function( event ) {
						if ( event.originalEvent.propertyName === "checked" ) {
							this._justChanged = true;
						}
					} );
					jQuery.event.add( this, "click._change", function( event ) {
						if ( this._justChanged && !event.isTrigger ) {
							this._justChanged = false;
						}

						// Allow triggered, simulated change events (#11500)
						jQuery.event.simulate( "change", this, event );
					} );
				}
				return false;
			}

			// Delegated event; lazy-add a change handler on descendant inputs
			jQuery.event.add( this, "beforeactivate._change", function( e ) {
				var elem = e.target;

				if ( rformElems.test( elem.nodeName ) && !jQuery._data( elem, "change" ) ) {
					jQuery.event.add( elem, "change._change", function( event ) {
						if ( this.parentNode && !event.isSimulated && !event.isTrigger ) {
							jQuery.event.simulate( "change", this.parentNode, event );
						}
					} );
					jQuery._data( elem, "change", true );
				}
			} );
		},

		handle: function( event ) {
			var elem = event.target;

			// Swallow native change events from checkbox/radio, we already triggered them above
			if ( this !== elem || event.isSimulated || event.isTrigger ||
				( elem.type !== "radio" && elem.type !== "checkbox" ) ) {

				return event.handleObj.handler.apply( this, arguments );
			}
		},

		teardown: function() {
			jQuery.event.remove( this, "._change" );

			return !rformElems.test( this.nodeName );
		}
	};
}

// Support: Firefox
// Firefox doesn't have focus(in | out) events
// Related ticket - https://bugzilla.mozilla.org/show_bug.cgi?id=687787
//
// Support: Chrome, Safari
// focus(in | out) events fire after focus & blur events,
// which is spec violation - http://www.w3.org/TR/DOM-Level-3-Events/#events-focusevent-event-order
// Related ticket - https://code.google.com/p/chromium/issues/detail?id=449857
if ( !support.focusin ) {
	jQuery.each( { focus: "focusin", blur: "focusout" }, function( orig, fix ) {

		// Attach a single capturing handler on the document while someone wants focusin/focusout
		var handler = function( event ) {
			jQuery.event.simulate( fix, event.target, jQuery.event.fix( event ) );
		};

		jQuery.event.special[ fix ] = {
			setup: function() {
				var doc = this.ownerDocument || this,
					attaches = jQuery._data( doc, fix );

				if ( !attaches ) {
					doc.addEventListener( orig, handler, true );
				}
				jQuery._data( doc, fix, ( attaches || 0 ) + 1 );
			},
			teardown: function() {
				var doc = this.ownerDocument || this,
					attaches = jQuery._data( doc, fix ) - 1;

				if ( !attaches ) {
					doc.removeEventListener( orig, handler, true );
					jQuery._removeData( doc, fix );
				} else {
					jQuery._data( doc, fix, attaches );
				}
			}
		};
	} );
}

jQuery.fn.extend( {

	on: function( types, selector, data, fn ) {
		return on( this, types, selector, data, fn );
	},
	one: function( types, selector, data, fn ) {
		return on( this, types, selector, data, fn, 1 );
	},
	off: function( types, selector, fn ) {
		var handleObj, type;
		if ( types && types.preventDefault && types.handleObj ) {

			// ( event )  dispatched jQuery.Event
			handleObj = types.handleObj;
			jQuery( types.delegateTarget ).off(
				handleObj.namespace ?
					handleObj.origType + "." + handleObj.namespace :
					handleObj.origType,
				handleObj.selector,
				handleObj.handler
			);
			return this;
		}
		if ( typeof types === "object" ) {

			// ( types-object [, selector] )
			for ( type in types ) {
				this.off( type, selector, types[ type ] );
			}
			return this;
		}
		if ( selector === false || typeof selector === "function" ) {

			// ( types [, fn] )
			fn = selector;
			selector = undefined;
		}
		if ( fn === false ) {
			fn = returnFalse;
		}
		return this.each( function() {
			jQuery.event.remove( this, types, fn, selector );
		} );
	},

	trigger: function( type, data ) {
		return this.each( function() {
			jQuery.event.trigger( type, data, this );
		} );
	},
	triggerHandler: function( type, data ) {
		var elem = this[ 0 ];
		if ( elem ) {
			return jQuery.event.trigger( type, data, elem, true );
		}
	}
} );


var rinlinejQuery = / jQuery\d+="(?:null|\d+)"/g,
	rnoshimcache = new RegExp( "<(?:" + nodeNames + ")[\\s/>]", "i" ),
	rxhtmlTag = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,

	// Support: IE 10-11, Edge 10240+
	// In IE/Edge using regex groups here causes severe slowdowns.
	// See https://connect.microsoft.com/IE/feedback/details/1736512/
	rnoInnerhtml = /<script|<style|<link/i,

	// checked="checked" or checked
	rchecked = /checked\s*(?:[^=]|=\s*.checked.)/i,
	rscriptTypeMasked = /^true\/(.*)/,
	rcleanScript = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,
	safeFragment = createSafeFragment( document ),
	fragmentDiv = safeFragment.appendChild( document.createElement( "div" ) );

// Support: IE<8
// Manipulating tables requires a tbody
function manipulationTarget( elem, content ) {
	return jQuery.nodeName( elem, "table" ) &&
		jQuery.nodeName( content.nodeType !== 11 ? content : content.firstChild, "tr" ) ?

		elem.getElementsByTagName( "tbody" )[ 0 ] ||
			elem.appendChild( elem.ownerDocument.createElement( "tbody" ) ) :
		elem;
}

// Replace/restore the type attribute of script elements for safe DOM manipulation
function disableScript( elem ) {
	elem.type = ( jQuery.find.attr( elem, "type" ) !== null ) + "/" + elem.type;
	return elem;
}
function restoreScript( elem ) {
	var match = rscriptTypeMasked.exec( elem.type );
	if ( match ) {
		elem.type = match[ 1 ];
	} else {
		elem.removeAttribute( "type" );
	}
	return elem;
}

function cloneCopyEvent( src, dest ) {
	if ( dest.nodeType !== 1 || !jQuery.hasData( src ) ) {
		return;
	}

	var type, i, l,
		oldData = jQuery._data( src ),
		curData = jQuery._data( dest, oldData ),
		events = oldData.events;

	if ( events ) {
		delete curData.handle;
		curData.events = {};

		for ( type in events ) {
			for ( i = 0, l = events[ type ].length; i < l; i++ ) {
				jQuery.event.add( dest, type, events[ type ][ i ] );
			}
		}
	}

	// make the cloned public data object a copy from the original
	if ( curData.data ) {
		curData.data = jQuery.extend( {}, curData.data );
	}
}

function fixCloneNodeIssues( src, dest ) {
	var nodeName, e, data;

	// We do not need to do anything for non-Elements
	if ( dest.nodeType !== 1 ) {
		return;
	}

	nodeName = dest.nodeName.toLowerCase();

	// IE6-8 copies events bound via attachEvent when using cloneNode.
	if ( !support.noCloneEvent && dest[ jQuery.expando ] ) {
		data = jQuery._data( dest );

		for ( e in data.events ) {
			jQuery.removeEvent( dest, e, data.handle );
		}

		// Event data gets referenced instead of copied if the expando gets copied too
		dest.removeAttribute( jQuery.expando );
	}

	// IE blanks contents when cloning scripts, and tries to evaluate newly-set text
	if ( nodeName === "script" && dest.text !== src.text ) {
		disableScript( dest ).text = src.text;
		restoreScript( dest );

	// IE6-10 improperly clones children of object elements using classid.
	// IE10 throws NoModificationAllowedError if parent is null, #12132.
	} else if ( nodeName === "object" ) {
		if ( dest.parentNode ) {
			dest.outerHTML = src.outerHTML;
		}

		// This path appears unavoidable for IE9. When cloning an object
		// element in IE9, the outerHTML strategy above is not sufficient.
		// If the src has innerHTML and the destination does not,
		// copy the src.innerHTML into the dest.innerHTML. #10324
		if ( support.html5Clone && ( src.innerHTML && !jQuery.trim( dest.innerHTML ) ) ) {
			dest.innerHTML = src.innerHTML;
		}

	} else if ( nodeName === "input" && rcheckableType.test( src.type ) ) {

		// IE6-8 fails to persist the checked state of a cloned checkbox
		// or radio button. Worse, IE6-7 fail to give the cloned element
		// a checked appearance if the defaultChecked value isn't also set

		dest.defaultChecked = dest.checked = src.checked;

		// IE6-7 get confused and end up setting the value of a cloned
		// checkbox/radio button to an empty string instead of "on"
		if ( dest.value !== src.value ) {
			dest.value = src.value;
		}

	// IE6-8 fails to return the selected option to the default selected
	// state when cloning options
	} else if ( nodeName === "option" ) {
		dest.defaultSelected = dest.selected = src.defaultSelected;

	// IE6-8 fails to set the defaultValue to the correct value when
	// cloning other types of input fields
	} else if ( nodeName === "input" || nodeName === "textarea" ) {
		dest.defaultValue = src.defaultValue;
	}
}

function domManip( collection, args, callback, ignored ) {

	// Flatten any nested arrays
	args = concat.apply( [], args );

	var first, node, hasScripts,
		scripts, doc, fragment,
		i = 0,
		l = collection.length,
		iNoClone = l - 1,
		value = args[ 0 ],
		isFunction = jQuery.isFunction( value );

	// We can't cloneNode fragments that contain checked, in WebKit
	if ( isFunction ||
			( l > 1 && typeof value === "string" &&
				!support.checkClone && rchecked.test( value ) ) ) {
		return collection.each( function( index ) {
			var self = collection.eq( index );
			if ( isFunction ) {
				args[ 0 ] = value.call( this, index, self.html() );
			}
			domManip( self, args, callback, ignored );
		} );
	}

	if ( l ) {
		fragment = buildFragment( args, collection[ 0 ].ownerDocument, false, collection, ignored );
		first = fragment.firstChild;

		if ( fragment.childNodes.length === 1 ) {
			fragment = first;
		}

		// Require either new content or an interest in ignored elements to invoke the callback
		if ( first || ignored ) {
			scripts = jQuery.map( getAll( fragment, "script" ), disableScript );
			hasScripts = scripts.length;

			// Use the original fragment for the last item
			// instead of the first because it can end up
			// being emptied incorrectly in certain situations (#8070).
			for ( ; i < l; i++ ) {
				node = fragment;

				if ( i !== iNoClone ) {
					node = jQuery.clone( node, true, true );

					// Keep references to cloned scripts for later restoration
					if ( hasScripts ) {

						// Support: Android<4.1, PhantomJS<2
						// push.apply(_, arraylike) throws on ancient WebKit
						jQuery.merge( scripts, getAll( node, "script" ) );
					}
				}

				callback.call( collection[ i ], node, i );
			}

			if ( hasScripts ) {
				doc = scripts[ scripts.length - 1 ].ownerDocument;

				// Reenable scripts
				jQuery.map( scripts, restoreScript );

				// Evaluate executable scripts on first document insertion
				for ( i = 0; i < hasScripts; i++ ) {
					node = scripts[ i ];
					if ( rscriptType.test( node.type || "" ) &&
						!jQuery._data( node, "globalEval" ) &&
						jQuery.contains( doc, node ) ) {

						if ( node.src ) {

							// Optional AJAX dependency, but won't run scripts if not present
							if ( jQuery._evalUrl ) {
								jQuery._evalUrl( node.src );
							}
						} else {
							jQuery.globalEval(
								( node.text || node.textContent || node.innerHTML || "" )
									.replace( rcleanScript, "" )
							);
						}
					}
				}
			}

			// Fix #11809: Avoid leaking memory
			fragment = first = null;
		}
	}

	return collection;
}

function remove( elem, selector, keepData ) {
	var node,
		elems = selector ? jQuery.filter( selector, elem ) : elem,
		i = 0;

	for ( ; ( node = elems[ i ] ) != null; i++ ) {

		if ( !keepData && node.nodeType === 1 ) {
			jQuery.cleanData( getAll( node ) );
		}

		if ( node.parentNode ) {
			if ( keepData && jQuery.contains( node.ownerDocument, node ) ) {
				setGlobalEval( getAll( node, "script" ) );
			}
			node.parentNode.removeChild( node );
		}
	}

	return elem;
}

jQuery.extend( {
	htmlPrefilter: function( html ) {
		return html.replace( rxhtmlTag, "<$1></$2>" );
	},

	clone: function( elem, dataAndEvents, deepDataAndEvents ) {
		var destElements, node, clone, i, srcElements,
			inPage = jQuery.contains( elem.ownerDocument, elem );

		if ( support.html5Clone || jQuery.isXMLDoc( elem ) ||
			!rnoshimcache.test( "<" + elem.nodeName + ">" ) ) {

			clone = elem.cloneNode( true );

		// IE<=8 does not properly clone detached, unknown element nodes
		} else {
			fragmentDiv.innerHTML = elem.outerHTML;
			fragmentDiv.removeChild( clone = fragmentDiv.firstChild );
		}

		if ( ( !support.noCloneEvent || !support.noCloneChecked ) &&
				( elem.nodeType === 1 || elem.nodeType === 11 ) && !jQuery.isXMLDoc( elem ) ) {

			// We eschew Sizzle here for performance reasons: http://jsperf.com/getall-vs-sizzle/2
			destElements = getAll( clone );
			srcElements = getAll( elem );

			// Fix all IE cloning issues
			for ( i = 0; ( node = srcElements[ i ] ) != null; ++i ) {

				// Ensure that the destination node is not null; Fixes #9587
				if ( destElements[ i ] ) {
					fixCloneNodeIssues( node, destElements[ i ] );
				}
			}
		}

		// Copy the events from the original to the clone
		if ( dataAndEvents ) {
			if ( deepDataAndEvents ) {
				srcElements = srcElements || getAll( elem );
				destElements = destElements || getAll( clone );

				for ( i = 0; ( node = srcElements[ i ] ) != null; i++ ) {
					cloneCopyEvent( node, destElements[ i ] );
				}
			} else {
				cloneCopyEvent( elem, clone );
			}
		}

		// Preserve script evaluation history
		destElements = getAll( clone, "script" );
		if ( destElements.length > 0 ) {
			setGlobalEval( destElements, !inPage && getAll( elem, "script" ) );
		}

		destElements = srcElements = node = null;

		// Return the cloned set
		return clone;
	},

	cleanData: function( elems, /* internal */ forceAcceptData ) {
		var elem, type, id, data,
			i = 0,
			internalKey = jQuery.expando,
			cache = jQuery.cache,
			attributes = support.attributes,
			special = jQuery.event.special;

		for ( ; ( elem = elems[ i ] ) != null; i++ ) {
			if ( forceAcceptData || acceptData( elem ) ) {

				id = elem[ internalKey ];
				data = id && cache[ id ];

				if ( data ) {
					if ( data.events ) {
						for ( type in data.events ) {
							if ( special[ type ] ) {
								jQuery.event.remove( elem, type );

							// This is a shortcut to avoid jQuery.event.remove's overhead
							} else {
								jQuery.removeEvent( elem, type, data.handle );
							}
						}
					}

					// Remove cache only if it was not already removed by jQuery.event.remove
					if ( cache[ id ] ) {

						delete cache[ id ];

						// Support: IE<9
						// IE does not allow us to delete expando properties from nodes
						// IE creates expando attributes along with the property
						// IE does not have a removeAttribute function on Document nodes
						if ( !attributes && typeof elem.removeAttribute !== "undefined" ) {
							elem.removeAttribute( internalKey );

						// Webkit & Blink performance suffers when deleting properties
						// from DOM nodes, so set to undefined instead
						// https://code.google.com/p/chromium/issues/detail?id=378607
						} else {
							elem[ internalKey ] = undefined;
						}

						deletedIds.push( id );
					}
				}
			}
		}
	}
} );

jQuery.fn.extend( {

	// Keep domManip exposed until 3.0 (gh-2225)
	domManip: domManip,

	detach: function( selector ) {
		return remove( this, selector, true );
	},

	remove: function( selector ) {
		return remove( this, selector );
	},

	text: function( value ) {
		return access( this, function( value ) {
			return value === undefined ?
				jQuery.text( this ) :
				this.empty().append(
					( this[ 0 ] && this[ 0 ].ownerDocument || document ).createTextNode( value )
				);
		}, null, value, arguments.length );
	},

	append: function() {
		return domManip( this, arguments, function( elem ) {
			if ( this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9 ) {
				var target = manipulationTarget( this, elem );
				target.appendChild( elem );
			}
		} );
	},

	prepend: function() {
		return domManip( this, arguments, function( elem ) {
			if ( this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9 ) {
				var target = manipulationTarget( this, elem );
				target.insertBefore( elem, target.firstChild );
			}
		} );
	},

	before: function() {
		return domManip( this, arguments, function( elem ) {
			if ( this.parentNode ) {
				this.parentNode.insertBefore( elem, this );
			}
		} );
	},

	after: function() {
		return domManip( this, arguments, function( elem ) {
			if ( this.parentNode ) {
				this.parentNode.insertBefore( elem, this.nextSibling );
			}
		} );
	},

	empty: function() {
		var elem,
			i = 0;

		for ( ; ( elem = this[ i ] ) != null; i++ ) {

			// Remove element nodes and prevent memory leaks
			if ( elem.nodeType === 1 ) {
				jQuery.cleanData( getAll( elem, false ) );
			}

			// Remove any remaining nodes
			while ( elem.firstChild ) {
				elem.removeChild( elem.firstChild );
			}

			// If this is a select, ensure that it displays empty (#12336)
			// Support: IE<9
			if ( elem.options && jQuery.nodeName( elem, "select" ) ) {
				elem.options.length = 0;
			}
		}

		return this;
	},

	clone: function( dataAndEvents, deepDataAndEvents ) {
		dataAndEvents = dataAndEvents == null ? false : dataAndEvents;
		deepDataAndEvents = deepDataAndEvents == null ? dataAndEvents : deepDataAndEvents;

		return this.map( function() {
			return jQuery.clone( this, dataAndEvents, deepDataAndEvents );
		} );
	},

	html: function( value ) {
		return access( this, function( value ) {
			var elem = this[ 0 ] || {},
				i = 0,
				l = this.length;

			if ( value === undefined ) {
				return elem.nodeType === 1 ?
					elem.innerHTML.replace( rinlinejQuery, "" ) :
					undefined;
			}

			// See if we can take a shortcut and just use innerHTML
			if ( typeof value === "string" && !rnoInnerhtml.test( value ) &&
				( support.htmlSerialize || !rnoshimcache.test( value )  ) &&
				( support.leadingWhitespace || !rleadingWhitespace.test( value ) ) &&
				!wrapMap[ ( rtagName.exec( value ) || [ "", "" ] )[ 1 ].toLowerCase() ] ) {

				value = jQuery.htmlPrefilter( value );

				try {
					for ( ; i < l; i++ ) {

						// Remove element nodes and prevent memory leaks
						elem = this[ i ] || {};
						if ( elem.nodeType === 1 ) {
							jQuery.cleanData( getAll( elem, false ) );
							elem.innerHTML = value;
						}
					}

					elem = 0;

				// If using innerHTML throws an exception, use the fallback method
				} catch ( e ) {}
			}

			if ( elem ) {
				this.empty().append( value );
			}
		}, null, value, arguments.length );
	},

	replaceWith: function() {
		var ignored = [];

		// Make the changes, replacing each non-ignored context element with the new content
		return domManip( this, arguments, function( elem ) {
			var parent = this.parentNode;

			if ( jQuery.inArray( this, ignored ) < 0 ) {
				jQuery.cleanData( getAll( this ) );
				if ( parent ) {
					parent.replaceChild( elem, this );
				}
			}

		// Force callback invocation
		}, ignored );
	}
} );

jQuery.each( {
	appendTo: "append",
	prependTo: "prepend",
	insertBefore: "before",
	insertAfter: "after",
	replaceAll: "replaceWith"
}, function( name, original ) {
	jQuery.fn[ name ] = function( selector ) {
		var elems,
			i = 0,
			ret = [],
			insert = jQuery( selector ),
			last = insert.length - 1;

		for ( ; i <= last; i++ ) {
			elems = i === last ? this : this.clone( true );
			jQuery( insert[ i ] )[ original ]( elems );

			// Modern browsers can apply jQuery collections as arrays, but oldIE needs a .get()
			push.apply( ret, elems.get() );
		}

		return this.pushStack( ret );
	};
} );


var iframe,
	elemdisplay = {

		// Support: Firefox
		// We have to pre-define these values for FF (#10227)
		HTML: "block",
		BODY: "block"
	};

/**
 * Retrieve the actual display of a element
 * @param {String} name nodeName of the element
 * @param {Object} doc Document object
 */

// Called only from within defaultDisplay
function actualDisplay( name, doc ) {
	var elem = jQuery( doc.createElement( name ) ).appendTo( doc.body ),

		display = jQuery.css( elem[ 0 ], "display" );

	// We don't have any data stored on the element,
	// so use "detach" method as fast way to get rid of the element
	elem.detach();

	return display;
}

/**
 * Try to determine the default display value of an element
 * @param {String} nodeName
 */
function defaultDisplay( nodeName ) {
	var doc = document,
		display = elemdisplay[ nodeName ];

	if ( !display ) {
		display = actualDisplay( nodeName, doc );

		// If the simple way fails, read from inside an iframe
		if ( display === "none" || !display ) {

			// Use the already-created iframe if possible
			iframe = ( iframe || jQuery( "<iframe frameborder='0' width='0' height='0'/>" ) )
				.appendTo( doc.documentElement );

			// Always write a new HTML skeleton so Webkit and Firefox don't choke on reuse
			doc = ( iframe[ 0 ].contentWindow || iframe[ 0 ].contentDocument ).document;

			// Support: IE
			doc.write();
			doc.close();

			display = actualDisplay( nodeName, doc );
			iframe.detach();
		}

		// Store the correct default display
		elemdisplay[ nodeName ] = display;
	}

	return display;
}
var rmargin = ( /^margin/ );

var rnumnonpx = new RegExp( "^(" + pnum + ")(?!px)[a-z%]+$", "i" );

var swap = function( elem, options, callback, args ) {
	var ret, name,
		old = {};

	// Remember the old values, and insert the new ones
	for ( name in options ) {
		old[ name ] = elem.style[ name ];
		elem.style[ name ] = options[ name ];
	}

	ret = callback.apply( elem, args || [] );

	// Revert the old values
	for ( name in options ) {
		elem.style[ name ] = old[ name ];
	}

	return ret;
};


var documentElement = document.documentElement;



( function() {
	var pixelPositionVal, pixelMarginRightVal, boxSizingReliableVal,
		reliableHiddenOffsetsVal, reliableMarginRightVal, reliableMarginLeftVal,
		container = document.createElement( "div" ),
		div = document.createElement( "div" );

	// Finish early in limited (non-browser) environments
	if ( !div.style ) {
		return;
	}

	div.style.cssText = "float:left;opacity:.5";

	// Support: IE<9
	// Make sure that element opacity exists (as opposed to filter)
	support.opacity = div.style.opacity === "0.5";

	// Verify style float existence
	// (IE uses styleFloat instead of cssFloat)
	support.cssFloat = !!div.style.cssFloat;

	div.style.backgroundClip = "content-box";
	div.cloneNode( true ).style.backgroundClip = "";
	support.clearCloneStyle = div.style.backgroundClip === "content-box";

	container = document.createElement( "div" );
	container.style.cssText = "border:0;width:8px;height:0;top:0;left:-9999px;" +
		"padding:0;margin-top:1px;position:absolute";
	div.innerHTML = "";
	container.appendChild( div );

	// Support: Firefox<29, Android 2.3
	// Vendor-prefix box-sizing
	support.boxSizing = div.style.boxSizing === "" || div.style.MozBoxSizing === "" ||
		div.style.WebkitBoxSizing === "";

	jQuery.extend( support, {
		reliableHiddenOffsets: function() {
			if ( pixelPositionVal == null ) {
				computeStyleTests();
			}
			return reliableHiddenOffsetsVal;
		},

		boxSizingReliable: function() {

			// We're checking for pixelPositionVal here instead of boxSizingReliableVal
			// since that compresses better and they're computed together anyway.
			if ( pixelPositionVal == null ) {
				computeStyleTests();
			}
			return boxSizingReliableVal;
		},

		pixelMarginRight: function() {

			// Support: Android 4.0-4.3
			if ( pixelPositionVal == null ) {
				computeStyleTests();
			}
			return pixelMarginRightVal;
		},

		pixelPosition: function() {
			if ( pixelPositionVal == null ) {
				computeStyleTests();
			}
			return pixelPositionVal;
		},

		reliableMarginRight: function() {

			// Support: Android 2.3
			if ( pixelPositionVal == null ) {
				computeStyleTests();
			}
			return reliableMarginRightVal;
		},

		reliableMarginLeft: function() {

			// Support: IE <=8 only, Android 4.0 - 4.3 only, Firefox <=3 - 37
			if ( pixelPositionVal == null ) {
				computeStyleTests();
			}
			return reliableMarginLeftVal;
		}
	} );

	function computeStyleTests() {
		var contents, divStyle,
			documentElement = document.documentElement;

		// Setup
		documentElement.appendChild( container );

		div.style.cssText =

			// Support: Android 2.3
			// Vendor-prefix box-sizing
			"-webkit-box-sizing:border-box;box-sizing:border-box;" +
			"position:relative;display:block;" +
			"margin:auto;border:1px;padding:1px;" +
			"top:1%;width:50%";

		// Support: IE<9
		// Assume reasonable values in the absence of getComputedStyle
		pixelPositionVal = boxSizingReliableVal = reliableMarginLeftVal = false;
		pixelMarginRightVal = reliableMarginRightVal = true;

		// Check for getComputedStyle so that this code is not run in IE<9.
		if ( window.getComputedStyle ) {
			divStyle = window.getComputedStyle( div );
			pixelPositionVal = ( divStyle || {} ).top !== "1%";
			reliableMarginLeftVal = ( divStyle || {} ).marginLeft === "2px";
			boxSizingReliableVal = ( divStyle || { width: "4px" } ).width === "4px";

			// Support: Android 4.0 - 4.3 only
			// Some styles come back with percentage values, even though they shouldn't
			div.style.marginRight = "50%";
			pixelMarginRightVal = ( divStyle || { marginRight: "4px" } ).marginRight === "4px";

			// Support: Android 2.3 only
			// Div with explicit width and no margin-right incorrectly
			// gets computed margin-right based on width of container (#3333)
			// WebKit Bug 13343 - getComputedStyle returns wrong value for margin-right
			contents = div.appendChild( document.createElement( "div" ) );

			// Reset CSS: box-sizing; display; margin; border; padding
			contents.style.cssText = div.style.cssText =

				// Support: Android 2.3
				// Vendor-prefix box-sizing
				"-webkit-box-sizing:content-box;-moz-box-sizing:content-box;" +
				"box-sizing:content-box;display:block;margin:0;border:0;padding:0";
			contents.style.marginRight = contents.style.width = "0";
			div.style.width = "1px";

			reliableMarginRightVal =
				!parseFloat( ( window.getComputedStyle( contents ) || {} ).marginRight );

			div.removeChild( contents );
		}

		// Support: IE6-8
		// First check that getClientRects works as expected
		// Check if table cells still have offsetWidth/Height when they are set
		// to display:none and there are still other visible table cells in a
		// table row; if so, offsetWidth/Height are not reliable for use when
		// determining if an element has been hidden directly using
		// display:none (it is still safe to use offsets if a parent element is
		// hidden; don safety goggles and see bug #4512 for more information).
		div.style.display = "none";
		reliableHiddenOffsetsVal = div.getClientRects().length === 0;
		if ( reliableHiddenOffsetsVal ) {
			div.style.display = "";
			div.innerHTML = "<table><tr><td></td><td>t</td></tr></table>";
			div.childNodes[ 0 ].style.borderCollapse = "separate";
			contents = div.getElementsByTagName( "td" );
			contents[ 0 ].style.cssText = "margin:0;border:0;padding:0;display:none";
			reliableHiddenOffsetsVal = contents[ 0 ].offsetHeight === 0;
			if ( reliableHiddenOffsetsVal ) {
				contents[ 0 ].style.display = "";
				contents[ 1 ].style.display = "none";
				reliableHiddenOffsetsVal = contents[ 0 ].offsetHeight === 0;
			}
		}

		// Teardown
		documentElement.removeChild( container );
	}

} )();


var getStyles, curCSS,
	rposition = /^(top|right|bottom|left)$/;

if ( window.getComputedStyle ) {
	getStyles = function( elem ) {

		// Support: IE<=11+, Firefox<=30+ (#15098, #14150)
		// IE throws on elements created in popups
		// FF meanwhile throws on frame elements through "defaultView.getComputedStyle"
		var view = elem.ownerDocument.defaultView;

		if ( !view || !view.opener ) {
			view = window;
		}

		return view.getComputedStyle( elem );
	};

	curCSS = function( elem, name, computed ) {
		var width, minWidth, maxWidth, ret,
			style = elem.style;

		computed = computed || getStyles( elem );

		// getPropertyValue is only needed for .css('filter') in IE9, see #12537
		ret = computed ? computed.getPropertyValue( name ) || computed[ name ] : undefined;

		// Support: Opera 12.1x only
		// Fall back to style even without computed
		// computed is undefined for elems on document fragments
		if ( ( ret === "" || ret === undefined ) && !jQuery.contains( elem.ownerDocument, elem ) ) {
			ret = jQuery.style( elem, name );
		}

		if ( computed ) {

			// A tribute to the "awesome hack by Dean Edwards"
			// Chrome < 17 and Safari 5.0 uses "computed value"
			// instead of "used value" for margin-right
			// Safari 5.1.7 (at least) returns percentage for a larger set of values,
			// but width seems to be reliably pixels
			// this is against the CSSOM draft spec:
			// http://dev.w3.org/csswg/cssom/#resolved-values
			if ( !support.pixelMarginRight() && rnumnonpx.test( ret ) && rmargin.test( name ) ) {

				// Remember the original values
				width = style.width;
				minWidth = style.minWidth;
				maxWidth = style.maxWidth;

				// Put in the new values to get a computed value out
				style.minWidth = style.maxWidth = style.width = ret;
				ret = computed.width;

				// Revert the changed values
				style.width = width;
				style.minWidth = minWidth;
				style.maxWidth = maxWidth;
			}
		}

		// Support: IE
		// IE returns zIndex value as an integer.
		return ret === undefined ?
			ret :
			ret + "";
	};
} else if ( documentElement.currentStyle ) {
	getStyles = function( elem ) {
		return elem.currentStyle;
	};

	curCSS = function( elem, name, computed ) {
		var left, rs, rsLeft, ret,
			style = elem.style;

		computed = computed || getStyles( elem );
		ret = computed ? computed[ name ] : undefined;

		// Avoid setting ret to empty string here
		// so we don't default to auto
		if ( ret == null && style && style[ name ] ) {
			ret = style[ name ];
		}

		// From the awesome hack by Dean Edwards
		// http://erik.eae.net/archives/2007/07/27/18.54.15/#comment-102291

		// If we're not dealing with a regular pixel number
		// but a number that has a weird ending, we need to convert it to pixels
		// but not position css attributes, as those are
		// proportional to the parent element instead
		// and we can't measure the parent instead because it
		// might trigger a "stacking dolls" problem
		if ( rnumnonpx.test( ret ) && !rposition.test( name ) ) {

			// Remember the original values
			left = style.left;
			rs = elem.runtimeStyle;
			rsLeft = rs && rs.left;

			// Put in the new values to get a computed value out
			if ( rsLeft ) {
				rs.left = elem.currentStyle.left;
			}
			style.left = name === "fontSize" ? "1em" : ret;
			ret = style.pixelLeft + "px";

			// Revert the changed values
			style.left = left;
			if ( rsLeft ) {
				rs.left = rsLeft;
			}
		}

		// Support: IE
		// IE returns zIndex value as an integer.
		return ret === undefined ?
			ret :
			ret + "" || "auto";
	};
}




function addGetHookIf( conditionFn, hookFn ) {

	// Define the hook, we'll check on the first run if it's really needed.
	return {
		get: function() {
			if ( conditionFn() ) {

				// Hook not needed (or it's not possible to use it due
				// to missing dependency), remove it.
				delete this.get;
				return;
			}

			// Hook needed; redefine it so that the support test is not executed again.
			return ( this.get = hookFn ).apply( this, arguments );
		}
	};
}


var

		ralpha = /alpha\([^)]*\)/i,
	ropacity = /opacity\s*=\s*([^)]*)/i,

	// swappable if display is none or starts with table except
	// "table", "table-cell", or "table-caption"
	// see here for display values:
	// https://developer.mozilla.org/en-US/docs/CSS/display
	rdisplayswap = /^(none|table(?!-c[ea]).+)/,
	rnumsplit = new RegExp( "^(" + pnum + ")(.*)$", "i" ),

	cssShow = { position: "absolute", visibility: "hidden", display: "block" },
	cssNormalTransform = {
		letterSpacing: "0",
		fontWeight: "400"
	},

	cssPrefixes = [ "Webkit", "O", "Moz", "ms" ],
	emptyStyle = document.createElement( "div" ).style;


// return a css property mapped to a potentially vendor prefixed property
function vendorPropName( name ) {

	// shortcut for names that are not vendor prefixed
	if ( name in emptyStyle ) {
		return name;
	}

	// check for vendor prefixed names
	var capName = name.charAt( 0 ).toUpperCase() + name.slice( 1 ),
		i = cssPrefixes.length;

	while ( i-- ) {
		name = cssPrefixes[ i ] + capName;
		if ( name in emptyStyle ) {
			return name;
		}
	}
}

function showHide( elements, show ) {
	var display, elem, hidden,
		values = [],
		index = 0,
		length = elements.length;

	for ( ; index < length; index++ ) {
		elem = elements[ index ];
		if ( !elem.style ) {
			continue;
		}

		values[ index ] = jQuery._data( elem, "olddisplay" );
		display = elem.style.display;
		if ( show ) {

			// Reset the inline display of this element to learn if it is
			// being hidden by cascaded rules or not
			if ( !values[ index ] && display === "none" ) {
				elem.style.display = "";
			}

			// Set elements which have been overridden with display: none
			// in a stylesheet to whatever the default browser style is
			// for such an element
			if ( elem.style.display === "" && isHidden( elem ) ) {
				values[ index ] =
					jQuery._data( elem, "olddisplay", defaultDisplay( elem.nodeName ) );
			}
		} else {
			hidden = isHidden( elem );

			if ( display && display !== "none" || !hidden ) {
				jQuery._data(
					elem,
					"olddisplay",
					hidden ? display : jQuery.css( elem, "display" )
				);
			}
		}
	}

	// Set the display of most of the elements in a second loop
	// to avoid the constant reflow
	for ( index = 0; index < length; index++ ) {
		elem = elements[ index ];
		if ( !elem.style ) {
			continue;
		}
		if ( !show || elem.style.display === "none" || elem.style.display === "" ) {
			elem.style.display = show ? values[ index ] || "" : "none";
		}
	}

	return elements;
}

function setPositiveNumber( elem, value, subtract ) {
	var matches = rnumsplit.exec( value );
	return matches ?

		// Guard against undefined "subtract", e.g., when used as in cssHooks
		Math.max( 0, matches[ 1 ] - ( subtract || 0 ) ) + ( matches[ 2 ] || "px" ) :
		value;
}

function augmentWidthOrHeight( elem, name, extra, isBorderBox, styles ) {
	var i = extra === ( isBorderBox ? "border" : "content" ) ?

		// If we already have the right measurement, avoid augmentation
		4 :

		// Otherwise initialize for horizontal or vertical properties
		name === "width" ? 1 : 0,

		val = 0;

	for ( ; i < 4; i += 2 ) {

		// both box models exclude margin, so add it if we want it
		if ( extra === "margin" ) {
			val += jQuery.css( elem, extra + cssExpand[ i ], true, styles );
		}

		if ( isBorderBox ) {

			// border-box includes padding, so remove it if we want content
			if ( extra === "content" ) {
				val -= jQuery.css( elem, "padding" + cssExpand[ i ], true, styles );
			}

			// at this point, extra isn't border nor margin, so remove border
			if ( extra !== "margin" ) {
				val -= jQuery.css( elem, "border" + cssExpand[ i ] + "Width", true, styles );
			}
		} else {

			// at this point, extra isn't content, so add padding
			val += jQuery.css( elem, "padding" + cssExpand[ i ], true, styles );

			// at this point, extra isn't content nor padding, so add border
			if ( extra !== "padding" ) {
				val += jQuery.css( elem, "border" + cssExpand[ i ] + "Width", true, styles );
			}
		}
	}

	return val;
}

function getWidthOrHeight( elem, name, extra ) {

	// Start with offset property, which is equivalent to the border-box value
	var valueIsBorderBox = true,
		val = name === "width" ? elem.offsetWidth : elem.offsetHeight,
		styles = getStyles( elem ),
		isBorderBox = support.boxSizing &&
			jQuery.css( elem, "boxSizing", false, styles ) === "border-box";

	// some non-html elements return undefined for offsetWidth, so check for null/undefined
	// svg - https://bugzilla.mozilla.org/show_bug.cgi?id=649285
	// MathML - https://bugzilla.mozilla.org/show_bug.cgi?id=491668
	if ( val <= 0 || val == null ) {

		// Fall back to computed then uncomputed css if necessary
		val = curCSS( elem, name, styles );
		if ( val < 0 || val == null ) {
			val = elem.style[ name ];
		}

		// Computed unit is not pixels. Stop here and return.
		if ( rnumnonpx.test( val ) ) {
			return val;
		}

		// we need the check for style in case a browser which returns unreliable values
		// for getComputedStyle silently falls back to the reliable elem.style
		valueIsBorderBox = isBorderBox &&
			( support.boxSizingReliable() || val === elem.style[ name ] );

		// Normalize "", auto, and prepare for extra
		val = parseFloat( val ) || 0;
	}

	// use the active box-sizing model to add/subtract irrelevant styles
	return ( val +
		augmentWidthOrHeight(
			elem,
			name,
			extra || ( isBorderBox ? "border" : "content" ),
			valueIsBorderBox,
			styles
		)
	) + "px";
}

jQuery.extend( {

	// Add in style property hooks for overriding the default
	// behavior of getting and setting a style property
	cssHooks: {
		opacity: {
			get: function( elem, computed ) {
				if ( computed ) {

					// We should always get a number back from opacity
					var ret = curCSS( elem, "opacity" );
					return ret === "" ? "1" : ret;
				}
			}
		}
	},

	// Don't automatically add "px" to these possibly-unitless properties
	cssNumber: {
		"animationIterationCount": true,
		"columnCount": true,
		"fillOpacity": true,
		"flexGrow": true,
		"flexShrink": true,
		"fontWeight": true,
		"lineHeight": true,
		"opacity": true,
		"order": true,
		"orphans": true,
		"widows": true,
		"zIndex": true,
		"zoom": true
	},

	// Add in properties whose names you wish to fix before
	// setting or getting the value
	cssProps: {

		// normalize float css property
		"float": support.cssFloat ? "cssFloat" : "styleFloat"
	},

	// Get and set the style property on a DOM Node
	style: function( elem, name, value, extra ) {

		// Don't set styles on text and comment nodes
		if ( !elem || elem.nodeType === 3 || elem.nodeType === 8 || !elem.style ) {
			return;
		}

		// Make sure that we're working with the right name
		var ret, type, hooks,
			origName = jQuery.camelCase( name ),
			style = elem.style;

		name = jQuery.cssProps[ origName ] ||
			( jQuery.cssProps[ origName ] = vendorPropName( origName ) || origName );

		// gets hook for the prefixed version
		// followed by the unprefixed version
		hooks = jQuery.cssHooks[ name ] || jQuery.cssHooks[ origName ];

		// Check if we're setting a value
		if ( value !== undefined ) {
			type = typeof value;

			// Convert "+=" or "-=" to relative numbers (#7345)
			if ( type === "string" && ( ret = rcssNum.exec( value ) ) && ret[ 1 ] ) {
				value = adjustCSS( elem, name, ret );

				// Fixes bug #9237
				type = "number";
			}

			// Make sure that null and NaN values aren't set. See: #7116
			if ( value == null || value !== value ) {
				return;
			}

			// If a number was passed in, add the unit (except for certain CSS properties)
			if ( type === "number" ) {
				value += ret && ret[ 3 ] || ( jQuery.cssNumber[ origName ] ? "" : "px" );
			}

			// Fixes #8908, it can be done more correctly by specifing setters in cssHooks,
			// but it would mean to define eight
			// (for every problematic property) identical functions
			if ( !support.clearCloneStyle && value === "" && name.indexOf( "background" ) === 0 ) {
				style[ name ] = "inherit";
			}

			// If a hook was provided, use that value, otherwise just set the specified value
			if ( !hooks || !( "set" in hooks ) ||
				( value = hooks.set( elem, value, extra ) ) !== undefined ) {

				// Support: IE
				// Swallow errors from 'invalid' CSS values (#5509)
				try {
					style[ name ] = value;
				} catch ( e ) {}
			}

		} else {

			// If a hook was provided get the non-computed value from there
			if ( hooks && "get" in hooks &&
				( ret = hooks.get( elem, false, extra ) ) !== undefined ) {

				return ret;
			}

			// Otherwise just get the value from the style object
			return style[ name ];
		}
	},

	css: function( elem, name, extra, styles ) {
		var num, val, hooks,
			origName = jQuery.camelCase( name );

		// Make sure that we're working with the right name
		name = jQuery.cssProps[ origName ] ||
			( jQuery.cssProps[ origName ] = vendorPropName( origName ) || origName );

		// gets hook for the prefixed version
		// followed by the unprefixed version
		hooks = jQuery.cssHooks[ name ] || jQuery.cssHooks[ origName ];

		// If a hook was provided get the computed value from there
		if ( hooks && "get" in hooks ) {
			val = hooks.get( elem, true, extra );
		}

		// Otherwise, if a way to get the computed value exists, use that
		if ( val === undefined ) {
			val = curCSS( elem, name, styles );
		}

		//convert "normal" to computed value
		if ( val === "normal" && name in cssNormalTransform ) {
			val = cssNormalTransform[ name ];
		}

		// Return, converting to number if forced or a qualifier was provided and val looks numeric
		if ( extra === "" || extra ) {
			num = parseFloat( val );
			return extra === true || isFinite( num ) ? num || 0 : val;
		}
		return val;
	}
} );

jQuery.each( [ "height", "width" ], function( i, name ) {
	jQuery.cssHooks[ name ] = {
		get: function( elem, computed, extra ) {
			if ( computed ) {

				// certain elements can have dimension info if we invisibly show them
				// however, it must have a current display style that would benefit from this
				return rdisplayswap.test( jQuery.css( elem, "display" ) ) &&
					elem.offsetWidth === 0 ?
						swap( elem, cssShow, function() {
							return getWidthOrHeight( elem, name, extra );
						} ) :
						getWidthOrHeight( elem, name, extra );
			}
		},

		set: function( elem, value, extra ) {
			var styles = extra && getStyles( elem );
			return setPositiveNumber( elem, value, extra ?
				augmentWidthOrHeight(
					elem,
					name,
					extra,
					support.boxSizing &&
						jQuery.css( elem, "boxSizing", false, styles ) === "border-box",
					styles
				) : 0
			);
		}
	};
} );

if ( !support.opacity ) {
	jQuery.cssHooks.opacity = {
		get: function( elem, computed ) {

			// IE uses filters for opacity
			return ropacity.test( ( computed && elem.currentStyle ?
				elem.currentStyle.filter :
				elem.style.filter ) || "" ) ?
					( 0.01 * parseFloat( RegExp.$1 ) ) + "" :
					computed ? "1" : "";
		},

		set: function( elem, value ) {
			var style = elem.style,
				currentStyle = elem.currentStyle,
				opacity = jQuery.isNumeric( value ) ? "alpha(opacity=" + value * 100 + ")" : "",
				filter = currentStyle && currentStyle.filter || style.filter || "";

			// IE has trouble with opacity if it does not have layout
			// Force it by setting the zoom level
			style.zoom = 1;

			// if setting opacity to 1, and no other filters exist -
			// attempt to remove filter attribute #6652
			// if value === "", then remove inline opacity #12685
			if ( ( value >= 1 || value === "" ) &&
					jQuery.trim( filter.replace( ralpha, "" ) ) === "" &&
					style.removeAttribute ) {

				// Setting style.filter to null, "" & " " still leave "filter:" in the cssText
				// if "filter:" is present at all, clearType is disabled, we want to avoid this
				// style.removeAttribute is IE Only, but so apparently is this code path...
				style.removeAttribute( "filter" );

				// if there is no filter style applied in a css rule
				// or unset inline opacity, we are done
				if ( value === "" || currentStyle && !currentStyle.filter ) {
					return;
				}
			}

			// otherwise, set new filter values
			style.filter = ralpha.test( filter ) ?
				filter.replace( ralpha, opacity ) :
				filter + " " + opacity;
		}
	};
}

jQuery.cssHooks.marginRight = addGetHookIf( support.reliableMarginRight,
	function( elem, computed ) {
		if ( computed ) {
			return swap( elem, { "display": "inline-block" },
				curCSS, [ elem, "marginRight" ] );
		}
	}
);

jQuery.cssHooks.marginLeft = addGetHookIf( support.reliableMarginLeft,
	function( elem, computed ) {
		if ( computed ) {
			return (
				parseFloat( curCSS( elem, "marginLeft" ) ) ||

				// Support: IE<=11+
				// Running getBoundingClientRect on a disconnected node in IE throws an error
				// Support: IE8 only
				// getClientRects() errors on disconnected elems
				( jQuery.contains( elem.ownerDocument, elem ) ?
					elem.getBoundingClientRect().left -
						swap( elem, { marginLeft: 0 }, function() {
							return elem.getBoundingClientRect().left;
						} ) :
					0
				)
			) + "px";
		}
	}
);

// These hooks are used by animate to expand properties
jQuery.each( {
	margin: "",
	padding: "",
	border: "Width"
}, function( prefix, suffix ) {
	jQuery.cssHooks[ prefix + suffix ] = {
		expand: function( value ) {
			var i = 0,
				expanded = {},

				// assumes a single number if not a string
				parts = typeof value === "string" ? value.split( " " ) : [ value ];

			for ( ; i < 4; i++ ) {
				expanded[ prefix + cssExpand[ i ] + suffix ] =
					parts[ i ] || parts[ i - 2 ] || parts[ 0 ];
			}

			return expanded;
		}
	};

	if ( !rmargin.test( prefix ) ) {
		jQuery.cssHooks[ prefix + suffix ].set = setPositiveNumber;
	}
} );

jQuery.fn.extend( {
	css: function( name, value ) {
		return access( this, function( elem, name, value ) {
			var styles, len,
				map = {},
				i = 0;

			if ( jQuery.isArray( name ) ) {
				styles = getStyles( elem );
				len = name.length;

				for ( ; i < len; i++ ) {
					map[ name[ i ] ] = jQuery.css( elem, name[ i ], false, styles );
				}

				return map;
			}

			return value !== undefined ?
				jQuery.style( elem, name, value ) :
				jQuery.css( elem, name );
		}, name, value, arguments.length > 1 );
	},
	show: function() {
		return showHide( this, true );
	},
	hide: function() {
		return showHide( this );
	},
	toggle: function( state ) {
		if ( typeof state === "boolean" ) {
			return state ? this.show() : this.hide();
		}

		return this.each( function() {
			if ( isHidden( this ) ) {
				jQuery( this ).show();
			} else {
				jQuery( this ).hide();
			}
		} );
	}
} );


function Tween( elem, options, prop, end, easing ) {
	return new Tween.prototype.init( elem, options, prop, end, easing );
}
jQuery.Tween = Tween;

Tween.prototype = {
	constructor: Tween,
	init: function( elem, options, prop, end, easing, unit ) {
		this.elem = elem;
		this.prop = prop;
		this.easing = easing || jQuery.easing._default;
		this.options = options;
		this.start = this.now = this.cur();
		this.end = end;
		this.unit = unit || ( jQuery.cssNumber[ prop ] ? "" : "px" );
	},
	cur: function() {
		var hooks = Tween.propHooks[ this.prop ];

		return hooks && hooks.get ?
			hooks.get( this ) :
			Tween.propHooks._default.get( this );
	},
	run: function( percent ) {
		var eased,
			hooks = Tween.propHooks[ this.prop ];

		if ( this.options.duration ) {
			this.pos = eased = jQuery.easing[ this.easing ](
				percent, this.options.duration * percent, 0, 1, this.options.duration
			);
		} else {
			this.pos = eased = percent;
		}
		this.now = ( this.end - this.start ) * eased + this.start;

		if ( this.options.step ) {
			this.options.step.call( this.elem, this.now, this );
		}

		if ( hooks && hooks.set ) {
			hooks.set( this );
		} else {
			Tween.propHooks._default.set( this );
		}
		return this;
	}
};

Tween.prototype.init.prototype = Tween.prototype;

Tween.propHooks = {
	_default: {
		get: function( tween ) {
			var result;

			// Use a property on the element directly when it is not a DOM element,
			// or when there is no matching style property that exists.
			if ( tween.elem.nodeType !== 1 ||
				tween.elem[ tween.prop ] != null && tween.elem.style[ tween.prop ] == null ) {
				return tween.elem[ tween.prop ];
			}

			// passing an empty string as a 3rd parameter to .css will automatically
			// attempt a parseFloat and fallback to a string if the parse fails
			// so, simple values such as "10px" are parsed to Float.
			// complex values such as "rotate(1rad)" are returned as is.
			result = jQuery.css( tween.elem, tween.prop, "" );

			// Empty strings, null, undefined and "auto" are converted to 0.
			return !result || result === "auto" ? 0 : result;
		},
		set: function( tween ) {

			// use step hook for back compat - use cssHook if its there - use .style if its
			// available and use plain properties where available
			if ( jQuery.fx.step[ tween.prop ] ) {
				jQuery.fx.step[ tween.prop ]( tween );
			} else if ( tween.elem.nodeType === 1 &&
				( tween.elem.style[ jQuery.cssProps[ tween.prop ] ] != null ||
					jQuery.cssHooks[ tween.prop ] ) ) {
				jQuery.style( tween.elem, tween.prop, tween.now + tween.unit );
			} else {
				tween.elem[ tween.prop ] = tween.now;
			}
		}
	}
};

// Support: IE <=9
// Panic based approach to setting things on disconnected nodes

Tween.propHooks.scrollTop = Tween.propHooks.scrollLeft = {
	set: function( tween ) {
		if ( tween.elem.nodeType && tween.elem.parentNode ) {
			tween.elem[ tween.prop ] = tween.now;
		}
	}
};

jQuery.easing = {
	linear: function( p ) {
		return p;
	},
	swing: function( p ) {
		return 0.5 - Math.cos( p * Math.PI ) / 2;
	},
	_default: "swing"
};

jQuery.fx = Tween.prototype.init;

// Back Compat <1.8 extension point
jQuery.fx.step = {};




var
	fxNow, timerId,
	rfxtypes = /^(?:toggle|show|hide)$/,
	rrun = /queueHooks$/;

// Animations created synchronously will run synchronously
function createFxNow() {
	window.setTimeout( function() {
		fxNow = undefined;
	} );
	return ( fxNow = jQuery.now() );
}

// Generate parameters to create a standard animation
function genFx( type, includeWidth ) {
	var which,
		attrs = { height: type },
		i = 0;

	// if we include width, step value is 1 to do all cssExpand values,
	// if we don't include width, step value is 2 to skip over Left and Right
	includeWidth = includeWidth ? 1 : 0;
	for ( ; i < 4 ; i += 2 - includeWidth ) {
		which = cssExpand[ i ];
		attrs[ "margin" + which ] = attrs[ "padding" + which ] = type;
	}

	if ( includeWidth ) {
		attrs.opacity = attrs.width = type;
	}

	return attrs;
}

function createTween( value, prop, animation ) {
	var tween,
		collection = ( Animation.tweeners[ prop ] || [] ).concat( Animation.tweeners[ "*" ] ),
		index = 0,
		length = collection.length;
	for ( ; index < length; index++ ) {
		if ( ( tween = collection[ index ].call( animation, prop, value ) ) ) {

			// we're done with this property
			return tween;
		}
	}
}

function defaultPrefilter( elem, props, opts ) {
	/* jshint validthis: true */
	var prop, value, toggle, tween, hooks, oldfire, display, checkDisplay,
		anim = this,
		orig = {},
		style = elem.style,
		hidden = elem.nodeType && isHidden( elem ),
		dataShow = jQuery._data( elem, "fxshow" );

	// handle queue: false promises
	if ( !opts.queue ) {
		hooks = jQuery._queueHooks( elem, "fx" );
		if ( hooks.unqueued == null ) {
			hooks.unqueued = 0;
			oldfire = hooks.empty.fire;
			hooks.empty.fire = function() {
				if ( !hooks.unqueued ) {
					oldfire();
				}
			};
		}
		hooks.unqueued++;

		anim.always( function() {

			// doing this makes sure that the complete handler will be called
			// before this completes
			anim.always( function() {
				hooks.unqueued--;
				if ( !jQuery.queue( elem, "fx" ).length ) {
					hooks.empty.fire();
				}
			} );
		} );
	}

	// height/width overflow pass
	if ( elem.nodeType === 1 && ( "height" in props || "width" in props ) ) {

		// Make sure that nothing sneaks out
		// Record all 3 overflow attributes because IE does not
		// change the overflow attribute when overflowX and
		// overflowY are set to the same value
		opts.overflow = [ style.overflow, style.overflowX, style.overflowY ];

		// Set display property to inline-block for height/width
		// animations on inline elements that are having width/height animated
		display = jQuery.css( elem, "display" );

		// Test default display if display is currently "none"
		checkDisplay = display === "none" ?
			jQuery._data( elem, "olddisplay" ) || defaultDisplay( elem.nodeName ) : display;

		if ( checkDisplay === "inline" && jQuery.css( elem, "float" ) === "none" ) {

			// inline-level elements accept inline-block;
			// block-level elements need to be inline with layout
			if ( !support.inlineBlockNeedsLayout || defaultDisplay( elem.nodeName ) === "inline" ) {
				style.display = "inline-block";
			} else {
				style.zoom = 1;
			}
		}
	}

	if ( opts.overflow ) {
		style.overflow = "hidden";
		if ( !support.shrinkWrapBlocks() ) {
			anim.always( function() {
				style.overflow = opts.overflow[ 0 ];
				style.overflowX = opts.overflow[ 1 ];
				style.overflowY = opts.overflow[ 2 ];
			} );
		}
	}

	// show/hide pass
	for ( prop in props ) {
		value = props[ prop ];
		if ( rfxtypes.exec( value ) ) {
			delete props[ prop ];
			toggle = toggle || value === "toggle";
			if ( value === ( hidden ? "hide" : "show" ) ) {

				// If there is dataShow left over from a stopped hide or show
				// and we are going to proceed with show, we should pretend to be hidden
				if ( value === "show" && dataShow && dataShow[ prop ] !== undefined ) {
					hidden = true;
				} else {
					continue;
				}
			}
			orig[ prop ] = dataShow && dataShow[ prop ] || jQuery.style( elem, prop );

		// Any non-fx value stops us from restoring the original display value
		} else {
			display = undefined;
		}
	}

	if ( !jQuery.isEmptyObject( orig ) ) {
		if ( dataShow ) {
			if ( "hidden" in dataShow ) {
				hidden = dataShow.hidden;
			}
		} else {
			dataShow = jQuery._data( elem, "fxshow", {} );
		}

		// store state if its toggle - enables .stop().toggle() to "reverse"
		if ( toggle ) {
			dataShow.hidden = !hidden;
		}
		if ( hidden ) {
			jQuery( elem ).show();
		} else {
			anim.done( function() {
				jQuery( elem ).hide();
			} );
		}
		anim.done( function() {
			var prop;
			jQuery._removeData( elem, "fxshow" );
			for ( prop in orig ) {
				jQuery.style( elem, prop, orig[ prop ] );
			}
		} );
		for ( prop in orig ) {
			tween = createTween( hidden ? dataShow[ prop ] : 0, prop, anim );

			if ( !( prop in dataShow ) ) {
				dataShow[ prop ] = tween.start;
				if ( hidden ) {
					tween.end = tween.start;
					tween.start = prop === "width" || prop === "height" ? 1 : 0;
				}
			}
		}

	// If this is a noop like .hide().hide(), restore an overwritten display value
	} else if ( ( display === "none" ? defaultDisplay( elem.nodeName ) : display ) === "inline" ) {
		style.display = display;
	}
}

function propFilter( props, specialEasing ) {
	var index, name, easing, value, hooks;

	// camelCase, specialEasing and expand cssHook pass
	for ( index in props ) {
		name = jQuery.camelCase( index );
		easing = specialEasing[ name ];
		value = props[ index ];
		if ( jQuery.isArray( value ) ) {
			easing = value[ 1 ];
			value = props[ index ] = value[ 0 ];
		}

		if ( index !== name ) {
			props[ name ] = value;
			delete props[ index ];
		}

		hooks = jQuery.cssHooks[ name ];
		if ( hooks && "expand" in hooks ) {
			value = hooks.expand( value );
			delete props[ name ];

			// not quite $.extend, this wont overwrite keys already present.
			// also - reusing 'index' from above because we have the correct "name"
			for ( index in value ) {
				if ( !( index in props ) ) {
					props[ index ] = value[ index ];
					specialEasing[ index ] = easing;
				}
			}
		} else {
			specialEasing[ name ] = easing;
		}
	}
}

function Animation( elem, properties, options ) {
	var result,
		stopped,
		index = 0,
		length = Animation.prefilters.length,
		deferred = jQuery.Deferred().always( function() {

			// don't match elem in the :animated selector
			delete tick.elem;
		} ),
		tick = function() {
			if ( stopped ) {
				return false;
			}
			var currentTime = fxNow || createFxNow(),
				remaining = Math.max( 0, animation.startTime + animation.duration - currentTime ),

				// Support: Android 2.3
				// Archaic crash bug won't allow us to use `1 - ( 0.5 || 0 )` (#12497)
				temp = remaining / animation.duration || 0,
				percent = 1 - temp,
				index = 0,
				length = animation.tweens.length;

			for ( ; index < length ; index++ ) {
				animation.tweens[ index ].run( percent );
			}

			deferred.notifyWith( elem, [ animation, percent, remaining ] );

			if ( percent < 1 && length ) {
				return remaining;
			} else {
				deferred.resolveWith( elem, [ animation ] );
				return false;
			}
		},
		animation = deferred.promise( {
			elem: elem,
			props: jQuery.extend( {}, properties ),
			opts: jQuery.extend( true, {
				specialEasing: {},
				easing: jQuery.easing._default
			}, options ),
			originalProperties: properties,
			originalOptions: options,
			startTime: fxNow || createFxNow(),
			duration: options.duration,
			tweens: [],
			createTween: function( prop, end ) {
				var tween = jQuery.Tween( elem, animation.opts, prop, end,
						animation.opts.specialEasing[ prop ] || animation.opts.easing );
				animation.tweens.push( tween );
				return tween;
			},
			stop: function( gotoEnd ) {
				var index = 0,

					// if we are going to the end, we want to run all the tweens
					// otherwise we skip this part
					length = gotoEnd ? animation.tweens.length : 0;
				if ( stopped ) {
					return this;
				}
				stopped = true;
				for ( ; index < length ; index++ ) {
					animation.tweens[ index ].run( 1 );
				}

				// resolve when we played the last frame
				// otherwise, reject
				if ( gotoEnd ) {
					deferred.notifyWith( elem, [ animation, 1, 0 ] );
					deferred.resolveWith( elem, [ animation, gotoEnd ] );
				} else {
					deferred.rejectWith( elem, [ animation, gotoEnd ] );
				}
				return this;
			}
		} ),
		props = animation.props;

	propFilter( props, animation.opts.specialEasing );

	for ( ; index < length ; index++ ) {
		result = Animation.prefilters[ index ].call( animation, elem, props, animation.opts );
		if ( result ) {
			if ( jQuery.isFunction( result.stop ) ) {
				jQuery._queueHooks( animation.elem, animation.opts.queue ).stop =
					jQuery.proxy( result.stop, result );
			}
			return result;
		}
	}

	jQuery.map( props, createTween, animation );

	if ( jQuery.isFunction( animation.opts.start ) ) {
		animation.opts.start.call( elem, animation );
	}

	jQuery.fx.timer(
		jQuery.extend( tick, {
			elem: elem,
			anim: animation,
			queue: animation.opts.queue
		} )
	);

	// attach callbacks from options
	return animation.progress( animation.opts.progress )
		.done( animation.opts.done, animation.opts.complete )
		.fail( animation.opts.fail )
		.always( animation.opts.always );
}

jQuery.Animation = jQuery.extend( Animation, {

	tweeners: {
		"*": [ function( prop, value ) {
			var tween = this.createTween( prop, value );
			adjustCSS( tween.elem, prop, rcssNum.exec( value ), tween );
			return tween;
		} ]
	},

	tweener: function( props, callback ) {
		if ( jQuery.isFunction( props ) ) {
			callback = props;
			props = [ "*" ];
		} else {
			props = props.match( rnotwhite );
		}

		var prop,
			index = 0,
			length = props.length;

		for ( ; index < length ; index++ ) {
			prop = props[ index ];
			Animation.tweeners[ prop ] = Animation.tweeners[ prop ] || [];
			Animation.tweeners[ prop ].unshift( callback );
		}
	},

	prefilters: [ defaultPrefilter ],

	prefilter: function( callback, prepend ) {
		if ( prepend ) {
			Animation.prefilters.unshift( callback );
		} else {
			Animation.prefilters.push( callback );
		}
	}
} );

jQuery.speed = function( speed, easing, fn ) {
	var opt = speed && typeof speed === "object" ? jQuery.extend( {}, speed ) : {
		complete: fn || !fn && easing ||
			jQuery.isFunction( speed ) && speed,
		duration: speed,
		easing: fn && easing || easing && !jQuery.isFunction( easing ) && easing
	};

	opt.duration = jQuery.fx.off ? 0 : typeof opt.duration === "number" ? opt.duration :
		opt.duration in jQuery.fx.speeds ?
			jQuery.fx.speeds[ opt.duration ] : jQuery.fx.speeds._default;

	// normalize opt.queue - true/undefined/null -> "fx"
	if ( opt.queue == null || opt.queue === true ) {
		opt.queue = "fx";
	}

	// Queueing
	opt.old = opt.complete;

	opt.complete = function() {
		if ( jQuery.isFunction( opt.old ) ) {
			opt.old.call( this );
		}

		if ( opt.queue ) {
			jQuery.dequeue( this, opt.queue );
		}
	};

	return opt;
};

jQuery.fn.extend( {
	fadeTo: function( speed, to, easing, callback ) {

		// show any hidden elements after setting opacity to 0
		return this.filter( isHidden ).css( "opacity", 0 ).show()

			// animate to the value specified
			.end().animate( { opacity: to }, speed, easing, callback );
	},
	animate: function( prop, speed, easing, callback ) {
		var empty = jQuery.isEmptyObject( prop ),
			optall = jQuery.speed( speed, easing, callback ),
			doAnimation = function() {

				// Operate on a copy of prop so per-property easing won't be lost
				var anim = Animation( this, jQuery.extend( {}, prop ), optall );

				// Empty animations, or finishing resolves immediately
				if ( empty || jQuery._data( this, "finish" ) ) {
					anim.stop( true );
				}
			};
			doAnimation.finish = doAnimation;

		return empty || optall.queue === false ?
			this.each( doAnimation ) :
			this.queue( optall.queue, doAnimation );
	},
	stop: function( type, clearQueue, gotoEnd ) {
		var stopQueue = function( hooks ) {
			var stop = hooks.stop;
			delete hooks.stop;
			stop( gotoEnd );
		};

		if ( typeof type !== "string" ) {
			gotoEnd = clearQueue;
			clearQueue = type;
			type = undefined;
		}
		if ( clearQueue && type !== false ) {
			this.queue( type || "fx", [] );
		}

		return this.each( function() {
			var dequeue = true,
				index = type != null && type + "queueHooks",
				timers = jQuery.timers,
				data = jQuery._data( this );

			if ( index ) {
				if ( data[ index ] && data[ index ].stop ) {
					stopQueue( data[ index ] );
				}
			} else {
				for ( index in data ) {
					if ( data[ index ] && data[ index ].stop && rrun.test( index ) ) {
						stopQueue( data[ index ] );
					}
				}
			}

			for ( index = timers.length; index--; ) {
				if ( timers[ index ].elem === this &&
					( type == null || timers[ index ].queue === type ) ) {

					timers[ index ].anim.stop( gotoEnd );
					dequeue = false;
					timers.splice( index, 1 );
				}
			}

			// start the next in the queue if the last step wasn't forced
			// timers currently will call their complete callbacks, which will dequeue
			// but only if they were gotoEnd
			if ( dequeue || !gotoEnd ) {
				jQuery.dequeue( this, type );
			}
		} );
	},
	finish: function( type ) {
		if ( type !== false ) {
			type = type || "fx";
		}
		return this.each( function() {
			var index,
				data = jQuery._data( this ),
				queue = data[ type + "queue" ],
				hooks = data[ type + "queueHooks" ],
				timers = jQuery.timers,
				length = queue ? queue.length : 0;

			// enable finishing flag on private data
			data.finish = true;

			// empty the queue first
			jQuery.queue( this, type, [] );

			if ( hooks && hooks.stop ) {
				hooks.stop.call( this, true );
			}

			// look for any active animations, and finish them
			for ( index = timers.length; index--; ) {
				if ( timers[ index ].elem === this && timers[ index ].queue === type ) {
					timers[ index ].anim.stop( true );
					timers.splice( index, 1 );
				}
			}

			// look for any animations in the old queue and finish them
			for ( index = 0; index < length; index++ ) {
				if ( queue[ index ] && queue[ index ].finish ) {
					queue[ index ].finish.call( this );
				}
			}

			// turn off finishing flag
			delete data.finish;
		} );
	}
} );

jQuery.each( [ "toggle", "show", "hide" ], function( i, name ) {
	var cssFn = jQuery.fn[ name ];
	jQuery.fn[ name ] = function( speed, easing, callback ) {
		return speed == null || typeof speed === "boolean" ?
			cssFn.apply( this, arguments ) :
			this.animate( genFx( name, true ), speed, easing, callback );
	};
} );

// Generate shortcuts for custom animations
jQuery.each( {
	slideDown: genFx( "show" ),
	slideUp: genFx( "hide" ),
	slideToggle: genFx( "toggle" ),
	fadeIn: { opacity: "show" },
	fadeOut: { opacity: "hide" },
	fadeToggle: { opacity: "toggle" }
}, function( name, props ) {
	jQuery.fn[ name ] = function( speed, easing, callback ) {
		return this.animate( props, speed, easing, callback );
	};
} );

jQuery.timers = [];
jQuery.fx.tick = function() {
	var timer,
		timers = jQuery.timers,
		i = 0;

	fxNow = jQuery.now();

	for ( ; i < timers.length; i++ ) {
		timer = timers[ i ];

		// Checks the timer has not already been removed
		if ( !timer() && timers[ i ] === timer ) {
			timers.splice( i--, 1 );
		}
	}

	if ( !timers.length ) {
		jQuery.fx.stop();
	}
	fxNow = undefined;
};

jQuery.fx.timer = function( timer ) {
	jQuery.timers.push( timer );
	if ( timer() ) {
		jQuery.fx.start();
	} else {
		jQuery.timers.pop();
	}
};

jQuery.fx.interval = 13;

jQuery.fx.start = function() {
	if ( !timerId ) {
		timerId = window.setInterval( jQuery.fx.tick, jQuery.fx.interval );
	}
};

jQuery.fx.stop = function() {
	window.clearInterval( timerId );
	timerId = null;
};

jQuery.fx.speeds = {
	slow: 600,
	fast: 200,

	// Default speed
	_default: 400
};


// Based off of the plugin by Clint Helfers, with permission.
// http://web.archive.org/web/20100324014747/http://blindsignals.com/index.php/2009/07/jquery-delay/
jQuery.fn.delay = function( time, type ) {
	time = jQuery.fx ? jQuery.fx.speeds[ time ] || time : time;
	type = type || "fx";

	return this.queue( type, function( next, hooks ) {
		var timeout = window.setTimeout( next, time );
		hooks.stop = function() {
			window.clearTimeout( timeout );
		};
	} );
};


( function() {
	var a,
		input = document.createElement( "input" ),
		div = document.createElement( "div" ),
		select = document.createElement( "select" ),
		opt = select.appendChild( document.createElement( "option" ) );

	// Setup
	div = document.createElement( "div" );
	div.setAttribute( "className", "t" );
	div.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";
	a = div.getElementsByTagName( "a" )[ 0 ];

	// Support: Windows Web Apps (WWA)
	// `type` must use .setAttribute for WWA (#14901)
	input.setAttribute( "type", "checkbox" );
	div.appendChild( input );

	a = div.getElementsByTagName( "a" )[ 0 ];

	// First batch of tests.
	a.style.cssText = "top:1px";

	// Test setAttribute on camelCase class.
	// If it works, we need attrFixes when doing get/setAttribute (ie6/7)
	support.getSetAttribute = div.className !== "t";

	// Get the style information from getAttribute
	// (IE uses .cssText instead)
	support.style = /top/.test( a.getAttribute( "style" ) );

	// Make sure that URLs aren't manipulated
	// (IE normalizes it by default)
	support.hrefNormalized = a.getAttribute( "href" ) === "/a";

	// Check the default checkbox/radio value ("" on WebKit; "on" elsewhere)
	support.checkOn = !!input.value;

	// Make sure that a selected-by-default option has a working selected property.
	// (WebKit defaults to false instead of true, IE too, if it's in an optgroup)
	support.optSelected = opt.selected;

	// Tests for enctype support on a form (#6743)
	support.enctype = !!document.createElement( "form" ).enctype;

	// Make sure that the options inside disabled selects aren't marked as disabled
	// (WebKit marks them as disabled)
	select.disabled = true;
	support.optDisabled = !opt.disabled;

	// Support: IE8 only
	// Check if we can trust getAttribute("value")
	input = document.createElement( "input" );
	input.setAttribute( "value", "" );
	support.input = input.getAttribute( "value" ) === "";

	// Check if an input maintains its value after becoming a radio
	input.value = "t";
	input.setAttribute( "type", "radio" );
	support.radioValue = input.value === "t";
} )();


var rreturn = /\r/g,
	rspaces = /[\x20\t\r\n\f]+/g;

jQuery.fn.extend( {
	val: function( value ) {
		var hooks, ret, isFunction,
			elem = this[ 0 ];

		if ( !arguments.length ) {
			if ( elem ) {
				hooks = jQuery.valHooks[ elem.type ] ||
					jQuery.valHooks[ elem.nodeName.toLowerCase() ];

				if (
					hooks &&
					"get" in hooks &&
					( ret = hooks.get( elem, "value" ) ) !== undefined
				) {
					return ret;
				}

				ret = elem.value;

				return typeof ret === "string" ?

					// handle most common string cases
					ret.replace( rreturn, "" ) :

					// handle cases where value is null/undef or number
					ret == null ? "" : ret;
			}

			return;
		}

		isFunction = jQuery.isFunction( value );

		return this.each( function( i ) {
			var val;

			if ( this.nodeType !== 1 ) {
				return;
			}

			if ( isFunction ) {
				val = value.call( this, i, jQuery( this ).val() );
			} else {
				val = value;
			}

			// Treat null/undefined as ""; convert numbers to string
			if ( val == null ) {
				val = "";
			} else if ( typeof val === "number" ) {
				val += "";
			} else if ( jQuery.isArray( val ) ) {
				val = jQuery.map( val, function( value ) {
					return value == null ? "" : value + "";
				} );
			}

			hooks = jQuery.valHooks[ this.type ] || jQuery.valHooks[ this.nodeName.toLowerCase() ];

			// If set returns undefined, fall back to normal setting
			if ( !hooks || !( "set" in hooks ) || hooks.set( this, val, "value" ) === undefined ) {
				this.value = val;
			}
		} );
	}
} );

jQuery.extend( {
	valHooks: {
		option: {
			get: function( elem ) {
				var val = jQuery.find.attr( elem, "value" );
				return val != null ?
					val :

					// Support: IE10-11+
					// option.text throws exceptions (#14686, #14858)
					// Strip and collapse whitespace
					// https://html.spec.whatwg.org/#strip-and-collapse-whitespace
					jQuery.trim( jQuery.text( elem ) ).replace( rspaces, " " );
			}
		},
		select: {
			get: function( elem ) {
				var value, option,
					options = elem.options,
					index = elem.selectedIndex,
					one = elem.type === "select-one" || index < 0,
					values = one ? null : [],
					max = one ? index + 1 : options.length,
					i = index < 0 ?
						max :
						one ? index : 0;

				// Loop through all the selected options
				for ( ; i < max; i++ ) {
					option = options[ i ];

					// oldIE doesn't update selected after form reset (#2551)
					if ( ( option.selected || i === index ) &&

							// Don't return options that are disabled or in a disabled optgroup
							( support.optDisabled ?
								!option.disabled :
								option.getAttribute( "disabled" ) === null ) &&
							( !option.parentNode.disabled ||
								!jQuery.nodeName( option.parentNode, "optgroup" ) ) ) {

						// Get the specific value for the option
						value = jQuery( option ).val();

						// We don't need an array for one selects
						if ( one ) {
							return value;
						}

						// Multi-Selects return an array
						values.push( value );
					}
				}

				return values;
			},

			set: function( elem, value ) {
				var optionSet, option,
					options = elem.options,
					values = jQuery.makeArray( value ),
					i = options.length;

				while ( i-- ) {
					option = options[ i ];

					if ( jQuery.inArray( jQuery.valHooks.option.get( option ), values ) > -1 ) {

						// Support: IE6
						// When new option element is added to select box we need to
						// force reflow of newly added node in order to workaround delay
						// of initialization properties
						try {
							option.selected = optionSet = true;

						} catch ( _ ) {

							// Will be executed only in IE6
							option.scrollHeight;
						}

					} else {
						option.selected = false;
					}
				}

				// Force browsers to behave consistently when non-matching value is set
				if ( !optionSet ) {
					elem.selectedIndex = -1;
				}

				return options;
			}
		}
	}
} );

// Radios and checkboxes getter/setter
jQuery.each( [ "radio", "checkbox" ], function() {
	jQuery.valHooks[ this ] = {
		set: function( elem, value ) {
			if ( jQuery.isArray( value ) ) {
				return ( elem.checked = jQuery.inArray( jQuery( elem ).val(), value ) > -1 );
			}
		}
	};
	if ( !support.checkOn ) {
		jQuery.valHooks[ this ].get = function( elem ) {
			return elem.getAttribute( "value" ) === null ? "on" : elem.value;
		};
	}
} );




var nodeHook, boolHook,
	attrHandle = jQuery.expr.attrHandle,
	ruseDefault = /^(?:checked|selected)$/i,
	getSetAttribute = support.getSetAttribute,
	getSetInput = support.input;

jQuery.fn.extend( {
	attr: function( name, value ) {
		return access( this, jQuery.attr, name, value, arguments.length > 1 );
	},

	removeAttr: function( name ) {
		return this.each( function() {
			jQuery.removeAttr( this, name );
		} );
	}
} );

jQuery.extend( {
	attr: function( elem, name, value ) {
		var ret, hooks,
			nType = elem.nodeType;

		// Don't get/set attributes on text, comment and attribute nodes
		if ( nType === 3 || nType === 8 || nType === 2 ) {
			return;
		}

		// Fallback to prop when attributes are not supported
		if ( typeof elem.getAttribute === "undefined" ) {
			return jQuery.prop( elem, name, value );
		}

		// All attributes are lowercase
		// Grab necessary hook if one is defined
		if ( nType !== 1 || !jQuery.isXMLDoc( elem ) ) {
			name = name.toLowerCase();
			hooks = jQuery.attrHooks[ name ] ||
				( jQuery.expr.match.bool.test( name ) ? boolHook : nodeHook );
		}

		if ( value !== undefined ) {
			if ( value === null ) {
				jQuery.removeAttr( elem, name );
				return;
			}

			if ( hooks && "set" in hooks &&
				( ret = hooks.set( elem, value, name ) ) !== undefined ) {
				return ret;
			}

			elem.setAttribute( name, value + "" );
			return value;
		}

		if ( hooks && "get" in hooks && ( ret = hooks.get( elem, name ) ) !== null ) {
			return ret;
		}

		ret = jQuery.find.attr( elem, name );

		// Non-existent attributes return null, we normalize to undefined
		return ret == null ? undefined : ret;
	},

	attrHooks: {
		type: {
			set: function( elem, value ) {
				if ( !support.radioValue && value === "radio" &&
					jQuery.nodeName( elem, "input" ) ) {

					// Setting the type on a radio button after the value resets the value in IE8-9
					// Reset value to default in case type is set after value during creation
					var val = elem.value;
					elem.setAttribute( "type", value );
					if ( val ) {
						elem.value = val;
					}
					return value;
				}
			}
		}
	},

	removeAttr: function( elem, value ) {
		var name, propName,
			i = 0,
			attrNames = value && value.match( rnotwhite );

		if ( attrNames && elem.nodeType === 1 ) {
			while ( ( name = attrNames[ i++ ] ) ) {
				propName = jQuery.propFix[ name ] || name;

				// Boolean attributes get special treatment (#10870)
				if ( jQuery.expr.match.bool.test( name ) ) {

					// Set corresponding property to false
					if ( getSetInput && getSetAttribute || !ruseDefault.test( name ) ) {
						elem[ propName ] = false;

					// Support: IE<9
					// Also clear defaultChecked/defaultSelected (if appropriate)
					} else {
						elem[ jQuery.camelCase( "default-" + name ) ] =
							elem[ propName ] = false;
					}

				// See #9699 for explanation of this approach (setting first, then removal)
				} else {
					jQuery.attr( elem, name, "" );
				}

				elem.removeAttribute( getSetAttribute ? name : propName );
			}
		}
	}
} );

// Hooks for boolean attributes
boolHook = {
	set: function( elem, value, name ) {
		if ( value === false ) {

			// Remove boolean attributes when set to false
			jQuery.removeAttr( elem, name );
		} else if ( getSetInput && getSetAttribute || !ruseDefault.test( name ) ) {

			// IE<8 needs the *property* name
			elem.setAttribute( !getSetAttribute && jQuery.propFix[ name ] || name, name );

		} else {

			// Support: IE<9
			// Use defaultChecked and defaultSelected for oldIE
			elem[ jQuery.camelCase( "default-" + name ) ] = elem[ name ] = true;
		}
		return name;
	}
};

jQuery.each( jQuery.expr.match.bool.source.match( /\w+/g ), function( i, name ) {
	var getter = attrHandle[ name ] || jQuery.find.attr;

	if ( getSetInput && getSetAttribute || !ruseDefault.test( name ) ) {
		attrHandle[ name ] = function( elem, name, isXML ) {
			var ret, handle;
			if ( !isXML ) {

				// Avoid an infinite loop by temporarily removing this function from the getter
				handle = attrHandle[ name ];
				attrHandle[ name ] = ret;
				ret = getter( elem, name, isXML ) != null ?
					name.toLowerCase() :
					null;
				attrHandle[ name ] = handle;
			}
			return ret;
		};
	} else {
		attrHandle[ name ] = function( elem, name, isXML ) {
			if ( !isXML ) {
				return elem[ jQuery.camelCase( "default-" + name ) ] ?
					name.toLowerCase() :
					null;
			}
		};
	}
} );

// fix oldIE attroperties
if ( !getSetInput || !getSetAttribute ) {
	jQuery.attrHooks.value = {
		set: function( elem, value, name ) {
			if ( jQuery.nodeName( elem, "input" ) ) {

				// Does not return so that setAttribute is also used
				elem.defaultValue = value;
			} else {

				// Use nodeHook if defined (#1954); otherwise setAttribute is fine
				return nodeHook && nodeHook.set( elem, value, name );
			}
		}
	};
}

// IE6/7 do not support getting/setting some attributes with get/setAttribute
if ( !getSetAttribute ) {

	// Use this for any attribute in IE6/7
	// This fixes almost every IE6/7 issue
	nodeHook = {
		set: function( elem, value, name ) {

			// Set the existing or create a new attribute node
			var ret = elem.getAttributeNode( name );
			if ( !ret ) {
				elem.setAttributeNode(
					( ret = elem.ownerDocument.createAttribute( name ) )
				);
			}

			ret.value = value += "";

			// Break association with cloned elements by also using setAttribute (#9646)
			if ( name === "value" || value === elem.getAttribute( name ) ) {
				return value;
			}
		}
	};

	// Some attributes are constructed with empty-string values when not defined
	attrHandle.id = attrHandle.name = attrHandle.coords =
		function( elem, name, isXML ) {
			var ret;
			if ( !isXML ) {
				return ( ret = elem.getAttributeNode( name ) ) && ret.value !== "" ?
					ret.value :
					null;
			}
		};

	// Fixing value retrieval on a button requires this module
	jQuery.valHooks.button = {
		get: function( elem, name ) {
			var ret = elem.getAttributeNode( name );
			if ( ret && ret.specified ) {
				return ret.value;
			}
		},
		set: nodeHook.set
	};

	// Set contenteditable to false on removals(#10429)
	// Setting to empty string throws an error as an invalid value
	jQuery.attrHooks.contenteditable = {
		set: function( elem, value, name ) {
			nodeHook.set( elem, value === "" ? false : value, name );
		}
	};

	// Set width and height to auto instead of 0 on empty string( Bug #8150 )
	// This is for removals
	jQuery.each( [ "width", "height" ], function( i, name ) {
		jQuery.attrHooks[ name ] = {
			set: function( elem, value ) {
				if ( value === "" ) {
					elem.setAttribute( name, "auto" );
					return value;
				}
			}
		};
	} );
}

if ( !support.style ) {
	jQuery.attrHooks.style = {
		get: function( elem ) {

			// Return undefined in the case of empty string
			// Note: IE uppercases css property names, but if we were to .toLowerCase()
			// .cssText, that would destroy case sensitivity in URL's, like in "background"
			return elem.style.cssText || undefined;
		},
		set: function( elem, value ) {
			return ( elem.style.cssText = value + "" );
		}
	};
}




var rfocusable = /^(?:input|select|textarea|button|object)$/i,
	rclickable = /^(?:a|area)$/i;

jQuery.fn.extend( {
	prop: function( name, value ) {
		return access( this, jQuery.prop, name, value, arguments.length > 1 );
	},

	removeProp: function( name ) {
		name = jQuery.propFix[ name ] || name;
		return this.each( function() {

			// try/catch handles cases where IE balks (such as removing a property on window)
			try {
				this[ name ] = undefined;
				delete this[ name ];
			} catch ( e ) {}
		} );
	}
} );

jQuery.extend( {
	prop: function( elem, name, value ) {
		var ret, hooks,
			nType = elem.nodeType;

		// Don't get/set properties on text, comment and attribute nodes
		if ( nType === 3 || nType === 8 || nType === 2 ) {
			return;
		}

		if ( nType !== 1 || !jQuery.isXMLDoc( elem ) ) {

			// Fix name and attach hooks
			name = jQuery.propFix[ name ] || name;
			hooks = jQuery.propHooks[ name ];
		}

		if ( value !== undefined ) {
			if ( hooks && "set" in hooks &&
				( ret = hooks.set( elem, value, name ) ) !== undefined ) {
				return ret;
			}

			return ( elem[ name ] = value );
		}

		if ( hooks && "get" in hooks && ( ret = hooks.get( elem, name ) ) !== null ) {
			return ret;
		}

		return elem[ name ];
	},

	propHooks: {
		tabIndex: {
			get: function( elem ) {

				// elem.tabIndex doesn't always return the
				// correct value when it hasn't been explicitly set
				// http://fluidproject.org/blog/2008/01/09/getting-setting-and-removing-tabindex-values-with-javascript/
				// Use proper attribute retrieval(#12072)
				var tabindex = jQuery.find.attr( elem, "tabindex" );

				return tabindex ?
					parseInt( tabindex, 10 ) :
					rfocusable.test( elem.nodeName ) ||
						rclickable.test( elem.nodeName ) && elem.href ?
							0 :
							-1;
			}
		}
	},

	propFix: {
		"for": "htmlFor",
		"class": "className"
	}
} );

// Some attributes require a special call on IE
// http://msdn.microsoft.com/en-us/library/ms536429%28VS.85%29.aspx
if ( !support.hrefNormalized ) {

	// href/src property should get the full normalized URL (#10299/#12915)
	jQuery.each( [ "href", "src" ], function( i, name ) {
		jQuery.propHooks[ name ] = {
			get: function( elem ) {
				return elem.getAttribute( name, 4 );
			}
		};
	} );
}

// Support: Safari, IE9+
// Accessing the selectedIndex property
// forces the browser to respect setting selected
// on the option
// The getter ensures a default option is selected
// when in an optgroup
if ( !support.optSelected ) {
	jQuery.propHooks.selected = {
		get: function( elem ) {
			var parent = elem.parentNode;

			if ( parent ) {
				parent.selectedIndex;

				// Make sure that it also works with optgroups, see #5701
				if ( parent.parentNode ) {
					parent.parentNode.selectedIndex;
				}
			}
			return null;
		},
		set: function( elem ) {
			var parent = elem.parentNode;
			if ( parent ) {
				parent.selectedIndex;

				if ( parent.parentNode ) {
					parent.parentNode.selectedIndex;
				}
			}
		}
	};
}

jQuery.each( [
	"tabIndex",
	"readOnly",
	"maxLength",
	"cellSpacing",
	"cellPadding",
	"rowSpan",
	"colSpan",
	"useMap",
	"frameBorder",
	"contentEditable"
], function() {
	jQuery.propFix[ this.toLowerCase() ] = this;
} );

// IE6/7 call enctype encoding
if ( !support.enctype ) {
	jQuery.propFix.enctype = "encoding";
}




var rclass = /[\t\r\n\f]/g;

function getClass( elem ) {
	return jQuery.attr( elem, "class" ) || "";
}

jQuery.fn.extend( {
	addClass: function( value ) {
		var classes, elem, cur, curValue, clazz, j, finalValue,
			i = 0;

		if ( jQuery.isFunction( value ) ) {
			return this.each( function( j ) {
				jQuery( this ).addClass( value.call( this, j, getClass( this ) ) );
			} );
		}

		if ( typeof value === "string" && value ) {
			classes = value.match( rnotwhite ) || [];

			while ( ( elem = this[ i++ ] ) ) {
				curValue = getClass( elem );
				cur = elem.nodeType === 1 &&
					( " " + curValue + " " ).replace( rclass, " " );

				if ( cur ) {
					j = 0;
					while ( ( clazz = classes[ j++ ] ) ) {
						if ( cur.indexOf( " " + clazz + " " ) < 0 ) {
							cur += clazz + " ";
						}
					}

					// only assign if different to avoid unneeded rendering.
					finalValue = jQuery.trim( cur );
					if ( curValue !== finalValue ) {
						jQuery.attr( elem, "class", finalValue );
					}
				}
			}
		}

		return this;
	},

	removeClass: function( value ) {
		var classes, elem, cur, curValue, clazz, j, finalValue,
			i = 0;

		if ( jQuery.isFunction( value ) ) {
			return this.each( function( j ) {
				jQuery( this ).removeClass( value.call( this, j, getClass( this ) ) );
			} );
		}

		if ( !arguments.length ) {
			return this.attr( "class", "" );
		}

		if ( typeof value === "string" && value ) {
			classes = value.match( rnotwhite ) || [];

			while ( ( elem = this[ i++ ] ) ) {
				curValue = getClass( elem );

				// This expression is here for better compressibility (see addClass)
				cur = elem.nodeType === 1 &&
					( " " + curValue + " " ).replace( rclass, " " );

				if ( cur ) {
					j = 0;
					while ( ( clazz = classes[ j++ ] ) ) {

						// Remove *all* instances
						while ( cur.indexOf( " " + clazz + " " ) > -1 ) {
							cur = cur.replace( " " + clazz + " ", " " );
						}
					}

					// Only assign if different to avoid unneeded rendering.
					finalValue = jQuery.trim( cur );
					if ( curValue !== finalValue ) {
						jQuery.attr( elem, "class", finalValue );
					}
				}
			}
		}

		return this;
	},

	toggleClass: function( value, stateVal ) {
		var type = typeof value;

		if ( typeof stateVal === "boolean" && type === "string" ) {
			return stateVal ? this.addClass( value ) : this.removeClass( value );
		}

		if ( jQuery.isFunction( value ) ) {
			return this.each( function( i ) {
				jQuery( this ).toggleClass(
					value.call( this, i, getClass( this ), stateVal ),
					stateVal
				);
			} );
		}

		return this.each( function() {
			var className, i, self, classNames;

			if ( type === "string" ) {

				// Toggle individual class names
				i = 0;
				self = jQuery( this );
				classNames = value.match( rnotwhite ) || [];

				while ( ( className = classNames[ i++ ] ) ) {

					// Check each className given, space separated list
					if ( self.hasClass( className ) ) {
						self.removeClass( className );
					} else {
						self.addClass( className );
					}
				}

			// Toggle whole class name
			} else if ( value === undefined || type === "boolean" ) {
				className = getClass( this );
				if ( className ) {

					// store className if set
					jQuery._data( this, "__className__", className );
				}

				// If the element has a class name or if we're passed "false",
				// then remove the whole classname (if there was one, the above saved it).
				// Otherwise bring back whatever was previously saved (if anything),
				// falling back to the empty string if nothing was stored.
				jQuery.attr( this, "class",
					className || value === false ?
					"" :
					jQuery._data( this, "__className__" ) || ""
				);
			}
		} );
	},

	hasClass: function( selector ) {
		var className, elem,
			i = 0;

		className = " " + selector + " ";
		while ( ( elem = this[ i++ ] ) ) {
			if ( elem.nodeType === 1 &&
				( " " + getClass( elem ) + " " ).replace( rclass, " " )
					.indexOf( className ) > -1
			) {
				return true;
			}
		}

		return false;
	}
} );




// Return jQuery for attributes-only inclusion


jQuery.each( ( "blur focus focusin focusout load resize scroll unload click dblclick " +
	"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave " +
	"change select submit keydown keypress keyup error contextmenu" ).split( " " ),
	function( i, name ) {

	// Handle event binding
	jQuery.fn[ name ] = function( data, fn ) {
		return arguments.length > 0 ?
			this.on( name, null, data, fn ) :
			this.trigger( name );
	};
} );

jQuery.fn.extend( {
	hover: function( fnOver, fnOut ) {
		return this.mouseenter( fnOver ).mouseleave( fnOut || fnOver );
	}
} );


var location = window.location;

var nonce = jQuery.now();

var rquery = ( /\?/ );



var rvalidtokens = /(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;

jQuery.parseJSON = function( data ) {

	// Attempt to parse using the native JSON parser first
	if ( window.JSON && window.JSON.parse ) {

		// Support: Android 2.3
		// Workaround failure to string-cast null input
		return window.JSON.parse( data + "" );
	}

	var requireNonComma,
		depth = null,
		str = jQuery.trim( data + "" );

	// Guard against invalid (and possibly dangerous) input by ensuring that nothing remains
	// after removing valid tokens
	return str && !jQuery.trim( str.replace( rvalidtokens, function( token, comma, open, close ) {

		// Force termination if we see a misplaced comma
		if ( requireNonComma && comma ) {
			depth = 0;
		}

		// Perform no more replacements after returning to outermost depth
		if ( depth === 0 ) {
			return token;
		}

		// Commas must not follow "[", "{", or ","
		requireNonComma = open || comma;

		// Determine new depth
		// array/object open ("[" or "{"): depth += true - false (increment)
		// array/object close ("]" or "}"): depth += false - true (decrement)
		// other cases ("," or primitive): depth += true - true (numeric cast)
		depth += !close - !open;

		// Remove this token
		return "";
	} ) ) ?
		( Function( "return " + str ) )() :
		jQuery.error( "Invalid JSON: " + data );
};


// Cross-browser xml parsing
jQuery.parseXML = function( data ) {
	var xml, tmp;
	if ( !data || typeof data !== "string" ) {
		return null;
	}
	try {
		if ( window.DOMParser ) { // Standard
			tmp = new window.DOMParser();
			xml = tmp.parseFromString( data, "text/xml" );
		} else { // IE
			xml = new window.ActiveXObject( "Microsoft.XMLDOM" );
			xml.async = "false";
			xml.loadXML( data );
		}
	} catch ( e ) {
		xml = undefined;
	}
	if ( !xml || !xml.documentElement || xml.getElementsByTagName( "parsererror" ).length ) {
		jQuery.error( "Invalid XML: " + data );
	}
	return xml;
};


var
	rhash = /#.*$/,
	rts = /([?&])_=[^&]*/,

	// IE leaves an \r character at EOL
	rheaders = /^(.*?):[ \t]*([^\r\n]*)\r?$/mg,

	// #7653, #8125, #8152: local protocol detection
	rlocalProtocol = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/,
	rnoContent = /^(?:GET|HEAD)$/,
	rprotocol = /^\/\//,
	rurl = /^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,

	/* Prefilters
	 * 1) They are useful to introduce custom dataTypes (see ajax/jsonp.js for an example)
	 * 2) These are called:
	 *    - BEFORE asking for a transport
	 *    - AFTER param serialization (s.data is a string if s.processData is true)
	 * 3) key is the dataType
	 * 4) the catchall symbol "*" can be used
	 * 5) execution will start with transport dataType and THEN continue down to "*" if needed
	 */
	prefilters = {},

	/* Transports bindings
	 * 1) key is the dataType
	 * 2) the catchall symbol "*" can be used
	 * 3) selection will start with transport dataType and THEN go to "*" if needed
	 */
	transports = {},

	// Avoid comment-prolog char sequence (#10098); must appease lint and evade compression
	allTypes = "*/".concat( "*" ),

	// Document location
	ajaxLocation = location.href,

	// Segment location into parts
	ajaxLocParts = rurl.exec( ajaxLocation.toLowerCase() ) || [];

// Base "constructor" for jQuery.ajaxPrefilter and jQuery.ajaxTransport
function addToPrefiltersOrTransports( structure ) {

	// dataTypeExpression is optional and defaults to "*"
	return function( dataTypeExpression, func ) {

		if ( typeof dataTypeExpression !== "string" ) {
			func = dataTypeExpression;
			dataTypeExpression = "*";
		}

		var dataType,
			i = 0,
			dataTypes = dataTypeExpression.toLowerCase().match( rnotwhite ) || [];

		if ( jQuery.isFunction( func ) ) {

			// For each dataType in the dataTypeExpression
			while ( ( dataType = dataTypes[ i++ ] ) ) {

				// Prepend if requested
				if ( dataType.charAt( 0 ) === "+" ) {
					dataType = dataType.slice( 1 ) || "*";
					( structure[ dataType ] = structure[ dataType ] || [] ).unshift( func );

				// Otherwise append
				} else {
					( structure[ dataType ] = structure[ dataType ] || [] ).push( func );
				}
			}
		}
	};
}

// Base inspection function for prefilters and transports
function inspectPrefiltersOrTransports( structure, options, originalOptions, jqXHR ) {

	var inspected = {},
		seekingTransport = ( structure === transports );

	function inspect( dataType ) {
		var selected;
		inspected[ dataType ] = true;
		jQuery.each( structure[ dataType ] || [], function( _, prefilterOrFactory ) {
			var dataTypeOrTransport = prefilterOrFactory( options, originalOptions, jqXHR );
			if ( typeof dataTypeOrTransport === "string" &&
				!seekingTransport && !inspected[ dataTypeOrTransport ] ) {

				options.dataTypes.unshift( dataTypeOrTransport );
				inspect( dataTypeOrTransport );
				return false;
			} else if ( seekingTransport ) {
				return !( selected = dataTypeOrTransport );
			}
		} );
		return selected;
	}

	return inspect( options.dataTypes[ 0 ] ) || !inspected[ "*" ] && inspect( "*" );
}

// A special extend for ajax options
// that takes "flat" options (not to be deep extended)
// Fixes #9887
function ajaxExtend( target, src ) {
	var deep, key,
		flatOptions = jQuery.ajaxSettings.flatOptions || {};

	for ( key in src ) {
		if ( src[ key ] !== undefined ) {
			( flatOptions[ key ] ? target : ( deep || ( deep = {} ) ) )[ key ] = src[ key ];
		}
	}
	if ( deep ) {
		jQuery.extend( true, target, deep );
	}

	return target;
}

/* Handles responses to an ajax request:
 * - finds the right dataType (mediates between content-type and expected dataType)
 * - returns the corresponding response
 */
function ajaxHandleResponses( s, jqXHR, responses ) {
	var firstDataType, ct, finalDataType, type,
		contents = s.contents,
		dataTypes = s.dataTypes;

	// Remove auto dataType and get content-type in the process
	while ( dataTypes[ 0 ] === "*" ) {
		dataTypes.shift();
		if ( ct === undefined ) {
			ct = s.mimeType || jqXHR.getResponseHeader( "Content-Type" );
		}
	}

	// Check if we're dealing with a known content-type
	if ( ct ) {
		for ( type in contents ) {
			if ( contents[ type ] && contents[ type ].test( ct ) ) {
				dataTypes.unshift( type );
				break;
			}
		}
	}

	// Check to see if we have a response for the expected dataType
	if ( dataTypes[ 0 ] in responses ) {
		finalDataType = dataTypes[ 0 ];
	} else {

		// Try convertible dataTypes
		for ( type in responses ) {
			if ( !dataTypes[ 0 ] || s.converters[ type + " " + dataTypes[ 0 ] ] ) {
				finalDataType = type;
				break;
			}
			if ( !firstDataType ) {
				firstDataType = type;
			}
		}

		// Or just use first one
		finalDataType = finalDataType || firstDataType;
	}

	// If we found a dataType
	// We add the dataType to the list if needed
	// and return the corresponding response
	if ( finalDataType ) {
		if ( finalDataType !== dataTypes[ 0 ] ) {
			dataTypes.unshift( finalDataType );
		}
		return responses[ finalDataType ];
	}
}

/* Chain conversions given the request and the original response
 * Also sets the responseXXX fields on the jqXHR instance
 */
function ajaxConvert( s, response, jqXHR, isSuccess ) {
	var conv2, current, conv, tmp, prev,
		converters = {},

		// Work with a copy of dataTypes in case we need to modify it for conversion
		dataTypes = s.dataTypes.slice();

	// Create converters map with lowercased keys
	if ( dataTypes[ 1 ] ) {
		for ( conv in s.converters ) {
			converters[ conv.toLowerCase() ] = s.converters[ conv ];
		}
	}

	current = dataTypes.shift();

	// Convert to each sequential dataType
	while ( current ) {

		if ( s.responseFields[ current ] ) {
			jqXHR[ s.responseFields[ current ] ] = response;
		}

		// Apply the dataFilter if provided
		if ( !prev && isSuccess && s.dataFilter ) {
			response = s.dataFilter( response, s.dataType );
		}

		prev = current;
		current = dataTypes.shift();

		if ( current ) {

			// There's only work to do if current dataType is non-auto
			if ( current === "*" ) {

				current = prev;

			// Convert response if prev dataType is non-auto and differs from current
			} else if ( prev !== "*" && prev !== current ) {

				// Seek a direct converter
				conv = converters[ prev + " " + current ] || converters[ "* " + current ];

				// If none found, seek a pair
				if ( !conv ) {
					for ( conv2 in converters ) {

						// If conv2 outputs current
						tmp = conv2.split( " " );
						if ( tmp[ 1 ] === current ) {

							// If prev can be converted to accepted input
							conv = converters[ prev + " " + tmp[ 0 ] ] ||
								converters[ "* " + tmp[ 0 ] ];
							if ( conv ) {

								// Condense equivalence converters
								if ( conv === true ) {
									conv = converters[ conv2 ];

								// Otherwise, insert the intermediate dataType
								} else if ( converters[ conv2 ] !== true ) {
									current = tmp[ 0 ];
									dataTypes.unshift( tmp[ 1 ] );
								}
								break;
							}
						}
					}
				}

				// Apply converter (if not an equivalence)
				if ( conv !== true ) {

					// Unless errors are allowed to bubble, catch and return them
					if ( conv && s[ "throws" ] ) { // jscs:ignore requireDotNotation
						response = conv( response );
					} else {
						try {
							response = conv( response );
						} catch ( e ) {
							return {
								state: "parsererror",
								error: conv ? e : "No conversion from " + prev + " to " + current
							};
						}
					}
				}
			}
		}
	}

	return { state: "success", data: response };
}

jQuery.extend( {

	// Counter for holding the number of active queries
	active: 0,

	// Last-Modified header cache for next request
	lastModified: {},
	etag: {},

	ajaxSettings: {
		url: ajaxLocation,
		type: "GET",
		isLocal: rlocalProtocol.test( ajaxLocParts[ 1 ] ),
		global: true,
		processData: true,
		async: true,
		contentType: "application/x-www-form-urlencoded; charset=UTF-8",
		/*
		timeout: 0,
		data: null,
		dataType: null,
		username: null,
		password: null,
		cache: null,
		throws: false,
		traditional: false,
		headers: {},
		*/

		accepts: {
			"*": allTypes,
			text: "text/plain",
			html: "text/html",
			xml: "application/xml, text/xml",
			json: "application/json, text/javascript"
		},

		contents: {
			xml: /\bxml\b/,
			html: /\bhtml/,
			json: /\bjson\b/
		},

		responseFields: {
			xml: "responseXML",
			text: "responseText",
			json: "responseJSON"
		},

		// Data converters
		// Keys separate source (or catchall "*") and destination types with a single space
		converters: {

			// Convert anything to text
			"* text": String,

			// Text to html (true = no transformation)
			"text html": true,

			// Evaluate text as a json expression
			"text json": jQuery.parseJSON,

			// Parse text as xml
			"text xml": jQuery.parseXML
		},

		// For options that shouldn't be deep extended:
		// you can add your own custom options here if
		// and when you create one that shouldn't be
		// deep extended (see ajaxExtend)
		flatOptions: {
			url: true,
			context: true
		}
	},

	// Creates a full fledged settings object into target
	// with both ajaxSettings and settings fields.
	// If target is omitted, writes into ajaxSettings.
	ajaxSetup: function( target, settings ) {
		return settings ?

			// Building a settings object
			ajaxExtend( ajaxExtend( target, jQuery.ajaxSettings ), settings ) :

			// Extending ajaxSettings
			ajaxExtend( jQuery.ajaxSettings, target );
	},

	ajaxPrefilter: addToPrefiltersOrTransports( prefilters ),
	ajaxTransport: addToPrefiltersOrTransports( transports ),

	// Main method
	ajax: function( url, options ) {

		// If url is an object, simulate pre-1.5 signature
		if ( typeof url === "object" ) {
			options = url;
			url = undefined;
		}

		// Force options to be an object
		options = options || {};

		var

			// Cross-domain detection vars
			parts,

			// Loop variable
			i,

			// URL without anti-cache param
			cacheURL,

			// Response headers as string
			responseHeadersString,

			// timeout handle
			timeoutTimer,

			// To know if global events are to be dispatched
			fireGlobals,

			transport,

			// Response headers
			responseHeaders,

			// Create the final options object
			s = jQuery.ajaxSetup( {}, options ),

			// Callbacks context
			callbackContext = s.context || s,

			// Context for global events is callbackContext if it is a DOM node or jQuery collection
			globalEventContext = s.context &&
				( callbackContext.nodeType || callbackContext.jquery ) ?
					jQuery( callbackContext ) :
					jQuery.event,

			// Deferreds
			deferred = jQuery.Deferred(),
			completeDeferred = jQuery.Callbacks( "once memory" ),

			// Status-dependent callbacks
			statusCode = s.statusCode || {},

			// Headers (they are sent all at once)
			requestHeaders = {},
			requestHeadersNames = {},

			// The jqXHR state
			state = 0,

			// Default abort message
			strAbort = "canceled",

			// Fake xhr
			jqXHR = {
				readyState: 0,

				// Builds headers hashtable if needed
				getResponseHeader: function( key ) {
					var match;
					if ( state === 2 ) {
						if ( !responseHeaders ) {
							responseHeaders = {};
							while ( ( match = rheaders.exec( responseHeadersString ) ) ) {
								responseHeaders[ match[ 1 ].toLowerCase() ] = match[ 2 ];
							}
						}
						match = responseHeaders[ key.toLowerCase() ];
					}
					return match == null ? null : match;
				},

				// Raw string
				getAllResponseHeaders: function() {
					return state === 2 ? responseHeadersString : null;
				},

				// Caches the header
				setRequestHeader: function( name, value ) {
					var lname = name.toLowerCase();
					if ( !state ) {
						name = requestHeadersNames[ lname ] = requestHeadersNames[ lname ] || name;
						requestHeaders[ name ] = value;
					}
					return this;
				},

				// Overrides response content-type header
				overrideMimeType: function( type ) {
					if ( !state ) {
						s.mimeType = type;
					}
					return this;
				},

				// Status-dependent callbacks
				statusCode: function( map ) {
					var code;
					if ( map ) {
						if ( state < 2 ) {
							for ( code in map ) {

								// Lazy-add the new callback in a way that preserves old ones
								statusCode[ code ] = [ statusCode[ code ], map[ code ] ];
							}
						} else {

							// Execute the appropriate callbacks
							jqXHR.always( map[ jqXHR.status ] );
						}
					}
					return this;
				},

				// Cancel the request
				abort: function( statusText ) {
					var finalText = statusText || strAbort;
					if ( transport ) {
						transport.abort( finalText );
					}
					done( 0, finalText );
					return this;
				}
			};

		// Attach deferreds
		deferred.promise( jqXHR ).complete = completeDeferred.add;
		jqXHR.success = jqXHR.done;
		jqXHR.error = jqXHR.fail;

		// Remove hash character (#7531: and string promotion)
		// Add protocol if not provided (#5866: IE7 issue with protocol-less urls)
		// Handle falsy url in the settings object (#10093: consistency with old signature)
		// We also use the url parameter if available
		s.url = ( ( url || s.url || ajaxLocation ) + "" )
			.replace( rhash, "" )
			.replace( rprotocol, ajaxLocParts[ 1 ] + "//" );

		// Alias method option to type as per ticket #12004
		s.type = options.method || options.type || s.method || s.type;

		// Extract dataTypes list
		s.dataTypes = jQuery.trim( s.dataType || "*" ).toLowerCase().match( rnotwhite ) || [ "" ];

		// A cross-domain request is in order when we have a protocol:host:port mismatch
		if ( s.crossDomain == null ) {
			parts = rurl.exec( s.url.toLowerCase() );
			s.crossDomain = !!( parts &&
				( parts[ 1 ] !== ajaxLocParts[ 1 ] || parts[ 2 ] !== ajaxLocParts[ 2 ] ||
					( parts[ 3 ] || ( parts[ 1 ] === "http:" ? "80" : "443" ) ) !==
						( ajaxLocParts[ 3 ] || ( ajaxLocParts[ 1 ] === "http:" ? "80" : "443" ) ) )
			);
		}

		// Convert data if not already a string
		if ( s.data && s.processData && typeof s.data !== "string" ) {
			s.data = jQuery.param( s.data, s.traditional );
		}

		// Apply prefilters
		inspectPrefiltersOrTransports( prefilters, s, options, jqXHR );

		// If request was aborted inside a prefilter, stop there
		if ( state === 2 ) {
			return jqXHR;
		}

		// We can fire global events as of now if asked to
		// Don't fire events if jQuery.event is undefined in an AMD-usage scenario (#15118)
		fireGlobals = jQuery.event && s.global;

		// Watch for a new set of requests
		if ( fireGlobals && jQuery.active++ === 0 ) {
			jQuery.event.trigger( "ajaxStart" );
		}

		// Uppercase the type
		s.type = s.type.toUpperCase();

		// Determine if request has content
		s.hasContent = !rnoContent.test( s.type );

		// Save the URL in case we're toying with the If-Modified-Since
		// and/or If-None-Match header later on
		cacheURL = s.url;

		// More options handling for requests with no content
		if ( !s.hasContent ) {

			// If data is available, append data to url
			if ( s.data ) {
				cacheURL = ( s.url += ( rquery.test( cacheURL ) ? "&" : "?" ) + s.data );

				// #9682: remove data so that it's not used in an eventual retry
				delete s.data;
			}

			// Add anti-cache in url if needed
			if ( s.cache === false ) {
				s.url = rts.test( cacheURL ) ?

					// If there is already a '_' parameter, set its value
					cacheURL.replace( rts, "$1_=" + nonce++ ) :

					// Otherwise add one to the end
					cacheURL + ( rquery.test( cacheURL ) ? "&" : "?" ) + "_=" + nonce++;
			}
		}

		// Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.
		if ( s.ifModified ) {
			if ( jQuery.lastModified[ cacheURL ] ) {
				jqXHR.setRequestHeader( "If-Modified-Since", jQuery.lastModified[ cacheURL ] );
			}
			if ( jQuery.etag[ cacheURL ] ) {
				jqXHR.setRequestHeader( "If-None-Match", jQuery.etag[ cacheURL ] );
			}
		}

		// Set the correct header, if data is being sent
		if ( s.data && s.hasContent && s.contentType !== false || options.contentType ) {
			jqXHR.setRequestHeader( "Content-Type", s.contentType );
		}

		// Set the Accepts header for the server, depending on the dataType
		jqXHR.setRequestHeader(
			"Accept",
			s.dataTypes[ 0 ] && s.accepts[ s.dataTypes[ 0 ] ] ?
				s.accepts[ s.dataTypes[ 0 ] ] +
					( s.dataTypes[ 0 ] !== "*" ? ", " + allTypes + "; q=0.01" : "" ) :
				s.accepts[ "*" ]
		);

		// Check for headers option
		for ( i in s.headers ) {
			jqXHR.setRequestHeader( i, s.headers[ i ] );
		}

		// Allow custom headers/mimetypes and early abort
		if ( s.beforeSend &&
			( s.beforeSend.call( callbackContext, jqXHR, s ) === false || state === 2 ) ) {

			// Abort if not done already and return
			return jqXHR.abort();
		}

		// aborting is no longer a cancellation
		strAbort = "abort";

		// Install callbacks on deferreds
		for ( i in { success: 1, error: 1, complete: 1 } ) {
			jqXHR[ i ]( s[ i ] );
		}

		// Get transport
		transport = inspectPrefiltersOrTransports( transports, s, options, jqXHR );

		// If no transport, we auto-abort
		if ( !transport ) {
			done( -1, "No Transport" );
		} else {
			jqXHR.readyState = 1;

			// Send global event
			if ( fireGlobals ) {
				globalEventContext.trigger( "ajaxSend", [ jqXHR, s ] );
			}

			// If request was aborted inside ajaxSend, stop there
			if ( state === 2 ) {
				return jqXHR;
			}

			// Timeout
			if ( s.async && s.timeout > 0 ) {
				timeoutTimer = window.setTimeout( function() {
					jqXHR.abort( "timeout" );
				}, s.timeout );
			}

			try {
				state = 1;
				transport.send( requestHeaders, done );
			} catch ( e ) {

				// Propagate exception as error if not done
				if ( state < 2 ) {
					done( -1, e );

				// Simply rethrow otherwise
				} else {
					throw e;
				}
			}
		}

		// Callback for when everything is done
		function done( status, nativeStatusText, responses, headers ) {
			var isSuccess, success, error, response, modified,
				statusText = nativeStatusText;

			// Called once
			if ( state === 2 ) {
				return;
			}

			// State is "done" now
			state = 2;

			// Clear timeout if it exists
			if ( timeoutTimer ) {
				window.clearTimeout( timeoutTimer );
			}

			// Dereference transport for early garbage collection
			// (no matter how long the jqXHR object will be used)
			transport = undefined;

			// Cache response headers
			responseHeadersString = headers || "";

			// Set readyState
			jqXHR.readyState = status > 0 ? 4 : 0;

			// Determine if successful
			isSuccess = status >= 200 && status < 300 || status === 304;

			// Get response data
			if ( responses ) {
				response = ajaxHandleResponses( s, jqXHR, responses );
			}

			// Convert no matter what (that way responseXXX fields are always set)
			response = ajaxConvert( s, response, jqXHR, isSuccess );

			// If successful, handle type chaining
			if ( isSuccess ) {

				// Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.
				if ( s.ifModified ) {
					modified = jqXHR.getResponseHeader( "Last-Modified" );
					if ( modified ) {
						jQuery.lastModified[ cacheURL ] = modified;
					}
					modified = jqXHR.getResponseHeader( "etag" );
					if ( modified ) {
						jQuery.etag[ cacheURL ] = modified;
					}
				}

				// if no content
				if ( status === 204 || s.type === "HEAD" ) {
					statusText = "nocontent";

				// if not modified
				} else if ( status === 304 ) {
					statusText = "notmodified";

				// If we have data, let's convert it
				} else {
					statusText = response.state;
					success = response.data;
					error = response.error;
					isSuccess = !error;
				}
			} else {

				// We extract error from statusText
				// then normalize statusText and status for non-aborts
				error = statusText;
				if ( status || !statusText ) {
					statusText = "error";
					if ( status < 0 ) {
						status = 0;
					}
				}
			}

			// Set data for the fake xhr object
			jqXHR.status = status;
			jqXHR.statusText = ( nativeStatusText || statusText ) + "";

			// Success/Error
			if ( isSuccess ) {
				deferred.resolveWith( callbackContext, [ success, statusText, jqXHR ] );
			} else {
				deferred.rejectWith( callbackContext, [ jqXHR, statusText, error ] );
			}

			// Status-dependent callbacks
			jqXHR.statusCode( statusCode );
			statusCode = undefined;

			if ( fireGlobals ) {
				globalEventContext.trigger( isSuccess ? "ajaxSuccess" : "ajaxError",
					[ jqXHR, s, isSuccess ? success : error ] );
			}

			// Complete
			completeDeferred.fireWith( callbackContext, [ jqXHR, statusText ] );

			if ( fireGlobals ) {
				globalEventContext.trigger( "ajaxComplete", [ jqXHR, s ] );

				// Handle the global AJAX counter
				if ( !( --jQuery.active ) ) {
					jQuery.event.trigger( "ajaxStop" );
				}
			}
		}

		return jqXHR;
	},

	getJSON: function( url, data, callback ) {
		return jQuery.get( url, data, callback, "json" );
	},

	getScript: function( url, callback ) {
		return jQuery.get( url, undefined, callback, "script" );
	}
} );

jQuery.each( [ "get", "post" ], function( i, method ) {
	jQuery[ method ] = function( url, data, callback, type ) {

		// shift arguments if data argument was omitted
		if ( jQuery.isFunction( data ) ) {
			type = type || callback;
			callback = data;
			data = undefined;
		}

		// The url can be an options object (which then must have .url)
		return jQuery.ajax( jQuery.extend( {
			url: url,
			type: method,
			dataType: type,
			data: data,
			success: callback
		}, jQuery.isPlainObject( url ) && url ) );
	};
} );


jQuery._evalUrl = function( url ) {
	return jQuery.ajax( {
		url: url,

		// Make this explicit, since user can override this through ajaxSetup (#11264)
		type: "GET",
		dataType: "script",
		cache: true,
		async: false,
		global: false,
		"throws": true
	} );
};


jQuery.fn.extend( {
	wrapAll: function( html ) {
		if ( jQuery.isFunction( html ) ) {
			return this.each( function( i ) {
				jQuery( this ).wrapAll( html.call( this, i ) );
			} );
		}

		if ( this[ 0 ] ) {

			// The elements to wrap the target around
			var wrap = jQuery( html, this[ 0 ].ownerDocument ).eq( 0 ).clone( true );

			if ( this[ 0 ].parentNode ) {
				wrap.insertBefore( this[ 0 ] );
			}

			wrap.map( function() {
				var elem = this;

				while ( elem.firstChild && elem.firstChild.nodeType === 1 ) {
					elem = elem.firstChild;
				}

				return elem;
			} ).append( this );
		}

		return this;
	},

	wrapInner: function( html ) {
		if ( jQuery.isFunction( html ) ) {
			return this.each( function( i ) {
				jQuery( this ).wrapInner( html.call( this, i ) );
			} );
		}

		return this.each( function() {
			var self = jQuery( this ),
				contents = self.contents();

			if ( contents.length ) {
				contents.wrapAll( html );

			} else {
				self.append( html );
			}
		} );
	},

	wrap: function( html ) {
		var isFunction = jQuery.isFunction( html );

		return this.each( function( i ) {
			jQuery( this ).wrapAll( isFunction ? html.call( this, i ) : html );
		} );
	},

	unwrap: function() {
		return this.parent().each( function() {
			if ( !jQuery.nodeName( this, "body" ) ) {
				jQuery( this ).replaceWith( this.childNodes );
			}
		} ).end();
	}
} );


function getDisplay( elem ) {
	return elem.style && elem.style.display || jQuery.css( elem, "display" );
}

function filterHidden( elem ) {

	// Disconnected elements are considered hidden
	if ( !jQuery.contains( elem.ownerDocument || document, elem ) ) {
		return true;
	}
	while ( elem && elem.nodeType === 1 ) {
		if ( getDisplay( elem ) === "none" || elem.type === "hidden" ) {
			return true;
		}
		elem = elem.parentNode;
	}
	return false;
}

jQuery.expr.filters.hidden = function( elem ) {

	// Support: Opera <= 12.12
	// Opera reports offsetWidths and offsetHeights less than zero on some elements
	return support.reliableHiddenOffsets() ?
		( elem.offsetWidth <= 0 && elem.offsetHeight <= 0 &&
			!elem.getClientRects().length ) :
			filterHidden( elem );
};

jQuery.expr.filters.visible = function( elem ) {
	return !jQuery.expr.filters.hidden( elem );
};




var r20 = /%20/g,
	rbracket = /\[\]$/,
	rCRLF = /\r?\n/g,
	rsubmitterTypes = /^(?:submit|button|image|reset|file)$/i,
	rsubmittable = /^(?:input|select|textarea|keygen)/i;

function buildParams( prefix, obj, traditional, add ) {
	var name;

	if ( jQuery.isArray( obj ) ) {

		// Serialize array item.
		jQuery.each( obj, function( i, v ) {
			if ( traditional || rbracket.test( prefix ) ) {

				// Treat each array item as a scalar.
				add( prefix, v );

			} else {

				// Item is non-scalar (array or object), encode its numeric index.
				buildParams(
					prefix + "[" + ( typeof v === "object" && v != null ? i : "" ) + "]",
					v,
					traditional,
					add
				);
			}
		} );

	} else if ( !traditional && jQuery.type( obj ) === "object" ) {

		// Serialize object item.
		for ( name in obj ) {
			buildParams( prefix + "[" + name + "]", obj[ name ], traditional, add );
		}

	} else {

		// Serialize scalar item.
		add( prefix, obj );
	}
}

// Serialize an array of form elements or a set of
// key/values into a query string
jQuery.param = function( a, traditional ) {
	var prefix,
		s = [],
		add = function( key, value ) {

			// If value is a function, invoke it and return its value
			value = jQuery.isFunction( value ) ? value() : ( value == null ? "" : value );
			s[ s.length ] = encodeURIComponent( key ) + "=" + encodeURIComponent( value );
		};

	// Set traditional to true for jQuery <= 1.3.2 behavior.
	if ( traditional === undefined ) {
		traditional = jQuery.ajaxSettings && jQuery.ajaxSettings.traditional;
	}

	// If an array was passed in, assume that it is an array of form elements.
	if ( jQuery.isArray( a ) || ( a.jquery && !jQuery.isPlainObject( a ) ) ) {

		// Serialize the form elements
		jQuery.each( a, function() {
			add( this.name, this.value );
		} );

	} else {

		// If traditional, encode the "old" way (the way 1.3.2 or older
		// did it), otherwise encode params recursively.
		for ( prefix in a ) {
			buildParams( prefix, a[ prefix ], traditional, add );
		}
	}

	// Return the resulting serialization
	return s.join( "&" ).replace( r20, "+" );
};

jQuery.fn.extend( {
	serialize: function() {
		return jQuery.param( this.serializeArray() );
	},
	serializeArray: function() {
		return this.map( function() {

			// Can add propHook for "elements" to filter or add form elements
			var elements = jQuery.prop( this, "elements" );
			return elements ? jQuery.makeArray( elements ) : this;
		} )
		.filter( function() {
			var type = this.type;

			// Use .is(":disabled") so that fieldset[disabled] works
			return this.name && !jQuery( this ).is( ":disabled" ) &&
				rsubmittable.test( this.nodeName ) && !rsubmitterTypes.test( type ) &&
				( this.checked || !rcheckableType.test( type ) );
		} )
		.map( function( i, elem ) {
			var val = jQuery( this ).val();

			return val == null ?
				null :
				jQuery.isArray( val ) ?
					jQuery.map( val, function( val ) {
						return { name: elem.name, value: val.replace( rCRLF, "\r\n" ) };
					} ) :
					{ name: elem.name, value: val.replace( rCRLF, "\r\n" ) };
		} ).get();
	}
} );


// Create the request object
// (This is still attached to ajaxSettings for backward compatibility)
jQuery.ajaxSettings.xhr = window.ActiveXObject !== undefined ?

	// Support: IE6-IE8
	function() {

		// XHR cannot access local files, always use ActiveX for that case
		if ( this.isLocal ) {
			return createActiveXHR();
		}

		// Support: IE 9-11
		// IE seems to error on cross-domain PATCH requests when ActiveX XHR
		// is used. In IE 9+ always use the native XHR.
		// Note: this condition won't catch Edge as it doesn't define
		// document.documentMode but it also doesn't support ActiveX so it won't
		// reach this code.
		if ( document.documentMode > 8 ) {
			return createStandardXHR();
		}

		// Support: IE<9
		// oldIE XHR does not support non-RFC2616 methods (#13240)
		// See http://msdn.microsoft.com/en-us/library/ie/ms536648(v=vs.85).aspx
		// and http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9
		// Although this check for six methods instead of eight
		// since IE also does not support "trace" and "connect"
		return /^(get|post|head|put|delete|options)$/i.test( this.type ) &&
			createStandardXHR() || createActiveXHR();
	} :

	// For all other browsers, use the standard XMLHttpRequest object
	createStandardXHR;

var xhrId = 0,
	xhrCallbacks = {},
	xhrSupported = jQuery.ajaxSettings.xhr();

// Support: IE<10
// Open requests must be manually aborted on unload (#5280)
// See https://support.microsoft.com/kb/2856746 for more info
if ( window.attachEvent ) {
	window.attachEvent( "onunload", function() {
		for ( var key in xhrCallbacks ) {
			xhrCallbacks[ key ]( undefined, true );
		}
	} );
}

// Determine support properties
support.cors = !!xhrSupported && ( "withCredentials" in xhrSupported );
xhrSupported = support.ajax = !!xhrSupported;

// Create transport if the browser can provide an xhr
if ( xhrSupported ) {

	jQuery.ajaxTransport( function( options ) {

		// Cross domain only allowed if supported through XMLHttpRequest
		if ( !options.crossDomain || support.cors ) {

			var callback;

			return {
				send: function( headers, complete ) {
					var i,
						xhr = options.xhr(),
						id = ++xhrId;

					// Open the socket
					xhr.open(
						options.type,
						options.url,
						options.async,
						options.username,
						options.password
					);

					// Apply custom fields if provided
					if ( options.xhrFields ) {
						for ( i in options.xhrFields ) {
							xhr[ i ] = options.xhrFields[ i ];
						}
					}

					// Override mime type if needed
					if ( options.mimeType && xhr.overrideMimeType ) {
						xhr.overrideMimeType( options.mimeType );
					}

					// X-Requested-With header
					// For cross-domain requests, seeing as conditions for a preflight are
					// akin to a jigsaw puzzle, we simply never set it to be sure.
					// (it can always be set on a per-request basis or even using ajaxSetup)
					// For same-domain requests, won't change header if already provided.
					if ( !options.crossDomain && !headers[ "X-Requested-With" ] ) {
						headers[ "X-Requested-With" ] = "XMLHttpRequest";
					}

					// Set headers
					for ( i in headers ) {

						// Support: IE<9
						// IE's ActiveXObject throws a 'Type Mismatch' exception when setting
						// request header to a null-value.
						//
						// To keep consistent with other XHR implementations, cast the value
						// to string and ignore `undefined`.
						if ( headers[ i ] !== undefined ) {
							xhr.setRequestHeader( i, headers[ i ] + "" );
						}
					}

					// Do send the request
					// This may raise an exception which is actually
					// handled in jQuery.ajax (so no try/catch here)
					xhr.send( ( options.hasContent && options.data ) || null );

					// Listener
					callback = function( _, isAbort ) {
						var status, statusText, responses;

						// Was never called and is aborted or complete
						if ( callback && ( isAbort || xhr.readyState === 4 ) ) {

							// Clean up
							delete xhrCallbacks[ id ];
							callback = undefined;
							xhr.onreadystatechange = jQuery.noop;

							// Abort manually if needed
							if ( isAbort ) {
								if ( xhr.readyState !== 4 ) {
									xhr.abort();
								}
							} else {
								responses = {};
								status = xhr.status;

								// Support: IE<10
								// Accessing binary-data responseText throws an exception
								// (#11426)
								if ( typeof xhr.responseText === "string" ) {
									responses.text = xhr.responseText;
								}

								// Firefox throws an exception when accessing
								// statusText for faulty cross-domain requests
								try {
									statusText = xhr.statusText;
								} catch ( e ) {

									// We normalize with Webkit giving an empty statusText
									statusText = "";
								}

								// Filter status for non standard behaviors

								// If the request is local and we have data: assume a success
								// (success with no data won't get notified, that's the best we
								// can do given current implementations)
								if ( !status && options.isLocal && !options.crossDomain ) {
									status = responses.text ? 200 : 404;

								// IE - #1450: sometimes returns 1223 when it should be 204
								} else if ( status === 1223 ) {
									status = 204;
								}
							}
						}

						// Call complete if needed
						if ( responses ) {
							complete( status, statusText, responses, xhr.getAllResponseHeaders() );
						}
					};

					// Do send the request
					// `xhr.send` may raise an exception, but it will be
					// handled in jQuery.ajax (so no try/catch here)
					if ( !options.async ) {

						// If we're in sync mode we fire the callback
						callback();
					} else if ( xhr.readyState === 4 ) {

						// (IE6 & IE7) if it's in cache and has been
						// retrieved directly we need to fire the callback
						window.setTimeout( callback );
					} else {

						// Register the callback, but delay it in case `xhr.send` throws
						// Add to the list of active xhr callbacks
						xhr.onreadystatechange = xhrCallbacks[ id ] = callback;
					}
				},

				abort: function() {
					if ( callback ) {
						callback( undefined, true );
					}
				}
			};
		}
	} );
}

// Functions to create xhrs
function createStandardXHR() {
	try {
		return new window.XMLHttpRequest();
	} catch ( e ) {}
}

function createActiveXHR() {
	try {
		return new window.ActiveXObject( "Microsoft.XMLHTTP" );
	} catch ( e ) {}
}




// Install script dataType
jQuery.ajaxSetup( {
	accepts: {
		script: "text/javascript, application/javascript, " +
			"application/ecmascript, application/x-ecmascript"
	},
	contents: {
		script: /\b(?:java|ecma)script\b/
	},
	converters: {
		"text script": function( text ) {
			jQuery.globalEval( text );
			return text;
		}
	}
} );

// Handle cache's special case and global
jQuery.ajaxPrefilter( "script", function( s ) {
	if ( s.cache === undefined ) {
		s.cache = false;
	}
	if ( s.crossDomain ) {
		s.type = "GET";
		s.global = false;
	}
} );

// Bind script tag hack transport
jQuery.ajaxTransport( "script", function( s ) {

	// This transport only deals with cross domain requests
	if ( s.crossDomain ) {

		var script,
			head = document.head || jQuery( "head" )[ 0 ] || document.documentElement;

		return {

			send: function( _, callback ) {

				script = document.createElement( "script" );

				script.async = true;

				if ( s.scriptCharset ) {
					script.charset = s.scriptCharset;
				}

				script.src = s.url;

				// Attach handlers for all browsers
				script.onload = script.onreadystatechange = function( _, isAbort ) {

					if ( isAbort || !script.readyState || /loaded|complete/.test( script.readyState ) ) {

						// Handle memory leak in IE
						script.onload = script.onreadystatechange = null;

						// Remove the script
						if ( script.parentNode ) {
							script.parentNode.removeChild( script );
						}

						// Dereference the script
						script = null;

						// Callback if not abort
						if ( !isAbort ) {
							callback( 200, "success" );
						}
					}
				};

				// Circumvent IE6 bugs with base elements (#2709 and #4378) by prepending
				// Use native DOM manipulation to avoid our domManip AJAX trickery
				head.insertBefore( script, head.firstChild );
			},

			abort: function() {
				if ( script ) {
					script.onload( undefined, true );
				}
			}
		};
	}
} );




var oldCallbacks = [],
	rjsonp = /(=)\?(?=&|$)|\?\?/;

// Default jsonp settings
jQuery.ajaxSetup( {
	jsonp: "callback",
	jsonpCallback: function() {
		var callback = oldCallbacks.pop() || ( jQuery.expando + "_" + ( nonce++ ) );
		this[ callback ] = true;
		return callback;
	}
} );

// Detect, normalize options and install callbacks for jsonp requests
jQuery.ajaxPrefilter( "json jsonp", function( s, originalSettings, jqXHR ) {

	var callbackName, overwritten, responseContainer,
		jsonProp = s.jsonp !== false && ( rjsonp.test( s.url ) ?
			"url" :
			typeof s.data === "string" &&
				( s.contentType || "" )
					.indexOf( "application/x-www-form-urlencoded" ) === 0 &&
				rjsonp.test( s.data ) && "data"
		);

	// Handle iff the expected data type is "jsonp" or we have a parameter to set
	if ( jsonProp || s.dataTypes[ 0 ] === "jsonp" ) {

		// Get callback name, remembering preexisting value associated with it
		callbackName = s.jsonpCallback = jQuery.isFunction( s.jsonpCallback ) ?
			s.jsonpCallback() :
			s.jsonpCallback;

		// Insert callback into url or form data
		if ( jsonProp ) {
			s[ jsonProp ] = s[ jsonProp ].replace( rjsonp, "$1" + callbackName );
		} else if ( s.jsonp !== false ) {
			s.url += ( rquery.test( s.url ) ? "&" : "?" ) + s.jsonp + "=" + callbackName;
		}

		// Use data converter to retrieve json after script execution
		s.converters[ "script json" ] = function() {
			if ( !responseContainer ) {
				jQuery.error( callbackName + " was not called" );
			}
			return responseContainer[ 0 ];
		};

		// force json dataType
		s.dataTypes[ 0 ] = "json";

		// Install callback
		overwritten = window[ callbackName ];
		window[ callbackName ] = function() {
			responseContainer = arguments;
		};

		// Clean-up function (fires after converters)
		jqXHR.always( function() {

			// If previous value didn't exist - remove it
			if ( overwritten === undefined ) {
				jQuery( window ).removeProp( callbackName );

			// Otherwise restore preexisting value
			} else {
				window[ callbackName ] = overwritten;
			}

			// Save back as free
			if ( s[ callbackName ] ) {

				// make sure that re-using the options doesn't screw things around
				s.jsonpCallback = originalSettings.jsonpCallback;

				// save the callback name for future use
				oldCallbacks.push( callbackName );
			}

			// Call if it was a function and we have a response
			if ( responseContainer && jQuery.isFunction( overwritten ) ) {
				overwritten( responseContainer[ 0 ] );
			}

			responseContainer = overwritten = undefined;
		} );

		// Delegate to script
		return "script";
	}
} );




// data: string of html
// context (optional): If specified, the fragment will be created in this context,
// defaults to document
// keepScripts (optional): If true, will include scripts passed in the html string
jQuery.parseHTML = function( data, context, keepScripts ) {
	if ( !data || typeof data !== "string" ) {
		return null;
	}
	if ( typeof context === "boolean" ) {
		keepScripts = context;
		context = false;
	}
	context = context || document;

	var parsed = rsingleTag.exec( data ),
		scripts = !keepScripts && [];

	// Single tag
	if ( parsed ) {
		return [ context.createElement( parsed[ 1 ] ) ];
	}

	parsed = buildFragment( [ data ], context, scripts );

	if ( scripts && scripts.length ) {
		jQuery( scripts ).remove();
	}

	return jQuery.merge( [], parsed.childNodes );
};


// Keep a copy of the old load method
var _load = jQuery.fn.load;

/**
 * Load a url into a page
 */
jQuery.fn.load = function( url, params, callback ) {
	if ( typeof url !== "string" && _load ) {
		return _load.apply( this, arguments );
	}

	var selector, type, response,
		self = this,
		off = url.indexOf( " " );

	if ( off > -1 ) {
		selector = jQuery.trim( url.slice( off, url.length ) );
		url = url.slice( 0, off );
	}

	// If it's a function
	if ( jQuery.isFunction( params ) ) {

		// We assume that it's the callback
		callback = params;
		params = undefined;

	// Otherwise, build a param string
	} else if ( params && typeof params === "object" ) {
		type = "POST";
	}

	// If we have elements to modify, make the request
	if ( self.length > 0 ) {
		jQuery.ajax( {
			url: url,

			// If "type" variable is undefined, then "GET" method will be used.
			// Make value of this field explicit since
			// user can override it through ajaxSetup method
			type: type || "GET",
			dataType: "html",
			data: params
		} ).done( function( responseText ) {

			// Save response for use in complete callback
			response = arguments;

			self.html( selector ?

				// If a selector was specified, locate the right elements in a dummy div
				// Exclude scripts to avoid IE 'Permission Denied' errors
				jQuery( "<div>" ).append( jQuery.parseHTML( responseText ) ).find( selector ) :

				// Otherwise use the full result
				responseText );

		// If the request succeeds, this function gets "data", "status", "jqXHR"
		// but they are ignored because response was set above.
		// If it fails, this function gets "jqXHR", "status", "error"
		} ).always( callback && function( jqXHR, status ) {
			self.each( function() {
				callback.apply( this, response || [ jqXHR.responseText, status, jqXHR ] );
			} );
		} );
	}

	return this;
};




// Attach a bunch of functions for handling common AJAX events
jQuery.each( [
	"ajaxStart",
	"ajaxStop",
	"ajaxComplete",
	"ajaxError",
	"ajaxSuccess",
	"ajaxSend"
], function( i, type ) {
	jQuery.fn[ type ] = function( fn ) {
		return this.on( type, fn );
	};
} );




jQuery.expr.filters.animated = function( elem ) {
	return jQuery.grep( jQuery.timers, function( fn ) {
		return elem === fn.elem;
	} ).length;
};





/**
 * Gets a window from an element
 */
function getWindow( elem ) {
	return jQuery.isWindow( elem ) ?
		elem :
		elem.nodeType === 9 ?
			elem.defaultView || elem.parentWindow :
			false;
}

jQuery.offset = {
	setOffset: function( elem, options, i ) {
		var curPosition, curLeft, curCSSTop, curTop, curOffset, curCSSLeft, calculatePosition,
			position = jQuery.css( elem, "position" ),
			curElem = jQuery( elem ),
			props = {};

		// set position first, in-case top/left are set even on static elem
		if ( position === "static" ) {
			elem.style.position = "relative";
		}

		curOffset = curElem.offset();
		curCSSTop = jQuery.css( elem, "top" );
		curCSSLeft = jQuery.css( elem, "left" );
		calculatePosition = ( position === "absolute" || position === "fixed" ) &&
			jQuery.inArray( "auto", [ curCSSTop, curCSSLeft ] ) > -1;

		// need to be able to calculate position if either top or left
		// is auto and position is either absolute or fixed
		if ( calculatePosition ) {
			curPosition = curElem.position();
			curTop = curPosition.top;
			curLeft = curPosition.left;
		} else {
			curTop = parseFloat( curCSSTop ) || 0;
			curLeft = parseFloat( curCSSLeft ) || 0;
		}

		if ( jQuery.isFunction( options ) ) {

			// Use jQuery.extend here to allow modification of coordinates argument (gh-1848)
			options = options.call( elem, i, jQuery.extend( {}, curOffset ) );
		}

		if ( options.top != null ) {
			props.top = ( options.top - curOffset.top ) + curTop;
		}
		if ( options.left != null ) {
			props.left = ( options.left - curOffset.left ) + curLeft;
		}

		if ( "using" in options ) {
			options.using.call( elem, props );
		} else {
			curElem.css( props );
		}
	}
};

jQuery.fn.extend( {
	offset: function( options ) {
		if ( arguments.length ) {
			return options === undefined ?
				this :
				this.each( function( i ) {
					jQuery.offset.setOffset( this, options, i );
				} );
		}

		var docElem, win,
			box = { top: 0, left: 0 },
			elem = this[ 0 ],
			doc = elem && elem.ownerDocument;

		if ( !doc ) {
			return;
		}

		docElem = doc.documentElement;

		// Make sure it's not a disconnected DOM node
		if ( !jQuery.contains( docElem, elem ) ) {
			return box;
		}

		// If we don't have gBCR, just use 0,0 rather than error
		// BlackBerry 5, iOS 3 (original iPhone)
		if ( typeof elem.getBoundingClientRect !== "undefined" ) {
			box = elem.getBoundingClientRect();
		}
		win = getWindow( doc );
		return {
			top: box.top  + ( win.pageYOffset || docElem.scrollTop )  - ( docElem.clientTop  || 0 ),
			left: box.left + ( win.pageXOffset || docElem.scrollLeft ) - ( docElem.clientLeft || 0 )
		};
	},

	position: function() {
		if ( !this[ 0 ] ) {
			return;
		}

		var offsetParent, offset,
			parentOffset = { top: 0, left: 0 },
			elem = this[ 0 ];

		// Fixed elements are offset from window (parentOffset = {top:0, left: 0},
		// because it is its only offset parent
		if ( jQuery.css( elem, "position" ) === "fixed" ) {

			// we assume that getBoundingClientRect is available when computed position is fixed
			offset = elem.getBoundingClientRect();
		} else {

			// Get *real* offsetParent
			offsetParent = this.offsetParent();

			// Get correct offsets
			offset = this.offset();
			if ( !jQuery.nodeName( offsetParent[ 0 ], "html" ) ) {
				parentOffset = offsetParent.offset();
			}

			// Add offsetParent borders
			parentOffset.top  += jQuery.css( offsetParent[ 0 ], "borderTopWidth", true );
			parentOffset.left += jQuery.css( offsetParent[ 0 ], "borderLeftWidth", true );
		}

		// Subtract parent offsets and element margins
		// note: when an element has margin: auto the offsetLeft and marginLeft
		// are the same in Safari causing offset.left to incorrectly be 0
		return {
			top:  offset.top  - parentOffset.top - jQuery.css( elem, "marginTop", true ),
			left: offset.left - parentOffset.left - jQuery.css( elem, "marginLeft", true )
		};
	},

	offsetParent: function() {
		return this.map( function() {
			var offsetParent = this.offsetParent;

			while ( offsetParent && ( !jQuery.nodeName( offsetParent, "html" ) &&
				jQuery.css( offsetParent, "position" ) === "static" ) ) {
				offsetParent = offsetParent.offsetParent;
			}
			return offsetParent || documentElement;
		} );
	}
} );

// Create scrollLeft and scrollTop methods
jQuery.each( { scrollLeft: "pageXOffset", scrollTop: "pageYOffset" }, function( method, prop ) {
	var top = /Y/.test( prop );

	jQuery.fn[ method ] = function( val ) {
		return access( this, function( elem, method, val ) {
			var win = getWindow( elem );

			if ( val === undefined ) {
				return win ? ( prop in win ) ? win[ prop ] :
					win.document.documentElement[ method ] :
					elem[ method ];
			}

			if ( win ) {
				win.scrollTo(
					!top ? val : jQuery( win ).scrollLeft(),
					top ? val : jQuery( win ).scrollTop()
				);

			} else {
				elem[ method ] = val;
			}
		}, method, val, arguments.length, null );
	};
} );

// Support: Safari<7-8+, Chrome<37-44+
// Add the top/left cssHooks using jQuery.fn.position
// Webkit bug: https://bugs.webkit.org/show_bug.cgi?id=29084
// getComputedStyle returns percent when specified for top/left/bottom/right
// rather than make the css module depend on the offset module, we just check for it here
jQuery.each( [ "top", "left" ], function( i, prop ) {
	jQuery.cssHooks[ prop ] = addGetHookIf( support.pixelPosition,
		function( elem, computed ) {
			if ( computed ) {
				computed = curCSS( elem, prop );

				// if curCSS returns percentage, fallback to offset
				return rnumnonpx.test( computed ) ?
					jQuery( elem ).position()[ prop ] + "px" :
					computed;
			}
		}
	);
} );


// Create innerHeight, innerWidth, height, width, outerHeight and outerWidth methods
jQuery.each( { Height: "height", Width: "width" }, function( name, type ) {
	jQuery.each( { padding: "inner" + name, content: type, "": "outer" + name },
	function( defaultExtra, funcName ) {

		// margin is only for outerHeight, outerWidth
		jQuery.fn[ funcName ] = function( margin, value ) {
			var chainable = arguments.length && ( defaultExtra || typeof margin !== "boolean" ),
				extra = defaultExtra || ( margin === true || value === true ? "margin" : "border" );

			return access( this, function( elem, type, value ) {
				var doc;

				if ( jQuery.isWindow( elem ) ) {

					// As of 5/8/2012 this will yield incorrect results for Mobile Safari, but there
					// isn't a whole lot we can do. See pull request at this URL for discussion:
					// https://github.com/jquery/jquery/pull/764
					return elem.document.documentElement[ "client" + name ];
				}

				// Get document width or height
				if ( elem.nodeType === 9 ) {
					doc = elem.documentElement;

					// Either scroll[Width/Height] or offset[Width/Height] or client[Width/Height],
					// whichever is greatest
					// unfortunately, this causes bug #3838 in IE6/8 only,
					// but there is currently no good, small way to fix it.
					return Math.max(
						elem.body[ "scroll" + name ], doc[ "scroll" + name ],
						elem.body[ "offset" + name ], doc[ "offset" + name ],
						doc[ "client" + name ]
					);
				}

				return value === undefined ?

					// Get width or height on the element, requesting but not forcing parseFloat
					jQuery.css( elem, type, extra ) :

					// Set width or height on the element
					jQuery.style( elem, type, value, extra );
			}, type, chainable ? margin : undefined, chainable, null );
		};
	} );
} );


jQuery.fn.extend( {

	bind: function( types, data, fn ) {
		return this.on( types, null, data, fn );
	},
	unbind: function( types, fn ) {
		return this.off( types, null, fn );
	},

	delegate: function( selector, types, data, fn ) {
		return this.on( types, selector, data, fn );
	},
	undelegate: function( selector, types, fn ) {

		// ( namespace ) or ( selector, types [, fn] )
		return arguments.length === 1 ?
			this.off( selector, "**" ) :
			this.off( types, selector || "**", fn );
	}
} );

// The number of elements contained in the matched element set
jQuery.fn.size = function() {
	return this.length;
};

jQuery.fn.andSelf = jQuery.fn.addBack;




// Register as a named AMD module, since jQuery can be concatenated with other
// files that may use define, but not via a proper concatenation script that
// understands anonymous AMD modules. A named AMD is safest and most robust
// way to register. Lowercase jquery is used because AMD module names are
// derived from file names, and jQuery is normally delivered in a lowercase
// file name. Do this after creating the global so that if an AMD module wants
// to call noConflict to hide this version of jQuery, it will work.

// Note that for maximum portability, libraries that are not jQuery should
// declare themselves as anonymous modules, and avoid setting a global if an
// AMD loader is present. jQuery is a special case. For more information, see
// https://github.com/jrburke/requirejs/wiki/Updating-existing-libraries#wiki-anon

if ( typeof define === "function" && define.amd ) {
	define( "jquery", [], function() {
		return jQuery;
	} );
}



var

	// Map over jQuery in case of overwrite
	_jQuery = window.jQuery,

	// Map over the $ in case of overwrite
	_$ = window.$;

jQuery.noConflict = function( deep ) {
	if ( window.$ === jQuery ) {
		window.$ = _$;
	}

	if ( deep && window.jQuery === jQuery ) {
		window.jQuery = _jQuery;
	}

	return jQuery;
};

// Expose jQuery and $ identifiers, even in
// AMD (#7102#comment:10, https://github.com/jquery/jquery/pull/557)
// and CommonJS for browser emulators (#13566)
if ( !noGlobal ) {
	window.jQuery = window.$ = jQuery;
}

return jQuery;
}));

},{}],5:[function(require,module,exports){
/* Mapbox GL JS is licensed under the 3-Clause BSD License. Full text of license: https://github.com/mapbox/mapbox-gl-js/blob/v1.9.1/LICENSE.txt */
(function (global, factory) {
typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
typeof define === 'function' && define.amd ? define(factory) :
(global = global || self, global.mapboxgl = factory());
}(this, (function () { 'use strict';

/* eslint-disable */

var shared, worker, mapboxgl;
// define gets called three times: one for each chunk. we rely on the order
// they're imported to know which is which
function define(_, chunk) {
if (!shared) {
    shared = chunk;
} else if (!worker) {
    worker = chunk;
} else {
    var workerBundleString = 'var sharedChunk = {}; (' + shared + ')(sharedChunk); (' + worker + ')(sharedChunk);'

    var sharedChunk = {};
    shared(sharedChunk);
    mapboxgl = chunk(sharedChunk);
    mapboxgl.workerUrl = window.URL.createObjectURL(new Blob([workerBundleString], { type: 'text/javascript' }));
}
}


define(["exports"],(function(t){"use strict";function e(t,e){return t(e={exports:{}},e.exports),e.exports}var r=n;function n(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n;}n.prototype.sampleCurveX=function(t){return ((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return ((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return (3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){var r,n,i,a,o;for(void 0===e&&(e=1e-6),i=t,o=0;o<8;o++){if(a=this.sampleCurveX(i)-t,Math.abs(a)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=a/s;}if((i=t)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(a=this.sampleCurveX(i),Math.abs(a-t)<e)return i;t>a?r=i:n=i,i=.5*(n-r)+r;}return i},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var i=a;function a(t,e){this.x=t,this.y=e;}function o(t,e,n,i){var a=new r(t,e,n,i);return function(t){return a.solve(t)}}a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t};var s=o(.25,.1,.25,1);function u(t,e,r){return Math.min(r,Math.max(e,t))}function l(t,e,r){var n=r-e,i=((t-e)%n+n)%n+e;return i===e?r:i}function p(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var a=i[n];for(var o in a)t[o]=a[o];}return t}var c=1;function h(){return c++}function f(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function y(t){return !!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function d(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e));}));}function m(t,e){return -1!==t.indexOf(e,t.length-e.length)}function v(t,e,r){var n={};for(var i in t)n[i]=e.call(r||this,t[i],i,t);return n}function g(t,e,r){var n={};for(var i in t)e.call(r||this,t[i],i,t)&&(n[i]=t[i]);return n}function x(t){return Array.isArray(t)?t.map(x):"object"==typeof t&&t?v(t,x):t}var b={};function w(t){b[t]||("undefined"!=typeof console&&console.warn(t),b[t]=!0);}function _(t,e,r){return (r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function A(t){for(var e=0,r=0,n=t.length,i=n-1,a=void 0,o=void 0;r<n;i=r++)e+=((o=t[i]).x-(a=t[r]).x)*(a.y+o.y);return e}function S(){return "undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function k(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(t,r,n,i){var a=n||i;return e[r]=!a||a.toLowerCase(),""})),e["max-age"]){var r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r;}return e}var I=null;function z(t){if(null==I){var e=t.navigator?t.navigator.userAgent:null;I=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")));}return I}function C(t){try{var e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return !1}}var M,T,E,P,B=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date),V=self.requestAnimationFrame||self.mozRequestAnimationFrame||self.webkitRequestAnimationFrame||self.msRequestAnimationFrame,F=self.cancelAnimationFrame||self.mozCancelAnimationFrame||self.webkitCancelAnimationFrame||self.msCancelAnimationFrame,D={now:B,frame:function(t){var e=V(t);return {cancel:function(){return F(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var r=self.document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return r.width=t.width,r.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return M||(M=self.document.createElement("a")),M.href=t,M.href},hardwareConcurrency:self.navigator.hardwareConcurrency||4,get devicePixelRatio(){return self.devicePixelRatio},get prefersReducedMotion(){return !!self.matchMedia&&(null==T&&(T=self.matchMedia("(prefers-reduced-motion: reduce)")),T.matches)}},L={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},R={supported:!1,testSupport:function(t){!O&&P&&(U?j(t):E=t);}},O=!1,U=!1;function j(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,P),t.isContextLost())return;R.supported=!0;}catch(t){}t.deleteTexture(e),O=!0;}self.document&&((P=self.document.createElement("img")).onload=function(){E&&j(E),E=null,U=!0;},P.onerror=function(){O=!0,E=null;},P.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var q="01",N=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken();};function K(t){return 0===t.indexOf("mapbox:")}N.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return {token:["1",q,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt;},N.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},N.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},N.prototype.normalizeStyleURL=function(t,e){if(!K(t))return t;var r=J(t);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},N.prototype.normalizeGlyphsURL=function(t,e){if(!K(t))return t;var r=J(t);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},N.prototype.normalizeSourceURL=function(t,e){if(!K(t))return t;var r=J(t);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)},N.prototype.normalizeSpriteURL=function(t,e,r,n){var i=J(t);return K(t)?(i.path="/styles/v1"+i.path+"/sprite"+e+r,this._makeAPIURL(i,this._customAccessToken||n)):(i.path+=""+e+r,H(i))},N.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!K(t))return t;var r=J(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(D.devicePixelRatio>=2||512===e?"@2x":"")+(R.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var n=this._customAccessToken||function(t){for(var e=0,r=t;e<r.length;e+=1){var n=r[e].match(/^access_token=(.*)$/);if(n)return n[1]}return null}(r.params)||L.ACCESS_TOKEN;return L.REQUIRE_ACCESS_TOKEN&&n&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,n)},N.prototype.canonicalizeTileURL=function(t,e){var r=J(t);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return t;var n="mapbox://tiles/";n+=r.path.replace("/v4/","");var i=r.params;return e&&(i=i.filter((function(t){return !t.match(/^access_token=/)}))),i.length&&(n+="?"+i.join("&")),n},N.prototype.canonicalizeTileset=function(t,e){for(var r=!!e&&K(e),n=[],i=0,a=t.tiles||[];i<a.length;i+=1){var o=a[i];G(o)?n.push(this.canonicalizeTileURL(o,r)):n.push(o);}return n},N.prototype._makeAPIURL=function(t,e){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=J(L.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,"/"!==n.path&&(t.path=""+n.path+t.path),!L.REQUIRE_ACCESS_TOKEN)return H(t);if(!(e=e||L.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return t.params=t.params.filter((function(t){return -1===t.indexOf("access_token")})),t.params.push("access_token="+e),H(t)};var X=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function G(t){return X.test(t)}var Z=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function J(t){var e=t.match(Z);if(!e)throw new Error("Unable to parse URL object");return {protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function H(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function Y(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(self.atob(e[1]).split("").map((function(t){return "%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(t){return null}}var $=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null;};$.prototype.getStorageKey=function(t){var e,r=Y(L.ACCESS_TOKEN);return e=r&&r.u?self.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x"+e))}))):L.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},$.prototype.fetchEventData=function(){var t=C("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{var n=self.localStorage.getItem(e);n&&(this.eventData=JSON.parse(n));var i=self.localStorage.getItem(r);i&&(this.anonId=i);}catch(t){w("Unable to read from LocalStorage");}},$.prototype.saveEventData=function(){var t=C("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{self.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&self.localStorage.setItem(e,JSON.stringify(this.eventData));}catch(t){w("Unable to write to LocalStorage");}},$.prototype.processRequests=function(t){},$.prototype.postEvent=function(t,e,r,n){var i=this;if(L.EVENTS_URL){var a=J(L.EVENTS_URL);a.params.push("access_token="+(n||L.ACCESS_TOKEN||""));var o={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.9.1",skuId:q,userId:this.anonId},s=e?p(o,e):o,u={url:H(a),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=wt(u,(function(t){i.pendingRequest=null,r(t),i.saveEventData(),i.processRequests(n);}));}},$.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e);};var W,Q,tt=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken="";}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(t,e,r,n){this.skuToken=r,(L.EVENTS_URL&&n||L.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return K(t)||G(t)})))&&this.queueRequest({id:e,timestamp:Date.now()},n);},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var r=this.queue.shift(),n=r.id,i=r.timestamp;n&&this.success[n]||(this.anonId||this.fetchEventData(),y(this.anonId)||(this.anonId=f()),this.postEvent(i,{skuToken:this.skuToken},(function(t){t||n&&(e.success[n]=!0);}),t));}},e}($),et=new(function(t){function e(e){t.call(this,"appUserTurnstile"),this._customAccessToken=e;}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(t,e){L.EVENTS_URL&&L.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return K(t)||G(t)}))&&this.queueRequest(Date.now(),e);},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var r=Y(L.ACCESS_TOKEN),n=r?r.u:L.ACCESS_TOKEN,i=n!==this.eventData.tokenU;y(this.anonId)||(this.anonId=f(),i=!0);var a=this.queue.shift();if(this.eventData.lastSuccess){var o=new Date(this.eventData.lastSuccess),s=new Date(a),u=(a-this.eventData.lastSuccess)/864e5;i=i||u>=1||u<-1||o.getDate()!==s.getDate();}else i=!0;if(!i)return this.processRequests();this.postEvent(a,{"enabled.telemetry":!1},(function(t){t||(e.eventData.lastSuccess=a,e.eventData.tokenU=n);}),t);}},e}($)),rt=et.postTurnstileEvent.bind(et),nt=new tt,it=nt.postMapLoadEvent.bind(nt),at="mapbox-tiles",ot=500,st=50,ut=42e4;function lt(){self.caches&&!W&&(W=self.caches.open(at));}function pt(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var ct,ht=1/0;function ft(){return null==ct&&(ct=self.OffscreenCanvas&&new self.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),ct}var yt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(yt);var dt=function(t){function e(e,r,n){401===r&&G(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=r,this.url=n,this.name=this.constructor.name,this.message=e;}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),mt=S()?function(){return self.worker&&self.worker.referrer}:function(){return ("blob:"===self.location.protocol?self.parent:self).location.href};var vt,gt,xt=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(mt())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&self.Request.prototype.hasOwnProperty("signal"))return function(t,e){var r,n=new self.AbortController,i=new self.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:mt(),signal:n.signal}),a=!1,o=!1,s=(r=i.url).indexOf("sku=")>0&&G(r);"json"===t.type&&i.headers.set("Accept","application/json");var u=function(r,n,a){if(!o){if(r&&"SecurityError"!==r.message&&w(r),n&&a)return l(n);var u=Date.now();self.fetch(i).then((function(r){if(r.ok){var n=s?r.clone():null;return l(r,n,u)}return e(new dt(r.statusText,r.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message));}));}},l=function(r,n,s){("arrayBuffer"===t.type?r.arrayBuffer():"json"===t.type?r.json():r.text()).then((function(t){o||(n&&s&&function(t,e,r){if(lt(),W){var n={status:e.status,statusText:e.statusText,headers:new self.Headers};e.headers.forEach((function(t,e){return n.headers.set(e,t)}));var i=k(e.headers.get("Cache-Control")||"");i["no-store"]||(i["max-age"]&&n.headers.set("Expires",new Date(r+1e3*i["max-age"]).toUTCString()),new Date(n.headers.get("Expires")).getTime()-r<ut||function(t,e){if(void 0===Q)try{new Response(new ReadableStream),Q=!0;}catch(t){Q=!1;}Q?e(t.body):t.blob().then(e);}(e,(function(e){var r=new self.Response(e,n);lt(),W&&W.then((function(e){return e.put(pt(t.url),r)})).catch((function(t){return w(t.message)}));})));}}(i,n,s),a=!0,e(null,t,r.headers.get("Cache-Control"),r.headers.get("Expires")));})).catch((function(t){o||e(new Error(t.message));}));};return s?function(t,e){if(lt(),!W)return e(null);var r=pt(t.url);W.then((function(t){t.match(r).then((function(n){var i=function(t){if(!t)return !1;var e=new Date(t.headers.get("Expires")||0),r=k(t.headers.get("Cache-Control")||"");return e>Date.now()&&!r["no-cache"]}(n);t.delete(r),i&&t.put(r,n.clone()),e(null,n,i);})).catch(e);})).catch(e);}(i,u):u(null,null),{cancel:function(){o=!0,a||n.abort();}}}(t,e);if(S()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(t,e){var r=new self.XMLHttpRequest;for(var n in r.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(r.responseType="arraybuffer"),t.headers)r.setRequestHeader(n,t.headers[n]);return "json"===t.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===t.credentials,r.onerror=function(){e(new Error(r.statusText));},r.onload=function(){if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){var n=r.response;if("json"===t.type)try{n=JSON.parse(r.response);}catch(t){return e(t)}e(null,n,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"));}else e(new dt(r.statusText,r.status,t.url));},r.send(t.body),{cancel:function(){return r.abort()}}}(t,e)},bt=function(t,e){return xt(p(t,{type:"arrayBuffer"}),e)},wt=function(t,e){return xt(p(t,{method:"POST"}),e)};vt=[],gt=0;var _t=function(t,e){if(R.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),gt>=L.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0;}};return vt.push(r),r}gt++;var n=!1,i=function(){if(!n)for(n=!0,gt--;vt.length&&gt<L.MAX_PARALLEL_IMAGE_REQUESTS;){var t=vt.shift();t.cancelled||(t.cancel=_t(t.requestParameters,t.callback).cancel);}},a=bt(t,(function(t,r,n,a){i(),t?e(t):r&&(ft()?function(t,e){var r=new self.Blob([new Uint8Array(t)],{type:"image/png"});self.createImageBitmap(r).then((function(t){e(null,t);})).catch((function(t){e(new Error("Could not load image because of "+t.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));}));}(r,e):function(t,e,r,n){var i=new self.Image,a=self.URL;i.onload=function(){e(null,i),a.revokeObjectURL(i.src);},i.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var o=new self.Blob([new Uint8Array(t)],{type:"image/png"});i.cacheControl=r,i.expires=n,i.src=t.byteLength?a.createObjectURL(o):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";}(r,e,n,a));}));return {cancel:function(){a.cancel(),i();}}};function At(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e));}function St(t,e,r){if(r&&r[t]){var n=r[t].indexOf(e);-1!==n&&r[t].splice(n,1);}}var kt=function(t,e){void 0===e&&(e={}),p(this,e),this.type=t;},It=function(t){function e(e,r){void 0===r&&(r={}),t.call(this,"error",p({error:e},r));}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(kt),zt=function(){};zt.prototype.on=function(t,e){return this._listeners=this._listeners||{},At(t,e,this._listeners),this},zt.prototype.off=function(t,e){return St(t,e,this._listeners),St(t,e,this._oneTimeListeners),this},zt.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},At(t,e,this._oneTimeListeners),this},zt.prototype.fire=function(t,e){"string"==typeof t&&(t=new kt(t,e||{}));var r=t.type;if(this.listens(r)){t.target=this;for(var n=0,i=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];n<i.length;n+=1)i[n].call(this,t);for(var a=0,o=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];a<o.length;a+=1){var s=o[a];St(r,s,this._oneTimeListeners),s.call(this,t);}var u=this._eventedParent;u&&(p(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t));}else t instanceof It&&console.error(t.error);return this},zt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},zt.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var Ct={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},in:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},image:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},within:{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Mt=function(t,e,r,n){this.message=(t?t+": ":"")+r,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__);};function Tt(t){var e=t.value;return e?[new Mt(t.key,e,"constants have been deprecated as of v8")]:[]}function Et(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var a=i[n];for(var o in a)t[o]=a[o];}return t}function Pt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Bt(t){if(Array.isArray(t))return t.map(Bt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var r in t)e[r]=Bt(t[r]);return e}return Pt(t)}var Vt=function(t){function e(e,r){t.call(this,r),this.message=r,this.key=e;}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),Ft=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var r=0,n=e;r<n.length;r+=1){var i=n[r];this.bindings[i[0]]=i[1];}};Ft.prototype.concat=function(t){return new Ft(this,t)},Ft.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Ft.prototype.has=function(t){return !!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Dt={kind:"null"},Lt={kind:"number"},Rt={kind:"string"},Ot={kind:"boolean"},Ut={kind:"color"},jt={kind:"object"},qt={kind:"value"},Nt={kind:"collator"},Kt={kind:"formatted"},Xt={kind:"resolvedImage"};function Gt(t,e){return {kind:"array",itemType:t,N:e}}function Zt(t){if("array"===t.kind){var e=Zt(t.itemType);return "number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Jt=[Dt,Lt,Rt,Ot,Ut,Kt,jt,Gt(qt),Xt];function Ht(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Ht(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var r=0,n=Jt;r<n.length;r+=1)if(!Ht(n[r],e))return null}return "Expected "+Zt(t)+" but found "+Zt(e)+" instead."}var Yt=e((function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(t){return (t=Math.round(t))<0?0:t>255?255:t}function i(t){return n("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function a(t){return (e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e;}function o(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{e.parseCSSColor=function(t){var e,s=t.replace(/ /g,"").toLowerCase();if(s in r)return r[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=s.indexOf("("),l=s.indexOf(")");if(-1!==u&&l+1===s.length){var p=s.substr(0,u),c=s.substr(u+1,l-(u+1)).split(","),h=1;switch(p){case"rgba":if(4!==c.length)return null;h=a(c.pop());case"rgb":return 3!==c.length?null:[i(c[0]),i(c[1]),i(c[2]),h];case"hsla":if(4!==c.length)return null;h=a(c.pop());case"hsl":if(3!==c.length)return null;var f=(parseFloat(c[0])%360+360)%360/360,y=a(c[1]),d=a(c[2]),m=d<=.5?d*(y+1):d+y-d*y,v=2*d-m;return [n(255*o(v,m,f+1/3)),n(255*o(v,m,f)),n(255*o(v,m,f-1/3)),h];default:return null}}return null};}catch(t){}})).parseCSSColor,$t=function(t,e,r,n){void 0===n&&(n=1),this.r=t,this.g=e,this.b=r,this.a=n;};$t.parse=function(t){if(t){if(t instanceof $t)return t;if("string"==typeof t){var e=Yt(t);if(e)return new $t(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},$t.prototype.toString=function(){var t=this.toArray(),e=t[1],r=t[2],n=t[3];return "rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(r)+","+n+")"},$t.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},$t.black=new $t(0,0,0,1),$t.white=new $t(1,1,1,1),$t.transparent=new $t(0,0,0,0),$t.red=new $t(1,0,0,1);var Wt=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"});};Wt.prototype.compare=function(t,e){return this.collator.compare(t,e)},Wt.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Qt=function(t,e,r,n,i){this.text=t,this.image=e,this.scale=r,this.fontStack=n,this.textColor=i;},te=function(t){this.sections=t;};te.fromString=function(t){return new te([new Qt(t,null,null,null,null)])},te.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},te.factory=function(t){return t instanceof te?t:te.fromString(t)},te.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},te.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];if(n.image)t.push(["image",n.image.name]);else{t.push(n.text);var i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(i);}}return t};var ee=function(t){this.name=t.name,this.available=t.available;};function re(t,e,r,n){return "number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid rgba value ["+[t,e,r,n].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof n?[t,e,r,n]:[t,e,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ne(t){if(null===t)return !0;if("string"==typeof t)return !0;if("boolean"==typeof t)return !0;if("number"==typeof t)return !0;if(t instanceof $t)return !0;if(t instanceof Wt)return !0;if(t instanceof te)return !0;if(t instanceof ee)return !0;if(Array.isArray(t)){for(var e=0,r=t;e<r.length;e+=1)if(!ne(r[e]))return !1;return !0}if("object"==typeof t){for(var n in t)if(!ne(t[n]))return !1;return !0}return !1}function ie(t){if(null===t)return Dt;if("string"==typeof t)return Rt;if("boolean"==typeof t)return Ot;if("number"==typeof t)return Lt;if(t instanceof $t)return Ut;if(t instanceof Wt)return Nt;if(t instanceof te)return Kt;if(t instanceof ee)return Xt;if(Array.isArray(t)){for(var e,r=t.length,n=0,i=t;n<i.length;n+=1){var a=ie(i[n]);if(e){if(e===a)continue;e=qt;break}e=a;}return Gt(e||qt,r)}return jt}function ae(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof $t||t instanceof te||t instanceof ee?t.toString():JSON.stringify(t)}ee.prototype.toString=function(){return this.name},ee.fromString=function(t){return t?new ee({name:t,available:!1}):null},ee.prototype.serialize=function(){return ["image",this.name]};var oe=function(t,e){this.type=t,this.value=e;};oe.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!ne(t[1]))return e.error("invalid value");var r=t[1],n=ie(r),i=e.expectedType;return "array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new oe(n,r)},oe.prototype.evaluate=function(){return this.value},oe.prototype.eachChild=function(){},oe.prototype.outputDefined=function(){return !0},oe.prototype.serialize=function(){return "array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof $t?["rgba"].concat(this.value.toArray()):this.value instanceof te?this.value.serialize():this.value};var se=function(t){this.name="ExpressionEvaluationError",this.message=t;};se.prototype.toJSON=function(){return this.message};var ue={string:Rt,number:Lt,boolean:Ot,object:jt},le=function(t,e){this.type=t,this.args=e;};le.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r,n=1,i=t[0];if("array"===i){var a,o;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in ue)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);a=ue[s],n++;}else a=qt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],n++;}r=Gt(a,o);}else r=ue[i];for(var u=[];n<t.length;n++){var l=e.parse(t[n],n,qt);if(!l)return null;u.push(l);}return new le(r,u)},le.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!Ht(this.type,ie(r)))return r;if(e===this.args.length-1)throw new se("Expected value to be of type "+Zt(this.type)+", but found "+Zt(ie(r))+" instead.")}return null},le.prototype.eachChild=function(t){this.args.forEach(t);},le.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},le.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var r=t.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){e.push(r.kind);var n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n);}}return e.concat(this.args.map((function(t){return t.serialize()})))};var pe=function(t){this.type=Kt,this.sections=t;};pe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[1];if(!Array.isArray(r)&&"object"==typeof r)return e.error("First argument must be an image or text section.");for(var n=[],i=!1,a=1;a<=t.length-1;++a){var o=t[a];if(i&&"object"==typeof o&&!Array.isArray(o)){i=!1;var s=null;if(o["font-scale"]&&!(s=e.parse(o["font-scale"],1,Lt)))return null;var u=null;if(o["text-font"]&&!(u=e.parse(o["text-font"],1,Gt(Rt))))return null;var l=null;if(o["text-color"]&&!(l=e.parse(o["text-color"],1,Ut)))return null;var p=n[n.length-1];p.scale=s,p.font=u,p.textColor=l;}else{var c=e.parse(t[a],1,qt);if(!c)return null;var h=c.type.kind;if("string"!==h&&"value"!==h&&"null"!==h&&"resolvedImage"!==h)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:c,scale:null,font:null,textColor:null});}}return new pe(n)},pe.prototype.evaluate=function(t){return new te(this.sections.map((function(e){var r=e.content.evaluate(t);return ie(r)===Xt?new Qt("",r,null,null,null):new Qt(ae(r),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},pe.prototype.eachChild=function(t){for(var e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor);}},pe.prototype.outputDefined=function(){return !1},pe.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t.push(n.content.serialize());var i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),t.push(i);}return t};var ce=function(t){this.type=Xt,this.input=t;};ce.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,Rt);return r?new ce(r):e.error("No image name provided.")},ce.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=ee.fromString(e);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(e)>-1),r},ce.prototype.eachChild=function(t){t(this.input);},ce.prototype.outputDefined=function(){return !1},ce.prototype.serialize=function(){return ["image",this.input.serialize()]};var he={"to-boolean":Ot,"to-color":Ut,"to-number":Lt,"to-string":Rt},fe=function(t,e){this.type=t,this.args=e;};fe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[0];if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return e.error("Expected one argument.");for(var n=he[r],i=[],a=1;a<t.length;a++){var o=e.parse(t[a],a,qt);if(!o)return null;i.push(o);}return new fe(n,i)},fe.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,r,n=0,i=this.args;n<i.length;n+=1){if(r=null,(e=i[n].evaluate(t))instanceof $t)return e;if("string"==typeof e){var a=t.parseColor(e);if(a)return a}else if(Array.isArray(e)&&!(r=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":re(e[0],e[1],e[2],e[3])))return new $t(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new se(r||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var o=null,s=0,u=this.args;s<u.length;s+=1){if(null===(o=u[s].evaluate(t)))return 0;var l=Number(o);if(!isNaN(l))return l}throw new se("Could not convert "+JSON.stringify(o)+" to number.")}return "formatted"===this.type.kind?te.fromString(ae(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ee.fromString(ae(this.args[0].evaluate(t))):ae(this.args[0].evaluate(t))},fe.prototype.eachChild=function(t){this.args.forEach(t);},fe.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},fe.prototype.serialize=function(){if("formatted"===this.type.kind)return new pe([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ce(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize());})),t};var ye=["Unknown","Point","LineString","Polygon"],de=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null;};de.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},de.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?ye[this.feature.type]:this.feature.type:null},de.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},de.prototype.canonicalID=function(){return this.canonical},de.prototype.properties=function(){return this.feature&&this.feature.properties||{}},de.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=$t.parse(t)),e};var me=function(t,e,r,n){this.name=t,this.type=e,this._evaluate=r,this.args=n;};me.prototype.evaluate=function(t){return this._evaluate(t,this.args)},me.prototype.eachChild=function(t){this.args.forEach(t);},me.prototype.outputDefined=function(){return !1},me.prototype.serialize=function(){return [this.name].concat(this.args.map((function(t){return t.serialize()})))},me.parse=function(t,e){var r,n=t[0],i=me.definitions[n];if(!i)return e.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0);for(var a=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=o.filter((function(e){var r=e[0];return !Array.isArray(r)||r.length===t.length-1})),u=null,l=0,p=s;l<p.length;l+=1){var c=p[l],h=c[0],f=c[1];u=new Xe(e.registry,e.path,null,e.scope);for(var y=[],d=!1,m=1;m<t.length;m++){var v=t[m],g=Array.isArray(h)?h[m-1]:h.type,x=u.parse(v,1+y.length,g);if(!x){d=!0;break}y.push(x);}if(!d)if(Array.isArray(h)&&h.length!==y.length)u.error("Expected "+h.length+" arguments, but found "+y.length+" instead.");else{for(var b=0;b<y.length;b++){var w=Array.isArray(h)?h[b]:h.type,_=y[b];u.concat(b+1).checkSubtype(w,_.type);}if(0===u.errors.length)return new me(n,a,f,y)}}if(1===s.length)(r=e.errors).push.apply(r,u.errors);else{for(var A=(s.length?s:o).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(Zt).join(", ")+")":"("+Zt(e.type)+"...)"})).join(" | "),S=[],k=1;k<t.length;k++){var I=e.parse(t[k],1+S.length);if(!I)return null;S.push(Zt(I.type));}e.error("Expected arguments of type "+A+", but found ("+S.join(", ")+") instead.");}return null},me.register=function(t,e){for(var r in me.definitions=e,e)t[r]=me;};var ve=function(t,e,r){this.type=Nt,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e;};ve.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var r=t[1];if("object"!=typeof r||Array.isArray(r))return e.error("Collator options argument must be an object.");var n=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,Ot);if(!n)return null;var i=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,Ot);if(!i)return null;var a=null;return r.locale&&!(a=e.parse(r.locale,1,Rt))?null:new ve(n,i,a)},ve.prototype.evaluate=function(t){return new Wt(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},ve.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale);},ve.prototype.outputDefined=function(){return !1},ve.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var ge=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]));};ge.prototype.setNorthEast=function(t){return this._ne=t instanceof xe?new xe(t.lng,t.lat):xe.convert(t),this},ge.prototype.setSouthWest=function(t){return this._sw=t instanceof xe?new xe(t.lng,t.lat):xe.convert(t),this},ge.prototype.extend=function(t){var e,r,n=this._sw,i=this._ne;if(t instanceof xe)e=t,r=t;else{if(!(t instanceof ge))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(ge.convert(t)):this.extend(xe.convert(t)):this;if(r=t._ne,!(e=t._sw)||!r)return this}return n||i?(n.lng=Math.min(e.lng,n.lng),n.lat=Math.min(e.lat,n.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new xe(e.lng,e.lat),this._ne=new xe(r.lng,r.lat)),this},ge.prototype.getCenter=function(){return new xe((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},ge.prototype.getSouthWest=function(){return this._sw},ge.prototype.getNorthEast=function(){return this._ne},ge.prototype.getNorthWest=function(){return new xe(this.getWest(),this.getNorth())},ge.prototype.getSouthEast=function(){return new xe(this.getEast(),this.getSouth())},ge.prototype.getWest=function(){return this._sw.lng},ge.prototype.getSouth=function(){return this._sw.lat},ge.prototype.getEast=function(){return this._ne.lng},ge.prototype.getNorth=function(){return this._ne.lat},ge.prototype.toArray=function(){return [this._sw.toArray(),this._ne.toArray()]},ge.prototype.toString=function(){return "LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},ge.prototype.isEmpty=function(){return !(this._sw&&this._ne)},ge.prototype.contains=function(t){var e=xe.convert(t),r=e.lng,n=e.lat,i=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i},ge.convert=function(t){return !t||t instanceof ge?t:new ge(t)};var xe=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};xe.prototype.wrap=function(){return new xe(l(this.lng,-180,180),this.lat)},xe.prototype.toArray=function(){return [this.lng,this.lat]},xe.prototype.toString=function(){return "LngLat("+this.lng+", "+this.lat+")"},xe.prototype.distanceTo=function(t){var e=Math.PI/180,r=this.lat*e,n=t.lat*e,i=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return 6371008.8*Math.acos(Math.min(i,1))},xe.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,r=e/Math.cos(Math.PI/180*this.lat);return new ge(new xe(this.lng-r,this.lat-e),new xe(this.lng+r,this.lat+e))},xe.convert=function(t){if(t instanceof xe)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new xe(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new xe(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var be=2*Math.PI*6371008.8;function we(t){return be*Math.cos(t*Math.PI/180)}function _e(t){return (180+t)/360}function Ae(t){return (180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Se(t,e){return t/we(e)}function ke(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Ie=function(t,e,r){void 0===r&&(r=0),this.x=+t,this.y=+e,this.z=+r;};Ie.fromLngLat=function(t,e){void 0===e&&(e=0);var r=xe.convert(t);return new Ie(_e(r.lng),Ae(r.lat),Se(e,r.lat))},Ie.prototype.toLngLat=function(){return new xe(360*this.x-180,ke(this.y))},Ie.prototype.toAltitude=function(){return this.z*we(ke(this.y))},Ie.prototype.meterInMercatorCoordinateUnits=function(){return 1/be*(t=ke(this.y),1/Math.cos(t*Math.PI/180));var t;};var ze=8192;function Ce(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1]);}function Me(t,e){return !(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Te(t,e){var r=Ie.fromLngLat({lng:t[0],lat:t[1]},0),n=Math.pow(2,e.z);return [Math.round(r.x*n*ze),Math.round(r.y*n*ze)]}function Ee(t,e,r){return e[1]>t[1]!=r[1]>t[1]&&t[0]<(r[0]-e[0])*(t[1]-e[1])/(r[1]-e[1])+e[0]}function Pe(t,e){for(var r,n,i,a,o,s,u,l=!1,p=0,c=e.length;p<c;p++)for(var h=e[p],f=0,y=h.length;f<y-1;f++){if((a=(r=t)[0]-(n=h[f])[0])*(u=r[1]-(i=h[f+1])[1])-(s=r[0]-i[0])*(o=r[1]-n[1])==0&&a*s<=0&&o*u<=0)return !1;Ee(t,h[f],h[f+1])&&(l=!l);}return l}function Be(t,e){for(var r=0;r<e.length;r++)if(Pe(t,e[r]))return !0;return !1}function Ve(t,e,r,n){var i=n[0]-r[0],a=n[1]-r[1];return ((t[0]-r[0])*a-i*(t[1]-r[1]))*((e[0]-r[0])*a-i*(e[1]-r[1]))<0}function Fe(t,e,r){for(var n=0,i=r;n<i.length;n+=1)for(var a=i[n],o=0;o<a.length-1;++o)if(0!=(c=[(p=a[o+1])[0]-(l=a[o])[0],p[1]-l[1]])[0]*(h=[(u=e)[0]-(s=t)[0],u[1]-s[1]])[1]-c[1]*h[0]&&Ve(s,u,l,p)&&Ve(l,p,s,u))return !0;var s,u,l,p,c,h;return !1}function De(t,e){for(var r=0;r<t.length;++r)if(!Pe(t[r],e))return !1;for(var n=0;n<t.length-1;++n)if(Fe(t[n],t[n+1],e))return !1;return !0}function Le(t,e){for(var r=0;r<e.length;r++)if(De(t,e[r]))return !0;return !1}function Re(t,e,r){for(var n=[],i=0;i<t.length;i++){for(var a=[],o=0;o<t[i].length;o++){var s=Te(t[i][o],r);Ce(e,s),a.push(s);}n.push(a);}return n}function Oe(t,e,r){for(var n=[],i=0;i<t.length;i++){var a=Re(t[i],e,r);n.push(a);}return n}var Ue=function(t,e){this.type=Ot,this.geojson=t,this.geometries=e;};function je(t){if(t instanceof me){if("get"===t.name&&1===t.args.length)return !1;if("feature-state"===t.name)return !1;if("has"===t.name&&1===t.args.length)return !1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return !1;if(/^filter-/.test(t.name))return !1}if(t instanceof Ue)return !1;var e=!0;return t.eachChild((function(t){e&&!je(t)&&(e=!1);})),e}function qe(t){if(t instanceof me&&"feature-state"===t.name)return !1;var e=!0;return t.eachChild((function(t){e&&!qe(t)&&(e=!1);})),e}function Ne(t,e){if(t instanceof me&&e.indexOf(t.name)>=0)return !1;var r=!0;return t.eachChild((function(t){r&&!Ne(t,e)&&(r=!1);})),r}Ue.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(ne(t[1])){var r=t[1];if("FeatureCollection"===r.type)for(var n=0;n<r.features.length;++n){var i=r.features[n].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Ue(r,r.features[n].geometry)}else if("Feature"===r.type){var a=r.geometry.type;if("Polygon"===a||"MultiPolygon"===a)return new Ue(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new Ue(r,r)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ue.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){for(var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID(),a=[i.x*ze,i.y*ze],o=[],s=0,u=t.geometry();s<u.length;s+=1)for(var l=0,p=u[s];l<p.length;l+=1){var c=p[l],h=[c.x+a[0],c.y+a[1]];Ce(r,h),o.push(h);}if("Polygon"===e.type){var f=Re(e.coordinates,n,i);if(!Me(r,n))return !1;for(var y=0,d=o;y<d.length;y+=1)if(!Pe(d[y],f))return !1}if("MultiPolygon"===e.type){var m=Oe(e.coordinates,n,i);if(!Me(r,n))return !1;for(var v=0,g=o;v<g.length;v+=1)if(!Be(g[v],m))return !1}return !0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){for(var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID(),a=[i.x*ze,i.y*ze],o=[],s=0,u=t.geometry();s<u.length;s+=1){for(var l=[],p=0,c=u[s];p<c.length;p+=1){var h=c[p],f=[h.x+a[0],h.y+a[1]];Ce(r,f),l.push(f);}o.push(l);}if("Polygon"===e.type){var y=Re(e.coordinates,n,i);if(!Me(r,n))return !1;for(var d=0,m=o;d<m.length;d+=1)if(!De(m[d],y))return !1}if("MultiPolygon"===e.type){var v=Oe(e.coordinates,n,i);if(!Me(r,n))return !1;for(var g=0,x=o;g<x.length;g+=1)if(!Le(x[g],v))return !1}return !0}(t,this.geometries)}return !1},Ue.prototype.eachChild=function(){},Ue.prototype.outputDefined=function(){return !0},Ue.prototype.serialize=function(){return ["within",this.geojson]};var Ke=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e;};Ke.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new Ke(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},Ke.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ke.prototype.eachChild=function(){},Ke.prototype.outputDefined=function(){return !1},Ke.prototype.serialize=function(){return ["var",this.name]};var Xe=function(t,e,r,n,i){void 0===e&&(e=[]),void 0===n&&(n=new Ft),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return "["+t+"]"})).join(""),this.scope=n,this.errors=i,this.expectedType=r;};function Ge(t,e){for(var r,n=t.length-1,i=0,a=n,o=0;i<=a;)if((r=t[o=Math.floor((i+a)/2)])<=e){if(o===n||e<t[o+1])return o;i=o+1;}else{if(!(r>e))throw new se("Input is not a number.");a=o-1;}return 0}Xe.prototype.parse=function(t,e,r,n,i){return void 0===i&&(i={}),e?this.concat(e,r,n)._parse(t,i):this._parse(t,i)},Xe.prototype._parse=function(t,e){function r(t,e,r){return "assert"===r?new le(e,[t]):"coerce"===r?new fe(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var n=t[0];if("string"!=typeof n)return this.error("Expression name must be a string, but found "+typeof n+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[n];if(i){var a=i.parse(t,this);if(!a)return null;if(this.expectedType){var o=this.expectedType,s=a.type;if("string"!==o.kind&&"number"!==o.kind&&"boolean"!==o.kind&&"object"!==o.kind&&"array"!==o.kind||"value"!==s.kind)if("color"!==o.kind&&"formatted"!==o.kind&&"resolvedImage"!==o.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(o,s))return null}else a=r(a,o,e.typeAnnotation||"coerce");else a=r(a,o,e.typeAnnotation||"assert");}if(!(a instanceof oe)&&"resolvedImage"!==a.type.kind&&function t(e){if(e instanceof Ke)return t(e.boundExpression);if(e instanceof me&&"error"===e.name)return !1;if(e instanceof ve)return !1;if(e instanceof Ue)return !1;var r=e instanceof fe||e instanceof le,n=!0;return e.eachChild((function(e){n=r?n&&t(e):n&&e instanceof oe;})),!!n&&je(e)&&Ne(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(a)){var u=new de;try{a=new oe(a.type,a.evaluate(u));}catch(t){return this.error(t.message),null}}return a}return this.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Xe.prototype.concat=function(t,e,r){var n="number"==typeof t?this.path.concat(t):this.path,i=r?this.scope.concat(r):this.scope;return new Xe(this.registry,n,e||null,i,this.errors)},Xe.prototype.error=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var n=""+this.key+e.map((function(t){return "["+t+"]"})).join("");this.errors.push(new Vt(n,t));},Xe.prototype.checkSubtype=function(t,e){var r=Ht(t,e);return r&&this.error(r),r};var Ze=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var n=0,i=r;n<i.length;n+=1){var a=i[n],o=a[1];this.labels.push(a[0]),this.outputs.push(o);}};Ze.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var r=e.parse(t[1],1,Lt);if(!r)return null;var n=[],i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var a=1;a<t.length;a+=2){var o=1===a?-1/0:t[a],s=t[a+1],u=a,l=a+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(n.length&&n[n.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var p=e.parse(s,l,i);if(!p)return null;i=i||p.type,n.push([o,p]);}return new Ze(i,r,n)},Ze.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;return n>=e[i-1]?r[i-1].evaluate(t):r[Ge(e,n)].evaluate(t)},Ze.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e]);},Ze.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},Ze.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var Je=He;function He(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n;}function Ye(t,e,r){return t*(1-r)+e*r}He.prototype.sampleCurveX=function(t){return ((this.ax*t+this.bx)*t+this.cx)*t},He.prototype.sampleCurveY=function(t){return ((this.ay*t+this.by)*t+this.cy)*t},He.prototype.sampleCurveDerivativeX=function(t){return (3*this.ax*t+2*this.bx)*t+this.cx},He.prototype.solveCurveX=function(t,e){var r,n,i,a,o;for(void 0===e&&(e=1e-6),i=t,o=0;o<8;o++){if(a=this.sampleCurveX(i)-t,Math.abs(a)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=a/s;}if((i=t)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(a=this.sampleCurveX(i),Math.abs(a-t)<e)return i;t>a?r=i:n=i,i=.5*(n-r)+r;}return i},He.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var $e=Object.freeze({__proto__:null,number:Ye,color:function(t,e,r){return new $t(Ye(t.r,e.r,r),Ye(t.g,e.g,r),Ye(t.b,e.b,r),Ye(t.a,e.a,r))},array:function(t,e,r){return t.map((function(t,n){return Ye(t,e[n],r)}))}}),We=.95047,Qe=1,tr=1.08883,er=4/29,rr=6/29,nr=3*rr*rr,ir=rr*rr*rr,ar=Math.PI/180,or=180/Math.PI;function sr(t){return t>ir?Math.pow(t,1/3):t/nr+er}function ur(t){return t>rr?t*t*t:nr*(t-er)}function lr(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function pr(t){return (t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function cr(t){var e=pr(t.r),r=pr(t.g),n=pr(t.b),i=sr((.4124564*e+.3575761*r+.1804375*n)/We),a=sr((.2126729*e+.7151522*r+.072175*n)/Qe);return {l:116*a-16,a:500*(i-a),b:200*(a-sr((.0193339*e+.119192*r+.9503041*n)/tr)),alpha:t.a}}function hr(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=Qe*ur(e),r=We*ur(r),n=tr*ur(n),new $t(lr(3.2404542*r-1.5371385*e-.4985314*n),lr(-.969266*r+1.8760108*e+.041556*n),lr(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function fr(t,e,r){var n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}var yr={forward:cr,reverse:hr,interpolate:function(t,e,r){return {l:Ye(t.l,e.l,r),a:Ye(t.a,e.a,r),b:Ye(t.b,e.b,r),alpha:Ye(t.alpha,e.alpha,r)}}},dr={forward:function(t){var e=cr(t),r=e.l,n=e.a,i=e.b,a=Math.atan2(i,n)*or;return {h:a<0?a+360:a,c:Math.sqrt(n*n+i*i),l:r,alpha:t.a}},reverse:function(t){var e=t.h*ar,r=t.c;return hr({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return {h:fr(t.h,e.h,r),c:Ye(t.c,e.c,r),l:Ye(t.l,e.l,r),alpha:Ye(t.alpha,e.alpha,r)}}},mr=Object.freeze({__proto__:null,lab:yr,hcl:dr}),vr=function(t,e,r,n,i){this.type=t,this.operator=e,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(var a=0,o=i;a<o.length;a+=1){var s=o[a],u=s[1];this.labels.push(s[0]),this.outputs.push(u);}};function gr(t,e,r,n){var i=n-r,a=t-r;return 0===i?0:1===e?a/i:(Math.pow(e,a)-1)/(Math.pow(e,i)-1)}vr.interpolationFactor=function(t,e,r,n){var i=0;if("exponential"===t.name)i=gr(e,t.base,r,n);else if("linear"===t.name)i=gr(e,1,r,n);else if("cubic-bezier"===t.name){var a=t.controlPoints;i=new Je(a[0],a[1],a[2],a[3]).solve(gr(e,1,r,n));}return i},vr.parse=function(t,e){var r=t[0],n=t[1],i=t[2],a=t.slice(3);if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){var o=n[1];if("number"!=typeof o)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:o};}else{if("cubic-bezier"!==n[0])return e.error("Unknown interpolation type "+String(n[0]),1,0);var s=n.slice(1);if(4!==s.length||s.some((function(t){return "number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:s};}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,Lt)))return null;var u=[],l=null;"interpolate-hcl"===r||"interpolate-lab"===r?l=Ut:e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var p=0;p<a.length;p+=2){var c=a[p],h=a[p+1],f=p+3,y=p+4;if("number"!=typeof c)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(u.length&&u[u.length-1][0]>=c)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);var d=e.parse(h,y,l);if(!d)return null;l=l||d.type,u.push([c,d]);}return "number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new vr(l,r,n,i,u):e.error("Type "+Zt(l)+" is not interpolatable.")},vr.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;if(n>=e[i-1])return r[i-1].evaluate(t);var a=Ge(e,n),o=vr.interpolationFactor(this.interpolation,n,e[a],e[a+1]),s=r[a].evaluate(t),u=r[a+1].evaluate(t);return "interpolate"===this.operator?$e[this.type.kind.toLowerCase()](s,u,o):"interpolate-hcl"===this.operator?dr.reverse(dr.interpolate(dr.forward(s),dr.forward(u),o)):yr.reverse(yr.interpolate(yr.forward(s),yr.forward(u),o))},vr.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e]);},vr.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},vr.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e};var xr=function(t,e){this.type=t,this.args=e;};xr.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,n=e.expectedType;n&&"value"!==n.kind&&(r=n);for(var i=[],a=0,o=t.slice(1);a<o.length;a+=1){var s=e.parse(o[a],1+i.length,r,void 0,{typeAnnotation:"omit"});if(!s)return null;r=r||s.type,i.push(s);}var u=n&&i.some((function(t){return Ht(n,t.type)}));return new xr(u?qt:r,i)},xr.prototype.evaluate=function(t){for(var e,r=null,n=0,i=0,a=this.args;i<a.length&&(n++,(r=a[i].evaluate(t))&&r instanceof ee&&!r.available&&(e||(e=r.name),r=null,n===this.args.length&&(r=e)),null===r);i+=1);return r},xr.prototype.eachChild=function(t){this.args.forEach(t);},xr.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},xr.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize());})),t};var br=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e;};br.prototype.evaluate=function(t){return this.result.evaluate(t)},br.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1)t(r[e][1]);t(this.result);},br.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],n=1;n<t.length-1;n+=2){var i=t[n];if("string"!=typeof i)return e.error("Expected string, but found "+typeof i+" instead.",n);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);var a=e.parse(t[n+1],n+1);if(!a)return null;r.push([i,a]);}var o=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return o?new br(r,o):null},br.prototype.outputDefined=function(){return this.result.outputDefined()},br.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var n=r[e];t.push(n[0],n[1].serialize());}return t.push(this.result.serialize()),t};var wr=function(t,e,r){this.type=t,this.index=e,this.input=r;};wr.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Lt),n=e.parse(t[2],2,Gt(e.expectedType||qt));return r&&n?new wr(n.type.itemType,r,n):null},wr.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new se("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new se("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new se("Array index must be an integer, but found "+e+" instead.");return r[e]},wr.prototype.eachChild=function(t){t(this.index),t(this.input);},wr.prototype.outputDefined=function(){return !1},wr.prototype.serialize=function(){return ["at",this.index.serialize(),this.input.serialize()]};var _r=function(t,e){this.type=Ot,this.needle=t,this.haystack=e;};_r.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r,n=e.parse(t[1],1,qt),i=e.parse(t[2],2,qt);return n&&i?"boolean"!==(r=n.type).kind&&"string"!==r.kind&&"number"!==r.kind&&"null"!==r.kind&&"value"!==r.kind?e.error("Expected first argument to be of type boolean, string, number or null, but found "+Zt(n.type)+" instead"):new _r(n,i):null},_r.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(null==e||!r)return !1;if(!function(t){return "boolean"==typeof t||"string"==typeof t||"number"==typeof t}(e))throw new se("Expected first argument to be of type boolean, string or number, but found "+Zt(ie(e))+" instead.");if(!function(t){return Array.isArray(t)||"string"==typeof t}(r))throw new se("Expected second argument to be of type array or string, but found "+Zt(ie(r))+" instead.");return r.indexOf(e)>=0},_r.prototype.eachChild=function(t){t(this.needle),t(this.haystack);},_r.prototype.outputDefined=function(){return !0},_r.prototype.serialize=function(){return ["in",this.needle.serialize(),this.haystack.serialize()]};var Ar=function(t,e,r,n,i,a){this.inputType=t,this.type=e,this.input=r,this.cases=n,this.outputs=i,this.otherwise=a;};Ar.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var r,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var i={},a=[],o=2;o<t.length-1;o+=2){var s=t[o],u=t[o+1];Array.isArray(s)||(s=[s]);var l=e.concat(o);if(0===s.length)return l.error("Expected at least one branch label.");for(var p=0,c=s;p<c.length;p+=1){var h=c[p];if("number"!=typeof h&&"string"!=typeof h)return l.error("Branch labels must be numbers or strings.");if("number"==typeof h&&Math.abs(h)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof h&&Math.floor(h)!==h)return l.error("Numeric branch labels must be integer values.");if(r){if(l.checkSubtype(r,ie(h)))return null}else r=ie(h);if(void 0!==i[String(h)])return l.error("Branch labels must be unique.");i[String(h)]=a.length;}var f=e.parse(u,o,n);if(!f)return null;n=n||f.type,a.push(f);}var y=e.parse(t[1],1,qt);if(!y)return null;var d=e.parse(t[t.length-1],t.length-1,n);return d?"value"!==y.type.kind&&e.concat(1).checkSubtype(r,y.type)?null:new Ar(r,n,y,i,a,d):null},Ar.prototype.evaluate=function(t){var e=this.input.evaluate(t);return (ie(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},Ar.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise);},Ar.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))&&this.otherwise.outputDefined()},Ar.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],r=[],n={},i=0,a=Object.keys(this.cases).sort();i<a.length;i+=1){var o=a[i];void 0===(c=n[this.cases[o]])?(n[this.cases[o]]=r.length,r.push([this.cases[o],[o]])):r[c][1].push(o);}for(var s=function(e){return "number"===t.inputType.kind?Number(e):e},u=0,l=r;u<l.length;u+=1){var p=l[u],c=p[0],h=p[1];e.push(1===h.length?s(h[0]):h.map(s)),e.push(this.outputs[outputIndex$1].serialize());}return e.push(this.otherwise.serialize()),e};var Sr=function(t,e,r){this.type=t,this.branches=e,this.otherwise=r;};function kr(t,e){return "=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Ir(t,e,r,n){return 0===n.compare(e,r)}function zr(t,e,r){var n="=="!==t&&"!="!==t;return function(){function i(t,e,r){this.type=Ot,this.lhs=t,this.rhs=e,this.collator=r,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind;}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var r=t[0],a=e.parse(t[1],1,qt);if(!a)return null;if(!kr(r,a.type))return e.concat(1).error('"'+r+"\" comparisons are not supported for type '"+Zt(a.type)+"'.");var o=e.parse(t[2],2,qt);if(!o)return null;if(!kr(r,o.type))return e.concat(2).error('"'+r+"\" comparisons are not supported for type '"+Zt(o.type)+"'.");if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot compare types '"+Zt(a.type)+"' and '"+Zt(o.type)+"'.");n&&("value"===a.type.kind&&"value"!==o.type.kind?a=new le(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new le(a.type,[o])));var s=null;if(4===t.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Nt)))return null}return new i(a,o,s)},i.prototype.evaluate=function(i){var a=this.lhs.evaluate(i),o=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){var s=ie(a),u=ie(o);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new se('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!n&&this.hasUntypedArgument){var l=ie(a),p=ie(o);if("string"!==l.kind||"string"!==p.kind)return e(i,a,o)}return this.collator?r(i,a,o,this.collator.evaluate(i)):e(i,a,o)},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator);},i.prototype.outputDefined=function(){return !0},i.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize());})),e},i}()}Sr.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var n=[],i=1;i<t.length-1;i+=2){var a=e.parse(t[i],i,Ot);if(!a)return null;var o=e.parse(t[i+1],i+1,r);if(!o)return null;n.push([a,o]),r=r||o.type;}var s=e.parse(t[t.length-1],t.length-1,r);return s?new Sr(r,n,s):null},Sr.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[1];if(n[0].evaluate(t))return i.evaluate(t)}return this.otherwise.evaluate(t)},Sr.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[1];t(n[0]),t(i);}t(this.otherwise);},Sr.prototype.outputDefined=function(){return this.branches.every((function(t){return t[1].outputDefined()}))&&this.otherwise.outputDefined()},Sr.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize());})),t};var Cr=zr("==",(function(t,e,r){return e===r}),Ir),Mr=zr("!=",(function(t,e,r){return e!==r}),(function(t,e,r,n){return !Ir(0,e,r,n)})),Tr=zr("<",(function(t,e,r){return e<r}),(function(t,e,r,n){return n.compare(e,r)<0})),Er=zr(">",(function(t,e,r){return e>r}),(function(t,e,r,n){return n.compare(e,r)>0})),Pr=zr("<=",(function(t,e,r){return e<=r}),(function(t,e,r,n){return n.compare(e,r)<=0})),Br=zr(">=",(function(t,e,r){return e>=r}),(function(t,e,r,n){return n.compare(e,r)>=0})),Vr=function(t,e,r,n,i){this.type=Rt,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=n,this.maxFractionDigits=i;};Vr.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,Lt);if(!r)return null;var n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");var i=null;if(n.locale&&!(i=e.parse(n.locale,1,Rt)))return null;var a=null;if(n.currency&&!(a=e.parse(n.currency,1,Rt)))return null;var o=null;if(n["min-fraction-digits"]&&!(o=e.parse(n["min-fraction-digits"],1,Lt)))return null;var s=null;return n["max-fraction-digits"]&&!(s=e.parse(n["max-fraction-digits"],1,Lt))?null:new Vr(r,i,a,o,s)},Vr.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Vr.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits);},Vr.prototype.outputDefined=function(){return !1},Vr.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Fr=function(t){this.type=Lt,this.input=t;};Fr.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error("Expected argument of type string or array, but found "+Zt(r.type)+" instead."):new Fr(r):null},Fr.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new se("Expected value to be of type string or array, but found "+Zt(ie(e))+" instead.")},Fr.prototype.eachChild=function(t){t(this.input);},Fr.prototype.outputDefined=function(){return !1},Fr.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize());})),t};var Dr={"==":Cr,"!=":Mr,">":Er,"<":Tr,">=":Br,"<=":Pr,array:le,at:wr,boolean:le,case:Sr,coalesce:xr,collator:ve,format:pe,image:ce,in:_r,interpolate:vr,"interpolate-hcl":vr,"interpolate-lab":vr,length:Fr,let:br,literal:oe,match:Ar,number:le,"number-format":Vr,object:le,step:Ze,string:le,"to-boolean":fe,"to-color":fe,"to-number":fe,"to-string":fe,var:Ke,within:Ue};function Lr(t,e){var r=e[0],n=e[1],i=e[2],a=e[3];r=r.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);var o=a?a.evaluate(t):1,s=re(r,n,i,o);if(s)throw new se(s);return new $t(r/255*o,n/255*o,i/255*o,o)}function Rr(t,e){return t in e}function Or(t,e){var r=e[t];return void 0===r?null:r}function Ur(t){return {type:t}}function jr(t){return {result:"success",value:t}}function qr(t){return {result:"error",value:t}}function Nr(t){return "data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Kr(t){return !!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Xr(t){return !!t.expression&&t.expression.interpolated}function Gr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Zr(t){return "object"==typeof t&&null!==t&&!Array.isArray(t)}function Jr(t){return t}function Hr(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function Yr(t,e,r,n,i){return Hr(typeof r===i?n[r]:void 0,t.default,e.default)}function $r(t,e,r){if("number"!==Gr(r))return Hr(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];var i=Ge(t.stops.map((function(t){return t[0]})),r);return t.stops[i][1]}function Wr(t,e,r){var n=void 0!==t.base?t.base:1;if("number"!==Gr(r))return Hr(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];var a=Ge(t.stops.map((function(t){return t[0]})),r),o=function(t,e,r,n){var i=n-r,a=t-r;return 0===i?0:1===e?a/i:(Math.pow(e,a)-1)/(Math.pow(e,i)-1)}(r,n,t.stops[a][0],t.stops[a+1][0]),s=t.stops[a][1],u=t.stops[a+1][1],l=$e[e.type]||Jr;if(t.colorSpace&&"rgb"!==t.colorSpace){var p=mr[t.colorSpace];l=function(t,e){return p.reverse(p.interpolate(p.forward(t),p.forward(e),o))};}return "function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=s.evaluate.apply(void 0,t),n=u.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==n)return l(r,n,o)}}:l(s,u,o)}function Qr(t,e,r){return "color"===e.type?r=$t.parse(r):"formatted"===e.type?r=te.fromString(r.toString()):"resolvedImage"===e.type?r=ee.fromString(r.toString()):Gr(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),Hr(r,t.default,e.default)}me.register(Dr,{error:[{kind:"error"},[Rt],function(t,e){throw new se(e[0].evaluate(t))}],typeof:[Rt,[qt],function(t,e){return Zt(ie(e[0].evaluate(t)))}],"to-rgba":[Gt(Lt,4),[Ut],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Ut,[Lt,Lt,Lt],Lr],rgba:[Ut,[Lt,Lt,Lt,Lt],Lr],has:{type:Ot,overloads:[[[Rt],function(t,e){return Rr(e[0].evaluate(t),t.properties())}],[[Rt,jt],function(t,e){var r=e[1];return Rr(e[0].evaluate(t),r.evaluate(t))}]]},get:{type:qt,overloads:[[[Rt],function(t,e){return Or(e[0].evaluate(t),t.properties())}],[[Rt,jt],function(t,e){var r=e[1];return Or(e[0].evaluate(t),r.evaluate(t))}]]},"feature-state":[qt,[Rt],function(t,e){return Or(e[0].evaluate(t),t.featureState||{})}],properties:[jt,[],function(t){return t.properties()}],"geometry-type":[Rt,[],function(t){return t.geometryType()}],id:[qt,[],function(t){return t.id()}],zoom:[Lt,[],function(t){return t.globals.zoom}],"heatmap-density":[Lt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Lt,[],function(t){return t.globals.lineProgress||0}],accumulated:[qt,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Lt,Ur(Lt),function(t,e){for(var r=0,n=0,i=e;n<i.length;n+=1)r+=i[n].evaluate(t);return r}],"*":[Lt,Ur(Lt),function(t,e){for(var r=1,n=0,i=e;n<i.length;n+=1)r*=i[n].evaluate(t);return r}],"-":{type:Lt,overloads:[[[Lt,Lt],function(t,e){var r=e[1];return e[0].evaluate(t)-r.evaluate(t)}],[[Lt],function(t,e){return -e[0].evaluate(t)}]]},"/":[Lt,[Lt,Lt],function(t,e){var r=e[1];return e[0].evaluate(t)/r.evaluate(t)}],"%":[Lt,[Lt,Lt],function(t,e){var r=e[1];return e[0].evaluate(t)%r.evaluate(t)}],ln2:[Lt,[],function(){return Math.LN2}],pi:[Lt,[],function(){return Math.PI}],e:[Lt,[],function(){return Math.E}],"^":[Lt,[Lt,Lt],function(t,e){var r=e[1];return Math.pow(e[0].evaluate(t),r.evaluate(t))}],sqrt:[Lt,[Lt],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[Lt,[Lt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[Lt,[Lt],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[Lt,[Lt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[Lt,[Lt],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[Lt,[Lt],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[Lt,[Lt],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[Lt,[Lt],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[Lt,[Lt],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[Lt,[Lt],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[Lt,Ur(Lt),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[Lt,Ur(Lt),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[Lt,[Lt],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[Lt,[Lt],function(t,e){var r=e[0].evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[Lt,[Lt],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[Lt,[Lt],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[Ot,[Rt,qt],function(t,e){var r=e[0],n=e[1];return t.properties()[r.value]===n.value}],"filter-id-==":[Ot,[qt],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[Ot,[Rt],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[Ot,[Rt,qt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],a=n.value;return typeof i==typeof a&&i<a}],"filter-id-<":[Ot,[qt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<i}],"filter->":[Ot,[Rt,qt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],a=n.value;return typeof i==typeof a&&i>a}],"filter-id->":[Ot,[qt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n>i}],"filter-<=":[Ot,[Rt,qt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],a=n.value;return typeof i==typeof a&&i<=a}],"filter-id-<=":[Ot,[qt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<=i}],"filter->=":[Ot,[Rt,qt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],a=n.value;return typeof i==typeof a&&i>=a}],"filter-id->=":[Ot,[qt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n>=i}],"filter-has":[Ot,[qt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[Ot,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[Ot,[Gt(Rt)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Ot,[Gt(qt)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[Ot,[Rt,Gt(qt)],function(t,e){var r=e[0];return e[1].value.indexOf(t.properties()[r.value])>=0}],"filter-in-large":[Ot,[Rt,Gt(qt)],function(t,e){var r=e[0],n=e[1];return function(t,e,r,n){for(;r<=n;){var i=r+n>>1;if(e[i]===t)return !0;e[i]>t?n=i-1:r=i+1;}return !1}(t.properties()[r.value],n.value,0,n.value.length-1)}],all:{type:Ot,overloads:[[[Ot,Ot],function(t,e){var r=e[1];return e[0].evaluate(t)&&r.evaluate(t)}],[Ur(Ot),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(!n[r].evaluate(t))return !1;return !0}]]},any:{type:Ot,overloads:[[[Ot,Ot],function(t,e){var r=e[1];return e[0].evaluate(t)||r.evaluate(t)}],[Ur(Ot),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(n[r].evaluate(t))return !0;return !1}]]},"!":[Ot,[Ot],function(t,e){return !e[0].evaluate(t)}],"is-supported-script":[Ot,[Rt],function(t,e){var r=t.globals&&t.globals.isSupportedScript;return !r||r(e[0].evaluate(t))}],upcase:[Rt,[Rt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Rt,[Rt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Rt,Ur(qt),function(t,e){return e.map((function(e){return ae(e.evaluate(t))})).join("")}],"resolved-locale":[Rt,[Nt],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var tn=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new de,this._defaultValue=e?function(t){return "color"===t.type&&Zr(t.default)?new $t(0,0,0,0):"color"===t.type?$t.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null;};function en(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Dr}function rn(t,e){var r=new Xe(Dr,[],e?function(t){var e={color:Ut,string:Rt,number:Lt,enum:Rt,boolean:Ot,formatted:Kt,resolvedImage:Xt};return "array"===t.type?Gt(e[t.value]||qt,t.length):e[t.type]}(e):void 0),n=r.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?jr(new tn(n,e)):qr(r.errors)}tn.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)},tn.prototype.evaluate=function(t,e,r,n,i,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a||null;try{var o=this.expression.evaluate(this._evaluator);if(null==o||"number"==typeof o&&o!=o)return this._defaultValue;if(this._enumValues&&!(o in this._enumValues))throw new se("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(o)+" instead.");return o}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var nn=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!qe(e.expression);};nn.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,a)},nn.prototype.evaluate=function(t,e,r,n,i,a){return this._styleExpression.evaluate(t,e,r,n,i,a)};var an=function(t,e,r,n){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent="camera"!==t&&!qe(e.expression),this.interpolationType=n;};function on(t,e){if("error"===(t=rn(t,e)).result)return t;var r=t.value.expression,n=je(r);if(!n&&!Nr(e))return qr([new Vt("","data expressions not supported")]);var i=Ne(r,["zoom"]);if(!i&&!Kr(e))return qr([new Vt("","zoom expressions not supported")]);var a=function t(e){var r=null;if(e instanceof br)r=t(e.result);else if(e instanceof xr)for(var n=0,i=e.args;n<i.length&&!(r=t(i[n]));n+=1);else(e instanceof Ze||e instanceof vr)&&e.input instanceof me&&"zoom"===e.input.name&&(r=e);return r instanceof Vt?r:(e.eachChild((function(e){var n=t(e);n instanceof Vt?r=n:!r&&n?r=new Vt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&n&&r!==n&&(r=new Vt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'));})),r)}(r);return a||i?a instanceof Vt?qr([a]):a instanceof vr&&!Xr(e)?qr([new Vt("",'"interpolate" expressions cannot be used with this property')]):jr(a?new an(n?"camera":"composite",t.value,a.labels,a instanceof vr?a.interpolation:void 0):new nn(n?"constant":"source",t.value)):qr([new Vt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}an.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,a)},an.prototype.evaluate=function(t,e,r,n,i,a){return this._styleExpression.evaluate(t,e,r,n,i,a)},an.prototype.interpolationFactor=function(t,e,r){return this.interpolationType?vr.interpolationFactor(this.interpolationType,t,e,r):0};var sn=function(t,e){this._parameters=t,this._specification=e,Et(this,function t(e,r){var n,i,a,o="color"===r.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||!(s||void 0!==e.property),l=e.type||(Xr(r)?"exponential":"interval");if(o&&((e=Et({},e)).stops&&(e.stops=e.stops.map((function(t){return [t[0],$t.parse(t[1])]}))),e.default=$t.parse(e.default?e.default:r.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!mr[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===l)n=Wr;else if("interval"===l)n=$r;else if("categorical"===l){n=Yr,i=Object.create(null);for(var p=0,c=e.stops;p<c.length;p+=1){var h=c[p];i[h[0]]=h[1];}a=typeof e.stops[0][0];}else{if("identity"!==l)throw new Error('Unknown function type "'+l+'"');n=Qr;}if(s){for(var f={},y=[],d=0;d<e.stops.length;d++){var m=e.stops[d],v=m[0].zoom;void 0===f[v]&&(f[v]={zoom:v,type:e.type,property:e.property,default:e.default,stops:[]},y.push(v)),f[v].stops.push([m[0].value,m[1]]);}for(var g=[],x=0,b=y;x<b.length;x+=1){var w=b[x];g.push([f[w].zoom,t(f[w],r)]);}var _={name:"linear"};return {kind:"composite",interpolationType:_,interpolationFactor:vr.interpolationFactor.bind(void 0,_),zoomStops:g.map((function(t){return t[0]})),evaluate:function(t,n){var i=t.zoom;return Wr({stops:g,base:e.base},r,i).evaluate(i,n)}}}if(u){var A="exponential"===l?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return {kind:"camera",interpolationType:A,interpolationFactor:vr.interpolationFactor.bind(void 0,A),zoomStops:e.stops.map((function(t){return t[0]})),evaluate:function(t){return n(e,r,t.zoom,i,a)}}}return {kind:"source",evaluate:function(t,o){var s=o&&o.properties?o.properties[e.property]:void 0;return void 0===s?Hr(e.default,r.default):n(e,r,s,i,a)}}}(this._parameters,this._specification));};function un(t){var e=t.key,r=t.value,n=t.valueSpec||{},i=t.objectElementValidators||{},a=t.style,o=t.styleSpec,s=[],u=Gr(r);if("object"!==u)return [new Mt(e,r,"object expected, "+u+" found")];for(var l in r){var p=l.split(".")[0],c=n[p]||n["*"],h=void 0;if(i[p])h=i[p];else if(n[p])h=Bn;else if(i["*"])h=i["*"];else{if(!n["*"]){s.push(new Mt(e,r[l],'unknown property "'+l+'"'));continue}h=Bn;}s=s.concat(h({key:(e?e+".":e)+l,value:r[l],valueSpec:c,style:a,styleSpec:o,object:r,objectKey:l},r));}for(var f in n)i[f]||n[f].required&&void 0===n[f].default&&void 0===r[f]&&s.push(new Mt(e,r,'missing required property "'+f+'"'));return s}function ln(t){var e=t.value,r=t.valueSpec,n=t.style,i=t.styleSpec,a=t.key,o=t.arrayElementValidator||Bn;if("array"!==Gr(e))return [new Mt(a,e,"array expected, "+Gr(e)+" found")];if(r.length&&e.length!==r.length)return [new Mt(a,e,"array length "+r.length+" expected, length "+e.length+" found")];if(r["min-length"]&&e.length<r["min-length"])return [new Mt(a,e,"array length at least "+r["min-length"]+" expected, length "+e.length+" found")];var s={type:r.value,values:r.values};i.$version<7&&(s.function=r.function),"object"===Gr(r.value)&&(s=r.value);for(var u=[],l=0;l<e.length;l++)u=u.concat(o({array:e,arrayIndex:l,value:e[l],valueSpec:s,style:n,styleSpec:i,key:a+"["+l+"]"}));return u}function pn(t){var e=t.key,r=t.value,n=t.valueSpec,i=Gr(r);return "number"===i&&r!=r&&(i="NaN"),"number"!==i?[new Mt(e,r,"number expected, "+i+" found")]:"minimum"in n&&r<n.minimum?[new Mt(e,r,r+" is less than the minimum value "+n.minimum)]:"maximum"in n&&r>n.maximum?[new Mt(e,r,r+" is greater than the maximum value "+n.maximum)]:[]}function cn(t){var e,r,n,i=t.valueSpec,a=Pt(t.value.type),o={},s="categorical"!==a&&void 0===t.value.property,u=!s,l="array"===Gr(t.value.stops)&&"array"===Gr(t.value.stops[0])&&"object"===Gr(t.value.stops[0][0]),p=un({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===a)return [new Mt(t.key,t.value,'identity function may not have a "stops" property')];var e=[],r=t.value;return e=e.concat(ln({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:c})),"array"===Gr(r)&&0===r.length&&e.push(new Mt(t.key,r,"array must have at least one stop")),e},default:function(t){return Bn({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return "identity"===a&&s&&p.push(new Mt(t.key,t.value,'missing required property "property"')),"identity"===a||t.value.stops||p.push(new Mt(t.key,t.value,'missing required property "stops"')),"exponential"===a&&t.valueSpec.expression&&!Xr(t.valueSpec)&&p.push(new Mt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!Nr(t.valueSpec)?p.push(new Mt(t.key,t.value,"property functions not supported")):s&&!Kr(t.valueSpec)&&p.push(new Mt(t.key,t.value,"zoom functions not supported"))),"categorical"!==a&&!l||void 0!==t.value.property||p.push(new Mt(t.key,t.value,'"property" property is required')),p;function c(t){var e=[],a=t.value,s=t.key;if("array"!==Gr(a))return [new Mt(s,a,"array expected, "+Gr(a)+" found")];if(2!==a.length)return [new Mt(s,a,"array length 2 expected, length "+a.length+" found")];if(l){if("object"!==Gr(a[0]))return [new Mt(s,a,"object expected, "+Gr(a[0])+" found")];if(void 0===a[0].zoom)return [new Mt(s,a,"object stop key must have zoom")];if(void 0===a[0].value)return [new Mt(s,a,"object stop key must have value")];if(n&&n>Pt(a[0].zoom))return [new Mt(s,a[0].zoom,"stop zoom values must appear in ascending order")];Pt(a[0].zoom)!==n&&(n=Pt(a[0].zoom),r=void 0,o={}),e=e.concat(un({key:s+"[0]",value:a[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:pn,value:h}}));}else e=e.concat(h({key:s+"[0]",value:a[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},a));return en(Bt(a[1]))?e.concat([new Mt(s+"[1]",a[1],"expressions are not allowed in function stops.")]):e.concat(Bn({key:s+"[1]",value:a[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function h(t,n){var s=Gr(t.value),u=Pt(t.value),l=null!==t.value?t.value:n;if(e){if(s!==e)return [new Mt(t.key,l,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return [new Mt(t.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==a){var p="number expected, "+s+" found";return Nr(i)&&void 0===a&&(p+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Mt(t.key,l,p)]}return "categorical"!==a||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==a&&"number"===s&&void 0!==r&&u<r?[new Mt(t.key,l,"stop domain values must appear in ascending order")]:(r=u,"categorical"===a&&u in o?[new Mt(t.key,l,"stop domain values must be unique")]:(o[u]=!0,[])):[new Mt(t.key,l,"integer expected, found "+u)]}}function hn(t){var e=("property"===t.expressionContext?on:rn)(Bt(t.value),t.valueSpec);if("error"===e.result)return e.value.map((function(e){return new Mt(""+t.key+e.key,t.value,e.message)}));var r=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!r.outputDefined())return [new Mt(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!qe(r))return [new Mt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!qe(r))return [new Mt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Ne(r,["zoom","feature-state"]))return [new Mt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!je(r))return [new Mt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return []}function fn(t){var e=t.key,r=t.value,n=t.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(Pt(r))&&i.push(new Mt(e,r,"expected one of ["+n.values.join(", ")+"], "+JSON.stringify(r)+" found")):-1===Object.keys(n.values).indexOf(Pt(r))&&i.push(new Mt(e,r,"expected one of ["+Object.keys(n.values).join(", ")+"], "+JSON.stringify(r)+" found")),i}function yn(t){if(!0===t||!1===t)return !0;if(!Array.isArray(t)||0===t.length)return !1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return !1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var n=r[e];if(!yn(n)&&"boolean"!=typeof n)return !1}return !0;default:return !0}}sn.deserialize=function(t){return new sn(t._parameters,t._specification)},sn.serialize=function(t){return {_parameters:t._parameters,_specification:t._specification}};var dn={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function mn(t){if(null==t)return {filter:function(){return !0},needGeometry:!1};yn(t)||(t=gn(t));var e=rn(t,dn);if("error"===e.result)throw new Error(e.value.map((function(t){return t.key+": "+t.message})).join(", "));return {filter:function(t,r,n){return e.value.evaluate(t,r,{},n)},needGeometry:Array.isArray(t)&&0!==t.length&&"within"===t[0]}}function vn(t,e){return t<e?-1:t>e?1:0}function gn(t){if(!t)return !0;var e,r=t[0];return t.length<=1?"any"!==r:"=="===r?xn(t[1],t[2],"=="):"!="===r?_n(xn(t[1],t[2],"==")):"<"===r||">"===r||"<="===r||">="===r?xn(t[1],t[2],r):"any"===r?(e=t.slice(1),["any"].concat(e.map(gn))):"all"===r?["all"].concat(t.slice(1).map(gn)):"none"===r?["all"].concat(t.slice(1).map(gn).map(_n)):"in"===r?bn(t[1],t.slice(2)):"!in"===r?_n(bn(t[1],t.slice(2))):"has"===r?wn(t[1]):"!has"!==r||_n(wn(t[1]))}function xn(t,e,r){switch(t){case"$type":return ["filter-type-"+r,e];case"$id":return ["filter-id-"+r,e];default:return ["filter-"+r,t,e]}}function bn(t,e){if(0===e.length)return !1;switch(t){case"$type":return ["filter-type-in",["literal",e]];case"$id":return ["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return typeof t!=typeof e[0]}))?["filter-in-large",t,["literal",e.sort(vn)]]:["filter-in-small",t,["literal",e]]}}function wn(t){switch(t){case"$type":return !0;case"$id":return ["filter-has-id"];default:return ["filter-has",t]}}function _n(t){return ["!",t]}function An(t){return yn(Bt(t.value))?hn(Et({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var r=e.value,n=e.key;if("array"!==Gr(r))return [new Mt(n,r,"array expected, "+Gr(r)+" found")];var i,a=e.styleSpec,o=[];if(r.length<1)return [new Mt(n,r,"filter array must have at least 1 element")];switch(o=o.concat(fn({key:n+"[0]",value:r[0],valueSpec:a.filter_operator,style:e.style,styleSpec:e.styleSpec})),Pt(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===Pt(r[1])&&o.push(new Mt(n,r,'"$type" cannot be use with operator "'+r[0]+'"'));case"==":case"!=":3!==r.length&&o.push(new Mt(n,r,'filter array for operator "'+r[0]+'" must have 3 elements'));case"in":case"!in":r.length>=2&&"string"!==(i=Gr(r[1]))&&o.push(new Mt(n+"[1]",r[1],"string expected, "+i+" found"));for(var s=2;s<r.length;s++)i=Gr(r[s]),"$type"===Pt(r[1])?o=o.concat(fn({key:n+"["+s+"]",value:r[s],valueSpec:a.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&o.push(new Mt(n+"["+s+"]",r[s],"string, number, or boolean expected, "+i+" found"));break;case"any":case"all":case"none":for(var u=1;u<r.length;u++)o=o.concat(t({key:n+"["+u+"]",value:r[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Gr(r[1]),2!==r.length?o.push(new Mt(n,r,'filter array for "'+r[0]+'" operator must have 2 elements')):"string"!==i&&o.push(new Mt(n+"[1]",r[1],"string expected, "+i+" found"));}return o}(t)}function Sn(t,e){var r=t.key,n=t.style,i=t.styleSpec,a=t.value,o=t.objectKey,s=i[e+"_"+t.layerType];if(!s)return [];var u=o.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return Bn({key:r,value:a,valueSpec:i.transition,style:n,styleSpec:i});var l,p=t.valueSpec||s[o];if(!p)return [new Mt(r,a,'unknown property "'+o+'"')];if("string"===Gr(a)&&Nr(p)&&!p.tokens&&(l=/^{([^}]+)}$/.exec(a)))return [new Mt(r,a,'"'+o+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var c=[];return "symbol"===t.layerType&&("text-field"===o&&n&&!n.glyphs&&c.push(new Mt(r,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&Zr(Bt(a))&&"identity"===Pt(a.type)&&c.push(new Mt(r,a,'"text-font" does not support identity functions'))),c.concat(Bn({key:t.key,value:a,valueSpec:p,style:n,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:o}))}function kn(t){return Sn(t,"paint")}function In(t){return Sn(t,"layout")}function zn(t){var e=[],r=t.value,n=t.key,i=t.style,a=t.styleSpec;r.type||r.ref||e.push(new Mt(n,r,'either "type" or "ref" is required'));var o,s=Pt(r.type),u=Pt(r.ref);if(r.id)for(var l=Pt(r.id),p=0;p<t.arrayIndex;p++){var c=i.layers[p];Pt(c.id)===l&&e.push(new Mt(n,r.id,'duplicate layer id "'+r.id+'", previously used at line '+c.id.__line__));}if("ref"in r)["type","source","source-layer","filter","layout"].forEach((function(t){t in r&&e.push(new Mt(n,r[t],'"'+t+'" is prohibited for ref layers'));})),i.layers.forEach((function(t){Pt(t.id)===u&&(o=t);})),o?o.ref?e.push(new Mt(n,r.ref,"ref cannot reference another ref layer")):s=Pt(o.type):e.push(new Mt(n,r.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(r.source){var h=i.sources&&i.sources[r.source],f=h&&Pt(h.type);h?"vector"===f&&"raster"===s?e.push(new Mt(n,r.source,'layer "'+r.id+'" requires a raster source')):"raster"===f&&"raster"!==s?e.push(new Mt(n,r.source,'layer "'+r.id+'" requires a vector source')):"vector"!==f||r["source-layer"]?"raster-dem"===f&&"hillshade"!==s?e.push(new Mt(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!r.paint||!r.paint["line-gradient"]||"geojson"===f&&h.lineMetrics||e.push(new Mt(n,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new Mt(n,r,'layer "'+r.id+'" must specify a "source-layer"')):e.push(new Mt(n,r.source,'source "'+r.source+'" not found'));}else e.push(new Mt(n,r,'missing required property "source"'));return e=e.concat(un({key:n,value:r,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return []},type:function(){return Bn({key:n+".type",value:r.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"})},filter:An,layout:function(t){return un({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return In(Et({layerType:s},t))}}})},paint:function(t){return un({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return kn(Et({layerType:s},t))}}})}}}))}function Cn(t){var e=t.value,r=t.key,n=Gr(e);return "string"!==n?[new Mt(r,e,"string expected, "+n+" found")]:[]}var Mn={promoteId:function(t){var e=t.key,r=t.value;if("string"===Gr(r))return Cn({key:e,value:r});var n=[];for(var i in r)n.push.apply(n,Cn({key:e+"."+i,value:r[i]}));return n}};function Tn(t){var e=t.value,r=t.key,n=t.styleSpec,i=t.style;if(!e.type)return [new Mt(r,e,'"type" is required')];var a,o=Pt(e.type);switch(o){case"vector":case"raster":case"raster-dem":return un({key:r,value:e,valueSpec:n["source_"+o.replace("-","_")],style:t.style,styleSpec:n,objectElementValidators:Mn});case"geojson":if(a=un({key:r,value:e,valueSpec:n.source_geojson,style:i,styleSpec:n,objectElementValidators:Mn}),e.cluster)for(var s in e.clusterProperties){var u=e.clusterProperties[s],l=u[0],p="string"==typeof l?[l,["accumulated"],["get",s]]:l;a.push.apply(a,hn({key:r+"."+s+".map",value:u[1],expressionContext:"cluster-map"})),a.push.apply(a,hn({key:r+"."+s+".reduce",value:p,expressionContext:"cluster-reduce"}));}return a;case"video":return un({key:r,value:e,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return un({key:r,value:e,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return [new Mt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return fn({key:r+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:n})}}function En(t){var e=t.value,r=t.styleSpec,n=r.light,i=t.style,a=[],o=Gr(e);if(void 0===e)return a;if("object"!==o)return a.concat([new Mt("light",e,"object expected, "+o+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);a=a.concat(u&&n[u[1]]&&n[u[1]].transition?Bn({key:s,value:e[s],valueSpec:r.transition,style:i,styleSpec:r}):n[s]?Bn({key:s,value:e[s],valueSpec:n[s],style:i,styleSpec:r}):[new Mt(s,e[s],'unknown property "'+s+'"')]);}return a}var Pn={"*":function(){return []},array:ln,boolean:function(t){var e=t.value,r=t.key,n=Gr(e);return "boolean"!==n?[new Mt(r,e,"boolean expected, "+n+" found")]:[]},number:pn,color:function(t){var e=t.key,r=t.value,n=Gr(r);return "string"!==n?[new Mt(e,r,"color expected, "+n+" found")]:null===Yt(r)?[new Mt(e,r,'color expected, "'+r+'" found')]:[]},constants:Tt,enum:fn,filter:An,function:cn,layer:zn,object:un,source:Tn,light:En,string:Cn,formatted:function(t){return 0===Cn(t).length?[]:hn(t)},resolvedImage:function(t){return 0===Cn(t).length?[]:hn(t)}};function Bn(t){var e=t.value,r=t.valueSpec,n=t.styleSpec;return r.expression&&Zr(Pt(e))?cn(t):r.expression&&en(Bt(e))?hn(t):r.type&&Pn[r.type]?Pn[r.type](t):un(Et({},t,{valueSpec:r.type?n[r.type]:r}))}function Vn(t){var e=t.value,r=t.key,n=Cn(t);return n.length?n:(-1===e.indexOf("{fontstack}")&&n.push(new Mt(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new Mt(r,e,'"glyphs" url must include a "{range}" token')),n)}function Fn(t,e){void 0===e&&(e=Ct);var r=[];return r=r.concat(Bn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Vn,"*":function(){return []}}})),t.constants&&(r=r.concat(Tt({key:"constants",value:t.constants,style:t,styleSpec:e}))),Dn(r)}function Dn(t){return [].concat(t).sort((function(t,e){return t.line-e.line}))}function Ln(t){return function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return Dn(t.apply(this,e))}}Fn.source=Ln(Tn),Fn.light=Ln(En),Fn.layer=Ln(zn),Fn.filter=Ln(An),Fn.paintProperty=Ln(kn),Fn.layoutProperty=Ln(In);var Rn=Fn,On=Rn.light,Un=Rn.paintProperty,jn=Rn.layoutProperty;function qn(t,e){var r=!1;if(e&&e.length)for(var n=0,i=e;n<i.length;n+=1)t.fire(new It(new Error(i[n].message))),r=!0;return r}var Nn=Xn,Kn=3;function Xn(t,e,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(r=i[2]);for(var a=0;a<this.d*this.d;a++){var o=i[Kn+a],s=i[Kn+a+1];n.push(o===s?null:i.subarray(o,s));}var u=i[Kn+n.length+1];this.keys=i.subarray(i[Kn+n.length],u),this.bboxes=i.subarray(u),this.insert=this._insertReadonly;}else{this.d=e+2*r;for(var l=0;l<this.d*this.d;l++)n.push([]);this.keys=[],this.bboxes=[];}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var p=r/e*t;this.min=-p,this.max=t+p;}Xn.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i);},Xn.prototype._insertReadonly=function(){throw "Cannot insert into a GridIndex created from an ArrayBuffer."},Xn.prototype._insertCell=function(t,e,r,n,i,a){this.cells[i].push(a);},Xn.prototype.query=function(t,e,r,n,i){var a=this.min,o=this.max;if(t<=a&&e<=a&&o<=r&&o<=n&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,r,n,this._queryCell,s,{},i),s},Xn.prototype._queryCell=function(t,e,r,n,i,a,o,s){var u=this.cells[i];if(null!==u)for(var l=this.keys,p=this.bboxes,c=0;c<u.length;c++){var h=u[c];if(void 0===o[h]){var f=4*h;(s?s(p[f+0],p[f+1],p[f+2],p[f+3]):t<=p[f+2]&&e<=p[f+3]&&r>=p[f+0]&&n>=p[f+1])?(o[h]=!0,a.push(l[h])):o[h]=!1;}}},Xn.prototype._forEachCell=function(t,e,r,n,i,a,o,s){for(var u=this._convertToCellCoord(t),l=this._convertToCellCoord(e),p=this._convertToCellCoord(r),c=this._convertToCellCoord(n),h=u;h<=p;h++)for(var f=l;f<=c;f++){var y=this.d*f+h;if((!s||s(this._convertFromCellCoord(h),this._convertFromCellCoord(f),this._convertFromCellCoord(h+1),this._convertFromCellCoord(f+1)))&&i.call(this,t,e,r,n,y,a,o,s))return}},Xn.prototype._convertFromCellCoord=function(t){return (t-this.padding)/this.scale},Xn.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Xn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Kn+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(e+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var a=e,o=0;o<t.length;o++){var s=t[o];i[Kn+o]=a,i.set(s,a),a+=s.length;}return i[Kn+t.length]=a,i.set(this.keys,a),i[Kn+t.length+1]=a+=this.keys.length,i.set(this.bboxes,a),a+=this.bboxes.length,i.buffer};var Gn=self.ImageData,Zn=self.ImageBitmap,Jn={};function Hn(t,e,r){void 0===r&&(r={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Jn[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]};}for(var Yn in Hn("Object",Object),Nn.serialize=function(t,e){var r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},Nn.deserialize=function(t){return new Nn(t.buffer)},Hn("Grid",Nn),Hn("Color",$t),Hn("Error",Error),Hn("ResolvedImage",ee),Hn("StylePropertyFunction",sn),Hn("StyleExpression",tn,{omit:["_evaluator"]}),Hn("ZoomDependentExpression",an),Hn("ZoomConstantExpression",nn),Hn("CompoundExpression",me,{omit:["_evaluate"]}),Dr)Dr[Yn]._classRegistryKey||Hn("Expression_"+Yn,Dr[Yn]);function $n(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Wn(t){return Zn&&t instanceof Zn}function Qn(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if($n(t)||Wn(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var r=t;return e&&e.push(r.buffer),r}if(t instanceof Gn)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var n=[],i=0,a=t;i<a.length;i+=1)n.push(Qn(a[i],e));return n}if("object"==typeof t){var o=t.constructor,s=o._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var u=o.serialize?o.serialize(t,e):{};if(!o.serialize){for(var l in t)if(t.hasOwnProperty(l)&&!(Jn[s].omit.indexOf(l)>=0)){var p=t[l];u[l]=Jn[s].shallow.indexOf(l)>=0?p:Qn(p,e);}t instanceof Error&&(u.message=t.message);}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return "Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof t)}function ti(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||$n(t)||Wn(t)||ArrayBuffer.isView(t)||t instanceof Gn)return t;if(Array.isArray(t))return t.map(ti);if("object"==typeof t){var e=t.$name||"Object",r=Jn[e].klass;if(!r)throw new Error("can't deserialize unregistered class "+e);if(r.deserialize)return r.deserialize(t);for(var n=Object.create(r.prototype),i=0,a=Object.keys(t);i<a.length;i+=1){var o=a[i];if("$name"!==o){var s=t[o];n[o]=Jn[e].shallow.indexOf(o)>=0?s:ti(s);}}return n}throw new Error("can't deserialize object of type "+typeof t)}var ei=function(){this.first=!0;};ei.prototype.update=function(t,e){var r=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=r,!0))};var ri={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function ni(t){for(var e=0,r=t;e<r.length;e+=1)if(ii(r[e].charCodeAt(0)))return !0;return !1}function ii(t){return !(746!==t&&747!==t&&(t<4352||!(ri["Bopomofo Extended"](t)||ri.Bopomofo(t)||ri["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||ri["CJK Compatibility Ideographs"](t)||ri["CJK Compatibility"](t)||ri["CJK Radicals Supplement"](t)||ri["CJK Strokes"](t)||!(!ri["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||ri["CJK Unified Ideographs Extension A"](t)||ri["CJK Unified Ideographs"](t)||ri["Enclosed CJK Letters and Months"](t)||ri["Hangul Compatibility Jamo"](t)||ri["Hangul Jamo Extended-A"](t)||ri["Hangul Jamo Extended-B"](t)||ri["Hangul Jamo"](t)||ri["Hangul Syllables"](t)||ri.Hiragana(t)||ri["Ideographic Description Characters"](t)||ri.Kanbun(t)||ri["Kangxi Radicals"](t)||ri["Katakana Phonetic Extensions"](t)||ri.Katakana(t)&&12540!==t||!(!ri["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!ri["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||ri["Unified Canadian Aboriginal Syllabics"](t)||ri["Unified Canadian Aboriginal Syllabics Extended"](t)||ri["Vertical Forms"](t)||ri["Yijing Hexagram Symbols"](t)||ri["Yi Syllables"](t)||ri["Yi Radicals"](t))))}function ai(t){return !(ii(t)||function(t){return !!(ri["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||ri["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||ri["Letterlike Symbols"](t)||ri["Number Forms"](t)||ri["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||ri["Control Pictures"](t)&&9251!==t||ri["Optical Character Recognition"](t)||ri["Enclosed Alphanumerics"](t)||ri["Geometric Shapes"](t)||ri["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ri["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ri["CJK Symbols and Punctuation"](t)||ri.Katakana(t)||ri["Private Use Area"](t)||ri["CJK Compatibility Forms"](t)||ri["Small Form Variants"](t)||ri["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function oi(t){return t>=1424&&t<=2303||ri["Arabic Presentation Forms-A"](t)||ri["Arabic Presentation Forms-B"](t)}function si(t,e){return !(!e&&oi(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||ri.Khmer(t))}function ui(t){for(var e=0,r=t;e<r.length;e+=1)if(oi(r[e].charCodeAt(0)))return !0;return !1}var li=null,pi="unavailable",ci=null,hi=function(t){li&&li(t);};function fi(){yi.fire(new kt("pluginStateChange",{pluginStatus:pi,pluginURL:ci}));}var yi=new zt,di=function(){return pi},mi=function(){if("deferred"!==pi||!ci)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");pi="loading",fi(),ci&&bt({url:ci},(function(t){t?hi(t):(pi="loaded",fi());}));},vi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return "loaded"===pi||null!=vi.applyArabicShaping},isLoading:function(){return "loading"===pi},setState:function(t){pi=t.pluginStatus,ci=t.pluginURL;},isParsed:function(){return null!=vi.applyArabicShaping&&null!=vi.processBidirectionalText&&null!=vi.processStyledBidirectionalText},getPluginURL:function(){return ci}},gi=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ei,this.transition={});};gi.prototype.isSupportedScript=function(t){return function(t,e){for(var r=0,n=t;r<n.length;r+=1)if(!si(n[r].charCodeAt(0),e))return !1;return !0}(t,vi.isLoaded())},gi.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},gi.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),r=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*e}};var xi=function(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Zr(t))return new sn(t,e);if(en(t)){var r=on(t,e);if("error"===r.result)throw new Error(r.value.map((function(t){return t.key+": "+t.message})).join(", "));return r.value}var n=t;return "string"==typeof t&&"color"===e.type&&(n=$t.parse(t)),{kind:"constant",evaluate:function(){return n}}}(void 0===e?t.specification.default:e,t.specification);};xi.prototype.isDataDriven=function(){return "source"===this.expression.kind||"composite"===this.expression.kind},xi.prototype.possiblyEvaluate=function(t,e,r){return this.property.possiblyEvaluate(this,t,e,r)};var bi=function(t){this.property=t,this.value=new xi(t,void 0);};bi.prototype.transitioned=function(t,e){return new _i(this.property,this.value,e,p({},t.transition,this.transition),t.now)},bi.prototype.untransitioned=function(){return new _i(this.property,this.value,null,{},0)};var wi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues);};wi.prototype.getValue=function(t){return x(this._values[t].value.value)},wi.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new bi(this._values[t].property)),this._values[t].value=new xi(this._values[t].property,null===e?void 0:x(e));},wi.prototype.getTransition=function(t){return x(this._values[t].transition)},wi.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new bi(this._values[t].property)),this._values[t].transition=x(e)||void 0;},wi.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e],i=this.getValue(n);void 0!==i&&(t[n]=i);var a=this.getTransition(n);void 0!==a&&(t[n+"-transition"]=a);}return t},wi.prototype.transitioned=function(t,e){for(var r=new Ai(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var a=i[n];r._values[a]=this._values[a].transitioned(t,e._values[a]);}return r},wi.prototype.untransitioned=function(){for(var t=new Ai(this._properties),e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e];t._values[n]=this._values[n].untransitioned();}return t};var _i=function(t,e,r,n,i){this.property=t,this.value=e,this.begin=i+n.delay||0,this.end=this.begin+n.duration||0,t.specification.transition&&(n.delay||n.duration)&&(this.prior=r);};_i.prototype.possiblyEvaluate=function(t,e,r){var n=t.now||0,i=this.value.possiblyEvaluate(t,e,r),a=this.prior;if(a){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return a.possiblyEvaluate(t,e,r);var o=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(t,e,r),i,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}(o))}return i};var Ai=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues);};Ai.prototype.possiblyEvaluate=function(t,e){for(var r=new Ii(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var a=i[n];r._values[a]=this._values[a].possiblyEvaluate(t,e);}return r},Ai.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return !0;return !1};var Si=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues);};Si.prototype.getValue=function(t){return x(this._values[t].value)},Si.prototype.setValue=function(t,e){this._values[t]=new xi(this._values[t].property,null===e?void 0:x(e));},Si.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e],i=this.getValue(n);void 0!==i&&(t[n]=i);}return t},Si.prototype.possiblyEvaluate=function(t,e){for(var r=new Ii(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var a=i[n];r._values[a]=this._values[a].possiblyEvaluate(t,e);}return r};var ki=function(t,e,r){this.property=t,this.value=e,this.parameters=r;};ki.prototype.isConstant=function(){return "constant"===this.value.kind},ki.prototype.constantOr=function(t){return "constant"===this.value.kind?this.value.value:t},ki.prototype.evaluate=function(t,e,r,n){return this.property.evaluate(this.value,this.parameters,t,e,r,n)};var Ii=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues);};Ii.prototype.get=function(t){return this._values[t]};var zi=function(t){this.specification=t;};zi.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},zi.prototype.interpolate=function(t,e,r){var n=$e[this.specification.type];return n?n(t,e,r):t};var Ci=function(t,e){this.specification=t,this.overrides=e;};Ci.prototype.possiblyEvaluate=function(t,e,r,n){return new ki(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},r,n)}:t.expression,e)},Ci.prototype.interpolate=function(t,e,r){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new ki(this,{kind:"constant",value:void 0},t.parameters);var n=$e[this.specification.type];return n?new ki(this,{kind:"constant",value:n(t.value.value,e.value.value,r)},t.parameters):t},Ci.prototype.evaluate=function(t,e,r,n,i,a){return "constant"===t.kind?t.value:t.evaluate(e,r,n,i,a)};var Mi=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(t,e,r,n){if(void 0===t.value)return new ki(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},r,n),a="resolvedImage"===t.property.specification.type&&"string"!=typeof i?i.name:i,o=this._calculate(a,a,a,e);return new ki(this,{kind:"constant",value:o},e)}if("camera"===t.expression.kind){var s=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new ki(this,{kind:"constant",value:s},e)}return new ki(this,t.expression,e)},e.prototype.evaluate=function(t,e,r,n,i,a){if("source"===t.kind){var o=t.evaluate(e,r,n,i,a);return this._calculate(o,o,o,e)}return "composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},r,n),t.evaluate({zoom:Math.floor(e.zoom)},r,n),t.evaluate({zoom:Math.floor(e.zoom)+1},r,n),e):t.value},e.prototype._calculate=function(t,e,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},e.prototype.interpolate=function(t){return t},e}(Ci),Ti=function(t){this.specification=t;};Ti.prototype.possiblyEvaluate=function(t,e,r,n){if(void 0!==t.value){if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},r,n);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate(new gi(Math.floor(e.zoom-1),e)),t.expression.evaluate(new gi(Math.floor(e.zoom),e)),t.expression.evaluate(new gi(Math.floor(e.zoom+1),e)),e)}},Ti.prototype._calculate=function(t,e,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},Ti.prototype.interpolate=function(t){return t};var Ei=function(t){this.specification=t;};Ei.prototype.possiblyEvaluate=function(t,e,r,n){return !!t.expression.evaluate(e,null,{},r,n)},Ei.prototype.interpolate=function(){return !1};var Pi=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var r=t[e];r.specification.overridable&&this.overridableProperties.push(e);var n=this.defaultPropertyValues[e]=new xi(r,void 0),i=this.defaultTransitionablePropertyValues[e]=new bi(r);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=n.possiblyEvaluate({});}};Hn("DataDrivenProperty",Ci),Hn("DataConstantProperty",zi),Hn("CrossFadedDataDrivenProperty",Mi),Hn("CrossFadedProperty",Ti),Hn("ColorRampProperty",Ei);var Bi=function(t){function e(e,r){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter={filter:function(){return !0},needGeometry:!1},"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Si(r.layout)),r.paint)){for(var n in this._transitionablePaint=new wi(r.paint),e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(var i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned();}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return "visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,r){void 0===r&&(r={}),null!=e&&this._validate(jn,"layers."+this.id+".layout."+t,t,e,r)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e);},e.prototype.getPaintProperty=function(t){return m(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,r){if(void 0===r&&(r={}),null!=e&&this._validate(Un,"layers."+this.id+".paint."+t,t,e,r))return !1;if(m(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var n=this._transitionablePaint._values[t],i="cross-faded-data-driven"===n.property.specification["property-type"],a=n.value.isDataDriven(),o=n.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var s=this._transitionablePaint._values[t].value;return s.isDataDriven()||a||i||this._handleOverridablePaintPropertyUpdate(t,o,s)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype._handleOverridablePaintPropertyUpdate=function(t,e,r){return !1},e.prototype.isHidden=function(t){return !!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint);},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,e);},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),g(t,(function(t,e){return !(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)}))},e.prototype._validate=function(t,e,r,n,i){return void 0===i&&(i={}),(!i||!1!==i.validate)&&qn(this,t.call(Rn,{key:e,layerType:this.type,objectKey:r,value:n,styleSpec:Ct,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return !1},e.prototype.isTileClipped=function(){return !1},e.prototype.hasOffscreenPass=function(){return !1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof ki&&Nr(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return !0}return !1},e}(zt),Vi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Fi=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8;},Di=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0);};function Li(t,e){void 0===e&&(e=1);var r=0,n=0;return {members:t.map((function(t){var i=Vi[t.type].BYTES_PER_ELEMENT,a=r=Ri(r,Math.max(e,i)),o=t.components||1;return n=Math.max(n,i),r+=i*o,{name:t.name,type:t.type,components:o,offset:a}})),size:Ri(r,Math.max(n,e)),alignment:e}}function Ri(t,e){return Math.ceil(t/e)*e}Di.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Di.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Di.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews());},Di.prototype.clear=function(){this.length=0;},Di.prototype.resize=function(t){this.reserve(t),this.length=t;},Di.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e);}},Di.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Oi=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.int16[n+0]=e,this.int16[n+1]=r,t},e}(Di);Oi.prototype.bytesPerElement=4,Hn("StructArrayLayout2i4",Oi);var Ui=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var a=4*t;return this.int16[a+0]=e,this.int16[a+1]=r,this.int16[a+2]=n,this.int16[a+3]=i,t},e}(Di);Ui.prototype.bytesPerElement=8,Hn("StructArrayLayout4i8",Ui);var ji=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,n,i,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,n,i,a)},e.prototype.emplace=function(t,e,r,n,i,a,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,this.int16[s+4]=a,this.int16[s+5]=o,t},e}(Di);ji.prototype.bytesPerElement=12,Hn("StructArrayLayout2i4i12",ji);var qi=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,n,i,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,n,i,a)},e.prototype.emplace=function(t,e,r,n,i,a,o){var s=4*t,u=8*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.uint8[u+4]=n,this.uint8[u+5]=i,this.uint8[u+6]=a,this.uint8[u+7]=o,t},e}(Di);qi.prototype.bytesPerElement=8,Hn("StructArrayLayout2i4ub8",qi);var Ni=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,n,i,a,o,s,u,l){var p=this.length;return this.resize(p+1),this.emplace(p,t,e,r,n,i,a,o,s,u,l)},e.prototype.emplace=function(t,e,r,n,i,a,o,s,u,l,p){var c=9*t,h=18*t;return this.uint16[c+0]=e,this.uint16[c+1]=r,this.uint16[c+2]=n,this.uint16[c+3]=i,this.uint16[c+4]=a,this.uint16[c+5]=o,this.uint16[c+6]=s,this.uint16[c+7]=u,this.uint8[h+16]=l,this.uint8[h+17]=p,t},e}(Di);Ni.prototype.bytesPerElement=18,Hn("StructArrayLayout8ui2ub18",Ni);var Ki=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,n,i,a,o,s,u,l,p,c){var h=this.length;return this.resize(h+1),this.emplace(h,t,e,r,n,i,a,o,s,u,l,p,c)},e.prototype.emplace=function(t,e,r,n,i,a,o,s,u,l,p,c,h){var f=12*t;return this.int16[f+0]=e,this.int16[f+1]=r,this.int16[f+2]=n,this.int16[f+3]=i,this.uint16[f+4]=a,this.uint16[f+5]=o,this.uint16[f+6]=s,this.uint16[f+7]=u,this.int16[f+8]=l,this.int16[f+9]=p,this.int16[f+10]=c,this.int16[f+11]=h,t},e}(Di);Ki.prototype.bytesPerElement=24,Hn("StructArrayLayout4i4ui4i24",Ki);var Xi=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.float32[i+0]=e,this.float32[i+1]=r,this.float32[i+2]=n,t},e}(Di);Xi.prototype.bytesPerElement=12,Hn("StructArrayLayout3f12",Xi);var Gi=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},e}(Di);Gi.prototype.bytesPerElement=4,Hn("StructArrayLayout1ul4",Gi);var Zi=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,n,i,a,o,s,u,l,p){var c=this.length;return this.resize(c+1),this.emplace(c,t,e,r,n,i,a,o,s,u,l,p)},e.prototype.emplace=function(t,e,r,n,i,a,o,s,u,l,p,c){var h=12*t,f=6*t;return this.int16[h+0]=e,this.int16[h+1]=r,this.int16[h+2]=n,this.int16[h+3]=i,this.int16[h+4]=a,this.int16[h+5]=o,this.uint32[f+3]=s,this.uint16[h+8]=u,this.uint16[h+9]=l,this.int16[h+10]=p,this.int16[h+11]=c,t},e}(Di);Zi.prototype.bytesPerElement=24,Hn("StructArrayLayout6i1ul2ui2i24",Zi);var Ji=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,n,i,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,n,i,a)},e.prototype.emplace=function(t,e,r,n,i,a,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,this.int16[s+4]=a,this.int16[s+5]=o,t},e}(Di);Ji.prototype.bytesPerElement=12,Hn("StructArrayLayout2i2i2i12",Ji);var Hi=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var a=12*t,o=3*t;return this.uint8[a+0]=e,this.uint8[a+1]=r,this.float32[o+1]=n,this.float32[o+2]=i,t},e}(Di);Hi.prototype.bytesPerElement=12,Hn("StructArrayLayout2ub2f12",Hi);var Yi=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,n,i,a,o,s,u,l,p,c,h,f,y,d,m){var v=this.length;return this.resize(v+1),this.emplace(v,t,e,r,n,i,a,o,s,u,l,p,c,h,f,y,d,m)},e.prototype.emplace=function(t,e,r,n,i,a,o,s,u,l,p,c,h,f,y,d,m,v){var g=24*t,x=12*t,b=48*t;return this.int16[g+0]=e,this.int16[g+1]=r,this.uint16[g+2]=n,this.uint16[g+3]=i,this.uint32[x+2]=a,this.uint32[x+3]=o,this.uint32[x+4]=s,this.uint16[g+10]=u,this.uint16[g+11]=l,this.uint16[g+12]=p,this.float32[x+7]=c,this.float32[x+8]=h,this.uint8[b+36]=f,this.uint8[b+37]=y,this.uint8[b+38]=d,this.uint32[x+10]=m,this.int16[g+22]=v,t},e}(Di);Yi.prototype.bytesPerElement=48,Hn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Yi);var $i=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,n,i,a,o,s,u,l,p,c,h,f,y,d,m,v,g,x,b,w,_,A,S,k){var I=this.length;return this.resize(I+1),this.emplace(I,t,e,r,n,i,a,o,s,u,l,p,c,h,f,y,d,m,v,g,x,b,w,_,A,S,k)},e.prototype.emplace=function(t,e,r,n,i,a,o,s,u,l,p,c,h,f,y,d,m,v,g,x,b,w,_,A,S,k,I){var z=30*t,C=15*t;return this.int16[z+0]=e,this.int16[z+1]=r,this.int16[z+2]=n,this.int16[z+3]=i,this.int16[z+4]=a,this.int16[z+5]=o,this.int16[z+6]=s,this.int16[z+7]=u,this.uint16[z+8]=l,this.uint16[z+9]=p,this.uint16[z+10]=c,this.uint16[z+11]=h,this.uint16[z+12]=f,this.uint16[z+13]=y,this.uint16[z+14]=d,this.uint16[z+15]=m,this.uint16[z+16]=v,this.uint16[z+17]=g,this.uint16[z+18]=x,this.uint16[z+19]=b,this.uint16[z+20]=w,this.uint16[z+21]=_,this.uint32[C+11]=A,this.float32[C+12]=S,this.float32[C+13]=k,this.float32[C+14]=I,t},e}(Di);$i.prototype.bytesPerElement=60,Hn("StructArrayLayout8i14ui1ul3f60",$i);var Wi=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},e}(Di);Wi.prototype.bytesPerElement=4,Hn("StructArrayLayout1f4",Wi);var Qi=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.int16[i+0]=e,this.int16[i+1]=r,this.int16[i+2]=n,t},e}(Di);Qi.prototype.bytesPerElement=6,Hn("StructArrayLayout3i6",Qi);var ta=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=4*t;return this.uint32[2*t+0]=e,this.uint16[i+2]=r,this.uint16[i+3]=n,t},e}(Di);ta.prototype.bytesPerElement=8,Hn("StructArrayLayout1ul2ui8",ta);var ea=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=r,this.uint16[i+2]=n,t},e}(Di);ea.prototype.bytesPerElement=6,Hn("StructArrayLayout3ui6",ea);var ra=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=r,t},e}(Di);ra.prototype.bytesPerElement=4,Hn("StructArrayLayout2ui4",ra);var na=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},e}(Di);na.prototype.bytesPerElement=2,Hn("StructArrayLayout1ui2",na);var ia=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.float32[n+0]=e,this.float32[n+1]=r,t},e}(Di);ia.prototype.bytesPerElement=8,Hn("StructArrayLayout2f8",ia);var aa=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var a=4*t;return this.float32[a+0]=e,this.float32[a+1]=r,this.float32[a+2]=n,this.float32[a+3]=i,t},e}(Di);aa.prototype.bytesPerElement=16,Hn("StructArrayLayout4f16",aa);var oa=function(t){function e(){t.apply(this,arguments);}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.radius.get=function(){return this._structArray.int16[this._pos2+10]},r.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},r.anchorPoint.get=function(){return new i(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,r),e}(Fi);oa.prototype.size=24;var sa=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new oa(this,t)},e}(Zi);Hn("CollisionBoxArray",sa);var ua=function(t){function e(){t.apply(this,arguments);}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t;},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t;},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t;},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,r),e}(Fi);ua.prototype.size=48;var la=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new ua(this,t)},e}(Yi);Hn("PlacedSymbolArray",la);var pa=function(t){function e(){t.apply(this,arguments);}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+11]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+11]=t;},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+12]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+14]},Object.defineProperties(e.prototype,r),e}(Fi);pa.prototype.size=60;var ca=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new pa(this,t)},e}($i);Hn("SymbolInstanceArray",ca);var ha=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e}(Wi);Hn("GlyphOffsetArray",ha);var fa=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e}(Qi);Hn("SymbolLineVertexArray",fa);var ya=function(t){function e(){t.apply(this,arguments);}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,r),e}(Fi);ya.prototype.size=8;var da=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new ya(this,t)},e}(ta);Hn("FeatureIndexArray",da);var ma=Li([{name:"a_pos",components:2,type:"Int16"}],4).members,va=function(t){void 0===t&&(t=[]),this.segments=t;};function ga(t,e){return 256*(t=u(Math.floor(t),0,255))+u(Math.floor(e),0,255)}va.prototype.prepareSegment=function(t,e,r,n){var i=this.segments[this.segments.length-1];return t>va.MAX_VERTEX_ARRAY_LENGTH&&w("Max vertices per segment is "+va.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!i||i.vertexLength+t>va.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i},va.prototype.get=function(){return this.segments},va.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var r=e[t];for(var n in r.vaos)r.vaos[n].destroy();}},va.simpleSegment=function(t,e,r,n){return new va([{vertexOffset:t,primitiveOffset:e,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])},va.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Hn("SegmentVector",va);var xa=Li([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint8"},{name:"a_pixel_ratio_to",components:1,type:"Uint8"}]),ba=e((function(t){t.exports=function(t,e){var r,n,i,a,o,s,u,l;for(n=t.length-(r=3&t.length),i=e,o=3432918353,s=461845907,l=0;l<n;)u=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,i=27492+(65535&(a=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(u=0,r){case 3:u^=(255&t.charCodeAt(l+2))<<16;case 2:u^=(255&t.charCodeAt(l+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(l)))*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295;}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0};})),wa=e((function(t){t.exports=function(t,e){for(var r,n=t.length,i=e^n,a=0;n>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(a)|(255&t.charCodeAt(++a))<<8|(255&t.charCodeAt(++a))<<16|(255&t.charCodeAt(++a))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++a;switch(n){case 3:i^=(255&t.charCodeAt(a+2))<<16;case 2:i^=(255&t.charCodeAt(a+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(a)))+((1540483477*(i>>>16)&65535)<<16);}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0};})),_a=ba,Aa=wa;_a.murmur3=ba,_a.murmur2=Aa;var Sa=function(){this.ids=[],this.positions=[],this.indexed=!1;};Sa.prototype.add=function(t,e,r,n){this.ids.push(Ia(t)),this.positions.push(e,r,n);},Sa.prototype.getPositions=function(t){for(var e=Ia(t),r=0,n=this.ids.length-1;r<n;){var i=r+n>>1;this.ids[i]>=e?n=i:r=i+1;}for(var a=[];this.ids[r]===e;)a.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return a},Sa.serialize=function(t,e){var r=new Float64Array(t.ids),n=new Uint32Array(t.positions);return function t(e,r,n,i){if(!(n>=i)){for(var a=e[n+i>>1],o=n-1,s=i+1;;){do{o++;}while(e[o]<a);do{s--;}while(e[s]>a);if(o>=s)break;za(e,o,s),za(r,3*o,3*s),za(r,3*o+1,3*s+1),za(r,3*o+2,3*s+2);}t(e,r,n,s),t(e,r,s+1,i);}}(r,n,0,r.length-1),e&&e.push(r.buffer,n.buffer),{ids:r,positions:n}},Sa.deserialize=function(t){var e=new Sa;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e};var ka=Math.pow(2,53)-1;function Ia(t){var e=+t;return !isNaN(e)&&e<=ka?e:_a(String(t))}function za(t,e,r){var n=t[e];t[e]=t[r],t[r]=n;}Hn("FeaturePositionMap",Sa);var Ca=function(t,e){this.gl=t.gl,this.location=e;},Ma=function(t){function e(e,r){t.call(this,e,r),this.current=0;}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t));},e}(Ca),Ta=function(t){function e(e,r){t.call(this,e,r),this.current=0;}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t));},e}(Ca),Ea=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0];}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]));},e}(Ca),Pa=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0,0];}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]));},e}(Ca),Ba=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0,0,0];}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]));},e}(Ca),Va=function(t){function e(e,r){t.call(this,e,r),this.current=$t.transparent;}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a));},e}(Ca),Fa=new Float32Array(16),Da=function(t){function e(e,r){t.call(this,e,r),this.current=Fa;}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(Ca);function La(t){return [ga(255*t.r,255*t.g),ga(255*t.b,255*t.a)]}var Ra=function(t,e,r){this.value=t,this.uniformNames=e.map((function(t){return "u_"+t})),this.type=r;};Ra.prototype.setUniform=function(t,e,r){t.set(r.constantOr(this.value));},Ra.prototype.getBinding=function(t,e,r){return "color"===this.type?new Va(t,e):new Ta(t,e)};var Oa=function(t,e){this.uniformNames=e.map((function(t){return "u_"+t})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1;};Oa.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr;},Oa.prototype.setUniform=function(t,e,r,n){var i="u_pattern_to"===n?this.patternTo:"u_pattern_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:null;i&&t.set(i);},Oa.prototype.getBinding=function(t,e,r){return "u_pattern"===r.substr(0,9)?new Ba(t,e):new Ta(t,e)};var Ua=function(t,e,r,n){this.expression=t,this.type=r,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return {name:"a_"+t,type:"Float32",components:"color"===r?2:1,offset:0}})),this.paintVertexArray=new n;};Ua.prototype.populatePaintArray=function(t,e,r,n,i){var a=this.paintVertexArray.length,o=this.expression.evaluate(new gi(0),e,{},n,[],i);this.paintVertexArray.resize(t),this._setPaintValue(a,t,o);},Ua.prototype.updatePaintArray=function(t,e,r,n){var i=this.expression.evaluate({zoom:0},r,n);this._setPaintValue(t,e,i);},Ua.prototype._setPaintValue=function(t,e,r){if("color"===this.type)for(var n=La(r),i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1]);else{for(var a=t;a<e;a++)this.paintVertexArray.emplace(a,r);this.maxValue=Math.max(this.maxValue,Math.abs(r));}},Ua.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent));},Ua.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy();};var ja=function(t,e,r,n,i,a){this.expression=t,this.uniformNames=e.map((function(t){return "u_"+t+"_t"})),this.type=r,this.useIntegerZoom=n,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return {name:"a_"+t,type:"Float32",components:"color"===r?4:2,offset:0}})),this.paintVertexArray=new a;};ja.prototype.populatePaintArray=function(t,e,r,n,i){var a=this.expression.evaluate(new gi(this.zoom),e,{},n,[],i),o=this.expression.evaluate(new gi(this.zoom+1),e,{},n,[],i),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,a,o);},ja.prototype.updatePaintArray=function(t,e,r,n){var i=this.expression.evaluate({zoom:this.zoom},r,n),a=this.expression.evaluate({zoom:this.zoom+1},r,n);this._setPaintValue(t,e,i,a);},ja.prototype._setPaintValue=function(t,e,r,n){if("color"===this.type)for(var i=La(r),a=La(n),o=t;o<e;o++)this.paintVertexArray.emplace(o,i[0],i[1],a[0],a[1]);else{for(var s=t;s<e;s++)this.paintVertexArray.emplace(s,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n));}},ja.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent));},ja.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy();},ja.prototype.setUniform=function(t,e){var r=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,n=u(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);t.set(n);},ja.prototype.getBinding=function(t,e,r){return new Ta(t,e)};var qa=function(t,e,r,n,i,a){this.expression=t,this.type=e,this.useIntegerZoom=r,this.zoom=n,this.layerId=a,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i;};qa.prototype.populatePaintArray=function(t,e,r){var n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(n,t,e.patterns&&e.patterns[this.layerId],r);},qa.prototype.updatePaintArray=function(t,e,r,n,i){this._setPaintValues(t,e,r.patterns&&r.patterns[this.layerId],i);},qa.prototype._setPaintValues=function(t,e,r,n){if(n&&r){var i=n[r.min],a=n[r.mid],o=n[r.max];if(i&&a&&o)for(var s=t;s<e;s++)this.zoomInPaintVertexArray.emplace(s,a.tl[0],a.tl[1],a.br[0],a.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],a.pixelRatio,i.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,a.tl[0],a.tl[1],a.br[0],a.br[1],o.tl[0],o.tl[1],o.br[0],o.br[1],a.pixelRatio,o.pixelRatio);}},qa.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,xa.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,xa.members,this.expression.isStateDependent));},qa.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy();};var Na=function(t,e,r,n){this.binders={},this.layoutAttributes=n,this._buffers=[];var i=[];for(var a in t.paint._values)if(r(a)){var o=t.paint.get(a);if(o instanceof ki&&Nr(o.property.specification)){var s=Xa(a,t.type),u=o.value,l=o.property.specification.type,p=o.property.useIntegerZoom,c=o.property.specification["property-type"],h="cross-faded"===c||"cross-faded-data-driven"===c;if("constant"===u.kind)this.binders[a]=h?new Oa(u.value,s):new Ra(u.value,s,l),i.push("/u_"+a);else if("source"===u.kind||h){var f=Ga(a,l,"source");this.binders[a]=h?new qa(u,l,p,e,f,t.id):new Ua(u,s,l,f),i.push("/a_"+a);}else{var y=Ga(a,l,"composite");this.binders[a]=new ja(u,s,l,p,e,y),i.push("/z_"+a);}}}this.cacheKey=i.sort().join("");};Na.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof Ua||e instanceof ja?e.maxValue:0},Na.prototype.populatePaintArrays=function(t,e,r,n,i){for(var a in this.binders){var o=this.binders[a];(o instanceof Ua||o instanceof ja||o instanceof qa)&&o.populatePaintArray(t,e,r,n,i);}},Na.prototype.setConstantPatternPositions=function(t,e){for(var r in this.binders){var n=this.binders[r];n instanceof Oa&&n.setConstantPatternPositions(t,e);}},Na.prototype.updatePaintArrays=function(t,e,r,n,i){var a=!1;for(var o in t)for(var s=0,u=e.getPositions(o);s<u.length;s+=1){var l=u[s],p=r.feature(l.index);for(var c in this.binders){var h=this.binders[c];if((h instanceof Ua||h instanceof ja||h instanceof qa)&&!0===h.expression.isStateDependent){var f=n.paint.get(c);h.expression=f.value,h.updatePaintArray(l.start,l.end,p,t[o],i),a=!0;}}}return a},Na.prototype.defines=function(){var t=[];for(var e in this.binders){var r=this.binders[e];(r instanceof Ra||r instanceof Oa)&&t.push.apply(t,r.uniformNames.map((function(t){return "#define HAS_UNIFORM_"+t})));}return t},Na.prototype.getPaintVertexBuffers=function(){return this._buffers},Na.prototype.getUniforms=function(t,e){var r=[];for(var n in this.binders){var i=this.binders[n];if(i instanceof Ra||i instanceof Oa||i instanceof ja)for(var a=0,o=i.uniformNames;a<o.length;a+=1){var s=o[a];if(e[s]){var u=i.getBinding(t,e[s],s);r.push({name:s,property:n,binding:u});}}}return r},Na.prototype.setUniforms=function(t,e,r,n){for(var i=0,a=e;i<a.length;i+=1){var o=a[i],s=o.name,u=o.property;this.binders[u].setUniform(o.binding,n,r.get(u),s);}},Na.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var r=this.binders[e];if(t&&r instanceof qa){var n=2===t.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;n&&this._buffers.push(n);}else(r instanceof Ua||r instanceof ja)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer);}},Na.prototype.upload=function(t){for(var e in this.binders){var r=this.binders[e];(r instanceof Ua||r instanceof ja||r instanceof qa)&&r.upload(t);}this.updatePaintBuffers();},Na.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof Ua||e instanceof ja||e instanceof qa)&&e.destroy();}};var Ka=function(t,e,r,n){void 0===n&&(n=function(){return !0}),this.programConfigurations={};for(var i=0,a=e;i<a.length;i+=1){var o=a[i];this.programConfigurations[o.id]=new Na(o,r,n,t);}this.needsUpload=!1,this._featureMap=new Sa,this._bufferOffset=0;};function Xa(t,e){return {"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function Ga(t,e,r){var n={color:{source:ia,composite:aa},number:{source:Wi,composite:ia}},i=function(t){return {"line-pattern":{source:Ni,composite:Ni},"fill-pattern":{source:Ni,composite:Ni},"fill-extrusion-pattern":{source:Ni,composite:Ni}}[t]}(t);return i&&i[r]||n[e][r]}Ka.prototype.populatePaintArrays=function(t,e,r,n,i,a){for(var o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(t,e,n,i,a);void 0!==e.id&&this._featureMap.add(e.id,r,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0;},Ka.prototype.updatePaintArrays=function(t,e,r,n){for(var i=0,a=r;i<a.length;i+=1){var o=a[i];this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(t,this._featureMap,e,o,n)||this.needsUpload;}},Ka.prototype.get=function(t){return this.programConfigurations[t]},Ka.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1;}},Ka.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy();},Hn("ConstantBinder",Ra),Hn("CrossFadedConstantBinder",Oa),Hn("SourceExpressionBinder",Ua),Hn("CrossFadedCompositeBinder",qa),Hn("CompositeExpressionBinder",ja),Hn("ProgramConfiguration",Na,{omit:["_buffers"]}),Hn("ProgramConfigurationSet",Ka);var Za={min:-1*Math.pow(2,14),max:Math.pow(2,14)-1};function Ja(t){for(var e=ze/t.extent,r=t.loadGeometry(),n=0;n<r.length;n++)for(var i=r[n],a=0;a<i.length;a++){var o=i[a];o.x=Math.round(o.x*e),o.y=Math.round(o.y*e),(o.x<Za.min||o.x>Za.max||o.y<Za.min||o.y>Za.max)&&(w("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o.x=u(o.x,Za.min,Za.max),o.y=u(o.y,Za.min,Za.max));}return r}function Ha(t,e,r,n,i){t.emplaceBack(2*e+(n+1)/2,2*r+(i+1)/2);}var Ya=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Oi,this.indexArray=new ea,this.segments=new va,this.programConfigurations=new Ka(ma,t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}));};function $a(t,e){for(var r=0;r<t.length;r++)if(oo(e,t[r]))return !0;for(var n=0;n<e.length;n++)if(oo(t,e[n]))return !0;return !!eo(t,e)}function Wa(t,e,r){return !!oo(t,e)||!!no(e,t,r)}function Qa(t,e){if(1===t.length)return ao(e,t[0]);for(var r=0;r<e.length;r++)for(var n=e[r],i=0;i<n.length;i++)if(oo(t,n[i]))return !0;for(var a=0;a<t.length;a++)if(ao(e,t[a]))return !0;for(var o=0;o<e.length;o++)if(eo(t,e[o]))return !0;return !1}function to(t,e,r){if(t.length>1){if(eo(t,e))return !0;for(var n=0;n<e.length;n++)if(no(e[n],t,r))return !0}for(var i=0;i<t.length;i++)if(no(t[i],e,r))return !0;return !1}function eo(t,e){if(0===t.length||0===e.length)return !1;for(var r=0;r<t.length-1;r++)for(var n=t[r],i=t[r+1],a=0;a<e.length-1;a++)if(ro(n,i,e[a],e[a+1]))return !0;return !1}function ro(t,e,r,n){return _(t,r,n)!==_(e,r,n)&&_(t,e,r)!==_(t,e,n)}function no(t,e,r){var n=r*r;if(1===e.length)return t.distSqr(e[0])<n;for(var i=1;i<e.length;i++)if(io(t,e[i-1],e[i])<n)return !0;return !1}function io(t,e,r){var n=e.distSqr(r);if(0===n)return t.distSqr(e);var i=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/n;return t.distSqr(i<0?e:i>1?r:r.sub(e)._mult(i)._add(e))}function ao(t,e){for(var r,n,i,a=!1,o=0;o<t.length;o++)for(var s=0,u=(r=t[o]).length-1;s<r.length;u=s++)(n=r[s]).y>e.y!=(i=r[u]).y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(a=!a);return a}function oo(t,e){for(var r=!1,n=0,i=t.length-1;n<t.length;i=n++){var a=t[n],o=t[i];a.y>e.y!=o.y>e.y&&e.x<(o.x-a.x)*(e.y-a.y)/(o.y-a.y)+a.x&&(r=!r);}return r}function so(t,e,r){var n=r[0],i=r[2];if(t.x<n.x&&e.x<n.x||t.x>i.x&&e.x>i.x||t.y<n.y&&e.y<n.y||t.y>i.y&&e.y>i.y)return !1;var a=_(t,e,r[0]);return a!==_(t,e,r[1])||a!==_(t,e,r[2])||a!==_(t,e,r[3])}function uo(t,e,r){var n=e.paint.get(t).value;return "constant"===n.kind?n.value:r.programConfigurations.get(e.id).getMaxValue(t)}function lo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function po(t,e,r,n,a){if(!e[0]&&!e[1])return t;var o=i.convert(e)._mult(a);"viewport"===r&&o._rotate(-n);for(var s=[],u=0;u<t.length;u++)s.push(t[u].sub(o));return s}Ya.prototype.populate=function(t,e,r){var n=this.layers[0],i=[],a=null;"circle"===n.type&&(a=n.layout.get("circle-sort-key"));for(var o=0,s=t;o<s.length;o+=1){var u=s[o],l=u.feature,p=u.id,c=u.index,h=u.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,y={type:l.type,id:p,properties:l.properties,geometry:f?Ja(l):[]};if(this.layers[0]._featureFilter.filter(new gi(this.zoom),y,r)){f||(y.geometry=Ja(l));var d=a?a.evaluate(y,{},r):void 0;i.push({id:p,properties:l.properties,type:l.type,sourceLayerIndex:h,index:c,geometry:y.geometry,patterns:{},sortKey:d});}}a&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var m=0,v=i;m<v.length;m+=1){var g=v[m],x=g.geometry,b=g.index,w=g.sourceLayerIndex,_=t[b].feature;this.addFeature(g,x,b,r),e.featureIndex.insert(_,x,b,w,this.index);}},Ya.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r);},Ya.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ya.prototype.uploadPending=function(){return !this.uploaded||this.programConfigurations.needsUpload},Ya.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ma),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Ya.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Ya.prototype.addFeature=function(t,e,r,n){for(var i=0,a=e;i<a.length;i+=1)for(var o=0,s=a[i];o<s.length;o+=1){var u=s[o],l=u.x,p=u.y;if(!(l<0||l>=ze||p<0||p>=ze)){var c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),h=c.vertexLength;Ha(this.layoutVertexArray,l,p,-1,-1),Ha(this.layoutVertexArray,l,p,1,-1),Ha(this.layoutVertexArray,l,p,1,1),Ha(this.layoutVertexArray,l,p,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),c.vertexLength+=4,c.primitiveLength+=2;}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{},n);},Hn("CircleBucket",Ya,{omit:["layers"]});var co,ho=new Pi({"circle-sort-key":new Ci(Ct.layout_circle["circle-sort-key"])}),fo={paint:new Pi({"circle-radius":new Ci(Ct.paint_circle["circle-radius"]),"circle-color":new Ci(Ct.paint_circle["circle-color"]),"circle-blur":new Ci(Ct.paint_circle["circle-blur"]),"circle-opacity":new Ci(Ct.paint_circle["circle-opacity"]),"circle-translate":new zi(Ct.paint_circle["circle-translate"]),"circle-translate-anchor":new zi(Ct.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zi(Ct.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zi(Ct.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ci(Ct.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ci(Ct.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ci(Ct.paint_circle["circle-stroke-opacity"])}),layout:ho},yo="undefined"!=typeof Float32Array?Float32Array:Array;function mo(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,r=arguments.length;r--;)e+=t[r]*t[r];return Math.sqrt(e)}),co=new yo(3),yo!=Float32Array&&(co[0]=0,co[1]=0,co[2]=0),function(){var t=new yo(4);yo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0);}();var vo=(function(){var t=new yo(2);yo!=Float32Array&&(t[0]=0,t[1]=0);}(),function(t){function e(e){t.call(this,e,fo);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Ya(t)},e.prototype.queryRadius=function(t){var e=t;return uo("circle-radius",this,e)+uo("circle-stroke-width",this,e)+lo(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,a,o,s){for(var u=po(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,o),l=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),p="map"===this.paint.get("circle-pitch-alignment"),c=p?u:function(t,e){return t.map((function(t){return go(t,e)}))}(u,s),h=p?l*o:l,f=0,y=n;f<y.length;f+=1)for(var d=0,m=y[f];d<m.length;d+=1){var v=m[d],g=p?v:go(v,s),x=h,b=mo([],[v.x,v.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?x*=b[3]/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(x*=a.cameraToCenterDistance/b[3]),Wa(c,g,x))return !0}return !1},e}(Bi));function go(t,e){var r=mo([],[t.x,t.y,0,1],e);return new i(r[0]/r[3],r[1]/r[3])}var xo=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Ya);function bo(t,e,r,n){var i=e.width,a=e.height;if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==i*a*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(i*a*r);return t.width=i,t.height=a,t.data=n,t}function wo(t,e,r){var n=e.width,i=e.height;if(n!==t.width||i!==t.height){var a=bo({},{width:n,height:i},r);_o(t,a,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,i)},r),t.width=n,t.height=i,t.data=a.data;}}function _o(t,e,r,n,i,a){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=t.data,s=e.data,u=0;u<i.height;u++)for(var l=((r.y+u)*t.width+r.x)*a,p=((n.y+u)*e.width+n.x)*a,c=0;c<i.width*a;c++)s[p+c]=o[l+c];return e}Hn("HeatmapBucket",xo,{omit:["layers"]});var Ao=function(t,e){bo(this,t,1,e);};Ao.prototype.resize=function(t){wo(this,t,1);},Ao.prototype.clone=function(){return new Ao({width:this.width,height:this.height},new Uint8Array(this.data))},Ao.copy=function(t,e,r,n,i){_o(t,e,r,n,i,1);};var So=function(t,e){bo(this,t,4,e);};So.prototype.resize=function(t){wo(this,t,4);},So.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t;},So.prototype.clone=function(){return new So({width:this.width,height:this.height},new Uint8Array(this.data))},So.copy=function(t,e,r,n,i){_o(t,e,r,n,i,4);},Hn("AlphaImage",Ao),Hn("RGBAImage",So);var ko={paint:new Pi({"heatmap-radius":new Ci(Ct.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ci(Ct.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zi(Ct.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ei(Ct.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zi(Ct.paint_heatmap["heatmap-opacity"])})};function Io(t,e){for(var r=new Uint8Array(1024),n={},i=0,a=0;i<256;i++,a+=4){n[e]=i/255;var o=t.evaluate(n);r[a+0]=Math.floor(255*o.r/o.a),r[a+1]=Math.floor(255*o.g/o.a),r[a+2]=Math.floor(255*o.b/o.a),r[a+3]=Math.floor(255*o.a);}return new So({width:256,height:1},r)}var zo=function(t){function e(e){t.call(this,e,ko),this._updateColorRamp();}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new xo(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp();},e.prototype._updateColorRamp=function(){this.colorRamp=Io(this._transitionablePaint._values["heatmap-color"].value.expression,"heatmapDensity"),this.colorRampTexture=null;},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null);},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return !1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(Bi),Co={paint:new Pi({"hillshade-illumination-direction":new zi(Ct.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new zi(Ct.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zi(Ct.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zi(Ct.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zi(Ct.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zi(Ct.paint_hillshade["hillshade-accent-color"])})},Mo=function(t){function e(e){t.call(this,e,Co);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(Bi),To=Li([{name:"a_pos",components:2,type:"Int16"}],4).members,Eo=Bo,Po=Bo;function Bo(t,e,r){r=r||2;var n,i,a,o,s,u,l,p=e&&e.length,c=p?e[0]*r:t.length,h=Vo(t,0,c,r,!0),f=[];if(!h||h.next===h.prev)return f;if(p&&(h=function(t,e,r,n){var i,a,o,s=[];for(i=0,a=e.length;i<a;i++)(o=Vo(t,e[i]*n,i<a-1?e[i+1]*n:t.length,n,!1))===o.next&&(o.steiner=!0),s.push(Xo(o));for(s.sort(jo),i=0;i<s.length;i++)qo(s[i],r),r=Fo(r,r.next);return r}(t,e,h,r)),t.length>80*r){n=a=t[0],i=o=t[1];for(var y=r;y<c;y+=r)(s=t[y])<n&&(n=s),(u=t[y+1])<i&&(i=u),s>a&&(a=s),u>o&&(o=u);l=0!==(l=Math.max(a-n,o-i))?1/l:0;}return Do(h,f,r,n,i,l),f}function Vo(t,e,r,n,i){var a,o;if(i===is(t,e,r,n)>0)for(a=e;a<r;a+=n)o=es(a,t[a],t[a+1],o);else for(a=r-n;a>=e;a-=n)o=es(a,t[a],t[a+1],o);return o&&Ho(o,o.next)&&(rs(o),o=o.next),o}function Fo(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Ho(n,n.next)&&0!==Jo(n.prev,n,n.next))n=n.next;else{if(rs(n),(n=e=n.prev)===n.next)break;r=!0;}}while(r||n!==e);return e}function Do(t,e,r,n,i,a,o){if(t){!o&&a&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=Ko(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,a,o,s,u,l=1;do{for(r=t,t=null,a=null,o=0;r;){for(o++,n=r,s=0,e=0;e<l&&(s++,n=n.nextZ);e++);for(u=l;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;r=n;}a.nextZ=null,l*=2;}while(o>1)}(i);}(t,n,i,a);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,a?Ro(t,n,i,a):Lo(t))e.push(s.i/r),e.push(t.i/r),e.push(u.i/r),rs(t),t=u.next,l=u.next;else if((t=u)===l){o?1===o?Do(t=Oo(Fo(t),e,r),e,r,n,i,a,2):2===o&&Uo(t,e,r,n,i,a):Do(Fo(t),e,r,n,i,a,1);break}}}function Lo(t){var e=t.prev,r=t,n=t.next;if(Jo(e,r,n)>=0)return !1;for(var i=t.next.next;i!==t.prev;){if(Go(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&Jo(i.prev,i,i.next)>=0)return !1;i=i.next;}return !0}function Ro(t,e,r,n){var i=t.prev,a=t,o=t.next;if(Jo(i,a,o)>=0)return !1;for(var s=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,u=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,l=Ko(i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,e,r,n),p=Ko(s,u,e,r,n),c=t.prevZ,h=t.nextZ;c&&c.z>=l&&h&&h.z<=p;){if(c!==t.prev&&c!==t.next&&Go(i.x,i.y,a.x,a.y,o.x,o.y,c.x,c.y)&&Jo(c.prev,c,c.next)>=0)return !1;if(c=c.prevZ,h!==t.prev&&h!==t.next&&Go(i.x,i.y,a.x,a.y,o.x,o.y,h.x,h.y)&&Jo(h.prev,h,h.next)>=0)return !1;h=h.nextZ;}for(;c&&c.z>=l;){if(c!==t.prev&&c!==t.next&&Go(i.x,i.y,a.x,a.y,o.x,o.y,c.x,c.y)&&Jo(c.prev,c,c.next)>=0)return !1;c=c.prevZ;}for(;h&&h.z<=p;){if(h!==t.prev&&h!==t.next&&Go(i.x,i.y,a.x,a.y,o.x,o.y,h.x,h.y)&&Jo(h.prev,h,h.next)>=0)return !1;h=h.nextZ;}return !0}function Oo(t,e,r){var n=t;do{var i=n.prev,a=n.next.next;!Ho(i,a)&&Yo(i,n,n.next,a)&&Qo(i,a)&&Qo(a,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(a.i/r),rs(n),rs(n.next),n=t=a),n=n.next;}while(n!==t);return Fo(n)}function Uo(t,e,r,n,i,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Zo(o,s)){var u=ts(o,s);return o=Fo(o,o.next),u=Fo(u,u.next),Do(o,e,r,n,i,a),void Do(u,e,r,n,i,a)}s=s.next;}o=o.next;}while(o!==t)}function jo(t,e){return t.x-e.x}function qo(t,e){if(e=function(t,e){var r,n=e,i=t.x,a=t.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next;}}n=n.next;}while(n!==e);if(!r)return null;if(i===o)return r;var u,l=r,p=r.x,c=r.y,h=1/0;n=r;do{i>=n.x&&n.x>=p&&i!==n.x&&Go(a<c?i:o,a,p,c,a<c?o:i,a,n.x,n.y)&&(u=Math.abs(a-n.y)/(i-n.x),Qo(n,t)&&(u<h||u===h&&(n.x>r.x||n.x===r.x&&No(r,n)))&&(r=n,h=u)),n=n.next;}while(n!==l);return r}(t,e)){var r=ts(e,t);Fo(e,e.next),Fo(r,r.next);}}function No(t,e){return Jo(t.prev,t,e.prev)<0&&Jo(e.next,t,t.next)<0}function Ko(t,e,r,n,i){return (t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Xo(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;}while(e!==t);return r}function Go(t,e,r,n,i,a,o,s){return (i-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(n-s)-(r-o)*(e-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function Zo(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Yo(r,r.next,t,e))return !0;r=r.next;}while(r!==t);return !1}(t,e)&&(Qo(t,e)&&Qo(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,a=(t.y+e.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;}while(r!==t);return n}(t,e)&&(Jo(t.prev,t,e.prev)||Jo(t,e.prev,e))||Ho(t,e)&&Jo(t.prev,t,t.next)>0&&Jo(e.prev,e,e.next)>0)}function Jo(t,e,r){return (e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Ho(t,e){return t.x===e.x&&t.y===e.y}function Yo(t,e,r,n){var i=Wo(Jo(t,e,r)),a=Wo(Jo(t,e,n)),o=Wo(Jo(r,n,t)),s=Wo(Jo(r,n,e));return i!==a&&o!==s||!(0!==i||!$o(t,r,e))||!(0!==a||!$o(t,n,e))||!(0!==o||!$o(r,t,n))||!(0!==s||!$o(r,e,n))}function $o(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Wo(t){return t>0?1:t<0?-1:0}function Qo(t,e){return Jo(t.prev,t,t.next)<0?Jo(t,e,t.next)>=0&&Jo(t,t.prev,e)>=0:Jo(t,e,t.prev)<0||Jo(t,t.next,e)<0}function ts(t,e){var r=new ns(t.i,t.x,t.y),n=new ns(e.i,e.x,e.y),i=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function es(t,e,r,n){var i=new ns(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function rs(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ);}function ns(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1;}function is(t,e,r,n){for(var i=0,a=e,o=r-n;a<r;a+=n)i+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return i}function as(t,e,r,n,i){!function t(e,r,n,i,a){for(;i>n;){if(i-n>600){var o=i-n+1,s=r-n+1,u=Math.log(o),l=.5*Math.exp(2*u/3),p=.5*Math.sqrt(u*l*(o-l)/o)*(s-o/2<0?-1:1);t(e,r,Math.max(n,Math.floor(r-s*l/o+p)),Math.min(i,Math.floor(r+(o-s)*l/o+p)),a);}var c=e[r],h=n,f=i;for(os(e,n,r),a(e[i],c)>0&&os(e,n,i);h<f;){for(os(e,h,f),h++,f--;a(e[h],c)<0;)h++;for(;a(e[f],c)>0;)f--;}0===a(e[n],c)?os(e,n,f):os(e,++f,i),f<=r&&(n=f+1),r<=f&&(i=f-1);}}(t,e,r||0,n||t.length-1,i||ss);}function os(t,e,r){var n=t[e];t[e]=t[r],t[r]=n;}function ss(t,e){return t<e?-1:t>e?1:0}function us(t,e){var r=t.length;if(r<=1)return [t];for(var n,i,a=[],o=0;o<r;o++){var s=A(t[o]);0!==s&&(t[o].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(n&&a.push(n),n=[t[o]]):n.push(t[o]));}if(n&&a.push(n),e>1)for(var u=0;u<a.length;u++)a[u].length<=e||(as(a[u],e,1,a[u].length-1,ls),a[u]=a[u].slice(0,e));return a}function ls(t,e){return e.area-t.area}function ps(t,e,r){for(var n=r.patternDependencies,i=!1,a=0,o=e;a<o.length;a+=1){var s=o[a].paint.get(t+"-pattern");s.isConstant()||(i=!0);var u=s.constantOr(null);u&&(i=!0,n[u.to]=!0,n[u.from]=!0);}return i}function cs(t,e,r,n,i){for(var a=i.patternDependencies,o=0,s=e;o<s.length;o+=1){var u=s[o],l=u.paint.get(t+"-pattern").value;if("constant"!==l.kind){var p=l.evaluate({zoom:n-1},r,{},i.availableImages),c=l.evaluate({zoom:n},r,{},i.availableImages),h=l.evaluate({zoom:n+1},r,{},i.availableImages);c=c&&c.name?c.name:c,h=h&&h.name?h.name:h,a[p=p&&p.name?p.name:p]=!0,a[c]=!0,a[h]=!0,r.patterns[u.id]={min:p,mid:c,max:h};}}return r}Bo.deviation=function(t,e,r,n){var i=e&&e.length,a=Math.abs(is(t,0,i?e[0]*r:t.length,r));if(i)for(var o=0,s=e.length;o<s;o++)a-=Math.abs(is(t,e[o]*r,o<s-1?e[o+1]*r:t.length,r));var u=0;for(o=0;o<n.length;o+=3){var l=n[o]*r,p=n[o+1]*r,c=n[o+2]*r;u+=Math.abs((t[l]-t[c])*(t[p+1]-t[l+1])-(t[l]-t[p])*(t[c+1]-t[l+1]));}return 0===a&&0===u?0:Math.abs((u-a)/a)},Bo.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var a=0;a<t[i].length;a++)for(var o=0;o<e;o++)r.vertices.push(t[i][a][o]);i>0&&r.holes.push(n+=t[i-1].length);}return r},Eo.default=Po;var hs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Oi,this.indexArray=new ea,this.indexArray2=new ra,this.programConfigurations=new Ka(To,t.layers,t.zoom),this.segments=new va,this.segments2=new va,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}));};hs.prototype.populate=function(t,e,r){this.hasPattern=ps("fill",this.layers,e);for(var n=this.layers[0].layout.get("fill-sort-key"),i=[],a=0,o=t;a<o.length;a+=1){var s=o[a],u=s.feature,l=s.id,p=s.index,c=s.sourceLayerIndex,h=this.layers[0]._featureFilter.needGeometry,f={type:u.type,id:l,properties:u.properties,geometry:h?Ja(u):[]};if(this.layers[0]._featureFilter.filter(new gi(this.zoom),f,r)){h||(f.geometry=Ja(u));var y=n?n.evaluate(f,{},r,e.availableImages):void 0;i.push({id:l,properties:u.properties,type:u.type,sourceLayerIndex:c,index:p,geometry:f.geometry,patterns:{},sortKey:y});}}n&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var d=0,m=i;d<m.length;d+=1){var v=m[d],g=v.geometry,x=v.index,b=v.sourceLayerIndex;if(this.hasPattern){var w=cs("fill",this.layers,v,this.zoom,e);this.patternFeatures.push(w);}else this.addFeature(v,g,x,r,{});e.featureIndex.insert(t[x].feature,g,x,b,this.index);}},hs.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r);},hs.prototype.addFeatures=function(t,e,r){for(var n=0,i=this.patternFeatures;n<i.length;n+=1){var a=i[n];this.addFeature(a,a.geometry,a.index,e,r);}},hs.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},hs.prototype.uploadPending=function(){return !this.uploaded||this.programConfigurations.needsUpload},hs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,To),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0;},hs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy());},hs.prototype.addFeature=function(t,e,r,n,i){for(var a=0,o=us(e,500);a<o.length;a+=1){for(var s=o[a],u=0,l=0,p=s;l<p.length;l+=1)u+=p[l].length;for(var c=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray),h=c.vertexLength,f=[],y=[],d=0,m=s;d<m.length;d+=1){var v=m[d];if(0!==v.length){v!==s[0]&&y.push(f.length/2);var g=this.segments2.prepareSegment(v.length,this.layoutVertexArray,this.indexArray2),x=g.vertexLength;this.layoutVertexArray.emplaceBack(v[0].x,v[0].y),this.indexArray2.emplaceBack(x+v.length-1,x),f.push(v[0].x),f.push(v[0].y);for(var b=1;b<v.length;b++)this.layoutVertexArray.emplaceBack(v[b].x,v[b].y),this.indexArray2.emplaceBack(x+b-1,x+b),f.push(v[b].x),f.push(v[b].y);g.vertexLength+=v.length,g.primitiveLength+=v.length;}}for(var w=Eo(f,y),_=0;_<w.length;_+=3)this.indexArray.emplaceBack(h+w[_],h+w[_+1],h+w[_+2]);c.vertexLength+=u,c.primitiveLength+=w.length/3;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i,n);},Hn("FillBucket",hs,{omit:["layers","patternFeatures"]});var fs=new Pi({"fill-sort-key":new Ci(Ct.layout_fill["fill-sort-key"])}),ys={paint:new Pi({"fill-antialias":new zi(Ct.paint_fill["fill-antialias"]),"fill-opacity":new Ci(Ct.paint_fill["fill-opacity"]),"fill-color":new Ci(Ct.paint_fill["fill-color"]),"fill-outline-color":new Ci(Ct.paint_fill["fill-outline-color"]),"fill-translate":new zi(Ct.paint_fill["fill-translate"]),"fill-translate-anchor":new zi(Ct.paint_fill["fill-translate-anchor"]),"fill-pattern":new Mi(Ct.paint_fill["fill-pattern"])}),layout:fs},ds=function(t){function e(e){t.call(this,e,ys);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,r){t.prototype.recalculate.call(this,e,r);var n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"]);},e.prototype.createBucket=function(t){return new hs(t)},e.prototype.queryRadius=function(){return lo(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,a,o){return Qa(po(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,o),n)},e.prototype.isTileClipped=function(){return !0},e}(Bi),ms=Li([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,vs=gs;function gs(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(xs,this,e);}function xs(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i;}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos);}function bs(t){for(var e,r,n=0,i=0,a=t.length,o=a-1;i<a;o=i++)n+=((r=t[o]).x-(e=t[i]).x)*(e.y+r.y);return n}gs.types=["Unknown","Point","LineString","Polygon"],gs.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,a=0,o=0,s=0,u=[];t.pos<r;){if(a<=0){var l=t.readVarint();n=7&l,a=l>>3;}if(a--,1===n||2===n)o+=t.readSVarint(),s+=t.readSVarint(),1===n&&(e&&u.push(e),e=[]),e.push(new i(o,s));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone());}}return e&&u.push(e),u},gs.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,i=0,a=0,o=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(n<=0){var p=t.readVarint();r=7&p,n=p>>3;}if(n--,1===r||2===r)(i+=t.readSVarint())<o&&(o=i),i>s&&(s=i),(a+=t.readSVarint())<u&&(u=a),a>l&&(l=a);else if(7!==r)throw new Error("unknown command "+r)}return [o,u,s,l]},gs.prototype.toGeoJSON=function(t,e,r){var n,i,a=this.extent*Math.pow(2,r),o=this.extent*t,s=this.extent*e,u=this.loadGeometry(),l=gs.types[this.type];function p(t){for(var e=0;e<t.length;e++){var r=t[e];t[e]=[360*(r.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+s)/a)*Math.PI/180))-90];}}switch(this.type){case 1:var c=[];for(n=0;n<u.length;n++)c[n]=u[n][0];p(u=c);break;case 2:for(n=0;n<u.length;n++)p(u[n]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return [t];for(var r,n,i=[],a=0;a<e;a++){var o=bs(t[a]);0!==o&&(void 0===n&&(n=o<0),n===o<0?(r&&i.push(r),r=[t[a]]):r.push(t[a]));}return r&&i.push(r),i}(u),n=0;n<u.length;n++)for(i=0;i<u[n].length;i++)p(u[n][i]);}1===u.length?u=u[0]:l="Multi"+l;var h={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return "id"in this&&(h.id=this.id),h};var ws=_s;function _s(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(As,this,e),this.length=this._features.length;}function As(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null;}return e}(r));}function Ss(t,e,r){if(3===t){var n=new ws(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n);}}_s.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new vs(this._pbf,e,this.extent,this._keys,this._values)};var ks={VectorTile:function(t,e){this.layers=t.readFields(Ss,{},e);},VectorTileFeature:vs,VectorTileLayer:ws},Is=ks.VectorTileFeature.types,zs=Math.pow(2,13);function Cs(t,e,r,n,i,a,o,s){t.emplaceBack(e,r,2*Math.floor(n*zs)+o,i*zs*2,a*zs*2,Math.round(s));}var Ms=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ji,this.indexArray=new ea,this.programConfigurations=new Ka(ms,t.layers,t.zoom),this.segments=new va,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}));};function Ts(t,e){return t.x===e.x&&(t.x<0||t.x>ze)||t.y===e.y&&(t.y<0||t.y>ze)}Ms.prototype.populate=function(t,e,r){this.features=[],this.hasPattern=ps("fill-extrusion",this.layers,e);for(var n=0,i=t;n<i.length;n+=1){var a=i[n],o=a.feature,s=a.id,u=a.index,l=a.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,c={type:o.type,id:s,properties:o.properties,geometry:p?Ja(o):[]};if(this.layers[0]._featureFilter.filter(new gi(this.zoom),c,r)){var h={id:s,sourceLayerIndex:l,index:u,geometry:p?c.geometry:Ja(o),properties:o.properties,type:o.type,patterns:{}};void 0!==o.id&&(h.id=o.id),this.hasPattern?this.features.push(cs("fill-extrusion",this.layers,h,this.zoom,e)):this.addFeature(h,h.geometry,u,r,{}),e.featureIndex.insert(o,h.geometry,u,l,this.index,!0);}}},Ms.prototype.addFeatures=function(t,e,r){for(var n=0,i=this.features;n<i.length;n+=1){var a=i[n];this.addFeature(a,a.geometry,a.index,e,r);}},Ms.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r);},Ms.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ms.prototype.uploadPending=function(){return !this.uploaded||this.programConfigurations.needsUpload},Ms.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ms),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Ms.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Ms.prototype.addFeature=function(t,e,r,n,i){for(var a=0,o=us(e,500);a<o.length;a+=1){for(var s=o[a],u=0,l=0,p=s;l<p.length;l+=1)u+=p[l].length;for(var c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=0,f=s;h<f.length;h+=1){var y=f[h];if(0!==y.length&&!((P=y).every((function(t){return t.x<0}))||P.every((function(t){return t.x>ze}))||P.every((function(t){return t.y<0}))||P.every((function(t){return t.y>ze}))))for(var d=0,m=0;m<y.length;m++){var v=y[m];if(m>=1){var g=y[m-1];if(!Ts(v,g)){c.vertexLength+4>va.MAX_VERTEX_ARRAY_LENGTH&&(c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var x=v.sub(g)._perp()._unit(),b=g.dist(v);d+b>32768&&(d=0),Cs(this.layoutVertexArray,v.x,v.y,x.x,x.y,0,0,d),Cs(this.layoutVertexArray,v.x,v.y,x.x,x.y,0,1,d),Cs(this.layoutVertexArray,g.x,g.y,x.x,x.y,0,0,d+=b),Cs(this.layoutVertexArray,g.x,g.y,x.x,x.y,0,1,d);var w=c.vertexLength;this.indexArray.emplaceBack(w,w+2,w+1),this.indexArray.emplaceBack(w+1,w+2,w+3),c.vertexLength+=4,c.primitiveLength+=2;}}}}if(c.vertexLength+u>va.MAX_VERTEX_ARRAY_LENGTH&&(c=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray)),"Polygon"===Is[t.type]){for(var _=[],A=[],S=c.vertexLength,k=0,I=s;k<I.length;k+=1){var z=I[k];if(0!==z.length){z!==s[0]&&A.push(_.length/2);for(var C=0;C<z.length;C++){var M=z[C];Cs(this.layoutVertexArray,M.x,M.y,0,0,1,1,0),_.push(M.x),_.push(M.y);}}}for(var T=Eo(_,A),E=0;E<T.length;E+=3)this.indexArray.emplaceBack(S+T[E],S+T[E+2],S+T[E+1]);c.primitiveLength+=T.length/3,c.vertexLength+=u;}}var P;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i,n);},Hn("FillExtrusionBucket",Ms,{omit:["layers","features"]});var Es={paint:new Pi({"fill-extrusion-opacity":new zi(Ct["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ci(Ct["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zi(Ct["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zi(Ct["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Mi(Ct["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ci(Ct["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ci(Ct["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new zi(Ct["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Ps=function(t){function e(e){t.call(this,e,Es);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Ms(t)},e.prototype.queryRadius=function(){return lo(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return !0},e.prototype.queryIntersectsFeature=function(t,e,r,n,a,o,s,u){var l=po(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,s),p=this.paint.get("fill-extrusion-height").evaluate(e,r),c=this.paint.get("fill-extrusion-base").evaluate(e,r),h=function(t,e,r,n){for(var a=[],o=0,s=t;o<s.length;o+=1){var u=s[o],l=[u.x,u.y,0,1];mo(l,l,e),a.push(new i(l[0]/l[3],l[1]/l[3]));}return a}(l,u),f=function(t,e,r,n){for(var a=[],o=[],s=n[8]*e,u=n[9]*e,l=n[10]*e,p=n[11]*e,c=n[8]*r,h=n[9]*r,f=n[10]*r,y=n[11]*r,d=0,m=t;d<m.length;d+=1){for(var v=[],g=[],x=0,b=m[d];x<b.length;x+=1){var w=b[x],_=w.x,A=w.y,S=n[0]*_+n[4]*A+n[12],k=n[1]*_+n[5]*A+n[13],I=n[2]*_+n[6]*A+n[14],z=n[3]*_+n[7]*A+n[15],C=I+l,M=z+p,T=S+c,E=k+h,P=I+f,B=z+y,V=new i((S+s)/M,(k+u)/M);V.z=C/M,v.push(V);var F=new i(T/B,E/B);F.z=P/B,g.push(F);}a.push(v),o.push(g);}return [a,o]}(n,c,p,u);return function(t,e,r){var n=1/0;Qa(r,e)&&(n=Vs(r,e[0]));for(var i=0;i<e.length;i++)for(var a=e[i],o=t[i],s=0;s<a.length-1;s++){var u=a[s],l=[u,a[s+1],o[s+1],o[s],u];$a(r,l)&&(n=Math.min(n,Vs(r,l)));}return n!==1/0&&n}(f[0],f[1],h)},e}(Bi);function Bs(t,e){return t.x*e.x+t.y*e.y}function Vs(t,e){if(1===t.length){for(var r,n,i=0,a=e[i++];!r||a.equals(r);)if(!(r=e[i++]))return 1/0;for(;!n||a.equals(n)||r.equals(n);)if(!(n=e[i++]))return 1/0;var o=t[0],s=r.sub(a),u=n.sub(a),l=o.sub(a),p=Bs(s,s),c=Bs(s,u),h=Bs(u,u),f=Bs(l,s),y=Bs(l,u),d=p*h-c*c,m=(h*f-c*y)/d,v=(p*y-c*f)/d;return a.z*(1-m-v)+r.z*m+n.z*v}for(var g=1/0,x=0,b=e;x<b.length;x+=1)g=Math.min(g,b[x].z);return g}var Fs=Li([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Ds=ks.VectorTileFeature.types,Ls=Math.cos(Math.PI/180*37.5),Rs=Math.pow(2,14)/.5,Os=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new qi,this.indexArray=new ea,this.programConfigurations=new Ka(Fs,t.layers,t.zoom),this.segments=new va,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}));};Os.prototype.populate=function(t,e,r){this.hasPattern=ps("line",this.layers,e);for(var n=this.layers[0].layout.get("line-sort-key"),i=[],a=0,o=t;a<o.length;a+=1){var s=o[a],u=s.feature,l=s.id,p=s.index,c=s.sourceLayerIndex,h=this.layers[0]._featureFilter.needGeometry,f={type:u.type,id:l,properties:u.properties,geometry:h?Ja(u):[]};if(this.layers[0]._featureFilter.filter(new gi(this.zoom),f,r)){h||(f.geometry=Ja(u));var y=n?n.evaluate(f,{},r):void 0;i.push({id:l,properties:u.properties,type:u.type,sourceLayerIndex:c,index:p,geometry:f.geometry,patterns:{},sortKey:y});}}n&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var d=0,m=i;d<m.length;d+=1){var v=m[d],g=v.geometry,x=v.index,b=v.sourceLayerIndex;if(this.hasPattern){var w=cs("line",this.layers,v,this.zoom,e);this.patternFeatures.push(w);}else this.addFeature(v,g,x,r,{});e.featureIndex.insert(t[x].feature,g,x,b,this.index);}},Os.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r);},Os.prototype.addFeatures=function(t,e,r){for(var n=0,i=this.patternFeatures;n<i.length;n+=1){var a=i[n];this.addFeature(a,a.geometry,a.index,e,r);}},Os.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Os.prototype.uploadPending=function(){return !this.uploaded||this.programConfigurations.needsUpload},Os.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fs),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Os.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Os.prototype.addFeature=function(t,e,r,n,i){for(var a=this.layers[0].layout,o=a.get("line-join").evaluate(t,{}),s=a.get("line-cap"),u=a.get("line-miter-limit"),l=a.get("line-round-limit"),p=0,c=e;p<c.length;p+=1)this.addLine(c[p],t,o,s,u,l,r,n,i);},Os.prototype.addLine=function(t,e,r,n,i,a,o,s,u){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end")){this.clipStart=+e.properties.mapbox_clip_start,this.clipEnd=+e.properties.mapbox_clip_end;for(var l=0;l<t.length-1;l++)this.totalDistance+=t[l].dist(t[l+1]);this.updateScaledDistance();}for(var p="Polygon"===Ds[e.type],c=t.length;c>=2&&t[c-1].equals(t[c-2]);)c--;for(var h=0;h<c-1&&t[h].equals(t[h+1]);)h++;if(!(c<(p?3:2))){"bevel"===r&&(i=1.05);var f,y=this.overscaling<=16?15*ze/(512*this.overscaling):0,d=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray),m=void 0,v=void 0,g=void 0,x=void 0;this.e1=this.e2=-1,p&&(x=t[h].sub(f=t[c-2])._unit()._perp());for(var b=h;b<c;b++)if(!(v=b===c-1?p?t[h+1]:void 0:t[b+1])||!t[b].equals(v)){x&&(g=x),f&&(m=f),f=t[b],x=v?v.sub(f)._unit()._perp():g;var w=(g=g||x).add(x);0===w.x&&0===w.y||w._unit();var _=g.x*x.x+g.y*x.y,A=w.x*x.x+w.y*x.y,S=0!==A?1/A:1/0,k=2*Math.sqrt(2-2*A),I=A<Ls&&m&&v,z=g.x*x.y-g.y*x.x>0;if(I&&b>h){var C=f.dist(m);if(C>2*y){var M=f.sub(f.sub(m)._mult(y/C)._round());this.updateDistance(m,M),this.addCurrentVertex(M,g,0,0,d),m=M;}}var T=m&&v,E=T?r:p?"butt":n;if(T&&"round"===E&&(S<a?E="miter":S<=2&&(E="fakeround")),"miter"===E&&S>i&&(E="bevel"),"bevel"===E&&(S>2&&(E="flipbevel"),S<i&&(E="miter")),m&&this.updateDistance(m,f),"miter"===E)w._mult(S),this.addCurrentVertex(f,w,0,0,d);else if("flipbevel"===E){if(S>100)w=x.mult(-1);else{var P=S*g.add(x).mag()/g.sub(x).mag();w._perp()._mult(P*(z?-1:1));}this.addCurrentVertex(f,w,0,0,d),this.addCurrentVertex(f,w.mult(-1),0,0,d);}else if("bevel"===E||"fakeround"===E){var B=-Math.sqrt(S*S-1),V=z?B:0,F=z?0:B;if(m&&this.addCurrentVertex(f,g,V,F,d),"fakeround"===E)for(var D=Math.round(180*k/Math.PI/20),L=1;L<D;L++){var R=L/D;if(.5!==R){var O=R-.5;R+=R*O*(R-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*O*O+(.848013+_*(.215638*_-1.06021)));}var U=x.sub(g)._mult(R)._add(g)._unit()._mult(z?-1:1);this.addHalfVertex(f,U.x,U.y,!1,z,0,d);}v&&this.addCurrentVertex(f,x,-V,-F,d);}else if("butt"===E)this.addCurrentVertex(f,w,0,0,d);else if("square"===E){var j=m?1:-1;this.addCurrentVertex(f,w,j,j,d);}else"round"===E&&(m&&(this.addCurrentVertex(f,g,0,0,d),this.addCurrentVertex(f,g,1,1,d,!0)),v&&(this.addCurrentVertex(f,x,-1,-1,d,!0),this.addCurrentVertex(f,x,0,0,d)));if(I&&b<c-1){var q=f.dist(v);if(q>2*y){var N=f.add(v.sub(f)._mult(y/q)._round());this.updateDistance(f,N),this.addCurrentVertex(N,x,0,0,d),f=N;}}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,s);}},Os.prototype.addCurrentVertex=function(t,e,r,n,i,a){void 0===a&&(a=!1);var o=e.y*n-e.x,s=-e.y-e.x*n;this.addHalfVertex(t,e.x+e.y*r,e.y-e.x*r,a,!1,r,i),this.addHalfVertex(t,o,s,a,!0,-n,i),this.distance>Rs/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,r,n,i,a));},Os.prototype.addHalfVertex=function(t,e,r,n,i,a,o){var s=.5*this.scaledDistance;this.layoutVertexArray.emplaceBack((t.x<<1)+(n?1:0),(t.y<<1)+(i?1:0),Math.round(63*e)+128,Math.round(63*r)+128,1+(0===a?0:a<0?-1:1)|(63&s)<<2,s>>6);var u=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),o.primitiveLength++),i?this.e2=u:this.e1=u;},Os.prototype.updateScaledDistance=function(){this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(Rs-1):this.distance;},Os.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance();},Hn("LineBucket",Os,{omit:["layers","patternFeatures"]});var Us=new Pi({"line-cap":new zi(Ct.layout_line["line-cap"]),"line-join":new Ci(Ct.layout_line["line-join"]),"line-miter-limit":new zi(Ct.layout_line["line-miter-limit"]),"line-round-limit":new zi(Ct.layout_line["line-round-limit"]),"line-sort-key":new Ci(Ct.layout_line["line-sort-key"])}),js={paint:new Pi({"line-opacity":new Ci(Ct.paint_line["line-opacity"]),"line-color":new Ci(Ct.paint_line["line-color"]),"line-translate":new zi(Ct.paint_line["line-translate"]),"line-translate-anchor":new zi(Ct.paint_line["line-translate-anchor"]),"line-width":new Ci(Ct.paint_line["line-width"]),"line-gap-width":new Ci(Ct.paint_line["line-gap-width"]),"line-offset":new Ci(Ct.paint_line["line-offset"]),"line-blur":new Ci(Ct.paint_line["line-blur"]),"line-dasharray":new Ti(Ct.paint_line["line-dasharray"]),"line-pattern":new Mi(Ct.paint_line["line-pattern"]),"line-gradient":new Ei(Ct.paint_line["line-gradient"])}),layout:Us},qs=new(function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new gi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,n,i){return r=p({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,n,i)},e}(Ci))(js.paint.properties["line-width"].specification);qs.useIntegerZoom=!0;var Ns=function(t){function e(e){t.call(this,e,js);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&this._updateGradient();},e.prototype._updateGradient=function(){this.gradient=Io(this._transitionablePaint._values["line-gradient"].value.expression,"lineProgress"),this.gradientTexture=null;},e.prototype.recalculate=function(e,r){t.prototype.recalculate.call(this,e,r),this.paint._values["line-floorwidth"]=qs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e);},e.prototype.createBucket=function(t){return new Os(t)},e.prototype.queryRadius=function(t){var e=t,r=Ks(uo("line-width",this,e),uo("line-gap-width",this,e)),n=uo("line-offset",this,e);return r/2+Math.abs(n)+lo(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,a,o,s){var u=po(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,s),l=s/2*Ks(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),p=this.paint.get("line-offset").evaluate(e,r);return p&&(n=function(t,e){for(var r=[],n=new i(0,0),a=0;a<t.length;a++){for(var o=t[a],s=[],u=0;u<o.length;u++){var l=o[u],p=o[u+1],c=0===u?n:l.sub(o[u-1])._unit()._perp(),h=u===o.length-1?n:p.sub(l)._unit()._perp(),f=c._add(h)._unit();f._mult(1/(f.x*h.x+f.y*h.y)),s.push(f._mult(e)._add(l));}r.push(s);}return r}(n,p*s)),function(t,e,r){for(var n=0;n<e.length;n++){var i=e[n];if(t.length>=3)for(var a=0;a<i.length;a++)if(oo(t,i[a]))return !0;if(to(t,i,r))return !0}return !1}(u,n,l)},e.prototype.isTileClipped=function(){return !0},e}(Bi);function Ks(t,e){return e>0?e+2*t:t}var Xs=Li([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Gs=Li([{name:"a_projected_pos",components:3,type:"Float32"}],4),Zs=(Li([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Li([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Js=(Li([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),Li([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Hs=Li([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function Ys(t,e,r){return t.sections.forEach((function(t){t.text=function(t,e,r){var n=e.layout.get("text-transform").evaluate(r,{});return "uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),vi.applyArabicShaping&&(t=vi.applyArabicShaping(t)),t}(t.text,e,r);})),t}Li([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Li([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"}]),Li([{type:"Float32",name:"offsetX"}]),Li([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var $s={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},Ws=24,Qs=function(t,e,r,n,i){var a,o,s=8*i-n-1,u=(1<<s)-1,l=u>>1,p=-7,c=r?i-1:0,h=r?-1:1,f=t[e+c];for(c+=h,a=f&(1<<-p)-1,f>>=-p,p+=s;p>0;a=256*a+t[e+c],c+=h,p-=8);for(o=a&(1<<-p)-1,a>>=-p,p+=n;p>0;o=256*o+t[e+c],c+=h,p-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),a-=l;}return (f?-1:1)*o*Math.pow(2,a-n)},tu=function(t,e,r,n,i,a){var o,s,u,l=8*a-i-1,p=(1<<l)-1,c=p>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,y=n?1:-1,d=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=p):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+c>=1?h/u:h*Math.pow(2,1-c))*u>=2&&(o++,u/=2),o+c>=p?(s=0,o=p):o+c>=1?(s=(e*u-1)*Math.pow(2,i),o+=c):(s=e*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;t[r+f]=255&s,f+=y,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;t[r+f]=255&o,f+=y,o/=256,l-=8);t[r+f-y]|=128*d;},eu=ru;function ru(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length;}ru.Varint=0,ru.Fixed64=1,ru.Bytes=2,ru.Fixed32=5;var nu="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function iu(t){return t.type===ru.Bytes?t.readVarint()+t.pos:t.pos+1}function au(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function ou(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i];}function su(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r]);}function uu(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r]);}function lu(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r]);}function pu(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r]);}function cu(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r]);}function hu(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r]);}function fu(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r]);}function yu(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r]);}function du(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r]);}function mu(t,e){return (t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function vu(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24;}function gu(t,e){return (t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}ru.prototype={destroy:function(){this.buf=null;},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,a=this.pos;this.type=7&n,t(i,e,this),this.pos===a&&this.skip(n);}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=mu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=gu(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=mu(this.buf,this.pos)+4294967296*mu(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=mu(this.buf,this.pos)+4294967296*gu(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Qs(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Qs(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,a=r.buf;if(n=(112&(i=a[r.pos++]))>>4,i<128)return au(t,n,e);if(n|=(127&(i=a[r.pos++]))<<3,i<128)return au(t,n,e);if(n|=(127&(i=a[r.pos++]))<<10,i<128)return au(t,n,e);if(n|=(127&(i=a[r.pos++]))<<17,i<128)return au(t,n,e);if(n|=(127&(i=a[r.pos++]))<<24,i<128)return au(t,n,e);if(n|=(1&(i=a[r.pos++]))<<31,i<128)return au(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&nu?function(t,e,r){return nu.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){for(var n="",i=e;i<r;){var a,o,s,u=t[i],l=null,p=u>239?4:u>223?3:u>191?2:1;if(i+p>r)break;1===p?u<128&&(l=u):2===p?128==(192&(a=t[i+1]))&&(l=(31&u)<<6|63&a)<=127&&(l=null):3===p?(o=t[i+2],128==(192&(a=t[i+1]))&&128==(192&o)&&((l=(15&u)<<12|(63&a)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):4===p&&(o=t[i+2],s=t[i+3],128==(192&(a=t[i+1]))&&128==(192&o)&&128==(192&s)&&((l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,p=1):l>65535&&(l-=65536,n+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),n+=String.fromCharCode(l),i+=p;}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ru.Bytes)return t.push(this.readVarint(e));var r=iu(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ru.Bytes)return t.push(this.readSVarint());var e=iu(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ru.Bytes)return t.push(this.readBoolean());var e=iu(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ru.Bytes)return t.push(this.readFloat());var e=iu(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ru.Bytes)return t.push(this.readDouble());var e=iu(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ru.Bytes)return t.push(this.readFixed32());var e=iu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ru.Bytes)return t.push(this.readSFixed32());var e=iu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ru.Bytes)return t.push(this.readFixed64());var e=iu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ru.Bytes)return t.push(this.readSFixed64());var e=iu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===ru.Varint)for(;this.buf[this.pos++]>127;);else if(e===ru.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ru.Fixed32)this.pos+=4;else{if(e!==ru.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8;}},writeTag:function(t,e){this.writeVarint(t<<3|e);},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e;}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),vu(this.buf,t,this.pos),this.pos+=4;},writeSFixed32:function(t){this.realloc(4),vu(this.buf,t,this.pos),this.pos+=4;},writeFixed64:function(t){this.realloc(8),vu(this.buf,-1&t,this.pos),vu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8;},writeSFixed64:function(t){this.realloc(8),vu(this.buf,-1&t,this.pos),vu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8;},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;if(t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,r.buf[r.pos]=127&(t>>>=7);}(r,0,e),function(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))));}(n,e);}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))));},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t);},writeBoolean:function(t){this.writeVarint(Boolean(t));},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,a=0;a<e.length;a++){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){n>56319||a+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null;}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128);}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&ou(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r;},writeFloat:function(t){this.realloc(4),tu(this.buf,t,this.pos,!0,23,4),this.pos+=4;},writeDouble:function(t){this.realloc(8),tu(this.buf,t,this.pos,!0,52,8),this.pos+=8;},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r];},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&ou(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n;},writeMessage:function(t,e,r){this.writeTag(t,ru.Bytes),this.writeRawMessage(e,r);},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,su,e);},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,uu,e);},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,cu,e);},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,lu,e);},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,pu,e);},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,hu,e);},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,fu,e);},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,yu,e);},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,du,e);},writeBytesField:function(t,e){this.writeTag(t,ru.Bytes),this.writeBytes(e);},writeFixed32Field:function(t,e){this.writeTag(t,ru.Fixed32),this.writeFixed32(e);},writeSFixed32Field:function(t,e){this.writeTag(t,ru.Fixed32),this.writeSFixed32(e);},writeFixed64Field:function(t,e){this.writeTag(t,ru.Fixed64),this.writeFixed64(e);},writeSFixed64Field:function(t,e){this.writeTag(t,ru.Fixed64),this.writeSFixed64(e);},writeVarintField:function(t,e){this.writeTag(t,ru.Varint),this.writeVarint(e);},writeSVarintField:function(t,e){this.writeTag(t,ru.Varint),this.writeSVarint(e);},writeStringField:function(t,e){this.writeTag(t,ru.Bytes),this.writeString(e);},writeFloatField:function(t,e){this.writeTag(t,ru.Fixed32),this.writeFloat(e);},writeDoubleField:function(t,e){this.writeTag(t,ru.Fixed64),this.writeDouble(e);},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e));}};var xu=3;function bu(t,e,r){1===t&&r.readMessage(wu,e);}function wu(t,e,r){if(3===t){var n=r.readMessage(_u,{}),i=n.width,a=n.height,o=n.left,s=n.top,u=n.advance;e.push({id:n.id,bitmap:new Ao({width:i+2*xu,height:a+2*xu},n.bitmap),metrics:{width:i,height:a,left:o,top:s,advance:u}});}}function _u(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint());}var Au=xu;function Su(t){for(var e=0,r=0,n=0,i=t;n<i.length;n+=1){var a=i[n];e+=a.w*a.h,r=Math.max(r,a.w);}t.sort((function(t,e){return e.h-t.h}));for(var o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],s=0,u=0,l=0,p=t;l<p.length;l+=1)for(var c=p[l],h=o.length-1;h>=0;h--){var f=o[h];if(!(c.w>f.w||c.h>f.h)){if(c.x=f.x,c.y=f.y,u=Math.max(u,c.y+c.h),s=Math.max(s,c.x+c.w),c.w===f.w&&c.h===f.h){var y=o.pop();h<o.length&&(o[h]=y);}else c.h===f.h?(f.x+=c.w,f.w-=c.w):c.w===f.w?(f.y+=c.h,f.h-=c.h):(o.push({x:f.x+c.w,y:f.y,w:f.w-c.w,h:c.h}),f.y+=c.h,f.h-=c.h);break}}return {w:s,h:u,fill:e/(s*u)||0}}var ku=1,Iu=function(t,e){var r=e.pixelRatio,n=e.version,i=e.stretchX,a=e.stretchY,o=e.content;this.paddedRect=t,this.pixelRatio=r,this.stretchX=i,this.stretchY=a,this.content=o,this.version=n;},zu={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};zu.tl.get=function(){return [this.paddedRect.x+ku,this.paddedRect.y+ku]},zu.br.get=function(){return [this.paddedRect.x+this.paddedRect.w-ku,this.paddedRect.y+this.paddedRect.h-ku]},zu.tlbr.get=function(){return this.tl.concat(this.br)},zu.displaySize.get=function(){return [(this.paddedRect.w-2*ku)/this.pixelRatio,(this.paddedRect.h-2*ku)/this.pixelRatio]},Object.defineProperties(Iu.prototype,zu);var Cu=function(t,e){var r={},n={};this.haveRenderCallbacks=[];var i=[];this.addImages(t,r,i),this.addImages(e,n,i);var a=Su(i),o=new So({width:a.w||1,height:a.h||1});for(var s in t){var u=t[s],l=r[s].paddedRect;So.copy(u.data,o,{x:0,y:0},{x:l.x+ku,y:l.y+ku},u.data);}for(var p in e){var c=e[p],h=n[p].paddedRect,f=h.x+ku,y=h.y+ku,d=c.data.width,m=c.data.height;So.copy(c.data,o,{x:0,y:0},{x:f,y:y},c.data),So.copy(c.data,o,{x:0,y:m-1},{x:f,y:y-1},{width:d,height:1}),So.copy(c.data,o,{x:0,y:0},{x:f,y:y+m},{width:d,height:1}),So.copy(c.data,o,{x:d-1,y:0},{x:f-1,y:y},{width:1,height:m}),So.copy(c.data,o,{x:0,y:0},{x:f+d,y:y},{width:1,height:m});}this.image=o,this.iconPositions=r,this.patternPositions=n;};Cu.prototype.addImages=function(t,e,r){for(var n in t){var i=t[n],a={x:0,y:0,w:i.data.width+2*ku,h:i.data.height+2*ku};r.push(a),e[n]=new Iu(a,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(n);}},Cu.prototype.patchUpdatedImages=function(t,e){for(var r in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[r],t.getImage(r),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r),e);},Cu.prototype.patchUpdatedImage=function(t,e,r){if(t&&e&&t.version!==e.version){t.version=e.version;var n=t.tl;r.update(e.data,void 0,{x:n[0],y:n[1]});}},Hn("ImagePosition",Iu),Hn("ImageAtlas",Cu);var Mu={horizontal:1,vertical:2,horizontalOnly:3},Tu=-17,Eu=function(){this.scale=1,this.fontStack="",this.imageName=null;};Eu.forText=function(t,e){var r=new Eu;return r.scale=t||1,r.fontStack=e,r},Eu.forImage=function(t){var e=new Eu;return e.imageName=t,e};var Pu=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null;};function Bu(t,e,r,n,i,a,o,s,u,l,p,c,h,f,y,d){var m,v=Pu.fromFeature(t,i);c===Mu.vertical&&v.verticalizePunctuation();var g=vi.processBidirectionalText,x=vi.processStyledBidirectionalText;if(g&&1===v.sections.length){m=[];for(var b=0,w=g(v.toString(),Uu(v,l,a,e,n,f,y));b<w.length;b+=1){var _=w[b],A=new Pu;A.text=_,A.sections=v.sections;for(var S=0;S<_.length;S++)A.sectionIndex.push(0);m.push(A);}}else if(x){m=[];for(var k=0,I=x(v.text,v.sectionIndex,Uu(v,l,a,e,n,f,y));k<I.length;k+=1){var z=I[k],C=new Pu;C.text=z[0],C.sectionIndex=z[1],C.sections=v.sections,m.push(C);}}else m=function(t,e){for(var r=[],n=t.text,i=0,a=0,o=e;a<o.length;a+=1){var s=o[a];r.push(t.substring(i,s)),i=s;}return i<n.length&&r.push(t.substring(i,n.length)),r}(v,Uu(v,l,a,e,n,f,y));var M=[],T={positionedLines:M,text:v.toString(),top:p[1],bottom:p[1],left:p[0],right:p[0],writingMode:c,iconsInText:!1,verticalizable:!1};return function(t,e,r,n,i,a,o,s,u,l,p,c){for(var h=0,f=Tu,y=0,d=0,m="right"===s?1:"left"===s?0:.5,v=0,g=0,x=i;g<x.length;g+=1){var b=x[g];b.trim();var w=b.getMaxScale(),_=(w-1)*Ws,A={positionedGlyphs:[],lineOffset:0};t.positionedLines[v]=A;var S=A.positionedGlyphs,k=0;if(b.length()){for(var I=0;I<b.length();I++){var z=b.getSection(I),C=b.getSectionIndex(I),M=b.getCharCode(I),T=0,E=null,P=null,B=null,V=Ws,F=!(u===Mu.horizontal||!p&&!ii(M)||p&&(Vu[M]||(K=M,ri.Arabic(K)||ri["Arabic Supplement"](K)||ri["Arabic Extended-A"](K)||ri["Arabic Presentation Forms-A"](K)||ri["Arabic Presentation Forms-B"](K))));if(z.imageName){var D=n[z.imageName];if(!D)continue;B=z.imageName,t.iconsInText=t.iconsInText||!0,P=D.paddedRect;var L=D.displaySize;z.scale=z.scale*Ws/c,T=_+(Ws-L[1]*z.scale),V=(E={width:L[0],height:L[1],left:ku,top:-Au,advance:F?L[1]:L[0]}).advance;var R=F?L[0]*z.scale-Ws*w:L[1]*z.scale-Ws*w;R>0&&R>k&&(k=R);}else{var O=r[z.fontStack],U=O&&O[M];if(U&&U.rect)P=U.rect,E=U.metrics;else{var j=e[z.fontStack],q=j&&j[M];if(!q)continue;E=q.metrics;}T=(w-z.scale)*Ws;}F?(t.verticalizable=!0,S.push({glyph:M,imageName:B,x:h,y:f+T,vertical:F,scale:z.scale,fontStack:z.fontStack,sectionIndex:C,metrics:E,rect:P}),h+=V*z.scale+l):(S.push({glyph:M,imageName:B,x:h,y:f+T,vertical:F,scale:z.scale,fontStack:z.fontStack,sectionIndex:C,metrics:E,rect:P}),h+=E.advance*z.scale+l);}0!==S.length&&(y=Math.max(h-l,y),qu(S,0,S.length-1,m,k)),h=0;var N=a*w+k;A.lineOffset=Math.max(k,_),f+=N,d=Math.max(N,d),++v;}else f+=a,++v;}var K,X=f-Tu,G=ju(o),Z=G.horizontalAlign,J=G.verticalAlign;(function(t,e,r,n,i,a,o,s,u){var l,p=(e-r)*i;l=a!==o?-s*n-Tu:(-n*u+.5)*o;for(var c=0,h=t;c<h.length;c+=1)for(var f=0,y=h[c].positionedGlyphs;f<y.length;f+=1){var d=y[f];d.x+=p,d.y+=l;}})(t.positionedLines,m,Z,J,y,d,a,X,i.length),t.top+=-J*X,t.bottom=t.top+X,t.left+=-Z*y,t.right=t.left+y;}(T,e,r,n,m,o,s,u,c,l,h,d),!function(t){for(var e=0,r=t;e<r.length;e+=1)if(0!==r[e].positionedGlyphs.length)return !1;return !0}(M)&&T}Pu.fromFeature=function(t,e){for(var r=new Pu,n=0;n<t.sections.length;n++){var i=t.sections[n];i.image?r.addImageSection(i):r.addTextSection(i,e);}return r},Pu.prototype.length=function(){return this.text.length},Pu.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Pu.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Pu.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Pu.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",r=0;r<t.length;r++){var n=t.charCodeAt(r+1)||null,i=t.charCodeAt(r-1)||null;e+=n&&ai(n)&&!$s[t[r+1]]||i&&ai(i)&&!$s[t[r-1]]||!$s[t[r]]?t[r]:$s[t[r]];}return e}(this.text);},Pu.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Vu[this.text.charCodeAt(e)];e++)t++;for(var r=this.text.length,n=this.text.length-1;n>=0&&n>=t&&Vu[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r);},Pu.prototype.substring=function(t,e){var r=new Pu;return r.text=this.text.substring(t,e),r.sectionIndex=this.sectionIndex.slice(t,e),r.sections=this.sections,r},Pu.prototype.toString=function(){return this.text},Pu.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce((function(e,r){return Math.max(e,t.sections[r].scale)}),0)},Pu.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(Eu.forText(t.scale,t.fontStack||e));for(var r=this.sections.length-1,n=0;n<t.text.length;++n)this.sectionIndex.push(r);},Pu.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(0!==e.length){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(Eu.forImage(e)),this.sectionIndex.push(this.sections.length-1)):w("Reached maximum number of images 6401");}else w("Can't add FormattedSection with an empty image.");},Pu.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Vu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Fu={};function Du(t,e,r,n,i,a){if(e.imageName){var o=n[e.imageName];return o?o.displaySize[0]*e.scale*Ws/a+i:0}var s=r[e.fontStack],u=s&&s[t];return u?u.metrics.advance*e.scale+i:0}function Lu(t,e,r,n){var i=Math.pow(t-e,2);return n?t<e?i/2:2*i:i+Math.abs(r)*r}function Ru(t,e,r){var n=0;return 10===t&&(n-=1e4),r&&(n+=150),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function Ou(t,e,r,n,i,a){for(var o=null,s=Lu(e,r,i,a),u=0,l=n;u<l.length;u+=1){var p=l[u],c=Lu(e-p.x,r,i,a)+p.badness;c<=s&&(o=p,s=c);}return {index:t,x:e,priorBreak:o,badness:s}}function Uu(t,e,r,n,i,a,o){if("point"!==a)return [];if(!t)return [];for(var s,u=[],l=function(t,e,r,n,i,a){for(var o=0,s=0;s<t.length();s++){var u=t.getSection(s);o+=Du(t.getCharCode(s),u,n,i,e,a);}return o/Math.max(1,Math.ceil(o/r))}(t,e,r,n,i,o),p=t.text.indexOf("​")>=0,c=0,h=0;h<t.length();h++){var f=t.getSection(h),y=t.getCharCode(h);if(Vu[y]||(c+=Du(y,f,n,i,e,o)),h<t.length()-1){var d=!((s=y)<11904||!(ri["Bopomofo Extended"](s)||ri.Bopomofo(s)||ri["CJK Compatibility Forms"](s)||ri["CJK Compatibility Ideographs"](s)||ri["CJK Compatibility"](s)||ri["CJK Radicals Supplement"](s)||ri["CJK Strokes"](s)||ri["CJK Symbols and Punctuation"](s)||ri["CJK Unified Ideographs Extension A"](s)||ri["CJK Unified Ideographs"](s)||ri["Enclosed CJK Letters and Months"](s)||ri["Halfwidth and Fullwidth Forms"](s)||ri.Hiragana(s)||ri["Ideographic Description Characters"](s)||ri["Kangxi Radicals"](s)||ri["Katakana Phonetic Extensions"](s)||ri.Katakana(s)||ri["Vertical Forms"](s)||ri["Yi Radicals"](s)||ri["Yi Syllables"](s)));(Fu[y]||d||f.imageName)&&u.push(Ou(h+1,c,l,u,Ru(y,t.getCharCode(h+1),d&&p),!1));}}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Ou(t.length(),c,l,u,0,!0))}function ju(t){var e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0;}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;}return {horizontalAlign:e,verticalAlign:r}}function qu(t,e,r,n,i){if(n||i)for(var a=t[r],o=(t[r].x+a.metrics.advance*a.scale)*n,s=e;s<=r;s++)t[s].x-=o,t[s].y+=i;}function Nu(t,e,r,n,i,a){var o,s=t.image;if(s.content){var u=s.content,l=s.pixelRatio||1;o=[u[0]/l,u[1]/l,s.displaySize[0]-u[2]/l,s.displaySize[1]-u[3]/l];}var p,c,h,f,y=e.left*a,d=e.right*a;"width"===r||"both"===r?(f=i[0]+y-n[3],c=i[0]+d+n[1]):c=(f=i[0]+(y+d-s.displaySize[0])/2)+s.displaySize[0];var m=e.top*a,v=e.bottom*a;return "height"===r||"both"===r?(p=i[1]+m-n[0],h=i[1]+v+n[2]):h=(p=i[1]+(m+v-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:p,right:c,bottom:h,left:f,collisionPadding:o}}Fu[10]=!0,Fu[32]=!0,Fu[38]=!0,Fu[40]=!0,Fu[41]=!0,Fu[43]=!0,Fu[45]=!0,Fu[47]=!0,Fu[173]=!0,Fu[183]=!0,Fu[8203]=!0,Fu[8208]=!0,Fu[8211]=!0,Fu[8231]=!0;var Ku=function(t){function e(e,r,n,i){t.call(this,e,r),this.angle=n,void 0!==i&&(this.segment=i);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(i);Hn("Anchor",Ku);var Xu=128;function Gu(t,e){var r=e.expression;if("constant"===r.kind)return {kind:"constant",layoutSize:r.evaluate(new gi(t+1))};if("source"===r.kind)return {kind:"source"};for(var n=r.zoomStops,i=r.interpolationType,a=0;a<n.length&&n[a]<=t;)a++;for(var o=a=Math.max(0,a-1);o<n.length&&n[o]<t+1;)o++;o=Math.min(n.length-1,o);var s=n[a],u=n[o];return "composite"===r.kind?{kind:"composite",minZoom:s,maxZoom:u,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:u,minSize:r.evaluate(new gi(s)),maxSize:r.evaluate(new gi(u)),interpolationType:i}}function Zu(t,e,r){var n=e.uSize,i=r.lowerSize;return "source"===t.kind?i/Xu:"composite"===t.kind?Ye(i/Xu,r.upperSize/Xu,e.uSizeT):n}function Ju(t,e){var r=0,n=0;if("constant"===t.kind)n=t.layoutSize;else if("source"!==t.kind){var i=t.interpolationType,a=i?u(vr.interpolationFactor(i,e,t.minZoom,t.maxZoom),0,1):0;"camera"===t.kind?n=Ye(t.minSize,t.maxSize,a):r=a;}return {uSizeT:r,uSize:n}}var Hu=Object.freeze({__proto__:null,getSizeData:Gu,evaluateSizeForFeature:Zu,evaluateSizeForZoom:Ju,SIZE_PACK_FACTOR:Xu});function Yu(t,e,r,n,i){if(void 0===e.segment)return !0;for(var a=e,o=e.segment+1,s=0;s>-r/2;){if(--o<0)return !1;s-=t[o].dist(a),a=t[o];}s+=t[o].dist(t[o+1]),o++;for(var u=[],l=0;s<r/2;){var p=t[o],c=t[o+1];if(!c)return !1;var h=t[o-1].angleTo(p)-p.angleTo(c);for(h=Math.abs((h+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:h}),l+=h;s-u[0].distance>n;)l-=u.shift().angleDelta;if(l>i)return !1;o++,s+=p.dist(c);}return !0}function $u(t){for(var e=0,r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function Wu(t,e,r){return t?.6*e*r:0}function Qu(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function tl(t,e,r,n,i,a){for(var o=Wu(r,i,a),s=Qu(r,n)*a,u=0,l=$u(t)/2,p=0;p<t.length-1;p++){var c=t[p],h=t[p+1],f=c.dist(h);if(u+f>l){var y=(l-u)/f,d=Ye(c.x,h.x,y),m=Ye(c.y,h.y,y),v=new Ku(d,m,h.angleTo(c),p);return v._round(),!o||Yu(t,v,s,o,e)?v:void 0}u+=f;}}function el(t,e,r,n,i,a,o,s,u){var l=Wu(n,a,o),p=Qu(n,i),c=p*o,h=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-c<e/4&&(e=c+e/4),function t(e,r,n,i,a,o,s,u,l){for(var p=o/2,c=$u(e),h=0,f=r-n,y=[],d=0;d<e.length-1;d++){for(var m=e[d],v=e[d+1],g=m.dist(v),x=v.angleTo(m);f+n<h+g;){var b=((f+=n)-h)/g,w=Ye(m.x,v.x,b),_=Ye(m.y,v.y,b);if(w>=0&&w<l&&_>=0&&_<l&&f-p>=0&&f+p<=c){var A=new Ku(w,_,x,d);A._round(),i&&!Yu(e,A,o,i,a)||y.push(A);}}h+=g;}return u||y.length||s||(y=t(e,h/2,n,i,a,o,s,!0,l)),y}(t,h?e/2*s%e:(p/2+2*a)*o*s%e,e,l,r,c,h,!1,u)}var rl=ku;function nl(t,e,r,n){var a=[],o=t.image,s=o.pixelRatio,u=o.paddedRect.w-2*rl,l=o.paddedRect.h-2*rl,p=t.right-t.left,c=t.bottom-t.top,h=o.stretchX||[[0,u]],f=o.stretchY||[[0,l]],y=function(t,e){return t+e[1]-e[0]},d=h.reduce(y,0),m=f.reduce(y,0),v=u-d,g=l-m,x=0,b=d,w=0,_=m,A=0,S=v,k=0,I=g;if(o.content&&n){var z=o.content;x=il(h,0,z[0]),w=il(f,0,z[1]),b=il(h,z[0],z[2]),_=il(f,z[1],z[3]),A=z[0]-x,k=z[1]-w,S=z[2]-z[0]-b,I=z[3]-z[1]-_;}var C=function(n,a,u,l){var h=ol(n.stretch-x,b,p,t.left),f=sl(n.fixed-A,S,n.stretch,d),y=ol(a.stretch-w,_,c,t.top),v=sl(a.fixed-k,I,a.stretch,m),g=ol(u.stretch-x,b,p,t.left),z=sl(u.fixed-A,S,u.stretch,d),C=ol(l.stretch-w,_,c,t.top),M=sl(l.fixed-k,I,l.stretch,m),T=new i(h,y),E=new i(g,y),P=new i(g,C),B=new i(h,C),V=new i(f/s,v/s),F=new i(z/s,M/s),D=e*Math.PI/180;if(D){var L=Math.sin(D),R=Math.cos(D),O=[R,-L,L,R];T._matMult(O),E._matMult(O),B._matMult(O),P._matMult(O);}var U=n.stretch+n.fixed,j=a.stretch+a.fixed;return {tl:T,tr:E,bl:B,br:P,tex:{x:o.paddedRect.x+rl+U,y:o.paddedRect.y+rl+j,w:u.stretch+u.fixed-U,h:l.stretch+l.fixed-j},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:V,pixelOffsetBR:F,minFontScaleX:S/s/p,minFontScaleY:I/s/c,isSDF:r}};if(n&&(o.stretchX||o.stretchY))for(var M=al(h,v,d),T=al(f,g,m),E=0;E<M.length-1;E++)for(var P=M[E],B=M[E+1],V=0;V<T.length-1;V++)a.push(C(P,T[V],B,T[V+1]));else a.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:u+1},{fixed:0,stretch:l+1}));return a}function il(t,e,r){for(var n=0,i=0,a=t;i<a.length;i+=1){var o=a[i];n+=Math.max(e,Math.min(r,o[1]))-Math.max(e,Math.min(r,o[0]));}return n}function al(t,e,r){for(var n=[{fixed:-rl,stretch:0}],i=0,a=t;i<a.length;i+=1){var o=a[i],s=o[0],u=o[1],l=n[n.length-1];n.push({fixed:s-l.stretch,stretch:l.stretch}),n.push({fixed:s-l.stretch,stretch:l.stretch+(u-s)});}return n.push({fixed:e+rl,stretch:r}),n}function ol(t,e,r,n){return t/e*r+n}function sl(t,e,r,n){return t-e*r/n}var ul=function(t,e,r,n,a,o,s,u,l,p,c,h){var f=s.top*u-l,y=s.bottom*u+l,d=s.left*u-l,m=s.right*u+l,v=s.collisionPadding;if(v&&(d-=v[0]*u,f-=v[1]*u,m+=v[2]*u,y+=v[3]*u),this.boxStartIndex=t.length,p){var g=y-f,x=m-d;g>0&&(g=Math.max(10*u,g),this._addLineCollisionCircles(t,e,r,r.segment,x,g,n,a,o,c));}else{if(h){var b=new i(d,f),w=new i(m,f),_=new i(d,y),A=new i(m,y),S=h*Math.PI/180;b._rotate(S),w._rotate(S),_._rotate(S),A._rotate(S),d=Math.min(b.x,w.x,_.x,A.x),m=Math.max(b.x,w.x,_.x,A.x),f=Math.min(b.y,w.y,_.y,A.y),y=Math.max(b.y,w.y,_.y,A.y);}t.emplaceBack(r.x,r.y,d,f,m,y,n,a,o,0,0);}this.boxEndIndex=t.length;};ul.prototype._addLineCollisionCircles=function(t,e,r,n,i,a,o,s,u,l){var p=a/2,c=Math.floor(i/p)||1,h=1+.4*Math.log(l)/Math.LN2,f=Math.floor(c*h/2),y=-a/2,d=r,m=n+1,v=y,g=-i/2,x=g-i/4;do{if(--m<0){if(v>g)return;m=0;break}v-=e[m].dist(d),d=e[m];}while(v>x);for(var b=e[m].dist(e[m+1]),w=-f;w<c+f;w++){var _=w*p,A=g+_;if(_<0&&(A+=_),_>i&&(A+=_-i),!(A<v)){for(;v+b<A;){if(v+=b,++m+1>=e.length)return;b=e[m].dist(e[m+1]);}var S=A-v,k=e[m],I=e[m+1].sub(k)._unit()._mult(S)._add(k)._round(),z=Math.abs(A-y)<p?0:.8*(A-y);t.emplaceBack(I.x,I.y,-a/2,-a/2,a/2,a/2,o,s,u,a/2,z);}}};var ll=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=pl),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r);};function pl(t,e){return t<e?-1:t>e?1:0}function cl(t,e,r){void 0===e&&(e=1),void 0===r&&(r=!1);for(var n=1/0,a=1/0,o=-1/0,s=-1/0,u=t[0],l=0;l<u.length;l++){var p=u[l];(!l||p.x<n)&&(n=p.x),(!l||p.y<a)&&(a=p.y),(!l||p.x>o)&&(o=p.x),(!l||p.y>s)&&(s=p.y);}var c=Math.min(o-n,s-a),h=c/2,f=new ll([],hl);if(0===c)return new i(n,a);for(var y=n;y<o;y+=c)for(var d=a;d<s;d+=c)f.push(new fl(y+h,d+h,h,t));for(var m=function(t){for(var e=0,r=0,n=0,i=t[0],a=0,o=i.length,s=o-1;a<o;s=a++){var u=i[a],l=i[s],p=u.x*l.y-l.x*u.y;r+=(u.x+l.x)*p,n+=(u.y+l.y)*p,e+=3*p;}return new fl(r/e,n/e,0,t)}(t),v=f.length;f.length;){var g=f.pop();(g.d>m.d||!m.d)&&(m=g,r&&console.log("found best %d after %d probes",Math.round(1e4*g.d)/1e4,v)),g.max-m.d<=e||(f.push(new fl(g.p.x-(h=g.h/2),g.p.y-h,h,t)),f.push(new fl(g.p.x+h,g.p.y-h,h,t)),f.push(new fl(g.p.x-h,g.p.y+h,h,t)),f.push(new fl(g.p.x+h,g.p.y+h,h,t)),v+=4);}return r&&(console.log("num probes: "+v),console.log("best distance: "+m.d)),m.p}function hl(t,e){return e.max-t.max}function fl(t,e,r,n){this.p=new i(t,e),this.h=r,this.d=function(t,e){for(var r=!1,n=1/0,i=0;i<e.length;i++)for(var a=e[i],o=0,s=a.length,u=s-1;o<s;u=o++){var l=a[o],p=a[u];l.y>t.y!=p.y>t.y&&t.x<(p.x-l.x)*(t.y-l.y)/(p.y-l.y)+l.x&&(r=!r),n=Math.min(n,io(t,l,p));}return (r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2;}ll.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1);},ll.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},ll.prototype.peek=function(){return this.data[0]},ll.prototype._up=function(t){for(var e=this.data,r=this.compare,n=e[t];t>0;){var i=t-1>>1,a=e[i];if(r(n,a)>=0)break;e[t]=a,t=i;}e[t]=n;},ll.prototype._down=function(t){for(var e=this.data,r=this.compare,n=this.length>>1,i=e[t];t<n;){var a=1+(t<<1),o=e[a],s=a+1;if(s<this.length&&r(e[s],o)<0&&(a=s,o=e[s]),r(o,i)>=0)break;e[t]=o,t=a;}e[t]=i;};var yl=7,dl=Number.POSITIVE_INFINITY;function ml(t,e){return e[1]!==dl?function(t,e,r){var n=0,i=0;switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":i=r-yl;break;case"bottom-right":case"bottom-left":case"bottom":i=-r+yl;}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e;}return [n,i]}(t,e[0],e[1]):function(t,e){var r=0,n=0;e<0&&(e=0);var i=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":n=i-yl;break;case"bottom-right":case"bottom-left":n=-i+yl;break;case"bottom":n=-e+yl;break;case"top":n=e-yl;}switch(t){case"top-right":case"bottom-right":r=-i;break;case"top-left":case"bottom-left":r=i;break;case"left":r=e;break;case"right":r=-e;}return [r,n]}(t,e[0])}function vl(t){switch(t){case"right":case"top-right":case"bottom-right":return "right";case"left":case"top-left":case"bottom-left":return "left"}return "center"}var gl=255,xl=gl*Xu;function bl(t,e,r,n,a,o,s,u,l,p,c,h,f,y,d){var m=function(t,e,r,n,a,o,s,u){for(var l=n.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,p=[],c=0,h=e.positionedLines;c<h.length;c+=1)for(var f=h[c],y=0,d=f.positionedGlyphs;y<d.length;y+=1){var m=d[y];if(m.rect){var v=m.rect||{},g=Au+1,x=!0,b=1,w=0,_=(a||u)&&m.vertical,A=m.metrics.advance*m.scale/2;if(u&&e.verticalizable&&(w=f.lineOffset/2-(m.imageName?-(Ws-m.metrics.width*m.scale)/2:(m.scale-1)*Ws)),m.imageName){var S=s[m.imageName];x=S.sdf,g=ku/(b=S.pixelRatio);}var k=a?[m.x+A,m.y]:[0,0],I=a?[0,0]:[m.x+A+r[0],m.y+r[1]-w],z=[0,0];_&&(z=I,I=[0,0]);var C=(m.metrics.left-g)*m.scale-A+I[0],M=(-m.metrics.top-g)*m.scale+I[1],T=C+v.w*m.scale/b,E=M+v.h*m.scale/b,P=new i(C,M),B=new i(T,M),V=new i(C,E),F=new i(T,E);if(_){var D=new i(-A,A-Tu),L=-Math.PI/2,R=Ws/2-A,O=new i(5-Tu-R,-(m.imageName?R:0)),U=new(Function.prototype.bind.apply(i,[null].concat(z)));P._rotateAround(L,D)._add(O)._add(U),B._rotateAround(L,D)._add(O)._add(U),V._rotateAround(L,D)._add(O)._add(U),F._rotateAround(L,D)._add(O)._add(U);}if(l){var j=Math.sin(l),q=Math.cos(l),N=[q,-j,j,q];P._matMult(N),B._matMult(N),V._matMult(N),F._matMult(N);}var K=new i(0,0),X=new i(0,0);p.push({tl:P,tr:B,bl:V,br:F,tex:v,writingMode:e.writingMode,glyphOffset:k,sectionIndex:m.sectionIndex,isSDF:x,pixelOffsetTL:K,pixelOffsetBR:X,minFontScaleX:0,minFontScaleY:0});}}return p}(0,r,u,a,o,s,n,t.allowVerticalPlacement),v=t.textSizeData,g=null;"source"===v.kind?(g=[Xu*a.layout.get("text-size").evaluate(s,{})])[0]>xl&&w(t.layerIds[0]+': Value for "text-size" is >= '+gl+'. Reduce your "text-size".'):"composite"===v.kind&&((g=[Xu*y.compositeTextSizes[0].evaluate(s,{},d),Xu*y.compositeTextSizes[1].evaluate(s,{},d)])[0]>xl||g[1]>xl)&&w(t.layerIds[0]+': Value for "text-size" is >= '+gl+'. Reduce your "text-size".'),t.addSymbols(t.text,m,g,u,o,s,p,e,l.lineStartIndex,l.lineLength,f,d);for(var x=0,b=c;x<b.length;x+=1)h[b[x]]=t.text.placedSymbolArray.length-1;return 4*m.length}function wl(t){for(var e in t)return t[e];return null}function _l(t,e,r,n){var i=t.compareText;if(e in i){for(var a=i[e],o=a.length-1;o>=0;o--)if(n.dist(a[o])<r)return !0}else i[e]=[];return i[e].push(n),!1}var Al=ks.VectorTileFeature.types,Sl=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function kl(t,e,r,n,i,a,o,s,u,l,p,c,h){var f=s?Math.min(xl,Math.round(s[0])):0,y=s?Math.min(xl,Math.round(s[1])):0;t.emplaceBack(e,r,Math.round(32*n),Math.round(32*i),a,o,(f<<1)+(u?1:0),y,16*l,16*p,256*c,256*h);}function Il(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r);}function zl(t){for(var e=0,r=t.sections;e<r.length;e+=1)if(ui(r[e].text))return !0;return !1}var Cl=function(t){this.layoutVertexArray=new Ki,this.indexArray=new ea,this.programConfigurations=t,this.segments=new va,this.dynamicLayoutVertexArray=new Xi,this.opacityVertexArray=new Gi,this.placedSymbolArray=new la;};Cl.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},Cl.prototype.upload=function(t,e,r,n){this.isEmpty()||(r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Xs.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Gs.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Sl,!0),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(t));},Cl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy());},Hn("SymbolBuffers",Cl);var Ml=function(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new va,this.collisionVertexArray=new Hi;};Ml.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Zs.members,!0);},Ml.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy());},Hn("CollisionBuffers",Ml);var Tl=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[];var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Gu(this.zoom,e["text-size"]),this.iconSizeData=Gu(this.zoom,e["icon-size"]);var r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&(r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement")),"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map((function(t){return Mu[t]}))),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id})),this.sourceID=t.sourceID;};Tl.prototype.createArrays=function(){this.text=new Cl(new Ka(Xs.members,this.layers,this.zoom,(function(t){return /^text/.test(t)}))),this.icon=new Cl(new Ka(Xs.members,this.layers,this.zoom,(function(t){return /^icon/.test(t)}))),this.glyphOffsetArray=new ha,this.lineVertexArray=new fa,this.symbolInstances=new ca;},Tl.prototype.calculateGlyphDependencies=function(t,e,r,n,i){for(var a=0;a<t.length;a++)if(e[t.charCodeAt(a)]=!0,(r||n)&&i){var o=$s[t.charAt(a)];o&&(e[o.charCodeAt(0)]=!0);}},Tl.prototype.populate=function(t,e,r){var n=this.layers[0],i=n.layout,a=i.get("text-font"),o=i.get("text-field"),s=i.get("icon-image"),u=("constant"!==o.value.kind||o.value.value instanceof te&&!o.value.value.isEmpty()||o.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),l="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,p=i.get("symbol-sort-key");if(this.features=[],u||l){for(var c=e.iconDependencies,h=e.glyphDependencies,f=e.availableImages,y=new gi(this.zoom),d=0,m=t;d<m.length;d+=1){var v=m[d],g=v.feature,x=v.id,b=v.index,w=v.sourceLayerIndex,_=n._featureFilter.needGeometry,A={type:g.type,id:x,properties:g.properties,geometry:_?Ja(g):[]};if(n._featureFilter.filter(y,A,r)){_||(A.geometry=Ja(g));var S=void 0;if(u){var k=n.getValueAndResolveTokens("text-field",A,r,f),I=te.factory(k);zl(I)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===di()||this.hasRTLText&&vi.isParsed())&&(S=Ys(I,n,A));}var z=void 0;if(l){var C=n.getValueAndResolveTokens("icon-image",A,r,f);z=C instanceof ee?C:ee.fromString(C);}if(S||z){var M=this.sortFeaturesByKey?p.evaluate(A,{},r):void 0,T={id:x,text:S,icon:z,index:b,sourceLayerIndex:w,geometry:Ja(g),properties:g.properties,type:Al[g.type],sortKey:M};if(this.features.push(T),z&&(c[z.name]=!0),S){var E=a.evaluate(A,{},r).join(","),P="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Mu.vertical)>=0;for(var B=0,V=S.sections;B<V.length;B+=1){var F=V[B];if(F.image)c[F.image.name]=!0;else{var D=ni(S.toString()),L=F.fontStack||E,R=h[L]=h[L]||{};this.calculateGlyphDependencies(F.text,R,P,this.allowVerticalPlacement,D);}}}}}}"line"===i.get("symbol-placement")&&(this.features=function(t){var e={},r={},n=[],i=0;function a(e){n.push(t[e]),i++;}function o(t,e,i){var a=r[t];return delete r[t],r[e]=a,n[a].geometry[0].pop(),n[a].geometry[0]=n[a].geometry[0].concat(i[0]),a}function s(t,r,i){var a=e[r];return delete e[r],e[t]=a,n[a].geometry[0].shift(),n[a].geometry[0]=i[0].concat(n[a].geometry[0]),a}function u(t,e,r){var n=r?e[0][e[0].length-1]:e[0][0];return t+":"+n.x+":"+n.y}for(var l=0;l<t.length;l++){var p=t[l],c=p.geometry,h=p.text?p.text.toString():null;if(h){var f=u(h,c),y=u(h,c,!0);if(f in r&&y in e&&r[f]!==e[y]){var d=s(f,y,c),m=o(f,y,n[d].geometry);delete e[f],delete r[y],r[u(h,n[m].geometry,!0)]=m,n[d].geometry=null;}else f in r?o(f,y,c):y in e?s(f,y,c):(a(l),e[f]=i-1,r[y]=i-1);}else a(l);}return n.filter((function(t){return t.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(t,e){return t.sortKey-e.sortKey}));}},Tl.prototype.update=function(t,e,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,r),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,r));},Tl.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},Tl.prototype.uploadPending=function(){return !this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Tl.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t),this.textCollisionCircle.upload(t),this.iconCollisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0;},Tl.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy(),this.textCollisionCircle.destroy(),this.iconCollisionCircle.destroy();},Tl.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();},Tl.prototype.addToLineVertexArray=function(t,e){var r=this.lineVertexArray.length;if(void 0!==t.segment){for(var n=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]),a={},o=t.segment+1;o<e.length;o++)a[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:n},o<e.length-1&&(n+=e[o+1].dist(e[o]));for(var s=t.segment||0;s>=0;s--)a[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=a[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor);}}return {lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},Tl.prototype.addSymbols=function(t,e,r,n,i,a,o,s,u,l,p,c){for(var h=t.indexArray,f=t.layoutVertexArray,y=t.segments.prepareSegment(4*e.length,f,h,a.sortKey),d=this.glyphOffsetArray.length,m=y.vertexLength,v=this.allowVerticalPlacement&&o===Mu.vertical?Math.PI/2:0,g=a.text&&a.text.sections,x=0;x<e.length;x++){var b=e[x],w=b.tl,_=b.tr,A=b.bl,S=b.br,k=b.tex,I=b.pixelOffsetTL,z=b.pixelOffsetBR,C=b.minFontScaleX,M=b.minFontScaleY,T=b.glyphOffset,E=b.isSDF,P=b.sectionIndex,B=y.vertexLength,V=T[1];kl(f,s.x,s.y,w.x,V+w.y,k.x,k.y,r,E,I.x,I.y,C,M),kl(f,s.x,s.y,_.x,V+_.y,k.x+k.w,k.y,r,E,z.x,I.y,C,M),kl(f,s.x,s.y,A.x,V+A.y,k.x,k.y+k.h,r,E,I.x,z.y,C,M),kl(f,s.x,s.y,S.x,V+S.y,k.x+k.w,k.y+k.h,r,E,z.x,z.y,C,M),Il(t.dynamicLayoutVertexArray,s,v),h.emplaceBack(B,B+1,B+2),h.emplaceBack(B+1,B+2,B+3),y.vertexLength+=4,y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(T[0]),x!==e.length-1&&P===e[x+1].sectionIndex||t.programConfigurations.populatePaintArrays(f.length,a,a.index,{},c,g&&g[P]);}t.placedSymbolArray.emplaceBack(s.x,s.y,d,this.glyphOffsetArray.length-d,m,u,l,s.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],o,0,!1,0,p);},Tl.prototype._addCollisionDebugVertex=function(t,e,r,n,i,a){return e.emplaceBack(0,0),t.emplaceBack(r.x,r.y,n,i,Math.round(a.x),Math.round(a.y))},Tl.prototype.addCollisionDebugVertices=function(t,e,r,n,a,o,s,u){var l=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),p=l.vertexLength,c=a.layoutVertexArray,h=a.collisionVertexArray,f=s.anchorX,y=s.anchorY;if(this._addCollisionDebugVertex(c,h,o,f,y,new i(t,e)),this._addCollisionDebugVertex(c,h,o,f,y,new i(r,e)),this._addCollisionDebugVertex(c,h,o,f,y,new i(r,n)),this._addCollisionDebugVertex(c,h,o,f,y,new i(t,n)),l.vertexLength+=4,u){var d=a.indexArray;d.emplaceBack(p,p+1,p+2),d.emplaceBack(p,p+2,p+3),l.primitiveLength+=2;}else{var m=a.indexArray;m.emplaceBack(p,p+1),m.emplaceBack(p+1,p+2),m.emplaceBack(p+2,p+3),m.emplaceBack(p+3,p),l.primitiveLength+=4;}},Tl.prototype.addDebugCollisionBoxes=function(t,e,r,n){for(var i=t;i<e;i++){var a=this.collisionBoxArray.get(i),o=a.radius>0;this.addCollisionDebugVertices(a.x1,a.y1,a.x2,a.y2,o?n?this.textCollisionCircle:this.iconCollisionCircle:n?this.textCollisionBox:this.iconCollisionBox,a.anchorPoint,r,o);}},Tl.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ml(Ji,Js.members,ra),this.iconCollisionBox=new Ml(Ji,Js.members,ra),this.textCollisionCircle=new Ml(Ji,Hs.members,ea),this.iconCollisionCircle=new Ml(Ji,Hs.members,ea);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1);}},Tl.prototype._deserializeCollisionBoxesForSymbol=function(t,e,r,n,i,a,o,s,u){for(var l={},p=e;p<r;p++){var c=t.get(p);if(0===c.radius){l.textBox={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2,anchorPointX:c.anchorPointX,anchorPointY:c.anchorPointY},l.textFeatureIndex=c.featureIndex;break}l.textCircles||(l.textCircles=[],l.textFeatureIndex=c.featureIndex),l.textCircles.push(c.anchorPointX,c.anchorPointY,c.radius,c.signedDistanceFromAnchor,1);}for(var h=n;h<i;h++){var f=t.get(h);if(0===f.radius){l.verticalTextBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},l.verticalTextFeatureIndex=f.featureIndex;break}}for(var y=a;y<o;y++){var d=t.get(y);if(0===d.radius){l.iconBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},l.iconFeatureIndex=d.featureIndex;break}}for(var m=s;m<u;m++){var v=t.get(m);if(0===v.radius){l.verticalIconBox={x1:v.x1,y1:v.y1,x2:v.x2,y2:v.y2,anchorPointX:v.anchorPointX,anchorPointY:v.anchorPointY},l.verticalIconFeatureIndex=v.featureIndex;break}}return l},Tl.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex));}},Tl.prototype.hasTextData=function(){return this.text.segments.get().length>0},Tl.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Tl.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox&&this.textCollisionCircle&&this.iconCollisionCircle},Tl.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Tl.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Tl.prototype.hasTextCollisionCircleData=function(){return this.hasDebugData()&&this.textCollisionCircle.segments.get().length>0},Tl.prototype.hasIconCollisionCircleData=function(){return this.hasDebugData()&&this.iconCollisionCircle.segments.get().length>0},Tl.prototype.addIndicesForPlacedSymbol=function(t,e){for(var r=t.placedSymbolArray.get(e),n=r.vertexStartIndex+4*r.numGlyphs,i=r.vertexStartIndex;i<n;i+=4)t.indexArray.emplaceBack(i,i+1,i+2),t.indexArray.emplaceBack(i+1,i+2,i+3);},Tl.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),r=Math.cos(t),n=[],i=[],a=[],o=0;o<this.symbolInstances.length;++o){a.push(o);var s=this.symbolInstances.get(o);n.push(0|Math.round(e*s.anchorX+r*s.anchorY)),i.push(s.featureIndex);}return a.sort((function(t,e){return n[t]-n[e]||i[e]-i[t]})),a},Tl.prototype.addToSortKeyRanges=function(t,e){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===e?r.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1});},Tl.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,n=this.symbolInstanceIndexes;r<n.length;r+=1){var i=this.symbolInstances.get(n[r]);this.featureSortOrder.push(i.featureIndex),[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((function(t,r,n){t>=0&&n.indexOf(t)===r&&e.addIndicesForPlacedSymbol(e.text,t);})),i.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,i.verticalPlacedTextSymbolIndex),i.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.placedIconSymbolIndex),i.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.verticalPlacedIconSymbolIndex);}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray);}},Hn("SymbolBucket",Tl,{omit:["layers","collisionBoxArray","features","compareText"]}),Tl.MAX_GLYPHS=65535,Tl.addDynamicAttributes=Il;var El=new Pi({"symbol-placement":new zi(Ct.layout_symbol["symbol-placement"]),"symbol-spacing":new zi(Ct.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zi(Ct.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ci(Ct.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zi(Ct.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new zi(Ct.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new zi(Ct.layout_symbol["icon-ignore-placement"]),"icon-optional":new zi(Ct.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zi(Ct.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ci(Ct.layout_symbol["icon-size"]),"icon-text-fit":new zi(Ct.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zi(Ct.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ci(Ct.layout_symbol["icon-image"]),"icon-rotate":new Ci(Ct.layout_symbol["icon-rotate"]),"icon-padding":new zi(Ct.layout_symbol["icon-padding"]),"icon-keep-upright":new zi(Ct.layout_symbol["icon-keep-upright"]),"icon-offset":new Ci(Ct.layout_symbol["icon-offset"]),"icon-anchor":new Ci(Ct.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zi(Ct.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zi(Ct.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zi(Ct.layout_symbol["text-rotation-alignment"]),"text-field":new Ci(Ct.layout_symbol["text-field"]),"text-font":new Ci(Ct.layout_symbol["text-font"]),"text-size":new Ci(Ct.layout_symbol["text-size"]),"text-max-width":new Ci(Ct.layout_symbol["text-max-width"]),"text-line-height":new zi(Ct.layout_symbol["text-line-height"]),"text-letter-spacing":new Ci(Ct.layout_symbol["text-letter-spacing"]),"text-justify":new Ci(Ct.layout_symbol["text-justify"]),"text-radial-offset":new Ci(Ct.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zi(Ct.layout_symbol["text-variable-anchor"]),"text-anchor":new Ci(Ct.layout_symbol["text-anchor"]),"text-max-angle":new zi(Ct.layout_symbol["text-max-angle"]),"text-writing-mode":new zi(Ct.layout_symbol["text-writing-mode"]),"text-rotate":new Ci(Ct.layout_symbol["text-rotate"]),"text-padding":new zi(Ct.layout_symbol["text-padding"]),"text-keep-upright":new zi(Ct.layout_symbol["text-keep-upright"]),"text-transform":new Ci(Ct.layout_symbol["text-transform"]),"text-offset":new Ci(Ct.layout_symbol["text-offset"]),"text-allow-overlap":new zi(Ct.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new zi(Ct.layout_symbol["text-ignore-placement"]),"text-optional":new zi(Ct.layout_symbol["text-optional"])}),Pl={paint:new Pi({"icon-opacity":new Ci(Ct.paint_symbol["icon-opacity"]),"icon-color":new Ci(Ct.paint_symbol["icon-color"]),"icon-halo-color":new Ci(Ct.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ci(Ct.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ci(Ct.paint_symbol["icon-halo-blur"]),"icon-translate":new zi(Ct.paint_symbol["icon-translate"]),"icon-translate-anchor":new zi(Ct.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ci(Ct.paint_symbol["text-opacity"]),"text-color":new Ci(Ct.paint_symbol["text-color"],{runtimeType:Ut,getOverride:function(t){return t.textColor},hasOverride:function(t){return !!t.textColor}}),"text-halo-color":new Ci(Ct.paint_symbol["text-halo-color"]),"text-halo-width":new Ci(Ct.paint_symbol["text-halo-width"]),"text-halo-blur":new Ci(Ct.paint_symbol["text-halo-blur"]),"text-translate":new zi(Ct.paint_symbol["text-translate"]),"text-translate-anchor":new zi(Ct.paint_symbol["text-translate-anchor"])}),layout:El},Bl=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Dt,this.defaultValue=t;};Bl.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Bl.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression);},Bl.prototype.outputDefined=function(){return !1},Bl.prototype.serialize=function(){return null},Hn("FormatSectionOverride",Bl,{omit:["defaultValue"]});var Vl=function(t){function e(e){t.call(this,e,Pl);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,r){if(t.prototype.recalculate.call(this,e,r),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var n=this.layout.get("text-writing-mode");if(n){for(var i=[],a=0,o=n;a<o.length;a+=1){var s=o[a];i.indexOf(s)<0&&i.push(s);}this.layout._values["text-writing-mode"]=i;}else this.layout._values["text-writing-mode"]=["horizontal"];}this._setPaintOverrides();},e.prototype.getValueAndResolveTokens=function(t,e,r,n){var i=this.layout.get(t).evaluate(e,{},r,n),a=this._unevaluatedLayout._values[t];return a.isDataDriven()||en(a.value)||!i?i:function(t,e){return e.replace(/{([^{}]+)}/g,(function(e,r){return r in t?String(t[r]):""}))}(e.properties,i)},e.prototype.createBucket=function(t){return new Tl(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return !1},e.prototype._setPaintOverrides=function(){for(var t=0,r=Pl.paint.overridableProperties;t<r.length;t+=1){var n=r[t];if(e.hasPaintOverride(this.layout,n)){var i,a=this.paint.get(n),o=new Bl(a),s=new tn(o,a.property.specification);i="constant"===a.value.kind||"source"===a.value.kind?new nn("source",s):new an("composite",s,a.value.zoomStops,a.value._interpolationType),this.paint._values[n]=new ki(a.property,i,a.parameters);}}},e.prototype._handleOverridablePaintPropertyUpdate=function(t,r,n){return !(!this.layout||r.isDataDriven()||n.isDataDriven())&&e.hasPaintOverride(this.layout,t)},e.hasPaintOverride=function(t,e){var r=t.get("text-field"),n=Pl.paint.properties[e],i=!1,a=function(t){for(var e=0,r=t;e<r.length;e+=1)if(n.overrides&&n.overrides.hasOverride(r[e]))return void(i=!0)};if("constant"===r.value.kind&&r.value.value instanceof te)a(r.value.value.sections);else if("source"===r.value.kind){var o=function(t){i||(t instanceof oe&&ie(t.value)===Kt?a(t.value.sections):t instanceof pe?a(t.sections):t.eachChild(o));},s=r.value;s._styleExpression&&o(s._styleExpression.expression);}return i},e}(Bi),Fl={paint:new Pi({"background-color":new zi(Ct.paint_background["background-color"]),"background-pattern":new Ti(Ct.paint_background["background-pattern"]),"background-opacity":new zi(Ct.paint_background["background-opacity"])})},Dl=function(t){function e(e){t.call(this,e,Fl);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Bi),Ll={paint:new Pi({"raster-opacity":new zi(Ct.paint_raster["raster-opacity"]),"raster-hue-rotate":new zi(Ct.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zi(Ct.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zi(Ct.paint_raster["raster-brightness-max"]),"raster-saturation":new zi(Ct.paint_raster["raster-saturation"]),"raster-contrast":new zi(Ct.paint_raster["raster-contrast"]),"raster-resampling":new zi(Ct.paint_raster["raster-resampling"]),"raster-fade-duration":new zi(Ct.paint_raster["raster-fade-duration"])})},Rl=function(t){function e(e){t.call(this,e,Ll);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Bi),Ol=function(t){function e(e){t.call(this,e,{}),this.implementation=e;}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return "3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl);},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl);},e}(Bi),Ul={circle:vo,heatmap:zo,hillshade:Mo,fill:ds,"fill-extrusion":Ps,line:Ns,symbol:Vl,background:Dl,raster:Rl},jl=self.HTMLImageElement,ql=self.HTMLCanvasElement,Nl=self.HTMLVideoElement,Kl=self.ImageData,Xl=self.ImageBitmap,Gl=function(t,e,r,n){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(e,n);};Gl.prototype.update=function(t,e,r){var n=t.width,i=t.height,a=!(this.size&&this.size[0]===n&&this.size[1]===i||r),o=this.context,s=o.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),a)this.size=[n,i],t instanceof jl||t instanceof ql||t instanceof Nl||t instanceof Kl||Xl&&t instanceof Xl?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,n,i,0,this.format,s.UNSIGNED_BYTE,t.data);else{var u=r||{x:0,y:0},l=u.x,p=u.y;t instanceof jl||t instanceof ql||t instanceof Nl||t instanceof Kl||Xl&&t instanceof Xl?s.texSubImage2D(s.TEXTURE_2D,0,l,p,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,l,p,n,i,s.RGBA,s.UNSIGNED_BYTE,t.data);}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D);},Gl.prototype.bind=function(t,e,r){var n=this.context.gl;n.bindTexture(n.TEXTURE_2D,this.texture),r!==n.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=n.LINEAR),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,r||t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e);},Gl.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Gl.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null;};var Zl=function(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback();});};Zl.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){t._triggered=!1,t._callback();}),0));},Zl.prototype.remove=function(){delete this._channel,this._callback=function(){};};var Jl=function(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},d(["receive","process"],this),this.invoker=new Zl(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=S()?t:self;};function Hl(t,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return [t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}Jl.prototype.send=function(t,e,r,n,i){var a=this;void 0===i&&(i=!1);var o=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[o]=r);var s=z(this.globalScope)?void 0:[];return this.target.postMessage({id:o,type:t,hasCallback:!!r,targetMapId:n,mustQueue:i,sourceMapId:this.mapId,data:Qn(e,s)},s),{cancel:function(){r&&delete a.callbacks[o],a.target.postMessage({id:o,type:"<cancel>",targetMapId:n,sourceMapId:a.mapId});}}},Jl.prototype.receive=function(t){var e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[r];var n=this.cancelCallbacks[r];delete this.cancelCallbacks[r],n&&n();}else S()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e);},Jl.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e);}},Jl.prototype.processTask=function(t,e){var r=this;if("<response>"===e.type){var n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(ti(e.error)):n(null,ti(e.data)));}else{var i=!1,a=z(this.globalScope)?void 0:[],o=e.hasCallback?function(e,n){i=!0,delete r.cancelCallbacks[t],r.target.postMessage({id:t,type:"<response>",sourceMapId:r.mapId,error:e?Qn(e):null,data:Qn(n,a)},a);}:function(t){i=!0;},s=null,u=ti(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,u,o);else if(this.parent.getWorkerSource){var l=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,l[0],u.source)[l[1]](u,o);}else o(new Error("Could not find function "+e.type));!i&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel);}},Jl.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1);};var Yl=function(t,e,r){this.z=t,this.x=e,this.y=r,this.key=Ql(0,t,t,e,r);};Yl.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Yl.prototype.url=function(t,e){var r,n,i,a,o,s=(n=this.y,i=this.z,a=Hl(256*(r=this.x),256*(n=Math.pow(2,i)-n-1),i),o=Hl(256*(r+1),256*(n+1),i),a[0]+","+a[1]+","+o[0]+","+o[1]),u=function(t,e,r){for(var n,i="",a=t;a>0;a--)i+=(e&(n=1<<a-1)?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)},Yl.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new i((t.x*e-this.x)*ze,(t.y*e-this.y)*ze)},Yl.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var $l=function(t,e){this.wrap=t,this.canonical=e,this.key=Ql(t,e.z,e.z,e.x,e.y);},Wl=function(t,e,r,n,i){this.overscaledZ=t,this.wrap=e,this.canonical=new Yl(r,+n,+i),this.key=Ql(e,t,r,n,i);};function Ql(t,e,r,n,i){(t*=2)<0&&(t=-1*t-1);var a=1<<r;return (a*a*t+a*i+n).toString(36)+r.toString(36)+e.toString(36)}Wl.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Wl.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Wl(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wl(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Wl.prototype.calculateScaledKey=function(t,e){var r=this.canonical.z-t;return t>this.canonical.z?Ql(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Ql(this.wrap*+e,t,t,this.canonical.x>>r,this.canonical.y>>r)},Wl.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return !1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Wl.prototype.children=function(t){if(this.overscaledZ>=t)return [new Wl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return [new Wl(e,this.wrap,e,r,n),new Wl(e,this.wrap,e,r+1,n),new Wl(e,this.wrap,e,r,n+1),new Wl(e,this.wrap,e,r+1,n+1)]},Wl.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Wl.prototype.wrapped=function(){return new Wl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Wl.prototype.unwrapTo=function(t){return new Wl(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Wl.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Wl.prototype.toUnwrapped=function(){return new $l(this.wrap,this.canonical)},Wl.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Wl.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Ie(t.x-this.wrap,t.y))},Hn("CanonicalTileID",Yl),Hn("OverscaledTileID",Wl,{omit:["posMatrix"]});var tp=function(t,e,r){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return w('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var n=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=r||"mapbox";for(var i=0;i<n;i++)this.data[this._idx(-1,i)]=this.data[this._idx(0,i)],this.data[this._idx(n,i)]=this.data[this._idx(n-1,i)],this.data[this._idx(i,-1)]=this.data[this._idx(i,0)],this.data[this._idx(i,n)]=this.data[this._idx(i,n-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(n,-1)]=this.data[this._idx(n-1,0)],this.data[this._idx(-1,n)]=this.data[this._idx(0,n-1)],this.data[this._idx(n,n)]=this.data[this._idx(n-1,n-1)];};tp.prototype.get=function(t,e){var r=new Uint8Array(this.data.buffer),n=4*this._idx(t,e);return ("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(r[n],r[n+1],r[n+2])},tp.prototype.getUnpackVector=function(){return "terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},tp.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return (e+1)*this.stride+(t+1)},tp.prototype._unpackMapbox=function(t,e,r){return (256*t*256+256*e+r)/10-1e4},tp.prototype._unpackTerrarium=function(t,e,r){return 256*t+e+r/256-32768},tp.prototype.getPixels=function(){return new So({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},tp.prototype.backfillBorder=function(t,e,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var n=e*this.dim,i=e*this.dim+this.dim,a=r*this.dim,o=r*this.dim+this.dim;switch(e){case-1:n=i-1;break;case 1:i=n+1;}switch(r){case-1:a=o-1;break;case 1:o=a+1;}for(var s=-e*this.dim,u=-r*this.dim,l=a;l<o;l++)for(var p=n;p<i;p++)this.data[this._idx(p,l)]=t.data[this._idx(p+s,l+u)];},Hn("DEMData",tp);var ep=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r;}};ep.prototype.encode=function(t){return this._stringToNumber[t]},ep.prototype.decode=function(t){return this._numberToString[t]};var rp=function(t,e,r,n,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=r,t._y=n,this.properties=t.properties,this.id=i;},np={geometry:{configurable:!0}};np.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},np.geometry.set=function(t){this._geometry=t;},rp.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(rp.prototype,np);var ip=function(){this.state={},this.stateChanges={},this.deletedStates={};};ip.prototype.updateState=function(t,e,r){var n=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},p(this.stateChanges[t][n],r),null===this.deletedStates[t])for(var i in this.deletedStates[t]={},this.state[t])i!==n&&(this.deletedStates[t][i]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][n])for(var a in this.deletedStates[t][n]={},this.state[t][n])r[a]||(this.deletedStates[t][n][a]=null);else for(var o in r)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][o]&&delete this.deletedStates[t][n][o];},ip.prototype.removeFeatureState=function(t,e,r){if(null!==this.deletedStates[t]){var n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},r&&void 0!==e)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][r]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][n])for(r in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][r]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null;}},ip.prototype.getState=function(t,e){var r=String(e),n=p({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(null===this.deletedStates[t])return {};if(this.deletedStates[t]){var i=this.deletedStates[t][e];if(null===i)return {};for(var a in i)delete n[a];}return n},ip.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e);},ip.prototype.coalesceChanges=function(t,e){var r={};for(var n in this.stateChanges){this.state[n]=this.state[n]||{};var i={};for(var a in this.stateChanges[n])this.state[n][a]||(this.state[n][a]={}),p(this.state[n][a],this.stateChanges[n][a]),i[a]=this.state[n][a];r[n]=i;}for(var o in this.deletedStates){this.state[o]=this.state[o]||{};var s={};if(null===this.deletedStates[o])for(var u in this.state[o])s[u]={},this.state[o][u]={};else for(var l in this.deletedStates[o]){if(null===this.deletedStates[o][l])this.state[o][l]={};else for(var c=0,h=Object.keys(this.deletedStates[o][l]);c<h.length;c+=1)delete this.state[o][l][h[c]];s[l]=this.state[o][l];}r[o]=r[o]||{},p(r[o],s);}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(var f in t)t[f].setFeatureState(r,e);};var ap=function(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Nn(ze,16,0),this.grid3D=new Nn(ze,16,0),this.featureIndexArray=new da,this.promoteId=e;};function op(t,e,r,n,i){return v(t,(function(t,a){var o=e instanceof Ii?e.get(a):null;return o&&o.evaluate?o.evaluate(r,n,i):o}))}function sp(t){for(var e=1/0,r=1/0,n=-1/0,i=-1/0,a=0,o=t;a<o.length;a+=1){var s=o[a];e=Math.min(e,s.x),r=Math.min(r,s.y),n=Math.max(n,s.x),i=Math.max(i,s.y);}return {minX:e,minY:r,maxX:n,maxY:i}}function up(t,e){return e-t}ap.prototype.insert=function(t,e,r,n,i,a){var o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i);for(var s=a?this.grid3D:this.grid,u=0;u<e.length;u++){for(var l=e[u],p=[1/0,1/0,-1/0,-1/0],c=0;c<l.length;c++){var h=l[c];p[0]=Math.min(p[0],h.x),p[1]=Math.min(p[1],h.y),p[2]=Math.max(p[2],h.x),p[3]=Math.max(p[3],h.y);}p[0]<ze&&p[1]<ze&&p[2]>=0&&p[3]>=0&&s.insert(o,p[0],p[1],p[2],p[3]);}},ap.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new ks.VectorTile(new eu(this.rawTileData)).layers,this.sourceLayerCoder=new ep(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ap.prototype.query=function(t,e,r,n){var a=this;this.loadVTLayers();for(var o=t.params||{},s=ze/t.tileSize/t.scale,u=mn(o.filter),l=t.queryGeometry,p=t.queryPadding*s,c=sp(l),h=this.grid.query(c.minX-p,c.minY-p,c.maxX+p,c.maxY+p),f=sp(t.cameraQueryGeometry),y=this.grid3D.query(f.minX-p,f.minY-p,f.maxX+p,f.maxY+p,(function(e,r,n,a){return function(t,e,r,n,a){for(var o=0,s=t;o<s.length;o+=1){var u=s[o];if(e<=u.x&&r<=u.y&&n>=u.x&&a>=u.y)return !0}var l=[new i(e,r),new i(e,a),new i(n,a),new i(n,r)];if(t.length>2)for(var p=0,c=l;p<c.length;p+=1)if(oo(t,c[p]))return !0;for(var h=0;h<t.length-1;h++)if(so(t[h],t[h+1],l))return !0;return !1}(t.cameraQueryGeometry,e-p,r-p,n+p,a+p)})),d=0,m=y;d<m.length;d+=1)h.push(m[d]);h.sort(up);for(var v,g={},x=function(i){var p=h[i];if(p!==v){v=p;var c=a.featureIndexArray.get(p),f=null;a.loadMatchingFeature(g,c.bucketIndex,c.sourceLayerIndex,c.featureIndex,u,o.layers,o.availableImages,e,r,n,(function(e,r,n){return f||(f=Ja(e)),r.queryIntersectsFeature(l,e,n,f,a.z,t.transform,s,t.pixelPosMatrix)}));}},b=0;b<h.length;b++)x(b);return g},ap.prototype.loadMatchingFeature=function(t,e,r,n,i,a,o,s,u,l,p){var c=this.bucketLayerIDs[e];if(!a||function(t,e){for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return !0;return !1}(a,c)){var h=this.sourceLayerCoder.decode(r),f=this.vtLayers[h].feature(n);if(i.filter(new gi(this.tileID.overscaledZ),f))for(var y=this.getId(f,h),d=0;d<c.length;d++){var m=c[d];if(!(a&&a.indexOf(m)<0)){var v=s[m];if(v){var g={};void 0!==y&&l&&(g=l.getState(v.sourceLayer||"_geojsonTileLayer",y));var x=u[m];x.paint=op(x.paint,v.paint,f,g,o),x.layout=op(x.layout,v.layout,f,g,o);var b=!p||p(f,v,g);if(b){var w=new rp(f,this.z,this.x,this.y,y);w.layer=x;var _=t[m];void 0===_&&(_=t[m]=[]),_.push({featureIndex:n,feature:w,intersectionZ:b});}}}}}},ap.prototype.lookupSymbolFeatures=function(t,e,r,n,i,a,o,s){var u={};this.loadVTLayers();for(var l=mn(i),p=0,c=t;p<c.length;p+=1)this.loadMatchingFeature(u,r,n,c[p],l,a,o,s,e);return u},ap.prototype.hasLayer=function(t){for(var e=0,r=this.bucketLayerIDs;e<r.length;e+=1)for(var n=0,i=r[e];n<i.length;n+=1)if(t===i[n])return !0;return !1},ap.prototype.getId=function(t,e){var r=t.id;return this.promoteId&&"boolean"==typeof(r=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]])&&(r=Number(r)),r},Hn("FeatureIndex",ap,{omit:["rawTileData","sourceLayerCoder"]});var lp=function(t,e){this.tileID=t,this.uid=h(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading";};lp.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<D.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e);},lp.prototype.wasRequested=function(){return "errored"===this.state||"loaded"===this.state||"reloading"===this.state},lp.prototype.loadVectorData=function(t,e,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var n in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var r={};if(!e)return r;for(var n=function(){var t=a[i],n=t.layerIds.map((function(t){return e.getLayer(t)})).filter(Boolean);if(0!==n.length){t.layers=n,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map((function(t){return n.filter((function(e){return e.id===t}))[0]})));for(var o=0,s=n;o<s.length;o+=1)r[s[o].id]=t;}},i=0,a=t;i<a.length;i+=1)n();return r}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[n];if(i instanceof Tl){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0;}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var a in this.buckets){var o=this.buckets[a];if(o instanceof Tl&&o.hasRTLText){this.hasRTLText=!0,vi.isLoading()||vi.isLoaded()||"deferred"!==di()||mi();break}}for(var s in this.queryPadding=0,this.buckets){var u=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(s).queryRadius(u));}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage);}else this.collisionBoxArray=new sa;},lp.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded";},lp.prototype.getBucket=function(t){return this.buckets[t.id]},lp.prototype.upload=function(t){for(var e in this.buckets){var r=this.buckets[e];r.uploadPending()&&r.upload(t);}var n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Gl(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Gl(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null);},lp.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture);},lp.prototype.queryRenderedFeatures=function(t,e,r,n,i,a,o,s,u,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:n,cameraQueryGeometry:i,scale:a,tileSize:this.tileSize,pixelPosMatrix:l,transform:s,params:o,queryPadding:this.queryPadding*u},t,e,r):{}},lp.prototype.querySourceFeatures=function(t,e){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var n=r.loadVTLayers(),i=e?e.sourceLayer:"",a=n._geojsonTileLayer||n[i];if(a)for(var o=mn(e&&e.filter),s=this.tileID.canonical,u=s.z,l=s.x,p=s.y,c={z:u,x:l,y:p},h=0;h<a.length;h++){var f=a.feature(h);if(o.filter(new gi(this.tileID.overscaledZ),f)){var y=r.getId(f,i),d=new rp(f,u,l,p,y);d.tile=c,t.push(d);}}}},lp.prototype.hasData=function(){return "loaded"===this.state||"reloading"===this.state||"expired"===this.state},lp.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},lp.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var r=k(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"]);}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var n=Date.now(),i=!1;if(this.expirationTime>n)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{var a=this.expirationTime-e;a?this.expirationTime=n+Math.max(a,3e4):i=!0;}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0;}},lp.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},lp.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var r=this.latestFeatureIndex.loadVTLayers();for(var n in this.buckets)if(e.style.hasLayer(n)){var i=this.buckets[n],a=i.layers[0].sourceLayer||"_geojsonTileLayer",o=r[a],s=t[a];o&&s&&0!==Object.keys(s).length&&(i.update(s,o,this.imageAtlas&&this.imageAtlas.patternPositions||{}),e&&e.style&&(this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(n).queryRadius(i))));}}},lp.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},lp.prototype.symbolFadeFinished=function(){return !this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<D.now()},lp.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0;},lp.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=D.now()+t;},lp.prototype.setDependencies=function(t,e){for(var r={},n=0,i=e;n<i.length;n+=1)r[i[n]]=!0;this.dependencies[t]=r;},lp.prototype.hasDependency=function(t,e){for(var r=0,n=t;r<n.length;r+=1){var i=this.dependencies[n[r]];if(i)for(var a=0,o=e;a<o.length;a+=1)if(i[o[a]])return !0}return !1};var pp=self.performance,cp=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},pp.mark(this._marks.start);};cp.prototype.finish=function(){pp.mark(this._marks.end);var t=pp.getEntriesByName(this._marks.measure);return 0===t.length&&(pp.measure(this._marks.measure,this._marks.start,this._marks.end),t=pp.getEntriesByName(this._marks.measure),pp.clearMarks(this._marks.start),pp.clearMarks(this._marks.end),pp.clearMeasures(this._marks.measure)),t},t.Actor=Jl,t.AlphaImage=Ao,t.CanonicalTileID=Yl,t.CollisionBoxArray=sa,t.Color=$t,t.DEMData=tp,t.DataConstantProperty=zi,t.DictionaryCoder=ep,t.EXTENT=ze,t.ErrorEvent=It,t.EvaluationParameters=gi,t.Event=kt,t.Evented=zt,t.FeatureIndex=ap,t.FillBucket=hs,t.FillExtrusionBucket=Ms,t.ImageAtlas=Cu,t.ImagePosition=Iu,t.LineBucket=Os,t.LngLat=xe,t.LngLatBounds=ge,t.MercatorCoordinate=Ie,t.ONE_EM=Ws,t.OverscaledTileID=Wl,t.Point=i,t.Point$1=i,t.Properties=Pi,t.Protobuf=eu,t.RGBAImage=So,t.RequestManager=N,t.RequestPerformance=cp,t.ResourceType=yt,t.SegmentVector=va,t.SourceFeatureState=ip,t.StructArrayLayout1ui2=na,t.StructArrayLayout2i4=Oi,t.StructArrayLayout3ui6=ea,t.StructArrayLayout4i8=Ui,t.SymbolBucket=Tl,t.Texture=Gl,t.Tile=lp,t.Transitionable=wi,t.Uniform1f=Ta,t.Uniform1i=Ma,t.Uniform2f=Ea,t.Uniform3f=Pa,t.Uniform4f=Ba,t.UniformColor=Va,t.UniformMatrix4f=Da,t.UnwrappedTileID=$l,t.ValidationError=Mt,t.WritingMode=Mu,t.ZoomHistory=ei,t.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},t.addDynamicAttributes=Il,t.asyncAll=function(t,e,r){if(!t.length)return r(null,[]);var n=t.length,i=new Array(t.length),a=null;t.forEach((function(t,o){e(t,(function(t,e){t&&(a=t),i[o]=e,0==--n&&r(a,i);}));}));},t.bezier=o,t.bindAll=d,t.browser=D,t.cacheEntryPossiblyAdded=function(t){++ht>st&&(t.getActor().send("enforceCacheSizeLimit",ot),ht=0);},t.clamp=u,t.clearTileCache=function(t){var e=self.caches.delete(at);t&&e.catch(t).then((function(){return t()}));},t.clone=function(t){var e=new yo(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=x,t.clone$2=function(t){var e=new yo(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.config=L,t.create=function(){var t=new yo(16);return yo!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=function(){var t=new yo(9);return yo!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},t.create$2=function(){var t=new yo(4);return yo!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=rn,t.createLayout=Li,t.createStyleLayer=function(t){return "custom"===t.type?new Ol(t):new Ul[t.type](t)},t.cross=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2];return t[0]=i*u-a*s,t[1]=a*o-n*u,t[2]=n*s-i*o,t},t.deepEqual=function t(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return !1;for(var n=0;n<e.length;n++)if(!t(e[n],r[n]))return !1;return !0}if("object"==typeof e&&null!==e&&null!==r){if("object"!=typeof r)return !1;if(Object.keys(e).length!==Object.keys(r).length)return !1;for(var i in e)if(!t(e[i],r[i]))return !1;return !0}return e===r},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=s,t.emitValidationErrors=qn,t.endsWith=m,t.enforceCacheSizeLimit=function(t){lt(),W&&W.then((function(e){e.keys().then((function(r){for(var n=0;n<r.length-t;n++)e.delete(r[n]);}));}));},t.evaluateSizeForFeature=Zu,t.evaluateSizeForZoom=Ju,t.evaluateVariableOffset=ml,t.evented=yi,t.extend=p,t.featureFilter=mn,t.filterObject=g,t.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=ju,t.getAnchorJustification=vl,t.getArrayBuffer=bt,t.getImage=_t,t.getJSON=function(t,e){return xt(p(t,{type:"json"}),e)},t.getRTLTextPluginStatus=di,t.getReferrer=mt,t.getVideo=function(t,e){var r,n,i=self.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i);};for(var a=0;a<t.length;a++){var o=self.document.createElement("source");r=t[a],n=void 0,(n=self.document.createElement("a")).href=r,(n.protocol!==self.document.location.protocol||n.host!==self.document.location.host)&&(i.crossOrigin="Anonymous"),o.src=t[a],i.appendChild(o);}return {cancel:function(){}}},t.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.invert=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],p=e[8],c=e[9],h=e[10],f=e[11],y=e[12],d=e[13],m=e[14],v=e[15],g=r*s-n*o,x=r*u-i*o,b=r*l-a*o,w=n*u-i*s,_=n*l-a*s,A=i*l-a*u,S=p*d-c*y,k=p*m-h*y,I=p*v-f*y,z=c*m-h*d,C=c*v-f*d,M=h*v-f*m,T=g*M-x*C+b*z+w*I-_*k+A*S;return T?(t[0]=(s*M-u*C+l*z)*(T=1/T),t[1]=(i*C-n*M-a*z)*T,t[2]=(d*A-m*_+v*w)*T,t[3]=(h*_-c*A-f*w)*T,t[4]=(u*I-o*M-l*k)*T,t[5]=(r*M-i*I+a*k)*T,t[6]=(m*b-y*A-v*x)*T,t[7]=(p*A-h*b+f*x)*T,t[8]=(o*C-s*I+l*S)*T,t[9]=(n*I-r*C-a*S)*T,t[10]=(y*_-d*b+v*g)*T,t[11]=(c*b-p*_-f*g)*T,t[12]=(s*k-o*z-u*S)*T,t[13]=(r*z-n*k+i*S)*T,t[14]=(d*x-y*w-m*g)*T,t[15]=(p*w-c*x+h*g)*T,t):null},t.isChar=ri,t.isMapboxURL=K,t.keysDifference=function(t,e){var r=[];for(var n in t)n in e||r.push(n);return r},t.makeRequest=xt,t.mapObject=v,t.mercatorXfromLng=_e,t.mercatorYfromLat=Ae,t.mercatorZfromAltitude=Se,t.multiply=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],p=e[7],c=e[8],h=e[9],f=e[10],y=e[11],d=e[12],m=e[13],v=e[14],g=e[15],x=r[0],b=r[1],w=r[2],_=r[3];return t[0]=x*n+b*s+w*c+_*d,t[1]=x*i+b*u+w*h+_*m,t[2]=x*a+b*l+w*f+_*v,t[3]=x*o+b*p+w*y+_*g,t[4]=(x=r[4])*n+(b=r[5])*s+(w=r[6])*c+(_=r[7])*d,t[5]=x*i+b*u+w*h+_*m,t[6]=x*a+b*l+w*f+_*v,t[7]=x*o+b*p+w*y+_*g,t[8]=(x=r[8])*n+(b=r[9])*s+(w=r[10])*c+(_=r[11])*d,t[9]=x*i+b*u+w*h+_*m,t[10]=x*a+b*l+w*f+_*v,t[11]=x*o+b*p+w*y+_*g,t[12]=(x=r[12])*n+(b=r[13])*s+(w=r[14])*c+(_=r[15])*d,t[13]=x*i+b*u+w*h+_*m,t[14]=x*a+b*l+w*f+_*v,t[15]=x*o+b*p+w*y+_*g,t},t.mvt=ks,t.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t},t.number=Ye,t.offscreenCanvasSupported=ft,t.ortho=function(t,e,r,n,i,a,o){var s=1/(e-r),u=1/(n-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(o+a)*l,t[15]=1,t},t.parseGlyphPBF=function(t){return new eu(t).readFields(bu,[])},t.pbf=eu,t.performSymbolLayout=function(t,e,r,n,a,o,s){t.createArrays(),t.tilePixelRatio=ze/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var u=t.layers[0].layout,l=t.layers[0]._unevaluatedLayout._values,p={};if("composite"===t.textSizeData.kind){var c=t.textSizeData,h=c.maxZoom;p.compositeTextSizes=[l["text-size"].possiblyEvaluate(new gi(c.minZoom),s),l["text-size"].possiblyEvaluate(new gi(h),s)];}if("composite"===t.iconSizeData.kind){var f=t.iconSizeData,y=f.maxZoom;p.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new gi(f.minZoom),s),l["icon-size"].possiblyEvaluate(new gi(y),s)];}p.layoutTextSize=l["text-size"].possiblyEvaluate(new gi(t.zoom+1),s),p.layoutIconSize=l["icon-size"].possiblyEvaluate(new gi(t.zoom+1),s),p.textMaxSize=l["text-size"].possiblyEvaluate(new gi(18));for(var d=u.get("text-line-height")*Ws,m="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement"),v=u.get("text-keep-upright"),g=u.get("text-size"),x=function(){var o=_[b],l=u.get("text-font").evaluate(o,{},s).join(","),c=g.evaluate(o,{},s),h=p.layoutTextSize.evaluate(o,{},s),f=p.layoutIconSize.evaluate(o,{},s),y={horizontal:{},vertical:void 0},x=o.text,A=[0,0];if(x){var S=x.toString(),k=u.get("text-letter-spacing").evaluate(o,{},s)*Ws,I=function(t){for(var e=0,r=t;e<r.length;e+=1)if(n=r[e].charCodeAt(0),ri.Arabic(n)||ri["Arabic Supplement"](n)||ri["Arabic Extended-A"](n)||ri["Arabic Presentation Forms-A"](n)||ri["Arabic Presentation Forms-B"](n))return !1;var n;return !0}(S)?k:0,z=u.get("text-anchor").evaluate(o,{},s),C=u.get("text-variable-anchor");if(!C){var M=u.get("text-radial-offset").evaluate(o,{},s);A=M?ml(z,[M*Ws,dl]):u.get("text-offset").evaluate(o,{},s).map((function(t){return t*Ws}));}var T=m?"center":u.get("text-justify").evaluate(o,{},s),E=u.get("symbol-placement"),P="point"===E?u.get("text-max-width").evaluate(o,{},s)*Ws:0,B=function(){t.allowVerticalPlacement&&ni(S)&&(y.vertical=Bu(x,e,r,a,l,P,d,z,"left",I,A,Mu.vertical,!0,E,h,c));};if(!m&&C){for(var V="auto"===T?C.map((function(t){return vl(t)})):[T],F=!1,D=0;D<V.length;D++){var L=V[D];if(!y.horizontal[L])if(F)y.horizontal[L]=y.horizontal[0];else{var R=Bu(x,e,r,a,l,P,d,"center",L,I,A,Mu.horizontal,!1,E,h,c);R&&(y.horizontal[L]=R,F=1===R.positionedLines.length);}}B();}else{"auto"===T&&(T=vl(z));var O=Bu(x,e,r,a,l,P,d,z,T,I,A,Mu.horizontal,!1,E,h,c);O&&(y.horizontal[T]=O),B(),ni(S)&&m&&v&&(y.vertical=Bu(x,e,r,a,l,P,d,z,T,I,A,Mu.vertical,!1,E,h,c));}}var U=void 0,j=!1;if(o.icon&&o.icon.name){var q=n[o.icon.name];q&&(U=function(t,e,r){var n=ju(r),i=e[0]-t.displaySize[0]*n.horizontalAlign,a=e[1]-t.displaySize[1]*n.verticalAlign;return {image:t,top:a,bottom:a+t.displaySize[1],left:i,right:i+t.displaySize[0]}}(a[o.icon.name],u.get("icon-offset").evaluate(o,{},s),u.get("icon-anchor").evaluate(o,{},s)),j=q.sdf,void 0===t.sdfIcons?t.sdfIcons=q.sdf:t.sdfIcons!==q.sdf&&w("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),q.pixelRatio!==t.pixelRatio?t.iconsNeedLinear=!0:0!==u.get("icon-rotate").constantOr(1)&&(t.iconsNeedLinear=!0));}var N=wl(y.horizontal)||y.vertical;t.iconsInText=!!N&&N.iconsInText,(N||U)&&function(t,e,r,n,a,o,s,u,l,p,c){var h=o.textMaxSize.evaluate(e,{});void 0===h&&(h=s);var f,y=t.layers[0].layout,d=y.get("icon-offset").evaluate(e,{},c),m=wl(r.horizontal),v=s/24,g=t.tilePixelRatio*v,x=t.tilePixelRatio*h/24,b=t.tilePixelRatio*u,_=t.tilePixelRatio*y.get("symbol-spacing"),A=y.get("text-padding")*t.tilePixelRatio,S=y.get("icon-padding")*t.tilePixelRatio,k=y.get("text-max-angle")/180*Math.PI,I="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement"),z="map"===y.get("icon-rotation-alignment")&&"point"!==y.get("symbol-placement"),C=y.get("symbol-placement"),M=_/2,T=y.get("icon-text-fit");n&&"none"!==T&&(t.allowVerticalPlacement&&r.vertical&&(f=Nu(n,r.vertical,T,y.get("icon-text-fit-padding"),d,v)),m&&(n=Nu(n,m,T,y.get("icon-text-fit-padding"),d,v)));var E=function(i,s){s.x<0||s.x>=ze||s.y<0||s.y>=ze||function(t,e,r,n,i,a,o,s,u,l,p,c,h,f,y,d,m,v,g,x,b,_,A,S){var k,I,z,C,M,T=t.addToLineVertexArray(e,r),E=0,P=0,B=0,V=0,F=-1,D=-1,L={},R=_a(""),O=0,U=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(O=(k=s.layout.get("text-offset").evaluate(b,{},S).map((function(t){return t*Ws})))[0],U=k[1]):(O=s.layout.get("text-radial-offset").evaluate(b,{},S)*Ws,U=dl),t.allowVerticalPlacement&&n.vertical){var j=s.layout.get("text-rotate").evaluate(b,{},S)+90;C=new ul(u,r,e,l,p,c,n.vertical,h,f,y,t.overscaling,j),o&&(M=new ul(u,r,e,l,p,c,o,m,v,y,t.overscaling,j));}if(i){var q=s.layout.get("icon-rotate").evaluate(b,{}),N="none"!==s.layout.get("icon-text-fit"),K=nl(i,q,A,N),X=o?nl(o,q,A,N):void 0;z=new ul(u,r,e,l,p,c,i,m,v,!1,t.overscaling,q),E=4*K.length;var G=t.iconSizeData,Z=null;"source"===G.kind?(Z=[Xu*s.layout.get("icon-size").evaluate(b,{})])[0]>xl&&w(t.layerIds[0]+': Value for "icon-size" is >= '+gl+'. Reduce your "icon-size".'):"composite"===G.kind&&((Z=[Xu*_.compositeIconSizes[0].evaluate(b,{},S),Xu*_.compositeIconSizes[1].evaluate(b,{},S)])[0]>xl||Z[1]>xl)&&w(t.layerIds[0]+': Value for "icon-size" is >= '+gl+'. Reduce your "icon-size".'),t.addSymbols(t.icon,K,Z,x,g,b,!1,e,T.lineStartIndex,T.lineLength,-1,S),F=t.icon.placedSymbolArray.length-1,X&&(P=4*X.length,t.addSymbols(t.icon,X,Z,x,g,b,Mu.vertical,e,T.lineStartIndex,T.lineLength,-1,S),D=t.icon.placedSymbolArray.length-1);}for(var J in n.horizontal){var H=n.horizontal[J];if(!I){R=_a(H.text);var Y=s.layout.get("text-rotate").evaluate(b,{},S);I=new ul(u,r,e,l,p,c,H,h,f,y,t.overscaling,Y);}var $=1===H.positionedLines.length;if(B+=bl(t,e,H,a,s,y,b,d,T,n.vertical?Mu.horizontal:Mu.horizontalOnly,$?Object.keys(n.horizontal):[J],L,F,_,S),$)break}n.vertical&&(V+=bl(t,e,n.vertical,a,s,y,b,d,T,Mu.vertical,["vertical"],L,D,_,S));var W=I?I.boxStartIndex:t.collisionBoxArray.length,Q=I?I.boxEndIndex:t.collisionBoxArray.length,tt=C?C.boxStartIndex:t.collisionBoxArray.length,et=C?C.boxEndIndex:t.collisionBoxArray.length,rt=z?z.boxStartIndex:t.collisionBoxArray.length,nt=z?z.boxEndIndex:t.collisionBoxArray.length,it=M?M.boxStartIndex:t.collisionBoxArray.length,at=M?M.boxEndIndex:t.collisionBoxArray.length;t.glyphOffsetArray.length>=Tl.MAX_GLYPHS&&w("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,b.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,L.right>=0?L.right:-1,L.center>=0?L.center:-1,L.left>=0?L.left:-1,L.vertical||-1,F,D,R,W,Q,tt,et,rt,nt,it,at,l,B,V,E,P,0,h,O,U);}(t,s,i,r,n,a,f,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,g,A,I,l,b,S,z,d,e,o,p,c);};if("line"===C)for(var P=0,B=function(t,e,r,n,a){for(var o=[],s=0;s<t.length;s++)for(var u=t[s],l=void 0,p=0;p<u.length-1;p++){var c=u[p],h=u[p+1];c.x<0&&h.x<0||(c.x<0?c=new i(0,c.y+(0-c.x)/(h.x-c.x)*(h.y-c.y))._round():h.x<0&&(h=new i(0,c.y+(0-c.x)/(h.x-c.x)*(h.y-c.y))._round()),c.y<0&&h.y<0||(c.y<0?c=new i(c.x+(0-c.y)/(h.y-c.y)*(h.x-c.x),0)._round():h.y<0&&(h=new i(c.x+(0-c.y)/(h.y-c.y)*(h.x-c.x),0)._round()),c.x>=n&&h.x>=n||(c.x>=n?c=new i(n,c.y+(n-c.x)/(h.x-c.x)*(h.y-c.y))._round():h.x>=n&&(h=new i(n,c.y+(n-c.x)/(h.x-c.x)*(h.y-c.y))._round()),c.y>=a&&h.y>=a||(c.y>=a?c=new i(c.x+(a-c.y)/(h.y-c.y)*(h.x-c.x),a)._round():h.y>=a&&(h=new i(c.x+(a-c.y)/(h.y-c.y)*(h.x-c.x),a)._round()),l&&c.equals(l[l.length-1])||o.push(l=[c]),l.push(h)))));}return o}(e.geometry,0,0,ze,ze);P<B.length;P+=1)for(var V=B[P],F=0,D=el(V,_,k,r.vertical||m,n,24,x,t.overscaling,ze);F<D.length;F+=1){var L=D[F];m&&_l(t,m.text,M,L)||E(V,L);}else if("line-center"===C)for(var R=0,O=e.geometry;R<O.length;R+=1){var U=O[R];if(U.length>1){var j=tl(U,k,r.vertical||m,n,24,x);j&&E(U,j);}}else if("Polygon"===e.type)for(var q=0,N=us(e.geometry,0);q<N.length;q+=1){var K=N[q],X=cl(K,16);E(K[0],new Ku(X.x,X.y,0));}else if("LineString"===e.type)for(var G=0,Z=e.geometry;G<Z.length;G+=1){var J=Z[G];E(J,new Ku(J[0].x,J[0].y,0));}else if("Point"===e.type)for(var H=0,Y=e.geometry;H<Y.length;H+=1)for(var $=0,W=Y[H];$<W.length;$+=1){var Q=W[$];E([Q],new Ku(Q.x,Q.y,0));}}(t,o,y,U,n,p,h,f,A,j,s);},b=0,_=t.features;b<_.length;b+=1)x();o&&t.generateCollisionDebugBuffers();},t.perspective=function(t,e,r,n,i){var a,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+n)*(a=1/(n-i)),t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t},t.pick=function(t,e){for(var r={},n=0;n<e.length;n++){var i=e[n];i in t&&(r[i]=t[i]);}return r},t.plugin=vi,t.polygonIntersectsPolygon=$a,t.postMapLoadEvent=it,t.postTurnstileEvent=rt,t.potpack=Su,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=Hn,t.registerForPluginStateChange=function(t){return t({pluginStatus:pi,pluginURL:ci}),yi.on("pluginStateChange",t),t},t.rotate=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+a*s,t[1]=i*u+o*s,t[2]=n*-s+a*u,t[3]=i*-s+o*u,t},t.rotateX=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],p=e[9],c=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+l*n,t[5]=o*i+p*n,t[6]=s*i+c*n,t[7]=u*i+h*n,t[8]=l*i-a*n,t[9]=p*i-o*n,t[10]=c*i-s*n,t[11]=h*i-u*n,t},t.rotateZ=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],p=e[5],c=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+l*n,t[1]=o*i+p*n,t[2]=s*i+c*n,t[3]=u*i+h*n,t[4]=l*i-a*n,t[5]=p*i-o*n,t[6]=c*i-s*n,t[7]=h*i-u*n,t},t.scale=function(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},t.scale$2=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},t.setCacheLimits=function(t,e){ot=t,st=e;},t.setRTLTextPlugin=function(t,e,r){if(void 0===r&&(r=!1),"deferred"===pi||"loading"===pi||"loaded"===pi)throw new Error("setRTLTextPlugin cannot be called multiple times.");ci=D.resolveURL(t),pi="deferred",li=e,fi(),r||mi();},t.sphericalToCartesian=function(t){var e=t[0],r=t[1],n=t[2];return r+=90,r*=Math.PI/180,n*=Math.PI/180,{x:e*Math.cos(r)*Math.sin(n),y:e*Math.sin(r)*Math.sin(n),z:e*Math.cos(n)}},t.sqrLen=function(t){var e=t[0],r=t[1];return e*e+r*r},t.styleSpec=Ct,t.sub=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},t.symbolSize=Hu,t.transformMat3=function(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=n*r[0]+i*r[3]+a*r[6],t[1]=n*r[1]+i*r[4]+a*r[7],t[2]=n*r[2]+i*r[5]+a*r[8],t},t.transformMat4=mo,t.translate=function(t,e,r){var n,i,a,o,s,u,l,p,c,h,f,y,d=r[0],m=r[1],v=r[2];return e===t?(t[12]=e[0]*d+e[4]*m+e[8]*v+e[12],t[13]=e[1]*d+e[5]*m+e[9]*v+e[13],t[14]=e[2]*d+e[6]*m+e[10]*v+e[14],t[15]=e[3]*d+e[7]*m+e[11]*v+e[15]):(i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],p=e[7],c=e[8],h=e[9],f=e[10],y=e[11],t[0]=n=e[0],t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=p,t[8]=c,t[9]=h,t[10]=f,t[11]=y,t[12]=n*d+s*m+c*v+e[12],t[13]=i*d+u*m+h*v+e[13],t[14]=a*d+l*m+f*v+e[14],t[15]=o*d+p*m+y*v+e[15]),t},t.triggerPluginCompletionEvent=hi,t.uniqueId=h,t.validateCustomStyleLayer=function(t){var e=[],r=t.id;return void 0===r&&e.push({message:"layers."+r+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+r+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=On,t.validateStyle=Rn,t.values=function(t){var e=[];for(var r in t)e.push(t[r]);return e},t.vectorTile=ks,t.version="1.9.1",t.warnOnce=w,t.webpSupported=R,t.window=self,t.wrap=l;}));

define(["./shared"],(function(e){"use strict";function t(e){var r=typeof e;if("number"===r||"boolean"===r||"string"===r||null==e)return JSON.stringify(e);if(Array.isArray(e)){for(var i="[",o=0,n=e;o<n.length;o+=1)i+=t(n[o])+",";return i+"]"}for(var a=Object.keys(e).sort(),s="{",l=0;l<a.length;l++)s+=JSON.stringify(a[l])+":"+t(e[a[l]])+",";return s+"}"}function r(r){for(var i="",o=0,n=e.refProperties;o<n.length;o+=1)i+="/"+t(r[n[o]]);return i}var i=function(e){this.keyCache={},e&&this.replace(e);};i.prototype.replace=function(e){this._layerConfigs={},this._layers={},this.update(e,[]);},i.prototype.update=function(t,i){for(var o=this,n=0,a=t;n<a.length;n+=1){var s=a[n];this._layerConfigs[s.id]=s;var l=this._layers[s.id]=e.createStyleLayer(s);l._featureFilter=e.featureFilter(l.filter),this.keyCache[s.id]&&delete this.keyCache[s.id];}for(var u=0,h=i;u<h.length;u+=1){var c=h[u];delete this.keyCache[c],delete this._layerConfigs[c],delete this._layers[c];}this.familiesBySource={};for(var p=0,f=function(e,t){for(var i={},o=0;o<e.length;o++){var n=t&&t[e[o].id]||r(e[o]);t&&(t[e[o].id]=n);var a=i[n];a||(a=i[n]=[]),a.push(e[o]);}var s=[];for(var l in i)s.push(i[l]);return s}(e.values(this._layerConfigs),this.keyCache);p<f.length;p+=1){var d=f[p].map((function(e){return o._layers[e.id]})),g=d[0];if("none"!==g.visibility){var m=g.source||"",v=this.familiesBySource[m];v||(v=this.familiesBySource[m]={});var y=g.sourceLayer||"_geojsonTileLayer",x=v[y];x||(x=v[y]=[]),x.push(d);}}};var o=function(t){var r={},i=[];for(var o in t){var n=t[o],a=r[o]={};for(var s in n){var l=n[+s];if(l&&0!==l.bitmap.width&&0!==l.bitmap.height){var u={x:0,y:0,w:l.bitmap.width+2,h:l.bitmap.height+2};i.push(u),a[s]={rect:u,metrics:l.metrics};}}}var h=e.potpack(i),c=new e.AlphaImage({width:h.w||1,height:h.h||1});for(var p in t){var f=t[p];for(var d in f){var g=f[+d];if(g&&0!==g.bitmap.width&&0!==g.bitmap.height){var m=r[p][d].rect;e.AlphaImage.copy(g.bitmap,c,{x:0,y:0},{x:m.x+1,y:m.y+1},g.bitmap);}}}this.image=c,this.positions=r;};e.register("GlyphAtlas",o);var n=function(t){this.tileID=new e.OverscaledTileID(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId;};function a(t,r,i){for(var o=new e.EvaluationParameters(r),n=0,a=t;n<a.length;n+=1)a[n].recalculate(o,i);}function s(t,r){var i=e.getArrayBuffer(t.request,(function(t,i,o,n){t?r(t):i&&r(null,{vectorTile:new e.vectorTile.VectorTile(new e.pbf(i)),rawData:i,cacheControl:o,expires:n});}));return function(){i.cancel(),r();}}n.prototype.parse=function(t,r,i,n,s){var l=this;this.status="parsing",this.data=t,this.collisionBoxArray=new e.CollisionBoxArray;var u=new e.DictionaryCoder(Object.keys(t.layers).sort()),h=new e.FeatureIndex(this.tileID,this.promoteId);h.bucketLayerIDs=[];var c,p,f,d,g={},m={featureIndex:h,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:i},v=r.familiesBySource[this.source];for(var y in v){var x=t.layers[y];if(x){1===x.version&&e.warnOnce('Vector tile source "'+this.source+'" layer "'+y+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var w=u.encode(y),S=[],I=0;I<x.length;I++){var M=x.feature(I),b=h.getId(M,y);S.push({feature:M,id:b,index:I,sourceLayerIndex:w});}for(var P=0,_=v[y];P<_.length;P+=1){var k=_[P],T=k[0];T.minzoom&&this.zoom<Math.floor(T.minzoom)||T.maxzoom&&this.zoom>=T.maxzoom||"none"!==T.visibility&&(a(k,this.zoom,i),(g[T.id]=T.createBucket({index:h.bucketLayerIDs.length,layers:k,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:w,sourceID:this.source})).populate(S,m,this.tileID.canonical),h.bucketLayerIDs.push(k.map((function(e){return e.id}))));}}}var C=e.mapObject(m.glyphDependencies,(function(e){return Object.keys(e).map(Number)}));Object.keys(C).length?n.send("getGlyphs",{uid:this.uid,stacks:C},(function(e,t){c||(c=e,p=t,O.call(l));})):p={};var D=Object.keys(m.iconDependencies);D.length?n.send("getImages",{icons:D,source:this.source,tileID:this.tileID,type:"icons"},(function(e,t){c||(c=e,f=t,O.call(l));})):f={};var L=Object.keys(m.patternDependencies);function O(){if(c)return s(c);if(p&&f&&d){var t=new o(p),r=new e.ImageAtlas(f,d);for(var n in g){var l=g[n];l instanceof e.SymbolBucket?(a(l.layers,this.zoom,i),e.performSymbolLayout(l,p,t.positions,f,r.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):l.hasPattern&&(l instanceof e.LineBucket||l instanceof e.FillBucket||l instanceof e.FillExtrusionBucket)&&(a(l.layers,this.zoom,i),l.addFeatures(m,this.tileID.canonical,r.patternPositions));}this.status="done",s(null,{buckets:e.values(g).filter((function(e){return !e.isEmpty()})),featureIndex:h,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,imageAtlas:r,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?t.positions:null});}}L.length?n.send("getImages",{icons:L,source:this.source,tileID:this.tileID,type:"patterns"},(function(e,t){c||(c=e,d=t,O.call(l));})):d={},O.call(this);};var l=function(e,t,r,i){this.actor=e,this.layerIndex=t,this.availableImages=r,this.loadVectorData=i||s,this.loading={},this.loaded={};};l.prototype.loadTile=function(t,r){var i=this,o=t.uid;this.loading||(this.loading={});var a=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.RequestPerformance(t.request),s=this.loading[o]=new n(t);s.abort=this.loadVectorData(t,(function(t,n){if(delete i.loading[o],t||!n)return s.status="done",i.loaded[o]=s,r(t);var l=n.rawData,u={};n.expires&&(u.expires=n.expires),n.cacheControl&&(u.cacheControl=n.cacheControl);var h={};if(a){var c=a.finish();c&&(h.resourceTiming=JSON.parse(JSON.stringify(c)));}s.vectorTile=n.vectorTile,s.parse(n.vectorTile,i.layerIndex,i.availableImages,i.actor,(function(t,i){if(t||!i)return r(t);r(null,e.extend({rawTileData:l.slice(0)},i,u,h));})),i.loaded=i.loaded||{},i.loaded[o]=s;}));},l.prototype.reloadTile=function(e,t){var r=this,i=this.loaded,o=e.uid,n=this;if(i&&i[o]){var a=i[o];a.showCollisionBoxes=e.showCollisionBoxes;var s=function(e,i){var o=a.reloadCallback;o&&(delete a.reloadCallback,a.parse(a.vectorTile,n.layerIndex,r.availableImages,n.actor,o)),t(e,i);};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s());}},l.prototype.abortTile=function(e,t){var r=this.loading,i=e.uid;r&&r[i]&&r[i].abort&&(r[i].abort(),delete r[i]),t();},l.prototype.removeTile=function(e,t){var r=this.loaded,i=e.uid;r&&r[i]&&delete r[i],t();};var u=e.window.ImageBitmap,h=function(){this.loaded={};};h.prototype.loadTile=function(t,r){var i=t.uid,o=t.encoding,n=t.rawImageData,a=u&&n instanceof u?this.getImageData(n):n,s=new e.DEMData(i,a,o);this.loaded=this.loaded||{},this.loaded[i]=s,r(null,s);},h.prototype.getImageData=function(t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);var r=this.offscreenCanvasContext.getImageData(-1,-1,t.width+2,t.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new e.RGBAImage({width:r.width,height:r.height},r.data)},h.prototype.removeTile=function(e){var t=this.loaded,r=e.uid;t&&t[r]&&delete t[r];};var c={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function p(e){var t=0;if(e&&e.length>0){t+=Math.abs(f(e[0]));for(var r=1;r<e.length;r++)t-=Math.abs(f(e[r]));}return t}function f(e){var t,r,i,o,n,a,s=0,l=e.length;if(l>2){for(a=0;a<l;a++)a===l-2?(i=l-2,o=l-1,n=0):a===l-1?(i=l-1,o=0,n=1):(i=a,o=a+1,n=a+2),t=e[i],r=e[o],s+=(d(e[n][0])-d(t[0]))*Math.sin(d(r[1]));s=s*c.RADIUS*c.RADIUS/2;}return s}function d(e){return e*Math.PI/180}var g={geometry:function e(t){var r,i=0;switch(t.type){case"Polygon":return p(t.coordinates);case"MultiPolygon":for(r=0;r<t.coordinates.length;r++)i+=p(t.coordinates[r]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<t.geometries.length;r++)i+=e(t.geometries[r]);return i}},ring:f};function m(e,t){return function(r){return e(r,t)}}function v(e,t){e[0]=y(e[0],t=!!t);for(var r=1;r<e.length;r++)e[r]=y(e[r],!t);return e}function y(e,t){return function(e){return g.ring(e)>=0}(e)===t?e:e.reverse()}var x=e.vectorTile.VectorTileFeature.prototype.toGeoJSON,w=function(t){this._feature=t,this.extent=e.EXTENT,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10));};w.prototype.loadGeometry=function(){if(1===this._feature.type){for(var t=[],r=0,i=this._feature.geometry;r<i.length;r+=1){var o=i[r];t.push([new e.Point$1(o[0],o[1])]);}return t}for(var n=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var l=[],u=0,h=s[a];u<h.length;u+=1){var c=h[u];l.push(new e.Point$1(c[0],c[1]));}n.push(l);}return n},w.prototype.toGeoJSON=function(e,t,r){return x.call(this,e,t,r)};var S=function(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.EXTENT,this.length=t.length,this._features=t;};S.prototype.feature=function(e){return new w(this._features[e])};var I=e.vectorTile.VectorTileFeature,M=b;function b(e,t){this.options=t||{},this.features=e,this.length=e.length;}function P(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096;}b.prototype.feature=function(e){return new P(this.features[e],this.options.extent)},P.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var r=0;r<t.length;r++){for(var i=t[r],o=[],n=0;n<i.length;n++)o.push(new e.Point$1(i[n][0],i[n][1]));this.geometry.push(o);}return this.geometry},P.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,i=1/0,o=-1/0,n=0;n<e.length;n++)for(var a=e[n],s=0;s<a.length;s++){var l=a[s];t=Math.min(t,l.x),r=Math.max(r,l.x),i=Math.min(i,l.y),o=Math.max(o,l.y);}return [t,i,r,o]},P.prototype.toGeoJSON=I.prototype.toGeoJSON;var _=T,k=M;function T(t){var r=new e.pbf;return function(e,t){for(var r in e.layers)t.writeMessage(3,C,e.layers[r]);}(t,r),r.finish()}function C(e,t){var r;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<e.length;r++)i.feature=e.feature(r),t.writeMessage(2,D,i);var o=i.keys;for(r=0;r<o.length;r++)t.writeStringField(3,o[r]);var n=i.values;for(r=0;r<n.length;r++)t.writeMessage(4,N,n[r]);}function D(e,t){var r=e.feature;void 0!==r.id&&t.writeVarintField(1,r.id),t.writeMessage(2,L,e),t.writeVarintField(3,r.type),t.writeMessage(4,E,r);}function L(e,t){var r=e.feature,i=e.keys,o=e.values,n=e.keycache,a=e.valuecache;for(var s in r.properties){var l=n[s];void 0===l&&(i.push(s),n[s]=l=i.length-1),t.writeVarint(l);var u=r.properties[s],h=typeof u;"string"!==h&&"boolean"!==h&&"number"!==h&&(u=JSON.stringify(u));var c=h+":"+u,p=a[c];void 0===p&&(o.push(u),a[c]=p=o.length-1),t.writeVarint(p);}}function O(e,t){return (t<<3)+(7&e)}function z(e){return e<<1^e>>31}function E(e,t){for(var r=e.loadGeometry(),i=e.type,o=0,n=0,a=r.length,s=0;s<a;s++){var l=r[s],u=1;1===i&&(u=l.length),t.writeVarint(O(1,u));for(var h=3===i?l.length-1:l.length,c=0;c<h;c++){1===c&&1!==i&&t.writeVarint(O(2,h-1));var p=l[c].x-o,f=l[c].y-n;t.writeVarint(z(p)),t.writeVarint(z(f)),o+=p,n+=f;}3===i&&t.writeVarint(O(7,1));}}function N(e,t){var r=typeof e;"string"===r?t.writeStringField(1,e):"boolean"===r?t.writeBooleanField(7,e):"number"===r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e));}function F(e,t,r,i){A(e,r,i),A(t,2*r,2*i),A(t,2*r+1,2*i+1);}function A(e,t,r){var i=e[t];e[t]=e[r],e[r]=i;}function J(e,t,r,i){var o=e-r,n=t-i;return o*o+n*n}_.fromVectorTileJs=T,_.fromGeojsonVt=function(e,t){t=t||{};var r={};for(var i in e)r[i]=new M(e[i].features,t),r[i].name=i,r[i].version=t.version,r[i].extent=t.extent;return T({layers:r})},_.GeoJSONWrapper=k;var Z=function(e){return e[0]},B=function(e){return e[1]},G=function(e,t,r,i,o){void 0===t&&(t=Z),void 0===r&&(r=B),void 0===i&&(i=64),void 0===o&&(o=Float64Array),this.nodeSize=i,this.points=e;for(var n=e.length<65536?Uint16Array:Uint32Array,a=this.ids=new n(e.length),s=this.coords=new o(2*e.length),l=0;l<e.length;l++)a[l]=l,s[2*l]=t(e[l]),s[2*l+1]=r(e[l]);!function e(t,r,i,o,n,a){if(!(n-o<=i)){var s=o+n>>1;!function e(t,r,i,o,n,a){for(;n>o;){if(n-o>600){var s=n-o+1,l=i-o+1,u=Math.log(s),h=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*h*(s-h)/s)*(l-s/2<0?-1:1);e(t,r,i,Math.max(o,Math.floor(i-l*h/s+c)),Math.min(n,Math.floor(i+(s-l)*h/s+c)),a);}var p=r[2*i+a],f=o,d=n;for(F(t,r,o,i),r[2*n+a]>p&&F(t,r,o,n);f<d;){for(F(t,r,f,d),f++,d--;r[2*f+a]<p;)f++;for(;r[2*d+a]>p;)d--;}r[2*o+a]===p?F(t,r,o,d):F(t,r,++d,n),d<=i&&(o=d+1),i<=d&&(n=d-1);}}(t,r,s,o,n,a%2),e(t,r,i,o,s-1,a+1),e(t,r,i,s+1,n,a+1);}}(a,s,i,0,a.length-1,0);};G.prototype.range=function(e,t,r,i){return function(e,t,r,i,o,n,a){for(var s,l,u=[0,e.length-1,0],h=[];u.length;){var c=u.pop(),p=u.pop(),f=u.pop();if(p-f<=a)for(var d=f;d<=p;d++)l=t[2*d+1],(s=t[2*d])>=r&&s<=o&&l>=i&&l<=n&&h.push(e[d]);else{var g=Math.floor((f+p)/2);l=t[2*g+1],(s=t[2*g])>=r&&s<=o&&l>=i&&l<=n&&h.push(e[g]);var m=(c+1)%2;(0===c?r<=s:i<=l)&&(u.push(f),u.push(g-1),u.push(m)),(0===c?o>=s:n>=l)&&(u.push(g+1),u.push(p),u.push(m));}}return h}(this.ids,this.coords,e,t,r,i,this.nodeSize)},G.prototype.within=function(e,t,r){return function(e,t,r,i,o,n){for(var a=[0,e.length-1,0],s=[],l=o*o;a.length;){var u=a.pop(),h=a.pop(),c=a.pop();if(h-c<=n)for(var p=c;p<=h;p++)J(t[2*p],t[2*p+1],r,i)<=l&&s.push(e[p]);else{var f=Math.floor((c+h)/2),d=t[2*f],g=t[2*f+1];J(d,g,r,i)<=l&&s.push(e[f]);var m=(u+1)%2;(0===u?r-o<=d:i-o<=g)&&(a.push(c),a.push(f-1),a.push(m)),(0===u?r+o>=d:i+o>=g)&&(a.push(f+1),a.push(h),a.push(m));}}return s}(this.ids,this.coords,e,t,r,this.nodeSize)};var Y={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},R=function(e){this.options=$(Object.create(Y),e),this.trees=new Array(this.options.maxZoom+1);};function j(e,t,r,i,o){return {x:e,y:t,zoom:1/0,id:r,parentId:-1,numPoints:i,properties:o}}function V(e,t){var r=e.geometry.coordinates,i=r[1];return {x:q(r[0]),y:U(i),zoom:1/0,index:t,parentId:-1}}function X(e){return {type:"Feature",id:e.id,properties:W(e),geometry:{type:"Point",coordinates:[(i=e.x,360*(i-.5)),(t=e.y,r=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(r))/Math.PI-90)]}};var t,r,i;}function W(e){var t=e.numPoints,r=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return $($({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:r})}function q(e){return e/360+.5}function U(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function $(e,t){for(var r in t)e[r]=t[r];return e}function H(e){return e.x}function K(e){return e.y}function Q(e,t,r,i,o,n){var a=o-r,s=n-i;if(0!==a||0!==s){var l=((e-r)*a+(t-i)*s)/(a*a+s*s);l>1?(r=o,i=n):l>0&&(r+=a*l,i+=s*l);}return (a=e-r)*a+(s=t-i)*s}function ee(e,t,r,i){var o={id:void 0===e?null:e,type:t,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,r=e.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)te(e,t);else if("Polygon"===r||"MultiLineString"===r)for(var i=0;i<t.length;i++)te(e,t[i]);else if("MultiPolygon"===r)for(i=0;i<t.length;i++)for(var o=0;o<t[i].length;o++)te(e,t[i][o]);}(o),o}function te(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1]);}function re(e,t,r,i){if(t.geometry){var o=t.geometry.coordinates,n=t.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],l=t.id;if(r.promoteId?l=t.properties[r.promoteId]:r.generateId&&(l=i||0),"Point"===n)ie(o,s);else if("MultiPoint"===n)for(var u=0;u<o.length;u++)ie(o[u],s);else if("LineString"===n)oe(o,s,a,!1);else if("MultiLineString"===n){if(r.lineMetrics){for(u=0;u<o.length;u++)oe(o[u],s=[],a,!1),e.push(ee(l,"LineString",s,t.properties));return}ne(o,s,a,!1);}else if("Polygon"===n)ne(o,s,a,!0);else{if("MultiPolygon"!==n){if("GeometryCollection"===n){for(u=0;u<t.geometry.geometries.length;u++)re(e,{id:l,geometry:t.geometry.geometries[u],properties:t.properties},r,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<o.length;u++){var h=[];ne(o[u],h,a,!0),s.push(h);}}e.push(ee(l,n,s,t.properties));}}function ie(e,t){t.push(ae(e[0])),t.push(se(e[1])),t.push(0);}function oe(e,t,r,i){for(var o,n,a=0,s=0;s<e.length;s++){var l=ae(e[s][0]),u=se(e[s][1]);t.push(l),t.push(u),t.push(0),s>0&&(a+=i?(o*u-l*n)/2:Math.sqrt(Math.pow(l-o,2)+Math.pow(u-n,2))),o=l,n=u;}var h=t.length-3;t[2]=1,function e(t,r,i,o){for(var n,a=o,s=i-r>>1,l=i-r,u=t[r],h=t[r+1],c=t[i],p=t[i+1],f=r+3;f<i;f+=3){var d=Q(t[f],t[f+1],u,h,c,p);if(d>a)n=f,a=d;else if(d===a){var g=Math.abs(f-s);g<l&&(n=f,l=g);}}a>o&&(n-r>3&&e(t,r,n,o),t[n+2]=a,i-n>3&&e(t,n,i,o));}(t,0,h,r),t[h+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size;}function ne(e,t,r,i){for(var o=0;o<e.length;o++){var n=[];oe(e[o],n,r,i),t.push(n);}}function ae(e){return e/360+.5}function se(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function le(e,t,r,i,o,n,a,s){if(i/=t,n>=(r/=t)&&a<i)return e;if(a<r||n>=i)return null;for(var l=[],u=0;u<e.length;u++){var h=e[u],c=h.geometry,p=h.type,f=0===o?h.minX:h.minY,d=0===o?h.maxX:h.maxY;if(f>=r&&d<i)l.push(h);else if(!(d<r||f>=i)){var g=[];if("Point"===p||"MultiPoint"===p)ue(c,g,r,i,o);else if("LineString"===p)he(c,g,r,i,o,!1,s.lineMetrics);else if("MultiLineString"===p)pe(c,g,r,i,o,!1);else if("Polygon"===p)pe(c,g,r,i,o,!0);else if("MultiPolygon"===p)for(var m=0;m<c.length;m++){var v=[];pe(c[m],v,r,i,o,!0),v.length&&g.push(v);}if(g.length){if(s.lineMetrics&&"LineString"===p){for(m=0;m<g.length;m++)l.push(ee(h.id,p,g[m],h.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===g.length?(p="LineString",g=g[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===g.length?"Point":"MultiPoint"),l.push(ee(h.id,p,g,h.tags));}}}return l.length?l:null}function ue(e,t,r,i,o){for(var n=0;n<e.length;n+=3){var a=e[n+o];a>=r&&a<=i&&(t.push(e[n]),t.push(e[n+1]),t.push(e[n+2]));}}function he(e,t,r,i,o,n,a){for(var s,l,u=ce(e),h=0===o?de:ge,c=e.start,p=0;p<e.length-3;p+=3){var f=e[p],d=e[p+1],g=e[p+2],m=e[p+3],v=e[p+4],y=0===o?f:d,x=0===o?m:v,w=!1;a&&(s=Math.sqrt(Math.pow(f-m,2)+Math.pow(d-v,2))),y<r?x>r&&(l=h(u,f,d,m,v,r),a&&(u.start=c+s*l)):y>i?x<i&&(l=h(u,f,d,m,v,i),a&&(u.start=c+s*l)):fe(u,f,d,g),x<r&&y>=r&&(l=h(u,f,d,m,v,r),w=!0),x>i&&y<=i&&(l=h(u,f,d,m,v,i),w=!0),!n&&w&&(a&&(u.end=c+s*l),t.push(u),u=ce(e)),a&&(c+=s);}var S=e.length-3;f=e[S],d=e[S+1],g=e[S+2],(y=0===o?f:d)>=r&&y<=i&&fe(u,f,d,g),S=u.length-3,n&&S>=3&&(u[S]!==u[0]||u[S+1]!==u[1])&&fe(u,u[0],u[1],u[2]),u.length&&t.push(u);}function ce(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function pe(e,t,r,i,o,n){for(var a=0;a<e.length;a++)he(e[a],t,r,i,o,n,!1);}function fe(e,t,r,i){e.push(t),e.push(r),e.push(i);}function de(e,t,r,i,o,n){var a=(n-t)/(i-t);return e.push(n),e.push(r+(o-r)*a),e.push(1),a}function ge(e,t,r,i,o,n){var a=(n-r)/(o-r);return e.push(t+(i-t)*a),e.push(n),e.push(1),a}function me(e,t){for(var r=[],i=0;i<e.length;i++){var o,n=e[i],a=n.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)o=ve(n.geometry,t);else if("MultiLineString"===a||"Polygon"===a){o=[];for(var s=0;s<n.geometry.length;s++)o.push(ve(n.geometry[s],t));}else if("MultiPolygon"===a)for(o=[],s=0;s<n.geometry.length;s++){for(var l=[],u=0;u<n.geometry[s].length;u++)l.push(ve(n.geometry[s][u],t));o.push(l);}r.push(ee(n.id,a,o,n.tags));}return r}function ve(e,t){var r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(var i=0;i<e.length;i+=3)r.push(e[i]+t,e[i+1],e[i+2]);return r}function ye(e,t){if(e.transformed)return e;var r,i,o,n=1<<e.z,a=e.x,s=e.y;for(r=0;r<e.features.length;r++){var l=e.features[r],u=l.geometry,h=l.type;if(l.geometry=[],1===h)for(i=0;i<u.length;i+=2)l.geometry.push(xe(u[i],u[i+1],t,n,a,s));else for(i=0;i<u.length;i++){var c=[];for(o=0;o<u[i].length;o+=2)c.push(xe(u[i][o],u[i][o+1],t,n,a,s));l.geometry.push(c);}}return e.transformed=!0,e}function xe(e,t,r,i,o,n){return [Math.round(r*(e*i-o)),Math.round(r*(t*i-n))]}function we(e,t,r,i,o){for(var n=t===o.maxZoom?0:o.tolerance/((1<<t)*o.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,Se(a,e[s],n,o);var l=e[s].minX,u=e[s].minY,h=e[s].maxX,c=e[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),h>a.maxX&&(a.maxX=h),c>a.maxY&&(a.maxY=c);}return a}function Se(e,t,r,i){var o=t.geometry,n=t.type,a=[];if("Point"===n||"MultiPoint"===n)for(var s=0;s<o.length;s+=3)a.push(o[s]),a.push(o[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===n)Ie(a,o,e,r,!1,!1);else if("MultiLineString"===n||"Polygon"===n)for(s=0;s<o.length;s++)Ie(a,o[s],e,r,"Polygon"===n,0===s);else if("MultiPolygon"===n)for(var l=0;l<o.length;l++){var u=o[l];for(s=0;s<u.length;s++)Ie(a,u[s],e,r,!0,0===s);}if(a.length){var h=t.tags||null;if("LineString"===n&&i.lineMetrics){for(var c in h={},t.tags)h[c]=t.tags[c];h.mapbox_clip_start=o.start/o.size,h.mapbox_clip_end=o.end/o.size;}var p={geometry:a,type:"Polygon"===n||"MultiPolygon"===n?3:"LineString"===n||"MultiLineString"===n?2:1,tags:h};null!==t.id&&(p.id=t.id),e.features.push(p);}}function Ie(e,t,r,i,o,n){var a=i*i;if(i>0&&t.size<(o?a:i))r.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===i||t[l+2]>a)&&(r.numSimplified++,s.push(t[l]),s.push(t[l+1])),r.numPoints++;o&&function(e,t){for(var r=0,i=0,o=e.length,n=o-2;i<o;n=i,i+=2)r+=(e[i]-e[n])*(e[i+1]+e[n+1]);if(r>0===t)for(i=0,o=e.length;i<o/2;i+=2){var a=e[i],s=e[i+1];e[i]=e[o-2-i],e[i+1]=e[o-1-i],e[o-2-i]=a,e[o-1-i]=s;}}(s,n),e.push(s);}}function Me(e,t){var r=(t=this.options=function(e,t){for(var r in t)e[r]=t[r];return e}(Object.create(this.options),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(e,t){var r=[];if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)re(r,e.features[i],t,i);else re(r,"Feature"===e.type?e:{geometry:e},t);return r}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(e,t){var r=t.buffer/t.extent,i=e,o=le(e,1,-1-r,r,0,-1,2,t),n=le(e,1,1-r,2+r,0,-1,2,t);return (o||n)&&(i=le(e,1,-r,1+r,0,-1,2,t)||[],o&&(i=me(o,1).concat(i)),n&&(i=i.concat(me(n,-1)))),i}(i,t)).length&&this.splitTile(i,0,0,0),r&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)));}function be(e,t,r){return 32*((1<<e)*r+t)+e}function Pe(e,t){var r=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);var i=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!i)return t(null,null);var o=new S(i.features),n=_(o);0===n.byteOffset&&n.byteLength===n.buffer.byteLength||(n=new Uint8Array(n)),t(null,{vectorTile:o,rawData:n.buffer});}R.prototype.load=function(e){var t=this.options,r=t.log,i=t.minZoom,o=t.maxZoom,n=t.nodeSize;r&&console.time("total time");var a="prepare "+e.length+" points";r&&console.time(a),this.points=e;for(var s=[],l=0;l<e.length;l++)e[l].geometry&&s.push(V(e[l],l));this.trees[o+1]=new G(s,H,K,n,Float32Array),r&&console.timeEnd(a);for(var u=o;u>=i;u--){var h=+Date.now();s=this._cluster(s,u),this.trees[u]=new G(s,H,K,n,Float32Array),r&&console.log("z%d: %d clusters in %dms",u,s.length,+Date.now()-h);}return r&&console.timeEnd("total time"),this},R.prototype.getClusters=function(e,t){var r=((e[0]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,e[1])),o=180===e[2]?180:((e[2]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)r=-180,o=180;else if(r>o){var a=this.getClusters([r,i,180,n],t),s=this.getClusters([-180,i,o,n],t);return a.concat(s)}for(var l=this.trees[this._limitZoom(t)],u=[],h=0,c=l.range(q(r),U(n),q(o),U(i));h<c.length;h+=1){var p=l.points[c[h]];u.push(p.numPoints?X(p):this.points[p.index]);}return u},R.prototype.getChildren=function(e){var t=this._getOriginId(e),r=this._getOriginZoom(e),i="No cluster with the specified id.",o=this.trees[r];if(!o)throw new Error(i);var n=o.points[t];if(!n)throw new Error(i);for(var a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=[],l=0,u=o.within(n.x,n.y,a);l<u.length;l+=1){var h=o.points[u[l]];h.parentId===e&&s.push(h.numPoints?X(h):this.points[h.index]);}if(0===s.length)throw new Error(i);return s},R.prototype.getLeaves=function(e,t,r){var i=[];return this._appendLeaves(i,e,t=t||10,r=r||0,0),i},R.prototype.getTile=function(e,t,r){var i=this.trees[this._limitZoom(e)],o=Math.pow(2,e),n=this.options,a=n.radius/n.extent,s=(r-a)/o,l=(r+1+a)/o,u={features:[]};return this._addTileFeatures(i.range((t-a)/o,s,(t+1+a)/o,l),i.points,t,r,o,u),0===t&&this._addTileFeatures(i.range(1-a/o,s,1,l),i.points,o,r,o,u),t===o-1&&this._addTileFeatures(i.range(0,s,a/o,l),i.points,-1,r,o,u),u.features.length?u:null},R.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id;}return t},R.prototype._appendLeaves=function(e,t,r,i,o){for(var n=0,a=this.getChildren(t);n<a.length;n+=1){var s=a[n],l=s.properties;if(l&&l.cluster?o+l.point_count<=i?o+=l.point_count:o=this._appendLeaves(e,l.cluster_id,r,i,o):o<i?o++:e.push(s),e.length===r)break}return o},R.prototype._addTileFeatures=function(e,t,r,i,o,n){for(var a=0,s=e;a<s.length;a+=1){var l=t[s[a]],u=l.numPoints,h={type:1,geometry:[[Math.round(this.options.extent*(l.x*o-r)),Math.round(this.options.extent*(l.y*o-i))]],tags:u?W(l):this.points[l.index].properties},c=void 0;u?c=l.id:this.options.generateId?c=l.index:this.points[l.index].id&&(c=this.points[l.index].id),void 0!==c&&(h.id=c),n.features.push(h);}},R.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(e,this.options.maxZoom+1))},R.prototype._cluster=function(e,t){for(var r=[],i=this.options,o=i.reduce,n=i.radius/(i.extent*Math.pow(2,t)),a=0;a<e.length;a++){var s=e[a];if(!(s.zoom<=t)){s.zoom=t;for(var l=this.trees[t+1],u=l.within(s.x,s.y,n),h=s.numPoints||1,c=s.x*h,p=s.y*h,f=o&&h>1?this._map(s,!0):null,d=(a<<5)+(t+1)+this.points.length,g=0,m=u;g<m.length;g+=1){var v=l.points[m[g]];if(!(v.zoom<=t)){v.zoom=t;var y=v.numPoints||1;c+=v.x*y,p+=v.y*y,h+=y,v.parentId=d,o&&(f||(f=this._map(s,!0)),o(f,this._map(v)));}}1===h?r.push(s):(s.parentId=d,r.push(j(c/h,p/h,d,h,f)));}}return r},R.prototype._getOriginId=function(e){return e-this.points.length>>5},R.prototype._getOriginZoom=function(e){return (e-this.points.length)%32},R.prototype._map=function(e,t){if(e.numPoints)return t?$({},e.properties):e.properties;var r=this.points[e.index].properties,i=this.options.map(r);return t&&i===r?$({},i):i},Me.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Me.prototype.splitTile=function(e,t,r,i,o,n,a){for(var s=[e,t,r,i],l=this.options,u=l.debug;s.length;){i=s.pop(),r=s.pop(),t=s.pop(),e=s.pop();var h=1<<t,c=be(t,r,i),p=this.tiles[c];if(!p&&(u>1&&console.time("creation"),p=this.tiles[c]=we(e,t,r,i,l),this.tileCoords.push({z:t,x:r,y:i}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++;}if(p.source=e,o){if(t===l.maxZoom||t===o)continue;var d=1<<o-t;if(r!==Math.floor(n/d)||i!==Math.floor(a/d))continue}else if(t===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==e.length){u>1&&console.time("clipping");var g,m,v,y,x,w,S=.5*l.buffer/l.extent,I=.5-S,M=.5+S,b=1+S;g=m=v=y=null,x=le(e,h,r-S,r+M,0,p.minX,p.maxX,l),w=le(e,h,r+I,r+b,0,p.minX,p.maxX,l),e=null,x&&(g=le(x,h,i-S,i+M,1,p.minY,p.maxY,l),m=le(x,h,i+I,i+b,1,p.minY,p.maxY,l),x=null),w&&(v=le(w,h,i-S,i+M,1,p.minY,p.maxY,l),y=le(w,h,i+I,i+b,1,p.minY,p.maxY,l),w=null),u>1&&console.timeEnd("clipping"),s.push(g||[],t+1,2*r,2*i),s.push(m||[],t+1,2*r,2*i+1),s.push(v||[],t+1,2*r+1,2*i),s.push(y||[],t+1,2*r+1,2*i+1);}}},Me.prototype.getTile=function(e,t,r){var i=this.options,o=i.extent,n=i.debug;if(e<0||e>24)return null;var a=1<<e,s=be(e,t=(t%a+a)%a,r);if(this.tiles[s])return ye(this.tiles[s],o);n>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var l,u=e,h=t,c=r;!l&&u>0;)u--,h=Math.floor(h/2),c=Math.floor(c/2),l=this.tiles[be(u,h,c)];return l&&l.source?(n>1&&console.log("found parent tile z%d-%d-%d",u,h,c),n>1&&console.time("drilling down"),this.splitTile(l.source,u,h,c,e,t,r),n>1&&console.timeEnd("drilling down"),this.tiles[s]?ye(this.tiles[s],o):null):null};var _e=function(t){function r(e,r,i,o){t.call(this,e,r,i,Pe),o&&(this.loadGeoJSON=o);}return t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r,r.prototype.loadData=function(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=t,this._pendingLoadDataParams=e,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData());},r.prototype._loadData=function(){var t=this;if(this._pendingCallback&&this._pendingLoadDataParams){var r=this._pendingCallback,i=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var o=!!(i&&i.request&&i.request.collectResourceTiming)&&new e.RequestPerformance(i.request);this.loadGeoJSON(i,(function(n,a){if(n||!a)return r(n);if("object"!=typeof a)return r(new Error("Input data given to '"+i.source+"' is not a valid GeoJSON object."));!function e(t,r){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.map(m(e,r)),t;case"GeometryCollection":return t.geometries=t.geometries.map(m(e,r)),t;case"Feature":return t.geometry=e(t.geometry,r),t;case"Polygon":case"MultiPolygon":return function(e,t){return "Polygon"===e.type?e.coordinates=v(e.coordinates,t):"MultiPolygon"===e.type&&(e.coordinates=e.coordinates.map(m(v,t))),e}(t,r);default:return t}}(a,!0);try{t._geoJSONIndex=i.cluster?new R(function(t){var r=t.superclusterOptions,i=t.clusterProperties;if(!i||!r)return r;for(var o={},n={},a={accumulated:null,zoom:0},s={properties:null},l=Object.keys(i),u=0,h=l;u<h.length;u+=1){var c=h[u],p=i[c],f=p[0],d=e.createExpression(p[1]),g=e.createExpression("string"==typeof f?[f,["accumulated"],["get",c]]:f);o[c]=d.value,n[c]=g.value;}return r.map=function(e){s.properties=e;for(var t={},r=0,i=l;r<i.length;r+=1){var n=i[r];t[n]=o[n].evaluate(a,s);}return t},r.reduce=function(e,t){s.properties=t;for(var r=0,i=l;r<i.length;r+=1){var o=i[r];a.accumulated=e[o],e[o]=n[o].evaluate(a,s);}},r}(i)).load(a.features):function(e,t){return new Me(e,t)}(a,i.geojsonVtOptions);}catch(n){return r(n)}t.loaded={};var s={};if(o){var l=o.finish();l&&(s.resourceTiming={},s.resourceTiming[i.source]=JSON.parse(JSON.stringify(l)));}r(null,s);}));}},r.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData());},r.prototype.reloadTile=function(e,r){var i=this.loaded;return i&&i[e.uid]?t.prototype.reloadTile.call(this,e,r):this.loadTile(e,r)},r.prototype.loadGeoJSON=function(t,r){if(t.request)e.getJSON(t.request,r);else{if("string"!=typeof t.data)return r(new Error("Input data given to '"+t.source+"' is not a valid GeoJSON object."));try{return r(null,JSON.parse(t.data))}catch(e){return r(new Error("Input data given to '"+t.source+"' is not a valid GeoJSON object."))}}},r.prototype.removeSource=function(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),t();},r.prototype.getClusterExpansionZoom=function(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId));}catch(e){t(e);}},r.prototype.getClusterChildren=function(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId));}catch(e){t(e);}},r.prototype.getClusterLeaves=function(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset));}catch(e){t(e);}},r}(l),ke=function(t){var r=this;this.self=t,this.actor=new e.Actor(t,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:l,geojson:_e},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(e,t){if(r.workerSourceTypes[e])throw new Error('Worker source with name "'+e+'" already registered.');r.workerSourceTypes[e]=t;},this.self.registerRTLTextPlugin=function(t){if(e.plugin.isParsed())throw new Error("RTL text plugin already registered.");e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText,e.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText;};};return ke.prototype.setReferrer=function(e,t){this.referrer=t;},ke.prototype.setImages=function(e,t,r){this.availableImages[e]=t,r();},ke.prototype.setLayers=function(e,t,r){this.getLayerIndex(e).replace(t),r();},ke.prototype.updateLayers=function(e,t,r){this.getLayerIndex(e).update(t.layers,t.removedIds),r();},ke.prototype.loadTile=function(e,t,r){this.getWorkerSource(e,t.type,t.source).loadTile(t,r);},ke.prototype.loadDEMTile=function(e,t,r){this.getDEMWorkerSource(e,t.source).loadTile(t,r);},ke.prototype.reloadTile=function(e,t,r){this.getWorkerSource(e,t.type,t.source).reloadTile(t,r);},ke.prototype.abortTile=function(e,t,r){this.getWorkerSource(e,t.type,t.source).abortTile(t,r);},ke.prototype.removeTile=function(e,t,r){this.getWorkerSource(e,t.type,t.source).removeTile(t,r);},ke.prototype.removeDEMTile=function(e,t){this.getDEMWorkerSource(e,t.source).removeTile(t);},ke.prototype.removeSource=function(e,t,r){if(this.workerSources[e]&&this.workerSources[e][t.type]&&this.workerSources[e][t.type][t.source]){var i=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==i.removeSource?i.removeSource(t,r):r();}},ke.prototype.loadWorkerSource=function(e,t,r){try{this.self.importScripts(t.url),r();}catch(e){r(e.toString());}},ke.prototype.syncRTLPluginState=function(t,r,i){try{e.plugin.setState(r);var o=e.plugin.getPluginURL();if(e.plugin.isLoaded()&&!e.plugin.isParsed()&&null!=o){this.self.importScripts(o);var n=e.plugin.isParsed();i(n?void 0:new Error("RTL Text Plugin failed to import scripts from "+o),n);}}catch(e){i(e.toString());}},ke.prototype.getAvailableImages=function(e){var t=this.availableImages[e];return t||(t=[]),t},ke.prototype.getLayerIndex=function(e){var t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new i),t},ke.prototype.getWorkerSource=function(e,t,r){var i=this;return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][r]||(this.workerSources[e][t][r]=new this.workerSourceTypes[t]({send:function(t,r,o){i.actor.send(t,r,o,e);}},this.getLayerIndex(e),this.getAvailableImages(e))),this.workerSources[e][t][r]},ke.prototype.getDEMWorkerSource=function(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new h),this.demWorkerSources[e][t]},ke.prototype.enforceCacheSizeLimit=function(t,r){e.enforceCacheSizeLimit(r);},"undefined"!=typeof WorkerGlobalScope&&void 0!==e.window&&e.window instanceof WorkerGlobalScope&&(e.window.worker=new ke(e.window)),ke}));

define(["./shared"],(function(t){"use strict";var e=t.createCommonjsModule((function(t){function e(t){return !!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return !1;var t,e,i=new Blob([""],{type:"text/javascript"}),o=URL.createObjectURL(i);try{e=new Worker(o),t=!0;}catch(e){t=!1;}return e&&e.terminate(),URL.revokeObjectURL(o),t}()&&"Uint8ClampedArray"in window&&ArrayBuffer.isView&&(o=t&&t.failIfMajorPerformanceCaveat,void 0===i[o]&&(i[o]=function(t){var i=document.createElement("canvas"),o=Object.create(e.webGLContextAttributes);return o.failIfMajorPerformanceCaveat=t,i.probablySupportsContext?i.probablySupportsContext("webgl",o)||i.probablySupportsContext("experimental-webgl",o):i.supportsContext?i.supportsContext("webgl",o)||i.supportsContext("experimental-webgl",o):i.getContext("webgl",o)||i.getContext("experimental-webgl",o)}(o)),i[o]));var o;}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e);var i={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};})),i={create:function(e,i,o){var r=t.window.document.createElement(e);return void 0!==i&&(r.className=i),o&&o.appendChild(r),r},createNS:function(e,i){return t.window.document.createElementNS(e,i)}},o=t.window.document.documentElement.style;function r(t){if(!o)return t[0];for(var e=0;e<t.length;e++)if(t[e]in o)return t[e];return t[0]}var a,n=r(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);i.disableDrag=function(){o&&n&&(a=o[n],o[n]="none");},i.enableDrag=function(){o&&n&&(o[n]=a);};var s=r(["transform","WebkitTransform"]);i.setTransform=function(t,e){t.style[s]=e;};var l=!1;try{var c=Object.defineProperty({},"passive",{get:function(){l=!0;}});t.window.addEventListener("test",c,c),t.window.removeEventListener("test",c,c);}catch(t){l=!1;}i.addEventListener=function(t,e,i,o){void 0===o&&(o={}),t.addEventListener(e,i,"passive"in o&&l?o:o.capture);},i.removeEventListener=function(t,e,i,o){void 0===o&&(o={}),t.removeEventListener(e,i,"passive"in o&&l?o:o.capture);};var u=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",u,!0);};function h(t){var e=t.userImage;return !!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}i.suppressClick=function(){t.window.addEventListener("click",u,!0),t.window.setTimeout((function(){t.window.removeEventListener("click",u,!0);}),0);},i.mousePos=function(e,i){var o=e.getBoundingClientRect(),r=t.window.TouchEvent&&i instanceof t.window.TouchEvent?i.touches[0]:i;return new t.Point(r.clientX-o.left-e.clientLeft,r.clientY-o.top-e.clientTop)},i.touchPos=function(e,i){for(var o=e.getBoundingClientRect(),r=[],a="touchend"===i.type?i.changedTouches:i.touches,n=0;n<a.length;n++)r.push(new t.Point(a[n].clientX-o.left-e.clientLeft,a[n].clientY-o.top-e.clientTop));return r},i.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},i.remove=function(t){t.parentNode&&t.parentNode.removeChild(t);};var p=function(e){function i(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0;}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.isLoaded=function(){return this.loaded},i.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,i=this.requestors;e<i.length;e+=1){var o=i[e];this._notify(o.ids,o.callback);}this.requestors=[];}},i.prototype.getImage=function(t){return this.images[t]},i.prototype.addImage=function(t,e){this._validate(t,e)&&(this.images[t]=e);},i.prototype._validate=function(e,i){var o=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchX" value'))),o=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchY" value'))),o=!1),this._validateContent(i.content,i)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "content" value'))),o=!1),o},i.prototype._validateStretch=function(t,e){if(!t)return !0;for(var i=0,o=0,r=t;o<r.length;o+=1){var a=r[o];if(a[0]<i||a[1]<a[0]||e<a[1])return !1;i=a[1];}return !0},i.prototype._validateContent=function(t,e){return !(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))},i.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0;},i.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove();},i.prototype.listImages=function(){return Object.keys(this.images)},i.prototype.getImages=function(t,e){var i=!0;if(!this.isLoaded())for(var o=0,r=t;o<r.length;o+=1)this.images[r[o]]||(i=!1);this.isLoaded()||i?this._notify(t,e):this.requestors.push({ids:t,callback:e});},i.prototype._notify=function(e,i){for(var o={},r=0,a=e;r<a.length;r+=1){var n=a[r];this.images[n]||this.fire(new t.Event("styleimagemissing",{id:n}));var s=this.images[n];s?o[n]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+n+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.');}i(null,o);},i.prototype.getPixelSize=function(){var t=this.atlasImage;return {width:t.width,height:t.height}},i.prototype.getPattern=function(e){var i=this.patterns[e],o=this.getImage(e);if(!o)return null;if(i&&i.position.version===o.version)return i.position;if(i)i.position.version=o.version;else{var r={w:o.data.width+2,h:o.data.height+2,x:0,y:0},a=new t.ImagePosition(r,o);this.patterns[e]={bin:r,position:a};}return this._updatePatternAtlas(),this.patterns[e].position},i.prototype.bind=function(e){var i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE);},i.prototype._updatePatternAtlas=function(){var e=[];for(var i in this.patterns)e.push(this.patterns[i].bin);var o=t.potpack(e),r=o.w,a=o.h,n=this.atlasImage;for(var s in n.resize({width:r||1,height:a||1}),this.patterns){var l=this.patterns[s].bin,c=l.x+1,u=l.y+1,h=this.images[s].data,p=h.width,d=h.height;t.RGBAImage.copy(h,n,{x:0,y:0},{x:c,y:u},{width:p,height:d}),t.RGBAImage.copy(h,n,{x:0,y:d-1},{x:c,y:u-1},{width:p,height:1}),t.RGBAImage.copy(h,n,{x:0,y:0},{x:c,y:u+d},{width:p,height:1}),t.RGBAImage.copy(h,n,{x:p-1,y:0},{x:c-1,y:u},{width:1,height:d}),t.RGBAImage.copy(h,n,{x:0,y:0},{x:c+p,y:u},{width:1,height:d});}this.dirty=!0;},i.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={};},i.prototype.dispatchRenderCallbacks=function(t){for(var e=0,i=t;e<i.length;e+=1){var o=i[e];if(!this.callbackDispatchedThisFrame[o]){this.callbackDispatchedThisFrame[o]=!0;var r=this.images[o];h(r)&&this.updateImage(o,r);}}},i}(t.Evented),d=m,_=m,f=1e20;function m(t,e,i,o,r,a){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=o||.25,this.fontFamily=r||"sans-serif",this.fontWeight=a||"normal",this.radius=i||8;var n=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=n,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(n*n),this.gridInner=new Float64Array(n*n),this.f=new Float64Array(n),this.d=new Float64Array(n),this.z=new Float64Array(n+1),this.v=new Int16Array(n),this.middle=Math.round(n/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1));}function g(t,e,i,o,r,a,n){for(var s=0;s<e;s++){for(var l=0;l<i;l++)o[l]=t[l*e+s];for(v(o,r,a,n,i),l=0;l<i;l++)t[l*e+s]=r[l];}for(l=0;l<i;l++){for(s=0;s<e;s++)o[s]=t[l*e+s];for(v(o,r,a,n,e),s=0;s<e;s++)t[l*e+s]=Math.sqrt(r[s]);}}function v(t,e,i,o,r){i[0]=0,o[0]=-f,o[1]=+f;for(var a=1,n=0;a<r;a++){for(var s=(t[a]+a*a-(t[i[n]]+i[n]*i[n]))/(2*a-2*i[n]);s<=o[n];)s=(t[a]+a*a-(t[i[--n]]+i[n]*i[n]))/(2*a-2*i[n]);i[++n]=a,o[n]=s,o[n+1]=+f;}for(a=0,n=0;a<r;a++){for(;o[n+1]<a;)n++;e[a]=(a-i[n])*(a-i[n])+t[i[n]];}}m.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),i=new Uint8ClampedArray(this.size*this.size),o=0;o<this.size*this.size;o++){var r=e.data[4*o+3]/255;this.gridOuter[o]=1===r?0:0===r?f:Math.pow(Math.max(0,.5-r),2),this.gridInner[o]=1===r?f:0===r?0:Math.pow(Math.max(0,r-.5),2);}for(g(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),g(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),o=0;o<this.size*this.size;o++)i[o]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[o]-this.gridInner[o])/this.radius+this.cutoff))));return i},d.default=_;var y=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={};};y.prototype.setURL=function(t){this.url=t;},y.prototype.getGlyphs=function(e,i){var o=this,r=[];for(var a in e)for(var n=0,s=e[a];n<s.length;n+=1)r.push({stack:a,id:s[n]});t.asyncAll(r,(function(t,e){var i=t.stack,r=t.id,a=o.entries[i];a||(a=o.entries[i]={glyphs:{},requests:{}});var n=a.glyphs[r];if(void 0===n){if(n=o._tinySDF(a,i,r))return a.glyphs[r]=n,void e(null,{stack:i,id:r,glyph:n});var s=Math.floor(r/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else{var l=a.requests[s];l||(l=a.requests[s]=[],y.loadGlyphRange(i,s,o.url,o.requestManager,(function(t,e){if(e)for(var i in e)o._doesCharSupportLocalGlyph(+i)||(a.glyphs[+i]=e[+i]);for(var r=0,n=l;r<n.length;r+=1)(0,n[r])(t,e);delete a.requests[s];}))),l.push((function(t,o){t?e(t):o&&e(null,{stack:i,id:r,glyph:o[r]||null});}));}}else e(null,{stack:i,id:r,glyph:n});}),(function(t,e){if(t)i(t);else if(e){for(var o={},r=0,a=e;r<a.length;r+=1){var n=a[r],s=n.stack,l=n.id,c=n.glyph;(o[s]||(o[s]={}))[l]=c&&{id:c.id,bitmap:c.bitmap.clone(),metrics:c.metrics};}i(null,o);}}));},y.prototype._doesCharSupportLocalGlyph=function(e){return !!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))},y.prototype._tinySDF=function(e,i,o){var r=this.localIdeographFontFamily;if(r&&this._doesCharSupportLocalGlyph(o)){var a=e.tinySDF;if(!a){var n="400";/bold/i.test(i)?n="900":/medium/i.test(i)?n="500":/light/i.test(i)&&(n="200"),a=e.tinySDF=new y.TinySDF(24,3,8,.25,r,n);}return {id:o,bitmap:new t.AlphaImage({width:30,height:30},a.draw(String.fromCharCode(o))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},y.loadGlyphRange=function(e,i,o,r,a){var n=256*i,s=n+255,l=r.transformRequest(r.normalizeGlyphsURL(o).replace("{fontstack}",e).replace("{range}",n+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(l,(function(e,i){if(e)a(e);else if(i){for(var o={},r=0,n=t.parseGlyphPBF(i);r<n.length;r+=1){var s=n[r];o[s.id]=s;}a(null,o);}}));},y.TinySDF=d;var x=function(){this.specification=t.styleSpec.light.position;};x.prototype.possiblyEvaluate=function(e,i){return t.sphericalToCartesian(e.expression.evaluate(i))},x.prototype.interpolate=function(e,i,o){return {x:t.number(e.x,i.x,o),y:t.number(e.y,i.y,o),z:t.number(e.z,i.z,o)}};var b=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new x,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),w=function(e){function i(i){e.call(this),this._transitionable=new t.Transitionable(b),this.setLight(i),this._transitioning=this._transitionable.untransitioned();}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.getLight=function(){return this._transitionable.serialize()},i.prototype.setLight=function(e,i){if(void 0===i&&(i={}),!this._validate(t.validateLight,e,i))for(var o in e){var r=e[o];t.endsWith(o,"-transition")?this._transitionable.setTransition(o.slice(0,-"-transition".length),r):this._transitionable.setValue(o,r);}},i.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning);},i.prototype.hasTransition=function(){return this._transitioning.hasTransition()},i.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t);},i.prototype._validate=function(e,i,o){return (!o||!1!==o.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},i}(t.Evented),E=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={};};E.prototype.getDash=function(t,e){var i=t.join(",")+String(e);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(t,e)),this.dashEntry[i]},E.prototype.getDashRanges=function(t,e,i){var o=[],r=t.length%2==1?-t[t.length-1]*i:0,a=t[0]*i,n=!0;o.push({left:r,right:a,isDash:n,zeroLength:0===t[0]});for(var s=t[0],l=1;l<t.length;l++){var c=t[l];o.push({left:r=s*i,right:a=(s+=c)*i,isDash:n=!n,zeroLength:0===c});}return o},E.prototype.addRoundDash=function(t,e,i){for(var o=e/2,r=-i;r<=i;r++)for(var a=this.width*(this.nextRow+i+r),n=0,s=t[n],l=0;l<this.width;l++){l/s.right>1&&(s=t[++n]);var c=Math.abs(l-s.left),u=Math.abs(l-s.right),h=Math.min(c,u),p=void 0,d=r/i*(o+1);if(s.isDash){var _=o-Math.abs(d);p=Math.sqrt(h*h+_*_);}else p=o-Math.sqrt(h*h+d*d);this.data[a+l]=Math.max(0,Math.min(255,p+128));}},E.prototype.addRegularDash=function(t){for(var e=t.length-1;e>=0;--e){var i=t[e],o=t[e+1];i.zeroLength?t.splice(e,1):o&&o.isDash===i.isDash&&(o.left=i.left,t.splice(e,1));}var r=t[0],a=t[t.length-1];r.isDash===a.isDash&&(r.left=a.left-this.width,a.right=r.right+this.width);for(var n=this.width*this.nextRow,s=0,l=t[s],c=0;c<this.width;c++){c/l.right>1&&(l=t[++s]);var u=Math.abs(c-l.left),h=Math.abs(c-l.right),p=Math.min(u,h);this.data[n+c]=Math.max(0,Math.min(255,(l.isDash?p:-p)+128));}},E.prototype.addDash=function(e,i){var o=i?7:0,r=2*o+1;if(this.nextRow+r>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var a=0,n=0;n<e.length;n++)a+=e[n];if(0!==a){var s=this.width/a,l=this.getDashRanges(e,this.width,s);i?this.addRoundDash(l,s,o):this.addRegularDash(l);}var c={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:a};return this.nextRow+=r,this.dirty=!0,c},E.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data));};var T=function e(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var r=this.workerPool.acquire(this.id),a=0;a<r.length;a++){var n=new e.Actor(r[a],o,this.id);n.name="Worker "+a,this.actors.push(n);}};function I(e,i,o){var r=function(r,a){if(r)return o(r);if(a){var n=t.pick(t.extend(a,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);a.vector_layers&&(n.vectorLayers=a.vector_layers,n.vectorLayerIds=n.vectorLayers.map((function(t){return t.id}))),n.tiles=i.canonicalizeTileset(n,e.url),o(null,n);}};return e.url?t.getJSON(i.transformRequest(i.normalizeSourceURL(e.url),t.ResourceType.Source),r):t.browser.frame((function(){return r(null,e)}))}T.prototype.broadcast=function(e,i,o){t.asyncAll(this.actors,(function(t,o){t.send(e,i,o);}),o=o||function(){});},T.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},T.prototype.remove=function(){this.actors.forEach((function(t){t.remove();})),this.actors=[],this.workerPool.release(this.id);},T.Actor=t.Actor;var C=function(e,i,o){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=o||24;};C.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},C.prototype.contains=function(e){var i=Math.pow(2,e.z),o=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*i),r=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*i),a=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*i),n=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*i);return e.x>=o&&e.x<a&&e.y>=r&&e.y<n};var S=function(e){function i(i,o,r,a){if(e.call(this),this.id=i,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(o,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a);}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=I(this._options,this.map._requestManager,(function(i,o){e._tileJSONRequest=null,e._loaded=!0,i?e.fire(new t.ErrorEvent(i)):o&&(t.extend(e,o),o.bounds&&(e.tileBounds=new C(o.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(o.tiles,e.map._requestManager._customAccessToken),t.postMapLoadEvent(o.tiles,e.map._getMapId(),e.map._requestManager._skuToken,e.map._requestManager._customAccessToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})));}));},i.prototype.loaded=function(){return this._loaded},i.prototype.hasTile=function(t){return !this.tileBounds||this.tileBounds.contains(t.canonical)},i.prototype.onAdd=function(t){this.map=t,this.load();},i.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);},i.prototype.serialize=function(){return t.extend({},this._options)},i.prototype.loadTile=function(e,i){var o=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(o,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function a(o,r){return delete e.request,e.aborted?i(null):o&&404!==o.status?i(o):(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}r.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=i:e.request=e.actor.send("reloadTile",r,a.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",r,a.bind(this)));},i.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0);},i.prototype.unloadTile=function(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0);},i.prototype.hasTransition=function(){return !1},i}(t.Evented),P=function(e){function i(i,o,r,a){e.call(this),this.id=i,this.dispatcher=r,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},o),t.extend(this,t.pick(o,["url","scheme","tileSize"]));}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=I(this._options,this.map._requestManager,(function(i,o){e._tileJSONRequest=null,e._loaded=!0,i?e.fire(new t.ErrorEvent(i)):o&&(t.extend(e,o),o.bounds&&(e.tileBounds=new C(o.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(o.tiles),t.postMapLoadEvent(o.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})));}));},i.prototype.loaded=function(){return this._loaded},i.prototype.onAdd=function(t){this.map=t,this.load();},i.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);},i.prototype.serialize=function(){return t.extend({},this._options)},i.prototype.hasTile=function(t){return !this.tileBounds||this.tileBounds.contains(t.canonical)},i.prototype.loadTile=function(e,i){var o=this,r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),(function(r,a){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(r)e.state="errored",i(r);else if(a){o.map._refreshExpiredTiles&&e.setExpiryData(a),delete a.cacheControl,delete a.expires;var n=o.map.painter.context,s=n.gl;e.texture=o.map.painter.getTileTexture(a.width),e.texture?e.texture.update(a,{useMipmap:!0}):(e.texture=new t.Texture(n,a,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),n.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(o.dispatcher),i(null);}}));},i.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e();},i.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e();},i.prototype.hasTransition=function(){return !1},i}(t.Evented),z=function(e){function i(i,o,r,a){e.call(this,i,o,r,a),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox";}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.serialize=function(){return {type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},i.prototype.loadTile=function(e,i){var o=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function r(t,o){t&&(e.state="errored",i(t)),o&&(e.dem=o,e.needsHillshadePrepare=!0,e.state="loaded",i(null));}e.request=t.getImage(this.map._requestManager.transformRequest(o,t.ResourceType.Tile),function(o,a){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(o)e.state="errored",i(o);else if(a){this.map._refreshExpiredTiles&&e.setExpiryData(a),delete a.cacheControl,delete a.expires;var n=t.window.ImageBitmap&&a instanceof t.window.ImageBitmap&&t.offscreenCanvasSupported()?a:t.browser.getImageData(a,1),s={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:n,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",s,r.bind(this)));}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID);},i.prototype._getNeighboringTiles=function(e){var i=e.canonical,o=Math.pow(2,i.z),r=(i.x-1+o)%o,a=0===i.x?e.wrap-1:e.wrap,n=(i.x+1+o)%o,s=i.x+1===o?e.wrap+1:e.wrap,l={};return l[new t.OverscaledTileID(e.overscaledZ,a,i.z,r,i.y).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,i.z,n,i.y).key]={backfilled:!1},i.y>0&&(l[new t.OverscaledTileID(e.overscaledZ,a,i.z,r,i.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,i.z,n,i.y-1).key]={backfilled:!1}),i.y+1<o&&(l[new t.OverscaledTileID(e.overscaledZ,a,i.z,r,i.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,s,i.z,n,i.y+1).key]={backfilled:!1}),l},i.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id});},i}(P),L=function(e){function i(i,o,r,a){e.call(this),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(a),this._data=o.data,this._options=t.extend({},o),this._collectResourceTiming=o.collectResourceTiming,this._resourceTiming=[],void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;var n=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*n,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*n,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:void 0!==o.clusterMaxZoom?Math.min(o.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:t.EXTENT,radius:(o.clusterRadius||50)*n,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties},o.workerOptions);}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(i){if(i)e.fire(new t.ErrorEvent(i));else{var o={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(o.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",o));}}));},i.prototype.onAdd=function(t){this.map=t,this.load();},i.prototype.setData=function(e){var i=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(e){if(e)i.fire(new t.ErrorEvent(e));else{var o={dataType:"source",sourceDataType:"content"};i._collectResourceTiming&&i._resourceTiming&&i._resourceTiming.length>0&&(o.resourceTiming=i._resourceTiming,i._resourceTiming=[]),i.fire(new t.Event("data",o));}})),this},i.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},i.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this},i.prototype.getClusterLeaves=function(t,e,i,o){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:i},o),this},i.prototype._updateWorkerData=function(e){var i=this;this._loaded=!1;var o=t.extend({},this.workerOptions),r=this._data;"string"==typeof r?(o.request=this.map._requestManager.transformRequest(t.browser.resolveURL(r),t.ResourceType.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(r),this.actor.send(this.type+".loadData",o,(function(t,r){i._removed||r&&r.abandoned||(i._loaded=!0,r&&r.resourceTiming&&r.resourceTiming[i.id]&&(i._resourceTiming=r.resourceTiming[i.id].slice(0)),i.actor.send(i.type+".coalesce",{source:o.source},null),e(t));}));},i.prototype.loaded=function(){return this._loaded},i.prototype.loadTile=function(e,i){var o=this,r=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(r,{type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(t,a){return delete e.request,e.unloadVectorData(),e.aborted?i(null):t?i(t):(e.loadVectorData(a,o.map.painter,"reloadTile"===r),i(null))}));},i.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0;},i.prototype.unloadTile=function(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id});},i.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id});},i.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},i.prototype.hasTransition=function(){return !1},i}(t.Evented),M=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),D=function(e){function i(t,i,o,r){e.call(this),this.id=t,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=i;}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(e,i){var o=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(function(r,a){o._loaded=!0,r?o.fire(new t.ErrorEvent(r)):a&&(o.image=a,e&&(o.coordinates=e),i&&i(),o._finishLoading());}));},i.prototype.loaded=function(){return this._loaded},i.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(function(){e.texture=null;})),this):this},i.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})));},i.prototype.onAdd=function(t){this.map=t,this.load();},i.prototype.setCoordinates=function(e){var i=this;this.coordinates=e;var o=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var i=1/0,o=1/0,r=-1/0,a=-1/0,n=0,s=e;n<s.length;n+=1){var l=s[n];i=Math.min(i,l.x),o=Math.min(o,l.y),r=Math.max(r,l.x),a=Math.max(a,l.y);}var c=Math.max(r-i,a-o),u=Math.max(0,Math.floor(-Math.log(c)/Math.LN2)),h=Math.pow(2,u);return new t.CanonicalTileID(u,Math.floor((i+r)/2*h),Math.floor((o+a)/2*h))}(o),this.minzoom=this.maxzoom=this.tileID.z;var r=o.map((function(t){return i.tileID.getTilePoint(t)._round()}));return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(r[2].x,r[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},i.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,i=e.gl;for(var o in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,M.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[o];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture);}}},i.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null));},i.prototype.serialize=function(){return {type:"image",url:this.options.url,coordinates:this.coordinates}},i.prototype.hasTransition=function(){return !1},i}(t.Evented),A=function(e){function i(t,i,o,r){e.call(this,t,i,o,r),this.roundZoom=!0,this.type="video",this.options=i;}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){var e=this;this._loaded=!1;var i=this.options;this.urls=[];for(var o=0,r=i.urls;o<r.length;o+=1)this.urls.push(this.map._requestManager.transformRequest(r[o],t.ResourceType.Source).url);t.getVideo(this.urls,(function(i,o){e._loaded=!0,i?e.fire(new t.ErrorEvent(i)):o&&(e.video=o,e.video.loop=!0,e.video.addEventListener("playing",(function(){e.map.triggerRepaint();})),e.map&&e.video.play(),e._finishLoading());}));},i.prototype.pause=function(){this.video&&this.video.pause();},i.prototype.play=function(){this.video&&this.video.play();},i.prototype.seek=function(e){if(this.video){var i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+i.start(0)+" and "+i.end(0)+"-second mark."))):this.video.currentTime=e;}},i.prototype.getVideo=function(){return this.video},i.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)));},i.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,i=e.gl;for(var o in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,M.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[o];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture);}}},i.prototype.serialize=function(){return {type:"video",urls:this.urls,coordinates:this.coordinates}},i.prototype.hasTransition=function(){return this.video&&!this.video.paused},i}(D),R=function(e){function i(i,o,r,a){e.call(this,i,o,r,a),o.coordinates?Array.isArray(o.coordinates)&&4===o.coordinates.length&&!o.coordinates.some((function(t){return !Array.isArray(t)||2!==t.length||t.some((function(t){return "number"!=typeof t}))}))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'missing required property "coordinates"'))),o.animate&&"boolean"!=typeof o.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'optional "animate" property must be a boolean value'))),o.canvas?"string"==typeof o.canvas||o.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+i,null,'missing required property "canvas"'))),this.options=o,this.animate=void 0===o.animate||o.animate;}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint();},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1);},this._finishLoading());},i.prototype.getCanvas=function(){return this.canvas},i.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play();},i.prototype.onRemove=function(){this.pause();},i.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var i=this.map.painter.context,o=i.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,M.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(i,this.canvas,o.RGBA,{premultiply:!0}),this.tiles){var a=this.tiles[r];"loaded"!==a.state&&(a.state="loaded",a.texture=this.texture);}}},i.prototype.serialize=function(){return {type:"canvas",coordinates:this.coordinates}},i.prototype.hasTransition=function(){return this._playing},i.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var i=e[t];if(isNaN(i)||i<=0)return !0}return !1},i}(D),k={vector:S,raster:P,"raster-dem":z,geojson:L,video:A,image:D,canvas:R},B=function(e,i,o,r){var a=new k[i.type](e,i,o,r);if(a.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+a.id);return t.bindAll(["load","abort","unload","serialize","prepare"],a),a};function O(e,i){var o=t.identity([]);return t.translate(o,o,[1,1,0]),t.scale(o,o,[.5*e.width,.5*e.height,1]),t.multiply(o,o,e.calculatePosMatrix(i.toUnwrapped()))}function F(t,e,i,o,r,a){var n=function(t,e,i){if(t)for(var o=0,r=t;o<r.length;o+=1){var a=e[r[o]];if(a&&a.source===i&&"fill-extrusion"===a.type)return !0}else for(var n in e){var s=e[n];if(s.source===i&&"fill-extrusion"===s.type)return !0}return !1}(r&&r.layers,e,t.id),s=a.maxPitchScaleFactor(),l=t.tilesIn(o,s,n);l.sort(U);for(var c=[],u=0,h=l;u<h.length;u+=1){var p=h[u];c.push({wrappedTileID:p.tileID.wrapped().key,queryResults:p.tile.queryRenderedFeatures(e,i,t._state,p.queryGeometry,p.cameraQueryGeometry,p.scale,r,a,s,O(t.transform,p.tileID))});}var d=function(t){for(var e={},i={},o=0,r=t;o<r.length;o+=1){var a=r[o],n=a.queryResults,s=a.wrappedTileID,l=i[s]=i[s]||{};for(var c in n)for(var u=n[c],h=l[c]=l[c]||{},p=e[c]=e[c]||[],d=0,_=u;d<_.length;d+=1){var f=_[d];h[f.featureIndex]||(h[f.featureIndex]=!0,p.push(f));}}return e}(c);for(var _ in d)d[_].forEach((function(e){var i=e.feature,o=t.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o;}));return d}function U(t,e){var i=t.tileID,o=e.tileID;return i.overscaledZ-o.overscaledZ||i.canonical.y-o.canonical.y||i.wrap-o.wrap||i.canonical.x-o.canonical.x}var N=function(t,e){this.max=t,this.onRemove=e,this.reset();};N.prototype.reset=function(){for(var t in this.data)for(var e=0,i=this.data[t];e<i.length;e+=1){var o=i[e];o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);}return this.data={},this.order=[],this},N.prototype.add=function(t,e,i){var o=this,r=t.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);var a={value:e,timeout:void 0};if(void 0!==i&&(a.timeout=setTimeout((function(){o.remove(t,a);}),i)),this.data[r].push(a),this.order.push(r),this.order.length>this.max){var n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n);}return this},N.prototype.has=function(t){return t.wrapped().key in this.data},N.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},N.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},N.prototype.getByKey=function(t){var e=this.data[t];return e?e[0].value:null},N.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},N.prototype.remove=function(t,e){if(!this.has(t))return this;var i=t.wrapped().key,o=void 0===e?0:this.data[i].indexOf(e),r=this.data[i][o];return this.data[i].splice(o,1),r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(r.value),this.order.splice(this.order.indexOf(i),1),this},N.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e);}return this},N.prototype.filter=function(t){var e=[];for(var i in this.data)for(var o=0,r=this.data[i];o<r.length;o+=1){var a=r[o];t(a.value)||e.push(a);}for(var n=0,s=e;n<s.length;n+=1){var l=s[n];this.remove(l.value.tileID,l);}};var Z=function(t,e,i){this.context=t;var o=t.gl;this.buffer=o.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer;};Z.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer);},Z.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer);},Z.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer);};var q={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},j=function(t,e,i,o){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=o,this.context=t;var r=t.gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer;};j.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer);},j.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer);},j.prototype.enableAttributes=function(t,e){for(var i=0;i<this.attributes.length;i++){var o=e.attributes[this.attributes[i].name];void 0!==o&&t.enableVertexAttribArray(o);}},j.prototype.setVertexAttribPointers=function(t,e,i){for(var o=0;o<this.attributes.length;o++){var r=this.attributes[o],a=e.attributes[r.name];void 0!==a&&t.vertexAttribPointer(a,r.components,t[q[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0));}},j.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer);};var V=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1;};V.prototype.get=function(){return this.current},V.prototype.set=function(t){},V.prototype.getDefault=function(){return this.default},V.prototype.setDefault=function(){this.set(this.default);};var G=function(e){function i(){e.apply(this,arguments);}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.getDefault=function(){return t.Color.transparent},i.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1);},i}(V),W=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1);},e}(V),X=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1);},e}(V),H=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return [!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1);},e}(V),K=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return !0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1);},e}(V),Y=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1);},e}(V),J=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return {func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1);},e}(V),Q=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return [t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1);},e}(V),$=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return !1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1;}},e}(V),tt=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return [0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1);},e}(V),et=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return !1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1;}},e}(V),it=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1);},e}(V),ot=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return !1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1;}},e}(V),rt=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return [t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1);},e}(V),at=function(e){function i(){e.apply(this,arguments);}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.getDefault=function(){return t.Color.transparent},i.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1);},i}(V),nt=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1);},e}(V),st=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return !1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1;}},e}(V),lt=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1);},e}(V),ct=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1);},e}(V),ut=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1);},e}(V),ht=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1);},e}(V),pt=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return [0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1);},e}(V),dt=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1;}},e}(V),_t=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1;}},e}(V),ft=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1;}},e}(V),mt=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1;}},e}(V),gt=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1;},e}(V),vt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject;}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1);},e}(V),yt=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1;}},e}(V),xt=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return !1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1;}},e}(V),bt=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return !1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1;}},e}(V),wt=function(t){function e(e,i){t.call(this,e),this.context=e,this.parent=i;}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}(V),Et=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0;},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1;}},e}(wt),Tt=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1;}},e}(wt),It=function(t,e,i,o){this.context=t,this.width=e,this.height=i;var r=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new Et(t,r),o&&(this.depthAttachment=new Tt(t,r));};It.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){var i=this.depthAttachment.get();i&&t.deleteRenderbuffer(i);}t.deleteFramebuffer(this.framebuffer);};var Ct=function(t,e,i){this.func=t,this.mask=e,this.range=i;};Ct.ReadOnly=!1,Ct.ReadWrite=!0,Ct.disabled=new Ct(519,Ct.ReadOnly,[0,1]);var St=function(t,e,i,o,r,a){this.test=t,this.ref=e,this.mask=i,this.fail=o,this.depthFail=r,this.pass=a;};St.disabled=new St({func:519,mask:0},0,0,7680,7680,7680);var Pt=function(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i;};Pt.Replace=[1,0],Pt.disabled=new Pt(Pt.Replace,t.Color.transparent,[!1,!1,!1,!1]),Pt.unblended=new Pt(Pt.Replace,t.Color.transparent,[!0,!0,!0,!0]),Pt.alphaBlended=new Pt([1,771],t.Color.transparent,[!0,!0,!0,!0]);var zt=function(t,e,i){this.enable=t,this.mode=e,this.frontFace=i;};zt.disabled=new zt(!1,1029,2305),zt.backCCW=new zt(!0,1029,2305);var Lt=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new G(this),this.clearDepth=new W(this),this.clearStencil=new X(this),this.colorMask=new H(this),this.depthMask=new K(this),this.stencilMask=new Y(this),this.stencilFunc=new J(this),this.stencilOp=new Q(this),this.stencilTest=new $(this),this.depthRange=new tt(this),this.depthTest=new et(this),this.depthFunc=new it(this),this.blend=new ot(this),this.blendFunc=new rt(this),this.blendColor=new at(this),this.blendEquation=new nt(this),this.cullFace=new st(this),this.cullFaceSide=new lt(this),this.frontFace=new ct(this),this.program=new ut(this),this.activeTexture=new ht(this),this.viewport=new pt(this),this.bindFramebuffer=new dt(this),this.bindRenderbuffer=new _t(this),this.bindTexture=new ft(this),this.bindVertexBuffer=new mt(this),this.bindElementBuffer=new gt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new vt(this),this.pixelStoreUnpack=new yt(this),this.pixelStoreUnpackPremultiplyAlpha=new xt(this),this.pixelStoreUnpackFlipY=new bt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query");};Lt.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault();},Lt.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0;},Lt.prototype.createIndexBuffer=function(t,e){return new Z(this,t,e)},Lt.prototype.createVertexBuffer=function(t,e,i){return new j(this,t,e,i)},Lt.prototype.createRenderbuffer=function(t,e,i){var o=this.gl,r=o.createRenderbuffer();return this.bindRenderbuffer.set(r),o.renderbufferStorage(o.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),r},Lt.prototype.createFramebuffer=function(t,e,i){return new It(this,t,e,i)},Lt.prototype.clear=function(t){var e=t.color,i=t.depth,o=this.gl,r=0;e&&(r|=o.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==i&&(r|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),o.clear(r);},Lt.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace));},Lt.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1);},Lt.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1);},Lt.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Pt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask);},Lt.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null);};var Mt=function(e){function i(i,o,r){var a=this;e.call(this),this.id=i,this.dispatcher=r,this.on("data",(function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(a._sourceLoaded=!0),a._sourceLoaded&&!a._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(a.reload(),a.transform&&a.update(a.transform));})),this.on("error",(function(){a._sourceErrored=!0;})),this._source=B(i,o,r,this),this._tiles={},this._cache=new N(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new t.SourceFeatureState;}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t);},i.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t);},i.prototype.loaded=function(){if(this._sourceErrored)return !0;if(!this._sourceLoaded)return !1;if(!this._source.loaded())return !1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return !1}return !0},i.prototype.getSource=function(){return this._source},i.prototype.pause=function(){this._paused=!0;},i.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform);}},i.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},i.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,(function(){}))},i.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,(function(){}))},i.prototype.serialize=function(){return this._source.serialize()},i.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager);}},i.prototype.getIds=function(){return t.values(this._tiles).map((function(t){return t.tileID})).sort(Dt).map((function(t){return t.key}))},i.prototype.getRenderableIds=function(e){var i=this,o=[];for(var r in this._tiles)this._isIdRenderable(r,e)&&o.push(this._tiles[r]);return e?o.sort((function(e,o){var r=e.tileID,a=o.tileID,n=new t.Point(r.canonical.x,r.canonical.y)._rotate(i.transform.angle),s=new t.Point(a.canonical.x,a.canonical.y)._rotate(i.transform.angle);return r.overscaledZ-a.overscaledZ||s.y-n.y||s.x-n.x})).map((function(t){return t.tileID.key})):o.map((function(t){return t.tileID})).sort(Dt).map((function(t){return t.key}))},i.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return !!e&&this._isIdRenderable(e.tileID.key)},i.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},i.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading");},i.prototype._reloadTile=function(t,e){var i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)));},i.prototype._tileLoaded=function(e,i,o,r){if(r)return e.state="errored",void(404!==r.status?this._source.fire(new t.ErrorEvent(r,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===o&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}));},i.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),i=0;i<e.length;i++){var o=e[i];if(t.neighboringTiles&&t.neighboringTiles[o]){var r=this.getTileByID(o);a(t,r),a(r,t);}}function a(t,e){t.needsHillshadePrepare=!0;var i=e.tileID.canonical.x-t.tileID.canonical.x,o=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),a=e.tileID.key;0===i&&0===o||Math.abs(o)>1||(Math.abs(i)>1&&(1===Math.abs(i+r)?i+=r:1===Math.abs(i-r)&&(i-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,o),t.neighboringTiles&&t.neighboringTiles[a]&&(t.neighboringTiles[a].backfilled=!0)));}},i.prototype.getTile=function(t){return this.getTileByID(t.key)},i.prototype.getTileByID=function(t){return this._tiles[t]},i.prototype._retainLoadedChildren=function(t,e,i,o){for(var r in this._tiles){var a=this._tiles[r];if(!(o[r]||!a.hasData()||a.tileID.overscaledZ<=e||a.tileID.overscaledZ>i)){for(var n=a.tileID;a&&a.tileID.overscaledZ>e+1;){var s=a.tileID.scaledTo(a.tileID.overscaledZ-1);(a=this._tiles[s.key])&&a.hasData()&&(n=s);}for(var l=n;l.overscaledZ>e;)if(t[(l=l.scaledTo(l.overscaledZ-1)).key]){o[n.key]=n;break}}}},i.prototype.findLoadedParent=function(t,e){if(t.key in this._loadedParentTiles){var i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(var o=t.overscaledZ-1;o>=e;o--){var r=t.scaledTo(o),a=this._getLoadedTile(r);if(a)return a}},i.prototype._getLoadedTile=function(t){var e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)},i.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/this._source.tileSize)+1,i=Math.ceil(t.height/this._source.tileSize)+1,o=Math.floor(e*i*5),r="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(r);},i.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var i={};for(var o in this._tiles){var r=this._tiles[o];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),i[r.tileID.key]=r;}for(var a in this._tiles=i,this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(var n in this._tiles)this._setTileReloadTimer(n,this._tiles[n]);}},i.prototype.update=function(e){var o=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var r;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(r=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(r=r.filter((function(t){return o._source.hasTile(t)})))):r=[];var a=e.coveringZoomLevel(this._source),n=Math.max(a-i.maxOverzooming,this._source.minzoom),s=Math.max(a+i.maxUnderzooming,this._source.minzoom),l=this._updateRetainedTiles(r,a);if(At(this._source.type)){for(var c={},u={},h=0,p=Object.keys(l);h<p.length;h+=1){var d=p[h],_=l[d],f=this._tiles[d];if(f&&!(f.fadeEndTime&&f.fadeEndTime<=t.browser.now())){var m=this.findLoadedParent(_,n);m&&(this._addTile(m.tileID),c[m.tileID.key]=m.tileID),u[d]=_;}}for(var g in this._retainLoadedChildren(u,a,s,l),c)l[g]||(this._coveredTiles[g]=!0,l[g]=c[g]);}for(var v in l)this._tiles[v].clearFadeHold();for(var y=0,x=t.keysDifference(this._tiles,l);y<x.length;y+=1){var b=x[y],w=this._tiles[b];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(b);}this._updateLoadedParentTileCache();}},i.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t);},i.prototype._updateRetainedTiles=function(t,e){for(var o={},r={},a=Math.max(e-i.maxOverzooming,this._source.minzoom),n=Math.max(e+i.maxUnderzooming,this._source.minzoom),s={},l=0,c=t;l<c.length;l+=1){var u=c[l],h=this._addTile(u);o[u.key]=u,h.hasData()||e<this._source.maxzoom&&(s[u.key]=u);}this._retainLoadedChildren(s,e,n,o);for(var p=0,d=t;p<d.length;p+=1){var _=d[p],f=this._tiles[_.key];if(!f.hasData()){if(e+1>this._source.maxzoom){var m=_.children(this._source.maxzoom)[0],g=this.getTile(m);if(g&&g.hasData()){o[m.key]=m;continue}}else{var v=_.children(this._source.maxzoom);if(o[v[0].key]&&o[v[1].key]&&o[v[2].key]&&o[v[3].key])continue}for(var y=f.wasRequested(),x=_.overscaledZ-1;x>=a;--x){var b=_.scaledTo(x);if(r[b.key])break;if(r[b.key]=!0,!(f=this.getTile(b))&&y&&(f=this._addTile(b)),f&&(o[b.key]=b,y=f.wasRequested(),f.hasData()))break}}}return o},i.prototype._updateLoadedParentTileCache=function(){for(var t in this._loadedParentTiles={},this._tiles){for(var e=[],i=void 0,o=this._tiles[t].tileID;o.overscaledZ>0;){if(o.key in this._loadedParentTiles){i=this._loadedParentTiles[o.key];break}e.push(o.key);var r=o.scaledTo(o.overscaledZ-1);if(i=this._getLoadedTile(r))break;o=r;}for(var a=0,n=e;a<n.length;a+=1)this._loadedParentTiles[n[a]]=i;}},i.prototype._addTile=function(e){var i=this._tiles[e.key];if(i)return i;(i=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));var o=Boolean(i);return o||(i=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))),i?(i.uses++,this._tiles[e.key]=i,o||this._source.fire(new t.Event("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null},i.prototype._setTileReloadTimer=function(t,e){var i=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var o=e.getExpiryTimeout();o&&(this._timers[t]=setTimeout((function(){i._reloadTile(t,"expired"),delete i._timers[t];}),o));},i.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))));},i.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset();},i.prototype.tilesIn=function(e,i,o){var r=this,a=[],n=this.transform;if(!n)return a;for(var s=o?n.getCameraQueryGeometry(e):e,l=e.map((function(t){return n.pointCoordinate(t)})),c=s.map((function(t){return n.pointCoordinate(t)})),u=this.getIds(),h=1/0,p=1/0,d=-1/0,_=-1/0,f=0,m=c;f<m.length;f+=1){var g=m[f];h=Math.min(h,g.x),p=Math.min(p,g.y),d=Math.max(d,g.x),_=Math.max(_,g.y);}for(var v=function(e){var o=r._tiles[u[e]];if(!o.holdingForFade()){var s=o.tileID,f=Math.pow(2,n.zoom-o.tileID.overscaledZ),m=i*o.queryPadding*t.EXTENT/o.tileSize/f,g=[s.getTilePoint(new t.MercatorCoordinate(h,p)),s.getTilePoint(new t.MercatorCoordinate(d,_))];if(g[0].x-m<t.EXTENT&&g[0].y-m<t.EXTENT&&g[1].x+m>=0&&g[1].y+m>=0){var v=l.map((function(t){return s.getTilePoint(t)})),y=c.map((function(t){return s.getTilePoint(t)}));a.push({tile:o,tileID:s,queryGeometry:v,cameraQueryGeometry:y,scale:f});}}},y=0;y<u.length;y++)v(y);return a},i.prototype.getVisibleCoordinates=function(t){for(var e=this,i=this.getRenderableIds(t).map((function(t){return e._tiles[t].tileID})),o=0,r=i;o<r.length;o+=1){var a=r[o];a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());}return i},i.prototype.hasTransition=function(){if(this._source.hasTransition())return !0;if(At(this._source.type))for(var e in this._tiles){var i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=t.browser.now())return !0}return !1},i.prototype.setFeatureState=function(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i);},i.prototype.removeFeatureState=function(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i);},i.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},i.prototype.setDependencies=function(t,e,i){var o=this._tiles[t];o&&o.setDependencies(e,i);},i.prototype.reloadTilesForDependencies=function(t,e){for(var i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(i,"reloading");this._cache.filter((function(i){return !i.hasDependency(t,e)}));},i}(t.Evented);function Dt(t,e){var i=Math.abs(2*t.wrap)-+(t.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||o-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function At(t){return "raster"===t||"image"===t||"video"===t}function Rt(){return new t.window.Worker(mr.workerUrl)}Mt.maxOverzooming=10,Mt.maxUnderzooming=3;var kt=function(){this.active={};};kt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<kt.workerCount;)this.workers.push(new Rt);return this.active[t]=!0,this.workers.slice()},kt.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach((function(t){t.terminate();})),this.workers=null);};var Bt,Ot=Math.floor(t.browser.hardwareConcurrency/2);function Ft(e,i){var o={};for(var r in e)"ref"!==r&&(o[r]=e[r]);return t.refProperties.forEach((function(t){t in i&&(o[t]=i[t]);})),o}function Ut(t){t=t.slice();for(var e=Object.create(null),i=0;i<t.length;i++)e[t[i].id]=t[i];for(var o=0;o<t.length;o++)"ref"in t[o]&&(t[o]=Ft(t[o],e[t[o].ref]));return t}kt.workerCount=Math.max(Math.min(Ot,6),1);var Nt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Zt(t,e,i){i.push({command:Nt.addSource,args:[t,e[t]]});}function qt(t,e,i){e.push({command:Nt.removeSource,args:[t]}),i[t]=!0;}function jt(t,e,i,o){qt(t,i,o),Zt(t,e,i);}function Vt(e,i,o){var r;for(r in e[o])if(e[o].hasOwnProperty(r)&&"data"!==r&&!t.deepEqual(e[o][r],i[o][r]))return !1;for(r in i[o])if(i[o].hasOwnProperty(r)&&"data"!==r&&!t.deepEqual(e[o][r],i[o][r]))return !1;return !0}function Gt(e,i,o,r,a,n){var s;for(s in i=i||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],i[s])||o.push({command:n,args:[r,s,i[s],a]}));for(s in i)i.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],i[s])||o.push({command:n,args:[r,s,i[s],a]}));}function Wt(t){return t.id}function Xt(t,e){return t[e.id]=e,t}var Ht=function(t,e,i){var o=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(var a=0;a<this.xCellCount*this.yCellCount;a++)o.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0;};function Kt(e,i,o,r,a){var n=t.create();return i?(t.scale(n,n,[1/a,1/a,1]),o||t.rotateZ(n,n,r.angle)):t.multiply(n,r.labelPlaneMatrix,e),n}function Yt(e,i,o,r,a){if(i){var n=t.clone(e);return t.scale(n,n,[a,a,1]),o||t.rotateZ(n,n,-r.angle),n}return r.glCoordMatrix}function Jt(e,i){var o=[e.x,e.y,0,1];se(o,o,i);var r=o[3];return {point:new t.Point(o[0]/r,o[1]/r),signedDistanceFromCamera:r}}function Qt(t,e){var i=t[0]/t[3],o=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&o>=-e[1]&&o<=e[1]}function $t(e,i,o,r,a,n,s,l){var c=r?e.textSizeData:e.iconSizeData,u=t.evaluateSizeForZoom(c,o.transform.zoom),h=[256/o.width*2+1,256/o.height*2+1],p=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();for(var d=e.lineVertexArray,_=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,f=o.transform.width/o.transform.height,m=!1,g=0;g<_.length;g++){var v=_.get(g);if(v.hidden||v.writingMode===t.WritingMode.vertical&&!m)ne(v.numGlyphs,p);else{m=!1;var y=[v.anchorX,v.anchorY,0,1];if(t.transformMat4(y,y,i),Qt(y,h)){var x=.5+y[3]/o.transform.cameraToCenterDistance*.5,b=t.evaluateSizeForFeature(c,u,v),w=s?b*x:b/x,E=new t.Point(v.anchorX,v.anchorY),T=Jt(E,a).point,I={},C=ie(v,w,!1,l,i,a,n,e.glyphOffsetArray,d,p,T,E,I,f);m=C.useVertical,(C.notEnoughRoom||m||C.needsFlipping&&ie(v,w,!0,l,i,a,n,e.glyphOffsetArray,d,p,T,E,I,f).notEnoughRoom)&&ne(v.numGlyphs,p);}else ne(v.numGlyphs,p);}}r?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p);}function te(t,e,i,o,r,a,n,s,l,c,u,h){var p=s.glyphStartIndex+s.numGlyphs,d=s.lineStartIndex,_=s.lineStartIndex+s.lineLength,f=e.getoffsetX(s.glyphStartIndex),m=e.getoffsetX(p-1),g=re(t*f,i,o,r,a,n,s.segment,d,_,l,c,u,h);if(!g)return null;var v=re(t*m,i,o,r,a,n,s.segment,d,_,l,c,u,h);return v?{first:g,last:v}:null}function ee(e,i,o,r){return e===t.WritingMode.horizontal&&Math.abs(o.y-i.y)>Math.abs(o.x-i.x)*r?{useVertical:!0}:(e===t.WritingMode.vertical?i.y<o.y:i.x>o.x)?{needsFlipping:!0}:null}function ie(e,i,o,r,a,n,s,l,c,u,h,p,d,_){var f,m=i/24,g=e.lineOffsetX*m,v=e.lineOffsetY*m;if(e.numGlyphs>1){var y=e.glyphStartIndex+e.numGlyphs,x=e.lineStartIndex,b=e.lineStartIndex+e.lineLength,w=te(m,l,g,v,o,h,p,e,c,n,d,!1);if(!w)return {notEnoughRoom:!0};var E=Jt(w.first.point,s).point,T=Jt(w.last.point,s).point;if(r&&!o){var I=ee(e.writingMode,E,T,_);if(I)return I}f=[w.first];for(var C=e.glyphStartIndex+1;C<y-1;C++)f.push(re(m*l.getoffsetX(C),g,v,o,h,p,e.segment,x,b,c,n,d,!1));f.push(w.last);}else{if(r&&!o){var S=Jt(p,a).point,P=e.lineStartIndex+e.segment+1,z=new t.Point(c.getx(P),c.gety(P)),L=Jt(z,a),M=L.signedDistanceFromCamera>0?L.point:oe(p,z,S,1,a),D=ee(e.writingMode,S,M,_);if(D)return D}var A=re(m*l.getoffsetX(e.glyphStartIndex),g,v,o,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,c,n,d,!1);if(!A)return {notEnoughRoom:!0};f=[A];}for(var R=0,k=f;R<k.length;R+=1){var B=k[R];t.addDynamicAttributes(u,B.point,B.angle);}return {}}function oe(t,e,i,o,r){var a=Jt(t.add(t.sub(e)._unit()),r).point,n=i.sub(a);return i.add(n._mult(o/n.mag()))}function re(e,i,o,r,a,n,s,l,c,u,h,p,d){var _=r?e-i:e+i,f=_>0?1:-1,m=0;r&&(f*=-1,m=Math.PI),f<0&&(m+=Math.PI);for(var g=f>0?l+s:l+s+1,v=g,y=a,x=a,b=0,w=0,E=Math.abs(_);b+w<=E;){if((g+=f)<l||g>=c)return null;if(x=y,void 0===(y=p[g])){var T=new t.Point(u.getx(g),u.gety(g)),I=Jt(T,h);if(I.signedDistanceFromCamera>0)y=p[g]=I.point;else{var C=g-f;y=oe(0===b?n:new t.Point(u.getx(C),u.gety(C)),T,x,E-b+1,h);}}b+=w,w=x.dist(y);}var S=(E-b)/w,P=y.sub(x),z=P.mult(S)._add(x);return z._add(P._unit()._perp()._mult(o*f)),{point:z,angle:m+Math.atan2(y.y-x.y,y.x-x.x),tileDistance:d?{prevTileDistance:g-f===v?0:u.gettileUnitDistanceFromAnchor(g-f),lastSegmentViewportDistance:E-b}:null}}Ht.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ht.prototype.insert=function(t,e,i,o,r){this._forEachCell(e,i,o,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(r);},Ht.prototype.insertCircle=function(t,e,i,o){this._forEachCell(e-o,i-o,e+o,i+o,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(o);},Ht.prototype._insertBoxCell=function(t,e,i,o,r,a){this.boxCells[r].push(a);},Ht.prototype._insertCircleCell=function(t,e,i,o,r,a){this.circleCells[r].push(a);},Ht.prototype._query=function(t,e,i,o,r,a){if(i<0||t>this.width||o<0||e>this.height)return !r&&[];var n=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=o){if(r)return !0;for(var s=0;s<this.boxKeys.length;s++)n.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var l=0;l<this.circleKeys.length;l++){var c=this.circles[3*l],u=this.circles[3*l+1],h=this.circles[3*l+2];n.push({key:this.circleKeys[l],x1:c-h,y1:u-h,x2:c+h,y2:u+h});}return a?n.filter(a):n}return this._forEachCell(t,e,i,o,this._queryCell,n,{hitTest:r,seenUids:{box:{},circle:{}}},a),r?n.length>0:n},Ht.prototype._queryCircle=function(t,e,i,o,r){var a=t-i,n=t+i,s=e-i,l=e+i;if(n<0||a>this.width||l<0||s>this.height)return !o&&[];var c=[];return this._forEachCell(a,s,n,l,this._queryCellCircle,c,{hitTest:o,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},r),o?c.length>0:c},Ht.prototype.query=function(t,e,i,o,r){return this._query(t,e,i,o,!1,r)},Ht.prototype.hitTest=function(t,e,i,o,r){return this._query(t,e,i,o,!0,r)},Ht.prototype.hitTestCircle=function(t,e,i,o){return this._queryCircle(t,e,i,!0,o)},Ht.prototype._queryCell=function(t,e,i,o,r,a,n,s){var l=n.seenUids,c=this.boxCells[r];if(null!==c)for(var u=this.bboxes,h=0,p=c;h<p.length;h+=1){var d=p[h];if(!l.box[d]){l.box[d]=!0;var _=4*d;if(t<=u[_+2]&&e<=u[_+3]&&i>=u[_+0]&&o>=u[_+1]&&(!s||s(this.boxKeys[d]))){if(n.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[d],x1:u[_],y1:u[_+1],x2:u[_+2],y2:u[_+3]});}}}var f=this.circleCells[r];if(null!==f)for(var m=this.circles,g=0,v=f;g<v.length;g+=1){var y=v[g];if(!l.circle[y]){l.circle[y]=!0;var x=3*y;if(this._circleAndRectCollide(m[x],m[x+1],m[x+2],t,e,i,o)&&(!s||s(this.circleKeys[y]))){if(n.hitTest)return a.push(!0),!0;var b=m[x],w=m[x+1],E=m[x+2];a.push({key:this.circleKeys[y],x1:b-E,y1:w-E,x2:b+E,y2:w+E});}}}},Ht.prototype._queryCellCircle=function(t,e,i,o,r,a,n,s){var l=n.circle,c=n.seenUids,u=this.boxCells[r];if(null!==u)for(var h=this.bboxes,p=0,d=u;p<d.length;p+=1){var _=d[p];if(!c.box[_]){c.box[_]=!0;var f=4*_;if(this._circleAndRectCollide(l.x,l.y,l.radius,h[f+0],h[f+1],h[f+2],h[f+3])&&(!s||s(this.boxKeys[_])))return a.push(!0),!0}}var m=this.circleCells[r];if(null!==m)for(var g=this.circles,v=0,y=m;v<y.length;v+=1){var x=y[v];if(!c.circle[x]){c.circle[x]=!0;var b=3*x;if(this._circlesCollide(g[b],g[b+1],g[b+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[x])))return a.push(!0),!0}}},Ht.prototype._forEachCell=function(t,e,i,o,r,a,n,s){for(var l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(o),p=l;p<=u;p++)for(var d=c;d<=h;d++)if(r.call(this,t,e,i,o,this.xCellCount*d+p,a,n,s))return},Ht.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Ht.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Ht.prototype._circlesCollide=function(t,e,i,o,r,a){var n=o-t,s=r-e,l=i+a;return l*l>n*n+s*s},Ht.prototype._circleAndRectCollide=function(t,e,i,o,r,a,n){var s=(a-o)/2,l=Math.abs(t-(o+s));if(l>s+i)return !1;var c=(n-r)/2,u=Math.abs(e-(r+c));if(u>c+i)return !1;if(l<=s||u<=c)return !0;var h=l-s,p=u-c;return h*h+p*p<=i*i};var ae=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ne(t,e){for(var i=0;i<t;i++){var o=e.length;e.resize(o+4),e.float32.set(ae,3*o);}}function se(t,e,i){var o=e[0],r=e[1];return t[0]=i[0]*o+i[4]*r+i[12],t[1]=i[1]*o+i[5]*r+i[13],t[3]=i[3]*o+i[7]*r+i[15],t}var le=function(t,e,i){void 0===e&&(e=new Ht(t.width+200,t.height+200,25)),void 0===i&&(i=new Ht(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=i,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200;};function ce(t,e,i){t[e+4]=i?1:0;}function ue(e,i,o){return i*(t.EXTENT/(e.tileSize*Math.pow(2,o-e.tileID.overscaledZ)))}le.prototype.placeCollisionBox=function(t,e,i,o,r){var a=this.projectAndGetPerspectiveRatio(o,t.anchorPointX,t.anchorPointY),n=i*a.perspectiveRatio,s=t.x1*n+a.point.x,l=t.y1*n+a.point.y,c=t.x2*n+a.point.x,u=t.y2*n+a.point.y;return !this.isInsideGrid(s,l,c,u)||!e&&this.grid.hitTest(s,l,c,u,r)?{box:[],offscreen:!1}:{box:[s,l,c,u],offscreen:this.isOffscreen(s,l,c,u)}},le.prototype.approximateTileDistance=function(t,e,i,o,r){var a=t.lastSegmentViewportDistance*i;return t.prevTileDistance+a+((r?1:o/this.pitchfactor)-1)*a*Math.abs(Math.sin(e))},le.prototype.placeCollisionCircles=function(e,i,o,r,a,n,s,l,c,u,h,p,d){var _=[],f=this.projectAnchor(c,a.anchorX,a.anchorY),m=l/24,g=a.lineOffsetX*l,v=a.lineOffsetY*l,y=new t.Point(a.anchorX,a.anchorY),x=te(m,s,g,v,!1,Jt(y,u).point,y,a,n,u,{},!0),b=!1,w=!1,E=!0,T=f.perspectiveRatio*r,I=1/(r*o),C=0,S=0;x&&(C=this.approximateTileDistance(x.first.tileDistance,x.first.angle,I,f.cameraDistance,p),S=this.approximateTileDistance(x.last.tileDistance,x.last.angle,I,f.cameraDistance,p));for(var P=0;P<e.length;P+=5){var z=e[P],L=e[P+1],M=e[P+2],D=e[P+3];if(!x||D<-C||D>S)ce(e,P,!1);else{var A=this.projectPoint(c,z,L),R=M*T;if(_.length>0){var k=A.x-_[_.length-4],B=A.y-_[_.length-3];if(R*R*2>k*k+B*B&&P+8<e.length){var O=e[P+8];if(O>-C&&O<S){ce(e,P,!1);continue}}}_.push(A.x,A.y,R,P/5),ce(e,P,!0);var F=A.x-R,U=A.y-R,N=A.x+R,Z=A.y+R;if(E=E&&this.isOffscreen(F,U,N,Z),w=w||this.isInsideGrid(F,U,N,Z),!i&&this.grid.hitTestCircle(A.x,A.y,R,d)){if(!h)return {circles:[],offscreen:!1};b=!0;}}}return {circles:b||!w?[]:_,offscreen:E}},le.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return {};for(var i=[],o=1/0,r=1/0,a=-1/0,n=-1/0,s=0,l=e;s<l.length;s+=1){var c=l[s],u=new t.Point(c.x+100,c.y+100);o=Math.min(o,u.x),r=Math.min(r,u.y),a=Math.max(a,u.x),n=Math.max(n,u.y),i.push(u);}for(var h={},p={},d=0,_=this.grid.query(o,r,a,n).concat(this.ignoredGrid.query(o,r,a,n));d<_.length;d+=1){var f=_[d],m=f.key;if(void 0===h[m.bucketInstanceId]&&(h[m.bucketInstanceId]={}),!h[m.bucketInstanceId][m.featureIndex]){var g=[new t.Point(f.x1,f.y1),new t.Point(f.x2,f.y1),new t.Point(f.x2,f.y2),new t.Point(f.x1,f.y2)];t.polygonIntersectsPolygon(i,g)&&(h[m.bucketInstanceId][m.featureIndex]=!0,void 0===p[m.bucketInstanceId]&&(p[m.bucketInstanceId]=[]),p[m.bucketInstanceId].push(m.featureIndex));}}return p},le.prototype.insertCollisionBox=function(t,e,i,o,r){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:o,collisionGroupID:r},t[0],t[1],t[2],t[3]);},le.prototype.insertCollisionCircles=function(t,e,i,o,r){for(var a=e?this.ignoredGrid:this.grid,n={bucketInstanceId:i,featureIndex:o,collisionGroupID:r},s=0;s<t.length;s+=4)a.insertCircle(n,t[s],t[s+1],t[s+2]);},le.prototype.projectAnchor=function(t,e,i){var o=[e,i,0,1];return se(o,o,t),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/o[3]*.5,cameraDistance:o[3]}},le.prototype.projectPoint=function(e,i,o){var r=[i,o,0,1];return se(r,r,e),new t.Point((r[0]/r[3]+1)/2*this.transform.width+100,(-r[1]/r[3]+1)/2*this.transform.height+100)},le.prototype.projectAndGetPerspectiveRatio=function(e,i,o){var r=[i,o,0,1];return se(r,r,e),{point:new t.Point((r[0]/r[3]+1)/2*this.transform.width+100,(-r[1]/r[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/r[3]*.5}},le.prototype.isOffscreen=function(t,e,i,o){return i<100||t>=this.screenRightBoundary||o<100||e>this.screenBottomBoundary},le.prototype.isInsideGrid=function(t,e,i,o){return i>=0&&t<this.gridRightBoundary&&o>=0&&e<this.gridBottomBoundary};var he=function(t,e,i,o){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):o&&i?1:0,this.placed=i;};he.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var pe=function(t,e,i,o,r){this.text=new he(t?t.text:null,e,i,r),this.icon=new he(t?t.icon:null,e,o,r);};pe.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var de=function(t,e,i){this.text=t,this.icon=e,this.skipFade=i;},_e=function(t,e,i,o,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=o,this.tileID=r;},fe=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={};};function me(e,i,o,r,a){var n=t.getAnchorAlignment(e),s=-(n.horizontalAlign-.5)*i,l=-(n.verticalAlign-.5)*o,c=t.evaluateVariableOffset(e,r);return new t.Point(s+c[0]*a,l+c[1]*a)}function ge(e,i,o,r,a,n){var s=e.x1,l=e.x2,c=e.y1,u=e.y2,h=e.anchorPointX,p=e.anchorPointY,d=new t.Point(i,o);return r&&d._rotate(a?n:-n),{x1:s+d.x,y1:c+d.y,x2:l+d.x,y2:u+d.y,anchorPointX:h,anchorPointY:p}}fe.prototype.get=function(t){if(this.crossSourceCollisions)return {ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}};}return this.collisionGroups[t]};var ve=function(t,e,i,o){this.transform=t.clone(),this.collisionIndex=new le(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new fe(i),this.prevPlacement=o,o&&(o.prevPlacement=void 0),this.placedOrientations={};};function ye(t,e,i,o,r){t.emplaceBack(e?1:0,i?1:0,o||0,r||0),t.emplaceBack(e?1:0,i?1:0,o||0,r||0),t.emplaceBack(e?1:0,i?1:0,o||0,r||0),t.emplaceBack(e?1:0,i?1:0,o||0,r||0);}ve.prototype.getBucketParts=function(e,i,o,r){var a=o.getBucket(i),n=o.latestFeatureIndex;if(a&&n&&i.id===a.layerIds[0]){var s=o.collisionBoxArray,l=a.layers[0].layout,c=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),u=o.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),p=Kt(h,"map"===l.get("text-pitch-alignment"),"map"===l.get("text-rotation-alignment"),this.transform,ue(o,1,this.transform.zoom));this.retainedQueryData[a.bucketInstanceId]=new _e(a.bucketInstanceId,n,a.sourceLayerIndex,a.index,o.tileID);var d={bucket:a,layout:l,posMatrix:h,textLabelPlaneMatrix:p,scale:c,textPixelRatio:u,holdingForFade:o.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(a.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(r)for(var _=0,f=a.sortKeyRanges;_<f.length;_+=1){var m=f[_];e.push({sortKey:m.sortKey,symbolInstanceStart:m.symbolInstanceStart,symbolInstanceEnd:m.symbolInstanceEnd,parameters:d});}else e.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:d});}},ve.prototype.attemptAnchorPlacement=function(t,e,i,o,r,a,n,s,l,c,u,h,p,d,_){var f,m=[h.textOffset0,h.textOffset1],g=me(t,i,o,m,r),v=this.collisionIndex.placeCollisionBox(ge(e,g.x,g.y,a,n,this.transform.angle),u,s,l,c.predicate);if(!_||0!==this.collisionIndex.placeCollisionBox(ge(_,g.x,g.y,a,n,this.transform.angle),u,s,l,c.predicate).box.length)return v.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(f=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:m,width:i,height:o,anchor:t,textBoxScale:r,prevAnchor:f},this.markUsedJustification(p,t,h,d),p.allowVerticalPlacement&&(this.markUsedOrientation(p,d,h),this.placedOrientations[h.crossTileID]=d),{shift:g,placedGlyphBoxes:v}):void 0},ve.prototype.placeLayerBucketPart=function(e,i,o){var r=this,a=e.parameters,n=a.bucket,s=a.layout,l=a.posMatrix,c=a.textLabelPlaneMatrix,u=a.scale,h=a.textPixelRatio,p=a.holdingForFade,d=a.collisionBoxArray,_=a.partiallyEvaluatedTextSize,f=a.collisionGroup,m=s.get("text-optional"),g=s.get("icon-optional"),v=s.get("text-allow-overlap"),y=s.get("icon-allow-overlap"),x="map"===s.get("text-rotation-alignment"),b="map"===s.get("text-pitch-alignment"),w="none"!==s.get("icon-text-fit"),E="viewport-y"===s.get("symbol-z-order"),T=v&&(y||!n.hasIconData()||g),I=y&&(v||!n.hasTextData()||m);!n.collisionArrays&&d&&n.deserializeCollisionBoxes(d);var C=function(e,a){if(!i[e.crossTileID])if(p)r.placements[e.crossTileID]=new de(!1,!1,!1);else{var d,E=!1,C=!1,S=!0,P=null,z={box:null,offscreen:null},L={box:null,offscreen:null},M=null,D=null,A=0,R=0,k=0;a.textFeatureIndex&&(A=a.textFeatureIndex),a.verticalTextFeatureIndex&&(R=a.verticalTextFeatureIndex);var B=a.textBox;if(B){var O=function(i){var o=t.WritingMode.horizontal;if(n.allowVerticalPlacement&&!i&&r.prevPlacement){var a=r.prevPlacement.placedOrientations[e.crossTileID];a&&(r.placedOrientations[e.crossTileID]=a,r.markUsedOrientation(n,o=a,e));}return o},F=function(i,o){if(n.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&a.verticalTextBox)for(var r=0,s=n.writingModes;r<s.length&&(s[r]===t.WritingMode.vertical?(z=o(),L=z):z=i(),!(z&&z.box&&z.box.length));r+=1);else z=i();};if(s.get("text-variable-anchor")){var U=s.get("text-variable-anchor");if(r.prevPlacement&&r.prevPlacement.variableOffsets[e.crossTileID]){var N=r.prevPlacement.variableOffsets[e.crossTileID];U.indexOf(N.anchor)>0&&(U=U.filter((function(t){return t!==N.anchor}))).unshift(N.anchor);}var Z=function(t,i,o){for(var a=t.x2-t.x1,s=t.y2-t.y1,c=e.textBoxScale,u=w&&!y?i:null,p={box:[],offscreen:!1},d=v?2*U.length:U.length,_=0;_<d;++_){var m=r.attemptAnchorPlacement(U[_%U.length],t,a,s,c,x,b,h,l,f,_>=U.length,e,n,o,u);if(m&&(p=m.placedGlyphBoxes)&&p.box&&p.box.length){E=!0,P=m.shift;break}}return p};F((function(){return Z(B,a.iconBox,t.WritingMode.horizontal)}),(function(){var i=a.verticalTextBox;return n.allowVerticalPlacement&&!(z&&z.box&&z.box.length)&&e.numVerticalGlyphVertices>0&&i?Z(i,a.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}})),z&&(E=z.box,S=z.offscreen);var q=O(z&&z.box);if(!E&&r.prevPlacement){var j=r.prevPlacement.variableOffsets[e.crossTileID];j&&(r.variableOffsets[e.crossTileID]=j,r.markUsedJustification(n,j.anchor,e,q));}}else{var V=function(t,i){var o=r.collisionIndex.placeCollisionBox(t,v,h,l,f.predicate);return o&&o.box&&o.box.length&&(r.markUsedOrientation(n,i,e),r.placedOrientations[e.crossTileID]=i),o};F((function(){return V(B,t.WritingMode.horizontal)}),(function(){var i=a.verticalTextBox;return n.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&i?V(i,t.WritingMode.vertical):{box:null,offscreen:null}})),O(z&&z.box&&z.box.length);}}E=(d=z)&&d.box&&d.box.length>0,S=d&&d.offscreen;var G=a.textCircles;if(G){var W=n.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),X=t.evaluateSizeForFeature(n.textSizeData,_,W);M=r.collisionIndex.placeCollisionCircles(G,v,u,h,W,n.lineVertexArray,n.glyphOffsetArray,X,l,c,o,b,f.predicate),E=v||M.circles.length>0,S=S&&M.offscreen;}if(a.iconFeatureIndex&&(k=a.iconFeatureIndex),a.iconBox){var H=function(t){var e=w&&P?ge(t,P.x,P.y,x,b,r.transform.angle):t;return r.collisionIndex.placeCollisionBox(e,y,h,l,f.predicate)};C=L&&L.box&&L.box.length&&a.verticalIconBox?(D=H(a.verticalIconBox)).box.length>0:(D=H(a.iconBox)).box.length>0,S=S&&D.offscreen;}var K=m||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,Y=g||0===e.numIconVertices;K||Y?Y?K||(C=C&&E):E=C&&E:C=E=C&&E,E&&d&&d.box&&r.collisionIndex.insertCollisionBox(d.box,s.get("text-ignore-placement"),n.bucketInstanceId,L&&L.box&&R?R:A,f.ID),C&&D&&r.collisionIndex.insertCollisionBox(D.box,s.get("icon-ignore-placement"),n.bucketInstanceId,k,f.ID),E&&M&&r.collisionIndex.insertCollisionCircles(M.circles,s.get("text-ignore-placement"),n.bucketInstanceId,A,f.ID),r.placements[e.crossTileID]=new de(E||T,C||I,S||n.justReloaded),i[e.crossTileID]=!0;}};if(E)for(var S=n.getSortedSymbolIndexes(this.transform.angle),P=S.length-1;P>=0;--P){var z=S[P];C(n.symbolInstances.get(z),n.collisionArrays[z]);}else for(var L=e.symbolInstanceStart;L<e.symbolInstanceEnd;L++)C(n.symbolInstances.get(L),n.collisionArrays[L]);n.justReloaded=!1;},ve.prototype.markUsedJustification=function(e,i,o,r){var a;a=r===t.WritingMode.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(i)];for(var n=0,s=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];n<s.length;n+=1){var l=s[n];l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=a>=0&&l!==a?0:o.crossTileID);}},ve.prototype.markUsedOrientation=function(e,i,o){for(var r=i===t.WritingMode.horizontal||i===t.WritingMode.horizontalOnly?i:0,a=i===t.WritingMode.vertical?i:0,n=0,s=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];n<s.length;n+=1)e.text.placedSymbolArray.get(s[n]).placedOrientation=r;o.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=a);},ve.prototype.commit=function(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;var e=this.prevPlacement,i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;var o=e?e.symbolFadeChange(t):1,r=e?e.opacities:{},a=e?e.variableOffsets:{},n=e?e.placedOrientations:{};for(var s in this.placements){var l=this.placements[s],c=r[s];c?(this.opacities[s]=new pe(c,o,l.text,l.icon),i=i||l.text!==c.text.placed||l.icon!==c.icon.placed):(this.opacities[s]=new pe(null,o,l.text,l.icon,l.skipFade),i=i||l.text||l.icon);}for(var u in r){var h=r[u];if(!this.opacities[u]){var p=new pe(h,o,!1,!1);p.isHidden()||(this.opacities[u]=p,i=i||h.text.placed||h.icon.placed);}}for(var d in a)this.variableOffsets[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.variableOffsets[d]=a[d]);for(var _ in n)this.placedOrientations[_]||!this.opacities[_]||this.opacities[_].isHidden()||(this.placedOrientations[_]=n[_]);i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t);},ve.prototype.updateLayerOpacities=function(t,e){for(var i={},o=0,r=e;o<r.length;o+=1){var a=r[o],n=a.getBucket(t);n&&a.latestFeatureIndex&&t.id===n.layerIds[0]&&this.updateBucketOpacities(n,i,a.collisionBoxArray);}},ve.prototype.updateBucketOpacities=function(e,i,o){var r=this;e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear(),e.hasIconCollisionCircleData()&&e.iconCollisionCircle.collisionVertexArray.clear(),e.hasTextCollisionCircleData()&&e.textCollisionCircle.collisionVertexArray.clear();var a=e.layers[0].layout,n=new pe(null,0,!1,!1,!0),s=a.get("text-allow-overlap"),l=a.get("icon-allow-overlap"),c=a.get("text-variable-anchor"),u="map"===a.get("text-rotation-alignment"),h="map"===a.get("text-pitch-alignment"),p="none"!==a.get("icon-text-fit"),d=new pe(null,0,s&&(l||!e.hasIconData()||a.get("icon-optional")),l&&(s||!e.hasTextData()||a.get("text-optional")),!0);!e.collisionArrays&&o&&(e.hasIconCollisionBoxData()||e.hasIconCollisionCircleData()||e.hasTextCollisionBoxData()||e.hasTextCollisionCircleData())&&e.deserializeCollisionBoxes(o);for(var _=function(t,e,i){for(var o=0;o<e/4;o++)t.opacityVertexArray.emplaceBack(i);},f=function(o){var a=e.symbolInstances.get(o),s=a.numHorizontalGlyphVertices,l=a.numVerticalGlyphVertices,f=a.crossTileID,m=i[f],g=r.opacities[f];m?g=n:g||(r.opacities[f]=g=d),i[f]=!0;var v=a.numIconVertices>0,y=r.placedOrientations[a.crossTileID],x=y===t.WritingMode.vertical,b=y===t.WritingMode.horizontal||y===t.WritingMode.horizontalOnly;if(s>0||l>0){var w=Se(g.text);_(e.text,s,x?Pe:w),_(e.text,l,b?Pe:w);var E=g.text.isHidden();[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=E||x?1:0);})),a.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).hidden=E||b?1:0);var T=r.variableOffsets[a.crossTileID];T&&r.markUsedJustification(e,T.anchor,a,y);var I=r.placedOrientations[a.crossTileID];I&&(r.markUsedJustification(e,"left",a,I),r.markUsedOrientation(e,I,a));}if(v){var C=Se(g.icon),S=!(p&&a.verticalPlacedIconSymbolIndex&&x);a.placedIconSymbolIndex>=0&&(_(e.icon,a.numIconVertices,S?C:Pe),e.icon.placedSymbolArray.get(a.placedIconSymbolIndex).hidden=g.icon.isHidden()),a.verticalPlacedIconSymbolIndex>=0&&(_(e.icon,a.numVerticalIconVertices,S?Pe:C),e.icon.placedSymbolArray.get(a.verticalPlacedIconSymbolIndex).hidden=g.icon.isHidden());}if(e.hasIconCollisionBoxData()||e.hasIconCollisionCircleData()||e.hasTextCollisionBoxData()||e.hasTextCollisionCircleData()){var P=e.collisionArrays[o];if(P){var z=new t.Point(0,0);if(P.textBox||P.verticalTextBox){var L=!0;if(c){var M=r.variableOffsets[f];M?(z=me(M.anchor,M.width,M.height,M.textOffset,M.textBoxScale),u&&z._rotate(h?r.transform.angle:-r.transform.angle)):L=!1;}P.textBox&&ye(e.textCollisionBox.collisionVertexArray,g.text.placed,!L||x,z.x,z.y),P.verticalTextBox&&ye(e.textCollisionBox.collisionVertexArray,g.text.placed,!L||b,z.x,z.y);}var D=Boolean(!b&&P.verticalIconBox);P.iconBox&&ye(e.iconCollisionBox.collisionVertexArray,g.icon.placed,D,p?z.x:0,p?z.y:0),P.verticalIconBox&&ye(e.iconCollisionBox.collisionVertexArray,g.icon.placed,!D,p?z.x:0,p?z.y:0);var A=P.textCircles;if(A&&e.hasTextCollisionCircleData())for(var R=0;R<A.length;R+=5)ye(e.textCollisionCircle.collisionVertexArray,g.text.placed,m||0===A[R+4]);}}},m=0;m<e.symbolInstances.length;m++)f(m);e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.hasIconCollisionCircleData()&&e.iconCollisionCircle.collisionVertexBuffer&&e.iconCollisionCircle.collisionVertexBuffer.updateData(e.iconCollisionCircle.collisionVertexArray),e.hasTextCollisionCircleData()&&e.textCollisionCircle.collisionVertexBuffer&&e.textCollisionCircle.collisionVertexBuffer.updateData(e.textCollisionCircle.collisionVertexArray);},ve.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},ve.prototype.zoomAdjustment=function(t){return Math.max(0,(this.transform.zoom-t)/1.5)},ve.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},ve.prototype.stillRecent=function(t,e){var i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t},ve.prototype.setStale=function(){this.stale=!0;};var xe=Math.pow(2,25),be=Math.pow(2,24),we=Math.pow(2,17),Ee=Math.pow(2,16),Te=Math.pow(2,9),Ie=Math.pow(2,8),Ce=Math.pow(2,1);function Se(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*xe+e*be+i*we+e*Ee+i*Te+e*Ie+i*Ce+e}var Pe=0,ze=function(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[];};ze.prototype.continuePlacement=function(t,e,i,o,r){for(var a=this._bucketParts;this._currentTileIndex<t.length;)if(e.getBucketParts(a,o,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return !0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((function(t,e){return t.sortKey-e.sortKey})));this._currentPartIndex<a.length;)if(e.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,r())return !0;return !1};var Le=function(t,e,i,o,r,a,n){this.placement=new ve(t,r,a,n),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=o,this._done=!1;};Le.prototype.isDone=function(){return this._done},Le.prototype.continuePlacement=function(e,i,o){for(var r=this,a=t.browser.now(),n=function(){var e=t.browser.now()-a;return !r._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=i[e[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){if(this._inProgressLayer||(this._inProgressLayer=new ze(s)),this._inProgressLayer.continuePlacement(o[s.source],this.placement,this._showCollisionBoxes,s,n))return;delete this._inProgressLayer;}this._currentPlacementIndex--;}this._done=!0;},Le.prototype.commit=function(t){return this.placement.commit(t),this.placement};var Me=512/t.EXTENT/2,De=function(t,e,i){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(var o=0;o<e.length;o++){var r=e.get(o),a=r.key;this.indexedSymbolInstances[a]||(this.indexedSymbolInstances[a]=[]),this.indexedSymbolInstances[a].push({crossTileID:r.crossTileID,coord:this.getScaledCoordinates(r,t)});}};De.prototype.getScaledCoordinates=function(e,i){var o=Me/Math.pow(2,i.canonical.z-this.tileID.canonical.z);return {x:Math.floor((i.canonical.x*t.EXTENT+e.anchorX)*o),y:Math.floor((i.canonical.y*t.EXTENT+e.anchorY)*o)}},De.prototype.findMatches=function(t,e,i){for(var o=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),r=0;r<t.length;r++){var a=t.get(r);if(!a.crossTileID){var n=this.indexedSymbolInstances[a.key];if(n)for(var s=this.getScaledCoordinates(a,e),l=0,c=n;l<c.length;l+=1){var u=c[l];if(Math.abs(u.coord.x-s.x)<=o&&Math.abs(u.coord.y-s.y)<=o&&!i[u.crossTileID]){i[u.crossTileID]=!0,a.crossTileID=u.crossTileID;break}}}}};var Ae=function(){this.maxCrossTileID=0;};Ae.prototype.generate=function(){return ++this.maxCrossTileID};var Re=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0;};Re.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var i in this.indexes){var o=this.indexes[i],r={};for(var a in o){var n=o[a];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),r[n.tileID.key]=n;}this.indexes[i]=r;}this.lng=t;},Re.prototype.addBucket=function(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return !1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key]);}for(var o=0;o<e.symbolInstances.length;o++)e.symbolInstances.get(o).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var r=this.usedCrossTileIDs[t.overscaledZ];for(var a in this.indexes){var n=this.indexes[a];if(Number(a)>t.overscaledZ)for(var s in n){var l=n[s];l.tileID.isChildOf(t)&&l.findMatches(e.symbolInstances,t,r);}else{var c=n[t.scaledTo(Number(a)).key];c&&c.findMatches(e.symbolInstances,t,r);}}for(var u=0;u<e.symbolInstances.length;u++){var h=e.symbolInstances.get(u);h.crossTileID||(h.crossTileID=i.generate(),r[h.crossTileID]=!0);}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new De(t,e.symbolInstances,e.bucketInstanceId),!0},Re.prototype.removeBucketCrossTileIDs=function(t,e){for(var i in e.indexedSymbolInstances)for(var o=0,r=e.indexedSymbolInstances[i];o<r.length;o+=1)delete this.usedCrossTileIDs[t][r[o].crossTileID];},Re.prototype.removeStaleBuckets=function(t){var e=!1;for(var i in this.indexes){var o=this.indexes[i];for(var r in o)t[o[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,o[r]),delete o[r],e=!0);}return e};var ke=function(){this.layerIndexes={},this.crossTileIDs=new Ae,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={};};ke.prototype.addLayer=function(t,e,i){var o=this.layerIndexes[t.id];void 0===o&&(o=this.layerIndexes[t.id]=new Re);var r=!1,a={};o.handleWrapJump(i);for(var n=0,s=e;n<s.length;n+=1){var l=s[n],c=l.getBucket(t);c&&t.id===c.layerIds[0]&&(c.bucketInstanceId||(c.bucketInstanceId=++this.maxBucketInstanceId),o.addBucket(l.tileID,c,this.crossTileIDs)&&(r=!0),a[c.bucketInstanceId]=!0);}return o.removeStaleBuckets(a)&&(r=!0),r},ke.prototype.pruneUnusedLayers=function(t){var e={};for(var i in t.forEach((function(t){e[t]=!0;})),this.layerIndexes)e[i]||delete this.layerIndexes[i];};var Be=function(e,i){return t.emitValidationErrors(e,i&&i.filter((function(t){return "source.canvas"!==t.identifier})))},Oe=t.pick(Nt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Fe=t.pick(Nt,["setCenter","setZoom","setBearing","setPitch"]),Ue=function(){var e={},i=t.styleSpec.$version;for(var o in t.styleSpec.$root){var r,a=t.styleSpec.$root[o];if(a.required)null!=(r="version"===o?i:"array"===a.type?[]:{})&&(e[o]=r);}return e}(),Ne=function(e){function i(o,r){var a=this;void 0===r&&(r={}),e.call(this),this.map=o,this.dispatcher=new T((Bt||(Bt=new kt),Bt),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new y(o._requestManager,r.localIdeographFontFamily),this.lineAtlas=new E(256,512),this.crossTileSymbolIndex=new ke,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var n=this;this._rtlTextPluginCallback=i.registerForPluginStateChange((function(e){n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(function(e,i){if(t.triggerPluginCompletionEvent(e),i&&i.every((function(t){return t})))for(var o in n.sourceCaches)n.sourceCaches[o].reload();}));})),this.on("data",(function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=a.sourceCaches[t.sourceId];if(e){var i=e.getSource();if(i&&i.vectorLayerIds)for(var o in a._layers){var r=a._layers[o];r.source===i.id&&a._validateLayer(r);}}}}));}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.loadURL=function(e,i){var o=this;void 0===i&&(i={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var r="boolean"==typeof i.validate?i.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,i.accessToken);var a=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(a,(function(e,i){o._request=null,e?o.fire(new t.ErrorEvent(e)):i&&o._load(i,r);}));},i.prototype.loadJSON=function(e,i){var o=this;void 0===i&&(i={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame((function(){o._request=null,o._load(e,!1!==i.validate);}));},i.prototype.loadEmpty=function(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ue,!1);},i.prototype._load=function(e,i){if(!i||!Be(this,t.validateStyle(e))){for(var o in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(o,e.sources[o],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var r=Ut(this.stylesheet.layers);this._order=r.map((function(t){return t.id})),this._layers={},this._serializedLayers={};for(var a=0,n=r;a<n.length;a+=1){var s=n[a];(s=t.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize();}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"));}},i.prototype._loadSprite=function(e){var i=this;this._spriteRequest=function(e,i,o){var r,a,n,s=t.browser.devicePixelRatio>1?"@2x":"",l=t.getJSON(i.transformRequest(i.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(function(t,e){l=null,n||(n=t,r=e,u());})),c=t.getImage(i.transformRequest(i.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(function(t,e){c=null,n||(n=t,a=e,u());}));function u(){if(n)o(n);else if(r&&a){var e=t.browser.getImageData(a),i={};for(var s in r){var l=r[s],c=l.width,u=l.height,h=l.x,p=l.y,d=l.sdf,_=l.pixelRatio,f=l.stretchX,m=l.stretchY,g=l.content,v=new t.RGBAImage({width:c,height:u});t.RGBAImage.copy(e,v,{x:h,y:p},{x:0,y:0},{width:c,height:u}),i[s]={data:v,pixelRatio:_,sdf:d,stretchX:f,stretchY:m,content:g};}o(null,i);}}return {cancel:function(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null);}}}(e,this.map._requestManager,(function(e,o){if(i._spriteRequest=null,e)i.fire(new t.ErrorEvent(e));else if(o)for(var r in o)i.imageManager.addImage(r,o[r]);i.imageManager.setLoaded(!0),i._availableImages=i.imageManager.listImages(),i.dispatcher.broadcast("setImages",i._availableImages),i.fire(new t.Event("data",{dataType:"style"}));}));},i.prototype._validateLayer=function(e){var i=this.sourceCaches[e.source];if(i){var o=e.sourceLayer;if(o){var r=i.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(o))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+o+'" does not exist on source "'+r.id+'" as specified by style layer "'+e.id+'"')));}}},i.prototype.loaded=function(){if(!this._loaded)return !1;if(Object.keys(this._updatedSources).length)return !1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return !1;return !!this.imageManager.isLoaded()},i.prototype._serializeLayers=function(t){for(var e=[],i=0,o=t;i<o.length;i+=1){var r=this._layers[o[i]];"custom"!==r.type&&e.push(r.serialize());}return e},i.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return !0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return !0;for(var e in this._layers)if(this._layers[e].hasTransition())return !0;return !1},i.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},i.prototype.update=function(e){if(this._loaded){var i=this._changed;if(this._changed){var o=Object.keys(this._updatedLayers),r=Object.keys(this._removedLayers);for(var a in (o.length||r.length)&&this._updateWorkerLayers(o,r),this._updatedSources){var n=this._updatedSources[a];"reload"===n?this._reloadSource(a):"clear"===n&&this._clearSource(a);}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates();}for(var l in this.sourceCaches)this.sourceCaches[l].used=!1;for(var c=0,u=this._order;c<u.length;c+=1){var h=this._layers[u[c]];h.recalculate(e,this._availableImages),!h.isHidden(e.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0);}this.light.recalculate(e),this.z=e.zoom,i&&this.fire(new t.Event("data",{dataType:"style"}));}},i.prototype._updateTilesForChangedImages=function(){var t=Object.keys(this._changedImages);if(t.length){for(var e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={};}},i.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e});},i.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={};},i.prototype.setState=function(e){var i=this;if(this._checkLoaded(),Be(this,t.validateStyle(e)))return !1;(e=t.clone$1(e)).layers=Ut(e.layers);var o=function(e,i){if(!e)return [{command:Nt.setStyle,args:[i]}];var o=[];try{if(!t.deepEqual(e.version,i.version))return [{command:Nt.setStyle,args:[i]}];t.deepEqual(e.center,i.center)||o.push({command:Nt.setCenter,args:[i.center]}),t.deepEqual(e.zoom,i.zoom)||o.push({command:Nt.setZoom,args:[i.zoom]}),t.deepEqual(e.bearing,i.bearing)||o.push({command:Nt.setBearing,args:[i.bearing]}),t.deepEqual(e.pitch,i.pitch)||o.push({command:Nt.setPitch,args:[i.pitch]}),t.deepEqual(e.sprite,i.sprite)||o.push({command:Nt.setSprite,args:[i.sprite]}),t.deepEqual(e.glyphs,i.glyphs)||o.push({command:Nt.setGlyphs,args:[i.glyphs]}),t.deepEqual(e.transition,i.transition)||o.push({command:Nt.setTransition,args:[i.transition]}),t.deepEqual(e.light,i.light)||o.push({command:Nt.setLight,args:[i.light]});var r={},a=[];!function(e,i,o,r){var a;for(a in i=i||{},e=e||{})e.hasOwnProperty(a)&&(i.hasOwnProperty(a)||qt(a,o,r));for(a in i)i.hasOwnProperty(a)&&(e.hasOwnProperty(a)?t.deepEqual(e[a],i[a])||("geojson"===e[a].type&&"geojson"===i[a].type&&Vt(e,i,a)?o.push({command:Nt.setGeoJSONSourceData,args:[a,i[a].data]}):jt(a,i,o,r)):Zt(a,i,o));}(e.sources,i.sources,a,r);var n=[];e.layers&&e.layers.forEach((function(t){r[t.source]?o.push({command:Nt.removeLayer,args:[t.id]}):n.push(t);})),o=o.concat(a),function(e,i,o){i=i||[];var r,a,n,s,l,c,u,h=(e=e||[]).map(Wt),p=i.map(Wt),d=e.reduce(Xt,{}),_=i.reduce(Xt,{}),f=h.slice(),m=Object.create(null);for(r=0,a=0;r<h.length;r++)_.hasOwnProperty(n=h[r])?a++:(o.push({command:Nt.removeLayer,args:[n]}),f.splice(f.indexOf(n,a),1));for(r=0,a=0;r<p.length;r++)f[f.length-1-r]!==(n=p[p.length-1-r])&&(d.hasOwnProperty(n)?(o.push({command:Nt.removeLayer,args:[n]}),f.splice(f.lastIndexOf(n,f.length-a),1)):a++,o.push({command:Nt.addLayer,args:[_[n],c=f[f.length-r]]}),f.splice(f.length-r,0,n),m[n]=!0);for(r=0;r<p.length;r++)if(s=d[n=p[r]],l=_[n],!m[n]&&!t.deepEqual(s,l))if(t.deepEqual(s.source,l.source)&&t.deepEqual(s["source-layer"],l["source-layer"])&&t.deepEqual(s.type,l.type)){for(u in Gt(s.layout,l.layout,o,n,null,Nt.setLayoutProperty),Gt(s.paint,l.paint,o,n,null,Nt.setPaintProperty),t.deepEqual(s.filter,l.filter)||o.push({command:Nt.setFilter,args:[n,l.filter]}),t.deepEqual(s.minzoom,l.minzoom)&&t.deepEqual(s.maxzoom,l.maxzoom)||o.push({command:Nt.setLayerZoomRange,args:[n,l.minzoom,l.maxzoom]}),s)s.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?Gt(s[u],l[u],o,n,u.slice(6),Nt.setPaintProperty):t.deepEqual(s[u],l[u])||o.push({command:Nt.setLayerProperty,args:[n,u,l[u]]}));for(u in l)l.hasOwnProperty(u)&&!s.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?Gt(s[u],l[u],o,n,u.slice(6),Nt.setPaintProperty):t.deepEqual(s[u],l[u])||o.push({command:Nt.setLayerProperty,args:[n,u,l[u]]}));}else o.push({command:Nt.removeLayer,args:[n]}),c=f[f.lastIndexOf(n)+1],o.push({command:Nt.addLayer,args:[l,c]});}(n,i.layers,o);}catch(t){console.warn("Unable to compute style diff:",t),o=[{command:Nt.setStyle,args:[i]}];}return o}(this.serialize(),e).filter((function(t){return !(t.command in Fe)}));if(0===o.length)return !1;var r=o.filter((function(t){return !(t.command in Oe)}));if(r.length>0)throw new Error("Unimplemented: "+r.map((function(t){return t.command})).join(", ")+".");return o.forEach((function(t){"setTransition"!==t.command&&i[t.command].apply(i,t.args);})),this.stylesheet=e,!0},i.prototype.addImage=function(e,i){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,i),this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.fire(new t.Event("data",{dataType:"style"}));},i.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e);},i.prototype.getImage=function(t){return this.imageManager.getImage(t)},i.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.fire(new t.Event("data",{dataType:"style"}));},i.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},i.prototype.addSource=function(e,i,o){var r=this;if(void 0===o&&(o={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!i.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(i).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,i,null,o))){this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);var a=this.sourceCaches[e]=new Mt(e,i,this.dispatcher);a.style=this,a.setEventedParent(this,(function(){return {isSourceLoaded:r.loaded(),source:a.serialize(),sourceId:e}})),a.onAdd(this.map),this._changed=!0;}},i.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var i in this._layers)if(this._layers[i].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+i+'" is using it.')));var o=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],o.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.clearTiles(),o.onRemove&&o.onRemove(this.map),this._changed=!0;},i.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0;},i.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},i.prototype.addLayer=function(e,i,o){void 0===o&&(o={}),this._checkLoaded();var r=e.id;if(this.getLayer(r))this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" already exists on this map')));else{var a;if("custom"===e.type){if(Be(this,t.validateCustomStyleLayer(e)))return;a=t.createStyleLayer(e);}else{if("object"==typeof e.source&&(this.addSource(r,e.source),e=t.clone$1(e),e=t.extend(e,{source:r})),this._validate(t.validateStyle.layer,"layers."+r,e,{arrayIndex:-1},o))return;a=t.createStyleLayer(e),this._validateLayer(a),a.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[a.id]=a.serialize();}var n=i?this._order.indexOf(i):this._order.length;if(i&&-1===n)this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" does not exist on this map.')));else{if(this._order.splice(n,0,r),this._layerOrderChanged=!0,this._layers[r]=a,this._removedLayers[r]&&a.source&&"custom"!==a.type){var s=this._removedLayers[r];delete this._removedLayers[r],s.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause());}this._updateLayer(a),a.onAdd&&a.onAdd(this.map);}}},i.prototype.moveLayer=function(e,i){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==i){var o=this._order.indexOf(e);this._order.splice(o,1);var r=i?this._order.indexOf(i):this._order.length;i&&-1===r?this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" does not exist on this map.'))):(this._order.splice(r,0,e),this._layerOrderChanged=!0);}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")));},i.prototype.removeLayer=function(e){this._checkLoaded();var i=this._layers[e];if(i){i.setEventedParent(null);var o=this._order.indexOf(e);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map);}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")));},i.prototype.getLayer=function(t){return this._layers[t]},i.prototype.hasLayer=function(t){return t in this._layers},i.prototype.setLayerZoomRange=function(e,i,o){this._checkLoaded();var r=this.getLayer(e);r?r.minzoom===i&&r.maxzoom===o||(null!=i&&(r.minzoom=i),null!=o&&(r.maxzoom=o),this._updateLayer(r)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")));},i.prototype.setFilter=function(e,i,o){void 0===o&&(o={}),this._checkLoaded();var r=this.getLayer(e);if(r){if(!t.deepEqual(r.filter,i))return null==i?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(t.validateStyle.filter,"layers."+r.id+".filter",i,null,o)||(r.filter=t.clone$1(i),this._updateLayer(r)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")));},i.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},i.prototype.setLayoutProperty=function(e,i,o,r){void 0===r&&(r={}),this._checkLoaded();var a=this.getLayer(e);a?t.deepEqual(a.getLayoutProperty(i),o)||(a.setLayoutProperty(i,o,r),this._updateLayer(a)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")));},i.prototype.getLayoutProperty=function(e,i){var o=this.getLayer(e);if(o)return o.getLayoutProperty(i);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")));},i.prototype.setPaintProperty=function(e,i,o,r){void 0===r&&(r={}),this._checkLoaded();var a=this.getLayer(e);a?t.deepEqual(a.getPaintProperty(i),o)||(a.setPaintProperty(i,o,r)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")));},i.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},i.prototype.setFeatureState=function(e,i){this._checkLoaded();var o=e.source,r=e.sourceLayer,a=this.sourceCaches[o];if(void 0!==a){var n=a.getSource().type;"geojson"===n&&r?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==n||r?(void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),a.setFeatureState(r,e.id,i)):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));}else this.fire(new t.ErrorEvent(new Error("The source '"+o+"' does not exist in the map's style.")));},i.prototype.removeFeatureState=function(e,i){this._checkLoaded();var o=e.source,r=this.sourceCaches[o];if(void 0!==r){var a=r.getSource().type,n="vector"===a?e.sourceLayer:void 0;"vector"!==a||n?i&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is requred to remove its specific state property."))):r.removeFeatureState(n,e.id,i):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));}else this.fire(new t.ErrorEvent(new Error("The source '"+o+"' does not exist in the map's style.")));},i.prototype.getFeatureState=function(e){this._checkLoaded();var i=e.source,o=e.sourceLayer,r=this.sourceCaches[i];if(void 0!==r){if("vector"!==r.getSource().type||o)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),r.getFeatureState(o,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));}else this.fire(new t.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")));},i.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},i.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(function(t){return t.serialize()})),layers:this._serializeLayers(this._order)},(function(t){return void 0!==t}))},i.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0;},i.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,i=function(t){return "fill-extrusion"===e._layers[t].type},o={},r=[],a=this._order.length-1;a>=0;a--){var n=this._order[a];if(i(n)){o[n]=a;for(var s=0,l=t;s<l.length;s+=1){var c=l[s][n];if(c)for(var u=0,h=c;u<h.length;u+=1)r.push(h[u]);}}}r.sort((function(t,e){return e.intersectionZ-t.intersectionZ}));for(var p=[],d=this._order.length-1;d>=0;d--){var _=this._order[d];if(i(_))for(var f=r.length-1;f>=0;f--){var m=r[f].feature;if(o[m.layer.id]<d)break;p.push(m),r.pop();}else for(var g=0,v=t;g<v.length;g+=1){var y=v[g][_];if(y)for(var x=0,b=y;x<b.length;x+=1)p.push(b[x].feature);}}return p},i.prototype.queryRenderedFeatures=function(e,i,o){i&&i.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",i.filter,null,i);var r={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var a=0,n=i.layers;a<n.length;a+=1){var s=n[a],l=this._layers[s];if(!l)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];r[l.source]=!0;}}var c=[];for(var u in i.availableImages=this._availableImages,this.sourceCaches)i.layers&&!r[u]||c.push(F(this.sourceCaches[u],this._layers,this._serializedLayers,e,i,o));return this.placement&&c.push(function(t,e,i,o,r,a,n){for(var s={},l=a.queryRenderedSymbols(o),c=[],u=0,h=Object.keys(l).map(Number);u<h.length;u+=1)c.push(n[h[u]]);c.sort(U);for(var p=function(){var i=_[d],o=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],e,i.bucketIndex,i.sourceLayerIndex,r.filter,r.layers,r.availableImages,t);for(var a in o){var n=s[a]=s[a]||[],c=o[a];c.sort((function(t,e){var o=i.featureSortOrder;if(o){var r=o.indexOf(t.featureIndex);return o.indexOf(e.featureIndex)-r}return e.featureIndex-t.featureIndex}));for(var u=0,h=c;u<h.length;u+=1)n.push(h[u]);}},d=0,_=c;d<_.length;d+=1)p();var f=function(e){s[e].forEach((function(o){var r=o.feature,a=i[t[e].source].getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=a;}));};for(var m in s)f(m);return s}(this._layers,this._serializedLayers,this.sourceCaches,e,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(c)},i.prototype.querySourceFeatures=function(e,i){i&&i.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",i.filter,null,i);var o=this.sourceCaches[e];return o?function(t,e){for(var i=t.getRenderableIds().map((function(e){return t.getTileByID(e)})),o=[],r={},a=0;a<i.length;a++){var n=i[a],s=n.tileID.canonical.key;r[s]||(r[s]=!0,n.querySourceFeatures(o,e));}return o}(o,i):[]},i.prototype.addSourceType=function(t,e,o){return i.getSourceType(t)?o(new Error('A source type called "'+t+'" already exists.')):(i.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},o):o(null,null))},i.prototype.getLight=function(){return this.light.getLight()},i.prototype.setLight=function(e,i){void 0===i&&(i={}),this._checkLoaded();var o=this.light.getLight(),r=!1;for(var a in e)if(!t.deepEqual(e[a],o[a])){r=!0;break}if(r){var n={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(n);}},i.prototype._validate=function(e,i,o,r,a){return void 0===a&&(a={}),(!a||!1!==a.validate)&&Be(this,e.call(t.validateStyle,t.extend({key:i,style:this.serialize(),value:o,styleSpec:t.styleSpec},r)))},i.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[e].setEventedParent(null);for(var i in this.sourceCaches)this.sourceCaches[i].clearTiles(),this.sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove();},i.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles();},i.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload();},i.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t);},i.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t);},i.prototype._updatePlacement=function(e,i,o,r,a){void 0===a&&(a=!1);for(var n=!1,s=!1,l={},c=0,u=this._order;c<u.length;c+=1){var h=this._layers[u[c]];if("symbol"===h.type){if(!l[h.source]){var p=this.sourceCaches[h.source];l[h.source]=p.getRenderableIds(!0).map((function(t){return p.getTileByID(t)})).sort((function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)}));}var d=this.crossTileSymbolIndex.addLayer(h,l[h.source],e.center.lng);n=n||d;}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((a=a||this._layerOrderChanged||0===o)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now(),e.zoom))&&(this.pauseablePlacement=new Le(e,this._order,a,i,o,r,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),s=!0),n&&this.pauseablePlacement.placement.setStale()),s||n)for(var _=0,f=this._order;_<f.length;_+=1){var m=this._layers[f[_]];"symbol"===m.type&&this.placement.updateLayerOpacities(m,l[m.source]);}return !this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},i.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles();},i.prototype.getImages=function(t,e,i){this.imageManager.getImages(e.icons,i),this._updateTilesForChangedImages();var o=this.sourceCaches[e.source];o&&o.setDependencies(e.tileID.key,e.type,e.icons);},i.prototype.getGlyphs=function(t,e,i){this.glyphManager.getGlyphs(e.stacks,i);},i.prototype.getResource=function(e,i,o){return t.makeRequest(i,o)},i}(t.Evented);Ne.getSourceType=function(t){return k[t]},Ne.setSourceType=function(t,e){k[t]=e;},Ne.registerForPluginStateChange=t.registerForPluginStateChange;var Ze=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),qe=_i("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),je=_i("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ve=_i("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ge=_i("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),We=_i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Xe=_i("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),He=_i("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ke=_i("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Ye=_i("uniform float u_overscale_factor;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {float alpha=0.5;vec4 color=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {color=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {color*=.2;}float extrude_scale_length=length(v_extrude_scale);float extrude_length=length(v_extrude)*extrude_scale_length;float stroke_width=15.0*extrude_scale_length/u_overscale_factor;float radius=v_radius*extrude_scale_length;float distance_to_edge=abs(extrude_length-radius);float opacity_t=smoothstep(-stroke_width,0.0,-distance_to_edge);gl_FragColor=opacity_t*color;}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);highp float padding_factor=1.2;gl_Position.xy+=a_extrude*u_extrude_scale*padding_factor*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;v_radius=abs(a_extrude.y);v_extrude=a_extrude*padding_factor;v_extrude_scale=u_extrude_scale*u_camera_to_center_distance*collision_perspective_ratio;}"),Je=_i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Qe=_i("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),$e=_i("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),ti=_i("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),ei=_i("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),ii=_i("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),oi=_i("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),ri=_i("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform float u_maxzoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggeration=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/ pow(2.0,(u_zoom-u_maxzoom)*exaggeration+19.2562-u_zoom);gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ai=_i("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ni=_i("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),si=_i("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,vec2(v_lineprogress,0.5));gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define MAX_LINE_DISTANCE 32767.0\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_lineprogress=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0/MAX_LINE_DISTANCE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),li=_i("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),ci=_i("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),ui=_i("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),hi=_i("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),pi=_i("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),di=_i("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function _i(t,e){var i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o={};return {fragmentSource:t=t.replace(i,(function(t,e,i,r,a){return o[a]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+a+"\nvarying "+i+" "+r+" "+a+";\n#else\nuniform "+i+" "+r+" u_"+a+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+a+"\n    "+i+" "+r+" "+a+" = u_"+a+";\n#endif\n"})),vertexSource:e=e.replace(i,(function(t,e,i,r,a){var n="float"===r?"vec2":"vec4",s=a.match(/color/)?"color":n;return o[a]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+a+"\nuniform lowp float u_"+a+"_t;\nattribute "+i+" "+n+" a_"+a+";\nvarying "+i+" "+r+" "+a+";\n#else\nuniform "+i+" "+r+" u_"+a+";\n#endif\n":"vec4"===s?"\n#ifndef HAS_UNIFORM_u_"+a+"\n    "+a+" = a_"+a+";\n#else\n    "+i+" "+r+" "+a+" = u_"+a+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+a+"\n    "+a+" = unpack_mix_"+s+"(a_"+a+", u_"+a+"_t);\n#else\n    "+i+" "+r+" "+a+" = u_"+a+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+a+"\nuniform lowp float u_"+a+"_t;\nattribute "+i+" "+n+" a_"+a+";\n#else\nuniform "+i+" "+r+" u_"+a+";\n#endif\n":"vec4"===s?"\n#ifndef HAS_UNIFORM_u_"+a+"\n    "+i+" "+r+" "+a+" = a_"+a+";\n#else\n    "+i+" "+r+" "+a+" = u_"+a+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+a+"\n    "+i+" "+r+" "+a+" = unpack_mix_"+s+"(a_"+a+", u_"+a+"_t);\n#else\n    "+i+" "+r+" "+a+" = u_"+a+";\n#endif\n"}))}}var fi=Object.freeze({__proto__:null,prelude:qe,background:je,backgroundPattern:Ve,circle:Ge,clippingMask:We,heatmap:Xe,heatmapTexture:He,collisionBox:Ke,collisionCircle:Ye,debug:Je,fill:Qe,fillOutline:$e,fillOutlinePattern:ti,fillPattern:ei,fillExtrusion:ii,fillExtrusionPattern:oi,hillshadePrepare:ri,hillshade:ai,line:ni,lineGradient:si,linePattern:li,lineSDF:ci,raster:ui,symbolIcon:hi,symbolSDF:pi,symbolTextAndIcon:di}),mi=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null;};mi.prototype.bind=function(t,e,i,o,r,a,n,s){this.context=t;for(var l=this.boundPaintVertexBuffers.length!==o.length,c=0;!l&&c<o.length;c++)this.boundPaintVertexBuffers[c]!==o[c]&&(l=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===i&&!l&&this.boundIndexBuffer===r&&this.boundVertexOffset===a&&this.boundDynamicVertexBuffer===n&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),n&&n.bind(),r&&r.dynamicDraw&&r.bind(),s&&s.bind()):this.freshBind(e,i,o,r,a,n,s);},mi.prototype.freshBind=function(t,e,i,o,r,a,n){var s,l=t.numAttributes,c=this.context,u=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=o,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=n;else{s=c.currentNumAttributes||0;for(var h=l;h<s;h++)u.disableVertexAttribArray(h);}e.enableAttributes(u,t);for(var p=0,d=i;p<d.length;p+=1)d[p].enableAttributes(u,t);a&&a.enableAttributes(u,t),n&&n.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,r);for(var _=0,f=i;_<f.length;_+=1){var m=f[_];m.bind(),m.setVertexAttribPointers(u,t,r);}a&&(a.bind(),a.setVertexAttribPointers(u,t,r)),o&&o.bind(),n&&(n.bind(),n.setVertexAttribPointers(u,t,r)),c.currentNumAttributes=l;},mi.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null);};var gi=function(t,e,i,o,r){var a=t.gl;this.program=a.createProgram();var n=i?i.defines():[];r&&n.push("#define OVERDRAW_INSPECTOR;");var s=n.concat(qe.fragmentSource,e.fragmentSource).join("\n"),l=n.concat(qe.vertexSource,e.vertexSource).join("\n"),c=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(c,s),a.compileShader(c),a.attachShader(this.program,c);var u=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(u,l),a.compileShader(u),a.attachShader(this.program,u);for(var h=i?i.layoutAttributes:[],p=0;p<h.length;p++)a.bindAttribLocation(this.program,p,h[p].name);a.linkProgram(this.program),this.numAttributes=a.getProgramParameter(this.program,a.ACTIVE_ATTRIBUTES),this.attributes={};for(var d={},_=0;_<this.numAttributes;_++){var f=a.getActiveAttrib(this.program,_);f&&(this.attributes[f.name]=a.getAttribLocation(this.program,f.name));}for(var m=a.getProgramParameter(this.program,a.ACTIVE_UNIFORMS),g=0;g<m;g++){var v=a.getActiveUniform(this.program,g);v&&(d[v.name]=a.getUniformLocation(this.program,v.name));}this.fixedUniforms=o(t,d),this.binderUniforms=i?i.getUniforms(t,d):[];}}};function vi(t,e,i){var o=1/ue(i,1,e.transform.tileZoom),r=Math.pow(2,i.tileID.overscaledZ),a=i.tileSize*Math.pow(2,e.transform.tileZoom)/r,n=a*(i.tileID.canonical.x+i.tileID.wrap*r),s=a*i.tileID.canonical.y;return {u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[o,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[n>>16,s>>16],u_pixel_coord_lower:[65535&n,65535&s]}}gi.prototype.draw=function(t,e,i,o,r,a,n,s,l,c,u,h,p,d,_,f){var m,g=t.gl;if(!this.failedToCreate){for(var v in t.program.set(this.program),t.setDepthMode(i),t.setStencilMode(o),t.setColorMode(r),t.setCullFace(a),this.fixedUniforms)this.fixedUniforms[v].set(n[v]);d&&d.setUniforms(t,this.binderUniforms,h,{zoom:p});for(var y=(m={},m[g.LINES]=2,m[g.TRIANGLES]=3,m[g.LINE_STRIP]=1,m)[e],x=0,b=u.get();x<b.length;x+=1){var w=b[x],E=w.vaos||(w.vaos={});(E[s]||(E[s]=new mi)).bind(t,this,l,d?d.getPaintVertexBuffers():[],c,w.vertexOffset,_,f),g.drawElements(e,w.primitiveLength*y,g.UNSIGNED_SHORT,w.primitiveOffset*y*2);}}};var yi=function(e,i,o,r){var a=i.style.light,n=a.properties.get("position"),s=[n.x,n.y,n.z],l=t.create$1();"viewport"===a.properties.get("anchor")&&t.fromRotation(l,-i.transform.angle),t.transformMat3(s,s,l);var c=a.properties.get("color");return {u_matrix:e,u_lightpos:s,u_lightintensity:a.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+o,u_opacity:r}},xi=function(e,i,o,r,a,n,s){return t.extend(yi(e,i,o,r),vi(n,i,s),{u_height_factor:-Math.pow(2,a.overscaledZ)/s.tileSize/8})},bi=function(t){return {u_matrix:t}},wi=function(e,i,o,r){return t.extend(bi(e),vi(o,i,r))},Ei=function(t,e){return {u_matrix:t,u_world:e}},Ti=function(e,i,o,r,a){return t.extend(wi(e,i,o,r),{u_world:a})},Ii=function(e,i,o,r){var a,n,s=e.transform;if("map"===r.paint.get("circle-pitch-alignment")){var l=ue(o,1,s.zoom);a=!0,n=[l,l];}else a=!1,n=s.pixelsToGLUnits;return {u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===r.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(i.posMatrix,o,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor")),u_pitch_with_map:+a,u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:n}},Ci=function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,i.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,i.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,i.u_overscale_factor)}},Si=function(t,e,i){var o=ue(i,1,e.zoom),r=Math.pow(2,e.zoom-i.tileID.overscaledZ),a=i.tileID.overscaleFactor();return {u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:o,u_extrude_scale:[e.pixelsToGLUnits[0]/(o*r),e.pixelsToGLUnits[1]/(o*r)],u_overscale_factor:a}},Pi=function(t,e,i){return void 0===i&&(i=1),{u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}},zi=function(t){return {u_matrix:t}},Li=function(t,e,i,o){return {u_matrix:t,u_extrude_scale:ue(e,1,i),u_intensity:o}},Mi=function(e,i,o){var r=o.paint.get("hillshade-shadow-color"),a=o.paint.get("hillshade-highlight-color"),n=o.paint.get("hillshade-accent-color"),s=o.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===o.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var l,c,u,h=!e.options.moving;return {u_matrix:e.transform.calculatePosMatrix(i.tileID.toUnwrapped(),h),u_image:0,u_latrange:(l=i.tileID,c=Math.pow(2,l.canonical.z),u=l.canonical.y,[new t.MercatorCoordinate(0,u/c).toLngLat().lat,new t.MercatorCoordinate(0,(u+1)/c).toLngLat().lat]),u_light:[o.paint.get("hillshade-exaggeration"),s],u_shadow:r,u_highlight:a,u_accent:n}},Di=function(e,i,o){var r=i.stride,a=t.create();return t.ortho(a,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(a,a,[0,-t.EXTENT,0]),{u_matrix:a,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_maxzoom:o,u_unpack:i.getUnpackVector()}},Ai=function(e,i,o){var r=e.transform;return {u_matrix:Fi(e,i,o),u_ratio:1/ue(i,1,r.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/r.pixelsToGLUnits[0],1/r.pixelsToGLUnits[1]]}},Ri=function(e,i,o){return t.extend(Ai(e,i,o),{u_image:0})},ki=function(e,i,o,r){var a=e.transform,n=Oi(i,a);return {u_matrix:Fi(e,i,o),u_texsize:i.imageAtlasTexture.size,u_ratio:1/ue(i,1,a.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[n,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},Bi=function(e,i,o,r,a){var n=e.lineAtlas,s=Oi(i,e.transform),l="round"===o.layout.get("line-cap"),c=n.getDash(r.from,l),u=n.getDash(r.to,l),h=c.width*a.fromScale,p=u.width*a.toScale;return t.extend(Ai(e,i,o),{u_patternscale_a:[s/h,-c.height/2],u_patternscale_b:[s/p,-u.height/2],u_sdfgamma:n.width/(256*Math.min(h,p)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:c.y,u_tex_y_b:u.y,u_mix:a.t})};function Oi(t,e){return 1/ue(t,1,e.tileZoom)}function Fi(t,e,i){return t.translatePosMatrix(e.tileID.posMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}var Ui=function(t,e,i,o,r){return {u_matrix:t,u_tl_parent:e,u_scale_parent:i,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(n=r.paint.get("raster-saturation"),n>0?1-1/(1.001-n):-n),u_contrast_factor:(a=r.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:Ni(r.paint.get("raster-hue-rotate"))};var a,n;};function Ni(t){t*=Math.PI/180;var e=Math.sin(t),i=Math.cos(t);return [(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}var Zi=function(t,e,i,o,r,a,n,s,l,c){var u=r.transform;return {u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:u.cameraToCenterDistance,u_pitch:u.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:u.width/u.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:n,u_coord_matrix:s,u_is_text:+l,u_pitch_with_map:+o,u_texsize:c,u_texture:0}},qi=function(e,i,o,r,a,n,s,l,c,u,h){var p=a.transform;return t.extend(Zi(e,i,o,r,a,n,s,l,c,u),{u_gamma_scale:r?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+h})},ji=function(e,i,o,r,a,n,s,l,c,u){return t.extend(qi(e,i,o,r,a,n,s,l,!0,c,!0),{u_texsize_icon:u,u_texture_icon:1})},Vi=function(t,e,i){return {u_matrix:t,u_opacity:e,u_color:i}},Gi=function(e,i,o,r,a,n){return t.extend(function(t,e,i,o){var r=i.imageManager.getPattern(t.from.toString()),a=i.imageManager.getPattern(t.to.toString()),n=i.imageManager.getPixelSize(),s=n.width,l=n.height,c=Math.pow(2,o.tileID.overscaledZ),u=o.tileSize*Math.pow(2,i.transform.tileZoom)/c,h=u*(o.tileID.canonical.x+o.tileID.wrap*c),p=u*o.tileID.canonical.y;return {u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[s,l],u_mix:e.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/ue(o,1,i.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(r,n,o,a),{u_matrix:e,u_opacity:i})},Wi={fillExtrusion:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_lightpos:new t.Uniform3f(e,i.u_lightpos),u_lightintensity:new t.Uniform1f(e,i.u_lightintensity),u_lightcolor:new t.Uniform3f(e,i.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,i.u_vertical_gradient),u_opacity:new t.Uniform1f(e,i.u_opacity)}},fillExtrusionPattern:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_lightpos:new t.Uniform3f(e,i.u_lightpos),u_lightintensity:new t.Uniform1f(e,i.u_lightintensity),u_lightcolor:new t.Uniform3f(e,i.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,i.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,i.u_height_factor),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade),u_opacity:new t.Uniform1f(e,i.u_opacity)}},fill:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}},fillPattern:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade)}},fillOutline:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_world:new t.Uniform2f(e,i.u_world)}},fillOutlinePattern:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_world:new t.Uniform2f(e,i.u_world),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade)}},circle:function(e,i){return {u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,i.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,i.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}},collisionBox:Ci,collisionCircle:Ci,debug:function(e,i){return {u_color:new t.UniformColor(e,i.u_color),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_overlay:new t.Uniform1i(e,i.u_overlay),u_overlay_scale:new t.Uniform1f(e,i.u_overlay_scale)}},clippingMask:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}},heatmap:function(e,i){return {u_extrude_scale:new t.Uniform1f(e,i.u_extrude_scale),u_intensity:new t.Uniform1f(e,i.u_intensity),u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}},heatmapTexture:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_world:new t.Uniform2f(e,i.u_world),u_image:new t.Uniform1i(e,i.u_image),u_color_ramp:new t.Uniform1i(e,i.u_color_ramp),u_opacity:new t.Uniform1f(e,i.u_opacity)}},hillshade:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_latrange:new t.Uniform2f(e,i.u_latrange),u_light:new t.Uniform2f(e,i.u_light),u_shadow:new t.UniformColor(e,i.u_shadow),u_highlight:new t.UniformColor(e,i.u_highlight),u_accent:new t.UniformColor(e,i.u_accent)}},hillshadePrepare:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_dimension:new t.Uniform2f(e,i.u_dimension),u_zoom:new t.Uniform1f(e,i.u_zoom),u_maxzoom:new t.Uniform1f(e,i.u_maxzoom),u_unpack:new t.Uniform4f(e,i.u_unpack)}},line:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels)}},lineGradient:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels),u_image:new t.Uniform1i(e,i.u_image)}},linePattern:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_texsize:new t.Uniform2f(e,i.u_texsize),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_image:new t.Uniform1i(e,i.u_image),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade)}},lineSDF:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_ratio:new t.Uniform1f(e,i.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,i.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,i.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,i.u_sdfgamma),u_image:new t.Uniform1i(e,i.u_image),u_tex_y_a:new t.Uniform1f(e,i.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,i.u_tex_y_b),u_mix:new t.Uniform1f(e,i.u_mix)}},raster:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_tl_parent:new t.Uniform2f(e,i.u_tl_parent),u_scale_parent:new t.Uniform1f(e,i.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,i.u_buffer_scale),u_fade_t:new t.Uniform1f(e,i.u_fade_t),u_opacity:new t.Uniform1f(e,i.u_opacity),u_image0:new t.Uniform1i(e,i.u_image0),u_image1:new t.Uniform1i(e,i.u_image1),u_brightness_low:new t.Uniform1f(e,i.u_brightness_low),u_brightness_high:new t.Uniform1f(e,i.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,i.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,i.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,i.u_spin_weights)}},symbolIcon:function(e,i){return {u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,i.u_pitch),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_texture:new t.Uniform1i(e,i.u_texture)}},symbolSDF:function(e,i){return {u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,i.u_pitch),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_texture:new t.Uniform1i(e,i.u_texture),u_gamma_scale:new t.Uniform1f(e,i.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,i.u_is_halo)}},symbolTextAndIcon:function(e,i){return {u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,i.u_pitch),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_texsize_icon:new t.Uniform2f(e,i.u_texsize_icon),u_texture:new t.Uniform1i(e,i.u_texture),u_texture_icon:new t.Uniform1i(e,i.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,i.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,i.u_is_halo)}},background:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_opacity:new t.Uniform1f(e,i.u_opacity),u_color:new t.UniformColor(e,i.u_color)}},backgroundPattern:function(e,i){return {u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_opacity:new t.Uniform1f(e,i.u_opacity),u_image:new t.Uniform1i(e,i.u_image),u_pattern_tl_a:new t.Uniform2f(e,i.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,i.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,i.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,i.u_pattern_br_b),u_texsize:new t.Uniform2f(e,i.u_texsize),u_mix:new t.Uniform1f(e,i.u_mix),u_pattern_size_a:new t.Uniform2f(e,i.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,i.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,i.u_scale_a),u_scale_b:new t.Uniform1f(e,i.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,i.u_tile_units_to_pixels)}}};function Xi(t,e,i,o,r,a,n,s){for(var l=t.context,c=l.gl,u=t.useProgram(r?"collisionCircle":"collisionBox"),h=0;h<o.length;h++){var p=o[h],d=e.getTile(p),_=d.getBucket(i);if(_){var f=r?s?_.textCollisionCircle:_.iconCollisionCircle:s?_.textCollisionBox:_.iconCollisionBox;if(f){var m=p.posMatrix;0===a[0]&&0===a[1]||(m=t.translatePosMatrix(p.posMatrix,d,a,n)),u.draw(l,r?c.TRIANGLES:c.LINES,Ct.disabled,St.disabled,t.colorModeForRenderPass(),zt.disabled,Si(m,t.transform,d),i.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,null,t.transform.zoom,null,null,f.collisionVertexBuffer);}}}}function Hi(t,e,i,o,r,a,n){Xi(t,e,i,o,!1,r,a,n),Xi(t,e,i,o,!0,r,a,n);}var Ki=t.identity(new Float32Array(16));function Yi(e,i,o,r,a,n){var s=t.getAnchorAlignment(e),l=-(s.horizontalAlign-.5)*i,c=-(s.verticalAlign-.5)*o,u=t.evaluateVariableOffset(e,r);return new t.Point((l/a+u[0])*n,(c/a+u[1])*n)}function Ji(e,i,o,r,a,n,s,l,c,u,h){var p=e.text.placedSymbolArray,d=e.text.dynamicLayoutVertexArray,_=e.icon.dynamicLayoutVertexArray,f={};d.clear();for(var m=0;m<p.length;m++){var g=p.get(m),v=g.hidden||!g.crossTileID||e.allowVerticalPlacement&&!g.placedOrientation?null:r[g.crossTileID];if(v){var y=new t.Point(g.anchorX,g.anchorY),x=Jt(y,o?l:s),b=.5+n.cameraToCenterDistance/x.signedDistanceFromCamera*.5,w=a.evaluateSizeForFeature(e.textSizeData,u,g)*b/t.ONE_EM;o&&(w*=e.tilePixelRatio/c);for(var E=Yi(v.anchor,v.width,v.height,v.textOffset,v.textBoxScale,w),T=o?Jt(y.add(E),s).point:x.point.add(i?E.rotate(-n.angle):E),I=e.allowVerticalPlacement&&g.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,C=0;C<g.numGlyphs;C++)t.addDynamicAttributes(d,T,I);h&&g.associatedIconIndex>=0&&(f[g.associatedIconIndex]={shiftedAnchor:T,angle:I});}else ne(g.numGlyphs,d);}if(h){_.clear();for(var S=e.icon.placedSymbolArray,P=0;P<S.length;P++){var z=S.get(P);if(z.hidden)ne(z.numGlyphs,_);else{var L=f[P];if(L)for(var M=0;M<z.numGlyphs;M++)t.addDynamicAttributes(_,L.shiftedAnchor,L.angle);else ne(z.numGlyphs,_);}}e.icon.dynamicLayoutVertexBuffer.updateData(_);}e.text.dynamicLayoutVertexBuffer.updateData(d);}function Qi(t,e,i){return i.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function $i(e,i,o,r,a,n,s,l,c,u,h,p){for(var d=e.context,_=d.gl,f=e.transform,m="map"===l,g="map"===c,v=m&&"point"!==o.layout.get("symbol-placement"),y=m&&!g&&!v,x=void 0!==o.layout.get("symbol-sort-key").constantOr(1),b=e.depthModeForSublayer(0,Ct.ReadOnly),w=o.layout.get("text-variable-anchor"),E=[],T=0,I=r;T<I.length;T+=1){var C=I[T],S=i.getTile(C),P=S.getBucket(o);if(P){var z=a?P.text:P.icon;if(z&&z.segments.get().length){var L=z.programConfigurations.get(o.id),M=a||P.sdfIcons,D=a?P.textSizeData:P.iconSizeData,A=g||0!==f.pitch,R=e.useProgram(Qi(M,a,P),L),k=t.evaluateSizeForZoom(D,f.zoom),B=void 0,O=[0,0],F=void 0,U=void 0,N=null,Z=void 0;if(a)F=S.glyphAtlasTexture,U=_.LINEAR,B=S.glyphAtlasTexture.size,P.iconsInText&&(O=S.imageAtlasTexture.size,N=S.imageAtlasTexture,Z=A||e.options.rotating||e.options.zooming||"composite"===D.kind||"camera"===D.kind?_.LINEAR:_.NEAREST);else{var q=1!==o.layout.get("icon-size").constantOr(0)||P.iconsNeedLinear;F=S.imageAtlasTexture,U=M||e.options.rotating||e.options.zooming||q||A?_.LINEAR:_.NEAREST,B=S.imageAtlasTexture.size;}var j=ue(S,1,e.transform.zoom),V=Kt(C.posMatrix,g,m,e.transform,j),G=Yt(C.posMatrix,g,m,e.transform,j),W=w&&P.hasTextData(),X="none"!==o.layout.get("icon-text-fit")&&W&&P.hasIconData();v&&$t(P,C.posMatrix,e,a,V,G,g,u);var H=e.translatePosMatrix(C.posMatrix,S,n,s),K=v||a&&w||X?Ki:V,Y=e.translatePosMatrix(G,S,n,s,!0),J=M&&0!==o.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),Q={program:R,buffers:z,uniformValues:M?P.iconsInText?ji(D.kind,k,y,g,e,H,K,Y,B,O):qi(D.kind,k,y,g,e,H,K,Y,a,B,!0):Zi(D.kind,k,y,g,e,H,K,Y,a,B),atlasTexture:F,atlasTextureIcon:N,atlasInterpolation:U,atlasInterpolationIcon:Z,isSDF:M,hasHalo:J};if(x)for(var $=0,tt=z.segments.get();$<tt.length;$+=1){var et=tt[$];E.push({segments:new t.SegmentVector([et]),sortKey:et.sortKey,state:Q});}else E.push({segments:z.segments,sortKey:0,state:Q});}}}x&&E.sort((function(t,e){return t.sortKey-e.sortKey}));for(var it=0,ot=E;it<ot.length;it+=1){var rt=ot[it],at=rt.state;if(d.activeTexture.set(_.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,_.CLAMP_TO_EDGE),at.atlasTextureIcon&&(d.activeTexture.set(_.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,_.CLAMP_TO_EDGE)),at.isSDF){var nt=at.uniformValues;at.hasHalo&&(nt.u_is_halo=1,to(at.buffers,rt.segments,o,e,at.program,b,h,p,nt)),nt.u_is_halo=0;}to(at.buffers,rt.segments,o,e,at.program,b,h,p,at.uniformValues);}}function to(t,e,i,o,r,a,n,s,l){var c=o.context;r.draw(c,c.gl.TRIANGLES,a,n,s,zt.disabled,l,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,o.transform.zoom,t.programConfigurations.get(i.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer);}function eo(t,e,i,o,r,a,n){var s,l,c,u,h,p=t.context.gl,d=i.paint.get("fill-pattern"),_=d&&d.constantOr(1),f=i.getCrossfadeParameters();n?(l=_&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=p.LINES):(l=_?"fillPattern":"fill",s=p.TRIANGLES);for(var m=0,g=o;m<g.length;m+=1){var v=g[m],y=e.getTile(v);if(!_||y.patternsLoaded()){var x=y.getBucket(i);if(x){var b=x.programConfigurations.get(i.id),w=t.useProgram(l,b);_&&(t.context.activeTexture.set(p.TEXTURE0),y.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),b.updatePaintBuffers(f));var E=d.constantOr(null);if(E&&y.imageAtlas){var T=y.imageAtlas,I=T.patternPositions[E.to.toString()],C=T.patternPositions[E.from.toString()];I&&C&&b.setConstantPatternPositions(I,C);}var S=t.translatePosMatrix(v.posMatrix,y,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(n){u=x.indexBuffer2,h=x.segments2;var P=[p.drawingBufferWidth,p.drawingBufferHeight];c="fillOutlinePattern"===l&&_?Ti(S,t,f,y,P):Ei(S,P);}else u=x.indexBuffer,h=x.segments,c=_?wi(S,t,f,y):bi(S);w.draw(t.context,s,r,t.stencilModeForClipping(v),a,zt.disabled,c,i.id,x.layoutVertexBuffer,u,h,i.paint,t.transform.zoom,b);}}}}function io(t,e,i,o,r,a,n){for(var s=t.context,l=s.gl,c=i.paint.get("fill-extrusion-pattern"),u=c.constantOr(1),h=i.getCrossfadeParameters(),p=i.paint.get("fill-extrusion-opacity"),d=0,_=o;d<_.length;d+=1){var f=_[d],m=e.getTile(f),g=m.getBucket(i);if(g){var v=g.programConfigurations.get(i.id),y=t.useProgram(u?"fillExtrusionPattern":"fillExtrusion",v);u&&(t.context.activeTexture.set(l.TEXTURE0),m.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),v.updatePaintBuffers(h));var x=c.constantOr(null);if(x&&m.imageAtlas){var b=m.imageAtlas,w=b.patternPositions[x.to.toString()],E=b.patternPositions[x.from.toString()];w&&E&&v.setConstantPatternPositions(w,E);}var T=t.translatePosMatrix(f.posMatrix,m,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),I=i.paint.get("fill-extrusion-vertical-gradient"),C=u?xi(T,t,I,p,f,h,m):yi(T,t,I,p);y.draw(s,s.gl.TRIANGLES,r,a,n,zt.backCCW,C,i.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,i.paint,t.transform.zoom,v);}}}function oo(t,e,i,o,r,a){var n=t.context,s=n.gl,l=e.fbo;if(l){var c=t.useProgram("hillshade");n.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,l.colorAttachment.get());var u=Mi(t,e,i);c.draw(n,s.TRIANGLES,o,r,a,zt.disabled,u,i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments);}}function ro(e,i,o,r,a,n,s){var l=e.context,c=l.gl,u=i.dem;if(u&&u.data){var h=u.dim,p=u.stride,d=u.getPixels();if(l.activeTexture.set(c.TEXTURE1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(p),i.demTexture){var _=i.demTexture;_.update(d,{premultiply:!1}),_.bind(c.NEAREST,c.CLAMP_TO_EDGE);}else i.demTexture=new t.Texture(l,d,c.RGBA,{premultiply:!1}),i.demTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE);l.activeTexture.set(c.TEXTURE0);var f=i.fbo;if(!f){var m=new t.Texture(l,{width:h,height:h,data:null},c.RGBA);m.bind(c.LINEAR,c.CLAMP_TO_EDGE),(f=i.fbo=l.createFramebuffer(h,h,!0)).colorAttachment.set(m.texture);}l.bindFramebuffer.set(f.framebuffer),l.viewport.set([0,0,h,h]),e.useProgram("hillshadePrepare").draw(l,c.TRIANGLES,a,n,s,zt.disabled,Di(i.tileID,u,r),o.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),i.needsHillshadePrepare=!1;}}function ao(e,i,o,r,a){var n=r.paint.get("raster-fade-duration");if(n>0){var s=t.browser.now(),l=(s-e.timeAdded)/n,c=i?(s-i.timeAdded)/n:-1,u=o.getSource(),h=a.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),p=!i||Math.abs(i.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),d=p&&e.refreshedUponExpiration?1:t.clamp(p?l:1-c,0,1);return e.refreshedUponExpiration&&l>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return {opacity:1,mix:0}}var no=new t.Color(1,0,0,1),so=new t.Color(0,1,0,1),lo=new t.Color(0,0,1,1),co=new t.Color(1,0,1,1),uo=new t.Color(0,1,1,1);function ho(t,e,i,o){_o(t,0,e+i/2,t.transform.width,i,o);}function po(t,e,i,o){_o(t,e-i/2,0,i,t.transform.height,o);}function _o(e,i,o,r,a,n){var s=e.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*t.browser.devicePixelRatio,o*t.browser.devicePixelRatio,r*t.browser.devicePixelRatio,a*t.browser.devicePixelRatio),s.clear({color:n}),l.disable(l.SCISSOR_TEST);}function fo(e,i,o){var r=e.context,a=r.gl,n=o.posMatrix,s=e.useProgram("debug"),l=Ct.disabled,c=St.disabled,u=e.colorModeForRenderPass();r.activeTexture.set(a.TEXTURE0),e.emptyTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.draw(r,a.LINE_STRIP,l,c,u,zt.disabled,Pi(n,t.Color.red),"$debug",e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);var h=i.getTileByID(o.key).latestRawTileData,p=Math.floor((h&&h.byteLength||0)/1024),d=i.getTile(o).tileSize,_=512/Math.min(d,512)*(o.overscaledZ/e.transform.zoom)*.5,f=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(f+=" => "+o.overscaledZ),function(t,e){t.initDebugOverlayCanvas();var i=t.debugOverlayCanvas,o=t.context.gl,r=t.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,i.width,i.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(e,5,5),r.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE);}(e,f+" "+p+"kb"),s.draw(r,a.TRIANGLES,l,c,Pt.alphaBlended,zt.disabled,Pi(n,t.Color.transparent,_),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments);}var mo={symbol:function(e,i,o,r,a){if("translucent"===e.renderPass){var n=St.disabled,s=e.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(e,i,o,r,a,n,s){for(var l=i.transform,c="map"===a,u="map"===n,h=0,p=e;h<p.length;h+=1){var d=p[h],_=r.getTile(d),f=_.getBucket(o);if(f&&f.text&&f.text.segments.get().length){var m=t.evaluateSizeForZoom(f.textSizeData,l.zoom),g=ue(_,1,i.transform.zoom),v=Kt(d.posMatrix,u,c,i.transform,g),y="none"!==o.layout.get("icon-text-fit")&&f.hasIconData();if(m){var x=Math.pow(2,l.zoom-_.tileID.overscaledZ);Ji(f,c,u,s,t.symbolSize,l,v,d.posMatrix,x,m,y);}}}}(r,e,o,i,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),a),0!==o.paint.get("icon-opacity").constantOr(1)&&$i(e,i,o,r,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),n,s),0!==o.paint.get("text-opacity").constantOr(1)&&$i(e,i,o,r,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),n,s),i.map.showCollisionBoxes&&(Hi(e,i,o,r,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Hi(e,i,o,r,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1));}},circle:function(e,i,o,r){if("translucent"===e.renderPass){var a=o.paint.get("circle-opacity"),n=o.paint.get("circle-stroke-width"),s=o.paint.get("circle-stroke-opacity"),l=void 0!==o.layout.get("circle-sort-key").constantOr(1);if(0!==a.constantOr(1)||0!==n.constantOr(1)&&0!==s.constantOr(1)){for(var c=e.context,u=c.gl,h=e.depthModeForSublayer(0,Ct.ReadOnly),p=St.disabled,d=e.colorModeForRenderPass(),_=[],f=0;f<r.length;f++){var m=r[f],g=i.getTile(m),v=g.getBucket(o);if(v){var y=v.programConfigurations.get(o.id),x={programConfiguration:y,program:e.useProgram("circle",y),layoutVertexBuffer:v.layoutVertexBuffer,indexBuffer:v.indexBuffer,uniformValues:Ii(e,m,g,o)};if(l)for(var b=0,w=v.segments.get();b<w.length;b+=1){var E=w[b];_.push({segments:new t.SegmentVector([E]),sortKey:E.sortKey,state:x});}else _.push({segments:v.segments,sortKey:0,state:x});}}l&&_.sort((function(t,e){return t.sortKey-e.sortKey}));for(var T=0,I=_;T<I.length;T+=1){var C=I[T],S=C.state;S.program.draw(c,u.TRIANGLES,h,p,d,zt.disabled,S.uniformValues,o.id,S.layoutVertexBuffer,S.indexBuffer,C.segments,o.paint,e.transform.zoom,S.programConfiguration);}}}},heatmap:function(e,i,o,r){if(0!==o.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var a=e.context,n=a.gl,s=St.disabled,l=new Pt([n.ONE,n.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,i){var o=t.gl;t.activeTexture.set(o.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var r=i.heatmapFbo;if(r)o.bindTexture(o.TEXTURE_2D,r.colorAttachment.get()),t.bindFramebuffer.set(r.framebuffer);else{var a=o.createTexture();o.bindTexture(o.TEXTURE_2D,a),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),r=i.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function t(e,i,o,r){var a=e.gl;a.texImage2D(a.TEXTURE_2D,0,a.RGBA,i.width/4,i.height/4,0,a.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:a.UNSIGNED_BYTE,null),r.colorAttachment.set(o),e.extTextureHalfFloat&&a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,r.colorAttachment.setDirty(),t(e,i,o,r));}(t,e,a,r);}}(a,e,o),a.clear({color:t.Color.transparent});for(var c=0;c<r.length;c++){var u=r[c];if(!i.hasRenderableParent(u)){var h=i.getTile(u),p=h.getBucket(o);if(p){var d=p.programConfigurations.get(o.id);e.useProgram("heatmap",d).draw(a,n.TRIANGLES,Ct.disabled,s,l,zt.disabled,Li(u.posMatrix,h,e.transform.zoom,o.paint.get("heatmap-intensity")),o.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,o.paint,e.transform.zoom,d);}}}a.viewport.set([0,0,e.width,e.height]);}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,i){var o=e.context,r=o.gl,a=i.heatmapFbo;if(a){o.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),o.activeTexture.set(r.TEXTURE1);var n=i.colorRampTexture;n||(n=i.colorRampTexture=new t.Texture(o,i.colorRamp,r.RGBA)),n.bind(r.LINEAR,r.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(o,r.TRIANGLES,Ct.disabled,St.disabled,e.colorModeForRenderPass(),zt.disabled,function(e,i,o,r){var a=t.create();t.ortho(a,0,e.width,e.height,0,0,1);var n=e.context.gl;return {u_matrix:a,u_world:[n.drawingBufferWidth,n.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:i.paint.get("heatmap-opacity")}}(e,i),i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom);}}(e,o));},line:function(e,i,o,r){if("translucent"===e.renderPass){var a=o.paint.get("line-opacity"),n=o.paint.get("line-width");if(0!==a.constantOr(1)&&0!==n.constantOr(1)){var s=e.depthModeForSublayer(0,Ct.ReadOnly),l=e.colorModeForRenderPass(),c=o.paint.get("line-dasharray"),u=o.paint.get("line-pattern"),h=u.constantOr(1),p=o.paint.get("line-gradient"),d=o.getCrossfadeParameters(),_=h?"linePattern":c?"lineSDF":p?"lineGradient":"line",f=e.context,m=f.gl,g=!0;if(p){f.activeTexture.set(m.TEXTURE0);var v=o.gradientTexture;if(!o.gradient)return;v||(v=o.gradientTexture=new t.Texture(f,o.gradient,m.RGBA)),v.bind(m.LINEAR,m.CLAMP_TO_EDGE);}for(var y=0,x=r;y<x.length;y+=1){var b=x[y],w=i.getTile(b);if(!h||w.patternsLoaded()){var E=w.getBucket(o);if(E){var T=E.programConfigurations.get(o.id),I=e.context.program.get(),C=e.useProgram(_,T),S=g||C.program!==I,P=u.constantOr(null);if(P&&w.imageAtlas){var z=w.imageAtlas,L=z.patternPositions[P.to.toString()],M=z.patternPositions[P.from.toString()];L&&M&&T.setConstantPatternPositions(L,M);}var D=h?ki(e,w,o,d):c?Bi(e,w,o,c,d):p?Ri(e,w,o):Ai(e,w,o);h?(f.activeTexture.set(m.TEXTURE0),w.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),T.updatePaintBuffers(d)):c&&(S||e.lineAtlas.dirty)&&(f.activeTexture.set(m.TEXTURE0),e.lineAtlas.bind(f)),C.draw(f,m.TRIANGLES,s,e.stencilModeForClipping(b),l,zt.disabled,D,o.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,o.paint,e.transform.zoom,T),g=!1;}}}}}},fill:function(e,i,o,r){var a=o.paint.get("fill-color"),n=o.paint.get("fill-opacity");if(0!==n.constantOr(1)){var s=e.colorModeForRenderPass(),l=o.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===a.constantOr(t.Color.transparent).a&&1===n.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){var u=e.depthModeForSublayer(1,"opaque"===e.renderPass?Ct.ReadWrite:Ct.ReadOnly);eo(e,i,o,r,u,s,!1);}if("translucent"===e.renderPass&&o.paint.get("fill-antialias")){var h=e.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,Ct.ReadOnly);eo(e,i,o,r,h,s,!0);}}},"fill-extrusion":function(t,e,i,o){var r=i.paint.get("fill-extrusion-opacity");if(0!==r&&"translucent"===t.renderPass){var a=new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D);if(1!==r||i.paint.get("fill-extrusion-pattern").constantOr(1))io(t,e,i,o,a,St.disabled,Pt.disabled),io(t,e,i,o,a,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var n=t.colorModeForRenderPass();io(t,e,i,o,a,St.disabled,n);}}},hillshade:function(t,e,i,o){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var r=t.context,a=e.getSource().maxzoom,n=t.depthModeForSublayer(0,Ct.ReadOnly),s=t.colorModeForRenderPass(),l="translucent"===t.renderPass?t.stencilConfigForOverlap(o):[{},o],c=l[0],u=0,h=l[1];u<h.length;u+=1){var p=h[u],d=e.getTile(p);d.needsHillshadePrepare&&"offscreen"===t.renderPass?ro(t,d,i,a,n,St.disabled,s):"translucent"===t.renderPass&&oo(t,d,i,n,c[p.overscaledZ],s);}r.viewport.set([0,0,t.width,t.height]);}},raster:function(t,e,i,o){if("translucent"===t.renderPass&&0!==i.paint.get("raster-opacity")&&o.length)for(var r=t.context,a=r.gl,n=e.getSource(),s=t.useProgram("raster"),l=t.colorModeForRenderPass(),c=n instanceof D?[{},o]:t.stencilConfigForOverlap(o),u=c[0],h=c[1],p=h[h.length-1].overscaledZ,d=!t.options.moving,_=0,f=h;_<f.length;_+=1){var m=f[_],g=t.depthModeForSublayer(m.overscaledZ-p,1===i.paint.get("raster-opacity")?Ct.ReadWrite:Ct.ReadOnly,a.LESS),v=e.getTile(m),y=t.transform.calculatePosMatrix(m.toUnwrapped(),d);v.registerFadeDuration(i.paint.get("raster-fade-duration"));var x=e.findLoadedParent(m,0),b=ao(v,x,e,i,t.transform),w=void 0,E=void 0,T="nearest"===i.paint.get("raster-resampling")?a.NEAREST:a.LINEAR;r.activeTexture.set(a.TEXTURE0),v.texture.bind(T,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),r.activeTexture.set(a.TEXTURE1),x?(x.texture.bind(T,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,x.tileID.overscaledZ-v.tileID.overscaledZ),E=[v.tileID.canonical.x*w%1,v.tileID.canonical.y*w%1]):v.texture.bind(T,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);var I=Ui(y,E||[0,0],w||1,b,i);n instanceof D?s.draw(r,a.TRIANGLES,g,St.disabled,l,zt.disabled,I,i.id,n.boundsBuffer,t.quadTriangleIndexBuffer,n.boundsSegments):s.draw(r,a.TRIANGLES,g,u[m.overscaledZ],l,zt.disabled,I,i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments);}},background:function(t,e,i){var o=i.paint.get("background-color"),r=i.paint.get("background-opacity");if(0!==r){var a=t.context,n=a.gl,s=t.transform,l=s.tileSize,c=i.paint.get("background-pattern");if(!t.isPatternMissing(c)){var u=!c&&1===o.a&&1===r&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===u){var h=St.disabled,p=t.depthModeForSublayer(0,"opaque"===u?Ct.ReadWrite:Ct.ReadOnly),d=t.colorModeForRenderPass(),_=t.useProgram(c?"backgroundPattern":"background"),f=s.coveringTiles({tileSize:l});c&&(a.activeTexture.set(n.TEXTURE0),t.imageManager.bind(t.context));for(var m=i.getCrossfadeParameters(),g=0,v=f;g<v.length;g+=1){var y=v[g],x=t.transform.calculatePosMatrix(y.toUnwrapped()),b=c?Gi(x,r,t,c,{tileID:y,tileSize:l},m):Vi(x,r,o);_.draw(a,n.TRIANGLES,p,h,d,zt.disabled,b,i.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments);}}}}},debug:function(t,e,i){for(var o=0;o<i.length;o++)fo(t,e,i[o]);},custom:function(t,e,i){var o=t.context,r=i.implementation;if("offscreen"===t.renderPass){var a=r.prerender;a&&(t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),a.call(r,o.gl,t.transform.customLayerMatrix()),o.setDirty(),t.setBaseState());}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),o.setStencilMode(St.disabled);var n="3d"===r.renderingMode?new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Ct.ReadOnly);o.setDepthMode(n),r.render(o.gl,t.transform.customLayerMatrix()),o.setDirty(),t.setBaseState(),o.bindFramebuffer.set(null);}}},go=function(t,e){this.context=new Lt(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=Mt.maxUnderzooming+Mt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ke,this.gpuTimers={};};go.prototype.resize=function(e,i){if(this.width=e*t.browser.devicePixelRatio,this.height=i*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var o=0,r=this.style._order;o<r.length;o+=1)this.style._layers[r[o]].resize();},go.prototype.setup=function(){var e=this.context,i=new t.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(t.EXTENT,0),i.emplaceBack(0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(i,Ze.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(t.EXTENT,0),o.emplaceBack(0,t.EXTENT),o.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(o,Ze.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var r=new t.StructArrayLayout4i8;r.emplaceBack(0,0,0,0),r.emplaceBack(t.EXTENT,0,t.EXTENT,0),r.emplaceBack(0,t.EXTENT,0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(r,M.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(a,Ze.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var n=new t.StructArrayLayout1ui2;n.emplaceBack(0),n.emplaceBack(1),n.emplaceBack(3),n.emplaceBack(2),n.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(n);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);var l=this.context.gl;this.stencilClearMode=new St({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO);},go.prototype.clearStencil=function(){var e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var o=t.create();t.ortho(o,0,this.width,this.height,0,0,1),t.scale(o,o,[i.drawingBufferWidth,i.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,i.TRIANGLES,Ct.disabled,this.stencilClearMode,Pt.disabled,zt.disabled,zi(o),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments);},go.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var i=this.context,o=i.gl;this.nextStencilID+e.length>256&&this.clearStencil(),i.setColorMode(Pt.disabled),i.setDepthMode(Ct.disabled);var r=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var a=0,n=e;a<n.length;a+=1){var s=n[a],l=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;r.draw(i,o.TRIANGLES,Ct.disabled,new St({func:o.ALWAYS,mask:0},l,255,o.KEEP,o.KEEP,o.REPLACE),Pt.disabled,zt.disabled,zi(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments);}}},go.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new St({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},go.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new St({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},go.prototype.stencilConfigForOverlap=function(t){var e,i=this.context.gl,o=t.sort((function(t,e){return e.overscaledZ-t.overscaledZ})),r=o[o.length-1].overscaledZ,a=o[0].overscaledZ-r+1;if(a>1){this.currentStencilSource=void 0,this.nextStencilID+a>256&&this.clearStencil();for(var n={},s=0;s<a;s++)n[s+r]=new St({func:i.GEQUAL,mask:255},s+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=a,[n,o]}return [(e={},e[r]=St.disabled,e),o]},go.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Pt([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Pt.unblended:Pt.alphaBlended},go.prototype.depthModeForSublayer=function(t,e,i){if(!this.opaquePassEnabledForLayer())return Ct.disabled;var o=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ct(i||this.context.gl.LEQUAL,e,[o,o])},go.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},go.prototype.render=function(e,i){var o=this;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var r=this.style._order,a=this.style.sourceCaches;for(var n in a){var s=a[n];s.used&&s.prepare(this.context);}var l,c,u={},h={},p={};for(var d in a){var _=a[d];u[d]=_.getVisibleCoordinates(),h[d]=u[d].slice().reverse(),p[d]=_.getVisibleCoordinates(!0).reverse();}this.opaquePassCutoff=1/0;for(var f=0;f<r.length;f++)if(this.style._layers[r[f]].is3D()){this.opaquePassCutoff=f;break}this.renderPass="offscreen";for(var m=0,g=r;m<g.length;m+=1){var v=this.style._layers[g[m]];if(v.hasOffscreenPass()&&!v.isHidden(this.transform.zoom)){var y=h[v.source];("custom"===v.type||y.length)&&this.renderLayer(this,a[v.source],v,y);}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){var x=this.style._layers[r[this.currentLayer]],b=a[x.source],w=u[x.source];this._renderTileClippingMasks(x,w),this.renderLayer(this,b,x,w);}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){var E=this.style._layers[r[this.currentLayer]],T=a[E.source],I=("symbol"===E.type?p:h)[E.source];this._renderTileClippingMasks(E,u[E.source]),this.renderLayer(this,T,E,I);}this.options.showTileBoundaries&&(t.values(this.style._layers).forEach((function(t){t.source&&!t.isHidden(o.transform.zoom)&&(t.source!==(c&&c.id)&&(c=o.style.sourceCaches[t.source]),(!l||l.getSource().maxzoom<c.getSource().maxzoom)&&(l=c));})),l&&mo.debug(this,l,l.getVisibleCoordinates())),this.options.showPadding&&function(t){var e=t.transform.padding;ho(t,t.transform.height-(e.top||0),3,no),ho(t,e.bottom||0,3,so),po(t,e.left||0,3,lo),po(t,t.transform.width-(e.right||0),3,co);var i=t.transform.centerPoint;!function(t,e,i,o){_o(t,e-1,i-10,2,20,o),_o(t,e-10,i-1,20,2,o);}(t,i.x,t.transform.height-i.y,uo);}(this),this.context.setDefault();},go.prototype.renderLayer=function(t,e,i,o){i.isHidden(this.transform.zoom)||("background"===i.type||"custom"===i.type||o.length)&&(this.id=i.id,this.gpuTimingStart(i),mo[i.type](t,e,i,o,this.style.placement.variableOffsets),this.gpuTimingEnd());},go.prototype.gpuTimingStart=function(t){if(this.options.gpuTiming){var e=this.context.extTimerQuery,i=this.gpuTimers[t.id];i||(i=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),i.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,i.query);}},go.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT);}},go.prototype.collectGpuTimers=function(){var t=this.gpuTimers;return this.gpuTimers={},t},go.prototype.queryGpuTimers=function(t){var e={};for(var i in t){var o=t[i],r=this.context.extTimerQuery,a=r.getQueryObjectEXT(o.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(o.query),e[i]=a;}return e},go.prototype.translatePosMatrix=function(e,i,o,r,a){if(!o[0]&&!o[1])return e;var n=a?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(n){var s=Math.sin(n),l=Math.cos(n);o=[o[0]*l-o[1]*s,o[0]*s+o[1]*l];}var c=[a?o[0]:ue(i,o[0],this.transform.zoom),a?o[1]:ue(i,o[1],this.transform.zoom),0],u=new Float32Array(16);return t.translate(u,e,c),u},go.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t];},go.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},go.prototype.isPatternMissing=function(t){if(!t)return !1;var e=this.imageManager.getPattern(t.from.toString()),i=this.imageManager.getPattern(t.to.toString());return !e||!i},go.prototype.useProgram=function(t,e){this.cache=this.cache||{};var i=""+t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[i]||(this.cache[i]=new gi(this.context,fi[t],e,Wi[t],this._showOverdrawInspector)),this.cache[i]},go.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault();},go.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD);},go.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA));},go.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy();};var vo=function(t,e){this.points=t,this.planes=e;};vo.fromInvProjectionMatrix=function(e,i,o){var r=Math.pow(2,o),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(i){return t.transformMat4([],i,e)})).map((function(e){return t.scale$1([],e,1/e[3]/i*r)})),n=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(e){var i=t.sub([],a[e[0]],a[e[1]]),o=t.sub([],a[e[2]],a[e[1]]),r=t.normalize([],t.cross([],i,o)),n=-t.dot(r,a[e[1]]);return r.concat(n)}));return new vo(a,n)};var yo=function(e,i){this.min=e,this.max=i,this.center=t.scale$2([],t.add([],this.min,this.max),.5);};yo.prototype.quadrant=function(e){for(var i=[e%2==0,e<2],o=t.clone$2(this.min),r=t.clone$2(this.max),a=0;a<i.length;a++)o[a]=i[a]?this.min[a]:this.center[a],r[a]=i[a]?this.center[a]:this.max[a];return r[2]=this.max[2],new yo(o,r)},yo.prototype.distanceX=function(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]},yo.prototype.distanceY=function(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]},yo.prototype.intersects=function(e){for(var i=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],o=!0,r=0;r<e.planes.length;r++){for(var a=e.planes[r],n=0,s=0;s<i.length;s++)n+=t.dot$1(a,i[s])>=0;if(0===n)return 0;n!==i.length&&(o=!1);}if(o)return 2;for(var l=0;l<3;l++){for(var c=Number.MAX_VALUE,u=-Number.MAX_VALUE,h=0;h<e.points.length;h++){var p=e.points[h][l]-this.min[l];c=Math.min(c,p),u=Math.max(u,p);}if(u<0||c>this.max[l]-this.min[l])return 0}return 1};var xo=function(t,e,i,o){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o=0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(o)||o<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=o;};xo.prototype.interpolate=function(e,i,o){return null!=i.top&&null!=e.top&&(this.top=t.number(e.top,i.top,o)),null!=i.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,i.bottom,o)),null!=i.left&&null!=e.left&&(this.left=t.number(e.left,i.left,o)),null!=i.right&&null!=e.right&&(this.right=t.number(e.right,i.right,o)),this},xo.prototype.getCenter=function(e,i){var o=t.clamp((this.left+e-this.right)/2,0,e),r=t.clamp((this.top+i-this.bottom)/2,0,i);return new t.Point(o,r)},xo.prototype.equals=function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right},xo.prototype.clone=function(){return new xo(this.top,this.bottom,this.left,this.right)},xo.prototype.toJSON=function(){return {top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var bo=function(e,i,o,r,a){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===a||a,this._minZoom=e||0,this._maxZoom=i||22,this._minPitch=null==o?0:o,this._maxPitch=null==r?60:r,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new xo,this._posMatrixCache={},this._alignedPosMatrixCache={};},wo={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};bo.prototype.clone=function(){var t=new bo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t},wo.minZoom.get=function(){return this._minZoom},wo.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t));},wo.maxZoom.get=function(){return this._maxZoom},wo.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t));},wo.minPitch.get=function(){return this._minPitch},wo.minPitch.set=function(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t));},wo.maxPitch.get=function(){return this._maxPitch},wo.maxPitch.set=function(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t));},wo.renderWorldCopies.get=function(){return this._renderWorldCopies},wo.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t;},wo.worldSize.get=function(){return this.tileSize*this.scale},wo.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},wo.size.get=function(){return new t.Point(this.width,this.height)},wo.bearing.get=function(){return -this.angle/Math.PI*180},wo.bearing.set=function(e){var i=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle));},wo.pitch.get=function(){return this._pitch/Math.PI*180},wo.pitch.set=function(e){var i=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices());},wo.fov.get=function(){return this._fov/Math.PI*180},wo.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices());},wo.zoom.get=function(){return this._zoom},wo.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices());},wo.center.get=function(){return this._center},wo.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices());},wo.padding.get=function(){return this._edgeInsets.toJSON()},wo.padding.set=function(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices());},wo.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},bo.prototype.isPaddingEqual=function(t){return this._edgeInsets.equals(t)},bo.prototype.interpolatePadding=function(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices();},bo.prototype.coveringZoomLevel=function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)},bo.prototype.getVisibleUnwrappedCoordinates=function(e){var i=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var o=this.pointCoordinate(new t.Point(0,0)),r=this.pointCoordinate(new t.Point(this.width,0)),a=this.pointCoordinate(new t.Point(this.width,this.height)),n=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(o.x,r.x,a.x,n.x)),l=Math.floor(Math.max(o.x,r.x,a.x,n.x)),c=s-1;c<=l+1;c++)0!==c&&i.push(new t.UnwrappedTileID(c,e));return i},bo.prototype.coveringTiles=function(e){var i=this.coveringZoomLevel(e),o=i;if(void 0!==e.minzoom&&i<e.minzoom)return [];void 0!==e.maxzoom&&i>e.maxzoom&&(i=e.maxzoom);var r=t.MercatorCoordinate.fromLngLat(this.center),a=Math.pow(2,i),n=[a*r.x,a*r.y,0],s=vo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i),l=e.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(l=i);var c=function(t){return {aabb:new yo([t*a,0,0],[(t+1)*a,a,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}},u=[],h=[],p=i,d=e.reparseOverscaled?o:i;if(this._renderWorldCopies)for(var _=1;_<=3;_++)u.push(c(-_)),u.push(c(_));for(u.push(c(0));u.length>0;){var f=u.pop(),m=f.x,g=f.y,v=f.fullyVisible;if(!v){var y=f.aabb.intersects(s);if(0===y)continue;v=2===y;}var x=f.aabb.distanceX(n),b=f.aabb.distanceY(n),w=Math.max(Math.abs(x),Math.abs(b));if(f.zoom===p||w>3+(1<<p-f.zoom)-2&&f.zoom>=l)h.push({tileID:new t.OverscaledTileID(f.zoom===p?d:f.zoom,f.wrap,f.zoom,m,g),distanceSq:t.sqrLen([n[0]-.5-m,n[1]-.5-g])});else for(var E=0;E<4;E++){var T=(m<<1)+E%2,I=(g<<1)+(E>>1);u.push({aabb:f.aabb.quadrant(E),zoom:f.zoom+1,x:T,y:I,wrap:f.wrap,fullyVisible:v});}}return h.sort((function(t,e){return t.distanceSq-e.distanceSq})).map((function(t){return t.tileID}))},bo.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices();},wo.unmodified.get=function(){return this._unmodified},bo.prototype.zoomScale=function(t){return Math.pow(2,t)},bo.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},bo.prototype.project=function(e){var i=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(i)*this.worldSize)},bo.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},wo.point.get=function(){return this.project(this.center)},bo.prototype.setLocationAtPoint=function(e,i){var o=this.pointCoordinate(i),r=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(e),n=new t.MercatorCoordinate(a.x-(o.x-r.x),a.y-(o.y-r.y));this.center=this.coordinateLocation(n),this._renderWorldCopies&&(this.center=this.center.wrap());},bo.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},bo.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},bo.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},bo.prototype.coordinateLocation=function(t){return t.toLngLat()},bo.prototype.pointCoordinate=function(e){var i=[e.x,e.y,0,1],o=[e.x,e.y,1,1];t.transformMat4(i,i,this.pixelMatrixInverse),t.transformMat4(o,o,this.pixelMatrixInverse);var r=i[3],a=o[3],n=i[1]/r,s=o[1]/a,l=i[2]/r,c=o[2]/a,u=l===c?0:(0-l)/(c-l);return new t.MercatorCoordinate(t.number(i[0]/r,o[0]/a,u)/this.worldSize,t.number(n,s,u)/this.worldSize)},bo.prototype.coordinatePoint=function(e){var i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(i,i,this.pixelMatrix),new t.Point(i[0]/i[3],i[1]/i[3])},bo.prototype.getBounds=function(){return (new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},bo.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},bo.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude]);},bo.prototype.calculatePosMatrix=function(e,i){void 0===i&&(i=!1);var o=e.key,r=i?this._alignedPosMatrixCache:this._posMatrixCache;if(r[o])return r[o];var a=e.canonical,n=this.worldSize/this.zoomScale(a.z),s=a.x+Math.pow(2,a.z)*e.wrap,l=t.identity(new Float64Array(16));return t.translate(l,l,[s*n,a.y*n,0]),t.scale(l,l,[n/t.EXTENT,n/t.EXTENT,1]),t.multiply(l,i?this.alignedProjMatrix:this.projMatrix,l),r[o]=new Float32Array(l),r[o]},bo.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},bo.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,i,o,r,a=-90,n=90,s=-180,l=180,c=this.size,u=this._unmodified;if(this.latRange){var h=this.latRange;a=t.mercatorYfromLat(h[1])*this.worldSize,e=(n=t.mercatorYfromLat(h[0])*this.worldSize)-a<c.y?c.y/(n-a):0;}if(this.lngRange){var p=this.lngRange;s=t.mercatorXfromLng(p[0])*this.worldSize,i=(l=t.mercatorXfromLng(p[1])*this.worldSize)-s<c.x?c.x/(l-s):0;}var d=this.point,_=Math.max(i||0,e||0);if(_)return this.center=this.unproject(new t.Point(i?(l+s)/2:d.x,e?(n+a)/2:d.y)),this.zoom+=this.scaleZoom(_),this._unmodified=u,void(this._constraining=!1);if(this.latRange){var f=d.y,m=c.y/2;f-m<a&&(r=a+m),f+m>n&&(r=n-m);}if(this.lngRange){var g=d.x,v=c.x/2;g-v<s&&(o=s+v),g+v>l&&(o=l-v);}void 0===o&&void 0===r||(this.center=this.unproject(new t.Point(void 0!==o?o:d.x,void 0!==r?r:d.y))),this._unmodified=u,this._constraining=!1;}},bo.prototype._calcMatrices=function(){if(this.height){var e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var i=Math.PI/2+this._pitch,o=this._fov*(.5+e.y/this.height),r=Math.sin(o)*this.cameraToCenterDistance/Math.sin(t.clamp(Math.PI-i-o,.01,Math.PI-.01)),a=this.point,n=a.x,s=a.y,l=1.01*(Math.cos(Math.PI/2-this._pitch)*r+this.cameraToCenterDistance),c=this.height/50,u=new Float64Array(16);t.perspective(u,this._fov,this.width/this.height,c,l),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,t.scale(u,u,[1,-1,1]),t.translate(u,u,[0,0,-this.cameraToCenterDistance]),t.rotateX(u,u,this._pitch),t.rotateZ(u,u,this.angle),t.translate(u,u,[-n,-s,0]),this.mercatorMatrix=t.scale([],u,[this.worldSize,this.worldSize,this.worldSize]),t.scale(u,u,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=u,this.invProjMatrix=t.invert([],this.projMatrix);var h=this.width%2/2,p=this.height%2/2,d=Math.cos(this.angle),_=Math.sin(this.angle),f=n-Math.round(n)+d*h+_*p,m=s-Math.round(s)+d*p+_*h,g=new Float64Array(u);if(t.translate(g,g,[f>.5?f-1:f,m>.5?m-1:m,0]),this.alignedProjMatrix=g,u=t.create(),t.scale(u,u,[this.width/2,-this.height/2,1]),t.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=t.create(),t.scale(u,u,[1,-1,1]),t.translate(u,u,[-1,-1,0]),t.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(u=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={};}},bo.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(i,i,this.pixelMatrix)[3]/this.cameraToCenterDistance},bo.prototype.getCameraPoint=function(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))},bo.prototype.getCameraQueryGeometry=function(e){var i=this.getCameraPoint();if(1===e.length)return [e[0],i];for(var o=i.x,r=i.y,a=i.x,n=i.y,s=0,l=e;s<l.length;s+=1){var c=l[s];o=Math.min(o,c.x),r=Math.min(r,c.y),a=Math.max(a,c.x),n=Math.max(n,c.y);}return [new t.Point(o,r),new t.Point(a,r),new t.Point(a,n),new t.Point(o,n),new t.Point(o,r)]},Object.defineProperties(bo.prototype,wo);var Eo=function(e){var i,o,r,a;this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(i=this._updateHashUnthrottled.bind(this),o=!1,r=null,a=function(){r=null,o&&(i(),r=setTimeout(a,300),o=!1);},function(){return o=!0,r||a(),r});};Eo.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Eo.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Eo.prototype.getHashString=function(e){var i=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,r=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,r),n=Math.round(i.lng*a)/a,s=Math.round(i.lat*a)/a,l=this._map.getBearing(),c=this._map.getPitch(),u="";if(u+=e?"/"+n+"/"+s+"/"+o:o+"/"+s+"/"+n,(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+="/"+Math.round(c)),this._hashName){var h=this._hashName,p=!1,d=t.window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===h?(p=!0,e+"="+u):t})).filter((function(t){return t}));return p||d.push(h+"="+u),"#"+d.join("&")}return "#"+u},Eo.prototype._getCurrentHash=function(){var e,i=this,o=t.window.location.hash.replace("#","");return this._hashName?(o.split("&").map((function(t){return t.split("=")})).forEach((function(t){t[0]===i._hashName&&(e=t);})),(e&&e[1]||"").split("/")):o.split("/")},Eo.prototype._onHashChange=function(){var t=this._getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(t)}))){var e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return !1},Eo.prototype._updateHashUnthrottled=function(){var e=this.getHashString();try{t.window.history.replaceState(t.window.history.state,"",e);}catch(t){}};var To=function(e){function o(o,r,a,n){void 0===n&&(n={});var s=i.mousePos(r.getCanvasContainer(),a),l=r.unproject(s);e.call(this,o,t.extend({point:s,lngLat:l,originalEvent:a},n)),this._defaultPrevented=!1,this.target=r;}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var r={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0;},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,r),o}(t.Event),Io=function(e){function o(o,r,a){var n=i.touchPos(r.getCanvasContainer(),a),s=n.map((function(t){return r.unproject(t)})),l=n.reduce((function(t,e,i,o){return t.add(e.div(o.length))}),new t.Point(0,0)),c=r.unproject(l);e.call(this,o,{points:n,point:l,lngLats:s,lngLat:c,originalEvent:a}),this._defaultPrevented=!1;}e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o;var r={defaultPrevented:{configurable:!0}};return o.prototype.preventDefault=function(){this._defaultPrevented=!0;},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(o.prototype,r),o}(t.Event),Co=function(t){function e(e,i,o){t.call(this,e,{originalEvent:o}),this._defaultPrevented=!1;}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0;},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,i),e}(t.Event),So=function(e){this._map=e,this._el=e.getCanvasContainer(),this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this);};So.prototype.setZoomRate=function(t){this._defaultZoomRate=t;},So.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t;},So.prototype.isEnabled=function(){return !!this._enabled},So.prototype.isActive=function(){return !!this._active},So.prototype.isZooming=function(){return !!this._zooming},So.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around);},So.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1);},So.prototype.onWheel=function(e){if(this.isEnabled()){var i=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,o=t.browser.now(),r=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,0!==i&&i%4.000244140625==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this.isActive()||this._start(e)),e.preventDefault();}},So.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(t);},So.prototype._start=function(e){if(this._delta){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0,this._map.fire(new t.Event("movestart",{originalEvent:e})),this._map.fire(new t.Event("zoomstart",{originalEvent:e}))),this._finishTimeout&&clearTimeout(this._finishTimeout);var o=i.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(o)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame));}},So.prototype._onScrollFrame=function(){var e=this;if(this._frameId=null,this.isActive()){var i=this._map.transform;if(0!==this._delta){var o="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,r=2/(1+Math.exp(-Math.abs(this._delta*o)));this._delta<0&&0!==r&&(r=1/r);var a="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(a*r))),"wheel"===this._type&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0;}var n="number"==typeof this._targetZoom?this._targetZoom:i.zoom,s=this._startZoom,l=this._easing,c=!1;if("wheel"===this._type&&s&&l){var u=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),h=l(u);i.zoom=t.number(s,n,h),u<1?this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame)):c=!0;}else i.zoom=n,c=!0;i.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire(new t.Event("move",{originalEvent:this._lastWheelEvent})),this._map.fire(new t.Event("zoom",{originalEvent:this._lastWheelEvent})),c&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._map.fire(new t.Event("zoomend",{originalEvent:e._lastWheelEvent})),e._map.fire(new t.Event("moveend",{originalEvent:e._lastWheelEvent})),delete e._targetZoom;}),200));}},So.prototype._smoothOutEasing=function(e){var i=t.ease;if(this._prevEase){var o=this._prevEase,r=(t.browser.now()-o.start)/o.duration,a=o.easing(r+.01)-o.easing(r),n=.27/Math.sqrt(a*a+1e-4)*.01,s=Math.sqrt(.0729-n*n);i=t.bezier(n,s,.25,1);}return this._prevEase={start:t.browser.now(),duration:e,easing:i},i};var Po=function(e,i){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1,t.bindAll(["_onMouseMove","_onMouseUp","_onKeyDown"],this);};Po.prototype.isEnabled=function(){return !!this._enabled},Po.prototype.isActive=function(){return !!this._active},Po.prototype.enable=function(){this.isEnabled()||(this._enabled=!0);},Po.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1);},Po.prototype.onMouseDown=function(e){this.isEnabled()&&e.shiftKey&&0===e.button&&(t.window.document.addEventListener("mousemove",this._onMouseMove,!1),t.window.document.addEventListener("keydown",this._onKeyDown,!1),t.window.document.addEventListener("mouseup",this._onMouseUp,!1),i.disableDrag(),this._startPos=this._lastPos=i.mousePos(this._el,e),this._active=!0);},Po.prototype._onMouseMove=function(t){var e=i.mousePos(this._el,t);if(!(this._lastPos.equals(e)||!this._box&&e.dist(this._startPos)<this._clickTolerance)){var o=this._startPos;this._lastPos=e,this._box||(this._box=i.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var r=Math.min(o.x,e.x),a=Math.max(o.x,e.x),n=Math.min(o.y,e.y),s=Math.max(o.y,e.y);i.setTransform(this._box,"translate("+r+"px,"+n+"px)"),this._box.style.width=a-r+"px",this._box.style.height=s-n+"px";}},Po.prototype._onMouseUp=function(e){if(0===e.button){var o=this._startPos,r=i.mousePos(this._el,e);this._finish(),i.suppressClick(),o.x===r.x&&o.y===r.y?this._fireEvent("boxzoomcancel",e):this._map.fitScreenCoordinates(o,r,this._map.getBearing(),{linear:!0}).fire(new t.Event("boxzoomend",{originalEvent:e}));}},Po.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t));},Po.prototype._finish=function(){this._active=!1,t.window.document.removeEventListener("mousemove",this._onMouseMove,!1),t.window.document.removeEventListener("keydown",this._onKeyDown,!1),t.window.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(i.remove(this._box),this._box=null),i.enableDrag(),delete this._startPos,delete this._lastPos;},Po.prototype._fireEvent=function(e,i){return this._map.fire(new t.Event(e,{originalEvent:i}))};var zo=t.bezier(0,0,.25,1),Lo=function(e,i){this._map=e,this._el=i.element||e.getCanvasContainer(),this._state="disabled",this._button=i.button||"right",this._bearingSnap=i.bearingSnap||0,this._pitchWithRotate=!1!==i.pitchWithRotate,this._clickTolerance=i.clickTolerance||1,t.bindAll(["onMouseDown","_onMouseMove","_onMouseUp","_onBlur","_onDragFrame"],this);};Lo.prototype.isEnabled=function(){return "disabled"!==this._state},Lo.prototype.isActive=function(){return "active"===this._state},Lo.prototype.enable=function(){this.isEnabled()||(this._state="enabled");},Lo.prototype.disable=function(){if(this.isEnabled())switch(this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend"),this._pitchWithRotate&&this._fireEvent("pitchend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled";}},Lo.prototype.onMouseDown=function(e){if("enabled"===this._state){var o="touchstart"===e.type;if(o)this._startTime=Date.now();else if("right"===this._button){if(this._eventButton=i.mouseButton(e),e.altKey||e.metaKey)return;if(this._eventButton!==(e.ctrlKey?0:2))return}else{if(e.ctrlKey||0!==i.mouseButton(e))return;this._eventButton=0;}i.disableDrag(),o?(t.window.document.addEventListener("touchmove",this._onMouseMove,{capture:!0}),t.window.document.addEventListener("touchend",this._onMouseUp)):(t.window.document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),t.window.document.addEventListener("mouseup",this._onMouseUp)),t.window.addEventListener("blur",this._onBlur),this._state="pending",this._inertia=[[t.browser.now(),this._map.getBearing()]],this._startPos=this._prevPos=this._lastPos=i.mousePos(this._el,e),this._center=this._map.transform.centerPoint,e.preventDefault();}},Lo.prototype._onMouseMove=function(t){var e=i.mousePos(this._el,t);this._lastPos.equals(e)||"pending"===this._state&&e.dist(this._startPos)<this._clickTolerance||(this._lastMoveEvent=t,this._lastPos=e,"pending"===this._state&&(this._state="active",this._fireEvent("rotatestart",t),this._fireEvent("movestart",t),this._pitchWithRotate&&this._fireEvent("pitchstart",t)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)));},Lo.prototype._onDragFrame=function(){this._frameId=null;var e=this._lastMoveEvent;if(e){var i=this._map.transform,o=this._prevPos,r=this._lastPos,a=i.bearing-.8*(o.x-r.x),n=i.pitch- -.5*(o.y-r.y),s=this._inertia,l=s[s.length-1];this._drainInertiaBuffer(),s.push([t.browser.now(),this._map._normalizeBearing(a,l[1])]);var c=i.bearing;if(i.bearing=a,this._pitchWithRotate){var u=i.pitch;i.pitch=n,i.pitch!==u&&this._fireEvent("pitch",e);}i.bearing!==c&&this._fireEvent("rotate",e),this._fireEvent("move",e),delete this._lastMoveEvent,this._prevPos=this._lastPos;}},Lo.prototype._onMouseUp=function(t){var e="touchend"===t.type;if(e&&this._startPos===this._lastPos&&Date.now()-this._startTime<300&&this._el.click(),e||i.mouseButton(t)===this._eventButton)switch(this._state){case"active":this._state="enabled",i.suppressClick(),this._unbind(),this._deactivate(),this._inertialRotate(t);break;case"pending":this._state="enabled",this._unbind();}},Lo.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend",t),this._pitchWithRotate&&this._fireEvent("pitchend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind();}},Lo.prototype._unbind=function(){t.window.document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),t.window.document.removeEventListener("mouseup",this._onMouseUp),t.window.document.removeEventListener("touchmove",this._onMouseMove,{capture:!0}),t.window.document.removeEventListener("touchend",this._onMouseUp),t.window.removeEventListener("blur",this._onBlur),i.enableDrag();},Lo.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._prevPos,delete this._lastPos;},Lo.prototype._inertialRotate=function(t){var e=this;this._fireEvent("rotateend",t),this._drainInertiaBuffer();var i=this._map,o=i.getBearing(),r=this._inertia,a=function(){Math.abs(o)<e._bearingSnap?i.resetNorth({noMoveStart:!0},{originalEvent:t}):e._fireEvent("moveend",t),e._pitchWithRotate&&e._fireEvent("pitchend",t);};if(r.length<2)a();else{var n=r[0],s=r[r.length-1],l=i._normalizeBearing(o,r[r.length-2][1]),c=s[1]-n[1],u=c<0?-1:1,h=(s[0]-n[0])/1e3;if(0!==c&&0!==h){var p=Math.abs(c*(.25/h));p>180&&(p=180);var d=p/180;l+=u*p*(d/2),Math.abs(i._normalizeBearing(l,0))<this._bearingSnap&&(l=i._normalizeBearing(0,l)),i.rotateTo(l,{duration:1e3*d,easing:zo,noMoveStart:!0},{originalEvent:t});}else a();}},Lo.prototype._fireEvent=function(e,i){return this._map.fire(new t.Event(e,i?{originalEvent:i}:{}))},Lo.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,i=t.browser.now();e.length>0&&i-e[0][0]>160;)e.shift();};var Mo={linearity:.3,easing:t.bezier(0,0,.3,1),maxSpeed:1400,deceleration:2500},Do=function(e,i){this._map=e,this._el=e.getCanvasContainer(),this._state="disabled",this._clickTolerance=i.clickTolerance||1,this._inertiaOptions=Mo,t.bindAll(["_onMove","_onMouseUp","_onTouchEnd","_onBlur","_onDragFrame"],this);};Do.prototype.isEnabled=function(){return "disabled"!==this._state},Do.prototype.isActive=function(){return "active"===this._state},Do.prototype.enable=function(e){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-drag-pan"),this._state="enabled",this._inertiaOptions=t.extend(Mo,e));},Do.prototype.disable=function(){if(this.isEnabled())switch(this._el.classList.remove("mapboxgl-touch-drag-pan"),this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("dragend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled";}},Do.prototype.onMouseDown=function(e){"enabled"===this._state&&(e.ctrlKey||0!==i.mouseButton(e)||(i.addEventListener(t.window.document,"mousemove",this._onMove,{capture:!0}),i.addEventListener(t.window.document,"mouseup",this._onMouseUp),this._start(e)));},Do.prototype.onTouchStart=function(e){this.isEnabled()&&(e.touches&&e.touches.length>1&&("pending"===this._state||"active"===this._state)||(i.addEventListener(t.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),i.addEventListener(t.window.document,"touchend",this._onTouchEnd),this._start(e)));},Do.prototype._start=function(e){t.window.addEventListener("blur",this._onBlur),this._state="pending",this._startPos=this._mouseDownPos=this._prevPos=this._lastPos=i.mousePos(this._el,e),this._startTouch=this._lastTouch=t.window.TouchEvent&&e instanceof t.window.TouchEvent?i.touchPos(this._el,e):null,this._inertia=[[t.browser.now(),this._startPos]];},Do.prototype._touchesMatch=function(t,e){return !(!t||!e||t.length!==e.length)&&t.every((function(t,i){return e[i]===t}))},Do.prototype._onMove=function(e){e.preventDefault();var o=t.window.TouchEvent&&e instanceof t.window.TouchEvent?i.touchPos(this._el,e):null,r=i.mousePos(this._el,e);(o?this._touchesMatch(this._lastTouch,o):this._lastPos.equals(r))||"pending"===this._state&&r.dist(this._mouseDownPos)<this._clickTolerance||(this._lastMoveEvent=e,this._lastPos=r,this._lastTouch=o,this._drainInertiaBuffer(),this._inertia.push([t.browser.now(),this._lastPos]),"pending"===this._state&&(this._state="active",this._shouldStart=!0),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)));},Do.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t)if(this._map.touchZoomRotate.isActive())this._abort(t);else if(this._shouldStart&&(this._fireEvent("dragstart",t),this._fireEvent("movestart",t),this._shouldStart=!1),this.isActive()){var e=this._map.transform;e.setLocationAtPoint(e.pointLocation(this._prevPos),this._lastPos),this._fireEvent("drag",t),this._fireEvent("move",t),this._prevPos=this._lastPos,delete this._lastMoveEvent;}},Do.prototype._onMouseUp=function(t){if(0===i.mouseButton(t))switch(this._state){case"active":this._state="enabled",i.suppressClick(),this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind();}},Do.prototype._onTouchEnd=function(t){if(t.touches&&0!==t.touches.length)switch(this._state){case"pending":case"active":break;case"enabled":this.onTouchStart(t);}else switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind();break;case"enabled":this._unbind();}},Do.prototype._abort=function(e){switch(this._state){case"active":this._state="enabled",this._shouldStart||(this._fireEvent("dragend",e),this._fireEvent("moveend",e)),this._unbind(),this._deactivate(),t.window.TouchEvent&&e instanceof t.window.TouchEvent&&e.touches.length>1&&i.addEventListener(t.window.document,"touchend",this._onTouchEnd);break;case"pending":this._state="enabled",this._unbind();break;case"enabled":this._unbind();}},Do.prototype._onBlur=function(t){this._abort(t);},Do.prototype._unbind=function(){i.removeEventListener(t.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),i.removeEventListener(t.window.document,"touchend",this._onTouchEnd),i.removeEventListener(t.window.document,"mousemove",this._onMove,{capture:!0}),i.removeEventListener(t.window.document,"mouseup",this._onMouseUp),i.removeEventListener(t.window,"blur",this._onBlur);},Do.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._prevPos,delete this._mouseDownPos,delete this._lastPos,delete this._startTouch,delete this._lastTouch,delete this._shouldStart;},Do.prototype._inertialPan=function(t){this._fireEvent("dragend",t),this._drainInertiaBuffer();var e=this._inertia;if(e.length<2)this._fireEvent("moveend",t);else{var i=e[e.length-1],o=e[0],r=i[1].sub(o[1]),a=(i[0]-o[0])/1e3;if(0===a||i[1].equals(o[1]))this._fireEvent("moveend",t);else{var n=this._inertiaOptions,s=n.linearity,l=n.easing,c=n.maxSpeed,u=n.deceleration,h=r.mult(s/a),p=h.mag();p>c&&(p=c,h._unit()._mult(p));var d=p/(u*s),_=h.mult(-d/2);this._map.panBy(_,{duration:1e3*d,easing:l,noMoveStart:!0},{originalEvent:t});}}},Do.prototype._fireEvent=function(e,i){return this._map.fire(new t.Event(e,i?{originalEvent:i}:{}))},Do.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,i=t.browser.now();e.length>0&&i-e[0][0]>160;)e.shift();};var Ao=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onKeyDown"],this);};function Ro(t){return t*(2-t)}Ao.prototype.isEnabled=function(){return !!this._enabled},Ao.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0);},Ao.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1);},Ao.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,i=0,o=0,r=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?o=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?o=-1:(a=1,t.preventDefault());break;default:return}var n=this._map,s=n.getZoom(),l={duration:300,delayEndEvents:500,easing:Ro,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:n.getBearing()+15*i,pitch:n.getPitch()+10*o,offset:[100*-r,100*-a],center:n.getCenter()};n.easeTo(l,{originalEvent:t});}};var ko=function(e){this._map=e,t.bindAll(["_onDblClick","_onZoomEnd"],this);};ko.prototype.isEnabled=function(){return !!this._enabled},ko.prototype.isActive=function(){return !!this._active},ko.prototype.enable=function(){this.isEnabled()||(this._enabled=!0);},ko.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1);},ko.prototype.onTouchStart=function(t){var e=this;if(this.isEnabled()&&!(t.points.length>1))if(this._tapped){var i=this._tappedPoint;if(i&&i.dist(t.points[0])<=30){t.originalEvent.preventDefault();var o=function(){e._tapped&&e._zoom(t),e._map.off("touchcancel",r),e._resetTapped();},r=function(){e._map.off("touchend",o),e._resetTapped();};this._map.once("touchend",o),this._map.once("touchcancel",r);}else this._resetTapped();}else this._tappedPoint=t.points[0],this._tapped=setTimeout((function(){e._tapped=null,e._tappedPoint=null;}),300);},ko.prototype._resetTapped=function(){clearTimeout(this._tapped),this._tapped=null,this._tappedPoint=null;},ko.prototype.onDblClick=function(t){this.isEnabled()&&(t.originalEvent.preventDefault(),this._zoom(t));},ko.prototype._zoom=function(t){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t);},ko.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd);};var Bo=t.bezier(0,0,.15,1),Oo=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onMove","_onEnd","_onTouchFrame"],this);};Oo.prototype.isEnabled=function(){return !!this._enabled},Oo.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-zoom-rotate"),this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around);},Oo.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("mapboxgl-touch-zoom-rotate"),this._enabled=!1);},Oo.prototype.disableRotation=function(){this._rotationDisabled=!0;},Oo.prototype.enableRotation=function(){this._rotationDisabled=!1;},Oo.prototype.isActive=function(){return this.isEnabled()&&!!this._gestureIntent},Oo.prototype.onStart=function(e){if(this.isEnabled()&&2===e.touches.length){var o=i.mousePos(this._el,e.touches[0]),r=i.mousePos(this._el,e.touches[1]),a=o.add(r).div(2);this._startVec=o.sub(r),this._startAround=this._map.transform.pointLocation(a),this._gestureIntent=void 0,this._inertia=[],i.addEventListener(t.window.document,"touchmove",this._onMove,{passive:!1}),i.addEventListener(t.window.document,"touchend",this._onEnd);}},Oo.prototype._getTouchEventData=function(t){var e=i.mousePos(this._el,t.touches[0]),o=i.mousePos(this._el,t.touches[1]),r=e.sub(o);return {vec:r,center:e.add(o).div(2),scale:r.mag()/this._startVec.mag(),bearing:this._rotationDisabled?0:180*r.angleWith(this._startVec)/Math.PI}},Oo.prototype._onMove=function(e){if(2===e.touches.length){var i=this._getTouchEventData(e),o=i.vec,r=i.scale,a=i.bearing;if(!this._gestureIntent){var n=this._rotationDisabled&&1!==r||Math.abs(1-r)>.15;Math.abs(a)>10?this._gestureIntent="rotate":n&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._map.fire(new t.Event(this._gestureIntent+"start",{originalEvent:e})),this._map.fire(new t.Event("movestart",{originalEvent:e})),this._startVec=o);}this._lastTouchEvent=e,this._frameId||(this._frameId=this._map._requestRenderFrame(this._onTouchFrame)),e.preventDefault();}},Oo.prototype._onTouchFrame=function(){this._frameId=null;var e=this._gestureIntent;if(e){var i=this._map.transform;this._startScale||(this._startScale=i.scale,this._startBearing=i.bearing);var o=this._getTouchEventData(this._lastTouchEvent),r=o.center,a=o.bearing,n=o.scale,s=i.pointLocation(r),l=i.locationPoint(s);"rotate"===e&&(i.bearing=this._startBearing+a),i.zoom=i.scaleZoom(this._startScale*n),i.setLocationAtPoint(this._startAround,l),this._map.fire(new t.Event(e,{originalEvent:this._lastTouchEvent})),this._map.fire(new t.Event("move",{originalEvent:this._lastTouchEvent})),this._drainInertiaBuffer(),this._inertia.push([t.browser.now(),n,r]);}},Oo.prototype._onEnd=function(e){i.removeEventListener(t.window.document,"touchmove",this._onMove,{passive:!1}),i.removeEventListener(t.window.document,"touchend",this._onEnd);var o=this._gestureIntent,r=this._startScale;if(this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._gestureIntent,delete this._startScale,delete this._startBearing,delete this._lastTouchEvent,o){this._map.fire(new t.Event(o+"end",{originalEvent:e})),this._drainInertiaBuffer();var a=this._inertia,n=this._map;if(a.length<2)n.snapToNorth({},{originalEvent:e});else{var s=a[a.length-1],l=a[0],c=n.transform.scaleZoom(r*s[1]),u=n.transform.scaleZoom(r*l[1]),h=(s[0]-l[0])/1e3,p=s[2];if(0!==h&&c!==u){var d=.15*(c-u)/h;Math.abs(d)>2.5&&(d=d>0?2.5:-2.5);var _=1e3*Math.abs(d/(12*.15));n.easeTo({zoom:c+d*_/2e3,duration:_,easing:Bo,around:this._aroundCenter?n.getCenter():n.unproject(p),noMoveStart:!0},{originalEvent:e});}else n.snapToNorth({},{originalEvent:e});}}},Oo.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,i=t.browser.now();e.length>2&&i-e[0][0]>160;)e.shift();};var Fo={scrollZoom:So,boxZoom:Po,dragRotate:Lo,dragPan:Do,keyboard:Ao,doubleClickZoom:ko,touchZoomRotate:Oo},Uo=function(e){function i(i,o){e.call(this),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,t.bindAll(["_renderFrameCallback"],this);}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},i.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},i.prototype.panBy=function(e,i,o){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},i),o)},i.prototype.panTo=function(e,i,o){return this.easeTo(t.extend({center:e},i),o)},i.prototype.getZoom=function(){return this.transform.zoom},i.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},i.prototype.zoomTo=function(e,i,o){return this.easeTo(t.extend({zoom:e},i),o)},i.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},i.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},i.prototype.getBearing=function(){return this.transform.bearing},i.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},i.prototype.getPadding=function(){return this.transform.padding},i.prototype.setPadding=function(t,e){return this.jumpTo({padding:t},e),this},i.prototype.rotateTo=function(e,i,o){return this.easeTo(t.extend({bearing:e},i),o)},i.prototype.resetNorth=function(e,i){return this.rotateTo(0,t.extend({duration:1e3},e),i),this},i.prototype.resetNorthPitch=function(e,i){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),i),this},i.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},i.prototype.getPitch=function(){return this.transform.pitch},i.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},i.prototype.cameraForBounds=function(e,i){return e=t.LngLatBounds.convert(e),this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,i)},i.prototype._cameraForBoxAndBearing=function(e,i,o,r){var a={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=t.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var n=r.padding;r.padding={top:n,bottom:n,right:n,left:n};}r.padding=t.extend(a,r.padding);var s=this.transform,l=s.padding,c=s.project(t.LngLat.convert(e)),u=s.project(t.LngLat.convert(i)),h=c.rotate(-o*Math.PI/180),p=u.rotate(-o*Math.PI/180),d=new t.Point(Math.max(h.x,p.x),Math.max(h.y,p.y)),_=new t.Point(Math.min(h.x,p.x),Math.min(h.y,p.y)),f=d.sub(_),m=(s.width-(l.left+l.right+r.padding.left+r.padding.right))/f.x,g=(s.height-(l.top+l.bottom+r.padding.top+r.padding.bottom))/f.y;if(!(g<0||m<0)){var v=Math.min(s.scaleZoom(s.scale*Math.min(m,g)),r.maxZoom),y=t.Point.convert(r.offset),x=new t.Point(y.x+(r.padding.left-r.padding.right)/2,y.y+(r.padding.top-r.padding.bottom)/2).mult(s.scale/s.zoomScale(v));return {center:s.unproject(c.add(u).div(2).sub(x)),zoom:v,bearing:o}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");},i.prototype.fitBounds=function(t,e,i){return this._fitInternal(this.cameraForBounds(t,e),e,i)},i.prototype.fitScreenCoordinates=function(e,i,o,r,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(i)),o,r),r,a)},i.prototype._fitInternal=function(e,i,o){return e?(delete(i=t.extend(e,i)).padding,i.linear?this.easeTo(i,o):this.flyTo(i,o)):this},i.prototype.jumpTo=function(e,i){this.stop();var o=this.transform,r=!1,a=!1,n=!1;return "zoom"in e&&o.zoom!==+e.zoom&&(r=!0,o.zoom=+e.zoom),void 0!==e.center&&(o.center=t.LngLat.convert(e.center)),"bearing"in e&&o.bearing!==+e.bearing&&(a=!0,o.bearing=+e.bearing),"pitch"in e&&o.pitch!==+e.pitch&&(n=!0,o.pitch=+e.pitch),null==e.padding||o.isPaddingEqual(e.padding)||(o.padding=e.padding),this.fire(new t.Event("movestart",i)).fire(new t.Event("move",i)),r&&this.fire(new t.Event("zoomstart",i)).fire(new t.Event("zoom",i)).fire(new t.Event("zoomend",i)),a&&this.fire(new t.Event("rotatestart",i)).fire(new t.Event("rotate",i)).fire(new t.Event("rotateend",i)),n&&this.fire(new t.Event("pitchstart",i)).fire(new t.Event("pitch",i)).fire(new t.Event("pitchend",i)),this.fire(new t.Event("moveend",i))},i.prototype.easeTo=function(e,i){var o=this;this.stop(),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.browser.prefersReducedMotion)&&(e.duration=0);var r=this.transform,a=this.getZoom(),n=this.getBearing(),s=this.getPitch(),l=this.getPadding(),c="zoom"in e?+e.zoom:a,u="bearing"in e?this._normalizeBearing(e.bearing,n):n,h="pitch"in e?+e.pitch:s,p="padding"in e?e.padding:r.padding,d=t.Point.convert(e.offset),_=r.centerPoint.add(d),f=r.pointLocation(_),m=t.LngLat.convert(e.center||f);this._normalizeCenter(m);var g,v,y=r.project(f),x=r.project(m).sub(y),b=r.zoomScale(c-a);return e.around&&(g=t.LngLat.convert(e.around),v=r.locationPoint(g)),this._zooming=c!==a,this._rotating=n!==u,this._pitching=h!==s,this._padding=!r.isPaddingEqual(p),this._prepareEase(i,e.noMoveStart),clearTimeout(this._easeEndTimeoutID),this._ease((function(e){if(o._zooming&&(r.zoom=t.number(a,c,e)),o._rotating&&(r.bearing=t.number(n,u,e)),o._pitching&&(r.pitch=t.number(s,h,e)),o._padding&&(r.interpolatePadding(l,p,e),_=r.centerPoint.add(d)),g)r.setLocationAtPoint(g,v);else{var f=r.zoomScale(r.zoom-a),m=c>a?Math.min(2,b):Math.max(.5,b),w=Math.pow(m,1-e),E=r.unproject(y.add(x.mult(e*w)).mult(f));r.setLocationAtPoint(r.renderWorldCopies?E.wrap():E,_);}o._fireMoveEvents(i);}),(function(){e.delayEndEvents?o._easeEndTimeoutID=setTimeout((function(){return o._afterEase(i)}),e.delayEndEvents):o._afterEase(i);}),e),this},i.prototype._prepareEase=function(e,i){this._moving=!0,i||this.fire(new t.Event("movestart",e)),this._zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&this.fire(new t.Event("pitchstart",e));},i.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e));},i.prototype._afterEase=function(e){var i=this._zooming,o=this._rotating,r=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new t.Event("zoomend",e)),o&&this.fire(new t.Event("rotateend",e)),r&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e));},i.prototype.flyTo=function(e,i){var o=this;if(!e.essential&&t.browser.prefersReducedMotion){var r=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,i)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var a=this.transform,n=this.getZoom(),s=this.getBearing(),l=this.getPitch(),c=this.getPadding(),u="zoom"in e?t.clamp(+e.zoom,a.minZoom,a.maxZoom):n,h="bearing"in e?this._normalizeBearing(e.bearing,s):s,p="pitch"in e?+e.pitch:l,d="padding"in e?e.padding:a.padding,_=a.zoomScale(u-n),f=t.Point.convert(e.offset),m=a.centerPoint.add(f),g=a.pointLocation(m),v=t.LngLat.convert(e.center||g);this._normalizeCenter(v);var y=a.project(g),x=a.project(v).sub(y),b=e.curve,w=Math.max(a.width,a.height),E=w/_,T=x.mag();if("minZoom"in e){var I=t.clamp(Math.min(e.minZoom,n,u),a.minZoom,a.maxZoom),C=w/a.zoomScale(I-n);b=Math.sqrt(C/T*2);}var S=b*b;function P(t){var e=(E*E-w*w+(t?-1:1)*S*S*T*T)/(2*(t?E:w)*S*T);return Math.log(Math.sqrt(e*e+1)-e)}function z(t){return (Math.exp(t)-Math.exp(-t))/2}function L(t){return (Math.exp(t)+Math.exp(-t))/2}var M=P(0),D=function(t){return L(M)/L(M+b*t)},A=function(t){return w*((L(M)*(z(e=M+b*t)/L(e))-z(M))/S)/T;var e;},R=(P(1)-M)/b;if(Math.abs(T)<1e-6||!isFinite(R)){if(Math.abs(w-E)<1e-6)return this.easeTo(e,i);var k=E<w?-1:1;R=Math.abs(Math.log(E/w))/b,A=function(){return 0},D=function(t){return Math.exp(k*b*t)};}return e.duration="duration"in e?+e.duration:1e3*R/("screenSpeed"in e?+e.screenSpeed/b:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==h,this._pitching=p!==l,this._padding=!a.isPaddingEqual(d),this._prepareEase(i,!1),this._ease((function(e){var r=e*R,_=1/D(r);a.zoom=1===e?u:n+a.scaleZoom(_),o._rotating&&(a.bearing=t.number(s,h,e)),o._pitching&&(a.pitch=t.number(l,p,e)),o._padding&&(a.interpolatePadding(c,d,e),m=a.centerPoint.add(f));var g=1===e?v:a.unproject(y.add(x.mult(A(r))).mult(_));a.setLocationAtPoint(a.renderWorldCopies?g.wrap():g,m),o._fireMoveEvents(i);}),(function(){return o._afterEase(i)}),e),this},i.prototype.isEasing=function(){return !!this._easeFrameId},i.prototype.stop=function(){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var t=this._onEaseEnd;delete this._onEaseEnd,t.call(this);}return this},i.prototype._ease=function(e,i,o){!1===o.animate||0===o.duration?(e(1),i()):(this._easeStart=t.browser.now(),this._easeOptions=o,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback));},i.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop();},i.prototype._normalizeBearing=function(e,i){e=t.wrap(e,-180,180);var o=Math.abs(e-i);return Math.abs(e-360-i)<o&&(e-=360),Math.abs(e+360-i)<o&&(e+=360),e},i.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0;}},i}(t.Evented),No=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_updateEditLink","_updateData","_updateCompact"],this);};No.prototype.getDefaultPosition=function(){return "bottom-right"},No.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._innerContainer=i.create("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},No.prototype.onRemove=function(){i.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0;},No.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){var o=i.reduce((function(t,e,o){return e.value&&(t+=e.key+"="+e.value+(o<i.length-1?"&":"")),t}),"?");e.href=t.config.FEEDBACK_URL+"/"+o+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener nofollow";}},No.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink());},No.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((function(t){return "string"!=typeof t?"":t}))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id;}var i=this._map.style.sourceCaches;for(var o in i){var r=i[o];if(r.used){var a=r.getSource();a.attribution&&t.indexOf(a.attribution)<0&&t.push(a.attribution);}}t.sort((function(t,e){return t.length-e.length}));var n=(t=t.filter((function(e,i){for(var o=i+1;o<t.length;o++)if(t[o].indexOf(e)>=0)return !1;return !0}))).join(" | ");n!==this._attribHTML&&(this._attribHTML=n,t.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null);}},No.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact");};var Zo=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this);};Zo.prototype.onAdd=function(t){this._map=t,this._container=i.create("div","mapboxgl-ctrl");var e=i.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Zo.prototype.onRemove=function(){i.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact);},Zo.prototype.getDefaultPosition=function(){return "bottom-left"},Zo.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none");},Zo.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return !0;return !1}},Zo.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact");}};var qo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1;};qo.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},qo.prototype.remove=function(t){for(var e=this._currentlyRunning,i=0,o=e?this._queue.concat(e):this._queue;i<o.length;i+=1){var r=o[i];if(r.id===t)return void(r.cancelled=!0)}},qo.prototype.run=function(){var t=this._currentlyRunning=this._queue;this._queue=[];for(var e=0,i=t;e<i.length;e+=1){var o=i[e];if(!o.cancelled&&(o.callback(),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1;},qo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[];};var jo={"FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Vo=t.window.HTMLImageElement,Go=t.window.HTMLElement,Wo=t.window.ImageBitmap,Xo=0,Ho=60,Ko={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:Xo,maxPitch:Ho,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,clickTolerance:3,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Yo=function(o){function r(e){var r=this;if(null!=(e=t.extend({},Ko,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<Xo)throw new Error("minPitch must be greater than or equal to "+Xo);if(null!=e.maxPitch&&e.maxPitch>Ho)throw new Error("maxPitch must be less than or equal to "+Ho);var a=new bo(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(o.call(this,a,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new qo,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},jo,e.locale),this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof Go))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container;}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return r._update(!1)})),this.on("moveend",(function(){return r._update(!1)})),this.on("zoom",(function(){return r._update(!0)})),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1)),function(t,e){var o=t.getCanvasContainer(),r=null,a=!1,n=null;for(var s in Fo)t[s]=new Fo[s](t,e),e.interactive&&e[s]&&t[s].enable(e[s]);i.addEventListener(o,"mouseout",(function(e){t.fire(new To("mouseout",t,e));})),i.addEventListener(o,"mousedown",(function(r){a=!0,n=i.mousePos(o,r);var s=new To("mousedown",t,r);t.fire(s),s.defaultPrevented||(e.interactive&&!t.doubleClickZoom.isActive()&&t.stop(),t.boxZoom.onMouseDown(r),t.boxZoom.isActive()||t.dragPan.isActive()||t.dragRotate.onMouseDown(r),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onMouseDown(r));})),i.addEventListener(o,"mouseup",(function(e){var i=t.dragRotate.isActive();r&&!i&&t.fire(new To("contextmenu",t,r)),r=null,a=!1,t.fire(new To("mouseup",t,e));})),i.addEventListener(o,"mousemove",(function(e){if(!t.dragPan.isActive()&&!t.dragRotate.isActive()){for(var i=e.target;i&&i!==o;)i=i.parentNode;i===o&&t.fire(new To("mousemove",t,e));}})),i.addEventListener(o,"mouseover",(function(e){for(var i=e.target;i&&i!==o;)i=i.parentNode;i===o&&t.fire(new To("mouseover",t,e));})),i.addEventListener(o,"touchstart",(function(i){var o=new Io("touchstart",t,i);t.fire(o),o.defaultPrevented||(e.interactive&&t.stop(),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onTouchStart(i),t.touchZoomRotate.onStart(i),t.doubleClickZoom.onTouchStart(o));}),{passive:!1}),i.addEventListener(o,"touchmove",(function(e){t.fire(new Io("touchmove",t,e));}),{passive:!1}),i.addEventListener(o,"touchend",(function(e){t.fire(new Io("touchend",t,e));})),i.addEventListener(o,"touchcancel",(function(e){t.fire(new Io("touchcancel",t,e));})),i.addEventListener(o,"click",(function(r){var a=i.mousePos(o,r);(!n||a.equals(n)||a.dist(n)<e.clickTolerance)&&t.fire(new To("click",t,r));})),i.addEventListener(o,"dblclick",(function(e){var i=new To("dblclick",t,e);t.fire(i),i.defaultPrevented||t.doubleClickZoom.onDblClick(i);})),i.addEventListener(o,"contextmenu",(function(e){var i=t.dragRotate.isActive();a||i?a&&(r=e):t.fire(new To("contextmenu",t,e)),(t.dragRotate.isEnabled()||t.listens("contextmenu"))&&e.preventDefault();})),i.addEventListener(o,"wheel",(function(i){e.interactive&&t.stop();var o=new Co("wheel",t,i);t.fire(o),o.defaultPrevented||t.scrollZoom.onWheel(i);}),{passive:!1});}(this,e),this._hash=e.hash&&new Eo("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new No({customAttribution:e.customAttribution})),this.addControl(new Zo,e.logoPosition),this.on("style.load",(function(){r.transform.unmodified&&r.jumpTo(r.style.stylesheet);})),this.on("data",(function(e){r._update("style"===e.dataType),r.fire(new t.Event(e.dataType+"data",e));})),this.on("dataloading",(function(e){r.fire(new t.Event(e.dataType+"dataloading",e));}));}o&&(r.__proto__=o),(r.prototype=Object.create(o&&o.prototype)).constructor=r;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return r.prototype._getMapId=function(){return this._mapId},r.prototype.addControl=function(e,i){if(void 0===i&&e.getDefaultPosition&&(i=e.getDefaultPosition()),void 0===i&&(i="top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var o=e.onAdd(this);this._controls.push(e);var r=this._controlPositions[i];return -1!==i.indexOf("bottom")?r.insertBefore(o,r.firstChild):r.appendChild(o),this},r.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var i=this._controls.indexOf(e);return i>-1&&this._controls.splice(i,1),e.onRemove(this),this},r.prototype.resize=function(e){var i=this._containerDimensions(),o=i[0],r=i[1];return this._resizeCanvas(o,r),this.transform.resize(o,r),this.painter.resize(o,r),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)).fire(new t.Event("resize",e)).fire(new t.Event("moveend",e)),this},r.prototype.getBounds=function(){return this.transform.getBounds()},r.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},r.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},r.prototype.setMinZoom=function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},r.prototype.getMinZoom=function(){return this.transform.minZoom},r.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},r.prototype.getMaxZoom=function(){return this.transform.maxZoom},r.prototype.setMinPitch=function(t){if((t=null==t?Xo:t)<Xo)throw new Error("minPitch must be greater than or equal to "+Xo);if(t>=Xo&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between "+Xo+" and the current maxPitch, inclusive")},r.prototype.getMinPitch=function(){return this.transform.minPitch},r.prototype.setMaxPitch=function(t){if((t=null==t?Ho:t)>Ho)throw new Error("maxPitch must be less than or equal to "+Ho);if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")},r.prototype.getMaxPitch=function(){return this.transform.maxPitch},r.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},r.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},r.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},r.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},r.prototype.isMoving=function(){return this._moving||this.dragPan.isActive()||this.dragRotate.isActive()||this.scrollZoom.isActive()},r.prototype.isZooming=function(){return this._zooming||this.scrollZoom.isZooming()},r.prototype.isRotating=function(){return this._rotating||this.dragRotate.isActive()},r.prototype._createDelegatedListener=function(t,e,i){var o,r=this;if("mouseenter"===t||"mouseover"===t){var a=!1;return {layer:e,listener:i,delegates:{mousemove:function(o){var n=r.getLayer(e)?r.queryRenderedFeatures(o.point,{layers:[e]}):[];n.length?a||(a=!0,i.call(r,new To(t,r,o.originalEvent,{features:n}))):a=!1;},mouseout:function(){a=!1;}}}}if("mouseleave"===t||"mouseout"===t){var n=!1;return {layer:e,listener:i,delegates:{mousemove:function(o){(r.getLayer(e)?r.queryRenderedFeatures(o.point,{layers:[e]}):[]).length?n=!0:n&&(n=!1,i.call(r,new To(t,r,o.originalEvent)));},mouseout:function(e){n&&(n=!1,i.call(r,new To(t,r,e.originalEvent)));}}}}return {layer:e,listener:i,delegates:(o={},o[t]=function(t){var o=r.getLayer(e)?r.queryRenderedFeatures(t.point,{layers:[e]}):[];o.length&&(t.features=o,i.call(r,t),delete t.features);},o)}},r.prototype.on=function(t,e,i){if(void 0===i)return o.prototype.on.call(this,t,e);var r=this._createDelegatedListener(t,e,i);for(var a in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(r),r.delegates)this.on(a,r.delegates[a]);return this},r.prototype.once=function(t,e,i){if(void 0===i)return o.prototype.once.call(this,t,e);var r=this._createDelegatedListener(t,e,i);for(var a in r.delegates)this.once(a,r.delegates[a]);return this},r.prototype.off=function(t,e,i){var r=this;return void 0===i?o.prototype.off.call(this,t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&function(o){for(var a=o[t],n=0;n<a.length;n++){var s=a[n];if(s.layer===e&&s.listener===i){for(var l in s.delegates)r.off(l,s.delegates[l]);return a.splice(n,1),r}}}(this._delegatedListeners),this)},r.prototype.queryRenderedFeatures=function(e,i){if(!this.style)return [];var o;if(void 0!==i||void 0===e||e instanceof t.Point||Array.isArray(e)||(i=e,e=void 0),i=i||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])o=[t.Point.convert(e)];else{var r=t.Point.convert(e[0]),a=t.Point.convert(e[1]);o=[r,new t.Point(a.x,r.y),a,new t.Point(r.x,a.y),r];}return this.style.queryRenderedFeatures(o,i,this.transform)},r.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},r.prototype.setStyle=function(e,i){return !1!==(i=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(e,i))},r.prototype._getUIString=function(t){var e=this._locale[t];if(null==e)throw new Error("Missing UI string '"+t+"'");return e},r.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new Ne(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},r.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ne(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty());},r.prototype._diffStyle=function(e,i){var o=this;if("string"==typeof e){var r=this._requestManager.normalizeStyleURL(e),a=this._requestManager.transformRequest(r,t.ResourceType.Style);t.getJSON(a,(function(e,r){e?o.fire(new t.ErrorEvent(e)):r&&o._updateDiff(r,i);}));}else"object"==typeof e&&this._updateDiff(e,i);},r.prototype._updateDiff=function(e,i){try{this.style.setState(e)&&this._update(!0);}catch(o){t.warnOnce("Unable to perform style diff: "+(o.message||o.error||o)+".  Rebuilding the style from scratch."),this._updateStyle(e,i);}},r.prototype.getStyle=function(){if(this.style)return this.style.serialize()},r.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},r.prototype.addSource=function(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)},r.prototype.isSourceLoaded=function(e){var i=this.style&&this.style.sourceCaches[e];if(void 0!==i)return i.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")));},r.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var i=t[e]._tiles;for(var o in i){var r=i[o];if("loaded"!==r.state&&"errored"!==r.state)return !1}}return !0},r.prototype.addSourceType=function(t,e,i){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)},r.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},r.prototype.getSource=function(t){return this.style.getSource(t)},r.prototype.addImage=function(e,i,o){void 0===o&&(o={});var r=o.pixelRatio;void 0===r&&(r=1);var a=o.sdf;void 0===a&&(a=!1);var n=o.stretchX,s=o.stretchY,l=o.content;if(this._lazyInitEmptyStyle(),i instanceof Vo||Wo&&i instanceof Wo){var c=t.browser.getImageData(i);this.style.addImage(e,{data:new t.RGBAImage({width:c.width,height:c.height},c.data),pixelRatio:r,stretchX:n,stretchY:s,content:l,sdf:a,version:0});}else{if(void 0===i.width||void 0===i.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var u=i;this.style.addImage(e,{data:new t.RGBAImage({width:i.width,height:i.height},new Uint8Array(i.data)),pixelRatio:r,stretchX:n,stretchY:s,content:l,sdf:a,version:0,userImage:u}),u.onAdd&&u.onAdd(this,e);}},r.prototype.updateImage=function(e,i){var o=this.style.getImage(e);if(!o)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var r=i instanceof Vo||Wo&&i instanceof Wo?t.browser.getImageData(i):i,a=r.width,n=r.height,s=r.data;return void 0===a||void 0===n?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):a!==o.data.width||n!==o.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(o.data.replace(s,!(i instanceof Vo||Wo&&i instanceof Wo)),void this.style.updateImage(e,o))},r.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},r.prototype.removeImage=function(t){this.style.removeImage(t);},r.prototype.loadImage=function(e,i){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),i);},r.prototype.listImages=function(){return this.style.listImages()},r.prototype.addLayer=function(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)},r.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},r.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},r.prototype.getLayer=function(t){return this.style.getLayer(t)},r.prototype.setLayerZoomRange=function(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0)},r.prototype.setFilter=function(t,e,i){return void 0===i&&(i={}),this.style.setFilter(t,e,i),this._update(!0)},r.prototype.getFilter=function(t){return this.style.getFilter(t)},r.prototype.setPaintProperty=function(t,e,i,o){return void 0===o&&(o={}),this.style.setPaintProperty(t,e,i,o),this._update(!0)},r.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},r.prototype.setLayoutProperty=function(t,e,i,o){return void 0===o&&(o={}),this.style.setLayoutProperty(t,e,i,o),this._update(!0)},r.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},r.prototype.setLight=function(t,e){return void 0===e&&(e={}),this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)},r.prototype.getLight=function(){return this.style.getLight()},r.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},r.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},r.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},r.prototype.getContainer=function(){return this._container},r.prototype.getCanvasContainer=function(){return this._canvasContainer},r.prototype.getCanvas=function(){return this._canvas},r.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},r.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.");},r.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=i.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=i.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=i.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var o=this._containerDimensions();this._resizeCanvas(o[0],o[1]);var r=this._controlContainer=i.create("div","mapboxgl-control-container",t),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(t){a[t]=i.create("div","mapboxgl-ctrl-"+t,r);}));},r.prototype._resizeCanvas=function(e,i){var o=t.browser.devicePixelRatio||1;this._canvas.width=o*e,this._canvas.height=o*i,this._canvas.style.width=e+"px",this._canvas.style.height=i+"px";},r.prototype._setupPainter=function(){var i=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",i)||this._canvas.getContext("experimental-webgl",i);o?(this.painter=new go(o,this.transform),t.webpSupported.testSupport(o)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")));},r.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}));},r.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}));},r.prototype.loaded=function(){return !this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},r.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},r.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},r.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t);},r.prototype._render=function(){var e,i=this,o=0,r=this.painter.context.extTimerQuery;this.listens("gpu-timing-frame")&&(e=r.createQueryEXT(),r.beginQueryEXT(r.TIME_ELAPSED_EXT,e),o=t.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run();var a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var n=this.transform.zoom,s=t.browser.now();this.style.zoomHistory.update(n,s);var l=new t.EvaluationParameters(n,{now:s,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),c=l.crossFadingFactor();1===c&&c===this._crossFadingFactor||(a=!0,this._crossFadingFactor=c),this.style.update(l);}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var u=t.browser.now()-o;r.endQueryEXT(r.TIME_ELAPSED_EXT,e),setTimeout((function(){var o=r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(e),i.fire(new t.Event("gpu-timing-frame",{cpuTime:u,gpuTime:o}));}),50);}if(this.listens("gpu-timing-layer")){var h=this.painter.collectGpuTimers();setTimeout((function(){var e=i.painter.queryGpuTimers(h);i.fire(new t.Event("gpu-timing-layer",{layerTimes:e}));}),50);}return this._sourcesDirty||this._styleDirty||this._placementDirty||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&(this._fullyLoaded||(this._fullyLoaded=!0),this.fire(new t.Event("idle"))),this},r.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,i=this._controls;e<i.length;e+=1)i[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var o=this.painter.context.gl.getExtension("WEBGL_lose_context");o&&o.loseContext(),Jo(this._canvasContainer),Jo(this._controlContainer),Jo(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this.fire(new t.Event("remove"));},r.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame((function(t){e._frame=null,e._render();})));},r.prototype._onWindowOnline=function(){this._update();},r.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update();},a.showTileBoundaries.get=function(){return !!this._showTileBoundaries},a.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update());},a.showPadding.get=function(){return !!this._showPadding},a.showPadding.set=function(t){this._showPadding!==t&&(this._showPadding=t,this._update());},a.showCollisionBoxes.get=function(){return !!this._showCollisionBoxes},a.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update());},a.showOverdrawInspector.get=function(){return !!this._showOverdrawInspector},a.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update());},a.repaint.get=function(){return !!this._repaint},a.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint());},a.vertices.get=function(){return !!this._vertices},a.vertices.set=function(t){this._vertices=t,this._update();},r.prototype._setCacheLimits=function(e,i){t.setCacheLimits(e,i);},a.version.get=function(){return t.version},Object.defineProperties(r.prototype,a),r}(Uo);function Jo(t){t.parentNode&&t.parentNode.removeChild(t);}var Qo={showCompass:!0,showZoom:!0,visualizePitch:!1},$o=function(e){var o=this;this.options=t.extend({},Qo,e),this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(t){return o._map.zoomIn({},{originalEvent:t})})),i.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(t){return o._map.zoomOut({},{originalEvent:t})})),i.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(t){o.options.visualizePitch?o._map.resetNorthPitch({},{originalEvent:t}):o._map.resetNorth({},{originalEvent:t});})),this._compassIcon=i.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0));};function tr(e,i,o){if(e=new t.LngLat(e.lng,e.lat),i){var r=new t.LngLat(e.lng-360,e.lat),a=new t.LngLat(e.lng+360,e.lat),n=o.locationPoint(e).distSqr(i);o.locationPoint(r).distSqr(i)<n?e=r:o.locationPoint(a).distSqr(i)<n&&(e=a);}for(;Math.abs(e.lng-o.center.lng)>180;){var s=o.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=o.width&&s.y<=o.height)break;e.lng>o.center.lng?e.lng-=360:e.lng+=360;}return e}$o.prototype._updateZoomButtons=function(){var t=this._map.getZoom();this._zoomInButton.disabled=t===this._map.getMaxZoom(),this._zoomOutButton.disabled=t===this._map.getMinZoom();},$o.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=t;},$o.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Lo(t,{button:"left",element:this._compass,clickTolerance:t.dragRotate._clickTolerance}),i.addEventListener(this._compass,"mousedown",this._handler.onMouseDown),i.addEventListener(this._compass,"touchstart",this._handler.onMouseDown,{passive:!1}),this._handler.enable()),this._container},$o.prototype.onRemove=function(){i.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),i.removeEventListener(this._compass,"mousedown",this._handler.onMouseDown),i.removeEventListener(this._compass,"touchstart",this._handler.onMouseDown,{passive:!1}),this._handler.disable(),delete this._handler),delete this._map;},$o.prototype._createButton=function(t,e){var o=i.create("button",t,this._container);return o.type="button",o.addEventListener("click",e),o},$o.prototype._setButtonTitle=function(t,e){var i=this._map._getUIString("NavigationControl."+e);t.title=i,t.setAttribute("aria-label",i);};var er={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ir(t,e,i){var o=t.classList;for(var r in er)o.remove("mapboxgl-"+i+"-anchor-"+r);o.add("mapboxgl-"+i+"-anchor-"+e);}var or,rr=function(e){function o(o,r){var a=this;if(e.call(this),(o instanceof t.window.HTMLElement||r)&&(o=t.extend({element:o},r)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._draggable=o&&o.draggable||!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=t.Point.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=i.create("div"),this._element.setAttribute("aria-label","Map marker");var n=i.createNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height","41px"),n.setAttributeNS(null,"width","27px"),n.setAttributeNS(null,"viewBox","0 0 27 41");var s=i.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"stroke","none"),s.setAttributeNS(null,"stroke-width","1"),s.setAttributeNS(null,"fill","none"),s.setAttributeNS(null,"fill-rule","evenodd");var l=i.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"fill-rule","nonzero");var c=i.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"transform","translate(3.0, 29.0)"),c.setAttributeNS(null,"fill","#000000");for(var u=0,h=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];u<h.length;u+=1){var p=h[u],d=i.createNS("http://www.w3.org/2000/svg","ellipse");d.setAttributeNS(null,"opacity","0.04"),d.setAttributeNS(null,"cx","10.5"),d.setAttributeNS(null,"cy","5.80029008"),d.setAttributeNS(null,"rx",p.rx),d.setAttributeNS(null,"ry",p.ry),c.appendChild(d);}var _=i.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill",this._color);var f=i.createNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),_.appendChild(f);var m=i.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"fill","#000000");var g=i.createNS("http://www.w3.org/2000/svg","path");g.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),m.appendChild(g);var v=i.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"transform","translate(6.0, 7.0)"),v.setAttributeNS(null,"fill","#FFFFFF");var y=i.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(8.0, 8.0)");var x=i.createNS("http://www.w3.org/2000/svg","circle");x.setAttributeNS(null,"fill","#000000"),x.setAttributeNS(null,"opacity","0.25"),x.setAttributeNS(null,"cx","5.5"),x.setAttributeNS(null,"cy","5.5"),x.setAttributeNS(null,"r","5.4999962");var b=i.createNS("http://www.w3.org/2000/svg","circle");b.setAttributeNS(null,"fill","#FFFFFF"),b.setAttributeNS(null,"cx","5.5"),b.setAttributeNS(null,"cy","5.5"),b.setAttributeNS(null,"r","5.4999962"),y.appendChild(x),y.appendChild(b),l.appendChild(c),l.appendChild(_),l.appendChild(m),l.appendChild(v),l.appendChild(y),n.appendChild(l),this._element.appendChild(n),this._offset=t.Point.convert(o&&o.offset||[0,-14]);}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(t){t.preventDefault();})),this._element.addEventListener("mousedown",(function(t){t.preventDefault();})),this._element.addEventListener("focus",(function(){var t=a._map.getContainer();t.scrollTop=0,t.scrollLeft=0;})),ir(this._element,this._anchor,"marker"),this._popup=null;}return e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o,o.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},o.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),i.remove(this._element),this._popup&&this._popup.remove(),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},o.prototype.getElement=function(){return this._element},o.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset;}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress);}return this},o.prototype._onKeyPress=function(t){var e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup();},o.prototype._onMapClick=function(t){var e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup();},o.prototype.getPopup=function(){return this._popup},o.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},o.prototype._update=function(t){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=tr(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(e="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var o="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?o="rotateX(0deg)":"map"===this._pitchAlignment&&(o="rotateX("+this._map.getPitch()+"deg)"),t&&"moveend"!==t.type||(this._pos=this._pos.round()),i.setTransform(this._element,er[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+o+" "+e);}},o.prototype.getOffset=function(){return this._offset},o.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},o.prototype._onMove=function(e){this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag"));},o.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive";},o.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp));},o.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},o.prototype.isDraggable=function(){return this._draggable},o.prototype.setRotation=function(t){return this._rotation=t||0,this._update(),this},o.prototype.getRotation=function(){return this._rotation},o.prototype.setRotationAlignment=function(t){return this._rotationAlignment=t||"auto",this._update(),this},o.prototype.getRotationAlignment=function(){return this._rotationAlignment},o.prototype.setPitchAlignment=function(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this},o.prototype.getPitchAlignment=function(){return this._pitchAlignment},o}(t.Evented),ar={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},nr=0,sr=!1,lr=function(e){function o(i){e.call(this),this.options=t.extend({},ar,i),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this);}return e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o,o.prototype.onAdd=function(e){var o;return this._map=e,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,void 0!==or?o(or):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((function(t){o(or="denied"!==t.state);})):o(or=!!t.window.navigator.geolocation),this._container},o.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),i.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,nr=0,sr=!1;},o.prototype._isOutOfMapMaxBounds=function(t){var e=this._map.getMaxBounds(),i=t.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())},o.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");}},o.prototype._onSuccess=function(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish();}},o.prototype._updateCamera=function(e){var i=new t.LngLat(e.coords.longitude,e.coords.latitude),o=e.coords.accuracy,r=this._map.getBearing(),a=t.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(o),a,{geolocateSource:!0});},o.prototype._updateMarker=function(e){if(e){var i=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius();}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove();},o.prototype._updateCircleRadius=function(){var t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),i=this._map.unproject([1,t]),o=e.distanceTo(i),r=Math.ceil(2*this._accuracy/o);this._circleElement.style.width=r+"px",this._circleElement.style.height=r+"px";},o.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius();},o.prototype._onError=function(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),void 0!==this._geolocationWatchID&&this._clearWatch();}else{if(3===e.code&&sr)return;this._setErrorState();}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish();}},o.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0;},o.prototype._setupUI=function(e){var o=this;if(this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this._geolocateButton=i.create("button","mapboxgl-ctrl-geolocate",this._container),i.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r);}else{var a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a);}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=i.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new rr(this._dotElement),this._circleElement=i.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new rr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(e){e.geolocateSource||"ACTIVE_LOCK"!==o._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(o._watchState="BACKGROUND",o._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),o._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),o.fire(new t.Event("trackuserlocationend")));}));},o.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":nr--,sr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"));}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error");}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++nr>1?(e={maximumAge:6e5,timeout:0},sr=!0):(e=this.options.positionOptions,sr=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e);}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return !0},o.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null);},o}(t.Evented),cr={maxWidth:100,unit:"metric"},ur=function(e){this.options=t.extend({},cr,e),t.bindAll(["_onMove","setUnit"],this);};function hr(t,e,i){var o=i&&i.maxWidth||100,r=t._container.clientHeight/2,a=t.unproject([0,r]),n=t.unproject([o,r]),s=a.distanceTo(n);if(i&&"imperial"===i.unit){var l=3.2808*s;l>5280?pr(e,o,l/5280,t._getUIString("ScaleControl.Miles")):pr(e,o,l,t._getUIString("ScaleControl.Feet"));}else i&&"nautical"===i.unit?pr(e,o,s/1852,t._getUIString("ScaleControl.NauticalMiles")):s>=1e3?pr(e,o,s/1e3,t._getUIString("ScaleControl.Kilometers")):pr(e,o,s,t._getUIString("ScaleControl.Meters"));}function pr(t,e,i,o){var r,a,n,s=(r=i,(a=Math.pow(10,(""+Math.floor(r)).length-1))*(n=(n=r/a)>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(n)));t.style.width=e*(s/i)+"px",t.innerHTML=s+"&nbsp;"+o;}ur.prototype.getDefaultPosition=function(){return "bottom-left"},ur.prototype._onMove=function(){hr(this._map,this._container,this.options);},ur.prototype.onAdd=function(t){return this._map=t,this._container=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},ur.prototype.onRemove=function(){i.remove(this._container),this._map.off("move",this._onMove),this._map=void 0;},ur.prototype.setUnit=function(t){this.options.unit=t,hr(this._map,this._container,this.options);};var dr=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange");};dr.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=i.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},dr.prototype.onRemove=function(){i.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon);},dr.prototype._checkFullscreenSupport=function(){return !!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},dr.prototype._setupUI=function(){var e=this._fullscreenButton=i.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);i.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon);},dr.prototype._updateTitle=function(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t;},dr.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},dr.prototype._isFullscreen=function(){return this._fullscreen},dr.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle());},dr.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen();};var _r={closeButton:!0,closeOnClick:!0,className:"",maxWidth:"240px"},fr=function(e){function o(i){e.call(this),this.options=t.extend(Object.create(_r),i),t.bindAll(["_update","_onClose","remove"],this);}return e&&(o.__proto__=e),(o.prototype=Object.create(e&&e.prototype)).constructor=o,o.prototype.addTo=function(e){var i=this;return this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._trackPointer?(this._map.on("mousemove",(function(t){i._update(t.point);})),this._map.on("mouseup",(function(t){i._update(t.point);})),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this},o.prototype.isOpen=function(){return !!this._map},o.prototype.remove=function(){return this._content&&i.remove(this._content),this._container&&(i.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove"),delete this._map),this.fire(new t.Event("close")),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove"),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},o.prototype.trackPointer=function(){var t=this;return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",(function(e){t._update(e.point);})),this._map.on("drag",(function(e){t._update(e.point);})),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},o.prototype.getElement=function(){return this._container},o.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},o.prototype.setHTML=function(e){var i,o=t.window.document.createDocumentFragment(),r=t.window.document.createElement("body");for(r.innerHTML=e;i=r.firstChild;)o.appendChild(i);return this.setDOMContent(o)},o.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},o.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},o.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},o.prototype.addClassName=function(t){this._container&&this._container.classList.add(t);},o.prototype.removeClassName=function(t){this._container&&this._container.classList.remove(t);},o.prototype.toggleClassName=function(t){if(this._container)return this._container.classList.toggle(t)},o.prototype._createContent=function(){this._content&&i.remove(this._content),this._content=i.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=i.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose));},o.prototype._update=function(e){var o=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=i.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=i.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(t){return o._container.classList.add(t)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=tr(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e)){var r=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),a=this.options.anchor,n=function e(i){if(i){if("number"==typeof i){var o=Math.round(Math.sqrt(.5*Math.pow(i,2)));return {center:new t.Point(0,0),top:new t.Point(0,i),"top-left":new t.Point(o,o),"top-right":new t.Point(-o,o),bottom:new t.Point(0,-i),"bottom-left":new t.Point(o,-o),"bottom-right":new t.Point(-o,-o),left:new t.Point(i,0),right:new t.Point(-i,0)}}if(i instanceof t.Point||Array.isArray(i)){var r=t.Point.convert(i);return {center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return {center:t.Point.convert(i.center||[0,0]),top:t.Point.convert(i.top||[0,0]),"top-left":t.Point.convert(i["top-left"]||[0,0]),"top-right":t.Point.convert(i["top-right"]||[0,0]),bottom:t.Point.convert(i.bottom||[0,0]),"bottom-left":t.Point.convert(i["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(i["bottom-right"]||[0,0]),left:t.Point.convert(i.left||[0,0]),right:t.Point.convert(i.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!a){var s,l=this._container.offsetWidth,c=this._container.offsetHeight;s=r.y+n.bottom.y<c?["top"]:r.y>this._map.transform.height-c?["bottom"]:[],r.x<l/2?s.push("left"):r.x>this._map.transform.width-l/2&&s.push("right"),a=0===s.length?"bottom":s.join("-");}var u=r.add(n[a]).round();i.setTransform(this._container,er[a]+" translate("+u.x+"px,"+u.y+"px)"),ir(this._container,a,"popup");}},o.prototype._onClose=function(){this.remove();},o}(t.Evented),mr={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:Yo,NavigationControl:$o,GeolocateControl:lr,AttributionControl:No,ScaleControl:ur,FullscreenControl:dr,Popup:fr,Marker:rr,Style:Ne,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e;},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e;},get workerCount(){return kt.workerCount},set workerCount(t){kt.workerCount=t;},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e;},clearStorage:function(e){t.clearTileCache(e);},workerUrl:""};return mr}));

//

return mapboxgl;

})));


},{}],6:[function(require,module,exports){
(function (global){
(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.Mapillary=e()}})(function(){var o,e,t;return function o(a,s,u){function c(r,e){if(!s[r]){if(!a[r]){var t=typeof require=="function"&&require;if(!e&&t)return t(r,!0);if(h)return h(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=s[r]={exports:{}};a[r][0].call(i.exports,function(e){var t=a[r][1][e];return c(t?t:e)},i,i.exports,o,a,s,u)}return s[r].exports}var h=typeof require=="function"&&require;for(var e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,t,r){"use strict";var b=e("tinyqueue");t.exports=n;t.exports.default=n;function n(e,t,r){t=t||1;var n,i,o,a;for(var s=0;s<e[0].length;s++){var u=e[0][s];if(!s||u[0]<n)n=u[0];if(!s||u[1]<i)i=u[1];if(!s||u[0]>o)o=u[0];if(!s||u[1]>a)a=u[1]}var c=o-n;var h=a-i;var l=Math.min(c,h);var p=l/2;var f=new b(null,w);if(l===0)return[n,i];for(var d=n;d<o;d+=l){for(var v=i;v<a;v+=l){f.push(new x(d+p,v+p,p,e))}}var m=S(e);var g=new x(n+c/2,i+h/2,0,e);if(g.d>m.d)m=g;var _=f.length;while(f.length){var y=f.pop();if(y.d>m.d){m=y;if(r)console.log("found best %d after %d probes",Math.round(1e4*y.d)/1e4,_)}if(y.max-m.d<=t)continue;p=y.h/2;f.push(new x(y.x-p,y.y-p,p,e));f.push(new x(y.x+p,y.y-p,p,e));f.push(new x(y.x-p,y.y+p,p,e));f.push(new x(y.x+p,y.y+p,p,e));_+=4}if(r){console.log("num probes: "+_);console.log("best distance: "+m.d)}return[m.x,m.y]}function w(e,t){return t.max-e.max}function x(e,t,r,n){this.x=e;this.y=t;this.h=r;this.d=i(e,t,n);this.max=this.d+this.h*Math.SQRT2}function i(e,t,r){var n=false;var i=Infinity;for(var o=0;o<r.length;o++){var a=r[o];for(var s=0,u=a.length,c=u-1;s<u;c=s++){var h=a[s];var l=a[c];if(h[1]>t!==l[1]>t&&e<(l[0]-h[0])*(t-h[1])/(l[1]-h[1])+h[0])n=!n;i=Math.min(i,p(e,t,h,l))}}return(n?1:-1)*Math.sqrt(i)}function S(e){var t=0;var r=0;var n=0;var i=e[0];for(var o=0,a=i.length,s=a-1;o<a;s=o++){var u=i[o];var c=i[s];var h=u[0]*c[1]-c[0]*u[1];r+=(u[0]+c[0])*h;n+=(u[1]+c[1])*h;t+=h*3}if(t===0)return new x(i[0][0],i[0][1],0,e);return new x(r/t,n/t,0,e)}function p(e,t,r,n){var i=r[0];var o=r[1];var a=n[0]-i;var s=n[1]-o;if(a!==0||s!==0){var u=((e-i)*a+(t-o)*s)/(a*a+s*s);if(u>1){i=n[0];o=n[1]}else if(u>0){i+=a*u;o+=s*u}}a=e-i;s=t-o;return a*a+s*s}},{tinyqueue:243}],2:[function(e,t,r){t.exports=n;function n(e,t,r,n){this.cx=3*e;this.bx=3*(r-e)-this.cx;this.ax=1-this.cx-this.bx;this.cy=3*t;this.by=3*(n-t)-this.cy;this.ay=1-this.cy-this.by;this.p1x=e;this.p1y=n;this.p2x=r;this.p2y=n}n.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e};n.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e};n.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx};n.prototype.solveCurveX=function(e,t){if(typeof t==="undefined")t=1e-6;var r,n,i,o,a;for(i=e,a=0;a<8;a++){o=this.sampleCurveX(i)-e;if(Math.abs(o)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i=i-o/s}r=0;n=1;i=e;if(i<r)return r;if(i>n)return n;while(r<n){o=this.sampleCurveX(i);if(Math.abs(o-e)<t)return i;if(e>o){r=i}else{n=i}i=(n-r)*.5+r}return i};n.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},{}],3:[function(e,t,r){"use strict";r.byteLength=a;r.toByteArray=s;r.fromByteArray=d;var c=[];var u=[];var h=typeof Uint8Array!=="undefined"?Uint8Array:Array;var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,o=n.length;i<o;++i){c[i]=n[i];u[n.charCodeAt(i)]=i}u["-".charCodeAt(0)]=62;u["_".charCodeAt(0)]=63;function l(e){var t=e.length;if(t%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return e[t-2]==="="?2:e[t-1]==="="?1:0}function a(e){return e.length*3/4-l(e)}function s(e){var t,r,n,i,o;var a=e.length;i=l(e);o=new h(a*3/4-i);r=i>0?a-4:a;var s=0;for(t=0;t<r;t+=4){n=u[e.charCodeAt(t)]<<18|u[e.charCodeAt(t+1)]<<12|u[e.charCodeAt(t+2)]<<6|u[e.charCodeAt(t+3)];o[s++]=n>>16&255;o[s++]=n>>8&255;o[s++]=n&255}if(i===2){n=u[e.charCodeAt(t)]<<2|u[e.charCodeAt(t+1)]>>4;o[s++]=n&255}else if(i===1){n=u[e.charCodeAt(t)]<<10|u[e.charCodeAt(t+1)]<<4|u[e.charCodeAt(t+2)]>>2;o[s++]=n>>8&255;o[s++]=n&255}return o}function p(e){return c[e>>18&63]+c[e>>12&63]+c[e>>6&63]+c[e&63]}function f(e,t,r){var n;var i=[];for(var o=t;o<r;o+=3){n=(e[o]<<16)+(e[o+1]<<8)+e[o+2];i.push(p(n))}return i.join("")}function d(e){var t;var r=e.length;var n=r%3;var i="";var o=[];var a=16383;for(var s=0,u=r-n;s<u;s+=a){o.push(f(e,s,s+a>u?u:s+a))}if(n===1){t=e[r-1];i+=c[t>>2];i+=c[t<<4&63];i+="=="}else if(n===2){t=(e[r-2]<<8)+e[r-1];i+=c[t>>10];i+=c[t>>4&63];i+=c[t<<2&63];i+="="}o.push(i);return o.join("")}},{}],4:[function(e,t,r){},{}],5:[function(e,t,r){t.exports=function e(h){var l=String.prototype.split,p=/()??/.exec("")[1]===h,t;t=function(e,t,r){if(Object.prototype.toString.call(t)!=="[object RegExp]"){return l.call(e,t,r)}var n=[],i=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.extended?"x":"")+(t.sticky?"y":""),o=0,t=new RegExp(t.source,i+"g"),a,s,u,c;e+="";if(!p){a=new RegExp("^"+t.source+"$(?!\\s)",i)}r=r===h?-1>>>0:r>>>0;while(s=t.exec(e)){u=s.index+s[0].length;if(u>o){n.push(e.slice(o,s.index));if(!p&&s.length>1){s[0].replace(a,function(){for(var e=1;e<arguments.length-2;e++){if(arguments[e]===h){s[e]=h}}})}if(s.length>1&&s.index<e.length){Array.prototype.push.apply(n,s.slice(1))}c=s[0].length;o=u;if(n.length>=r){break}}if(t.lastIndex===s.index){t.lastIndex++}}if(o===e.length){if(c||!t.test("")){n.push("")}}else{n.push(e.slice(o))}return n.length>r?n.slice(0,r):n};return t}()},{}],6:[function(e,t,r){var n=t.exports={};var i;var o;function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){i=setTimeout}else{i=a}}catch(e){i=a}try{if(typeof clearTimeout==="function"){o=clearTimeout}else{o=s}}catch(e){o=s}})();function u(t){if(i===setTimeout){return setTimeout(t,0)}if((i===a||!i)&&setTimeout){i=setTimeout;return setTimeout(t,0)}try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}function c(t){if(o===clearTimeout){return clearTimeout(t)}if((o===s||!o)&&clearTimeout){o=clearTimeout;return clearTimeout(t)}try{return o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}var h=[];var l=false;var p;var f=-1;function d(){if(!l||!p){return}l=false;if(p.length){h=p.concat(h)}else{f=-1}if(h.length){v()}}function v(){if(l){return}var e=u(d);l=true;var t=h.length;while(t){p=h;h=[];while(++f<t){if(p){p[f].run()}}f=-1;t=h.length}p=null;l=false;c(e)}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}}h.push(new m(e,t));if(h.length===1&&!l){u(v)}};function m(e,t){this.fun=e;this.array=t}m.prototype.run=function(){this.fun.apply(null,this.array)};n.title="browser";n.browser=true;n.env={};n.argv=[];n.version="";n.versions={};function g(){}n.on=g;n.addListener=g;n.once=g;n.off=g;n.removeListener=g;n.removeAllListeners=g;n.emit=g;n.prependListener=g;n.prependOnceListener=g;n.listeners=function(e){return[]};n.binding=function(e){throw new Error("process.binding is not supported")};n.cwd=function(){return"/"};n.chdir=function(e){throw new Error("process.chdir is not supported")};n.umask=function(){return 0}},{}],7:[function(e,t,n){"use strict";var i=e("base64-js");var o=e("ieee754");n.Buffer=p;n.SlowBuffer=_;n.INSPECT_MAX_BYTES=50;var r=2147483647;n.kMaxLength=r;p.TYPED_ARRAY_SUPPORT=a();if(!p.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function a(){try{var e=new Uint8Array(1);e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return e.foo()===42}catch(e){return false}}function s(e){if(e>r){throw new RangeError("Invalid typed array length")}var t=new Uint8Array(e);t.__proto__=p.prototype;return t}function p(e,t,r){if(typeof e==="number"){if(typeof t==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return l(e)}return u(e,t,r)}if(typeof Symbol!=="undefined"&&Symbol.species&&p[Symbol.species]===p){Object.defineProperty(p,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}p.poolSize=8192;function u(e,t,r){if(typeof e==="number"){throw new TypeError('"value" argument must not be a number')}if(Z(e)){return v(e,t,r)}if(typeof e==="string"){return f(e,t)}return m(e)}p.from=function(e,t,r){return u(e,t,r)};p.prototype.__proto__=Uint8Array.prototype;p.__proto__=Uint8Array;function c(e){if(typeof e!=="number"){throw new TypeError('"size" argument must be a number')}else if(e<0){throw new RangeError('"size" argument must not be negative')}}function h(e,t,r){c(e);if(e<=0){return s(e)}if(t!==undefined){return typeof r==="string"?s(e).fill(t,r):s(e).fill(t)}return s(e)}p.alloc=function(e,t,r){return h(e,t,r)};function l(e){c(e);return s(e<0?0:g(e)|0)}p.allocUnsafe=function(e){return l(e)};p.allocUnsafeSlow=function(e){return l(e)};function f(e,t){if(typeof t!=="string"||t===""){t="utf8"}if(!p.isEncoding(t)){throw new TypeError('"encoding" must be a valid string encoding')}var r=y(e,t)|0;var n=s(r);var i=n.write(e,t);if(i!==r){n=n.slice(0,i)}return n}function d(e){var t=e.length<0?0:g(e.length)|0;var r=s(t);for(var n=0;n<t;n+=1){r[n]=e[n]&255}return r}function v(e,t,r){if(t<0||e.byteLength<t){throw new RangeError("'offset' is out of bounds")}if(e.byteLength<t+(r||0)){throw new RangeError("'length' is out of bounds")}var n;if(t===undefined&&r===undefined){n=new Uint8Array(e)}else if(r===undefined){n=new Uint8Array(e,t)}else{n=new Uint8Array(e,t,r)}n.__proto__=p.prototype;return n}function m(e){if(p.isBuffer(e)){var t=g(e.length)|0;var r=s(t);if(r.length===0){return r}e.copy(r,0,0,t);return r}if(e){if(J(e)||"length"in e){if(typeof e.length!=="number"||Q(e.length)){return s(0)}return d(e)}if(e.type==="Buffer"&&Array.isArray(e.data)){return d(e.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function g(e){if(e>=r){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+r.toString(16)+" bytes")}return e|0}function _(e){if(+e!=e){e=0}return p.alloc(+e)}p.isBuffer=function e(t){return t!=null&&t._isBuffer===true};p.compare=function e(t,r){if(!p.isBuffer(t)||!p.isBuffer(r)){throw new TypeError("Arguments must be Buffers")}if(t===r)return 0;var n=t.length;var i=r.length;for(var o=0,a=Math.min(n,i);o<a;++o){if(t[o]!==r[o]){n=t[o];i=r[o];break}}if(n<i)return-1;if(i<n)return 1;return 0};p.isEncoding=function e(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};p.concat=function e(t,r){if(!Array.isArray(t)){throw new TypeError('"list" argument must be an Array of Buffers')}if(t.length===0){return p.alloc(0)}var n;if(r===undefined){r=0;for(n=0;n<t.length;++n){r+=t[n].length}}var i=p.allocUnsafe(r);var o=0;for(n=0;n<t.length;++n){var a=t[n];if(!p.isBuffer(a)){throw new TypeError('"list" argument must be an Array of Buffers')}a.copy(i,o);o+=a.length}return i};function y(e,t){if(p.isBuffer(e)){return e.length}if(J(e)||Z(e)){return e.byteLength}if(typeof e!=="string"){e=""+e}var r=e.length;if(r===0)return 0;var n=false;for(;;){switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case undefined:return q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return Y(e).length;default:if(n)return q(e).length;t=(""+t).toLowerCase();n=true}}}p.byteLength=y;function b(e,t,r){var n=false;if(t===undefined||t<0){t=0}if(t>this.length){return""}if(r===undefined||r>this.length){r=this.length}if(r<=0){return""}r>>>=0;t>>>=0;if(r<=t){return""}if(!e)e="utf8";while(true){switch(e){case"hex":return N(this,t,r);case"utf8":case"utf-8":return j(this,t,r);case"ascii":return L(this,t,r);case"latin1":case"binary":return I(this,t,r);case"base64":return A(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase();n=true}}}p.prototype._isBuffer=true;function w(e,t,r){var n=e[t];e[t]=e[r];e[r]=n}p.prototype.swap16=function e(){var t=this.length;if(t%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var r=0;r<t;r+=2){w(this,r,r+1)}return this};p.prototype.swap32=function e(){var t=this.length;if(t%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var r=0;r<t;r+=4){w(this,r,r+3);w(this,r+1,r+2)}return this};p.prototype.swap64=function e(){var t=this.length;if(t%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var r=0;r<t;r+=8){w(this,r,r+7);w(this,r+1,r+6);w(this,r+2,r+5);w(this,r+3,r+4)}return this};p.prototype.toString=function e(){var t=this.length;if(t===0)return"";if(arguments.length===0)return j(this,0,t);return b.apply(this,arguments)};p.prototype.equals=function e(t){if(!p.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(this===t)return true;return p.compare(this,t)===0};p.prototype.inspect=function e(){var t="";var r=n.INSPECT_MAX_BYTES;if(this.length>0){t=this.toString("hex",0,r).match(/.{2}/g).join(" ");if(this.length>r)t+=" ... "}return"<Buffer "+t+">"};p.prototype.compare=function e(t,r,n,i,o){if(!p.isBuffer(t)){throw new TypeError("Argument must be a Buffer")}if(r===undefined){r=0}if(n===undefined){n=t?t.length:0}if(i===undefined){i=0}if(o===undefined){o=this.length}if(r<0||n>t.length||i<0||o>this.length){throw new RangeError("out of range index")}if(i>=o&&r>=n){return 0}if(i>=o){return-1}if(r>=n){return 1}r>>>=0;n>>>=0;i>>>=0;o>>>=0;if(this===t)return 0;var a=o-i;var s=n-r;var u=Math.min(a,s);var c=this.slice(i,o);var h=t.slice(r,n);for(var l=0;l<u;++l){if(c[l]!==h[l]){a=c[l];s=h[l];break}}if(a<s)return-1;if(s<a)return 1;return 0};function x(e,t,r,n,i){if(e.length===0)return-1;if(typeof r==="string"){n=r;r=0}else if(r>2147483647){r=2147483647}else if(r<-2147483648){r=-2147483648}r=+r;if(Q(r)){r=i?0:e.length-1}if(r<0)r=e.length+r;if(r>=e.length){if(i)return-1;else r=e.length-1}else if(r<0){if(i)r=0;else return-1}if(typeof t==="string"){t=p.from(t,n)}if(p.isBuffer(t)){if(t.length===0){return-1}return S(e,t,r,n,i)}else if(typeof t==="number"){t=t&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(i){return Uint8Array.prototype.indexOf.call(e,t,r)}else{return Uint8Array.prototype.lastIndexOf.call(e,t,r)}}return S(e,[t],r,n,i)}throw new TypeError("val must be string, number or Buffer")}function S(e,t,r,n,i){var o=1;var a=e.length;var s=t.length;if(n!==undefined){n=String(n).toLowerCase();if(n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le"){if(e.length<2||t.length<2){return-1}o=2;a/=2;s/=2;r/=2}}function u(e,t){if(o===1){return e[t]}else{return e.readUInt16BE(t*o)}}var c;if(i){var h=-1;for(c=r;c<a;c++){if(u(e,c)===u(t,h===-1?0:c-h)){if(h===-1)h=c;if(c-h+1===s)return h*o}else{if(h!==-1)c-=c-h;h=-1}}}else{if(r+s>a)r=a-s;for(c=r;c>=0;c--){var l=true;for(var p=0;p<s;p++){if(u(e,c+p)!==u(t,p)){l=false;break}}if(l)return c}}return-1}p.prototype.includes=function e(t,r,n){return this.indexOf(t,r,n)!==-1};p.prototype.indexOf=function e(t,r,n){return x(this,t,r,n,true)};p.prototype.lastIndexOf=function e(t,r,n){return x(this,t,r,n,false)};function M(e,t,r,n){r=Number(r)||0;var i=e.length-r;if(!n){n=i}else{n=Number(n);if(n>i){n=i}}var o=t.length;if(o%2!==0)throw new TypeError("Invalid hex string");if(n>o/2){n=o/2}for(var a=0;a<n;++a){var s=parseInt(t.substr(a*2,2),16);if(Q(s))return a;e[r+a]=s}return a}function C(e,t,r,n){return K(q(t,e.length-r),e,r,n)}function E(e,t,r,n){return K(W(t),e,r,n)}function T(e,t,r,n){return E(e,t,r,n)}function O(e,t,r,n){return K(Y(t),e,r,n)}function P(e,t,r,n){return K(X(t,e.length-r),e,r,n)}p.prototype.write=function e(t,r,n,i){if(r===undefined){i="utf8";n=this.length;r=0}else if(n===undefined&&typeof r==="string"){i=r;n=this.length;r=0}else if(isFinite(r)){r=r>>>0;if(isFinite(n)){n=n>>>0;if(i===undefined)i="utf8"}else{i=n;n=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var o=this.length-r;if(n===undefined||n>o)n=o;if(t.length>0&&(n<0||r<0)||r>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!i)i="utf8";var a=false;for(;;){switch(i){case"hex":return M(this,t,r,n);case"utf8":case"utf-8":return C(this,t,r,n);case"ascii":return E(this,t,r,n);case"latin1":case"binary":return T(this,t,r,n);case"base64":return O(this,t,r,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,r,n);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase();a=true}}};p.prototype.toJSON=function e(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function A(e,t,r){if(t===0&&r===e.length){return i.fromByteArray(e)}else{return i.fromByteArray(e.slice(t,r))}}function j(e,t,r){r=Math.min(e.length,r);var n=[];var i=t;while(i<r){var o=e[i];var a=null;var s=o>239?4:o>223?3:o>191?2:1;if(i+s<=r){var u,c,h,l;switch(s){case 1:if(o<128){a=o}break;case 2:u=e[i+1];if((u&192)===128){l=(o&31)<<6|u&63;if(l>127){a=l}}break;case 3:u=e[i+1];c=e[i+2];if((u&192)===128&&(c&192)===128){l=(o&15)<<12|(u&63)<<6|c&63;if(l>2047&&(l<55296||l>57343)){a=l}}break;case 4:u=e[i+1];c=e[i+2];h=e[i+3];if((u&192)===128&&(c&192)===128&&(h&192)===128){l=(o&15)<<18|(u&63)<<12|(c&63)<<6|h&63;if(l>65535&&l<1114112){a=l}}}}if(a===null){a=65533;s=1}else if(a>65535){a-=65536;n.push(a>>>10&1023|55296);a=56320|a&1023}n.push(a);i+=s}return k(n)}var R=4096;function k(e){var t=e.length;if(t<=R){return String.fromCharCode.apply(String,e)}var r="";var n=0;while(n<t){r+=String.fromCharCode.apply(String,e.slice(n,n+=R))}return r}function L(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i){n+=String.fromCharCode(e[i]&127)}return n}function I(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i){n+=String.fromCharCode(e[i])}return n}function N(e,t,r){var n=e.length;if(!t||t<0)t=0;if(!r||r<0||r>n)r=n;var i="";for(var o=t;o<r;++o){i+=H(e[o])}return i}function D(e,t,r){var n=e.slice(t,r);var i="";for(var o=0;o<n.length;o+=2){i+=String.fromCharCode(n[o]+n[o+1]*256)}return i}p.prototype.slice=function e(t,r){var n=this.length;t=~~t;r=r===undefined?n:~~r;if(t<0){t+=n;if(t<0)t=0}else if(t>n){t=n}if(r<0){r+=n;if(r<0)r=0}else if(r>n){r=n}if(r<t)r=t;var i=this.subarray(t,r);i.__proto__=p.prototype;return i};function B(e,t,r){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}p.prototype.readUIntLE=function e(t,r,n){t=t>>>0;r=r>>>0;if(!n)B(t,r,this.length);var i=this[t];var o=1;var a=0;while(++a<r&&(o*=256)){i+=this[t+a]*o}return i};p.prototype.readUIntBE=function e(t,r,n){t=t>>>0;r=r>>>0;if(!n){B(t,r,this.length)}var i=this[t+--r];var o=1;while(r>0&&(o*=256)){i+=this[t+--r]*o}return i};p.prototype.readUInt8=function e(t,r){t=t>>>0;if(!r)B(t,1,this.length);return this[t]};p.prototype.readUInt16LE=function e(t,r){t=t>>>0;if(!r)B(t,2,this.length);return this[t]|this[t+1]<<8};p.prototype.readUInt16BE=function e(t,r){t=t>>>0;if(!r)B(t,2,this.length);return this[t]<<8|this[t+1]};p.prototype.readUInt32LE=function e(t,r){t=t>>>0;if(!r)B(t,4,this.length);return(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216};p.prototype.readUInt32BE=function e(t,r){t=t>>>0;if(!r)B(t,4,this.length);return this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])};p.prototype.readIntLE=function e(t,r,n){t=t>>>0;r=r>>>0;if(!n)B(t,r,this.length);var i=this[t];var o=1;var a=0;while(++a<r&&(o*=256)){i+=this[t+a]*o}o*=128;if(i>=o)i-=Math.pow(2,8*r);return i};p.prototype.readIntBE=function e(t,r,n){t=t>>>0;r=r>>>0;if(!n)B(t,r,this.length);var i=r;var o=1;var a=this[t+--i];while(i>0&&(o*=256)){a+=this[t+--i]*o}o*=128;if(a>=o)a-=Math.pow(2,8*r);return a};p.prototype.readInt8=function e(t,r){t=t>>>0;if(!r)B(t,1,this.length);if(!(this[t]&128))return this[t];return(255-this[t]+1)*-1};p.prototype.readInt16LE=function e(t,r){t=t>>>0;if(!r)B(t,2,this.length);var n=this[t]|this[t+1]<<8;return n&32768?n|4294901760:n};p.prototype.readInt16BE=function e(t,r){t=t>>>0;if(!r)B(t,2,this.length);var n=this[t+1]|this[t]<<8;return n&32768?n|4294901760:n};p.prototype.readInt32LE=function e(t,r){t=t>>>0;if(!r)B(t,4,this.length);return this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24};p.prototype.readInt32BE=function e(t,r){t=t>>>0;if(!r)B(t,4,this.length);return this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]};p.prototype.readFloatLE=function e(t,r){t=t>>>0;if(!r)B(t,4,this.length);return o.read(this,t,true,23,4)};p.prototype.readFloatBE=function e(t,r){t=t>>>0;if(!r)B(t,4,this.length);return o.read(this,t,false,23,4)};p.prototype.readDoubleLE=function e(t,r){t=t>>>0;if(!r)B(t,8,this.length);return o.read(this,t,true,52,8)};p.prototype.readDoubleBE=function e(t,r){t=t>>>0;if(!r)B(t,8,this.length);return o.read(this,t,false,52,8)};function F(e,t,r,n,i,o){if(!p.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}p.prototype.writeUIntLE=function e(t,r,n,i){t=+t;r=r>>>0;n=n>>>0;if(!i){var o=Math.pow(2,8*n)-1;F(this,t,r,n,o,0)}var a=1;var s=0;this[r]=t&255;while(++s<n&&(a*=256)){this[r+s]=t/a&255}return r+n};p.prototype.writeUIntBE=function e(t,r,n,i){t=+t;r=r>>>0;n=n>>>0;if(!i){var o=Math.pow(2,8*n)-1;F(this,t,r,n,o,0)}var a=n-1;var s=1;this[r+a]=t&255;while(--a>=0&&(s*=256)){this[r+a]=t/s&255}return r+n};p.prototype.writeUInt8=function e(t,r,n){t=+t;r=r>>>0;if(!n)F(this,t,r,1,255,0);this[r]=t&255;return r+1};p.prototype.writeUInt16LE=function e(t,r,n){t=+t;r=r>>>0;if(!n)F(this,t,r,2,65535,0);this[r]=t&255;this[r+1]=t>>>8;return r+2};p.prototype.writeUInt16BE=function e(t,r,n){t=+t;r=r>>>0;if(!n)F(this,t,r,2,65535,0);this[r]=t>>>8;this[r+1]=t&255;return r+2};p.prototype.writeUInt32LE=function e(t,r,n){t=+t;r=r>>>0;if(!n)F(this,t,r,4,4294967295,0);this[r+3]=t>>>24;this[r+2]=t>>>16;this[r+1]=t>>>8;this[r]=t&255;return r+4};p.prototype.writeUInt32BE=function e(t,r,n){t=+t;r=r>>>0;if(!n)F(this,t,r,4,4294967295,0);this[r]=t>>>24;this[r+1]=t>>>16;this[r+2]=t>>>8;this[r+3]=t&255;return r+4};p.prototype.writeIntLE=function e(t,r,n,i){t=+t;r=r>>>0;if(!i){var o=Math.pow(2,8*n-1);F(this,t,r,n,o-1,-o)}var a=0;var s=1;var u=0;this[r]=t&255;while(++a<n&&(s*=256)){if(t<0&&u===0&&this[r+a-1]!==0){u=1}this[r+a]=(t/s>>0)-u&255}return r+n};p.prototype.writeIntBE=function e(t,r,n,i){t=+t;r=r>>>0;if(!i){var o=Math.pow(2,8*n-1);F(this,t,r,n,o-1,-o)}var a=n-1;var s=1;var u=0;this[r+a]=t&255;while(--a>=0&&(s*=256)){if(t<0&&u===0&&this[r+a+1]!==0){u=1}this[r+a]=(t/s>>0)-u&255}return r+n};p.prototype.writeInt8=function e(t,r,n){t=+t;r=r>>>0;if(!n)F(this,t,r,1,127,-128);if(t<0)t=255+t+1;this[r]=t&255;return r+1};p.prototype.writeInt16LE=function e(t,r,n){t=+t;r=r>>>0;if(!n)F(this,t,r,2,32767,-32768);this[r]=t&255;this[r+1]=t>>>8;return r+2};p.prototype.writeInt16BE=function e(t,r,n){t=+t;r=r>>>0;if(!n)F(this,t,r,2,32767,-32768);this[r]=t>>>8;this[r+1]=t&255;return r+2};p.prototype.writeInt32LE=function e(t,r,n){t=+t;r=r>>>0;if(!n)F(this,t,r,4,2147483647,-2147483648);this[r]=t&255;this[r+1]=t>>>8;this[r+2]=t>>>16;this[r+3]=t>>>24;return r+4};p.prototype.writeInt32BE=function e(t,r,n){t=+t;r=r>>>0;if(!n)F(this,t,r,4,2147483647,-2147483648);if(t<0)t=4294967295+t+1;this[r]=t>>>24;this[r+1]=t>>>16;this[r+2]=t>>>8;this[r+3]=t&255;return r+4};function z(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function $(e,t,r,n,i){t=+t;r=r>>>0;if(!i){z(e,t,r,4,34028234663852886e22,-34028234663852886e22)}o.write(e,t,r,n,23,4);return r+4}p.prototype.writeFloatLE=function e(t,r,n){return $(this,t,r,true,n)};p.prototype.writeFloatBE=function e(t,r,n){return $(this,t,r,false,n)};function U(e,t,r,n,i){t=+t;r=r>>>0;if(!i){z(e,t,r,8,17976931348623157e292,-17976931348623157e292)}o.write(e,t,r,n,52,8);return r+8}p.prototype.writeDoubleLE=function e(t,r,n){return U(this,t,r,true,n)};p.prototype.writeDoubleBE=function e(t,r,n){return U(this,t,r,false,n)};p.prototype.copy=function e(t,r,n,i){if(!n)n=0;if(!i&&i!==0)i=this.length;if(r>=t.length)r=t.length;if(!r)r=0;if(i>0&&i<n)i=n;if(i===n)return 0;if(t.length===0||this.length===0)return 0;if(r<0){throw new RangeError("targetStart out of bounds")}if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");if(i>this.length)i=this.length;if(t.length-r<i-n){i=t.length-r+n}var o=i-n;var a;if(this===t&&n<r&&r<i){for(a=o-1;a>=0;--a){t[a+r]=this[a+n]}}else if(o<1e3){for(a=0;a<o;++a){t[a+r]=this[a+n]}}else{Uint8Array.prototype.set.call(t,this.subarray(n,n+o),r)}return o};p.prototype.fill=function e(t,r,n,i){if(typeof t==="string"){if(typeof r==="string"){i=r;r=0;n=this.length}else if(typeof n==="string"){i=n;n=this.length}if(t.length===1){var o=t.charCodeAt(0);if(o<256){t=o}}if(i!==undefined&&typeof i!=="string"){throw new TypeError("encoding must be a string")}if(typeof i==="string"&&!p.isEncoding(i)){throw new TypeError("Unknown encoding: "+i)}}else if(typeof t==="number"){t=t&255}if(r<0||this.length<r||this.length<n){throw new RangeError("Out of range index")}if(n<=r){return this}r=r>>>0;n=n===undefined?this.length:n>>>0;if(!t)t=0;var a;if(typeof t==="number"){for(a=r;a<n;++a){this[a]=t}}else{var s=p.isBuffer(t)?t:new p(t,i);var u=s.length;for(a=0;a<n-r;++a){this[a+r]=s[a%u]}}return this};var G=/[^+/0-9A-Za-z-_]/g;function V(e){e=e.trim().replace(G,"");if(e.length<2)return"";while(e.length%4!==0){e=e+"="}return e}function H(e){if(e<16)return"0"+e.toString(16);return e.toString(16)}function q(e,t){t=t||Infinity;var r;var n=e.length;var i=null;var o=[];for(var a=0;a<n;++a){r=e.charCodeAt(a);if(r>55295&&r<57344){if(!i){if(r>56319){if((t-=3)>-1)o.push(239,191,189);continue}else if(a+1===n){if((t-=3)>-1)o.push(239,191,189);continue}i=r;continue}if(r<56320){if((t-=3)>-1)o.push(239,191,189);i=r;continue}r=(i-55296<<10|r-56320)+65536}else if(i){if((t-=3)>-1)o.push(239,191,189)}i=null;if(r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,r&63|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else{throw new Error("Invalid code point")}}return o}function W(e){var t=[];for(var r=0;r<e.length;++r){t.push(e.charCodeAt(r)&255)}return t}function X(e,t){var r,n,i;var o=[];for(var a=0;a<e.length;++a){if((t-=2)<0)break;r=e.charCodeAt(a);n=r>>8;i=r%256;o.push(i);o.push(n)}return o}function Y(e){return i.toByteArray(V(e))}function K(e,t,r,n){for(var i=0;i<n;++i){if(i+r>=t.length||i>=e.length)break;t[i+r]=e[i]}return i}function Z(e){return e instanceof ArrayBuffer||e!=null&&e.constructor!=null&&e.constructor.name==="ArrayBuffer"&&typeof e.byteLength==="number"}function J(e){return typeof ArrayBuffer.isView==="function"&&ArrayBuffer.isView(e)}function Q(e){return e!==e}},{"base64-js":3,ieee754:17}],8:[function(e,t,r){"use strict";t.exports=n;t.exports.default=n;function n(e,t,r){r=r||2;var n=t&&t.length,i=n?t[0]*r:e.length,o=v(e,0,i,r,true),a=[];if(!o)return a;var s,u,c,h,l,p,f;if(n)o=g(e,t,o,r);if(e.length>80*r){s=c=e[0];u=h=e[1];for(var d=r;d<i;d+=r){l=e[d];p=e[d+1];if(l<s)s=l;if(p<u)u=p;if(l>c)c=l;if(p>h)h=p}f=Math.max(c-s,h-u);f=f!==0?1/f:0}m(o,a,r,s,u,f);return a}function v(e,t,r,n,i){var o,a;if(i===j(e,t,r,n)>0){for(o=t;o<r;o+=n)a=O(o,e[o],e[o+1],a)}else{for(o=r-n;o>=t;o-=n)a=O(o,e[o],e[o+1],a)}if(a&&s(a,a.next)){P(a);a=a.next}return a}function h(e,t){if(!e)return e;if(!t)t=e;var r=e,n;do{n=false;if(!r.steiner&&(s(r,r.next)||M(r.prev,r,r.next)===0)){P(r);r=t=r.prev;if(r===r.next)break;n=true}else{r=r.next}}while(n||r!==t);return t}function m(e,t,r,n,i,o,a){if(!e)return;if(!a&&o)b(e,n,i,o);var s=e,u,c;while(e.prev!==e.next){u=e.prev;c=e.next;if(o?p(e,n,i,o):l(e)){t.push(u.i/r);t.push(e.i/r);t.push(c.i/r);P(e);e=c.next;s=c.next;continue}e=c;if(e===s){if(!a){m(h(e),t,r,n,i,o,1)}else if(a===1){e=f(e,t,r);m(e,t,r,n,i,o,2)}else if(a===2){d(e,t,r,n,i,o)}break}}}function l(e){var t=e.prev,r=e,n=e.next;if(M(t,r,n)>=0)return false;var i=e.next.next;while(i!==e.prev){if(S(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&M(i.prev,i,i.next)>=0)return false;i=i.next}return true}function p(e,t,r,n){var i=e.prev,o=e,a=e.next;if(M(i,o,a)>=0)return false;var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,h=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y;var l=w(s,u,t,r,n),p=w(c,h,t,r,n);var f=e.prevZ,d=e.nextZ;while(f&&f.z>=l&&d&&d.z<=p){if(f!==e.prev&&f!==e.next&&S(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&M(f.prev,f,f.next)>=0)return false;f=f.prevZ;if(d!==e.prev&&d!==e.next&&S(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&M(d.prev,d,d.next)>=0)return false;d=d.nextZ}while(f&&f.z>=l){if(f!==e.prev&&f!==e.next&&S(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&M(f.prev,f,f.next)>=0)return false;f=f.prevZ}while(d&&d.z<=p){if(d!==e.prev&&d!==e.next&&S(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&M(d.prev,d,d.next)>=0)return false;d=d.nextZ}return true}function f(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;if(!s(i,o)&&a(i,n,n.next,o)&&C(i,o)&&C(o,i)){t.push(i.i/r);t.push(n.i/r);t.push(o.i/r);P(n);P(n.next);n=e=o}n=n.next}while(n!==e);return n}function d(e,t,r,n,i,o){var a=e;do{var s=a.next.next;while(s!==a.prev){if(a.i!==s.i&&c(a,s)){var u=T(a,s);a=h(a,a.next);u=h(u,u.next);m(a,t,r,n,i,o);m(u,t,r,n,i,o);return}s=s.next}a=a.next}while(a!==e)}function g(e,t,r,n){var i=[],o,a,s,u,c;for(o=0,a=t.length;o<a;o++){s=t[o]*n;u=o<a-1?t[o+1]*n:e.length;c=v(e,s,u,n,false);if(c===c.next)c.steiner=true;i.push(x(c))}i.sort(_);for(o=0;o<i.length;o++){y(i[o],r);r=h(r,r.next)}return r}function _(e,t){return e.x-t.x}function y(e,t){t=i(e,t);if(t){var r=T(t,e);h(r,r.next)}}function i(e,t){var r=t,n=e.x,i=e.y,o=-Infinity,a;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var s=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>o){o=s;if(s===n){if(i===r.y)return r;if(i===r.next.y)return r.next}a=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!a)return null;if(n===o)return a.prev;var u=a,c=a.x,h=a.y,l=Infinity,p;r=a.next;while(r!==u){if(n>=r.x&&r.x>=c&&n!==r.x&&S(i<h?n:o,i,c,h,i<h?o:n,i,r.x,r.y)){p=Math.abs(i-r.y)/(n-r.x);if((p<l||p===l&&r.x>a.x)&&C(r,e)){a=r;l=p}}r=r.next}return a}function b(e,t,r,n){var i=e;do{if(i.z===null)i.z=w(i.x,i.y,t,r,n);i.prevZ=i.prev;i.nextZ=i.next;i=i.next}while(i!==e);i.prevZ.nextZ=null;i.prevZ=null;o(i)}function o(e){var t,r,n,i,o,a,s,u,c=1;do{r=e;e=null;o=null;a=0;while(r){a++;n=r;s=0;for(t=0;t<c;t++){s++;n=n.nextZ;if(!n)break}u=c;while(s>0||u>0&&n){if(s!==0&&(u===0||!n||r.z<=n.z)){i=r;r=r.nextZ;s--}else{i=n;n=n.nextZ;u--}if(o)o.nextZ=i;else e=i;i.prevZ=o;o=i}r=n}o.nextZ=null;c*=2}while(a>1);return e}function w(e,t,r,n,i){e=32767*(e-r)*i;t=32767*(t-n)*i;e=(e|e<<8)&16711935;e=(e|e<<4)&252645135;e=(e|e<<2)&858993459;e=(e|e<<1)&1431655765;t=(t|t<<8)&16711935;t=(t|t<<4)&252645135;t=(t|t<<2)&858993459;t=(t|t<<1)&1431655765;return e|t<<1}function x(e){var t=e,r=e;do{if(t.x<r.x)r=t;t=t.next}while(t!==e);return r}function S(e,t,r,n,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(n-s)-(r-a)*(t-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function c(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!u(e,t)&&C(e,t)&&C(t,e)&&E(e,t)}function M(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function s(e,t){return e.x===t.x&&e.y===t.y}function a(e,t,r,n){if(s(e,t)&&s(r,n)||s(e,n)&&s(r,t))return true;return M(e,t,r)>0!==M(e,t,n)>0&&M(r,n,e)>0!==M(r,n,t)>0}function u(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&a(r,r.next,e,t))return true;r=r.next}while(r!==e);return false}function C(e,t){return M(e.prev,e,e.next)<0?M(e,t,e.next)>=0&&M(e,e.prev,t)>=0:M(e,t,e.prev)<0||M(e,e.next,t)<0}function E(e,t){var r=e,n=false,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{if(r.y>o!==r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x)n=!n;r=r.next}while(r!==e);return n}function T(e,t){var r=new A(e.i,e.x,e.y),n=new A(t.i,t.x,t.y),i=e.next,o=t.prev;e.next=t;t.prev=e;r.next=i;i.prev=r;n.next=r;r.prev=n;o.next=n;n.prev=o;return n}function O(e,t,r,n){var i=new A(e,t,r);if(!n){i.prev=i;i.next=i}else{i.next=n.next;i.prev=n;n.next.prev=i;n.next=i}return i}function P(e){e.next.prev=e.prev;e.prev.next=e.next;if(e.prevZ)e.prevZ.nextZ=e.nextZ;if(e.nextZ)e.nextZ.prevZ=e.prevZ}function A(e,t,r){this.i=e;this.x=t;this.y=r;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}n.deviation=function(e,t,r,n){var i=t&&t.length;var o=i?t[0]*r:e.length;var a=Math.abs(j(e,0,o,r));if(i){for(var s=0,u=t.length;s<u;s++){var c=t[s]*r;var h=s<u-1?t[s+1]*r:e.length;a-=Math.abs(j(e,c,h,r))}}var l=0;for(s=0;s<n.length;s+=3){var p=n[s]*r;var f=n[s+1]*r;var d=n[s+2]*r;l+=Math.abs((e[p]-e[d])*(e[f+1]-e[p+1])-(e[p]-e[f])*(e[d+1]-e[p+1]))}return a===0&&l===0?0:Math.abs((l-a)/a)};function j(e,t,r,n){var i=0;for(var o=t,a=r-n;o<r;o+=n){i+=(e[a]-e[o])*(e[o+1]+e[a+1]);a=o}return i}n.flatten=function(e){var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0;for(var i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++){for(var a=0;a<t;a++)r.vertices.push(e[i][o][a])}if(i>0){n+=e[i-1].length;r.holes.push(n)}}return r}},{}],9:[function(e,t,r){"use strict";var n=e("individual/one-version");var i="7";n("ev-store",i);var o="__EV_STORE_KEY@"+i;t.exports=a;function a(e){var t=e[o];if(!t){t=e[o]={}}return t}},{"individual/one-version":19}],10:[function(e,t,r){"use strict";var h=e("./request");var n=e("./buildQueryObject");var i=Array.isArray;function l(e,t){var r;for(r in t){e[r]=t[r]}return e}function o(e,t){this._jsongUrl=e;if(typeof t==="number"){var r={timeout:t};t=r}this._config=l({timeout:15e3,headers:{}},t||{})}o.prototype={constructor:o,buildQueryObject:n,get:function e(t){var r="GET";var n=this.buildQueryObject(this._jsongUrl,r,{paths:t,method:"get"});var i=l(n,this._config);var o=this;return h(r,i,o)},set:function e(t){var r="POST";var n=this.buildQueryObject(this._jsongUrl,r,{jsonGraph:t,method:"set"});var i=l(n,this._config);i.headers["Content-Type"]="application/x-www-form-urlencoded";var o=this;return h(r,i,o)},call:function e(t,r,n,i){r=r||[];n=n||[];i=i||[];var o="POST";var a=[];a.push("method=call");a.push("callPath="+encodeURIComponent(JSON.stringify(t)));a.push("arguments="+encodeURIComponent(JSON.stringify(r)));a.push("pathSuffixes="+encodeURIComponent(JSON.stringify(n)));a.push("paths="+encodeURIComponent(JSON.stringify(i)));var s=this.buildQueryObject(this._jsongUrl,o,a.join("&"));var u=l(s,this._config);u.headers["Content-Type"]="application/x-www-form-urlencoded";var c=this;return h(o,u,c)}};o.XMLHttpSource=o;o["default"]=o;t.exports=o},{"./buildQueryObject":11,"./request":14}],11:[function(e,t,r){"use strict";t.exports=function e(t,r,n){var i=[];var o;var a={url:t};var s=t.indexOf("?")!==-1;var u=s?"&":"?";if(typeof n==="string"){i.push(n)}else{o=Object.keys(n);o.forEach(function(e){var t=typeof n[e]==="object"?JSON.stringify(n[e]):n[e];i.push(e+"="+encodeURIComponent(t))})}if(r==="GET"){a.url+=u+i.join("&")}else{a.data=i.join("&")}return a}},{}],12:[function(e,t,r){(function(r){"use strict";t.exports=function e(){var t=new r.XMLHttpRequest;if("withCredentials"in t){return t}else if(!!r.XDomainRequest){return new XDomainRequest}else{throw new Error("CORS is not supported by your browser")}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],13:[function(e,t,r){(function(i){"use strict";t.exports=function e(){var t,r,n;if(i.XMLHttpRequest){return new i.XMLHttpRequest}else{try{r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];for(n=0;n<3;n++){try{t=r[n];if(new i.ActiveXObject(t)){break}}catch(e){}}return new i.ActiveXObject(t)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],14:[function(e,t,r){"use strict";var l=e("./getXMLHttpRequest");var p=e("./getCORSRequest");var f=Object.prototype.hasOwnProperty;var a=function(){};function n(){}n.create=function(o){var e=new n;e.subscribe=function(e,t,r){var n;var i;if(typeof e==="function"){n={onNext:e,onError:t||a,onCompleted:r||a}}else{n=e}i=o(n);if(typeof i==="function"){return{dispose:i}}else{return i}};return e};function i(u,c,h){return n.create(function e(r){var t={method:u||"GET",crossDomain:false,async:true,headers:{},responseType:"json"};var n,i,o,a,s;for(s in c){if(f.call(c,s)){t[s]=c[s]}}if(!t.crossDomain&&!t.headers["X-Requested-With"]){t.headers["X-Requested-With"]="XMLHttpRequest"}if(h.onBeforeRequest!=null){h.onBeforeRequest(t)}try{n=t.crossDomain?p():l()}catch(e){r.onError(e)}try{if(t.user){n.open(t.method,t.url,t.async,t.user,t.password)}else{n.open(t.method,t.url,t.async)}n.timeout=t.timeout;n.withCredentials=t.withCredentials!==false;o=t.headers;for(a in o){if(f.call(o,a)){n.setRequestHeader(a,o[a])}}if(t.responseType){try{n.responseType=t.responseType}catch(e){if(t.responseType!=="json"){throw e}}}n.onreadystatechange=function e(t){if(n.readyState===4){if(!i){i=true;d(r,n,t)}}};n.ontimeout=function e(t){if(!i){i=true;v(r,n,"timeout error",t)}};n.send(t.data)}catch(e){r.onError(e)}return function e(){if(!i&&n.readyState!==4){i=true;n.abort()}}})}function s(e,t,r){if(!r){r=new Error(t)}e.onError(r)}function d(e,t,r){var n,i,o;if(t&&e){o=t.responseType;n="response"in t?t.response:t.responseText;var a=t.status===1223?204:t.status;if(a>=200&&a<=399){try{if(o!=="json"){n=JSON.parse(n||"")}if(typeof n==="string"){n=JSON.parse(n||"")}}catch(r){s(e,"invalid json",r)}e.onNext(n);e.onCompleted();return}else if(a===401||a===403||a===407){return s(e,n)}else if(a===410){return s(e,n)}else if(a===408||a===504){return s(e,n)}else{return s(e,n||"Response code "+a)}}}function v(e,t,r,n){s(e,r||t.statusText||"request error",n)}t.exports=i},{"./getCORSRequest":12,"./getXMLHttpRequest":13}],15:[function(l,r,i){(function(n){!function(e){if("object"==typeof i&&"undefined"!=typeof r)r.exports=e();else if("function"==typeof o&&o.amd)o([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof n?n:"undefined"!=typeof self?self:this,t.falcor=e()}}(function(){var Nr;return function o(a,s,u){function c(r,e){if(!s[r]){if(!a[r]){var t="function"==typeof l&&l;if(!e&&t)return t(r,!0);if(h)return h(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=s[r]={exports:{}};a[r][0].call(i.exports,function(e){var t=a[r][1][e];return c(t?t:e)},i,i.exports,o,a,s,u)}return s[r].exports}for(var h="function"==typeof l&&l,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,t,r){var n=e(32),i=e(130);n.atom=i.atom,n.ref=i.ref,n.error=i.error,n.pathValue=i.pathValue,n.HttpDataSource=e(125),t.exports=n},{125:125,130:130,32:32}],2:[function(e,t,r){function i(e){var t=e||{};this._root=t._root||new n(t),this._path=t.path||t._path||[],this._scheduler=t.scheduler||t._scheduler||new f,this._source=t.source||t._source,this._request=t.request||t._request||new a(this,this._scheduler),this._ID=T++,"number"==typeof t.maxSize?this._maxSize=t.maxSize:this._maxSize=t._maxSize||i.prototype._maxSize,"number"==typeof t.collectRatio?this._collectRatio=t.collectRatio:this._collectRatio=t._collectRatio||i.prototype._collectRatio,(t.boxed||t.hasOwnProperty("_boxed"))&&(this._boxed=t.boxed||t._boxed),(t.materialized||t.hasOwnProperty("_materialized"))&&(this._materialized=t.materialized||t._materialized),"boolean"==typeof t.treatErrorsAsValues?this._treatErrorsAsValues=t.treatErrorsAsValues:t.hasOwnProperty("_treatErrorsAsValues")&&(this._treatErrorsAsValues=t._treatErrorsAsValues),t.cache&&this.setCache(t.cache)}var n=e(4),o=e(3),a=e(55),s=e(64),u=e(65),c=e(61),h=e(63),l=e(73),p=e(75),f=e(74),d=e(81),v=e(84),m=e(49),g=e(134),_=e(88),y=e(100),b=e(96),w=e(102),x=e(98),S=e(99),M=e(77),C=e(76),E=e(130),T=0,O=e(116),P=function(){},A=e(14),j=e(19),R={pathValue:!0,pathSyntax:!0,json:!0,jsonGraph:!0},k=e(72);t.exports=i,i.ref=E.ref,i.atom=E.atom,i.error=E.error,i.pathValue=E.pathValue,i.prototype.constructor=i,i.prototype._materialized=!1,i.prototype._boxed=!1,i.prototype._progressive=!1,i.prototype._treatErrorsAsValues=!1,i.prototype._maxSize=Math.pow(2,53)-1,i.prototype._collectRatio=.75,i.prototype.get=e(71),i.prototype._getWithPaths=e(70),i.prototype.set=function(){var t=O(arguments,R,"set");return t!==!0?new s(function(e){e.onError(t)}):this._set.apply(this,arguments)},i.prototype.preload=function(){var t=O(arguments,k,"preload");if(t!==!0)return new s(function(e){e.onError(t)});var e=Array.prototype.slice.call(arguments),r=this;return new s(function(t){return r.get.apply(r,e).subscribe(function(){},function(e){t.onError(e)},function(){t.onCompleted()})})},i.prototype._set=function(){var e,t=-1,r=arguments.length,n=arguments[r-1];for(b(n)?r-=1:n=void 0,e=new Array(r);++t<r;)e[t]=arguments[t];return u.create(this,e,n)},i.prototype.call=function(){var e,t=-1,r=arguments.length;for(e=new Array(r);++t<r;){var n=arguments[t];e[t]=n;var i=typeof n;if(t>1&&!Array.isArray(n)||0===t&&!Array.isArray(n)&&"string"!==i||1===t&&!Array.isArray(n)&&!w(n))return new s(function(e){e.onError(new Error("Invalid argument"))})}return c.create(this,e)},i.prototype.invalidate=function(){var e,t=-1,r=arguments.length,n=arguments[r-1];for(e=new Array(r);++t<r;)if(e[t]=g.fromPath(arguments[t]),"object"!=typeof e[t])throw new Error("Invalid argument");h.create(this,e,n).subscribe(P,function(e){throw e})},i.prototype.deref=e(5),i.prototype.getValue=e(16),i.prototype.setValue=e(79),i.prototype._getValueSync=e(24),i.prototype._setValueSync=e(80),i.prototype._derefSync=e(6),i.prototype.setCache=function(e){var t=this._root.cache;if(e!==t){var r=this._root,n=this._path;this._path=[],this._root.cache={},"undefined"!=typeof t&&m(r,r.expired,_(t),0),S(e)?C(this,[e]):x(e)?M(this,[e]):y(e)&&M(this,[{json:e}]),this._path=n}else"undefined"==typeof t&&(this._root.cache={});return this},i.prototype.getCache=function(){var e=v(arguments);if(0===e.length)return A(this._root.cache);var t=[{}],r=this._path;return j.getWithPathsAsJSONGraph(this,e,t),this._path=r,t[0].jsonGraph},i.prototype.getVersion=function(e){var t=e&&g.fromPath(e)||[];if(Array.isArray(t)===!1)throw new Error("Model#getVersion must be called with an Array path.");return this._path.length&&(t=this._path.concat(t)),this._getVersion(this,t)},i.prototype._syncCheck=function(e){if(Boolean(this._source)&&this._root.syncRefCount<=0&&this._root.unsafeMode===!1)throw new Error("Model#"+e+" may only be called within the context of a request selector.");return!0},i.prototype._clone=function(e){var t=new i(this);for(var r in e){var n=e[r];"delete"===n?delete t[r]:t[r]=n}return t.setCache=void 0,t},i.prototype.batch=function(e){var t=e;"number"==typeof t?t=new p(Math.round(Math.abs(t))):t&&t.schedule||(t=new l);var r=this._clone();return r._request=new a(r,t),r},i.prototype.unbatch=function(){var e=this._clone();return e._request=new a(e,new f),e},i.prototype.treatErrorsAsValues=function(){return this._clone({_treatErrorsAsValues:!0})},i.prototype.asDataSource=function(){return new o(this)},i.prototype._materialize=function(){return this._clone({_materialized:!0})},i.prototype._dematerialize=function(){return this._clone({_materialized:"delete"})},i.prototype.boxValues=function(){return this._clone({_boxed:!0})},i.prototype.unboxValues=function(){return this._clone({_boxed:"delete"})},i.prototype.withoutDataSource=function(){return this._clone({_source:"delete"})},i.prototype.toJSON=function(){return{$type:"ref",value:this._path}},i.prototype.getPath=function(){return d(this._path)},i.prototype._getBoundValue=e(13),i.prototype._getVersion=e(18),i.prototype._getValueSync=e(17),i.prototype._getPathValuesAsPathMap=j.getWithPathsAsPathMap,i.prototype._getPathValuesAsJSONG=j.getWithPathsAsJSONGraph,i.prototype._setPathValuesAsJSON=e(78),i.prototype._setPathValuesAsJSONG=e(78),i.prototype._setPathValuesAsPathMap=e(78),i.prototype._setPathValuesAsValues=e(78),i.prototype._setPathMapsAsJSON=e(77),i.prototype._setPathMapsAsJSONG=e(77),i.prototype._setPathMapsAsPathMap=e(77),i.prototype._setPathMapsAsValues=e(77),i.prototype._setJSONGsAsJSON=e(76),i.prototype._setJSONGsAsJSONG=e(76),i.prototype._setJSONGsAsPathMap=e(76),i.prototype._setJSONGsAsValues=e(76),i.prototype._setCache=e(77),i.prototype._invalidatePathValuesAsJSON=e(48),i.prototype._invalidatePathMapsAsJSON=e(47)},{100:100,102:102,116:116,13:13,130:130,134:134,14:14,16:16,17:17,18:18,19:19,24:24,3:3,4:4,47:47,48:48,49:49,5:5,55:55,6:6,61:61,63:63,64:64,65:65,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,84:84,88:88,96:96,98:98,99:99}],3:[function(e,t,r){function n(e){this._model=e._materialize().treatErrorsAsValues()}n.prototype.get=function(e){return this._model.get.apply(this._model,e)._toJSONG()},n.prototype.set=function(e){return this._model.set(e)._toJSONG()},n.prototype.call=function(e,t,r,n){var i=[e,t,r].concat(n);return this._model.call.apply(this._model,i)._toJSONG()},t.exports=n},{}],4:[function(e,t,r){function n(e){var t=e||{};this.syncRefCount=0,this.expired=t.expired||[],this.unsafeMode=t.unsafeMode||!1,this.collectionScheduler=t.collectionScheduler||new a,this.cache={},i(t.comparator)&&(this.comparator=t.comparator),i(t.errorSelector)&&(this.errorSelector=t.errorSelector),i(t.onChange)&&(this.onChange=t.onChange)}var i=e(96),o=e(91),a=e(74);n.prototype.errorSelector=function(e,t){return t},n.prototype.comparator=function(e,t){return o(e,"value")&&o(t,"value")?e.value===t.value&&e.$type===t.$type&&e.$expires===t.$expires:e===t},t.exports=n},{74:74,91:91,96:96}],5:[function(e,t,r){function s(e,t){var r,n=!1;try{++e._root.syncRefCount,r=e._derefSync(t)}catch(e){r=e,n=!0}finally{--e._root.syncRefCount}return n?u.Observable["throw"](r):u.Observable["return"](r)}var u=e(159),c=e(134);t.exports=function(e){for(var n=this,t=-1,i=arguments.length-1,o=new Array(i),a=c.fromPath(e);++t<i;)o[t]=c.fromPath(arguments[t+1]);if(0===i)throw new Error("Model#deref requires at least one value path.");return u.Observable.defer(function(){return s(n,a)}).flatMap(function(e){if(Boolean(e)){if(i>0){var t=u.Observable.of(e);return e.get.apply(e,o)["catch"](u.Observable.empty()).concat(t).last().flatMap(function(){return s(n,a)}).filter(function(e){return e})}return u.Observable["return"](e)}if(i>0){var r=o.map(function(e){return a.concat(e)});return n.get.apply(n,r).concat(u.Observable.defer(function(){return s(n,a)})).last().filter(function(e){return e})}return u.Observable.empty()})}},{134:134,159:159}],6:[function(e,t,r){var a=e(134),s=e(13),u=e(8),c=e(118);t.exports=function(e){var t=a.fromPath(e);if(!Array.isArray(t))throw new Error("Model#derefSync must be called with an Array path.");var r=s(this,this._path.concat(t),!1),n=r.path,i=r.value,o=r.found;if(o&&void 0!==i&&(i.$type!==c||void 0!==i.value)){if(i.$type)throw new u;return this._clone({_path:n})}}},{118:118,13:13,134:134,8:8}],7:[function(e,t,r){function n(){this.message=n.message,this.stack=(new Error).stack}n.prototype=new Error,n.prototype.name="BoundJSONGraphModelError",n.message="It is not legal to use the JSON Graph format from a bound Model. JSON Graph format can only be used from a root model.",t.exports=n},{}],8:[function(e,t,r){function n(e,t){this.message=o,this.stack=(new Error).stack,this.boundPath=e,this.shortedPath=t}var i="InvalidModelError",o="The boundPath of the model is not valid since a value or error was found before the path end.";n.prototype=new Error,n.prototype.name=i,n.message=o,t.exports=n},{}],9:[function(e,t,r){function n(e){this.message="An exception was thrown when making a request.",this.stack=(new Error).stack,this.innerError=e}var i="InvalidSourceError";n.prototype=new Error,n.prototype.name=i,n.is=function(e){return e&&e.name===i},t.exports=n},{}],10:[function(e,t,r){function n(){this.message="The allowed number of retries have been exceeded.",this.stack=(new Error).stack}var i="MaxRetryExceededError";n.prototype=new Error,n.prototype.name=i,n.is=function(e){return e&&e.name===i},t.exports=n},{}],11:[function(e,t,r){function n(e,t,r,n,i,o,a){for(var s,u,c=r,h=i,l=n,p=0;;){if(0===p&&l[w]?(p=h.length,u=l[w]):(s=h[p++],u=c[s]),u){var f=u.$type,d=f&&u.value||u;if(p<h.length){if(f){c=u;break}c=u;continue}if(c=u,f&&y(u))break;if(l[w]||g(l,u),f===b){a?_(e,u,o,null,null,null,h,h.length,a):x(e,u),p=0,h=d,l=u,c=t;continue}break}c=void 0;break}if(p<h.length&&void 0!==c){for(var v=[],m=0;p>m;m++)v[m]=h[m];h=v}return[c,h]}var i=e(26),g=i.create,_=e(22),y=e(27),b=e(120),w=e(33),x=e(29).promote;t.exports=n},{120:120,22:22,26:26,27:27,29:29,33:33}],12:[function(e,t,r){var v=e(15),m=e(8),g=e(7);t.exports=function(f,d){return function(e,t,r){var n,i,o,a=r[0],s={values:r,optimizedPaths:[]},u=e._root.cache,c=e._path,h=u,l=c.length,p=[];if(l){if(d)return{criticalError:new g};if(h=v(e,c),h.$type)return{criticalError:new m(c,c)};for(n=[],i=0;l>i;++i)n[i]=c[i]}else n=[],l=0;for(i=0,o=t.length;o>i;i++)f(e,u,h,t[i],0,a,s,p,n,l,d);return s}}},{15:15,7:7,8:8}],13:[function(e,t,r){var h=e(17),l=e(8);t.exports=function(e,t,r){var n,i,o,a,s,u=t,c=t;for(n=e._boxed,r=e._materialized,i=e._treatErrorsAsValues,e._boxed=!0,e._materialized=void 0===r||r,e._treatErrorsAsValues=!0,o=h(e,u.concat(null),!0),e._boxed=n,e._materialized=r,e._treatErrorsAsValues=i,u=o.optimizedPath,a=o.shorted,s=o.found,o=o.value;u.length&&null===u[u.length-1];)u.pop();if(s&&a)throw new l(c,u);return{path:u,value:o,shorted:a,found:s}}},{17:17,8:8}],14:[function(e,t,r){function u(e){var t,r,n,i={},o=Object.keys(e);for(r=0,n=o.length;n>r;r++)t=o[r],l(t)||(i[t]=e[t]);return i}function c(a,s,e){Object.keys(a).filter(function(e){return!l(e)&&a[e]}).forEach(function(e){var t=a[e],r=s[e];if(r||(r=s[e]={}),t.$type){var n,i=t.value&&"object"==typeof t.value,o=!a[h];return n=i||o?u(t):t.value,void(s[e]=n)}c(t,r,e)})}var h=e(37),l=e(97);t.exports=function(e){var t={};return c(e,t),t}},{37:37,97:97}],15:[function(e,t,r){t.exports=function(e,t){for(var r=e._root.cache,n=-1,i=t.length;++n<i&&r&&!r.$type;)r=r[t[n]];return r}},{}],16:[function(e,t,r){var i=e(64),a=e(134);t.exports=function(e){for(var o=a.fromPath(e),t=0,r=o.length;++t<r;)if("object"==typeof o[t])return new i(function(e){e.onError(new Error("Paths must be simple paths"))});var n=this;return new i(function(i){return n.get(o).subscribe(function(e){for(var t=e.json,r=-1,n=o.length;t&&++r<n;)t=t[o[r]];i.onNext(t)},function(e){i.onError(e)},function(){i.onCompleted()})})}},{134:134,64:64}],17:[function(e,t,r){var y=e(11),b=e(25),w=e(27),x=e(29).promote,S=e(120),M=e(118),C=e(119);t.exports=function(e,t,r){for(var n,i,o,a,s,u=e._root.cache,c=t.length,h=[],l=!1,p=!1,f=0,d=u,v=u,m=u,g=!0,_=!1;d&&c>f;){if(n=t[f++],null!==n&&(d=v[n],h[h.length]=n),!d){m=void 0,l=!0,g=!1;break}if(o=d.$type,o===M&&void 0===d.value){m=void 0,g=!1,l=c>f;break}if(c>f){if(o===S){if(w(d)){_=!0,m=void 0,g=!1;break}if(a=y(e,u,u,d,d.value),s=a[0],!s){m=void 0,d=void 0,g=!1;break}o=s.$type,d=s,h=a[1].slice(0)}if(o)break}else m=d;v=d}if(c>f&&!_){for(i=f;c>i;++i)if(null!==t[f]){p=!0;break}for(p?(l=!0,m=void 0):m=d,i=f;c>i;++i)null!==t[i]&&(h[h.length]=t[i])}if(m&&o&&(w(m)?m=void 0:x(e,m)),m&&o===C&&!e._treatErrorsAsValues)throw{path:f===c?t:t.slice(0,f),value:m.value};return m&&e._boxed?m=Boolean(o)&&!r?b(m):m:!m&&e._materialized?m={$type:M}:m&&(m=m.value),{value:m,shorted:l,optimizedPath:h,found:g}}},{11:11,118:118,119:119,120:120,25:25,27:27,29:29}],18:[function(e,t,r){var i=e(46);t.exports=function(e,t){var r=e._getValueSync({_boxed:!0,_root:e._root,_treatErrorsAsValues:e._treatErrorsAsValues},t,!0).value,n=r&&r[i];return null==n?-1:n}},{46:46}],19:[function(e,t,r){var n=e(12),i=e(31),o=n(i,!1),a=n(i,!0);t.exports={getValueSync:e(17),getBoundValue:e(13),getWithPathsAsPathMap:o,getWithPathsAsJSONGraph:a}},{12:12,13:13,17:17,31:31}],20:[function(e,t,r){var n=e(29),a=e(25),s=n.promote;t.exports=function(e,t,r,n,i){var o=t.value;i.errors||(i.errors=[]),e._boxed&&(o=a(t)),i.errors.push({path:n.slice(0,r+1),value:o}),s(e,t)}},{25:25,29:29}],21:[function(e,t,r){function u(e,t,r,n,i,o,a){a.requestedMissingPaths.push(n.slice(0,r).concat(t)),a.optimizedMissingPaths.push(i.slice(0,o).concat(t))}var n=e(30),c=n.fastCopy;t.exports=function(e,t,r,n,i,o,a){var s;n.requestedMissingPaths||(n.requestedMissingPaths=[],n.optimizedMissingPaths=[]),s=r<t.length?c(t,r):[],u(e,s,r,i,o,a,n)}},{30:30}],22:[function(e,t,r){var n=e(29),w=e(25),x=n.promote,S=e(120),M=e(118),C=e(119),E=e(37);t.exports=function(e,t,r,n,i,o,a,s,u,c){if(r){var h,l,p,f,d,v,m,g,_=!1;if(t&&x(e,t),t&&void 0!==t.value||(_=e._materialized),_)g={$type:M};else if(e._boxed)g=w(t);else if(t.$type===S||t.$type===C)g=u?w(t):t.value;else if(u){var y=t.value&&"object"==typeof t.value,b=!t[E];g=y||b?w(t):t.value}else g=t.value;if(i&&(i.hasValue=!0),u){for(d=r.jsonGraph,d||(d=r.jsonGraph={},r.paths=[]),h=0,l=s-1;l>h;h++)f=a[h],d[f]||(d[f]={}),d=d[f];f=a[h],d[f]=_?{$type:M}:g,o&&r.paths.push(o.slice(0,n))}else if(0===n)r.json=g;else{for(d=r.json,d||(d=r.json={}),h=0;n-1>h;h++)p=o[h],d[p]||(d[p]={}),v=d,m=p,d=d[p];p=o[h],null!==p?d[p]=g:v[m]=g}}}},{118:118,119:119,120:120,25:25,29:29,37:37}],23:[function(e,t,r){var f=e(27),n=e(26),i=e(29),d=n.remove,v=i.splice,m=e(119),g=e(20),_=e(22),y=e(21),b=e(28),w=e(35);t.exports=function(e,t,r,n,i,o,a,s,u,c,h){var l=t&&t.$type,p=t&&void 0===t.value;return t&&l?void(f(t)?(t[w]||(v(e,t),d(t)),y(e,r,n,o,a,s,u)):l===m?(h&&(a[n]=null),c||e._treatErrorsAsValues?_(e,t,i,n,o,a,s,u,c,h):g(e,t,n,a,o)):(h&&(a[n]=null),(!p||p&&e._materialized)&&_(e,t,i,n,o,a,s,u,c,h))):void(b(e)?_(e,t,i,n,o,a,s,u,c,h):y(e,r,n,o,a,s,u))}},{119:119,20:20,21:21,22:22,26:26,27:27,28:28,29:29,35:35}],24:[function(e,t,r){var n=e(134);t.exports=function(e){var t=n.fromPath(e);if(Array.isArray(t)===!1)throw new Error("Model#getValueSync must be called with an Array path.");return this._path.length&&(t=this._path.concat(t)),this._syncCheck("getValueSync")&&this._getValueSync(this,t).value}},{134:134}],25:[function(e,t,r){var a=e(40);t.exports=function(e){var t,r,n,i=Object.keys(e);for(t={},r=0,n=i.length;n>r;r++){var o=i[r];o[0]!==a&&(t[o]=e[o])}return t}},{40:40}],26:[function(e,t,r){function n(e,t){var r=t[u]||0;t[o+r]=e,t[u]=r+1,e[s]=r,e[a]=t}function i(e){var t=e[a];if(t){for(var r=e[s],n=t[u];n>r;)t[o+r]=t[o+r+1],++r;t[u]=n-1,e[a]=void 0,e[s]=void 0}}var o=e(43),a=e(33),s=e(42),u=e(44);t.exports={create:n,remove:i}},{33:33,42:42,43:43,44:44}],27:[function(e,t,r){var n=e(106);t.exports=function(e){var t=void 0===e.$expires&&-1||e.$expires;return-1!==t&&1!==t&&(0===t||t<n())}},{106:106}],28:[function(e,t,r){t.exports=function(e){return e._materialized&&!e._source}},{}],29:[function(e,t,r){function n(e,t){var r=e._root,n=r[a];if(n!==t){var i=t[u],o=t[s];o&&(o[u]=i),i&&(i[s]=o),t[u]=void 0,r[a]=t,t[s]=n,n[u]=t}}function i(e,t){var r=e._root,n=t[u],i=t[s];i&&(i[u]=n),n&&(n[s]=i),t[u]=void 0,t===r[a]&&(r[a]=void 0),t===r[o]&&(r[o]=void 0),t[c]=!0,r.expired.push(t)}var a=e(34),o=e(45),s=e(38),u=e(41),c=e(35);t.exports={promote:n,splice:i}},{34:34,35:35,38:38,41:41,45:45}],30:[function(e,t,r){function n(e,t){var r,n,i,o=[];for(n=0,i=t||0,r=e.length;r>i;n++,i++)o[n]=e[i];return o}function i(e,t){var r,n,i,o=[];for(r=0,n=e.length;n>r;r++)o[r]=e[r];for(i=0,n=t.length;n>i;i++)null!==t[i]&&(o[r++]=t[i]);return o}function o(e,t){var r,n,i,o=[];for(r=0,n=e.length;n>r;r++)o[r]=e[r];for(i=0,n=t.length;n>i;i++)o[r++]=t[i];return o}t.exports={fastCat:o,fastCatSkipNulls:i,fastCopy:n}},{}],31:[function(e,t,r){var P=e(11),A=e(23),j=e(27),R=e(143).iterateKeySet,k=e(120),L=e(29).promote;t.exports=function e(t,r,n,i,o,a,s,u,c,h,l,p){var f=p,d=c;if(!n||n&&n.$type||o===i.length)return void A(t,n,i,o,a,s,u,d,h,l,f);var v,m;v=i[o];var g="object"==typeof v,_=o+1,y=!1,b=v;if(g&&(y={},b=R(v,y)),void 0!==b||!y.done){var w=h+1;do{f=!1;var x;null===b?x=n:(x=n[b],d[h]=b,u[o]=b);var S=d,M=w;if(x){var C=x.$type,E=C&&x.value||x;if(_<i.length&&C&&C===k&&!j(x)){l&&A(t,x,i,_,a,s,null,d,M,l,f),L(t,x);var T=P(t,r,r,x,E,a,l);f=!0,x=T[0];var O=T[1];for(S=[],M=O.length,m=0;M>m;++m)S[m]=O[m]}}e(t,r,x,i,_,a,s,u,S,M,l,f),y&&!y.done&&(b=R(v,y))}while(y&&!y.done)}}},{11:11,120:120,143:143,23:23,27:27,29:29}],32:[function(e,t,r){"use strict";function n(e){return new n.Model(e)}"function"==typeof Promise?n.Promise=Promise:n.Promise=e(151),t.exports=n,n.Model=e(2)},{151:151,2:2}],33:[function(e,t,r){t.exports=e(40)+"context"},{40:40}],34:[function(e,t,r){t.exports=e(40)+"head"},{40:40}],35:[function(e,t,r){t.exports=e(40)+"invalidated"},{40:40}],36:[function(e,t,r){t.exports=e(40)+"key"},{40:40}],37:[function(e,t,r){t.exports="$modelCreated"},{}],38:[function(e,t,r){t.exports=e(40)+"next"},{40:40}],39:[function(e,t,r){t.exports=e(40)+"parent"},{40:40}],40:[function(e,t,r){t.exports=String.fromCharCode(30)},{}],41:[function(e,t,r){t.exports=e(40)+"prev"},{40:40}],42:[function(e,t,r){t.exports=e(40)+"ref-index"},{40:40}],43:[function(e,t,r){t.exports=e(40)+"ref"},{40:40}],44:[function(e,t,r){t.exports=e(40)+"refs-length"},{40:40}],45:[function(e,t,r){t.exports=e(40)+"tail"},{40:40}],46:[function(e,t,r){t.exports=e(40)+"version"},{40:40}],47:[function(e,t,r){function _(e,t,r,n,i,o,a,s,u,c){if(!k(e)&&!e.$type)for(var h in e)if(h[0]!==m&&"$"!==h[0]&&P(e,h)){var l=e[h],p=A(l)&&!l.$type,f=g(r,n,i,h,l,p,!1,o,a,s,u,c),d=f[0],v=f[1];d&&(p?_(l,t+1,r,v,d,o,a,s,u,c):D(d,v,h,s)&&N(v,O(d),s,o))}}function d(e,t,r,n,i,o,a,s){if(j(r))return L(r,i,o),[void 0,t];T(o,r);var u=r,c=r.value,h=t;if(r=r[w],null!=r)h=r[b]||t;else{var l=0,p=c.length-1;h=r=t;do{var f=c[l],d=p>l,v=g(t,h,r,f,e,d,!0,n,i,o,a,s);if(r=v[0],k(r))return v;h=v[1]}while(l++<p);if(u[w]!==r){var m=r[M]||0;r[M]=m+1,r[y+m]=u,u[w]=r,u[S]=m}}return[r,h]}function g(e,t,r,n,i,o,a,s,u,c,h,l){for(var p=r.$type;p===C;){var f=d(i,e,r,s,u,c,h,l);if(r=f[0],k(r))return f;t=f[1],p=r&&r.$type}if(void 0!==p)return[r,t];if(null==n){if(o)throw new Error("`null` is not allowed in branch key positions.");r&&(n=r[v])}else t=r,r=t[n];return[r,t]}var v=e(36),y=e(43),m=e(40),b=e(39),w=e(33),x=e(46),S=e(42),M=e(44),C=e(120),E=e(13),T=e(50),O=e(88),P=e(91),A=e(100),j=e(95),R=e(96),k=e(102),L=e(86),I=e(92),N=e(115),D=e(109);t.exports=function(e,t){for(var r=e._root,n=r,i=r.expired,o=I(),a=r._comparator,s=r._errorSelector,u=e._path,c=r.cache,h=u.length?E(e,u).value:c,l=h[b]||c,p=c[x],f=-1,d=t.length;++f<d;){var v=t[f];_(v.json,0,c,l,h,o,i,n,a,s)}var m=c[x],g=r.onChange;R(g)&&p!==m&&g()}},{100:100,102:102,109:109,115:115,120:120,13:13,33:33,36:36,39:39,40:40,42:42,43:43,44:44,46:46,50:50,86:86,88:88,91:91,92:92,95:95,96:96}],48:[function(e,t,r){function m(e,t,r,n,i,o,a,s){var u={},c=t<e.length-1,h=e[t],l=P(h,u);do{var p=v(r,n,i,l,c,!1,o,a,s),f=p[0],d=p[1];f&&(c?m(e,t+1,r,d,f,o,a,s):R(f,d,l,s)&&j(d,M(f),s,o)),l=P(h,u)}while(!u.done)}function l(e,t,r,n,i){if(C(t))return O(t,n,i),[void 0,e];S(i,t);var o=t,a=t.value,s=e;if(t=t[_],null!=t)s=t[g]||e;else{var u=0,c=a.length-1;s=t=e;do{var h=a[u],l=c>u,p=v(e,s,t,h,l,!0,r,n,i);if(t=p[0],T(t))return p;s=p[1]}while(u++<c);if(o[_]!==t){var f=t[w]||0;t[w]=f+1,t[d+f]=o,o[_]=t,o[b]=f}}return[t,s]}function v(e,t,r,n,i,o,a,s,u){for(var c=r.$type;c===f;){var h=l(e,r,a,s,u);if(r=h[0],T(r))return h;t=h[1],c=r.$type}if(void 0!==c)return[r,t];if(null==n){if(i)throw new Error("`null` is not allowed in branch key positions.");r&&(n=r[p])}else t=r,r=t[n];return[r,t]}var p=e(36),d=e(43),g=e(39),_=e(33),y=e(46),b=e(42),w=e(44),f=e(120),x=e(13),S=e(50),M=e(88),C=e(95),E=e(96),T=e(102),O=e(86),P=e(143).iterateKeySet,A=e(92),j=e(115),R=e(109);t.exports=function(e,t){for(var r=e._root,n=r,i=r.expired,o=A(),a=e._path,s=r.cache,u=a.length?x(e,a).value:s,c=u[g]||s,h=s[y],l=-1,p=t.length;++l<p;){var f=t[l];m(f,0,s,c,u,o,i,n)}var d=s[y],v=r.onChange;E(v)&&h!==d&&v()}},{102:102,109:109,115:115,120:120,13:13,143:143,33:33,36:36,39:39,42:42,43:43,44:44,46:46,50:50,86:86,88:88,92:92,95:95,96:96}],49:[function(e,t,r){var d=e(36),v=e(39),m=e(34),g=e(45),_=e(38),y=e(41),b=e(108),w=e(115);t.exports=function(e,t,r,n,i,o){var a=r,s=i;"number"!=typeof s&&(s=.75);var u,c,h,l="number"==typeof o,p=n*s;for(c=t.pop();c;)h=c.$size||0,a-=h,l===!0?w(c,h,e,o):(u=c[v])&&b(c,u,c[d],e),c=t.pop();if(a>=n){var f=e[g];for(c=f;a>=p&&c;)f=f[y],h=c.$size||0,a-=h,l===!0&&w(c,h,e,o),c=f;e[g]=e[y]=c,null==c?e[m]=e[_]=void 0:c[_]=void 0}}},{108:108,115:115,34:34,36:36,38:38,39:39,41:41,45:45}],50:[function(e,t,r){var a=e(121),s=e(34),u=e(45),c=e(38),h=e(41),l=e(100);t.exports=function(e,t){if(l(t)&&t.$expires!==a){var r=e[s],n=e[u],i=t[c],o=t[h];t!==r&&(null!=i&&"object"==typeof i&&(i[h]=o),null!=o&&"object"==typeof o&&(o[c]=i),i=r,null!=r&&"object"==typeof r&&(r[h]=t),e[s]=e[c]=r=t,r[c]=i,r[h]=void 0),null!=n&&t!==n||(e[u]=e[h]=n=o||t)}return t}},{100:100,121:121,34:34,38:38,41:41,45:45}],51:[function(e,t,r){var a=e(34),s=e(45),u=e(38),c=e(41);t.exports=function(e,t){var r=e[a],n=e[s],i=t[u],o=t[c];null!=i&&"object"==typeof i&&(i[c]=o),null!=o&&"object"==typeof o&&(o[u]=i),t===r&&(e[a]=e[u]=i),t===n&&(e[s]=e[c]=o),t[u]=t[c]=void 0,r=n=i=o=void 0}},{34:34,38:38,41:41,45:45}],52:[function(e,t,r){function h(t,r){var n=!1;return function(){if(!n&&!t._disposed){n=!0,t._callbacks[r]=null,t._optimizedPaths[r]=[],t._requestedPaths[r]=[];var e=--t._count;0!==e||t.sent||(t._disposable.dispose(),t.requestQueue.removeRequest(t))}}}function p(e){for(var t=[],r=-1,n=0,i=e.length;i>n;++n)for(var o=e[n],a=0,s=o.length;s>a;++a)t[++r]=o[a];return t}var l=e(59),u=e(60),n=0,i=e(57).GetRequest,f=e(76),d=e(78),v=e(119),m=[],o=function(e,t){this.sent=!1,this.scheduled=!1,this.requestQueue=t,this.id=++n,this.type=i,this._scheduler=e,this._pathMap={},this._optimizedPaths=[],this._requestedPaths=[],this._callbacks=[],this._count=0,this._disposable=null,this._collapsed=null,this._disposed=!1};o.prototype={batch:function(e,t,r){var o=this,n=o._optimizedPaths,a=o._requestedPaths,s=o._callbacks,i=n.length;return n[i]=t,a[i]=e,s[i]=r,++o._count,o.scheduled||(o.scheduled=!0,o._disposable=o._scheduler.schedule(function(){u(o,n,function(e,t){if(o.requestQueue.removeRequest(o),o._disposed=!0,o._count){o._merge(a,e,t);for(var r=0,n=s.length;n>r;++r){var i=s[r];i&&i(e,t)}}})})),h(o,i)},add:function(e,t,r){var n,i,o=this,a=l(e,t,o._pathMap);a?(i=a[2],n=a[1]):(i=e,n=t);var s=!1,u=!1;if(n.length<t.length){s=!0;var c=o._callbacks.length;o._callbacks[c]=r,o._requestedPaths[c]=a[0],o._optimizedPaths[c]=[],++o._count,u=h(o,c)}return[s,i,n,u]},_merge:function(e,t,r){var n=this,i=n.requestQueue.model,o=i._root,a=o.errorSelector,s=o.comparator,u=i._path;i._path=m;var c=p(e);if(t){var h=t;h instanceof Error&&(h={message:h.message}),h.$type||(h={$type:v,value:h});var l=c.map(function(e){return{path:e,value:h}});d(i,l,null,a,s)}else f(i,[{paths:c,jsonGraph:r.jsonGraph}],null,a,s);i._path=u}},t.exports=o},{119:119,57:57,59:59,60:60,76:76,78:78}],53:[function(e,t,r){function n(){this.length=0,this.pending=!1,this.pathmaps=[],a.call(this,this._subscribe)}var i=e(159),o=i.Observer,a=i.Observable,s=i.Disposable,u=i.SerialDisposable,c=i.CompositeDisposable,h=e(9),l=e(143),f=l.iterateKeySet;n.create=function(e,t,r){var n=new this;return n.queue=e,n.model=t,n.index=r,n},n.prototype=Object.create(a.prototype),n.prototype.constructor=n,n.prototype.insertPath=function(e,t,r,n,i){var o=n||0,a=i||e.length-1,s=r||this.pathmaps[a+1]||(this.pathmaps[a+1]=Object.create(null));if(void 0===s||null===s)return!1;var u,c,h=e[o],l={};u=f(h,l);do{if(c=s[u],a>o){if(null==c){if(t)return!1;c=s[u]=Object.create(null)}if(this.insertPath(e,t,c,o+1,a)===!1)return!1}else s[u]=(c||0)+1,this.length+=1;l.done||(u=f(h,l))}while(!l.done);return!0},n.prototype.removePath=function(e,t,r,n){var i=r||0,o=n||e.length-1,a=t||this.pathmaps[o+1];if(void 0===a||null===a)return!0;var s,u,c=0,h=e[i],l={};s=f(h,l);do{if(u=a[s],void 0!==u&&null!==u){if(o>i){c+=this.removePath(e,u,i+1,o);var p=void 0;for(p in u)break;void 0===p&&delete a[s]}else u=a[s]=(u||1)-1,0===u&&delete a[s],c+=1,this.length-=1;l.done||(s=f(h,l))}}while(!l.done);return c},n.prototype.getSourceObserver=function(t){var r=this;return o.create(function(e){e.jsonGraph=e.jsonGraph||e.jsong||e.values||e.value,e.index=r.index,t.onNext(e)},function(e){t.onError(e)},function(){t.onCompleted()})},n.prototype._subscribe=function(e){var t=this,r=this.queue;t.pending=!0;var n=!1,i=new u,o=s.create(function(){n||(n=!0,r&&r._remove(t))}),a=new c(i,o);try{i.setDisposable(this.model._source[this.method](this.getSourceArgs()).subscribe(this.getSourceObserver(e)))}catch(e){throw new h(e)}return a},t.exports=n},{143:143,159:159,9:9}],54:[function(e,t,r){function n(e,t){this.total=0,this.model=e,this.requests=[],this.scheduler=t}var i=e(58),m=e(40),g=e(90),_=e(100),o=e(143);n.prototype.set=function(e){return e.paths=o.collapse(e.paths),i.create(this.model,e)},n.prototype._remove=function(e){var t=this.requests,r=t.indexOf(e);-1!==r&&t.splice(r,1)},n.prototype.distributePaths=function(e,t,r){var n,i,o=this.model,a=-1,s=e.length,u=-1,c=t.length,h=[];e:for(;++a<s;){var l=e[a];for(u=-1;++u<c;)if(i=t[u],i.insertPath(l,i.pending)){h[u]=i;continue e}n||(n=r.create(this,o,this.total++),t[u]=n,h[c++]=n),n.insertPath(l,!1)}var p=[],f=-1;for(u=-1;++u<c;)i=h[u],null!=i&&(p[++f]=i);return p},n.prototype.mergeJSONGraphs=function(e,t){var r=0,n=[],i=[],o=[],a=e.index,s=t.index;e.index=Math.max(a,s),n[-1]=e.jsonGraph||{},i[-1]=t.jsonGraph||{};e:for(;r>-1;){for(var u=n[r-1],c=i[r-1],h=o[r-1]||(o[r-1]=Object.keys(c));h.length>0;){var l=h.pop();if(l[0]!==m)if(u.hasOwnProperty(l)){var p=u[l],f=g(p),d=c[l],v=g(d);if(_(p)&&_(d)&&!f&&!v){n[r]=p,i[r]=d,r+=1;continue e}s>a&&(u[l]=d)}else u[l]=c[l]}r-=1}return e},t.exports=n},{100:100,143:143,40:40,58:58,90:90}],55:[function(e,t,r){function n(e,t){this.model=e,this.scheduler=t,this.requests=this._requests=[]}var i=e(54),o=e(56);n.prototype.get=o.prototype.get,n.prototype.removeRequest=o.prototype.removeRequest,n.prototype.set=i.prototype.set,n.prototype.call=i.prototype.call,t.exports=n},{54:54,56:56}],56:[function(e,t,r){function n(e,t){this.model=e,this.scheduler=t,this.requests=this._requests=[]}var m=e(57),g=e(52);n.prototype={setScheduler:function(e){this.scheduler=e},get:function(e,t,r){function n(){f||(--c,0===c&&r())}var i,o,a,s=this,u=[],c=0,h=s._requests,l=t,p=e,f=!1;for(i=0,o=h.length;o>i;++i)if(a=h[i],a.type===m.GetRequest){if(a.sent){var d=a.add(p,l,n);d[0]&&(p=d[1],l=d[2],u[u.length]=d[3],++c)}else a.batch(p,l,n),l=[],p=[],++c;if(!l.length)break}if(l.length){a=new g(s.scheduler,s),h[h.length]=a,++c;var v=a.batch(p,l,n);u[u.length]=v}return function(){if(!f&&0!==c){f=!0;for(var e=u.length,t=0;e>t;++t)u[t]()}}},removeRequest:function(e){for(var t=this._requests,r=t.length;--r>=0;)if(t[r].id===e.id){t.splice(r,1);break}}},t.exports=n},{52:52,57:57}],57:[function(e,t,r){t.exports={GetRequest:"GET"}},{}],58:[function(e,t,r){function n(){c.call(this)}var i=e(159),u=i.Observer,c=e(53),h=e(83),l=e(76),p=e(78),f=new Array(0);n.create=function(e,t){var r=new n;return r.model=e,r.jsonGraphEnvelope=t,r},n.prototype=Object.create(c.prototype),n.prototype.constructor=n,n.prototype.method="set",n.prototype.insertPath=function(){return!1},n.prototype.removePath=function(){return 0},n.prototype.getSourceArgs=function(){return this.jsonGraphEnvelope},n.prototype.getSourceObserver=function(r){var n=this.model,i=n._path,o=this.jsonGraphEnvelope.paths,e=n._root,a=e.errorSelector,s=e.comparator;return c.prototype.getSourceObserver.call(this,u.create(function(e){n._path=f;var t=l(n,[{paths:o,jsonGraph:e.jsonGraph}],null,a,s);e.paths=t[1],n._path=i,r.onNext(e)},function(t){n._path=f,p(n,h(o,function(e){return{path:e,value:t}}),null,a,s),n._path=i,r.onError(t)},function(){r.onCompleted()}))},t.exports=n},{159:159,53:53,76:76,78:78,83:83}],59:[function(e,t,r){var f=e(143).hasIntersection,d=e(84);t.exports=function(e,t,r){for(var n=[],i=[],o=[],a=-1,s=-1,u=!1,c=0,h=t.length;h>c;++c){var l=t[c],p=r[l.length];p&&f(p,l,0)?(!u&&c>0&&(i=d(e,0,c),n=d(t,0,c)),o[++a]=e[c],u=!0):u&&(n[++s]=l,i[s]=e[c])}return u?[o,n,i]:null}},{143:143,84:84}],60:[function(e,t,r){var n=e(143),y=n.toTree,b=n.toPaths;t.exports=function(e,t,r){if(0===e._count)return void e.requestQueue.removeRequest(e);e.sent=!0,e.scheduled=!1;for(var n=e._pathMap,i=Object.keys(t),o=0,a=i.length;a>o;++o)for(var s=t[o],u=0,c=s.length;c>u;++u){var h=s[u],l=h.length;if(n[l]){var p=n[l];p[p.length]=h}else n[l]=[h]}for(var f=Object.keys(n),d=0,v=f.length;v>d;++d){var m=f[d];n[m]=y(n[m])}var g,_=e._collasped=b(n);e.requestQueue.model._source.get(_).subscribe(function(e){g=e},function(e){r(e,g)},function(){r(null,g)})}},{143:143}],61:[function(e,t,r){function n(e){b.call(this,e||i)}function _(e){return y.Observable.defer(function(){return e})}function i(i){function e(e){function t(e,t){if(Boolean(t.invalidated))e.invalidations.push(e.localThisPath.concat(t.path));else{var r=t.path,n=t.value;Boolean(n)&&"object"==typeof n&&n.$type===M?e.references.push({path:f(r),value:t.value}):e.values.push({path:f(r),value:t.value})}return e}function r(t){var e=t.values.concat(t.references);return e.length>0?_(h.set.apply(h,e)._toJSONG()).map(function(e){return{results:t,envelope:e}}):b["return"]({results:t,envelope:{jsonGraph:{},paths:[]}})}function n(e){var t,r=e.envelope,n=e.results,i=n.values,o=n.references,a=n.invalidations,s=i.map(p).map(f),u=o.reduce(l,[]),c=d.map(f),h=u.concat(c);return t=h.length>0?_(v.get.apply(v,s.concat(h))._toJSONG()):b["return"](r),t.doAction(function(e){e.invalidated=a})}function l(e,t){var r=t.path;return e.push.apply(e,c.map(function(e){return r.concat(e)})),e}function p(e){return e.path}var i=e&&e.localFn;if("function"==typeof i){var o=e.model,a=o._path,s=i.apply(o,u).reduce(t,{values:[],references:[],invalidations:[],localThisPath:a}).flatMap(r).flatMap(n);return b["return"](s)}return b.empty()}function t(e){function t(e){var t=e.invalidated;return t&&t.length&&v.invalidate.apply(v,t),e}return e&&"object"==typeof e?y.Observable.defer(function(){var t;try{t=e.call(l,u,c,d)}catch(e){t=b["throw"](new x(e))}return t}).map(t):b.empty()}function r(e){return _(h.set(e)).reduce(function(e){return e},null).map(function(){return{invalidated:e.invalidated,paths:e.paths.map(function(e){return e.slice(s.length)})}})}function f(e){return p.concat(e)}var n=this.args,o=this.model,a=S.fromPath(n[0]),u=n[1]||[],c=(n[2]||[]).map(S.fromPath),d=(n[3]||[]).map(S.fromPath),v=o._clone({_path:[]}),h=v.withoutDataSource(),s=o._path,l=s.concat(a),p=l.slice(0,-1),m=_(o.withoutDataSource().get(a)).map(function(e){for(var t=e.json,r=-1,n=a.length;t&&++r<n;)t=t[a[r]];var i=v._derefSync(p).boxValues();return{model:i,localFn:t}}).flatMap(e).defaultIfEmpty(t(o._source)).mergeAll().flatMap(r),g=new w;return g.add(m.subscribe(function(e){var t=e.paths,r=e.invalidated,n=o.get.apply(o,t);"AsJSONG"===i.outputFormat&&(n=_(n._toJSONG()).doAction(function(e){e.invalidated=r})),g.add(n.subscribe(i))},function(e){i.onError(e)})),g}var y=e(159)&&e(158),b=y.Observable,w=y.CompositeDisposable,o=e(64),x=e(9),S=e(134),M=e(120);n.create=o.create,n.prototype=Object.create(b.prototype),n.prototype.constructor=n,n.prototype.invokeSourceRequest=function(e){return this},n.prototype.ensureCollect=function(e){return this},n.prototype.initialize=function(){return this},t.exports=n},{120:120,134:134,158:158,159:159,64:64,9:9}],62:[function(e,t,r){function n(e){o.call(this,e)}var i=e(159),o=i.Observable,a=e(64),p=e(134),s=e(88),u=e(49),f=e(81),c=e(46),d=Array.isArray,v=e(101),m=e(98),g=e(99);n.create=a.create,n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype.subscribeCount=0,n.prototype.subscribeLimit=10,n.prototype.initialize=function(){for(var e,t,r=this.model,n=this.outputFormat||"AsPathMap",i=this.isProgressive,o=[{}],a=[],s=this.args,u=-1,c=s.length;++u<c;){var h,l=s[u];d(l)||"string"==typeof l?(l=p.fromPath(l),h="PathValues"):v(l)?(l.path=p.fromPath(l.path),h="PathValues"):g(l)?h="JSONGs":m(l)&&(h="PathMaps"),t!==h&&(t=h,e={inputType:h,arguments:[]},a.push(e),e.values=o),e.arguments.push(l)}return this.boundPath=f(r._path),this.groups=a,this.outputFormat=n,this.isProgressive=i,this.isCompleted=!1,this.isMaster=null==r._source,this.values=o,this},n.prototype.invokeSourceRequest=function(e){return this},n.prototype.ensureCollect=function(r){var t=this["finally"](function(){var e=r._root,t=e.cache;e.collectionScheduler.schedule(function(){u(e,e.expired,s(t),r._maxSize,r._collectRatio,t[c])})});return new this.constructor(function(e){return t.subscribe(e)})},t.exports=n},{101:101,134:134,159:159,46:46,49:49,64:64,81:81,88:88,98:98,99:99}],63:[function(e,t,r){function n(e){a.call(this,e||i)}function i(e){for(var t=this.model,r=this.method,n=this.groups,i=-1,o=n.length;++i<o;){var a=n[i],s=a.inputType,u=a.arguments;if(u.length>0){var c="_"+r+s+"AsJSON",h=t[c];h(t,u)}}return e.onCompleted(),l.empty}var o=e(159),l=o.Disposable,a=e(62);n.create=a.create,n.prototype=Object.create(a.prototype),n.prototype.method="invalidate",n.prototype.constructor=n,t.exports=n},{159:159,62:62}],64:[function(e,t,r){function n(e){this._subscribe=e}function i(e){var t=this.model,r=new this.type;return r.model=t,r.args=this.args,r.outputFormat=e.outputFormat||"AsPathMap",r.isProgressive=e.isProgressive||!1,r.subscribeCount=0,r.subscribeLimit=e.retryLimit||10,r.initialize().invokeSourceRequest(t).ensureCollect(t).subscribe(e)}var o=e(32),a=e(159)&&e(158),s=a.Observable,u=e(84),c=e(105),h={outputFormat:{value:"AsJSONG"}},l={isProgressive:{value:!0}};n.create=function(e,t){var r=new n(i);return r.args=t,r.type=this,r.model=e,r},n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype._mixin=function(){var t=this,r=u(arguments);return new t.constructor(function(e){return t.subscribe(r.reduce(function(e,t){return Object.create(e,t)},e))})},n.prototype._toJSONG=function(){return this._mixin(h)},n.prototype.progressively=function(){return this._mixin(l)},n.prototype.subscribe=function(e,t,r){var n=e;n&&"object"==typeof n||(n={onNext:e||c,onError:t||c,onCompleted:r||c});var i=this._subscribe(n);switch(typeof i){case"function":return{dispose:i};case"object":return i||{dispose:c};default:return{dispose:c}}},n.prototype.then=function(e,t){var i=this;return new o.Promise(function(e,t){var r,n=!1;i.toArray().subscribe(function(e){r=e.length<=1?e[0]:e},function(e){n=!0,t(e)},function(){n===!1&&e(r)})}).then(e,t)},t.exports=n},{105:105,158:158,159:159,32:32,84:84}],65:[function(e,t,r){function n(e){c.call(this,e||i)}function i(e){return this.isCompleted?_.call(this,e):o.call(this,e)}function o(e){if(this.subscribeCount++>this.subscribeLimit)return e.onError("Loop kill switch thrown."),w.empty;for(var t=[],r=[],n=this.model,i=this.isMaster,o=n._root,a=this.outputFormat,s=o.errorSelector,u=this.method,c=this.groups,h=-1,l=c.length;++h<l;){var p=c[h],f=p.inputType,d=p.arguments;if(d.length>0){var v="_"+u+f+a,m=n[v],g=m(n,d,null,s);r.push.apply(r,g[1]),"PathValues"===f?t.push.apply(t,d.map(y)):"JSONGs"===f?t.push.apply(t,x(d,b)):t.push.apply(t,g[0])}}return this.requestedPaths=t,i?(this.isCompleted=!0,_.call(this,e)):void e.onError({method:u,optimizedPaths:r,invokeSourceRequest:!0})}function _(e){var t=new s(this.model,this.requestedPaths);return"AsJSONG"===this.outputFormat&&(t=t._toJSONG()),this.isProgressive&&(t=t.progressively()),t.subscribe(e)}function y(e){return e.path}function b(e){return e.paths}var a=e(159),u=a.Observable,w=a.Disposable,s=e(67),c=e(62),h=e(9),x=e(82),l=new Array(0);n.create=c.create,n.prototype=Object.create(c.prototype),n.prototype.method="set",n.prototype.constructor=n,n.prototype.invokeSourceRequest=function(o){var a=this,s=this["catch"](function(e){var t;if(e&&e.invokeSourceRequest===!0){var r={},n=o._path,i=e.optimizedPaths;o._path=l,o._getPathValuesAsJSONG(o._materialize().withoutDataSource(),i,[r]),o._path=n,t=o._request.set(r)["do"](function(e){a.isCompleted=i.length===e.paths.length},function(){a.isCompleted=!0}).materialize().flatMap(function(e){if("C"===e.kind)return u.empty();if("E"===e.kind){var t=e.exception;if(h.is(t))return u["throw"](e.exception)}return s})}else t=u["throw"](e);return t});return new this.constructor(function(e){return s.subscribe(e)})},t.exports=n},{159:159,62:62,67:67,82:82,9:9}],66:[function(e,t,r){var n=function(e){this.disposed=!1,this.currentDisposable=e};n.prototype={dispose:function(){if(!this.disposed&&this.currentDisposable){this.disposed=!0;var e=this.currentDisposable;e.dispose?e.dispose():e()}}},t.exports=n},{}],67:[function(e,t,r){var n=e(64),a=e(68),s=e(69),u={dispose:function(){}},i=e(159).Observable,o=t.exports=function(e,t,r,n){this.model=e,this.currentRemainingPaths=t,this.isJSONGraph=r||!1,this.isProgressive=n||!1};o.prototype=Object.create(i.prototype),o.prototype.subscribe=n.prototype.subscribe,o.prototype.then=n.prototype.then,o.prototype._toJSONG=function(){return new o(this.model,this.currentRemainingPaths,!0,this.isProgressive)},o.prototype.progressively=function(){return new o(this.model,this.currentRemainingPaths,this.isJSONGraph,!0)},o.prototype._subscribe=function(e){var t=[{}],r=[],n=e.isJSONG=this.isJSONGraph,i=this.isProgressive,o=a(this.model,this.currentRemainingPaths,e,i,n,t,r);return o?s(this,this.model,o,e,t,r,1):u}},{159:159,64:64,68:68,69:69}],68:[function(e,t,r){var n=e(19),v=n.getWithPathsAsJSONGraph,m=n.getWithPathsAsPathMap;t.exports=function(e,t,r,n,i,o,a){var s;if(s=i?v(e,t,o):m(e,t,o),s.criticalError)return r.onError(s.criticalError),null;var u=s.hasValue,c=!s.requestedMissingPaths||!e._source,h=o[0].json||o[0].jsonGraph;if(s.errors)for(var l=s.errors,p=a.length,f=0,d=l.length;d>f;++f,++p)a[p]=l[f];if(u&&n||h&&c)try{++e._root.syncRefCount,r.onNext(o[0])}catch(e){throw e}finally{--e._root.syncRefCount}return c?(a.length?r.onError(a):r.onCompleted(),null):s}},{19:19}],69:[function(e,t,r){var g=e(68),_=e(10),y=e(30).fastCat,b=e(49),w=e(88),x=e(66),S=e(46);t.exports=function i(o,a,e,s,u,c,h){if(10===h)throw new _;var t=a._request,l=e.requestedMissingPaths,r=e.optimizedMissingPaths,p=new x,n=[],f=a._path;if(f.length)for(var d=0,v=l.length;v>d;++d)n[d]=y(f,l[d]);else n=l;var m=t.get(n,r,function(){var e=g(a,l,s,o.isProgressive,o.isJSONGraph,u,c);if(e)p.currentDisposable=i(o,a,e,s,u,c,h+1);else{var t=a._root,r=t.cache,n=r[S];b(t,t.expired,w(r),a._maxSize,a._collectRatio,n)}});return p.currentDisposable=m,p}},{10:10,30:30,46:46,49:49,66:66,68:68,88:88}],70:[function(e,t,r){var n=e(67);t.exports=function(e){return new n(this,e)}},{67:67}],71:[function(e,t,r){var n=e(134),i=e(64),o=e(72),a=e(116),s=e(67);t.exports=function(){var t=a(arguments,o,"get");if(t!==!0)return new i(function(e){e.onError(t)});var e=n.fromPathsOrPathValues(arguments);return new s(this,e)}},{116:116,134:134,64:64,67:67,72:72}],72:[function(e,t,r){t.exports={path:!0,pathSyntax:!0}},{}],73:[function(e,t,r){function n(){}var i=e(123),o=e(159),a=o.Disposable;n.prototype.schedule=function(e){return i(e),a.empty},n.prototype.scheduleWithState=function(e,t){var r=this;return i(function(){t(r,e)}),a.empty},t.exports=n},{123:123,159:159}],74:[function(e,t,r){function n(){}var i=e(159),o=i.Disposable;n.prototype.schedule=function(e){return e(),o.empty},n.prototype.scheduleWithState=function(e,t){return t(this,e),o.empty},t.exports=n},{159:159}],75:[function(e,t,r){function n(e){this.delay=e}var i=e(159),o=i.Disposable;n.prototype.schedule=function(e){var t=setTimeout(e,this.delay);return o.create(function(){void 0!==t&&(clearTimeout(t),t=void 0)})},n.prototype.scheduleWithState=function(e,t){var r=this,n=setTimeout(function(){t(r,e)},this.delay);return o.create(function(){void 0!==n&&(clearTimeout(n),n=void 0)})},t.exports=n},{159:159}],76:[function(e,t,r){function C(e,t,r,n,i,o,a,s,u,c,h,l,p,f,d,v,m){for(var g={},_=t<e.length-1,y=e[t],b=k(y,g),w=l.index;;){h.depth=t;var x=E(r,n,i,o,a,s,b,_,!1,h,l,p,f,d,v,m);h[t]=b,h.index=t,l[l.index++]=b;var S=x[0],M=x[1];if(S&&(_?C(e,t+1,r,M,S,o,x[3],x[2],u,c,h,l,p,f,d,v,m):(O(d,S),u.push(h.slice(0,h.index+1)),c.push(l.slice(0,l.index)))),b=k(y,g),g.done)break;l.index=w}}function _(e,t,r,n,i,o,a,s,u,c,h){var l=t.value;if(o.splice(0,o.length),o.push.apply(o,l),P(t))return o.index=l.length,R(t,s,u),[void 0,e,n,r];O(u,t);var p=0,f=t,d=l.length-1,v=t=e,m=n=r;do{var g=l[p],_=d>p,y=E(e,v,t,r,m,n,g,_,!0,i,o,a,s,u,c,h);if(t=y[0],j(t))return o.index=p,y;v=y[1],n=y[2],m=y[3]}while(p++<d);if(o.index=p,f[x]!==t){var b=t[M]||0;t[M]=b+1,t[w+b]=f,f[x]=t,f[S]=b}return[t,v,n,m]}function E(e,t,r,n,i,o,a,s,u,c,h,l,p,f,d,v){for(var m=r.$type;m===b;){var g=_(e,r,n,o,c,h,l,p,f,d,v);if(r=g[0],j(r))return g;t=g[1],o=g[2],i=g[3],m=r.$type}if(void 0!==m)return[r,t,o,i];if(null==a){if(s)throw new Error("`null` is not allowed in branch key positions.");r&&(a=r[y])}else t=r,i=o,r=t[a],o=i&&i[a];return r=I(t,r,o,a,c,h,l,p,f,d,v),[r,t,o,i]}var y=e(36),w=e(43),x=e(33),T=e(46),S=e(42),M=e(44),b=e(120),O=e(50),P=e(94),A=e(96),j=e(102),R=e(86),k=e(143).iterateKeySet,L=e(92),I=e(103);t.exports=function(e,t,r,n,i){for(var o=e._root,a=o,s=o.expired,u=L(),c=o.cache,h=c[T],l=[],p=[],f=[],d=[],v=-1,m=t.length;++v<m;)for(var g=t[v],_=g.paths,y=g.jsonGraph,b=-1,w=_.length;++b<w;){var x=_[b];p.index=0,C(x,0,c,c,c,y,y,y,f,d,l,p,u,s,a,i,n)}var S=c[T],M=o.onChange;return A(M)&&h!==S&&M(),[f,d]}},{102:102,103:103,120:120,143:143,33:33,36:36,42:42,43:43,44:44,46:46,50:50,86:86,92:92,94:94,96:96}],77:[function(e,t,r){function M(e,t,r,n,i,o,a,s,u,c,h,l,p,f){var d=E(e);if(d&&d.length)for(var v=0,m=d.length,g=u.index;;){var _=d[v],y=e[_],b=j(y)&&!y.$type;s.depth=t;var w=C(r,n,i,_,y,b,!1,s,u,c,h,l,p,f);s[t]=_,s.index=t,u[u.index++]=_;var x=w[0],S=w[1];if(x&&(b?M(y,t+1,r,S,x,o,a,s,u,c,h,l,p,f):(A(l,x),o.push(s.slice(0,s.index+1)),a.push(u.slice(0,u.index)))),++v>=m)break;u.index=g}}function m(e,t,r,n,i,o,a,s,u,c){var h=r.value;if(i.splice(0,i.length),i.push.apply(i,h),S(r))return i.index=h.length,L(r,a,s),[void 0,t];A(s,r);var l=r,p=t;if(r=r[b],null!=r)p=r[T]||t,i.index=h.length;else{var f=0,d=h.length-1;p=r=t;do{var v=h[f],m=d>f,g=C(t,p,r,v,e,m,!0,n,i,o,a,s,u,c);if(r=g[0],k(r))return i.index=f,g;p=g[1]}while(f++<d);if(i.index=f,l[b]!==r){var _=r[x]||0;r[x]=_+1,r[y+_]=l,l[b]=r,l[w]=_}}return[r,p]}function C(e,t,r,n,i,o,a,s,u,c,h,l,p,f){for(var d=r.$type;d===_;){var v=m(i,e,r,s,u,c,h,l,p,f);if(r=v[0],k(r))return v;t=v[1],d=r&&r.$type}if(void 0!==d)return[r,t];if(null==n){if(o)throw new Error("`null` is not allowed in branch key positions.");r&&(n=r[g])}else t=r,r=t[n];return r=N(t,r,n,i,o,a,s,u,c,h,l,p,f),[r,t]}function E(e){if(j(e)&&!e.$type){var t=[],r=0;o(e)&&(t[r++]="length");for(var n in e)n[0]!==i&&"$"!==n[0]&&a(e,n)&&(t[r++]=n);return t}}var g=e(36),y=e(43),i=e(40),T=e(39),b=e(33),O=e(46),w=e(42),x=e(44),_=e(120),P=e(13),o=Array.isArray,A=e(50),a=e(91),j=e(100),S=e(95),R=e(96),k=e(102),L=e(86),I=e(92),N=e(104);t.exports=function(e,t,r,n,i){for(var o=e._root,a=o,s=o.expired,u=I(),c=e._path,h=o.cache,l=c.length?P(e,c).value:h,p=l[T]||h,f=h[O],d=[],v=[],m=[],g=c.length,_=-1,y=t.length;++_<y;){var b=t[_],w=c.slice(0);w.index=g,M(b.json,0,h,p,l,v,m,d,w,u,s,a,i,n)}var x=h[O],S=o.onChange;return R(S)&&f!==x&&S(),[v,m]}},{100:100,102:102,104:104,120:120,13:13,33:33,36:36,39:39,40:40,42:42,43:43,44:44,46:46,50:50,86:86,91:91,92:92,95:95,96:96}],78:[function(e,t,r){function E(e,t,r,n,i,o,a,s,u,c,h,l,p,f,d){for(var v={},m=r<t.length-1,g=t[r],_=k(g,v),y=c.index;;){u.depth=r;var b=S(n,i,o,_,e,m,!1,u,c,h,l,p,f,d);u[r]=_,u.index=r,c[c.index++]=_;var w=b[0],x=b[1];if(w&&(m?E(e,t,r+1,n,x,w,a,s,u,c,h,l,p,f,d):(M(p,w),a.push(u.slice(0,u.index+1)),s.push(c.slice(0,c.index)))),_=k(g,v),v.done)break;c.index=y}}function m(e,t,r,n,i,o,a,s,u,c){var h=r.value;if(i.splice(0,i.length),i.push.apply(i,h),C(r))return i.index=h.length,R(r,a,s),[void 0,t];M(s,r);var l=r,p=t;if(r=r[b],null!=r)p=r[T]||t,i.index=h.length;else{var f=0,d=h.length-1;p=r=t;do{var v=h[f],m=d>f,g=S(t,p,r,v,e,m,!0,n,i,o,a,s,u,c);if(r=g[0],j(r))return i.index=f,g;p=g[1]}while(f++<d);if(i.index=f,l[b]!==r){var _=r[x]||0;r[x]=_+1,r[y+_]=l,l[b]=r,l[w]=_}}return[r,p]}function S(e,t,r,n,i,o,a,s,u,c,h,l,p,f){for(var d=r.$type;d===_;){var v=m(i,e,r,s,u,c,h,l,p,f);if(r=v[0],j(r))return v;t=v[1],d=r.$type}if(void 0!==d)return[r,t];if(null==n){if(o)throw new Error("`null` is not allowed in branch key positions.");r&&(n=r[g])}else t=r,r=t[n];return r=I(t,r,n,i,o,a,s,u,c,h,l,p,f),[r,t]}var g=e(36),y=e(43),T=e(39),b=e(33),O=e(46),w=e(42),x=e(44),_=e(120),P=e(13),M=e(50),C=e(95),A=e(96),j=e(102),R=e(86),k=e(143).iterateKeySet,L=e(92),I=e(104);t.exports=function(e,t,r,n,i){for(var o=e._root,a=o,s=o.expired,u=L(),c=e._path,h=o.cache,l=c.length?P(e,c).value:h,p=l[T]||h,f=h[O],d=[],v=[],m=[],g=c.length,_=-1,y=t.length;++_<y;){var b=t[_],w=b.path,x=b.value,S=c.slice(0);S.index=g,E(x,w,0,h,p,l,v,m,d,S,u,s,a,i,n)}var M=h[O],C=o.onChange;return A(C)&&f!==M&&C(),[v,m]}},{102:102,104:104,120:120,13:13,143:143,33:33,36:36,39:39,42:42,43:43,44:44,46:46,50:50,86:86,92:92,95:95,96:96}],79:[function(e,t,r){var s=e(130),u=e(64),c=e(101);t.exports=function(e,t){for(var r=c(e)?e:s.pathValue(e,t),n=0,o=r.path,i=o.length;++n<i;)if("object"==typeof o[n])return new u(function(e){e.onError(new Error("Paths must be simple paths"))});var a=this;return new u(function(i){return a._set(r).subscribe(function(e){for(var t=e.json,r=-1,n=o.length;t&&++r<n;)t=t[o[r]];i.onNext(t)},function(e){i.onError(e)},function(){i.onCompleted()})})}},{101:101,130:130,64:64}],80:[function(e,t,r){var u=e(134),c=e(101),h=e(78);t.exports=function(e,t,r,n){var i=u.fromPath(e),o=t,a=r,s=n;if(c(i)?(s=a,a=o,o=i):o={path:i,value:o},c(o)===!1)throw new Error("Model#setValueSync must be called with an Array path.");return"function"!=typeof a&&(a=this._root._errorSelector),"function"!=typeof s&&(s=this._root._comparator),this._syncCheck("setValueSync")?(h(this,[o]),this._getValueSync(this,o.path).value):void 0}},{101:101,134:134,78:78}],81:[function(e,t,r){t.exports=function(e){if(!e)return e;for(var t=-1,r=e.length,n=[];++t<r;)n[t]=e[t];return n}},{}],82:[function(e,t,r){t.exports=function(e,t){for(var r=-1,n=-1,i=e.length,o=[];++n<i;)for(var a=t(e[n],n,e),s=-1,u=a.length;++s<u;)o[++r]=a[s];return o}},{}],83:[function(e,t,r){t.exports=function(e,t){for(var r=-1,n=e.length,i=new Array(n);++r<n;)i[r]=t(e[r],r,e);return i}},{}],84:[function(e,t,r){t.exports=function(e,t,r){var n=t||0,i=-1,o=e.length-n;0>o&&(o=0),r>0&&o>r&&(o=r);for(var a=new Array(o);++i<o;)a[i]=e[i+n];return a}},{}],85:[function(e,t,r){var i=e(40),o=e(91),a=Array.isArray,s=e(100);t.exports=function(e){var t=e;if(s(t)){t=a(e)?[]:{};var r=e;for(var n in r)n[0]!==i&&o(r,n)&&(t[n]=r[n])}return t}},{100:100,40:40,91:91}],86:[function(e,t,r){var n=e(51),i=e(35);t.exports=function(e,t,r){return e[i]||(e[i]=!0,t.push(e),n(r,e)),e}},{35:35,51:51}],87:[function(e,t,r){var n=e(100);t.exports=function(e){return n(e)&&e.$expires||void 0}},{100:100}],88:[function(e,t,r){var n=e(100);t.exports=function(e){return n(e)&&e.$size||0}},{100:100}],89:[function(e,t,r){var n=e(100);t.exports=function(e){return n(e)&&e.$timestamp||void 0}},{100:100}],90:[function(e,t,r){var n=e(100);t.exports=function(e,t){var r=n(e)&&e.$type||void 0;return t&&r?"branch":r}},{100:100}],91:[function(e,t,r){var n=e(100),i=Object.prototype.hasOwnProperty;t.exports=function(e,t){return n(e)&&i.call(e,t)}},{100:100}],92:[function(e,t,r){var n=1;t.exports=function(){return n++}},{}],93:[function(e,t,r){var i=e(36),o=e(39),a=e(46);t.exports=function(e,t,r,n){return e[i]=r,e[o]=t,e[a]=n,t[r]=e,e}},{36:36,39:39,46:46}],94:[function(e,t,r){var n=e(106),i=e(122),o=e(121);t.exports=function(e){var t=e.$expires;return null!=t&&t!==o&&t!==i&&t<n()}},{106:106,121:121,122:122}],95:[function(e,t,r){var n=e(106),i=e(122),o=e(121);t.exports=function(e){var t=e.$expires;return null!=t&&t!==o&&(t===i||t<n())}},{106:106,121:121,122:122}],96:[function(e,t,r){var n="function";t.exports=function(e){return Boolean(e)&&typeof e===n}},{}],97:[function(e,t,r){var n=e(40);t.exports=function(e){return"$size"===e||e&&e.charAt(0)===n}},{40:40}],98:[function(e,t,r){var n=e(100);t.exports=function(e){return n(e)&&"json"in e}},{100:100}],99:[function(e,t,r){var n=Array.isArray,i=e(100);t.exports=function(e){return i(e)&&n(e.paths)&&(i(e.jsonGraph)||i(e.jsong)||i(e.json)||i(e.values)||i(e.value))}},{100:100}],100:[function(e,t,r){var n="object";t.exports=function(e){return null!==e&&typeof e===n}},{}],101:[function(e,t,r){var n=Array.isArray,i=e(100);t.exports=function(e){return i(e)&&(n(e.path)||"string"==typeof e.path)}},{100:100}],102:[function(e,t,r){var n="object";t.exports=function(e){return null==e||typeof e!==n}},{}],103:[function(e,t,r){var y=e(36),b=e(39),w=e(120),x=e(119),S=e(88),M=e(89),C=e(100),E=e(95),T=e(96),O=e(50),P=e(117),A=e(93),j=e(86),R=e(110),k=e(115),L=e(107);t.exports=function(e,t,r,n,i,o,a,s,u,c,h){var l,p,f,d,v,m,g;if(t===r){if(null===r)return t=P(r,void 0,r),e=k(e,-t.$size,u,a),t=A(t,e,n),O(u,t),t;if(void 0===r)return r;if(d=C(t),d&&(p=t.$type,null==p))return null==t[b]&&(t[y]=n,t[b]=e),t}else d=C(t),d&&(p=t.$type);if(p!==w){if(v=C(r),v&&(f=r.$type),d&&!p&&(null==r||v&&!f))return t}else{if(null==r)return E(t)?void j(t,s,u):t;if(v=C(r),v&&(f=r.$type,f===w))if(t===r){if(null!=t[b])return t}else if(m=t.$timestamp,g=r.$timestamp,!E(t)&&!E(r)&&m>g)return}if(p&&v&&!f)return A(R(t,r,e,n,u),e,n);if(f||!v){if(f===x&&T(h)&&(r=h(L(i,n),r)),f&&t===r)null==t[b]&&(t=P(t,p,t.value),e=k(e,-t.$size,u,a),t=A(t,e,n,a));else{var _=!0;!p&&d||(_=M(r)<M(t)==!1,(p||f)&&T(c)&&(_=!c(t,r,o.slice(0,o.index)))),_&&(r=P(r,f,f?r.value:r),l=S(t)-S(r),t=R(t,r,e,n,u),e=k(e,l,u,a),t=A(t,e,n,a))}E(t)?j(t,s,u):O(u,t)}else null==t&&(t=A(r,e,n));return t}},{100:100,107:107,110:110,115:115,117:117,119:119,120:120,36:36,39:39,50:50,86:86,88:88,89:89,93:93,95:95,96:96}],104:[function(e,t,r){var _=e(120),y=e(119),b=e(90),w=e(88),x=e(89),S=e(95),M=e(102),C=e(96),E=e(117),T=e(86),O=e(93),P=e(110),A=e(115),j=e(114),R=e(107);t.exports=function(e,t,r,n,i,o,a,s,u,c,h,l,p){var f=b(t,o);if(i||o)f&&S(t)&&(f="expired",T(t,c,h)),(f&&f!==_||M(t))&&(t=P(t,{},e,r,h),t=O(t,e,r,u),t=j(t,u));else{var d=n,v=b(d),m=x(d)<x(t)==!1;if((f||v)&&C(l)&&(m=!l(t,d,s.slice(0,s.index))),m){v===y&&C(p)&&(d=p(R(a,r),d)),d=E(d,v,v?d.value:d);var g=w(t)-w(d);t=P(t,d,e,r,h),e=A(e,g,h,u),t=O(t,e,r,u)}}return t}},{102:102,107:107,110:110,114:114,115:115,117:117,119:119,120:120,86:86,88:88,89:89,90:90,93:93,95:95,96:96}],105:[function(e,t,r){t.exports=function(){}},{}],106:[function(e,t,r){t.exports=Date.now},{}],107:[function(e,t,r){t.exports=function(e,t){var r=e.slice(0,e.depth);return r[r.length]=t,r}},{}],108:[function(e,t,r){var o=e(120),a=e(39),s=e(51),u=e(100),c=e(112),h=e(113);t.exports=function(e,t,r,n){if(u(e)){var i=e.$type;return Boolean(i)&&(i===o&&h(e),s(n,e)),c(e),t[r]=e[a]=void 0,!0}return!1}},{100:100,112:112,113:113,120:120,39:39,51:51}],109:[function(e,t,r){var a=e(91),s=e(40),u=e(108);t.exports=function e(t,r,n,i){if(u(t,r,n,i)){if(null==t.$type)for(var o in t)o[0]!==s&&"$"!==o[0]&&a(t,o)&&e(t[o],t,o,i);return!0}return!1}},{108:108,40:40,91:91}],110:[function(e,t,r){var o=e(100),a=e(111),s=e(109);t.exports=function(e,t,r,n,i){return e===t?e:(o(e)&&(a(e,t),s(e,r,n,i)),r[n]=t,t)}},{100:100,109:109,111:111}],111:[function(e,t,r){var a=e(43),s=e(33),u=e(44);t.exports=function(e,t){for(var r=e[u]||0,n=t[u]||0,i=-1;++i<r;){var o=e[a+i];void 0!==o&&(o[s]=t,t[a+(n+i)]=o,e[a+i]=void 0)}return t[u]=r+n,e[u]=void 0,t}},{33:33,43:43,44:44}],112:[function(e,t,r){var i=e(43),o=e(33),a=e(42),s=e(44);t.exports=function(e){for(var t=-1,r=e[s]||0;++t<r;){var n=e[i+t];null!=n&&(n[o]=n[a]=e[i+t]=void 0)}return e[s]=void 0,e}},{33:33,42:42,43:43,44:44}],113:[function(e,t,r){var i=e(43),o=e(33),a=e(42),s=e(44);t.exports=function(e){var t=e[o];if(t){for(var r=(e[a]||0)-1,n=(t[s]||0)-1;++r<=n;)t[i+r]=t[i+(r+1)];t[s]=n,e[a]=e[o]=t=void 0}return e}},{33:33,42:42,43:43,44:44}],114:[function(e,t,r){var s=e(43),u=e(39),c=e(46),h=e(44);t.exports=function(e,t){var r=[e],n=0;do{var i=r[n--];if(i&&i[c]!==t){i[c]=t,r[n++]=i[u];for(var o=-1,a=i[h]||0;++o<a;)r[n++]=i[s+o]}}while(n>-1);return e}},{39:39,43:43,44:44,46:46}],115:[function(e,t,r){var s=e(36),u=e(46),c=e(39),h=e(108),l=e(114);t.exports=function(e,t,r,n){var i=e;do{var o=i[c],a=i.$size=(i.$size||0)-t;0>=a&&null!=o?h(i,o,i[s],r):i[u]!==n&&l(i,n),i=o}while(i);return e}},{108:108,114:114,36:36,39:39,46:46}],116:[function(e,t,r){var s=Array.isArray,u=e(101),c=e(99),h=e(98),l=e(134);t.exports=function(e,t,r){for(var n=0,i=e.length;i>n;++n){var o=e[n],a=!1;if(s(o)&&t.path?a=!0:"string"==typeof o&&t.pathSyntax?a=!0:u(o)&&t.pathValue?(o.path=l.fromPath(o.path),a=!0):c(o)&&t.jsonGraph?a=!0:h(o)&&t.json?a=!0:"function"==typeof o&&n+1===i&&t.selector&&(a=!0),!a)return new Error("Unrecognized argument "+typeof o+" ["+String(o)+"] to Model#"+r)}return!0}},{101:101,134:134,98:98,99:99}],117:[function(e,t,r){var n=e(130),s=n.atom,u=e(106),c=e(122),h=e(37),l=50,p=e(85),f=Array.isArray,d=e(88),v=e(87);t.exports=function(e,t,r){var n=0,i=e,o=t;if(o?(i=p(i),n=d(i),i.$type=o):(i=s(r),o=i.$type,i[h]=!0),null==r)n=l+1;else if(null==n||0>=n)switch(typeof r){case"object":n=f(r)?l+r.length:l+1;break;case"string":n=l+r.length;break;default:n=l+1}var a=v(i);return"number"==typeof a&&c>a&&(i.$expires=u()+-1*a),i.$size=n,i}},{106:106,122:122,130:130,37:37,85:85,87:87,88:88}],118:[function(e,t,r){t.exports="atom"},{}],119:[function(e,t,r){t.exports="error"},{}],120:[function(e,t,r){t.exports="ref"},{}],121:[function(e,t,r){t.exports=1},{}],122:[function(e,t,r){t.exports=0},{}],123:[function(e,t,r){"use strict";function n(){if(u.length)throw u.shift()}function i(e){var t;t=s.length?s.pop():new o,t.task=e,a(t)}function o(){this.task=null}var a=e(124),s=[],u=[],c=a.makeRequestCallFromTimer(n);t.exports=i,o.prototype.call=function(){try{this.task.call()}catch(e){i.onerror?i.onerror(e):(u.push(e),c())}finally{this.task=null,s[s.length]=this}}},{124:124}],124:[function(e,l,t){(function(e){"use strict";function t(e){a.length||(o(),s=!0),a[a.length]=e}function r(){for(;u<a.length;){var e=u;if(u+=1,a[e].call(),u>c){for(var t=0,r=a.length-u;r>t;t++)a[t]=a[t+u];a.length-=u,u=0}}a.length=0,u=0,s=!1}function n(e){var t=1,r=new h(e),n=document.createTextNode("");return r.observe(n,{characterData:!0}),function(){t=-t,n.data=t}}function i(n){return function(){function e(){clearTimeout(t),clearInterval(r),n()}var t=setTimeout(e,0),r=setInterval(e,50)}}l.exports=t;var o,a=[],s=!1,u=0,c=1024,h=e.MutationObserver||e.WebKitMutationObserver;o="function"==typeof h?n(r):i(r),t.requestFlush=o,t.makeRequestCallFromTimer=i}).call(this,"undefined"!=typeof n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],125:[function(e,t,r){"use strict";function c(e,t){var r;for(r in t)e[r]=t[r];return e}function n(e,t){if(this._jsongUrl=e,"number"==typeof t){var r={timeout:t};t=r}this._config=c({timeout:15e3,headers:{}},t||{})}var h=e(129),i=e(126);Array.isArray;n.prototype={constructor:n,buildQueryObject:i,get:function(e){var t="GET",r=this.buildQueryObject(this._jsongUrl,t,{paths:e,method:"get"}),n=c(r,this._config),i=this;return h(t,n,i)},set:function(e){var t="POST",r=this.buildQueryObject(this._jsongUrl,t,{jsonGraph:e,method:"set"}),n=c(r,this._config);n.headers["Content-Type"]="application/x-www-form-urlencoded";var i=this;return h(t,n,i)},call:function(e,t,r,n){t=t||[],r=r||[],n=n||[];var i="POST",o=[];o.push("method=call"),o.push("callPath="+encodeURIComponent(JSON.stringify(e))),o.push("arguments="+encodeURIComponent(JSON.stringify(t))),o.push("pathSuffixes="+encodeURIComponent(JSON.stringify(r))),o.push("paths="+encodeURIComponent(JSON.stringify(n)));var a=this.buildQueryObject(this._jsongUrl,i,o.join("&")),s=c(a,this._config);s.headers["Content-Type"]="application/x-www-form-urlencoded";var u=this;return h(i,s,u)}},n.XMLHttpSource=n,n["default"]=n,t.exports=n},{126:126,129:129}],126:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n,i=[],o={url:e},a=-1!==e.indexOf("?"),s=a?"&":"?";return"string"==typeof r?i.push(r):(n=Object.keys(r),n.forEach(function(e){var t="object"==typeof r[e]?JSON.stringify(r[e]):r[e];i.push(e+"="+encodeURIComponent(t))})),"GET"===t?o.url+=s+i.join("&"):o.data=i.join("&"),o}},{}],127:[function(e,r,t){(function(t){"use strict";r.exports=function(){var e=new t.XMLHttpRequest;if("withCredentials"in e)return e;if(t.XDomainRequest)return new XDomainRequest;throw new Error("CORS is not supported by your browser")}}).call(this,"undefined"!=typeof n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],128:[function(e,t,r){(function(n){"use strict";t.exports=function(){var e,t,r;if(n.XMLHttpRequest)return new n.XMLHttpRequest;try{for(t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=0;3>r;r++)try{if(e=t[r],new n.ActiveXObject(e))break}catch(e){}return new n.ActiveXObject(e)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}}).call(this,"undefined"!=typeof n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],129:[function(e,t,r){"use strict";function n(){}function i(s,u,c){return n.create(function(t){var r,n,e,i,o,a={method:s||"GET",crossDomain:!1,async:!0,headers:{},responseType:"json"};for(o in u)d.call(u,o)&&(a[o]=u[o]);a.crossDomain||a.headers["X-Requested-With"]||(a.headers["X-Requested-With"]="XMLHttpRequest"),null!=c.onBeforeRequest&&c.onBeforeRequest(a);try{r=a.crossDomain?f():p()}catch(e){t.onError(e)}try{a.user?r.open(a.method,a.url,a.async,a.user,a.password):r.open(a.method,a.url,a.async),r.timeout=a.timeout,r.withCredentials=a.withCredentials!==!1,e=a.headers;for(i in e)d.call(e,i)&&r.setRequestHeader(i,e[i]);if(a.responseType)try{r.responseType=a.responseType}catch(e){if("json"!==a.responseType)throw e}r.onreadystatechange=function(e){4===r.readyState&&(n||(n=!0,h(t,r,e)))},r.ontimeout=function(e){n||(n=!0,l(t,r,"timeout error",e))},r.send(a.data)}catch(e){t.onError(e)}return function(){n||4===r.readyState||(n=!0,r.abort())}})}function a(e,t,r){r||(r=new Error(t)),e.onError(r)}function h(e,t,r){var n,i;if(t&&e){i=t.responseType,n="response"in t?t.response:t.responseText;var o=1223===t.status?204:t.status;if(o>=200&&399>=o){try{"json"!==i&&(n=JSON.parse(n||"")),"string"==typeof n&&(n=JSON.parse(n||""))}catch(r){a(e,"invalid json",r)}return e.onNext(n),void e.onCompleted()}return 401===o||403===o||407===o?a(e,n):410===o?a(e,n):408===o||504===o?a(e,n):a(e,n||"Response code "+o)}}function l(e,t,r,n){a(e,r||t.statusText||"request error",n)}var p=e(128),f=e(127),d=Object.prototype.hasOwnProperty,s=function(){};n.create=function(o){var e=new n;return e.subscribe=function(e,t,r){var n,i;return n="function"==typeof e?{onNext:e,onError:t||s,onCompleted:r||s}:e,i=o(n),"function"==typeof i?{dispose:i}:i},e},t.exports=i},{127:127,128:128}],130:[function(e,t,r){function n(e,t,r){var n=Object.create(null);if(null!=r){for(var i in r)n[i]=r[i];return n.$type=e,n.value=t,n}return{$type:e,value:t}}var i=e(134);t.exports={ref:function(e,t){return n("ref",i.fromPath(e),t)},atom:function(e,t){return n("atom",e,t)},undefined:function(){return n("atom")},error:function(e,t){return n("error",e,t)},pathValue:function(e,t){return{path:i.fromPath(e),value:t}},pathInvalidation:function(e){return{path:i.fromPath(e),invalidated:!0}}}},{134:134}],131:[function(e,t,r){t.exports={integers:"integers",ranges:"ranges",keys:"keys"}},{}],132:[function(e,t,r){var n={token:"token",dotSeparator:".",commaSeparator:",",openingBracket:"[",closingBracket:"]",openingBrace:"{",closingBrace:"}",escape:"\\",space:" ",colon:":",quote:"quote",unknown:"unknown"};t.exports=n},{}],133:[function(e,t,r){t.exports={indexer:{nested:"Indexers cannot be nested.",needQuotes:"unquoted indexers must be numeric.",empty:"cannot have empty indexers.",leadingDot:"Indexers cannot have leading dots.",leadingComma:"Indexers cannot have leading comma.",requiresComma:"Indexers require commas between indexer args.",routedTokens:"Only one token can be used per indexer when specifying routed tokens."},range:{precedingNaN:"ranges must be preceded by numbers.",suceedingNaN:"ranges must be suceeded by numbers."},routed:{invalid:"Invalid routed token.  only integers|ranges|keys are supported."},quote:{empty:"cannot have empty quoted keys.",illegalEscape:"Invalid escape character.  Only quotes are escapable."},unexpectedToken:"Unexpected token.",invalidIdentifier:"Invalid Identifier.",invalidPath:"Please provide a valid path.",throwError:function(e,t,r){if(r)throw e+" -- "+t.parseString+" with next token: "+r;throw e+" -- "+t.parseString}}},{}],134:[function(e,t,r){var n=e(140),i=e(135),o=e(131),a=function(e,t){return i(new n(e,t))};t.exports=a,a.fromPathsOrPathValues=function(e,t){if(!e)return[];for(var r=[],n=0,i=e.length;i>n;n++)"string"==typeof e[n]?r[n]=a(e[n],t):"string"==typeof e[n].path?r[n]={path:a(e[n].path,t),value:e[n].value}:r[n]=e[n];return r},a.fromPath=function(e,t){return e?"string"==typeof e?a(e,t):e:[]},a.RoutedTokens=o},{131:131,135:135,140:140}],135:[function(e,t,r){var o=e(132),a=e(133),s=e(136);t.exports=function(e){for(var t=e.next(),r={},n=[];!t.done;){switch(t.type){case o.token:var i=+t.token[0];isNaN(i)||a.throwError(a.invalidIdentifier,e),n[n.length]=t.token;break;case o.dotSeparator:0===n.length&&a.throwError(a.unexpectedToken,e);break;case o.space:break;case o.openingBracket:s(e,t,r,n);break;default:a.throwError(a.unexpectedToken,e)}t=e.next()}return 0===n.length&&a.throwError(a.invalidPath,e),n}},{132:132,133:133,136:136}],136:[function(e,t,r){var c=e(132),h=e(133),l=h.indexer,p=e(138),f=e(137),d=e(139);t.exports=function(e,t,r,n){var i=e.next(),o=!1,a=1,s=!1;for(r.indexer=[];!i.done;){switch(i.type){case c.token:case c.quote:r.indexer.length===a&&h.throwError(l.requiresComma,e)}switch(i.type){case c.openingBrace:s=!0,d(e,i,r,n);break;case c.token:var u=+i.token;isNaN(u)&&h.throwError(l.needQuotes,e),r.indexer[r.indexer.length]=u;break;case c.dotSeparator:r.indexer.length||h.throwError(l.leadingDot,e),p(e,i,r,n);break;case c.space:break;case c.closingBracket:o=!0;break;case c.quote:f(e,i,r,n);break;case c.openingBracket:h.throwError(l.nested,e);break;case c.commaSeparator:++a;break;default:h.throwError(h.unexpectedToken,e)}if(o)break;i=e.next()}0===r.indexer.length&&h.throwError(l.empty,e),r.indexer.length>1&&s&&h.throwError(l.routedTokens,e),1===r.indexer.length&&(r.indexer=r.indexer[0]),n[n.length]=r.indexer,r.indexer=void 0}},{132:132,133:133,137:137,138:138,139:139}],137:[function(e,t,r){var c=e(132),h=e(133),l=h.quote;t.exports=function(e,t,r,n){for(var i=e.next(),o="",a=t.token,s=!1,u=!1;!i.done;){switch(i.type){case c.token:case c.space:case c.dotSeparator:case c.commaSeparator:case c.openingBracket:case c.closingBracket:case c.openingBrace:case c.closingBrace:s&&h.throwError(l.illegalEscape,e),o+=i.token;break;case c.quote:s?(o+=i.token,s=!1):i.token!==a?o+=i.token:u=!0;break;case c.escape:s=!0;break;default:h.throwError(h.unexpectedToken,e)}if(u)break;i=e.next()}0===o.length&&h.throwError(l.empty,e),r.indexer[r.indexer.length]=o}},{132:132,133:133}],138:[function(e,t,r){var l=e(140),p=e(132),f=e(133);t.exports=function(e,t,r,n){var i,o=e.peek(),a=1,s=!1,u=!0,c=r.indexer.length-1,h=l.toNumber(r.indexer[c]);for(isNaN(h)&&f.throwError(f.range.precedingNaN,e);!s&&!o.done;){switch(o.type){case p.dotSeparator:3===a&&f.throwError(f.unexpectedToken,e),++a,3===a&&(u=!1);break;case p.token:i=l.toNumber(e.next().token),isNaN(i)&&f.throwError(f.range.suceedingNaN,e),s=!0;break;default:s=!0}if(s)break;e.next(),o=e.peek()}r.indexer[c]={from:h,to:u?i:i-1}}},{132:132,133:133,140:140}],139:[function(e,t,r){var c=e(132),h=e(131),l=e(133),p=l.routed;t.exports=function(e,t,r,n){var i=e.next(),o=!1,a="";switch(i.token){case h.integers:case h.ranges:case h.keys:break;default:l.throwError(p.invalid,e)}var s=e.next();if(s.type===c.colon&&(o=!0,s=e.next(),s.type!==c.token&&l.throwError(p.invalid,e),a=s.token,s=e.next()),s.type===c.closingBrace){var u={type:i.token,named:o,name:a};r.indexer[r.indexer.length]=u}else l.throwError(p.invalid,e)}},{131:131,132:132,133:133}],140:[function(e,t,r){function c(e,t,r){return{token:e,done:r,type:t}}function n(e,t,r){var n,i=!1,o="",a=r?S:x;do{if(n=t+1>=e.length)break;var s=e[t+1];if(void 0===s||-1!==a.indexOf(s)){if(o.length)break;++t;var u;switch(s){case l:u=h.dotSeparator;break;case p:u=h.commaSeparator;break;case f:u=h.openingBracket;break;case d:u=h.closingBracket;break;case v:u=h.openingBrace;break;case m:u=h.closingBrace;break;case w:u=h.space;break;case y:case b:u=h.quote;break;case _:u=h.escape;break;case g:u=h.colon;break;default:u=h.unknown}i=c(s,u,!1);break}o+=s,++t}while(!n);return!i&&o.length&&(i=c(o,h.token,!1)),i||(i={done:!0}),{token:i,idx:t}}var h=e(132),l=".",p=",",f="[",d="]",v="{",m="}",g=":",_="\\",y='"',b="'",w=" ",x="\\'\"[]., ",S="\\{}'\"[]., :",i=t.exports=function(e,t){this._string=e,this._idx=-1,this._extended=t,this.parseString=""};i.prototype={next:function(){var e=this._nextToken?this._nextToken:n(this._string,this._idx,this._extended);return this._idx=e.idx,this._nextToken=!1,this.parseString+=e.token.token,e.token},peek:function(){var e=this._nextToken?this._nextToken:n(this._string,this._idx,this._extended);return this._nextToken=e,e.token}},i.toNumber=function(e){return isNaN(+e)?NaN:+e}},{132:132}],141:[function(e,t,r){var n=e(147),i=e(148);t.exports=function(e){var t=e.reduce(function(e,t){var r=t.length;return e[r]||(e[r]=[]),e[r].push(t),e},{});return Object.keys(t).forEach(function(e){t[e]=i(t[e])}),n(t)}},{147:147,148:148}],142:[function(e,t,r){var p=e(144);t.exports=function e(t,r,n){for(var i=t,o=!0;o&&n<r.length;++n){var a=r[n],s=typeof a;if(a&&"object"===s){var u={},c=p(a,u),h=n+1;do{var l=i[c];o=void 0!==l,o&&(o=e(l,r,h)),c=p(a,u)}while(o&&!u.done);break}i=i[a],o=void 0!==i}return o}},{144:144}],143:[function(e,t,r){t.exports={iterateKeySet:e(144),toTree:e(148),toTreeWithUnion:e(149),pathsComplementFromTree:e(146),pathsComplementFromLengthTree:e(145),hasIntersection:e(142),toPaths:e(147),collapse:e(141)}},{141:141,142:142,144:144,145:145,146:146,147:147,148:148,149:149}],144:[function(e,t,r){function s(e,t){var r=t.from=e.from||0,n=t.to=e.to||"number"==typeof e.length&&t.from+e.length-1||0;t.rangeOffset=t.from,t.loaded=!0,r>n&&(t.empty=!0)}function u(e,t){t.done=!1;var r=t.isObject=!(!e||"object"!=typeof e);t.isArray=r&&n(e),t.arrayOffset=0}var n=Array.isArray;t.exports=function(e,t){if(void 0===t.isArray&&u(e,t),t.isArray){var r;do{t.loaded&&t.rangeOffset>t.to&&(++t.arrayOffset,t.loaded=!1);var n=t.arrayOffset,i=e.length;if(n>=i){t.done=!0;break}var o=e[t.arrayOffset],a=typeof o;if("object"===a){if(t.loaded||s(o,t),t.empty)continue;r=t.rangeOffset++}else++t.arrayOffset,r=o}while(void 0===r);return r}return t.isObject?(t.loaded||s(e,t),t.rangeOffset>t.to?void(t.done=!0):t.rangeOffset++):(t.done=!0,e)}},{}],145:[function(e,t,r){var s=e(142);t.exports=function(e,t){for(var r=[],n=-1,i=0,o=e.length;o>i;++i){var a=e[i];s(t[a.length],a,0)||(r[++n]=a)}return r}},{142:142}],146:[function(e,t,r){var a=e(142);t.exports=function(e,t){for(var r=[],n=-1,i=0,o=e.length;o>i;++i)a(t,e[i],0)||(r[++n]=e[i]);return r}},{142:142}],147:[function(e,t,r){function u(e){return null!==e&&typeof e===n}function M(e,t,r){var n,i,o,a,s,u,c,h,l,p,f,d,v,m,g=E(String(t)),_=Object.create(null),y=[],b=-1,w=0,x=[],S=0;if(a=[],s=-1,r-1>t){for(u=C(e,a);++s<u;)n=a[s],i=M(e[n],t+1,r),o=i.code,_[o]?i=_[o]:(y[w++]=o,i=_[o]={keys:[],sets:i.sets}),g=E(g+n+o),T(n)&&i.keys.push(parseInt(n,10))||i.keys.push(n);for(;++b<w;)if(n=y[b],i=_[n],a=i.keys,u=a.length,u>0)for(c=i.sets,h=-1,l=c.length,v=a[0];++h<l;){for(p=c[h],f=-1,d=p.length,m=new Array(d+1),m[0]=u>1&&a||v;++f<d;)m[f+1]=p[f];x[S++]=m}}else for(u=C(e,a),u>1?x[S++]=[a]:x[S++]=a;++s<u;)g=E(g+a[s]);return{code:g,sets:x}}function c(e){for(var t=-1,r=e.length;++t<r;){var n=e[t];o(n)&&(e[t]=i(n))}return e}function i(e){for(var t=-1,r=e.length-1,n=r>0;++t<=r;){var i=e[t];if(!T(i)){n=!1;break}e[t]=parseInt(i,10)}if(n===!0){e.sort(s);var o=e[0],a=e[r];if(r>=a-o)return{from:o,to:a}}return e}function s(e,t){return e-t}function C(e,t,r){var n=0;for(var i in e)t[n++]=i;return n>1&&t.sort(r),n}function E(e){for(var t=5381,r=-1,n=e.length;++r<n;)t=(t<<5)+t+e.charCodeAt(r);return String(t)}function T(e){return!o(e)&&e-parseFloat(e)+1>=0}var o=Array.isArray,n="object";t.exports=function(e){var t,r=[],n=0;for(var i in e)if(T(i)&&u(t=e[i]))for(var o=M(t,0,parseInt(i,10)).sets,a=-1,s=o.length;++a<s;)r[n++]=c(o[a]);return r}},{}],148:[function(e,t,r){function u(e,t,r){var n,i=t[r],o={},a=r+1;n=c(i,o);do{var s=e[n];s||(a===t.length?e[n]=null:s=e[n]={}),a<t.length&&u(s,t,a),o.done||(n=c(i,o))}while(!o.done)}var c=e(144);Array.isArray;t.exports=function(e){return e.reduce(function(e,t){return u(e,t,0),e},{})}},{144:144}],149:[function(e,t,r){},{}],150:[function(e,t,r){function n(){h=!1,s.length?c=s.concat(c):l=-1,c.length&&i()}function i(){if(!h){var e=setTimeout(n);h=!0;for(var t=c.length;t;){for(s=c,c=[];++l<t;)s&&s[l].run();l=-1,t=c.length}s=null,h=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function a(){}var s,u=t.exports={},c=[],h=!1,l=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new o(e,t)),1!==c.length||h||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=a,u.addListener=a,u.once=a,u.off=a,u.removeListener=a,u.removeAllListeners=a,u.emit=a,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],151:[function(e,t,r){"use strict";t.exports=e(156)},{156:156}],152:[function(e,t,r){"use strict";function a(){}function n(e){try{return e.then}catch(e){return m=e,g}}function i(e,t){try{return e(t)}catch(e){return m=e,g}}function o(e,t,r){try{e(t,r)}catch(e){return m=e,g}}function s(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._37=0,this._12=null,this._59=[],e!==a&&d(e,this)}function u(n,i,o){return new n.constructor(function(e,t){var r=new s(a);r.then(e,t),c(n,new f(i,o,r))})}function c(r,n){for(;3===r._37;)r=r._12;return 0===r._37?void r._59.push(n):void v(function(){var e=1===r._37?n.onFulfilled:n.onRejected;if(null===e)return void(1===r._37?h(n.promise,r._12):l(n.promise,r._12));var t=i(e,r._12);t===g?l(n.promise,m):h(n.promise,t)})}function h(e,t){if(t===e)return l(e,new TypeError("A promise cannot be resolved with itself."));if(t&&("object"==typeof t||"function"==typeof t)){var r=n(t);if(r===g)return l(e,m);if(r===e.then&&t instanceof s)return e._37=3,e._12=t,void p(e);if("function"==typeof r)return void d(r.bind(t),e)}e._37=1,e._12=t,p(e)}function l(e,t){e._37=2,e._12=t,p(e)}function p(e){for(var t=0;t<e._59.length;t++)c(e,e._59[t]);e._59=null}function f(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function d(e,t){var r=!1,n=o(e,function(e){r||(r=!0,h(t,e))},function(e){r||(r=!0,l(t,e))});r||n!==g||(r=!0,l(t,m))}var v=e(124),m=null,g={};t.exports=s,s._99=a,s.prototype.then=function(e,t){if(this.constructor!==s)return u(this,e,t);var r=new s(a);return c(this,new f(e,t,r)),r}},{124:124}],153:[function(e,t,r){"use strict";var n=e(152);t.exports=n,n.prototype.done=function(e,t){var r=arguments.length?this.then.apply(this,arguments):this;r.then(null,function(e){setTimeout(function(){throw e},0)})}},{152:152}],154:[function(e,t,r){"use strict";function n(e){var t=new c(c._99);return t._37=1,t._12=e,t}var c=e(152);t.exports=c;var i=n(!0),o=n(!1),a=n(null),s=n(void 0),u=n(0),h=n("");c.resolve=function(e){if(e instanceof c)return e;if(null===e)return a;if(void 0===e)return s;if(e===!0)return i;if(e===!1)return o;if(0===e)return u;if(""===e)return h;if("object"==typeof e||"function"==typeof e)try{var t=e.then;if("function"==typeof t)return new c(t.bind(e))}catch(r){return new c(function(e,t){t(r)})}return n(e)},c.all=function(e){var u=Array.prototype.slice.call(e);return new c(function(i,o){function a(t,e){if(e&&("object"==typeof e||"function"==typeof e)){if(e instanceof c&&e.then===c.prototype.then){for(;3===e._37;)e=e._12;return 1===e._37?a(t,e._12):(2===e._37&&o(e._12),void e.then(function(e){a(t,e)},o))}var r=e.then;if("function"==typeof r){var n=new c(r.bind(e));return void n.then(function(e){a(t,e)},o)}}u[t]=e,0===--s&&i(u)}if(0===u.length)return i([]);for(var s=u.length,e=0;e<u.length;e++)a(e,u[e])})},c.reject=function(r){return new c(function(e,t){t(r)})},c.race=function(e){return new c(function(t,r){e.forEach(function(e){c.resolve(e).then(t,r)})})},c.prototype["catch"]=function(e){return this.then(null,e)}},{152:152}],155:[function(e,t,r){"use strict";var n=e(152);t.exports=n,n.prototype["finally"]=function(t){return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})})}},{152:152}],156:[function(e,t,r){"use strict";t.exports=e(152),e(153),e(155),e(154),e(157)},{152:152,153:153,154:154,155:155,157:157}],157:[function(e,t,r){"use strict";var a=e(152),i=e(123);t.exports=a,a.denodeify=function(o,e){return e=e||1/0,function(){var t=this,i=Array.prototype.slice.call(arguments,0,e>0?e:0);return new a(function(r,n){i.push(function(e,t){e?n(e):r(t)});var e=o.apply(t,i);!e||"object"!=typeof e&&"function"!=typeof e||"function"!=typeof e.then||r(e)})}},a.nodeify=function(r){return function(){var e=Array.prototype.slice.call(arguments),t="function"==typeof e[e.length-1]?e.pop():null,n=this;try{return r.apply(this,arguments).nodeify(t,n)}catch(r){if(null===t||"undefined"==typeof t)return new a(function(e,t){t(r)});i(function(){t.call(n,r)})}}},a.prototype.nodeify=function(t,r){return"function"!=typeof t?this:void this.then(function(e){i(function(){t.call(r,null,e)})},function(e){i(function(){t.call(r,e)})})}},{123:123,152:152}],158:[function(s,u,c){(function(a){(function(r){var e={boolean:!1,function:!0,object:!0,number:!1,string:!1,undefined:!1},n=e[typeof window]&&window||this,t=e[typeof c]&&c&&!c.nodeType&&c,i=e[typeof u]&&u&&!u.nodeType&&u,o=(i&&i.exports===t&&t,e[typeof a]&&a);!o||o.global!==o&&o.window!==o||(n=o),"function"==typeof Nr&&Nr.amd?Nr(["rx"],function(e,t){return r(n,t,e)}):"object"==typeof u&&u&&u.exports===t?u.exports=r(n,u.exports,s(159)):n.Rx=r(n,{},n.Rx)}).call(this,function(s,e,t,u){function r(){try{return f.apply(this,arguments)}catch(e){return I.e=e,I}}function n(e){if(!M(e))throw new TypeError("fn must be a function");return f=e,r}function i(e,s,u){return new g(function(n){var i=!1,o=null,a=[];return e.subscribe(function(e){var t,r;try{r=s(e)}catch(e){return void n.onError(e)}if(t=0,i)try{t=u(r,o)}catch(e){return void n.onError(e)}else i=!0,o=r;t>0&&(o=r,a=[]),t>=0&&a.push(e)},function(e){n.onError(e)},function(){n.onNext(a),n.onCompleted()})},e)}function o(e){if(0===e.length)throw new R;return e[0]}function a(e,n,i,o){if(0>n)throw new L;return new g(function(t){var r=n;return e.subscribe(function(e){0===r--&&(t.onNext(e),t.onCompleted())},function(e){t.onError(e)},function(){i?(t.onNext(o),t.onCompleted()):t.onError(new L)})},e)}function c(e,i,o){return new g(function(t){var r=o,n=!1;return e.subscribe(function(e){n?t.onError(new Error("Sequence contains more than one element")):(r=e,n=!0)},function(e){t.onError(e)},function(){n||i?(t.onNext(r),t.onCompleted()):t.onError(new R)})},e)}function h(e,r,n){return new g(function(t){return e.subscribe(function(e){t.onNext(e),t.onCompleted()},function(e){t.onError(e)},function(){r?(t.onNext(n),t.onCompleted()):t.onError(new R)})},e)}function l(e,i,o){return new g(function(t){var r=o,n=!1;return e.subscribe(function(e){r=e,n=!0},function(e){t.onError(e)},function(){n||i?(t.onNext(r),t.onCompleted()):t.onError(new R)})},e)}function p(i,e,t,o){var a=j(e,t,3);return new g(function(r){var n=0;return i.subscribe(function(e){var t;try{t=a(e,n,i)}catch(e){return void r.onError(e)}t?(r.onNext(o?n:e),r.onCompleted()):n++},function(e){r.onError(e)},function(){r.onNext(o?-1:u),r.onCompleted()})},i)}var f,d=t.Observable,v=d.prototype,m=t.CompositeDisposable,g=t.AnonymousObservable,_=t.Disposable.empty,y=(t.internals.isEqual,t.helpers),b=y.not,w=y.defaultComparer,x=y.identity,S=y.defaultSubComparer,M=y.isFunction,C=y.isPromise,E=y.isArrayLike,T=y.isIterable,O=t.internals.inherits,P=d.fromPromise,A=d.from,j=t.internals.bindCallback,R=t.EmptyError,k=t.ObservableBase,L=t.ArgumentOutOfRangeError,I={e:{}};v.aggregate=function(){var o,a,s=!1,e=this;return 2===arguments.length?(s=!0,a=arguments[0],o=arguments[1]):o=arguments[0],new g(function(t){var r,n,i;return e.subscribe(function(e){!i&&(i=!0);try{r?n=o(n,e):(n=s?o(a,e):e,r=!0)}catch(e){return t.onError(e)}},function(e){t.onError(e)},function(){i&&t.onNext(n),!i&&s&&t.onNext(a),!i&&!s&&t.onError(new R),t.onCompleted()})},e)};var N=function(i){function e(e,t,r,n){this.source=e,this.acc=t,this.hasSeed=r,this.seed=n,i.call(this)}function t(e,t){this.o=e,this.acc=t.acc,this.hasSeed=t.hasSeed,this.seed=t.seed,this.hasAccumulation=!1,this.result=null,this.hasValue=!1,this.isStopped=!1}return O(e,i),e.prototype.subscribeCore=function(e){return this.source.subscribe(new t(e,this))},t.prototype.onNext=function(e){this.isStopped||(!this.hasValue&&(this.hasValue=!0),this.hasAccumulation?this.result=n(this.acc)(this.result,e):(this.result=this.hasSeed?n(this.acc)(this.seed,e):e,this.hasAccumulation=!0),this.result===I&&this.o.onError(this.result.e))},t.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.o.onError(e))},t.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.hasValue&&this.o.onNext(this.result),!this.hasValue&&this.hasSeed&&this.o.onNext(this.seed),!this.hasValue&&!this.hasSeed&&this.o.onError(new R),this.o.onCompleted())},t.prototype.dispose=function(){this.isStopped=!0},t.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(e),!0)},e}(k);return v.reduce=function(e){var t=!1;if(2===arguments.length){t=!0;var r=arguments[1]}return new N(this,e,t,r)},v.some=function(e,t){var r=this;return e?r.filter(e,t).some():new g(function(t){return r.subscribe(function(){t.onNext(!0),t.onCompleted()},function(e){t.onError(e)},function(){t.onNext(!1),t.onCompleted()})},r)},v.any=function(){return this.some.apply(this,arguments)},v.isEmpty=function(){return this.any().map(b)},v.every=function(t,e){return this.filter(function(e){return!t(e)},e).some().map(b)},v.all=function(){return this.every.apply(this,arguments)},v.includes=function(i,e){function o(e,t){return 0===e&&0===t||e===t||isNaN(e)&&isNaN(t)}var a=this;return new g(function(t){var r=0,n=+e||0;return Math.abs(n)===1/0&&(n=0),0>n?(t.onNext(!1),t.onCompleted(),_):a.subscribe(function(e){r++>=n&&o(e,i)&&(t.onNext(!0),t.onCompleted())},function(e){t.onError(e)},function(){t.onNext(!1),t.onCompleted()})},this)},v.contains=function(e,t){v.includes(e,t)},v.count=function(e,t){return e?this.filter(e,t).count():this.reduce(function(e){return e+1},0)},v.indexOf=function(i,e){var o=this;return new g(function(t){var r=0,n=+e||0;return Math.abs(n)===1/0&&(n=0),0>n?(t.onNext(-1),t.onCompleted(),_):o.subscribe(function(e){r>=n&&e===i&&(t.onNext(r),t.onCompleted()),r++},function(e){t.onError(e)},function(){t.onNext(-1),t.onCompleted()})},o)},v.sum=function(e,t){return e&&M(e)?this.map(e,t).sum():this.reduce(function(e,t){return e+t},0)},v.minBy=function(e,r){return r||(r=S),i(this,e,function(e,t){return-1*r(e,t)})},v.min=function(e){return this.minBy(x,e).map(function(e){return o(e)})},v.maxBy=function(e,t){return t||(t=S),i(this,e,t)},v.max=function(e){return this.maxBy(x,e).map(function(e){return o(e)})},v.average=function(e,t){return e&&M(e)?this.map(e,t).average():this.reduce(function(e,t){return{sum:e.sum+t,count:e.count+1}},{sum:0,count:0}).map(function(e){if(0===e.count)throw new R;return e.sum/e.count})},v.sequenceEqual=function(r,u){var c=this;return u||(u=w),new g(function(n){var i=!1,o=!1,a=[],s=[],e=c.subscribe(function(e){var t,r;if(s.length>0){r=s.shift();try{t=u(r,e)}catch(e){return void n.onError(e)}t||(n.onNext(!1),n.onCompleted())}else o?(n.onNext(!1),n.onCompleted()):a.push(e)},function(e){n.onError(e)},function(){i=!0,0===a.length&&(s.length>0?(n.onNext(!1),n.onCompleted()):o&&(n.onNext(!0),n.onCompleted()))});(E(r)||T(r))&&(r=A(r)),C(r)&&(r=P(r));var t=r.subscribe(function(e){var t;if(a.length>0){var r=a.shift();try{t=u(r,e)}catch(e){return void n.onError(e)}t||(n.onNext(!1),n.onCompleted())}else i?(n.onNext(!1),n.onCompleted()):s.push(e)},function(e){n.onError(e)},function(){o=!0,0===s.length&&(a.length>0?(n.onNext(!1),n.onCompleted()):i&&(n.onNext(!0),n.onCompleted()))});return new m(e,t)},c)},v.elementAt=function(e){return a(this,e,!1)},v.elementAtOrDefault=function(e,t){return a(this,e,!0,t)},v.single=function(e,t){return e&&M(e)?this.where(e,t).single():c(this,!1)},v.singleOrDefault=function(e,t,r){return e&&M(e)?this.filter(e,r).singleOrDefault(null,t):c(this,!0,t)},v.first=function(e,t){return e?this.where(e,t).first():h(this,!1)},v.firstOrDefault=function(e,t,r){return e?this.where(e).firstOrDefault(null,t):h(this,!0,t)},v.last=function(e,t){return e?this.where(e,t).last():l(this,!1)},v.lastOrDefault=function(e,t,r){return e?this.where(e,r).lastOrDefault(null,t):l(this,!0,t)},v.find=function(e,t){return p(this,e,t,!1)},v.findIndex=function(e,t){return p(this,e,t,!0)},v.toSet=function(){if("undefined"==typeof s.Set)throw new TypeError;var e=this;return new g(function(t){var r=new s.Set;return e.subscribe(function(e){r.add(e)},function(e){t.onError(e)},function(){t.onNext(r),t.onCompleted()})},e)},v.toMap=function(o,a){if("undefined"==typeof s.Map)throw new TypeError;var e=this;return new g(function(n){var i=new s.Map;return e.subscribe(function(e){var t;try{t=o(e)}catch(e){return void n.onError(e)}var r=e;if(a)try{r=a(e)}catch(e){return void n.onError(e)}i.set(t,r)},function(e){n.onError(e)},function(){n.onNext(i),n.onCompleted()})},e)},t})}).call(this,"undefined"!=typeof n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{159:159}],159:[function(e,Lr,Ir){(function(Rr,kr){(function(a){function i(e){for(var t=[],r=0,n=e.length;n>r;r++)t.push(e[r]);return t}function o(e,t){if(ie&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(se)){for(var r=[],n=t;n;n=n.source)n.stack&&r.unshift(n.stack);r.unshift(e.stack);var i=r.join("\n"+se+"\n");e.stack=u(i)}}function u(e){for(var t=e.split("\n"),r=[],n=0,i=t.length;i>n;n++){var o=t[n];c(o)||h(o)||!o||r.push(o)}return r.join("\n")}function c(e){var t=l(e);if(!t)return!1;var r=t[0],n=t[1];return r===oe&&n>=ae&&jr>=n}function h(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function e(){if(ie)try{throw new Error}catch(e){var t=e.stack.split("\n"),r=t[0].indexOf("@")>0?t[1]:t[2],n=l(r);if(!n)return;return oe=n[0],n[1]}}function l(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var r=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(r)return[r[1],Number(r[2])];var n=/.*@(.+):(\d+)$/.exec(e);return n?[n[1],Number(n[2])]:void 0}function r(e){var t=[];if(!Ue(e))return t;$e.nonEnumArgs&&e.length&&Ge(e)&&(e=qe.call(e));var r=$e.enumPrototypes&&"function"==typeof e,n=$e.enumErrorProps&&(e===Ne||e instanceof Error);for(var i in e)r&&"prototype"==i||n&&("message"==i||"name"==i)||t.push(i);if($e.nonEnumShadows&&e!==De){var o=e.constructor,a=-1,s=xe;if(e===(o&&o.prototype))var u=e===Be?Re:e===Ne?Te:ke.call(e),c=ze[u];for(;++a<s;)i=we[a],c&&c[i]||!Le.call(e,i)||t.push(i)}return t}function n(e,t,r){for(var n=-1,i=r(e),o=i.length;++n<o;){var a=i[n];if(t(e[a],a,e)===!1)break}return e}function v(e,t){return n(e,t,r)}function m(e){return"function"!=typeof e.toString&&"string"==typeof(e+"")}function g(n,e,i,o){if(n===e)return 0!==n||1/n==1/e;var t=typeof n,r=typeof e;if(n===n&&(null==n||null==e||"function"!=t&&"object"!=t&&"function"!=r&&"object"!=r))return!1;var a=ke.call(n),s=ke.call(e);if(a==Se&&(a=Ae),s==Se&&(s=Ae),a!=s)return!1;switch(a){case Ce:case Ee:return+n==+e;case Pe:return n!=+n?e!=+e:0==n?1/n==1/e:n==+e;case je:case Re:return n==String(e)}var u=a==Me;if(!u){if(a!=Ae||!$e.nodeClass&&(m(n)||m(e)))return!1;var c=!$e.argsObject&&Ge(n)?Object:n.constructor,h=!$e.argsObject&&Ge(e)?Object:e.constructor;if(!(c==h||Le.call(n,"constructor")&&Le.call(e,"constructor")||ne(c)&&c instanceof c&&ne(h)&&h instanceof h||!("constructor"in n&&"constructor"in e)))return!1}i||(i=[]),o||(o=[]);for(var l=i.length;l--;)if(i[l]==n)return o[l]==e;var p=0,f=!0;if(i.push(n),o.push(e),u){if(l=n.length,p=e.length,f=p==l)for(;p--;){var d=e[p];if(!(f=g(n[p],d,i,o)))break}}else v(e,function(e,t,r){return Le.call(r,t)?(p++,f=Le.call(n,t)&&g(n[t],e,i,o)):void 0}),f&&v(n,function(e,t,r){return Le.call(r,t)?f=--p>-1:void 0});return i.pop(),o.pop(),f}function f(e,t){for(var r=new Array(e),n=0;e>n;n++)r[n]=t();return r}function t(){try{return Ve.apply(this,arguments)}catch(e){return Ke.e=e,Ke}}function p(e){if(!ne(e))throw new TypeError("fn must be a function");return Ve=e,t}function d(e){throw e}function _(e,t){this.id=e,this.value=t}function y(e,t){this.scheduler=e,this.disposable=t,this.isDisposed=!1}function b(e,t){t.isDisposed||(t.isDisposed=!0,t.disposable.dispose())}function w(e){this._s=s}function x(e){this._s=s,this._l=s.length,this._i=0}function S(e){this._a=e}function M(e){this._a=e,this._l=O(e),this._i=0}function C(e){return"number"==typeof e&&V.isFinite(e)}function E(e){var t,r=e[ve];if(!r&&"string"==typeof e)return t=new w(e),t[ve]();if(!r&&e.length!==a)return t=new S(e),t[ve]();if(!r)throw new TypeError("Object is not iterable");return e[ve]()}function T(e){var t=+e;return 0===t?t:isNaN(t)?t:0>t?-1:1}function O(e){var t=+e.length;return isNaN(t)?0:0!==t&&C(t)?(t=T(t)*Math.floor(Math.abs(t)),0>=t?0:t>Yt?Yt:t):t}function P(e,t){this.observer=e,this.parent=t}function A(e,t){return pt(e)||(e=mt),new Zt(t,e)}function j(e,t){this.observer=e,this.parent=t}function R(e,t){this.observer=e,this.parent=t}function k(t,o){return new Er(function(n){var e=new at,i=new st;return i.setDisposable(e),e.setDisposable(t.subscribe(function(e){n.onNext(e)},function(e){try{var t=o(e)}catch(e){return n.onError(e)}re(t)&&(t=Gt(t));var r=new at;i.setDisposable(r),r.setDisposable(t.subscribe(n))},function(e){n.onCompleted(e)})),i},t)}function L(){return!1}function I(a,s){var e=this;return new Er(function(n){var i=0,o=a.length;return e.subscribe(function(e){if(o>i){var t=a[i++],r=p(s)(e,t);if(r===Ke)return n.onError(r.e);n.onNext(r)}else n.onCompleted()},function(e){n.onError(e)},function(){n.onCompleted()})},e)}function L(){return!1}function N(){return[]}function L(){return!1}function D(){return[]}function B(e,t){this.observer=e,this.accumulator=t.accumulator,this.hasSeed=t.hasSeed,this.seed=t.seed,this.hasAccumulation=!1,this.accumulation=null,this.hasValue=!1,this.isStopped=!1}function F(n,e,t){var i=be(e,t,3);return n.map(function(e,t){var r=i(e,t,n);return re(r)&&(r=Gt(r)),(_e(r)||ge(r))&&(r=Kt(r)),r}).concatAll()}function z(e,t,r){for(var n=0,i=e.length;i>n;n++)if(r(e[n],t))return n;return-1}function $(e){this.comparer=e,this.set=[]}function U(n,e,t){var i=be(e,t,3);return n.map(function(e,t){var r=i(e,t,n);return re(r)&&(r=Gt(r)),(_e(r)||ge(r))&&(r=Kt(r)),r}).mergeAll()}var G={boolean:!1,function:!0,object:!0,number:!1,string:!1,undefined:!1},V=G[typeof window]&&window||this,H=G[typeof Ir]&&Ir&&!Ir.nodeType&&Ir,q=G[typeof Lr]&&Lr&&!Lr.nodeType&&Lr,W=q&&q.exports===H&&H,X=G[typeof kr]&&kr;!X||X.global!==X&&X.window!==X||(V=X);var Y={internals:{},config:{Promise:V.Promise},helpers:{}},K=Y.helpers.noop=function(){},Z=(Y.helpers.notDefined=function(e){return"undefined"==typeof e},Y.helpers.identity=function(e){return e}),J=(Y.helpers.pluck=function(t){return function(e){return e[t]}},Y.helpers.just=function(e){return function(){return e}},Y.helpers.defaultNow=Date.now),Q=Y.helpers.defaultComparer=function(e,t){return He(e,t)},ee=Y.helpers.defaultSubComparer=function(e,t){return e>t?1:t>e?-1:0},te=(Y.helpers.defaultKeySerializer=function(e){return e.toString()},Y.helpers.defaultError=function(e){throw e}),re=Y.helpers.isPromise=function(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then},ne=(Y.helpers.asArray=function(){return Array.prototype.slice.call(arguments)},Y.helpers.not=function(e){return!e},Y.helpers.isFunction=function(){var e=function(e){return"function"==typeof e||!1};return e(/x/)&&(e=function(e){return"function"==typeof e&&"[object Function]"==ke.call(e)}),e}());Y.config.longStackSupport=!1;var ie=!1;try{throw new Error}catch(e){ie=!!e.stack}var oe,ae=e(),se="From previous event:",ue=Y.EmptyError=function(){this.message="Sequence contains no elements.",Error.call(this)};ue.prototype=Error.prototype;var ce=Y.ObjectDisposedError=function(){this.message="Object has been disposed",Error.call(this)};ce.prototype=Error.prototype;var he=Y.ArgumentOutOfRangeError=function(){this.message="Argument out of range",Error.call(this)};he.prototype=Error.prototype;var le=Y.NotSupportedError=function(e){this.message=e||"This operation is not supported",Error.call(this)};le.prototype=Error.prototype;var pe=Y.NotImplementedError=function(e){this.message=e||"This operation is not implemented",Error.call(this)};pe.prototype=Error.prototype;var fe=Y.helpers.notImplemented=function(){throw new pe},de=Y.helpers.notSupported=function(){throw new le},ve="function"==typeof Symbol&&Symbol.iterator||"_es6shim_iterator_";V.Set&&"function"==typeof(new V.Set)["@@iterator"]&&(ve="@@iterator");var me=Y.doneEnumerator={done:!0,value:a},ge=Y.helpers.isIterable=function(e){return e[ve]!==a},_e=Y.helpers.isArrayLike=function(e){return e&&e.length!==a};Y.helpers.iterator=ve;var ye,be=Y.internals.bindCallback=function(n,i,e){if("undefined"==typeof i)return n;switch(e){case 0:return function(){return n.call(i)};case 1:return function(e){return n.call(i,e)};case 2:return function(e,t){return n.call(i,e,t)};case 3:return function(e,t,r){return n.call(i,e,t,r)}}return function(){return n.apply(i,arguments)}},we=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],xe=we.length,Se="[object Arguments]",Me="[object Array]",Ce="[object Boolean]",Ee="[object Date]",Te="[object Error]",Oe="[object Function]",Pe="[object Number]",Ae="[object Object]",je="[object RegExp]",Re="[object String]",ke=Object.prototype.toString,Le=Object.prototype.hasOwnProperty,Ie=ke.call(arguments)==Se,Ne=Error.prototype,De=Object.prototype,Be=String.prototype,Fe=De.propertyIsEnumerable;try{ye=!(ke.call(document)==Ae&&!({toString:0}+""))}catch(e){ye=!0}var ze={};ze[Me]=ze[Ee]=ze[Pe]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},ze[Ce]=ze[Re]={constructor:!0,toString:!0,valueOf:!0},ze[Te]=ze[Oe]=ze[je]={constructor:!0,toString:!0},ze[Ae]={constructor:!0};var $e={};!function(){var e=function(){this.x=1},t=[];e.prototype={valueOf:1,y:1};for(var r in new e)t.push(r);for(r in arguments);$e.enumErrorProps=Fe.call(Ne,"message")||Fe.call(Ne,"name"),$e.enumPrototypes=Fe.call(e,"prototype"),$e.nonEnumArgs=0!=r,$e.nonEnumShadows=!/valueOf/.test(t)}(1);var Ue=Y.internals.isObject=function(e){var t=typeof e;return e&&("function"==t||"object"==t)||!1},Ge=function(e){return e&&"object"==typeof e?ke.call(e)==Se:!1};Ie||(Ge=function(e){return e&&"object"==typeof e?Le.call(e,"callee"):!1});var Ve,He=Y.internals.isEqual=function(e,t){return g(e,t,[],[])},qe=({}.hasOwnProperty,Array.prototype.slice),We=this.inherits=Y.internals.inherits=function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r},Xe=Y.internals.addProperties=function(e){for(var t=[],r=1,n=arguments.length;n>r;r++)t.push(arguments[r]);for(var i=0,o=t.length;o>i;i++){var a=t[i];for(var s in a)e[s]=a[s]}},Ye=Y.internals.addRef=function(t,r){return new Er(function(e){return new Qe(r.getDisposable(),t.subscribe(e))})},Ke={e:{}};_.prototype.compareTo=function(e){var t=this.value.compareTo(e.value);return 0===t&&(t=this.id-e.id),t};var Ze=Y.internals.PriorityQueue=function(e){this.items=new Array(e),this.length=0},Je=Ze.prototype;Je.isHigherPriority=function(e,t){return this.items[e].compareTo(this.items[t])<0},Je.percolate=function(e){if(!(e>=this.length||0>e)){var t=e-1>>1;if(!(0>t||t===e)&&this.isHigherPriority(e,t)){var r=this.items[e];this.items[e]=this.items[t],this.items[t]=r,this.percolate(t)}}},Je.heapify=function(e){if(+e||(e=0),!(e>=this.length||0>e)){var t=2*e+1,r=2*e+2,n=e;if(t<this.length&&this.isHigherPriority(t,n)&&(n=t),r<this.length&&this.isHigherPriority(r,n)&&(n=r),n!==e){var i=this.items[e];this.items[e]=this.items[n],this.items[n]=i,this.heapify(n)}}},Je.peek=function(){return this.items[0].value},Je.removeAt=function(e){this.items[e]=this.items[--this.length],this.items[this.length]=a,this.heapify()},Je.dequeue=function(){var e=this.peek();return this.removeAt(0),e},Je.enqueue=function(e){var t=this.length++;this.items[t]=new _(Ze.count++,e),this.percolate(t)},Je.remove=function(e){for(var t=0;t<this.length;t++)if(this.items[t].value===e)return this.removeAt(t),!0;return!1},Ze.count=0;var Qe=Y.CompositeDisposable=function(){var e,t,r=[];if(Array.isArray(arguments[0]))r=arguments[0],t=r.length;else for(t=arguments.length,r=new Array(t),e=0;t>e;e++)r[e]=arguments[e];for(e=0;t>e;e++)if(!it(r[e]))throw new TypeError("Not a disposable");this.disposables=r,this.isDisposed=!1,this.length=r.length},et=Qe.prototype;et.add=function(e){this.isDisposed?e.dispose():(this.disposables.push(e),this.length++)},et.remove=function(e){var t=!1;if(!this.isDisposed){var r=this.disposables.indexOf(e);-1!==r&&(t=!0,this.disposables.splice(r,1),this.length--,e.dispose())}return t},et.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;for(var e=this.disposables.length,t=new Array(e),r=0;e>r;r++)t[r]=this.disposables[r];for(this.disposables=[],this.length=0,r=0;e>r;r++)t[r].dispose()}};var tt=Y.Disposable=function(e){this.isDisposed=!1,this.action=e||K};tt.prototype.dispose=function(){this.isDisposed||(this.action(),this.isDisposed=!0)};var rt=tt.create=function(e){return new tt(e)},nt=tt.empty={dispose:K},it=tt.isDisposable=function(e){return e&&ne(e.dispose)},ot=tt.checkDisposed=function(e){if(e.isDisposed)throw new ce},at=Y.SingleAssignmentDisposable=function(){this.isDisposed=!1,this.current=null};at.prototype.getDisposable=function(){return this.current},at.prototype.setDisposable=function(e){if(this.current)throw new Error("Disposable has already been assigned");var t=this.isDisposed;!t&&(this.current=e),t&&e&&e.dispose()},at.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var e=this.current;this.current=null}e&&e.dispose()};var st=Y.SerialDisposable=function(){this.isDisposed=!1,this.current=null};st.prototype.getDisposable=function(){return this.current},st.prototype.setDisposable=function(e){var t=this.isDisposed;if(!t){var r=this.current;this.current=e}r&&r.dispose(),t&&e&&e.dispose()},st.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var e=this.current;this.current=null}e&&e.dispose()};var ut=Y.RefCountDisposable=function(){function e(e){this.disposable=e,this.disposable.count++,this.isInnerDisposed=!1}function t(e){this.underlyingDisposable=e,this.isDisposed=!1,this.isPrimaryDisposed=!1,this.count=0}return e.prototype.dispose=function(){this.disposable.isDisposed||this.isInnerDisposed||(this.isInnerDisposed=!0,this.disposable.count--,0===this.disposable.count&&this.disposable.isPrimaryDisposed&&(this.disposable.isDisposed=!0,this.disposable.underlyingDisposable.dispose()))},t.prototype.dispose=function(){this.isDisposed||this.isPrimaryDisposed||(this.isPrimaryDisposed=!0,0===this.count&&(this.isDisposed=!0,this.underlyingDisposable.dispose()))},t.prototype.getDisposable=function(){return this.isDisposed?nt:new e(this)},t}();y.prototype.dispose=function(){this.scheduler.scheduleWithState(this,b)};var ct=Y.internals.ScheduledItem=function(e,t,r,n,i){this.scheduler=e,this.state=t,this.action=r,this.dueTime=n,this.comparer=i||ee,this.disposable=new at};ct.prototype.invoke=function(){this.disposable.setDisposable(this.invokeCore())},ct.prototype.compareTo=function(e){return this.comparer(this.dueTime,e.dueTime)},ct.prototype.isCancelled=function(){return this.disposable.isDisposed},ct.prototype.invokeCore=function(){return this.action(this.scheduler,this.state)};var ht=Y.Scheduler=function(){function t(e,t,r,n){this.now=e,this._schedule=t,this._scheduleRelative=r,this._scheduleAbsolute=n}function r(e,t){return t(),nt}t.isScheduler=function(e){return e instanceof t};var e=t.prototype;return e.schedule=function(e){return this._schedule(e,r)},e.scheduleWithState=function(e,t){return this._schedule(e,t)},e.scheduleWithRelative=function(e,t){return this._scheduleRelative(t,e,r)},e.scheduleWithRelativeAndState=function(e,t,r){return this._scheduleRelative(e,t,r)},e.scheduleWithAbsolute=function(e,t){return this._scheduleAbsolute(t,e,r)},e.scheduleWithAbsoluteAndState=function(e,t,r){return this._scheduleAbsolute(e,t,r)},t.now=J,t.normalize=function(e){return 0>e&&(e=0),e},t}(),lt=ht.normalize,pt=ht.isScheduler;!function(e){function r(t,e){function o(e){n(e,function(e){var r=!1,n=!1,i=t.scheduleWithState(e,function(e,t){return r?a.remove(i):n=!0,o(t),nt});n||(a.add(i),r=!0)})}var r=e[0],n=e[1],a=new Qe;return o(r),a}function n(o,e,a){function s(e){r(e,function(e,t){var r=!1,n=!1,i=o[a](e,t,function(e,t){return r?u.remove(i):n=!0,s(t),nt});n||(u.add(i),r=!0)})}var t=e[0],r=e[1],u=new Qe;return s(t),u}function i(t,r){t(function(e){r(t,e)})}e.scheduleRecursive=function(e){return this.scheduleRecursiveWithState(e,i)},e.scheduleRecursiveWithState=function(e,t){return this.scheduleWithState([e,t],r)},e.scheduleRecursiveWithRelative=function(e,t){return this.scheduleRecursiveWithRelativeAndState(t,e,i)},e.scheduleRecursiveWithRelativeAndState=function(e,t,r){return this._scheduleRelative([e,r],t,function(e,t){return n(e,t,"scheduleWithRelativeAndState")})},e.scheduleRecursiveWithAbsolute=function(e,t){return this.scheduleRecursiveWithAbsoluteAndState(t,e,i)},e.scheduleRecursiveWithAbsoluteAndState=function(e,t,r){return this._scheduleAbsolute([e,r],t,function(e,t){return n(e,t,"scheduleWithAbsoluteAndState")})}}(ht.prototype),function(e){ht.prototype.schedulePeriodic=function(e,t){return this.schedulePeriodicWithState(null,e,t)},ht.prototype.schedulePeriodicWithState=function(e,t,r){if("undefined"==typeof V.setInterval)throw new le;t=lt(t);var n=e,i=V.setInterval(function(){n=r(n)},t);return rt(function(){V.clearInterval(i)})}}(ht.prototype),function(e){e.catchError=e["catch"]=function(e){return new bt(this,e)}}(ht.prototype);var ft,dt,vt=(Y.internals.SchedulePeriodicRecursive=function(){function t(e,t){t(0,this._period);try{this._state=this._action(this._state)}catch(e){throw this._cancel.dispose(),e}}function e(e,t,r,n){this._scheduler=e,this._state=t,this._period=r,this._action=n}return e.prototype.start=function(){var e=new at;return this._cancel=e,e.setDisposable(this._scheduler.scheduleRecursiveWithRelativeAndState(0,this._period,t.bind(this))),e},e}(),ht.immediate=function(){function e(e,t){return t(this,e)}return new ht(J,e,de,de)}()),mt=ht.currentThread=function(){function i(){for(;o.length>0;){var e=o.dequeue();!e.isCancelled()&&e.invoke()}}function e(e,t){var r=new ct(this,e,t,this.now());if(o)o.enqueue(r);else{o=new Ze(4),o.enqueue(r);var n=p(i)();if(o=null,n===Ke)return d(n.e)}return r.disposable}var o,t=new ht(J,e,de,de);return t.scheduleRequired=function(){return!o},t}(),gt=function(){var e,t=K;if(V.setTimeout)e=V.setTimeout,t=V.clearTimeout;else{if(!V.WScript)throw new le;e=function(e,t){V.WScript.Sleep(t),e()}}return{setTimeout:e,clearTimeout:t}}(),_t=gt.setTimeout,yt=gt.clearTimeout;!function(){function n(e){if(a)_t(function(){n(e)},0);else{var t=o[e];if(t){a=!0;var r=p(t)();if(dt(e),a=!1,r===Ke)return d(r.e)}}}function e(){if(!V.postMessage||V.importScripts)return!1;var e=!1,t=V.onmessage;return V.onmessage=function(){e=!0},V.postMessage("","*"),V.onmessage=t,e}function t(e){"string"==typeof e.data&&e.data.substring(0,u.length)===u&&n(e.data.substring(u.length))}var i=1,o={},a=!1;dt=function(e){delete o[e]};var r=RegExp("^"+String(ke).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),s="function"==typeof(s=X&&W&&X.setImmediate)&&!r.test(s)&&s;if(ne(s))ft=function(e){var t=i++;return o[t]=e,s(function(){n(t)}),t};else if("undefined"!=typeof Rr&&"[object process]"==={}.toString.call(Rr))ft=function(e){var t=i++;return o[t]=e,Rr.nextTick(function(){n(t)}),t};else if(e()){var u="ms.rx.schedule"+Math.random();V.addEventListener?V.addEventListener("message",t,!1):V.attachEvent?V.attachEvent("onmessage",t):V.onmessage=t,ft=function(e){var t=i++;return o[t]=e,V.postMessage(u+currentId,"*"),t}}else if(V.MessageChannel){var c=new V.MessageChannel;c.port1.onmessage=function(e){n(e.data)},ft=function(e){var t=i++;return o[t]=e,c.port2.postMessage(t),t}}else ft="document"in V&&"onreadystatechange"in V.document.createElement("script")?function(e){var t=V.document.createElement("script"),r=i++;return o[r]=e,t.onreadystatechange=function(){n(r),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},V.document.documentElement.appendChild(t),r}:function(e){var t=i++;return o[t]=e,_t(function(){n(t)},0),t}}();var bt=(ht.timeout=ht["default"]=function(){function e(e,t){var r=this,n=new at,i=ft(function(){!n.isDisposed&&n.setDisposable(t(r,e))});return new Qe(n,rt(function(){dt(i)}))}function t(e,t,r){var n=this,i=ht.normalize(t),o=new at;if(0===i)return n.scheduleWithState(e,r);var a=_t(function(){!o.isDisposed&&o.setDisposable(r(n,e))},i);return new Qe(o,rt(function(){yt(a)}))}function r(e,t,r){return this.scheduleWithRelativeAndState(e,t-this.now(),r)}return new ht(J,e,t,r)}(),function(r){function n(e,t){return this._scheduler.scheduleWithState(e,this._wrap(t))}function i(e,t,r){return this._scheduler.scheduleWithRelativeAndState(e,t,this._wrap(r))}function o(e,t,r){return this._scheduler.scheduleWithAbsoluteAndState(e,t,this._wrap(r))}function t(e,t){this._scheduler=e,this._handler=t,this._recursiveOriginal=null,this._recursiveWrapper=null,r.call(this,this._scheduler.now.bind(this._scheduler),n,i,o)}return We(t,r),t.prototype._clone=function(e){return new t(e,this._handler)},t.prototype._wrap=function(r){var n=this;return function(e,t){try{return r(n._getRecursiveWrapper(e),t)}catch(e){if(!n._handler(e))throw e;return nt}}},t.prototype._getRecursiveWrapper=function(e){if(this._recursiveOriginal!==e){this._recursiveOriginal=e;var t=this._clone(e);t._recursiveOriginal=e,t._recursiveWrapper=t,this._recursiveWrapper=t}return this._recursiveWrapper},t.prototype.schedulePeriodicWithState=function(e,t,r){var n=this,i=!1,o=new at;return o.setDisposable(this._scheduler.schedulePeriodicWithState(e,t,function(e){if(i)return null;try{return r(e)}catch(e){if(i=!0,!n._handler(e))throw e;return o.dispose(),null}})),o},t}(ht)),wt=Y.Notification=function(){function e(e,t,r,n,i,o){this.kind=e,this.value=t,this.exception=r,this._accept=n,this._acceptObservable=i,this.toString=o}return e.prototype.accept=function(e,t,r){return e&&"object"==typeof e?this._acceptObservable(e):this._accept(e,t,r)},e.prototype.toObservable=function(e){var t=this;return pt(e)||(e=vt),new Er(function(r){return e.scheduleWithState(t,function(e,t){t._acceptObservable(r),"N"===t.kind&&r.onCompleted()})})},e}(),xt=wt.createOnNext=function(){function t(e){return e(this.value)}function r(e){return e.onNext(this.value)}function n(){return"OnNext("+this.value+")"}return function(e){return new wt("N",e,null,t,r,n)}}(),St=wt.createOnError=function(){function t(e,t){return t(this.exception)}function r(e){return e.onError(this.exception)}function n(){return"OnError("+this.exception+")"}return function(e){return new wt("E",null,e,t,r,n)}}(),Mt=wt.createOnCompleted=function(){function e(e,t,r){return r()}function t(e){return e.onCompleted()}function r(){return"OnCompleted()"}return function(){return new wt("C",null,null,e,t,r)}}(),Ct=Y.Observer=function(){};Ct.prototype.toNotifier=function(){var t=this;return function(e){return e.accept(t)}},Ct.prototype.asObserver=function(){return new Pt(this.onNext.bind(this),this.onError.bind(this),this.onCompleted.bind(this))},Ct.prototype.checked=function(){return new At(this)};var Et=Ct.create=function(e,t,r){return e||(e=K),t||(t=te),r||(r=K),new Pt(e,t,r)};Ct.fromNotifier=function(t,r){return new Pt(function(e){return t.call(r,xt(e))},function(e){return t.call(r,St(e))},function(){return t.call(r,Mt())})},Ct.prototype.notifyOn=function(e){return new Rt(e,this)},Ct.prototype.makeSafe=function(e){return new AnonymousSafeObserver(this._onNext,this._onError,this._onCompleted,e)};var Tt,Ot=Y.internals.AbstractObserver=function(e){function t(){this.isStopped=!1,e.call(this)}return We(t,e),t.prototype.next=fe,t.prototype.error=fe,t.prototype.completed=fe,t.prototype.onNext=function(e){this.isStopped||this.next(e)},t.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.error(e))},t.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.completed())},t.prototype.dispose=function(){this.isStopped=!0},t.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.error(e),!0)},t}(Ct),Pt=Y.AnonymousObserver=function(n){function e(e,t,r){n.call(this),this._onNext=e,this._onError=t,this._onCompleted=r}return We(e,n),e.prototype.next=function(e){this._onNext(e)},e.prototype.error=function(e){this._onError(e)},e.prototype.completed=function(){this._onCompleted()},e}(Ot),At=function(t){function e(e){t.call(this),this._observer=e,this._state=0}We(e,t);var r=e.prototype;return r.onNext=function(e){this.checkAccess();var t=p(this._observer.onNext).call(this._observer,e);this._state=0,t===Ke&&d(t.e)},r.onError=function(e){this.checkAccess();var t=p(this._observer.onError).call(this._observer,e);this._state=2,t===Ke&&d(t.e)},r.onCompleted=function(){this.checkAccess();var e=p(this._observer.onCompleted).call(this._observer);this._state=2,e===Ke&&d(e.e)},r.checkAccess=function(){if(1===this._state)throw new Error("Re-entrancy detected");if(2===this._state)throw new Error("Observer completed");0===this._state&&(this._state=1)},e}(Ct),jt=Y.internals.ScheduledObserver=function(r){function e(e,t){r.call(this),this.scheduler=e,this.observer=t,this.isAcquired=!1,this.hasFaulted=!1,this.queue=[],this.disposable=new st}return We(e,r),e.prototype.next=function(e){var t=this;this.queue.push(function(){t.observer.onNext(e)})},e.prototype.error=function(e){var t=this;this.queue.push(function(){t.observer.onError(e)})},e.prototype.completed=function(){var e=this;this.queue.push(function(){e.observer.onCompleted()})},e.prototype.ensureActive=function(){var e=!1,r=this;!this.hasFaulted&&this.queue.length>0&&(e=!this.isAcquired,this.isAcquired=!0),e&&this.disposable.setDisposable(this.scheduler.scheduleRecursive(function(e){var t;if(!(r.queue.length>0))return void(r.isAcquired=!1);t=r.queue.shift();try{t()}catch(e){throw r.queue=[],r.hasFaulted=!0,e}e()}))},e.prototype.dispose=function(){r.prototype.dispose.call(this),this.disposable.dispose()},e}(Ot),Rt=function(n){function e(e,t,r){n.call(this,e,t),this._cancel=r}return We(e,n),e.prototype.next=function(e){n.prototype.next.call(this,e),this.ensureActive()},e.prototype.error=function(e){n.prototype.error.call(this,e),this.ensureActive()},e.prototype.completed=function(){n.prototype.completed.call(this),this.ensureActive()},e.prototype.dispose=function(){n.prototype.dispose.call(this),this._cancel&&this._cancel.dispose(),this._cancel=null},e}(jt),kt=Y.Observable=function(){function e(r){if(Y.config.longStackSupport&&ie){try{throw new Error}catch(e){this.stack=e.stack.substring(e.stack.indexOf("\n")+1)}var n=this;this._subscribe=function(e){var t=e.onError.bind(e);return e.onError=function(e){o(e,n),t(e)},r.call(n,e)}}else this._subscribe=r}return Tt=e.prototype,Tt.subscribe=Tt.forEach=function(e,t,r){return this._subscribe("object"==typeof e?e:Et(e,t,r))},Tt.subscribeOnNext=function(t,r){return this._subscribe(Et("undefined"!=typeof r?function(e){t.call(r,e)}:t))},Tt.subscribeOnError=function(t,r){return this._subscribe(Et(null,"undefined"!=typeof r?function(e){t.call(r,e)}:t))},Tt.subscribeOnCompleted=function(e,t){return this._subscribe(Et(null,null,"undefined"!=typeof t?function(){e.call(t)}:e))},e}(),Lt=Y.ObservableBase=function(e){function o(e){return e&&ne(e.dispose)?e:ne(e)?rt(e):nt}function n(e,t){var r=t[0],n=t[1],i=p(n.subscribeCore).call(n,r);return i!==Ke||r.fail(Ke.e)?void r.setDisposable(o(i)):d(Ke.e)}function t(e){var t=new Tr(e),r=[t,this];return mt.scheduleRequired()?mt.scheduleWithState(r,n):n(null,r),t}function r(){e.call(this,t)}return We(r,e),r.prototype.subscribeCore=fe,r}(kt),It=Y.internals.Enumerable=function(){},Nt=function(t){function e(e){this.sources=e,t.call(this)}function u(e,t,r){this.o=e,this.s=t,this.e=r,this.isStopped=!1}return We(e,t),e.prototype.subscribeCore=function(o){var a,s=new st,e=vt.scheduleRecursiveWithState(this.sources[ve](),function(e,t){if(!a){var r=p(e.next).call(e);if(r===Ke)return o.onError(r.e);if(r.done)return o.onCompleted();var n=r.value;re(n)&&(n=Gt(n));var i=new at;s.setDisposable(i),i.setDisposable(n.subscribe(new u(o,t,e)))}});return new Qe(s,e,rt(function(){a=!0}))},u.prototype.onNext=function(e){this.isStopped||this.o.onNext(e)},u.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.o.onError(e))},u.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.s(this.e))},u.prototype.dispose=function(){this.isStopped=!0},u.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(e),!0)},e}(Lt);It.prototype.concat=function(){return new Nt(this)};var Dt=function(t){function e(e){this.sources=e,t.call(this)}return We(e,t),e.prototype.subscribeCore=function(o){var a,s=this.sources[ve](),u=new st,e=vt.scheduleRecursiveWithState(null,function(e,t){if(!a){var r=p(s.next).call(s);if(r===Ke)return o.onError(r.e);if(r.done)return null!==e?o.onError(e):o.onCompleted();var n=r.value;re(n)&&(n=Gt(n));var i=new at;u.setDisposable(i),i.setDisposable(n.subscribe(function(e){o.onNext(e)},t,function(){o.onCompleted()}))}});return new Qe(u,e,rt(function(){a=!0}))},e}(Lt);It.prototype.catchError=function(){return new Dt(this)},It.prototype.catchErrorWhen=function(n){var i=this;return new Er(function(o){var a,s,u=new Pr,c=new Pr,e=n(u),t=e.subscribe(c),h=i[ve](),l=new st,r=vt.scheduleRecursive(function(t){if(!a){var e=p(h.next).call(h);if(e===Ke)return o.onError(e.e);if(e.done)return void(s?o.onError(s):o.onCompleted());var r=e.value;re(r)&&(r=Gt(r));var n=new at,i=new at;l.setDisposable(new Qe(i,n)),n.setDisposable(r.subscribe(function(e){o.onNext(e)},function(e){i.setDisposable(c.subscribe(t,function(e){o.onError(e)},function(){o.onCompleted()})),u.onNext(e)},function(){o.onCompleted()}))}});return new Qe(t,l,r,rt(function(){a=!0}))})};var Bt=function(e){function t(e,t){this.v=e,this.c=null==t?-1:t}function r(e){this.v=e.v,this.l=e.c}return We(t,e),t.prototype[ve]=function(){return new r(this)},r.prototype.next=function(){return 0===this.l?me:(this.l>0&&this.l--,{done:!1,value:this.v})},t}(It),Ft=It.repeat=function(e,t){return new Bt(e,t)},zt=function(e){function t(e,t,r){this.s=e,this.fn=t?be(t,r,3):null}function r(e){this.i=-1,this.s=e.s,this.l=this.s.length,this.fn=e.fn}return We(t,e),t.prototype[ve]=function(){return new r(this)},r.prototype.next=function(){return++this.i<this.l?{done:!1,value:this.fn?this.fn(this.s[this.i],this.i,this.s):this.s[this.i]}:me},t}(It),$t=It.of=function(e,t,r){return new zt(e,t,r)};Tt.observeOn=function(t){var r=this;return new Er(function(e){return r.subscribe(new Rt(t,e))},r)},Tt.subscribeOn=function(n){var i=this;return new Er(function(e){var t=new at,r=new st;return r.setDisposable(t),t.setDisposable(n.schedule(function(){r.setDisposable(new y(n,i.subscribe(e)))})),r},i)};var Ut=function(t){function e(e){this.p=e,t.call(this)}return We(e,t),e.prototype.subscribeCore=function(t){return this.p.then(function(e){t.onNext(e),t.onCompleted()},function(e){t.onError(e)}),nt},e}(Lt),Gt=kt.fromPromise=function(e){return new Ut(e)};Tt.toPromise=function(e){if(e||(e=Y.config.Promise),!e)throw new le("Promise type not provided nor in Rx.config.Promise");var i=this;return new e(function(e,t){var r,n=!1;i.subscribe(function(e){r=e,n=!0},t,function(){n&&e(r)})})};var Vt=function(t){function e(e){this.source=e,t.call(this)}function r(e){this.o=e,this.a=[],this.isStopped=!1}return We(e,t),e.prototype.subscribeCore=function(e){return this.source.subscribe(new r(e))},r.prototype.onNext=function(e){this.isStopped||this.a.push(e)},r.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.o.onError(e))},r.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onNext(this.a),this.o.onCompleted())},r.prototype.dispose=function(){this.isStopped=!0},r.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(e),!0)},e}(Lt);Tt.toArray=function(){return new Vt(this)},kt.create=kt.createWithDisposable=function(e,t){return new Er(e,t)};var Ht=(kt.defer=function(r){return new Er(function(t){var e;try{e=r()}catch(e){return sr(e).subscribe(t)}return re(e)&&(e=Gt(e)),e.subscribe(t)})},function(t){function e(e){this.scheduler=e,t.call(this)}function r(e,t){this.observer=e,this.parent=t}function n(e,t){t.onCompleted()}return We(e,t),e.prototype.subscribeCore=function(e){var t=new r(e,this);return t.run()},r.prototype.run=function(){return this.parent.scheduler.scheduleWithState(this.observer,n)},e}(Lt)),qt=kt.empty=function(e){return pt(e)||(e=vt),new Ht(e)},Wt=function(n){function e(e,t,r){this.iterable=e,this.mapper=t,this.scheduler=r,n.call(this)}return We(e,n),e.prototype.subscribeCore=function(e){var t=new Xt(e,this);return t.run()},e}(Lt),Xt=function(){function e(e,t){this.observer=e,this.parent=t}return e.prototype.run=function(){function e(e,t){try{var r=i.next()}catch(e){return o.onError(e)}if(r.done)return o.onCompleted();var n=r.value;if(a)try{n=a(n,e)}catch(e){return o.onError(e)}o.onNext(n),t(e+1)}var t=Object(this.parent.iterable),i=E(t),o=this.observer,a=this.parent.mapper;return this.parent.scheduler.scheduleRecursiveWithState(0,e)},e}(),Yt=Math.pow(2,53)-1;w.prototype[ve]=function(){return new x(this._s)},x.prototype[ve]=function(){return this},x.prototype.next=function(){return this._i<this._l?{done:!1,value:this._s.charAt(this._i++)}:me},S.prototype[ve]=function(){return new M(this._a)},M.prototype[ve]=function(){return this},M.prototype.next=function(){return this._i<this._l?{done:!1,value:this._a[this._i++]}:me};var Kt=kt.from=function(e,t,r,n){if(null==e)throw new Error("iterable cannot be null.");if(t&&!ne(t))throw new Error("mapFn when provided must be a function");if(t)var i=be(t,r,2);return pt(n)||(n=mt),new Wt(e,i,n)},Zt=function(r){function e(e,t){this.args=e,this.scheduler=t,r.call(this)}return We(e,r),e.prototype.subscribeCore=function(e){var t=new P(e,this);return t.run()},e}(Lt);P.prototype.run=function(){function e(e,t){i>e?(r.onNext(n[e]),t(e+1)):r.onCompleted()}var r=this.observer,n=this.parent.args,i=n.length;return this.parent.scheduler.scheduleRecursiveWithState(0,e)};var Jt=kt.fromArray=function(e,t){return pt(t)||(t=mt),new Zt(e,t)};kt.generate=function(e,a,s,u,t){return pt(t)||(t=mt),new Er(function(i){var o=!0;return t.scheduleRecursiveWithState(e,function(e,t){var r,n;try{o?o=!1:e=s(e),r=a(e),r&&(n=u(e))}catch(e){return i.onError(e)}r?(i.onNext(n),t(e)):i.onCompleted()})})};var Qt=function(e){function t(){e.call(this)}return We(t,e),t.prototype.subscribeCore=function(e){return nt},t}(Lt),er=kt.never=function(){return new Qt};kt.of=function(){for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];return new Zt(t,mt)},kt.ofWithScheduler=function(e){for(var t=arguments.length,r=new Array(t-1),n=1;t>n;n++)r[n-1]=arguments[n];return new Zt(r,e)};var tr=function(r){function e(e,t){this.obj=e,this.keys=Object.keys(e),this.scheduler=t,r.call(this)}return We(e,r),e.prototype.subscribeCore=function(e){var t=new j(e,this);return t.run()},e}(Lt);j.prototype.run=function(){function e(e,t){if(a>e){var r=o[e];n.onNext([r,i[r]]),t(e+1)}else n.onCompleted()}var n=this.observer,i=this.parent.obj,o=this.parent.keys,a=o.length;return this.parent.scheduler.scheduleRecursiveWithState(0,e)},kt.pairs=function(e,t){return t||(t=mt),new tr(e,t)};var rr=function(n){function e(e,t,r){this.start=e,this.rangeCount=t,this.scheduler=r,n.call(this)}return We(e,n),e.prototype.subscribeCore=function(e){var t=new nr(e,this);return t.run()},e}(Lt),nr=function(){function e(e,t){this.observer=e,this.parent=t}return e.prototype.run=function(){function e(e,t){n>e?(i.onNext(r+e),t(e+1)):i.onCompleted()}var r=this.parent.start,n=this.parent.rangeCount,i=this.observer;return this.parent.scheduler.scheduleRecursiveWithState(0,e)},e}();kt.range=function(e,t,r){return pt(r)||(r=mt),new rr(e,t,r)};var ir=function(n){function e(e,t,r){this.value=e,this.repeatCount=null==t?-1:t,this.scheduler=r,n.call(this)}return We(e,n),e.prototype.subscribeCore=function(e){var t=new R(e,this);return t.run()},e}(Lt);R.prototype.run=function(){function e(e,t){return(-1===e||e>0)&&(r.onNext(n),e>0&&e--),0===e?r.onCompleted():void t(e)}var r=this.observer,n=this.parent.value;return this.parent.scheduler.scheduleRecursiveWithState(this.parent.repeatCount,e)},kt.repeat=function(e,t,r){return pt(r)||(r=mt),new ir(e,t,r)};var or=function(r){function e(e,t){this.value=e,this.scheduler=t,r.call(this)}function n(e,t){this.observer=e,this.parent=t}function t(e,t){var r=t[0],n=t[1];n.onNext(r),n.onCompleted()}return We(e,r),e.prototype.subscribeCore=function(e){var t=new n(e,this);return t.run()},n.prototype.run=function(){return this.parent.scheduler.scheduleWithState([this.parent.value,this.observer],t)},e}(Lt),ar=(kt["return"]=kt.just=kt.returnValue=function(e,t){return pt(t)||(t=vt),new or(e,t)},function(r){function e(e,t){this.error=e,this.scheduler=t,r.call(this)}function n(e,t){this.o=e,this.p=t}function t(e,t){var r=t[0],n=t[1];n.onError(r)}return We(e,r),e.prototype.subscribeCore=function(e){var t=new n(e,this);return t.run()},n.prototype.run=function(){return this.p.scheduler.scheduleWithState([this.p.error,this.o],t)},e}(Lt)),sr=kt["throw"]=kt.throwError=kt.throwException=function(e,t){return pt(t)||(t=vt),new ar(e,t)};kt.using=function(i,o){return new Er(function(t){var e,r,n=nt;try{e=i(),e&&(n=e),r=o(e)}catch(e){return new Qe(sr(e).subscribe(t),n)}return new Qe(r.subscribe(t),n)})},Tt.amb=function(u){var c=this;return new Er(function(t){function r(){i||(i=o,s.dispose())}function n(){i||(i=a,e.dispose())}var i,o="L",a="R",e=new at,s=new at;return re(u)&&(u=Gt(u)),e.setDisposable(c.subscribe(function(e){r(),i===o&&t.onNext(e)},function(e){r(),i===o&&t.onError(e)},function(){r(),i===o&&t.onCompleted()})),s.setDisposable(u.subscribe(function(e){n(),i===a&&t.onNext(e)},function(e){n(),i===a&&t.onError(e)},function(){n(),i===a&&t.onCompleted()})),new Qe(e,s)})},kt.amb=function(){function e(e,t){return e.amb(t)}var t=er(),r=[];if(Array.isArray(arguments[0]))r=arguments[0];else for(var n=0,i=arguments.length;i>n;n++)r.push(arguments[n]);for(var n=0,i=r.length;i>n;n++)t=e(t,r[n]);return t},Tt["catch"]=Tt.catchError=Tt.catchException=function(e){return"function"==typeof e?k(this,e):ur([this,e])};var ur=kt.catchError=kt["catch"]=kt.catchException=function(){var e=[];if(Array.isArray(arguments[0]))e=arguments[0];else for(var t=0,r=arguments.length;r>t;t++)e.push(arguments[t]);return $t(e).catchError()};Tt.combineLatest=function(){for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];return Array.isArray(t[0])?t[0].unshift(this):t.unshift(this),cr.apply(this,t)};var cr=kt.combineLatest=function(){for(var e=arguments.length,l=new Array(e),t=0;e>t;t++)l[t]=arguments[t];var p=l.pop();return Array.isArray(l[0])&&(l=l[0]),new Er(function(n){function i(r){if(a[r]=!0,s||(s=a.every(Z))){try{var e=p.apply(null,c)}catch(e){return n.onError(e)}n.onNext(e)}else u.filter(function(e,t){return t!==r}).every(Z)&&n.onCompleted()}function o(e){u[e]=!0,u.every(Z)&&n.onCompleted()}for(var e=l.length,t=function(){return!1},a=f(e,t),s=!1,u=f(e,t),c=new Array(e),h=new Array(e),r=0;e>r;r++)!function(t){var e=l[t],r=new at;re(e)&&(e=Gt(e)),r.setDisposable(e.subscribe(function(e){c[t]=e,i(t)},function(e){n.onError(e)},function(){o(t)})),h[t]=r}(r);return new Qe(h)},this)};Tt.concat=function(){for(var e=[],t=0,r=arguments.length;r>t;t++)e.push(arguments[t]);return e.unshift(this),lr.apply(null,e)};var hr=function(t){function e(e){this.sources=e,t.call(this)}function r(e,t){this.sources=e,this.o=t}return We(e,t),e.prototype.subscribeCore=function(e){var t=new r(this.sources,e);return t.run()},r.prototype.run=function(){var i,o=new st,a=this.sources,s=a.length,u=this.o,e=vt.scheduleRecursiveWithState(0,function(e,t){if(!i){if(e===s)return u.onCompleted();var r=a[e];re(r)&&(r=Gt(r));var n=new at;o.setDisposable(n),n.setDisposable(r.subscribe(function(e){u.onNext(e)},function(e){u.onError(e)},function(){t(e+1)}))}});return new Qe(o,e,rt(function(){i=!0}))},e}(Lt),lr=kt.concat=function(){var e;if(Array.isArray(arguments[0]))e=arguments[0];else{e=new Array(arguments.length);for(var t=0,r=arguments.length;r>t;t++)e[t]=arguments[t]}return new hr(e)};Tt.concatAll=Tt.concatObservable=function(){return this.merge(1)};var pr=function(r){function e(e,t){this.source=e,this.maxConcurrent=t,r.call(this)}return We(e,r),e.prototype.subscribeCore=function(e){var t=new Qe;return t.add(this.source.subscribe(new fr(e,this.maxConcurrent,t))),t},e}(Lt),fr=function(){function e(e,t,r){this.o=e,this.max=t,this.g=r,this.done=!1,this.q=[],this.activeCount=0,this.isStopped=!1}function r(e,t){this.parent=e,this.sad=t,this.isStopped=!1}return e.prototype.handleSubscribe=function(e){var t=new at;this.g.add(t),re(e)&&(e=Gt(e)),t.setDisposable(e.subscribe(new r(this,t)))},e.prototype.onNext=function(e){this.isStopped||(this.activeCount<this.max?(this.activeCount++,this.handleSubscribe(e)):this.q.push(e))},e.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.o.onError(e))},e.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.done=!0,0===this.activeCount&&this.o.onCompleted())},e.prototype.dispose=function(){this.isStopped=!0},e.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(e),!0)},r.prototype.onNext=function(e){this.isStopped||this.parent.o.onNext(e)},r.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.parent.o.onError(e))},r.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=!0;var e=this.parent;e.g.remove(this.sad),e.q.length>0?e.handleSubscribe(e.q.shift()):(e.activeCount--,e.done&&0===e.activeCount&&e.o.onCompleted())}},r.prototype.dispose=function(){this.isStopped=!0},r.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.parent.o.onError(e),!0)},e}();Tt.merge=function(e){return"number"!=typeof e?dr(this,e):new pr(this,e)};var dr=kt.merge=function(){var e,t,r=[],n=arguments.length;if(arguments[0])if(pt(arguments[0]))for(e=arguments[0],t=1;n>t;t++)r.push(arguments[t]);else for(e=vt,t=0;n>t;t++)r.push(arguments[t]);else for(e=vt,t=1;n>t;t++)r.push(arguments[t]);return Array.isArray(r[0])&&(r=r[0]),A(e,r).mergeAll()},vr=Y.CompositeError=function(e){this.name="NotImplementedError",this.innerErrors=e,this.message="This contains multiple errors. Check the innerErrors",Error.call(this)};vr.prototype=Error.prototype,kt.mergeDelayError=function(){var e;if(Array.isArray(arguments[0]))e=arguments[0];else{var t=arguments.length;e=new Array(t);for(var r=0;t>r;r++)e[r]=arguments[r]}var s=A(null,e);return new Er(function(r){function n(){0===a.length?r.onCompleted():1===a.length?r.onError(a[0]):r.onError(new vr(a))}var i=new Qe,e=new at,o=!1,a=[];return i.add(e),e.setDisposable(s.subscribe(function(e){var t=new at;i.add(t),re(e)&&(e=Gt(e)),t.setDisposable(e.subscribe(function(e){r.onNext(e)},function(e){a.push(e),i.remove(t),o&&1===i.length&&n()},function(){i.remove(t),o&&1===i.length&&n()}))},function(e){a.push(e),o=!0,1===i.length&&n()},function(){o=!0,1===i.length&&n()})),i})};var mr=function(t){function e(e){this.source=e,t.call(this)}function n(e,t){this.o=e,this.g=t,this.isStopped=!1,this.done=!1}function r(e,t,r){this.parent=e,this.g=t,this.sad=r,this.isStopped=!1}return We(e,t),e.prototype.subscribeCore=function(e){var t=new Qe,r=new at;return t.add(r),r.setDisposable(this.source.subscribe(new n(e,t))),t},n.prototype.onNext=function(e){if(!this.isStopped){var t=new at;this.g.add(t),re(e)&&(e=Gt(e)),t.setDisposable(e.subscribe(new r(this,this.g,t)))}},n.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.o.onError(e))},n.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.done=!0,1===this.g.length&&this.o.onCompleted())},n.prototype.dispose=function(){this.isStopped=!0},n.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(e),!0)},r.prototype.onNext=function(e){this.isStopped||this.parent.o.onNext(e)},r.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.parent.o.onError(e))},r.prototype.onCompleted=function(){if(!this.isStopped){var e=this.parent;this.isStopped=!0,e.g.remove(this.sad),e.done&&1===e.g.length&&e.o.onCompleted()}},r.prototype.dispose=function(){this.isStopped=!0},r.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.parent.o.onError(e),!0)},e}(Lt);Tt.mergeAll=Tt.mergeObservable=function(){return new mr(this)},Tt.onErrorResumeNext=function(e){if(!e)throw new Error("Second observable is required");return gr([this,e])};var gr=kt.onErrorResumeNext=function(){var a=[];if(Array.isArray(arguments[0]))a=arguments[0];else for(var e=0,t=arguments.length;t>e;e++)a.push(arguments[e]);return new Er(function(n){var i=0,o=new st,e=vt.scheduleRecursive(function(e){var t,r;i<a.length?(t=a[i++],re(t)&&(t=Gt(t)),r=new at,o.setDisposable(r),r.setDisposable(t.subscribe(n.onNext.bind(n),e,e))):n.onCompleted()});return new Qe(o,e)})};Tt.skipUntil=function(i){var o=this;return new Er(function(t){var r=!1,e=new Qe(o.subscribe(function(e){r&&t.onNext(e)},function(e){t.onError(e)},function(){r&&t.onCompleted()}));re(i)&&(i=Gt(i));var n=new at;return e.add(n),n.setDisposable(i.subscribe(function(){r=!0,n.dispose()},function(e){t.onError(e)},function(){n.dispose()})),e},o)};var _r=function(t){function e(e){this.source=e,t.call(this)}function n(e,t){this.o=e,this.inner=t,this.stopped=!1,this.latest=0,this.hasLatest=!1,this.isStopped=!1}function i(e,t){this.parent=e,this.id=t,this.isStopped=!1}return We(e,t),e.prototype.subscribeCore=function(e){var t=new st,r=this.source.subscribe(new n(e,t));return new Qe(r,t)},n.prototype.onNext=function(e){if(!this.isStopped){var t=new at,r=++this.latest;this.hasLatest=!0,this.inner.setDisposable(t),re(e)&&(e=Gt(e)),t.setDisposable(e.subscribe(new i(this,r)))}},n.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.o.onError(e))},n.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.stopped=!0,!this.hasLatest&&this.o.onCompleted())},n.prototype.dispose=function(){this.isStopped=!0},n.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(e),!0)},i.prototype.onNext=function(e){this.isStopped||this.parent.latest===this.id&&this.parent.o.onNext(e)},i.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.parent.latest===this.id&&this.parent.o.onError(e))},i.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.parent.latest===this.id&&(this.parent.hasLatest=!1,this.parent.isStopped&&this.parent.o.onCompleted()))},i.prototype.dispose=function(){this.isStopped=!0},i.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.parent.o.onError(e),!0)},e}(Lt);Tt["switch"]=Tt.switchLatest=function(){return new _r(this)};var yr=function(r){function e(e,t){this.source=e,this.other=re(t)?Gt(t):t,r.call(this)}function t(e){this.o=e,this.isStopped=!1}return We(e,r),e.prototype.subscribeCore=function(e){return new Qe(this.source.subscribe(e),this.other.subscribe(new t(e)))},t.prototype.onNext=function(e){this.isStopped||this.o.onCompleted()},t.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.o.onError(e))},t.prototype.onCompleted=function(){!this.isStopped&&(this.isStopped=!0)},t.prototype.dispose=function(){this.isStopped=!0},t.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(e),!0)},e}(Lt);Tt.takeUntil=function(e){return new yr(this,e)},Tt.withLatestFrom=function(){for(var e=arguments.length,u=new Array(e),t=0;e>t;t++)u[t]=arguments[t];var c=u.pop(),h=this;return Array.isArray(u[0])&&(u=u[0]),new Er(function(n){for(var e=u.length,i=f(e,L),o=!1,a=new Array(e),s=new Array(e+1),t=0;e>t;t++)!function(t){var e=u[t],r=new at;re(e)&&(e=Gt(e)),r.setDisposable(e.subscribe(function(e){a[t]=e,i[t]=!0,o=i.every(Z)},function(e){n.onError(e)},K)),s[t]=r}(t);var r=new at;return r.setDisposable(h.subscribe(function(e){var t=[e].concat(a);if(o){var r=p(c).apply(null,t);return r===Ke?n.onError(r.e):void n.onNext(r)}},function(e){n.onError(e)},function(){n.onCompleted()})),s[e]=r,new Qe(s)},this)},Tt.zip=function(){if(Array.isArray(arguments[0]))return I.apply(this,arguments);for(var e=arguments.length,s=new Array(e),t=0;e>t;t++)s[t]=arguments[t];var u=this,c=s.pop();return s.unshift(u),new Er(function(i){for(var e=s.length,o=f(e,N),a=f(e,L),r=new Array(e),t=0;e>t;t++)!function(n){var e=s[n],t=new at;re(e)&&(e=Gt(e)),t.setDisposable(e.subscribe(function(e){if(o[n].push(e),o.every(function(e){return e.length>0})){var t=o.map(function(e){return e.shift()}),r=p(c).apply(u,t);if(r===Ke)return i.onError(r.e);i.onNext(r)}else a.filter(function(e,t){return t!==n}).every(Z)&&i.onCompleted()},function(e){i.onError(e)},function(){a[n]=!0,a.every(Z)&&i.onCompleted()})),r[n]=t}(t);return new Qe(r)},u)},kt.zip=function(){for(var e=arguments.length,t=new Array(e),r=0;e>r;r++)t[r]=arguments[r];var n=t.shift();return n.zip.apply(n,t)},kt.zipArray=function(){var a;if(Array.isArray(arguments[0]))a=arguments[0];else{var e=arguments.length;a=new Array(e);for(var t=0;e>t;t++)a[t]=arguments[t]}return new Er(function(n){for(var e=a.length,i=f(e,D),o=f(e,L),t=new Array(e),r=0;e>r;r++)!function(r){t[r]=new at,t[r].setDisposable(a[r].subscribe(function(e){if(i[r].push(e),i.every(function(e){return e.length>0})){var t=i.map(function(e){return e.shift()});n.onNext(t)}else if(o.filter(function(e,t){return t!==r}).every(Z))return n.onCompleted()},function(e){n.onError(e)},function(){o[r]=!0,o.every(Z)&&n.onCompleted()}))}(r);return new Qe(t)})},Tt.asObservable=function(){var t=this;return new Er(function(e){return t.subscribe(e)},t)},Tt.bufferWithCount=function(e,t){return"number"!=typeof t&&(t=e),this.windowWithCount(e,t).selectMany(function(e){return e.toArray()}).where(function(e){return e.length>0})},Tt.dematerialize=function(){var e=this;return new Er(function(t){return e.subscribe(function(e){return e.accept(t)},function(e){t.onError(e)},function(){t.onCompleted()})},this)},Tt.distinctUntilChanged=function(a,s){var e=this;return s||(s=Q),new Er(function(n){var i,o=!1;return e.subscribe(function(e){var t=e;if(a&&(t=p(a)(e),t===Ke))return n.onError(t.e);if(o){var r=p(s)(i,t);if(r===Ke)return n.onError(r.e)}o&&r||(o=!0,i=t,n.onNext(e))},function(e){n.onError(e)},function(){n.onCompleted()})},this)};var br=function(i){function e(e,t,r,n){this.source=e,this.t=!t||ne(t)?Et(t||K,r||K,n||K):t,i.call(this)}function t(e,t){this.o=e,this.t=t,this.isStopped=!1}return We(e,i),e.prototype.subscribeCore=function(e){return this.source.subscribe(new t(e,this.t))},t.prototype.onNext=function(e){if(!this.isStopped){var t=p(this.t.onNext).call(this.t,e);t===Ke&&this.o.onError(t.e),this.o.onNext(e)}},t.prototype.onError=function(e){if(!this.isStopped){this.isStopped=!0;var t=p(this.t.onError).call(this.t,e);if(t===Ke)return this.o.onError(t.e);this.o.onError(e)}},t.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=!0;var e=p(this.t.onCompleted).call(this.t);if(e===Ke)return this.o.onError(e.e);this.o.onCompleted()}},t.prototype.dispose=function(){this.isStopped=!0},t.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(e),!0)},e}(Lt);Tt["do"]=Tt.tap=Tt.doAction=function(e,t,r){return new br(this,e,t,r)},Tt.doOnNext=Tt.tapOnNext=function(t,r){return this.tap("undefined"!=typeof r?function(e){t.call(r,e)}:t)},Tt.doOnError=Tt.tapOnError=function(t,r){return this.tap(K,"undefined"!=typeof r?function(e){t.call(r,e)}:t)},Tt.doOnCompleted=Tt.tapOnCompleted=function(e,t){return this.tap(K,null,"undefined"!=typeof t?function(){e.call(t)}:e)},Tt["finally"]=Tt.ensure=function(r){var n=this;return new Er(function(e){var t;try{t=n.subscribe(e)}catch(e){throw r(),e}return rt(function(){try{t.dispose()}catch(e){throw e}finally{r()}})},this)},Tt.finallyAction=function(e){return this.ensure(e)};var wr=function(t){function e(e){this.source=e,t.call(this)}function r(e){this.o=e,this.isStopped=!1}return We(e,t),e.prototype.subscribeCore=function(e){return this.source.subscribe(new r(e))},r.prototype.onNext=K,r.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.o.onError(e))},r.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},r.prototype.dispose=function(){this.isStopped=!0},r.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.observer.onError(e),!0)},e}(Lt);Tt.ignoreElements=function(){return new wr(this)},Tt.materialize=function(){var e=this;return new Er(function(t){return e.subscribe(function(e){t.onNext(xt(e))},function(e){t.onNext(St(e)),t.onCompleted()},function(){t.onNext(Mt()),t.onCompleted()})},e)},Tt.repeat=function(e){return Ft(this,e).concat()},Tt.retry=function(e){return Ft(this,e).catchError()},Tt.retryWhen=function(e){return Ft(this).catchErrorWhen(e)};var xr=function(i){function e(e,t,r,n){this.source=e,this.accumulator=t,this.hasSeed=r,this.seed=n,i.call(this)}return We(e,i),e.prototype.subscribeCore=function(e){return this.source.subscribe(new B(e,this))},e}(Lt);B.prototype.onNext=function(e){if(!this.isStopped){!this.hasValue&&(this.hasValue=!0);try{this.hasAccumulation?this.accumulation=this.accumulator(this.accumulation,e):(this.accumulation=this.hasSeed?this.accumulator(this.seed,e):e,this.hasAccumulation=!0)}catch(e){return this.observer.onError(e)}this.observer.onNext(this.accumulation)}},B.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.observer.onError(e))},B.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,!this.hasValue&&this.hasSeed&&this.observer.onNext(this.seed),this.observer.onCompleted())},B.prototype.dispose=function(){this.isStopped=!0},B.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.observer.onError(e),!0)},Tt.scan=function(){var e,t,r=!1;return 2===arguments.length?(r=!0,e=arguments[0],t=arguments[1]):t=arguments[0],new xr(this,t,r,e)},Tt.skipLast=function(n){if(0>n)throw new he;var e=this;return new Er(function(t){var r=[];return e.subscribe(function(e){r.push(e),r.length>n&&t.onNext(r.shift())},function(e){t.onError(e)},function(){t.onCompleted()})},e)},Tt.startWith=function(){var e,t=0;arguments.length&&pt(arguments[0])?(e=arguments[0],t=1):e=vt;for(var r=[],n=t,i=arguments.length;i>n;n++)r.push(arguments[n]);return $t([Jt(r,e),this]).concat()},Tt.takeLast=function(n){if(0>n)throw new he;var e=this;return new Er(function(t){var r=[];return e.subscribe(function(e){r.push(e),r.length>n&&r.shift()},function(e){t.onError(e)},function(){for(;r.length>0;)t.onNext(r.shift());t.onCompleted()})},e)},Tt.takeLastBuffer=function(n){var e=this;return new Er(function(t){var r=[];return e.subscribe(function(e){r.push(e),r.length>n&&r.shift()},function(e){t.onError(e)},function(){t.onNext(r),t.onCompleted()})},e)},Tt.windowWithCount=function(s,u){var n=this;if(+s||(s=0),Math.abs(s)===1/0&&(s=0),0>=s)throw new he;if(null==u&&(u=s),+u||(u=0),Math.abs(u)===1/0&&(u=0),0>=u)throw new he;return new Er(function(t){function i(){var e=new Pr;a.push(e),t.onNext(Ye(e,r))}var e=new at,r=new ut(e),o=0,a=[];return i(),e.setDisposable(n.subscribe(function(e){for(var t=0,r=a.length;r>t;t++)a[t].onNext(e);var n=o-s+1;n>=0&&n%u===0&&a.shift().onCompleted(),++o%u===0&&i()},function(e){for(;a.length>0;)a.shift().onError(e);t.onError(e)},function(){for(;a.length>0;)a.shift().onCompleted();t.onCompleted()})),r},n)},Tt.selectConcat=Tt.concatMap=function(t,i,e){return ne(t)&&ne(i)?this.concatMap(function(r,n){var e=t(r,n);return re(e)&&(e=Gt(e)),(_e(e)||ge(e))&&(e=Kt(e)),e.map(function(e,t){return i(r,e,n,t)})}):ne(t)?F(this,t,e):F(this,function(){return t})},Tt.concatMapObserver=Tt.selectConcatObserver=function(e,t,r,n){var i=this,o=be(e,n,2),a=be(t,n,1),s=be(r,n,0);return new Er(function(r){var n=0;return i.subscribe(function(e){var t;try{t=o(e,n++)}catch(e){return void r.onError(e)}re(t)&&(t=Gt(t)),r.onNext(t)},function(e){var t;try{t=a(e)}catch(e){return void r.onError(e)}re(t)&&(t=Gt(t)),r.onNext(t),r.onCompleted()},function(){var e;try{e=s()}catch(e){return void r.onError(e)}re(e)&&(e=Gt(e)),r.onNext(e),r.onCompleted()})},this).concatAll()},Tt.defaultIfEmpty=function(e){var n=this;return e===a&&(e=null),new Er(function(t){var r=!1;return n.subscribe(function(e){r=!0,t.onNext(e)},function(e){t.onError(e)},function(){!r&&t.onNext(e),t.onCompleted()})},n)},$.prototype.push=function(e){var t=-1===z(this.set,e,this.comparer);return t&&this.set.push(e),t},Tt.distinct=function(i,e){var t=this;return e||(e=Q),new Er(function(r){var n=new $(e);return t.subscribe(function(e){var t=e;if(i)try{t=i(e)}catch(e){return void r.onError(e)}n.push(t)&&r.onNext(e)},function(e){r.onError(e)},function(){r.onCompleted()})},this)};var Sr=function(n){function r(e,t,r){this.source=e,this.selector=be(t,r,3),n.call(this)}function i(n,i){return function(e,t,r){return n.call(this,i.selector(e,t,r),t,r)}}function t(e,t,r){this.o=e,this.selector=t,this.source=r,this.i=0,this.isStopped=!1}return We(r,n),r.prototype.internalMap=function(e,t){return new r(this.source,i(e,this),t)},r.prototype.subscribeCore=function(e){return this.source.subscribe(new t(e,this.selector,this))},t.prototype.onNext=function(e){if(!this.isStopped){var t=p(this.selector)(e,this.i++,this.source);return t===Ke?this.o.onError(t.e):void this.o.onNext(t)}},t.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.o.onError(e))},t.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},t.prototype.dispose=function(){this.isStopped=!0},t.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(e),!0)},r}(Lt);Tt.map=Tt.select=function(e,t){var r="function"==typeof e?e:function(){return e};return this instanceof Sr?this.internalMap(r,t):new Sr(this,r,t)},Tt.pluck=function(){var i=arguments,o=arguments.length;if(0===o)throw new Error("List of properties cannot be empty.");return this.map(function(e){for(var t=e,r=0;o>r;r++){var n=t[i[r]];if("undefined"==typeof n)return a;t=n}return t})},Tt.flatMapObserver=Tt.selectManyObserver=function(i,o,t,a){var e=this;return new Er(function(r){var n=0;return e.subscribe(function(e){var t;try{t=i.call(a,e,n++)}catch(e){return void r.onError(e)}re(t)&&(t=Gt(t)),r.onNext(t)},function(e){var t;try{t=o.call(a,e)}catch(e){return void r.onError(e)}re(t)&&(t=Gt(t)),r.onNext(t),r.onCompleted()},function(){var e;try{e=t.call(a)}catch(e){return void r.onError(e)}re(e)&&(e=Gt(e)),r.onNext(e),r.onCompleted()})},e).mergeAll()},Tt.selectMany=Tt.flatMap=function(t,i,e){return ne(t)&&ne(i)?this.flatMap(function(r,n){var e=t(r,n);return re(e)&&(e=Gt(e)),(_e(e)||ge(e))&&(e=Kt(e)),e.map(function(e,t){return i(r,e,n,t)})},e):ne(t)?U(this,t,e):U(this,function(){return t})},Tt.selectSwitch=Tt.flatMapLatest=Tt.switchMap=function(e,t){return this.select(e,t).switchLatest()};var Mr=function(r){function e(e,t){this.source=e,this.skipCount=t,r.call(this)}function t(e,t){this.c=t,this.r=t,this.o=e,this.isStopped=!1}return We(e,r),e.prototype.subscribeCore=function(e){return this.source.subscribe(new t(e,this.skipCount))},t.prototype.onNext=function(e){this.isStopped||(this.r<=0?this.o.onNext(e):this.r--)},t.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.o.onError(e))},t.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},t.prototype.dispose=function(){this.isStopped=!0},t.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(e),!0)},e}(Lt);Tt.skip=function(e){if(0>e)throw new he;return new Mr(this,e)},Tt.skipWhile=function(e,t){var i=this,o=be(e,t,3);return new Er(function(t){var r=0,n=!1;return i.subscribe(function(e){if(!n)try{n=!o(e,r++,i)}catch(e){return void t.onError(e)}n&&t.onNext(e)},function(e){t.onError(e)},function(){t.onCompleted()})},i)},Tt.take=function(e,t){if(0>e)throw new he;if(0===e)return qt(t);var n=this;return new Er(function(t){var r=e;return n.subscribe(function(e){r-- >0&&(t.onNext(e),0>=r&&t.onCompleted())},function(e){t.onError(e)},function(){t.onCompleted()})},n)},Tt.takeWhile=function(e,t){var i=this,o=be(e,t,3);return new Er(function(t){var r=0,n=!0;return i.subscribe(function(e){if(n){try{n=o(e,r++,i)}catch(e){return void t.onError(e)}n?t.onNext(e):t.onCompleted()}},function(e){t.onError(e)},function(){t.onCompleted()})},i)};var Cr=function(n){function r(e,t,r){this.source=e,this.predicate=be(t,r,3),n.call(this)}function i(n,i){return function(e,t,r){return i.predicate(e,t,r)&&n.call(this,e,t,r)}}function t(e,t,r){this.o=e,this.predicate=t,this.source=r,this.i=0,this.isStopped=!1}return We(r,n),r.prototype.subscribeCore=function(e){return this.source.subscribe(new t(e,this.predicate,this))},r.prototype.internalFilter=function(e,t){return new r(this.source,i(e,this),t)},t.prototype.onNext=function(e){if(!this.isStopped){var t=p(this.predicate)(e,this.i++,this.source);return t===Ke?this.o.onError(t.e):void(t&&this.o.onNext(e))}},t.prototype.onError=function(e){this.isStopped||(this.isStopped=!0,this.o.onError(e))},t.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},t.prototype.dispose=function(){this.isStopped=!0},t.prototype.fail=function(e){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(e),!0)},r}(Lt);Tt.filter=Tt.where=function(e,t){return this instanceof Cr?this.internalFilter(e,t):new Cr(this,e,t)},Tt.transduce=function(e){function n(e){return{"@@transducer/init":function(){return e},"@@transducer/step":function(e,t){return e.onNext(t)},"@@transducer/result":function(e){return e.onCompleted()}}}var i=this;return new Er(function(t){var r=e(n(t));return i.subscribe(function(e){try{r["@@transducer/step"](t,e)}catch(e){t.onError(e)}},function(e){t.onError(e)},function(){r["@@transducer/result"](t)})},i)};var Er=Y.AnonymousObservable=function(r){function o(e){return e&&ne(e.dispose)?e:ne(e)?rt(e):nt}function i(e,t){var r=t[0],n=t[1],i=p(n)(r);return i!==Ke||r.fail(Ke.e)?void r.setDisposable(o(i)):d(Ke.e)}function e(n,e){function t(e){var t=new Tr(e),r=[t,n];return mt.scheduleRequired()?mt.scheduleWithState(r,i):i(null,r),t}this.source=e,r.call(this,t)}return We(e,r),e}(kt),Tr=function(t){function e(e){t.call(this),this.observer=e,this.m=new at}We(e,t);var r=e.prototype;return r.next=function(e){var t=p(this.observer.onNext).call(this.observer,e);t===Ke&&(this.dispose(),d(t.e))},r.error=function(e){var t=p(this.observer.onError).call(this.observer,e);this.dispose(),t===Ke&&d(t.e)},r.completed=function(){var e=p(this.observer.onCompleted).call(this.observer);this.dispose(),e===Ke&&d(e.e)},r.setDisposable=function(e){this.m.setDisposable(e)},r.getDisposable=function(){return this.m.getDisposable()},r.dispose=function(){t.prototype.dispose.call(this),this.m.dispose()},e}(Ot),Or=function(e,t){this.subject=e,this.observer=t};Or.prototype.dispose=function(){if(!this.subject.isDisposed&&null!==this.observer){var e=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(e,1),this.observer=null}};var Pr=Y.Subject=function(e){function t(e){return ot(this),this.isStopped?this.hasError?(e.onError(this.error),nt):(e.onCompleted(),nt):(this.observers.push(e),new Or(this,e))}function r(){e.call(this,t),this.isDisposed=!1,this.isStopped=!1,this.observers=[],this.hasError=!1}return We(r,e),Xe(r.prototype,Ct.prototype,{hasObservers:function(){return this.observers.length>0},onCompleted:function(){if(ot(this),!this.isStopped){this.isStopped=!0;for(var e=0,t=i(this.observers),r=t.length;r>e;e++)t[e].onCompleted();this.observers.length=0}},onError:function(e){if(ot(this),!this.isStopped){this.isStopped=!0,this.error=e,this.hasError=!0;for(var t=0,r=i(this.observers),n=r.length;n>t;t++)r[t].onError(e);this.observers.length=0}},onNext:function(e){if(ot(this),!this.isStopped)for(var t=0,r=i(this.observers),n=r.length;n>t;t++)r[t].onNext(e)},dispose:function(){this.isDisposed=!0,this.observers=null}}),r.create=function(e,t){return new Ar(e,t)},r}(kt),Ar=(Y.AsyncSubject=function(e){function t(e){return ot(this),this.isStopped?(this.hasError?e.onError(this.error):this.hasValue?(e.onNext(this.value),e.onCompleted()):e.onCompleted(),nt):(this.observers.push(e),new Or(this,e))}function r(){e.call(this,t),this.isDisposed=!1,this.isStopped=!1,this.hasValue=!1,this.observers=[],this.hasError=!1}return We(r,e),Xe(r.prototype,Ct,{hasObservers:function(){return ot(this),this.observers.length>0},onCompleted:function(){var e,t;if(ot(this),!this.isStopped){this.isStopped=!0;var r=i(this.observers),t=r.length;if(this.hasValue)for(e=0;t>e;e++){var n=r[e];n.onNext(this.value),n.onCompleted()}else for(e=0;t>e;e++)r[e].onCompleted();this.observers.length=0}},onError:function(e){if(ot(this),!this.isStopped){this.isStopped=!0,this.hasError=!0,this.error=e;for(var t=0,r=i(this.observers),n=r.length;n>t;t++)r[t].onError(e);this.observers.length=0}},onNext:function(e){ot(this),this.isStopped||(this.value=e,this.hasValue=!0)},dispose:function(){this.isDisposed=!0,this.observers=null,this.exception=null,this.value=null}}),r}(kt),Y.AnonymousSubject=function(r){function n(e){return this.observable.subscribe(e)}function e(e,t){this.observer=e,this.observable=t,r.call(this,n)}return We(e,r),Xe(e.prototype,Ct.prototype,{onCompleted:function(){this.observer.onCompleted()},onError:function(e){this.observer.onError(e)},onNext:function(e){this.observer.onNext(e)}}),e}(kt));"function"==typeof Nr&&"object"==typeof Nr.amd&&Nr.amd?(V.Rx=Y,Nr(function(){return Y})):H&&q?W?(q.exports=Y).Rx=Y:H.Rx=Y:V.Rx=Y;var jr=e()}).call(this)}).call(this,e(150),"undefined"!=typeof n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{150:150}]},{},[1])(1)})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],16:[function(i,o,e){(function(e){var t=typeof e!=="undefined"?e:typeof window!=="undefined"?window:{};var r=i("min-document");var n;if(typeof document!=="undefined"){n=document}else{n=t["__GLOBAL_DOCUMENT_CACHE@4"];if(!n){n=t["__GLOBAL_DOCUMENT_CACHE@4"]=r}}o.exports=n}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"min-document":4}],17:[function(e,t,r){r.read=function(e,t,r,n,i){var o,a;var s=i*8-n-1;var u=(1<<s)-1;var c=u>>1;var h=-7;var l=r?i-1:0;var p=r?-1:1;var f=e[t+l];l+=p;o=f&(1<<-h)-1;f>>=-h;h+=s;for(;h>0;o=o*256+e[t+l],l+=p,h-=8){}a=o&(1<<-h)-1;o>>=-h;h+=n;for(;h>0;a=a*256+e[t+l],l+=p,h-=8){}if(o===0){o=1-c}else if(o===u){return a?NaN:(f?-1:1)*Infinity}else{a=a+Math.pow(2,n);o=o-c}return(f?-1:1)*a*Math.pow(2,o-n)};r.write=function(e,t,r,n,i,o){var a,s,u;var c=o*8-i-1;var h=(1<<c)-1;var l=h>>1;var p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0;var f=n?0:o-1;var d=n?1:-1;var v=t<0||t===0&&1/t<0?1:0;t=Math.abs(t);if(isNaN(t)||t===Infinity){s=isNaN(t)?1:0;a=h}else{a=Math.floor(Math.log(t)/Math.LN2);if(t*(u=Math.pow(2,-a))<1){a--;u*=2}if(a+l>=1){t+=p/u}else{t+=p*Math.pow(2,1-l)}if(t*u>=2){a++;u/=2}if(a+l>=h){s=0;a=h}else if(a+l>=1){s=(t*u-1)*Math.pow(2,i);a=a+l}else{s=t*Math.pow(2,l-1)*Math.pow(2,i);a=0}}for(;i>=8;e[r+f]=s&255,f+=d,s/=256,i-=8){}a=a<<i|s;c+=i;for(;c>0;e[r+f]=a&255,f+=d,a/=256,c-=8){}e[r+f-d]|=v*128}},{}],18:[function(e,n,t){(function(e){"use strict";var r=typeof window!=="undefined"?window:typeof e!=="undefined"?e:{};n.exports=t;function t(e,t){if(e in r){return r[e]}r[e]=t;return t}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],19:[function(e,t,r){"use strict";var a=e("./index.js");t.exports=n;function n(e,t,r){var n="__INDIVIDUAL_ONE_VERSION_"+e;var i=n+"_ENFORCE_SINGLETON";var o=a(i,t);if(o!==t){throw new Error("Can only have one copy of "+e+".\n"+"You already have version "+o+" installed.\n"+"This means you cannot install version "+t)}return a(n,r)}},{"./index.js":18}],20:[function(e,t,r){"use strict";t.exports=function e(t){return typeof t==="object"&&t!==null}},{}],21:[function(e,t,r){"use strict";var m={};m.base32="0123456789bcdefghjkmnpqrstuvwxyz";m.encode=function(e,t,r){if(typeof r=="undefined"){for(var n=1;n<=12;n++){var i=m.encode(e,t,n);var o=m.decode(i);if(o.lat==e&&o.lon==t)return i}r=12}e=Number(e);t=Number(t);r=Number(r);if(isNaN(e)||isNaN(t)||isNaN(r))throw new Error("Invalid geohash");var a=0;var s=0;var u=true;var c="";var h=-90,l=90;var p=-180,f=180;while(c.length<r){if(u){var d=(p+f)/2;if(t>=d){a=a*2+1;p=d}else{a=a*2;f=d}}else{var v=(h+l)/2;if(e>=v){a=a*2+1;h=v}else{a=a*2;l=v}}u=!u;if(++s==5){c+=m.base32.charAt(a);s=0;a=0}}return c};m.decode=function(e){var t=m.bounds(e);var r=t.sw.lat,n=t.sw.lon;var i=t.ne.lat,o=t.ne.lon;var a=(r+i)/2;var s=(n+o)/2;a=a.toFixed(Math.floor(2-Math.log(i-r)/Math.LN10));s=s.toFixed(Math.floor(2-Math.log(o-n)/Math.LN10));return{lat:Number(a),lon:Number(s)}};m.bounds=function(e){if(e.length===0)throw new Error("Invalid geohash");e=e.toLowerCase();var t=true;var r=-90,n=90;var i=-180,o=180;for(var a=0;a<e.length;a++){var s=e.charAt(a);var u=m.base32.indexOf(s);if(u==-1)throw new Error("Invalid geohash");for(var c=4;c>=0;c--){var h=u>>c&1;if(t){var l=(i+o)/2;if(h==1){i=l}else{o=l}}else{var p=(r+n)/2;if(h==1){r=p}else{n=p}}t=!t}}var f={sw:{lat:r,lon:i},ne:{lat:n,lon:o}};return f};m.adjacent=function(e,t){e=e.toLowerCase();t=t.toLowerCase();if(e.length===0)throw new Error("Invalid geohash");if("nsew".indexOf(t)==-1)throw new Error("Invalid direction");var r={n:["p0r21436x8zb9dcf5h7kjnmqesgutwvy","bc01fg45238967deuvhjyznpkmstqrwx"],s:["14365h7k9dcfesgujnmqp0r2twvyx8zb","238967debc01fg45kmstqrwxuvhjyznp"],e:["bc01fg45238967deuvhjyznpkmstqrwx","p0r21436x8zb9dcf5h7kjnmqesgutwvy"],w:["238967debc01fg45kmstqrwxuvhjyznp","14365h7k9dcfesgujnmqp0r2twvyx8zb"]};var n={n:["prxz","bcfguvyz"],s:["028b","0145hjnp"],e:["bcfguvyz","prxz"],w:["0145hjnp","028b"]};var i=e.slice(-1);var o=e.slice(0,-1);var a=e.length%2;if(n[t][a].indexOf(i)!=-1&&o!==""){o=m.adjacent(o,t)}return o+m.base32.charAt(r[t][a].indexOf(i))};m.neighbours=function(e){return{n:m.adjacent(e,"n"),ne:m.adjacent(m.adjacent(e,"n"),"e"),e:m.adjacent(e,"e"),se:m.adjacent(m.adjacent(e,"s"),"e"),s:m.adjacent(e,"s"),sw:m.adjacent(m.adjacent(e,"s"),"w"),w:m.adjacent(e,"w"),nw:m.adjacent(m.adjacent(e,"n"),"w")}};if(typeof t!="undefined"&&t.exports)t.exports=m},{}],22:[function(e,r,n){(function(e,t){typeof n==="object"&&typeof r!=="undefined"?t(n):typeof o==="function"&&o.amd?o(["exports"],t):t(e.martinez={})})(this,function(e){"use strict";function n(e,t){return e>t?1:e<t?-1:0}var m=function e(t,r){if(t===void 0)t=n;if(r===void 0)r=false;this._compare=t;this._root=null;this._size=0;this._noDuplicates=!!r};var t={size:{configurable:true}};m.prototype.rotateLeft=function e(t){var r=t.right;if(r){t.right=r.left;if(r.left){r.left.parent=t}r.parent=t.parent}if(!t.parent){this._root=r}else if(t===t.parent.left){t.parent.left=r}else{t.parent.right=r}if(r){r.left=t}t.parent=r};m.prototype.rotateRight=function e(t){var r=t.left;if(r){t.left=r.right;if(r.right){r.right.parent=t}r.parent=t.parent}if(!t.parent){this._root=r}else if(t===t.parent.left){t.parent.left=r}else{t.parent.right=r}if(r){r.right=t}t.parent=r};m.prototype._splay=function e(t){var r=this;while(t.parent){var n=t.parent;if(!n.parent){if(n.left===t){r.rotateRight(n)}else{r.rotateLeft(n)}}else if(n.left===t&&n.parent.left===n){r.rotateRight(n.parent);r.rotateRight(n)}else if(n.right===t&&n.parent.right===n){r.rotateLeft(n.parent);r.rotateLeft(n)}else if(n.left===t&&n.parent.right===n){r.rotateRight(n);r.rotateLeft(n)}else{r.rotateLeft(n);r.rotateRight(n)}}};m.prototype.splay=function e(t){var r=this;var n,i,o,a,s;while(t.parent){n=t.parent;i=n.parent;if(i&&i.parent){o=i.parent;if(o.left===i){o.left=t}else{o.right=t}t.parent=o}else{t.parent=null;r._root=t}a=t.left;s=t.right;if(t===n.left){if(i){if(i.left===n){if(n.right){i.left=n.right;i.left.parent=i}else{i.left=null}n.right=i;i.parent=n}else{if(a){i.right=a;a.parent=i}else{i.right=null}t.left=i;i.parent=t}}if(s){n.left=s;s.parent=n}else{n.left=null}t.right=n;n.parent=t}else{if(i){if(i.right===n){if(n.left){i.right=n.left;i.right.parent=i}else{i.right=null}n.left=i;i.parent=n}else{if(s){i.left=s;s.parent=i}else{i.left=null}t.right=i;i.parent=t}}if(a){n.right=a;a.parent=n}else{n.right=null}t.left=n;n.parent=t}}};m.prototype.replace=function e(t,r){if(!t.parent){this._root=r}else if(t===t.parent.left){t.parent.left=r}else{t.parent.right=r}if(r){r.parent=t.parent}};m.prototype.minNode=function e(t){if(t===void 0)t=this._root;if(t){while(t.left){t=t.left}}return t};m.prototype.maxNode=function e(t){if(t===void 0)t=this._root;if(t){while(t.right){t=t.right}}return t};m.prototype.insert=function e(t,r){var n=this._root;var i=null;var o=this._compare;var a;if(this._noDuplicates){while(n){i=n;a=o(n.key,t);if(a===0){return}else if(o(n.key,t)<0){n=n.right}else{n=n.left}}}else{while(n){i=n;if(o(n.key,t)<0){n=n.right}else{n=n.left}}}n={key:t,data:r,left:null,right:null,parent:i};if(!i){this._root=n}else if(o(i.key,n.key)<0){i.right=n}else{i.left=n}this.splay(n);this._size++;return n};m.prototype.find=function e(t){var r=this._root;var n=this._compare;while(r){var i=n(r.key,t);if(i<0){r=r.right}else if(i>0){r=r.left}else{return r}}return null};m.prototype.contains=function e(t){var r=this._root;var n=this._compare;while(r){var i=n(t,r.key);if(i===0){return true}else if(i<0){r=r.left}else{r=r.right}}return false};m.prototype.remove=function e(t){var r=this.find(t);if(!r){return false}this.splay(r);if(!r.left){this.replace(r,r.right)}else if(!r.right){this.replace(r,r.left)}else{var n=this.minNode(r.right);if(n.parent!==r){this.replace(n,n.right);n.right=r.right;n.right.parent=n}this.replace(r,n);n.left=r.left;n.left.parent=n}this._size--;return true};m.prototype.removeNode=function e(t){if(!t){return false}this.splay(t);if(!t.left){this.replace(t,t.right)}else if(!t.right){this.replace(t,t.left)}else{var r=this.minNode(t.right);if(r.parent!==t){this.replace(r,r.right);r.right=t.right;r.right.parent=r}this.replace(t,r);r.left=t.left;r.left.parent=r}this._size--;return true};m.prototype.erase=function e(t){var r=this.find(t);if(!r){return}this.splay(r);var n=r.left;var i=r.right;var o=null;if(n){n.parent=null;o=this.maxNode(n);this.splay(o);this._root=o}if(i){if(n){o.right=i}else{this._root=i}i.parent=o}this._size--};m.prototype.pop=function e(){var t=this._root,r=null;if(t){while(t.left){t=t.left}r={key:t.key,data:t.data};this.remove(t.key)}return r};m.prototype.next=function e(t){var r=t;if(r){if(r.right){r=r.right;while(r&&r.left){r=r.left}}else{r=t.parent;while(r&&r.right===t){t=r;r=r.parent}}}return r};m.prototype.prev=function e(t){var r=t;if(r){if(r.left){r=r.left;while(r&&r.right){r=r.right}}else{r=t.parent;while(r&&r.left===t){t=r;r=r.parent}}}return r};m.prototype.forEach=function e(t){var r=this._root;var n=[],i=false,o=0;while(!i){if(r){n.push(r);r=r.left}else{if(n.length>0){r=n.pop();t(r,o++);r=r.right}else{i=true}}}return this};m.prototype.range=function e(t,r,n,i){var o=this;var a=[];var s=this._compare;var u=this._root,c;while(a.length!==0||u){if(u){a.push(u);u=u.left}else{u=a.pop();c=s(u.key,r);if(c>0){break}else if(s(u.key,t)>=0){if(n.call(i,u)){return o}}u=u.right}}return this};m.prototype.keys=function e(){var t=this._root;var r=[],n=[],i=false;while(!i){if(t){r.push(t);t=t.left}else{if(r.length>0){t=r.pop();n.push(t.key);t=t.right}else{i=true}}}return n};m.prototype.values=function e(){var t=this._root;var r=[],n=[],i=false;while(!i){if(t){r.push(t);t=t.left}else{if(r.length>0){t=r.pop();n.push(t.data);t=t.right}else{i=true}}}return n};m.prototype.at=function e(t){var r=this._root;var n=[],i=false,o=0;while(!i){if(r){n.push(r);r=r.left}else{if(n.length>0){r=n.pop();if(o===t){return r}o++;r=r.right}else{i=true}}}return null};m.prototype.load=function e(t,r,n){if(t===void 0)t=[];if(r===void 0)r=[];if(n===void 0)n=false;if(this._size!==0){throw new Error("bulk-load: tree is not empty")}var i=t.length;if(n){c(t,r,0,i-1,this._compare)}this._root=h(null,t,r,0,i);this._size=i;return this};m.prototype.min=function e(){var t=this.minNode(this._root);if(t){return t.key}else{return null}};m.prototype.max=function e(){var t=this.maxNode(this._root);if(t){return t.key}else{return null}};m.prototype.isEmpty=function e(){return this._root===null};t.size.get=function(){return this._size};m.createTree=function e(t,r,n,i,o){return new m(n,o).load(t,r,i)};Object.defineProperties(m.prototype,t);function h(e,t,r,n,i){var o=i-n;if(o>0){var a=n+Math.floor(o/2);var s=t[a];var u=r[a];var c={key:s,data:u,parent:e};c.left=h(c,t,r,n,a);c.right=h(c,t,r,a+1,i);return c}return null}function c(e,t,r,n,i){if(r>=n){return}var o=e[r+n>>1];var a=r-1;var s=n+1;while(true){do{a++}while(i(e[a],o)<0);do{s--}while(i(e[s],o)>0);if(a>=s){break}var u=e[a];e[a]=e[s];e[s]=u;u=t[a];t[a]=t[s];t[s]=u}c(e,t,r,s,i);c(e,t,s+1,n,i)}var a=0;var u=1;var l=2;var p=3;var g=0;var s=1;var _=2;var f=3;function y(e,t,r){if(t===null){e.inOut=false;e.otherInOut=true}else{if(e.isSubject===t.isSubject){e.inOut=!t.inOut;e.otherInOut=t.otherInOut}else{e.inOut=!t.otherInOut;e.otherInOut=t.isVertical()?!t.inOut:t.inOut}if(t){e.prevInResult=!i(t,r)||t.isVertical()?t.prevInResult:t}}e.inResult=i(e,r)}function i(e,t){switch(e.type){case a:switch(t){case g:return!e.otherInOut;case s:return e.otherInOut;case _:return e.isSubject&&e.otherInOut||!e.isSubject&&!e.otherInOut;case f:return true}break;case l:return t===g||t===s;case p:return t===_;case u:return false}return false}var d=function e(t,r,n,i,o){this.left=r;this.point=t;this.otherEvent=n;this.isSubject=i;this.type=o||a;this.inOut=false;this.otherInOut=false;this.prevInResult=null;this.inResult=false;this.resultInOut=false;this.isExteriorRing=true};d.prototype.isBelow=function e(t){var r=this.point,n=this.otherEvent.point;return this.left?(r[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(r[1]-t[1])>0:(n[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(n[1]-t[1])>0};d.prototype.isAbove=function e(t){return!this.isBelow(t)};d.prototype.isVertical=function e(){return this.point[0]===this.otherEvent.point[0]};d.prototype.clone=function e(){var t=new d(this.point,this.left,this.otherEvent,this.isSubject,this.type);t.inResult=this.inResult;t.prevInResult=this.prevInResult;t.isExteriorRing=this.isExteriorRing;t.inOut=this.inOut;t.otherInOut=this.otherInOut;return t};function v(e,t){if(e[0]===t[0]){if(e[1]===t[1]){return true}else{return false}}return false}function o(e,t,r){return(e[0]-r[0])*(t[1]-r[1])-(t[0]-r[0])*(e[1]-r[1])}function b(e,t){var r=e.point;var n=t.point;if(r[0]>n[0]){return 1}if(r[0]<n[0]){return-1}if(r[1]!==n[1]){return r[1]>n[1]?1:-1}return w(e,t,r,n)}function w(e,t,r,n){if(e.left!==t.left){return e.left?1:-1}if(o(r,e.otherEvent.point,t.otherEvent.point)!==0){return!e.isBelow(t.otherEvent.point)?1:-1}return!e.isSubject&&t.isSubject?1:-1}function x(e,t,r){var n=new d(t,false,e,e.isSubject);var i=new d(t,true,e.otherEvent,e.isSubject);if(v(e.point,e.otherEvent.point)){console.warn("what is that, a collapsed segment?",e)}n.contourId=i.contourId=e.contourId;if(b(i,e.otherEvent)>0){e.otherEvent.left=true;i.left=false}e.otherEvent.otherEvent=i;e.otherEvent=n;r.push(i);r.push(n);return r}function S(e,t){return e[0]*t[1]-e[1]*t[0]}function M(e,t){return e[0]*t[0]+e[1]*t[1]}function C(e,t,r,n,i){var o=[t[0]-e[0],t[1]-e[1]];var a=[n[0]-r[0],n[1]-r[1]];function s(e,t,r){return[e[0]+t*r[0],e[1]+t*r[1]]}var u=[r[0]-e[0],r[1]-e[1]];var c=S(o,a);var h=c*c;var l=M(o,o);if(h>0){var p=S(u,a)/c;if(p<0||p>1){return null}var f=S(u,o)/c;if(f<0||f>1){return null}if(p===0||p===1){return i?null:[s(e,p,o)]}if(f===0||f===1){return i?null:[s(r,f,a)]}return[s(e,p,o)]}c=S(u,o);h=c*c;if(h>0){return null}var d=M(o,u)/l;var v=d+M(o,a)/l;var m=Math.min(d,v);var g=Math.max(d,v);if(m<=1&&g>=0){if(m===1){return i?null:[s(e,m>0?m:0,o)]}if(g===0){return i?null:[s(e,g<1?g:1,o)]}if(i&&m===0&&g===1){return null}return[s(e,m>0?m:0,o),s(e,g<1?g:1,o)]}return null}function E(e,t,r){var n=C(e.point,e.otherEvent.point,t.point,t.otherEvent.point);var i=n?n.length:0;if(i===0){return 0}if(i===1&&(v(e.point,t.point)||v(e.otherEvent.point,t.otherEvent.point))){return 0}if(i===2&&e.isSubject===t.isSubject){return 0}if(i===1){if(!v(e.point,n[0])&&!v(e.otherEvent.point,n[0])){x(e,n[0],r)}if(!v(t.point,n[0])&&!v(t.otherEvent.point,n[0])){x(t,n[0],r)}return 1}var o=[];var a=false;var s=false;if(v(e.point,t.point)){a=true}else if(b(e,t)===1){o.push(t,e)}else{o.push(e,t)}if(v(e.otherEvent.point,t.otherEvent.point)){s=true}else if(b(e.otherEvent,t.otherEvent)===1){o.push(t.otherEvent,e.otherEvent)}else{o.push(e.otherEvent,t.otherEvent)}if(a&&s||a){t.type=u;e.type=t.inOut===e.inOut?l:p;if(a&&!s){x(o[1].otherEvent,o[0].point,r)}return 2}if(s){x(o[0],o[1].point,r);return 3}if(o[0]!==o[3].otherEvent){x(o[0],o[1].point,r);x(o[1],o[2].point,r);return 3}x(o[0],o[1].point,r);x(o[3].otherEvent,o[2].point,r);return 3}function T(e,t){if(e===t){return 0}if(o(e.point,e.otherEvent.point,t.point)!==0||o(e.point,e.otherEvent.point,t.otherEvent.point)!==0){if(v(e.point,t.point)){return e.isBelow(t.otherEvent.point)?-1:1}if(e.point[0]===t.point[0]){return e.point[1]<t.point[1]?-1:1}if(b(e,t)===1){return t.isAbove(e.point)?-1:1}return e.isBelow(t.point)?-1:1}if(e.isSubject===t.isSubject){var r=e.point,n=t.point;if(r[0]===n[0]&&r[1]===n[1]){r=e.otherEvent.point;n=t.otherEvent.point;if(r[0]===n[0]&&r[1]===n[1]){return 0}else{return e.contourId>t.contourId?1:-1}}}else{return e.isSubject?-1:1}return b(e,t)===1?1:-1}function O(e,t,r,n,i,o){var a=new m(T);var s=[];var u=Math.min(n[2],i[2]);var c,h,l;while(e.length!==0){var p=e.pop();s.push(p);if(o===g&&p.point[0]>u||o===_&&p.point[0]>n[2]){break}if(p.left){h=c=a.insert(p);l=a.minNode();if(c!==l){c=a.prev(c)}else{c=null}h=a.next(h);var f=c?c.key:null;var d=void 0;y(p,f,o);if(h){if(E(p,h.key,e)===2){y(p,f,o);y(p,h.key,o)}}if(c){if(E(c.key,p,e)===2){var v=c;if(v!==l){v=a.prev(v)}else{v=null}d=v?v.key:null;y(f,d,o);y(p,f,o)}}}else{p=p.otherEvent;h=c=a.find(p);if(c&&h){if(c!==l){c=a.prev(c)}else{c=null}h=a.next(h);a.remove(p);if(h&&c){E(c.key,h.key,e)}}}}return s}function P(e){var t,r,n,i;var o=[];for(r=0,n=e.length;r<n;r++){t=e[r];if(t.left&&t.inResult||!t.left&&t.otherEvent.inResult){o.push(t)}}var a=false;while(!a){a=true;for(r=0,n=o.length;r<n;r++){if(r+1<n&&b(o[r],o[r+1])===1){i=o[r];o[r]=o[r+1];o[r+1]=i;a=false}}}for(r=0,n=o.length;r<n;r++){t=o[r];t.pos=r}for(r=0,n=o.length;r<n;r++){t=o[r];if(!t.left){i=t.pos;t.pos=t.otherEvent.pos;t.otherEvent.pos=i}}return o}function A(e,t,r,n){var i,o;var a=e+1;var s=t.length;i=t[e].point;if(a<s){o=t[a].point}while(a<s&&o[0]===i[0]&&o[1]===i[1]){if(!r[a]){return a}else{a++}o=t[a].point}a=e-1;while(r[a]&&a>=n){a--}return a}function j(e,t){var r,n;var i=P(e);var o={};var a=[];var s;for(r=0,n=i.length;r<n;r++){if(o[r]){continue}var u=[[]];if(!i[r].isExteriorRing){if(t===_&&!i[r].isSubject&&a.length===0){a.push(u)}else if(a.length===0){a.push([[u]])}else{a[a.length-1].push(u[0])}}else if(t===_&&!i[r].isSubject&&a.length>1){a[a.length-1].push(u[0])}else{a.push(u)}var c=a.length-1;var h=r;var l=i[r].point;u[0].push(l);while(h>=r){s=i[h];o[h]=true;if(s.left){s.resultInOut=false;s.contourId=c}else{s.otherEvent.resultInOut=true;s.otherEvent.contourId=c}h=s.pos;o[h]=true;u[0].push(i[h].point);h=A(h,i,o,r)}h=h===-1?r:h;s=i[h];o[h]=o[s.pos]=true;s.otherEvent.resultInOut=true;s.otherEvent.contourId=c}return a}var R=k;var r=k;function k(e,t){var r=this;if(!(this instanceof k)){return new k(e,t)}this.data=e||[];this.length=this.data.length;this.compare=t||L;if(this.length>0){for(var n=(this.length>>1)-1;n>=0;n--){r._down(n)}}}function L(e,t){return e<t?-1:e>t?1:0}k.prototype={push:function(e){this.data.push(e);this.length++;this._up(this.length-1)},pop:function(){if(this.length===0){return undefined}var e=this.data[0];this.length--;if(this.length>0){this.data[0]=this.data[this.length];this._down(0)}this.data.pop();return e},peek:function(){return this.data[0]},_up:function(e){var t=this.data;var r=this.compare;var n=t[e];while(e>0){var i=e-1>>1;var o=t[i];if(r(n,o)>=0){break}t[e]=o;e=i}t[e]=n},_down:function(e){var t=this;var r=this.data;var n=this.compare;var i=this.length>>1;var o=r[e];while(e<i){var a=(e<<1)+1;var s=a+1;var u=r[a];if(s<t.length&&n(r[s],u)<0){a=s;u=r[s]}if(n(u,o)>=0){break}r[e]=u;e=a}r[e]=o}};R.default=r;var I=Math.max;var N=Math.min;var D=0;function B(e,t,r,n,i,o){var a,s,u,c,h,l;for(a=0,s=e.length-1;a<s;a++){u=e[a];c=e[a+1];h=new d(u,false,undefined,t);l=new d(c,false,h,t);h.otherEvent=l;if(u[0]===c[0]&&u[1]===c[1]){continue}h.contourId=l.contourId=r;if(!o){h.isExteriorRing=false;l.isExteriorRing=false}if(b(h,l)>0){l.left=true}else{h.left=true}var p=u[0],f=u[1];i[0]=N(i[0],p);i[1]=N(i[1],f);i[2]=I(i[2],p);i[3]=I(i[3],f);n.push(h);n.push(l)}}function F(e,t,r,n,i){var o=new R(null,b);var a,s,u,c,h,l;for(u=0,c=e.length;u<c;u++){a=e[u];for(h=0,l=a.length;h<l;h++){s=h===0;if(s){D++}B(a[h],true,D,o,r,s)}}for(u=0,c=t.length;u<c;u++){a=t[u];for(h=0,l=a.length;h<l;h++){s=h===0;if(i===_){s=false}if(s){D++}B(a[h],false,D,o,n,s)}}return o}var z=[];function $(e,t,r){var n=null;if(e.length*t.length===0){if(r===g){n=z}else if(r===_){n=e}else if(r===s||r===f){n=e.length===0?t:e}}return n}function U(e,t,r,n,i){var o=null;if(r[0]>n[2]||n[0]>r[2]||r[1]>n[3]||n[1]>r[3]){if(i===g){o=z}else if(i===_){o=e}else if(i===s||i===f){o=e.concat(t)}}return o}function G(e,t,r){if(typeof e[0][0][0]==="number"){e=[e]}if(typeof t[0][0][0]==="number"){t=[t]}var n=$(e,t,r);if(n){return n===z?null:n}var i=[Infinity,Infinity,-Infinity,-Infinity];var o=[Infinity,Infinity,-Infinity,-Infinity];var a=F(e,t,i,o,r);n=U(e,t,i,o,r);if(n){return n===z?null:n}var s=O(a,e,t,i,o,r);var u=j(s,r);return u}function V(e,t){return G(e,t,s)}function H(e,t){return G(e,t,_)}function q(e,t){return G(e,t,f)}function W(e,t){return G(e,t,g)}var X={UNION:s,DIFFERENCE:_,INTERSECTION:g,XOR:f};e.union=V;e.diff=H;e.xor=q;e.intersection=W;e.operations=X;Object.defineProperty(e,"__esModule",{value:true})})},{}],23:[function(e,t,r){"use strict";var n=e("./lib/utils/common").assign;var i=e("./lib/deflate");var o=e("./lib/inflate");var a=e("./lib/zlib/constants");var s={};n(s,i,o,a);t.exports=s},{"./lib/deflate":24,"./lib/inflate":25,"./lib/utils/common":26,"./lib/zlib/constants":29}],24:[function(e,t,r){"use strict";var a=e("./zlib/deflate");var s=e("./utils/common");var u=e("./utils/strings");var i=e("./zlib/messages");var o=e("./zlib/zstream");var c=Object.prototype.toString;var h=0;var l=4;var p=0;var f=1;var d=2;var v=-1;var m=0;var g=8;function _(e){if(!(this instanceof _))return new _(e);this.options=s.assign({level:v,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:m,to:""},e||{});var t=this.options;if(t.raw&&t.windowBits>0){t.windowBits=-t.windowBits}else if(t.gzip&&t.windowBits>0&&t.windowBits<16){t.windowBits+=16}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new o;this.strm.avail_out=0;var r=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==p){throw new Error(i[r])}if(t.header){a.deflateSetHeader(this.strm,t.header)}if(t.dictionary){var n;if(typeof t.dictionary==="string"){n=u.string2buf(t.dictionary)}else if(c.call(t.dictionary)==="[object ArrayBuffer]"){n=new Uint8Array(t.dictionary)}else{n=t.dictionary}r=a.deflateSetDictionary(this.strm,n);if(r!==p){throw new Error(i[r])}this._dict_set=true}}_.prototype.push=function(e,t){var r=this.strm;var n=this.options.chunkSize;var i,o;if(this.ended){return false}o=t===~~t?t:t===true?l:h;if(typeof e==="string"){r.input=u.string2buf(e)}else if(c.call(e)==="[object ArrayBuffer]"){r.input=new Uint8Array(e)}else{r.input=e}r.next_in=0;r.avail_in=r.input.length;do{if(r.avail_out===0){r.output=new s.Buf8(n);r.next_out=0;r.avail_out=n}i=a.deflate(r,o);if(i!==f&&i!==p){this.onEnd(i);this.ended=true;return false}if(r.avail_out===0||r.avail_in===0&&(o===l||o===d)){if(this.options.to==="string"){this.onData(u.buf2binstring(s.shrinkBuf(r.output,r.next_out)))}else{this.onData(s.shrinkBuf(r.output,r.next_out))}}}while((r.avail_in>0||r.avail_out===0)&&i!==f);if(o===l){i=a.deflateEnd(this.strm);this.onEnd(i);this.ended=true;return i===p}if(o===d){this.onEnd(p);r.avail_out=0;return true}return true};_.prototype.onData=function(e){this.chunks.push(e)};_.prototype.onEnd=function(e){if(e===p){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=s.flattenChunks(this.chunks)}}this.chunks=[];this.err=e;this.msg=this.strm.msg};function n(e,t){var r=new _(t);r.push(e,true);if(r.err){throw r.msg||i[r.err]}return r.result}function y(e,t){t=t||{};t.raw=true;return n(e,t)}function b(e,t){t=t||{};t.gzip=true;return n(e,t)}r.Deflate=_;r.deflate=n;r.deflateRaw=y;r.gzip=b},{"./utils/common":26,"./utils/strings":27,"./zlib/deflate":31,"./zlib/messages":36,"./zlib/zstream":38}],25:[function(e,t,r){"use strict";var l=e("./zlib/inflate");var p=e("./utils/common");var f=e("./utils/strings");var d=e("./zlib/constants");var n=e("./zlib/messages");var i=e("./zlib/zstream");var o=e("./zlib/gzheader");var v=Object.prototype.toString;function a(e){if(!(this instanceof a))return new a(e);this.options=p.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;if(t.raw&&t.windowBits>=0&&t.windowBits<16){t.windowBits=-t.windowBits;if(t.windowBits===0){t.windowBits=-15}}if(t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)){t.windowBits+=32}if(t.windowBits>15&&t.windowBits<48){if((t.windowBits&15)===0){t.windowBits|=15}}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new i;this.strm.avail_out=0;var r=l.inflateInit2(this.strm,t.windowBits);if(r!==d.Z_OK){throw new Error(n[r])}this.header=new o;l.inflateGetHeader(this.strm,this.header);if(t.dictionary){if(typeof t.dictionary==="string"){t.dictionary=f.string2buf(t.dictionary)}else if(v.call(t.dictionary)==="[object ArrayBuffer]"){t.dictionary=new Uint8Array(t.dictionary)}if(t.raw){r=l.inflateSetDictionary(this.strm,t.dictionary);if(r!==d.Z_OK){throw new Error(n[r])}}}}a.prototype.push=function(e,t){var r=this.strm;var n=this.options.chunkSize;var i=this.options.dictionary;var o,a;var s,u,c;var h=false;if(this.ended){return false}a=t===~~t?t:t===true?d.Z_FINISH:d.Z_NO_FLUSH;if(typeof e==="string"){r.input=f.binstring2buf(e)}else if(v.call(e)==="[object ArrayBuffer]"){r.input=new Uint8Array(e)}else{r.input=e}r.next_in=0;r.avail_in=r.input.length;do{if(r.avail_out===0){r.output=new p.Buf8(n);r.next_out=0;r.avail_out=n}o=l.inflate(r,d.Z_NO_FLUSH);if(o===d.Z_NEED_DICT&&i){o=l.inflateSetDictionary(this.strm,i)}if(o===d.Z_BUF_ERROR&&h===true){o=d.Z_OK;h=false}if(o!==d.Z_STREAM_END&&o!==d.Z_OK){this.onEnd(o);this.ended=true;return false}if(r.next_out){if(r.avail_out===0||o===d.Z_STREAM_END||r.avail_in===0&&(a===d.Z_FINISH||a===d.Z_SYNC_FLUSH)){if(this.options.to==="string"){s=f.utf8border(r.output,r.next_out);u=r.next_out-s;c=f.buf2string(r.output,s);r.next_out=u;r.avail_out=n-u;if(u){p.arraySet(r.output,r.output,s,u,0)}this.onData(c)}else{this.onData(p.shrinkBuf(r.output,r.next_out))}}}if(r.avail_in===0&&r.avail_out===0){h=true}}while((r.avail_in>0||r.avail_out===0)&&o!==d.Z_STREAM_END);if(o===d.Z_STREAM_END){a=d.Z_FINISH}if(a===d.Z_FINISH){o=l.inflateEnd(this.strm);this.onEnd(o);this.ended=true;return o===d.Z_OK}if(a===d.Z_SYNC_FLUSH){this.onEnd(d.Z_OK);r.avail_out=0;return true}return true};a.prototype.onData=function(e){this.chunks.push(e)};a.prototype.onEnd=function(e){if(e===d.Z_OK){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=p.flattenChunks(this.chunks)}}this.chunks=[];this.err=e;this.msg=this.strm.msg};function s(e,t){var r=new a(t);r.push(e,true);if(r.err){throw r.msg||n[r.err]}return r.result}function u(e,t){t=t||{};t.raw=true;return s(e,t)}r.Inflate=a;r.inflate=s;r.inflateRaw=u;r.ungzip=s},{"./utils/common":26,"./utils/strings":27,"./zlib/constants":29,"./zlib/gzheader":32,"./zlib/inflate":34,"./zlib/messages":36,"./zlib/zstream":38}],26:[function(e,t,r){"use strict";var n=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}r.assign=function(e){var t=Array.prototype.slice.call(arguments,1);while(t.length){var r=t.shift();if(!r){continue}if(typeof r!=="object"){throw new TypeError(r+"must be non-object")}for(var n in r){if(i(r,n)){e[n]=r[n]}}}return e};r.shrinkBuf=function(e,t){if(e.length===t){return e}if(e.subarray){return e.subarray(0,t)}e.length=t;return e};var o={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray){e.set(t.subarray(r,r+n),i);return}for(var o=0;o<n;o++){e[i+o]=t[r+o]}},flattenChunks:function(e){var t,r,n,i,o,a;n=0;for(t=0,r=e.length;t<r;t++){n+=e[t].length}a=new Uint8Array(n);i=0;for(t=0,r=e.length;t<r;t++){o=e[t];a.set(o,i);i+=o.length}return a}};var a={arraySet:function(e,t,r,n,i){for(var o=0;o<n;o++){e[i+o]=t[r+o]}},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){if(e){r.Buf8=Uint8Array;r.Buf16=Uint16Array;r.Buf32=Int32Array;r.assign(r,o)}else{r.Buf8=Array;r.Buf16=Array;r.Buf32=Array;r.assign(r,a)}};r.setTyped(n)},{}],27:[function(e,t,r){"use strict";var u=e("./common");var i=true;var o=true;try{String.fromCharCode.apply(null,[0])}catch(e){i=false}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=false}var c=new u.Buf8(256);for(var n=0;n<256;n++){c[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1}c[254]=c[254]=1;r.string2buf=function(e){var t,r,n,i,o,a=e.length,s=0;for(i=0;i<a;i++){r=e.charCodeAt(i);if((r&64512)===55296&&i+1<a){n=e.charCodeAt(i+1);if((n&64512)===56320){r=65536+(r-55296<<10)+(n-56320);i++}}s+=r<128?1:r<2048?2:r<65536?3:4}t=new u.Buf8(s);for(o=0,i=0;o<s;i++){r=e.charCodeAt(i);if((r&64512)===55296&&i+1<a){n=e.charCodeAt(i+1);if((n&64512)===56320){r=65536+(r-55296<<10)+(n-56320);i++}}if(r<128){t[o++]=r}else if(r<2048){t[o++]=192|r>>>6;t[o++]=128|r&63}else if(r<65536){t[o++]=224|r>>>12;t[o++]=128|r>>>6&63;t[o++]=128|r&63}else{t[o++]=240|r>>>18;t[o++]=128|r>>>12&63;t[o++]=128|r>>>6&63;t[o++]=128|r&63}}return t};function h(e,t){if(t<65534){if(e.subarray&&o||!e.subarray&&i){return String.fromCharCode.apply(null,u.shrinkBuf(e,t))}}var r="";for(var n=0;n<t;n++){r+=String.fromCharCode(e[n])}return r}r.buf2binstring=function(e){return h(e,e.length)};r.binstring2buf=function(e){var t=new u.Buf8(e.length);for(var r=0,n=t.length;r<n;r++){t[r]=e.charCodeAt(r)}return t};r.buf2string=function(e,t){var r,n,i,o;var a=t||e.length;var s=new Array(a*2);for(n=0,r=0;r<a;){i=e[r++];if(i<128){s[n++]=i;continue}o=c[i];if(o>4){s[n++]=65533;r+=o-1;continue}i&=o===2?31:o===3?15:7;while(o>1&&r<a){i=i<<6|e[r++]&63;o--}if(o>1){s[n++]=65533;continue}if(i<65536){s[n++]=i}else{i-=65536;s[n++]=55296|i>>10&1023;s[n++]=56320|i&1023}}return h(s,n)};r.utf8border=function(e,t){var r;t=t||e.length;if(t>e.length){t=e.length}r=t-1;while(r>=0&&(e[r]&192)===128){r--}if(r<0){return t}if(r===0){return t}return r+c[e[r]]>t?r:t}},{"./common":26}],28:[function(e,t,r){"use strict";function n(e,t,r,n){var i=e&65535|0,o=e>>>16&65535|0,a=0;while(r!==0){a=r>2e3?2e3:r;r-=a;do{i=i+t[n++]|0;o=o+i|0}while(--a);i%=65521;o%=65521}return i|o<<16|0}t.exports=n},{}],29:[function(e,t,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],30:[function(e,t,r){"use strict";function n(){var e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++){e=e&1?3988292384^e>>>1:e>>>1}t[r]=e}return t}var s=n();function i(e,t,r,n){var i=s,o=n+r;e^=-1;for(var a=n;a<o;a++){e=e>>>8^i[(e^t[a])&255]}return e^-1}t.exports=i},{}],31:[function(e,t,r){"use strict";var l=e("../utils/common");var c=e("./trees");var p=e("./adler32");var h=e("./crc32");var n=e("./messages");var f=0;var d=1;var v=3;var m=4;var g=5;var _=0;var y=1;var b=-2;var i=-3;var w=-5;var u=-1;var o=1;var x=2;var S=3;var M=4;var a=0;var s=2;var C=8;var E=9;var T=15;var O=8;var P=29;var A=256;var j=A+1+P;var R=30;var k=19;var L=2*j+1;var I=15;var N=3;var D=258;var B=D+N+1;var F=32;var z=42;var $=69;var U=73;var G=91;var V=103;var H=113;var q=666;var W=1;var X=2;var Y=3;var K=4;var Z=3;function J(e,t){e.msg=n[t];return t}function Q(e){return(e<<1)-(e>4?9:0)}function ee(e){var t=e.length;while(--t>=0){e[t]=0}}function te(e){var t=e.state;var r=t.pending;if(r>e.avail_out){r=e.avail_out}if(r===0){return}l.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out);e.next_out+=r;t.pending_out+=r;e.total_out+=r;e.avail_out-=r;t.pending-=r;if(t.pending===0){t.pending_out=0}}function re(e,t){c._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t);e.block_start=e.strstart;te(e.strm)}function ne(e,t){e.pending_buf[e.pending++]=t}function ie(e,t){e.pending_buf[e.pending++]=t>>>8&255;e.pending_buf[e.pending++]=t&255}function oe(e,t,r,n){var i=e.avail_in;if(i>n){i=n}if(i===0){return 0}e.avail_in-=i;l.arraySet(t,e.input,e.next_in,i,r);if(e.state.wrap===1){e.adler=p(e.adler,t,i,r)}else if(e.state.wrap===2){e.adler=h(e.adler,t,i,r)}e.next_in+=i;e.total_in+=i;return i}function ae(e,t){var r=e.max_chain_length;var n=e.strstart;var i;var o;var a=e.prev_length;var s=e.nice_match;var u=e.strstart>e.w_size-B?e.strstart-(e.w_size-B):0;var c=e.window;var h=e.w_mask;var l=e.prev;var p=e.strstart+D;var f=c[n+a-1];var d=c[n+a];if(e.prev_length>=e.good_match){r>>=2}if(s>e.lookahead){s=e.lookahead}do{i=t;if(c[i+a]!==d||c[i+a-1]!==f||c[i]!==c[n]||c[++i]!==c[n+1]){continue}n+=2;i++;do{}while(c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&c[++n]===c[++i]&&n<p);o=D-(p-n);n=p-D;if(o>a){e.match_start=t;a=o;if(o>=s){break}f=c[n+a-1];d=c[n+a]}}while((t=l[t&h])>u&&--r!==0);if(a<=e.lookahead){return a}return e.lookahead}function se(e){var t=e.w_size;var r,n,i,o,a;do{o=e.window_size-e.lookahead-e.strstart;if(e.strstart>=t+(t-B)){l.arraySet(e.window,e.window,t,t,0);e.match_start-=t;e.strstart-=t;e.block_start-=t;n=e.hash_size;r=n;do{i=e.head[--r];e.head[r]=i>=t?i-t:0}while(--n);n=t;r=n;do{i=e.prev[--r];e.prev[r]=i>=t?i-t:0}while(--n);o+=t}if(e.strm.avail_in===0){break}n=oe(e.strm,e.window,e.strstart+e.lookahead,o);e.lookahead+=n;if(e.lookahead+e.insert>=N){a=e.strstart-e.insert;e.ins_h=e.window[a];e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;while(e.insert){e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+N-1])&e.hash_mask;e.prev[a&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=a;a++;e.insert--;if(e.lookahead+e.insert<N){break}}}}while(e.lookahead<B&&e.strm.avail_in!==0)}function ue(e,t){var r=65535;if(r>e.pending_buf_size-5){r=e.pending_buf_size-5}for(;;){if(e.lookahead<=1){se(e);if(e.lookahead===0&&t===f){return W}if(e.lookahead===0){break}}e.strstart+=e.lookahead;e.lookahead=0;var n=e.block_start+r;if(e.strstart===0||e.strstart>=n){e.lookahead=e.strstart-n;e.strstart=n;re(e,false);if(e.strm.avail_out===0){return W}}if(e.strstart-e.block_start>=e.w_size-B){re(e,false);if(e.strm.avail_out===0){return W}}}e.insert=0;if(t===m){re(e,true);if(e.strm.avail_out===0){return Y}return K}if(e.strstart>e.block_start){re(e,false);if(e.strm.avail_out===0){return W}}return W}function ce(e,t){var r;var n;for(;;){if(e.lookahead<B){se(e);if(e.lookahead<B&&t===f){return W}if(e.lookahead===0){break}}r=0;if(e.lookahead>=N){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask;r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}if(r!==0&&e.strstart-r<=e.w_size-B){e.match_length=ae(e,r)}if(e.match_length>=N){n=c._tr_tally(e,e.strstart-e.match_start,e.match_length-N);e.lookahead-=e.match_length;if(e.match_length<=e.max_lazy_match&&e.lookahead>=N){e.match_length--;do{e.strstart++;e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask;r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}while(--e.match_length!==0);e.strstart++}else{e.strstart+=e.match_length;e.match_length=0;e.ins_h=e.window[e.strstart];e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask}}else{n=c._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++}if(n){re(e,false);if(e.strm.avail_out===0){return W}}}e.insert=e.strstart<N-1?e.strstart:N-1;if(t===m){re(e,true);if(e.strm.avail_out===0){return Y}return K}if(e.last_lit){re(e,false);if(e.strm.avail_out===0){return W}}return X}function he(e,t){var r;var n;var i;for(;;){if(e.lookahead<B){se(e);if(e.lookahead<B&&t===f){return W}if(e.lookahead===0){break}}r=0;if(e.lookahead>=N){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask;r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}e.prev_length=e.match_length;e.prev_match=e.match_start;e.match_length=N-1;if(r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-B){e.match_length=ae(e,r);if(e.match_length<=5&&(e.strategy===o||e.match_length===N&&e.strstart-e.match_start>4096)){e.match_length=N-1}}if(e.prev_length>=N&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-N;n=c._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-N);e.lookahead-=e.prev_length-1;e.prev_length-=2;do{if(++e.strstart<=i){e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+N-1])&e.hash_mask;r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h];e.head[e.ins_h]=e.strstart}}while(--e.prev_length!==0);e.match_available=0;e.match_length=N-1;e.strstart++;if(n){re(e,false);if(e.strm.avail_out===0){return W}}}else if(e.match_available){n=c._tr_tally(e,0,e.window[e.strstart-1]);if(n){re(e,false)}e.strstart++;e.lookahead--;if(e.strm.avail_out===0){return W}}else{e.match_available=1;e.strstart++;e.lookahead--}}if(e.match_available){n=c._tr_tally(e,0,e.window[e.strstart-1]);e.match_available=0}e.insert=e.strstart<N-1?e.strstart:N-1;if(t===m){re(e,true);if(e.strm.avail_out===0){return Y}return K}if(e.last_lit){re(e,false);if(e.strm.avail_out===0){return W}}return X}function le(e,t){var r;var n;var i,o;var a=e.window;for(;;){if(e.lookahead<=D){se(e);if(e.lookahead<=D&&t===f){return W}if(e.lookahead===0){break}}e.match_length=0;if(e.lookahead>=N&&e.strstart>0){i=e.strstart-1;n=a[i];if(n===a[++i]&&n===a[++i]&&n===a[++i]){o=e.strstart+D;do{}while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<o);e.match_length=D-(o-i);if(e.match_length>e.lookahead){e.match_length=e.lookahead}}}if(e.match_length>=N){r=c._tr_tally(e,1,e.match_length-N);e.lookahead-=e.match_length;e.strstart+=e.match_length;e.match_length=0}else{r=c._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++}if(r){re(e,false);if(e.strm.avail_out===0){return W}}}e.insert=0;if(t===m){re(e,true);if(e.strm.avail_out===0){return Y}return K}if(e.last_lit){re(e,false);if(e.strm.avail_out===0){return W}}return X}function pe(e,t){var r;for(;;){if(e.lookahead===0){se(e);if(e.lookahead===0){if(t===f){return W}break}}e.match_length=0;r=c._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++;if(r){re(e,false);if(e.strm.avail_out===0){return W}}}e.insert=0;if(t===m){re(e,true);if(e.strm.avail_out===0){return Y}return K}if(e.last_lit){re(e,false);if(e.strm.avail_out===0){return W}}return X}function fe(e,t,r,n,i){this.good_length=e;this.max_lazy=t;this.nice_length=r;this.max_chain=n;this.func=i}var de;de=[new fe(0,0,0,0,ue),new fe(4,4,8,4,ce),new fe(4,5,16,8,ce),new fe(4,6,32,32,ce),new fe(4,4,16,16,he),new fe(8,16,32,32,he),new fe(8,16,128,128,he),new fe(8,32,128,256,he),new fe(32,128,258,1024,he),new fe(32,258,258,4096,he)];function ve(e){e.window_size=2*e.w_size;ee(e.head);e.max_lazy_match=de[e.level].max_lazy;e.good_match=de[e.level].good_length;e.nice_match=de[e.level].nice_length;e.max_chain_length=de[e.level].max_chain;e.strstart=0;e.block_start=0;e.lookahead=0;e.insert=0;e.match_length=e.prev_length=N-1;e.match_available=0;e.ins_h=0}function me(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=C;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new l.Buf16(L*2);this.dyn_dtree=new l.Buf16((2*R+1)*2);this.bl_tree=new l.Buf16((2*k+1)*2);ee(this.dyn_ltree);ee(this.dyn_dtree);ee(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new l.Buf16(I+1);this.heap=new l.Buf16(2*j+1);ee(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new l.Buf16(2*j+1);ee(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function ge(e){var t;if(!e||!e.state){return J(e,b)}e.total_in=e.total_out=0;e.data_type=s;t=e.state;t.pending=0;t.pending_out=0;if(t.wrap<0){t.wrap=-t.wrap}t.status=t.wrap?z:H;e.adler=t.wrap===2?0:1;t.last_flush=f;c._tr_init(t);return _}function _e(e){var t=ge(e);if(t===_){ve(e.state)}return t}function ye(e,t){if(!e||!e.state){return b}if(e.state.wrap!==2){return b}e.state.gzhead=t;return _}function be(e,t,r,n,i,o){if(!e){return b}var a=1;if(t===u){t=6}if(n<0){a=0;n=-n}else if(n>15){a=2;n-=16}if(i<1||i>E||r!==C||n<8||n>15||t<0||t>9||o<0||o>M){return J(e,b)}if(n===8){n=9}var s=new me;e.state=s;s.strm=e;s.wrap=a;s.gzhead=null;s.w_bits=n;s.w_size=1<<s.w_bits;s.w_mask=s.w_size-1;s.hash_bits=i+7;s.hash_size=1<<s.hash_bits;s.hash_mask=s.hash_size-1;s.hash_shift=~~((s.hash_bits+N-1)/N);s.window=new l.Buf8(s.w_size*2);s.head=new l.Buf16(s.hash_size);s.prev=new l.Buf16(s.w_size);s.lit_bufsize=1<<i+6;s.pending_buf_size=s.lit_bufsize*4;s.pending_buf=new l.Buf8(s.pending_buf_size);s.d_buf=1*s.lit_bufsize;s.l_buf=(1+2)*s.lit_bufsize;s.level=t;s.strategy=o;s.method=r;return _e(e)}function we(e,t){return be(e,t,C,T,O,a)}function xe(e,t){var r,n;var i,o;if(!e||!e.state||t>g||t<0){return e?J(e,b):b}n=e.state;if(!e.output||!e.input&&e.avail_in!==0||n.status===q&&t!==m){return J(e,e.avail_out===0?w:b)}n.strm=e;r=n.last_flush;n.last_flush=t;if(n.status===z){if(n.wrap===2){e.adler=0;ne(n,31);ne(n,139);ne(n,8);if(!n.gzhead){ne(n,0);ne(n,0);ne(n,0);ne(n,0);ne(n,0);ne(n,n.level===9?2:n.strategy>=x||n.level<2?4:0);ne(n,Z);n.status=H}else{ne(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(!n.gzhead.extra?0:4)+(!n.gzhead.name?0:8)+(!n.gzhead.comment?0:16));ne(n,n.gzhead.time&255);ne(n,n.gzhead.time>>8&255);ne(n,n.gzhead.time>>16&255);ne(n,n.gzhead.time>>24&255);ne(n,n.level===9?2:n.strategy>=x||n.level<2?4:0);ne(n,n.gzhead.os&255);if(n.gzhead.extra&&n.gzhead.extra.length){ne(n,n.gzhead.extra.length&255);ne(n,n.gzhead.extra.length>>8&255)}if(n.gzhead.hcrc){e.adler=h(e.adler,n.pending_buf,n.pending,0)}n.gzindex=0;n.status=$}}else{var a=C+(n.w_bits-8<<4)<<8;var s=-1;if(n.strategy>=x||n.level<2){s=0}else if(n.level<6){s=1}else if(n.level===6){s=2}else{s=3}a|=s<<6;if(n.strstart!==0){a|=F}a+=31-a%31;n.status=H;ie(n,a);if(n.strstart!==0){ie(n,e.adler>>>16);ie(n,e.adler&65535)}e.adler=1}}if(n.status===$){if(n.gzhead.extra){i=n.pending;while(n.gzindex<(n.gzhead.extra.length&65535)){if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i){e.adler=h(e.adler,n.pending_buf,n.pending-i,i)}te(e);i=n.pending;if(n.pending===n.pending_buf_size){break}}ne(n,n.gzhead.extra[n.gzindex]&255);n.gzindex++}if(n.gzhead.hcrc&&n.pending>i){e.adler=h(e.adler,n.pending_buf,n.pending-i,i)}if(n.gzindex===n.gzhead.extra.length){n.gzindex=0;n.status=U}}else{n.status=U}}if(n.status===U){if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i){e.adler=h(e.adler,n.pending_buf,n.pending-i,i)}te(e);i=n.pending;if(n.pending===n.pending_buf_size){o=1;break}}if(n.gzindex<n.gzhead.name.length){o=n.gzhead.name.charCodeAt(n.gzindex++)&255}else{o=0}ne(n,o)}while(o!==0);if(n.gzhead.hcrc&&n.pending>i){e.adler=h(e.adler,n.pending_buf,n.pending-i,i)}if(o===0){n.gzindex=0;n.status=G}}else{n.status=G}}if(n.status===G){if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i){e.adler=h(e.adler,n.pending_buf,n.pending-i,i)}te(e);i=n.pending;if(n.pending===n.pending_buf_size){o=1;break}}if(n.gzindex<n.gzhead.comment.length){o=n.gzhead.comment.charCodeAt(n.gzindex++)&255}else{o=0}ne(n,o)}while(o!==0);if(n.gzhead.hcrc&&n.pending>i){e.adler=h(e.adler,n.pending_buf,n.pending-i,i)}if(o===0){n.status=V}}else{n.status=V}}if(n.status===V){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size){te(e)}if(n.pending+2<=n.pending_buf_size){ne(n,e.adler&255);ne(n,e.adler>>8&255);e.adler=0;n.status=H}}else{n.status=H}}if(n.pending!==0){te(e);if(e.avail_out===0){n.last_flush=-1;return _}}else if(e.avail_in===0&&Q(t)<=Q(r)&&t!==m){return J(e,w)}if(n.status===q&&e.avail_in!==0){return J(e,w)}if(e.avail_in!==0||n.lookahead!==0||t!==f&&n.status!==q){var u=n.strategy===x?pe(n,t):n.strategy===S?le(n,t):de[n.level].func(n,t);if(u===Y||u===K){n.status=q}if(u===W||u===Y){if(e.avail_out===0){n.last_flush=-1}return _}if(u===X){if(t===d){c._tr_align(n)}else if(t!==g){c._tr_stored_block(n,0,0,false);if(t===v){ee(n.head);if(n.lookahead===0){n.strstart=0;n.block_start=0;n.insert=0}}}te(e);if(e.avail_out===0){n.last_flush=-1;return _}}}if(t!==m){return _}if(n.wrap<=0){return y}if(n.wrap===2){ne(n,e.adler&255);ne(n,e.adler>>8&255);ne(n,e.adler>>16&255);ne(n,e.adler>>24&255);ne(n,e.total_in&255);ne(n,e.total_in>>8&255);ne(n,e.total_in>>16&255);ne(n,e.total_in>>24&255)}else{ie(n,e.adler>>>16);ie(n,e.adler&65535)}te(e);if(n.wrap>0){n.wrap=-n.wrap}return n.pending!==0?_:y}function Se(e){var t;if(!e||!e.state){return b}t=e.state.status;if(t!==z&&t!==$&&t!==U&&t!==G&&t!==V&&t!==H&&t!==q){return J(e,b)}e.state=null;return t===H?J(e,i):_}function Me(e,t){var r=t.length;var n;var i,o;var a;var s;var u;var c;var h;if(!e||!e.state){return b}n=e.state;a=n.wrap;if(a===2||a===1&&n.status!==z||n.lookahead){return b}if(a===1){e.adler=p(e.adler,t,r,0)}n.wrap=0;if(r>=n.w_size){if(a===0){ee(n.head);n.strstart=0;n.block_start=0;n.insert=0}h=new l.Buf8(n.w_size);l.arraySet(h,t,r-n.w_size,n.w_size,0);t=h;r=n.w_size}s=e.avail_in;u=e.next_in;c=e.input;e.avail_in=r;e.next_in=0;e.input=t;se(n);while(n.lookahead>=N){i=n.strstart;o=n.lookahead-(N-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+N-1])&n.hash_mask;n.prev[i&n.w_mask]=n.head[n.ins_h];n.head[n.ins_h]=i;i++}while(--o);n.strstart=i;n.lookahead=N-1;se(n)}n.strstart+=n.lookahead;n.block_start=n.strstart;n.insert=n.lookahead;n.lookahead=0;n.match_length=n.prev_length=N-1;n.match_available=0;e.next_in=u;e.input=c;e.avail_in=s;n.wrap=a;return _}r.deflateInit=we;r.deflateInit2=be;r.deflateReset=_e;r.deflateResetKeep=ge;r.deflateSetHeader=ye;r.deflate=xe;r.deflateEnd=Se;r.deflateSetDictionary=Me;r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":26,"./adler32":28,"./crc32":30,"./messages":36,"./trees":37}],32:[function(e,t,r){"use strict";function n(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=false}t.exports=n},{}],33:[function(e,t,r){"use strict";var O=30;var P=12;t.exports=function e(t,r){var n;var i;var o;var a;var s;var u;var c;var h;var l;var p;var f;var d;var v;var m;var g;var _;var y;var b;var w;var x;var S;var M;var C;var E,T;n=t.state;i=t.next_in;E=t.input;o=i+(t.avail_in-5);a=t.next_out;T=t.output;s=a-(r-t.avail_out);u=a+(t.avail_out-257);c=n.dmax;h=n.wsize;l=n.whave;p=n.wnext;f=n.window;d=n.hold;v=n.bits;m=n.lencode;g=n.distcode;_=(1<<n.lenbits)-1;y=(1<<n.distbits)-1;e:do{if(v<15){d+=E[i++]<<v;v+=8;d+=E[i++]<<v;v+=8}b=m[d&_];t:for(;;){w=b>>>24;d>>>=w;v-=w;w=b>>>16&255;if(w===0){T[a++]=b&65535}else if(w&16){x=b&65535;w&=15;if(w){if(v<w){d+=E[i++]<<v;v+=8}x+=d&(1<<w)-1;d>>>=w;v-=w}if(v<15){d+=E[i++]<<v;v+=8;d+=E[i++]<<v;v+=8}b=g[d&y];r:for(;;){w=b>>>24;d>>>=w;v-=w;w=b>>>16&255;if(w&16){S=b&65535;w&=15;if(v<w){d+=E[i++]<<v;v+=8;if(v<w){d+=E[i++]<<v;v+=8}}S+=d&(1<<w)-1;if(S>c){t.msg="invalid distance too far back";n.mode=O;break e}d>>>=w;v-=w;w=a-s;if(S>w){w=S-w;if(w>l){if(n.sane){t.msg="invalid distance too far back";n.mode=O;break e}}M=0;C=f;if(p===0){M+=h-w;if(w<x){x-=w;do{T[a++]=f[M++]}while(--w);M=a-S;C=T}}else if(p<w){M+=h+p-w;w-=p;if(w<x){x-=w;do{T[a++]=f[M++]}while(--w);M=0;if(p<x){w=p;x-=w;do{T[a++]=f[M++]}while(--w);M=a-S;C=T}}}else{M+=p-w;if(w<x){x-=w;do{T[a++]=f[M++]}while(--w);M=a-S;C=T}}while(x>2){T[a++]=C[M++];T[a++]=C[M++];T[a++]=C[M++];x-=3}if(x){T[a++]=C[M++];if(x>1){T[a++]=C[M++]}}}else{M=a-S;do{T[a++]=T[M++];T[a++]=T[M++];T[a++]=T[M++];x-=3}while(x>2);if(x){T[a++]=T[M++];if(x>1){T[a++]=T[M++]}}}}else if((w&64)===0){b=g[(b&65535)+(d&(1<<w)-1)];continue r}else{t.msg="invalid distance code";n.mode=O;break e}break}}else if((w&64)===0){b=m[(b&65535)+(d&(1<<w)-1)];continue t}else if(w&32){n.mode=P;break e}else{t.msg="invalid literal/length code";n.mode=O;break e}break}}while(i<o&&a<u);x=v>>3;i-=x;v-=x<<3;d&=(1<<v)-1;t.next_in=i;t.next_out=a;t.avail_in=i<o?5+(o-i):5-(i-o);t.avail_out=a<u?257+(u-a):257-(a-u);n.hold=d;n.bits=v;return}},{}],34:[function(e,t,r){"use strict";var P=e("../utils/common");var A=e("./adler32");var j=e("./crc32");var R=e("./inffast");var k=e("./inftrees");var L=0;var I=1;var N=2;var D=4;var B=5;var F=6;var z=0;var $=1;var U=2;var G=-2;var V=-3;var H=-4;var q=-5;var W=8;var X=1;var Y=2;var K=3;var Z=4;var J=5;var Q=6;var ee=7;var te=8;var re=9;var ne=10;var ie=11;var oe=12;var ae=13;var se=14;var ue=15;var ce=16;var he=17;var le=18;var pe=19;var fe=20;var de=21;var ve=22;var me=23;var ge=24;var _e=25;var ye=26;var be=27;var we=28;var xe=29;var Se=30;var Me=31;var Ce=32;var n=852;var i=592;var o=15;var a=o;function Ee(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function s(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new P.Buf16(320);this.work=new P.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function u(e){var t;if(!e||!e.state){return G}t=e.state;e.total_in=e.total_out=t.total=0;e.msg="";if(t.wrap){e.adler=t.wrap&1}t.mode=X;t.last=0;t.havedict=0;t.dmax=32768;t.head=null;t.hold=0;t.bits=0;t.lencode=t.lendyn=new P.Buf32(n);t.distcode=t.distdyn=new P.Buf32(i);t.sane=1;t.back=-1;return z}function c(e){var t;if(!e||!e.state){return G}t=e.state;t.wsize=0;t.whave=0;t.wnext=0;return u(e)}function h(e,t){var r;var n;if(!e||!e.state){return G}n=e.state;if(t<0){r=0;t=-t}else{r=(t>>4)+1;if(t<48){t&=15}}if(t&&(t<8||t>15)){return G}if(n.window!==null&&n.wbits!==t){n.window=null}n.wrap=r;n.wbits=t;return c(e)}function l(e,t){var r;var n;if(!e){return G}n=new s;e.state=n;n.window=null;r=h(e,t);if(r!==z){e.state=null}return r}function p(e){return l(e,a)}var f=true;var d,v;function Te(e){if(f){var t;d=new P.Buf32(512);v=new P.Buf32(32);t=0;while(t<144){e.lens[t++]=8}while(t<256){e.lens[t++]=9}while(t<280){e.lens[t++]=7}while(t<288){e.lens[t++]=8}k(I,e.lens,0,288,d,0,e.work,{bits:9});t=0;while(t<32){e.lens[t++]=5}k(N,e.lens,0,32,v,0,e.work,{bits:5});f=false}e.lencode=d;e.lenbits=9;e.distcode=v;e.distbits=5}function Oe(e,t,r,n){var i;var o=e.state;if(o.window===null){o.wsize=1<<o.wbits;o.wnext=0;o.whave=0;o.window=new P.Buf8(o.wsize)}if(n>=o.wsize){P.arraySet(o.window,t,r-o.wsize,o.wsize,0);o.wnext=0;o.whave=o.wsize}else{i=o.wsize-o.wnext;if(i>n){i=n}P.arraySet(o.window,t,r-n,i,o.wnext);n-=i;if(n){P.arraySet(o.window,t,r-n,n,0);o.wnext=n;o.whave=o.wsize}else{o.wnext+=i;if(o.wnext===o.wsize){o.wnext=0}if(o.whave<o.wsize){o.whave+=i}}}return 0}function m(e,t){var r;var n,i;var o;var a;var s,u;var c;var h;var l,p;var f;var d;var v;var m=0;var g,_,y;var b,w,x;var S;var M;var C=new P.Buf8(4);var E;var T;var O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0){return G}r=e.state;if(r.mode===oe){r.mode=ae}a=e.next_out;i=e.output;u=e.avail_out;o=e.next_in;n=e.input;s=e.avail_in;c=r.hold;h=r.bits;l=s;p=u;M=z;e:for(;;){switch(r.mode){case X:if(r.wrap===0){r.mode=ae;break}while(h<16){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}if(r.wrap&2&&c===35615){r.check=0;C[0]=c&255;C[1]=c>>>8&255;r.check=j(r.check,C,2,0);c=0;h=0;r.mode=Y;break}r.flags=0;if(r.head){r.head.done=false}if(!(r.wrap&1)||(((c&255)<<8)+(c>>8))%31){e.msg="incorrect header check";r.mode=Se;break}if((c&15)!==W){e.msg="unknown compression method";r.mode=Se;break}c>>>=4;h-=4;S=(c&15)+8;if(r.wbits===0){r.wbits=S}else if(S>r.wbits){e.msg="invalid window size";r.mode=Se;break}r.dmax=1<<S;e.adler=r.check=1;r.mode=c&512?ne:oe;c=0;h=0;break;case Y:while(h<16){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}r.flags=c;if((r.flags&255)!==W){e.msg="unknown compression method";r.mode=Se;break}if(r.flags&57344){e.msg="unknown header flags set";r.mode=Se;break}if(r.head){r.head.text=c>>8&1}if(r.flags&512){C[0]=c&255;C[1]=c>>>8&255;r.check=j(r.check,C,2,0)}c=0;h=0;r.mode=K;case K:while(h<32){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}if(r.head){r.head.time=c}if(r.flags&512){C[0]=c&255;C[1]=c>>>8&255;C[2]=c>>>16&255;C[3]=c>>>24&255;r.check=j(r.check,C,4,0)}c=0;h=0;r.mode=Z;case Z:while(h<16){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}if(r.head){r.head.xflags=c&255;r.head.os=c>>8}if(r.flags&512){C[0]=c&255;C[1]=c>>>8&255;r.check=j(r.check,C,2,0)}c=0;h=0;r.mode=J;case J:if(r.flags&1024){while(h<16){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}r.length=c;if(r.head){r.head.extra_len=c}if(r.flags&512){C[0]=c&255;C[1]=c>>>8&255;r.check=j(r.check,C,2,0)}c=0;h=0}else if(r.head){r.head.extra=null}r.mode=Q;case Q:if(r.flags&1024){f=r.length;if(f>s){f=s}if(f){if(r.head){S=r.head.extra_len-r.length;if(!r.head.extra){r.head.extra=new Array(r.head.extra_len)}P.arraySet(r.head.extra,n,o,f,S)}if(r.flags&512){r.check=j(r.check,n,f,o)}s-=f;o+=f;r.length-=f}if(r.length){break e}}r.length=0;r.mode=ee;case ee:if(r.flags&2048){if(s===0){break e}f=0;do{S=n[o+f++];if(r.head&&S&&r.length<65536){r.head.name+=String.fromCharCode(S)}}while(S&&f<s);if(r.flags&512){r.check=j(r.check,n,f,o)}s-=f;o+=f;if(S){break e}}else if(r.head){r.head.name=null}r.length=0;r.mode=te;case te:if(r.flags&4096){if(s===0){break e}f=0;do{S=n[o+f++];if(r.head&&S&&r.length<65536){r.head.comment+=String.fromCharCode(S)}}while(S&&f<s);if(r.flags&512){r.check=j(r.check,n,f,o)}s-=f;o+=f;if(S){break e}}else if(r.head){r.head.comment=null}r.mode=re;case re:if(r.flags&512){while(h<16){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}if(c!==(r.check&65535)){e.msg="header crc mismatch";r.mode=Se;break}c=0;h=0}if(r.head){r.head.hcrc=r.flags>>9&1;r.head.done=true}e.adler=r.check=0;r.mode=oe;break;case ne:while(h<32){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}e.adler=r.check=Ee(c);c=0;h=0;r.mode=ie;case ie:if(r.havedict===0){e.next_out=a;e.avail_out=u;e.next_in=o;e.avail_in=s;r.hold=c;r.bits=h;return U}e.adler=r.check=1;r.mode=oe;case oe:if(t===B||t===F){break e}case ae:if(r.last){c>>>=h&7;h-=h&7;r.mode=be;break}while(h<3){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}r.last=c&1;c>>>=1;h-=1;switch(c&3){case 0:r.mode=se;break;case 1:Te(r);r.mode=fe;if(t===F){c>>>=2;h-=2;break e}break;case 2:r.mode=he;break;case 3:e.msg="invalid block type";r.mode=Se}c>>>=2;h-=2;break;case se:c>>>=h&7;h-=h&7;while(h<32){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}if((c&65535)!==(c>>>16^65535)){e.msg="invalid stored block lengths";r.mode=Se;break}r.length=c&65535;c=0;h=0;r.mode=ue;if(t===F){break e}case ue:r.mode=ce;case ce:f=r.length;if(f){if(f>s){f=s}if(f>u){f=u}if(f===0){break e}P.arraySet(i,n,o,f,a);s-=f;o+=f;u-=f;a+=f;r.length-=f;break}r.mode=oe;break;case he:while(h<14){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}r.nlen=(c&31)+257;c>>>=5;h-=5;r.ndist=(c&31)+1;c>>>=5;h-=5;r.ncode=(c&15)+4;c>>>=4;h-=4;if(r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols";r.mode=Se;break}r.have=0;r.mode=le;case le:while(r.have<r.ncode){while(h<3){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}r.lens[O[r.have++]]=c&7;c>>>=3;h-=3}while(r.have<19){r.lens[O[r.have++]]=0}r.lencode=r.lendyn;r.lenbits=7;E={bits:r.lenbits};M=k(L,r.lens,0,19,r.lencode,0,r.work,E);r.lenbits=E.bits;if(M){e.msg="invalid code lengths set";r.mode=Se;break}r.have=0;r.mode=pe;case pe:while(r.have<r.nlen+r.ndist){for(;;){m=r.lencode[c&(1<<r.lenbits)-1];g=m>>>24;_=m>>>16&255;y=m&65535;if(g<=h){break}if(s===0){break e}s--;c+=n[o++]<<h;h+=8}if(y<16){c>>>=g;h-=g;r.lens[r.have++]=y}else{if(y===16){T=g+2;while(h<T){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}c>>>=g;h-=g;if(r.have===0){e.msg="invalid bit length repeat";r.mode=Se;break}S=r.lens[r.have-1];f=3+(c&3);c>>>=2;h-=2}else if(y===17){T=g+3;while(h<T){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}c>>>=g;h-=g;S=0;f=3+(c&7);c>>>=3;h-=3}else{T=g+7;while(h<T){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}c>>>=g;h-=g;S=0;f=11+(c&127);c>>>=7;h-=7}if(r.have+f>r.nlen+r.ndist){e.msg="invalid bit length repeat";r.mode=Se;break}while(f--){r.lens[r.have++]=S}}}if(r.mode===Se){break}if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block";r.mode=Se;break}r.lenbits=9;E={bits:r.lenbits};M=k(I,r.lens,0,r.nlen,r.lencode,0,r.work,E);r.lenbits=E.bits;if(M){e.msg="invalid literal/lengths set";r.mode=Se;break}r.distbits=6;r.distcode=r.distdyn;E={bits:r.distbits};M=k(N,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,E);r.distbits=E.bits;if(M){e.msg="invalid distances set";r.mode=Se;break}r.mode=fe;if(t===F){break e}case fe:r.mode=de;case de:if(s>=6&&u>=258){e.next_out=a;e.avail_out=u;e.next_in=o;e.avail_in=s;r.hold=c;r.bits=h;R(e,p);a=e.next_out;i=e.output;u=e.avail_out;o=e.next_in;n=e.input;s=e.avail_in;c=r.hold;h=r.bits;if(r.mode===oe){r.back=-1}break}r.back=0;for(;;){m=r.lencode[c&(1<<r.lenbits)-1];g=m>>>24;_=m>>>16&255;y=m&65535;if(g<=h){break}if(s===0){break e}s--;c+=n[o++]<<h;h+=8}if(_&&(_&240)===0){b=g;w=_;x=y;for(;;){m=r.lencode[x+((c&(1<<b+w)-1)>>b)];g=m>>>24;_=m>>>16&255;y=m&65535;if(b+g<=h){break}if(s===0){break e}s--;c+=n[o++]<<h;h+=8}c>>>=b;h-=b;r.back+=b}c>>>=g;h-=g;r.back+=g;r.length=y;if(_===0){r.mode=ye;break}if(_&32){r.back=-1;r.mode=oe;break}if(_&64){e.msg="invalid literal/length code";r.mode=Se;break}r.extra=_&15;r.mode=ve;case ve:if(r.extra){T=r.extra;while(h<T){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}r.length+=c&(1<<r.extra)-1;c>>>=r.extra;h-=r.extra;r.back+=r.extra}r.was=r.length;r.mode=me;case me:for(;;){m=r.distcode[c&(1<<r.distbits)-1];g=m>>>24;_=m>>>16&255;y=m&65535;if(g<=h){break}if(s===0){break e}s--;c+=n[o++]<<h;h+=8}if((_&240)===0){b=g;w=_;x=y;for(;;){m=r.distcode[x+((c&(1<<b+w)-1)>>b)];g=m>>>24;_=m>>>16&255;y=m&65535;if(b+g<=h){break}if(s===0){break e}s--;c+=n[o++]<<h;h+=8}c>>>=b;h-=b;r.back+=b}c>>>=g;h-=g;r.back+=g;if(_&64){e.msg="invalid distance code";r.mode=Se;break}r.offset=y;r.extra=_&15;r.mode=ge;case ge:if(r.extra){T=r.extra;while(h<T){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}r.offset+=c&(1<<r.extra)-1;c>>>=r.extra;h-=r.extra;r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back";r.mode=Se;break}r.mode=_e;case _e:if(u===0){break e}f=p-u;if(r.offset>f){f=r.offset-f;if(f>r.whave){if(r.sane){e.msg="invalid distance too far back";r.mode=Se;break}}if(f>r.wnext){f-=r.wnext;d=r.wsize-f}else{d=r.wnext-f}if(f>r.length){f=r.length}v=r.window}else{v=i;d=a-r.offset;f=r.length}if(f>u){f=u}u-=f;r.length-=f;do{i[a++]=v[d++]}while(--f);if(r.length===0){r.mode=de}break;case ye:if(u===0){break e}i[a++]=r.length;u--;r.mode=de;break;case be:if(r.wrap){while(h<32){if(s===0){break e}s--;c|=n[o++]<<h;h+=8}p-=u;e.total_out+=p;r.total+=p;if(p){e.adler=r.check=r.flags?j(r.check,i,p,a-p):A(r.check,i,p,a-p)}p=u;if((r.flags?c:Ee(c))!==r.check){e.msg="incorrect data check";r.mode=Se;break}c=0;h=0}r.mode=we;case we:if(r.wrap&&r.flags){while(h<32){if(s===0){break e}s--;c+=n[o++]<<h;h+=8}if(c!==(r.total&4294967295)){e.msg="incorrect length check";r.mode=Se;break}c=0;h=0}r.mode=xe;case xe:M=$;break e;case Se:M=V;break e;case Me:return H;case Ce:default:return G}}e.next_out=a;e.avail_out=u;e.next_in=o;e.avail_in=s;r.hold=c;r.bits=h;if(r.wsize||p!==e.avail_out&&r.mode<Se&&(r.mode<be||t!==D)){if(Oe(e,e.output,e.next_out,p-e.avail_out)){r.mode=Me;return H}}l-=e.avail_in;p-=e.avail_out;e.total_in+=l;e.total_out+=p;r.total+=p;if(r.wrap&&p){e.adler=r.check=r.flags?j(r.check,i,p,e.next_out-p):A(r.check,i,p,e.next_out-p)}e.data_type=r.bits+(r.last?64:0)+(r.mode===oe?128:0)+(r.mode===fe||r.mode===ue?256:0);if((l===0&&p===0||t===D)&&M===z){M=q}return M}function g(e){if(!e||!e.state){return G}var t=e.state;if(t.window){t.window=null}e.state=null;return z}function _(e,t){var r;if(!e||!e.state){return G}r=e.state;if((r.wrap&2)===0){return G}r.head=t;t.done=false;return z}function y(e,t){var r=t.length;var n;var i;var o;if(!e||!e.state){return G}n=e.state;if(n.wrap!==0&&n.mode!==ie){return G}if(n.mode===ie){i=1;i=A(i,t,r,0);if(i!==n.check){return V}}o=Oe(e,t,r,r);if(o){n.mode=Me;return H}n.havedict=1;return z}r.inflateReset=c;r.inflateReset2=h;r.inflateResetKeep=u;r.inflateInit=p;r.inflateInit2=l;r.inflate=m;r.inflateEnd=g;r.inflateGetHeader=_;r.inflateSetDictionary=y;r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":26,"./adler32":28,"./crc32":30,"./inffast":33,"./inftrees":35}],35:[function(e,t,r){"use strict";var I=e("../utils/common");var N=15;var D=852;var B=592;var F=0;var z=1;var $=2;var U=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var G=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var V=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var H=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function e(t,r,n,i,o,a,s,u){var c=u.bits;var h=0;var l=0;var p=0,f=0;var d=0;var v=0;var m=0;var g=0;var _=0;var y=0;var b;var w;var x;var S;var M;var C=null;var E=0;var T;var O=new I.Buf16(N+1);var P=new I.Buf16(N+1);var A=null;var j=0;var R,k,L;for(h=0;h<=N;h++){O[h]=0}for(l=0;l<i;l++){O[r[n+l]]++}d=c;for(f=N;f>=1;f--){if(O[f]!==0){break}}if(d>f){d=f}if(f===0){o[a++]=1<<24|64<<16|0;o[a++]=1<<24|64<<16|0;u.bits=1;return 0}for(p=1;p<f;p++){if(O[p]!==0){break}}if(d<p){d=p}g=1;for(h=1;h<=N;h++){g<<=1;g-=O[h];if(g<0){return-1}}if(g>0&&(t===F||f!==1)){return-1}P[1]=0;for(h=1;h<N;h++){P[h+1]=P[h]+O[h]}for(l=0;l<i;l++){if(r[n+l]!==0){s[P[r[n+l]]++]=l}}if(t===F){C=A=s;T=19}else if(t===z){C=U;E-=257;A=G;j-=257;T=256}else{C=V;A=H;T=-1}y=0;l=0;h=p;M=a;v=d;m=0;x=-1;_=1<<d;S=_-1;if(t===z&&_>D||t===$&&_>B){return 1}for(;;){R=h-m;if(s[l]<T){k=0;L=s[l]}else if(s[l]>T){k=A[j+s[l]];L=C[E+s[l]]}else{k=32+64;L=0}b=1<<h-m;w=1<<v;p=w;do{w-=b;o[M+(y>>m)+w]=R<<24|k<<16|L|0}while(w!==0);b=1<<h-1;while(y&b){b>>=1}if(b!==0){y&=b-1;y+=b}else{y=0}l++;if(--O[h]===0){if(h===f){break}h=r[n+s[l]]}if(h>d&&(y&S)!==x){if(m===0){m=d}M+=p;v=h-m;g=1<<v;while(v+m<f){g-=O[v+m];if(g<=0){break}v++;g<<=1}_+=1<<v;if(t===z&&_>D||t===$&&_>B){return 1}x=y&S;o[x]=d<<24|v<<16|M-a|0}}if(y!==0){o[M+y]=h-m<<24|64<<16|0}u.bits=d;return 0}},{"../utils/common":26}],36:[function(e,t,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],37:[function(e,t,r){"use strict";var i=e("../utils/common");var s=4;var n=0;var o=1;var u=2;function a(e){var t=e.length;while(--t>=0){e[t]=0}}var c=0;var h=1;var l=2;var p=3;var f=258;var d=29;var v=256;var m=v+1+d;var g=30;var _=19;var y=2*m+1;var b=15;var w=16;var x=7;var S=256;var M=16;var C=17;var E=18;var T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var O=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var j=512;var R=new Array((m+2)*2);a(R);var k=new Array(g*2);a(k);var L=new Array(j);a(L);var I=new Array(f-p+1);a(I);var N=new Array(d);a(N);var D=new Array(g);a(D);function B(e,t,r,n,i){this.static_tree=e;this.extra_bits=t;this.extra_base=r;this.elems=n;this.max_length=i;this.has_stree=e&&e.length}var F;var z;var $;function U(e,t){this.dyn_tree=e;this.max_code=0;this.stat_desc=t}function G(e){return e<256?L[e]:L[256+(e>>>7)]}function V(e,t){e.pending_buf[e.pending++]=t&255;e.pending_buf[e.pending++]=t>>>8&255}function H(e,t,r){if(e.bi_valid>w-r){e.bi_buf|=t<<e.bi_valid&65535;V(e,e.bi_buf);e.bi_buf=t>>w-e.bi_valid;e.bi_valid+=r-w}else{e.bi_buf|=t<<e.bi_valid&65535;e.bi_valid+=r}}function q(e,t,r){H(e,r[t*2],r[t*2+1])}function W(e,t){var r=0;do{r|=e&1;e>>>=1;r<<=1}while(--t>0);return r>>>1}function X(e){if(e.bi_valid===16){V(e,e.bi_buf);e.bi_buf=0;e.bi_valid=0}else if(e.bi_valid>=8){e.pending_buf[e.pending++]=e.bi_buf&255;e.bi_buf>>=8;e.bi_valid-=8}}function Y(e,t){var r=t.dyn_tree;var n=t.max_code;var i=t.stat_desc.static_tree;var o=t.stat_desc.has_stree;var a=t.stat_desc.extra_bits;var s=t.stat_desc.extra_base;var u=t.stat_desc.max_length;var c;var h,l;var p;var f;var d;var v=0;for(p=0;p<=b;p++){e.bl_count[p]=0}r[e.heap[e.heap_max]*2+1]=0;for(c=e.heap_max+1;c<y;c++){h=e.heap[c];p=r[r[h*2+1]*2+1]+1;if(p>u){p=u;v++}r[h*2+1]=p;if(h>n){continue}e.bl_count[p]++;f=0;if(h>=s){f=a[h-s]}d=r[h*2];e.opt_len+=d*(p+f);if(o){e.static_len+=d*(i[h*2+1]+f)}}if(v===0){return}do{p=u-1;while(e.bl_count[p]===0){p--}e.bl_count[p]--;e.bl_count[p+1]+=2;e.bl_count[u]--;v-=2}while(v>0);for(p=u;p!==0;p--){h=e.bl_count[p];while(h!==0){l=e.heap[--c];if(l>n){continue}if(r[l*2+1]!==p){e.opt_len+=(p-r[l*2+1])*r[l*2];r[l*2+1]=p}h--}}}function K(e,t,r){var n=new Array(b+1);var i=0;var o;var a;for(o=1;o<=b;o++){n[o]=i=i+r[o-1]<<1}for(a=0;a<=t;a++){var s=e[a*2+1];if(s===0){continue}e[a*2]=W(n[s]++,s)}}function Z(){var e;var t;var r;var n;var i;var o=new Array(b+1);r=0;for(n=0;n<d-1;n++){N[n]=r;for(e=0;e<1<<T[n];e++){I[r++]=n}}I[r-1]=n;i=0;for(n=0;n<16;n++){D[n]=i;for(e=0;e<1<<O[n];e++){L[i++]=n}}i>>=7;for(;n<g;n++){D[n]=i<<7;for(e=0;e<1<<O[n]-7;e++){L[256+i++]=n}}for(t=0;t<=b;t++){o[t]=0}e=0;while(e<=143){R[e*2+1]=8;e++;o[8]++}while(e<=255){R[e*2+1]=9;e++;o[9]++}while(e<=279){R[e*2+1]=7;e++;o[7]++}while(e<=287){R[e*2+1]=8;e++;o[8]++}K(R,m+1,o);for(e=0;e<g;e++){k[e*2+1]=5;k[e*2]=W(e,5)}F=new B(R,T,v+1,m,b);z=new B(k,O,0,g,b);$=new B(new Array(0),P,0,_,x)}function J(e){var t;for(t=0;t<m;t++){e.dyn_ltree[t*2]=0}for(t=0;t<g;t++){e.dyn_dtree[t*2]=0}for(t=0;t<_;t++){e.bl_tree[t*2]=0}e.dyn_ltree[S*2]=1;e.opt_len=e.static_len=0;e.last_lit=e.matches=0}function Q(e){if(e.bi_valid>8){V(e,e.bi_buf)}else if(e.bi_valid>0){e.pending_buf[e.pending++]=e.bi_buf}e.bi_buf=0;e.bi_valid=0}function ee(e,t,r,n){Q(e);if(n){V(e,r);V(e,~r)}i.arraySet(e.pending_buf,e.window,t,r,e.pending);e.pending+=r}function te(e,t,r,n){var i=t*2;var o=r*2;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]}function re(e,t,r){var n=e.heap[r];var i=r<<1;while(i<=e.heap_len){if(i<e.heap_len&&te(t,e.heap[i+1],e.heap[i],e.depth)){i++}if(te(t,n,e.heap[i],e.depth)){break}e.heap[r]=e.heap[i];r=i;i<<=1}e.heap[r]=n}function ne(e,t,r){var n;var i;var o=0;var a;var s;if(e.last_lit!==0){do{n=e.pending_buf[e.d_buf+o*2]<<8|e.pending_buf[e.d_buf+o*2+1];i=e.pending_buf[e.l_buf+o];o++;if(n===0){q(e,i,t)}else{a=I[i];q(e,a+v+1,t);s=T[a];if(s!==0){i-=N[a];H(e,i,s)}n--;a=G(n);q(e,a,r);s=O[a];if(s!==0){n-=D[a];H(e,n,s)}}}while(o<e.last_lit)}q(e,S,t)}function ie(e,t){var r=t.dyn_tree;var n=t.stat_desc.static_tree;var i=t.stat_desc.has_stree;var o=t.stat_desc.elems;var a,s;var u=-1;var c;e.heap_len=0;e.heap_max=y;for(a=0;a<o;a++){if(r[a*2]!==0){e.heap[++e.heap_len]=u=a;e.depth[a]=0}else{r[a*2+1]=0}}while(e.heap_len<2){c=e.heap[++e.heap_len]=u<2?++u:0;r[c*2]=1;e.depth[c]=0;e.opt_len--;if(i){e.static_len-=n[c*2+1]}}t.max_code=u;for(a=e.heap_len>>1;a>=1;a--){re(e,r,a)}c=o;do{a=e.heap[1];e.heap[1]=e.heap[e.heap_len--];re(e,r,1);s=e.heap[1];e.heap[--e.heap_max]=a;e.heap[--e.heap_max]=s;r[c*2]=r[a*2]+r[s*2];e.depth[c]=(e.depth[a]>=e.depth[s]?e.depth[a]:e.depth[s])+1;r[a*2+1]=r[s*2+1]=c;e.heap[1]=c++;re(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1];Y(e,t);K(r,u,e.bl_count)}function oe(e,t,r){var n;var i=-1;var o;var a=t[0*2+1];var s=0;var u=7;var c=4;if(a===0){u=138;c=3}t[(r+1)*2+1]=65535;for(n=0;n<=r;n++){o=a;a=t[(n+1)*2+1];if(++s<u&&o===a){continue}else if(s<c){e.bl_tree[o*2]+=s}else if(o!==0){if(o!==i){e.bl_tree[o*2]++}e.bl_tree[M*2]++}else if(s<=10){e.bl_tree[C*2]++}else{e.bl_tree[E*2]++}s=0;i=o;if(a===0){u=138;c=3}else if(o===a){u=6;c=3}else{u=7;c=4}}}function ae(e,t,r){var n;var i=-1;var o;var a=t[0*2+1];var s=0;var u=7;var c=4;if(a===0){u=138;c=3}for(n=0;n<=r;n++){o=a;a=t[(n+1)*2+1];if(++s<u&&o===a){continue}else if(s<c){do{q(e,o,e.bl_tree)}while(--s!==0)}else if(o!==0){if(o!==i){q(e,o,e.bl_tree);s--}q(e,M,e.bl_tree);H(e,s-3,2)}else if(s<=10){q(e,C,e.bl_tree);H(e,s-3,3)}else{q(e,E,e.bl_tree);H(e,s-11,7)}s=0;i=o;if(a===0){u=138;c=3}else if(o===a){u=6;c=3}else{u=7;c=4}}}function se(e){var t;oe(e,e.dyn_ltree,e.l_desc.max_code);oe(e,e.dyn_dtree,e.d_desc.max_code);ie(e,e.bl_desc);for(t=_-1;t>=3;t--){if(e.bl_tree[A[t]*2+1]!==0){break}}e.opt_len+=3*(t+1)+5+5+4;return t}function ue(e,t,r,n){var i;H(e,t-257,5);H(e,r-1,5);H(e,n-4,4);for(i=0;i<n;i++){H(e,e.bl_tree[A[i]*2+1],3)}ae(e,e.dyn_ltree,t-1);ae(e,e.dyn_dtree,r-1)}function ce(e){var t=4093624447;var r;for(r=0;r<=31;r++,t>>>=1){if(t&1&&e.dyn_ltree[r*2]!==0){return n}}if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0){return o}for(r=32;r<v;r++){if(e.dyn_ltree[r*2]!==0){return o}}return n}var he=false;function le(e){if(!he){Z();he=true}e.l_desc=new U(e.dyn_ltree,F);e.d_desc=new U(e.dyn_dtree,z);e.bl_desc=new U(e.bl_tree,$);e.bi_buf=0;e.bi_valid=0;J(e)}function pe(e,t,r,n){H(e,(c<<1)+(n?1:0),3);ee(e,t,r,true)}function fe(e){H(e,h<<1,3);q(e,S,R);X(e)}function de(e,t,r,n){var i,o;var a=0;if(e.level>0){if(e.strm.data_type===u){e.strm.data_type=ce(e)}ie(e,e.l_desc);ie(e,e.d_desc);a=se(e);i=e.opt_len+3+7>>>3;o=e.static_len+3+7>>>3;if(o<=i){i=o}}else{i=o=r+5}if(r+4<=i&&t!==-1){pe(e,t,r,n)}else if(e.strategy===s||o===i){H(e,(h<<1)+(n?1:0),3);ne(e,R,k)}else{H(e,(l<<1)+(n?1:0),3);ue(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1);ne(e,e.dyn_ltree,e.dyn_dtree)}J(e);if(n){Q(e)}}function ve(e,t,r){e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255;e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255;e.pending_buf[e.l_buf+e.last_lit]=r&255;e.last_lit++;if(t===0){e.dyn_ltree[r*2]++}else{e.matches++;t--;e.dyn_ltree[(I[r]+v+1)*2]++;e.dyn_dtree[G(t)*2]++}return e.last_lit===e.lit_bufsize-1}r._tr_init=le;r._tr_stored_block=pe;r._tr_flush_block=de;r._tr_tally=ve;r._tr_align=fe},{"../utils/common":26}],38:[function(e,t,r){"use strict";function n(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}t.exports=n},{}],39:[function(e,t,c){(function(i){function o(e,t){var r=0;for(var n=e.length-1;n>=0;n--){var i=e[n];if(i==="."){e.splice(n,1)}else if(i===".."){e.splice(n,1);r++}else if(r){e.splice(n,1);r--}}if(t){for(;r--;r){e.unshift("..")}}return e}var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var a=function(e){return t.exec(e).slice(1)};c.resolve=function(){var e="",t=false;for(var r=arguments.length-1;r>=-1&&!t;r--){var n=r>=0?arguments[r]:i.cwd();if(typeof n!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!n){continue}e=n+"/"+e;t=n.charAt(0)==="/"}e=o(s(e.split("/"),function(e){return!!e}),!t).join("/");return(t?"/":"")+e||"."};c.normalize=function(e){var t=c.isAbsolute(e),r=n(e,-1)==="/";e=o(s(e.split("/"),function(e){return!!e}),!t).join("/");if(!e&&!t){e="."}if(e&&r){e+="/"}return(t?"/":"")+e};c.isAbsolute=function(e){return e.charAt(0)==="/"};c.join=function(){var e=Array.prototype.slice.call(arguments,0);return c.normalize(s(e,function(e,t){if(typeof e!=="string"){throw new TypeError("Arguments to path.join must be strings")}return e}).join("/"))};c.relative=function(e,t){e=c.resolve(e).substr(1);t=c.resolve(t).substr(1);function r(e){var t=0;for(;t<e.length;t++){if(e[t]!=="")break}var r=e.length-1;for(;r>=0;r--){if(e[r]!=="")break}if(t>r)return[];return e.slice(t,r-t+1)}var n=r(e.split("/"));var i=r(t.split("/"));var o=Math.min(n.length,i.length);var a=o;for(var s=0;s<o;s++){if(n[s]!==i[s]){a=s;break}}var u=[];for(var s=a;s<n.length;s++){u.push("..")}u=u.concat(i.slice(a));return u.join("/")};c.sep="/";c.delimiter=":";c.dirname=function(e){var t=a(e),r=t[0],n=t[1];if(!r&&!n){return"."}if(n){n=n.substr(0,n.length-1)}return r+n};c.basename=function(e,t){var r=a(e)[2];if(t&&r.substr(-1*t.length)===t){r=r.substr(0,r.length-t.length)}return r};c.extname=function(e){return a(e)[3]};function s(e,t){if(e.filter)return e.filter(t);var r=[];for(var n=0;n<e.length;n++){if(t(e[n],n,e))r.push(e[n])}return r}var n="ab".substr(-1)==="b"?function(e,t,r){return e.substr(t,r)}:function(e,t,r){if(t<0)t=e.length+t;return e.substr(t,r)}}).call(this,e("_process"))},{_process:6}],40:[function(e,t,r){"use strict";t.exports=i;var n=e("ieee754");function i(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0);this.pos=0;this.type=0;this.length=this.buf.length}i.Varint=0;i.Fixed64=1;i.Bytes=2;i.Fixed32=5;var o=(1<<16)*(1<<16),a=1/o;i.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){r=r||this.length;while(this.pos<r){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=n&7;e(i,t,this);if(this.pos===o)this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=S(this.buf,this.pos);this.pos+=4;return e},readSFixed32:function(){var e=C(this.buf,this.pos);this.pos+=4;return e},readFixed64:function(){var e=S(this.buf,this.pos)+S(this.buf,this.pos+4)*o;this.pos+=8;return e},readSFixed64:function(){var e=S(this.buf,this.pos)+C(this.buf,this.pos+4)*o;this.pos+=8;return e},readFloat:function(){var e=n.read(this.buf,this.pos,true,23,4);this.pos+=4;return e},readDouble:function(){var e=n.read(this.buf,this.pos,true,52,8);this.pos+=8;return e},readVarint:function(e){var t=this.buf,r,n;n=t[this.pos++];r=n&127;if(n<128)return r;n=t[this.pos++];r|=(n&127)<<7;if(n<128)return r;n=t[this.pos++];r|=(n&127)<<14;if(n<128)return r;n=t[this.pos++];r|=(n&127)<<21;if(n<128)return r;n=t[this.pos];r|=(n&15)<<28;return s(r,e,this)},readVarint64:function(){return this.readVarint(true)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=E(this.buf,this.pos,e);this.pos=e;return t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);this.pos=e;return t},readPackedVarint:function(e,t){var r=u(this);e=e||[];while(this.pos<r)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=u(this);e=e||[];while(this.pos<t)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=u(this);e=e||[];while(this.pos<t)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=u(this);e=e||[];while(this.pos<t)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=u(this);e=e||[];while(this.pos<t)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=u(this);e=e||[];while(this.pos<t)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=u(this);e=e||[];while(this.pos<t)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=u(this);e=e||[];while(this.pos<t)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=u(this);e=e||[];while(this.pos<t)e.push(this.readSFixed64());return e},skip:function(e){var t=e&7;if(t===i.Varint)while(this.buf[this.pos++]>127){}else if(t===i.Bytes)this.pos=this.readVarint()+this.pos;else if(t===i.Fixed32)this.pos+=4;else if(t===i.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){var t=this.length||16;while(t<this.pos+e)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf);this.buf=r;this.length=t}},finish:function(){this.length=this.pos;this.pos=0;return this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4);M(this.buf,e,this.pos);this.pos+=4},writeSFixed32:function(e){this.realloc(4);M(this.buf,e,this.pos);this.pos+=4},writeFixed64:function(e){this.realloc(8);M(this.buf,e&-1,this.pos);M(this.buf,Math.floor(e*a),this.pos+4);this.pos+=8},writeSFixed64:function(e){this.realloc(8);M(this.buf,e&-1,this.pos);M(this.buf,Math.floor(e*a),this.pos+4);this.pos+=8},writeVarint:function(e){e=+e||0;if(e>268435455||e<0){h(e,this);return}this.realloc(4);this.buf[this.pos++]=e&127|(e>127?128:0);if(e<=127)return;this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0);if(e<=127)return;this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0);if(e<=127)return;this.buf[this.pos++]=e>>>7&127},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e);this.realloc(e.length*4);this.pos++;var t=this.pos;this.pos=T(this.buf,e,this.pos);var r=this.pos-t;if(r>=128)f(t,r,this);this.pos=t-1;this.writeVarint(r);this.pos+=r},writeFloat:function(e){this.realloc(4);n.write(this.buf,e,this.pos,true,23,4);this.pos+=4},writeDouble:function(e){this.realloc(8);n.write(this.buf,e,this.pos,true,52,8);this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t);this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var n=this.pos-r;if(n>=128)f(r,n,this);this.pos=r-1;this.writeVarint(n);this.pos+=n},writeMessage:function(e,t,r){this.writeTag(e,i.Bytes);this.writeRawMessage(t,r)},writePackedVarint:function(e,t){this.writeMessage(e,d,t)},writePackedSVarint:function(e,t){this.writeMessage(e,v,t)},writePackedBoolean:function(e,t){this.writeMessage(e,_,t)},writePackedFloat:function(e,t){this.writeMessage(e,m,t)},writePackedDouble:function(e,t){this.writeMessage(e,g,t)},writePackedFixed32:function(e,t){this.writeMessage(e,y,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,b,t)},writePackedFixed64:function(e,t){this.writeMessage(e,w,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,x,t)},writeBytesField:function(e,t){this.writeTag(e,i.Bytes);this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,i.Fixed32);this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,i.Fixed32);this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,i.Fixed64);this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,i.Fixed64);this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,i.Varint);this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,i.Varint);this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,i.Bytes);this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,i.Fixed32);this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,i.Fixed64);this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};function s(e,t,r){var n=r.buf,i,o;o=n[r.pos++];i=(o&112)>>4;if(o<128)return c(e,i,t);o=n[r.pos++];i|=(o&127)<<3;if(o<128)return c(e,i,t);o=n[r.pos++];i|=(o&127)<<10;if(o<128)return c(e,i,t);o=n[r.pos++];i|=(o&127)<<17;if(o<128)return c(e,i,t);o=n[r.pos++];i|=(o&127)<<24;if(o<128)return c(e,i,t);o=n[r.pos++];i|=(o&1)<<31;if(o<128)return c(e,i,t);throw new Error("Expected varint not more than 10 bytes")}function u(e){return e.type===i.Bytes?e.readVarint()+e.pos:e.pos+1}function c(e,t,r){if(r){return t*4294967296+(e>>>0)}return(t>>>0)*4294967296+(e>>>0)}function h(e,t){var r,n;if(e>=0){r=e%4294967296|0;n=e/4294967296|0}else{r=~(-e%4294967296);n=~(-e/4294967296);if(r^4294967295){r=r+1|0}else{r=0;n=n+1|0}}if(e>=0x10000000000000000||e<-0x10000000000000000){throw new Error("Given varint doesn't fit into 10 bytes")}t.realloc(10);l(r,n,t);p(n,t)}function l(e,t,r){r.buf[r.pos++]=e&127|128;e>>>=7;r.buf[r.pos++]=e&127|128;e>>>=7;r.buf[r.pos++]=e&127|128;e>>>=7;r.buf[r.pos++]=e&127|128;e>>>=7;r.buf[r.pos]=e&127}function p(e,t){var r=(e&7)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0);if(!e)return;t.buf[t.pos++]=e&127|((e>>>=7)?128:0);if(!e)return;t.buf[t.pos++]=e&127|((e>>>=7)?128:0);if(!e)return;t.buf[t.pos++]=e&127|((e>>>=7)?128:0);if(!e)return;t.buf[t.pos++]=e&127|((e>>>=7)?128:0);if(!e)return;t.buf[t.pos++]=e&127}function f(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(Math.LN2*7));r.realloc(n);for(var i=r.pos-1;i>=e;i--)r.buf[i+n]=r.buf[i]}function d(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function v(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function m(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function g(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function _(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function y(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function b(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function w(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function x(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function S(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216}function M(e,t,r){e[r]=t;e[r+1]=t>>>8;e[r+2]=t>>>16;e[r+3]=t>>>24}function C(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function E(e,t,r){var n="";var i=t;while(i<r){var o=e[i];var a=null;var s=o>239?4:o>223?3:o>191?2:1;if(i+s>r)break;var u,c,h;if(s===1){if(o<128){a=o}}else if(s===2){u=e[i+1];if((u&192)===128){a=(o&31)<<6|u&63;if(a<=127){a=null}}}else if(s===3){u=e[i+1];c=e[i+2];if((u&192)===128&&(c&192)===128){a=(o&15)<<12|(u&63)<<6|c&63;if(a<=2047||a>=55296&&a<=57343){a=null}}}else if(s===4){u=e[i+1];c=e[i+2];h=e[i+3];if((u&192)===128&&(c&192)===128&&(h&192)===128){a=(o&15)<<18|(u&63)<<12|(c&63)<<6|h&63;if(a<=65535||a>=1114112){a=null}}}if(a===null){a=65533;s=1}else if(a>65535){a-=65536;n+=String.fromCharCode(a>>>10&1023|55296);a=56320|a&1023}n+=String.fromCharCode(a);i+=s}return n}function T(e,t,r){for(var n=0,i,o;n<t.length;n++){i=t.charCodeAt(n);if(i>55295&&i<57344){if(o){if(i<56320){e[r++]=239;e[r++]=191;e[r++]=189;o=i;continue}else{i=o-55296<<10|i-56320|65536;o=null}}else{if(i>56319||n+1===t.length){e[r++]=239;e[r++]=191;e[r++]=189}else{o=i}continue}}else if(o){e[r++]=239;e[r++]=191;e[r++]=189;o=null}if(i<128){e[r++]=i}else{if(i<2048){e[r++]=i>>6|192}else{if(i<65536){e[r++]=i>>12|224}else{e[r++]=i>>18|240;e[r++]=i>>12&63|128}e[r++]=i>>6&63|128}e[r++]=i&63|128}}return r}},{ieee754:17}],41:[function(e,r,n){(function(e,t){typeof n==="object"&&typeof r!=="undefined"?r.exports=t():typeof o==="function"&&o.amd?o(t):e.quickselect=t()})(this,function(){"use strict";function e(e,t,r,n,i){v(e,t,r||0,n||e.length-1,i||o)}function v(e,t,r,n,i){while(n>r){if(n-r>600){var o=n-r+1;var a=t-r+1;var s=Math.log(o);var u=.5*Math.exp(2*s/3);var c=.5*Math.sqrt(s*u*(o-u)/o)*(a-o/2<0?-1:1);var h=Math.max(r,Math.floor(t-a*u/o+c));var l=Math.min(n,Math.floor(t+(o-a)*u/o+c));v(e,t,h,l,i)}var p=e[t];var f=r;var d=n;m(e,r,t);if(i(e[n],p)>0)m(e,r,n);while(f<d){m(e,f,d);f++;d--;while(i(e[f],p)<0)f++;while(i(e[d],p)>0)d--}if(i(e[r],p)===0)m(e,r,d);else{d++;m(e,d,n)}if(d<=t)r=d+1;if(t<=d)n=d-1}}function m(e,t,r){var n=e[t];e[t]=e[r];e[r]=n}function o(e,t){return e<t?-1:e>t?1:0}return e})},{}],42:[function(e,t,r){"use strict";t.exports=n;t.exports.default=n;var s=e("quickselect");function n(e,t){if(!(this instanceof n))return new n(e,t);this._maxEntries=Math.max(4,e||9);this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4));if(t){this._initFormat(t)}this.clear()}n.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,r=[],n=this.toBBox;if(!y(e,t))return r;var i=[],o,a,s,u;while(t){for(o=0,a=t.children.length;o<a;o++){s=t.children[o];u=t.leaf?n(s):s;if(y(e,u)){if(t.leaf)r.push(s);else if(_(e,u))this._all(s,r);else i.push(s)}}t=i.pop()}return r},collides:function(e){var t=this.data,r=this.toBBox;if(!y(e,t))return false;var n=[],i,o,a,s;while(t){for(i=0,o=t.children.length;i<o;i++){a=t.children[i];s=t.leaf?r(a):a;if(y(e,s)){if(t.leaf||_(e,s))return true;n.push(a)}}t=n.pop()}return false},load:function(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++){this.insert(e[t])}return this}var n=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length){this.data=n}else if(this.data.height===n.height){this._splitRoot(this.data,n)}else{if(this.data.height<n.height){var i=this.data;this.data=n;n=i}this._insert(n,this.data.height-n.height-1,true)}return this},insert:function(e){if(e)this._insert(e,this.data.height-1);return this},clear:function(){this.data=b([]);return this},remove:function(e,t){if(!e)return this;var r=this.data,n=this.toBBox(e),i=[],o=[],a,s,u,c;while(r||i.length){if(!r){r=i.pop();s=i[i.length-1];a=o.pop();c=true}if(r.leaf){u=h(e,r.children,t);if(u!==-1){r.children.splice(u,1);i.push(r);this._condense(i);return this}}if(!c&&!r.leaf&&_(r,n)){i.push(r);o.push(a);a=0;s=r;r=r.children[0]}else if(s){a++;r=s.children[a];c=false}else r=null}return this},toBBox:function(e){return e},compareMinX:u,compareMinY:c,toJSON:function(){return this.data},fromJSON:function(e){this.data=e;return this},_all:function(e,t){var r=[];while(e){if(e.leaf)t.push.apply(t,e.children);else r.push.apply(r,e.children);e=r.pop()}return t},_build:function(e,t,r,n){var i=r-t+1,o=this._maxEntries,a;if(i<=o){a=b(e.slice(t,r+1));f(a,this.toBBox);return a}if(!n){n=Math.ceil(Math.log(i)/Math.log(o));o=Math.ceil(i/Math.pow(o,n-1))}a=b([]);a.leaf=false;a.height=n;var s=Math.ceil(i/o),u=s*Math.ceil(Math.sqrt(o)),c,h,l,p;w(e,t,r,u,this.compareMinX);for(c=t;c<=r;c+=u){l=Math.min(c+u-1,r);w(e,c,l,s,this.compareMinY);for(h=c;h<=l;h+=s){p=Math.min(h+s-1,l);a.children.push(this._build(e,h,p,n-1))}}f(a,this.toBBox);return a},_chooseSubtree:function(e,t,r,n){var i,o,a,s,u,c,h,l;while(true){n.push(t);if(t.leaf||n.length-1===r)break;h=l=Infinity;for(i=0,o=t.children.length;i<o;i++){a=t.children[i];u=d(a);c=m(e,a)-u;if(c<l){l=c;h=u<h?u:h;s=a}else if(c===l){if(u<h){h=u;s=a}}}t=s||t.children[0]}return t},_insert:function(e,t,r){var n=this.toBBox,i=r?e:n(e),o=[];var a=this._chooseSubtree(i,this.data,t,o);a.children.push(e);p(a,i);while(t>=0){if(o[t].children.length>this._maxEntries){this._split(o,t);t--}else break}this._adjustParentBBoxes(i,o,t)},_split:function(e,t){var r=e[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n);var a=b(r.children.splice(o,r.children.length-o));a.height=r.height;a.leaf=r.leaf;f(r,this.toBBox);f(a,this.toBBox);if(t)e[t-1].children.push(a);else this._splitRoot(r,a)},_splitRoot:function(e,t){this.data=b([e,t]);this.data.height=e.height+1;this.data.leaf=false;f(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,r){var n,i,o,a,s,u,c,h;u=c=Infinity;for(n=t;n<=r-t;n++){i=l(e,0,n,this.toBBox);o=l(e,n,r,this.toBBox);a=g(i,o);s=d(i)+d(o);if(a<u){u=a;h=n;c=s<c?s:c}else if(a===u){if(s<c){c=s;h=n}}}return h},_chooseSplitAxis:function(e,t,r){var n=e.leaf?this.compareMinX:u,i=e.leaf?this.compareMinY:c,o=this._allDistMargin(e,t,r,n),a=this._allDistMargin(e,t,r,i);if(o<a)e.children.sort(n)},_allDistMargin:function(e,t,r,n){e.children.sort(n);var i=this.toBBox,o=l(e,0,t,i),a=l(e,r-t,r,i),s=v(o)+v(a),u,c;for(u=t;u<r-t;u++){c=e.children[u];p(o,e.leaf?i(c):c);s+=v(o)}for(u=r-t-1;u>=t;u--){c=e.children[u];p(a,e.leaf?i(c):c);s+=v(a)}return s},_adjustParentBBoxes:function(e,t,r){for(var n=r;n>=0;n--){p(t[n],e)}},_condense:function(e){for(var t=e.length-1,r;t>=0;t--){if(e[t].children.length===0){if(t>0){r=e[t-1].children;r.splice(r.indexOf(e[t]),1)}else this.clear()}else f(e[t],this.toBBox)}},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0]));this.compareMinY=new Function("a","b",t.join(e[1]));this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};function h(e,t,r){if(!r)return t.indexOf(e);for(var n=0;n<t.length;n++){if(r(e,t[n]))return n}return-1}function f(e,t){l(e,0,e.children.length,t,e)}function l(e,t,r,n,i){if(!i)i=b(null);i.minX=Infinity;i.minY=Infinity;i.maxX=-Infinity;i.maxY=-Infinity;for(var o=t,a;o<r;o++){a=e.children[o];p(i,e.leaf?n(a):a)}return i}function p(e,t){e.minX=Math.min(e.minX,t.minX);e.minY=Math.min(e.minY,t.minY);e.maxX=Math.max(e.maxX,t.maxX);e.maxY=Math.max(e.maxY,t.maxY);return e}function u(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function d(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function v(e){return e.maxX-e.minX+(e.maxY-e.minY)}function m(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function g(e,t){var r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),o=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,o-n)}function _(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function y(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function b(e){return{children:e,height:1,leaf:true,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function w(e,t,r,n,i){var o=[t,r],a;while(o.length){r=o.pop();t=o.pop();if(r-t<=n)continue;a=t+Math.ceil((r-t)/n/2)*n;s(e,a,t,r,i);o.push(t,a,a,r)}}},{quickselect:41}],43:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./internal/Observable");r.Observable=n.Observable;var i=e("./internal/observable/ConnectableObservable");r.ConnectableObservable=i.ConnectableObservable;var o=e("./internal/operators/groupBy");r.GroupedObservable=o.GroupedObservable;var a=e("./internal/symbol/observable");r.observable=a.observable;var s=e("./internal/Subject");r.Subject=s.Subject;var u=e("./internal/BehaviorSubject");r.BehaviorSubject=u.BehaviorSubject;var c=e("./internal/ReplaySubject");r.ReplaySubject=c.ReplaySubject;var h=e("./internal/AsyncSubject");r.AsyncSubject=h.AsyncSubject;var l=e("./internal/scheduler/asap");r.asapScheduler=l.asap;var p=e("./internal/scheduler/async");r.asyncScheduler=p.async;var f=e("./internal/scheduler/queue");r.queueScheduler=f.queue;var d=e("./internal/scheduler/animationFrame");r.animationFrameScheduler=d.animationFrame;var v=e("./internal/scheduler/VirtualTimeScheduler");r.VirtualTimeScheduler=v.VirtualTimeScheduler;r.VirtualAction=v.VirtualAction;var m=e("./internal/Scheduler");r.Scheduler=m.Scheduler;var g=e("./internal/Subscription");r.Subscription=g.Subscription;var _=e("./internal/Subscriber");r.Subscriber=_.Subscriber;var y=e("./internal/Notification");r.Notification=y.Notification;var b=e("./internal/util/pipe");r.pipe=b.pipe;var w=e("./internal/util/noop");r.noop=w.noop;var x=e("./internal/util/identity");r.identity=x.identity;var S=e("./internal/util/isObservable");r.isObservable=S.isObservable;var M=e("./internal/util/ArgumentOutOfRangeError");r.ArgumentOutOfRangeError=M.ArgumentOutOfRangeError;var C=e("./internal/util/EmptyError");r.EmptyError=C.EmptyError;var E=e("./internal/util/ObjectUnsubscribedError");r.ObjectUnsubscribedError=E.ObjectUnsubscribedError;var T=e("./internal/util/UnsubscriptionError");r.UnsubscriptionError=T.UnsubscriptionError;var O=e("./internal/util/TimeoutError");r.TimeoutError=O.TimeoutError;var P=e("./internal/observable/bindCallback");r.bindCallback=P.bindCallback;var A=e("./internal/observable/bindNodeCallback");r.bindNodeCallback=A.bindNodeCallback;var j=e("./internal/observable/combineLatest");r.combineLatest=j.combineLatest;var R=e("./internal/observable/concat");r.concat=R.concat;var k=e("./internal/observable/defer");r.defer=k.defer;var L=e("./internal/observable/empty");r.empty=L.empty;var I=e("./internal/observable/forkJoin");r.forkJoin=I.forkJoin;var N=e("./internal/observable/from");r.from=N.from;var D=e("./internal/observable/fromEvent");r.fromEvent=D.fromEvent;var B=e("./internal/observable/fromEventPattern");r.fromEventPattern=B.fromEventPattern;var F=e("./internal/observable/generate");r.generate=F.generate;var z=e("./internal/observable/iif");r.iif=z.iif;var $=e("./internal/observable/interval");r.interval=$.interval;var U=e("./internal/observable/merge");r.merge=U.merge;var G=e("./internal/observable/never");r.never=G.never;var V=e("./internal/observable/of");r.of=V.of;var H=e("./internal/observable/onErrorResumeNext");r.onErrorResumeNext=H.onErrorResumeNext;var q=e("./internal/observable/pairs");r.pairs=q.pairs;var W=e("./internal/observable/race");r.race=W.race;var X=e("./internal/observable/range");r.range=X.range;var Y=e("./internal/observable/throwError");r.throwError=Y.throwError;var K=e("./internal/observable/timer");r.timer=K.timer;var Z=e("./internal/observable/using");r.using=Z.using;var J=e("./internal/observable/zip");r.zip=J.zip;var Q=e("./internal/observable/empty");r.EMPTY=Q.EMPTY;var ee=e("./internal/observable/never");r.NEVER=ee.NEVER;var te=e("./internal/config");r.config=te.config},{"./internal/AsyncSubject":44,"./internal/BehaviorSubject":45,"./internal/Notification":47,"./internal/Observable":48,"./internal/ReplaySubject":51,"./internal/Scheduler":52,"./internal/Subject":53,"./internal/Subscriber":55,"./internal/Subscription":56,"./internal/config":57,"./internal/observable/ConnectableObservable":58,"./internal/observable/bindCallback":60,"./internal/observable/bindNodeCallback":61,"./internal/observable/combineLatest":62,"./internal/observable/concat":63,"./internal/observable/defer":64,"./internal/observable/empty":65,"./internal/observable/forkJoin":66,"./internal/observable/from":67,"./internal/observable/fromEvent":69,"./internal/observable/fromEventPattern":70,"./internal/observable/generate":74,"./internal/observable/iif":75,"./internal/observable/interval":76,"./internal/observable/merge":77,"./internal/observable/never":78,"./internal/observable/of":79,"./internal/observable/onErrorResumeNext":80,"./internal/observable/pairs":81,"./internal/observable/race":82,"./internal/observable/range":83,"./internal/observable/throwError":85,"./internal/observable/timer":86,"./internal/observable/using":87,"./internal/observable/zip":88,"./internal/operators/groupBy":124,"./internal/scheduler/VirtualTimeScheduler":201,"./internal/scheduler/animationFrame":202,"./internal/scheduler/asap":203,"./internal/scheduler/async":204,"./internal/scheduler/queue":205,"./internal/symbol/observable":207,"./internal/util/ArgumentOutOfRangeError":209,"./internal/util/EmptyError":210,"./internal/util/ObjectUnsubscribedError":212,"./internal/util/TimeoutError":213,"./internal/util/UnsubscriptionError":214,"./internal/util/identity":218,"./internal/util/isObservable":227,"./internal/util/noop":230,"./internal/util/pipe":232}],44:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("./Subject");var o=e("./Subscription");var a=function(t){n(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.value=null;e.hasNext=false;e.hasCompleted=false;return e}e.prototype._subscribe=function(e){if(this.hasError){e.error(this.thrownError);return o.Subscription.EMPTY}else if(this.hasCompleted&&this.hasNext){e.next(this.value);e.complete();return o.Subscription.EMPTY}return t.prototype._subscribe.call(this,e)};e.prototype.next=function(e){if(!this.hasCompleted){this.value=e;this.hasNext=true}};e.prototype.error=function(e){if(!this.hasCompleted){t.prototype.error.call(this,e)}};e.prototype.complete=function(){this.hasCompleted=true;if(this.hasNext){t.prototype.next.call(this,this.value)}t.prototype.complete.call(this)};return e}(i.Subject);r.AsyncSubject=a},{"./Subject":53,"./Subscription":56}],45:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("./Subject");var o=e("./util/ObjectUnsubscribedError");var a=function(r){n(e,r);function e(e){var t=r.call(this)||this;t._value=e;return t}Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:true,configurable:true});e.prototype._subscribe=function(e){var t=r.prototype._subscribe.call(this,e);if(t&&!t.closed){e.next(this._value)}return t};e.prototype.getValue=function(){if(this.hasError){throw this.thrownError}else if(this.closed){throw new o.ObjectUnsubscribedError}else{return this._value}};e.prototype.next=function(e){r.prototype.next.call(this,this._value=e)};return e}(i.Subject);r.BehaviorSubject=a},{"./Subject":53,"./util/ObjectUnsubscribedError":212}],46:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("./Subscriber");var o=function(i){n(e,i);function e(e,t,r){var n=i.call(this)||this;n.parent=e;n.outerValue=t;n.outerIndex=r;n.index=0;return n}e.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)};e.prototype._error=function(e){this.parent.notifyError(e,this);this.unsubscribe()};e.prototype._complete=function(){this.parent.notifyComplete(this);this.unsubscribe()};return e}(i.Subscriber);r.InnerSubscriber=o},{"./Subscriber":55}],47:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./observable/empty");var i=e("./observable/of");var o=e("./observable/throwError");var a=function(){function t(e,t,r){this.kind=e;this.value=t;this.error=r;this.hasValue=e==="N"}t.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}};t.prototype.do=function(e,t,r){var n=this.kind;switch(n){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return r&&r()}};t.prototype.accept=function(e,t,r){if(e&&typeof e.next==="function"){return this.observe(e)}else{return this.do(e,t,r)}};t.prototype.toObservable=function(){var e=this.kind;switch(e){case"N":return i.of(this.value);case"E":return o.throwError(this.error);case"C":return n.empty()}throw new Error("unexpected notification kind value")};t.createNext=function(e){if(typeof e!=="undefined"){return new t("N",e)}return t.undefinedValueNotification};t.createError=function(e){return new t("E",undefined,e)};t.createComplete=function(){return t.completeNotification};t.completeNotification=new t("C");t.undefinedValueNotification=new t("N",undefined);return t}();r.Notification=a},{"./observable/empty":65,"./observable/of":79,"./observable/throwError":85}],48:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./util/canReportError");var o=e("./util/toSubscriber");var i=e("../internal/symbol/observable");var a=e("./util/pipe");var s=e("./config");var u=function(){function r(e){this._isScalar=false;if(e){this._subscribe=e}}r.prototype.lift=function(e){var t=new r;t.source=this;t.operator=e;return t};r.prototype.subscribe=function(e,t,r){var n=this.operator;var i=o.toSubscriber(e,t,r);if(n){n.call(i,this.source)}else{i.add(this.source||s.config.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i))}if(s.config.useDeprecatedSynchronousErrorHandling){if(i.syncErrorThrowable){i.syncErrorThrowable=false;if(i.syncErrorThrown){throw i.syncErrorValue}}}return i};r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){if(s.config.useDeprecatedSynchronousErrorHandling){t.syncErrorThrown=true;t.syncErrorValue=e}if(n.canReportError(t)){t.error(e)}else{console.warn(e)}}};r.prototype.forEach=function(n,e){var i=this;e=c(e);return new e(function(e,t){var r;r=i.subscribe(function(e){try{n(e)}catch(e){t(e);if(r){r.unsubscribe()}}},t,e)})};r.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)};r.prototype[i.observable]=function(){return this};r.prototype.pipe=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(e.length===0){return this}return a.pipeFromArray(e)(this)};r.prototype.toPromise=function(e){var n=this;e=c(e);return new e(function(e,t){var r;n.subscribe(function(e){return r=e},function(e){return t(e)},function(){return e(r)})})};r.create=function(e){return new r(e)};return r}();r.Observable=u;function c(e){if(!e){e=s.config.Promise||Promise}if(!e){throw new Error("no Promise impl found")}return e}},{"../internal/symbol/observable":207,"./config":57,"./util/canReportError":215,"./util/pipe":232,"./util/toSubscriber":239}],49:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./config");var i=e("./util/hostReportError");r.empty={closed:true,next:function(e){},error:function(e){if(n.config.useDeprecatedSynchronousErrorHandling){throw e}else{i.hostReportError(e)}},complete:function(){}}},{"./config":57,"./util/hostReportError":217}],50:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("./Subscriber");var o=function(e){n(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.notifyNext=function(e,t,r,n,i){this.destination.next(t)};t.prototype.notifyError=function(e,t){this.destination.error(e)};t.prototype.notifyComplete=function(e){this.destination.complete()};return t}(i.Subscriber);r.OuterSubscriber=o},{"./Subscriber":55}],51:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("./Subject");var o=e("./scheduler/queue");var s=e("./Subscription");var u=e("./operators/observeOn");var c=e("./util/ObjectUnsubscribedError");var h=e("./SubjectSubscription");var a=function(i){n(e,i);function e(e,t,r){if(e===void 0){e=Number.POSITIVE_INFINITY}if(t===void 0){t=Number.POSITIVE_INFINITY}var n=i.call(this)||this;n.scheduler=r;n._events=[];n._infiniteTimeWindow=false;n._bufferSize=e<1?1:e;n._windowTime=t<1?1:t;if(t===Number.POSITIVE_INFINITY){n._infiniteTimeWindow=true;n.next=n.nextInfiniteTimeWindow}else{n.next=n.nextTimeWindow}return n}e.prototype.nextInfiniteTimeWindow=function(e){var t=this._events;t.push(e);if(t.length>this._bufferSize){t.shift()}i.prototype.next.call(this,e)};e.prototype.nextTimeWindow=function(e){this._events.push(new l(this._getNow(),e));this._trimBufferThenGetEvents();i.prototype.next.call(this,e)};e.prototype._subscribe=function(e){var t=this._infiniteTimeWindow;var r=t?this._events:this._trimBufferThenGetEvents();var n=this.scheduler;var i=r.length;var o;if(this.closed){throw new c.ObjectUnsubscribedError}else if(this.isStopped||this.hasError){o=s.Subscription.EMPTY}else{this.observers.push(e);o=new h.SubjectSubscription(this,e)}if(n){e.add(e=new u.ObserveOnSubscriber(e,n))}if(t){for(var a=0;a<i&&!e.closed;a++){e.next(r[a])}}else{for(var a=0;a<i&&!e.closed;a++){e.next(r[a].value)}}if(this.hasError){e.error(this.thrownError)}else if(this.isStopped){e.complete()}return o};e.prototype._getNow=function(){return(this.scheduler||o.queue).now()};e.prototype._trimBufferThenGetEvents=function(){var e=this._getNow();var t=this._bufferSize;var r=this._windowTime;var n=this._events;var i=n.length;var o=0;while(o<i){if(e-n[o].time<r){break}o++}if(i>t){o=Math.max(o,i-t)}if(o>0){n.splice(0,o)}return n};return e}(i.Subject);r.ReplaySubject=a;var l=function(){function e(e,t){this.time=e;this.value=t}return e}()},{"./Subject":53,"./SubjectSubscription":54,"./Subscription":56,"./operators/observeOn":139,"./scheduler/queue":205,"./util/ObjectUnsubscribedError":212}],52:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function r(e,t){if(t===void 0){t=r.now}this.SchedulerAction=e;this.now=t}r.prototype.schedule=function(e,t,r){if(t===void 0){t=0}return new this.SchedulerAction(this,e).schedule(r,t)};r.now=function(){return Date.now()};return r}();r.Scheduler=n},{}],53:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("./Observable");var o=e("./Subscriber");var a=e("./Subscription");var s=e("./util/ObjectUnsubscribedError");var u=e("./SubjectSubscription");var c=e("../internal/symbol/rxSubscriber");var h=function(r){i(e,r);function e(e){var t=r.call(this,e)||this;t.destination=e;return t}return e}(o.Subscriber);r.SubjectSubscriber=h;var l=function(t){i(e,t);function e(){var e=t.call(this)||this;e.observers=[];e.closed=false;e.isStopped=false;e.hasError=false;e.thrownError=null;return e}e.prototype[c.rxSubscriber]=function(){return new h(this)};e.prototype.lift=function(e){var t=new p(this,this);t.operator=e;return t};e.prototype.next=function(e){if(this.closed){throw new s.ObjectUnsubscribedError}if(!this.isStopped){var t=this.observers;var r=t.length;var n=t.slice();for(var i=0;i<r;i++){n[i].next(e)}}};e.prototype.error=function(e){if(this.closed){throw new s.ObjectUnsubscribedError}this.hasError=true;this.thrownError=e;this.isStopped=true;var t=this.observers;var r=t.length;var n=t.slice();for(var i=0;i<r;i++){n[i].error(e)}this.observers.length=0};e.prototype.complete=function(){if(this.closed){throw new s.ObjectUnsubscribedError}this.isStopped=true;var e=this.observers;var t=e.length;var r=e.slice();for(var n=0;n<t;n++){r[n].complete()}this.observers.length=0};e.prototype.unsubscribe=function(){this.isStopped=true;this.closed=true;this.observers=null};e.prototype._trySubscribe=function(e){if(this.closed){throw new s.ObjectUnsubscribedError}else{return t.prototype._trySubscribe.call(this,e)}};e.prototype._subscribe=function(e){if(this.closed){throw new s.ObjectUnsubscribedError}else if(this.hasError){e.error(this.thrownError);return a.Subscription.EMPTY}else if(this.isStopped){e.complete();return a.Subscription.EMPTY}else{this.observers.push(e);return new u.SubjectSubscription(this,e)}};e.prototype.asObservable=function(){var e=new n.Observable;e.source=this;return e};e.create=function(e,t){return new p(e,t)};return e}(n.Observable);r.Subject=l;var p=function(n){i(e,n);function e(e,t){var r=n.call(this)||this;r.destination=e;r.source=t;return r}e.prototype.next=function(e){var t=this.destination;if(t&&t.next){t.next(e)}};e.prototype.error=function(e){var t=this.destination;if(t&&t.error){this.destination.error(e)}};e.prototype.complete=function(){var e=this.destination;if(e&&e.complete){this.destination.complete()}};e.prototype._subscribe=function(e){var t=this.source;if(t){return this.source.subscribe(e)}else{return a.Subscription.EMPTY}};return e}(l);r.AnonymousSubject=p},{"../internal/symbol/rxSubscriber":208,"./Observable":48,"./SubjectSubscription":54,"./Subscriber":55,"./Subscription":56,"./util/ObjectUnsubscribedError":212}],54:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("./Subscription");var o=function(n){i(e,n);function e(e,t){var r=n.call(this)||this;r.subject=e;r.subscriber=t;r.closed=false;return r}e.prototype.unsubscribe=function(){if(this.closed){return}this.closed=true;var e=this.subject;var t=e.observers;this.subject=null;if(!t||t.length===0||e.isStopped||e.closed){return}var r=t.indexOf(this.subscriber);if(r!==-1){t.splice(r,1)}};return e}(n.Subscription);r.SubjectSubscription=o},{"./Subscription":56}],55:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var u=e("./util/isFunction");var c=e("./Observer");var i=e("./Subscription");var a=e("../internal/symbol/rxSubscriber");var o=e("./config");var h=e("./util/hostReportError");var s=function(i){n(o,i);function o(e,t,r){var n=i.call(this)||this;n.syncErrorValue=null;n.syncErrorThrown=false;n.syncErrorThrowable=false;n.isStopped=false;n._parentSubscription=null;switch(arguments.length){case 0:n.destination=c.empty;break;case 1:if(!e){n.destination=c.empty;break}if(typeof e==="object"){if(e instanceof o){n.syncErrorThrowable=e.syncErrorThrowable;n.destination=e;e.add(n)}else{n.syncErrorThrowable=true;n.destination=new l(n,e)}break}default:n.syncErrorThrowable=true;n.destination=new l(n,e,t,r);break}return n}o.prototype[a.rxSubscriber]=function(){return this};o.create=function(e,t,r){var n=new o(e,t,r);n.syncErrorThrowable=false;return n};o.prototype.next=function(e){if(!this.isStopped){this._next(e)}};o.prototype.error=function(e){if(!this.isStopped){this.isStopped=true;this._error(e)}};o.prototype.complete=function(){if(!this.isStopped){this.isStopped=true;this._complete()}};o.prototype.unsubscribe=function(){if(this.closed){return}this.isStopped=true;i.prototype.unsubscribe.call(this)};o.prototype._next=function(e){this.destination.next(e)};o.prototype._error=function(e){this.destination.error(e);this.unsubscribe()};o.prototype._complete=function(){this.destination.complete();this.unsubscribe()};o.prototype._unsubscribeAndRecycle=function(){var e=this,t=e._parent,r=e._parents;this._parent=null;this._parents=null;this.unsubscribe();this.closed=false;this.isStopped=false;this._parent=t;this._parents=r;this._parentSubscription=null;return this};return o}(i.Subscription);r.Subscriber=s;var l=function(s){n(e,s);function e(e,t,r,n){var i=s.call(this)||this;i._parentSubscriber=e;var o;var a=i;if(u.isFunction(t)){o=t}else if(t){o=t.next;r=t.error;n=t.complete;if(t!==c.empty){a=Object.create(t);if(u.isFunction(a.unsubscribe)){i.add(a.unsubscribe.bind(a))}a.unsubscribe=i.unsubscribe.bind(i)}}i._context=a;i._next=o;i._error=r;i._complete=n;return i}e.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;if(!o.config.useDeprecatedSynchronousErrorHandling||!t.syncErrorThrowable){this.__tryOrUnsub(this._next,e)}else if(this.__tryOrSetError(t,this._next,e)){this.unsubscribe()}}};e.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber;var r=o.config.useDeprecatedSynchronousErrorHandling;if(this._error){if(!r||!t.syncErrorThrowable){this.__tryOrUnsub(this._error,e);this.unsubscribe()}else{this.__tryOrSetError(t,this._error,e);this.unsubscribe()}}else if(!t.syncErrorThrowable){this.unsubscribe();if(r){throw e}h.hostReportError(e)}else{if(r){t.syncErrorValue=e;t.syncErrorThrown=true}else{h.hostReportError(e)}this.unsubscribe()}}};e.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var r=function(){return e._complete.call(e._context)};if(!o.config.useDeprecatedSynchronousErrorHandling||!t.syncErrorThrowable){this.__tryOrUnsub(r);this.unsubscribe()}else{this.__tryOrSetError(t,r);this.unsubscribe()}}else{this.unsubscribe()}}};e.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){this.unsubscribe();if(o.config.useDeprecatedSynchronousErrorHandling){throw e}else{h.hostReportError(e)}}};e.prototype.__tryOrSetError=function(t,e,r){if(!o.config.useDeprecatedSynchronousErrorHandling){throw new Error("bad call")}try{e.call(this._context,r)}catch(e){if(o.config.useDeprecatedSynchronousErrorHandling){t.syncErrorValue=e;t.syncErrorThrown=true;return true}else{h.hostReportError(e);return true}}return false};e.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null;this._parentSubscriber=null;e.unsubscribe()};return e}(s);r.SafeSubscriber=l},{"../internal/symbol/rxSubscriber":208,"./Observer":49,"./Subscription":56,"./config":57,"./util/hostReportError":217,"./util/isFunction":222}],56:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var p=e("./util/isArray");var f=e("./util/isObject");var d=e("./util/isFunction");var v=e("./util/tryCatch");var m=e("./util/errorObject");var g=e("./util/UnsubscriptionError");var n=function(){function i(e){this.closed=false;this._parent=null;this._parents=null;this._subscriptions=null;if(e){this._unsubscribe=e}}i.prototype.unsubscribe=function(){var e=false;var t;if(this.closed){return}var r=this,n=r._parent,i=r._parents,o=r._unsubscribe,a=r._subscriptions;this.closed=true;this._parent=null;this._parents=null;this._subscriptions=null;var s=-1;var u=i?i.length:0;while(n){n.remove(this);n=++s<u&&i[s]||null}if(d.isFunction(o)){var c=v.tryCatch(o).call(this);if(c===m.errorObject){e=true;t=t||(m.errorObject.e instanceof g.UnsubscriptionError?_(m.errorObject.e.errors):[m.errorObject.e])}}if(p.isArray(a)){s=-1;u=a.length;while(++s<u){var h=a[s];if(f.isObject(h)){var c=v.tryCatch(h.unsubscribe).call(h);if(c===m.errorObject){e=true;t=t||[];var l=m.errorObject.e;if(l instanceof g.UnsubscriptionError){t=t.concat(_(l.errors))}else{t.push(l)}}}}}if(e){throw new g.UnsubscriptionError(t)}};i.prototype.add=function(e){if(!e||e===i.EMPTY){return i.EMPTY}if(e===this){return this}var t=e;switch(typeof e){case"function":t=new i(e);case"object":if(t.closed||typeof t.unsubscribe!=="function"){return t}else if(this.closed){t.unsubscribe();return t}else if(typeof t._addParent!=="function"){var r=t;t=new i;t._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var n=this._subscriptions||(this._subscriptions=[]);n.push(t);t._addParent(this);return t};i.prototype.remove=function(e){var t=this._subscriptions;if(t){var r=t.indexOf(e);if(r!==-1){t.splice(r,1)}}};i.prototype._addParent=function(e){var t=this,r=t._parent,n=t._parents;if(!r||r===e){this._parent=e}else if(!n){this._parents=[e]}else if(n.indexOf(e)===-1){n.push(e)}};i.EMPTY=function(e){e.closed=true;return e}(new i);return i}();r.Subscription=n;function _(e){return e.reduce(function(e,t){return e.concat(t instanceof g.UnsubscriptionError?t.errors:t)},[])}},{"./util/UnsubscriptionError":214,"./util/errorObject":216,"./util/isArray":219,"./util/isFunction":222,"./util/isObject":226,"./util/tryCatch":240}],57:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=false;r.config={Promise:undefined,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else if(n){console.log("RxJS: Back to a better error behavior. Thank you. <3")}n=e},get useDeprecatedSynchronousErrorHandling(){return n}}},{}],58:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subject");var o=e("../Observable");var a=e("../Subscriber");var s=e("../Subscription");var u=e("../operators/refCount");var c=function(n){i(e,n);function e(e,t){var r=n.call(this)||this;r.source=e;r.subjectFactory=t;r._refCount=0;r._isComplete=false;return r}e.prototype._subscribe=function(e){return this.getSubject().subscribe(e)};e.prototype.getSubject=function(){var e=this._subject;if(!e||e.isStopped){this._subject=this.subjectFactory()}return this._subject};e.prototype.connect=function(){var e=this._connection;if(!e){this._isComplete=false;e=this._connection=new s.Subscription;e.add(this.source.subscribe(new l(this.getSubject(),this)));if(e.closed){this._connection=null;e=s.Subscription.EMPTY}else{this._connection=e}}return e};e.prototype.refCount=function(){return u.refCount()(this)};return e}(o.Observable);r.ConnectableObservable=c;var h=c.prototype;r.connectableObservableDescriptor={operator:{value:null},_refCount:{value:0,writable:true},_subject:{value:null,writable:true},_connection:{value:null,writable:true},_subscribe:{value:h._subscribe},_isComplete:{value:h._isComplete,writable:true},getSubject:{value:h.getSubject},connect:{value:h.connect},refCount:{value:h.refCount}};var l=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.connectable=t;return r}e.prototype._error=function(e){this._unsubscribe();n.prototype._error.call(this,e)};e.prototype._complete=function(){this.connectable._isComplete=true;this._unsubscribe();n.prototype._complete.call(this)};e.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0;e._subject=null;e._connection=null;if(t){t.unsubscribe()}}};return e}(n.SubjectSubscriber);var p=function(){function e(e){this.connectable=e}e.prototype.call=function(e,t){var r=this.connectable;r._refCount++;var n=new f(e,r);var i=t.subscribe(n);if(!n.closed){n.connection=r.connect()}return i};return e}();var f=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.connectable=t;return r}e.prototype._unsubscribe=function(){var e=this.connectable;if(!e){this.connection=null;return}this.connectable=null;var t=e._refCount;if(t<=0){this.connection=null;return}e._refCount=t-1;if(t>1){this.connection=null;return}var r=this.connection;var n=e._connection;this.connection=null;if(n&&(!r||n===r)){n.unsubscribe()}};return e}(a.Subscriber)},{"../Observable":48,"../Subject":53,"../Subscriber":55,"../Subscription":56,"../operators/refCount":150}],59:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Observable");var a=e("../scheduler/asap");var s=e("../util/isNumeric");var o=function(i){n(o,i);function o(e,t,r){if(t===void 0){t=0}if(r===void 0){r=a.asap}var n=i.call(this)||this;n.source=e;n.delayTime=t;n.scheduler=r;if(!s.isNumeric(t)||t<0){n.delayTime=0}if(!r||typeof r.schedule!=="function"){n.scheduler=a.asap}return n}o.create=function(e,t,r){if(t===void 0){t=0}if(r===void 0){r=a.asap}return new o(e,t,r)};o.dispatch=function(e){var t=e.source,r=e.subscriber;return this.add(t.subscribe(r))};o.prototype._subscribe=function(e){var t=this.delayTime;var r=this.source;var n=this.scheduler;return n.schedule(o.dispatch,t,{source:r,subscriber:e})};return o}(i.Observable);r.SubscribeOnObservable=o},{"../Observable":48,"../scheduler/asap":203,"../util/isNumeric":225}],60:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var c=e("../Observable");var l=e("../AsyncSubject");var n=e("../operators/map");var h=e("../util/canReportError");var i=e("../util/isArray");var o=e("../util/isScheduler");function a(s,r,u){if(r){if(o.isScheduler(r)){u=r}else{return function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return a(s,u).apply(void 0,e).pipe(n.map(function(e){return i.isArray(e)?r.apply(void 0,e):r(e)}))}}}return function(){var n=[];for(var e=0;e<arguments.length;e++){n[e]=arguments[e]}var i=this;var o;var a={context:i,subject:o,callbackFunc:s,scheduler:u};return new c.Observable(function(e){if(!u){if(!o){o=new l.AsyncSubject;var t=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}o.next(e.length<=1?e[0]:e);o.complete()};try{s.apply(i,n.concat([t]))}catch(e){if(h.canReportError(o)){o.error(e)}else{console.warn(e)}}}return o.subscribe(e)}else{var r={args:n,subscriber:e,params:a};return u.schedule(p,0,r)}})}}r.bindCallback=a;function p(e){var n=this;var t=this;var r=e.args,i=e.subscriber,o=e.params;var a=o.callbackFunc,s=o.context,u=o.scheduler;var c=o.subject;if(!c){c=o.subject=new l.AsyncSubject;var h=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=e.length<=1?e[0]:e;n.add(u.schedule(f,0,{value:r,subject:c}))};try{a.apply(s,r.concat([h]))}catch(e){c.error(e)}}this.add(c.subscribe(i))}function f(e){var t=e.value,r=e.subject;r.next(t);r.complete()}function s(e){var t=e.err,r=e.subject;r.error(t)}},{"../AsyncSubject":44,"../Observable":48,"../operators/map":128,"../util/canReportError":215,"../util/isArray":219,"../util/isScheduler":229}],61:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Observable");var h=e("../AsyncSubject");var i=e("../operators/map");var u=e("../util/canReportError");var o=e("../util/isScheduler");var c=e("../util/isArray");function l(a,r,s){if(r){if(o.isScheduler(r)){s=r}else{return function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return l(a,s).apply(void 0,e).pipe(i.map(function(e){return c.isArray(e)?r.apply(void 0,e):r(e)}))}}}return function(){var i=[];for(var e=0;e<arguments.length;e++){i[e]=arguments[e]}var o={subject:undefined,args:i,callbackFunc:a,scheduler:s,context:this};return new n.Observable(function(e){var t=o.context;var n=o.subject;if(!s){if(!n){n=o.subject=new h.AsyncSubject;var r=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=e.shift();if(r){n.error(r);return}n.next(e.length<=1?e[0]:e);n.complete()};try{a.apply(t,i.concat([r]))}catch(e){if(u.canReportError(n)){n.error(e)}else{console.warn(e)}}}return n.subscribe(e)}else{return s.schedule(p,0,{params:o,subscriber:e,context:t})}})}}r.bindNodeCallback=l;function p(e){var i=this;var t=e.params,r=e.subscriber,n=e.context;var o=t.callbackFunc,a=t.args,s=t.scheduler;var u=t.subject;if(!u){u=t.subject=new h.AsyncSubject;var c=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=e.shift();if(r){i.add(s.schedule(d,0,{err:r,subject:u}))}else{var n=e.length<=1?e[0]:e;i.add(s.schedule(f,0,{value:n,subject:u}))}};try{o.apply(n,a.concat([c]))}catch(e){this.add(s.schedule(d,0,{err:e,subject:u}))}}this.add(u.subscribe(r))}function f(e){var t=e.value,r=e.subject;r.next(t);r.complete()}function d(e){var t=e.err,r=e.subject;r.error(t)}},{"../AsyncSubject":44,"../Observable":48,"../operators/map":128,"../util/canReportError":215,"../util/isArray":219,"../util/isScheduler":229}],62:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("../util/isScheduler");var a=e("../util/isArray");var n=e("../OuterSubscriber");var s=e("../util/subscribeToResult");var u=e("./fromArray");var c={};function h(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=null;var n=null;if(o.isScheduler(e[e.length-1])){n=e.pop()}if(typeof e[e.length-1]==="function"){r=e.pop()}if(e.length===1&&a.isArray(e[0])){e=e[0]}return u.fromArray(e,n).lift(new l(r))}r.combineLatest=h;var l=function(){function e(e){this.resultSelector=e}e.prototype.call=function(e,t){return t.subscribe(new p(e,this.resultSelector))};return e}();r.CombineLatestOperator=l;var p=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.resultSelector=t;r.active=0;r.values=[];r.observables=[];return r}e.prototype._next=function(e){this.values.push(c);this.observables.push(e)};e.prototype._complete=function(){var e=this.observables;var t=e.length;if(t===0){this.destination.complete()}else{this.active=t;this.toRespond=t;for(var r=0;r<t;r++){var n=e[r];this.add(s.subscribeToResult(this,n,n,r))}}};e.prototype.notifyComplete=function(e){if((this.active-=1)===0){this.destination.complete()}};e.prototype.notifyNext=function(e,t,r,n,i){var o=this.values;var a=o[r];var s=!this.toRespond?0:a===c?--this.toRespond:this.toRespond;o[r]=t;if(s===0){if(this.resultSelector){this._tryResultSelector(o)}else{this.destination.next(o.slice())}}};e.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){this.destination.error(e);return}this.destination.next(t)};return e}(n.OuterSubscriber);r.CombineLatestSubscriber=p},{"../OuterSubscriber":50,"../util/isArray":219,"../util/isScheduler":229,"../util/subscribeToResult":238,"./fromArray":68}],63:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../util/isScheduler");var i=e("./of");var o=e("./from");var a=e("../operators/concatAll");function s(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(e.length===1||e.length===2&&n.isScheduler(e[1])){return o.from(e[0])}return a.concatAll()(i.of.apply(void 0,e))}r.concat=s},{"../operators/concatAll":100,"../util/isScheduler":229,"./from":67,"./of":79}],64:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("../Observable");var o=e("./from");var a=e("./empty");function n(n){return new i.Observable(function(t){var e;try{e=n()}catch(e){t.error(e);return undefined}var r=e?o.from(e):a.empty();return r.subscribe(t)})}r.defer=n},{"../Observable":48,"./empty":65,"./from":67}],65:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Observable");r.EMPTY=new n.Observable(function(e){return e.complete()});function i(e){return e?o(e):r.EMPTY}r.empty=i;function o(t){return new n.Observable(function(e){return t.schedule(function(){return e.complete()})})}r.emptyScheduled=o},{"../Observable":48}],66:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Observable");var o=e("../util/isArray");var a=e("./empty");var u=e("../util/subscribeToResult");var s=e("../OuterSubscriber");var c=e("../operators/map");function h(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}var r;if(typeof t[t.length-1]==="function"){r=t.pop()}if(t.length===1&&o.isArray(t[0])){t=t[0]}if(t.length===0){return a.EMPTY}if(r){return h(t).pipe(c.map(function(e){return r.apply(void 0,e)}))}return new i.Observable(function(e){return new l(e,t)})}r.forkJoin=h;var l=function(s){n(e,s);function e(e,t){var r=s.call(this,e)||this;r.sources=t;r.completed=0;r.haveValues=0;var n=t.length;r.values=new Array(n);for(var i=0;i<n;i++){var o=t[i];var a=u.subscribeToResult(r,o,null,i);if(a){r.add(a)}}return r}e.prototype.notifyNext=function(e,t,r,n,i){this.values[r]=t;if(!i._hasValue){i._hasValue=true;this.haveValues++}};e.prototype.notifyComplete=function(e){var t=this,r=t.destination,n=t.haveValues,i=t.values;var o=i.length;if(!e._hasValue){r.complete();return}this.completed++;if(this.completed!==o){return}if(n===o){r.next(i)}r.complete()};return e}(s.OuterSubscriber)},{"../Observable":48,"../OuterSubscriber":50,"../operators/map":128,"../util/isArray":219,"../util/subscribeToResult":238,"./empty":65}],67:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Observable");var i=e("../util/isPromise");var o=e("../util/isArrayLike");var a=e("../util/isInteropObservable");var s=e("../util/isIterable");var u=e("./fromArray");var c=e("./fromPromise");var h=e("./fromIterable");var l=e("./fromObservable");var p=e("../util/subscribeTo");function f(e,t){if(!t){if(e instanceof n.Observable){return e}return new n.Observable(p.subscribeTo(e))}if(e!=null){if(a.isInteropObservable(e)){return l.fromObservable(e,t)}else if(i.isPromise(e)){return c.fromPromise(e,t)}else if(o.isArrayLike(e)){return u.fromArray(e,t)}else if(s.isIterable(e)||typeof e==="string"){return h.fromIterable(e,t)}}throw new TypeError((e!==null&&typeof e||e)+" is not observable")}r.from=f},{"../Observable":48,"../util/isArrayLike":220,"../util/isInteropObservable":223,"../util/isIterable":224,"../util/isPromise":228,"../util/subscribeTo":233,"./fromArray":68,"./fromIterable":71,"./fromObservable":72,"./fromPromise":73}],68:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=e("../Observable");var a=e("../Subscription");var s=e("../util/subscribeToArray");function n(n,i){if(!i){return new o.Observable(s.subscribeToArray(n))}else{return new o.Observable(function(e){var t=new a.Subscription;var r=0;t.add(i.schedule(function(){if(r===n.length){e.complete();return}e.next(n[r++]);if(!e.closed){t.add(this.schedule())}}));return t})}}r.fromArray=n},{"../Observable":48,"../Subscription":56,"../util/subscribeToArray":234}],69:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=e("../Observable");var a=e("../util/isArray");var s=e("../util/isFunction");var u=e("../operators/map");var n=Object.prototype.toString;function c(r,n,i,t){if(s.isFunction(i)){t=i;i=undefined}if(t){return c(r,n,i).pipe(u.map(function(e){return a.isArray(e)?t.apply(void 0,e):t(e)}))}return new o.Observable(function(t){function e(e){if(arguments.length>1){t.next(Array.prototype.slice.call(arguments))}else{t.next(e)}}l(r,n,e,t,i)})}r.fromEvent=c;function l(e,t,r,n,i){var o;if(d(e)){var a=e;e.addEventListener(t,r,i);o=function(){return a.removeEventListener(t,r,i)}}else if(f(e)){var s=e;e.on(t,r);o=function(){return s.off(t,r)}}else if(p(e)){var u=e;e.addListener(t,r);o=function(){return u.removeListener(t,r)}}else if(e&&e.length){for(var c=0,h=e.length;c<h;c++){l(e[c],t,r,n,i)}}else{throw new TypeError("Invalid event target")}n.add(o)}function p(e){return e&&typeof e.addListener==="function"&&typeof e.removeListener==="function"}function f(e){return e&&typeof e.on==="function"&&typeof e.off==="function"}function d(e){return e&&typeof e.addEventListener==="function"&&typeof e.removeEventListener==="function"}},{"../Observable":48,"../operators/map":128,"../util/isArray":219,"../util/isFunction":222}],70:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=e("../Observable");var a=e("../util/isArray");var s=e("../util/isFunction");var u=e("../operators/map");function c(n,i,t){if(t){return c(n,i).pipe(u.map(function(e){return a.isArray(e)?t.apply(void 0,e):t(e)}))}return new o.Observable(function(r){var e=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return r.next(e.length===1?e[0]:e)};var t;try{t=n(e)}catch(e){r.error(e);return undefined}if(!s.isFunction(i)){return undefined}return function(){return i(e,t)}})}r.fromEventPattern=c},{"../Observable":48,"../operators/map":128,"../util/isArray":219,"../util/isFunction":222}],71:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Observable");var o=e("../Subscription");var a=e("../symbol/iterator");var i=e("../util/subscribeToIterable");function s(t,r){if(!t){throw new Error("Iterable cannot be null")}if(!r){return new n.Observable(i.subscribeToIterable(t))}else{return new n.Observable(function(n){var e=new o.Subscription;var i;e.add(function(){if(i&&typeof i.return==="function"){i.return()}});e.add(r.schedule(function(){i=t[a.iterator]();e.add(r.schedule(function(){if(n.closed){return}var e;var t;try{var r=i.next();e=r.value;t=r.done}catch(e){n.error(e);return}if(t){n.complete()}else{n.next(e);this.schedule()}}))}));return e})}}r.fromIterable=s},{"../Observable":48,"../Subscription":56,"../symbol/iterator":206,"../util/subscribeToIterable":235}],72:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=e("../Observable");var a=e("../Subscription");var s=e("../symbol/observable");var u=e("../util/subscribeToObservable");function n(n,i){if(!i){return new o.Observable(u.subscribeToObservable(n))}else{return new o.Observable(function(t){var r=new a.Subscription;r.add(i.schedule(function(){var e=n[s.observable]();r.add(e.subscribe({next:function(e){r.add(i.schedule(function(){return t.next(e)}))},error:function(e){r.add(i.schedule(function(){return t.error(e)}))},complete:function(){r.add(i.schedule(function(){return t.complete()}))}}))}));return r})}}r.fromObservable=n},{"../Observable":48,"../Subscription":56,"../symbol/observable":207,"../util/subscribeToObservable":236}],73:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("../Observable");var o=e("../Subscription");var a=e("../util/subscribeToPromise");function n(e,n){if(!n){return new i.Observable(a.subscribeToPromise(e))}else{return new i.Observable(function(t){var r=new o.Subscription;r.add(n.schedule(function(){return e.then(function(e){r.add(n.schedule(function(){t.next(e);r.add(n.schedule(function(){return t.complete()}))}))},function(e){r.add(n.schedule(function(){return t.error(e)}))})}));return r})}}r.fromPromise=n},{"../Observable":48,"../Subscription":56,"../util/subscribeToPromise":237}],74:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Observable");var c=e("../util/identity");var h=e("../util/isScheduler");function i(e,i,o,t,a){var s;var u;if(arguments.length==1){var r=e;u=r.initialState;i=r.condition;o=r.iterate;s=r.resultSelector||c.identity;a=r.scheduler}else if(t===undefined||h.isScheduler(t)){u=e;s=c.identity;a=t}else{u=e;s=t}return new n.Observable(function(t){var e=u;if(a){return a.schedule(l,0,{subscriber:t,iterate:o,condition:i,resultSelector:s,state:e})}do{if(i){var r=void 0;try{r=i(e)}catch(e){t.error(e);return undefined}if(!r){t.complete();break}}var n=void 0;try{n=s(e)}catch(e){t.error(e);return undefined}t.next(n);if(t.closed){break}try{e=o(e)}catch(e){t.error(e);return undefined}}while(true);return undefined})}r.generate=i;function l(e){var t=e.subscriber,r=e.condition;if(t.closed){return undefined}if(e.needIterate){try{e.state=e.iterate(e.state)}catch(e){t.error(e);return undefined}}else{e.needIterate=true}if(r){var n=void 0;try{n=r(e.state)}catch(e){t.error(e);return undefined}if(!n){t.complete();return undefined}if(t.closed){return undefined}}var i;try{i=e.resultSelector(e.state)}catch(e){t.error(e);return undefined}if(t.closed){return undefined}t.next(i);if(t.closed){return undefined}return this.schedule(e)}},{"../Observable":48,"../util/identity":218,"../util/isScheduler":229}],75:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./defer");var i=e("./empty");function o(e,t,r){if(t===void 0){t=i.EMPTY}if(r===void 0){r=i.EMPTY}return n.defer(function(){return e()?t:r})}r.iif=o},{"./defer":64,"./empty":65}],76:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Observable");var i=e("../scheduler/async");var o=e("../util/isNumeric");function a(t,r){if(t===void 0){t=0}if(r===void 0){r=i.async}if(!o.isNumeric(t)||t<0){t=0}if(!r||typeof r.schedule!=="function"){r=i.async}return new n.Observable(function(e){e.add(r.schedule(s,t,{subscriber:e,counter:0,period:t}));return e})}r.interval=a;function s(e){var t=e.subscriber,r=e.counter,n=e.period;t.next(r);this.schedule({subscriber:t,counter:r+1,period:n},n)}},{"../Observable":48,"../scheduler/async":204,"../util/isNumeric":225}],77:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=e("../Observable");var a=e("../util/isScheduler");var s=e("../operators/mergeAll");var u=e("./fromArray");function n(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=Number.POSITIVE_INFINITY;var n=null;var i=e[e.length-1];if(a.isScheduler(i)){n=e.pop();if(e.length>1&&typeof e[e.length-1]==="number"){r=e.pop()}}else if(typeof i==="number"){r=e.pop()}if(n===null&&e.length===1&&e[0]instanceof o.Observable){return e[0]}return s.mergeAll(r)(u.fromArray(e,n))}r.merge=n},{"../Observable":48,"../operators/mergeAll":133,"../util/isScheduler":229,"./fromArray":68}],78:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Observable");var i=e("../util/noop");r.NEVER=new n.Observable(i.noop);function o(){return r.NEVER}r.never=o},{"../Observable":48,"../util/noop":230}],79:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../util/isScheduler");var i=e("./fromArray");var o=e("./empty");var a=e("./scalar");function s(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=e[e.length-1];if(n.isScheduler(r)){e.pop()}else{r=undefined}switch(e.length){case 0:return o.empty(r);case 1:return r?i.fromArray(e,r):a.scalar(e[0]);default:return i.fromArray(e,r)}}r.of=s},{"../util/isScheduler":229,"./empty":65,"./fromArray":68,"./scalar":84}],80:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("../Observable");var o=e("./from");var a=e("../util/isArray");var s=e("./empty");function u(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(e.length===0){return s.EMPTY}var r=e[0],n=e.slice(1);if(e.length===1&&a.isArray(r)){return u.apply(void 0,r)}return new i.Observable(function(t){var e=function(){return t.add(u.apply(void 0,n).subscribe(t))};return o.from(r).subscribe({next:function(e){t.next(e)},error:e,complete:e})})}r.onErrorResumeNext=u},{"../Observable":48,"../util/isArray":219,"./empty":65,"./from":67}],81:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=e("../Observable");var a=e("../Subscription");function n(i,n){if(!n){return new o.Observable(function(e){var t=Object.keys(i);for(var r=0;r<t.length&&!e.closed;r++){var n=t[r];if(i.hasOwnProperty(n)){e.next([n,i[n]])}}e.complete()})}else{return new o.Observable(function(e){var t=Object.keys(i);var r=new a.Subscription;r.add(n.schedule(s,0,{keys:t,index:0,subscriber:e,subscription:r,obj:i}));return r})}}r.pairs=n;function s(e){var t=e.keys,r=e.index,n=e.subscriber,i=e.subscription,o=e.obj;if(!n.closed){if(r<t.length){var a=t[r];n.next([a,o[a]]);i.add(this.schedule({keys:t,index:r+1,subscriber:n,subscription:i,obj:o}))}else{n.complete()}}}r.dispatch=s},{"../Observable":48,"../Subscription":56}],82:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../util/isArray");var o=e("./fromArray");var a=e("../OuterSubscriber");var s=e("../util/subscribeToResult");function u(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(e.length===1){if(i.isArray(e[0])){e=e[0]}else{return e[0]}}return o.fromArray(e,undefined).lift(new c)}r.race=u;var c=function(){function e(){}e.prototype.call=function(e,t){return t.subscribe(new h(e))};return e}();r.RaceOperator=c;var h=function(r){n(e,r);function e(e){var t=r.call(this,e)||this;t.hasFirst=false;t.observables=[];t.subscriptions=[];return t}e.prototype._next=function(e){this.observables.push(e)};e.prototype._complete=function(){var e=this.observables;var t=e.length;if(t===0){this.destination.complete()}else{for(var r=0;r<t&&!this.hasFirst;r++){var n=e[r];var i=s.subscribeToResult(this,n,n,r);if(this.subscriptions){this.subscriptions.push(i)}this.add(i)}this.observables=null}};e.prototype.notifyNext=function(e,t,r,n,i){if(!this.hasFirst){this.hasFirst=true;for(var o=0;o<this.subscriptions.length;o++){if(o!==r){var a=this.subscriptions[o];a.unsubscribe();this.remove(a)}}this.subscriptions=null}this.destination.next(t)};return e}(a.OuterSubscriber);r.RaceSubscriber=h},{"../OuterSubscriber":50,"../util/isArray":219,"../util/subscribeToResult":238,"./fromArray":68}],83:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var a=e("../Observable");function n(n,i,o){if(n===void 0){n=0}if(i===void 0){i=0}return new a.Observable(function(e){var t=0;var r=n;if(o){return o.schedule(s,0,{index:t,count:i,start:n,subscriber:e})}else{do{if(t++>=i){e.complete();break}e.next(r++);if(e.closed){break}}while(true)}return undefined})}r.range=n;function s(e){var t=e.start,r=e.index,n=e.count,i=e.subscriber;if(r>=n){i.complete();return}i.next(t);if(i.closed){return}e.index=r+1;e.start=t+1;this.schedule(e)}r.dispatch=s},{"../Observable":48}],84:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Observable");function i(t){var e=new n.Observable(function(e){e.next(t);e.complete()});e._isScalar=true;e.value=t;return e}r.scalar=i},{"../Observable":48}],85:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Observable");function i(t,r){if(!r){return new n.Observable(function(e){return e.error(t)})}else{return new n.Observable(function(e){return r.schedule(o,0,{error:t,subscriber:e})})}}r.throwError=i;function o(e){var t=e.error,r=e.subscriber;r.error(t)}},{"../Observable":48}],86:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=e("../Observable");var a=e("../scheduler/async");var s=e("../util/isNumeric");var u=e("../util/isScheduler");function n(r,e,n){if(r===void 0){r=0}var i=-1;if(s.isNumeric(e)){i=Number(e)<1&&1||Number(e)}else if(u.isScheduler(e)){n=e}if(!u.isScheduler(n)){n=a.async}return new o.Observable(function(e){var t=s.isNumeric(r)?r:+r-n.now();return n.schedule(c,t,{index:0,period:i,subscriber:e})})}r.timer=n;function c(e){var t=e.index,r=e.period,n=e.subscriber;n.next(t);if(n.closed){return}else if(r===-1){return n.complete()}e.index=t+1;this.schedule(e,r)}},{"../Observable":48,"../scheduler/async":204,"../util/isNumeric":225,"../util/isScheduler":229}],87:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Observable");var s=e("./from");var u=e("./empty");function i(o,a){return new n.Observable(function(t){var e;try{e=o()}catch(e){t.error(e);return undefined}var r;try{r=a(e)}catch(e){t.error(e);return undefined}var n=r?s.from(r):u.EMPTY;var i=n.subscribe(t);return function(){i.unsubscribe();if(e){e.unsubscribe()}}})}r.using=i},{"../Observable":48,"./empty":65,"./from":67}],88:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("./fromArray");var o=e("../util/isArray");var a=e("../Subscriber");var s=e("../OuterSubscriber");var u=e("../util/subscribeToResult");var c=e("../../internal/symbol/iterator");function h(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=e[e.length-1];if(typeof r==="function"){e.pop()}return i.fromArray(e,undefined).lift(new l(r))}r.zip=h;var l=function(){function e(e){this.resultSelector=e}e.prototype.call=function(e,t){return t.subscribe(new p(e,this.resultSelector))};return e}();r.ZipOperator=l;var p=function(i){n(e,i);function e(e,t,r){if(r===void 0){r=Object.create(null)}var n=i.call(this,e)||this;n.iterators=[];n.active=0;n.resultSelector=typeof t==="function"?t:null;n.values=r;return n}e.prototype._next=function(e){var t=this.iterators;if(o.isArray(e)){t.push(new d(e))}else if(typeof e[c.iterator]==="function"){t.push(new f(e[c.iterator]()))}else{t.push(new v(this.destination,this,e))}};e.prototype._complete=function(){var e=this.iterators;var t=e.length;this.unsubscribe();if(t===0){this.destination.complete();return}this.active=t;for(var r=0;r<t;r++){var n=e[r];if(n.stillUnsubscribed){var i=this.destination;i.add(n.subscribe(n,r))}else{this.active--}}};e.prototype.notifyInactive=function(){this.active--;if(this.active===0){this.destination.complete()}};e.prototype.checkIterators=function(){var e=this.iterators;var t=e.length;var r=this.destination;for(var n=0;n<t;n++){var i=e[n];if(typeof i.hasValue==="function"&&!i.hasValue()){return}}var o=false;var a=[];for(var n=0;n<t;n++){var i=e[n];var s=i.next();if(i.hasCompleted()){o=true}if(s.done){r.complete();return}a.push(s.value)}if(this.resultSelector){this._tryresultSelector(a)}else{r.next(a)}if(o){r.complete()}};e.prototype._tryresultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){this.destination.error(e);return}this.destination.next(t)};return e}(a.Subscriber);r.ZipSubscriber=p;var f=function(){function e(e){this.iterator=e;this.nextResult=e.next()}e.prototype.hasValue=function(){return true};e.prototype.next=function(){var e=this.nextResult;this.nextResult=this.iterator.next();return e};e.prototype.hasCompleted=function(){var e=this.nextResult;return e&&e.done};return e}();var d=function(){function e(e){this.array=e;this.index=0;this.length=0;this.length=e.length}e.prototype[c.iterator]=function(){return this};e.prototype.next=function(e){var t=this.index++;var r=this.array;return t<this.length?{value:r[t],done:false}:{value:null,done:true}};e.prototype.hasValue=function(){return this.array.length>this.index};e.prototype.hasCompleted=function(){return this.array.length===this.index};return e}();var v=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.parent=t;n.observable=r;n.stillUnsubscribed=true;n.buffer=[];n.isComplete=false;return n}e.prototype[c.iterator]=function(){return this};e.prototype.next=function(){var e=this.buffer;if(e.length===0&&this.isComplete){return{value:null,done:true}}else{return{value:e.shift(),done:false}}};e.prototype.hasValue=function(){return this.buffer.length>0};e.prototype.hasCompleted=function(){return this.buffer.length===0&&this.isComplete};e.prototype.notifyComplete=function(){if(this.buffer.length>0){this.isComplete=true;this.parent.notifyInactive()}else{this.destination.complete()}};e.prototype.notifyNext=function(e,t,r,n,i){this.buffer.push(t);this.parent.checkIterators()};e.prototype.subscribe=function(e,t){return u.subscribeToResult(this,this.observable,this,t)};return e}(s.OuterSubscriber)},{"../../internal/symbol/iterator":206,"../OuterSubscriber":50,"../Subscriber":55,"../util/isArray":219,"../util/subscribeToResult":238,"./fromArray":68}],89:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("../util/tryCatch");var a=e("../util/errorObject");var n=e("../OuterSubscriber");var s=e("../util/subscribeToResult");function u(r){return function e(t){return t.lift(new c(r))}}r.audit=u;var c=function(){function e(e){this.durationSelector=e}e.prototype.call=function(e,t){return t.subscribe(new h(e,this.durationSelector))};return e}();var h=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.durationSelector=t;r.hasValue=false;return r}e.prototype._next=function(e){this.value=e;this.hasValue=true;if(!this.throttled){var t=o.tryCatch(this.durationSelector)(e);if(t===a.errorObject){this.destination.error(a.errorObject.e)}else{var r=s.subscribeToResult(this,t);if(!r||r.closed){this.clearThrottle()}else{this.add(this.throttled=r)}}}};e.prototype.clearThrottle=function(){var e=this,t=e.value,r=e.hasValue,n=e.throttled;if(n){this.remove(n);this.throttled=null;n.unsubscribe()}if(r){this.value=null;this.hasValue=false;this.destination.next(t)}};e.prototype.notifyNext=function(e,t,r,n){this.clearThrottle()};e.prototype.notifyComplete=function(){this.clearThrottle()};return e}(n.OuterSubscriber)},{"../OuterSubscriber":50,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],90:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../scheduler/async");var i=e("./audit");var o=e("../observable/timer");function a(e,t){if(t===void 0){t=n.async}return i.audit(function(){return o.timer(e,t)})}r.auditTime=a},{"../observable/timer":86,"../scheduler/async":204,"./audit":89}],91:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../OuterSubscriber");var o=e("../util/subscribeToResult");function a(r){return function e(t){return t.lift(new s(r))}}r.buffer=a;var s=function(){function e(e){this.closingNotifier=e}e.prototype.call=function(e,t){return t.subscribe(new u(e,this.closingNotifier))};return e}();var u=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.buffer=[];r.add(o.subscribeToResult(r,t));return r}e.prototype._next=function(e){this.buffer.push(e)};e.prototype.notifyNext=function(e,t,r,n,i){var o=this.buffer;this.buffer=[];this.destination.next(o)};return e}(n.OuterSubscriber)},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],92:[function(e,t,r){"use strict";var o=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subscriber");function i(r,n){if(n===void 0){n=null}return function e(t){return t.lift(new a(r,n))}}r.bufferCount=i;var a=function(){function e(e,t){this.bufferSize=e;this.startBufferEvery=t;if(!t||e===t){this.subscriberClass=s}else{this.subscriberClass=u}}e.prototype.call=function(e,t){return t.subscribe(new this.subscriberClass(e,this.bufferSize,this.startBufferEvery))};return e}();var s=function(n){o(e,n);function e(e,t){var r=n.call(this,e)||this;r.bufferSize=t;r.buffer=[];return r}e.prototype._next=function(e){var t=this.buffer;t.push(e);if(t.length==this.bufferSize){this.destination.next(t);this.buffer=[]}};e.prototype._complete=function(){var e=this.buffer;if(e.length>0){this.destination.next(e)}n.prototype._complete.call(this)};return e}(n.Subscriber);var u=function(i){o(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.bufferSize=t;n.startBufferEvery=r;n.buffers=[];n.count=0;return n}e.prototype._next=function(e){var t=this,r=t.bufferSize,n=t.startBufferEvery,i=t.buffers,o=t.count;this.count++;if(o%n===0){i.push([])}for(var a=i.length;a--;){var s=i[a];s.push(e);if(s.length===r){i.splice(a,1);this.destination.next(s)}}};e.prototype._complete=function(){var e=this,t=e.buffers,r=e.destination;while(t.length>0){var n=t.shift();if(n.length>0){r.next(n)}}i.prototype._complete.call(this)};return e}(n.Subscriber)},{"../Subscriber":55}],93:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var a=e("../scheduler/async");var i=e("../Subscriber");var s=e("../util/isScheduler");function o(r){var e=arguments.length;var n=a.async;if(s.isScheduler(arguments[arguments.length-1])){n=arguments[arguments.length-1];e--}var i=null;if(e>=2){i=arguments[1]}var o=Number.POSITIVE_INFINITY;if(e>=3){o=arguments[2]}return function e(t){return t.lift(new u(r,i,o,n))}}r.bufferTime=o;var u=function(){function e(e,t,r,n){this.bufferTimeSpan=e;this.bufferCreationInterval=t;this.maxBufferSize=r;this.scheduler=n}e.prototype.call=function(e,t){return t.subscribe(new h(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))};return e}();var c=function(){function e(){this.buffer=[]}return e}();var h=function(h){n(e,h);function e(e,t,r,n,i){var o=h.call(this,e)||this;o.bufferTimeSpan=t;o.bufferCreationInterval=r;o.maxBufferSize=n;o.scheduler=i;o.contexts=[];var a=o.openContext();o.timespanOnly=r==null||r<0;if(o.timespanOnly){var s={subscriber:o,context:a,bufferTimeSpan:t};o.add(a.closeAction=i.schedule(l,t,s))}else{var u={subscriber:o,context:a};var c={bufferTimeSpan:t,bufferCreationInterval:r,subscriber:o,scheduler:i};o.add(a.closeAction=i.schedule(f,t,u));o.add(i.schedule(p,r,c))}return o}e.prototype._next=function(e){var t=this.contexts;var r=t.length;var n;for(var i=0;i<r;i++){var o=t[i];var a=o.buffer;a.push(e);if(a.length==this.maxBufferSize){n=o}}if(n){this.onBufferFull(n)}};e.prototype._error=function(e){this.contexts.length=0;h.prototype._error.call(this,e)};e.prototype._complete=function(){var e=this,t=e.contexts,r=e.destination;while(t.length>0){var n=t.shift();r.next(n.buffer)}h.prototype._complete.call(this)};e.prototype._unsubscribe=function(){this.contexts=null};e.prototype.onBufferFull=function(e){this.closeContext(e);var t=e.closeAction;t.unsubscribe();this.remove(t);if(!this.closed&&this.timespanOnly){e=this.openContext();var r=this.bufferTimeSpan;var n={subscriber:this,context:e,bufferTimeSpan:r};this.add(e.closeAction=this.scheduler.schedule(l,r,n))}};e.prototype.openContext=function(){var e=new c;this.contexts.push(e);return e};e.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts;var r=t?t.indexOf(e):-1;if(r>=0){t.splice(t.indexOf(e),1)}};return e}(i.Subscriber);function l(e){var t=e.subscriber;var r=e.context;if(r){t.closeContext(r)}if(!t.closed){e.context=t.openContext();e.context.closeAction=this.schedule(e,e.bufferTimeSpan)}}function p(e){var t=e.bufferCreationInterval,r=e.bufferTimeSpan,n=e.subscriber,i=e.scheduler;var o=n.openContext();var a=this;if(!n.closed){n.add(o.closeAction=i.schedule(f,r,{subscriber:n,context:o}));a.schedule(e,t)}}function f(e){var t=e.subscriber,r=e.context;t.closeContext(r)}},{"../Subscriber":55,"../scheduler/async":204,"../util/isScheduler":229}],94:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var a=e("../Subscription");var s=e("../util/subscribeToResult");var i=e("../OuterSubscriber");function o(r,n){return function e(t){return t.lift(new u(r,n))}}r.bufferToggle=o;var u=function(){function e(e,t){this.openings=e;this.closingSelector=t}e.prototype.call=function(e,t){return t.subscribe(new c(e,this.openings,this.closingSelector))};return e}();var c=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.openings=t;n.closingSelector=r;n.contexts=[];n.add(s.subscribeToResult(n,t));return n}e.prototype._next=function(e){var t=this.contexts;var r=t.length;for(var n=0;n<r;n++){t[n].buffer.push(e)}};e.prototype._error=function(e){var t=this.contexts;while(t.length>0){var r=t.shift();r.subscription.unsubscribe();r.buffer=null;r.subscription=null}this.contexts=null;i.prototype._error.call(this,e)};e.prototype._complete=function(){var e=this.contexts;while(e.length>0){var t=e.shift();this.destination.next(t.buffer);t.subscription.unsubscribe();t.buffer=null;t.subscription=null}this.contexts=null;i.prototype._complete.call(this)};e.prototype.notifyNext=function(e,t,r,n,i){e?this.closeBuffer(e):this.openBuffer(t)};e.prototype.notifyComplete=function(e){this.closeBuffer(e.context)};e.prototype.openBuffer=function(e){try{var t=this.closingSelector;var r=t.call(this,e);if(r){this.trySubscribe(r)}}catch(e){this._error(e)}};e.prototype.closeBuffer=function(e){var t=this.contexts;if(t&&e){var r=e.buffer,n=e.subscription;this.destination.next(r);t.splice(t.indexOf(e),1);this.remove(n);n.unsubscribe()}};e.prototype.trySubscribe=function(e){var t=this.contexts;var r=[];var n=new a.Subscription;var i={buffer:r,subscription:n};t.push(i);var o=s.subscribeToResult(this,e,i);if(!o||o.closed){this.closeBuffer(i)}else{o.context=i;this.add(o);n.add(o)}};return e}(i.OuterSubscriber)},{"../OuterSubscriber":50,"../Subscription":56,"../util/subscribeToResult":238}],95:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("../Subscription");var a=e("../util/tryCatch");var s=e("../util/errorObject");var n=e("../OuterSubscriber");var u=e("../util/subscribeToResult");function c(t){return function(e){return e.lift(new h(t))}}r.bufferWhen=c;var h=function(){function e(e){this.closingSelector=e}e.prototype.call=function(e,t){return t.subscribe(new l(e,this.closingSelector))};return e}();var l=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.closingSelector=t;r.subscribing=false;r.openBuffer();return r}e.prototype._next=function(e){this.buffer.push(e)};e.prototype._complete=function(){var e=this.buffer;if(e){this.destination.next(e)}n.prototype._complete.call(this)};e.prototype._unsubscribe=function(){this.buffer=null;this.subscribing=false};e.prototype.notifyNext=function(e,t,r,n,i){this.openBuffer()};e.prototype.notifyComplete=function(){if(this.subscribing){this.complete()}else{this.openBuffer()}};e.prototype.openBuffer=function(){var e=this.closingSubscription;if(e){this.remove(e);e.unsubscribe()}var t=this.buffer;if(this.buffer){this.destination.next(t)}this.buffer=[];var r=a.tryCatch(this.closingSelector)();if(r===s.errorObject){this.error(s.errorObject.e)}else{e=new o.Subscription;this.closingSubscription=e;this.add(e);this.subscribing=true;e.add(u.subscribeToResult(this,r));this.subscribing=false}};return e}(n.OuterSubscriber)},{"../OuterSubscriber":50,"../Subscription":56,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],96:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../OuterSubscriber");var o=e("../InnerSubscriber");var a=e("../util/subscribeToResult");function s(i){return function e(t){var r=new u(i);var n=t.lift(r);return r.caught=n}}r.catchError=s;var u=function(){function e(e){this.selector=e}e.prototype.call=function(e,t){return t.subscribe(new c(e,this.selector,this.caught))};return e}();var c=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.selector=t;n.caught=r;return n}e.prototype.error=function(e){if(!this.isStopped){var t=void 0;try{t=this.selector(e,this.caught)}catch(e){i.prototype.error.call(this,e);return}this._unsubscribeAndRecycle();var r=new o.InnerSubscriber(this,undefined,undefined);this.add(r);a.subscribeToResult(this,t,undefined,undefined,r)}};return e}(i.OuterSubscriber)},{"../InnerSubscriber":46,"../OuterSubscriber":50,"../util/subscribeToResult":238}],97:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../observable/combineLatest");function i(t){return function(e){return e.lift(new n.CombineLatestOperator(t))}}r.combineAll=i},{"../observable/combineLatest":62}],98:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../util/isArray");var i=e("../observable/combineLatest");var o=e("../observable/from");var a={};function s(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}var r=null;if(typeof t[t.length-1]==="function"){r=t.pop()}if(t.length===1&&n.isArray(t[0])){t=t[0].slice()}return function(e){return e.lift.call(o.from([e].concat(t)),new i.CombineLatestOperator(r))}}r.combineLatest=s},{"../observable/combineLatest":62,"../observable/from":67,"../util/isArray":219}],99:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../observable/concat");function i(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return function(e){return e.lift.call(n.concat.apply(void 0,[e].concat(t)))}}r.concat=i},{"../observable/concat":63}],100:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./mergeAll");function i(){return n.mergeAll(1)}r.concatAll=i},{"./mergeAll":133}],101:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./mergeMap");function i(e,t){return n.mergeMap(e,t,1)}r.concatMap=i},{"./mergeMap":134}],102:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./concatMap");function i(e,t){return n.concatMap(function(){return e},t)}r.concatMapTo=i},{"./concatMap":101}],103:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");function o(t){return function(e){return e.lift(new a(t,e))}}r.count=o;var a=function(){function e(e,t){this.predicate=e;this.source=t}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate,this.source))};return e}();var s=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.predicate=t;n.source=r;n.count=0;n.index=0;return n}e.prototype._next=function(e){if(this.predicate){this._tryPredicate(e)}else{this.count++}};e.prototype._tryPredicate=function(e){var t;try{t=this.predicate(e,this.index++,this.source)}catch(e){this.destination.error(e);return}if(t){this.count++}};e.prototype._complete=function(){this.destination.next(this.count);this.destination.complete()};return e}(i.Subscriber)},{"../Subscriber":55}],104:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../OuterSubscriber");var o=e("../util/subscribeToResult");function a(t){return function(e){return e.lift(new s(t))}}r.debounce=a;var s=function(){function e(e){this.durationSelector=e}e.prototype.call=function(e,t){return t.subscribe(new u(e,this.durationSelector))};return e}();var u=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.durationSelector=t;r.hasValue=false;r.durationSubscription=null;return r}e.prototype._next=function(e){try{var t=this.durationSelector.call(this,e);if(t){this._tryNext(e,t)}}catch(e){this.destination.error(e)}};e.prototype._complete=function(){this.emitValue();this.destination.complete()};e.prototype._tryNext=function(e,t){var r=this.durationSubscription;this.value=e;this.hasValue=true;if(r){r.unsubscribe();this.remove(r)}r=o.subscribeToResult(this,t);if(r&&!r.closed){this.add(this.durationSubscription=r)}};e.prototype.notifyNext=function(e,t,r,n,i){this.emitValue()};e.prototype.notifyComplete=function(){this.emitValue()};e.prototype.emitValue=function(){if(this.hasValue){var e=this.value;var t=this.durationSubscription;if(t){this.durationSubscription=null;t.unsubscribe();this.remove(t)}this.value=null;this.hasValue=false;n.prototype._next.call(this,e)}};return e}(n.OuterSubscriber)},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],105:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");var o=e("../scheduler/async");function a(t,r){if(r===void 0){r=o.async}return function(e){return e.lift(new s(t,r))}}r.debounceTime=a;var s=function(){function e(e,t){this.dueTime=e;this.scheduler=t}e.prototype.call=function(e,t){return t.subscribe(new u(e,this.dueTime,this.scheduler))};return e}();var u=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.dueTime=t;n.scheduler=r;n.debouncedSubscription=null;n.lastValue=null;n.hasValue=false;return n}e.prototype._next=function(e){this.clearDebounce();this.lastValue=e;this.hasValue=true;this.add(this.debouncedSubscription=this.scheduler.schedule(c,this.dueTime,this))};e.prototype._complete=function(){this.debouncedNext();this.destination.complete()};e.prototype.debouncedNext=function(){this.clearDebounce();if(this.hasValue){var e=this.lastValue;this.lastValue=null;this.hasValue=false;this.destination.next(e)}};e.prototype.clearDebounce=function(){var e=this.debouncedSubscription;if(e!==null){this.remove(e);e.unsubscribe();this.debouncedSubscription=null}};return e}(i.Subscriber);function c(e){e.debouncedNext()}},{"../Subscriber":55,"../scheduler/async":204}],106:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subscriber");function o(t){if(t===void 0){t=null}return function(e){return e.lift(new a(t))}}r.defaultIfEmpty=o;var a=function(){function e(e){this.defaultValue=e}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.defaultValue))};return e}();var s=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.defaultValue=t;r.isEmpty=true;return r}e.prototype._next=function(e){this.isEmpty=false;this.destination.next(e)};e.prototype._complete=function(){if(this.isEmpty){this.destination.next(this.defaultValue)}this.destination.complete()};return e}(n.Subscriber)},{"../Subscriber":55}],107:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../scheduler/async");var o=e("../util/isDate");var a=e("../Subscriber");var s=e("../Notification");function u(e,t){if(t===void 0){t=i.async}var r=o.isDate(e);var n=r?+e-t.now():Math.abs(e);return function(e){return e.lift(new c(n,t))}}r.delay=u;var c=function(){function e(e,t){this.delay=e;this.scheduler=t}e.prototype.call=function(e,t){return t.subscribe(new h(e,this.delay,this.scheduler))};return e}();var h=function(i){n(r,i);function r(e,t,r){var n=i.call(this,e)||this;n.delay=t;n.scheduler=r;n.queue=[];n.active=false;n.errored=false;return n}r.dispatch=function(e){var t=e.source;var r=t.queue;var n=e.scheduler;var i=e.destination;while(r.length>0&&r[0].time-n.now()<=0){r.shift().notification.observe(i)}if(r.length>0){var o=Math.max(0,r[0].time-n.now());this.schedule(e,o)}else{this.unsubscribe();t.active=false}};r.prototype._schedule=function(e){this.active=true;var t=this.destination;t.add(e.schedule(r.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))};r.prototype.scheduleNotification=function(e){if(this.errored===true){return}var t=this.scheduler;var r=new l(t.now()+this.delay,e);this.queue.push(r);if(this.active===false){this._schedule(t)}};r.prototype._next=function(e){this.scheduleNotification(s.Notification.createNext(e))};r.prototype._error=function(e){this.errored=true;this.queue=[];this.destination.error(e);this.unsubscribe()};r.prototype._complete=function(){this.scheduleNotification(s.Notification.createComplete());this.unsubscribe()};return r}(a.Subscriber);var l=function(){function e(e,t){this.time=e;this.notification=t}return e}()},{"../Notification":47,"../Subscriber":55,"../scheduler/async":204,"../util/isDate":221}],108:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subscriber");var o=e("../Observable");var a=e("../OuterSubscriber");var s=e("../util/subscribeToResult");function u(t,r){if(r){return function(e){return new l(e,r).lift(new c(t))}}return function(e){return e.lift(new c(t))}}r.delayWhen=u;var c=function(){function e(e){this.delayDurationSelector=e}e.prototype.call=function(e,t){return t.subscribe(new h(e,this.delayDurationSelector))};return e}();var h=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.delayDurationSelector=t;r.completed=false;r.delayNotifierSubscriptions=[];r.index=0;return r}e.prototype.notifyNext=function(e,t,r,n,i){this.destination.next(e);this.removeSubscription(i);this.tryComplete()};e.prototype.notifyError=function(e,t){this._error(e)};e.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);if(t){this.destination.next(t)}this.tryComplete()};e.prototype._next=function(e){var t=this.index++;try{var r=this.delayDurationSelector(e,t);if(r){this.tryDelay(r,e)}}catch(e){this.destination.error(e)}};e.prototype._complete=function(){this.completed=true;this.tryComplete();this.unsubscribe()};e.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e);if(t!==-1){this.delayNotifierSubscriptions.splice(t,1)}return e.outerValue};e.prototype.tryDelay=function(e,t){var r=s.subscribeToResult(this,e,t);if(r&&!r.closed){var n=this.destination;n.add(r);this.delayNotifierSubscriptions.push(r)}};e.prototype.tryComplete=function(){if(this.completed&&this.delayNotifierSubscriptions.length===0){this.destination.complete()}};return e}(a.OuterSubscriber);var l=function(n){i(e,n);function e(e,t){var r=n.call(this)||this;r.source=e;r.subscriptionDelay=t;return r}e.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new p(e,this.source))};return e}(o.Observable);var p=function(n){i(e,n);function e(e,t){var r=n.call(this)||this;r.parent=e;r.source=t;r.sourceSubscribed=false;return r}e.prototype._next=function(e){this.subscribeToSource()};e.prototype._error=function(e){this.unsubscribe();this.parent.error(e)};e.prototype._complete=function(){this.unsubscribe();this.subscribeToSource()};e.prototype.subscribeToSource=function(){if(!this.sourceSubscribed){this.sourceSubscribed=true;this.unsubscribe();this.source.subscribe(this.parent)}};return e}(n.Subscriber)},{"../Observable":48,"../OuterSubscriber":50,"../Subscriber":55,"../util/subscribeToResult":238}],109:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");function o(){return function e(t){return t.lift(new a)}}r.dematerialize=o;var a=function(){function e(){}e.prototype.call=function(e,t){return t.subscribe(new s(e))};return e}();var s=function(t){n(e,t);function e(e){return t.call(this,e)||this}e.prototype._next=function(e){e.observe(this.destination)};return e}(i.Subscriber)},{"../Subscriber":55}],110:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../OuterSubscriber");var o=e("../util/subscribeToResult");function a(t,r){return function(e){return e.lift(new s(t,r))}}r.distinct=a;var s=function(){function e(e,t){this.keySelector=e;this.flushes=t}e.prototype.call=function(e,t){return t.subscribe(new u(e,this.keySelector,this.flushes))};return e}();var u=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.keySelector=t;n.values=new Set;if(r){n.add(o.subscribeToResult(n,r))}return n}e.prototype.notifyNext=function(e,t,r,n,i){this.values.clear()};e.prototype.notifyError=function(e,t){this._error(e)};e.prototype._next=function(e){if(this.keySelector){this._useKeySelector(e)}else{this._finalizeNext(e,e)}};e.prototype._useKeySelector=function(e){var t;var r=this.destination;try{t=this.keySelector(e)}catch(e){r.error(e);return}this._finalizeNext(t,e)};e.prototype._finalizeNext=function(e,t){var r=this.values;if(!r.has(e)){r.add(e);this.destination.next(t)}};return e}(i.OuterSubscriber);r.DistinctSubscriber=u},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],111:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");var o=e("../util/tryCatch");var a=e("../util/errorObject");function s(t,r){return function(e){return e.lift(new u(t,r))}}r.distinctUntilChanged=s;var u=function(){function e(e,t){this.compare=e;this.keySelector=t}e.prototype.call=function(e,t){return t.subscribe(new c(e,this.compare,this.keySelector))};return e}();var c=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.keySelector=r;n.hasKey=false;if(typeof t==="function"){n.compare=t}return n}e.prototype.compare=function(e,t){return e===t};e.prototype._next=function(e){var t=this.keySelector;var r=e;if(t){r=o.tryCatch(this.keySelector)(e);if(r===a.errorObject){return this.destination.error(a.errorObject.e)}}var n=false;if(this.hasKey){n=o.tryCatch(this.compare)(this.key,r);if(n===a.errorObject){return this.destination.error(a.errorObject.e)}}else{this.hasKey=true}if(Boolean(n)===false){this.key=r;this.destination.next(e)}};return e}(i.Subscriber)},{"../Subscriber":55,"../util/errorObject":216,"../util/tryCatch":240}],112:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("./distinctUntilChanged");function n(r,n){return i.distinctUntilChanged(function(e,t){return n?n(e[r],t[r]):e[r]===t[r]})}r.distinctUntilKeyChanged=n},{"./distinctUntilChanged":111}],113:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("../util/ArgumentOutOfRangeError");var o=e("./filter");var a=e("./throwIfEmpty");var s=e("./defaultIfEmpty");var u=e("./take");function n(r,t){if(r<0){throw new i.ArgumentOutOfRangeError}var n=arguments.length>=2;return function(e){return e.pipe(o.filter(function(e,t){return t===r}),u.take(1),n?s.defaultIfEmpty(t):a.throwIfEmpty(function(){return new i.ArgumentOutOfRangeError}))}}r.elementAt=n},{"../util/ArgumentOutOfRangeError":209,"./defaultIfEmpty":106,"./filter":119,"./take":171,"./throwIfEmpty":178}],114:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("../observable/fromArray");var o=e("../observable/scalar");var a=e("../observable/empty");var s=e("../observable/concat");var u=e("../util/isScheduler");function n(){var n=[];for(var e=0;e<arguments.length;e++){n[e]=arguments[e]}return function(e){var t=n[n.length-1];if(u.isScheduler(t)){n.pop()}else{t=null}var r=n.length;if(r===1&&!t){return s.concat(e,o.scalar(n[0]))}else if(r>0){return s.concat(e,i.fromArray(n,t))}else{return s.concat(e,a.empty(t))}}}r.endWith=n},{"../observable/concat":63,"../observable/empty":65,"../observable/fromArray":68,"../observable/scalar":84,"../util/isScheduler":229}],115:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");function o(t,r){return function(e){return e.lift(new a(t,r,e))}}r.every=o;var a=function(){function e(e,t,r){this.predicate=e;this.thisArg=t;this.source=r}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate,this.thisArg,this.source))};return e}();var s=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e)||this;i.predicate=t;i.thisArg=r;i.source=n;i.index=0;i.thisArg=r||i;return i}e.prototype.notifyComplete=function(e){this.destination.next(e);this.destination.complete()};e.prototype._next=function(e){var t=false;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(e){this.destination.error(e);return}if(!t){this.notifyComplete(false)}};e.prototype._complete=function(){this.notifyComplete(true)};return e}(i.Subscriber)},{"../Subscriber":55}],116:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../OuterSubscriber");var o=e("../util/subscribeToResult");function a(){return function(e){return e.lift(new s)}}r.exhaust=a;var s=function(){function e(){}e.prototype.call=function(e,t){return t.subscribe(new u(e))};return e}();var u=function(r){n(e,r);function e(e){var t=r.call(this,e)||this;t.hasCompleted=false;t.hasSubscription=false;return t}e.prototype._next=function(e){if(!this.hasSubscription){this.hasSubscription=true;this.add(o.subscribeToResult(this,e))}};e.prototype._complete=function(){this.hasCompleted=true;if(!this.hasSubscription){this.destination.complete()}};e.prototype.notifyComplete=function(e){this.remove(e);this.hasSubscription=false;if(this.hasCompleted){this.destination.complete()}};return e}(i.OuterSubscriber)},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],117:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../OuterSubscriber");var o=e("../InnerSubscriber");var a=e("../util/subscribeToResult");var s=e("./map");var u=e("../observable/from");function c(t,i){if(i){return function(e){return e.pipe(c(function(r,n){return u.from(t(r,n)).pipe(s.map(function(e,t){return i(r,e,n,t)}))}))}}return function(e){return e.lift(new h(t))}}r.exhaustMap=c;var h=function(){function e(e){this.project=e}e.prototype.call=function(e,t){return t.subscribe(new l(e,this.project))};return e}();var l=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.project=t;r.hasSubscription=false;r.hasCompleted=false;r.index=0;return r}e.prototype._next=function(e){if(!this.hasSubscription){this.tryNext(e)}};e.prototype.tryNext=function(e){var t;var r=this.index++;try{t=this.project(e,r)}catch(e){this.destination.error(e);return}this.hasSubscription=true;this._innerSub(t,e,r)};e.prototype._innerSub=function(e,t,r){var n=new o.InnerSubscriber(this,undefined,undefined);var i=this.destination;i.add(n);a.subscribeToResult(this,e,t,r,n)};e.prototype._complete=function(){this.hasCompleted=true;if(!this.hasSubscription){this.destination.complete()}this.unsubscribe()};e.prototype.notifyNext=function(e,t,r,n,i){this.destination.next(t)};e.prototype.notifyError=function(e){this.destination.error(e)};e.prototype.notifyComplete=function(e){var t=this.destination;t.remove(e);this.hasSubscription=false;if(this.hasCompleted){this.destination.complete()}};return e}(n.OuterSubscriber)},{"../InnerSubscriber":46,"../OuterSubscriber":50,"../observable/from":67,"../util/subscribeToResult":238,"./map":128}],118:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var s=e("../util/tryCatch");var u=e("../util/errorObject");var i=e("../OuterSubscriber");var c=e("../util/subscribeToResult");function o(t,r,n){if(r===void 0){r=Number.POSITIVE_INFINITY}if(n===void 0){n=undefined}r=(r||0)<1?Number.POSITIVE_INFINITY:r;return function(e){return e.lift(new a(t,r,n))}}r.expand=o;var a=function(){function e(e,t,r){this.project=e;this.concurrent=t;this.scheduler=r}e.prototype.call=function(e,t){return t.subscribe(new h(e,this.project,this.concurrent,this.scheduler))};return e}();r.ExpandOperator=a;var h=function(o){n(a,o);function a(e,t,r,n){var i=o.call(this,e)||this;i.project=t;i.concurrent=r;i.scheduler=n;i.index=0;i.active=0;i.hasCompleted=false;if(r<Number.POSITIVE_INFINITY){i.buffer=[]}return i}a.dispatch=function(e){var t=e.subscriber,r=e.result,n=e.value,i=e.index;t.subscribeToProjection(r,n,i)};a.prototype._next=function(e){var t=this.destination;if(t.closed){this._complete();return}var r=this.index++;if(this.active<this.concurrent){t.next(e);var n=s.tryCatch(this.project)(e,r);if(n===u.errorObject){t.error(u.errorObject.e)}else if(!this.scheduler){this.subscribeToProjection(n,e,r)}else{var i={subscriber:this,result:n,value:e,index:r};var o=this.destination;o.add(this.scheduler.schedule(a.dispatch,0,i))}}else{this.buffer.push(e)}};a.prototype.subscribeToProjection=function(e,t,r){this.active++;var n=this.destination;n.add(c.subscribeToResult(this,e,t,r))};a.prototype._complete=function(){this.hasCompleted=true;if(this.hasCompleted&&this.active===0){this.destination.complete()}this.unsubscribe()};a.prototype.notifyNext=function(e,t,r,n,i){this._next(t)};a.prototype.notifyComplete=function(e){var t=this.buffer;var r=this.destination;r.remove(e);this.active--;if(t&&t.length>0){this._next(t.shift())}if(this.hasCompleted&&this.active===0){this.destination.complete()}};return a}(i.OuterSubscriber);r.ExpandSubscriber=h},{"../OuterSubscriber":50,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],119:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");function o(r,n){return function e(t){return t.lift(new a(r,n))}}r.filter=o;var a=function(){function e(e,t){this.predicate=e;this.thisArg=t}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate,this.thisArg))};return e}();var s=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.predicate=t;n.thisArg=r;n.count=0;return n}e.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){this.destination.error(e);return}if(t){this.destination.next(e)}};return e}(i.Subscriber)},{"../Subscriber":55}],120:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subscriber");var o=e("../Subscription");function a(t){return function(e){return e.lift(new s(t))}}r.finalize=a;var s=function(){function e(e){this.callback=e}e.prototype.call=function(e,t){return t.subscribe(new u(e,this.callback))};return e}();var u=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.add(new o.Subscription(t));return r}return e}(n.Subscriber)},{"../Subscriber":55,"../Subscription":56}],121:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");function o(t,r){if(typeof t!=="function"){throw new TypeError("predicate is not a function")}return function(e){return e.lift(new a(t,e,false,r))}}r.find=o;var a=function(){function e(e,t,r,n){this.predicate=e;this.source=t;this.yieldIndex=r;this.thisArg=n}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate,this.source,this.yieldIndex,this.thisArg))};return e}();r.FindValueOperator=a;var s=function(a){n(e,a);function e(e,t,r,n,i){var o=a.call(this,e)||this;o.predicate=t;o.source=r;o.yieldIndex=n;o.thisArg=i;o.index=0;return o}e.prototype.notifyComplete=function(e){var t=this.destination;t.next(e);t.complete();this.unsubscribe()};e.prototype._next=function(e){var t=this,r=t.predicate,n=t.thisArg;var i=this.index++;try{var o=r.call(n||this,e,i,this.source);if(o){this.notifyComplete(this.yieldIndex?i:e)}}catch(e){this.destination.error(e)}};e.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:undefined)};return e}(i.Subscriber);r.FindValueSubscriber=s},{"../Subscriber":55}],122:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../operators/find");function i(t,r){return function(e){return e.lift(new n.FindValueOperator(t,e,true,r))}}r.findIndex=i},{"../operators/find":121}],123:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("../util/EmptyError");var o=e("./filter");var a=e("./take");var s=e("./defaultIfEmpty");var u=e("./throwIfEmpty");var c=e("../util/identity");function n(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?o.filter(function(e,t){return n(e,t,r)}):c.identity,a.take(1),t?s.defaultIfEmpty(e):u.throwIfEmpty(function(){return new i.EmptyError}))}}r.first=n},{"../util/EmptyError":210,"../util/identity":218,"./defaultIfEmpty":106,"./filter":119,"./take":171,"./throwIfEmpty":178}],124:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");var o=e("../Subscription");var a=e("../Observable");var s=e("../Subject");function u(t,r,n,i){return function(e){return e.lift(new c(t,r,n,i))}}r.groupBy=u;var c=function(){function e(e,t,r,n){this.keySelector=e;this.elementSelector=t;this.durationSelector=r;this.subjectSelector=n}e.prototype.call=function(e,t){return t.subscribe(new h(e,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))};return e}();var h=function(a){n(e,a);function e(e,t,r,n,i){var o=a.call(this,e)||this;o.keySelector=t;o.elementSelector=r;o.durationSelector=n;o.subjectSelector=i;o.groups=null;o.attemptedToUnsubscribe=false;o.count=0;return o}e.prototype._next=function(e){var t;try{t=this.keySelector(e)}catch(e){this.error(e);return}this._group(e,t)};e.prototype._group=function(e,t){var r=this.groups;if(!r){r=this.groups=new Map}var n=r.get(t);var i;if(this.elementSelector){try{i=this.elementSelector(e)}catch(e){this.error(e)}}else{i=e}if(!n){n=this.subjectSelector?this.subjectSelector():new s.Subject;r.set(t,n);var o=new p(t,n,this);this.destination.next(o);if(this.durationSelector){var a=void 0;try{a=this.durationSelector(new p(t,n))}catch(e){this.error(e);return}this.add(a.subscribe(new l(t,n,this)))}}if(!n.closed){n.next(i)}};e.prototype._error=function(r){var e=this.groups;if(e){e.forEach(function(e,t){e.error(r)});e.clear()}this.destination.error(r)};e.prototype._complete=function(){var e=this.groups;if(e){e.forEach(function(e,t){e.complete()});e.clear()}this.destination.complete()};e.prototype.removeGroup=function(e){this.groups.delete(e)};e.prototype.unsubscribe=function(){if(!this.closed){this.attemptedToUnsubscribe=true;if(this.count===0){a.prototype.unsubscribe.call(this)}}};return e}(i.Subscriber);var l=function(i){n(e,i);function e(e,t,r){var n=i.call(this,t)||this;n.key=e;n.group=t;n.parent=r;return n}e.prototype._next=function(e){this.complete()};e.prototype._unsubscribe=function(){var e=this,t=e.parent,r=e.key;this.key=this.parent=null;if(t){t.removeGroup(r)}};return e}(i.Subscriber);var p=function(i){n(e,i);function e(e,t,r){var n=i.call(this)||this;n.key=e;n.groupSubject=t;n.refCountSubscription=r;return n}e.prototype._subscribe=function(e){var t=new o.Subscription;var r=this,n=r.refCountSubscription,i=r.groupSubject;if(n&&!n.closed){t.add(new f(n))}t.add(i.subscribe(e));return t};return e}(a.Observable);r.GroupedObservable=p;var f=function(r){n(e,r);function e(e){var t=r.call(this)||this;t.parent=e;e.count++;return t}e.prototype.unsubscribe=function(){var e=this.parent;if(!e.closed&&!this.closed){r.prototype.unsubscribe.call(this);e.count-=1;if(e.count===0&&e.attemptedToUnsubscribe){e.unsubscribe()}}};return e}(o.Subscription)},{"../Observable":48,"../Subject":53,"../Subscriber":55,"../Subscription":56}],125:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");function o(){return function e(t){return t.lift(new a)}}r.ignoreElements=o;var a=function(){function e(){}e.prototype.call=function(e,t){return t.subscribe(new s(e))};return e}();var s=function(e){n(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype._next=function(e){};return t}(i.Subscriber)},{"../Subscriber":55}],126:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");function o(){return function(e){return e.lift(new a)}}r.isEmpty=o;var a=function(){function e(){}e.prototype.call=function(e,t){return t.subscribe(new s(e))};return e}();var s=function(t){n(e,t);function e(e){return t.call(this,e)||this}e.prototype.notifyComplete=function(e){var t=this.destination;t.next(e);t.complete()};e.prototype._next=function(e){this.notifyComplete(false)};e.prototype._complete=function(){this.notifyComplete(true)};return e}(i.Subscriber)},{"../Subscriber":55}],127:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("../util/EmptyError");var o=e("./filter");var a=e("./takeLast");var s=e("./throwIfEmpty");var u=e("./defaultIfEmpty");var c=e("../util/identity");function n(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?o.filter(function(e,t){return n(e,t,r)}):c.identity,a.takeLast(1),t?u.defaultIfEmpty(e):s.throwIfEmpty(function(){return new i.EmptyError}))}}r.last=n},{"../util/EmptyError":210,"../util/identity":218,"./defaultIfEmpty":106,"./filter":119,"./takeLast":172,"./throwIfEmpty":178}],128:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");function o(r,n){return function e(t){if(typeof r!=="function"){throw new TypeError("argument is not a function. Are you looking for `mapTo()`?")}return t.lift(new a(r,n))}}r.map=o;var a=function(){function e(e,t){this.project=e;this.thisArg=t}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.project,this.thisArg))};return e}();r.MapOperator=a;var s=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.project=t;n.count=0;n.thisArg=r||n;return n}e.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){this.destination.error(e);return}this.destination.next(t)};return e}(i.Subscriber)},{"../Subscriber":55}],129:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subscriber");function o(t){return function(e){return e.lift(new a(t))}}r.mapTo=o;var a=function(){function e(e){this.value=e}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.value))};return e}();var s=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.value=t;return r}e.prototype._next=function(e){this.destination.next(this.value)};return e}(n.Subscriber)},{"../Subscriber":55}],130:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");var o=e("../Notification");function a(){return function e(t){return t.lift(new s)}}r.materialize=a;var s=function(){function e(){}e.prototype.call=function(e,t){return t.subscribe(new u(e))};return e}();var u=function(t){n(e,t);function e(e){return t.call(this,e)||this}e.prototype._next=function(e){this.destination.next(o.Notification.createNext(e))};e.prototype._error=function(e){var t=this.destination;t.next(o.Notification.createError(e));t.complete()};e.prototype._complete=function(){var e=this.destination;e.next(o.Notification.createComplete());e.complete()};return e}(i.Subscriber)},{"../Notification":47,"../Subscriber":55}],131:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./reduce");function i(r){var e=typeof r==="function"?function(e,t){return r(e,t)>0?e:t}:function(e,t){return e>t?e:t};return n.reduce(e)}r.max=i},{"./reduce":149}],132:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../observable/merge");function i(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return function(e){return e.lift.call(n.merge.apply(void 0,[e].concat(t)))}}r.merge=i},{"../observable/merge":77}],133:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./mergeMap");var i=e("../util/identity");function o(e){if(e===void 0){e=Number.POSITIVE_INFINITY}return n.mergeMap(i.identity,e)}r.mergeAll=o},{"../util/identity":218,"./mergeMap":134}],134:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("../util/subscribeToResult");var i=e("../OuterSubscriber");var a=e("../InnerSubscriber");var s=e("./map");var u=e("../observable/from");function c(t,i,r){if(r===void 0){r=Number.POSITIVE_INFINITY}if(typeof i==="function"){return function(e){return e.pipe(c(function(r,n){return u.from(t(r,n)).pipe(s.map(function(e,t){return i(r,e,n,t)}))},r))}}else if(typeof i==="number"){r=i}return function(e){return e.lift(new h(t,r))}}r.mergeMap=c;var h=function(){function e(e,t){if(t===void 0){t=Number.POSITIVE_INFINITY}this.project=e;this.concurrent=t}e.prototype.call=function(e,t){return t.subscribe(new l(e,this.project,this.concurrent))};return e}();r.MergeMapOperator=h;var l=function(i){n(e,i);function e(e,t,r){if(r===void 0){r=Number.POSITIVE_INFINITY}var n=i.call(this,e)||this;n.project=t;n.concurrent=r;n.hasCompleted=false;n.buffer=[];n.active=0;n.index=0;return n}e.prototype._next=function(e){if(this.active<this.concurrent){this._tryNext(e)}else{this.buffer.push(e)}};e.prototype._tryNext=function(e){var t;var r=this.index++;try{t=this.project(e,r)}catch(e){this.destination.error(e);return}this.active++;this._innerSub(t,e,r)};e.prototype._innerSub=function(e,t,r){var n=new a.InnerSubscriber(this,undefined,undefined);var i=this.destination;i.add(n);o.subscribeToResult(this,e,t,r,n)};e.prototype._complete=function(){this.hasCompleted=true;if(this.active===0&&this.buffer.length===0){this.destination.complete()}this.unsubscribe()};e.prototype.notifyNext=function(e,t,r,n,i){this.destination.next(t)};e.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e);this.active--;if(t.length>0){this._next(t.shift())}else if(this.active===0&&this.hasCompleted){this.destination.complete()}};return e}(i.OuterSubscriber);r.MergeMapSubscriber=l},{"../InnerSubscriber":46,"../OuterSubscriber":50,"../observable/from":67,"../util/subscribeToResult":238,"./map":128}],135:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./mergeMap");function i(e,t,r){if(r===void 0){r=Number.POSITIVE_INFINITY}if(typeof t==="function"){return n.mergeMap(function(){return e},t,r)}if(typeof t==="number"){r=t}return n.mergeMap(function(){return e},r)}r.mergeMapTo=i},{"./mergeMap":134}],136:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../util/tryCatch");var a=e("../util/errorObject");var s=e("../util/subscribeToResult");var o=e("../OuterSubscriber");var u=e("../InnerSubscriber");function c(t,r,n){if(n===void 0){n=Number.POSITIVE_INFINITY}return function(e){return e.lift(new h(t,r,n))}}r.mergeScan=c;var h=function(){function e(e,t,r){this.accumulator=e;this.seed=t;this.concurrent=r}e.prototype.call=function(e,t){return t.subscribe(new l(e,this.accumulator,this.seed,this.concurrent))};return e}();r.MergeScanOperator=h;var l=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e)||this;i.accumulator=t;i.acc=r;i.concurrent=n;i.hasValue=false;i.hasCompleted=false;i.buffer=[];i.active=0;i.index=0;return i}e.prototype._next=function(e){if(this.active<this.concurrent){var t=this.index++;var r=i.tryCatch(this.accumulator)(this.acc,e);var n=this.destination;if(r===a.errorObject){n.error(a.errorObject.e)}else{this.active++;this._innerSub(r,e,t)}}else{this.buffer.push(e)}};e.prototype._innerSub=function(e,t,r){var n=new u.InnerSubscriber(this,undefined,undefined);var i=this.destination;i.add(n);s.subscribeToResult(this,e,t,r,n)};e.prototype._complete=function(){this.hasCompleted=true;if(this.active===0&&this.buffer.length===0){if(this.hasValue===false){this.destination.next(this.acc)}this.destination.complete()}this.unsubscribe()};e.prototype.notifyNext=function(e,t,r,n,i){var o=this.destination;this.acc=t;this.hasValue=true;o.next(t)};e.prototype.notifyComplete=function(e){var t=this.buffer;var r=this.destination;r.remove(e);this.active--;if(t.length>0){this._next(t.shift())}else if(this.active===0&&this.hasCompleted){if(this.hasValue===false){this.destination.next(this.acc)}this.destination.complete()}};return e}(o.OuterSubscriber);r.MergeScanSubscriber=l},{"../InnerSubscriber":46,"../OuterSubscriber":50,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],137:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./reduce");function i(r){var e=typeof r==="function"?function(e,t){return r(e,t)<0?e:t}:function(e,t){return e<t?e:t};return n.reduce(e)}r.min=i},{"./reduce":149}],138:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var a=e("../observable/ConnectableObservable");function n(i,o){return function e(t){var r;if(typeof i==="function"){r=i}else{r=function e(){return i}}if(typeof o==="function"){return t.lift(new s(r,o))}var n=Object.create(t,a.connectableObservableDescriptor);n.source=t;n.subjectFactory=r;return n}}r.multicast=n;var s=function(){function e(e,t){this.subjectFactory=e;this.selector=t}e.prototype.call=function(e,t){var r=this.selector;var n=this.subjectFactory();var i=r(n).subscribe(e);i.add(t.subscribe(n));return i};return e}();r.MulticastOperator=s},{"../observable/ConnectableObservable":58}],139:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");var o=e("../Notification");function a(r,n){if(n===void 0){n=0}return function e(t){return t.lift(new s(r,n))}}r.observeOn=a;var s=function(){function e(e,t){if(t===void 0){t=0}this.scheduler=e;this.delay=t}e.prototype.call=function(e,t){return t.subscribe(new u(e,this.scheduler,this.delay))};return e}();r.ObserveOnOperator=s;var u=function(i){n(r,i);function r(e,t,r){if(r===void 0){r=0}var n=i.call(this,e)||this;n.scheduler=t;n.delay=r;return n}r.dispatch=function(e){var t=e.notification,r=e.destination;t.observe(r);this.unsubscribe()};r.prototype.scheduleMessage=function(e){var t=this.destination;t.add(this.scheduler.schedule(r.dispatch,this.delay,new c(e,this.destination)))};r.prototype._next=function(e){this.scheduleMessage(o.Notification.createNext(e))};r.prototype._error=function(e){this.scheduleMessage(o.Notification.createError(e));this.unsubscribe()};r.prototype._complete=function(){this.scheduleMessage(o.Notification.createComplete());this.unsubscribe()};return r}(i.Subscriber);r.ObserveOnSubscriber=u;var c=function(){function e(e,t){this.notification=e;this.destination=t}return e}();r.ObserveOnMessage=c},{"../Notification":47,"../Subscriber":55}],140:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../observable/from");var o=e("../util/isArray");var a=e("../OuterSubscriber");var s=e("../InnerSubscriber");var u=e("../util/subscribeToResult");function c(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}if(t.length===1&&o.isArray(t[0])){t=t[0]}return function(e){return e.lift(new l(t))}}r.onErrorResumeNext=c;function h(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=null;if(e.length===1&&o.isArray(e[0])){e=e[0]}r=e.shift();return n.from(r,null).lift(new l(e))}r.onErrorResumeNextStatic=h;var l=function(){function e(e){this.nextSources=e}e.prototype.call=function(e,t){return t.subscribe(new p(e,this.nextSources))};return e}();var p=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.destination=e;r.nextSources=t;return r}e.prototype.notifyError=function(e,t){this.subscribeToNextSource()};e.prototype.notifyComplete=function(e){this.subscribeToNextSource()};e.prototype._error=function(e){this.subscribeToNextSource();this.unsubscribe()};e.prototype._complete=function(){this.subscribeToNextSource();this.unsubscribe()};e.prototype.subscribeToNextSource=function(){var e=this.nextSources.shift();if(e){var t=new s.InnerSubscriber(this,undefined,undefined);var r=this.destination;r.add(t);u.subscribeToResult(this,e,undefined,undefined,t)}else{this.destination.complete()}};return e}(a.OuterSubscriber)},{"../InnerSubscriber":46,"../OuterSubscriber":50,"../observable/from":67,"../util/isArray":219,"../util/subscribeToResult":238}],141:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");function o(){return function(e){return e.lift(new a)}}r.pairwise=o;var a=function(){function e(){}e.prototype.call=function(e,t){return t.subscribe(new s(e))};return e}();var s=function(r){n(e,r);function e(e){var t=r.call(this,e)||this;t.hasPrev=false;return t}e.prototype._next=function(e){if(this.hasPrev){this.destination.next([this.prev,e])}else{this.hasPrev=true}this.prev=e};return e}(i.Subscriber)},{"../Subscriber":55}],142:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../util/not");var i=e("./filter");function o(t,r){return function(e){return[i.filter(t,r)(e),i.filter(n.not(t,r))(e)]}}r.partition=o},{"../util/not":231,"./filter":119}],143:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./map");function i(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}var r=t.length;if(r===0){throw new Error("list of properties cannot be empty.")}return function(e){return n.map(o(t,r))(e)}}r.pluck=i;function o(i,o){var e=function(e){var t=e;for(var r=0;r<o;r++){var n=t[i[r]];if(typeof n!=="undefined"){t=n}else{return undefined}}return t};return e}},{"./map":128}],144:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subject");var i=e("./multicast");function o(e){return e?i.multicast(function(){return new n.Subject},e):i.multicast(new n.Subject)}r.publish=o},{"../Subject":53,"./multicast":138}],145:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../BehaviorSubject");var i=e("./multicast");function o(t){return function(e){return i.multicast(new n.BehaviorSubject(t))(e)}}r.publishBehavior=o},{"../BehaviorSubject":45,"./multicast":138}],146:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../AsyncSubject");var i=e("./multicast");function o(){return function(e){return i.multicast(new n.AsyncSubject)(e)}}r.publishLast=o},{"../AsyncSubject":44,"./multicast":138}],147:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var a=e("../ReplaySubject");var s=e("./multicast");function n(e,t,r,n){if(r&&typeof r!=="function"){n=r}var i=typeof r==="function"?r:undefined;var o=new a.ReplaySubject(e,t,n);return function(e){return s.multicast(function(){return o},i)(e)}}r.publishReplay=n},{"../ReplaySubject":51,"./multicast":138}],148:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../util/isArray");var i=e("../observable/race");function o(){var r=[];for(var e=0;e<arguments.length;e++){r[e]=arguments[e]}return function e(t){if(r.length===1&&n.isArray(r[0])){r=r[0]}return t.lift.call(i.race.apply(void 0,[t].concat(r)))}}r.race=o},{"../observable/race":82,"../util/isArray":219}],149:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("./scan");var o=e("./takeLast");var a=e("./defaultIfEmpty");var s=e("../util/pipe");function n(n,r){if(arguments.length>=2){return function e(t){return s.pipe(i.scan(n,r),o.takeLast(1),a.defaultIfEmpty(r))(t)}}return function e(t){return s.pipe(i.scan(function(e,t,r){return n(e,t,r+1)}),o.takeLast(1))(t)}}r.reduce=n},{"../util/pipe":232,"./defaultIfEmpty":106,"./scan":157,"./takeLast":172}],150:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subscriber");function o(){return function e(t){return t.lift(new a(t))}}r.refCount=o;var a=function(){function e(e){this.connectable=e}e.prototype.call=function(e,t){var r=this.connectable;r._refCount++;var n=new s(e,r);var i=t.subscribe(n);if(!n.closed){n.connection=r.connect()}return i};return e}();var s=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.connectable=t;return r}e.prototype._unsubscribe=function(){var e=this.connectable;if(!e){this.connection=null;return}this.connectable=null;var t=e._refCount;if(t<=0){this.connection=null;return}e._refCount=t-1;if(t>1){this.connection=null;return}var r=this.connection;var n=e._connection;this.connection=null;if(n&&(!r||n===r)){n.unsubscribe()}};return e}(n.Subscriber)},{"../Subscriber":55}],151:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");var o=e("../observable/empty");function a(t){if(t===void 0){t=-1}return function(e){if(t===0){return o.empty()}else if(t<0){return e.lift(new s(-1,e))}else{return e.lift(new s(t-1,e))}}}r.repeat=a;var s=function(){function e(e,t){this.count=e;this.source=t}e.prototype.call=function(e,t){return t.subscribe(new u(e,this.count,this.source))};return e}();var u=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.count=t;n.source=r;return n}e.prototype.complete=function(){if(!this.isStopped){var e=this,t=e.source,r=e.count;if(r===0){return i.prototype.complete.call(this)}else if(r>-1){this.count=r-1}t.subscribe(this._unsubscribeAndRecycle())}};return e}(i.Subscriber)},{"../Subscriber":55,"../observable/empty":65}],152:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("../Subject");var a=e("../util/tryCatch");var s=e("../util/errorObject");var i=e("../OuterSubscriber");var u=e("../util/subscribeToResult");function c(t){return function(e){return e.lift(new h(t))}}r.repeatWhen=c;var h=function(){function e(e){this.notifier=e}e.prototype.call=function(e,t){return t.subscribe(new l(e,this.notifier,t))};return e}();var l=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.notifier=t;n.source=r;n.sourceIsBeingSubscribedTo=true;return n}e.prototype.notifyNext=function(e,t,r,n,i){this.sourceIsBeingSubscribedTo=true;this.source.subscribe(this)};e.prototype.notifyComplete=function(e){if(this.sourceIsBeingSubscribedTo===false){return i.prototype.complete.call(this)}};e.prototype.complete=function(){this.sourceIsBeingSubscribedTo=false;if(!this.isStopped){if(!this.retries){this.subscribeToRetries()}if(!this.retriesSubscription||this.retriesSubscription.closed){return i.prototype.complete.call(this)}this._unsubscribeAndRecycle();this.notifications.next()}};e.prototype._unsubscribe=function(){var e=this,t=e.notifications,r=e.retriesSubscription;if(t){t.unsubscribe();this.notifications=null}if(r){r.unsubscribe();this.retriesSubscription=null}this.retries=null};e.prototype._unsubscribeAndRecycle=function(){var e=this._unsubscribe;this._unsubscribe=null;i.prototype._unsubscribeAndRecycle.call(this);this._unsubscribe=e;return this};e.prototype.subscribeToRetries=function(){this.notifications=new o.Subject;var e=a.tryCatch(this.notifier)(this.notifications);if(e===s.errorObject){return i.prototype.complete.call(this)}this.retries=e;this.retriesSubscription=u.subscribeToResult(this,e)};return e}(i.OuterSubscriber)},{"../OuterSubscriber":50,"../Subject":53,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],153:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");function o(t){if(t===void 0){t=-1}return function(e){return e.lift(new a(t,e))}}r.retry=o;var a=function(){function e(e,t){this.count=e;this.source=t}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.count,this.source))};return e}();var s=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.count=t;n.source=r;return n}e.prototype.error=function(e){if(!this.isStopped){var t=this,r=t.source,n=t.count;if(n===0){return i.prototype.error.call(this,e)}else if(n>-1){this.count=n-1}r.subscribe(this._unsubscribeAndRecycle())}};return e}(i.Subscriber)},{"../Subscriber":55}],154:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("../Subject");var a=e("../util/tryCatch");var s=e("../util/errorObject");var i=e("../OuterSubscriber");var u=e("../util/subscribeToResult");function c(t){return function(e){return e.lift(new h(t,e))}}r.retryWhen=c;var h=function(){function e(e,t){this.notifier=e;this.source=t}e.prototype.call=function(e,t){return t.subscribe(new l(e,this.notifier,this.source))};return e}();var l=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.notifier=t;n.source=r;return n}e.prototype.error=function(e){if(!this.isStopped){var t=this.errors;var r=this.retries;var n=this.retriesSubscription;if(!r){t=new o.Subject;r=a.tryCatch(this.notifier)(t);if(r===s.errorObject){return i.prototype.error.call(this,s.errorObject.e)}n=u.subscribeToResult(this,r)}else{this.errors=null;this.retriesSubscription=null}this._unsubscribeAndRecycle();this.errors=t;this.retries=r;this.retriesSubscription=n;t.next(e)}};e.prototype._unsubscribe=function(){var e=this,t=e.errors,r=e.retriesSubscription;if(t){t.unsubscribe();this.errors=null}if(r){r.unsubscribe();this.retriesSubscription=null}this.retries=null};e.prototype.notifyNext=function(e,t,r,n,i){var o=this._unsubscribe;this._unsubscribe=null;this._unsubscribeAndRecycle();this._unsubscribe=o;this.source.subscribe(this)};return e}(i.OuterSubscriber)},{"../OuterSubscriber":50,"../Subject":53,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],155:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../OuterSubscriber");var o=e("../util/subscribeToResult");function a(t){return function(e){return e.lift(new s(t))}}r.sample=a;var s=function(){function e(e){this.notifier=e}e.prototype.call=function(e,t){var r=new u(e);var n=t.subscribe(r);n.add(o.subscribeToResult(r,this.notifier));return n};return e}();var u=function(t){n(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.hasValue=false;return e}e.prototype._next=function(e){this.value=e;this.hasValue=true};e.prototype.notifyNext=function(e,t,r,n,i){this.emitValue()};e.prototype.notifyComplete=function(){this.emitValue()};e.prototype.emitValue=function(){if(this.hasValue){this.hasValue=false;this.destination.next(this.value)}};return e}(i.OuterSubscriber)},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],156:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");var o=e("../scheduler/async");function a(t,r){if(r===void 0){r=o.async}return function(e){return e.lift(new s(t,r))}}r.sampleTime=a;var s=function(){function e(e,t){this.period=e;this.scheduler=t}e.prototype.call=function(e,t){return t.subscribe(new u(e,this.period,this.scheduler))};return e}();var u=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.period=t;n.scheduler=r;n.hasValue=false;n.add(r.schedule(c,t,{subscriber:n,period:t}));return n}e.prototype._next=function(e){this.lastValue=e;this.hasValue=true};e.prototype.notifyNext=function(){if(this.hasValue){this.hasValue=false;this.destination.next(this.lastValue)}};return e}(i.Subscriber);function c(e){var t=e.subscriber,r=e.period;t.notifyNext();this.schedule(e,r)}},{"../Subscriber":55,"../scheduler/async":204}],157:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");function o(r,n){var i=false;if(arguments.length>=2){i=true}return function e(t){return t.lift(new a(r,n,i))}}r.scan=o;var a=function(){function e(e,t,r){if(r===void 0){r=false}this.accumulator=e;this.seed=t;this.hasSeed=r}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.accumulator,this.seed,this.hasSeed))};return e}();var s=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e)||this;i.accumulator=t;i._seed=r;i.hasSeed=n;i.index=0;return i}Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=true;this._seed=e},enumerable:true,configurable:true});e.prototype._next=function(e){if(!this.hasSeed){this.seed=e;this.destination.next(e)}else{return this._tryNext(e)}};e.prototype._tryNext=function(e){var t=this.index++;var r;try{r=this.accumulator(this.seed,e,t)}catch(e){this.destination.error(e)}this.seed=r;this.destination.next(r)};return e}(i.Subscriber)},{"../Subscriber":55}],158:[function(e,t,r){"use strict";var o=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subscriber");var s=e("../util/tryCatch");var u=e("../util/errorObject");function i(t,r){return function(e){return e.lift(new a(t,r))}}r.sequenceEqual=i;var a=function(){function e(e,t){this.compareTo=e;this.comparor=t}e.prototype.call=function(e,t){return t.subscribe(new c(e,this.compareTo,this.comparor))};return e}();r.SequenceEqualOperator=a;var c=function(i){o(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.compareTo=t;n.comparor=r;n._a=[];n._b=[];n._oneComplete=false;n.destination.add(t.subscribe(new h(e,n)));return n}e.prototype._next=function(e){if(this._oneComplete&&this._b.length===0){this.emit(false)}else{this._a.push(e);this.checkValues()}};e.prototype._complete=function(){if(this._oneComplete){this.emit(this._a.length===0&&this._b.length===0)}else{this._oneComplete=true}this.unsubscribe()};e.prototype.checkValues=function(){var e=this,t=e._a,r=e._b,n=e.comparor;while(t.length>0&&r.length>0){var i=t.shift();var o=r.shift();var a=false;if(n){a=s.tryCatch(n)(i,o);if(a===u.errorObject){this.destination.error(u.errorObject.e)}}else{a=i===o}if(!a){this.emit(false)}}};e.prototype.emit=function(e){var t=this.destination;t.next(e);t.complete()};e.prototype.nextB=function(e){if(this._oneComplete&&this._a.length===0){this.emit(false)}else{this._b.push(e);this.checkValues()}};e.prototype.completeB=function(){if(this._oneComplete){this.emit(this._a.length===0&&this._b.length===0)}else{this._oneComplete=true}};return e}(n.Subscriber);r.SequenceEqualSubscriber=c;var h=function(n){o(e,n);function e(e,t){var r=n.call(this,e)||this;r.parent=t;return r}e.prototype._next=function(e){this.parent.nextB(e)};e.prototype._error=function(e){this.parent.error(e);this.unsubscribe()};e.prototype._complete=function(){this.parent.completeB();this.unsubscribe()};return e}(n.Subscriber)},{"../Subscriber":55,"../util/errorObject":216,"../util/tryCatch":240}],159:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./multicast");var i=e("./refCount");var o=e("../Subject");function a(){return new o.Subject}function s(){return function(e){return i.refCount()(n.multicast(a)(e))}}r.share=s},{"../Subject":53,"./multicast":138,"./refCount":150}],160:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var l=e("../ReplaySubject");function n(t,r,n){if(t===void 0){t=Number.POSITIVE_INFINITY}if(r===void 0){r=Number.POSITIVE_INFINITY}return function(e){return e.lift(i(t,r,n))}}r.shareReplay=n;function i(n,i,o){var a;var s=0;var u;var c=false;var h=false;return function e(t){s++;if(!a||c){c=false;a=new l.ReplaySubject(n,i,o);u=t.subscribe({next:function(e){a.next(e)},error:function(e){c=true;a.error(e)},complete:function(){h=true;a.complete()}})}var r=a.subscribe(this);return function(){s--;r.unsubscribe();if(u&&s===0&&h){u.unsubscribe()}}}}},{"../ReplaySubject":51}],161:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");var o=e("../util/EmptyError");function a(t){return function(e){return e.lift(new s(t,e))}}r.single=a;var s=function(){function e(e,t){this.predicate=e;this.source=t}e.prototype.call=function(e,t){return t.subscribe(new u(e,this.predicate,this.source))};return e}();var u=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.predicate=t;n.source=r;n.seenValue=false;n.index=0;return n}e.prototype.applySingleValue=function(e){if(this.seenValue){this.destination.error("Sequence contains more than one element")}else{this.seenValue=true;this.singleValue=e}};e.prototype._next=function(e){var t=this.index++;if(this.predicate){this.tryNext(e,t)}else{this.applySingleValue(e)}};e.prototype.tryNext=function(e,t){try{if(this.predicate(e,t,this.source)){this.applySingleValue(e)}}catch(e){this.destination.error(e)}};e.prototype._complete=function(){var e=this.destination;if(this.index>0){e.next(this.seenValue?this.singleValue:undefined);e.complete()}else{e.error(new o.EmptyError)}};return e}(i.Subscriber)},{"../Subscriber":55,"../util/EmptyError":210}],162:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subscriber");function o(t){return function(e){return e.lift(new a(t))}}r.skip=o;var a=function(){function e(e){this.total=e}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.total))};return e}();var s=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.total=t;r.count=0;return r}e.prototype._next=function(e){if(++this.count>this.total){this.destination.next(e)}};return e}(n.Subscriber)},{"../Subscriber":55}],163:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subscriber");var o=e("../util/ArgumentOutOfRangeError");function a(t){return function(e){return e.lift(new s(t))}}r.skipLast=a;var s=function(){function e(e){this._skipCount=e;if(this._skipCount<0){throw new o.ArgumentOutOfRangeError}}e.prototype.call=function(e,t){if(this._skipCount===0){return t.subscribe(new n.Subscriber(e))}else{return t.subscribe(new u(e,this._skipCount))}};return e}();var u=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r._skipCount=t;r._count=0;r._ring=new Array(t);return r}e.prototype._next=function(e){var t=this._skipCount;var r=this._count++;if(r<t){this._ring[r]=e}else{var n=r%t;var i=this._ring;var o=i[n];i[n]=e;this.destination.next(o)}};return e}(n.Subscriber)},{"../Subscriber":55,"../util/ArgumentOutOfRangeError":209}],164:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../OuterSubscriber");var o=e("../InnerSubscriber");var a=e("../util/subscribeToResult");function s(t){return function(e){return e.lift(new u(t))}}r.skipUntil=s;var u=function(){function e(e){this.notifier=e}e.prototype.call=function(e,t){return t.subscribe(new c(e,this.notifier))};return e}();var c=function(i){n(e,i);function e(e,t){var r=i.call(this,e)||this;r.hasValue=false;var n=new o.InnerSubscriber(r,undefined,undefined);r.add(n);r.innerSubscription=n;a.subscribeToResult(r,t,undefined,undefined,n);return r}e.prototype._next=function(e){if(this.hasValue){i.prototype._next.call(this,e)}};e.prototype.notifyNext=function(e,t,r,n,i){this.hasValue=true;if(this.innerSubscription){this.innerSubscription.unsubscribe()}};e.prototype.notifyComplete=function(){};return e}(i.OuterSubscriber)},{"../InnerSubscriber":46,"../OuterSubscriber":50,"../util/subscribeToResult":238}],165:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subscriber");function o(t){return function(e){return e.lift(new a(t))}}r.skipWhile=o;var a=function(){function e(e){this.predicate=e}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate))};return e}();var s=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.predicate=t;r.skipping=true;r.index=0;return r}e.prototype._next=function(e){var t=this.destination;if(this.skipping){this.tryCallPredicate(e)}if(!this.skipping){t.next(e)}};e.prototype.tryCallPredicate=function(e){try{var t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(e){this.destination.error(e)}};return e}(n.Subscriber)},{"../Subscriber":55}],166:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("../observable/fromArray");var o=e("../observable/scalar");var a=e("../observable/empty");var s=e("../observable/concat");var u=e("../util/isScheduler");function n(){var n=[];for(var e=0;e<arguments.length;e++){n[e]=arguments[e]}return function(e){var t=n[n.length-1];if(u.isScheduler(t)){n.pop()}else{t=null}var r=n.length;if(r===1&&!t){return s.concat(o.scalar(n[0]),e)}else if(r>0){return s.concat(i.fromArray(n,t),e)}else{return s.concat(a.empty(t),e)}}}r.startWith=n},{"../observable/concat":63,"../observable/empty":65,"../observable/fromArray":68,"../observable/scalar":84,"../util/isScheduler":229}],167:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../observable/SubscribeOnObservable");function i(r,n){if(n===void 0){n=0}return function e(t){return t.lift(new o(r,n))}}r.subscribeOn=i;var o=function(){function e(e,t){this.scheduler=e;this.delay=t}e.prototype.call=function(e,t){return new n.SubscribeOnObservable(t,this.delay,this.scheduler).subscribe(e)};return e}()},{"../observable/SubscribeOnObservable":59}],168:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./switchMap");var i=e("../util/identity");function o(){return n.switchMap(i.identity)}r.switchAll=o},{"../util/identity":218,"./switchMap":169}],169:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../OuterSubscriber");var a=e("../InnerSubscriber");var s=e("../util/subscribeToResult");var o=e("./map");var u=e("../observable/from");function c(t,i){if(typeof i==="function"){return function(e){return e.pipe(c(function(r,n){return u.from(t(r,n)).pipe(o.map(function(e,t){return i(r,e,n,t)}))}))}}return function(e){return e.lift(new h(t))}}r.switchMap=c;var h=function(){function e(e){this.project=e}e.prototype.call=function(e,t){return t.subscribe(new l(e,this.project))};return e}();var l=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.project=t;r.index=0;return r}e.prototype._next=function(e){var t;var r=this.index++;try{t=this.project(e,r)}catch(e){this.destination.error(e);return}this._innerSub(t,e,r)};e.prototype._innerSub=function(e,t,r){var n=this.innerSubscription;if(n){n.unsubscribe()}var i=new a.InnerSubscriber(this,undefined,undefined);var o=this.destination;o.add(i);this.innerSubscription=s.subscribeToResult(this,e,t,r,i)};e.prototype._complete=function(){var e=this.innerSubscription;if(!e||e.closed){n.prototype._complete.call(this)}this.unsubscribe()};e.prototype._unsubscribe=function(){this.innerSubscription=null};e.prototype.notifyComplete=function(e){var t=this.destination;t.remove(e);this.innerSubscription=null;if(this.isStopped){n.prototype._complete.call(this)}};e.prototype.notifyNext=function(e,t,r,n,i){this.destination.next(t)};return e}(n.OuterSubscriber)},{"../InnerSubscriber":46,"../OuterSubscriber":50,"../observable/from":67,"../util/subscribeToResult":238,"./map":128}],170:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./switchMap");function i(e,t){return t?n.switchMap(function(){return e},t):n.switchMap(function(){return e})}r.switchMapTo=i},{"./switchMap":169}],171:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subscriber");var o=e("../util/ArgumentOutOfRangeError");var a=e("../observable/empty");function s(t){return function(e){if(t===0){return a.empty()}else{return e.lift(new u(t))}}}r.take=s;var u=function(){function e(e){this.total=e;if(this.total<0){throw new o.ArgumentOutOfRangeError}}e.prototype.call=function(e,t){return t.subscribe(new c(e,this.total))};return e}();var c=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.total=t;r.count=0;return r}e.prototype._next=function(e){var t=this.total;var r=++this.count;if(r<=t){this.destination.next(e);if(r===t){this.destination.complete();this.unsubscribe()}}};return e}(n.Subscriber)},{"../Subscriber":55,"../observable/empty":65,"../util/ArgumentOutOfRangeError":209}],172:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subscriber");var o=e("../util/ArgumentOutOfRangeError");var a=e("../observable/empty");function s(r){return function e(t){if(r===0){return a.empty()}else{return t.lift(new u(r))}}}r.takeLast=s;var u=function(){function e(e){this.total=e;if(this.total<0){throw new o.ArgumentOutOfRangeError}}e.prototype.call=function(e,t){return t.subscribe(new c(e,this.total))};return e}();var c=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.total=t;r.ring=new Array;r.count=0;return r}e.prototype._next=function(e){var t=this.ring;var r=this.total;var n=this.count++;if(t.length<r){t.push(e)}else{var i=n%r;t[i]=e}};e.prototype._complete=function(){var e=this.destination;var t=this.count;if(t>0){var r=this.count>=this.total?this.total:this.count;var n=this.ring;for(var i=0;i<r;i++){var o=t++%r;e.next(n[o])}}e.complete()};return e}(n.Subscriber)},{"../Subscriber":55,"../observable/empty":65,"../util/ArgumentOutOfRangeError":209}],173:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../OuterSubscriber");var o=e("../util/subscribeToResult");function a(t){return function(e){return e.lift(new s(t))}}r.takeUntil=a;var s=function(){function e(e){this.notifier=e}e.prototype.call=function(e,t){var r=new u(e);var n=o.subscribeToResult(r,this.notifier);if(n&&!r.seenValue){r.add(n);return t.subscribe(r)}return r};return e}();var u=function(r){n(e,r);function e(e){var t=r.call(this,e)||this;t.seenValue=false;return t}e.prototype.notifyNext=function(e,t,r,n,i){this.seenValue=true;this.complete()};e.prototype.notifyComplete=function(){};return e}(i.OuterSubscriber)},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],174:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subscriber");function o(t){return function(e){return e.lift(new a(t))}}r.takeWhile=o;var a=function(){function e(e){this.predicate=e}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate))};return e}();var s=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.predicate=t;r.index=0;return r}e.prototype._next=function(e){var t=this.destination;var r;try{r=this.predicate(e,this.index++)}catch(e){t.error(e);return}this.nextOrComplete(e,r)};e.prototype.nextOrComplete=function(e,t){var r=this.destination;if(Boolean(t)){r.next(e)}else{r.complete()}};return e}(n.Subscriber)},{"../Subscriber":55}],175:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");var a=e("../util/noop");var s=e("../util/isFunction");function o(r,n,i){return function e(t){return t.lift(new u(r,n,i))}}r.tap=o;var u=function(){function e(e,t,r){this.nextOrObserver=e;this.error=t;this.complete=r}e.prototype.call=function(e,t){return t.subscribe(new c(e,this.nextOrObserver,this.error,this.complete))};return e}();var c=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e)||this;i._tapNext=a.noop;i._tapError=a.noop;i._tapComplete=a.noop;i._tapError=r||a.noop;i._tapComplete=n||a.noop;if(s.isFunction(t)){i._context=i;i._tapNext=t}else if(t){i._context=t;i._tapNext=t.next||a.noop;i._tapError=t.error||a.noop;i._tapComplete=t.complete||a.noop}return i}e.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){this.destination.error(e);return}this.destination.next(e)};e.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){this.destination.error(e);return}this.destination.error(e)};e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){this.destination.error(e);return}return this.destination.complete()};return e}(i.Subscriber)},{"../Subscriber":55,"../util/isFunction":222,"../util/noop":230}],176:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:true});var i=e("../OuterSubscriber");var a=e("../util/subscribeToResult");n.defaultThrottleConfig={leading:true,trailing:false};function o(t,r){if(r===void 0){r=n.defaultThrottleConfig}return function(e){return e.lift(new s(t,r.leading,r.trailing))}}n.throttle=o;var s=function(){function e(e,t,r){this.durationSelector=e;this.leading=t;this.trailing=r}e.prototype.call=function(e,t){return t.subscribe(new u(e,this.durationSelector,this.leading,this.trailing))};return e}();var u=function(o){r(e,o);function e(e,t,r,n){var i=o.call(this,e)||this;i.destination=e;i.durationSelector=t;i._leading=r;i._trailing=n;i._hasValue=false;return i}e.prototype._next=function(e){this._hasValue=true;this._sendValue=e;if(!this._throttled){if(this._leading){this.send()}else{this.throttle(e)}}};e.prototype.send=function(){var e=this,t=e._hasValue,r=e._sendValue;if(t){this.destination.next(r);this.throttle(r)}this._hasValue=false;this._sendValue=null};e.prototype.throttle=function(e){var t=this.tryDurationSelector(e);if(t){this.add(this._throttled=a.subscribeToResult(this,t))}};e.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(e){this.destination.error(e);return null}};e.prototype.throttlingDone=function(){var e=this,t=e._throttled,r=e._trailing;if(t){t.unsubscribe()}this._throttled=null;if(r){this.send()}};e.prototype.notifyNext=function(e,t,r,n,i){this.throttlingDone()};e.prototype.notifyComplete=function(){this.throttlingDone()};return e}(i.OuterSubscriber)},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],177:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");var o=e("../scheduler/async");var a=e("./throttle");function s(t,r,n){if(r===void 0){r=o.async}if(n===void 0){n=a.defaultThrottleConfig}return function(e){return e.lift(new u(t,r,n.leading,n.trailing))}}r.throttleTime=s;var u=function(){function e(e,t,r,n){this.duration=e;this.scheduler=t;this.leading=r;this.trailing=n}e.prototype.call=function(e,t){return t.subscribe(new c(e,this.duration,this.scheduler,this.leading,this.trailing))};return e}();var c=function(a){n(e,a);function e(e,t,r,n,i){var o=a.call(this,e)||this;o.duration=t;o.scheduler=r;o.leading=n;o.trailing=i;o._hasTrailingValue=false;o._trailingValue=null;return o}e.prototype._next=function(e){if(this.throttled){if(this.trailing){this._trailingValue=e;this._hasTrailingValue=true}}else{this.add(this.throttled=this.scheduler.schedule(h,this.duration,{subscriber:this}));if(this.leading){this.destination.next(e)}}};e.prototype._complete=function(){if(this._hasTrailingValue){this.destination.next(this._trailingValue);this.destination.complete()}else{this.destination.complete()}};e.prototype.clearThrottle=function(){var e=this.throttled;if(e){if(this.trailing&&this._hasTrailingValue){this.destination.next(this._trailingValue);this._trailingValue=null;this._hasTrailingValue=false}e.unsubscribe();this.remove(e);this.throttled=null}};return e}(i.Subscriber);function h(e){var t=e.subscriber;t.clearThrottle()}},{"../Subscriber":55,"../scheduler/async":204,"./throttle":176}],178:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./tap");var i=e("../util/EmptyError");r.throwIfEmpty=function(e){if(e===void 0){e=o}return n.tap({hasValue:false,next:function(){this.hasValue=true},complete:function(){if(!this.hasValue){throw e()}}})};function o(){return new i.EmptyError}},{"../util/EmptyError":210,"./tap":175}],179:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("../scheduler/async");var o=e("./scan");var a=e("../observable/defer");var s=e("./map");function n(n){if(n===void 0){n=i.async}return function(e){return a.defer(function(){return e.pipe(o.scan(function(e,t){var r=e.current;return{value:t,current:n.now(),last:r}},{current:n.now(),value:undefined,last:undefined}),s.map(function(e){var t=e.current,r=e.last,n=e.value;return new u(n,t-r)}))})}}r.timeInterval=n;var u=function(){function e(e,t){this.value=e;this.interval=t}return e}();r.TimeInterval=u},{"../observable/defer":64,"../scheduler/async":204,"./map":128,"./scan":157}],180:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../scheduler/async");var i=e("../util/TimeoutError");var o=e("./timeoutWith");var a=e("../observable/throwError");function s(e,t){if(t===void 0){t=n.async}return o.timeoutWith(e,a.throwError(new i.TimeoutError),t)}r.timeout=s},{"../observable/throwError":85,"../scheduler/async":204,"../util/TimeoutError":213,"./timeoutWith":181}],181:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var a=e("../scheduler/async");var s=e("../util/isDate");var i=e("../OuterSubscriber");var o=e("../util/subscribeToResult");function u(n,i,o){if(o===void 0){o=a.async}return function(e){var t=s.isDate(n);var r=t?+n-o.now():Math.abs(n);return e.lift(new c(r,t,i,o))}}r.timeoutWith=u;var c=function(){function e(e,t,r,n){this.waitFor=e;this.absoluteTimeout=t;this.withObservable=r;this.scheduler=n}e.prototype.call=function(e,t){return t.subscribe(new h(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))};return e}();var h=function(a){n(t,a);function t(e,t,r,n,i){var o=a.call(this,e)||this;o.absoluteTimeout=t;o.waitFor=r;o.withObservable=n;o.scheduler=i;o.action=null;o.scheduleTimeout();return o}t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle();e.add(o.subscribeToResult(e,t))};t.prototype.scheduleTimeout=function(){var e=this.action;if(e){this.action=e.schedule(this,this.waitFor)}else{this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))}};t.prototype._next=function(e){if(!this.absoluteTimeout){this.scheduleTimeout()}a.prototype._next.call(this,e)};t.prototype._unsubscribe=function(){this.action=null;this.scheduler=null;this.withObservable=null};return t}(i.OuterSubscriber)},{"../OuterSubscriber":50,"../scheduler/async":204,"../util/isDate":221,"../util/subscribeToResult":238}],182:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../scheduler/async");var i=e("./map");function o(t){if(t===void 0){t=n.async}return i.map(function(e){return new a(e,t.now())})}r.timestamp=o;var a=function(){function e(e,t){this.value=e;this.timestamp=t}return e}();r.Timestamp=a},{"../scheduler/async":204,"./map":128}],183:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./reduce");function i(e,t,r){if(r===0){return[t]}e.push(t);return e}function o(){return n.reduce(i,[])}r.toArray=o},{"./reduce":149}],184:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subject");var o=e("../OuterSubscriber");var a=e("../util/subscribeToResult");function s(r){return function e(t){return t.lift(new u(r))}}r.window=s;var u=function(){function e(e){this.windowBoundaries=e}e.prototype.call=function(e,t){var r=new c(e);var n=t.subscribe(r);if(!n.closed){r.add(a.subscribeToResult(r,this.windowBoundaries))}return n};return e}();var c=function(r){n(e,r);function e(e){var t=r.call(this,e)||this;t.window=new i.Subject;e.next(t.window);return t}e.prototype.notifyNext=function(e,t,r,n,i){this.openWindow()};e.prototype.notifyError=function(e,t){this._error(e)};e.prototype.notifyComplete=function(e){this._complete()};e.prototype._next=function(e){this.window.next(e)};e.prototype._error=function(e){this.window.error(e);this.destination.error(e)};e.prototype._complete=function(){this.window.complete();this.destination.complete()};e.prototype._unsubscribe=function(){this.window=null};e.prototype.openWindow=function(){var e=this.window;if(e){e.complete()}var t=this.destination;var r=this.window=new i.Subject;t.next(r)};return e}(o.OuterSubscriber)},{"../OuterSubscriber":50,"../Subject":53,"../util/subscribeToResult":238}],185:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscriber");var c=e("../Subject");function o(r,n){if(n===void 0){n=0}return function e(t){return t.lift(new a(r,n))}}r.windowCount=o;var a=function(){function e(e,t){this.windowSize=e;this.startWindowEvery=t}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.windowSize,this.startWindowEvery))};return e}();var s=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e)||this;n.destination=e;n.windowSize=t;n.startWindowEvery=r;n.windows=[new c.Subject];n.count=0;e.next(n.windows[0]);return n}e.prototype._next=function(e){var t=this.startWindowEvery>0?this.startWindowEvery:this.windowSize;var r=this.destination;var n=this.windowSize;var i=this.windows;var o=i.length;for(var a=0;a<o&&!this.closed;a++){i[a].next(e)}var s=this.count-n+1;if(s>=0&&s%t===0&&!this.closed){i.shift().complete()}if(++this.count%t===0&&!this.closed){var u=new c.Subject;i.push(u);r.next(u)}};e.prototype._error=function(e){var t=this.windows;if(t){while(t.length>0&&!this.closed){t.shift().error(e)}}this.destination.error(e)};e.prototype._complete=function(){var e=this.windows;if(e){while(e.length>0&&!this.closed){e.shift().complete()}}this.destination.complete()};e.prototype._unsubscribe=function(){this.count=0;this.windows=null};return e}(i.Subscriber)},{"../Subject":53,"../Subscriber":55}],186:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subject");var a=e("../scheduler/async");var o=e("../Subscriber");var s=e("../util/isNumeric");var u=e("../util/isScheduler");function c(r){var n=a.async;var i=null;var o=Number.POSITIVE_INFINITY;if(u.isScheduler(arguments[3])){n=arguments[3]}if(u.isScheduler(arguments[2])){n=arguments[2]}else if(s.isNumeric(arguments[2])){o=arguments[2]}if(u.isScheduler(arguments[1])){n=arguments[1]}else if(s.isNumeric(arguments[1])){i=arguments[1]}return function e(t){return t.lift(new h(r,i,o,n))}}r.windowTime=c;var h=function(){function e(e,t,r,n){this.windowTimeSpan=e;this.windowCreationInterval=t;this.maxWindowSize=r;this.scheduler=n}e.prototype.call=function(e,t){return t.subscribe(new p(e,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))};return e}();var l=function(t){n(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e._numberOfNextedValues=0;return e}e.prototype.next=function(e){this._numberOfNextedValues++;t.prototype.next.call(this,e)};Object.defineProperty(e.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:true,configurable:true});return e}(i.Subject);var p=function(h){n(e,h);function e(e,t,r,n,i){var o=h.call(this,e)||this;o.destination=e;o.windowTimeSpan=t;o.windowCreationInterval=r;o.maxWindowSize=n;o.scheduler=i;o.windows=[];var a=o.openWindow();if(r!==null&&r>=0){var s={subscriber:o,window:a,context:null};var u={windowTimeSpan:t,windowCreationInterval:r,subscriber:o,scheduler:i};o.add(i.schedule(v,t,s));o.add(i.schedule(d,r,u))}else{var c={subscriber:o,window:a,windowTimeSpan:t};o.add(i.schedule(f,t,c))}return o}e.prototype._next=function(e){var t=this.windows;var r=t.length;for(var n=0;n<r;n++){var i=t[n];if(!i.closed){i.next(e);if(i.numberOfNextedValues>=this.maxWindowSize){this.closeWindow(i)}}}};e.prototype._error=function(e){var t=this.windows;while(t.length>0){t.shift().error(e)}this.destination.error(e)};e.prototype._complete=function(){var e=this.windows;while(e.length>0){var t=e.shift();if(!t.closed){t.complete()}}this.destination.complete()};e.prototype.openWindow=function(){var e=new l;this.windows.push(e);var t=this.destination;t.next(e);return e};e.prototype.closeWindow=function(e){e.complete();var t=this.windows;t.splice(t.indexOf(e),1)};return e}(o.Subscriber);function f(e){var t=e.subscriber,r=e.windowTimeSpan,n=e.window;if(n){t.closeWindow(n)}e.window=t.openWindow();this.schedule(e,r)}function d(e){var t=e.windowTimeSpan,r=e.subscriber,n=e.scheduler,i=e.windowCreationInterval;var o=r.openWindow();var a=this;var s={action:a,subscription:null};var u={subscriber:r,window:o,context:s};s.subscription=n.schedule(v,t,u);a.add(s.subscription);a.schedule(e,i)}function v(e){var t=e.subscriber,r=e.window,n=e.context;if(n&&n.action&&n.subscription){n.action.remove(n.subscription)}t.closeWindow(r)}},{"../Subject":53,"../Subscriber":55,"../scheduler/async":204,"../util/isNumeric":225,"../util/isScheduler":229}],187:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var l=e("../Subject");var p=e("../Subscription");var f=e("../util/tryCatch");var d=e("../util/errorObject");var i=e("../OuterSubscriber");var v=e("../util/subscribeToResult");function o(t,r){return function(e){return e.lift(new a(t,r))}}r.windowToggle=o;var a=function(){function e(e,t){this.openings=e;this.closingSelector=t}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.openings,this.closingSelector))};return e}();var s=function(o){n(e,o);function e(e,t,r){var n=o.call(this,e)||this;n.openings=t;n.closingSelector=r;n.contexts=[];n.add(n.openSubscription=v.subscribeToResult(n,t,t));return n}e.prototype._next=function(e){var t=this.contexts;if(t){var r=t.length;for(var n=0;n<r;n++){t[n].window.next(e)}}};e.prototype._error=function(e){var t=this.contexts;this.contexts=null;if(t){var r=t.length;var n=-1;while(++n<r){var i=t[n];i.window.error(e);i.subscription.unsubscribe()}}o.prototype._error.call(this,e)};e.prototype._complete=function(){var e=this.contexts;this.contexts=null;if(e){var t=e.length;var r=-1;while(++r<t){var n=e[r];n.window.complete();n.subscription.unsubscribe()}}o.prototype._complete.call(this)};e.prototype._unsubscribe=function(){var e=this.contexts;this.contexts=null;if(e){var t=e.length;var r=-1;while(++r<t){var n=e[r];n.window.unsubscribe();n.subscription.unsubscribe()}}};e.prototype.notifyNext=function(e,t,r,n,i){if(e===this.openings){var o=this.closingSelector;var a=f.tryCatch(o)(t);if(a===d.errorObject){return this.error(d.errorObject.e)}else{var s=new l.Subject;var u=new p.Subscription;var c={window:s,subscription:u};this.contexts.push(c);var h=v.subscribeToResult(this,a,c);if(h.closed){this.closeWindow(this.contexts.length-1)}else{h.context=c;u.add(h)}this.destination.next(s)}}else{this.closeWindow(this.contexts.indexOf(e))}};e.prototype.notifyError=function(e){this.error(e)};e.prototype.notifyComplete=function(e){if(e!==this.openSubscription){this.closeWindow(this.contexts.indexOf(e.context))}};e.prototype.closeWindow=function(e){if(e===-1){return}var t=this.contexts;var r=t[e];var n=r.window,i=r.subscription;t.splice(e,1);n.complete();i.unsubscribe()};return e}(i.OuterSubscriber)},{"../OuterSubscriber":50,"../Subject":53,"../Subscription":56,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],188:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("../Subject");var a=e("../util/tryCatch");var s=e("../util/errorObject");var n=e("../OuterSubscriber");var u=e("../util/subscribeToResult");function c(r){return function e(t){return t.lift(new h(r))}}r.windowWhen=c;var h=function(){function e(e){this.closingSelector=e}e.prototype.call=function(e,t){return t.subscribe(new l(e,this.closingSelector))};return e}();var l=function(n){i(e,n);function e(e,t){var r=n.call(this,e)||this;r.destination=e;r.closingSelector=t;r.openWindow();return r}e.prototype.notifyNext=function(e,t,r,n,i){this.openWindow(i)};e.prototype.notifyError=function(e,t){this._error(e)};e.prototype.notifyComplete=function(e){this.openWindow(e)};e.prototype._next=function(e){this.window.next(e)};e.prototype._error=function(e){this.window.error(e);this.destination.error(e);this.unsubscribeClosingNotification()};e.prototype._complete=function(){this.window.complete();this.destination.complete();this.unsubscribeClosingNotification()};e.prototype.unsubscribeClosingNotification=function(){if(this.closingNotification){this.closingNotification.unsubscribe()}};e.prototype.openWindow=function(e){if(e===void 0){e=null}if(e){this.remove(e);e.unsubscribe()}var t=this.window;if(t){t.complete()}var r=this.window=new o.Subject;this.destination.next(r);var n=a.tryCatch(this.closingSelector)();if(n===s.errorObject){var i=s.errorObject.e;this.destination.error(i);this.window.error(i)}else{this.add(this.closingNotification=u.subscribeToResult(this,n))}};return e}(n.OuterSubscriber)},{"../OuterSubscriber":50,"../Subject":53,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],189:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../OuterSubscriber");var u=e("../util/subscribeToResult");function o(){var n=[];for(var e=0;e<arguments.length;e++){n[e]=arguments[e]}return function(e){var t;if(typeof n[n.length-1]==="function"){t=n.pop()}var r=n;return e.lift(new a(r,t))}}r.withLatestFrom=o;var a=function(){function e(e,t){this.observables=e;this.project=t}e.prototype.call=function(e,t){return t.subscribe(new s(e,this.observables,this.project))};return e}();var s=function(s){n(e,s);function e(e,t,r){var n=s.call(this,e)||this;n.observables=t;n.project=r;n.toRespond=[];var i=t.length;n.values=new Array(i);for(var o=0;o<i;o++){n.toRespond.push(o)}for(var o=0;o<i;o++){var a=t[o];n.add(u.subscribeToResult(n,a,a,o))}return n}e.prototype.notifyNext=function(e,t,r,n,i){this.values[r]=t;var o=this.toRespond;if(o.length>0){var a=o.indexOf(r);if(a!==-1){o.splice(a,1)}}};e.prototype.notifyComplete=function(){};e.prototype._next=function(e){if(this.toRespond.length===0){var t=[e].concat(this.values);if(this.project){this._tryProject(t)}else{this.destination.next(t)}}};e.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(e){this.destination.error(e);return}this.destination.next(t)};return e}(i.OuterSubscriber)},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],190:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../observable/zip");function i(){var r=[];for(var e=0;e<arguments.length;e++){r[e]=arguments[e]}return function e(t){return t.lift.call(n.zip.apply(void 0,[t].concat(r)))}}r.zip=i},{"../observable/zip":88}],191:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../observable/zip");function i(t){return function(e){return e.lift(new n.ZipOperator(t))}}r.zipAll=i},{"../observable/zip":88}],192:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../Subscription");var o=function(r){n(e,r);function e(e,t){return r.call(this)||this}e.prototype.schedule=function(e,t){if(t===void 0){t=0}return this};return e}(i.Subscription);r.Action=o},{"../Subscription":56}],193:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("./AsyncAction");var o=function(n){i(e,n);function e(e,t){var r=n.call(this,e,t)||this;r.scheduler=e;r.work=t;return r}e.prototype.requestAsyncId=function(e,t,r){if(r===void 0){r=0}if(r!==null&&r>0){return n.prototype.requestAsyncId.call(this,e,t,r)}e.actions.push(this);return e.scheduled||(e.scheduled=requestAnimationFrame(function(){return e.flush(null)}))};e.prototype.recycleAsyncId=function(e,t,r){if(r===void 0){r=0}if(r!==null&&r>0||r===null&&this.delay>0){return n.prototype.recycleAsyncId.call(this,e,t,r)}if(e.actions.length===0){cancelAnimationFrame(t);e.scheduled=undefined}return undefined};return e}(n.AsyncAction);r.AnimationFrameAction=o},{"./AsyncAction":197}],194:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("./AsyncScheduler");var o=function(e){n(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.flush=function(e){this.active=true;this.scheduled=undefined;var t=this.actions;var r;var n=-1;var i=t.length;e=e||t.shift();do{if(r=e.execute(e.state,e.delay)){break}}while(++n<i&&(e=t.shift()));this.active=false;if(r){while(++n<i&&(e=t.shift())){e.unsubscribe()}throw r}};return t}(i.AsyncScheduler);r.AnimationFrameScheduler=o},{"./AsyncScheduler":198}],195:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("../util/Immediate");var n=e("./AsyncAction");var a=function(n){i(e,n);function e(e,t){var r=n.call(this,e,t)||this;r.scheduler=e;r.work=t;return r}e.prototype.requestAsyncId=function(e,t,r){if(r===void 0){r=0}if(r!==null&&r>0){return n.prototype.requestAsyncId.call(this,e,t,r)}e.actions.push(this);return e.scheduled||(e.scheduled=o.Immediate.setImmediate(e.flush.bind(e,null)))};e.prototype.recycleAsyncId=function(e,t,r){if(r===void 0){r=0}if(r!==null&&r>0||r===null&&this.delay>0){return n.prototype.recycleAsyncId.call(this,e,t,r)}if(e.actions.length===0){o.Immediate.clearImmediate(t);e.scheduled=undefined}return undefined};return e}(n.AsyncAction);r.AsapAction=a},{"../util/Immediate":211,"./AsyncAction":197}],196:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("./AsyncScheduler");var o=function(e){n(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.flush=function(e){this.active=true;this.scheduled=undefined;var t=this.actions;var r;var n=-1;var i=t.length;e=e||t.shift();do{if(r=e.execute(e.state,e.delay)){break}}while(++n<i&&(e=t.shift()));this.active=false;if(r){while(++n<i&&(e=t.shift())){e.unsubscribe()}throw r}};return t}(i.AsyncScheduler);r.AsapScheduler=o},{"./AsyncScheduler":198}],197:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("./Action");var o=function(n){i(e,n);function e(e,t){var r=n.call(this,e,t)||this;r.scheduler=e;r.work=t;r.pending=false;return r}e.prototype.schedule=function(e,t){if(t===void 0){t=0}if(this.closed){return this}this.state=e;var r=this.id;var n=this.scheduler;if(r!=null){this.id=this.recycleAsyncId(n,r,t)}this.pending=true;this.delay=t;this.id=this.id||this.requestAsyncId(n,this.id,t);return this};e.prototype.requestAsyncId=function(e,t,r){if(r===void 0){r=0}return setInterval(e.flush.bind(e,this),r)};e.prototype.recycleAsyncId=function(e,t,r){if(r===void 0){r=0}if(r!==null&&this.delay===r&&this.pending===false){return t}clearInterval(t)};e.prototype.execute=function(e,t){if(this.closed){return new Error("executing a cancelled action")}this.pending=false;var r=this._execute(e,t);if(r){return r}else if(this.pending===false&&this.id!=null){this.id=this.recycleAsyncId(this.scheduler,this.id,null)}};e.prototype._execute=function(e,t){var r=false;var n=undefined;try{this.work(e)}catch(e){r=true;n=!!e&&e||new Error(e)}if(r){this.unsubscribe();return n}};e.prototype._unsubscribe=function(){var e=this.id;var t=this.scheduler;var r=t.actions;var n=r.indexOf(this);this.work=null;this.state=null;this.pending=false;this.scheduler=null;if(n!==-1){r.splice(n,1)}if(e!=null){this.id=this.recycleAsyncId(t,e,null)}this.delay=null};return e}(n.Action);r.AsyncAction=o},{"./Action":192}],198:[function(e,t,r){"use strict";var o=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var a=e("../Scheduler");var n=function(n){o(i,n);function i(e,t){if(t===void 0){t=a.Scheduler.now}var r=n.call(this,e,function(){if(i.delegate&&i.delegate!==r){return i.delegate.now()}else{return t()}})||this;r.actions=[];r.active=false;r.scheduled=undefined;return r}i.prototype.schedule=function(e,t,r){if(t===void 0){t=0}if(i.delegate&&i.delegate!==this){return i.delegate.schedule(e,t,r)}else{return n.prototype.schedule.call(this,e,t,r)}};i.prototype.flush=function(e){var t=this.actions;if(this.active){t.push(e);return}var r;this.active=true;do{if(r=e.execute(e.state,e.delay)){break}}while(e=t.shift());this.active=false;if(r){while(e=t.shift()){e.unsubscribe()}throw r}};return i}(a.Scheduler);r.AsyncScheduler=n},{"../Scheduler":52}],199:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("./AsyncAction");var o=function(n){i(e,n);function e(e,t){var r=n.call(this,e,t)||this;r.scheduler=e;r.work=t;return r}e.prototype.schedule=function(e,t){if(t===void 0){t=0}if(t>0){return n.prototype.schedule.call(this,e,t)}this.delay=t;this.state=e;this.scheduler.flush(this);return this};e.prototype.execute=function(e,t){return t>0||this.closed?n.prototype.execute.call(this,e,t):this._execute(e,t)};e.prototype.requestAsyncId=function(e,t,r){if(r===void 0){r=0}if(r!==null&&r>0||r===null&&this.delay>0){return n.prototype.requestAsyncId.call(this,e,t,r)}return e.flush(this)};return e}(n.AsyncAction);r.QueueAction=o},{"./AsyncAction":197}],200:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("./AsyncScheduler");var o=function(e){n(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(i.AsyncScheduler);r.QueueScheduler=o},{"./AsyncScheduler":198}],201:[function(e,t,r){"use strict";var a=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("./AsyncAction");var i=e("./AsyncScheduler");var o=function(n){a(e,n);function e(e,t){if(e===void 0){e=s}if(t===void 0){t=Number.POSITIVE_INFINITY}var r=n.call(this,e,function(){return r.frame})||this;r.maxFrames=t;r.frame=0;r.index=-1;return r}e.prototype.flush=function(){var e=this,t=e.actions,r=e.maxFrames;var n,i;while((i=t.shift())&&(this.frame=i.delay)<=r){if(n=i.execute(i.state,i.delay)){break}}if(n){while(i=t.shift()){i.unsubscribe()}throw n}};e.frameTimeFactor=10;return e}(i.AsyncScheduler);r.VirtualTimeScheduler=o;var s=function(i){a(o,i);function o(e,t,r){if(r===void 0){r=e.index+=1}var n=i.call(this,e,t)||this;n.scheduler=e;n.work=t;n.index=r;n.active=true;n.index=e.index=r;return n}o.prototype.schedule=function(e,t){if(t===void 0){t=0}if(!this.id){return i.prototype.schedule.call(this,e,t)}this.active=false;var r=new o(this.scheduler,this.work);this.add(r);return r.schedule(e,t)};o.prototype.requestAsyncId=function(e,t,r){if(r===void 0){r=0}this.delay=e.frame+r;var n=e.actions;n.push(this);n.sort(o.sortActions);return true};o.prototype.recycleAsyncId=function(e,t,r){if(r===void 0){r=0}return undefined};o.prototype._execute=function(e,t){if(this.active===true){return i.prototype._execute.call(this,e,t)}};o.sortActions=function(e,t){if(e.delay===t.delay){if(e.index===t.index){return 0}else if(e.index>t.index){return 1}else{return-1}}else if(e.delay>t.delay){return 1}else{return-1}};return o}(n.AsyncAction);r.VirtualAction=s},{"./AsyncAction":197,"./AsyncScheduler":198}],202:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./AnimationFrameAction");var i=e("./AnimationFrameScheduler");r.animationFrame=new i.AnimationFrameScheduler(n.AnimationFrameAction)},{"./AnimationFrameAction":193,"./AnimationFrameScheduler":194}],203:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./AsapAction");var i=e("./AsapScheduler");r.asap=new i.AsapScheduler(n.AsapAction)},{"./AsapAction":195,"./AsapScheduler":196}],204:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./AsyncAction");var i=e("./AsyncScheduler");r.async=new i.AsyncScheduler(n.AsyncAction)},{"./AsyncAction":197,"./AsyncScheduler":198}],205:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./QueueAction");var i=e("./QueueScheduler");r.queue=new i.QueueScheduler(n.QueueAction)},{"./QueueAction":199,"./QueueScheduler":200}],206:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(){if(typeof Symbol!=="function"||!Symbol.iterator){return"@@iterator"}return Symbol.iterator}r.getSymbolIterator=n;r.iterator=n();r.$$iterator=r.iterator},{}],207:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.observable=typeof Symbol==="function"&&Symbol.observable||"@@observable"},{}],208:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.rxSubscriber=typeof Symbol==="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();r.$$rxSubscriber=r.rxSubscriber},{}],209:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(){Error.call(this);this.message="argument out of range";this.name="ArgumentOutOfRangeError";return this}n.prototype=Object.create(Error.prototype);r.ArgumentOutOfRangeError=n},{}],210:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(){Error.call(this);this.message="no elements in sequence";this.name="EmptyError";return this}n.prototype=Object.create(Error.prototype);r.EmptyError=n},{}],211:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=1;var i={};function o(e){var t=i[e];if(t){t()}}r.Immediate={setImmediate:function(e){var t=n++;i[t]=e;Promise.resolve().then(function(){return o(t)});return t},clearImmediate:function(e){delete i[e]}}},{}],212:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(){Error.call(this);this.message="object unsubscribed";this.name="ObjectUnsubscribedError";return this}n.prototype=Object.create(Error.prototype);r.ObjectUnsubscribedError=n},{}],213:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(){Error.call(this);this.message="Timeout has occurred";this.name="TimeoutError";return this}n.prototype=Object.create(Error.prototype);r.TimeoutError=n},{}],214:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(e){Error.call(this);this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"";this.name="UnsubscriptionError";this.errors=e;return this}n.prototype=Object.create(Error.prototype);r.UnsubscriptionError=n},{}],215:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=e("../Subscriber");function n(e){while(e){var t=e,r=t.closed,n=t.destination,i=t.isStopped;if(r||i){return false}else if(n&&n instanceof o.Subscriber){e=n}else{e=null}}return true}r.canReportError=n},{"../Subscriber":55}],216:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.errorObject={e:{}}},{}],217:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(e){setTimeout(function(){throw e})}r.hostReportError=n},{}],218:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(e){return e}r.identity=n},{}],219:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.isArray=Array.isArray||function(e){return e&&typeof e.length==="number"}},{}],220:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.isArrayLike=function(e){return e&&typeof e.length==="number"&&typeof e!=="function"}},{}],221:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(e){return e instanceof Date&&!isNaN(+e)}r.isDate=n},{}],222:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(e){return typeof e==="function"}r.isFunction=n},{}],223:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../symbol/observable");function i(e){return e&&typeof e[n.observable]==="function"}r.isInteropObservable=i},{"../symbol/observable":207}],224:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../symbol/iterator");function i(e){return e&&typeof e[n.iterator]==="function"}r.isIterable=i},{"../symbol/iterator":206}],225:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./isArray");function i(e){return!n.isArray(e)&&e-parseFloat(e)+1>=0}r.isNumeric=i},{"./isArray":219}],226:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(e){return e!=null&&typeof e==="object"}r.isObject=n},{}],227:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Observable");function i(e){return!!e&&(e instanceof n.Observable||typeof e.lift==="function"&&typeof e.subscribe==="function")}r.isObservable=i},{"../Observable":48}],228:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(e){return e&&typeof e.subscribe!=="function"&&typeof e.then==="function"}r.isPromise=n},{}],229:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(e){return e&&typeof e.schedule==="function"}r.isScheduler=n},{}],230:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(){}r.noop=n},{}],231:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(e,t){function r(){return!r.pred.apply(r.thisArg,arguments)}r.pred=e;r.thisArg=t;return r}r.not=n},{}],232:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./noop");function i(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return o(e)}r.pipe=i;function o(r){if(!r){return n.noop}if(r.length===1){return r[0]}return function e(t){return r.reduce(function(e,t){return t(e)},t)}}r.pipeFromArray=o},{"./noop":230}],233:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Observable");var i=e("./subscribeToArray");var o=e("./subscribeToPromise");var a=e("./subscribeToIterable");var s=e("./subscribeToObservable");var u=e("./isArrayLike");var c=e("./isPromise");var h=e("./isObject");var l=e("../symbol/iterator");var p=e("../symbol/observable");r.subscribeTo=function(t){if(t instanceof n.Observable){return function(e){if(t._isScalar){e.next(t.value);e.complete();return undefined}else{return t.subscribe(e)}}}else if(t&&typeof t[p.observable]==="function"){return s.subscribeToObservable(t)}else if(u.isArrayLike(t)){return i.subscribeToArray(t)}else if(c.isPromise(t)){return o.subscribeToPromise(t)}else if(t&&typeof t[l.iterator]==="function"){return a.subscribeToIterable(t)}else{var e=h.isObject(t)?"an invalid object":"'"+t+"'";var r="You provided "+e+" where a stream was expected."+" You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(r)}}},{"../Observable":48,"../symbol/iterator":206,"../symbol/observable":207,"./isArrayLike":220,"./isObject":226,"./isPromise":228,"./subscribeToArray":234,"./subscribeToIterable":235,"./subscribeToObservable":236,"./subscribeToPromise":237}],234:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.subscribeToArray=function(n){return function(e){for(var t=0,r=n.length;t<r&&!e.closed;t++){e.next(n[t])}if(!e.closed){e.complete()}}}},{}],235:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("../symbol/iterator");r.subscribeToIterable=function(n){return function(e){var t=n[i.iterator]();do{var r=t.next();if(r.done){e.complete();break}e.next(r.value);if(e.closed){break}}while(true);if(typeof t.return==="function"){e.add(function(){if(t.return){t.return()}})}return e}}},{"../symbol/iterator":206}],236:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../symbol/observable");r.subscribeToObservable=function(r){return function(e){var t=r[n.observable]();if(typeof t.subscribe!=="function"){throw new TypeError("Provided object does not correctly implement Symbol.observable")}else{return t.subscribe(e)}}}},{"../symbol/observable":207}],237:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./hostReportError");r.subscribeToPromise=function(e){return function(t){e.then(function(e){if(!t.closed){t.next(e);t.complete()}},function(e){return t.error(e)}).then(null,n.hostReportError);return t}}},{"./hostReportError":217}],238:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=e("../InnerSubscriber");var a=e("./subscribeTo");function n(e,t,r,n,i){if(i===void 0){i=new o.InnerSubscriber(e,r,n)}if(i.closed){return}return a.subscribeTo(t)(i)}r.subscribeToResult=n},{"../InnerSubscriber":46,"./subscribeTo":233}],239:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Subscriber");var i=e("../symbol/rxSubscriber");var o=e("../Observer");function a(e,t,r){if(e){if(e instanceof n.Subscriber){return e}if(e[i.rxSubscriber]){return e[i.rxSubscriber]()}}if(!e&&!t&&!r){return new n.Subscriber(o.empty)}return new n.Subscriber(e,t,r)}r.toSubscriber=a},{"../Observer":49,"../Subscriber":55,"../symbol/rxSubscriber":208}],240:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./errorObject");var i;function o(){try{return i.apply(this,arguments)}catch(e){n.errorObject.e=e;return n.errorObject}}function a(e){i=e;return o}r.tryCatch=a},{"./errorObject":216}],241:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../internal/operators/audit");r.audit=n.audit;var i=e("../internal/operators/auditTime");r.auditTime=i.auditTime;var o=e("../internal/operators/buffer");r.buffer=o.buffer;var a=e("../internal/operators/bufferCount");r.bufferCount=a.bufferCount;var s=e("../internal/operators/bufferTime");r.bufferTime=s.bufferTime;var u=e("../internal/operators/bufferToggle");r.bufferToggle=u.bufferToggle;var c=e("../internal/operators/bufferWhen");r.bufferWhen=c.bufferWhen;var h=e("../internal/operators/catchError");r.catchError=h.catchError;var l=e("../internal/operators/combineAll");r.combineAll=l.combineAll;var p=e("../internal/operators/combineLatest");r.combineLatest=p.combineLatest;var f=e("../internal/operators/concat");r.concat=f.concat;var d=e("../internal/operators/concatAll");r.concatAll=d.concatAll;var v=e("../internal/operators/concatMap");r.concatMap=v.concatMap;var m=e("../internal/operators/concatMapTo");r.concatMapTo=m.concatMapTo;var g=e("../internal/operators/count");r.count=g.count;var _=e("../internal/operators/debounce");r.debounce=_.debounce;var y=e("../internal/operators/debounceTime");r.debounceTime=y.debounceTime;var b=e("../internal/operators/defaultIfEmpty");r.defaultIfEmpty=b.defaultIfEmpty;var w=e("../internal/operators/delay");r.delay=w.delay;var x=e("../internal/operators/delayWhen");r.delayWhen=x.delayWhen;var S=e("../internal/operators/dematerialize");r.dematerialize=S.dematerialize;var M=e("../internal/operators/distinct");r.distinct=M.distinct;var C=e("../internal/operators/distinctUntilChanged");r.distinctUntilChanged=C.distinctUntilChanged;var E=e("../internal/operators/distinctUntilKeyChanged");r.distinctUntilKeyChanged=E.distinctUntilKeyChanged;var T=e("../internal/operators/elementAt");r.elementAt=T.elementAt;var O=e("../internal/operators/endWith");r.endWith=O.endWith;var P=e("../internal/operators/every");r.every=P.every;var A=e("../internal/operators/exhaust");r.exhaust=A.exhaust;var j=e("../internal/operators/exhaustMap");r.exhaustMap=j.exhaustMap;var R=e("../internal/operators/expand");r.expand=R.expand;var k=e("../internal/operators/filter");r.filter=k.filter;var L=e("../internal/operators/finalize");r.finalize=L.finalize;var I=e("../internal/operators/find");r.find=I.find;var N=e("../internal/operators/findIndex");r.findIndex=N.findIndex;var D=e("../internal/operators/first");r.first=D.first;var B=e("../internal/operators/groupBy");r.groupBy=B.groupBy;var F=e("../internal/operators/ignoreElements");r.ignoreElements=F.ignoreElements;var z=e("../internal/operators/isEmpty");r.isEmpty=z.isEmpty;var $=e("../internal/operators/last");r.last=$.last;var U=e("../internal/operators/map");r.map=U.map;var G=e("../internal/operators/mapTo");r.mapTo=G.mapTo;var V=e("../internal/operators/materialize");r.materialize=V.materialize;var H=e("../internal/operators/max");r.max=H.max;var q=e("../internal/operators/merge");r.merge=q.merge;var W=e("../internal/operators/mergeAll");r.mergeAll=W.mergeAll;var X=e("../internal/operators/mergeMap");r.mergeMap=X.mergeMap;var Y=e("../internal/operators/mergeMap");r.flatMap=Y.mergeMap;var K=e("../internal/operators/mergeMapTo");r.mergeMapTo=K.mergeMapTo;var Z=e("../internal/operators/mergeScan");r.mergeScan=Z.mergeScan;var J=e("../internal/operators/min");r.min=J.min;var Q=e("../internal/operators/multicast");r.multicast=Q.multicast;var ee=e("../internal/operators/observeOn");r.observeOn=ee.observeOn;var te=e("../internal/operators/onErrorResumeNext");r.onErrorResumeNext=te.onErrorResumeNext;var re=e("../internal/operators/pairwise");r.pairwise=re.pairwise;var ne=e("../internal/operators/partition");r.partition=ne.partition;var ie=e("../internal/operators/pluck");r.pluck=ie.pluck;var oe=e("../internal/operators/publish");r.publish=oe.publish;var ae=e("../internal/operators/publishBehavior");r.publishBehavior=ae.publishBehavior;var se=e("../internal/operators/publishLast");r.publishLast=se.publishLast;var ue=e("../internal/operators/publishReplay");r.publishReplay=ue.publishReplay;var ce=e("../internal/operators/race");r.race=ce.race;var he=e("../internal/operators/reduce");r.reduce=he.reduce;var le=e("../internal/operators/repeat");r.repeat=le.repeat;var pe=e("../internal/operators/repeatWhen");r.repeatWhen=pe.repeatWhen;var fe=e("../internal/operators/retry");r.retry=fe.retry;var de=e("../internal/operators/retryWhen");r.retryWhen=de.retryWhen;var ve=e("../internal/operators/refCount");r.refCount=ve.refCount;var me=e("../internal/operators/sample");r.sample=me.sample;var ge=e("../internal/operators/sampleTime");r.sampleTime=ge.sampleTime;var _e=e("../internal/operators/scan");r.scan=_e.scan;var ye=e("../internal/operators/sequenceEqual");r.sequenceEqual=ye.sequenceEqual;var be=e("../internal/operators/share");r.share=be.share;var we=e("../internal/operators/shareReplay");r.shareReplay=we.shareReplay;var xe=e("../internal/operators/single");r.single=xe.single;var Se=e("../internal/operators/skip");r.skip=Se.skip;var Me=e("../internal/operators/skipLast");r.skipLast=Me.skipLast;var Ce=e("../internal/operators/skipUntil");r.skipUntil=Ce.skipUntil;var Ee=e("../internal/operators/skipWhile");r.skipWhile=Ee.skipWhile;var Te=e("../internal/operators/startWith");r.startWith=Te.startWith;var Oe=e("../internal/operators/subscribeOn");r.subscribeOn=Oe.subscribeOn;var Pe=e("../internal/operators/switchAll");r.switchAll=Pe.switchAll;var Ae=e("../internal/operators/switchMap");r.switchMap=Ae.switchMap;var je=e("../internal/operators/switchMapTo");r.switchMapTo=je.switchMapTo;var Re=e("../internal/operators/take");r.take=Re.take;var ke=e("../internal/operators/takeLast");r.takeLast=ke.takeLast;var Le=e("../internal/operators/takeUntil");r.takeUntil=Le.takeUntil;var Ie=e("../internal/operators/takeWhile");r.takeWhile=Ie.takeWhile;var Ne=e("../internal/operators/tap");r.tap=Ne.tap;var De=e("../internal/operators/throttle");r.throttle=De.throttle;var Be=e("../internal/operators/throttleTime");r.throttleTime=Be.throttleTime;var Fe=e("../internal/operators/throwIfEmpty");r.throwIfEmpty=Fe.throwIfEmpty;var ze=e("../internal/operators/timeInterval");r.timeInterval=ze.timeInterval;var $e=e("../internal/operators/timeout");r.timeout=$e.timeout;var Ue=e("../internal/operators/timeoutWith");r.timeoutWith=Ue.timeoutWith;var Ge=e("../internal/operators/timestamp");r.timestamp=Ge.timestamp;var Ve=e("../internal/operators/toArray");r.toArray=Ve.toArray;var He=e("../internal/operators/window");r.window=He.window;var qe=e("../internal/operators/windowCount");r.windowCount=qe.windowCount;var We=e("../internal/operators/windowTime");r.windowTime=We.windowTime;var Xe=e("../internal/operators/windowToggle");r.windowToggle=Xe.windowToggle;var Ye=e("../internal/operators/windowWhen");r.windowWhen=Ye.windowWhen;var Ke=e("../internal/operators/withLatestFrom");r.withLatestFrom=Ke.withLatestFrom;var Ze=e("../internal/operators/zip");r.zip=Ze.zip;var Je=e("../internal/operators/zipAll");r.zipAll=Je.zipAll},{"../internal/operators/audit":89,"../internal/operators/auditTime":90,"../internal/operators/buffer":91,"../internal/operators/bufferCount":92,"../internal/operators/bufferTime":93,"../internal/operators/bufferToggle":94,"../internal/operators/bufferWhen":95,"../internal/operators/catchError":96,"../internal/operators/combineAll":97,"../internal/operators/combineLatest":98,"../internal/operators/concat":99,"../internal/operators/concatAll":100,"../internal/operators/concatMap":101,"../internal/operators/concatMapTo":102,"../internal/operators/count":103,"../internal/operators/debounce":104,"../internal/operators/debounceTime":105,"../internal/operators/defaultIfEmpty":106,"../internal/operators/delay":107,"../internal/operators/delayWhen":108,"../internal/operators/dematerialize":109,"../internal/operators/distinct":110,"../internal/operators/distinctUntilChanged":111,"../internal/operators/distinctUntilKeyChanged":112,"../internal/operators/elementAt":113,"../internal/operators/endWith":114,"../internal/operators/every":115,"../internal/operators/exhaust":116,"../internal/operators/exhaustMap":117,"../internal/operators/expand":118,"../internal/operators/filter":119,"../internal/operators/finalize":120,"../internal/operators/find":121,"../internal/operators/findIndex":122,"../internal/operators/first":123,"../internal/operators/groupBy":124,"../internal/operators/ignoreElements":125,"../internal/operators/isEmpty":126,"../internal/operators/last":127,"../internal/operators/map":128,"../internal/operators/mapTo":129,"../internal/operators/materialize":130,"../internal/operators/max":131,"../internal/operators/merge":132,"../internal/operators/mergeAll":133,"../internal/operators/mergeMap":134,"../internal/operators/mergeMapTo":135,"../internal/operators/mergeScan":136,"../internal/operators/min":137,"../internal/operators/multicast":138,"../internal/operators/observeOn":139,"../internal/operators/onErrorResumeNext":140,"../internal/operators/pairwise":141,"../internal/operators/partition":142,"../internal/operators/pluck":143,"../internal/operators/publish":144,"../internal/operators/publishBehavior":145,"../internal/operators/publishLast":146,"../internal/operators/publishReplay":147,"../internal/operators/race":148,"../internal/operators/reduce":149,"../internal/operators/refCount":150,"../internal/operators/repeat":151,"../internal/operators/repeatWhen":152,"../internal/operators/retry":153,"../internal/operators/retryWhen":154,"../internal/operators/sample":155,"../internal/operators/sampleTime":156,"../internal/operators/scan":157,"../internal/operators/sequenceEqual":158,"../internal/operators/share":159,"../internal/operators/shareReplay":160,"../internal/operators/single":161,"../internal/operators/skip":162,"../internal/operators/skipLast":163,"../internal/operators/skipUntil":164,"../internal/operators/skipWhile":165,"../internal/operators/startWith":166,"../internal/operators/subscribeOn":167,"../internal/operators/switchAll":168,"../internal/operators/switchMap":169,"../internal/operators/switchMapTo":170,"../internal/operators/take":171,"../internal/operators/takeLast":172,"../internal/operators/takeUntil":173,"../internal/operators/takeWhile":174,"../internal/operators/tap":175,"../internal/operators/throttle":176,"../internal/operators/throttleTime":177,"../internal/operators/throwIfEmpty":178,"../internal/operators/timeInterval":179,"../internal/operators/timeout":180,"../internal/operators/timeoutWith":181,"../internal/operators/timestamp":182,"../internal/operators/toArray":183,"../internal/operators/window":184,"../internal/operators/windowCount":185,"../internal/operators/windowTime":186,"../internal/operators/windowToggle":187,"../internal/operators/windowWhen":188,"../internal/operators/withLatestFrom":189,"../internal/operators/zip":190,"../internal/operators/zipAll":191}],242:[function(e,r,n){(function(e,t){"object"===typeof n&&"undefined"!==typeof r?t(n):"function"===typeof o&&o.amd?o(["exports"],t):t(e.THREE={})})(this,function(e){function t(){}function H(e,t){this.x=e||0;this.y=t||0}function we(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function s(e,t,r,n){this._x=e||0;this._y=t||0;this._z=r||0;this._w=void 0!==n?n:1}function xe(e,t,r){this.x=e||0;this.y=t||0;this.z=r||0}function m(){this.elements=[1,0,0,0,1,0,0,0,1];0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function p(e,t,r,n,i,o,a,s,u,c){Object.defineProperty(this,"id",{value:ro++});this.uuid=eo.generateUUID();this.name="";this.image=void 0!==e?e:p.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==t?t:p.DEFAULT_MAPPING;this.wrapS=void 0!==r?r:1001;this.wrapT=void 0!==n?n:1001;this.magFilter=void 0!==i?i:1006;this.minFilter=void 0!==o?o:1008;this.anisotropy=void 0!==u?u:1;this.format=void 0!==a?a:1023;this.type=void 0!==s?s:1009;this.offset=new H(0,0);this.repeat=new H(1,1);this.center=new H(0,0);this.rotation=0;this.matrixAutoUpdate=!0;this.matrix=new m;this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==c?c:3e3;this.version=0;this.onUpdate=null}function Se(e,t,r,n){this.x=e||0;this.y=t||0;this.z=r||0;this.w=void 0!==n?n:1}function T(e,t,r){this.width=e;this.height=t;this.scissor=new Se(0,0,e,t);this.scissorTest=!1;this.viewport=new Se(0,0,e,t);r=r||{};void 0===r.minFilter&&(r.minFilter=1006);this.texture=new p(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding);this.texture.generateMipmaps=void 0!==r.generateMipmaps?r.generateMipmaps:!0;this.depthBuffer=void 0!==r.depthBuffer?r.depthBuffer:!0;this.stencilBuffer=void 0!==r.stencilBuffer?r.stencilBuffer:!0;this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function n(e,t,r){T.call(this,e,t,r);this.activeMipMapLevel=this.activeCubeFace=0}function Me(e,t,r,n,i,o,a,s,u,c,h,l){p.call(this,null,o,a,s,u,c,n,i,h,l);this.image={data:e,width:t,height:r};this.magFilter=void 0!==u?u:1003;this.minFilter=void 0!==c?c:1003;this.flipY=this.generateMipmaps=!1;this.unpackAlignment=1}function r(e,t){this.min=void 0!==e?e:new xe(Infinity,Infinity,Infinity);this.max=void 0!==t?t:new xe(-Infinity,-Infinity,-Infinity)}function c(e,t){this.center=void 0!==e?e:new xe;this.radius=void 0!==t?t:0}function g(e,t){this.normal=void 0!==e?e:new xe(1,0,0);this.constant=void 0!==t?t:0}function Ce(e,t,r,n,i,o){this.planes=[void 0!==e?e:new g,void 0!==t?t:new g,void 0!==r?r:new g,void 0!==n?n:new g,void 0!==i?i:new g,void 0!==o?o:new g]}function x(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}function Ee(){function r(e,t){!1!==i&&(o(e,t),n.requestAnimationFrame(r))}var n=null,i=!1,o=null;return{start:function(){!0!==i&&null!==o&&(n.requestAnimationFrame(r),i=!0)},stop:function(){i=!1},setAnimationLoop:function(e){o=e},setContext:function(e){n=e}}}function Te(a){function s(e,t){var r=e.array,n=e.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW,i=a.createBuffer();a.bindBuffer(t,i);a.bufferData(t,r,n);e.onUploadCallback();t=a.FLOAT;r instanceof Float32Array?t=a.FLOAT:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?t=a.UNSIGNED_SHORT:r instanceof Int16Array?t=a.SHORT:r instanceof Uint32Array?t=a.UNSIGNED_INT:r instanceof Int32Array?t=a.INT:r instanceof Int8Array?t=a.BYTE:r instanceof Uint8Array&&(t=a.UNSIGNED_BYTE);return{buffer:i,type:t,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}var u=new WeakMap;return{get:function(e){e.isInterleavedBufferAttribute&&(e=e.data);return u.get(e)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var t=u.get(e);t&&(a.deleteBuffer(t.buffer),u.delete(e))},update:function(e,t){e.isInterleavedBufferAttribute&&(e=e.data);var r=u.get(e);if(void 0===r)u.set(e,s(e,t));else if(r.version<e.version){var n=e,i=n.array,o=n.updateRange;a.bindBuffer(t,r.buffer);!1===n.dynamic?a.bufferData(t,i,a.STATIC_DRAW):-1===o.count?a.bufferSubData(t,0,i):0===o.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(a.bufferSubData(t,o.offset*i.BYTES_PER_ELEMENT,i.subarray(o.offset,o.offset+o.count)),o.count=-1);r.version=e.version}}}}function i(e,t,r,n){this._x=e||0;this._y=t||0;this._z=r||0;this._order=n||i.DefaultOrder}function o(){this.mask=1}function h(){Object.defineProperty(this,"id",{value:uo++});this.uuid=eo.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=h.DefaultUp.clone();var e=new xe,t=new i,r=new s,n=new xe(1,1,1);t.onChange(function(){r.setFromEuler(t,!1)});r.onChange(function(){t.setFromQuaternion(r,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new we},normalMatrix:{value:new m}});this.matrix=new we;this.matrixWorld=new we;this.matrixAutoUpdate=h.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new o;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={}}function u(){h.call(this);this.type="Camera";this.matrixWorldInverse=new we;this.projectionMatrix=new we}function f(e,t,r,n,i,o){u.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=e;this.right=t;this.top=r;this.bottom=n;this.near=void 0!==i?i:.1;this.far=void 0!==o?o:2e3;this.updateProjectionMatrix()}function D(e,t,r,n,i,o){this.a=e;this.b=t;this.c=r;this.normal=n&&n.isVector3?n:new xe;this.vertexNormals=Array.isArray(n)?n:[];this.color=i&&i.isColor?i:new x;this.vertexColors=Array.isArray(i)?i:[];this.materialIndex=void 0!==o?o:0}function S(){Object.defineProperty(this,"id",{value:co+=2});this.uuid=eo.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function _(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="";this.array=e;this.itemSize=t;this.count=void 0!==e?e.length/t:0;this.normalized=!0===r;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0}function a(e,t,r){_.call(this,new Int8Array(e),t,r)}function l(e,t,r){_.call(this,new Uint8Array(e),t,r)}function d(e,t,r){_.call(this,new Uint8ClampedArray(e),t,r)}function v(e,t,r){_.call(this,new Int16Array(e),t,r)}function y(e,t,r){_.call(this,new Uint16Array(e),t,r)}function b(e,t,r){_.call(this,new Int32Array(e),t,r)}function w(e,t,r){_.call(this,new Uint32Array(e),t,r)}function P(e,t,r){_.call(this,new Float32Array(e),t,r)}function M(e,t,r){_.call(this,new Float64Array(e),t,r)}function C(){this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function E(e){if(0===e.length)return-Infinity;for(var t=e[0],r=1,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}function A(){Object.defineProperty(this,"id",{value:ho+=2});this.uuid=eo.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity};this.userData={}}function O(e,t,r,n,i,o){S.call(this);this.type="BoxGeometry";this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};this.fromBufferGeometry(new j(e,t,r,n,i,o));this.mergeVertices()}function j(e,t,r,n,i,o){function a(e,t,r,n,i,o,a,s,u,c,h){var l=o/u,p=a/c,f=o/2,d=a/2,v=s/2;a=u+1;var m=c+1,g=o=0,_,y,b=new xe;for(y=0;y<m;y++){var w=y*p-d;for(_=0;_<a;_++)b[e]=(_*l-f)*n,b[t]=w*i,b[r]=v,M.push(b.x,b.y,b.z),b[e]=0,b[t]=0,b[r]=0<s?1:-1,C.push(b.x,b.y,b.z),E.push(_/u),E.push(1-y/c),o+=1}for(y=0;y<c;y++)for(_=0;_<u;_++)e=T+_+a*(y+1),t=T+(_+1)+a*(y+1),r=T+(_+1)+a*y,S.push(T+_+a*y,e,r),S.push(e,t,r),g+=6;x.addGroup(O,g,h);O+=g;T+=o}A.call(this);this.type="BoxBufferGeometry";this.parameters={width:e,height:t,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};var x=this;e=e||1;t=t||1;r=r||1;n=Math.floor(n)||1;i=Math.floor(i)||1;o=Math.floor(o)||1;var S=[],M=[],C=[],E=[],T=0,O=0;a("z","y","x",-1,-1,r,t,e,o,i,0);a("z","y","x",1,-1,r,t,-e,o,i,1);a("x","z","y",1,1,e,r,t,n,o,2);a("x","z","y",1,-1,e,r,-t,n,o,3);a("x","y","z",1,-1,e,t,r,n,i,4);a("x","y","z",-1,-1,e,t,-r,n,i,5);this.setIndex(S);this.addAttribute("position",new P(M,3));this.addAttribute("normal",new P(C,3));this.addAttribute("uv",new P(E,2))}function R(e,t,r,n){S.call(this);this.type="PlaneGeometry";this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};this.fromBufferGeometry(new k(e,t,r,n));this.mergeVertices()}function k(e,t,r,n){A.call(this);this.type="PlaneBufferGeometry";this.parameters={width:e,height:t,widthSegments:r,heightSegments:n};e=e||1;t=t||1;var i=e/2,o=t/2;r=Math.floor(r)||1;n=Math.floor(n)||1;var a=r+1,s=n+1,u=e/r,c=t/n,h=[],l=[],p=[],f=[];for(e=0;e<s;e++){var d=e*c-o;for(t=0;t<a;t++)l.push(t*u-i,-d,0),p.push(0,0,1),f.push(t/r),f.push(1-e/n)}for(e=0;e<n;e++)for(t=0;t<r;t++)i=t+a*(e+1),o=t+1+a*(e+1),s=t+1+a*e,h.push(t+a*e,i,s),h.push(i,o,s);this.setIndex(h);this.addAttribute("position",new P(l,3));this.addAttribute("normal",new P(p,3));this.addAttribute("uv",new P(f,2))}function L(){Object.defineProperty(this,"id",{value:lo++});this.uuid=eo.generateUUID();this.name="";this.type="Material";this.lights=this.fog=!0;this.blending=1;this.side=0;this.flatShading=!1;this.vertexColors=0;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=3;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=this.clipIntersection=!1;this.shadowSide=null;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.dithering=!1;this.alphaTest=0;this.premultipliedAlpha=!1;this.overdraw=0;this.visible=!0;this.userData={};this.needsUpdate=!0}function I(e){L.call(this);this.type="MeshBasicMaterial";this.color=new x(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.lights=this.morphTargets=this.skinning=!1;this.setValues(e)}function N(e){L.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;this.uniformsNeedUpdate=!1;void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function B(e,t){this.origin=void 0!==e?e:new xe;this.direction=void 0!==t?t:new xe}function F(e,t,r){this.a=void 0!==e?e:new xe;this.b=void 0!==t?t:new xe;this.c=void 0!==r?r:new xe}function z(e,t){h.call(this);this.type="Mesh";this.geometry=void 0!==e?e:new A;this.material=void 0!==t?t:new I({color:16777215*Math.random()});this.drawMode=0;this.updateMorphTargets()}function Oe(i,r,o,n){function a(e,t){r.buffers.color.setClear(e.r,e.g,e.b,t,n)}var s=new x(0),u=0,c,h,l;return{getClearColor:function(){return s},setClearColor:function(e,t){s.set(e);u=void 0!==t?t:1;a(s,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e;a(s,u)},render:function(e,t,r,n){t=t.background;null===t?a(s,u):t&&t.isColor&&(a(t,1),n=!0);(i.autoClear||n)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil);t&&t.isCubeTexture?(void 0===l&&(l=new z(new j(1,1,1),new N({uniforms:so.cube.uniforms,vertexShader:so.cube.vertexShader,fragmentShader:so.cube.fragmentShader,side:1,depthTest:!0,depthWrite:!1,fog:!1})),l.geometry.removeAttribute("normal"),l.geometry.removeAttribute("uv"),l.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},o.update(l)),l.material.uniforms.tCube.value=t,e.push(l,l.geometry,l.material,0,null)):t&&t.isTexture&&(void 0===c&&(c=new f(-1,1,1,-1,0,1),h=new z(new k(2,2),new I({depthTest:!1,depthWrite:!1,fog:!1})),o.update(h)),h.material.map=t,i.renderBufferDirect(c,null,h.geometry,h.material,h,null))}}}function Pe(i,o,a,s){var u;this.setMode=function(e){u=e};this.render=function(e,t){i.drawArrays(u,e,t);a.update(t,u)};this.renderInstances=function(e,t,r){if(s.isWebGL2)var n=i;else if(n=o.get("ANGLE_instanced_arrays"),null===n){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}n[s.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](u,t,r,e.maxInstancedCount);a.update(r,u,e.maxInstancedCount)}}function Ae(t,r,e){function n(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision&&0<t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision&&0<t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision?"mediump":"lowp"}var i,o="undefined"!==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext,a=void 0!==e.precision?e.precision:"highp",s=n(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);e=!0===e.logarithmicDepthBuffer;s=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);var u=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),c=t.getParameter(t.MAX_TEXTURE_SIZE),h=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),l=t.getParameter(t.MAX_VERTEX_ATTRIBS),p=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),f=t.getParameter(t.MAX_VARYING_VECTORS),d=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),v=0<u,m=o||!!r.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==i)return i;var e=r.get("EXT_texture_filter_anisotropic");return i=null!==e?t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:a,logarithmicDepthBuffer:e,maxTextures:s,maxVertexTextures:u,maxTextureSize:c,maxCubemapSize:h,maxAttributes:l,maxVertexUniforms:p,maxVaryings:f,maxFragmentUniforms:d,vertexTextures:v,floatFragmentTextures:m,floatVertexTextures:v&&m}}function je(){function u(){v.value!==h&&(v.value=h,v.needsUpdate=0<l);a.numPlanes=l;a.numIntersection=0}function c(e,t,r,n){var i=null!==e?e.length:0,o=null;if(0!==i){o=v.value;if(!0!==n||null===o){n=r+4*i;t=t.matrixWorldInverse;d.getNormalMatrix(t);if(null===o||o.length<n)o=new Float32Array(n);for(n=0;n!==i;++n,r+=4)s.copy(e[n]).applyMatrix4(t,d),s.normal.toArray(o,r),o[r+3]=s.constant}v.value=o;v.needsUpdate=!0}a.numPlanes=i;return o}var a=this,h=null,l=0,p=!1,f=!1,s=new g,d=new m,v={value:null,needsUpdate:!1};this.uniform=v;this.numIntersection=this.numPlanes=0;this.init=function(e,t,r){var n=0!==e.length||t||0!==l||p;p=t;h=c(e,r,0);l=e.length;return n};this.beginShadows=function(){f=!0;c(null)};this.endShadows=function(){f=!1;u()};this.setState=function(e,t,r,n,i,o){if(!p||null===e||0===e.length||f&&!r)f?c(null):u();else{r=f?0:l;var a=4*r,s=i.clippingState||null;v.value=s;s=c(e,n,a,o);for(e=0;e!==a;++e)s[e]=h[e];i.clippingState=s;this.numIntersection=t?this.numPlanes:0;this.numPlanes+=r}}}function Re(r){var n={};return{get:function(e){if(void 0!==n[e])return n[e];switch(e){case"WEBGL_depth_texture":var t=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":t=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=r.getExtension(e)}null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported.");return n[e]=t}}}function ke(u,c,n){function i(e){var t=e.target;e=o[t.id];null!==e.index&&c.remove(e.index);for(var r in e.attributes)c.remove(e.attributes[r]);t.removeEventListener("dispose",i);delete o[t.id];if(r=h[e.id])c.remove(r),delete h[e.id];n.memory.geometries--}var o={},h={};return{get:function(e,t){var r=o[t.id];if(r)return r;t.addEventListener("dispose",i);t.isBufferGeometry?r=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new A).setFromObject(e)),r=t._bufferGeometry);o[t.id]=r;n.memory.geometries++;return r},update:function(e){var t=e.index,r=e.attributes;null!==t&&c.update(t,u.ELEMENT_ARRAY_BUFFER);for(var n in r)c.update(r[n],u.ARRAY_BUFFER);e=e.morphAttributes;for(n in e){t=e[n];r=0;for(var i=t.length;r<i;r++)c.update(t[r],u.ARRAY_BUFFER)}},getWireframeAttribute:function(e){var t=h[e.id];if(t)return t;t=[];var r=e.index,n=e.attributes;if(null!==r){r=r.array;n=0;for(var i=r.length;n<i;n+=3){var o=r[n+0],a=r[n+1],s=r[n+2];t.push(o,a,a,s,s,o)}}else for(r=n.position.array,n=0,i=r.length/3-1;n<i;n+=3)o=n+0,a=n+1,s=n+2,t.push(o,a,a,s,s,o);t=new(65535<E(t)?w:y)(t,1);c.update(t,u.ELEMENT_ARRAY_BUFFER);return h[e.id]=t}}}function Le(i,o,a,s){var u,c,h;this.setMode=function(e){u=e};this.setIndex=function(e){c=e.type;h=e.bytesPerElement};this.render=function(e,t){i.drawElements(u,t,c,e*h);a.update(t,u)};this.renderInstances=function(e,t,r){if(s.isWebGL2)var n=i;else if(n=o.get("ANGLE_instanced_arrays"),null===n){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}n[s.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](u,r,c,t*h,e.maxInstancedCount);a.update(r,u,e.maxInstancedCount)}}function Ie(n){var i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function(){i.frame++;i.calls=0;i.triangles=0;i.points=0;i.lines=0},update:function(e,t,r){r=r||1;i.calls++;switch(t){case n.TRIANGLES:i.triangles+=e/3*r;break;case n.TRIANGLE_STRIP:case n.TRIANGLE_FAN:i.triangles+=r*(e-2);break;case n.LINES:i.lines+=e/2*r;break;case n.LINE_STRIP:i.lines+=r*(e-1);break;case n.LINE_LOOP:i.lines+=r*e;break;case n.POINTS:i.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",t)}}}}function $(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Ne(c){var h={},l=new Float32Array(8);return{update:function(e,t,r,n){var i=e.morphTargetInfluences,o=i.length;e=h[t.id];if(void 0===e){e=[];for(var a=0;a<o;a++)e[a]=[a,0];h[t.id]=e}var s=r.morphTargets&&t.morphAttributes.position;r=r.morphNormals&&t.morphAttributes.normal;for(a=0;a<o;a++){var u=e[a];0!==u[1]&&(s&&t.removeAttribute("morphTarget"+a),r&&t.removeAttribute("morphNormal"+a))}for(a=0;a<o;a++)u=e[a],u[0]=a,u[1]=i[a];e.sort($);for(a=0;8>a;a++){if(u=e[a])if(i=u[0],o=u[1]){s&&t.addAttribute("morphTarget"+a,s[i]);r&&t.addAttribute("morphNormal"+a,r[i]);l[a]=o;continue}l[a]=0}n.getUniforms().setValue(c,"morphTargetInfluences",l)}}}function De(i,o){var a={};return{update:function(e){var t=o.render.frame,r=e.geometry,n=i.get(e,r);a[n.id]!==t&&(r.isGeometry&&n.updateFromObject(e),i.update(n),a[n.id]=t);return n},dispose:function(){a={}}}}function U(e,t,r,n,i,o,a,s,u,c){e=void 0!==e?e:[];p.call(this,e,void 0!==t?t:301,r,n,i,o,a,s,u,c);this.flipY=!1}function G(e,t,r){var n=e[0];if(0>=n||0<n)return e;var i=t*r,o=vo[i];void 0===o&&(o=new Float32Array(i),vo[i]=o);if(0!==t)for(n.toArray(o,0),n=1,i=0;n!==t;++n)i+=r,e[n].toArray(o,i);return o}function V(e,t){if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0}function q(e,t){for(var r=0,n=t.length;r<n;r++)e[r]=t[r]}function W(e,t){var r=mo[t];void 0===r&&(r=new Int32Array(t),mo[t]=r);for(var n=0;n!==t;++n)r[n]=e.allocTextureUnit();return r}function X(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function Y(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function K(e,t){var r=this.cache;if(void 0!==t.x){if(r[0]!==t.x||r[1]!==t.y)e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y}else V(r,t)||(e.uniform2fv(this.addr,t),q(r,t))}function Z(e,t){var r=this.cache;if(void 0!==t.x){if(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z)e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z}else if(void 0!==t.r){if(r[0]!==t.r||r[1]!==t.g||r[2]!==t.b)e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b}else V(r,t)||(e.uniform3fv(this.addr,t),q(r,t))}function J(e,t){var r=this.cache;if(void 0!==t.x){if(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z||r[3]!==t.w)e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w}else V(r,t)||(e.uniform4fv(this.addr,t),q(r,t))}function Q(e,t){var r=this.cache,n=t.elements;void 0===n?V(r,t)||(e.uniformMatrix2fv(this.addr,!1,t),q(r,t)):V(r,n)||(yo.set(n),e.uniformMatrix2fv(this.addr,!1,yo),q(r,n))}function ee(e,t){var r=this.cache,n=t.elements;void 0===n?V(r,t)||(e.uniformMatrix3fv(this.addr,!1,t),q(r,t)):V(r,n)||(_o.set(n),e.uniformMatrix3fv(this.addr,!1,_o),q(r,n))}function te(e,t){var r=this.cache,n=t.elements;void 0===n?V(r,t)||(e.uniformMatrix4fv(this.addr,!1,t),q(r,t)):V(r,n)||(go.set(n),e.uniformMatrix4fv(this.addr,!1,go),q(r,n))}function re(e,t,r){var n=this.cache,i=r.allocTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i);r.setTexture2D(t||po,i)}function ne(e,t,r){var n=this.cache,i=r.allocTextureUnit();n[0]!==i&&(e.uniform1i(this.addr,i),n[0]=i);r.setTextureCube(t||fo,i)}function ie(e,t){var r=this.cache;V(r,t)||(e.uniform2iv(this.addr,t),q(r,t))}function oe(e,t){var r=this.cache;V(r,t)||(e.uniform3iv(this.addr,t),q(r,t))}function ae(e,t){var r=this.cache;V(r,t)||(e.uniform4iv(this.addr,t),q(r,t))}function se(e){switch(e){case 5126:return X;case 35664:return K;case 35665:return Z;case 35666:return J;case 35674:return Q;case 35675:return ee;case 35676:return te;case 35678:case 36198:return re;case 35680:return ne;case 5124:case 35670:return Y;case 35667:case 35671:return ie;case 35668:case 35672:return oe;case 35669:case 35673:return ae}}function ue(e,t){var r=this.cache;V(r,t)||(e.uniform1fv(this.addr,t),q(r,t))}function ce(e,t){var r=this.cache;V(r,t)||(e.uniform1iv(this.addr,t),q(r,t))}function he(e,t){var r=this.cache;t=G(t,this.size,2);V(r,t)||(e.uniform2fv(this.addr,t),this.updateCache(t))}function le(e,t){var r=this.cache;t=G(t,this.size,3);V(r,t)||(e.uniform3fv(this.addr,t),this.updateCache(t))}function pe(e,t){var r=this.cache;t=G(t,this.size,4);V(r,t)||(e.uniform4fv(this.addr,t),this.updateCache(t))}function fe(e,t){var r=this.cache;t=G(t,this.size,4);V(r,t)||(e.uniformMatrix2fv(this.addr,!1,t),this.updateCache(t))}function de(e,t){var r=this.cache;t=G(t,this.size,9);V(r,t)||(e.uniformMatrix3fv(this.addr,!1,t),this.updateCache(t))}function ve(e,t){var r=this.cache;t=G(t,this.size,16);V(r,t)||(e.uniformMatrix4fv(this.addr,!1,t),this.updateCache(t))}function me(e,t,r){var n=this.cache,i=t.length,o=W(r,i);!1===V(n,o)&&(e.uniform1iv(this.addr,o),q(n,o));for(e=0;e!==i;++e)r.setTexture2D(t[e]||po,o[e])}function ge(e,t,r){var n=this.cache,i=t.length,o=W(r,i);!1===V(n,o)&&(e.uniform1iv(this.addr,o),q(n,o));for(e=0;e!==i;++e)r.setTextureCube(t[e]||fo,o[e])}function _e(e){switch(e){case 5126:return ue;case 35664:return he;case 35665:return le;case 35666:return pe;case 35674:return fe;case 35675:return de;case 35676:return ve;case 35678:return me;case 35680:return ge;case 5124:case 35670:return ce;case 35667:case 35671:return ie;case 35668:case 35672:return oe;case 35669:case 35673:return ae}}function ye(e,t,r){this.id=e;this.addr=r;this.cache=[];this.setValue=se(t.type)}function be(e,t,r){this.id=e;this.addr=r;this.cache=[];this.size=t.size;this.setValue=_e(t.type)}function Be(e){this.id=e;this.seq=[];this.map={}}function Fe(e,t,r){this.seq=[];this.map={};this.renderer=r;r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(var n=0;n<r;++n){var i=e.getActiveUniform(t,n),o=e.getUniformLocation(t,i.name),a=this,s=i.name,u=s.length;for(bo.lastIndex=0;;){var c=bo.exec(s),h=bo.lastIndex,l=c[1],p=c[3];"]"===c[2]&&(l|=0);if(void 0===p||"["===p&&h+2===u){s=a;i=void 0===p?new ye(l,i,o):new be(l,i,o);s.seq.push(i);s.map[i.id]=i;break}else p=a.map[l],void 0===p&&(p=new Be(l),l=a,a=p,l.seq.push(a),l.map[a.id]=a),a=p}}}function ze(e){e=e.split("\n");for(var t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}function $e(e,t,r){var n=e.createShader(t);e.shaderSource(n,r);e.compileShader(n);!1===e.getShaderParameter(n,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==e.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(n),ze(r));return n}function Ue(e){switch(e){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+e)}}function Ge(e,t){t=Ue(t);return"vec4 "+e+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function Ve(e,t){t=Ue(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function He(e,t){switch(t){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="Uncharted2";break;case 4:t="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function qe(e,t,r){e=e||{};return[e.derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Xe).join("\n")}function We(e){var t=[],r;for(r in e){var n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}function Xe(e){return""!==e}function Ye(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Ke(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function Ze(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){e=no[t];if(void 0===e)throw Error("Can not resolve #include <"+t+">");return Ze(e)})}function Je(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,r,n){e="";for(t=parseInt(t);t<parseInt(r);t++)e+=n.replace(/\[ i \]/g,"[ "+t+" ]");return e})}function Qe(e,t,r,n,i,o,a){var s=e.context,u=n.defines,c=i.vertexShader,h=i.fragmentShader,l="SHADOWMAP_TYPE_BASIC";1===o.shadowMapType?l="SHADOWMAP_TYPE_PCF":2===o.shadowMapType&&(l="SHADOWMAP_TYPE_PCF_SOFT");var p="ENVMAP_TYPE_CUBE",f="ENVMAP_MODE_REFLECTION",d="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(n.envMap.mapping){case 301:case 302:p="ENVMAP_TYPE_CUBE";break;case 306:case 307:p="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:p="ENVMAP_TYPE_EQUIREC";break;case 305:p="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case 302:case 304:f="ENVMAP_MODE_REFRACTION"}switch(n.combine){case 0:d="ENVMAP_BLENDING_MULTIPLY";break;case 1:d="ENVMAP_BLENDING_MIX";break;case 2:d="ENVMAP_BLENDING_ADD"}}var v=0<e.gammaFactor?e.gammaFactor:1,m=a.isWebGL2?"":qe(n.extensions,o,t),g=We(u),_=s.createProgram();n.isRawShaderMaterial?(u=[g].filter(Xe).join("\n"),0<u.length&&(u+="\n"),t=[m,g].filter(Xe).join("\n"),0<t.length&&(t+="\n")):(u=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,g,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+v,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+f:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+l:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Xe).join("\n"),t=[m,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,g,o.alphaTest?"#define ALPHATEST "+o.alphaTest+(o.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+v,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+p:"",o.envMap?"#define "+f:"",o.envMap?"#define "+d:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+l:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&(a.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==o.toneMapping?"#define TONE_MAPPING":"",0!==o.toneMapping?no.tonemapping_pars_fragment:"",0!==o.toneMapping?He("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.envMapEncoding||o.emissiveMapEncoding?no.encodings_pars_fragment:"",o.mapEncoding?Ge("mapTexelToLinear",o.mapEncoding):"",o.envMapEncoding?Ge("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?Ge("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?Ve("linearToOutputTexel",o.outputEncoding):"",o.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Xe).join("\n"));c=Ze(c);c=Ye(c,o);c=Ke(c,o);h=Ze(h);h=Ye(h,o);h=Ke(h,o);c=Je(c);h=Je(h);a.isWebGL2&&!n.isRawShaderMaterial&&(a=!1,l=/^\s*#version\s+300\s+es\s*\n/,n.isShaderMaterial&&null!==c.match(l)&&null!==h.match(l)&&(a=!0,c=c.replace(l,""),h=h.replace(l,"")),u="#version 300 es\n\n#define attribute in\n#define varying out\n#define texture2D texture\n"+u,t=["#version 300 es\n\n#define varying in",a?"":"out highp vec4 pc_fragColor;",a?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+t);h=t+h;c=$e(s,s.VERTEX_SHADER,u+c);h=$e(s,s.FRAGMENT_SHADER,h);s.attachShader(_,c);s.attachShader(_,h);void 0!==n.index0AttributeName?s.bindAttribLocation(_,0,n.index0AttributeName):!0===o.morphTargets&&s.bindAttribLocation(_,0,"position");s.linkProgram(_);o=s.getProgramInfoLog(_).trim();a=s.getShaderInfoLog(c).trim();l=s.getShaderInfoLog(h).trim();f=p=!0;if(!1===s.getProgramParameter(_,s.LINK_STATUS))p=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(_,s.VALIDATE_STATUS),"gl.getProgramInfoLog",o,a,l);else if(""!==o)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",o);else if(""===a||""===l)f=!1;f&&(this.diagnostics={runnable:p,material:n,programLog:o,vertexShader:{log:a,prefix:u},fragmentShader:{log:l,prefix:t}});s.deleteShader(c);s.deleteShader(h);var y;this.getUniforms=function(){void 0===y&&(y=new Fe(s,_,e));return y};var b;this.getAttributes=function(){if(void 0===b){for(var e={},t=s.getProgramParameter(_,s.ACTIVE_ATTRIBUTES),r=0;r<t;r++){var n=s.getActiveAttrib(_,r).name;e[n]=s.getAttribLocation(_,n)}b=e}return b};this.destroy=function(){s.deleteProgram(_);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.name=i.name;this.id=wo++;this.code=r;this.usedTimes=1;this.program=_;this.vertexShader=c;this.fragmentShader=h;return this}function et(l,u,p){function f(e,t){if(e)e.isTexture?r=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.encoding);else var r=3e3;3e3===r&&t&&(r=3007);return r}var c=[],d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},i="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap objectSpaceNormalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking dithering".split(" ");this.getParameters=function(e,t,r,n,i,o,a){var s=d[e.type];if(a.isSkinnedMesh){var u=a.skeleton.bones;if(p.floatVertexTextures)u=1024;else{var c=Math.min(Math.floor((p.maxVertexUniforms-20)/4),u.length);c<u.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+u.length+" bones. This GPU supports "+c+"."),u=0):u=c}}else u=0;c=p.precision;null!==e.precision&&(c=p.getMaxPrecision(e.precision),c!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",c,"instead."));var h=l.getRenderTarget();return{shaderID:s,precision:c,supportsVertexTextures:p.vertexTextures,outputEncoding:f(h?h.texture:null,l.gammaOutput),map:!!e.map,mapEncoding:f(e.map,l.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:f(e.envMap,l.gammaInput),envMapCubeUV:!!e.envMap&&(306===e.envMap.mapping||307===e.envMap.mapping),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:f(e.emissiveMap,l.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,objectSpaceNormalMap:1===e.normalMapType,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,combine:e.combine,vertexColors:e.vertexColors,fog:!!n,useFog:e.fog,fogExp:n&&n.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:p.logarithmicDepthBuffer,skinning:e.skinning&&0<u,maxBones:u,useVertexTexture:p.floatVertexTextures,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:l.maxMorphTargets,maxMorphNormals:l.maxMorphNormals,numDirLights:t.directional.length,numPointLights:t.point.length,numSpotLights:t.spot.length,numRectAreaLights:t.rectArea.length,numHemiLights:t.hemi.length,numClippingPlanes:i,numClipIntersection:o,dithering:e.dithering,shadowMapEnabled:l.shadowMap.enabled&&a.receiveShadow&&0<r.length,shadowMapType:l.shadowMap.type,toneMapping:l.toneMapping,physicallyCorrectLights:l.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:2===e.side,flipSided:1===e.side,depthPacking:void 0!==e.depthPacking?e.depthPacking:!1}};this.getProgramCode=function(e,t){var r=[];t.shaderID?r.push(t.shaderID):(r.push(e.fragmentShader),r.push(e.vertexShader));if(void 0!==e.defines)for(var n in e.defines)r.push(n),r.push(e.defines[n]);for(n=0;n<i.length;n++)r.push(t[i[n]]);r.push(e.onBeforeCompile.toString());r.push(l.gammaOutput);return r.join()};this.acquireProgram=function(e,t,r,n){for(var i,o=0,a=c.length;o<a;o++){var s=c[o];if(s.code===n){i=s;++i.usedTimes;break}}void 0===i&&(i=new Qe(l,u,n,e,t,r,p),c.push(i));return i};this.releaseProgram=function(e){if(0===--e.usedTimes){var t=c.indexOf(e);c[t]=c[c.length-1];c.pop();e.destroy()}};this.programs=c}function tt(){var n=new WeakMap;return{get:function(e){var t=n.get(e);void 0===t&&(t={},n.set(e,t));return t},remove:function(e){n.delete(e)},update:function(e,t,r){n.get(e)[t]=r},dispose:function(){n=new WeakMap}}}function rt(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function nt(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function it(){var a=[],s=0,u=[],c=[];return{opaque:u,transparent:c,init:function(){s=0;u.length=0;c.length=0},push:function(e,t,r,n,i){var o=a[s];void 0===o?(o={id:e.id,object:e,geometry:t,material:r,program:r.program,renderOrder:e.renderOrder,z:n,group:i},a[s]=o):(o.id=e.id,o.object=e,o.geometry=t,o.material=r,o.program=r.program,o.renderOrder=e.renderOrder,o.z=n,o.group=i);(!0===r.transparent?c:u).push(o);s++},sort:function(){1<u.length&&u.sort(rt);1<c.length&&c.sort(nt)}}}function ot(){var r={};return{get:function(e,t){e=e.id+","+t.id;t=r[e];void 0===t&&(t=new it,r[e]=t);return t},dispose:function(){r={}}}}function at(){var r={};return{get:function(e){if(void 0!==r[e.id])return r[e.id];switch(e.type){case"DirectionalLight":var t={direction:new xe,color:new x,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new H};break;case"SpotLight":t={position:new xe,direction:new xe,color:new x,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new H};break;case"PointLight":t={position:new xe,color:new x,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new H,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":t={direction:new xe,skyColor:new x,groundColor:new x};break;case"RectAreaLight":t={color:new x,position:new xe,halfWidth:new xe,halfHeight:new xe}}return r[e.id]=t}}}function st(){var y=new at,b={id:xo++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},w=new xe,x=new we,S=new we;return{setup:function(e,t,r){var n=0,i=0,o=0,a=0,s=0,u=0,c=0,h=0;r=r.matrixWorldInverse;for(var l=0,p=e.length;l<p;l++){var f=e[l],d=f.color,v=f.intensity,m=f.distance,g=f.shadow&&f.shadow.map?f.shadow.map.texture:null;if(f.isAmbientLight)n+=d.r*v,i+=d.g*v,o+=d.b*v;else if(f.isDirectionalLight){var _=y.get(f);_.color.copy(f.color).multiplyScalar(f.intensity);_.direction.setFromMatrixPosition(f.matrixWorld);w.setFromMatrixPosition(f.target.matrixWorld);_.direction.sub(w);_.direction.transformDirection(r);if(_.shadow=f.castShadow)d=f.shadow,_.shadowBias=d.bias,_.shadowRadius=d.radius,_.shadowMapSize=d.mapSize;b.directionalShadowMap[a]=g;b.directionalShadowMatrix[a]=f.shadow.matrix;b.directional[a]=_;a++}else if(f.isSpotLight){_=y.get(f);_.position.setFromMatrixPosition(f.matrixWorld);_.position.applyMatrix4(r);_.color.copy(d).multiplyScalar(v);_.distance=m;_.direction.setFromMatrixPosition(f.matrixWorld);w.setFromMatrixPosition(f.target.matrixWorld);_.direction.sub(w);_.direction.transformDirection(r);_.coneCos=Math.cos(f.angle);_.penumbraCos=Math.cos(f.angle*(1-f.penumbra));_.decay=0===f.distance?0:f.decay;if(_.shadow=f.castShadow)d=f.shadow,_.shadowBias=d.bias,_.shadowRadius=d.radius,_.shadowMapSize=d.mapSize;b.spotShadowMap[u]=g;b.spotShadowMatrix[u]=f.shadow.matrix;b.spot[u]=_;u++}else if(f.isRectAreaLight)_=y.get(f),_.color.copy(d).multiplyScalar(v),_.position.setFromMatrixPosition(f.matrixWorld),_.position.applyMatrix4(r),S.identity(),x.copy(f.matrixWorld),x.premultiply(r),S.extractRotation(x),_.halfWidth.set(.5*f.width,0,0),_.halfHeight.set(0,.5*f.height,0),_.halfWidth.applyMatrix4(S),_.halfHeight.applyMatrix4(S),b.rectArea[c]=_,c++;else if(f.isPointLight){_=y.get(f);_.position.setFromMatrixPosition(f.matrixWorld);_.position.applyMatrix4(r);_.color.copy(f.color).multiplyScalar(f.intensity);_.distance=f.distance;_.decay=0===f.distance?0:f.decay;if(_.shadow=f.castShadow)d=f.shadow,_.shadowBias=d.bias,_.shadowRadius=d.radius,_.shadowMapSize=d.mapSize,_.shadowCameraNear=d.camera.near,_.shadowCameraFar=d.camera.far;b.pointShadowMap[s]=g;b.pointShadowMatrix[s]=f.shadow.matrix;b.point[s]=_;s++}else f.isHemisphereLight&&(_=y.get(f),_.direction.setFromMatrixPosition(f.matrixWorld),_.direction.transformDirection(r),_.direction.normalize(),_.skyColor.copy(f.color).multiplyScalar(v),_.groundColor.copy(f.groundColor).multiplyScalar(v),b.hemi[h]=_,h++)}b.ambient[0]=n;b.ambient[1]=i;b.ambient[2]=o;b.directional.length=a;b.spot.length=u;b.rectArea.length=c;b.point.length=s;b.hemi.length=h;b.hash.stateID=b.id;b.hash.directionalLength=a;b.hash.pointLength=s;b.hash.spotLength=u;b.hash.rectAreaLength=c;b.hash.hemiLength=h;b.hash.shadowsLength=t.length},state:b}}function ut(){var t=new st,r=[],n=[];return{init:function(){r.length=0;n.length=0},state:{lightsArray:r,shadowsArray:n,lights:t},setupLights:function(e){t.setup(r,n,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){n.push(e)}}}function ct(){var n={};return{get:function(e,t){if(void 0===n[e.id]){var r=new ut;n[e.id]={};n[e.id][t.id]=r}else void 0===n[e.id][t.id]?(r=new ut,n[e.id][t.id]=r):r=n[e.id][t.id];return r},dispose:function(){n={}}}}function ht(e){L.call(this);this.type="MeshDepthMaterial";this.depthPacking=3200;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(e)}function lt(e){L.call(this);this.type="MeshDistanceMaterial";this.referencePosition=new xe;this.nearDistance=1;this.farDistance=1e3;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.lights=this.fog=!1;this.setValues(e)}function pt(p,l,e){function f(e,t,r,n,i,o){var a=e.geometry;var s=c;var u=e.customDepthMaterial;r&&(s=h,u=e.customDistanceMaterial);u?s=u:(u=!1,t.morphTargets&&(a&&a.isBufferGeometry?u=a.morphAttributes&&a.morphAttributes.position&&0<a.morphAttributes.position.length:a&&a.isGeometry&&(u=a.morphTargets&&0<a.morphTargets.length)),e.isSkinnedMesh&&!1===t.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e),e=e.isSkinnedMesh&&t.skinning,a=0,u&&(a|=1),e&&(a|=2),s=s[a]);p.localClippingEnabled&&!0===t.clipShadows&&0!==t.clippingPlanes.length&&(a=s.uuid,u=t.uuid,e=w[a],void 0===e&&(e={},w[a]=e),a=e[u],void 0===a&&(a=s.clone(),e[u]=a),s=a);s.visible=t.visible;s.wireframe=t.wireframe;s.side=null!=t.shadowSide?t.shadowSide:x[t.side];s.clipShadows=t.clipShadows;s.clippingPlanes=t.clippingPlanes;s.clipIntersection=t.clipIntersection;s.wireframeLinewidth=t.wireframeLinewidth;s.linewidth=t.linewidth;r&&s.isMeshDistanceMaterial&&(s.referencePosition.copy(n),s.nearDistance=i,s.farDistance=o);return s}function d(e,t,r,n){if(!1!==e.visible){if(e.layers.test(t.layers)&&(e.isMesh||e.isLine||e.isPoints)&&e.castShadow&&(!e.frustumCulled||v.intersectsObject(e))){e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld);var i=l.update(e),o=e.material;if(Array.isArray(o))for(var a=i.groups,s=0,u=a.length;s<u;s++){var c=a[s],h=o[c.materialIndex];h&&h.visible&&(h=f(e,h,n,b,r.near,r.far),p.renderBufferDirect(r,null,i,h,e,c))}else o.visible&&(h=f(e,o,n,b,r.near,r.far),p.renderBufferDirect(r,null,i,h,e,null))}e=e.children;i=0;for(o=e.length;i<o;i++)d(e[i],t,r,n)}}var v=new Ce,m=new we,g=new H,_=new H(e,e),y=new xe,b=new xe,c=Array(4),h=Array(4),w={},x={0:1,1:0,2:2},S=[new xe(1,0,0),new xe(-1,0,0),new xe(0,0,1),new xe(0,0,-1),new xe(0,1,0),new xe(0,-1,0)],M=[new xe(0,1,0),new xe(0,1,0),new xe(0,1,0),new xe(0,1,0),new xe(0,0,1),new xe(0,0,-1)],C=[new Se,new Se,new Se,new Se,new Se,new Se];for(e=0;4!==e;++e){var t=0!==(e&1),r=0!==(e&2),n=new ht({depthPacking:3201,morphTargets:t,skinning:r});c[e]=n;t=new lt({morphTargets:t,skinning:r});h[e]=t}var E=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.render=function(e,t,r){if(!1!==E.enabled&&(!1!==E.autoUpdate||!1!==E.needsUpdate)&&0!==e.length){var n=p.state;n.disable(p.context.BLEND);n.buffers.color.setClear(1,1,1,1);n.buffers.depth.setTest(!0);n.setScissorTest(!1);for(var i,o=0,a=e.length;o<a;o++){var s=e[o];i=s.shadow;var u=s&&s.isPointLight;if(void 0===i)console.warn("THREE.WebGLShadowMap:",s,"has no shadow.");else{var c=i.camera;g.copy(i.mapSize);g.min(_);if(u){var h=g.x,l=g.y;C[0].set(2*h,l,h,l);C[1].set(0,l,h,l);C[2].set(3*h,l,h,l);C[3].set(h,l,h,l);C[4].set(3*h,0,h,l);C[5].set(h,0,h,l);g.x*=4;g.y*=2}null===i.map&&(i.map=new T(g.x,g.y,{minFilter:1003,magFilter:1003,format:1023}),i.map.texture.name=s.name+".shadowMap",c.updateProjectionMatrix());i.isSpotLightShadow&&i.update(s);h=i.map;l=i.matrix;b.setFromMatrixPosition(s.matrixWorld);c.position.copy(b);u?(i=6,l.makeTranslation(-b.x,-b.y,-b.z)):(i=1,y.setFromMatrixPosition(s.target.matrixWorld),c.lookAt(y),c.updateMatrixWorld(),l.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),l.multiply(c.projectionMatrix),l.multiply(c.matrixWorldInverse));p.setRenderTarget(h);p.clear();for(s=0;s<i;s++)u&&(y.copy(c.position),y.add(S[s]),c.up.copy(M[s]),c.lookAt(y),c.updateMatrixWorld(),n.viewport(C[s])),m.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),v.setFromMatrix(m),d(t,r,c,u)}}E.needsUpdate=!1}}}function ft(h,r,u,n){function e(e,t,r){var n=new Uint8Array(4),i=h.createTexture();h.bindTexture(e,i);h.texParameteri(e,h.TEXTURE_MIN_FILTER,h.NEAREST);h.texParameteri(e,h.TEXTURE_MAG_FILTER,h.NEAREST);for(e=0;e<r;e++)h.texImage2D(t+e,0,h.RGBA,1,1,0,h.RGBA,h.UNSIGNED_BYTE,n);return i}function t(e,t){g[e]=1;0===_[e]&&(h.enableVertexAttribArray(e),_[e]=1);y[e]!==t&&((n.isWebGL2?h:r.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](e,t),y[e]=t)}function l(e){!0!==b[e]&&(h.enable(e),b[e]=!0)}function p(e){!1!==b[e]&&(h.disable(e),b[e]=!1)}function i(e,t,r,n,i,o,a,s){0!==e?l(h.BLEND):p(h.BLEND);if(5!==e){if(e!==S||s!==A)switch(e){case 2:s?(h.blendEquationSeparate(h.FUNC_ADD,h.FUNC_ADD),h.blendFuncSeparate(h.ONE,h.ONE,h.ONE,h.ONE)):(h.blendEquation(h.FUNC_ADD),h.blendFunc(h.SRC_ALPHA,h.ONE));break;case 3:s?(h.blendEquationSeparate(h.FUNC_ADD,h.FUNC_ADD),h.blendFuncSeparate(h.ZERO,h.ZERO,h.ONE_MINUS_SRC_COLOR,h.ONE_MINUS_SRC_ALPHA)):(h.blendEquation(h.FUNC_ADD),h.blendFunc(h.ZERO,h.ONE_MINUS_SRC_COLOR));break;case 4:s?(h.blendEquationSeparate(h.FUNC_ADD,h.FUNC_ADD),h.blendFuncSeparate(h.ZERO,h.SRC_COLOR,h.ZERO,h.SRC_ALPHA)):(h.blendEquation(h.FUNC_ADD),h.blendFunc(h.ZERO,h.SRC_COLOR));break;default:s?(h.blendEquationSeparate(h.FUNC_ADD,h.FUNC_ADD),h.blendFuncSeparate(h.ONE,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA)):(h.blendEquationSeparate(h.FUNC_ADD,h.FUNC_ADD),h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA))}P=O=T=E=C=M=null}else{i=i||t;o=o||r;a=a||n;if(t!==M||i!==T)h.blendEquationSeparate(u.convert(t),u.convert(i)),M=t,T=i;if(r!==C||n!==E||o!==O||a!==P)h.blendFuncSeparate(u.convert(r),u.convert(n),u.convert(o),u.convert(a)),C=r,E=n,O=o,P=a}S=e;A=s}function o(e){j!==e&&(e?h.frontFace(h.CW):h.frontFace(h.CCW),j=e)}function a(e){0!==e?(l(h.CULL_FACE),e!==R&&(1===e?h.cullFace(h.BACK):2===e?h.cullFace(h.FRONT):h.cullFace(h.FRONT_AND_BACK))):p(h.CULL_FACE);R=e}function s(e,t,r){if(e){if(l(h.POLYGON_OFFSET_FILL),L!==t||I!==r)h.polygonOffset(t,r),L=t,I=r}else p(h.POLYGON_OFFSET_FILL)}function c(e){void 0===e&&(e=h.TEXTURE0+N-1);B!==e&&(h.activeTexture(e),B=e)}var f=new function(){var t=!1,o=new Se,r=null,a=new Se(0,0,0,0);return{setMask:function(e){r===e||t||(h.colorMask(e,e,e,e),r=e)},setLocked:function(e){t=e},setClear:function(e,t,r,n,i){!0===i&&(e*=n,t*=n,r*=n);o.set(e,t,r,n);!1===a.equals(o)&&(h.clearColor(e,t,r,n),a.copy(o))},reset:function(){t=!1;r=null;a.set(-1,0,0,0)}}},d=new function(){var t=!1,r=null,n=null,i=null;return{setTest:function(e){e?l(h.DEPTH_TEST):p(h.DEPTH_TEST)},setMask:function(e){r===e||t||(h.depthMask(e),r=e)},setFunc:function(e){if(n!==e){if(e)switch(e){case 0:h.depthFunc(h.NEVER);break;case 1:h.depthFunc(h.ALWAYS);break;case 2:h.depthFunc(h.LESS);break;case 3:h.depthFunc(h.LEQUAL);break;case 4:h.depthFunc(h.EQUAL);break;case 5:h.depthFunc(h.GEQUAL);break;case 6:h.depthFunc(h.GREATER);break;case 7:h.depthFunc(h.NOTEQUAL);break;default:h.depthFunc(h.LEQUAL)}else h.depthFunc(h.LEQUAL);n=e}},setLocked:function(e){t=e},setClear:function(e){i!==e&&(h.clearDepth(e),i=e)},reset:function(){t=!1;i=n=r=null}}},v=new function(){var t=!1,r=null,n=null,i=null,o=null,a=null,s=null,u=null,c=null;return{setTest:function(e){e?l(h.STENCIL_TEST):p(h.STENCIL_TEST)},setMask:function(e){r===e||t||(h.stencilMask(e),r=e)},setFunc:function(e,t,r){if(n!==e||i!==t||o!==r)h.stencilFunc(e,t,r),n=e,i=t,o=r},setOp:function(e,t,r){if(a!==e||s!==t||u!==r)h.stencilOp(e,t,r),a=e,s=t,u=r},setLocked:function(e){t=e},setClear:function(e){c!==e&&(h.clearStencil(e),c=e)},reset:function(){t=!1;c=u=s=a=o=i=n=r=null}}},m=h.getParameter(h.MAX_VERTEX_ATTRIBS),g=new Uint8Array(m),_=new Uint8Array(m),y=new Uint8Array(m),b={},w=null,x=null,S=null,M=null,C=null,E=null,T=null,O=null,P=null,A=!1,j=null,R=null,k=null,L=null,I=null,N=h.getParameter(h.MAX_COMBINED_TEXTURE_IMAGE_UNITS),D=!1;m=0;m=h.getParameter(h.VERSION);-1!==m.indexOf("WebGL")?(m=parseFloat(/^WebGL ([0-9])/.exec(m)[1]),D=1<=m):-1!==m.indexOf("OpenGL ES")&&(m=parseFloat(/^OpenGL ES ([0-9])/.exec(m)[1]),D=2<=m);var B=null,F={},z=new Se,$=new Se,U={};U[h.TEXTURE_2D]=e(h.TEXTURE_2D,h.TEXTURE_2D,1);U[h.TEXTURE_CUBE_MAP]=e(h.TEXTURE_CUBE_MAP,h.TEXTURE_CUBE_MAP_POSITIVE_X,6);f.setClear(0,0,0,1);d.setClear(1);v.setClear(0);l(h.DEPTH_TEST);d.setFunc(3);o(!1);a(1);l(h.CULL_FACE);l(h.BLEND);i(1);return{buffers:{color:f,depth:d,stencil:v},initAttributes:function(){for(var e=0,t=g.length;e<t;e++)g[e]=0},enableAttribute:function(e){t(e,0)},enableAttributeAndDivisor:t,disableUnusedAttributes:function(){for(var e=0,t=_.length;e!==t;++e)_[e]!==g[e]&&(h.disableVertexAttribArray(e),_[e]=0)},enable:l,disable:p,getCompressedTextureFormats:function(){if(null===w&&(w=[],r.get("WEBGL_compressed_texture_pvrtc")||r.get("WEBGL_compressed_texture_s3tc")||r.get("WEBGL_compressed_texture_etc1")||r.get("WEBGL_compressed_texture_astc")))for(var e=h.getParameter(h.COMPRESSED_TEXTURE_FORMATS),t=0;t<e.length;t++)w.push(e[t]);return w},useProgram:function(e){return x!==e?(h.useProgram(e),x=e,!0):!1},setBlending:i,setMaterial:function(e,t){2===e.side?p(h.CULL_FACE):l(h.CULL_FACE);var r=1===e.side;t&&(r=!r);o(r);1===e.blending&&!1===e.transparent?i(0):i(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha);d.setFunc(e.depthFunc);d.setTest(e.depthTest);d.setMask(e.depthWrite);f.setMask(e.colorWrite);s(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:o,setCullFace:a,setLineWidth:function(e){e!==k&&(D&&h.lineWidth(e),k=e)},setPolygonOffset:s,setScissorTest:function(e){e?l(h.SCISSOR_TEST):p(h.SCISSOR_TEST)},activeTexture:c,bindTexture:function(e,t){null===B&&c();var r=F[B];void 0===r&&(r={type:void 0,texture:void 0},F[B]=r);if(r.type!==e||r.texture!==t)h.bindTexture(e,t||U[e]),r.type=e,r.texture=t},compressedTexImage2D:function(){try{h.compressedTexImage2D.apply(h,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{h.texImage2D.apply(h,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===z.equals(e)&&(h.scissor(e.x,e.y,e.z,e.w),z.copy(e))},viewport:function(e){!1===$.equals(e)&&(h.viewport(e.x,e.y,e.z,e.w),$.copy(e))},reset:function(){for(var e=0;e<_.length;e++)1===_[e]&&(h.disableVertexAttribArray(e),_[e]=0);b={};B=w=null;F={};R=j=S=x=null;f.reset();d.reset();v.reset()}}}function dt(v,n,m,g,_,y,b){function w(e,t){if(e.width>t||e.height>t){if("data"in e){console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+e.width+"x"+e.height+").");return}t/=Math.max(e.width,e.height);var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=Math.floor(e.width*t);r.height=Math.floor(e.height*t);r.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height);console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height);return r}return e}function x(e){return eo.isPowerOfTwo(e.width)&&eo.isPowerOfTwo(e.height)}function S(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function M(e,t,r,n){v.generateMipmap(e);g.get(t).__maxMipLevel=Math.log(Math.max(r,n))*Math.LOG2E}function C(e,t){if(!_.isWebGL2)return e;if(e===v.RGB){if(t===v.FLOAT)return v.RGB32F;if(t===v.HALF_FLOAT)return v.RGB16F;if(t===v.UNSIGNED_BYTE)return v.RGB8}if(e===v.RGBA){if(t===v.FLOAT)return v.RGBA32F;if(t===v.HALF_FLOAT)return v.RGBA16F;if(t===v.UNSIGNED_BYTE)return v.RGBA8}return e}function i(e){return 1003===e||1004===e||1005===e?v.NEAREST:v.LINEAR}function E(e){e=e.target;e.removeEventListener("dispose",E);e:{var t=g.get(e);if(e.image&&t.__image__webglTextureCube)v.deleteTexture(t.__image__webglTextureCube);else{if(void 0===t.__webglInit)break e;v.deleteTexture(t.__webglTexture)}g.remove(e)}e.isVideoTexture&&delete l[e.id];b.memory.textures--}function a(e){e=e.target;e.removeEventListener("dispose",a);var t=g.get(e),r=g.get(e.texture);if(e){void 0!==r.__webglTexture&&v.deleteTexture(r.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLRenderTargetCube)for(r=0;6>r;r++)v.deleteFramebuffer(t.__webglFramebuffer[r]),t.__webglDepthbuffer&&v.deleteRenderbuffer(t.__webglDepthbuffer[r]);else v.deleteFramebuffer(t.__webglFramebuffer),t.__webglDepthbuffer&&v.deleteRenderbuffer(t.__webglDepthbuffer);g.remove(e.texture);g.remove(e)}b.memory.textures--}function s(e,t){var r=g.get(e);if(e.isVideoTexture){var n=e.id,i=b.render.frame;l[n]!==i&&(l[n]=i,e.update())}if(0<e.version&&r.__version!==e.version)if(n=e.image,void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(!1===n.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{void 0===r.__webglInit&&(r.__webglInit=!0,e.addEventListener("dispose",E),r.__webglTexture=v.createTexture(),b.memory.textures++);m.activeTexture(v.TEXTURE0+t);m.bindTexture(v.TEXTURE_2D,r.__webglTexture);v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,e.flipY);v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);v.pixelStorei(v.UNPACK_ALIGNMENT,e.unpackAlignment);t=w(e.image,_.maxTextureSize);(_.isWebGL2?0:1001!==e.wrapS||1001!==e.wrapT||1003!==e.minFilter&&1006!==e.minFilter)&&!1===x(t)&&(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageBitmap)&&(void 0===p&&(p=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),p.width=eo.floorPowerOfTwo(t.width),p.height=eo.floorPowerOfTwo(t.height),p.getContext("2d").drawImage(t,0,0,p.width,p.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+t.width+"x"+t.height+"). Resized to "+p.width+"x"+p.height),t=p);n=x(t);i=y.convert(e.format);var o=y.convert(e.type),a=C(i,o);T(v.TEXTURE_2D,e,n);var s=e.mipmaps;if(e.isDepthTexture){a=v.DEPTH_COMPONENT;if(1015===e.type){if(!_.isWebGL2)throw Error("Float Depth Texture only supported in WebGL2.0");a=v.DEPTH_COMPONENT32F}else _.isWebGL2&&(a=v.DEPTH_COMPONENT16);1026===e.format&&a===v.DEPTH_COMPONENT&&1012!==e.type&&1014!==e.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),e.type=1012,o=y.convert(e.type));1027===e.format&&(a=v.DEPTH_STENCIL,1020!==e.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),e.type=1020,o=y.convert(e.type)));m.texImage2D(v.TEXTURE_2D,0,a,t.width,t.height,0,i,o,null)}else if(e.isDataTexture)if(0<s.length&&n){for(var u=0,c=s.length;u<c;u++){var h=s[u];m.texImage2D(v.TEXTURE_2D,u,a,h.width,h.height,0,i,o,h.data)}e.generateMipmaps=!1;r.__maxMipLevel=s.length-1}else m.texImage2D(v.TEXTURE_2D,0,a,t.width,t.height,0,i,o,t.data),r.__maxMipLevel=0;else if(e.isCompressedTexture){u=0;for(c=s.length;u<c;u++)h=s[u],1023!==e.format&&1022!==e.format?-1<m.getCompressedTextureFormats().indexOf(i)?m.compressedTexImage2D(v.TEXTURE_2D,u,a,h.width,h.height,0,h.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):m.texImage2D(v.TEXTURE_2D,u,a,h.width,h.height,0,i,o,h.data);r.__maxMipLevel=s.length-1}else if(0<s.length&&n){u=0;for(c=s.length;u<c;u++)h=s[u],m.texImage2D(v.TEXTURE_2D,u,a,i,o,h);e.generateMipmaps=!1;r.__maxMipLevel=s.length-1}else m.texImage2D(v.TEXTURE_2D,0,a,i,o,t),r.__maxMipLevel=0;S(e,n)&&M(v.TEXTURE_2D,e,t.width,t.height);r.__version=e.version;if(e.onUpdate)e.onUpdate(e);return}m.activeTexture(v.TEXTURE0+t);m.bindTexture(v.TEXTURE_2D,r.__webglTexture)}function T(e,t,r){r?(v.texParameteri(e,v.TEXTURE_WRAP_S,y.convert(t.wrapS)),v.texParameteri(e,v.TEXTURE_WRAP_T,y.convert(t.wrapT)),v.texParameteri(e,v.TEXTURE_MAG_FILTER,y.convert(t.magFilter)),v.texParameteri(e,v.TEXTURE_MIN_FILTER,y.convert(t.minFilter))):(v.texParameteri(e,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(e,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),1001===t.wrapS&&1001===t.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),v.texParameteri(e,v.TEXTURE_MAG_FILTER,i(t.magFilter)),v.texParameteri(e,v.TEXTURE_MIN_FILTER,i(t.minFilter)),1003!==t.minFilter&&1006!==t.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));!(r=n.get("EXT_texture_filter_anisotropic"))||1015===t.type&&null===n.get("OES_texture_float_linear")||1016===t.type&&null===(_.isWebGL2||n.get("OES_texture_half_float_linear"))||!(1<t.anisotropy||g.get(t).__currentAnisotropy)||(v.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,_.getMaxAnisotropy())),g.get(t).__currentAnisotropy=t.anisotropy)}function u(e,t,r,n){var i=y.convert(t.texture.format),o=y.convert(t.texture.type),a=C(i,o);m.texImage2D(n,0,a,t.width,t.height,0,i,o,null);v.bindFramebuffer(v.FRAMEBUFFER,e);v.framebufferTexture2D(v.FRAMEBUFFER,r,n,g.get(t.texture).__webglTexture,0);v.bindFramebuffer(v.FRAMEBUFFER,null)}function c(e,t){v.bindRenderbuffer(v.RENDERBUFFER,e);t.depthBuffer&&!t.stencilBuffer?(v.renderbufferStorage(v.RENDERBUFFER,v.DEPTH_COMPONENT16,t.width,t.height),v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,v.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(v.renderbufferStorage(v.RENDERBUFFER,v.DEPTH_STENCIL,t.width,t.height),v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_STENCIL_ATTACHMENT,v.RENDERBUFFER,e)):v.renderbufferStorage(v.RENDERBUFFER,v.RGBA4,t.width,t.height);v.bindRenderbuffer(v.RENDERBUFFER,null)}var l={},p;this.setTexture2D=s;this.setTextureCube=function(e,t){var r=g.get(e);if(6===e.image.length)if(0<e.version&&r.__version!==e.version){r.__image__webglTextureCube||(e.addEventListener("dispose",E),r.__image__webglTextureCube=v.createTexture(),b.memory.textures++);m.activeTexture(v.TEXTURE0+t);m.bindTexture(v.TEXTURE_CUBE_MAP,r.__image__webglTextureCube);v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,e.flipY);t=e&&e.isCompressedTexture;for(var n=e.image[0]&&e.image[0].isDataTexture,i=[],o=0;6>o;o++)i[o]=t||n?n?e.image[o].image:e.image[o]:w(e.image[o],_.maxCubemapSize);var a=i[0],s=x(a),u=y.convert(e.format),c=y.convert(e.type),h=C(u,c);T(v.TEXTURE_CUBE_MAP,e,s);for(o=0;6>o;o++)if(t)for(var l,p=i[o].mipmaps,f=0,d=p.length;f<d;f++)l=p[f],1023!==e.format&&1022!==e.format?-1<m.getCompressedTextureFormats().indexOf(u)?m.compressedTexImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+o,f,h,l.width,l.height,0,l.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):m.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+o,f,h,l.width,l.height,0,u,c,l.data);else n?m.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,h,i[o].width,i[o].height,0,u,c,i[o].data):m.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,h,u,c,i[o]);r.__maxMipLevel=t?p.length-1:0;S(e,s)&&M(v.TEXTURE_CUBE_MAP,e,a.width,a.height);r.__version=e.version;if(e.onUpdate)e.onUpdate(e)}else m.activeTexture(v.TEXTURE0+t),m.bindTexture(v.TEXTURE_CUBE_MAP,r.__image__webglTextureCube)};this.setTextureCubeDynamic=function(e,t){m.activeTexture(v.TEXTURE0+t);m.bindTexture(v.TEXTURE_CUBE_MAP,g.get(e).__webglTexture)};this.setupRenderTarget=function(e){var t=g.get(e),r=g.get(e.texture);e.addEventListener("dispose",a);r.__webglTexture=v.createTexture();b.memory.textures++;var n=!0===e.isWebGLRenderTargetCube,i=x(e);if(n){t.__webglFramebuffer=[];for(var o=0;6>o;o++)t.__webglFramebuffer[o]=v.createFramebuffer()}else t.__webglFramebuffer=v.createFramebuffer();if(n){m.bindTexture(v.TEXTURE_CUBE_MAP,r.__webglTexture);T(v.TEXTURE_CUBE_MAP,e.texture,i);for(o=0;6>o;o++)u(t.__webglFramebuffer[o],e,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+o);S(e.texture,i)&&M(v.TEXTURE_CUBE_MAP,e.texture,e.width,e.height);m.bindTexture(v.TEXTURE_CUBE_MAP,null)}else m.bindTexture(v.TEXTURE_2D,r.__webglTexture),T(v.TEXTURE_2D,e.texture,i),u(t.__webglFramebuffer,e,v.COLOR_ATTACHMENT0,v.TEXTURE_2D),S(e.texture,i)&&M(v.TEXTURE_2D,e.texture,e.width,e.height),m.bindTexture(v.TEXTURE_2D,null);if(e.depthBuffer){t=g.get(e);r=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(r)throw Error("target.depthTexture not supported in Cube render targets");if(e&&e.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported");v.bindFramebuffer(v.FRAMEBUFFER,t.__webglFramebuffer);if(!e.depthTexture||!e.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");g.get(e.depthTexture).__webglTexture&&e.depthTexture.image.width===e.width&&e.depthTexture.image.height===e.height||(e.depthTexture.image.width=e.width,e.depthTexture.image.height=e.height,e.depthTexture.needsUpdate=!0);s(e.depthTexture,0);t=g.get(e.depthTexture).__webglTexture;if(1026===e.depthTexture.format)v.framebufferTexture2D(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,v.TEXTURE_2D,t,0);else if(1027===e.depthTexture.format)v.framebufferTexture2D(v.FRAMEBUFFER,v.DEPTH_STENCIL_ATTACHMENT,v.TEXTURE_2D,t,0);else throw Error("Unknown depthTexture format")}else if(r)for(t.__webglDepthbuffer=[],r=0;6>r;r++)v.bindFramebuffer(v.FRAMEBUFFER,t.__webglFramebuffer[r]),t.__webglDepthbuffer[r]=v.createRenderbuffer(),c(t.__webglDepthbuffer[r],e);else v.bindFramebuffer(v.FRAMEBUFFER,t.__webglFramebuffer),t.__webglDepthbuffer=v.createRenderbuffer(),c(t.__webglDepthbuffer,e);v.bindFramebuffer(v.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=function(e){var t=e.texture,r=x(e);if(S(t,r)){r=e.isWebGLRenderTargetCube?v.TEXTURE_CUBE_MAP:v.TEXTURE_2D;var n=g.get(t).__webglTexture;m.bindTexture(r,n);M(r,t,e.width,e.height);m.bindTexture(r,null)}}}function vt(r,n,i){return{convert:function(e){if(1e3===e)return r.REPEAT;if(1001===e)return r.CLAMP_TO_EDGE;if(1002===e)return r.MIRRORED_REPEAT;if(1003===e)return r.NEAREST;if(1004===e)return r.NEAREST_MIPMAP_NEAREST;if(1005===e)return r.NEAREST_MIPMAP_LINEAR;if(1006===e)return r.LINEAR;if(1007===e)return r.LINEAR_MIPMAP_NEAREST;if(1008===e)return r.LINEAR_MIPMAP_LINEAR;if(1009===e)return r.UNSIGNED_BYTE;if(1017===e)return r.UNSIGNED_SHORT_4_4_4_4;if(1018===e)return r.UNSIGNED_SHORT_5_5_5_1;if(1019===e)return r.UNSIGNED_SHORT_5_6_5;if(1010===e)return r.BYTE;if(1011===e)return r.SHORT;if(1012===e)return r.UNSIGNED_SHORT;if(1013===e)return r.INT;if(1014===e)return r.UNSIGNED_INT;if(1015===e)return r.FLOAT;if(1016===e){if(i.isWebGL2)return r.HALF_FLOAT;var t=n.get("OES_texture_half_float");if(null!==t)return t.HALF_FLOAT_OES}if(1021===e)return r.ALPHA;if(1022===e)return r.RGB;if(1023===e)return r.RGBA;if(1024===e)return r.LUMINANCE;if(1025===e)return r.LUMINANCE_ALPHA;if(1026===e)return r.DEPTH_COMPONENT;if(1027===e)return r.DEPTH_STENCIL;if(100===e)return r.FUNC_ADD;if(101===e)return r.FUNC_SUBTRACT;if(102===e)return r.FUNC_REVERSE_SUBTRACT;if(200===e)return r.ZERO;if(201===e)return r.ONE;if(202===e)return r.SRC_COLOR;if(203===e)return r.ONE_MINUS_SRC_COLOR;if(204===e)return r.SRC_ALPHA;if(205===e)return r.ONE_MINUS_SRC_ALPHA;if(206===e)return r.DST_ALPHA;if(207===e)return r.ONE_MINUS_DST_ALPHA;if(208===e)return r.DST_COLOR;if(209===e)return r.ONE_MINUS_DST_COLOR;if(210===e)return r.SRC_ALPHA_SATURATE;if(33776===e||33777===e||33778===e||33779===e)if(t=n.get("WEBGL_compressed_texture_s3tc"),null!==t){if(33776===e)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e)if(t=n.get("WEBGL_compressed_texture_pvrtc"),null!==t){if(35840===e)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e&&(t=n.get("WEBGL_compressed_texture_etc1"),null!==t))return t.COMPRESSED_RGB_ETC1_WEBGL;if(37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e)if(t=n.get("WEBGL_compressed_texture_astc"),null!==t)return e;if(103===e||104===e){if(i.isWebGL2){if(103===e)return r.MIN;if(104===e)return r.MAX}t=n.get("EXT_blend_minmax");if(null!==t){if(103===e)return t.MIN_EXT;if(104===e)return t.MAX_EXT}}if(1020===e){if(i.isWebGL2)return r.UNSIGNED_INT_24_8;t=n.get("WEBGL_depth_texture");if(null!==t)return t.UNSIGNED_INT_24_8_WEBGL}return 0}}}function mt(){h.call(this);this.type="Group"}function gt(e,t,r,n){u.call(this);this.type="PerspectiveCamera";this.fov=void 0!==e?e:50;this.zoom=1;this.near=void 0!==r?r:.1;this.far=void 0!==n?n:2e3;this.focus=10;this.aspect=void 0!==t?t:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}function _t(e){gt.call(this);this.cameras=e||[]}function yt(r){function n(){return null!==c&&!0===c.isPresenting}function e(){if(n()){var e=c.getEyeParameters("left"),t=e.renderWidth;e=e.renderHeight;o=r.getPixelRatio();i=r.getSize();r.setDrawingBufferSize(2*t,e,1);a.start()}else u.enabled&&(r.setDrawingBufferSize(i.width,i.height,o),a.stop())}var u=this,c=null,h=null,l=null,p=[],f=new we,d=new we;"undefined"!==typeof window&&"VRFrameData"in window&&(h=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",e,!1));var v=new we,m=new s,g=new xe,_=new gt;_.bounds=new Se(0,0,.5,1);_.layers.enable(1);var y=new gt;y.bounds=new Se(.5,0,.5,1);y.layers.enable(2);var b=new _t([_,y]);b.layers.enable(1);b.layers.enable(2);var i,o,w=[];this.enabled=!1;this.userHeight=1.6;this.getController=function(e){var t=p[e];void 0===t&&(t=new mt,t.matrixAutoUpdate=!1,t.visible=!1,p[e]=t);return t};this.getDevice=function(){return c};this.setDevice=function(e){void 0!==e&&(c=e);a.setContext(e)};this.setPoseTarget=function(e){void 0!==e&&(l=e)};this.getCamera=function(e){if(null===c)return e.position.set(0,u.userHeight,0),e;c.depthNear=e.near;c.depthFar=e.far;c.getFrameData(h);var t=c.stageParameters;t?f.fromArray(t.sittingToStandingTransform):f.makeTranslation(0,u.userHeight,0);t=h.pose;var r=null!==l?l:e;r.matrix.copy(f);r.matrix.decompose(r.position,r.quaternion,r.scale);null!==t.orientation&&(m.fromArray(t.orientation),r.quaternion.multiply(m));null!==t.position&&(m.setFromRotationMatrix(f),g.fromArray(t.position),g.applyQuaternion(m),r.position.add(g));r.updateMatrixWorld();if(!1===c.isPresenting)return e;_.near=e.near;y.near=e.near;_.far=e.far;y.far=e.far;b.matrixWorld.copy(e.matrixWorld);b.matrixWorldInverse.copy(e.matrixWorldInverse);_.matrixWorldInverse.fromArray(h.leftViewMatrix);y.matrixWorldInverse.fromArray(h.rightViewMatrix);d.getInverse(f);_.matrixWorldInverse.multiply(d);y.matrixWorldInverse.multiply(d);e=r.parent;null!==e&&(v.getInverse(e.matrixWorld),_.matrixWorldInverse.multiply(v),y.matrixWorldInverse.multiply(v));_.matrixWorld.getInverse(_.matrixWorldInverse);y.matrixWorld.getInverse(y.matrixWorldInverse);_.projectionMatrix.fromArray(h.leftProjectionMatrix);y.projectionMatrix.fromArray(h.rightProjectionMatrix);b.projectionMatrix.copy(_.projectionMatrix);e=c.getLayers();e.length&&(e=e[0],null!==e.leftBounds&&4===e.leftBounds.length&&_.bounds.fromArray(e.leftBounds),null!==e.rightBounds&&4===e.rightBounds.length&&y.bounds.fromArray(e.rightBounds));e:for(e=0;e<p.length;e++){t=p[e];t:{r=e;for(var n=navigator.getGamepads&&navigator.getGamepads(),i=0,o=0,a=n.length;i<a;i++){var s=n[i];if(s&&("Daydream Controller"===s.id||"Gear VR Controller"===s.id||"Oculus Go Controller"===s.id||"OpenVR Gamepad"===s.id||s.id.startsWith("Oculus Touch")||s.id.startsWith("Spatial Controller"))){if(o===r){r=s;break t}o++}}r=void 0}if(void 0!==r&&void 0!==r.pose){if(null===r.pose)break e;n=r.pose;!1===n.hasPosition&&t.position.set(.2,-.6,-.05);null!==n.position&&t.position.fromArray(n.position);null!==n.orientation&&t.quaternion.fromArray(n.orientation);t.matrix.compose(t.position,t.quaternion,t.scale);t.matrix.premultiply(f);t.matrix.decompose(t.position,t.quaternion,t.scale);t.matrixWorldNeedsUpdate=!0;t.visible=!0;n="Daydream Controller"===r.id?0:1;w[e]!==r.buttons[n].pressed&&(w[e]=r.buttons[n].pressed,!0===w[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}return b};this.getStandingMatrix=function(){return f};this.isPresenting=n;var a=new Ee;this.setAnimationLoop=function(e){a.setAnimationLoop(e)};this.submitFrame=function(){n()&&c.submitFrame()};this.dispose=function(){"undefined"!==typeof window&&window.removeEventListener("vrdisplaypresentchange",e)}}function bt(r){function i(){return null!==c&&null!==h}function n(e){var t=p[f.indexOf(e.inputSource)];t&&t.dispatchEvent({type:e.type})}function o(){r.setFramebuffer(null);m.stop()}function a(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix);e.matrixWorldInverse.getInverse(e.matrixWorld)}var s=r.context,t=null,c=null,h=null,l=null,p=[],f=[],e=new gt;e.layers.enable(1);e.viewport=new Se;var u=new gt;u.layers.enable(2);u.viewport=new Se;var d=new _t([e,u]);d.layers.enable(1);d.layers.enable(2);this.enabled=!1;this.getController=function(e){var t=p[e];void 0===t&&(t=new mt,t.matrixAutoUpdate=!1,t.visible=!1,p[e]=t);return t};this.getDevice=function(){return t};this.setDevice=function(e){void 0!==e&&(t=e);e instanceof XRDevice&&s.setCompatibleXRDevice(e)};this.setSession=function(e,t){c=e;null!==c&&(c.addEventListener("select",n),c.addEventListener("selectstart",n),c.addEventListener("selectend",n),c.addEventListener("end",o),c.baseLayer=new XRWebGLLayer(c,s),c.requestFrameOfReference(t.frameOfReferenceType).then(function(e){h=e;r.setFramebuffer(c.baseLayer.framebuffer);m.setContext(c);m.start()}),f=c.getInputSources(),c.addEventListener("inputsourceschange",function(){f=c.getInputSources();console.log(f)}))};this.getCamera=function(e){if(i()){var t=e.parent,r=d.cameras;a(d,t);for(var n=0;n<r.length;n++)a(r[n],t);e.matrixWorld.copy(d.matrixWorld);e=e.children;n=0;for(t=e.length;n<t;n++)e[n].updateMatrixWorld(!0);return d}return e};this.isPresenting=i;var v=null,m=new Ee;m.setAnimationLoop(function(e,t){l=t.getDevicePose(h);if(null!==l)for(var r=c.baseLayer,n=t.views,i=0;i<n.length;i++){var o=n[i],a=r.getViewport(o),s=l.getViewMatrix(o),u=d.cameras[i];u.matrix.fromArray(s).getInverse(u.matrix);u.projectionMatrix.fromArray(o.projectionMatrix);u.viewport.set(a.x,a.y,a.width,a.height);0===i&&(d.matrix.copy(u.matrix),d.projectionMatrix.copy(u.projectionMatrix))}for(i=0;i<p.length;i++){r=p[i];if(n=f[i])if(n=t.getInputPose(n,h),null!==n){r.matrix.elements=n.pointerMatrix;r.matrix.decompose(r.position,r.rotation,r.scale);r.visible=!0;continue}r.visible=!1}v&&v(e)});this.setAnimationLoop=function(e){v=e};this.dispose=function(){};this.getStandingMatrix=function(){console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed.");return new THREE.Matrix4};this.submitFrame=function(){}}function wt(e){var x;function t(){ee=new Re(Q);te=new Ae(Q,ee,e);te.isWebGL2||(ee.get("WEBGL_depth_texture"),ee.get("OES_texture_float"),ee.get("OES_texture_half_float"),ee.get("OES_texture_half_float_linear"),ee.get("OES_standard_derivatives"),ee.get("OES_element_index_uint"),ee.get("ANGLE_instanced_arrays"));ee.get("OES_texture_float_linear");me=new vt(Q,ee,te);re=new ft(Q,ee,me,te);re.scissor(B.copy(H).multiplyScalar(G));re.viewport(D.copy(V).multiplyScalar(G));ne=new Ie(Q);ie=new tt;oe=new dt(Q,ee,re,ie,te,me,ne);ae=new Te(Q);se=new ke(Q,ae,ne);ue=new De(se,ne);fe=new Ne(Q);ce=new et(T,ee,te);he=new ot;le=new ct;pe=new Oe(T,re,ue,b);de=new Pe(Q,ee,ne,te);ve=new Le(Q,ee,ne,te);ne.programs=ce.programs;T.context=Q;T.capabilities=te;T.extensions=ee;T.properties=ie;T.renderLists=he;T.state=re;T.info=ne}function r(e){e.preventDefault();console.log("THREE.WebGLRenderer: Context Lost.");O=!0}function n(){console.log("THREE.WebGLRenderer: Context Restored.");O=!1;t()}function h(e){e=e.target;e.removeEventListener("dispose",h);l(e);ie.remove(e)}function l(e){var t=ie.get(e).program;e.program=void 0;void 0!==t&&ce.releaseProgram(t)}function s(e,t){e.render(function(e){T.renderBufferImmediate(e,t)})}function p(e,t,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isLight)E.pushLight(e),e.castShadow&&E.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||W.intersectsSprite(e)){r&&J.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Z);var n=ue.update(e),i=e.material;C.push(e,n,i,J.z,null)}}else if(e.isImmediateRenderObject)r&&J.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Z),C.push(e,null,e.material,J.z,null);else if(e.isMesh||e.isLine||e.isPoints)if(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||W.intersectsObject(e))if(r&&J.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Z),n=ue.update(e),i=e.material,Array.isArray(i))for(var o=n.groups,a=0,s=o.length;a<s;a++){var u=o[a],c=i[u.materialIndex];c&&c.visible&&C.push(e,n,c,J.z,u)}else i.visible&&C.push(e,n,i,J.z,null);e=e.children;a=0;for(s=e.length;a<s;a++)p(e[a],t,r)}}function a(e,t,r,n){for(var i=0,o=e.length;i<o;i++){var a=e[i],s=a.object,u=a.geometry,c=void 0===n?a.material:n;a=a.group;if(r.isArrayCamera){N=r;for(var h=r.cameras,l=0,p=h.length;l<p;l++){var f=h[l];if(s.layers.test(f.layers)){if("viewport"in f)re.viewport(D.copy(f.viewport));else{var d=f.bounds;re.viewport(D.set(d.x*$,d.y*U,d.z*$,d.w*U).multiplyScalar(G))}v(s,t,f,u,c,a)}}}else N=null,v(s,t,r,u,c,a)}}function v(e,t,r,n,i,o){e.onBeforeRender(T,t,r,n,i,o);E=le.get(t,N||r);e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld);e.normalMatrix.getNormalMatrix(e.modelViewMatrix);if(e.isImmediateRenderObject){re.setMaterial(i);var a=S(r,t.fog,i,e);k=x=null;L=!1;s(e,a)}else T.renderBufferDirect(r,t.fog,n,i,e,o);e.onAfterRender(T,t,r,n,i,o);E=le.get(t,N||r)}function f(e,t,r){var n=ie.get(e),i=E.state.lights,o=n.lightsHash,a=i.state.hash;r=ce.getParameters(e,i.state,E.state.shadowsArray,t,X.numPlanes,X.numIntersection,r);var s=ce.getProgramCode(e,r),u=n.program,c=!0;if(void 0===u)e.addEventListener("dispose",h);else if(u.code!==s)l(e);else{if(o.stateID!==a.stateID||o.directionalLength!==a.directionalLength||o.pointLength!==a.pointLength||o.spotLength!==a.spotLength||o.rectAreaLength!==a.rectAreaLength||o.hemiLength!==a.hemiLength||o.shadowsLength!==a.shadowsLength)o.stateID=a.stateID,o.directionalLength=a.directionalLength,o.pointLength=a.pointLength,o.spotLength=a.spotLength,o.rectAreaLength=a.rectAreaLength,o.hemiLength=a.hemiLength,o.shadowsLength=a.shadowsLength;else if(void 0!==r.shaderID)return;c=!1}c&&(r.shaderID?(s=so[r.shaderID],n.shader={name:e.type,uniforms:io.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}):n.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader},e.onBeforeCompile(n.shader,T),s=ce.getProgramCode(e,r),u=ce.acquireProgram(e,n.shader,r,s),n.program=u,e.program=u);r=u.getAttributes();if(e.morphTargets)for(s=e.numSupportedMorphTargets=0;s<T.maxMorphTargets;s++)0<=r["morphTarget"+s]&&e.numSupportedMorphTargets++;if(e.morphNormals)for(s=e.numSupportedMorphNormals=0;s<T.maxMorphNormals;s++)0<=r["morphNormal"+s]&&e.numSupportedMorphNormals++;r=n.shader.uniforms;if(!e.isShaderMaterial&&!e.isRawShaderMaterial||!0===e.clipping)n.numClippingPlanes=X.numPlanes,n.numIntersection=X.numIntersection,r.clippingPlanes=X.uniform;n.fog=t;void 0===o&&(n.lightsHash=o={});o.stateID=a.stateID;o.directionalLength=a.directionalLength;o.pointLength=a.pointLength;o.spotLength=a.spotLength;o.rectAreaLength=a.rectAreaLength;o.hemiLength=a.hemiLength;o.shadowsLength=a.shadowsLength;e.lights&&(r.ambientLightColor.value=i.state.ambient,r.directionalLights.value=i.state.directional,r.spotLights.value=i.state.spot,r.rectAreaLights.value=i.state.rectArea,r.pointLights.value=i.state.point,r.hemisphereLights.value=i.state.hemi,r.directionalShadowMap.value=i.state.directionalShadowMap,r.directionalShadowMatrix.value=i.state.directionalShadowMatrix,r.spotShadowMap.value=i.state.spotShadowMap,r.spotShadowMatrix.value=i.state.spotShadowMatrix,r.pointShadowMap.value=i.state.pointShadowMap,r.pointShadowMatrix.value=i.state.pointShadowMatrix);e=n.program.getUniforms();e=Fe.seqWithValue(e.seq,r);n.uniformsList=e}function S(e,t,r,n){z=0;var i=ie.get(r),o=i.lightsHash,a=E.state.lights.state.hash;Y&&(K||e!==I)&&X.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,e,i,e===I&&r.id===R);!1===r.needsUpdate&&(void 0===i.program?r.needsUpdate=!0:r.fog&&i.fog!==t?r.needsUpdate=!0:!r.lights||o.stateID===a.stateID&&o.directionalLength===a.directionalLength&&o.pointLength===a.pointLength&&o.spotLength===a.spotLength&&o.rectAreaLength===a.rectAreaLength&&o.hemiLength===a.hemiLength&&o.shadowsLength===a.shadowsLength?void 0===i.numClippingPlanes||i.numClippingPlanes===X.numPlanes&&i.numIntersection===X.numIntersection||(r.needsUpdate=!0):r.needsUpdate=!0);r.needsUpdate&&(f(r,t,n),r.needsUpdate=!1);var s=!1,u=!1,c=!1;o=i.program;a=o.getUniforms();var h=i.shader.uniforms;re.useProgram(o.program)&&(c=u=s=!0);r.id!==R&&(R=r.id,u=!0);if(s||e!==I){a.setValue(Q,"projectionMatrix",e.projectionMatrix);te.logarithmicDepthBuffer&&a.setValue(Q,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2));I!==(N||e)&&(I=N||e,c=u=!0);if(r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap)s=a.map.cameraPosition,void 0!==s&&s.setValue(Q,J.setFromMatrixPosition(e.matrixWorld));(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&a.setValue(Q,"viewMatrix",e.matrixWorldInverse)}if(r.skinning&&(a.setOptional(Q,n,"bindMatrix"),a.setOptional(Q,n,"bindMatrixInverse"),e=n.skeleton))if(s=e.bones,te.floatVertexTextures){if(void 0===e.boneTexture){s=Math.sqrt(4*s.length);s=eo.ceilPowerOfTwo(s);s=Math.max(s,4);var l=new Float32Array(s*s*4);l.set(e.boneMatrices);var p=new Me(l,s,s,1023,1015);p.needsUpdate=!0;e.boneMatrices=l;e.boneTexture=p;e.boneTextureSize=s}a.setValue(Q,"boneTexture",e.boneTexture);a.setValue(Q,"boneTextureSize",e.boneTextureSize)}else a.setOptional(Q,e,"boneMatrices");u&&(a.setValue(Q,"toneMappingExposure",T.toneMappingExposure),a.setValue(Q,"toneMappingWhitePoint",T.toneMappingWhitePoint),r.lights&&(u=c,h.ambientLightColor.needsUpdate=u,h.directionalLights.needsUpdate=u,h.pointLights.needsUpdate=u,h.spotLights.needsUpdate=u,h.rectAreaLights.needsUpdate=u,h.hemisphereLights.needsUpdate=u),t&&r.fog&&(h.fogColor.value=t.color,t.isFog?(h.fogNear.value=t.near,h.fogFar.value=t.far):t.isFogExp2&&(h.fogDensity.value=t.density)),r.isMeshBasicMaterial?d(h,r):r.isMeshLambertMaterial?(d(h,r),r.emissiveMap&&(h.emissiveMap.value=r.emissiveMap)):r.isMeshPhongMaterial?(d(h,r),r.isMeshToonMaterial?(m(h,r),r.gradientMap&&(h.gradientMap.value=r.gradientMap)):m(h,r)):r.isMeshStandardMaterial?(d(h,r),r.isMeshPhysicalMaterial?(g(h,r),h.reflectivity.value=r.reflectivity,h.clearCoat.value=r.clearCoat,h.clearCoatRoughness.value=r.clearCoatRoughness):g(h,r)):r.isMeshDepthMaterial?(d(h,r),r.displacementMap&&(h.displacementMap.value=r.displacementMap,h.displacementScale.value=r.displacementScale,h.displacementBias.value=r.displacementBias)):r.isMeshDistanceMaterial?(d(h,r),r.displacementMap&&(h.displacementMap.value=r.displacementMap,h.displacementScale.value=r.displacementScale,h.displacementBias.value=r.displacementBias),h.referencePosition.value.copy(r.referencePosition),h.nearDistance.value=r.nearDistance,h.farDistance.value=r.farDistance):r.isMeshNormalMaterial?(d(h,r),r.bumpMap&&(h.bumpMap.value=r.bumpMap,h.bumpScale.value=r.bumpScale,1===r.side&&(h.bumpScale.value*=-1)),r.normalMap&&(h.normalMap.value=r.normalMap,h.normalScale.value.copy(r.normalScale),1===r.side&&h.normalScale.value.negate()),r.displacementMap&&(h.displacementMap.value=r.displacementMap,h.displacementScale.value=r.displacementScale,h.displacementBias.value=r.displacementBias)):r.isLineBasicMaterial?(h.diffuse.value=r.color,h.opacity.value=r.opacity,r.isLineDashedMaterial&&(h.dashSize.value=r.dashSize,h.totalSize.value=r.dashSize+r.gapSize,h.scale.value=r.scale)):r.isPointsMaterial?(h.diffuse.value=r.color,h.opacity.value=r.opacity,h.size.value=r.size*G,h.scale.value=.5*U,h.map.value=r.map,null!==r.map&&(!0===r.map.matrixAutoUpdate&&r.map.updateMatrix(),h.uvTransform.value.copy(r.map.matrix))):r.isSpriteMaterial?(h.diffuse.value=r.color,h.opacity.value=r.opacity,h.rotation.value=r.rotation,h.map.value=r.map,null!==r.map&&(!0===r.map.matrixAutoUpdate&&r.map.updateMatrix(),h.uvTransform.value.copy(r.map.matrix))):r.isShadowMaterial&&(h.color.value=r.color,h.opacity.value=r.opacity),void 0!==h.ltc_1&&(h.ltc_1.value=ao.LTC_1),void 0!==h.ltc_2&&(h.ltc_2.value=ao.LTC_2),Fe.upload(Q,i.uniformsList,h,T));r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Fe.upload(Q,i.uniformsList,h,T),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&a.setValue(Q,"center",n.center);a.setValue(Q,"modelViewMatrix",n.modelViewMatrix);a.setValue(Q,"normalMatrix",n.normalMatrix);a.setValue(Q,"modelMatrix",n.matrixWorld);return o}function d(e,t){e.opacity.value=t.opacity;t.color&&(e.diffuse.value=t.color);t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity);t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.specularMap&&(e.specularMap.value=t.specularMap);t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=ie.get(t.envMap).__maxMipLevel);t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity);t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);if(t.map)var r=t.map;else t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap);void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}function m(e,t){e.specular.value=t.specular;e.shininess.value=Math.max(t.shininess,1e-4);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function g(e,t){e.roughness.value=t.roughness;e.metalness.value=t.metalness;t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap);t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}console.log("THREE.WebGLRenderer","95");e=e||{};var i=void 0!==e.canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),o=void 0!==e.context?e.context:null,u=void 0!==e.alpha?e.alpha:!1,c=void 0!==e.depth?e.depth:!0,_=void 0!==e.stencil?e.stencil:!0,y=void 0!==e.antialias?e.antialias:!1,b=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,w=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,M=void 0!==e.powerPreference?e.powerPreference:"default",C=null,E=null;this.domElement=i;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var T=this,O=!1,P=null,A=null,j=null,R=-1;var k=x=null;var L=!1;var I=null,N=null,D=new Se,B=new Se,F=null,z=0,$=i.width,U=i.height,G=1,V=new Se(0,0,$,U),H=new Se(0,0,$,U),q=!1,W=new Ce,X=new je,Y=!1,K=!1,Z=new we,J=new xe;try{u={alpha:u,depth:c,stencil:_,antialias:y,premultipliedAlpha:b,preserveDrawingBuffer:w,powerPreference:M};i.addEventListener("webglcontextlost",r,!1);i.addEventListener("webglcontextrestored",n,!1);var Q=o||i.getContext("webgl",u)||i.getContext("experimental-webgl",u);if(null===Q){if(null!==i.getContext("webgl"))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}void 0===Q.getShaderPrecisionFormat&&(Q.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){console.error("THREE.WebGLRenderer: "+e.message)}var ee,te,re,ne,ie,oe,ae,se,ue,ce,he,le,pe,fe,de,ve,me;t();var ge="xr"in navigator?new bt(T):new yt(T);this.vr=ge;var _e=new pt(T,ue,te.maxTextureSize);this.shadowMap=_e;this.getContext=function(){return Q};this.getContextAttributes=function(){return Q.getContextAttributes()};this.forceContextLoss=function(){var e=ee.get("WEBGL_lose_context");e&&e.loseContext()};this.forceContextRestore=function(){var e=ee.get("WEBGL_lose_context");e&&e.restoreContext()};this.getPixelRatio=function(){return G};this.setPixelRatio=function(e){void 0!==e&&(G=e,this.setSize($,U,!1))};this.getSize=function(){return{width:$,height:U}};this.setSize=function(e,t,r){ge.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):($=e,U=t,i.width=e*G,i.height=t*G,!1!==r&&(i.style.width=e+"px",i.style.height=t+"px"),this.setViewport(0,0,e,t))};this.getDrawingBufferSize=function(){return{width:$*G,height:U*G}};this.setDrawingBufferSize=function(e,t,r){$=e;U=t;G=r;i.width=e*r;i.height=t*r;this.setViewport(0,0,e,t)};this.getCurrentViewport=function(){return D};this.setViewport=function(e,t,r,n){V.set(e,U-t-n,r,n);re.viewport(D.copy(V).multiplyScalar(G))};this.setScissor=function(e,t,r,n){H.set(e,U-t-n,r,n);re.scissor(B.copy(H).multiplyScalar(G))};this.setScissorTest=function(e){re.setScissorTest(q=e)};this.getClearColor=function(){return pe.getClearColor()};this.setClearColor=function(){pe.setClearColor.apply(pe,arguments)};this.getClearAlpha=function(){return pe.getClearAlpha()};this.setClearAlpha=function(){pe.setClearAlpha.apply(pe,arguments)};this.clear=function(e,t,r){var n=0;if(void 0===e||e)n|=Q.COLOR_BUFFER_BIT;if(void 0===t||t)n|=Q.DEPTH_BUFFER_BIT;if(void 0===r||r)n|=Q.STENCIL_BUFFER_BIT;Q.clear(n)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(e,t,r,n){this.setRenderTarget(e);this.clear(t,r,n)};this.dispose=function(){i.removeEventListener("webglcontextlost",r,!1);i.removeEventListener("webglcontextrestored",n,!1);he.dispose();le.dispose();ie.dispose();ue.dispose();ge.dispose();be.stop()};this.renderBufferImmediate=function(e,t){re.initAttributes();var r=ie.get(e);e.hasPositions&&!r.position&&(r.position=Q.createBuffer());e.hasNormals&&!r.normal&&(r.normal=Q.createBuffer());e.hasUvs&&!r.uv&&(r.uv=Q.createBuffer());e.hasColors&&!r.color&&(r.color=Q.createBuffer());t=t.getAttributes();e.hasPositions&&(Q.bindBuffer(Q.ARRAY_BUFFER,r.position),Q.bufferData(Q.ARRAY_BUFFER,e.positionArray,Q.DYNAMIC_DRAW),re.enableAttribute(t.position),Q.vertexAttribPointer(t.position,3,Q.FLOAT,!1,0,0));e.hasNormals&&(Q.bindBuffer(Q.ARRAY_BUFFER,r.normal),Q.bufferData(Q.ARRAY_BUFFER,e.normalArray,Q.DYNAMIC_DRAW),re.enableAttribute(t.normal),Q.vertexAttribPointer(t.normal,3,Q.FLOAT,!1,0,0));e.hasUvs&&(Q.bindBuffer(Q.ARRAY_BUFFER,r.uv),Q.bufferData(Q.ARRAY_BUFFER,e.uvArray,Q.DYNAMIC_DRAW),re.enableAttribute(t.uv),Q.vertexAttribPointer(t.uv,2,Q.FLOAT,!1,0,0));e.hasColors&&(Q.bindBuffer(Q.ARRAY_BUFFER,r.color),Q.bufferData(Q.ARRAY_BUFFER,e.colorArray,Q.DYNAMIC_DRAW),re.enableAttribute(t.color),Q.vertexAttribPointer(t.color,3,Q.FLOAT,!1,0,0));re.disableUnusedAttributes();Q.drawArrays(Q.TRIANGLES,0,e.count);e.count=0};this.renderBufferDirect=function(e,t,r,n,i,o){var a=i.isMesh&&0>i.normalMatrix.determinant();re.setMaterial(n,a);var s=S(e,t,n,i),u=!1;if(x!==r.id||k!==s.id||L!==(!0===n.wireframe))x=r.id,k=s.id,L=!0===n.wireframe,u=!0;i.morphTargetInfluences&&(fe.update(i,r,n,s),u=!0);a=r.index;var c=r.attributes.position;t=1;!0===n.wireframe&&(a=se.getWireframeAttribute(r),t=2);e=de;if(null!==a){var h=ae.get(a);e=ve;e.setIndex(h)}if(u){if(r&&r.isInstancedBufferGeometry&!te.isWebGL2&&null===ee.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{re.initAttributes();u=r.attributes;s=s.getAttributes();var l=n.defaultAttributeValues;for(w in s){var p=s[w];if(0<=p){var f=u[w];if(void 0!==f){var d=f.normalized,v=f.itemSize,m=ae.get(f);if(void 0!==m){var g=m.buffer,_=m.type;m=m.bytesPerElement;if(f.isInterleavedBufferAttribute){var y=f.data,b=y.stride;f=f.offset;y&&y.isInstancedInterleavedBuffer?(re.enableAttributeAndDivisor(p,y.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=y.meshPerAttribute*y.count)):re.enableAttribute(p);Q.bindBuffer(Q.ARRAY_BUFFER,g);Q.vertexAttribPointer(p,v,_,d,b*m,f*m)}else f.isInstancedBufferAttribute?(re.enableAttributeAndDivisor(p,f.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=f.meshPerAttribute*f.count)):re.enableAttribute(p),Q.bindBuffer(Q.ARRAY_BUFFER,g),Q.vertexAttribPointer(p,v,_,d,0,0)}}else if(void 0!==l&&(d=l[w],void 0!==d))switch(d.length){case 2:Q.vertexAttrib2fv(p,d);break;case 3:Q.vertexAttrib3fv(p,d);break;case 4:Q.vertexAttrib4fv(p,d);break;default:Q.vertexAttrib1fv(p,d)}}}re.disableUnusedAttributes()}null!==a&&Q.bindBuffer(Q.ELEMENT_ARRAY_BUFFER,h.buffer)}h=Infinity;null!==a?h=a.count:void 0!==c&&(h=c.count);a=r.drawRange.start*t;c=null!==o?o.start*t:0;var w=Math.max(a,c);o=Math.max(0,Math.min(h,a+r.drawRange.count*t,c+(null!==o?o.count*t:Infinity))-1-w+1);if(0!==o){if(i.isMesh)if(!0===n.wireframe)re.setLineWidth(n.wireframeLinewidth*(null===A?G:1)),e.setMode(Q.LINES);else switch(i.drawMode){case 0:e.setMode(Q.TRIANGLES);break;case 1:e.setMode(Q.TRIANGLE_STRIP);break;case 2:e.setMode(Q.TRIANGLE_FAN)}else i.isLine?(n=n.linewidth,void 0===n&&(n=1),re.setLineWidth(n*(null===A?G:1)),i.isLineSegments?e.setMode(Q.LINES):i.isLineLoop?e.setMode(Q.LINE_LOOP):e.setMode(Q.LINE_STRIP)):i.isPoints?e.setMode(Q.POINTS):i.isSprite&&e.setMode(Q.TRIANGLES);r&&r.isInstancedBufferGeometry?0<r.maxInstancedCount&&e.renderInstances(r,w,o):e.render(w,o)}};this.compile=function(r,e){E=le.get(r,e);E.init();r.traverse(function(e){e.isLight&&(E.pushLight(e),e.castShadow&&E.pushShadow(e))});E.setupLights(e);r.traverse(function(e){if(e.material)if(Array.isArray(e.material))for(var t=0;t<e.material.length;t++)f(e.material[t],r.fog,e);else f(e.material,r.fog,e)})};var ye=null,be=new Ee;be.setAnimationLoop(function(e){ge.isPresenting()||ye&&ye(e)});"undefined"!==typeof window&&be.setContext(window);this.setAnimationLoop=function(e){ye=e;ge.setAnimationLoop(e);be.start()};this.render=function(e,t,r,n){if(!t||!t.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else if(!O){k=x=null;L=!1;R=-1;I=null;!0===e.autoUpdate&&e.updateMatrixWorld();null===t.parent&&t.updateMatrixWorld();ge.enabled&&(t=ge.getCamera(t));E=le.get(e,t);E.init();e.onBeforeRender(T,e,t,r);Z.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);W.setFromMatrix(Z);K=this.localClippingEnabled;Y=X.init(this.clippingPlanes,K,t);C=he.get(e,t);C.init();p(e,t,T.sortObjects);!0===T.sortObjects&&C.sort();Y&&X.beginShadows();_e.render(E.state.shadowsArray,e,t);E.setupLights(t);Y&&X.endShadows();this.info.autoReset&&this.info.reset();void 0===r&&(r=null);this.setRenderTarget(r);pe.render(C,e,t,n);n=C.opaque;var i=C.transparent;if(e.overrideMaterial){var o=e.overrideMaterial;n.length&&a(n,e,t,o);i.length&&a(i,e,t,o)}else n.length&&a(n,e,t),i.length&&a(i,e,t);r&&oe.updateRenderTargetMipmap(r);re.buffers.depth.setTest(!0);re.buffers.depth.setMask(!0);re.buffers.color.setMask(!0);re.setPolygonOffset(!1);e.onAfterRender(T,e,t);ge.enabled&&ge.submitFrame();E=C=null}};this.allocTextureUnit=function(){var e=z;e>=te.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+te.maxTextures);z+=1;return e};this.setTexture2D=function(){var r=!1;return function(e,t){e&&e.isWebGLRenderTarget&&(r||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),r=!0),e=e.texture);oe.setTexture2D(e,t)}}();this.setTexture=function(){var r=!1;return function(e,t){r||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),r=!0);oe.setTexture2D(e,t)}}();this.setTextureCube=function(){var r=!1;return function(e,t){e&&e.isWebGLRenderTargetCube&&(r||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),r=!0),e=e.texture);e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?oe.setTextureCube(e,t):oe.setTextureCubeDynamic(e,t)}}();this.setFramebuffer=function(e){P=e};this.getRenderTarget=function(){return A};this.setRenderTarget=function(e){(A=e)&&void 0===ie.get(e).__webglFramebuffer&&oe.setupRenderTarget(e);var t=P,r=!1;e?(t=ie.get(e).__webglFramebuffer,e.isWebGLRenderTargetCube&&(t=t[e.activeCubeFace],r=!0),D.copy(e.viewport),B.copy(e.scissor),F=e.scissorTest):(D.copy(V).multiplyScalar(G),B.copy(H).multiplyScalar(G),F=q);j!==t&&(Q.bindFramebuffer(Q.FRAMEBUFFER,t),j=t);re.viewport(D);re.scissor(B);re.setScissorTest(F);r&&(r=ie.get(e.texture),Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,r.__webglTexture,e.activeMipMapLevel))};this.readRenderTargetPixels=function(e,t,r,n,i,o){if(e&&e.isWebGLRenderTarget){var a=ie.get(e).__webglFramebuffer;if(a){var s=!1;a!==j&&(Q.bindFramebuffer(Q.FRAMEBUFFER,a),s=!0);try{var u=e.texture,c=u.format,h=u.type;1023!==c&&me.convert(c)!==Q.getParameter(Q.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===h||me.convert(h)===Q.getParameter(Q.IMPLEMENTATION_COLOR_READ_TYPE)||1015===h&&(te.isWebGL2||ee.get("OES_texture_float")||ee.get("WEBGL_color_buffer_float"))||1016===h&&(te.isWebGL2?ee.get("EXT_color_buffer_float"):ee.get("EXT_color_buffer_half_float"))?Q.checkFramebufferStatus(Q.FRAMEBUFFER)===Q.FRAMEBUFFER_COMPLETE?0<=t&&t<=e.width-n&&0<=r&&r<=e.height-i&&Q.readPixels(t,r,n,i,me.convert(c),me.convert(h),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{s&&Q.bindFramebuffer(Q.FRAMEBUFFER,j)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")};this.copyFramebufferToTexture=function(e,t,r){var n=t.image.width,i=t.image.height,o=me.convert(t.format);this.setTexture2D(t,0);Q.copyTexImage2D(Q.TEXTURE_2D,r||0,o,e.x,e.y,n,i,0)};this.copyTextureToTexture=function(e,t,r,n){var i=t.image.width,o=t.image.height,a=me.convert(r.format),s=me.convert(r.type);this.setTexture2D(r,0);t.isDataTexture?Q.texSubImage2D(Q.TEXTURE_2D,n||0,e.x,e.y,i,o,a,s,t.image.data):Q.texSubImage2D(Q.TEXTURE_2D,n||0,e.x,e.y,a,s,t.image)}}function xt(e,t){this.name="";this.color=new x(e);this.density=void 0!==t?t:25e-5}function St(e,t,r){this.name="";this.color=new x(e);this.near=void 0!==t?t:1;this.far=void 0!==r?r:1e3}function Mt(){h.call(this);this.type="Scene";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0}function Ct(e,t){this.array=e;this.stride=t;this.count=void 0!==e?e.length/t:0;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0}function Et(e,t,r,n){this.data=e;this.itemSize=t;this.offset=r;this.normalized=!0===n}function Tt(e){L.call(this);this.type="SpriteMaterial";this.color=new x(16777215);this.map=null;this.rotation=0;this.lights=!1;this.transparent=!0;this.setValues(e)}function Ot(e){h.call(this);this.type="Sprite";if(void 0===So){So=new A;var t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);t=new Ct(t,5);So.setIndex([0,1,2,0,2,3]);So.addAttribute("position",new Et(t,3,0,!1));So.addAttribute("uv",new Et(t,2,3,!1))}this.geometry=So;this.material=void 0!==e?e:new Tt;this.center=new H(.5,.5)}function Pt(){h.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function At(e,t){e=e||[];this.bones=e.slice(0);this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else for(console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[],e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new we)}function jt(){h.call(this);this.type="Bone"}function Rt(e,t){z.call(this,e,t);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new we;this.bindMatrixInverse=new we;e=this.initBones();e=new At(e);this.bind(e,this.matrixWorld);this.normalizeSkinWeights()}function kt(e){L.call(this);this.type="LineBasicMaterial";this.color=new x(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.lights=!1;this.setValues(e)}function Lt(e,t,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead.");h.call(this);this.type="Line";this.geometry=void 0!==e?e:new A;this.material=void 0!==t?t:new kt({color:16777215*Math.random()})}function It(e,t){Lt.call(this,e,t);this.type="LineSegments"}function Nt(e,t){Lt.call(this,e,t);this.type="LineLoop"}function Dt(e){L.call(this);this.type="PointsMaterial";this.color=new x(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.lights=this.morphTargets=!1;this.setValues(e)}function Bt(e,t){h.call(this);this.type="Points";this.geometry=void 0!==e?e:new A;this.material=void 0!==t?t:new Dt({color:16777215*Math.random()})}function Ft(e,t,r,n,i,o,a,s,u){p.call(this,e,t,r,n,i,o,a,s,u);this.generateMipmaps=!1}function zt(e,t,r,n,i,o,a,s,u,c,h,l){p.call(this,null,o,a,s,u,c,n,i,h,l);this.image={width:t,height:r};this.mipmaps=e;this.generateMipmaps=this.flipY=!1}function $t(e,t,r,n,i,o,a,s,u){p.call(this,e,t,r,n,i,o,a,s,u);this.needsUpdate=!0}function Ut(e,t,r,n,i,o,a,s,u,c){c=void 0!==c?c:1026;if(1026!==c&&1027!==c)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&1026===c&&(r=1012);void 0===r&&1027===c&&(r=1020);p.call(this,null,n,i,o,a,s,c,r,u);this.image={width:e,height:t};this.magFilter=void 0!==a?a:1003;this.minFilter=void 0!==s?s:1003;this.generateMipmaps=this.flipY=!1}function Gt(e){A.call(this);this.type="WireframeGeometry";var t=[],r,n,i,o=[0,0],a={},s=["a","b","c"];if(e&&e.isGeometry){var u=e.faces;var c=0;for(n=u.length;c<n;c++){var h=u[c];for(r=0;3>r;r++){var l=h[s[r]];var p=h[s[(r+1)%3]];o[0]=Math.min(l,p);o[1]=Math.max(l,p);l=o[0]+","+o[1];void 0===a[l]&&(a[l]={index1:o[0],index2:o[1]})}}for(l in a)c=a[l],s=e.vertices[c.index1],t.push(s.x,s.y,s.z),s=e.vertices[c.index2],t.push(s.x,s.y,s.z)}else if(e&&e.isBufferGeometry)if(s=new xe,null!==e.index){u=e.attributes.position;h=e.index;var f=e.groups;0===f.length&&(f=[{start:0,count:h.count,materialIndex:0}]);e=0;for(i=f.length;e<i;++e)for(c=f[e],r=c.start,n=c.count,c=r,n=r+n;c<n;c+=3)for(r=0;3>r;r++)l=h.getX(c+r),p=h.getX(c+(r+1)%3),o[0]=Math.min(l,p),o[1]=Math.max(l,p),l=o[0]+","+o[1],void 0===a[l]&&(a[l]={index1:o[0],index2:o[1]});for(l in a)c=a[l],s.fromBufferAttribute(u,c.index1),t.push(s.x,s.y,s.z),s.fromBufferAttribute(u,c.index2),t.push(s.x,s.y,s.z)}else for(u=e.attributes.position,c=0,n=u.count/3;c<n;c++)for(r=0;3>r;r++)a=3*c+r,s.fromBufferAttribute(u,a),t.push(s.x,s.y,s.z),a=3*c+(r+1)%3,s.fromBufferAttribute(u,a),t.push(s.x,s.y,s.z);this.addAttribute("position",new P(t,3))}function Vt(e,t,r){S.call(this);this.type="ParametricGeometry";this.parameters={func:e,slices:t,stacks:r};this.fromBufferGeometry(new Ht(e,t,r));this.mergeVertices()}function Ht(e,t,r){A.call(this);this.type="ParametricBufferGeometry";this.parameters={func:e,slices:t,stacks:r};var n=[],i=[],o=[],a=[],s=new xe,u=new xe,c=new xe,h=new xe,l=new xe,p,f;3>e.length&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var d=t+1;for(p=0;p<=r;p++){var v=p/r;for(f=0;f<=t;f++){var m=f/t;e(m,v,u);i.push(u.x,u.y,u.z);0<=m-1e-5?(e(m-1e-5,v,c),h.subVectors(u,c)):(e(m+1e-5,v,c),h.subVectors(c,u));0<=v-1e-5?(e(m,v-1e-5,c),l.subVectors(u,c)):(e(m,v+1e-5,c),l.subVectors(c,u));s.crossVectors(h,l).normalize();o.push(s.x,s.y,s.z);a.push(m,v)}}for(p=0;p<r;p++)for(f=0;f<t;f++)e=p*d+f+1,s=(p+1)*d+f+1,u=(p+1)*d+f,n.push(p*d+f,e,u),n.push(e,s,u);this.setIndex(n);this.addAttribute("position",new P(i,3));this.addAttribute("normal",new P(o,3));this.addAttribute("uv",new P(a,2))}function qt(e,t,r,n){S.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:e,indices:t,radius:r,detail:n};this.fromBufferGeometry(new Wt(e,t,r,n));this.mergeVertices()}function Wt(r,v,e,t){function m(e){l.push(e.x,e.y,e.z)}function g(e,t){e*=3;t.x=r[e+0];t.y=r[e+1];t.z=r[e+2]}function h(e,t,r,n){0>n&&1===e.x&&(p[t]=e.x-1);0===r.x&&0===r.z&&(p[t]=n/2/Math.PI+.5)}A.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:r,indices:v,radius:e,detail:t};e=e||1;t=t||0;var l=[],p=[];(function(e){for(var t=new xe,r=new xe,n=new xe,i=0;i<v.length;i+=3){g(v[i+0],t);g(v[i+1],r);g(v[i+2],n);var o,a,s=t,u=r,c=n,h=Math.pow(2,e),l=[];for(a=0;a<=h;a++){l[a]=[];var p=s.clone().lerp(c,a/h),f=u.clone().lerp(c,a/h),d=h-a;for(o=0;o<=d;o++)l[a][o]=0===o&&a===h?p:p.clone().lerp(f,o/d)}for(a=0;a<h;a++)for(o=0;o<2*(h-a)-1;o++)s=Math.floor(o/2),0===o%2?(m(l[a][s+1]),m(l[a+1][s]),m(l[a][s])):(m(l[a][s+1]),m(l[a+1][s+1]),m(l[a+1][s]))}})(t);(function(e){for(var t=new xe,r=0;r<l.length;r+=3)t.x=l[r+0],t.y=l[r+1],t.z=l[r+2],t.normalize().multiplyScalar(e),l[r+0]=t.x,l[r+1]=t.y,l[r+2]=t.z})(e);(function(){for(var e=new xe,t=0;t<l.length;t+=3)e.x=l[t+0],e.y=l[t+1],e.z=l[t+2],p.push(Math.atan2(e.z,-e.x)/2/Math.PI+.5,1-(Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5));e=new xe;t=new xe;for(var r=new xe,n=new xe,i=new H,o=new H,a=new H,s=0,u=0;s<l.length;s+=9,u+=6){e.set(l[s+0],l[s+1],l[s+2]);t.set(l[s+3],l[s+4],l[s+5]);r.set(l[s+6],l[s+7],l[s+8]);i.set(p[u+0],p[u+1]);o.set(p[u+2],p[u+3]);a.set(p[u+4],p[u+5]);n.copy(e).add(t).add(r).divideScalar(3);var c=Math.atan2(n.z,-n.x);h(i,u+0,e,c);h(o,u+2,t,c);h(a,u+4,r,c)}for(e=0;e<p.length;e+=6)t=p[e+0],r=p[e+2],n=p[e+4],i=Math.min(t,r,n),.9<Math.max(t,r,n)&&.1>i&&(.2>t&&(p[e+0]+=1),.2>r&&(p[e+2]+=1),.2>n&&(p[e+4]+=1))})();this.addAttribute("position",new P(l,3));this.addAttribute("normal",new P(l.slice(),3));this.addAttribute("uv",new P(p,2));0===t?this.computeVertexNormals():this.normalizeNormals()}function Xt(e,t){S.call(this);this.type="TetrahedronGeometry";this.parameters={radius:e,detail:t};this.fromBufferGeometry(new Yt(e,t));this.mergeVertices()}function Yt(e,t){Wt.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t);this.type="TetrahedronBufferGeometry";this.parameters={radius:e,detail:t}}function Kt(e,t){S.call(this);this.type="OctahedronGeometry";this.parameters={radius:e,detail:t};this.fromBufferGeometry(new Zt(e,t));this.mergeVertices()}function Zt(e,t){Wt.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t);this.type="OctahedronBufferGeometry";this.parameters={radius:e,detail:t}}function Jt(e,t){S.call(this);this.type="IcosahedronGeometry";this.parameters={radius:e,detail:t};this.fromBufferGeometry(new Qt(e,t));this.mergeVertices()}function Qt(e,t){var r=(1+Math.sqrt(5))/2;Wt.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t);this.type="IcosahedronBufferGeometry";this.parameters={radius:e,detail:t}}function er(e,t){S.call(this);this.type="DodecahedronGeometry";this.parameters={radius:e,detail:t};this.fromBufferGeometry(new tr(e,t));this.mergeVertices()}function tr(e,t){var r=(1+Math.sqrt(5))/2,n=1/r;Wt.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t);this.type="DodecahedronBufferGeometry";this.parameters={radius:e,detail:t}}function rr(e,t,r,n,i,o){S.call(this);this.type="TubeGeometry";this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:n,closed:i};void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");e=new nr(e,t,r,n,i);this.tangents=e.tangents;this.normals=e.normals;this.binormals=e.binormals;this.fromBufferGeometry(e);this.mergeVertices()}function nr(i,o,a,s,e){function t(e){l=i.getPointAt(e/o,l);var t=u.normals[e];e=u.binormals[e];for(p=0;p<=s;p++){var r=p/s*Math.PI*2,n=Math.sin(r);r=-Math.cos(r);h.x=r*t.x+n*e.x;h.y=r*t.y+n*e.y;h.z=r*t.z+n*e.z;h.normalize();d.push(h.x,h.y,h.z);c.x=l.x+a*h.x;c.y=l.y+a*h.y;c.z=l.z+a*h.z;f.push(c.x,c.y,c.z)}}A.call(this);this.type="TubeBufferGeometry";this.parameters={path:i,tubularSegments:o,radius:a,radialSegments:s,closed:e};o=o||64;a=a||1;s=s||8;e=e||!1;var u=i.computeFrenetFrames(o,e);this.tangents=u.tangents;this.normals=u.normals;this.binormals=u.binormals;var c=new xe,h=new xe,r=new H,l=new xe,n,p,f=[],d=[],v=[],m=[];for(n=0;n<o;n++)t(n);t(!1===e?o:0);for(n=0;n<=o;n++)for(p=0;p<=s;p++)r.x=n/o,r.y=p/s,v.push(r.x,r.y);(function(){for(p=1;p<=o;p++)for(n=1;n<=s;n++){var e=(s+1)*p+(n-1),t=(s+1)*p+n,r=(s+1)*(p-1)+n;m.push((s+1)*(p-1)+(n-1),e,r);m.push(e,t,r)}})();this.setIndex(m);this.addAttribute("position",new P(f,3));this.addAttribute("normal",new P(d,3));this.addAttribute("uv",new P(v,2))}function ir(e,t,r,n,i,o,a){S.call(this);this.type="TorusKnotGeometry";this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:o};void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new or(e,t,r,n,i,o));this.mergeVertices()}function or(e,t,r,n,i,o){function a(e,t,r,n,i){var o=Math.sin(e);t=r/t*e;r=Math.cos(t);i.x=n*(2+r)*.5*Math.cos(e);i.y=n*(2+r)*o*.5;i.z=n*Math.sin(t)*.5}A.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:n,p:i,q:o};e=e||1;t=t||.4;r=Math.floor(r)||64;n=Math.floor(n)||8;i=i||2;o=o||3;var s=[],u=[],c=[],h=[],l,p=new xe,f=new xe,d=new xe,v=new xe,m=new xe,g=new xe,_=new xe;for(l=0;l<=r;++l){var y=l/r*i*Math.PI*2;a(y,i,o,e,d);a(y+.01,i,o,e,v);g.subVectors(v,d);_.addVectors(v,d);m.crossVectors(g,_);_.crossVectors(m,g);m.normalize();_.normalize();for(y=0;y<=n;++y){var b=y/n*Math.PI*2,w=-t*Math.cos(b);b=t*Math.sin(b);p.x=d.x+(w*_.x+b*m.x);p.y=d.y+(w*_.y+b*m.y);p.z=d.z+(w*_.z+b*m.z);u.push(p.x,p.y,p.z);f.subVectors(p,d).normalize();c.push(f.x,f.y,f.z);h.push(l/r);h.push(y/n)}}for(y=1;y<=r;y++)for(l=1;l<=n;l++)e=(n+1)*y+(l-1),t=(n+1)*y+l,i=(n+1)*(y-1)+l,s.push((n+1)*(y-1)+(l-1),e,i),s.push(e,t,i);this.setIndex(s);this.addAttribute("position",new P(u,3));this.addAttribute("normal",new P(c,3));this.addAttribute("uv",new P(h,2))}function ar(e,t,r,n,i){S.call(this);this.type="TorusGeometry";this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i};this.fromBufferGeometry(new sr(e,t,r,n,i));this.mergeVertices()}function sr(e,t,r,n,i){A.call(this);this.type="TorusBufferGeometry";this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:n,arc:i};e=e||1;t=t||.4;r=Math.floor(r)||8;n=Math.floor(n)||6;i=i||2*Math.PI;var o=[],a=[],s=[],u=[],c=new xe,h=new xe,l=new xe,p,f;for(p=0;p<=r;p++)for(f=0;f<=n;f++){var d=f/n*i,v=p/r*Math.PI*2;h.x=(e+t*Math.cos(v))*Math.cos(d);h.y=(e+t*Math.cos(v))*Math.sin(d);h.z=t*Math.sin(v);a.push(h.x,h.y,h.z);c.x=e*Math.cos(d);c.y=e*Math.sin(d);l.subVectors(h,c).normalize();s.push(l.x,l.y,l.z);u.push(f/n);u.push(p/r)}for(p=1;p<=r;p++)for(f=1;f<=n;f++)e=(n+1)*(p-1)+f-1,t=(n+1)*(p-1)+f,i=(n+1)*p+f,o.push((n+1)*p+f-1,e,i),o.push(e,t,i);this.setIndex(o);this.addAttribute("position",new P(a,3));this.addAttribute("normal",new P(s,3));this.addAttribute("uv",new P(u,2))}function ur(e,t,r,n,i){for(var o,a=0,s=t,u=r-n;s<r;s+=n)a+=(e[u]-e[s])*(e[s+1]+e[u+1]),u=s;if(i===0<a)for(i=t;i<r;i+=n)o=wr(i,e[i],e[i+1],o);else for(i=r-n;i>=t;i-=n)o=wr(i,e[i],e[i+1],o);o&&gr(o,o.next)&&(xr(o),o=o.next);return o}function cr(e,t){if(!e)return e;t||(t=e);do{var r=!1;if(e.steiner||!gr(e,e.next)&&0!==mr(e.prev,e,e.next))e=e.next;else{xr(e);e=t=e.prev;if(e===e.next)break;r=!0}}while(r||e!==t);return t}function hr(e,t,r,n,i,o,a){if(e){if(!a&&o){var s=e,u=s;do{null===u.z&&(u.z=fr(u.x,u.y,n,i,o)),u.prevZ=u.prev,u=u.nextZ=u.next}while(u!==s);u.prevZ.nextZ=null;u.prevZ=null;s=u;var c,h,l,p,f=1;do{u=s;var d=s=null;for(h=0;u;){h++;var v=u;for(c=l=0;c<f&&(l++,v=v.nextZ,v);c++);for(p=f;0<l||0<p&&v;)0!==l&&(0===p||!v||u.z<=v.z)?(c=u,u=u.nextZ,l--):(c=v,v=v.nextZ,p--),d?d.nextZ=c:s=c,c.prevZ=d,d=c;u=v}d.nextZ=null;f*=2}while(1<h)}for(s=e;e.prev!==e.next;){u=e.prev;v=e.next;if(o)e:{d=e;p=n;var m=i,g=o;h=d.prev;l=d;f=d.next;if(0<=mr(h,l,f))d=!1;else{var _=h.x>l.x?h.x>f.x?h.x:f.x:l.x>f.x?l.x:f.x,y=h.y>l.y?h.y>f.y?h.y:f.y:l.y>f.y?l.y:f.y;c=fr(h.x<l.x?h.x<f.x?h.x:f.x:l.x<f.x?l.x:f.x,h.y<l.y?h.y<f.y?h.y:f.y:l.y<f.y?l.y:f.y,p,m,g);p=fr(_,y,p,m,g);for(m=d.nextZ;m&&m.z<=p;){if(m!==d.prev&&m!==d.next&&vr(h.x,h.y,l.x,l.y,f.x,f.y,m.x,m.y)&&0<=mr(m.prev,m,m.next)){d=!1;break e}m=m.nextZ}for(m=d.prevZ;m&&m.z>=c;){if(m!==d.prev&&m!==d.next&&vr(h.x,h.y,l.x,l.y,f.x,f.y,m.x,m.y)&&0<=mr(m.prev,m,m.next)){d=!1;break e}m=m.prevZ}d=!0}}else e:if(d=e,h=d.prev,l=d,f=d.next,0<=mr(h,l,f))d=!1;else{for(c=d.next.next;c!==d.prev;){if(vr(h.x,h.y,l.x,l.y,f.x,f.y,c.x,c.y)&&0<=mr(c.prev,c,c.next)){d=!1;break e}c=c.next}d=!0}if(d)t.push(u.i/r),t.push(e.i/r),t.push(v.i/r),xr(e),s=e=v.next;else if(e=v,e===s){if(!a)hr(cr(e),t,r,n,i,o,1);else if(1===a){a=t;s=r;u=e;do{v=u.prev,d=u.next.next,!gr(v,d)&&_r(v,u,u.next,d)&&yr(v,d)&&yr(d,v)&&(a.push(v.i/s),a.push(u.i/s),a.push(d.i/s),xr(u),xr(u.next),u=e=d),u=u.next}while(u!==e);e=u;hr(e,t,r,n,i,o,2)}else if(2===a)e:{a=e;do{for(s=a.next.next;s!==a.prev;){if(u=a.i!==s.i){u=a;v=s;if(d=u.next.i!==v.i&&u.prev.i!==v.i){t:{d=u;do{if(d.i!==u.i&&d.next.i!==u.i&&d.i!==v.i&&d.next.i!==v.i&&_r(d,d.next,u,v)){d=!0;break t}d=d.next}while(d!==u);d=!1}d=!d}if(d=d&&yr(u,v)&&yr(v,u)){d=u;h=!1;l=(u.x+v.x)/2;v=(u.y+v.y)/2;do{d.y>v!==d.next.y>v&&d.next.y!==d.y&&l<(d.next.x-d.x)*(v-d.y)/(d.next.y-d.y)+d.x&&(h=!h),d=d.next}while(d!==u);d=h}u=d}if(u){e=br(a,s);a=cr(a,a.next);e=cr(e,e.next);hr(a,t,r,n,i,o);hr(e,t,r,n,i,o);break e}s=s.next}a=a.next}while(a!==e)}break}}}}function lr(e,t){return e.x-t.x}function pr(e,t){var r=t,n=e.x,i=e.y,o=-Infinity;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var a=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>o){o=a;if(a===n){if(i===r.y)return r;if(i===r.next.y)return r.next}var s=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!s)return null;if(n===o)return s.prev;t=s;a=s.x;var u=s.y,c=Infinity;for(r=s.next;r!==t;){if(n>=r.x&&r.x>=a&&n!==r.x&&vr(i<u?n:o,i,a,u,i<u?o:n,i,r.x,r.y)){var h=Math.abs(i-r.y)/(n-r.x);(h<c||h===c&&r.x>s.x)&&yr(r,e)&&(s=r,c=h)}r=r.next}return s}function fr(e,t,r,n,i){e=32767*(e-r)*i;t=32767*(t-n)*i;e=(e|e<<8)&16711935;e=(e|e<<4)&252645135;e=(e|e<<2)&858993459;t=(t|t<<8)&16711935;t=(t|t<<4)&252645135;t=(t|t<<2)&858993459;return(e|e<<1)&1431655765|((t|t<<1)&1431655765)<<1}function dr(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function vr(e,t,r,n,i,o,a,s){return 0<=(i-a)*(t-s)-(e-a)*(o-s)&&0<=(e-a)*(n-s)-(r-a)*(t-s)&&0<=(r-a)*(o-s)-(i-a)*(n-s)}function mr(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function gr(e,t){return e.x===t.x&&e.y===t.y}function _r(e,t,r,n){return gr(e,t)&&gr(r,n)||gr(e,n)&&gr(r,t)?!0:0<mr(e,t,r)!==0<mr(e,t,n)&&0<mr(r,n,e)!==0<mr(r,n,t)}function yr(e,t){return 0>mr(e.prev,e,e.next)?0<=mr(e,t,e.next)&&0<=mr(e,e.prev,t):0>mr(e,t,e.prev)||0>mr(e,e.next,t)}function br(e,t){var r=new Sr(e.i,e.x,e.y),n=new Sr(t.i,t.x,t.y),i=e.next,o=t.prev;e.next=t;t.prev=e;r.next=i;i.prev=r;n.next=r;r.prev=n;o.next=n;n.prev=o;return n}function wr(e,t,r,n){e=new Sr(e,t,r);n?(e.next=n.next,e.prev=n,n.next.prev=e,n.next=e):(e.prev=e,e.next=e);return e}function xr(e){e.next.prev=e.prev;e.prev.next=e.next;e.prevZ&&(e.prevZ.nextZ=e.nextZ);e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Sr(e,t,r){this.i=e;this.x=t;this.y=r;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function Mr(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function Cr(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function Er(e,t){S.call(this);this.type="ExtrudeGeometry";this.parameters={shapes:e,options:t};this.fromBufferGeometry(new Tr(e,t));this.mergeVertices()}function Tr(e,$){function t(e){function t(e,t,r){t||console.error("THREE.ExtrudeGeometry: vec does not exist");return t.clone().multiplyScalar(r).add(e)}function r(e,t,r){var n=e.x-t.x;var i=e.y-t.y;var o=r.x-e.x;var a=r.y-e.y,s=n*n+i*i;if(Math.abs(n*a-i*o)>Number.EPSILON){var u=Math.sqrt(s),c=Math.sqrt(o*o+a*a);s=t.x-i/u;t=t.y+n/u;a=((r.x-a/c-s)*a-(r.y+o/c-t)*o)/(n*a-i*o);o=s+n*a-e.x;n=t+i*a-e.y;i=o*o+n*n;if(2>=i)return new H(o,n);i=Math.sqrt(i/2)}else e=!1,n>Number.EPSILON?o>Number.EPSILON&&(e=!0):n<-Number.EPSILON?o<-Number.EPSILON&&(e=!0):Math.sign(i)===Math.sign(a)&&(e=!0),e?(o=-i,i=Math.sqrt(s)):(o=n,n=i,i=Math.sqrt(s/2));return new H(o/i,n/i)}function n(e,t){for(L=e.length;0<=--L;){var r=L;var n=L-1;0>n&&(n=e.length-1);var i,o=p+2*v;for(i=0;i<o;i++){var a=j*i,s=j*(i+1),u=t+n+a,c=t+n+s;s=t+r+s;h(t+r+a);h(u);h(s);h(u);h(c);h(s);a=G.length/3;a=g.generateSideWallUV(U,G,a-6,a-3,a-2,a-1);l(a[0]);l(a[1]);l(a[3]);l(a[1]);l(a[2]);l(a[3])}}}function i(e,t,r){a.push(e);a.push(t);a.push(r)}function o(e,t,r){h(e);h(t);h(r);e=G.length/3;e=g.generateTopUV(U,G,e-3,e-2,e-1);l(e[0]);l(e[1]);l(e[2])}function h(e){G.push(a[3*e]);G.push(a[3*e+1]);G.push(a[3*e+2])}function l(e){V.push(e.x);V.push(e.y)}var a=[],s=void 0!==$.curveSegments?$.curveSegments:12,p=void 0!==$.steps?$.steps:1,u=void 0!==$.depth?$.depth:100,c=void 0!==$.bevelEnabled?$.bevelEnabled:!0,f=void 0!==$.bevelThickness?$.bevelThickness:6,d=void 0!==$.bevelSize?$.bevelSize:f-2,v=void 0!==$.bevelSegments?$.bevelSegments:3,m=$.extrudePath,g=void 0!==$.UVGenerator?$.UVGenerator:Eo;void 0!==$.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=$.amount);var _=!1;if(m){var y=m.getSpacedPoints(p);_=!0;c=!1;var b=m.computeFrenetFrames(p,!1);var w=new xe;var x=new xe;var S=new xe}c||(d=f=v=0);var M;s=e.extractPoints(s);e=s.shape;var C=s.holes;if(!Co.isClockWise(e)){e=e.reverse();var E=0;for(M=C.length;E<M;E++){var T=C[E];Co.isClockWise(T)&&(C[E]=T.reverse())}}var O=Co.triangulateShape(e,C),P=e;E=0;for(M=C.length;E<M;E++)T=C[E],e=e.concat(T);var A,j=e.length,R,k=O.length;s=[];var L=0;var I=P.length;var N=I-1;for(A=L+1;L<I;L++,N++,A++)N===I&&(N=0),A===I&&(A=0),s[L]=r(P[L],P[N],P[A]);m=[];var D=s.concat();E=0;for(M=C.length;E<M;E++){T=C[E];var B=[];L=0;I=T.length;N=I-1;for(A=L+1;L<I;L++,N++,A++)N===I&&(N=0),A===I&&(A=0),B[L]=r(T[L],T[N],T[A]);m.push(B);D=D.concat(B)}for(N=0;N<v;N++){I=N/v;var F=f*Math.cos(I*Math.PI/2);A=d*Math.sin(I*Math.PI/2);L=0;for(I=P.length;L<I;L++){var z=t(P[L],s[L],A);i(z.x,z.y,-F)}E=0;for(M=C.length;E<M;E++)for(T=C[E],B=m[E],L=0,I=T.length;L<I;L++)z=t(T[L],B[L],A),i(z.x,z.y,-F)}A=d;for(L=0;L<j;L++)z=c?t(e[L],D[L],A):e[L],_?(x.copy(b.normals[0]).multiplyScalar(z.x),w.copy(b.binormals[0]).multiplyScalar(z.y),S.copy(y[0]).add(x).add(w),i(S.x,S.y,S.z)):i(z.x,z.y,0);for(I=1;I<=p;I++)for(L=0;L<j;L++)z=c?t(e[L],D[L],A):e[L],_?(x.copy(b.normals[I]).multiplyScalar(z.x),w.copy(b.binormals[I]).multiplyScalar(z.y),S.copy(y[I]).add(x).add(w),i(S.x,S.y,S.z)):i(z.x,z.y,u/p*I);for(N=v-1;0<=N;N--){I=N/v;F=f*Math.cos(I*Math.PI/2);A=d*Math.sin(I*Math.PI/2);L=0;for(I=P.length;L<I;L++)z=t(P[L],s[L],A),i(z.x,z.y,u+F);E=0;for(M=C.length;E<M;E++)for(T=C[E],B=m[E],L=0,I=T.length;L<I;L++)z=t(T[L],B[L],A),_?i(z.x,z.y+y[p-1].y,y[p-1].x+F):i(z.x,z.y,u+F)}(function(){var e=G.length/3;if(c){var t=0*j;for(L=0;L<k;L++)R=O[L],o(R[2]+t,R[1]+t,R[0]+t);t=j*(p+2*v);for(L=0;L<k;L++)R=O[L],o(R[0]+t,R[1]+t,R[2]+t)}else{for(L=0;L<k;L++)R=O[L],o(R[2],R[1],R[0]);for(L=0;L<k;L++)R=O[L],o(R[0]+j*p,R[1]+j*p,R[2]+j*p)}U.addGroup(e,G.length/3-e,0)})();(function(){var e=G.length/3,t=0;n(P,t);t+=P.length;E=0;for(M=C.length;E<M;E++)T=C[E],n(T,t),t+=T.length;U.addGroup(e,G.length/3-e,1)})()}A.call(this);this.type="ExtrudeBufferGeometry";this.parameters={shapes:e,options:$};e=Array.isArray(e)?e:[e];for(var U=this,G=[],V=[],r=0,n=e.length;r<n;r++)t(e[r]);this.addAttribute("position",new P(G,3));this.addAttribute("uv",new P(V,2));this.computeVertexNormals()}function Or(e,t,r){r.shapes=[];if(Array.isArray(e))for(var n=0,i=e.length;n<i;n++)r.shapes.push(e[n].uuid);else r.shapes.push(e.uuid);void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON());return r}function Pr(e,t){S.call(this);this.type="TextGeometry";this.parameters={text:e,parameters:t};this.fromBufferGeometry(new Ar(e,t));this.mergeVertices()}function Ar(e,t){t=t||{};var r=t.font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new S;e=r.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50;void 0===t.bevelThickness&&(t.bevelThickness=10);void 0===t.bevelSize&&(t.bevelSize=8);void 0===t.bevelEnabled&&(t.bevelEnabled=!1);Tr.call(this,e,t);this.type="TextBufferGeometry"}function jr(e,t,r,n,i,o,a){S.call(this);this.type="SphereGeometry";this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a};this.fromBufferGeometry(new Rr(e,t,r,n,i,o,a));this.mergeVertices()}function Rr(e,t,r,n,i,o,a){A.call(this);this.type="SphereBufferGeometry";this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a};e=e||1;t=Math.max(3,Math.floor(t)||8);r=Math.max(2,Math.floor(r)||6);n=void 0!==n?n:0;i=void 0!==i?i:2*Math.PI;o=void 0!==o?o:0;a=void 0!==a?a:Math.PI;var s=o+a,u,c,h=0,l=[],p=new xe,f=new xe,d=[],v=[],m=[],g=[];for(c=0;c<=r;c++){var _=[],y=c/r;for(u=0;u<=t;u++){var b=u/t;p.x=-e*Math.cos(n+b*i)*Math.sin(o+y*a);p.y=e*Math.cos(o+y*a);p.z=e*Math.sin(n+b*i)*Math.sin(o+y*a);v.push(p.x,p.y,p.z);f.set(p.x,p.y,p.z).normalize();m.push(f.x,f.y,f.z);g.push(b,1-y);_.push(h++)}l.push(_)}for(c=0;c<r;c++)for(u=0;u<t;u++)e=l[c][u+1],n=l[c][u],i=l[c+1][u],a=l[c+1][u+1],(0!==c||0<o)&&d.push(e,n,a),(c!==r-1||s<Math.PI)&&d.push(n,i,a);this.setIndex(d);this.addAttribute("position",new P(v,3));this.addAttribute("normal",new P(m,3));this.addAttribute("uv",new P(g,2))}function kr(e,t,r,n,i,o){S.call(this);this.type="RingGeometry";this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o};this.fromBufferGeometry(new Lr(e,t,r,n,i,o));this.mergeVertices()}function Lr(e,t,r,n,i,o){A.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o};e=e||.5;t=t||1;i=void 0!==i?i:0;o=void 0!==o?o:2*Math.PI;r=void 0!==r?Math.max(3,r):8;n=void 0!==n?Math.max(1,n):1;var a=[],s=[],u=[],c=[],h=e,l=(t-e)/n,p=new xe,f=new H,d,v;for(d=0;d<=n;d++){for(v=0;v<=r;v++)e=i+v/r*o,p.x=h*Math.cos(e),p.y=h*Math.sin(e),s.push(p.x,p.y,p.z),u.push(0,0,1),f.x=(p.x/t+1)/2,f.y=(p.y/t+1)/2,c.push(f.x,f.y);h+=l}for(d=0;d<n;d++)for(t=d*(r+1),v=0;v<r;v++)e=v+t,i=e+r+1,o=e+r+2,h=e+1,a.push(e,i,h),a.push(i,o,h);this.setIndex(a);this.addAttribute("position",new P(s,3));this.addAttribute("normal",new P(u,3));this.addAttribute("uv",new P(c,2))}function Ir(e,t,r,n){S.call(this);this.type="LatheGeometry";this.parameters={points:e,segments:t,phiStart:r,phiLength:n};this.fromBufferGeometry(new Nr(e,t,r,n));this.mergeVertices()}function Nr(e,t,r,n){A.call(this);this.type="LatheBufferGeometry";this.parameters={points:e,segments:t,phiStart:r,phiLength:n};t=Math.floor(t)||12;r=r||0;n=n||2*Math.PI;n=eo.clamp(n,0,2*Math.PI);var i=[],o=[],a=[],s=1/t,u=new xe,c=new H,h;for(h=0;h<=t;h++){var l=r+h*s*n;var p=Math.sin(l),f=Math.cos(l);for(l=0;l<=e.length-1;l++)u.x=e[l].x*p,u.y=e[l].y,u.z=e[l].x*f,o.push(u.x,u.y,u.z),c.x=h/t,c.y=l/(e.length-1),a.push(c.x,c.y)}for(h=0;h<t;h++)for(l=0;l<e.length-1;l++)r=l+h*e.length,s=r+e.length,u=r+e.length+1,c=r+1,i.push(r,s,c),i.push(s,u,c);this.setIndex(i);this.addAttribute("position",new P(o,3));this.addAttribute("uv",new P(a,2));this.computeVertexNormals();if(n===2*Math.PI)for(n=this.attributes.normal.array,i=new xe,o=new xe,a=new xe,r=t*e.length*3,l=h=0;h<e.length;h++,l+=3)i.x=n[l+0],i.y=n[l+1],i.z=n[l+2],o.x=n[r+l+0],o.y=n[r+l+1],o.z=n[r+l+2],a.addVectors(i,o).normalize(),n[l+0]=n[r+l+0]=a.x,n[l+1]=n[r+l+1]=a.y,n[l+2]=n[r+l+2]=a.z}function Dr(e,t){S.call(this);this.type="ShapeGeometry";"object"===typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments);this.parameters={shapes:e,curveSegments:t};this.fromBufferGeometry(new Br(e,t));this.mergeVertices()}function Br(e,s){function t(e){var t,r=c.length/3;e=e.extractPoints(s);var n=e.shape,i=e.holes;if(!1===Co.isClockWise(n))for(n=n.reverse(),e=0,t=i.length;e<t;e++){var o=i[e];!0===Co.isClockWise(o)&&(i[e]=o.reverse())}var a=Co.triangulateShape(n,i);e=0;for(t=i.length;e<t;e++)o=i[e],n=n.concat(o);e=0;for(t=n.length;e<t;e++)o=n[e],c.push(o.x,o.y,0),h.push(0,0,1),l.push(o.x,o.y);e=0;for(t=a.length;e<t;e++)n=a[e],u.push(n[0]+r,n[1]+r,n[2]+r),p+=3}A.call(this);this.type="ShapeBufferGeometry";this.parameters={shapes:e,curveSegments:s};s=s||12;var u=[],c=[],h=[],l=[],r=0,p=0;if(!1===Array.isArray(e))t(e);else for(var n=0;n<e.length;n++)t(e[n]),this.addGroup(r,p,n),r+=p,p=0;this.setIndex(u);this.addAttribute("position",new P(c,3));this.addAttribute("normal",new P(h,3));this.addAttribute("uv",new P(l,2))}function Fr(e,t){t.shapes=[];if(Array.isArray(e))for(var r=0,n=e.length;r<n;r++)t.shapes.push(e[r].uuid);else t.shapes.push(e.uuid);return t}function zr(e,t){A.call(this);this.type="EdgesGeometry";this.parameters={thresholdAngle:t};var r=[];t=Math.cos(eo.DEG2RAD*(void 0!==t?t:1));var n=[0,0],i={},o=["a","b","c"];if(e.isBufferGeometry){var a=new S;a.fromBufferGeometry(e)}else a=e.clone();a.mergeVertices();a.computeFaceNormals();e=a.vertices;a=a.faces;for(var s=0,u=a.length;s<u;s++)for(var c=a[s],h=0;3>h;h++){var l=c[o[h]];var p=c[o[(h+1)%3]];n[0]=Math.min(l,p);n[1]=Math.max(l,p);l=n[0]+","+n[1];void 0===i[l]?i[l]={index1:n[0],index2:n[1],face1:s,face2:void 0}:i[l].face2=s}for(l in i)if(n=i[l],void 0===n.face2||a[n.face1].normal.dot(a[n.face2].normal)<=t)o=e[n.index1],r.push(o.x,o.y,o.z),o=e[n.index2],r.push(o.x,o.y,o.z);this.addAttribute("position",new P(r,3))}function $r(e,t,r,n,i,o,a,s){S.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};this.fromBufferGeometry(new Ur(e,t,r,n,i,o,a,s));this.mergeVertices()}function Ur(p,f,d,v,m,e,g,_){function t(e){var t,r=new H,n=new xe,i=0,o=!0===e?p:f,a=!0===e?1:-1;var s=M;for(t=1;t<=v;t++)w.push(0,E*a,0),x.push(0,a,0),S.push(.5,.5),M++;var u=M;for(t=0;t<=v;t++){var c=t/v*_+g,h=Math.cos(c);c=Math.sin(c);n.x=o*c;n.y=E*a;n.z=o*h;w.push(n.x,n.y,n.z);x.push(0,a,0);r.x=.5*h+.5;r.y=.5*c*a+.5;S.push(r.x,r.y);M++}for(t=0;t<v;t++)r=s+t,n=u+t,!0===e?b.push(n,n+1,r):b.push(n+1,n,r),i+=3;y.addGroup(T,i,!0===e?1:2);T+=i}A.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:p,radiusBottom:f,height:d,radialSegments:v,heightSegments:m,openEnded:e,thetaStart:g,thetaLength:_};var y=this;p=void 0!==p?p:1;f=void 0!==f?f:1;d=d||1;v=Math.floor(v)||8;m=Math.floor(m)||1;e=void 0!==e?e:!1;g=void 0!==g?g:0;_=void 0!==_?_:2*Math.PI;var b=[],w=[],x=[],S=[],M=0,C=[],E=d/2,T=0;(function(){var e,t,r=new xe,n=new xe,i=0,o=(f-p)/d;for(t=0;t<=m;t++){var a=[],s=t/m,u=s*(f-p)+p;for(e=0;e<=v;e++){var c=e/v,h=c*_+g,l=Math.sin(h);h=Math.cos(h);n.x=u*l;n.y=-s*d+E;n.z=u*h;w.push(n.x,n.y,n.z);r.set(l,o,h).normalize();x.push(r.x,r.y,r.z);S.push(c,1-s);a.push(M++)}C.push(a)}for(e=0;e<v;e++)for(t=0;t<m;t++)r=C[t+1][e],n=C[t+1][e+1],o=C[t][e+1],b.push(C[t][e],r,o),b.push(r,n,o),i+=6;y.addGroup(T,i,0);T+=i})();!1===e&&(0<p&&t(!0),0<f&&t(!1));this.setIndex(b);this.addAttribute("position",new P(w,3));this.addAttribute("normal",new P(x,3));this.addAttribute("uv",new P(S,2))}function Gr(e,t,r,n,i,o,a){$r.call(this,0,e,t,r,n,i,o,a);this.type="ConeGeometry";this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function Vr(e,t,r,n,i,o,a){Ur.call(this,0,e,t,r,n,i,o,a);this.type="ConeBufferGeometry";this.parameters={radius:e,height:t,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function Hr(e,t,r,n){S.call(this);this.type="CircleGeometry";this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n};this.fromBufferGeometry(new qr(e,t,r,n));this.mergeVertices()}function qr(e,t,r,n){A.call(this);this.type="CircleBufferGeometry";this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:n};e=e||1;t=void 0!==t?Math.max(3,t):8;r=void 0!==r?r:0;n=void 0!==n?n:2*Math.PI;var i=[],o=[],a=[],s=[],u,c=new xe,h=new H;o.push(0,0,0);a.push(0,0,1);s.push(.5,.5);var l=0;for(u=3;l<=t;l++,u+=3){var p=r+l/t*n;c.x=e*Math.cos(p);c.y=e*Math.sin(p);o.push(c.x,c.y,c.z);a.push(0,0,1);h.x=(o[u]/e+1)/2;h.y=(o[u+1]/e+1)/2;s.push(h.x,h.y)}for(u=1;u<=t;u++)i.push(u,u+1,0);this.setIndex(i);this.addAttribute("position",new P(o,3));this.addAttribute("normal",new P(a,3));this.addAttribute("uv",new P(s,2))}function Wr(e){L.call(this);this.type="ShadowMaterial";this.color=new x(0);this.transparent=!0;this.setValues(e)}function Xr(e){N.call(this,e);this.type="RawShaderMaterial"}function Yr(e){L.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new x(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new x(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new H(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(e)}function Kr(e){Yr.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(e)}function Zr(e){L.call(this);this.type="MeshPhongMaterial";this.color=new x(16777215);this.specular=new x(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new x(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new H(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(e)}function Jr(e){Zr.call(this);this.defines={TOON:""};this.type="MeshToonMaterial";this.gradientMap=null;this.setValues(e)}function Qr(e){L.call(this);this.type="MeshNormalMaterial";this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new H(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.lights=this.fog=!1;this.setValues(e)}function en(e){L.call(this);this.type="MeshLambertMaterial";this.color=new x(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new x(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(e)}function tn(e){kt.call(this);this.type="LineDashedMaterial";this.scale=1;this.dashSize=3;this.gapSize=1;this.setValues(e)}function rn(e,t,r){var n=this,i=!1,o=0,a=0,s=void 0;this.onStart=void 0;this.onLoad=e;this.onProgress=t;this.onError=r;this.itemStart=function(e){a++;if(!1===i&&void 0!==n.onStart)n.onStart(e,o,a);i=!0};this.itemEnd=function(e){o++;if(void 0!==n.onProgress)n.onProgress(e,o,a);if(o===a&&(i=!1,void 0!==n.onLoad))n.onLoad()};this.itemError=function(e){if(void 0!==n.onError)n.onError(e)};this.resolveURL=function(e){return s?s(e):e};this.setURLModifier=function(e){s=e;return this}}function nn(e){this.manager=void 0!==e?e:Ao}function on(e){this.manager=void 0!==e?e:Ao;this._parser=null}function an(e){this.manager=void 0!==e?e:Ao;this._parser=null}function sn(e){this.manager=void 0!==e?e:Ao}function un(e){this.manager=void 0!==e?e:Ao}function cn(e){this.manager=void 0!==e?e:Ao}function hn(){this.type="Curve";this.arcLengthDivisions=200}function ln(e,t,r,n,i,o,a,s){hn.call(this);this.type="EllipseCurve";this.aX=e||0;this.aY=t||0;this.xRadius=r||1;this.yRadius=n||1;this.aStartAngle=i||0;this.aEndAngle=o||2*Math.PI;this.aClockwise=a||!1;this.aRotation=s||0}function pn(e,t,r,n,i,o){ln.call(this,e,t,r,r,n,i,o);this.type="ArcCurve"}function fn(){var s=0,u=0,c=0,h=0;return{initCatmullRom:function(e,t,r,n,i){e=i*(r-e);n=i*(n-t);s=t;u=e;c=-3*t+3*r-2*e-n;h=2*t-2*r+e+n},initNonuniformCatmullRom:function(e,t,r,n,i,o,a){e=((t-e)/i-(r-e)/(i+o)+(r-t)/o)*o;n=((r-t)/o-(n-t)/(o+a)+(n-r)/a)*o;s=t;u=e;c=-3*t+3*r-2*e-n;h=2*t-2*r+e+n},calc:function(e){var t=e*e;return s+u*e+c*t+h*t*e}}}function dn(e,t,r,n){hn.call(this);this.type="CatmullRomCurve3";this.points=e||[];this.closed=t||!1;this.curveType=r||"centripetal";this.tension=n||.5}function vn(e,t,r,n,i){t=.5*(n-t);i=.5*(i-r);var o=e*e;return(2*r-2*n+t+i)*e*o+(-3*r+3*n-2*t-i)*o+t*e+r}function mn(e,t,r,n){var i=1-e;return i*i*t+2*(1-e)*e*r+e*e*n}function gn(e,t,r,n,i){var o=1-e,a=1-e;return o*o*o*t+3*a*a*e*r+3*(1-e)*e*e*n+e*e*e*i}function _n(e,t,r,n){hn.call(this);this.type="CubicBezierCurve";this.v0=e||new H;this.v1=t||new H;this.v2=r||new H;this.v3=n||new H}function yn(e,t,r,n){hn.call(this);this.type="CubicBezierCurve3";this.v0=e||new xe;this.v1=t||new xe;this.v2=r||new xe;this.v3=n||new xe}function bn(e,t){hn.call(this);this.type="LineCurve";this.v1=e||new H;this.v2=t||new H}function wn(e,t){hn.call(this);this.type="LineCurve3";this.v1=e||new xe;this.v2=t||new xe}function xn(e,t,r){hn.call(this);this.type="QuadraticBezierCurve";this.v0=e||new H;this.v1=t||new H;this.v2=r||new H}function Sn(e,t,r){hn.call(this);this.type="QuadraticBezierCurve3";this.v0=e||new xe;this.v1=t||new xe;this.v2=r||new xe}function Mn(e){hn.call(this);this.type="SplineCurve";this.points=e||[]}function Cn(){hn.call(this);this.type="CurvePath";this.curves=[];this.autoClose=!1}function En(e){Cn.call(this);this.type="Path";this.currentPoint=new H;e&&this.setFromPoints(e)}function Tn(e){En.call(this,e);this.uuid=eo.generateUUID();this.type="Shape";this.holes=[]}function On(e,t){h.call(this);this.type="Light";this.color=new x(e);this.intensity=void 0!==t?t:1;this.receiveShadow=void 0}function Pn(e,t,r){On.call(this,e,r);this.type="HemisphereLight";this.castShadow=void 0;this.position.copy(h.DefaultUp);this.updateMatrix();this.groundColor=new x(t)}function An(e){this.camera=e;this.bias=0;this.radius=1;this.mapSize=new H(512,512);this.map=null;this.matrix=new we}function jn(){An.call(this,new gt(50,1,.5,500))}function Rn(e,t,r,n,i,o){On.call(this,e,t);this.type="SpotLight";this.position.copy(h.DefaultUp);this.updateMatrix();this.target=new h;Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}});this.distance=void 0!==r?r:0;this.angle=void 0!==n?n:Math.PI/3;this.penumbra=void 0!==i?i:0;this.decay=void 0!==o?o:1;this.shadow=new jn}function kn(e,t,r,n){On.call(this,e,t);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}});this.distance=void 0!==r?r:0;this.decay=void 0!==n?n:1;this.shadow=new An(new gt(90,1,.5,500))}function Ln(){An.call(this,new f(-5,5,5,-5,.5,500))}function In(e,t){On.call(this,e,t);this.type="DirectionalLight";this.position.copy(h.DefaultUp);this.updateMatrix();this.target=new h;this.shadow=new Ln}function Nn(e,t){On.call(this,e,t);this.type="AmbientLight";this.castShadow=void 0}function Dn(e,t,r,n){On.call(this,e,t);this.type="RectAreaLight";this.width=void 0!==r?r:10;this.height=void 0!==n?n:10}function Bn(e,t,r,n){this.parameterPositions=e;this._cachedIndex=0;this.resultBuffer=void 0!==n?n:new t.constructor(r);this.sampleValues=t;this.valueSize=r}function Fn(e,t,r,n){Bn.call(this,e,t,r,n);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function zn(e,t,r,n){Bn.call(this,e,t,r,n)}function $n(e,t,r,n){Bn.call(this,e,t,r,n)}function Un(e,t,r,n){if(void 0===e)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e;this.times=Do.convertArray(t,this.TimeBufferType);this.values=Do.convertArray(r,this.ValueBufferType);this.setInterpolation(n||this.DefaultInterpolation)}function Gn(e,t,r){Un.call(this,e,t,r)}function Vn(e,t,r,n){Un.call(this,e,t,r,n)}function Hn(e,t,r,n){Un.call(this,e,t,r,n)}function qn(e,t,r,n){Bn.call(this,e,t,r,n)}function Wn(e,t,r,n){Un.call(this,e,t,r,n)}function Xn(e,t,r,n){Un.call(this,e,t,r,n)}function Yn(e,t,r,n){Un.call(this,e,t,r,n)}function Kn(e,t,r){this.name=e;this.tracks=r;this.duration=void 0!==t?t:-1;this.uuid=eo.generateUUID();0>this.duration&&this.resetDuration()}function Zn(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Hn;case"vector":case"vector2":case"vector3":case"vector4":return Yn;case"color":return Vn;case"quaternion":return Wn;case"bool":case"boolean":return Gn;case"string":return Xn}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function Jn(e){if(void 0===e.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=Zn(e.type);if(void 0===e.times){var r=[],n=[];Do.flattenJSON(e.keys,r,n,"value");e.times=r;e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}function Qn(e){this.manager=void 0!==e?e:Ao;this.textures={}}function ei(e){this.manager=void 0!==e?e:Ao}function ti(){}function ri(e){"boolean"===typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0);this.manager=void 0!==e?e:Ao;this.withCredentials=!1}function ni(e){this.manager=void 0!==e?e:Ao;this.texturePath=""}function ii(e){"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported.");"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported.");this.manager=void 0!==e?e:Ao;this.options=void 0}function oi(){this.type="ShapePath";this.color=new x;this.subPaths=[];this.currentPath=null}function ai(e){this.type="Font";this.data=e}function si(e){this.manager=void 0!==e?e:Ao}function ui(e){this.manager=void 0!==e?e:Ao}function ci(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new gt;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new gt;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1}function hi(e,t,r){h.call(this);this.type="CubeCamera";var i=new gt(90,1,e,t);i.up.set(0,-1,0);i.lookAt(new xe(1,0,0));this.add(i);var o=new gt(90,1,e,t);o.up.set(0,-1,0);o.lookAt(new xe(-1,0,0));this.add(o);var a=new gt(90,1,e,t);a.up.set(0,0,1);a.lookAt(new xe(0,1,0));this.add(a);var s=new gt(90,1,e,t);s.up.set(0,0,-1);s.lookAt(new xe(0,-1,0));this.add(s);var u=new gt(90,1,e,t);u.up.set(0,-1,0);u.lookAt(new xe(0,0,1));this.add(u);var c=new gt(90,1,e,t);c.up.set(0,-1,0);c.lookAt(new xe(0,0,-1));this.add(c);this.renderTarget=new n(r,r,{format:1022,magFilter:1006,minFilter:1006});this.renderTarget.texture.name="CubeCamera";this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,n=r.texture.generateMipmaps;r.texture.generateMipmaps=!1;r.activeCubeFace=0;e.render(t,i,r);r.activeCubeFace=1;e.render(t,o,r);r.activeCubeFace=2;e.render(t,a,r);r.activeCubeFace=3;e.render(t,s,r);r.activeCubeFace=4;e.render(t,u,r);r.texture.generateMipmaps=n;r.activeCubeFace=5;e.render(t,c,r);e.setRenderTarget(null)};this.clear=function(e,t,r,n){for(var i=this.renderTarget,o=0;6>o;o++)i.activeCubeFace=o,e.setRenderTarget(i),e.clear(t,r,n);e.setRenderTarget(null)}}function li(){h.call(this);this.type="AudioListener";this.context=Vo.getContext();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null}function pi(e){h.call(this);this.type="Audio";this.context=e.context;this.gain=this.context.createGain();this.gain.connect(e.getInput());this.autoplay=!1;this.buffer=null;this.loop=!1;this.offset=this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType="empty";this.filters=[]}function fi(e){pi.call(this,e);this.panner=this.context.createPanner();this.panner.connect(this.gain)}function di(e,t){this.analyser=e.context.createAnalyser();this.analyser.fftSize=void 0!==t?t:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);e.getOutput().connect(this.analyser)}function vi(e,t,r){this.binding=e;this.valueSize=r;e=Float64Array;switch(t){case"quaternion":t=this._slerp;break;case"string":case"bool":e=Array;t=this._select;break;default:t=this._lerp}this.buffer=new e(4*r);this._mixBufferRegion=t;this.referenceCount=this.useCount=this.cumulativeWeight=0}function mi(e,t,r){r=r||gi.parseTrackName(t);this._targetGroup=e;this._bindings=e.subscribe_(t,r)}function gi(e,t,r){this.path=t;this.parsedPath=r||gi.parseTrackName(t);this.node=gi.findNode(e,this.parsedPath.nodeName)||e;this.rootNode=e}function _i(){this.uuid=eo.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function yi(e,t,r){this._mixer=e;this._clip=t;this._localRoot=r||null;e=t.tracks;t=e.length;r=Array(t);for(var n={endingStart:2400,endingEnd:2400},i=0;i!==t;++i){var o=e[i].createInterpolant(null);r[i]=o;o.settings=n}this._interpolantSettings=n;this._interpolants=r;this._propertyBindings=Array(t);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=2201;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function bi(e){this._root=e;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1}function wi(e,t){"string"===typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=t);this.value=e}function xi(){A.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0}function Si(e,t,r){Ct.call(this,e,t);this.meshPerAttribute=r||1}function Mi(e,t,r){_.call(this,e,t);this.meshPerAttribute=r||1}function Ci(e,t,r,n){this.ray=new B(e,t);this.near=r||0;this.far=n||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})}function Ei(e,t){return e.distance-t.distance}function Ti(e,t,r,n){if(!1!==e.visible&&(e.raycast(t,r),!0===n)){e=e.children;n=0;for(var i=e.length;n<i;n++)Ti(e[n],t,r,!0)}}function Oi(e){this.autoStart=void 0!==e?e:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1}function Pi(e,t,r){this.radius=void 0!==e?e:1;this.phi=void 0!==t?t:0;this.theta=void 0!==r?r:0;return this}function Ai(e,t,r){this.radius=void 0!==e?e:1;this.theta=void 0!==t?t:0;this.y=void 0!==r?r:0;return this}function ji(e,t){this.min=void 0!==e?e:new H(Infinity,Infinity);this.max=void 0!==t?t:new H(-Infinity,-Infinity)}function Ri(e,t){this.start=void 0!==e?e:new xe;this.end=void 0!==t?t:new xe}function ki(e){h.call(this);this.material=e;this.render=function(){}}function Li(e,t,r,n){this.object=e;this.size=void 0!==t?t:1;e=void 0!==r?r:16711680;n=void 0!==n?n:1;t=0;(r=this.object.geometry)&&r.isGeometry?t=3*r.faces.length:r&&r.isBufferGeometry&&(t=r.attributes.normal.count);r=new A;t=new P(6*t,3);r.addAttribute("position",t);It.call(this,r,new kt({color:e,linewidth:n}));this.matrixAutoUpdate=!1;this.update()}function Ii(e,t){h.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=!1;this.color=t;e=new A;t=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var r=0,n=1;32>r;r++,n++){var i=r/32*Math.PI*2,o=n/32*Math.PI*2;t.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}e.addAttribute("position",new P(t,3));t=new kt({fog:!1});this.cone=new It(e,t);this.add(this.cone);this.update()}function Ni(e){var t=[];e&&e.isBone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,Ni(e.children[r]));return t}function Di(e){for(var t=Ni(e),r=new A,n=[],i=[],o=new x(0,0,1),a=new x(0,1,0),s=0;s<t.length;s++){var u=t[s];u.parent&&u.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}r.addAttribute("position",new P(n,3));r.addAttribute("color",new P(i,3));n=new kt({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});It.call(this,r,n);this.root=e;this.bones=t;this.matrix=e.matrixWorld;this.matrixAutoUpdate=!1}function Bi(e,t,r){this.light=e;this.light.updateMatrixWorld();this.color=r;e=new Rr(t,4,2);t=new I({wireframe:!0,fog:!1});z.call(this,e,t);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1;this.update()}function Fi(e,t){h.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=!1;this.color=t;e=new kt({fog:!1});t=new A;t.addAttribute("position",new _(new Float32Array(15),3));this.line=new Lt(t,e);this.add(this.line);this.update()}function zi(e,t,r){h.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=!1;this.color=r;e=new Zt(t);e.rotateY(.5*Math.PI);this.material=new I({wireframe:!0,fog:!1});void 0===this.color&&(this.material.vertexColors=2);t=e.getAttribute("position");t=new Float32Array(3*t.count);e.addAttribute("color",new _(t,3));this.add(new z(e,this.material));this.update()}function $i(e,t,r,n){e=e||10;t=t||10;r=new x(void 0!==r?r:4473924);n=new x(void 0!==n?n:8947848);var i=t/2,o=e/t,a=e/2;e=[];for(var s=[],u=0,c=0,h=-a;u<=t;u++,h+=o){e.push(-a,0,h,a,0,h);e.push(h,0,-a,h,0,a);var l=u===i?r:n;l.toArray(s,c);c+=3;l.toArray(s,c);c+=3;l.toArray(s,c);c+=3;l.toArray(s,c);c+=3}t=new A;t.addAttribute("position",new P(e,3));t.addAttribute("color",new P(s,3));r=new kt({vertexColors:2});It.call(this,t,r)}function Ui(e,t,r,n,i,o){e=e||10;t=t||16;r=r||8;n=n||64;i=new x(void 0!==i?i:4473924);o=new x(void 0!==o?o:8947848);var a=[],s=[],u;for(u=0;u<=t;u++){var c=u/t*2*Math.PI;var h=Math.sin(c)*e;c=Math.cos(c)*e;a.push(0,0,0);a.push(h,0,c);var l=u&1?i:o;s.push(l.r,l.g,l.b);s.push(l.r,l.g,l.b)}for(u=0;u<=r;u++){l=u&1?i:o;var p=e-e/r*u;for(t=0;t<n;t++)c=t/n*2*Math.PI,h=Math.sin(c)*p,c=Math.cos(c)*p,a.push(h,0,c),s.push(l.r,l.g,l.b),c=(t+1)/n*2*Math.PI,h=Math.sin(c)*p,c=Math.cos(c)*p,a.push(h,0,c),s.push(l.r,l.g,l.b)}e=new A;e.addAttribute("position",new P(a,3));e.addAttribute("color",new P(s,3));a=new kt({vertexColors:2});It.call(this,e,a)}function Gi(e,t,r,n){this.object=e;this.size=void 0!==t?t:1;e=void 0!==r?r:16776960;n=void 0!==n?n:1;t=0;(r=this.object.geometry)&&r.isGeometry?t=r.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");r=new A;t=new P(6*t,3);r.addAttribute("position",t);It.call(this,r,new kt({color:e,linewidth:n}));this.matrixAutoUpdate=!1;this.update()}function Vi(e,t,r){h.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=!1;this.color=r;void 0===t&&(t=1);e=new A;e.addAttribute("position",new P([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));t=new kt({fog:!1});this.lightPlane=new Lt(e,t);this.add(this.lightPlane);e=new A;e.addAttribute("position",new P([0,0,0,0,0,1],3));this.targetLine=new Lt(e,t);this.add(this.targetLine);this.update()}function Hi(e){function t(e,t,r){n(e,r);n(t,r)}function n(e,t){o.push(0,0,0);a.push(t.r,t.g,t.b);void 0===s[e]&&(s[e]=[]);s[e].push(o.length/3-1)}var r=new A,i=new kt({color:16777215,vertexColors:1}),o=[],a=[],s={},u=new x(16755200),c=new x(16711680),h=new x(43775),l=new x(16777215),p=new x(3355443);t("n1","n2",u);t("n2","n4",u);t("n4","n3",u);t("n3","n1",u);t("f1","f2",u);t("f2","f4",u);t("f4","f3",u);t("f3","f1",u);t("n1","f1",u);t("n2","f2",u);t("n3","f3",u);t("n4","f4",u);t("p","n1",c);t("p","n2",c);t("p","n3",c);t("p","n4",c);t("u1","u2",h);t("u2","u3",h);t("u3","u1",h);t("c","t",l);t("p","c",p);t("cn1","cn2",p);t("cn3","cn4",p);t("cf1","cf2",p);t("cf3","cf4",p);r.addAttribute("position",new P(o,3));r.addAttribute("color",new P(a,3));It.call(this,r,i);this.camera=e;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=e.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=s;this.update()}function qi(e,t){this.object=e;void 0===t&&(t=16776960);e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var r=new Float32Array(24),n=new A;n.setIndex(new _(e,1));n.addAttribute("position",new _(r,3));It.call(this,n,new kt({color:t}));this.matrixAutoUpdate=!1;this.update()}function Wi(e,t){this.type="Box3Helper";this.box=e;e=void 0!==t?t:16776960;t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var r=new A;r.setIndex(new _(t,1));r.addAttribute("position",new P([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3));It.call(this,r,new kt({color:e}));this.geometry.computeBoundingSphere()}function Xi(e,t,r){this.type="PlaneHelper";this.plane=e;this.size=void 0===t?1:t;e=void 0!==r?r:16776960;t=new A;t.addAttribute("position",new P([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3));t.computeBoundingSphere();Lt.call(this,t,new kt({color:e}));t=new A;t.addAttribute("position",new P([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3));t.computeBoundingSphere();this.add(new z(t,new I({color:e,opacity:.2,transparent:!0,depthWrite:!1})))}function Yi(e,t,r,n,i,o){h.call(this);void 0===n&&(n=16776960);void 0===r&&(r=1);void 0===i&&(i=.2*r);void 0===o&&(o=.2*i);void 0===Ho&&(Ho=new A,Ho.addAttribute("position",new P([0,0,0,0,1,0],3)),qo=new Ur(0,.5,1,5,1),qo.translate(0,-.5,0));this.position.copy(t);this.line=new Lt(Ho,new kt({color:n}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new z(qo,new I({color:n}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(e);this.setLength(r,i,o)}function Ki(e){e=e||1;var t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e];e=new A;e.addAttribute("position",new P(t,3));e.addAttribute("color",new P([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));t=new kt({vertexColors:2});It.call(this,e,t)}function Zi(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");dn.call(this,e);this.type="catmullrom";this.closed=!0}function Ji(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");dn.call(this,e);this.type="catmullrom"}function Qi(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead.");dn.call(this,e);this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"===typeof e&&isFinite(e)&&Math.floor(e)===e});void 0===Math.sign&&(Math.sign=function(e){return 0>e?-1:0<e?1:+e});!1==="name"in Function.prototype&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});void 0===Object.assign&&function(){Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(void 0!==n&&null!==n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}}();Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]);-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){void 0!==this._listeners&&(e=this._listeners[e],void 0!==e&&(t=e.indexOf(t),-1!==t&&e.splice(t,1)))},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;t=t.slice(0);for(var r=0,n=t.length;r<n;r++)t[r].call(this,e)}}}});var eo={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var i=[],e=0;256>e;e++)i[e]=(16>e?"0":"")+e.toString(16);return function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(i[e&255]+i[e>>8&255]+i[e>>16&255]+i[e>>24&255]+"-"+i[t&255]+i[t>>8&255]+"-"+i[t>>16&15|64]+i[t>>24&255]+"-"+i[r&63|128]+i[r>>8&255]+"-"+i[r>>16&255]+i[r>>24&255]+i[n&255]+i[n>>8&255]+i[n>>16&255]+i[n>>24&255]).toUpperCase()}}(),clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,n,i){return n+(e-t)*(i-n)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){if(e<=t)return 0;if(e>=r)return 1;e=(e-t)/(r-t);return e*e*(3-2*e)},smootherstep:function(e,t,r){if(e<=t)return 0;if(e>=r)return 1;e=(e-t)/(r-t);return e*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*eo.DEG2RAD},radToDeg:function(e){return e*eo.RAD2DEG},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};Object.defineProperties(H.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}});Object.assign(H.prototype,{isVector2:!0,set:function(e,t){this.x=e;this.y=t;return this},setScalar:function(e){this.y=this.x=e;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){this.x=e.x;this.y=e.y;return this},add:function(e,t){if(void 0!==t)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t);this.x+=e.x;this.y+=e.y;return this},addScalar:function(e){this.x+=e;this.y+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this},addScaledVector:function(e,t){this.x+=e.x*t;this.y+=e.y*t;return this},sub:function(e,t){if(void 0!==t)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t);this.x-=e.x;this.y-=e.y;return this},subScalar:function(e){this.x-=e;this.y-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this},multiply:function(e){this.x*=e.x;this.y*=e.y;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;return this},divide:function(e){this.x/=e.x;this.y/=e.y;return this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y;e=e.elements;this.x=e[0]*t+e[3]*r+e[6];this.y=e[1]*t+e[4]*r+e[7];return this},min:function(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);return this},max:function(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);return this},clamp:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));return this},clampScalar:function(){var r=new H,n=new H;return function(e,t){r.set(e,e);n.set(t,t);return this.clamp(r,n)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);0>e&&(e+=2*Math.PI);return e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;e=this.y-e.y;return t*t+e*e},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;return this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){void 0===t&&(t=0);this.x=e[t];this.y=e[t+1];return this},toArray:function(e,t){void 0===e&&(e=[]);void 0===t&&(t=0);e[t]=this.x;e[t+1]=this.y;return e},fromBufferAttribute:function(e,t,r){void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute().");this.x=e.getX(t);this.y=e.getY(t);return this},rotateAround:function(e,t){var r=Math.cos(t);t=Math.sin(t);var n=this.x-e.x,i=this.y-e.y;this.x=n*r-i*t+e.x;this.y=n*t+i*r+e.y;return this}});Object.assign(we.prototype,{isMatrix4:!0,set:function(e,t,r,n,i,o,a,s,u,c,h,l,p,f,d,v){var m=this.elements;m[0]=e;m[4]=t;m[8]=r;m[12]=n;m[1]=i;m[5]=o;m[9]=a;m[13]=s;m[2]=u;m[6]=c;m[10]=h;m[14]=l;m[3]=p;m[7]=f;m[11]=d;m[15]=v;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new we).fromArray(this.elements)},copy:function(e){var t=this.elements;e=e.elements;t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return this},copyPosition:function(e){var t=this.elements;e=e.elements;t[12]=e[12];t[13]=e[13];t[14]=e[14];return this},extractBasis:function(e,t,r){e.setFromMatrixColumn(this,0);t.setFromMatrixColumn(this,1);r.setFromMatrixColumn(this,2);return this},makeBasis:function(e,t,r){this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1);return this},extractRotation:function(){var o=new xe;return function(e){var t=this.elements,r=e.elements,n=1/o.setFromMatrixColumn(e,0).length(),i=1/o.setFromMatrixColumn(e,1).length();e=1/o.setFromMatrixColumn(e,2).length();t[0]=r[0]*n;t[1]=r[1]*n;t[2]=r[2]*n;t[3]=0;t[4]=r[4]*i;t[5]=r[5]*i;t[6]=r[6]*i;t[7]=0;t[8]=r[8]*e;t[9]=r[9]*e;t[10]=r[10]*e;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,n=e.y,i=e.z,o=Math.cos(r);r=Math.sin(r);var a=Math.cos(n);n=Math.sin(n);var s=Math.cos(i);i=Math.sin(i);if("XYZ"===e.order){e=o*s;var u=o*i,c=r*s,h=r*i;t[0]=a*s;t[4]=-a*i;t[8]=n;t[1]=u+c*n;t[5]=e-h*n;t[9]=-r*a;t[2]=h-e*n;t[6]=c+u*n;t[10]=o*a}else"YXZ"===e.order?(e=a*s,u=a*i,c=n*s,h=n*i,t[0]=e+h*r,t[4]=c*r-u,t[8]=o*n,t[1]=o*i,t[5]=o*s,t[9]=-r,t[2]=u*r-c,t[6]=h+e*r,t[10]=o*a):"ZXY"===e.order?(e=a*s,u=a*i,c=n*s,h=n*i,t[0]=e-h*r,t[4]=-o*i,t[8]=c+u*r,t[1]=u+c*r,t[5]=o*s,t[9]=h-e*r,t[2]=-o*n,t[6]=r,t[10]=o*a):"ZYX"===e.order?(e=o*s,u=o*i,c=r*s,h=r*i,t[0]=a*s,t[4]=c*n-u,t[8]=e*n+h,t[1]=a*i,t[5]=h*n+e,t[9]=u*n-c,t[2]=-n,t[6]=r*a,t[10]=o*a):"YZX"===e.order?(e=o*a,u=o*n,c=r*a,h=r*n,t[0]=a*s,t[4]=h-e*i,t[8]=c*i+u,t[1]=i,t[5]=o*s,t[9]=-r*s,t[2]=-n*s,t[6]=u*i+c,t[10]=e-h*i):"XZY"===e.order&&(e=o*a,u=o*n,c=r*a,h=r*n,t[0]=a*s,t[4]=-i,t[8]=n*s,t[1]=e*i+h,t[5]=o*s,t[9]=u*i-c,t[2]=c*i-u,t[6]=r*s,t[10]=h*i+e);t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},makeRotationFromQuaternion:function(){var t=new xe(0,0,0),r=new xe(1,1,1);return function(e){return this.compose(t,e,r)}}(),lookAt:function(){var i=new xe,o=new xe,a=new xe;return function(e,t,r){var n=this.elements;a.subVectors(e,t);0===a.lengthSq()&&(a.z=1);a.normalize();i.crossVectors(r,a);0===i.lengthSq()&&(1===Math.abs(r.z)?a.x+=1e-4:a.z+=1e-4,a.normalize(),i.crossVectors(r,a));i.normalize();o.crossVectors(a,i);n[0]=i.x;n[4]=o.x;n[8]=a.x;n[1]=i.y;n[5]=o.y;n[9]=a.y;n[2]=i.z;n[6]=o.z;n[10]=a.z;return this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements;t=this.elements;e=r[0];var i=r[4],o=r[8],a=r[12],s=r[1],u=r[5],c=r[9],h=r[13],l=r[2],p=r[6],f=r[10],d=r[14],v=r[3],m=r[7],g=r[11];r=r[15];var _=n[0],y=n[4],b=n[8],w=n[12],x=n[1],S=n[5],M=n[9],C=n[13],E=n[2],T=n[6],O=n[10],P=n[14],A=n[3],j=n[7],R=n[11];n=n[15];t[0]=e*_+i*x+o*E+a*A;t[4]=e*y+i*S+o*T+a*j;t[8]=e*b+i*M+o*O+a*R;t[12]=e*w+i*C+o*P+a*n;t[1]=s*_+u*x+c*E+h*A;t[5]=s*y+u*S+c*T+h*j;t[9]=s*b+u*M+c*O+h*R;t[13]=s*w+u*C+c*P+h*n;t[2]=l*_+p*x+f*E+d*A;t[6]=l*y+p*S+f*T+d*j;t[10]=l*b+p*M+f*O+d*R;t[14]=l*w+p*C+f*P+d*n;t[3]=v*_+m*x+g*E+r*A;t[7]=v*y+m*S+g*T+r*j;t[11]=v*b+m*M+g*O+r*R;t[15]=v*w+m*C+g*P+r*n;return this},multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[4]*=e;t[8]*=e;t[12]*=e;t[1]*=e;t[5]*=e;t[9]*=e;t[13]*=e;t[2]*=e;t[6]*=e;t[10]*=e;t[14]*=e;t[3]*=e;t[7]*=e;t[11]*=e;t[15]*=e;return this},applyToBufferAttribute:function(){var n=new xe;return function(e){for(var t=0,r=e.count;t<r;t++)n.x=e.getX(t),n.y=e.getY(t),n.z=e.getZ(t),n.applyMatrix4(this),e.setXYZ(t,n.x,n.y,n.z);return e}}(),determinant:function(){var e=this.elements,t=e[0],r=e[4],n=e[8],i=e[12],o=e[1],a=e[5],s=e[9],u=e[13],c=e[2],h=e[6],l=e[10],p=e[14];return e[3]*(+i*s*h-n*u*h-i*a*l+r*u*l+n*a*p-r*s*p)+e[7]*(+t*s*p-t*u*l+i*o*l-n*o*p+n*u*c-i*s*c)+e[11]*(+t*u*h-t*a*p-i*o*h+r*o*p+i*a*c-r*u*c)+e[15]*(-n*a*c-t*s*h+t*a*l+n*o*h-r*o*l+r*s*c)},transpose:function(){var e=this.elements;var t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this},setPosition:function(e){var t=this.elements;t[12]=e.x;t[13]=e.y;t[14]=e.z;return this},getInverse:function(e,t){var r=this.elements,n=e.elements;e=n[0];var i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=n[6],h=n[7],l=n[8],p=n[9],f=n[10],d=n[11],v=n[12],m=n[13],g=n[14];n=n[15];var _=p*g*h-m*f*h+m*c*d-u*g*d-p*c*n+u*f*n,y=v*f*h-l*g*h-v*c*d+s*g*d+l*c*n-s*f*n,b=l*m*h-v*p*h+v*u*d-s*m*d-l*u*n+s*p*n,w=v*p*c-l*m*c-v*u*f+s*m*f+l*u*g-s*p*g,x=e*_+i*y+o*b+a*w;if(0===x){if(!0===t)throw Error("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");console.warn("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");return this.identity()}t=1/x;r[0]=_*t;r[1]=(m*f*a-p*g*a-m*o*d+i*g*d+p*o*n-i*f*n)*t;r[2]=(u*g*a-m*c*a+m*o*h-i*g*h-u*o*n+i*c*n)*t;r[3]=(p*c*a-u*f*a-p*o*h+i*f*h+u*o*d-i*c*d)*t;r[4]=y*t;r[5]=(l*g*a-v*f*a+v*o*d-e*g*d-l*o*n+e*f*n)*t;r[6]=(v*c*a-s*g*a-v*o*h+e*g*h+s*o*n-e*c*n)*t;r[7]=(s*f*a-l*c*a+l*o*h-e*f*h-s*o*d+e*c*d)*t;r[8]=b*t;r[9]=(v*p*a-l*m*a-v*i*d+e*m*d+l*i*n-e*p*n)*t;r[10]=(s*m*a-v*u*a+v*i*h-e*m*h-s*i*n+e*u*n)*t;r[11]=(l*u*a-s*p*a-l*i*h+e*p*h+s*i*d-e*u*d)*t;r[12]=w*t;r[13]=(l*m*o-v*p*o+v*i*f-e*m*f-l*i*g+e*p*g)*t;r[14]=(v*u*o-s*m*o-v*i*c+e*m*c+s*i*g-e*u*g)*t;r[15]=(s*p*o-l*u*o+l*i*c-e*p*c-s*i*f+e*u*f)*t;return this},scale:function(e){var t=this.elements,r=e.x,n=e.y;e=e.z;t[0]*=r;t[4]*=n;t[8]*=e;t[1]*=r;t[5]*=n;t[9]*=e;t[2]*=r;t[6]*=n;t[10]*=e;t[3]*=r;t[7]*=n;t[11]*=e;return this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))},makeTranslation:function(e,t,r){this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1);return this},makeRotationX:function(e){var t=Math.cos(e);e=Math.sin(e);this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1);return this},makeRotationY:function(e){var t=Math.cos(e);e=Math.sin(e);this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1);return this},makeRotationZ:function(e){var t=Math.cos(e);e=Math.sin(e);this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(e,t){var r=Math.cos(t);t=Math.sin(t);var n=1-r,i=e.x,o=e.y;e=e.z;var a=n*i,s=n*o;this.set(a*i+r,a*o-t*e,a*e+t*o,0,a*o+t*e,s*o+r,s*e-t*i,0,a*e-t*o,s*e+t*i,n*e*e+r,0,0,0,0,1);return this},makeScale:function(e,t,r){this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1);return this},makeShear:function(e,t,r){this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1);return this},compose:function(e,t,r){var n=this.elements,i=t._x,o=t._y,a=t._z,s=t._w,u=i+i,c=o+o,h=a+a;t=i*u;var l=i*c;i*=h;var p=o*c;o*=h;a*=h;u*=s;c*=s;s*=h;h=r.x;var f=r.y;r=r.z;n[0]=(1-(p+a))*h;n[1]=(l+s)*h;n[2]=(i-c)*h;n[3]=0;n[4]=(l-s)*f;n[5]=(1-(t+a))*f;n[6]=(o+u)*f;n[7]=0;n[8]=(i+c)*r;n[9]=(o-u)*r;n[10]=(1-(t+p))*r;n[11]=0;n[12]=e.x;n[13]=e.y;n[14]=e.z;n[15]=1;return this},decompose:function(){var u=new xe,c=new we;return function(e,t,r){var n=this.elements,i=u.set(n[0],n[1],n[2]).length(),o=u.set(n[4],n[5],n[6]).length(),a=u.set(n[8],n[9],n[10]).length();0>this.determinant()&&(i=-i);e.x=n[12];e.y=n[13];e.z=n[14];c.copy(this);e=1/i;n=1/o;var s=1/a;c.elements[0]*=e;c.elements[1]*=e;c.elements[2]*=e;c.elements[4]*=n;c.elements[5]*=n;c.elements[6]*=n;c.elements[8]*=s;c.elements[9]*=s;c.elements[10]*=s;t.setFromRotationMatrix(c);r.x=i;r.y=o;r.z=a;return this}}(),makePerspective:function(e,t,r,n,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements;a[0]=2*i/(t-e);a[4]=0;a[8]=(t+e)/(t-e);a[12]=0;a[1]=0;a[5]=2*i/(r-n);a[9]=(r+n)/(r-n);a[13]=0;a[2]=0;a[6]=0;a[10]=-(o+i)/(o-i);a[14]=-2*o*i/(o-i);a[3]=0;a[7]=0;a[11]=-1;a[15]=0;return this},makeOrthographic:function(e,t,r,n,i,o){var a=this.elements,s=1/(t-e),u=1/(r-n),c=1/(o-i);a[0]=2*s;a[4]=0;a[8]=0;a[12]=-((t+e)*s);a[1]=0;a[5]=2*u;a[9]=0;a[13]=-((r+n)*u);a[2]=0;a[6]=0;a[10]=-2*c;a[14]=-((o+i)*c);a[3]=0;a[7]=0;a[11]=0;a[15]=1;return this},equals:function(e){var t=this.elements;e=e.elements;for(var r=0;16>r;r++)if(t[r]!==e[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;16>r;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]);void 0===t&&(t=0);var r=this.elements;e[t]=r[0];e[t+1]=r[1];e[t+2]=r[2];e[t+3]=r[3];e[t+4]=r[4];e[t+5]=r[5];e[t+6]=r[6];e[t+7]=r[7];e[t+8]=r[8];e[t+9]=r[9];e[t+10]=r[10];e[t+11]=r[11];e[t+12]=r[12];e[t+13]=r[13];e[t+14]=r[14];e[t+15]=r[15];return e}});Object.assign(s,{slerp:function(e,t,r,n){return r.copy(e).slerp(t,n)},slerpFlat:function(e,t,r,n,i,o,a){var s=r[n+0],u=r[n+1],c=r[n+2];r=r[n+3];n=i[o+0];var h=i[o+1],l=i[o+2];i=i[o+3];if(r!==i||s!==n||u!==h||c!==l){o=1-a;var p=s*n+u*h+c*l+r*i,f=0<=p?1:-1,d=1-p*p;d>Number.EPSILON&&(d=Math.sqrt(d),p=Math.atan2(d,p*f),o=Math.sin(o*p)/d,a=Math.sin(a*p)/d);f*=a;s=s*o+n*f;u=u*o+h*f;c=c*o+l*f;r=r*o+i*f;o===1-a&&(a=1/Math.sqrt(s*s+u*u+c*c+r*r),s*=a,u*=a,c*=a,r*=a)}e[t]=s;e[t+1]=u;e[t+2]=c;e[t+3]=r}});Object.defineProperties(s.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e;this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e;this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e;this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e;this.onChangeCallback()}}});Object.assign(s.prototype,{set:function(e,t,r,n){this._x=e;this._y=t;this._z=r;this._w=n;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){this._x=e.x;this._y=e.y;this._z=e.z;this._w=e.w;this.onChangeCallback();return this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,n=e._y,i=e._z;e=e.order;var o=Math.cos,a=Math.sin,s=o(r/2),u=o(n/2);o=o(i/2);r=a(r/2);n=a(n/2);i=a(i/2);"XYZ"===e?(this._x=r*u*o+s*n*i,this._y=s*n*o-r*u*i,this._z=s*u*i+r*n*o,this._w=s*u*o-r*n*i):"YXZ"===e?(this._x=r*u*o+s*n*i,this._y=s*n*o-r*u*i,this._z=s*u*i-r*n*o,this._w=s*u*o+r*n*i):"ZXY"===e?(this._x=r*u*o-s*n*i,this._y=s*n*o+r*u*i,this._z=s*u*i+r*n*o,this._w=s*u*o-r*n*i):"ZYX"===e?(this._x=r*u*o-s*n*i,this._y=s*n*o+r*u*i,this._z=s*u*i-r*n*o,this._w=s*u*o+r*n*i):"YZX"===e?(this._x=r*u*o+s*n*i,this._y=s*n*o+r*u*i,this._z=s*u*i-r*n*o,this._w=s*u*o-r*n*i):"XZY"===e&&(this._x=r*u*o-s*n*i,this._y=s*n*o-r*u*i,this._z=s*u*i+r*n*o,this._w=s*u*o+r*n*i);if(!1!==t)this.onChangeCallback();return this},setFromAxisAngle:function(e,t){t/=2;var r=Math.sin(t);this._x=e.x*r;this._y=e.y*r;this._z=e.z*r;this._w=Math.cos(t);this.onChangeCallback();return this},setFromRotationMatrix:function(e){var t=e.elements,r=t[0];e=t[4];var n=t[8],i=t[1],o=t[5],a=t[9],s=t[2],u=t[6];t=t[10];var c=r+o+t;0<c?(r=.5/Math.sqrt(c+1),this._w=.25/r,this._x=(u-a)*r,this._y=(n-s)*r,this._z=(i-e)*r):r>o&&r>t?(r=2*Math.sqrt(1+r-o-t),this._w=(u-a)/r,this._x=.25*r,this._y=(e+i)/r,this._z=(n+s)/r):o>t?(r=2*Math.sqrt(1+o-r-t),this._w=(n-s)/r,this._x=(e+i)/r,this._y=.25*r,this._z=(a+u)/r):(r=2*Math.sqrt(1+t-r-o),this._w=(i-e)/r,this._x=(n+s)/r,this._y=(a+u)/r,this._z=.25*r);this.onChangeCallback();return this},setFromUnitVectors:function(){var r=new xe,n;return function(e,t){void 0===r&&(r=new xe);n=e.dot(t)+1;1e-6>n?(n=0,Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0):r.set(0,-e.z,e.y)):r.crossVectors(e,t);this._x=r.x;this._y=r.y;this._z=r.z;this._w=n;return this.normalize()}}(),angleTo:function(e){return 2*Math.acos(Math.abs(eo.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);if(0===r)return this;this.slerp(e,Math.min(1,t/r));return this},inverse:function(){return this.conjugate()},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();0===e?(this._z=this._y=this._x=0,this._w=1):(e=1/e,this._x*=e,this._y*=e,this._z*=e,this._w*=e);this.onChangeCallback();return this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,n=e._y,i=e._z;e=e._w;var o=t._x,a=t._y,s=t._z;t=t._w;this._x=r*t+e*o+n*s-i*a;this._y=n*t+e*a+i*o-r*s;this._z=i*t+e*s+r*a-n*o;this._w=e*t-r*o-n*a-i*s;this.onChangeCallback();return this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var r=this._x,n=this._y,i=this._z,o=this._w,a=o*e._w+r*e._x+n*e._y+i*e._z;0>a?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e);if(1<=a)return this._w=o,this._x=r,this._y=n,this._z=i,this;e=1-a*a;if(e<=Number.EPSILON)return a=1-t,this._w=a*o+t*this._w,this._x=a*r+t*this._x,this._y=a*n+t*this._y,this._z=a*i+t*this._z,this.normalize();e=Math.sqrt(e);var s=Math.atan2(e,a);a=Math.sin((1-t)*s)/e;t=Math.sin(t*s)/e;this._w=o*a+this._w*t;this._x=r*a+this._x*t;this._y=n*a+this._y*t;this._z=i*a+this._z*t;this.onChangeCallback();return this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){void 0===t&&(t=0);this._x=e[t];this._y=e[t+1];this._z=e[t+2];this._w=e[t+3];this.onChangeCallback();return this},toArray:function(e,t){void 0===e&&(e=[]);void 0===t&&(t=0);e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._w;return e},onChange:function(e){this.onChangeCallback=e;return this},onChangeCallback:function(){}});Object.assign(xe.prototype,{isVector3:!0,set:function(e,t,r){this.x=e;this.y=t;this.z=r;return this},setScalar:function(e){this.z=this.y=this.x=e;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;return this},add:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t);this.x+=e.x;this.y+=e.y;this.z+=e.z;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;return this},addScaledVector:function(e,t){this.x+=e.x*t;this.y+=e.y*t;this.z+=e.z*t;return this},sub:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t);this.x-=e.x;this.y-=e.y;this.z-=e.z;return this},subScalar:function(e){this.x-=e;this.y-=e;this.z-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;return this},multiply:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t);this.x*=e.x;this.y*=e.y;this.z*=e.z;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;return this},multiplyVectors:function(e,t){this.x=e.x*t.x;this.y=e.y*t.y;this.z=e.z*t.z;return this},applyEuler:function(){var t=new s;return function(e){e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");return this.applyQuaternion(t.setFromEuler(e))}}(),applyAxisAngle:function(){var r=new s;return function(e,t){return this.applyQuaternion(r.setFromAxisAngle(e,t))}}(),applyMatrix3:function(e){var t=this.x,r=this.y,n=this.z;e=e.elements;this.x=e[0]*t+e[3]*r+e[6]*n;this.y=e[1]*t+e[4]*r+e[7]*n;this.z=e[2]*t+e[5]*r+e[8]*n;return this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z;e=e.elements;var i=1/(e[3]*t+e[7]*r+e[11]*n+e[15]);this.x=(e[0]*t+e[4]*r+e[8]*n+e[12])*i;this.y=(e[1]*t+e[5]*r+e[9]*n+e[13])*i;this.z=(e[2]*t+e[6]*r+e[10]*n+e[14])*i;return this},applyQuaternion:function(e){var t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,a=e.z;e=e.w;var s=e*t+o*n-a*r,u=e*r+a*t-i*n,c=e*n+i*r-o*t;t=-i*t-o*r-a*n;this.x=s*e+t*-i+u*-a-c*-o;this.y=u*e+t*-o+c*-i-s*-a;this.z=c*e+t*-a+s*-o-u*-i;return this},project:function(){var t=new we;return function(e){t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld));return this.applyMatrix4(t)}}(),unproject:function(){var t=new we;return function(e){t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix));return this.applyMatrix4(t)}}(),transformDirection:function(e){var t=this.x,r=this.y,n=this.z;e=e.elements;this.x=e[0]*t+e[4]*r+e[8]*n;this.y=e[1]*t+e[5]*r+e[9]*n;this.z=e[2]*t+e[6]*r+e[10]*n;return this.normalize()},divide:function(e){this.x/=e.x;this.y/=e.y;this.z/=e.z;return this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);this.z=Math.min(this.z,e.z);return this},max:function(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);this.z=Math.max(this.z,e.z);return this},clamp:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));this.z=Math.max(e.z,Math.min(t.z,this.z));return this},clampScalar:function(){var r=new xe,n=new xe;return function(e,t){r.set(e,e,e);n.set(t,t,t);return this.clamp(r,n)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;return this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,n=e.y;e=e.z;var i=t.x,o=t.y;t=t.z;this.x=n*t-e*o;this.y=e*i-r*t;this.z=r*o-n*i;return this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var t=new xe;return function(e){t.copy(this).projectOnVector(e);return this.sub(t)}}(),reflect:function(){var t=new xe;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(e){e=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(eo.clamp(e,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;e=this.z-e.z;return t*t+r*r+e*e},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){var t=Math.sin(e.phi)*e.radius;this.x=t*Math.sin(e.theta);this.y=Math.cos(e.phi)*e.radius;this.z=t*Math.cos(e.theta);return this},setFromCylindrical:function(e){this.x=e.radius*Math.sin(e.theta);this.y=e.y;this.z=e.radius*Math.cos(e.theta);return this},setFromMatrixPosition:function(e){e=e.elements;this.x=e[12];this.y=e[13];this.z=e[14];return this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length();e=this.setFromMatrixColumn(e,2).length();this.x=t;this.y=r;this.z=e;return this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){void 0===t&&(t=0);this.x=e[t];this.y=e[t+1];this.z=e[t+2];return this},toArray:function(e,t){void 0===e&&(e=[]);void 0===t&&(t=0);e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;return e},fromBufferAttribute:function(e,t,r){void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute().");this.x=e.getX(t);this.y=e.getY(t);this.z=e.getZ(t);return this}});Object.assign(m.prototype,{isMatrix3:!0,set:function(e,t,r,n,i,o,a,s,u){var c=this.elements;c[0]=e;c[1]=n;c[2]=a;c[3]=t;c[4]=i;c[5]=s;c[6]=r;c[7]=o;c[8]=u;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements;e=e.elements;t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return this},setFromMatrix4:function(e){e=e.elements;this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]);return this},applyToBufferAttribute:function(){var n=new xe;return function(e){for(var t=0,r=e.count;t<r;t++)n.x=e.getX(t),n.y=e.getY(t),n.z=e.getZ(t),n.applyMatrix3(this),e.setXYZ(t,n.x,n.y,n.z);return e}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,n=t.elements;t=this.elements;e=r[0];var i=r[3],o=r[6],a=r[1],s=r[4],u=r[7],c=r[2],h=r[5];r=r[8];var l=n[0],p=n[3],f=n[6],d=n[1],v=n[4],m=n[7],g=n[2],_=n[5];n=n[8];t[0]=e*l+i*d+o*g;t[3]=e*p+i*v+o*_;t[6]=e*f+i*m+o*n;t[1]=a*l+s*d+u*g;t[4]=a*p+s*v+u*_;t[7]=a*f+s*m+u*n;t[2]=c*l+h*d+r*g;t[5]=c*p+h*v+r*_;t[8]=c*f+h*m+r*n;return this},multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[3]*=e;t[6]*=e;t[1]*=e;t[4]*=e;t[7]*=e;t[2]*=e;t[5]*=e;t[8]*=e;return this},determinant:function(){var e=this.elements,t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7];e=e[8];return t*o*e-t*a*u-r*i*e+r*a*s+n*i*u-n*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements;e=this.elements;var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],u=r[5],c=r[6],h=r[7];r=r[8];var l=r*s-u*h,p=u*c-r*a,f=h*a-s*c,d=n*l+i*p+o*f;if(0===d){if(!0===t)throw Error("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");console.warn("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");return this.identity()}t=1/d;e[0]=l*t;e[1]=(o*h-r*i)*t;e[2]=(u*i-o*s)*t;e[3]=p*t;e[4]=(r*n-o*c)*t;e[5]=(o*a-u*n)*t;e[6]=f*t;e[7]=(i*c-h*n)*t;e[8]=(s*n-i*a)*t;return this},transpose:function(){var e=this.elements;var t=e[1];e[1]=e[3];e[3]=t;t=e[2];e[2]=e[6];e[6]=t;t=e[5];e[5]=e[7];e[7]=t;return this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8];return this},setUvTransform:function(e,t,r,n,i,o,a){var s=Math.cos(i);i=Math.sin(i);this.set(r*s,r*i,-r*(s*o+i*a)+o+e,-n*i,n*s,-n*(-i*o+s*a)+a+t,0,0,1)},scale:function(e,t){var r=this.elements;r[0]*=e;r[3]*=e;r[6]*=e;r[1]*=t;r[4]*=t;r[7]*=t;return this},rotate:function(e){var t=Math.cos(e);e=Math.sin(e);var r=this.elements,n=r[0],i=r[3],o=r[6],a=r[1],s=r[4],u=r[7];r[0]=t*n+e*a;r[3]=t*i+e*s;r[6]=t*o+e*u;r[1]=-e*n+t*a;r[4]=-e*i+t*s;r[7]=-e*o+t*u;return this},translate:function(e,t){var r=this.elements;r[0]+=e*r[2];r[3]+=e*r[5];r[6]+=e*r[8];r[1]+=t*r[2];r[4]+=t*r[5];r[7]+=t*r[8];return this},equals:function(e){var t=this.elements;e=e.elements;for(var r=0;9>r;r++)if(t[r]!==e[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;9>r;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]);void 0===t&&(t=0);var r=this.elements;e[t]=r[0];e[t+1]=r[1];e[t+2]=r[2];e[t+3]=r[3];e[t+4]=r[4];e[t+5]=r[5];e[t+6]=r[6];e[t+7]=r[7];e[t+8]=r[8];return e}});var to={getDataURL:function(e){if(e instanceof HTMLCanvasElement)var t=e;else{"undefined"!==typeof OffscreenCanvas?t=new OffscreenCanvas(e.width,e.height):(t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),t.width=e.width,t.height=e.height);var r=t.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height)}return 2048<t.width||2048<t.height?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},ro=0;p.DEFAULT_IMAGE=void 0;p.DEFAULT_MAPPING=300;p.prototype=Object.assign(Object.create(t.prototype),{constructor:p,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name;this.image=e.image;this.mipmaps=e.mipmaps.slice(0);this.mapping=e.mapping;this.wrapS=e.wrapS;this.wrapT=e.wrapT;this.magFilter=e.magFilter;this.minFilter=e.minFilter;this.anisotropy=e.anisotropy;this.format=e.format;this.type=e.type;this.offset.copy(e.offset);this.repeat.copy(e.repeat);this.center.copy(e.center);this.rotation=e.rotation;this.matrixAutoUpdate=e.matrixAutoUpdate;this.matrix.copy(e.matrix);this.generateMipmaps=e.generateMipmaps;this.premultiplyAlpha=e.premultiplyAlpha;this.flipY=e.flipY;this.unpackAlignment=e.unpackAlignment;this.encoding=e.encoding;return this},toJSON:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=eo.generateUUID());if(!t&&void 0===e.images[n.uuid]){if(Array.isArray(n)){var i=[];for(var o=0,a=n.length;o<a;o++)i.push(to.getDataURL(n[o]))}else i=to.getDataURL(n);e.images[n.uuid]={uuid:n.uuid,url:i}}r.image=n.uuid}t||(e.textures[this.uuid]=r);return r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300===this.mapping){e.applyMatrix3(this.matrix);if(0>e.x||1<e.x)switch(this.wrapS){case 1e3:e.x-=Math.floor(e.x);break;case 1001:e.x=0>e.x?0:1;break;case 1002:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(0>e.y||1<e.y)switch(this.wrapT){case 1e3:e.y-=Math.floor(e.y);break;case 1001:e.y=0>e.y?0:1;break;case 1002:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}});Object.defineProperty(p.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});Object.assign(Se.prototype,{isVector4:!0,set:function(e,t,r,n){this.x=e;this.y=t;this.z=r;this.w=n;return this},setScalar:function(e){this.w=this.z=this.y=this.x=e;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setW:function(e){this.w=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=void 0!==e.w?e.w:1;return this},add:function(e,t){if(void 0!==t)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t);this.x+=e.x;this.y+=e.y;this.z+=e.z;this.w+=e.w;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;this.w+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;this.w=e.w+t.w;return this},addScaledVector:function(e,t){this.x+=e.x*t;this.y+=e.y*t;this.z+=e.z*t;this.w+=e.w*t;return this},sub:function(e,t){if(void 0!==t)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t);this.x-=e.x;this.y-=e.y;this.z-=e.z;this.w-=e.w;return this},subScalar:function(e){this.x-=e;this.y-=e;this.z-=e;this.w-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;this.w=e.w-t.w;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;this.w*=e;return this},applyMatrix4:function(e){var t=this.x,r=this.y,n=this.z,i=this.w;e=e.elements;this.x=e[0]*t+e[4]*r+e[8]*n+e[12]*i;this.y=e[1]*t+e[5]*r+e[9]*n+e[13]*i;this.z=e[2]*t+e[6]*r+e[10]*n+e[14]*i;this.w=e[3]*t+e[7]*r+e[11]*n+e[15]*i;return this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t);return this},setAxisAngleFromRotationMatrix:function(e){e=e.elements;var t=e[0];var r=e[4];var n=e[8],i=e[1],o=e[5],a=e[9];var s=e[2];var u=e[6];var c=e[10];if(.01>Math.abs(r-i)&&.01>Math.abs(n-s)&&.01>Math.abs(a-u)){if(.1>Math.abs(r+i)&&.1>Math.abs(n+s)&&.1>Math.abs(a+u)&&.1>Math.abs(t+o+c-3))return this.set(1,0,0,0),this;e=Math.PI;t=(t+1)/2;o=(o+1)/2;c=(c+1)/2;r=(r+i)/4;n=(n+s)/4;a=(a+u)/4;t>o&&t>c?.01>t?(u=0,r=s=.707106781):(u=Math.sqrt(t),s=r/u,r=n/u):o>c?.01>o?(u=.707106781,s=0,r=.707106781):(s=Math.sqrt(o),u=r/s,r=a/s):.01>c?(s=u=.707106781,r=0):(r=Math.sqrt(c),u=n/r,s=a/r);this.set(u,s,r,e);return this}e=Math.sqrt((u-a)*(u-a)+(n-s)*(n-s)+(i-r)*(i-r));.001>Math.abs(e)&&(e=1);this.x=(u-a)/e;this.y=(n-s)/e;this.z=(i-r)/e;this.w=Math.acos((t+o+c-1)/2);return this},min:function(e){this.x=Math.min(this.x,e.x);this.y=Math.min(this.y,e.y);this.z=Math.min(this.z,e.z);this.w=Math.min(this.w,e.w);return this},max:function(e){this.x=Math.max(this.x,e.x);this.y=Math.max(this.y,e.y);this.z=Math.max(this.z,e.z);this.w=Math.max(this.w,e.w);return this},clamp:function(e,t){this.x=Math.max(e.x,Math.min(t.x,this.x));this.y=Math.max(e.y,Math.min(t.y,this.y));this.z=Math.max(e.z,Math.min(t.z,this.z));this.w=Math.max(e.w,Math.min(t.w,this.w));return this},clampScalar:function(){var r,n;return function(e,t){void 0===r&&(r=new Se,n=new Se);r.set(e,e,e,e);n.set(t,t,t,t);return this.clamp(r,n)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;this.w+=(e.w-this.w)*t;return this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){void 0===t&&(t=0);this.x=e[t];this.y=e[t+1];this.z=e[t+2];this.w=e[t+3];return this},toArray:function(e,t){void 0===e&&(e=[]);void 0===t&&(t=0);e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;e[t+3]=this.w;return e},fromBufferAttribute:function(e,t,r){void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute().");this.x=e.getX(t);this.y=e.getY(t);this.z=e.getZ(t);this.w=e.getW(t);return this}});T.prototype=Object.assign(Object.create(t.prototype),{constructor:T,isWebGLRenderTarget:!0,setSize:function(e,t){if(this.width!==e||this.height!==t)this.width=e,this.height=t,this.dispose();this.viewport.set(0,0,e,t);this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.width=e.width;this.height=e.height;this.viewport.copy(e.viewport);this.texture=e.texture.clone();this.depthBuffer=e.depthBuffer;this.stencilBuffer=e.stencilBuffer;this.depthTexture=e.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});n.prototype=Object.create(T.prototype);n.prototype.constructor=n;n.prototype.isWebGLRenderTargetCube=!0;Me.prototype=Object.create(p.prototype);Me.prototype.constructor=Me;Me.prototype.isDataTexture=!0;Object.assign(r.prototype,{isBox3:!0,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromArray:function(e){for(var t=Infinity,r=Infinity,n=Infinity,i=-Infinity,o=-Infinity,a=-Infinity,s=0,u=e.length;s<u;s+=3){var c=e[s],h=e[s+1],l=e[s+2];c<t&&(t=c);h<r&&(r=h);l<n&&(n=l);c>i&&(i=c);h>o&&(o=h);l>a&&(a=l)}this.min.set(t,r,n);this.max.set(i,o,a);return this},setFromBufferAttribute:function(e){for(var t=Infinity,r=Infinity,n=Infinity,i=-Infinity,o=-Infinity,a=-Infinity,s=0,u=e.count;s<u;s++){var c=e.getX(s),h=e.getY(s),l=e.getZ(s);c<t&&(t=c);h<r&&(r=h);l<n&&(n=l);c>i&&(i=c);h>o&&(o=h);l>a&&(a=l)}this.min.set(t,r,n);this.max.set(i,o,a);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var r=new xe;return function(e,t){t=r.copy(t).multiplyScalar(.5);this.min.copy(e).sub(t);this.max.copy(e).add(t);return this}}(),setFromObject:function(e){this.makeEmpty();return this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new xe);return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new xe);return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},expandByObject:function(){function t(e){var t=e.geometry;if(void 0!==t)if(t.isGeometry)for(t=t.vertices,n=0,i=t.length;n<i;n++)o.copy(t[n]),o.applyMatrix4(e.matrixWorld),r.expandByPoint(o);else if(t.isBufferGeometry&&(t=t.attributes.position,void 0!==t))for(n=0,i=t.count;n<i;n++)o.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),r.expandByPoint(o)}var r,n,i,o=new xe;return function(e){r=this;e.updateMatrixWorld(!0);e.traverse(t);return this}}(),containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new xe);return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},intersectsSphere:function(){var t=new xe;return function(e){this.clampPoint(e.center,t);return t.distanceToSquared(e.center)<=e.radius*e.radius}}(),intersectsPlane:function(e){if(0<e.normal.x){var t=e.normal.x*this.min.x;var r=e.normal.x*this.max.x}else t=e.normal.x*this.max.x,r=e.normal.x*this.min.x;0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y);0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z);return t<=e.constant&&r>=e.constant},intersectsTriangle:function(){function t(e){var t;var r=0;for(t=e.length-3;r<=t;r+=3){h.fromArray(e,r);var n=l.x*Math.abs(h.x)+l.y*Math.abs(h.y)+l.z*Math.abs(h.z),i=s.dot(h),o=u.dot(h),a=c.dot(h);if(Math.max(-Math.max(i,o,a),Math.min(i,o,a))>n)return!1}return!0}var s=new xe,u=new xe,c=new xe,r=new xe,n=new xe,i=new xe,h=new xe,o=new xe,l=new xe,a=new xe;return function(e){if(this.isEmpty())return!1;this.getCenter(o);l.subVectors(this.max,o);s.subVectors(e.a,o);u.subVectors(e.b,o);c.subVectors(e.c,o);r.subVectors(u,s);n.subVectors(c,u);i.subVectors(s,c);e=[0,-r.z,r.y,0,-n.z,n.y,0,-i.z,i.y,r.z,0,-r.x,n.z,0,-n.x,i.z,0,-i.x,-r.y,r.x,0,-n.y,n.x,0,-i.y,i.x,0];if(!t(e))return!1;e=[1,0,0,0,1,0,0,0,1];if(!t(e))return!1;a.crossVectors(r,n);e=[a.x,a.y,a.z];return t(e)}}(),clampPoint:function(e,t){void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new xe);return t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var t=new xe;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new xe;return function(e){void 0===e&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),e=new c);this.getCenter(e.center);e.radius=.5*this.getSize(t).length();return e}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);this.isEmpty()&&this.makeEmpty();return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},applyMatrix4:function(e){if(this.isEmpty())return this;e=e.elements;var t=e[0]*this.min.x,r=e[1]*this.min.x,n=e[2]*this.min.x,i=e[0]*this.max.x,o=e[1]*this.max.x,a=e[2]*this.max.x,s=e[4]*this.min.y,u=e[5]*this.min.y,c=e[6]*this.min.y,h=e[4]*this.max.y,l=e[5]*this.max.y,p=e[6]*this.max.y,f=e[8]*this.min.z,d=e[9]*this.min.z,v=e[10]*this.min.z,m=e[8]*this.max.z,g=e[9]*this.max.z,_=e[10]*this.max.z;this.min.x=Math.min(t,i)+Math.min(s,h)+Math.min(f,m)+e[12];this.min.y=Math.min(r,o)+Math.min(u,l)+Math.min(d,g)+e[13];this.min.z=Math.min(n,a)+Math.min(c,p)+Math.min(v,_)+e[14];this.max.x=Math.max(t,i)+Math.max(s,h)+Math.max(f,m)+e[12];this.max.y=Math.max(r,o)+Math.max(u,l)+Math.max(d,g)+e[13];this.max.z=Math.max(n,a)+Math.max(c,p)+Math.max(v,_)+e[14];return this},translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});Object.assign(c.prototype,{set:function(e,t){this.center.copy(e);this.radius=t;return this},setFromPoints:function(){var o=new r;return function(e,t){var r=this.center;void 0!==t?r.copy(t):o.setFromPoints(e).getCenter(r);for(var n=t=0,i=e.length;n<i;n++)t=Math.max(t,r.distanceToSquared(e[n]));this.radius=Math.sqrt(t);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.center.copy(e.center);this.radius=e.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new xe);t.copy(e);r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center));return t},getBoundingBox:function(e){void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new r);e.set(this.center,this.center);e.expandByScalar(this.radius);return e},applyMatrix4:function(e){this.center.applyMatrix4(e);this.radius*=e.getMaxScaleOnAxis();return this},translate:function(e){this.center.add(e);return this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});Object.assign(g.prototype,{set:function(e,t){this.normal.copy(e);this.constant=t;return this},setComponents:function(e,t,r,n){this.normal.set(e,t,r);this.constant=n;return this},setFromNormalAndCoplanarPoint:function(e,t){this.normal.copy(e);this.constant=-t.dot(this.normal);return this},setFromCoplanarPoints:function(){var n=new xe,i=new xe;return function(e,t,r){t=n.subVectors(r,t).cross(i.subVectors(e,t)).normalize();this.setFromNormalAndCoplanarPoint(t,e);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.normal.copy(e.normal);this.constant=e.constant;return this},normalize:function(){var e=1/this.normal.length();this.normal.multiplyScalar(e);this.constant*=e;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new xe);return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var i=new xe;return function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new xe);var r=e.delta(i),n=this.normal.dot(r);if(0===n){if(0===this.distanceToPoint(e.start))return t.copy(e.start)}else if(n=-(e.start.dot(this.normal)+this.constant)/n,!(0>n||1<n))return t.copy(r).multiplyScalar(n).add(e.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start);e=this.distanceToPoint(e.end);return 0>t&&0<e||0>e&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new xe);return e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var r=new xe,n=new m;return function(e,t){t=t||n.getNormalMatrix(e);e=this.coplanarPoint(r).applyMatrix4(e);t=this.normal.applyMatrix3(t).normalize();this.constant=-e.dot(t);return this}}(),translate:function(e){this.constant-=e.dot(this.normal);return this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});Object.assign(Ce.prototype,{set:function(e,t,r,n,i,o){var a=this.planes;a[0].copy(e);a[1].copy(t);a[2].copy(r);a[3].copy(n);a[4].copy(i);a[5].copy(o);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,r=0;6>r;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements;e=r[0];var n=r[1],i=r[2],o=r[3],a=r[4],s=r[5],u=r[6],c=r[7],h=r[8],l=r[9],p=r[10],f=r[11],d=r[12],v=r[13],m=r[14];r=r[15];t[0].setComponents(o-e,c-a,f-h,r-d).normalize();t[1].setComponents(o+e,c+a,f+h,r+d).normalize();t[2].setComponents(o+n,c+s,f+l,r+v).normalize();t[3].setComponents(o-n,c-s,f-l,r-v).normalize();t[4].setComponents(o-i,c-u,f-p,r-m).normalize();t[5].setComponents(o+i,c+u,f+p,r+m).normalize();return this},intersectsObject:function(){var r=new c;return function(e){var t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere();r.copy(t.boundingSphere).applyMatrix4(e.matrixWorld);return this.intersectsSphere(r)}}(),intersectsSprite:function(){var t=new c;return function(e){t.center.set(0,0,0);t.radius=.7071067811865476;t.applyMatrix4(e.matrixWorld);return this.intersectsSphere(t)}}(),intersectsSphere:function(e){var t=this.planes,r=e.center;e=-e.radius;for(var n=0;6>n;n++)if(t[n].distanceToPoint(r)<e)return!1;return!0},intersectsBox:function(){var i=new xe;return function(e){for(var t=this.planes,r=0;6>r;r++){var n=t[r];i.x=0<n.normal.x?e.max.x:e.min.x;i.y=0<n.normal.y?e.max.y:e.min.y;i.z=0<n.normal.z?e.max.z:e.min.z;if(0>n.distanceToPoint(i))return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;6>r;r++)if(0>t[r].distanceToPoint(e))return!1;return!0}});var no={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tvec4 mvPosition;\n\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n"},io={merge:function(e){for(var t={},r=0;r<e.length;r++){var n=this.clone(e[r]),i;for(i in n)t[i]=n[i]}return t},clone:function(e){var t={},r;for(r in e){t[r]={};for(var n in e[r]){var i=e[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[r][n]=i.clone():Array.isArray(i)?t[r][n]=i.slice():t[r][n]=i}}return t}},oo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(x.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e);return this},setScalar:function(e){this.b=this.g=this.r=e;return this},setHex:function(e){e=Math.floor(e);this.r=(e>>16&255)/255;this.g=(e>>8&255)/255;this.b=(e&255)/255;return this},setRGB:function(e,t,r){this.r=e;this.g=t;this.b=r;return this},setHSL:function(){function n(e,t,r){0>r&&(r+=1);1<r&&--r;return r<1/6?e+6*(t-e)*r:.5>r?t:r<2/3?e+6*(t-e)*(2/3-r):e}return function(e,t,r){e=eo.euclideanModulo(e,1);t=eo.clamp(t,0,1);r=eo.clamp(r,0,1);0===t?this.r=this.g=this.b=r:(t=.5>=r?r*(1+t):r+t-r*t,r=2*r-t,this.r=n(r,t,e+1/3),this.g=n(r,t,e),this.b=n(r,t,e-1/3));return this}}(),setStyle:function(t){function e(e){void 0!==e&&1>parseFloat(e)&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n=r[2];switch(r[1]){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,e(r[5]),this;if(r=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,e(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n)){n=parseFloat(r[1])/360;var i=parseInt(r[2],10)/100,o=parseInt(r[3],10)/100;e(r[5]);return this.setHSL(n,i,o)}}}else if(r=/^#([A-Fa-f0-9]+)$/.exec(t)){r=r[1];n=r.length;if(3===n)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,this;if(6===n)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,this}t&&0<t.length&&(r=oo[t],void 0!==r?this.setHex(r):console.warn("THREE.Color: Unknown color "+t));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){this.r=e.r;this.g=e.g;this.b=e.b;return this},copyGammaToLinear:function(e,t){void 0===t&&(t=2);this.r=Math.pow(e.r,t);this.g=Math.pow(e.g,t);this.b=Math.pow(e.b,t);return this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);t=0<t?1/t:1;this.r=Math.pow(e.r,t);this.g=Math.pow(e.g,t);this.b=Math.pow(e.b,t);return this},convertGammaToLinear:function(e){this.copyGammaToLinear(this,e);return this},convertLinearToGamma:function(e){this.copyLinearToGamma(this,e);return this},copySRGBToLinear:function(){function t(e){return.04045>e?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}return function(e){this.r=t(e.r);this.g=t(e.g);this.b=t(e.b);return this}}(),copyLinearToSRGB:function(){function t(e){return.0031308>e?12.92*e:1.055*Math.pow(e,.41666)-.055}return function(e){this.r=t(e.r);this.g=t(e.g);this.b=t(e.b);return this}}(),convertSRGBToLinear:function(){this.copySRGBToLinear(this);return this},convertLinearToSRGB:function(){this.copyLinearToSRGB(this);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t=this.r,r=this.g,n=this.b,i=Math.max(t,r,n),o=Math.min(t,r,n),a,s=(o+i)/2;if(o===i)o=a=0;else{var u=i-o;o=.5>=s?u/(i+o):u/(2-i-o);switch(i){case t:a=(r-n)/u+(r<n?6:0);break;case r:a=(n-t)/u+2;break;case n:a=(t-r)/u+4}a/=6}e.h=a;e.s=o;e.l=s;return e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var n={};return function(e,t,r){this.getHSL(n);n.h+=e;n.s+=t;n.l+=r;this.setHSL(n.h,n.s,n.l);return this}}(),add:function(e){this.r+=e.r;this.g+=e.g;this.b+=e.b;return this},addColors:function(e,t){this.r=e.r+t.r;this.g=e.g+t.g;this.b=e.b+t.b;return this},addScalar:function(e){this.r+=e;this.g+=e;this.b+=e;return this},sub:function(e){this.r=Math.max(0,this.r-e.r);this.g=Math.max(0,this.g-e.g);this.b=Math.max(0,this.b-e.b);return this},multiply:function(e){this.r*=e.r;this.g*=e.g;this.b*=e.b;return this},multiplyScalar:function(e){this.r*=e;this.g*=e;this.b*=e;return this},lerp:function(e,t){this.r+=(e.r-this.r)*t;this.g+=(e.g-this.g)*t;this.b+=(e.b-this.b)*t;return this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){void 0===t&&(t=0);this.r=e[t];this.g=e[t+1];this.b=e[t+2];return this},toArray:function(e,t){void 0===e&&(e=[]);void 0===t&&(t=0);e[t]=this.r;e[t+1]=this.g;e[t+2]=this.b;return e},toJSON:function(){return this.getHex()}});var ao={common:{diffuse:{value:new x(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new m},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new H(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new x(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new x(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new m}},sprite:{diffuse:{value:new x(15658734)},opacity:{value:1},center:{value:new H(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new m}}},so={basic:{uniforms:io.merge([ao.common,ao.specularmap,ao.envmap,ao.aomap,ao.lightmap,ao.fog]),vertexShader:no.meshbasic_vert,fragmentShader:no.meshbasic_frag},lambert:{uniforms:io.merge([ao.common,ao.specularmap,ao.envmap,ao.aomap,ao.lightmap,ao.emissivemap,ao.fog,ao.lights,{emissive:{value:new x(0)}}]),vertexShader:no.meshlambert_vert,fragmentShader:no.meshlambert_frag},phong:{uniforms:io.merge([ao.common,ao.specularmap,ao.envmap,ao.aomap,ao.lightmap,ao.emissivemap,ao.bumpmap,ao.normalmap,ao.displacementmap,ao.gradientmap,ao.fog,ao.lights,{emissive:{value:new x(0)},specular:{value:new x(1118481)},shininess:{value:30}}]),vertexShader:no.meshphong_vert,fragmentShader:no.meshphong_frag},standard:{uniforms:io.merge([ao.common,ao.envmap,ao.aomap,ao.lightmap,ao.emissivemap,ao.bumpmap,ao.normalmap,ao.displacementmap,ao.roughnessmap,ao.metalnessmap,ao.fog,ao.lights,{emissive:{value:new x(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:no.meshphysical_vert,fragmentShader:no.meshphysical_frag},points:{uniforms:io.merge([ao.points,ao.fog]),vertexShader:no.points_vert,fragmentShader:no.points_frag},dashed:{uniforms:io.merge([ao.common,ao.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:no.linedashed_vert,fragmentShader:no.linedashed_frag},depth:{uniforms:io.merge([ao.common,ao.displacementmap]),vertexShader:no.depth_vert,fragmentShader:no.depth_frag},normal:{uniforms:io.merge([ao.common,ao.bumpmap,ao.normalmap,ao.displacementmap,{opacity:{value:1}}]),vertexShader:no.normal_vert,fragmentShader:no.normal_frag},sprite:{uniforms:io.merge([ao.sprite,ao.fog]),vertexShader:no.sprite_vert,fragmentShader:no.sprite_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:no.cube_vert,fragmentShader:no.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:no.equirect_vert,fragmentShader:no.equirect_frag},distanceRGBA:{uniforms:io.merge([ao.common,ao.displacementmap,{referencePosition:{value:new xe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:no.distanceRGBA_vert,fragmentShader:no.distanceRGBA_frag},shadow:{uniforms:io.merge([ao.lights,ao.fog,{color:{value:new x(0)},opacity:{value:1}}]),vertexShader:no.shadow_vert,fragmentShader:no.shadow_frag}};so.physical={uniforms:io.merge([so.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:no.meshphysical_vert,fragmentShader:no.meshphysical_frag};i.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");i.DefaultOrder="XYZ";Object.defineProperties(i.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e;this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e;this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e;this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e;this.onChangeCallback()}}});Object.assign(i.prototype,{isEuler:!0,set:function(e,t,r,n){this._x=e;this._y=t;this._z=r;this._order=n||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){this._x=e._x;this._y=e._y;this._z=e._z;this._order=e._order;this.onChangeCallback();return this},setFromRotationMatrix:function(e,t,r){var n=eo.clamp,i=e.elements;e=i[0];var o=i[4],a=i[8],s=i[1],u=i[5],c=i[9],h=i[2],l=i[6];i=i[10];t=t||this._order;"XYZ"===t?(this._y=Math.asin(n(a,-1,1)),.99999>Math.abs(a)?(this._x=Math.atan2(-c,i),this._z=Math.atan2(-o,e)):(this._x=Math.atan2(l,u),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(c,-1,1)),.99999>Math.abs(c)?(this._y=Math.atan2(a,i),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-h,e),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(l,-1,1)),.99999>Math.abs(l)?(this._y=Math.atan2(-h,i),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(s,e))):"ZYX"===t?(this._y=Math.asin(-n(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(l,i),this._z=Math.atan2(s,e)):(this._x=0,this._z=Math.atan2(-o,u))):"YZX"===t?(this._z=Math.asin(n(s,-1,1)),.99999>Math.abs(s)?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,e)):(this._x=0,this._y=Math.atan2(a,i))):"XZY"===t?(this._z=Math.asin(-n(o,-1,1)),.99999>Math.abs(o)?(this._x=Math.atan2(l,u),this._y=Math.atan2(a,e)):(this._x=Math.atan2(-c,i),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t);this._order=t;if(!1!==r)this.onChangeCallback();return this},setFromQuaternion:function(){var n=new we;return function(e,t,r){n.makeRotationFromQuaternion(e);return this.setFromRotationMatrix(n,t,r)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var t=new s;return function(e){t.setFromEuler(this);return this.setFromQuaternion(t,e)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){this._x=e[0];this._y=e[1];this._z=e[2];void 0!==e[3]&&(this._order=e[3]);this.onChangeCallback();return this},toArray:function(e,t){void 0===e&&(e=[]);void 0===t&&(t=0);e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._order;return e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new xe(this._x,this._y,this._z)},onChange:function(e){this.onChangeCallback=e;return this},onChangeCallback:function(){}});Object.assign(o.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask=this.mask|1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!==(this.mask&e.mask)}});var uo=0;h.DefaultUp=new xe(0,1,0);h.DefaultMatrixAutoUpdate=!0;h.prototype=Object.assign(Object.create(t.prototype),{constructor:h,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){this.quaternion.premultiply(e);return this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var r=new s;return function(e,t){r.setFromAxisAngle(e,t);this.quaternion.multiply(r);return this}}(),rotateOnWorldAxis:function(){var r=new s;return function(e,t){r.setFromAxisAngle(e,t);this.quaternion.premultiply(r);return this}}(),rotateX:function(){var t=new xe(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new xe(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new xe(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var r=new xe;return function(e,t){r.copy(e).applyQuaternion(this.quaternion);this.position.add(r.multiplyScalar(t));return this}}(),translateX:function(){var t=new xe(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new xe(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new xe(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new we;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var n=new we,i=new xe;return function(e,t,r){e.isVector3?i.copy(e):i.set(e,t,r);this.isCamera?n.lookAt(this.position,i,this.up):n.lookAt(i,this.position,this.up);this.quaternion.setFromRotationMatrix(n)}}(),add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}if(e===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this;e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e);return this},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}t=this.children.indexOf(e);-1!==t&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(t,1));return this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new xe);this.updateMatrixWorld(!0);return e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new xe,r=new xe;return function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new s);this.updateMatrixWorld(!0);this.matrixWorld.decompose(t,e,r);return e}}(),getWorldScale:function(){var t=new xe,r=new s;return function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new xe);this.updateMatrixWorld(!0);this.matrixWorld.decompose(t,r,e);return e}}(),getWorldDirection:function(){var t=new s;return function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new xe);this.getWorldQuaternion(t);return e.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=this.children,r=0,n=t.length;r<n;r++)t[r].updateMatrixWorld(e)},toJSON:function(r){function e(e,t){void 0===e[t.uuid]&&(e[t.uuid]=t.toJSON(r));return t.uuid}function t(e){var t=[],r;for(r in e){var n=e[r];delete n.metadata;t.push(n)}return t}var n=void 0===r||"string"===typeof r,i={};n&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var o={};o.uuid=this.uuid;o.type=this.type;""!==this.name&&(o.name=this.name);!0===this.castShadow&&(o.castShadow=!0);!0===this.receiveShadow&&(o.receiveShadow=!0);!1===this.visible&&(o.visible=!1);!1===this.frustumCulled&&(o.frustumCulled=!1);0!==this.renderOrder&&(o.renderOrder=this.renderOrder);"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData);o.layers=this.layers.mask;o.matrix=this.matrix.toArray();!1===this.matrixAutoUpdate&&(o.matrixAutoUpdate=!1);if(this.isMesh||this.isLine||this.isPoints){o.geometry=e(r.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes)if(a=a.shapes,Array.isArray(a))for(var s=0,u=a.length;s<u;s++)e(r.shapes,a[s]);else e(r.shapes,a)}if(void 0!==this.material)if(Array.isArray(this.material)){a=[];s=0;for(u=this.material.length;s<u;s++)a.push(e(r.materials,this.material[s]));o.material=a}else o.material=e(r.materials,this.material);if(0<this.children.length)for(o.children=[],s=0;s<this.children.length;s++)o.children.push(this.children[s].toJSON(r).object);if(n){n=t(r.geometries);s=t(r.materials);u=t(r.textures);var c=t(r.images);a=t(r.shapes);0<n.length&&(i.geometries=n);0<s.length&&(i.materials=s);0<u.length&&(i.textures=u);0<c.length&&(i.images=c);0<a.length&&(i.shapes=a)}i.object=o;return i},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){void 0===t&&(t=!0);this.name=e.name;this.up.copy(e.up);this.position.copy(e.position);this.quaternion.copy(e.quaternion);this.scale.copy(e.scale);this.matrix.copy(e.matrix);this.matrixWorld.copy(e.matrixWorld);this.matrixAutoUpdate=e.matrixAutoUpdate;this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate;this.layers.mask=e.layers.mask;this.visible=e.visible;this.castShadow=e.castShadow;this.receiveShadow=e.receiveShadow;this.frustumCulled=e.frustumCulled;this.renderOrder=e.renderOrder;this.userData=JSON.parse(JSON.stringify(e.userData));if(!0===t)for(t=0;t<e.children.length;t++)this.add(e.children[t].clone());return this}});u.prototype=Object.assign(Object.create(h.prototype),{constructor:u,isCamera:!0,copy:function(e,t){h.prototype.copy.call(this,e,t);this.matrixWorldInverse.copy(e.matrixWorldInverse);this.projectionMatrix.copy(e.projectionMatrix);return this},getWorldDirection:function(){var t=new s;return function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new xe);this.getWorldQuaternion(t);return e.set(0,0,-1).applyQuaternion(t)}}(),updateMatrixWorld:function(e){h.prototype.updateMatrixWorld.call(this,e);this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}});f.prototype=Object.assign(Object.create(u.prototype),{constructor:f,isOrthographicCamera:!0,copy:function(e,t){u.prototype.copy.call(this,e,t);this.left=e.left;this.right=e.right;this.top=e.top;this.bottom=e.bottom;this.near=e.near;this.far=e.far;this.zoom=e.zoom;this.view=null===e.view?null:Object.assign({},e.view);return this},setViewOffset:function(e,t,r,n,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1});this.view.enabled=!0;this.view.fullWidth=e;this.view.fullHeight=t;this.view.offsetX=r;this.view.offsetY=n;this.view.width=i;this.view.height=o;this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1);this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-e;r+=e;e=n+t;t=n-t;if(null!==this.view&&this.view.enabled){r=this.zoom/(this.view.width/this.view.fullWidth);t=this.zoom/(this.view.height/this.view.fullHeight);var o=(this.right-this.left)/this.view.width;n=(this.top-this.bottom)/this.view.height;i+=this.view.offsetX/r*o;r=i+this.view.width/r*o;e-=this.view.offsetY/t*n;t=e-this.view.height/t*n}this.projectionMatrix.makeOrthographic(i,r,e,t,this.near,this.far)},toJSON:function(e){e=h.prototype.toJSON.call(this,e);e.object.zoom=this.zoom;e.object.left=this.left;e.object.right=this.right;e.object.top=this.top;e.object.bottom=this.bottom;e.object.near=this.near;e.object.far=this.far;null!==this.view&&(e.object.view=Object.assign({},this.view));return e}});Object.assign(D.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a;this.b=e.b;this.c=e.c;this.normal.copy(e.normal);this.color.copy(e.color);this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();t=0;for(r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var co=0;S.prototype=Object.assign(Object.create(t.prototype),{constructor:S,isGeometry:!0,applyMatrix:function(e){for(var t=(new m).getNormalMatrix(e),r=0,n=this.vertices.length;r<n;r++)this.vertices[r].applyMatrix4(e);r=0;for(n=this.faces.length;r<n;r++){e=this.faces[r];e.normal.applyMatrix3(t).normalize();for(var i=0,o=e.vertexNormals.length;i<o;i++)e.vertexNormals[i].applyMatrix3(t).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var t=new we;return function(e){t.makeRotationX(e);this.applyMatrix(t);return this}}(),rotateY:function(){var t=new we;return function(e){t.makeRotationY(e);this.applyMatrix(t);return this}}(),rotateZ:function(){var t=new we;return function(e){t.makeRotationZ(e);this.applyMatrix(t);return this}}(),translate:function(){var n=new we;return function(e,t,r){n.makeTranslation(e,t,r);this.applyMatrix(n);return this}}(),scale:function(){var n=new we;return function(e,t,r){n.makeScale(e,t,r);this.applyMatrix(n);return this}}(),lookAt:function(){var t=new h;return function(e){t.lookAt(e);t.updateMatrix();this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(e){function t(e,t,r,n){var i=void 0!==s?[l[e].clone(),l[t].clone(),l[r].clone()]:[],o=void 0!==u?[a.colors[e].clone(),a.colors[t].clone(),a.colors[r].clone()]:[];n=new D(e,t,r,i,o,n);a.faces.push(n);void 0!==c&&a.faceVertexUvs[0].push([p[e].clone(),p[t].clone(),p[r].clone()]);void 0!==h&&a.faceVertexUvs[1].push([f[e].clone(),f[t].clone(),f[r].clone()])}var a=this,r=null!==e.index?e.index.array:void 0,n=e.attributes,i=n.position.array,s=void 0!==n.normal?n.normal.array:void 0,u=void 0!==n.color?n.color.array:void 0,c=void 0!==n.uv?n.uv.array:void 0,h=void 0!==n.uv2?n.uv2.array:void 0;void 0!==h&&(this.faceVertexUvs[1]=[]);for(var l=[],p=[],f=[],o=n=0;n<i.length;n+=3,o+=2)a.vertices.push(new xe(i[n],i[n+1],i[n+2])),void 0!==s&&l.push(new xe(s[n],s[n+1],s[n+2])),void 0!==u&&a.colors.push(new x(u[n],u[n+1],u[n+2])),void 0!==c&&p.push(new H(c[o],c[o+1])),void 0!==h&&f.push(new H(h[o],h[o+1]));var d=e.groups;if(0<d.length)for(n=0;n<d.length;n++){i=d[n];var v=i.start,m=i.count;o=v;for(v+=m;o<v;o+=3)void 0!==r?t(r[o],r[o+1],r[o+2],i.materialIndex):t(o,o+1,o+2,i.materialIndex)}else if(void 0!==r)for(n=0;n<r.length;n+=3)t(r[n],r[n+1],r[n+2]);else for(n=0;n<i.length/3;n+=3)t(n,n+1,n+2);this.computeFaceNormals();null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone());null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone());return this},center:function(){var e=new xe;return function(){this.computeBoundingBox();this.boundingBox.getCenter(e).negate();this.translate(e.x,e.y,e.z);return this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius;t=0===t?1:1/t;var r=new we;r.set(t,0,0,-t*e.x,0,t,0,-t*e.y,0,0,t,-t*e.z,0,0,0,1);this.applyMatrix(r);return this},computeFaceNormals:function(){for(var e=new xe,t=new xe,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],o=this.vertices[i.a],a=this.vertices[i.b];e.subVectors(this.vertices[i.c],a);t.subVectors(o,a);e.cross(t);e.normalize();i.normal.copy(e)}},computeVertexNormals:function(e){void 0===e&&(e=!0);var t;var r=Array(this.vertices.length);var n=0;for(t=this.vertices.length;n<t;n++)r[n]=new xe;if(e){var i=new xe,o=new xe;e=0;for(n=this.faces.length;e<n;e++){t=this.faces[e];var a=this.vertices[t.a];var s=this.vertices[t.b];var u=this.vertices[t.c];i.subVectors(u,s);o.subVectors(a,s);i.cross(o);r[t.a].add(i);r[t.b].add(i);r[t.c].add(i)}}else for(this.computeFaceNormals(),e=0,n=this.faces.length;e<n;e++)t=this.faces[e],r[t.a].add(t.normal),r[t.b].add(t.normal),r[t.c].add(t.normal);n=0;for(t=this.vertices.length;n<t;n++)r[n].normalize();e=0;for(n=this.faces.length;e<n;e++)t=this.faces[e],a=t.vertexNormals,3===a.length?(a[0].copy(r[t.a]),a[1].copy(r[t.b]),a[2].copy(r[t.c])):(a[0]=r[t.a].clone(),a[1]=r[t.b].clone(),a[2]=r[t.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e;this.computeFaceNormals();var t=0;for(e=this.faces.length;t<e;t++){var r=this.faces[t];var n=r.vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t;var r=0;for(t=this.faces.length;r<t;r++){var n=this.faces[r];n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone();n.__originalVertexNormals||(n.__originalVertexNormals=[]);var i=0;for(e=n.vertexNormals.length;i<e;i++)n.__originalVertexNormals[i]?n.__originalVertexNormals[i].copy(n.vertexNormals[i]):n.__originalVertexNormals[i]=n.vertexNormals[i].clone()}var o=new S;o.faces=this.faces;i=0;for(e=this.morphTargets.length;i<e;i++){if(!this.morphNormals[i]){this.morphNormals[i]={};this.morphNormals[i].faceNormals=[];this.morphNormals[i].vertexNormals=[];n=this.morphNormals[i].faceNormals;var a=this.morphNormals[i].vertexNormals;r=0;for(t=this.faces.length;r<t;r++){var s=new xe;var u={a:new xe,b:new xe,c:new xe};n.push(s);a.push(u)}}a=this.morphNormals[i];o.vertices=this.morphTargets[i].vertices;o.computeFaceNormals();o.computeVertexNormals();r=0;for(t=this.faces.length;r<t;r++)n=this.faces[r],s=a.faceNormals[r],u=a.vertexNormals[r],s.copy(n.normal),u.a.copy(n.vertexNormals[0]),u.b.copy(n.vertexNormals[1]),u.c.copy(n.vertexNormals[2])}r=0;for(t=this.faces.length;r<t;r++)n=this.faces[r],n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new r);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new c);this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var n,i=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,u=e.faces,c=this.faceVertexUvs[0],h=e.faceVertexUvs[0],l=this.colors,p=e.colors;void 0===r&&(r=0);void 0!==t&&(n=(new m).getNormalMatrix(t));e=0;for(var f=a.length;e<f;e++){var d=a[e].clone();void 0!==t&&d.applyMatrix4(t);o.push(d)}e=0;for(f=p.length;e<f;e++)l.push(p[e].clone());e=0;for(f=u.length;e<f;e++){a=u[e];var v=a.vertexNormals;p=a.vertexColors;l=new D(a.a+i,a.b+i,a.c+i);l.normal.copy(a.normal);void 0!==n&&l.normal.applyMatrix3(n).normalize();t=0;for(o=v.length;t<o;t++)d=v[t].clone(),void 0!==n&&d.applyMatrix3(n).normalize(),l.vertexNormals.push(d);l.color.copy(a.color);t=0;for(o=p.length;t<o;t++)d=p[t],l.vertexColors.push(d.clone());l.materialIndex=a.materialIndex+r;s.push(l)}e=0;for(f=h.length;e<f;e++)if(r=h[e],n=[],void 0!==r){t=0;for(o=r.length;t<o;t++)n.push(r[t].clone());c.push(n)}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e={},t=[],r=[],n=Math.pow(10,4),i;var o=0;for(i=this.vertices.length;o<i;o++){var a=this.vertices[o];a=Math.round(a.x*n)+"_"+Math.round(a.y*n)+"_"+Math.round(a.z*n);void 0===e[a]?(e[a]=o,t.push(this.vertices[o]),r[o]=t.length-1):r[o]=r[e[a]]}e=[];o=0;for(i=this.faces.length;o<i;o++)for(n=this.faces[o],n.a=r[n.a],n.b=r[n.b],n.c=r[n.c],n=[n.a,n.b,n.c],a=0;3>a;a++)if(n[a]===n[(a+1)%3]){e.push(o);break}for(o=e.length-1;0<=o;o--)for(n=e[o],this.faces.splice(n,1),r=0,i=this.faceVertexUvs.length;r<i;r++)this.faceVertexUvs[r].splice(n,1);o=this.vertices.length-t.length;this.vertices=t;return o},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var n=e[t];this.vertices.push(new xe(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var n=this.faceVertexUvs[0],i=this.faceVertexUvs[1],o,a;n&&n.length===t&&(o=[]);i&&i.length===t&&(a=[]);for(r=0;r<t;r++){var s=e[r]._id;o&&o.push(n[s]);a&&a.push(i[s])}o&&(this.faceVertexUvs[0]=o);a&&(this.faceVertexUvs[1]=a)},toJSON:function(){function e(e,t,r){return r?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();if(void 0!==c[t])return c[t];c[t]=u.length/3;u.push(e.x,e.y,e.z);return c[t]}function r(e){var t=e.r.toString()+e.g.toString()+e.b.toString();if(void 0!==l[t])return l[t];l[t]=h.length;h.push(e.getHex());return l[t]}function n(e){var t=e.x.toString()+e.y.toString();if(void 0!==f[t])return f[t];f[t]=p.length/2;p.push(e.x,e.y);return f[t]}var i={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};i.uuid=this.uuid;i.type=this.type;""!==this.name&&(i.name=this.name);if(void 0!==this.parameters){var o=this.parameters,a;for(a in o)void 0!==o[a]&&(i[a]=o[a]);return i}o=[];for(a=0;a<this.vertices.length;a++){var s=this.vertices[a];o.push(s.x,s.y,s.z)}s=[];var u=[],c={},h=[],l={},p=[],f={};for(a=0;a<this.faces.length;a++){var d=this.faces[a],v=void 0!==this.faceVertexUvs[0][a],m=0<d.normal.length(),g=0<d.vertexNormals.length,_=1!==d.color.r||1!==d.color.g||1!==d.color.b,y=0<d.vertexColors.length,b=0;b=e(b,0,0);b=e(b,1,!0);b=e(b,2,!1);b=e(b,3,v);b=e(b,4,m);b=e(b,5,g);b=e(b,6,_);b=e(b,7,y);s.push(b);s.push(d.a,d.b,d.c);s.push(d.materialIndex);v&&(v=this.faceVertexUvs[0][a],s.push(n(v[0]),n(v[1]),n(v[2])));m&&s.push(t(d.normal));g&&(m=d.vertexNormals,s.push(t(m[0]),t(m[1]),t(m[2])));_&&s.push(r(d.color));y&&(d=d.vertexColors,s.push(r(d[0]),r(d[1]),r(d[2])))}i.data={};i.data.vertices=o;i.data.normals=u;0<h.length&&(i.data.colors=h);0<p.length&&(i.data.uvs=[p]);i.data.faces=s;return i},clone:function(){return(new S).copy(this)},copy:function(e){var t,r,n;this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.name=e.name;var i=e.vertices;var o=0;for(t=i.length;o<t;o++)this.vertices.push(i[o].clone());i=e.colors;o=0;for(t=i.length;o<t;o++)this.colors.push(i[o].clone());i=e.faces;o=0;for(t=i.length;o<t;o++)this.faces.push(i[o].clone());o=0;for(t=e.faceVertexUvs.length;o<t;o++){var a=e.faceVertexUvs[o];void 0===this.faceVertexUvs[o]&&(this.faceVertexUvs[o]=[]);i=0;for(r=a.length;i<r;i++){var s=a[i],u=[];var c=0;for(n=s.length;c<n;c++)u.push(s[c].clone());this.faceVertexUvs[o].push(u)}}c=e.morphTargets;o=0;for(t=c.length;o<t;o++){n={};n.name=c[o].name;if(void 0!==c[o].vertices)for(n.vertices=[],i=0,r=c[o].vertices.length;i<r;i++)n.vertices.push(c[o].vertices[i].clone());if(void 0!==c[o].normals)for(n.normals=[],i=0,r=c[o].normals.length;i<r;i++)n.normals.push(c[o].normals[i].clone());this.morphTargets.push(n)}c=e.morphNormals;o=0;for(t=c.length;o<t;o++){n={};if(void 0!==c[o].vertexNormals)for(n.vertexNormals=[],i=0,r=c[o].vertexNormals.length;i<r;i++)a=c[o].vertexNormals[i],s={},s.a=a.a.clone(),s.b=a.b.clone(),s.c=a.c.clone(),n.vertexNormals.push(s);if(void 0!==c[o].faceNormals)for(n.faceNormals=[],i=0,r=c[o].faceNormals.length;i<r;i++)n.faceNormals.push(c[o].faceNormals[i].clone());this.morphNormals.push(n)}i=e.skinWeights;o=0;for(t=i.length;o<t;o++)this.skinWeights.push(i[o].clone());i=e.skinIndices;o=0;for(t=i.length;o<t;o++)this.skinIndices.push(i[o].clone());i=e.lineDistances;o=0;for(t=i.length;o<t;o++)this.lineDistances.push(i[o]);o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());o=e.boundingSphere;null!==o&&(this.boundingSphere=o.clone());this.elementsNeedUpdate=e.elementsNeedUpdate;this.verticesNeedUpdate=e.verticesNeedUpdate;this.uvsNeedUpdate=e.uvsNeedUpdate;this.normalsNeedUpdate=e.normalsNeedUpdate;this.colorsNeedUpdate=e.colorsNeedUpdate;this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate;this.groupsNeedUpdate=e.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.defineProperty(_.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});Object.assign(_.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.itemSize:0;this.array=e;return this},setDynamic:function(e){this.dynamic=e;return this},copy:function(e){this.name=e.name;this.array=new e.array.constructor(e.array);this.itemSize=e.itemSize;this.count=e.count;this.normalized=e.normalized;this.dynamic=e.dynamic;return this},copyAt:function(e,t,r){e*=this.itemSize;r*=t.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[e+n]=t.array[r+n];return this},copyArray:function(e){this.array.set(e);return this},copyColorsArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new x);t[r++]=o.r;t[r++]=o.g;t[r++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new H);t[r++]=o.x;t[r++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new xe);t[r++]=o.x;t[r++]=o.y;t[r++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,n=0,i=e.length;n<i;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new Se);t[r++]=o.x;t[r++]=o.y;t[r++]=o.z;t[r++]=o.w}return this},set:function(e,t){void 0===t&&(t=0);this.array.set(e,t);return this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){this.array[e*this.itemSize]=t;return this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){this.array[e*this.itemSize+1]=t;return this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){this.array[e*this.itemSize+2]=t;return this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){this.array[e*this.itemSize+3]=t;return this},setXY:function(e,t,r){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=r;return this},setXYZ:function(e,t,r,n){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=r;this.array[e+2]=n;return this},setXYZW:function(e,t,r,n,i){e*=this.itemSize;this.array[e+0]=t;this.array[e+1]=r;this.array[e+2]=n;this.array[e+3]=i;return this},onUpload:function(e){this.onUploadCallback=e;return this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}});a.prototype=Object.create(_.prototype);a.prototype.constructor=a;l.prototype=Object.create(_.prototype);l.prototype.constructor=l;d.prototype=Object.create(_.prototype);d.prototype.constructor=d;v.prototype=Object.create(_.prototype);v.prototype.constructor=v;y.prototype=Object.create(_.prototype);y.prototype.constructor=y;b.prototype=Object.create(_.prototype);b.prototype.constructor=b;w.prototype=Object.create(_.prototype);w.prototype.constructor=w;P.prototype=Object.create(_.prototype);P.prototype.constructor=P;M.prototype=Object.create(_.prototype);M.prototype.constructor=M;Object.assign(C.prototype,{computeGroups:function(e){var t=[],r=void 0;e=e.faces;for(var n=0;n<e.length;n++){var i=e[n];if(i.materialIndex!==r){r=i.materialIndex;void 0!==o&&(o.count=3*n-o.start,t.push(o));var o={start:3*n,materialIndex:r}}}void 0!==o&&(o.count=3*n-o.start,t.push(o));this.groups=t},fromGeometry:function(e){var t=e.faces,r=e.vertices,n=e.faceVertexUvs,i=n[0]&&0<n[0].length,o=n[1]&&0<n[1].length,a=e.morphTargets,s=a.length;if(0<s){var u=[];for(var c=0;c<s;c++)u[c]=[];this.morphTargets.position=u}var h=e.morphNormals,l=h.length;if(0<l){var p=[];for(c=0;c<l;c++)p[c]=[];this.morphTargets.normal=p}var f=e.skinIndices,d=e.skinWeights,v=f.length===r.length,m=d.length===r.length;0<r.length&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(c=0;c<t.length;c++){var g=t[c];this.vertices.push(r[g.a],r[g.b],r[g.c]);var _=g.vertexNormals;3===_.length?this.normals.push(_[0],_[1],_[2]):(_=g.normal,this.normals.push(_,_,_));_=g.vertexColors;3===_.length?this.colors.push(_[0],_[1],_[2]):(_=g.color,this.colors.push(_,_,_));!0===i&&(_=n[0][c],void 0!==_?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new H,new H,new H)));!0===o&&(_=n[1][c],void 0!==_?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new H,new H,new H)));for(_=0;_<s;_++){var y=a[_].vertices;u[_].push(y[g.a],y[g.b],y[g.c])}for(_=0;_<l;_++)y=h[_].vertexNormals[c],p[_].push(y.a,y.b,y.c);v&&this.skinIndices.push(f[g.a],f[g.b],f[g.c]);m&&this.skinWeights.push(d[g.a],d[g.b],d[g.c])}this.computeGroups(e);this.verticesNeedUpdate=e.verticesNeedUpdate;this.normalsNeedUpdate=e.normalsNeedUpdate;this.colorsNeedUpdate=e.colorsNeedUpdate;this.uvsNeedUpdate=e.uvsNeedUpdate;this.groupsNeedUpdate=e.groupsNeedUpdate;return this}});var ho=1;A.prototype=Object.assign(Object.create(t.prototype),{constructor:A,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(65535<E(e)?w:y)(e,1):this.index=e},addAttribute:function(e,t,r){if(!(t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute))return console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new _(t,r));if("index"===e)return console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this;this.attributes[e]=t;return this},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){delete this.attributes[e];return this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e;this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);t=this.attributes.normal;void 0!==t&&((new m).getNormalMatrix(e).applyToBufferAttribute(t),t.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var t=new we;return function(e){t.makeRotationX(e);this.applyMatrix(t);return this}}(),rotateY:function(){var t=new we;return function(e){t.makeRotationY(e);this.applyMatrix(t);return this}}(),rotateZ:function(){var t=new we;return function(e){t.makeRotationZ(e);this.applyMatrix(t);return this}}(),translate:function(){var n=new we;return function(e,t,r){n.makeTranslation(e,t,r);this.applyMatrix(n);return this}}(),scale:function(){var n=new we;return function(e,t,r){n.makeScale(e,t,r);this.applyMatrix(n);return this}}(),lookAt:function(){var t=new h;return function(e){t.lookAt(e);t.updateMatrix();this.applyMatrix(t.matrix)}}(),center:function(){var e=new xe;return function(){this.computeBoundingBox();this.boundingBox.getCenter(e).negate();this.translate(e.x,e.y,e.z);return this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){e=new P(3*t.vertices.length,3);var r=new P(3*t.colors.length,3);this.addAttribute("position",e.copyVector3sArray(t.vertices));this.addAttribute("color",r.copyColorsArray(t.colors));t.lineDistances&&t.lineDistances.length===t.vertices.length&&(e=new P(t.lineDistances.length,1),this.addAttribute("lineDistance",e.copyArray(t.lineDistances)));null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone());null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];t.push(i.x,i.y,i.z||0)}this.addAttribute("position",new P(t,3));return this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var r=t.__directGeometry;!0===t.elementsNeedUpdate&&(r=void 0,t.elementsNeedUpdate=!1);if(void 0===r)return this.fromGeometry(t);r.verticesNeedUpdate=t.verticesNeedUpdate;r.normalsNeedUpdate=t.normalsNeedUpdate;r.colorsNeedUpdate=t.colorsNeedUpdate;r.uvsNeedUpdate=t.uvsNeedUpdate;r.groupsNeedUpdate=t.groupsNeedUpdate;t.verticesNeedUpdate=!1;t.normalsNeedUpdate=!1;t.colorsNeedUpdate=!1;t.uvsNeedUpdate=!1;t.groupsNeedUpdate=!1;t=r}!0===t.verticesNeedUpdate&&(r=this.attributes.position,void 0!==r&&(r.copyVector3sArray(t.vertices),r.needsUpdate=!0),t.verticesNeedUpdate=!1);!0===t.normalsNeedUpdate&&(r=this.attributes.normal,void 0!==r&&(r.copyVector3sArray(t.normals),r.needsUpdate=!0),t.normalsNeedUpdate=!1);!0===t.colorsNeedUpdate&&(r=this.attributes.color,void 0!==r&&(r.copyColorsArray(t.colors),r.needsUpdate=!0),t.colorsNeedUpdate=!1);t.uvsNeedUpdate&&(r=this.attributes.uv,void 0!==r&&(r.copyVector2sArray(t.uvs),r.needsUpdate=!0),t.uvsNeedUpdate=!1);t.lineDistancesNeedUpdate&&(r=this.attributes.lineDistance,void 0!==r&&(r.copyArray(t.lineDistances),r.needsUpdate=!0),t.lineDistancesNeedUpdate=!1);t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1);return this},fromGeometry:function(e){e.__directGeometry=(new C).fromGeometry(e);return this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);this.addAttribute("position",new _(t,3).copyVector3sArray(e.vertices));0<e.normals.length&&(t=new Float32Array(3*e.normals.length),this.addAttribute("normal",new _(t,3).copyVector3sArray(e.normals)));0<e.colors.length&&(t=new Float32Array(3*e.colors.length),this.addAttribute("color",new _(t,3).copyColorsArray(e.colors)));0<e.uvs.length&&(t=new Float32Array(2*e.uvs.length),this.addAttribute("uv",new _(t,2).copyVector2sArray(e.uvs)));0<e.uvs2.length&&(t=new Float32Array(2*e.uvs2.length),this.addAttribute("uv2",new _(t,2).copyVector2sArray(e.uvs2)));this.groups=e.groups;for(var r in e.morphTargets){t=[];for(var n=e.morphTargets[r],i=0,o=n.length;i<o;i++){var a=n[i],s=new P(3*a.length,3);t.push(s.copyVector3sArray(a))}this.morphAttributes[r]=t}0<e.skinIndices.length&&(r=new P(4*e.skinIndices.length,4),this.addAttribute("skinIndex",r.copyVector4sArray(e.skinIndices)));0<e.skinWeights.length&&(r=new P(4*e.skinWeights.length,4),this.addAttribute("skinWeight",r.copyVector4sArray(e.skinWeights)));null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone());null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new r);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var o=new r,a=new xe;return function(){null===this.boundingSphere&&(this.boundingSphere=new c);var e=this.attributes.position;if(e){var t=this.boundingSphere.center;o.setFromBufferAttribute(e);o.getCenter(t);for(var r=0,n=0,i=e.count;n<i;n++)a.x=e.getX(n),a.y=e.getY(n),a.z=e.getZ(n),r=Math.max(r,t.distanceToSquared(a));this.boundingSphere.radius=Math.sqrt(r);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,r=this.groups;if(t.position){var n=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new _(new Float32Array(n.length),3));else for(var i=t.normal.array,o=0,a=i.length;o<a;o++)i[o]=0;i=t.normal.array;var s=new xe,u=new xe,c=new xe,h=new xe,l=new xe;if(e){e=e.array;0===r.length&&this.addGroup(0,e.length);for(var p=0,f=r.length;p<f;++p){o=r[p];a=o.start;var d=o.count;o=a;for(a+=d;o<a;o+=3){d=3*e[o+0];var v=3*e[o+1];var m=3*e[o+2];s.fromArray(n,d);u.fromArray(n,v);c.fromArray(n,m);h.subVectors(c,u);l.subVectors(s,u);h.cross(l);i[d]+=h.x;i[d+1]+=h.y;i[d+2]+=h.z;i[v]+=h.x;i[v+1]+=h.y;i[v+2]+=h.z;i[m]+=h.x;i[m+1]+=h.y;i[m+2]+=h.z}}}else for(o=0,a=n.length;o<a;o+=9)s.fromArray(n,o),u.fromArray(n,o+3),c.fromArray(n,o+6),h.subVectors(c,u),l.subVectors(s,u),h.cross(l),i[o]=h.x,i[o+1]=h.y,i[o+2]=h.z,i[o+3]=h.x,i[o+4]=h.y,i[o+5]=h.z,i[o+6]=h.x,i[o+7]=h.y,i[o+8]=h.z;this.normalizeNormals();t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes,n;for(n in r)if(void 0!==e.attributes[n]){var i=r[n].array,o=e.attributes[n],a=o.array,s=0;for(o=o.itemSize*t;s<a.length;s++,o++)i[o]=a[s]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var n=new xe;return function(){for(var e=this.attributes.normal,t=0,r=e.count;t<r;t++)n.x=e.getX(t),n.y=e.getY(t),n.z=e.getZ(t),n.normalize(),e.setXYZ(t,n.x,n.y,n.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new A,t=this.index.array,r=this.attributes,n;for(n in r){var i=r[n],o=i.array,a=i.itemSize,s=new o.constructor(t.length*a),u=0;i=0;for(var c=t.length;i<c;i++){var h=t[i]*a;for(var l=0;l<a;l++)s[u++]=o[h++]}e.addAttribute(n,new _(s,a))}t=this.groups;i=0;for(c=t.length;i<c;i++)r=t[i],e.addGroup(r.start,r.count,r.materialIndex);return e},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);0<Object.keys(this.userData).length&&(e.userData=this.userData);if(void 0!==this.parameters){var t=this.parameters;for(i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(t=Array.prototype.slice.call(r.array),e.data.index={type:r.array.constructor.name,array:t});r=this.attributes;for(i in r){var n=r[i];t=Array.prototype.slice.call(n.array);e.data.attributes[i]={itemSize:n.itemSize,type:n.array.constructor.name,array:t,normalized:n.normalized}}var i=this.groups;0<i.length&&(e.data.groups=JSON.parse(JSON.stringify(i)));i=this.boundingSphere;null!==i&&(e.data.boundingSphere={center:i.center.toArray(),radius:i.radius});return e},clone:function(){return(new A).copy(this)},copy:function(e){var t;this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.name=e.name;var r=e.index;null!==r&&this.setIndex(r.clone());r=e.attributes;for(a in r)this.addAttribute(a,r[a].clone());var n=e.morphAttributes;for(a in n){var i=[],o=n[a];r=0;for(t=o.length;r<t;r++)i.push(o[r].clone());this.morphAttributes[a]=i}var a=e.groups;r=0;for(t=a.length;r<t;r++)n=a[r],this.addGroup(n.start,n.count,n.materialIndex);a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());a=e.boundingSphere;null!==a&&(this.boundingSphere=a.clone());this.drawRange.start=e.drawRange.start;this.drawRange.count=e.drawRange.count;this.userData=e.userData;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});O.prototype=Object.create(S.prototype);O.prototype.constructor=O;j.prototype=Object.create(A.prototype);j.prototype.constructor=j;R.prototype=Object.create(S.prototype);R.prototype.constructor=R;k.prototype=Object.create(A.prototype);k.prototype.constructor=k;var lo=0;L.prototype=Object.assign(Object.create(t.prototype),{constructor:L,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0===r)console.warn("THREE.Material: '"+t+"' parameter is undefined.");else if("shading"===t)console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r?!0:!1;else{var n=this[t];void 0===n?console.warn("THREE."+this.type+": '"+t+"' is not a property of this material."):n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[t]="overdraw"===t?Number(r):r}}},toJSON:function(e){function t(e){var t=[],r;for(r in e){var n=e[r];delete n.metadata;t.push(n)}return t}var r=void 0===e||"string"===typeof e;r&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid;n.type=this.type;""!==this.name&&(n.name=this.name);this.color&&this.color.isColor&&(n.color=this.color.getHex());void 0!==this.roughness&&(n.roughness=this.roughness);void 0!==this.metalness&&(n.metalness=this.metalness);this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex());1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity);this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex());void 0!==this.shininess&&(n.shininess=this.shininess);void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat);void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness);this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid);this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid);this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid);this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity);this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale);this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray());this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias);this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid);this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid);this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid);this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid);this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity);this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid);void 0!==this.size&&(n.size=this.size);void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation);1!==this.blending&&(n.blending=this.blending);!0===this.flatShading&&(n.flatShading=this.flatShading);0!==this.side&&(n.side=this.side);0!==this.vertexColors&&(n.vertexColors=this.vertexColors);1>this.opacity&&(n.opacity=this.opacity);!0===this.transparent&&(n.transparent=this.transparent);n.depthFunc=this.depthFunc;n.depthTest=this.depthTest;n.depthWrite=this.depthWrite;0!==this.rotation&&(n.rotation=this.rotation);1!==this.linewidth&&(n.linewidth=this.linewidth);void 0!==this.dashSize&&(n.dashSize=this.dashSize);void 0!==this.gapSize&&(n.gapSize=this.gapSize);void 0!==this.scale&&(n.scale=this.scale);!0===this.dithering&&(n.dithering=!0);0<this.alphaTest&&(n.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(n.wireframe=this.wireframe);1<this.wireframeLinewidth&&(n.wireframeLinewidth=this.wireframeLinewidth);"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap);"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin);!0===this.morphTargets&&(n.morphTargets=!0);!0===this.skinning&&(n.skinning=!0);!1===this.visible&&(n.visible=!1);"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData);r&&(r=t(e.textures),e=t(e.images),0<r.length&&(n.textures=r),0<e.length&&(n.images=e));return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name;this.fog=e.fog;this.lights=e.lights;this.blending=e.blending;this.side=e.side;this.flatShading=e.flatShading;this.vertexColors=e.vertexColors;this.opacity=e.opacity;this.transparent=e.transparent;this.blendSrc=e.blendSrc;this.blendDst=e.blendDst;this.blendEquation=e.blendEquation;this.blendSrcAlpha=e.blendSrcAlpha;this.blendDstAlpha=e.blendDstAlpha;this.blendEquationAlpha=e.blendEquationAlpha;this.depthFunc=e.depthFunc;this.depthTest=e.depthTest;this.depthWrite=e.depthWrite;this.colorWrite=e.colorWrite;this.precision=e.precision;this.polygonOffset=e.polygonOffset;this.polygonOffsetFactor=e.polygonOffsetFactor;this.polygonOffsetUnits=e.polygonOffsetUnits;this.dithering=e.dithering;this.alphaTest=e.alphaTest;this.premultipliedAlpha=e.premultipliedAlpha;this.overdraw=e.overdraw;this.visible=e.visible;this.userData=JSON.parse(JSON.stringify(e.userData));this.clipShadows=e.clipShadows;this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,r=null;if(null!==t){var n=t.length;r=Array(n);for(var i=0;i!==n;++i)r[i]=t[i].clone()}this.clippingPlanes=r;this.shadowSide=e.shadowSide;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});I.prototype=Object.create(L.prototype);I.prototype.constructor=I;I.prototype.isMeshBasicMaterial=!0;I.prototype.copy=function(e){L.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.skinning=e.skinning;this.morphTargets=e.morphTargets;return this};N.prototype=Object.create(L.prototype);N.prototype.constructor=N;N.prototype.isShaderMaterial=!0;N.prototype.copy=function(e){L.prototype.copy.call(this,e);this.fragmentShader=e.fragmentShader;this.vertexShader=e.vertexShader;this.uniforms=io.clone(e.uniforms);this.defines=Object.assign({},e.defines);this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.lights=e.lights;this.clipping=e.clipping;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;this.extensions=e.extensions;return this};N.prototype.toJSON=function(e){e=L.prototype.toJSON.call(this,e);e.uniforms=this.uniforms;e.vertexShader=this.vertexShader;e.fragmentShader=this.fragmentShader;return e};Object.assign(B.prototype,{set:function(e,t){this.origin.copy(e);this.direction.copy(t);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.origin.copy(e.origin);this.direction.copy(e.direction);return this},at:function(e,t){void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new xe);return t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){this.direction.copy(e).sub(this.origin).normalize();return this},recast:function(){var t=new xe;return function(e){this.origin.copy(this.at(e,t));return this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new xe);t.subVectors(e,this.origin);e=t.dot(this.direction);return 0>e?t.copy(this.origin):t.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var r=new xe;return function(e){var t=r.subVectors(e,this.origin).dot(this.direction);if(0>t)return this.origin.distanceToSquared(e);r.copy(this.direction).multiplyScalar(t).add(this.origin);return r.distanceToSquared(e)}}(),distanceSqToSegment:function(){var l=new xe,p=new xe,f=new xe;return function(e,t,r,n){l.copy(e).add(t).multiplyScalar(.5);p.copy(t).sub(e).normalize();f.copy(this.origin).sub(l);var i=.5*e.distanceTo(t),o=-this.direction.dot(p),a=f.dot(this.direction),s=-f.dot(p),u=f.lengthSq(),c=Math.abs(1-o*o);if(0<c){e=o*s-a;t=o*a-s;var h=i*c;0<=e?t>=-h?t<=h?(i=1/c,e*=i,t*=i,o=e*(e+o*t+2*a)+t*(o*e+t+2*s)+u):(t=i,e=Math.max(0,-(o*t+a)),o=-e*e+t*(t+2*s)+u):(t=-i,e=Math.max(0,-(o*t+a)),o=-e*e+t*(t+2*s)+u):t<=-h?(e=Math.max(0,-(-o*i+a)),t=0<e?-i:Math.min(Math.max(-i,-s),i),o=-e*e+t*(t+2*s)+u):t<=h?(e=0,t=Math.min(Math.max(-i,-s),i),o=t*(t+2*s)+u):(e=Math.max(0,-(o*i+a)),t=0<e?i:Math.min(Math.max(-i,-s),i),o=-e*e+t*(t+2*s)+u)}else t=0<o?-i:i,e=Math.max(0,-(o*t+a)),o=-e*e+t*(t+2*s)+u;r&&r.copy(this.direction).multiplyScalar(e).add(this.origin);n&&n.copy(p).multiplyScalar(t).add(l);return o}}(),intersectSphere:function(){var i=new xe;return function(e,t){i.subVectors(e.center,this.origin);var r=i.dot(this.direction),n=i.dot(i)-r*r;e=e.radius*e.radius;if(n>e)return null;e=Math.sqrt(e-n);n=r-e;r+=e;return 0>n&&0>r?null:0>n?this.at(r,t):this.at(n,t)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;e=-(this.origin.dot(e.normal)+e.constant)/t;return 0<=e?e:null},intersectPlane:function(e,t){e=this.distanceToPlane(e);return null===e?null:this.at(e,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t?!0:!1},intersectBox:function(e,t){var r=1/this.direction.x;var n=1/this.direction.y;var i=1/this.direction.z,o=this.origin;if(0<=r){var a=(e.min.x-o.x)*r;r*=e.max.x-o.x}else a=(e.max.x-o.x)*r,r*=e.min.x-o.x;if(0<=n){var s=(e.min.y-o.y)*n;n*=e.max.y-o.y}else s=(e.max.y-o.y)*n,n*=e.min.y-o.y;if(a>n||s>r)return null;if(s>a||a!==a)a=s;if(n<r||r!==r)r=n;0<=i?(s=(e.min.z-o.z)*i,e=(e.max.z-o.z)*i):(s=(e.max.z-o.z)*i,e=(e.min.z-o.z)*i);if(a>e||s>r)return null;if(s>a||a!==a)a=s;if(e<r||r!==r)r=e;return 0>r?null:this.at(0<=a?a:r,t)},intersectsBox:function(){var t=new xe;return function(e){return null!==this.intersectBox(e,t)}}(),intersectTriangle:function(){var o=new xe,a=new xe,s=new xe,u=new xe;return function(e,t,r,n,i){a.subVectors(t,e);s.subVectors(r,e);u.crossVectors(a,s);t=this.direction.dot(u);if(0<t){if(n)return null;n=1}else if(0>t)n=-1,t=-t;else return null;o.subVectors(this.origin,e);e=n*this.direction.dot(s.crossVectors(o,s));if(0>e)return null;r=n*this.direction.dot(a.cross(o));if(0>r||e+r>t)return null;e=-n*o.dot(u);return 0>e?null:this.at(e/t,i)}}(),applyMatrix4:function(e){this.origin.applyMatrix4(e);this.direction.transformDirection(e);return this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});Object.assign(F,{getNormal:function(){var i=new xe;return function(e,t,r,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new xe);n.subVectors(r,t);i.subVectors(e,t);n.cross(i);e=n.lengthSq();return 0<e?n.multiplyScalar(1/Math.sqrt(e)):n.set(0,0,0)}}(),getBarycoord:function(){var s=new xe,u=new xe,c=new xe;return function(e,t,r,n,i){s.subVectors(n,t);u.subVectors(r,t);c.subVectors(e,t);e=s.dot(s);t=s.dot(u);r=s.dot(c);var o=u.dot(u);n=u.dot(c);var a=e*o-t*t;void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new xe);if(0===a)return i.set(-2,-1,-1);a=1/a;o=(o*r-t*n)*a;e=(e*n-t*r)*a;return i.set(1-o-e,e,o)}}(),containsPoint:function(){var i=new xe;return function(e,t,r,n){F.getBarycoord(e,t,r,n,i);return 0<=i.x&&0<=i.y&&1>=i.x+i.y}}()});Object.assign(F.prototype,{set:function(e,t,r){this.a.copy(e);this.b.copy(t);this.c.copy(r);return this},setFromPointsAndIndices:function(e,t,r,n){this.a.copy(e[t]);this.b.copy(e[r]);this.c.copy(e[n]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a.copy(e.a);this.b.copy(e.b);this.c.copy(e.c);return this},getArea:function(){var e=new xe,t=new xe;return function(){e.subVectors(this.c,this.b);t.subVectors(this.a,this.b);return.5*e.cross(t).length()}}(),getMidpoint:function(e){void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new xe);return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return F.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new xe);return e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return F.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return F.containsPoint(e,this.a,this.b,this.c)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var l=new xe,p=new xe,f=new xe,d=new xe,v=new xe,m=new xe;return function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new xe);var r=this.a,n=this.b,i=this.c;l.subVectors(n,r);p.subVectors(i,r);d.subVectors(e,r);var o=l.dot(d),a=p.dot(d);if(0>=o&&0>=a)return t.copy(r);v.subVectors(e,n);var s=l.dot(v),u=p.dot(v);if(0<=s&&u<=s)return t.copy(n);var c=o*u-s*a;if(0>=c&&0<=o&&0>=s)return n=o/(o-s),t.copy(r).addScaledVector(l,n);m.subVectors(e,i);e=l.dot(m);var h=p.dot(m);if(0<=h&&e<=h)return t.copy(i);o=e*a-o*h;if(0>=o&&0<=a&&0>=h)return c=a/(a-h),t.copy(r).addScaledVector(p,c);a=s*h-e*u;if(0>=a&&0<=u-s&&0<=e-h)return f.subVectors(i,n),c=(u-s)/(u-s+(e-h)),t.copy(n).addScaledVector(f,c);i=1/(a+o+c);n=o*i;c*=i;return t.copy(r).addScaledVector(l,n).addScaledVector(p,c)}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});z.prototype=Object.assign(Object.create(h.prototype),{constructor:z,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){h.prototype.copy.call(this,e);this.drawMode=e.drawMode;void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice());void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary));return this},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){e=e.morphAttributes;var t=Object.keys(e);if(0<t.length){var r=e[t[0]];if(void 0!==r)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=r.length;e<t;e++){var n=r[e].name||String(e);this.morphTargetInfluences.push(0);this.morphTargetDictionary[n]=e}}}else if(r=e.morphTargets,void 0!==r&&0<r.length)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=r.length;e<t;e++)n=r[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e},raycast:function(){function w(e,t,r,n,i,o,a){F.getBarycoord(e,t,r,n,s);i.multiplyScalar(s.x);o.multiplyScalar(s.y);a.multiplyScalar(s.z);i.add(o).add(a);return i.clone()}function x(e,t,r,n,i,o,a,s){if(null===(1===t.side?n.intersectTriangle(a,o,i,!0,s):n.intersectTriangle(i,o,a,2!==t.side,s)))return null;u.copy(s);u.applyMatrix4(e.matrixWorld);t=r.ray.origin.distanceTo(u);return t<r.near||t>r.far?null:{distance:t,point:u.clone(),object:e}}function S(e,t,r,n,i,o,a,s,u){T.fromBufferAttribute(i,a);O.fromBufferAttribute(i,s);P.fromBufferAttribute(i,u);if(e=x(e,t,r,n,T,O,P,N))o&&(k.fromBufferAttribute(o,a),L.fromBufferAttribute(o,s),I.fromBufferAttribute(o,u),e.uv=w(N,T,O,P,k,L,I)),o=new D(a,s,u),F.getNormal(T,O,P,o.normal),e.face=o;return e}var M=new we,C=new B,E=new c,T=new xe,O=new xe,P=new xe,A=new xe,j=new xe,R=new xe,k=new H,L=new H,I=new H,s=new xe,N=new xe,u=new xe;return function(e,t){var r=this.geometry,n=this.material,i=this.matrixWorld;if(void 0!==n&&(null===r.boundingSphere&&r.computeBoundingSphere(),E.copy(r.boundingSphere),E.applyMatrix4(i),!1!==e.ray.intersectsSphere(E)&&(M.getInverse(i),C.copy(e.ray).applyMatrix4(M),null===r.boundingBox||!1!==C.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var o=r.index,a=r.attributes.position,s=r.attributes.uv,u=r.groups;r=r.drawRange;var c;if(null!==o)if(Array.isArray(n)){var h=0;for(c=u.length;h<c;h++){var l=u[h];var p=n[l.materialIndex];i=Math.max(l.start,r.start);var f=Math.min(l.start+l.count,r.start+r.count);for(l=i;l<f;l+=3){i=o.getX(l);var d=o.getX(l+1);var v=o.getX(l+2);if(i=S(this,p,e,C,a,s,i,d,v))i.faceIndex=Math.floor(l/3),t.push(i)}}}else for(i=Math.max(0,r.start),f=Math.min(o.count,r.start+r.count),h=i,c=f;h<c;h+=3){if(i=o.getX(h),d=o.getX(h+1),v=o.getX(h+2),i=S(this,n,e,C,a,s,i,d,v))i.faceIndex=Math.floor(h/3),t.push(i)}else if(void 0!==a)if(Array.isArray(n))for(h=0,c=u.length;h<c;h++)for(l=u[h],p=n[l.materialIndex],i=Math.max(l.start,r.start),f=Math.min(l.start+l.count,r.start+r.count),l=i;l<f;l+=3){if(i=l,d=l+1,v=l+2,i=S(this,p,e,C,a,s,i,d,v))i.faceIndex=Math.floor(l/3),t.push(i)}else for(i=Math.max(0,r.start),f=Math.min(a.count,r.start+r.count),h=i,c=f;h<c;h+=3)if(i=h,d=h+1,v=h+2,i=S(this,n,e,C,a,s,i,d,v))i.faceIndex=Math.floor(h/3),t.push(i)}else if(r.isGeometry)for(a=Array.isArray(n),s=r.vertices,u=r.faces,i=r.faceVertexUvs[0],0<i.length&&(o=i),l=0,f=u.length;l<f;l++)if(d=u[l],i=a?n[d.materialIndex]:n,void 0!==i){h=s[d.a];c=s[d.b];p=s[d.c];if(!0===i.morphTargets){v=r.morphTargets;var m=this.morphTargetInfluences;T.set(0,0,0);O.set(0,0,0);P.set(0,0,0);for(var g=0,_=v.length;g<_;g++){var y=m[g];if(0!==y){var b=v[g].vertices;T.addScaledVector(A.subVectors(b[d.a],h),y);O.addScaledVector(j.subVectors(b[d.b],c),y);P.addScaledVector(R.subVectors(b[d.c],p),y)}}T.add(h);O.add(c);P.add(p);h=T;c=O;p=P}if(i=x(this,i,e,C,h,c,p,N))o&&o[l]&&(v=o[l],k.copy(v[0]),L.copy(v[1]),I.copy(v[2]),i.uv=w(N,h,c,p,k,L,I)),i.face=d,i.faceIndex=l,t.push(i)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});U.prototype=Object.create(p.prototype);U.prototype.constructor=U;U.prototype.isCubeTexture=!0;Object.defineProperty(U.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var po=new p,fo=new U,vo=[],mo=[],go=new Float32Array(16),_o=new Float32Array(9),yo=new Float32Array(4);be.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length));q(t,e)};Be.prototype.setValue=function(e,t,r){for(var n=this.seq,i=0,o=n.length;i!==o;++i){var a=n[i];a.setValue(e,t[a.id],r)}};var bo=/([\w\d_]+)(\])?(\[|\.)?/g;Fe.prototype.setValue=function(e,t,r){t=this.map[t];void 0!==t&&t.setValue(e,r,this.renderer)};Fe.prototype.setOptional=function(e,t,r){t=t[r];void 0!==t&&this.setValue(e,r,t)};Fe.upload=function(e,t,r,n){for(var i=0,o=t.length;i!==o;++i){var a=t[i],s=r[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,n)}};Fe.seqWithValue=function(e,t){for(var r=[],n=0,i=e.length;n!==i;++n){var o=e[n];o.id in t&&r.push(o)}return r};var wo=0,xo=0;ht.prototype=Object.create(L.prototype);ht.prototype.constructor=ht;ht.prototype.isMeshDepthMaterial=!0;ht.prototype.copy=function(e){L.prototype.copy.call(this,e);this.depthPacking=e.depthPacking;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.map=e.map;this.alphaMap=e.alphaMap;this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;return this};lt.prototype=Object.create(L.prototype);lt.prototype.constructor=lt;lt.prototype.isMeshDistanceMaterial=!0;lt.prototype.copy=function(e){L.prototype.copy.call(this,e);this.referencePosition.copy(e.referencePosition);this.nearDistance=e.nearDistance;this.farDistance=e.farDistance;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.map=e.map;this.alphaMap=e.alphaMap;this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;return this};mt.prototype=Object.assign(Object.create(h.prototype),{constructor:mt,isGroup:!0});gt.prototype=Object.assign(Object.create(u.prototype),{constructor:gt,isPerspectiveCamera:!0,copy:function(e,t){u.prototype.copy.call(this,e,t);this.fov=e.fov;this.zoom=e.zoom;this.near=e.near;this.far=e.far;this.focus=e.focus;this.aspect=e.aspect;this.view=null===e.view?null:Object.assign({},e.view);this.filmGauge=e.filmGauge;this.filmOffset=e.filmOffset;return this},setFocalLength:function(e){e=.5*this.getFilmHeight()/e;this.fov=2*eo.RAD2DEG*Math.atan(e);this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*eo.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*eo.RAD2DEG*Math.atan(Math.tan(.5*eo.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,n,i,o){this.aspect=e/t;null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1});this.view.enabled=!0;this.view.fullWidth=e;this.view.fullHeight=t;this.view.offsetX=r;this.view.offsetY=n;this.view.width=i;this.view.height=o;this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1);this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*eo.DEG2RAD*this.fov)/this.zoom,r=2*t,n=this.aspect*r,i=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*n/a;t-=o.offsetY*r/s;n*=o.width/a;r*=o.height/s}o=this.filmOffset;0!==o&&(i+=e*o/this.getFilmWidth());this.projectionMatrix.makePerspective(i,i+n,t,t-r,e,this.far)},toJSON:function(e){e=h.prototype.toJSON.call(this,e);e.object.fov=this.fov;e.object.zoom=this.zoom;e.object.near=this.near;e.object.far=this.far;e.object.focus=this.focus;e.object.aspect=this.aspect;null!==this.view&&(e.object.view=Object.assign({},this.view));e.object.filmGauge=this.filmGauge;e.object.filmOffset=this.filmOffset;return e}});_t.prototype=Object.assign(Object.create(gt.prototype),{constructor:_t,isArrayCamera:!0});xt.prototype.isFogExp2=!0;xt.prototype.clone=function(){return new xt(this.color,this.density)};xt.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};St.prototype.isFog=!0;St.prototype.clone=function(){return new St(this.color,this.near,this.far)};St.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};Mt.prototype=Object.assign(Object.create(h.prototype),{constructor:Mt,copy:function(e,t){h.prototype.copy.call(this,e,t);null!==e.background&&(this.background=e.background.clone());null!==e.fog&&(this.fog=e.fog.clone());null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone());this.autoUpdate=e.autoUpdate;this.matrixAutoUpdate=e.matrixAutoUpdate;return this},toJSON:function(e){var t=h.prototype.toJSON.call(this,e);null!==this.background&&(t.object.background=this.background.toJSON(e));null!==this.fog&&(t.object.fog=this.fog.toJSON());return t}});Object.defineProperty(Ct.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});Object.assign(Ct.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.stride:0;this.array=e;return this},setDynamic:function(e){this.dynamic=e;return this},copy:function(e){this.array=new e.array.constructor(e.array);this.count=e.count;this.stride=e.stride;this.dynamic=e.dynamic;return this},copyAt:function(e,t,r){e*=this.stride;r*=t.stride;for(var n=0,i=this.stride;n<i;n++)this.array[e+n]=t.array[r+n];return this},set:function(e,t){void 0===t&&(t=0);this.array.set(e,t);return this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){this.onUploadCallback=e;return this}});Object.defineProperties(Et.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}});Object.assign(Et.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){this.data.array[e*this.data.stride+this.offset]=t;return this},setY:function(e,t){this.data.array[e*this.data.stride+this.offset+1]=t;return this},setZ:function(e,t){this.data.array[e*this.data.stride+this.offset+2]=t;return this},setW:function(e,t){this.data.array[e*this.data.stride+this.offset+3]=t;return this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=r;return this},setXYZ:function(e,t,r,n){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=r;this.data.array[e+2]=n;return this},setXYZW:function(e,t,r,n,i){e=e*this.data.stride+this.offset;this.data.array[e+0]=t;this.data.array[e+1]=r;this.data.array[e+2]=n;this.data.array[e+3]=i;return this}});Tt.prototype=Object.create(L.prototype);Tt.prototype.constructor=Tt;Tt.prototype.isSpriteMaterial=!0;Tt.prototype.copy=function(e){L.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.rotation=e.rotation;return this};var So;Ot.prototype=Object.assign(Object.create(h.prototype),{constructor:Ot,isSprite:!0,raycast:function(){function a(e,t,r,n,i,o){h.subVectors(e,r).addScalar(.5).multiply(n);void 0!==i?(l.x=o*h.x-i*h.y,l.y=i*h.x+o*h.y):l.copy(h);e.copy(t);e.x+=l.x;e.y+=l.y;e.applyMatrix4(p)}var s=new xe,u=new xe,c=new xe,h=new H,l=new H,p=new we,f=new xe,d=new xe,v=new xe;return function(e,t){u.setFromMatrixScale(this.matrixWorld);p.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld);c.setFromMatrixPosition(this.modelViewMatrix);var r=this.material.rotation;if(0!==r){var n=Math.cos(r);var i=Math.sin(r)}r=this.center;a(f.set(-.5,-.5,0),c,r,u,i,n);a(d.set(.5,-.5,0),c,r,u,i,n);a(v.set(.5,.5,0),c,r,u,i,n);var o=e.ray.intersectTriangle(f,d,v,!1,s);if(null===o&&(a(d.set(-.5,.5,0),c,r,u,i,n),o=e.ray.intersectTriangle(f,v,d,!1,s),null===o))return;i=e.ray.origin.distanceTo(s);i<e.near||i>e.far||t.push({distance:i,point:s.clone(),face:null,object:this})}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){h.prototype.copy.call(this,e);void 0!==e.center&&this.center.copy(e.center);return this}});Pt.prototype=Object.assign(Object.create(h.prototype),{constructor:Pt,copy:function(e){h.prototype.copy.call(this,e,!1);e=e.levels;for(var t=0,r=e.length;t<r;t++){var n=e[t];this.addLevel(n.object.clone(),n.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0);t=Math.abs(t);for(var r=this.levels,n=0;n<r.length&&!(t<r[n].distance);n++);r.splice(n,0,{distance:t,object:e});this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,r=1,n=t.length;r<n&&!(e<t[r].distance);r++);return t[r-1].object},raycast:function(){var n=new xe;return function(e,t){n.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(n);this.getObjectForDistance(r).raycast(e,t)}}(),update:function(){var i=new xe,o=new xe;return function(e){var t=this.levels;if(1<t.length){i.setFromMatrixPosition(e.matrixWorld);o.setFromMatrixPosition(this.matrixWorld);e=i.distanceTo(o);t[0].object.visible=!0;for(var r=1,n=t.length;r<n;r++)if(e>=t[r].distance)t[r-1].object.visible=!1,t[r].object.visible=!0;else break;for(;r<n;r++)t[r].object.visible=!1}}}(),toJSON:function(e){e=h.prototype.toJSON.call(this,e);e.object.levels=[];for(var t=this.levels,r=0,n=t.length;r<n;r++){var i=t[r];e.object.levels.push({object:i.object.uuid,distance:i.distance})}return e}});Object.assign(At.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new we;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld);this.boneInverses.push(r)}},pose:function(){var e,t;var r=0;for(t=this.bones.length;r<t;r++)(e=this.bones[r])&&e.matrixWorld.getInverse(this.boneInverses[r]);r=0;for(t=this.bones.length;r<t;r++)if(e=this.bones[r])e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale)},update:function(){var a=new we,s=new we;return function(){for(var e=this.bones,t=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,o=e.length;i<o;i++)a.multiplyMatrices(e[i]?e[i].matrixWorld:s,t[i]),a.toArray(r,16*i);void 0!==n&&(n.needsUpdate=!0)}}(),clone:function(){return new At(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var n=this.bones[t];if(n.name===e)return n}}});jt.prototype=Object.assign(Object.create(h.prototype),{constructor:jt,isBone:!0});Rt.prototype=Object.assign(Object.create(z.prototype),{constructor:Rt,isSkinnedMesh:!0,initBones:function(){var e=[],t;if(this.geometry&&void 0!==this.geometry.bones){var r=0;for(t=this.geometry.bones.length;r<t;r++){var n=this.geometry.bones[r];var i=new jt;e.push(i);i.name=n.name;i.position.fromArray(n.pos);i.quaternion.fromArray(n.rotq);void 0!==n.scl&&i.scale.fromArray(n.scl)}r=0;for(t=this.geometry.bones.length;r<t;r++)n=this.geometry.bones[r],-1!==n.parent&&null!==n.parent&&void 0!==e[n.parent]?e[n.parent].add(e[r]):this.add(e[r])}this.updateMatrixWorld(!0);return e},bind:function(e,t){this.skeleton=e;void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld);this.bindMatrix.copy(t);this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var e;if(this.geometry&&this.geometry.isGeometry)for(e=0;e<this.geometry.skinWeights.length;e++){var t=this.geometry.skinWeights[e];var r=1/t.manhattanLength();Infinity!==r?t.multiplyScalar(r):t.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){t=new Se;var n=this.geometry.attributes.skinWeight;for(e=0;e<n.count;e++)t.x=n.getX(e),t.y=n.getY(e),t.z=n.getZ(e),t.w=n.getW(e),r=1/t.manhattanLength(),Infinity!==r?t.multiplyScalar(r):t.set(1,0,0,0),n.setXYZW(e,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(e){z.prototype.updateMatrixWorld.call(this,e);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});kt.prototype=Object.create(L.prototype);kt.prototype.constructor=kt;kt.prototype.isLineBasicMaterial=!0;kt.prototype.copy=function(e){L.prototype.copy.call(this,e);this.color.copy(e.color);this.linewidth=e.linewidth;this.linecap=e.linecap;this.linejoin=e.linejoin;return this};Lt.prototype=Object.assign(Object.create(h.prototype),{constructor:Lt,isLine:!0,computeLineDistances:function(){var o=new xe,a=new xe;return function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[0],n=1,i=t.count;n<i;n++)o.fromBufferAttribute(t,n-1),a.fromBufferAttribute(t,n),r[n]=r[n-1],r[n]+=o.distanceTo(a);e.addAttribute("lineDistance",new P(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry)for(t=e.vertices,r=e.lineDistances,r[0]=0,n=1,i=t.length;n<i;n++)r[n]=r[n-1],r[n]+=t[n-1].distanceTo(t[n]);return this}}(),raycast:function(){var f=new we,d=new B,v=new c;return function(e,t){var r=e.linePrecision;r*=r;var n=this.geometry,i=this.matrixWorld;null===n.boundingSphere&&n.computeBoundingSphere();v.copy(n.boundingSphere);v.applyMatrix4(i);if(!1!==e.ray.intersectsSphere(v)){f.getInverse(i);d.copy(e.ray).applyMatrix4(f);var o=new xe,a=new xe;i=new xe;var s=new xe,u=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){var c=n.index,h=n.attributes.position.array;if(null!==c){c=c.array;n=0;for(var l=c.length-1;n<l;n+=u){var p=c[n+1];o.fromArray(h,3*c[n]);a.fromArray(h,3*p);p=d.distanceSqToSegment(o,a,s,i);p>r||(s.applyMatrix4(this.matrixWorld),p=e.ray.origin.distanceTo(s),p<e.near||p>e.far||t.push({distance:p,point:i.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this}))}}else for(n=0,l=h.length/3-1;n<l;n+=u)o.fromArray(h,3*n),a.fromArray(h,3*n+3),p=d.distanceSqToSegment(o,a,s,i),p>r||(s.applyMatrix4(this.matrixWorld),p=e.ray.origin.distanceTo(s),p<e.near||p>e.far||t.push({distance:p,point:i.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this}))}else if(n.isGeometry)for(o=n.vertices,a=o.length,n=0;n<a-1;n+=u)p=d.distanceSqToSegment(o[n],o[n+1],s,i),p>r||(s.applyMatrix4(this.matrixWorld),p=e.ray.origin.distanceTo(s),p<e.near||p>e.far||t.push({distance:p,point:i.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});It.prototype=Object.assign(Object.create(Lt.prototype),{constructor:It,isLineSegments:!0,computeLineDistances:function(){var o=new xe,a=new xe;return function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,r=[],n=0,i=t.count;n<i;n+=2)o.fromBufferAttribute(t,n),a.fromBufferAttribute(t,n+1),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+o.distanceTo(a);e.addAttribute("lineDistance",new P(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry)for(t=e.vertices,r=e.lineDistances,n=0,i=t.length;n<i;n+=2)o.copy(t[n]),a.copy(t[n+1]),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+o.distanceTo(a);return this}}()});Nt.prototype=Object.assign(Object.create(Lt.prototype),{constructor:Nt,isLineLoop:!0});Dt.prototype=Object.create(L.prototype);Dt.prototype.constructor=Dt;Dt.prototype.isPointsMaterial=!0;Dt.prototype.copy=function(e){L.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.size=e.size;this.sizeAttenuation=e.sizeAttenuation;this.morphTargets=e.morphTargets;return this};Bt.prototype=Object.assign(Object.create(h.prototype),{constructor:Bt,isPoints:!0,raycast:function(){var f=new we,d=new B,v=new c;return function(n,i){function e(e,t){var r=d.distanceSqToPoint(e);r<s&&(d.closestPointToPoint(e,u),u.applyMatrix4(a),e=n.ray.origin.distanceTo(u),e<n.near||e>n.far||i.push({distance:e,distanceToRay:Math.sqrt(r),point:u.clone(),index:t,face:null,object:o}))}var o=this,t=this.geometry,a=this.matrixWorld,r=n.params.Points.threshold;null===t.boundingSphere&&t.computeBoundingSphere();v.copy(t.boundingSphere);v.applyMatrix4(a);v.radius+=r;if(!1!==n.ray.intersectsSphere(v)){f.getInverse(a);d.copy(n.ray).applyMatrix4(f);r/=(this.scale.x+this.scale.y+this.scale.z)/3;var s=r*r;r=new xe;var u=new xe;if(t.isBufferGeometry){var c=t.index;t=t.attributes.position.array;if(null!==c){var h=c.array;c=0;for(var l=h.length;c<l;c++){var p=h[c];r.fromArray(t,3*p);e(r,p)}}else for(c=0,h=t.length/3;c<h;c++)r.fromArray(t,3*c),e(r,c)}else for(r=t.vertices,c=0,h=r.length;c<h;c++)e(r[c],c)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});Ft.prototype=Object.assign(Object.create(p.prototype),{constructor:Ft,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});zt.prototype=Object.create(p.prototype);zt.prototype.constructor=zt;zt.prototype.isCompressedTexture=!0;$t.prototype=Object.create(p.prototype);$t.prototype.constructor=$t;$t.prototype.isCanvasTexture=!0;Ut.prototype=Object.create(p.prototype);Ut.prototype.constructor=Ut;Ut.prototype.isDepthTexture=!0;Gt.prototype=Object.create(A.prototype);Gt.prototype.constructor=Gt;Vt.prototype=Object.create(S.prototype);Vt.prototype.constructor=Vt;Ht.prototype=Object.create(A.prototype);Ht.prototype.constructor=Ht;qt.prototype=Object.create(S.prototype);qt.prototype.constructor=qt;Wt.prototype=Object.create(A.prototype);Wt.prototype.constructor=Wt;Xt.prototype=Object.create(S.prototype);Xt.prototype.constructor=Xt;Yt.prototype=Object.create(Wt.prototype);Yt.prototype.constructor=Yt;Kt.prototype=Object.create(S.prototype);Kt.prototype.constructor=Kt;Zt.prototype=Object.create(Wt.prototype);Zt.prototype.constructor=Zt;Jt.prototype=Object.create(S.prototype);Jt.prototype.constructor=Jt;Qt.prototype=Object.create(Wt.prototype);Qt.prototype.constructor=Qt;er.prototype=Object.create(S.prototype);er.prototype.constructor=er;tr.prototype=Object.create(Wt.prototype);tr.prototype.constructor=tr;rr.prototype=Object.create(S.prototype);rr.prototype.constructor=rr;nr.prototype=Object.create(A.prototype);nr.prototype.constructor=nr;ir.prototype=Object.create(S.prototype);ir.prototype.constructor=ir;or.prototype=Object.create(A.prototype);or.prototype.constructor=or;ar.prototype=Object.create(S.prototype);ar.prototype.constructor=ar;sr.prototype=Object.create(A.prototype);sr.prototype.constructor=sr;var Mo={triangulate:function(e,t,r){r=r||2;var n=t&&t.length,i=n?t[0]*r:e.length,o=ur(e,0,i,r,!0),a=[];if(!o)return a;var s;if(n){var u=r;n=[];var c;var h=0;for(c=t.length;h<c;h++){var l=t[h]*u;var p=h<c-1?t[h+1]*u:e.length;l=ur(e,l,p,u,!1);l===l.next&&(l.steiner=!0);n.push(dr(l))}n.sort(lr);for(h=0;h<n.length;h++){t=n[h];u=o;if(u=pr(t,u))t=br(u,t),cr(t,t.next);o=cr(o,o.next)}}if(e.length>80*r){var f=s=e[0];var d=n=e[1];for(u=r;u<i;u+=r)h=e[u],t=e[u+1],h<f&&(f=h),t<d&&(d=t),h>s&&(s=h),t>n&&(n=t);s=Math.max(s-f,n-d);s=0!==s?1/s:0}hr(o,a,r,f,d,s);return a}},Co={area:function(e){for(var t=e.length,r=0,n=t-1,i=0;i<t;n=i++)r+=e[n].x*e[i].y-e[i].x*e[n].y;return.5*r},isClockWise:function(e){return 0>Co.area(e)},triangulateShape:function(e,t){var r=[],n=[],i=[];Mr(e);Cr(r,e);var o=e.length;t.forEach(Mr);for(e=0;e<t.length;e++)n.push(o),o+=t[e].length,Cr(r,t[e]);t=Mo.triangulate(r,n);for(e=0;e<t.length;e+=3)i.push(t.slice(e,e+3));return i}};Er.prototype=Object.create(S.prototype);Er.prototype.constructor=Er;Er.prototype.toJSON=function(){var e=S.prototype.toJSON.call(this);return Or(this.parameters.shapes,this.parameters.options,e)};Tr.prototype=Object.create(A.prototype);Tr.prototype.constructor=Tr;Tr.prototype.toJSON=function(){var e=A.prototype.toJSON.call(this);return Or(this.parameters.shapes,this.parameters.options,e)};var Eo={generateTopUV:function(e,t,r,n,i){e=t[3*n];n=t[3*n+1];var o=t[3*i];i=t[3*i+1];return[new H(t[3*r],t[3*r+1]),new H(e,n),new H(o,i)]},generateSideWallUV:function(e,t,r,n,i,o){e=t[3*r];var a=t[3*r+1];r=t[3*r+2];var s=t[3*n],u=t[3*n+1];n=t[3*n+2];var c=t[3*i],h=t[3*i+1];i=t[3*i+2];var l=t[3*o],p=t[3*o+1];t=t[3*o+2];return.01>Math.abs(a-u)?[new H(e,1-r),new H(s,1-n),new H(c,1-i),new H(l,1-t)]:[new H(a,1-r),new H(u,1-n),new H(h,1-i),new H(p,1-t)]}};Pr.prototype=Object.create(S.prototype);Pr.prototype.constructor=Pr;Ar.prototype=Object.create(Tr.prototype);Ar.prototype.constructor=Ar;jr.prototype=Object.create(S.prototype);jr.prototype.constructor=jr;Rr.prototype=Object.create(A.prototype);Rr.prototype.constructor=Rr;kr.prototype=Object.create(S.prototype);kr.prototype.constructor=kr;Lr.prototype=Object.create(A.prototype);Lr.prototype.constructor=Lr;Ir.prototype=Object.create(S.prototype);Ir.prototype.constructor=Ir;Nr.prototype=Object.create(A.prototype);Nr.prototype.constructor=Nr;Dr.prototype=Object.create(S.prototype);Dr.prototype.constructor=Dr;Dr.prototype.toJSON=function(){var e=S.prototype.toJSON.call(this);return Fr(this.parameters.shapes,e)};Br.prototype=Object.create(A.prototype);Br.prototype.constructor=Br;Br.prototype.toJSON=function(){var e=A.prototype.toJSON.call(this);return Fr(this.parameters.shapes,e)};zr.prototype=Object.create(A.prototype);zr.prototype.constructor=zr;$r.prototype=Object.create(S.prototype);$r.prototype.constructor=$r;Ur.prototype=Object.create(A.prototype);Ur.prototype.constructor=Ur;Gr.prototype=Object.create($r.prototype);Gr.prototype.constructor=Gr;Vr.prototype=Object.create(Ur.prototype);Vr.prototype.constructor=Vr;Hr.prototype=Object.create(S.prototype);Hr.prototype.constructor=Hr;qr.prototype=Object.create(A.prototype);qr.prototype.constructor=qr;var To=Object.freeze({WireframeGeometry:Gt,ParametricGeometry:Vt,ParametricBufferGeometry:Ht,TetrahedronGeometry:Xt,TetrahedronBufferGeometry:Yt,OctahedronGeometry:Kt,OctahedronBufferGeometry:Zt,IcosahedronGeometry:Jt,IcosahedronBufferGeometry:Qt,DodecahedronGeometry:er,DodecahedronBufferGeometry:tr,PolyhedronGeometry:qt,PolyhedronBufferGeometry:Wt,TubeGeometry:rr,TubeBufferGeometry:nr,TorusKnotGeometry:ir,TorusKnotBufferGeometry:or,TorusGeometry:ar,TorusBufferGeometry:sr,TextGeometry:Pr,TextBufferGeometry:Ar,SphereGeometry:jr,SphereBufferGeometry:Rr,RingGeometry:kr,RingBufferGeometry:Lr,PlaneGeometry:R,PlaneBufferGeometry:k,LatheGeometry:Ir,LatheBufferGeometry:Nr,ShapeGeometry:Dr,ShapeBufferGeometry:Br,ExtrudeGeometry:Er,ExtrudeBufferGeometry:Tr,EdgesGeometry:zr,ConeGeometry:Gr,ConeBufferGeometry:Vr,CylinderGeometry:$r,CylinderBufferGeometry:Ur,CircleGeometry:Hr,CircleBufferGeometry:qr,BoxGeometry:O,BoxBufferGeometry:j});Wr.prototype=Object.create(L.prototype);Wr.prototype.constructor=Wr;Wr.prototype.isShadowMaterial=!0;Wr.prototype.copy=function(e){L.prototype.copy.call(this,e);this.color.copy(e.color);return this};Xr.prototype=Object.create(N.prototype);Xr.prototype.constructor=Xr;Xr.prototype.isRawShaderMaterial=!0;Yr.prototype=Object.create(L.prototype);Yr.prototype.constructor=Yr;Yr.prototype.isMeshStandardMaterial=!0;Yr.prototype.copy=function(e){L.prototype.copy.call(this,e);this.defines={STANDARD:""};this.color.copy(e.color);this.roughness=e.roughness;this.metalness=e.metalness;this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.roughnessMap=e.roughnessMap;this.metalnessMap=e.metalnessMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.envMapIntensity=e.envMapIntensity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};Kr.prototype=Object.create(Yr.prototype);Kr.prototype.constructor=Kr;Kr.prototype.isMeshPhysicalMaterial=!0;Kr.prototype.copy=function(e){Yr.prototype.copy.call(this,e);this.defines={PHYSICAL:""};this.reflectivity=e.reflectivity;this.clearCoat=e.clearCoat;this.clearCoatRoughness=e.clearCoatRoughness;return this};Zr.prototype=Object.create(L.prototype);Zr.prototype.constructor=Zr;Zr.prototype.isMeshPhongMaterial=!0;Zr.prototype.copy=function(e){L.prototype.copy.call(this,e);this.color.copy(e.color);this.specular.copy(e.specular);this.shininess=e.shininess;this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};Jr.prototype=Object.create(Zr.prototype);Jr.prototype.constructor=Jr;Jr.prototype.isMeshToonMaterial=!0;Jr.prototype.copy=function(e){Zr.prototype.copy.call(this,e);this.gradientMap=e.gradientMap;return this};Qr.prototype=Object.create(L.prototype);Qr.prototype.constructor=Qr;Qr.prototype.isMeshNormalMaterial=!0;Qr.prototype.copy=function(e){L.prototype.copy.call(this,e);this.bumpMap=e.bumpMap;this.bumpScale=e.bumpScale;this.normalMap=e.normalMap;this.normalMapType=e.normalMapType;this.normalScale.copy(e.normalScale);this.displacementMap=e.displacementMap;this.displacementScale=e.displacementScale;this.displacementBias=e.displacementBias;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};en.prototype=Object.create(L.prototype);en.prototype.constructor=en;en.prototype.isMeshLambertMaterial=!0;en.prototype.copy=function(e){L.prototype.copy.call(this,e);this.color.copy(e.color);this.map=e.map;this.lightMap=e.lightMap;this.lightMapIntensity=e.lightMapIntensity;this.aoMap=e.aoMap;this.aoMapIntensity=e.aoMapIntensity;this.emissive.copy(e.emissive);this.emissiveMap=e.emissiveMap;this.emissiveIntensity=e.emissiveIntensity;this.specularMap=e.specularMap;this.alphaMap=e.alphaMap;this.envMap=e.envMap;this.combine=e.combine;this.reflectivity=e.reflectivity;this.refractionRatio=e.refractionRatio;this.wireframe=e.wireframe;this.wireframeLinewidth=e.wireframeLinewidth;this.wireframeLinecap=e.wireframeLinecap;this.wireframeLinejoin=e.wireframeLinejoin;this.skinning=e.skinning;this.morphTargets=e.morphTargets;this.morphNormals=e.morphNormals;return this};tn.prototype=Object.create(kt.prototype);tn.prototype.constructor=tn;tn.prototype.isLineDashedMaterial=!0;tn.prototype.copy=function(e){kt.prototype.copy.call(this,e);this.scale=e.scale;this.dashSize=e.dashSize;this.gapSize=e.gapSize;return this};var Oo=Object.freeze({ShadowMaterial:Wr,SpriteMaterial:Tt,RawShaderMaterial:Xr,ShaderMaterial:N,PointsMaterial:Dt,MeshPhysicalMaterial:Kr,MeshStandardMaterial:Yr,MeshPhongMaterial:Zr,MeshToonMaterial:Jr,MeshNormalMaterial:Qr,MeshLambertMaterial:en,MeshDepthMaterial:ht,MeshDistanceMaterial:lt,MeshBasicMaterial:I,LineDashedMaterial:tn,LineBasicMaterial:kt,Material:L}),Po={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Ao=new rn,jo={};Object.assign(nn.prototype,{load:function(a,e,t,r){void 0===a&&(a="");void 0!==this.path&&(a=this.path+a);a=this.manager.resolveURL(a);var s=this,n=Po.get(a);if(void 0!==n)return s.manager.itemStart(a),setTimeout(function(){e&&e(n);s.manager.itemEnd(a)},0),n;if(void 0!==jo[a])jo[a].push({onLoad:e,onProgress:t,onError:r});else{var i=a.match(/^data:(.*?)(;base64)?,(.*)$/);if(i){t=i[1];var o=!!i[2];i=i[3];i=window.decodeURIComponent(i);o&&(i=window.atob(i));try{var u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":var c=new Uint8Array(i.length);for(o=0;o<i.length;o++)c[o]=i.charCodeAt(o);var h="blob"===u?new Blob([c.buffer],{type:t}):c.buffer;break;case"document":h=(new DOMParser).parseFromString(i,t);break;case"json":h=JSON.parse(i);break;default:h=i}window.setTimeout(function(){e&&e(h);s.manager.itemEnd(a)},0)}catch(e){window.setTimeout(function(){r&&r(e);s.manager.itemEnd(a);s.manager.itemError(a)},0)}}else{jo[a]=[];jo[a].push({onLoad:e,onProgress:t,onError:r});var l=new XMLHttpRequest;l.open("GET",a,!0);l.addEventListener("load",function(e){var t=this.response;Po.add(a,t);var r=jo[a];delete jo[a];if(200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var n=0,i=r.length;n<i;n++){var o=r[n];if(o.onLoad)o.onLoad(t)}s.manager.itemEnd(a)}else{n=0;for(i=r.length;n<i;n++)if(o=r[n],o.onError)o.onError(e);s.manager.itemEnd(a);s.manager.itemError(a)}},!1);l.addEventListener("progress",function(e){for(var t=jo[a],r=0,n=t.length;r<n;r++){var i=t[r];if(i.onProgress)i.onProgress(e)}},!1);l.addEventListener("error",function(e){var t=jo[a];delete jo[a];for(var r=0,n=t.length;r<n;r++){var i=t[r];if(i.onError)i.onError(e)}s.manager.itemEnd(a);s.manager.itemError(a)},!1);void 0!==this.responseType&&(l.responseType=this.responseType);void 0!==this.withCredentials&&(l.withCredentials=this.withCredentials);l.overrideMimeType&&l.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(o in this.requestHeader)l.setRequestHeader(o,this.requestHeader[o]);l.send(null)}s.manager.itemStart(a);return l}},setPath:function(e){this.path=e;return this},setResponseType:function(e){this.responseType=e;return this},setWithCredentials:function(e){this.withCredentials=e;return this},setMimeType:function(e){this.mimeType=e;return this},setRequestHeader:function(e){this.requestHeader=e;return this}});Object.assign(on.prototype,{load:function(e,i,r,n){function t(t){u.load(e[t],function(e){e=o._parser(e,!0);a[t]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps};c+=1;6===c&&(1===e.mipmapCount&&(s.minFilter=1006),s.format=e.format,s.needsUpdate=!0,i&&i(s))},r,n)}var o=this,a=[],s=new zt;s.image=a;var u=new nn(this.manager);u.setPath(this.path);u.setResponseType("arraybuffer");if(Array.isArray(e))for(var c=0,h=0,l=e.length;h<l;++h)t(h);else u.load(e,function(e){e=o._parser(e,!0);if(e.isCubemap)for(var t=e.mipmaps.length/e.mipmapCount,r=0;r<t;r++){a[r]={mipmaps:[]};for(var n=0;n<e.mipmapCount;n++)a[r].mipmaps.push(e.mipmaps[r*e.mipmapCount+n]),a[r].format=e.format,a[r].width=e.width,a[r].height=e.height}else s.image.width=e.width,s.image.height=e.height,s.mipmaps=e.mipmaps;1===e.mipmapCount&&(s.minFilter=1006);s.format=e.format;s.needsUpdate=!0;i&&i(s)},r,n);return s},setPath:function(e){this.path=e;return this}});Object.assign(an.prototype,{load:function(e,t,r,n){var i=this,o=new Me,a=new nn(this.manager);a.setResponseType("arraybuffer");a.load(e,function(e){if(e=i._parser(e))void 0!==e.image?o.image=e.image:void 0!==e.data&&(o.image.width=e.width,o.image.height=e.height,o.image.data=e.data),o.wrapS=void 0!==e.wrapS?e.wrapS:1001,o.wrapT=void 0!==e.wrapT?e.wrapT:1001,o.magFilter=void 0!==e.magFilter?e.magFilter:1006,o.minFilter=void 0!==e.minFilter?e.minFilter:1008,o.anisotropy=void 0!==e.anisotropy?e.anisotropy:1,void 0!==e.format&&(o.format=e.format),void 0!==e.type&&(o.type=e.type),void 0!==e.mipmaps&&(o.mipmaps=e.mipmaps),1===e.mipmapCount&&(o.minFilter=1006),o.needsUpdate=!0,t&&t(o,e)},r,n);return o}});Object.assign(sn.prototype,{crossOrigin:"anonymous",load:function(t,e,r,n){function i(){u.removeEventListener("load",i,!1);u.removeEventListener("error",o,!1);Po.add(t,this);e&&e(this);a.manager.itemEnd(t)}function o(e){u.removeEventListener("load",i,!1);u.removeEventListener("error",o,!1);n&&n(e);a.manager.itemEnd(t);a.manager.itemError(t)}void 0===t&&(t="");void 0!==this.path&&(t=this.path+t);t=this.manager.resolveURL(t);var a=this,s=Po.get(t);if(void 0!==s)return a.manager.itemStart(t),setTimeout(function(){e&&e(s);a.manager.itemEnd(t)},0),s;var u=document.createElementNS("http://www.w3.org/1999/xhtml","img");u.addEventListener("load",i,!1);u.addEventListener("error",o,!1);"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(u.crossOrigin=this.crossOrigin);a.manager.itemStart(t);u.src=t;return u},setCrossOrigin:function(e){this.crossOrigin=e;return this},setPath:function(e){this.path=e;return this}});Object.assign(un.prototype,{crossOrigin:"anonymous",load:function(e,r,t,n){function i(t){a.load(e[t],function(e){o.images[t]=e;s++;6===s&&(o.needsUpdate=!0,r&&r(o))},void 0,n)}var o=new U,a=new sn(this.manager);a.setCrossOrigin(this.crossOrigin);a.setPath(this.path);var s=0;for(t=0;t<e.length;++t)i(t);return o},setCrossOrigin:function(e){this.crossOrigin=e;return this},setPath:function(e){this.path=e;return this}});Object.assign(cn.prototype,{crossOrigin:"anonymous",load:function(t,r,e,n){var i=new p,o=new sn(this.manager);o.setCrossOrigin(this.crossOrigin);o.setPath(this.path);o.load(t,function(e){i.image=e;e=0<t.search(/\.(jpg|jpeg)$/)||0===t.search(/^data:image\/jpeg/);i.format=e?1022:1023;i.needsUpdate=!0;void 0!==r&&r(i)},e,n);return i},setCrossOrigin:function(e){this.crossOrigin=e;return this},setPath:function(e){this.path=e;return this}});Object.assign(hn.prototype,{getPoint:function(){console.warn("THREE.Curve: .getPoint() not implemented.");return null},getPointAt:function(e,t){e=this.getUtoTmapping(e);return this.getPoint(e,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){void 0===e&&(e=this.arcLengthDivisions);if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],r=this.getPoint(0),n,i=0;t.push(0);for(n=1;n<=e;n++){var o=this.getPoint(n/e);i+=o.distanceTo(r);t.push(i);r=o}return this.cacheArcLengths=t},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(e,t){var r=this.getLengths(),n=r.length;t=t?t:e*r[n-1];for(var i=0,o=n-1,a;i<=o;)if(e=Math.floor(i+(o-i)/2),a=r[e]-t,0>a)i=e+1;else if(0<a)o=e-1;else{o=e;break}e=o;if(r[e]===t)return e/(n-1);i=r[e];return(e+(t-i)/(r[e+1]-i))/(n-1)},getTangent:function(e){var t=e-1e-4;e+=1e-4;0>t&&(t=0);1<e&&(e=1);t=this.getPoint(t);return this.getPoint(e).clone().sub(t).normalize()},getTangentAt:function(e){e=this.getUtoTmapping(e);return this.getTangent(e)},computeFrenetFrames:function(e,t){var r=new xe,n=[],i=[],o=[],a=new xe,s=new we,u;for(u=0;u<=e;u++){var c=u/e;n[u]=this.getTangentAt(c);n[u].normalize()}i[0]=new xe;o[0]=new xe;u=Number.MAX_VALUE;c=Math.abs(n[0].x);var h=Math.abs(n[0].y),l=Math.abs(n[0].z);c<=u&&(u=c,r.set(1,0,0));h<=u&&(u=h,r.set(0,1,0));l<=u&&r.set(0,0,1);a.crossVectors(n[0],r).normalize();i[0].crossVectors(n[0],a);o[0].crossVectors(n[0],i[0]);for(u=1;u<=e;u++)i[u]=i[u-1].clone(),o[u]=o[u-1].clone(),a.crossVectors(n[u-1],n[u]),a.length()>Number.EPSILON&&(a.normalize(),r=Math.acos(eo.clamp(n[u-1].dot(n[u]),-1,1)),i[u].applyMatrix4(s.makeRotationAxis(a,r))),o[u].crossVectors(n[u],i[u]);if(!0===t)for(r=Math.acos(eo.clamp(i[0].dot(i[e]),-1,1)),r/=e,0<n[0].dot(a.crossVectors(i[0],i[e]))&&(r=-r),u=1;u<=e;u++)i[u].applyMatrix4(s.makeRotationAxis(n[u],r*u)),o[u].crossVectors(n[u],i[u]);return{tangents:n,normals:i,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.arcLengthDivisions=e.arcLengthDivisions;return this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};e.arcLengthDivisions=this.arcLengthDivisions;e.type=this.type;return e},fromJSON:function(e){this.arcLengthDivisions=e.arcLengthDivisions;return this}});ln.prototype=Object.create(hn.prototype);ln.prototype.constructor=ln;ln.prototype.isEllipseCurve=!0;ln.prototype.getPoint=function(e,t){t=t||new H;for(var r=2*Math.PI,n=this.aEndAngle-this.aStartAngle,i=Math.abs(n)<Number.EPSILON;0>n;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(n=i?0:r);!0!==this.aClockwise||i||(n=n===r?-r:n-r);r=this.aStartAngle+e*n;e=this.aX+this.xRadius*Math.cos(r);var o=this.aY+this.yRadius*Math.sin(r);0!==this.aRotation&&(r=Math.cos(this.aRotation),n=Math.sin(this.aRotation),i=e-this.aX,o-=this.aY,e=i*r-o*n+this.aX,o=i*n+o*r+this.aY);return t.set(e,o)};ln.prototype.copy=function(e){hn.prototype.copy.call(this,e);this.aX=e.aX;this.aY=e.aY;this.xRadius=e.xRadius;this.yRadius=e.yRadius;this.aStartAngle=e.aStartAngle;this.aEndAngle=e.aEndAngle;this.aClockwise=e.aClockwise;this.aRotation=e.aRotation;return this};ln.prototype.toJSON=function(){var e=hn.prototype.toJSON.call(this);e.aX=this.aX;e.aY=this.aY;e.xRadius=this.xRadius;e.yRadius=this.yRadius;e.aStartAngle=this.aStartAngle;e.aEndAngle=this.aEndAngle;e.aClockwise=this.aClockwise;e.aRotation=this.aRotation;return e};ln.prototype.fromJSON=function(e){hn.prototype.fromJSON.call(this,e);this.aX=e.aX;this.aY=e.aY;this.xRadius=e.xRadius;this.yRadius=e.yRadius;this.aStartAngle=e.aStartAngle;this.aEndAngle=e.aEndAngle;this.aClockwise=e.aClockwise;this.aRotation=e.aRotation;return this};pn.prototype=Object.create(ln.prototype);pn.prototype.constructor=pn;pn.prototype.isArcCurve=!0;var Ro=new xe,ko=new fn,Lo=new fn,Io=new fn;dn.prototype=Object.create(hn.prototype);dn.prototype.constructor=dn;dn.prototype.isCatmullRomCurve3=!0;dn.prototype.getPoint=function(e,t){t=t||new xe;var r=this.points,n=r.length;e*=n-(this.closed?0:1);var i=Math.floor(e);e-=i;this.closed?i+=0<i?0:(Math.floor(Math.abs(i)/n)+1)*n:0===e&&i===n-1&&(i=n-2,e=1);if(this.closed||0<i)var o=r[(i-1)%n];else Ro.subVectors(r[0],r[1]).add(r[0]),o=Ro;var a=r[i%n];var s=r[(i+1)%n];this.closed||i+2<n?r=r[(i+2)%n]:(Ro.subVectors(r[n-1],r[n-2]).add(r[n-1]),r=Ro);if("centripetal"===this.curveType||"chordal"===this.curveType){var u="chordal"===this.curveType?.5:.25;n=Math.pow(o.distanceToSquared(a),u);i=Math.pow(a.distanceToSquared(s),u);u=Math.pow(s.distanceToSquared(r),u);1e-4>i&&(i=1);1e-4>n&&(n=i);1e-4>u&&(u=i);ko.initNonuniformCatmullRom(o.x,a.x,s.x,r.x,n,i,u);Lo.initNonuniformCatmullRom(o.y,a.y,s.y,r.y,n,i,u);Io.initNonuniformCatmullRom(o.z,a.z,s.z,r.z,n,i,u)}else"catmullrom"===this.curveType&&(ko.initCatmullRom(o.x,a.x,s.x,r.x,this.tension),Lo.initCatmullRom(o.y,a.y,s.y,r.y,this.tension),Io.initCatmullRom(o.z,a.z,s.z,r.z,this.tension));t.set(ko.calc(e),Lo.calc(e),Io.calc(e));return t};dn.prototype.copy=function(e){hn.prototype.copy.call(this,e);this.points=[];for(var t=0,r=e.points.length;t<r;t++)this.points.push(e.points[t].clone());this.closed=e.closed;this.curveType=e.curveType;this.tension=e.tension;return this};dn.prototype.toJSON=function(){var e=hn.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++)e.points.push(this.points[t].toArray());e.closed=this.closed;e.curveType=this.curveType;e.tension=this.tension;return e};dn.prototype.fromJSON=function(e){hn.prototype.fromJSON.call(this,e);this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new xe).fromArray(n))}this.closed=e.closed;this.curveType=e.curveType;this.tension=e.tension;return this};_n.prototype=Object.create(hn.prototype);_n.prototype.constructor=_n;_n.prototype.isCubicBezierCurve=!0;_n.prototype.getPoint=function(e,t){t=t||new H;var r=this.v0,n=this.v1,i=this.v2,o=this.v3;t.set(gn(e,r.x,n.x,i.x,o.x),gn(e,r.y,n.y,i.y,o.y));return t};_n.prototype.copy=function(e){hn.prototype.copy.call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);this.v3.copy(e.v3);return this};_n.prototype.toJSON=function(){var e=hn.prototype.toJSON.call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();e.v3=this.v3.toArray();return e};_n.prototype.fromJSON=function(e){hn.prototype.fromJSON.call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);this.v3.fromArray(e.v3);return this};yn.prototype=Object.create(hn.prototype);yn.prototype.constructor=yn;yn.prototype.isCubicBezierCurve3=!0;yn.prototype.getPoint=function(e,t){t=t||new xe;var r=this.v0,n=this.v1,i=this.v2,o=this.v3;t.set(gn(e,r.x,n.x,i.x,o.x),gn(e,r.y,n.y,i.y,o.y),gn(e,r.z,n.z,i.z,o.z));return t};yn.prototype.copy=function(e){hn.prototype.copy.call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);this.v3.copy(e.v3);return this};yn.prototype.toJSON=function(){var e=hn.prototype.toJSON.call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();e.v3=this.v3.toArray();return e};yn.prototype.fromJSON=function(e){hn.prototype.fromJSON.call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);this.v3.fromArray(e.v3);return this};bn.prototype=Object.create(hn.prototype);bn.prototype.constructor=bn;bn.prototype.isLineCurve=!0;bn.prototype.getPoint=function(e,t){t=t||new H;1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1));return t};bn.prototype.getPointAt=function(e,t){return this.getPoint(e,t)};bn.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()};bn.prototype.copy=function(e){hn.prototype.copy.call(this,e);this.v1.copy(e.v1);this.v2.copy(e.v2);return this};bn.prototype.toJSON=function(){var e=hn.prototype.toJSON.call(this);e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e};bn.prototype.fromJSON=function(e){hn.prototype.fromJSON.call(this,e);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this};wn.prototype=Object.create(hn.prototype);wn.prototype.constructor=wn;wn.prototype.isLineCurve3=!0;wn.prototype.getPoint=function(e,t){t=t||new xe;1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1));return t};wn.prototype.getPointAt=function(e,t){return this.getPoint(e,t)};wn.prototype.copy=function(e){hn.prototype.copy.call(this,e);this.v1.copy(e.v1);this.v2.copy(e.v2);return this};wn.prototype.toJSON=function(){var e=hn.prototype.toJSON.call(this);e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e};wn.prototype.fromJSON=function(e){hn.prototype.fromJSON.call(this,e);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this};xn.prototype=Object.create(hn.prototype);xn.prototype.constructor=xn;xn.prototype.isQuadraticBezierCurve=!0;xn.prototype.getPoint=function(e,t){t=t||new H;var r=this.v0,n=this.v1,i=this.v2;t.set(mn(e,r.x,n.x,i.x),mn(e,r.y,n.y,i.y));return t};xn.prototype.copy=function(e){hn.prototype.copy.call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);return this};xn.prototype.toJSON=function(){var e=hn.prototype.toJSON.call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e};xn.prototype.fromJSON=function(e){hn.prototype.fromJSON.call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this};Sn.prototype=Object.create(hn.prototype);Sn.prototype.constructor=Sn;Sn.prototype.isQuadraticBezierCurve3=!0;Sn.prototype.getPoint=function(e,t){t=t||new xe;var r=this.v0,n=this.v1,i=this.v2;t.set(mn(e,r.x,n.x,i.x),mn(e,r.y,n.y,i.y),mn(e,r.z,n.z,i.z));return t};Sn.prototype.copy=function(e){hn.prototype.copy.call(this,e);this.v0.copy(e.v0);this.v1.copy(e.v1);this.v2.copy(e.v2);return this};Sn.prototype.toJSON=function(){var e=hn.prototype.toJSON.call(this);e.v0=this.v0.toArray();e.v1=this.v1.toArray();e.v2=this.v2.toArray();return e};Sn.prototype.fromJSON=function(e){hn.prototype.fromJSON.call(this,e);this.v0.fromArray(e.v0);this.v1.fromArray(e.v1);this.v2.fromArray(e.v2);return this};Mn.prototype=Object.create(hn.prototype);Mn.prototype.constructor=Mn;Mn.prototype.isSplineCurve=!0;Mn.prototype.getPoint=function(e,t){t=t||new H;var r=this.points,n=(r.length-1)*e;e=Math.floor(n);n-=e;var i=r[0===e?e:e-1],o=r[e],a=r[e>r.length-2?r.length-1:e+1];r=r[e>r.length-3?r.length-1:e+2];t.set(vn(n,i.x,o.x,a.x,r.x),vn(n,i.y,o.y,a.y,r.y));return t};Mn.prototype.copy=function(e){hn.prototype.copy.call(this,e);this.points=[];for(var t=0,r=e.points.length;t<r;t++)this.points.push(e.points[t].clone());return this};Mn.prototype.toJSON=function(){var e=hn.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++)e.points.push(this.points[t].toArray());return e};Mn.prototype.fromJSON=function(e){hn.prototype.fromJSON.call(this,e);this.points=[];for(var t=0,r=e.points.length;t<r;t++){var n=e.points[t];this.points.push((new H).fromArray(n))}return this};var No=Object.freeze({ArcCurve:pn,CatmullRomCurve3:dn,CubicBezierCurve:_n,CubicBezierCurve3:yn,EllipseCurve:ln,LineCurve:bn,LineCurve3:wn,QuadraticBezierCurve:xn,QuadraticBezierCurve3:Sn,SplineCurve:Mn});Cn.prototype=Object.assign(Object.create(hn.prototype),{constructor:Cn,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new bn(t,e))},getPoint:function(e){var t=e*this.getLength(),r=this.getCurveLengths();for(e=0;e<r.length;){if(r[e]>=t)return t=r[e]-t,e=this.curves[e],r=e.getLength(),e.getPointAt(0===r?0:1-t/r);e++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,n=this.curves.length;r<n;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));this.autoClose&&t.push(t[0]);return t},getPoints:function(e){e=e||12;for(var t=[],r,n=0,i=this.curves;n<i.length;n++){var o=i[n];o=o.getPoints(o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e);for(var a=0;a<o.length;a++){var s=o[a];r&&r.equals(s)||(t.push(s),r=s)}}this.autoClose&&1<t.length&&!t[t.length-1].equals(t[0])&&t.push(t[0]);return t},copy:function(e){hn.prototype.copy.call(this,e);this.curves=[];for(var t=0,r=e.curves.length;t<r;t++)this.curves.push(e.curves[t].clone());this.autoClose=e.autoClose;return this},toJSON:function(){var e=hn.prototype.toJSON.call(this);e.autoClose=this.autoClose;e.curves=[];for(var t=0,r=this.curves.length;t<r;t++)e.curves.push(this.curves[t].toJSON());return e},fromJSON:function(e){hn.prototype.fromJSON.call(this,e);this.autoClose=e.autoClose;this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var n=e.curves[t];this.curves.push((new No[n.type]).fromJSON(n))}return this}});En.prototype=Object.assign(Object.create(Cn.prototype),{constructor:En,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var r=new bn(this.currentPoint.clone(),new H(e,t));this.curves.push(r);this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,r,n){e=new xn(this.currentPoint.clone(),new H(e,t),new H(r,n));this.curves.push(e);this.currentPoint.set(r,n)},bezierCurveTo:function(e,t,r,n,i,o){e=new _n(this.currentPoint.clone(),new H(e,t),new H(r,n),new H(i,o));this.curves.push(e);this.currentPoint.set(i,o)},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e);t=new Mn(t);this.curves.push(t);this.currentPoint.copy(e[e.length-1])},arc:function(e,t,r,n,i,o){this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,r,n,i,o)},absarc:function(e,t,r,n,i,o){this.absellipse(e,t,r,r,n,i,o)},ellipse:function(e,t,r,n,i,o,a,s){this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,r,n,i,o,a,s)},absellipse:function(e,t,r,n,i,o,a,s){e=new ln(e,t,r,n,i,o,a,s);0<this.curves.length&&(t=e.getPoint(0),t.equals(this.currentPoint)||this.lineTo(t.x,t.y));this.curves.push(e);e=e.getPoint(1);this.currentPoint.copy(e)},copy:function(e){Cn.prototype.copy.call(this,e);this.currentPoint.copy(e.currentPoint);return this},toJSON:function(){var e=Cn.prototype.toJSON.call(this);e.currentPoint=this.currentPoint.toArray();return e},fromJSON:function(e){Cn.prototype.fromJSON.call(this,e);this.currentPoint.fromArray(e.currentPoint);return this}});Tn.prototype=Object.assign(Object.create(En.prototype),{constructor:Tn,getPointsHoles:function(e){for(var t=[],r=0,n=this.holes.length;r<n;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){En.prototype.copy.call(this,e);this.holes=[];for(var t=0,r=e.holes.length;t<r;t++)this.holes.push(e.holes[t].clone());return this},toJSON:function(){var e=En.prototype.toJSON.call(this);e.uuid=this.uuid;e.holes=[];for(var t=0,r=this.holes.length;t<r;t++)e.holes.push(this.holes[t].toJSON());return e},fromJSON:function(e){En.prototype.fromJSON.call(this,e);this.uuid=e.uuid;this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var n=e.holes[t];this.holes.push((new En).fromJSON(n))}return this}});On.prototype=Object.assign(Object.create(h.prototype),{constructor:On,isLight:!0,copy:function(e){h.prototype.copy.call(this,e);this.color.copy(e.color);this.intensity=e.intensity;return this},toJSON:function(e){e=h.prototype.toJSON.call(this,e);e.object.color=this.color.getHex();e.object.intensity=this.intensity;void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(e.object.distance=this.distance);void 0!==this.angle&&(e.object.angle=this.angle);void 0!==this.decay&&(e.object.decay=this.decay);void 0!==this.penumbra&&(e.object.penumbra=this.penumbra);void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON());return e}});Pn.prototype=Object.assign(Object.create(On.prototype),{constructor:Pn,isHemisphereLight:!0,copy:function(e){On.prototype.copy.call(this,e);this.groundColor.copy(e.groundColor);return this}});Object.assign(An.prototype,{copy:function(e){this.camera=e.camera.clone();this.bias=e.bias;this.radius=e.radius;this.mapSize.copy(e.mapSize);return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};0!==this.bias&&(e.bias=this.bias);1!==this.radius&&(e.radius=this.radius);if(512!==this.mapSize.x||512!==this.mapSize.y)e.mapSize=this.mapSize.toArray();e.camera=this.camera.toJSON(!1).object;delete e.camera.matrix;return e}});jn.prototype=Object.assign(Object.create(An.prototype),{constructor:jn,isSpotLightShadow:!0,update:function(e){var t=this.camera,r=2*eo.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height;e=e.distance||t.far;if(r!==t.fov||n!==t.aspect||e!==t.far)t.fov=r,t.aspect=n,t.far=e,t.updateProjectionMatrix()}});Rn.prototype=Object.assign(Object.create(On.prototype),{constructor:Rn,isSpotLight:!0,copy:function(e){On.prototype.copy.call(this,e);this.distance=e.distance;this.angle=e.angle;this.penumbra=e.penumbra;this.decay=e.decay;this.target=e.target.clone();this.shadow=e.shadow.clone();return this}});kn.prototype=Object.assign(Object.create(On.prototype),{constructor:kn,isPointLight:!0,copy:function(e){On.prototype.copy.call(this,e);this.distance=e.distance;this.decay=e.decay;this.shadow=e.shadow.clone();return this}});Ln.prototype=Object.assign(Object.create(An.prototype),{constructor:Ln});In.prototype=Object.assign(Object.create(On.prototype),{constructor:In,isDirectionalLight:!0,copy:function(e){On.prototype.copy.call(this,e);this.target=e.target.clone();this.shadow=e.shadow.clone();return this}});Nn.prototype=Object.assign(Object.create(On.prototype),{constructor:Nn,isAmbientLight:!0});Dn.prototype=Object.assign(Object.create(On.prototype),{constructor:Dn,isRectAreaLight:!0,copy:function(e){On.prototype.copy.call(this,e);this.width=e.width;this.height=e.height;return this},toJSON:function(e){e=On.prototype.toJSON.call(this,e);e.object.width=this.width;e.object.height=this.height;return e}});var Do={arraySlice:function(e,t,r){return Do.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==r?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(r){for(var e=r.length,t=Array(e),n=0;n!==e;++n)t[n]=n;t.sort(function(e,t){return r[e]-r[t]});return t},sortedArray:function(e,t,r){for(var n=e.length,i=new e.constructor(n),o=0,a=0;a!==n;++o)for(var s=r[o]*t,u=0;u!==t;++u)i[a++]=e[s+u];return i},flattenJSON:function(e,t,r,n){for(var i=1,o=e[0];void 0!==o&&void 0===o[n];)o=e[i++];if(void 0!==o){var a=o[n];if(void 0!==a)if(Array.isArray(a)){do{a=o[n],void 0!==a&&(t.push(o.time),r.push.apply(r,a)),o=e[i++]}while(void 0!==o)}else if(void 0!==a.toArray){do{a=o[n],void 0!==a&&(t.push(o.time),a.toArray(r,r.length)),o=e[i++]}while(void 0!==o)}else{do{a=o[n],void 0!==a&&(t.push(o.time),r.push(a)),o=e[i++]}while(void 0!==o)}}}};Object.assign(Bn.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,n=t[r],i=t[r-1];e:{t:{r:{n:if(!(e<n)){for(var o=r+2;;){if(void 0===n){if(e<i)break n;this._cachedIndex=r=t.length;return this.afterEnd_(r-1,e,i)}if(r===o)break;i=n;n=t[++r];if(e<n)break t}n=t.length;break r}if(e>=i)break e;else{o=t[1];e<o&&(r=2,i=o);for(o=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(r===o)break;n=i;i=t[--r-1];if(e>=i)break t}n=r;r=0}}for(;r<n;)i=r+n>>>1,e<t[i]?n=i:r=i+1;n=t[r];i=t[r-1];if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return this._cachedIndex=r=t.length,this.afterEnd_(r-1,i,e)}this._cachedIndex=r;this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){var t=this.resultBuffer,r=this.sampleValues,n=this.valueSize;e*=n;for(var i=0;i!==n;++i)t[i]=r[e+i];return t},interpolate_:function(){throw Error("call to abstract method")},intervalChanged_:function(){}});Object.assign(Bn.prototype,{beforeStart_:Bn.prototype.copySampleValue_,afterEnd_:Bn.prototype.copySampleValue_});Fn.prototype=Object.assign(Object.create(Bn.prototype),{constructor:Fn,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,r){var n=this.parameterPositions,i=e-2,o=e+1,a=n[i],s=n[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=e;a=2*t-r;break;case 2402:i=n.length-2;a=t+n[i]-n[i+1];break;default:i=e,a=r}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e;s=2*r-t;break;case 2402:o=1;s=r+n[1]-n[0];break;default:o=e-1,s=t}e=.5*(r-t);n=this.valueSize;this._weightPrev=e/(t-a);this._weightNext=e/(s-r);this._offsetPrev=i*n;this._offsetNext=o*n},interpolate_:function(e,t,r,n){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize;e*=a;var s=e-a,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,l=this._weightNext,p=(r-t)/(n-t);r=p*p;n=r*p;t=-h*n+2*h*r-h*p;h=(1+h)*n+(-1.5-2*h)*r+(-.5+h)*p+1;p=(-1-l)*n+(1.5+l)*r+.5*p;l=l*n-l*r;for(r=0;r!==a;++r)i[r]=t*o[u+r]+h*o[s+r]+p*o[e+r]+l*o[c+r];return i}});zn.prototype=Object.assign(Object.create(Bn.prototype),{constructor:zn,interpolate_:function(e,t,r,n){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize;e*=a;var s=e-a;t=(r-t)/(n-t);r=1-t;for(n=0;n!==a;++n)i[n]=o[s+n]*r+o[e+n]*t;return i}});$n.prototype=Object.assign(Object.create(Bn.prototype),{constructor:$n,interpolate_:function(e){return this.copySampleValue_(e-1)}});Object.assign(Un,{toJSON:function(e){var t=e.constructor;if(void 0!==t.toJSON)t=t.toJSON(e);else{t={name:e.name,times:Do.convertArray(e.times,Array),values:Do.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}t.type=e.ValueTypeName;return t}});Object.assign(Un.prototype,{constructor:Un,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new $n(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new zn(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Fn(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){switch(e){case 2300:var t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(t);console.warn("THREE.KeyframeTrack:",t);return this}this.createInterpolant=t;return this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,n=t.length;r!==n;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,n=r.length,i=0,o=n-1;i!==n&&r[i]<e;)++i;for(;-1!==o&&r[o]>t;)--o;++o;if(0!==i||o!==n)i>=o&&(o=Math.max(o,1),i=o-1),e=this.getValueSize(),this.times=Do.arraySlice(r,i,o),this.values=Do.arraySlice(this.values,i*e,o*e);return this},validate:function(){var e=!0,t=this.getValueSize();0!==t-Math.floor(t)&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times;t=this.values;var n=r.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var i=null,o=0;o!==n;o++){var a=r[o];if("number"===typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,a);e=!1;break}if(null!==i&&i>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,a,i);e=!1;break}i=a}if(void 0!==t&&Do.isTypedArray(t))for(o=0,r=t.length;o!==r;++o)if(n=t[o],isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,n);e=!1;break}return e},optimize:function(){for(var e=this.times,t=this.values,r=this.getValueSize(),n=2302===this.getInterpolation(),i=1,o=e.length-1,a=1;a<o;++a){var s=!1,u=e[a];if(u!==e[a+1]&&(1!==a||u!==u[0]))if(n)s=!0;else{var c=a*r,h=c-r,l=c+r;for(u=0;u!==r;++u){var p=t[c+u];if(p!==t[h+u]||p!==t[l+u]){s=!0;break}}}if(s){if(a!==i)for(e[i]=e[a],s=a*r,c=i*r,u=0;u!==r;++u)t[c+u]=t[s+u];++i}}if(0<o){e[i]=e[o];s=o*r;c=i*r;for(u=0;u!==r;++u)t[c+u]=t[s+u];++i}i!==e.length&&(this.times=Do.arraySlice(e,0,i),this.values=Do.arraySlice(t,0,i*r));return this}});Gn.prototype=Object.assign(Object.create(Un.prototype),{constructor:Gn,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});Vn.prototype=Object.assign(Object.create(Un.prototype),{constructor:Vn,ValueTypeName:"color"});Hn.prototype=Object.assign(Object.create(Un.prototype),{constructor:Hn,ValueTypeName:"number"});qn.prototype=Object.assign(Object.create(Bn.prototype),{constructor:qn,interpolate_:function(e,t,r,n){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize;e*=a;t=(r-t)/(n-t);for(r=e+a;e!==r;e+=4)s.slerpFlat(i,0,o,e-a,o,e,t);return i}});Wn.prototype=Object.assign(Object.create(Un.prototype),{constructor:Wn,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new qn(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0});Xn.prototype=Object.assign(Object.create(Un.prototype),{constructor:Xn,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});Yn.prototype=Object.assign(Object.create(Un.prototype),{constructor:Yn,ValueTypeName:"vector"});Object.assign(Kn,{parse:function(e){for(var t=[],r=e.tracks,n=1/(e.fps||1),i=0,o=r.length;i!==o;++i)t.push(Jn(r[i]).scale(n));return new Kn(e.name,e.duration,t)},toJSON:function(e){var t=[],r=e.tracks;e={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid};for(var n=0,i=r.length;n!==i;++n)t.push(Un.toJSON(r[n]));return e},CreateFromMorphTargetSequence:function(e,t,r,n){for(var i=t.length,o=[],a=0;a<i;a++){var s=[],u=[];s.push((a+i-1)%i,a,(a+1)%i);u.push(0,1,0);var c=Do.getKeyframeOrder(s);s=Do.sortedArray(s,1,c);u=Do.sortedArray(u,1,c);n||0!==s[0]||(s.push(i),u.push(u[0]));o.push(new Hn(".morphTargetInfluences["+t[a].name+"]",s,u).scale(1/r))}return new Kn(e,-1,o)},findByName:function(e,t){var r=e;Array.isArray(e)||(r=e.geometry&&e.geometry.animations||e.animations);for(e=0;e<r.length;e++)if(r[e].name===t)return r[e];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],u=s.name.match(i);if(u&&1<u.length){var c=u[1];(u=n[c])||(n[c]=u=[]);u.push(s)}}e=[];for(c in n)e.push(Kn.CreateFromMorphTargetSequence(c,n[c],t,r));return e},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;var r=function(e,t,r,n,i){if(0!==r.length){var o=[],a=[];Do.flattenJSON(r,o,a,n);0!==o.length&&i.push(new e(t,o,a))}},n=[],i=e.name||"default",o=e.length||-1,a=e.fps||30;e=e.hierarchy||[];for(var s=0;s<e.length;s++){var u=e[s].keys;if(u&&0!==u.length)if(u[0].morphTargets){o={};for(var c=0;c<u.length;c++)if(u[c].morphTargets)for(var h=0;h<u[c].morphTargets.length;h++)o[u[c].morphTargets[h]]=-1;for(var l in o){var p=[],f=[];for(h=0;h!==u[c].morphTargets.length;++h){var d=u[c];p.push(d.time);f.push(d.morphTarget===l?1:0)}n.push(new Hn(".morphTargetInfluence["+l+"]",p,f))}o=o.length*(a||1)}else c=".bones["+t[s].name+"]",r(Yn,c+".position",u,"pos",n),r(Wn,c+".quaternion",u,"rot",n),r(Yn,c+".scale",u,"scl",n)}return 0===n.length?null:new Kn(i,o,n)}});Object.assign(Kn.prototype,{resetDuration:function(){for(var e=0,t=0,r=this.tracks.length;t!==r;++t){var n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}this.duration=e;return this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}});Object.assign(Qn.prototype,{load:function(e,t,r,n){var i=this;new nn(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},setTextures:function(e){this.textures=e},parse:function(e){function t(e){void 0===r[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e);return r[e]}var r=this.textures,n=new Oo[e.type];void 0!==e.uuid&&(n.uuid=e.uuid);void 0!==e.name&&(n.name=e.name);void 0!==e.color&&n.color.setHex(e.color);void 0!==e.roughness&&(n.roughness=e.roughness);void 0!==e.metalness&&(n.metalness=e.metalness);void 0!==e.emissive&&n.emissive.setHex(e.emissive);void 0!==e.specular&&n.specular.setHex(e.specular);void 0!==e.shininess&&(n.shininess=e.shininess);void 0!==e.clearCoat&&(n.clearCoat=e.clearCoat);void 0!==e.clearCoatRoughness&&(n.clearCoatRoughness=e.clearCoatRoughness);void 0!==e.uniforms&&(n.uniforms=e.uniforms);void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader);void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader);void 0!==e.vertexColors&&(n.vertexColors=e.vertexColors);void 0!==e.fog&&(n.fog=e.fog);void 0!==e.flatShading&&(n.flatShading=e.flatShading);void 0!==e.blending&&(n.blending=e.blending);void 0!==e.side&&(n.side=e.side);void 0!==e.opacity&&(n.opacity=e.opacity);void 0!==e.transparent&&(n.transparent=e.transparent);void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest);void 0!==e.depthTest&&(n.depthTest=e.depthTest);void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite);void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite);void 0!==e.wireframe&&(n.wireframe=e.wireframe);void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth);void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap);void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin);void 0!==e.rotation&&(n.rotation=e.rotation);1!==e.linewidth&&(n.linewidth=e.linewidth);void 0!==e.dashSize&&(n.dashSize=e.dashSize);void 0!==e.gapSize&&(n.gapSize=e.gapSize);void 0!==e.scale&&(n.scale=e.scale);void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset);void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor);void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits);void 0!==e.skinning&&(n.skinning=e.skinning);void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets);void 0!==e.dithering&&(n.dithering=e.dithering);void 0!==e.visible&&(n.visible=e.visible);void 0!==e.userData&&(n.userData=e.userData);void 0!==e.shading&&(n.flatShading=1===e.shading);void 0!==e.size&&(n.size=e.size);void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation);void 0!==e.map&&(n.map=t(e.map));void 0!==e.alphaMap&&(n.alphaMap=t(e.alphaMap),n.transparent=!0);void 0!==e.bumpMap&&(n.bumpMap=t(e.bumpMap));void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale);void 0!==e.normalMap&&(n.normalMap=t(e.normalMap));void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType);if(void 0!==e.normalScale){var i=e.normalScale;!1===Array.isArray(i)&&(i=[i,i]);n.normalScale=(new H).fromArray(i)}void 0!==e.displacementMap&&(n.displacementMap=t(e.displacementMap));void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale);void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias);void 0!==e.roughnessMap&&(n.roughnessMap=t(e.roughnessMap));void 0!==e.metalnessMap&&(n.metalnessMap=t(e.metalnessMap));void 0!==e.emissiveMap&&(n.emissiveMap=t(e.emissiveMap));void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity);void 0!==e.specularMap&&(n.specularMap=t(e.specularMap));void 0!==e.envMap&&(n.envMap=t(e.envMap));void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity);void 0!==e.lightMap&&(n.lightMap=t(e.lightMap));void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity);void 0!==e.aoMap&&(n.aoMap=t(e.aoMap));void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity);void 0!==e.gradientMap&&(n.gradientMap=t(e.gradientMap));return n}});Object.assign(ei.prototype,{load:function(e,t,r,n){var i=this;new nn(i.manager).load(e,function(e){t(i.parse(JSON.parse(e)))},r,n)},parse:function(e){var t=new A,r=e.data.index;void 0!==r&&(r=new Bo[r.type](r.array),t.setIndex(new _(r,1)));var n=e.data.attributes;for(o in n){var i=n[o];r=new Bo[i.type](i.array);t.addAttribute(o,new _(r,i.itemSize,i.normalized))}var o=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==o)for(r=0,n=o.length;r!==n;++r)i=o[r],t.addGroup(i.start,i.count,i.materialIndex);e=e.data.boundingSphere;void 0!==e&&(o=new xe,void 0!==e.center&&o.fromArray(e.center),t.boundingSphere=new c(o,e.radius));return t}});var Bo={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!==typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};ti.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,r=0,n=t.length;r<n;r+=2){var i=t[r+1];if(t[r].test(e))return i}return null}};Object.assign(ti.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,r){for(var n=[],i=0;i<e.length;++i)n[i]=this.createMaterial(e[i],t,r);return n},createMaterial:function(){var o={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},c=new x,h=new cn,l=new Qn;return function(e,a,s){function t(e,t,r,n,i){e=a+e;var o=ti.Handlers.get(e);null!==o?e=o.load(e):(h.setCrossOrigin(s),e=h.load(e));void 0!==t&&(e.repeat.fromArray(t),1!==t[0]&&(e.wrapS=1e3),1!==t[1]&&(e.wrapT=1e3));void 0!==r&&e.offset.fromArray(r);void 0!==n&&("repeat"===n[0]&&(e.wrapS=1e3),"mirror"===n[0]&&(e.wrapS=1002),"repeat"===n[1]&&(e.wrapT=1e3),"mirror"===n[1]&&(e.wrapT=1002));void 0!==i&&(e.anisotropy=i);t=eo.generateUUID();u[t]=e;return t}var u={},r={uuid:eo.generateUUID(),type:"MeshLambertMaterial"},n;for(n in e){var i=e[n];switch(n){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":r.name=i;break;case"blending":r.blending=o[i];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",n,"is no longer supported.");break;case"colorDiffuse":r.color=c.fromArray(i).getHex();break;case"colorSpecular":r.specular=c.fromArray(i).getHex();break;case"colorEmissive":r.emissive=c.fromArray(i).getHex();break;case"specularCoef":r.shininess=i;break;case"shading":"basic"===i.toLowerCase()&&(r.type="MeshBasicMaterial");"phong"===i.toLowerCase()&&(r.type="MeshPhongMaterial");"standard"===i.toLowerCase()&&(r.type="MeshStandardMaterial");break;case"mapDiffuse":r.map=t(i,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":r.emissiveMap=t(i,e.mapEmissiveRepeat,e.mapEmissiveOffset,e.mapEmissiveWrap,e.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":r.lightMap=t(i,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":r.aoMap=t(i,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":r.bumpMap=t(i,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case"mapBumpScale":r.bumpScale=i;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":r.normalMap=t(i,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case"mapNormalFactor":r.normalScale=i;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":r.specularMap=t(i,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":r.metalnessMap=t(i,e.mapMetalnessRepeat,e.mapMetalnessOffset,e.mapMetalnessWrap,e.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":r.roughnessMap=t(i,e.mapRoughnessRepeat,e.mapRoughnessOffset,e.mapRoughnessWrap,e.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":r.alphaMap=t(i,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":r.side=1;break;case"doubleSided":r.side=2;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");r.opacity=i;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":r[n]=i;break;case"vertexColors":!0===i&&(r.vertexColors=2);"face"===i&&(r.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",n,i)}}"MeshBasicMaterial"===r.type&&delete r.emissive;"MeshPhongMaterial"!==r.type&&delete r.specular;1>r.opacity&&(r.transparent=!0);l.setTextures(u);return l.parse(r)}}()});var Fo={decodeText:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);return decodeURIComponent(escape(t))},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};Object.assign(ri.prototype,{crossOrigin:"anonymous",load:function(r,n,e,t){var i=this,o=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:Fo.extractUrlBase(r),a=new nn(this.manager);a.setWithCredentials(this.withCredentials);a.load(r,function(e){e=JSON.parse(e);var t=e.metadata;if(void 0!==t&&(t=t.type,void 0!==t&&"object"===t.toLowerCase())){console.error("THREE.JSONLoader: "+r+" should be loaded with THREE.ObjectLoader instead.");return}e=i.parse(e,o);n(e.geometry,e.materials)},e,t)},setCrossOrigin:function(e){this.crossOrigin=e;return this},setTexturePath:function(e){this.texturePath=e;return this},parse:function(){return function(e,t){void 0!==e.data&&(e=e.data);e.scale=void 0!==e.scale?1/e.scale:1;var r=new S,n=e,i,o,a,s=n.faces;var u=n.vertices;var c=n.normals,h=n.colors;var l=n.scale;var p=0;if(void 0!==n.uvs){for(i=0;i<n.uvs.length;i++)n.uvs[i].length&&p++;for(i=0;i<p;i++)r.faceVertexUvs[i]=[]}var f=0;for(a=u.length;f<a;)i=new xe,i.x=u[f++]*l,i.y=u[f++]*l,i.z=u[f++]*l,r.vertices.push(i);f=0;for(a=s.length;f<a;){u=s[f++];var d=u&1;var v=u&2;i=u&8;var m=u&16;var g=u&32;l=u&64;u&=128;if(d){d=new D;d.a=s[f];d.b=s[f+1];d.c=s[f+3];var _=new D;_.a=s[f+1];_.b=s[f+2];_.c=s[f+3];f+=4;v&&(v=s[f++],d.materialIndex=v,_.materialIndex=v);v=r.faces.length;if(i)for(i=0;i<p;i++){var y=n.uvs[i];r.faceVertexUvs[i][v]=[];r.faceVertexUvs[i][v+1]=[];for(o=0;4>o;o++){var b=s[f++];var w=y[2*b];b=y[2*b+1];w=new H(w,b);2!==o&&r.faceVertexUvs[i][v].push(w);0!==o&&r.faceVertexUvs[i][v+1].push(w)}}m&&(m=3*s[f++],d.normal.set(c[m++],c[m++],c[m]),_.normal.copy(d.normal));if(g)for(i=0;4>i;i++)m=3*s[f++],g=new xe(c[m++],c[m++],c[m]),2!==i&&d.vertexNormals.push(g),0!==i&&_.vertexNormals.push(g);l&&(l=s[f++],l=h[l],d.color.setHex(l),_.color.setHex(l));if(u)for(i=0;4>i;i++)l=s[f++],l=h[l],2!==i&&d.vertexColors.push(new x(l)),0!==i&&_.vertexColors.push(new x(l));r.faces.push(d);r.faces.push(_)}else{d=new D;d.a=s[f++];d.b=s[f++];d.c=s[f++];v&&(v=s[f++],d.materialIndex=v);v=r.faces.length;if(i)for(i=0;i<p;i++)for(y=n.uvs[i],r.faceVertexUvs[i][v]=[],o=0;3>o;o++)b=s[f++],w=y[2*b],b=y[2*b+1],w=new H(w,b),r.faceVertexUvs[i][v].push(w);m&&(m=3*s[f++],d.normal.set(c[m++],c[m++],c[m]));if(g)for(i=0;3>i;i++)m=3*s[f++],g=new xe(c[m++],c[m++],c[m]),d.vertexNormals.push(g);l&&(l=s[f++],d.color.setHex(h[l]));if(u)for(i=0;3>i;i++)l=s[f++],d.vertexColors.push(new x(h[l]));r.faces.push(d)}}n=e;f=void 0!==n.influencesPerVertex?n.influencesPerVertex:2;if(n.skinWeights)for(a=0,s=n.skinWeights.length;a<s;a+=f)r.skinWeights.push(new Se(n.skinWeights[a],1<f?n.skinWeights[a+1]:0,2<f?n.skinWeights[a+2]:0,3<f?n.skinWeights[a+3]:0));if(n.skinIndices)for(a=0,s=n.skinIndices.length;a<s;a+=f)r.skinIndices.push(new Se(n.skinIndices[a],1<f?n.skinIndices[a+1]:0,2<f?n.skinIndices[a+2]:0,3<f?n.skinIndices[a+3]:0));r.bones=n.bones;r.bones&&0<r.bones.length&&(r.skinWeights.length!==r.skinIndices.length||r.skinIndices.length!==r.vertices.length)&&console.warn("When skinning, number of vertices ("+r.vertices.length+"), skinIndices ("+r.skinIndices.length+"), and skinWeights ("+r.skinWeights.length+") should match.");a=e;s=a.scale;if(void 0!==a.morphTargets)for(n=0,f=a.morphTargets.length;n<f;n++)for(r.morphTargets[n]={},r.morphTargets[n].name=a.morphTargets[n].name,r.morphTargets[n].vertices=[],c=r.morphTargets[n].vertices,h=a.morphTargets[n].vertices,p=0,u=h.length;p<u;p+=3)l=new xe,l.x=h[p]*s,l.y=h[p+1]*s,l.z=h[p+2]*s,c.push(l);if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),s=r.faces,a=a.morphColors[0].colors,n=0,f=s.length;n<f;n++)s[n].color.fromArray(a,3*n);a=e;n=[];f=[];void 0!==a.animation&&f.push(a.animation);void 0!==a.animations&&(a.animations.length?f=f.concat(a.animations):f.push(a.animations));for(a=0;a<f.length;a++)(s=Kn.parseAnimation(f[a],r.bones))&&n.push(s);r.morphTargets&&(f=Kn.CreateClipsFromMorphTargetSequences(r.morphTargets,10),n=n.concat(f));0<n.length&&(r.animations=n);r.computeFaceNormals();r.computeBoundingSphere();if(void 0===e.materials||0===e.materials.length)return{geometry:r};e=ti.prototype.initMaterials(e.materials,t,this.crossOrigin);return{geometry:r,materials:e}}}()});Object.assign(ni.prototype,{crossOrigin:"anonymous",load:function(r,n,e,i){""===this.texturePath&&(this.texturePath=r.substring(0,r.lastIndexOf("/")+1));var o=this;new nn(o.manager).load(r,function(e){var t=null;try{t=JSON.parse(e)}catch(e){void 0!==i&&i(e);console.error("THREE:ObjectLoader: Can't parse "+r+".",e.message);return}e=t.metadata;void 0===e||void 0===e.type||"geometry"===e.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+r+". Use THREE.JSONLoader instead."):o.parse(t,n)},e,i)},setTexturePath:function(e){this.texturePath=e;return this},setCrossOrigin:function(e){this.crossOrigin=e;return this},parse:function(e,t){var r=this.parseShape(e.shapes);r=this.parseGeometries(e.geometries,r);var n=this.parseImages(e.images,function(){void 0!==t&&t(i)});n=this.parseTextures(e.textures,n);n=this.parseMaterials(e.materials,n);var i=this.parseObject(e.object,r,n);e.animations&&(i.animations=this.parseAnimations(e.animations));void 0!==e.images&&0!==e.images.length||void 0===t||t(i);return i},parseShape:function(e){var t={};if(void 0!==e)for(var r=0,n=e.length;r<n;r++){var i=(new Tn).fromJSON(e[r]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var r={};if(void 0!==e)for(var n=new ri,i=new ei,o=0,a=e.length;o<a;o++){var s=e[o];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":var u=new To[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":u=new To[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":u=new To[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":u=new To[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":u=new To[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":u=new To[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":u=new To[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":u=new To[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":u=new To[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":u=new To[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"LatheGeometry":case"LatheBufferGeometry":u=new To[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":u=new To[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":u=[];for(var c=0,h=s.shapes.length;c<h;c++){var l=t[s.shapes[c]];u.push(l)}u=new To[s.type](u,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":u=[];c=0;for(h=s.shapes.length;c<h;c++)l=t[s.shapes[c]],u.push(l);c=s.options.extrudePath;void 0!==c&&(s.options.extrudePath=(new No[c.type]).fromJSON(c));u=new To[s.type](u,s.options);break;case"BufferGeometry":u=i.parse(s);break;case"Geometry":u=n.parse(s,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}u.uuid=s.uuid;void 0!==s.name&&(u.name=s.name);!0===u.isBufferGeometry&&void 0!==s.userData&&(u.userData=s.userData);r[s.uuid]=u}return r},parseMaterials:function(e,t){var r={};if(void 0!==e){var n=new Qn;n.setTextures(t);t=0;for(var i=e.length;t<i;t++){var o=e[t];if("MultiMaterial"===o.type){for(var a=[],s=0;s<o.materials.length;s++)a.push(n.parse(o.materials[s]));r[o.uuid]=a}else r[o.uuid]=n.parse(o)}}return r},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],i=Kn.parse(n);void 0!==n.uuid&&(i.uuid=n.uuid);t.push(i)}return t},parseImages:function(e,t){function r(e){n.manager.itemStart(e);return o.load(e,function(){n.manager.itemEnd(e)},void 0,function(){n.manager.itemEnd(e);n.manager.itemError(e)})}var n=this,i={};if(void 0!==e&&0<e.length){t=new rn(t);var o=new sn(t);o.setCrossOrigin(this.crossOrigin);t=0;for(var a=e.length;t<a;t++){var s=e[t],u=s.url;if(Array.isArray(u)){i[s.uuid]=[];for(var c=0,h=u.length;c<h;c++){var l=u[c];l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:n.texturePath+l;i[s.uuid].push(r(l))}}else l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(s.url)?s.url:n.texturePath+s.url,i[s.uuid]=r(l)}}return i},parseTextures:function(e,t){function r(e,t){if("number"===typeof e)return e;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e);return t[e]}var n={};if(void 0!==e)for(var i=0,o=e.length;i<o;i++){var a=e[i];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid);void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var s=Array.isArray(t[a.image])?new U(t[a.image]):new p(t[a.image]);s.needsUpdate=!0;s.uuid=a.uuid;void 0!==a.name&&(s.name=a.name);void 0!==a.mapping&&(s.mapping=r(a.mapping,zo));void 0!==a.offset&&s.offset.fromArray(a.offset);void 0!==a.repeat&&s.repeat.fromArray(a.repeat);void 0!==a.center&&s.center.fromArray(a.center);void 0!==a.rotation&&(s.rotation=a.rotation);void 0!==a.wrap&&(s.wrapS=r(a.wrap[0],$o),s.wrapT=r(a.wrap[1],$o));void 0!==a.format&&(s.format=a.format);void 0!==a.minFilter&&(s.minFilter=r(a.minFilter,Uo));void 0!==a.magFilter&&(s.magFilter=r(a.magFilter,Uo));void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy);void 0!==a.flipY&&(s.flipY=a.flipY);n[a.uuid]=s}return n},parseObject:function(e,t,o){function r(e){void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e);return t[e]}function n(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];void 0===o[i]&&console.warn("THREE.ObjectLoader: Undefined material",i);t.push(o[i])}return t}void 0===o[e]&&console.warn("THREE.ObjectLoader: Undefined material",e);return o[e]}}switch(e.type){case"Scene":var i=new Mt;void 0!==e.background&&Number.isInteger(e.background)&&(i.background=new x(e.background));void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new St(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new xt(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new gt(e.fov,e.aspect,e.near,e.far);void 0!==e.focus&&(i.focus=e.focus);void 0!==e.zoom&&(i.zoom=e.zoom);void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge);void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset);void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new f(e.left,e.right,e.top,e.bottom,e.near,e.far);void 0!==e.zoom&&(i.zoom=e.zoom);void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new Nn(e.color,e.intensity);break;case"DirectionalLight":i=new In(e.color,e.intensity);break;case"PointLight":i=new kn(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new Dn(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new Rn(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new Pn(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":i=r(e.geometry);var a=n(e.material);i=i.bones&&0<i.bones.length?new Rt(i,a):new z(i,a);break;case"LOD":i=new Pt;break;case"Line":i=new Lt(r(e.geometry),n(e.material),e.mode);break;case"LineLoop":i=new Nt(r(e.geometry),n(e.material));break;case"LineSegments":i=new It(r(e.geometry),n(e.material));break;case"PointCloud":case"Points":i=new Bt(r(e.geometry),n(e.material));break;case"Sprite":i=new Ot(n(e.material));break;case"Group":i=new mt;break;default:i=new h}i.uuid=e.uuid;void 0!==e.name&&(i.name=e.name);void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale));void 0!==e.castShadow&&(i.castShadow=e.castShadow);void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow);e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera)));void 0!==e.visible&&(i.visible=e.visible);void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled);void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder);void 0!==e.userData&&(i.userData=e.userData);void 0!==e.layers&&(i.layers.mask=e.layers);if(void 0!==e.children){a=e.children;for(var s=0;s<a.length;s++)i.add(this.parseObject(a[s],t,o))}if("LOD"===e.type)for(e=e.levels,a=0;a<e.length;a++){s=e[a];var u=i.getObjectByProperty("uuid",s.object);void 0!==u&&i.addLevel(u,s.distance)}return i}});var zo={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},$o={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},Uo={NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008};ii.prototype={constructor:ii,setOptions:function(e){this.options=e;return this},load:function(t,r,e,n){void 0===t&&(t="");void 0!==this.path&&(t=this.path+t);t=this.manager.resolveURL(t);var i=this,o=Po.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout(function(){r&&r(o);i.manager.itemEnd(t)},0),o;fetch(t).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,i.options)}).then(function(e){Po.add(t,e);r&&r(e);i.manager.itemEnd(t)}).catch(function(e){n&&n(e);i.manager.itemEnd(t);i.manager.itemError(t)})},setCrossOrigin:function(){return this},setPath:function(e){this.path=e;return this}};Object.assign(oi.prototype,{moveTo:function(e,t){this.currentPath=new En;this.subPaths.push(this.currentPath);this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,r,n){this.currentPath.quadraticCurveTo(e,t,r,n)},bezierCurveTo:function(e,t,r,n,i,o){this.currentPath.bezierCurveTo(e,t,r,n,i,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function r(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r],o=new Tn;o.curves=i.curves;t.push(o)}return t}function n(e,t){for(var r=t.length,n=!1,i=r-1,o=0;o<r;i=o++){var a=t[i],s=t[o],u=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(0>c&&(a=t[o],u=-u,s=t[i],c=-c),!(e.y<a.y||e.y>s.y))if(e.y===a.y){if(e.x===a.x)return!0}else{i=c*(e.x-a.x)-u*(e.y-a.y);if(0===i)return!0;0>i||(n=!n)}}else if(e.y===a.y&&(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x))return!0}return n}var i=Co.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return r(o);t=[];if(1===o.length){var a=o[0];var s=new Tn;s.curves=a.curves;t.push(s);return t}var u=!i(o[0].getPoints());u=e?!u:u;s=[];var c=[],h=[],l=0;c[l]=void 0;h[l]=[];for(var p=0,f=o.length;p<f;p++){a=o[p];var d=a.getPoints();var v=i(d);(v=e?!v:v)?(!u&&c[l]&&l++,c[l]={s:new Tn,p:d},c[l].s.curves=a.curves,u&&l++,h[l]=[]):h[l].push({h:a,p:d[0]})}if(!c[0])return r(o);if(1<c.length){p=!1;e=[];i=0;for(o=c.length;i<o;i++)s[i]=[];i=0;for(o=c.length;i<o;i++)for(a=h[i],v=0;v<a.length;v++){u=a[v];l=!0;for(d=0;d<c.length;d++)n(u.p,c[d].p)&&(i!==d&&e.push({froms:i,tos:d,hole:v}),l?(l=!1,s[d].push(u)):p=!0);l&&s[i].push(u)}0<e.length&&(p||(h=s))}p=0;for(i=c.length;p<i;p++)for(s=c[p].s,t.push(s),e=h[p],o=0,a=e.length;o<a;o++)s.holes.push(e[o].h);return t}});Object.assign(ai.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);var r=[],n=t;t=this.data;var i=Array.from?Array.from(e):String(e).split("");n/=t.resolution;var o=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*n;e=[];for(var a=0,s=0,u=0;u<i.length;u++){var c=i[u];if("\n"===c)a=0,s-=o;else{var h=n;var l=a,p=s;if(c=t.glyphs[c]||t.glyphs["?"]){var f=new oi;if(c.o)for(var d=c._cachedOutline||(c._cachedOutline=c.o.split(" ")),v=0,m=d.length;v<m;)switch(d[v++]){case"m":var g=d[v++]*h+l;var _=d[v++]*h+p;f.moveTo(g,_);break;case"l":g=d[v++]*h+l;_=d[v++]*h+p;f.lineTo(g,_);break;case"q":var y=d[v++]*h+l;var b=d[v++]*h+p;var w=d[v++]*h+l;var x=d[v++]*h+p;f.quadraticCurveTo(w,x,y,b);break;case"b":y=d[v++]*h+l,b=d[v++]*h+p,w=d[v++]*h+l,x=d[v++]*h+p,g=d[v++]*h+l,_=d[v++]*h+p,f.bezierCurveTo(w,x,g,_,y,b)}h={offsetX:c.ha*h,path:f}}else h=void 0;a+=h.offsetX;e.push(h.path)}}t=0;for(i=e.length;t<i;t++)Array.prototype.push.apply(r,e[t].toShapes());return r}});Object.assign(si.prototype,{load:function(e,n,t,r){var i=this,o=new nn(this.manager);o.setPath(this.path);o.load(e,function(t){try{var r=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(t.substring(65,t.length-2))}t=i.parse(r);n&&n(t)},t,r)},parse:function(e){return new ai(e)},setPath:function(e){this.path=e;return this}});var Go,Vo={getContext:function(){void 0===Go&&(Go=new(window.AudioContext||window.webkitAudioContext));return Go},setContext:function(e){Go=e}};Object.assign(ui.prototype,{load:function(e,t,r,n){var i=new nn(this.manager);i.setResponseType("arraybuffer");i.load(e,function(e){e=e.slice(0);Vo.getContext().decodeAudioData(e,function(e){t(e)})},r,n)}});Object.assign(ci.prototype,{update:function(){var a,s,u,c,h,l,p,f,d=new we,v=new we;return function(e){if(a!==this||s!==e.focus||u!==e.fov||c!==e.aspect*this.aspect||h!==e.near||l!==e.far||p!==e.zoom||f!==this.eyeSep){a=this;s=e.focus;u=e.fov;c=e.aspect*this.aspect;h=e.near;l=e.far;p=e.zoom;var t=e.projectionMatrix.clone();f=this.eyeSep/2;var r=f*h/s,n=h*Math.tan(eo.DEG2RAD*u*.5)/p;v.elements[12]=-f;d.elements[12]=f;var i=-n*c+r;var o=n*c+r;t.elements[0]=2*h/(o-i);t.elements[8]=(o+i)/(o-i);this.cameraL.projectionMatrix.copy(t);i=-n*c-r;o=n*c-r;t.elements[0]=2*h/(o-i);t.elements[8]=(o+i)/(o-i);this.cameraR.projectionMatrix.copy(t)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(v);this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(d)}}()});hi.prototype=Object.create(h.prototype);hi.prototype.constructor=hi;li.prototype=Object.assign(Object.create(h.prototype),{constructor:li,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null);return this},getFilter:function(){return this.filter},setFilter:function(e){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination);this.filter=e;this.gain.connect(this.filter);this.filter.connect(this.context.destination);return this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01);return this},updateMatrixWorld:function(){var r=new xe,n=new s,i=new xe,o=new xe;return function(e){h.prototype.updateMatrixWorld.call(this,e);e=this.context.listener;var t=this.up;this.matrixWorld.decompose(r,n,i);o.set(0,0,-1).applyQuaternion(n);e.positionX?(e.positionX.setValueAtTime(r.x,this.context.currentTime),e.positionY.setValueAtTime(r.y,this.context.currentTime),e.positionZ.setValueAtTime(r.z,this.context.currentTime),e.forwardX.setValueAtTime(o.x,this.context.currentTime),e.forwardY.setValueAtTime(o.y,this.context.currentTime),e.forwardZ.setValueAtTime(o.z,this.context.currentTime),e.upX.setValueAtTime(t.x,this.context.currentTime),e.upY.setValueAtTime(t.y,this.context.currentTime),e.upZ.setValueAtTime(t.z,this.context.currentTime)):(e.setPosition(r.x,r.y,r.z),e.setOrientation(o.x,o.y,o.z,t.x,t.y,t.z))}}()});pi.prototype=Object.assign(Object.create(h.prototype),{constructor:pi,getOutput:function(){return this.gain},setNodeSource:function(e){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=e;this.connect();return this},setMediaElementSource:function(e){this.hasPlaybackControl=!1;this.sourceType="mediaNode";this.source=this.context.createMediaElementSource(e);this.connect();return this},setBuffer:function(e){this.buffer=e;this.sourceType="buffer";this.autoplay&&this.play();return this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else{var e=this.context.createBufferSource();e.buffer=this.buffer;e.loop=this.loop;e.onended=this.onEnded.bind(this);e.playbackRate.setValueAtTime(this.playbackRate,this.startTime);this.startTime=this.context.currentTime;e.start(this.startTime,this.offset);this.isPlaying=!0;this.source=e;return this.connect()}},pause:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this},stop:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){e||(e=[]);!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e;return this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01);return this}});fi.prototype=Object.assign(Object.create(pi.prototype),{constructor:fi,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){this.panner.refDistance=e;return this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){this.panner.rolloffFactor=e;return this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){this.panner.distanceModel=e;return this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){this.panner.maxDistance=e;return this},setDirectionalCone:function(e,t,r){this.panner.coneInnerAngle=e;this.panner.coneOuterAngle=t;this.panner.coneOuterGain=r;return this},updateMatrixWorld:function(){var t=new xe,r=new s,n=new xe,i=new xe;return function(e){h.prototype.updateMatrixWorld.call(this,e);e=this.panner;this.matrixWorld.decompose(t,r,n);i.set(0,0,1).applyQuaternion(r);e.setPosition(t.x,t.y,t.z);e.setOrientation(i.x,i.y,i.z)}}()});Object.assign(di.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}});Object.assign(vi.prototype,{accumulate:function(e,t){var r=this.buffer,n=this.valueSize;e=e*n+n;var i=this.cumulativeWeight;if(0===i){for(i=0;i!==n;++i)r[e+i]=r[i];i=t}else i+=t,this._mixBufferRegion(r,e,0,t/i,n);this.cumulativeWeight=i},apply:function(e){var t=this.valueSize,r=this.buffer;e=e*t+t;var n=this.cumulativeWeight,i=this.binding;this.cumulativeWeight=0;1>n&&this._mixBufferRegion(r,e,3*t,1-n,t);n=t;for(var o=t+t;n!==o;++n)if(r[n]!==r[n+t]){i.setValue(r,e);break}},saveOriginalState:function(){var e=this.buffer,t=this.valueSize,r=3*t;this.binding.getValue(e,r);for(var n=t;n!==r;++n)e[n]=e[r+n%t];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(e,t,r,n,i){if(.5<=n)for(n=0;n!==i;++n)e[t+n]=e[r+n]},_slerp:function(e,t,r,n){s.slerpFlat(e,t,e,t,e,r,n)},_lerp:function(e,t,r,n,i){for(var o=1-n,a=0;a!==i;++a){var s=t+a;e[s]=e[s]*o+e[r+a]*n}}});Object.assign(mi.prototype,{getValue:function(e,t){this.bind();var r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}});Object.assign(gi,{Composite:mi,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new gi.Composite(e,t,r):new gi(e,t,r)},sanitizeNodeName:function(){var t=/[\[\]\.:\/]/g;return function(e){return e.replace(/\s/g,"_").replace(t,"")}}(),parseTrackName:function(){var e="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",t=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]");e=/(WCOD+)?/.source.replace("WCOD",e);var r=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),n=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),i=new RegExp("^"+t+e+r+n+"$"),o=["material","materials","bones"];return function(e){var t=i.exec(e);if(!t)throw Error("PropertyBinding: Cannot parse trackName: "+e);t={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]};var r=t.nodeName&&t.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var n=t.nodeName.substring(r+1);-1!==o.indexOf(n)&&(t.nodeName=t.nodeName.substring(0,r),t.objectName=n)}if(null===t.propertyName||0===t.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+e);return t}}(),findNode:function(e,n){if(!n||""===n||"root"===n||"."===n||-1===n||n===e.name||n===e.uuid)return e;if(e.skeleton){var t=e.skeleton.getBoneByName(n);if(void 0!==t)return t}if(e.children){var i=function(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.name===n||r.uuid===n||(r=i(r.children)))return r}return null};if(e=i(e.children))return e}return null}});Object.assign(gi.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)e[t++]=r[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t];this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++]},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t];this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t);this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t);this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind();this.getValue(e,t)},setValue:function(e,t){this.bind();this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,n=t.propertyName,i=t.propertyIndex;e||(this.node=e=gi.findNode(this.rootNode,t.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(e){if(r){var o=t.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(r=0;r<e.length;r++)if(e[r].name===o){o=r;break}break;default:if(void 0===e[r]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(void 0!==o){if(void 0===e[o]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[o]}}o=e[n];if(void 0===o)console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+n+" but it wasn't found.",e);else{t=this.Versioning.None;void 0!==e.needsUpdate?(t=this.Versioning.NeedsUpdate,this.targetObject=e):void 0!==e.matrixWorldNeedsUpdate&&(t=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e);r=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}for(r=0;r<this.node.geometry.morphAttributes.position.length;r++)if(e.geometry.morphAttributes.position[r].name===i){i=r;break}}else{if(!e.geometry.morphTargets){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);return}for(r=0;r<this.node.geometry.morphTargets.length;r++)if(e.geometry.morphTargets[r].name===i){i=r;break}}}r=this.BindingType.ArrayElement;this.resolvedProperty=o;this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(r=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(r=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[r];this.setValue=this.SetterByBindingTypeAndVersioning[r][t]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}});Object.assign(gi.prototype,{_getValue_unbound:gi.prototype.getValue,_setValue_unbound:gi.prototype.setValue});Object.assign(_i.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,u=void 0,c=0,h=arguments.length;c!==h;++c){var l=arguments[c],p=l.uuid,f=n[p];if(void 0===f){f=t++;n[p]=f;e.push(l);p=0;for(var d=s;p!==d;++p)a[p].push(new gi(l,i[p],o[p]))}else if(f<r){u=e[f];var v=--r;d=e[v];n[d.uuid]=f;e[f]=d;n[p]=v;e[v]=l;p=0;for(d=s;p!==d;++p){var m=a[p],g=m[f];m[f]=m[v];void 0===g&&(g=new gi(l,i[p],o[p]));m[v]=g}}else e[f]!==u&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],u=s.uuid,c=r[u];if(void 0!==c&&c>=t){var h=t++,l=e[h];r[l.uuid]=c;e[c]=l;r[u]=h;e[h]=s;s=0;for(u=i;s!==u;++s){l=n[s];var p=l[c];l[c]=l[h];l[h]=p}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var u=arguments[a].uuid,c=n[u];if(void 0!==c)if(delete n[u],c<r){u=--r;var h=e[u],l=--t,p=e[l];n[h.uuid]=c;e[c]=h;n[p.uuid]=u;e[u]=p;e.pop();h=0;for(p=o;h!==p;++h){var f=i[h],d=f[l];f[c]=f[u];f[u]=d;f.pop()}}else for(l=--t,p=e[l],n[p.uuid]=c,e[c]=p,e.pop(),h=0,p=o;h!==p;++h)f=i[h],f[c]=f[l],f.pop()}this.nCachedObjects_=r},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,n=r[e],i=this._bindings;if(void 0!==n)return i[n];var o=this._paths,a=this._parsedPaths,s=this._objects,u=this.nCachedObjects_,c=Array(s.length);n=i.length;r[e]=n;o.push(e);a.push(t);i.push(c);r=u;for(n=s.length;r!==n;++r)c[r]=new gi(s[r],e,t);return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){var n=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=r;o[r]=s;o.pop();i[r]=i[a];i.pop();n[r]=n[a];n.pop()}}});Object.assign(yi.prototype,{play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){this._startTime=e;return this},setLoop:function(e,t){this.loop=e;this.repetitions=t;return this},setEffectiveWeight:function(e){this.weight=e;this._effectiveWeight=this.enabled?e:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){e.fadeOut(t);this.fadeIn(t);if(r){r=this._clip.duration;var n=e._clip.duration,i=r/n;e.warp(1,n/r,t);this.warp(i,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e));return this},setEffectiveTimeScale:function(e){this.timeScale=e;this._effectiveTimeScale=this.paused?0:e;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){this.timeScale=this._clip.duration/e;return this.stopWarping()},syncWith:function(e){this.time=e.time;this.timeScale=e.timeScale;return this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var n=this._mixer,i=n.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(this._timeScaleInterpolant=o=n._lendControlInterpolant());n=o.parameterPositions;o=o.sampleValues;n[0]=i;n[1]=i+r;o[0]=e/a;o[1]=t/a;return this},stopWarping:function(){var e=this._timeScaleInterpolant;null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,n){if(this.enabled){var i=this._startTime;if(null!==i){t=(e-i)*r;if(0>t||0===r)return;this._startTime=null;t*=r}t*=this._updateTimeScale(e);r=this._updateTime(t);e=this._updateWeight(e);if(0<e){t=this._interpolants;i=this._propertyBindings;for(var o=0,a=t.length;o!==a;++o)t[o].evaluate(r),i[o].accumulate(n,e)}}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(e)[0];t*=n;e>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r){var n=r.evaluate(e)[0];t*=n;e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t},_updateTime:function(e){var t=this.time+e,r=this._clip.duration,n=this.loop,i=this._loopCount,o=2202===n;if(0===e)return-1===i?t:o&&1===(i&1)?r-t:t;if(2200===n)e:{if(-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1)),t>=r)t=r;else if(0>t)t=0;else break e;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>e?-1:1})}else{-1===i&&(0<=e?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o));if(t>=r||0>t){n=Math.floor(t/r);t-=r*n;i+=Math.abs(n);var a=this.repetitions-i;0>=a?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=0<e?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1})):(1===a?(e=0>e,this._setEndings(e,!e,o)):this._setEndings(!1,!1,o),this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n}))}if(o&&1===(i&1))return this.time=t,r-t}return this.time=t},_setEndings:function(e,t,r){var n=this._interpolantSettings;r?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,n.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(e,t,r){var n=this._mixer,i=n.time,o=this._weightInterpolant;null===o&&(this._weightInterpolant=o=n._lendControlInterpolant());n=o.parameterPositions;o=o.sampleValues;n[0]=i;o[0]=t;n[1]=i+e;o[1]=r;return this}});bi.prototype=Object.assign(Object.create(t.prototype),{constructor:bi,_bindAction:function(e,t){var r=e._localRoot||this._root,n=e._clip.tracks,i=n.length,o=e._propertyBindings;e=e._interpolants;var a=r.uuid,s=this._bindingsByRootAndName,u=s[a];void 0===u&&(u={},s[a]=u);for(s=0;s!==i;++s){var c=n[s],h=c.name,l=u[h];if(void 0===l){l=o[s];if(void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,a,h));continue}l=new vi(gi.create(r,h,t&&t._propertyBindings[s].binding.parsedPath),c.ValueTypeName,c.getValueSize());++l.referenceCount;this._addInactiveBinding(l,a,h)}o[s]=l;e[s].resultBuffer=l.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]);this._addInactiveAction(e,r,t)}t=e._propertyBindings;r=0;for(n=t.length;r!==n;++r){var i=t[r];0===i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,n=t.length;r!==n;++r){var i=t[r];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){e=e._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(e,t,r){var n=this._actions,i=this._actionsByClip,o=i[t];void 0===o?(o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o):(t=o.knownActions,e._byClipCacheIndex=t.length,t.push(e));e._cacheIndex=n.length;n.push(e);o.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],n=e._cacheIndex;r._cacheIndex=n;t[n]=r;t.pop();e._cacheIndex=null;t=e._clip.uuid;r=this._actionsByClip;n=r[t];var i=n.knownActions,o=i[i.length-1],a=e._byClipCacheIndex;o._byClipCacheIndex=a;i[a]=o;i.pop();e._byClipCacheIndex=null;delete n.actionByRoot[(e._localRoot||this._root).uuid];0===i.length&&delete r[t];this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){e=e._propertyBindings;for(var t=0,r=e.length;t!==r;++t){var n=e[t];0===--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,n=this._nActiveActions++,i=t[n];e._cacheIndex=n;t[n]=e;i._cacheIndex=r;t[r]=i},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,n=--this._nActiveActions,i=t[n];e._cacheIndex=n;t[n]=e;i._cacheIndex=r;t[r]=i},_addInactiveBinding:function(e,t,r){var n=this._bindingsByRootAndName,i=n[t],o=this._bindings;void 0===i&&(i={},n[t]=i);i[r]=e;e._cacheIndex=o.length;o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,n=r.rootNode.uuid;r=r.path;var i=this._bindingsByRootAndName,o=i[n],a=t[t.length-1];e=e._cacheIndex;a._cacheIndex=e;t[e]=a;t.pop();delete o[r];e:{for(var s in o)break e;delete i[n]}},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,i=t[n];e._cacheIndex=n;t[n]=e;i._cacheIndex=r;t[r]=i},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,i=t[n];e._cacheIndex=n;t[n]=e;i._cacheIndex=r;t[r]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];void 0===r&&(r=new zn(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),r.__cacheIndex=t,e[t]=r);return r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,i=t[n];e.__cacheIndex=n;t[n]=e;i.__cacheIndex=r;t[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,n=r.uuid;r="string"===typeof e?Kn.findByName(r,e):e;e=null!==r?r.uuid:e;var i=this._actionsByClip[e],o=null;if(void 0!==i){o=i.actionByRoot[n];if(void 0!==o)return o;o=i.knownActions[0];null===r&&(r=o._clip)}if(null===r)return null;t=new yi(this,r,t);this._bindAction(t,o);this._addInactiveAction(t,e,n);return t},existingAction:function(e,t){var r=t||this._root;t=r.uuid;r="string"===typeof e?Kn.findByName(r,e):e;e=this._actionsByClip[r?r.uuid:e];return void 0!==e?e.actionByRoot[t]||null:null},stopAllAction:function(){for(var e=this._actions,t=this._nActiveActions,r=this._bindings,n=this._nActiveBindings,i=this._nActiveBindings=this._nActiveActions=0;i!==t;++i)e[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,n=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1,a=0;a!==r;++a)t[a]._update(n,e,i,o);e=this._bindings;t=this._nActiveBindings;for(a=0;a!==t;++a)e[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions;e=e.uuid;var r=this._actionsByClip,n=r[e];if(void 0!==n){n=n.knownActions;for(var i=0,o=n.length;i!==o;++i){var a=n[i];this._deactivateAction(a);var s=a._cacheIndex,u=t[t.length-1];a._cacheIndex=null;a._byClipCacheIndex=null;u._cacheIndex=s;t[s]=u;t.pop();this._removeInactiveBindingsForAction(a)}delete r[e]}},uncacheRoot:function(e){e=e.uuid;var t=this._actionsByClip;for(n in t){var r=t[n].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var n=this._bindingsByRootAndName[e];if(void 0!==n)for(var i in n)e=n[i],e.restoreOriginalState(),this._removeInactiveBinding(e)},uncacheAction:function(e,t){e=this.existingAction(e,t);null!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}});wi.prototype.clone=function(){return new wi(void 0===this.value.clone?this.value:this.value.clone())};xi.prototype=Object.assign(Object.create(A.prototype),{constructor:xi,isInstancedBufferGeometry:!0,copy:function(e){A.prototype.copy.call(this,e);this.maxInstancedCount=e.maxInstancedCount;return this},clone:function(){return(new this.constructor).copy(this)}});Si.prototype=Object.assign(Object.create(Ct.prototype),{constructor:Si,isInstancedInterleavedBuffer:!0,copy:function(e){Ct.prototype.copy.call(this,e);this.meshPerAttribute=e.meshPerAttribute;return this}});Mi.prototype=Object.assign(Object.create(_.prototype),{constructor:Mi,isInstancedBufferAttribute:!0,copy:function(e){_.prototype.copy.call(this,e);this.meshPerAttribute=e.meshPerAttribute;return this}});Object.assign(Ci.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){r=r||[];Ti(e,this,r,t);r.sort(Ei);return r},intersectObjects:function(e,t,r){r=r||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var n=0,i=e.length;n<i;n++)Ti(e[n],this,r,t);r.sort(Ei);return r}});Object.assign(Oi.prototype,{start:function(){this.oldTime=this.startTime=("undefined"===typeof performance?Date:performance).now();this.elapsedTime=0;this.running=!0},stop:function(){this.getElapsedTime();this.autoStart=this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"===typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3;this.oldTime=t;this.elapsedTime+=e}return e}});Object.assign(Pi.prototype,{set:function(e,t,r){this.radius=e;this.phi=t;this.theta=r;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.radius=e.radius;this.phi=e.phi;this.theta=e.theta;return this},makeSafe:function(){this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi));return this},setFromVector3:function(e){this.radius=e.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(eo.clamp(e.y/this.radius,-1,1)));return this}});Object.assign(Ai.prototype,{set:function(e,t,r){this.radius=e;this.theta=t;this.y=r;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.radius=e.radius;this.theta=e.theta;this.y=e.y;return this},setFromVector3:function(e){this.radius=Math.sqrt(e.x*e.x+e.z*e.z);this.theta=Math.atan2(e.x,e.z);this.y=e.y;return this}});Object.assign(ji.prototype,{set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var r=new H;return function(e,t){t=r.copy(t).multiplyScalar(.5);this.min.copy(e).sub(t);this.max.copy(e).add(t);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new H);return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new H);return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new H);return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new H);return t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var t=new H;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});Object.assign(Ri.prototype,{set:function(e,t){this.start.copy(e);this.end.copy(t);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.start.copy(e.start);this.end.copy(e.end);return this},getCenter:function(e){void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new xe);return e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new xe);return e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new xe);return this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var r=new xe,n=new xe;return function(e,t){r.subVectors(e,this.start);n.subVectors(this.end,this.start);e=n.dot(n);e=n.dot(r)/e;t&&(e=eo.clamp(e,0,1));return e}}(),closestPointToPoint:function(e,t,r){e=this.closestPointToPointParameter(e,t);void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new xe);return this.delta(r).multiplyScalar(e).add(this.start)},applyMatrix4:function(e){this.start.applyMatrix4(e);this.end.applyMatrix4(e);return this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}});ki.prototype=Object.create(h.prototype);ki.prototype.constructor=ki;ki.prototype.isImmediateRenderObject=!0;Li.prototype=Object.create(It.prototype);Li.prototype.constructor=Li;Li.prototype.update=function(){var p=new xe,f=new xe,d=new m;return function(){var e=["a","b","c"];this.object.updateMatrixWorld(!0);d.getNormalMatrix(this.object.matrixWorld);var t=this.object.matrixWorld,r=this.geometry.attributes.position,n=this.object.geometry;if(n&&n.isGeometry)for(var i=n.vertices,o=n.faces,a=n=0,s=o.length;a<s;a++)for(var u=o[a],c=0,h=u.vertexNormals.length;c<h;c++){var l=u.vertexNormals[c];p.copy(i[u[e[c]]]).applyMatrix4(t);f.copy(l).applyMatrix3(d).normalize().multiplyScalar(this.size).add(p);r.setXYZ(n,p.x,p.y,p.z);n+=1;r.setXYZ(n,f.x,f.y,f.z);n+=1}else if(n&&n.isBufferGeometry)for(e=n.attributes.position,i=n.attributes.normal,c=n=0,h=e.count;c<h;c++)p.set(e.getX(c),e.getY(c),e.getZ(c)).applyMatrix4(t),f.set(i.getX(c),i.getY(c),i.getZ(c)),f.applyMatrix3(d).normalize().multiplyScalar(this.size).add(p),r.setXYZ(n,p.x,p.y,p.z),n+=1,r.setXYZ(n,f.x,f.y,f.z),n+=1;r.needsUpdate=!0}}();Ii.prototype=Object.create(h.prototype);Ii.prototype.constructor=Ii;Ii.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};Ii.prototype.update=function(){var r=new xe,n=new xe;return function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e);r.setFromMatrixPosition(this.light.matrixWorld);n.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(n.sub(r));void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}();Di.prototype=Object.create(It.prototype);Di.prototype.constructor=Di;Di.prototype.updateMatrixWorld=function(){var s=new xe,u=new we,c=new we;return function(e){var t=this.bones,r=this.geometry,n=r.getAttribute("position");c.getInverse(this.root.matrixWorld);for(var i=0,o=0;i<t.length;i++){var a=t[i];a.parent&&a.parent.isBone&&(u.multiplyMatrices(c,a.matrixWorld),s.setFromMatrixPosition(u),n.setXYZ(o,s.x,s.y,s.z),u.multiplyMatrices(c,a.parent.matrixWorld),s.setFromMatrixPosition(u),n.setXYZ(o+1,s.x,s.y,s.z),o+=2)}r.getAttribute("position").needsUpdate=!0;h.prototype.updateMatrixWorld.call(this,e)}}();Bi.prototype=Object.create(z.prototype);Bi.prototype.constructor=Bi;Bi.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};Bi.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};Fi.prototype=Object.create(h.prototype);Fi.prototype.constructor=Fi;Fi.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};Fi.prototype.update=function(){var e=.5*this.light.width,t=.5*this.light.height,r=this.line.geometry.attributes.position,n=r.array;n[0]=e;n[1]=-t;n[2]=0;n[3]=e;n[4]=t;n[5]=0;n[6]=-e;n[7]=t;n[8]=0;n[9]=-e;n[10]=-t;n[11]=0;n[12]=e;n[13]=-t;n[14]=0;r.needsUpdate=!0;void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)};zi.prototype=Object.create(h.prototype);zi.prototype.constructor=zi;zi.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};zi.prototype.update=function(){var o=new xe,a=new x,s=new x;return function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");a.copy(this.light.color);s.copy(this.light.groundColor);for(var r=0,n=t.count;r<n;r++){var i=r<n/2?a:s;t.setXYZ(r,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(o.setFromMatrixPosition(this.light.matrixWorld).negate())}}();$i.prototype=Object.create(It.prototype);$i.prototype.constructor=$i;Ui.prototype=Object.create(It.prototype);Ui.prototype.constructor=Ui;Gi.prototype=Object.create(It.prototype);Gi.prototype.constructor=Gi;Gi.prototype.update=function(){var c=new xe,h=new xe,l=new m;return function(){this.object.updateMatrixWorld(!0);l.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry,n=r.vertices;r=r.faces;for(var i=0,o=0,a=r.length;o<a;o++){var s=r[o],u=s.normal;c.copy(n[s.a]).add(n[s.b]).add(n[s.c]).divideScalar(3).applyMatrix4(e);h.copy(u).applyMatrix3(l).normalize().multiplyScalar(this.size).add(c);t.setXYZ(i,c.x,c.y,c.z);i+=1;t.setXYZ(i,h.x,h.y,h.z);i+=1}t.needsUpdate=!0}}();Vi.prototype=Object.create(h.prototype);Vi.prototype.constructor=Vi;Vi.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};Vi.prototype.update=function(){var e=new xe,t=new xe,r=new xe;return function(){e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);r.subVectors(t,e);this.lightPlane.lookAt(r);void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color));this.targetLine.lookAt(r);this.targetLine.scale.z=r.length()}}();Hi.prototype=Object.create(It.prototype);Hi.prototype.constructor=Hi;Hi.prototype.update=function(){function e(e,t,r,n){a.set(t,r,n).unproject(s);e=o[e];if(void 0!==e)for(t=i.getAttribute("position"),r=0,n=e.length;r<n;r++)t.setXYZ(e[r],a.x,a.y,a.z)}var i,o,a=new xe,s=new u;return function(){i=this.geometry;o=this.pointMap;s.projectionMatrix.copy(this.camera.projectionMatrix);e("c",0,0,-1);e("t",0,0,1);e("n1",-1,-1,-1);e("n2",1,-1,-1);e("n3",-1,1,-1);e("n4",1,1,-1);e("f1",-1,-1,1);e("f2",1,-1,1);e("f3",-1,1,1);e("f4",1,1,1);e("u1",.7,1.1,-1);e("u2",-.7,1.1,-1);e("u3",0,2,-1);e("cf1",-1,0,1);e("cf2",1,0,1);e("cf3",0,-1,1);e("cf4",0,1,1);e("cn1",-1,0,-1);e("cn2",1,0,-1);e("cn3",0,-1,-1);e("cn4",0,1,-1);i.getAttribute("position").needsUpdate=!0}}();qi.prototype=Object.create(It.prototype);qi.prototype.constructor=qi;qi.prototype.update=function(){var i=new r;return function(e){void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments.");void 0!==this.object&&i.setFromObject(this.object);if(!i.isEmpty()){e=i.min;var t=i.max,r=this.geometry.attributes.position,n=r.array;n[0]=t.x;n[1]=t.y;n[2]=t.z;n[3]=e.x;n[4]=t.y;n[5]=t.z;n[6]=e.x;n[7]=e.y;n[8]=t.z;n[9]=t.x;n[10]=e.y;n[11]=t.z;n[12]=t.x;n[13]=t.y;n[14]=e.z;n[15]=e.x;n[16]=t.y;n[17]=e.z;n[18]=e.x;n[19]=e.y;n[20]=e.z;n[21]=t.x;n[22]=e.y;n[23]=e.z;r.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();qi.prototype.setFromObject=function(e){this.object=e;this.update();return this};Wi.prototype=Object.create(It.prototype);Wi.prototype.constructor=Wi;Wi.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),h.prototype.updateMatrixWorld.call(this,e))};Xi.prototype=Object.create(Lt.prototype);Xi.prototype.constructor=Xi;Xi.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;1e-8>Math.abs(t)&&(t=1e-8);this.scale.set(.5*this.size,.5*this.size,t);this.children[0].material.side=0>t?1:0;this.lookAt(this.plane.normal);h.prototype.updateMatrixWorld.call(this,e)};var Ho,qo;Yi.prototype=Object.create(h.prototype);Yi.prototype.constructor=Yi;Yi.prototype.setDirection=function(){var t=new xe,r;return function(e){.99999<e.y?this.quaternion.set(0,0,0,1):-.99999>e.y?this.quaternion.set(1,0,0,0):(t.set(e.z,0,-e.x).normalize(),r=Math.acos(e.y),this.quaternion.setFromAxisAngle(t,r))}}();Yi.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e);void 0===r&&(r=.2*t);this.line.scale.set(1,Math.max(0,e-t),1);this.line.updateMatrix();this.cone.scale.set(r,t,r);this.cone.position.y=e;this.cone.updateMatrix()};Yi.prototype.setColor=function(e){this.line.material.color.copy(e);this.cone.material.color.copy(e)};Ki.prototype=Object.create(It.prototype);Ki.prototype.constructor=Ki;hn.create=function(e,t){console.log("THREE.Curve.create() has been deprecated");e.prototype=Object.create(hn.prototype);e.prototype.constructor=e;e.prototype.getPoint=t;return e};Object.assign(Cn.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");e=this.getPoints(e);return this.createGeometry(e)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");e=this.getSpacedPoints(e);return this.createGeometry(e)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new S,r=0,n=e.length;r<n;r++){var i=e[r];t.vertices.push(new xe(i.x,i.y,i.z||0))}return t}});Object.assign(En.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints().");this.setFromPoints(e)}});Zi.prototype=Object.create(dn.prototype);Ji.prototype=Object.create(dn.prototype);Qi.prototype=Object.create(dn.prototype);Object.assign(Qi.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});$i.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Di.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Object.assign(ti.prototype,{extractUrlBase:function(e){console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.");return Fo.extractUrlBase(e)}});Object.assign(ji.prototype,{center:function(e){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(e)},empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(e){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(e)},size:function(e){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(e)}});Object.assign(r.prototype,{center:function(e){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(e)},empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(e){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(e)},isIntersectionSphere:function(e){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(e)},size:function(e){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(e)}});Ri.prototype.center=function(e){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");return this.getCenter(e)};Object.assign(eo,{random16:function(){console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead.");return Math.random()},nearestPowerOfTwo:function(e){console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo().");return eo.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo().");return eo.ceilPowerOfTwo(e)}});Object.assign(m.prototype,{flattenToArrayOffset:function(e,t){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(e,t)},multiplyVector3:function(e){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});Object.assign(we.prototype,{extractPosition:function(e){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(e)},flattenToArrayOffset:function(e,t){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(e,t)},getPosition:function(){var e;return function(){void 0===e&&(e=new xe);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},multiplyVector4:function(e){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");e.transformDirection(this)},crossVector:function(e){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,n,i,o){console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.");return this.makePerspective(e,t,n,r,i,o)}});g.prototype.isIntersectionLine=function(e){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(e)};s.prototype.multiplyVector3=function(e){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return e.applyQuaternion(this)};Object.assign(B.prototype,{isIntersectionBox:function(e){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(e)},isIntersectionPlane:function(e){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(e)},isIntersectionSphere:function(e){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(e)}});Object.assign(F.prototype,{area:function(){console.warn("THREE.Triangle: .area() has been renamed to .getArea().");return this.getArea()},barycoordFromPoint:function(e,t){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return this.getBarycoord(e,t)},midpoint:function(e){console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint().");return this.getMidpoint(e)},normal:function(e){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return this.getNormal(e)},plane:function(e){console.warn("THREE.Triangle: .plane() has been renamed to .getPlane().");return this.getPlane(e)}});Object.assign(F,{barycoordFromPoint:function(e,t,r,n,i){console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().");return F.getBarycoord(e,t,r,n,i)},normal:function(e,t,r,n){console.warn("THREE.Triangle: .normal() has been renamed to .getNormal().");return F.getNormal(e,t,r,n)}});Object.assign(Tn.prototype,{extractAllPoints:function(e){console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.");return this.extractPoints(e)},extrude:function(e){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new Er(this,e)},makeGeometry:function(e){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new Dr(this,e)}});Object.assign(H.prototype,{fromAttribute:function(e,t,r){console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(e)},lengthManhattan:function(){console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(xe.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(t,e)},applyProjection:function(e){console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.");return this.applyMatrix4(e)},fromAttribute:function(e,t,r){console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(e)},lengthManhattan:function(){console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(Se.prototype,{fromAttribute:function(e,t,r){console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(S.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}});Object.assign(h.prototype,{getChildByName:function(e){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}});Object.defineProperties(h.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.defineProperties(Pt.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});Object.defineProperty(At.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});Object.defineProperty(hn.prototype,"__arcLengthDivisions",{get:function(){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");return this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");this.arcLengthDivisions=e}});gt.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==t&&(this.filmGauge=t);this.setFocalLength(e)};Object.defineProperties(On.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=e}}});Object.defineProperties(_.prototype,{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");return this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}});Object.assign(A.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(e)},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});Object.defineProperties(A.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});Object.assign(Tr.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}});Object.defineProperties(wi.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this}}});Object.defineProperties(L.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){console.warn("THREE.Material: .wrapRGB has been removed.");return new x}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=1===e}}});Object.defineProperties(Zr.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(N.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=e}}});Object.assign(wt.prototype,{animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop().");this.setAnimationLoop(e)},getCurrentRenderTarget:function(){console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().");return this.getRenderTarget()},getMaxAnisotropy:function(){console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().");return this.capabilities.getMaxAnisotropy()},getPrecision:function(){console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.");return this.capabilities.precision},resetGLState:function(){console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset().");return this.state.reset()},supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}});Object.defineProperties(wt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(pt.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(T.prototype,{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=e}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=e}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=e}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=e}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=e}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=e}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=e}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=e}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=e}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=e}}});Object.defineProperties(yt.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}}});pi.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;(new ui).load(e,function(e){t.setBuffer(e)});return this};di.prototype.getData=function(){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()};hi.prototype.updateCubeMap=function(e,t){console.warn("THREE.CubeCamera: .updateCubeMap() is now .update().");return this.update(e,t)};to.crossOrigin=void 0;to.loadTexture=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new cn;i.setCrossOrigin(this.crossOrigin);e=i.load(e,r,void 0,n);t&&(e.mapping=t);return e};to.loadTextureCube=function(e,t,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new un;i.setCrossOrigin(this.crossOrigin);e=i.load(e,r,void 0,n);t&&(e.mapping=t);return e};to.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};to.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};e.WebGLRenderTargetCube=n;e.WebGLRenderTarget=T;e.WebGLRenderer=wt;e.ShaderLib=so;e.UniformsLib=ao;e.UniformsUtils=io;e.ShaderChunk=no;e.FogExp2=xt;e.Fog=St;e.Scene=Mt;e.Sprite=Ot;e.LOD=Pt;e.SkinnedMesh=Rt;e.Skeleton=At;e.Bone=jt;e.Mesh=z;e.LineSegments=It;e.LineLoop=Nt;e.Line=Lt;e.Points=Bt;e.Group=mt;e.VideoTexture=Ft;e.DataTexture=Me;e.CompressedTexture=zt;e.CubeTexture=U;e.CanvasTexture=$t;e.DepthTexture=Ut;e.Texture=p;e.CompressedTextureLoader=on;e.DataTextureLoader=an;e.CubeTextureLoader=un;e.TextureLoader=cn;e.ObjectLoader=ni;e.MaterialLoader=Qn;e.BufferGeometryLoader=ei;e.DefaultLoadingManager=Ao;e.LoadingManager=rn;e.JSONLoader=ri;e.ImageLoader=sn;e.ImageBitmapLoader=ii;e.FontLoader=si;e.FileLoader=nn;e.Loader=ti;e.LoaderUtils=Fo;e.Cache=Po;e.AudioLoader=ui;e.SpotLightShadow=jn;e.SpotLight=Rn;e.PointLight=kn;e.RectAreaLight=Dn;e.HemisphereLight=Pn;e.DirectionalLightShadow=Ln;e.DirectionalLight=In;e.AmbientLight=Nn;e.LightShadow=An;e.Light=On;e.StereoCamera=ci;e.PerspectiveCamera=gt;e.OrthographicCamera=f;e.CubeCamera=hi;e.ArrayCamera=_t;e.Camera=u;e.AudioListener=li;e.PositionalAudio=fi;e.AudioContext=Vo;e.AudioAnalyser=di;e.Audio=pi;e.VectorKeyframeTrack=Yn;e.StringKeyframeTrack=Xn;e.QuaternionKeyframeTrack=Wn;e.NumberKeyframeTrack=Hn;e.ColorKeyframeTrack=Vn;e.BooleanKeyframeTrack=Gn;e.PropertyMixer=vi;e.PropertyBinding=gi;e.KeyframeTrack=Un;e.AnimationUtils=Do;e.AnimationObjectGroup=_i;e.AnimationMixer=bi;e.AnimationClip=Kn;e.Uniform=wi;e.InstancedBufferGeometry=xi;e.BufferGeometry=A;e.Geometry=S;e.InterleavedBufferAttribute=Et;e.InstancedInterleavedBuffer=Si;e.InterleavedBuffer=Ct;e.InstancedBufferAttribute=Mi;e.Face3=D;e.Object3D=h;e.Raycaster=Ci;e.Layers=o;e.EventDispatcher=t;e.Clock=Oi;e.QuaternionLinearInterpolant=qn;e.LinearInterpolant=zn;e.DiscreteInterpolant=$n;e.CubicInterpolant=Fn;e.Interpolant=Bn;e.Triangle=F;e.Math=eo;e.Spherical=Pi;e.Cylindrical=Ai;e.Plane=g;e.Frustum=Ce;e.Sphere=c;e.Ray=B;e.Matrix4=we;e.Matrix3=m;e.Box3=r;e.Box2=ji;e.Line3=Ri;e.Euler=i;e.Vector4=Se;e.Vector3=xe;e.Vector2=H;e.Quaternion=s;e.Color=x;e.ImmediateRenderObject=ki;e.VertexNormalsHelper=Li;e.SpotLightHelper=Ii;e.SkeletonHelper=Di;e.PointLightHelper=Bi;e.RectAreaLightHelper=Fi;e.HemisphereLightHelper=zi;e.GridHelper=$i;e.PolarGridHelper=Ui;e.FaceNormalsHelper=Gi;e.DirectionalLightHelper=Vi;e.CameraHelper=Hi;e.BoxHelper=qi;e.Box3Helper=Wi;e.PlaneHelper=Xi;e.ArrowHelper=Yi;e.AxesHelper=Ki;e.Shape=Tn;e.Path=En;e.ShapePath=oi;e.Font=ai;e.CurvePath=Cn;e.Curve=hn;e.ImageUtils=to;e.ShapeUtils=Co;e.WebGLUtils=vt;e.WireframeGeometry=Gt;e.ParametricGeometry=Vt;e.ParametricBufferGeometry=Ht;e.TetrahedronGeometry=Xt;e.TetrahedronBufferGeometry=Yt;e.OctahedronGeometry=Kt;e.OctahedronBufferGeometry=Zt;e.IcosahedronGeometry=Jt;e.IcosahedronBufferGeometry=Qt;e.DodecahedronGeometry=er;e.DodecahedronBufferGeometry=tr;e.PolyhedronGeometry=qt;e.PolyhedronBufferGeometry=Wt;e.TubeGeometry=rr;e.TubeBufferGeometry=nr;e.TorusKnotGeometry=ir;e.TorusKnotBufferGeometry=or;e.TorusGeometry=ar;e.TorusBufferGeometry=sr;e.TextGeometry=Pr;e.TextBufferGeometry=Ar;e.SphereGeometry=jr;e.SphereBufferGeometry=Rr;e.RingGeometry=kr;e.RingBufferGeometry=Lr;e.PlaneGeometry=R;e.PlaneBufferGeometry=k;e.LatheGeometry=Ir;e.LatheBufferGeometry=Nr;e.ShapeGeometry=Dr;e.ShapeBufferGeometry=Br;e.ExtrudeGeometry=Er;e.ExtrudeBufferGeometry=Tr;e.EdgesGeometry=zr;e.ConeGeometry=Gr;e.ConeBufferGeometry=Vr;e.CylinderGeometry=$r;e.CylinderBufferGeometry=Ur;e.CircleGeometry=Hr;e.CircleBufferGeometry=qr;e.BoxGeometry=O;e.BoxBufferGeometry=j;e.ShadowMaterial=Wr;e.SpriteMaterial=Tt;e.RawShaderMaterial=Xr;e.ShaderMaterial=N;e.PointsMaterial=Dt;e.MeshPhysicalMaterial=Kr;e.MeshStandardMaterial=Yr;e.MeshPhongMaterial=Zr;e.MeshToonMaterial=Jr;e.MeshNormalMaterial=Qr;e.MeshLambertMaterial=en;e.MeshDepthMaterial=ht;e.MeshDistanceMaterial=lt;e.MeshBasicMaterial=I;e.LineDashedMaterial=tn;e.LineBasicMaterial=kt;e.Material=L;e.Float64BufferAttribute=M;e.Float32BufferAttribute=P;e.Uint32BufferAttribute=w;e.Int32BufferAttribute=b;e.Uint16BufferAttribute=y;e.Int16BufferAttribute=v;e.Uint8ClampedBufferAttribute=d;e.Uint8BufferAttribute=l;e.Int8BufferAttribute=a;e.BufferAttribute=_;e.ArcCurve=pn;e.CatmullRomCurve3=dn;e.CubicBezierCurve=_n;e.CubicBezierCurve3=yn;e.EllipseCurve=ln;e.LineCurve=bn;e.LineCurve3=wn;e.QuadraticBezierCurve=xn;e.QuadraticBezierCurve3=Sn;e.SplineCurve=Mn;e.REVISION="95";e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};e.CullFaceNone=0;e.CullFaceBack=1;e.CullFaceFront=2;e.CullFaceFrontBack=3;e.FrontFaceDirectionCW=0;e.FrontFaceDirectionCCW=1;e.BasicShadowMap=0;e.PCFShadowMap=1;e.PCFSoftShadowMap=2;e.FrontSide=0;e.BackSide=1;e.DoubleSide=2;e.FlatShading=1;e.SmoothShading=2;e.NoColors=0;e.FaceColors=1;e.VertexColors=2;e.NoBlending=0;e.NormalBlending=1;e.AdditiveBlending=2;e.SubtractiveBlending=3;e.MultiplyBlending=4;e.CustomBlending=5;e.AddEquation=100;e.SubtractEquation=101;e.ReverseSubtractEquation=102;e.MinEquation=103;e.MaxEquation=104;e.ZeroFactor=200;e.OneFactor=201;e.SrcColorFactor=202;e.OneMinusSrcColorFactor=203;e.SrcAlphaFactor=204;e.OneMinusSrcAlphaFactor=205;e.DstAlphaFactor=206;e.OneMinusDstAlphaFactor=207;e.DstColorFactor=208;e.OneMinusDstColorFactor=209;e.SrcAlphaSaturateFactor=210;e.NeverDepth=0;e.AlwaysDepth=1;e.LessDepth=2;e.LessEqualDepth=3;e.EqualDepth=4;e.GreaterEqualDepth=5;e.GreaterDepth=6;e.NotEqualDepth=7;e.MultiplyOperation=0;e.MixOperation=1;e.AddOperation=2;e.NoToneMapping=0;e.LinearToneMapping=1;e.ReinhardToneMapping=2;e.Uncharted2ToneMapping=3;e.CineonToneMapping=4;e.UVMapping=300;e.CubeReflectionMapping=301;e.CubeRefractionMapping=302;e.EquirectangularReflectionMapping=303;e.EquirectangularRefractionMapping=304;e.SphericalReflectionMapping=305;e.CubeUVReflectionMapping=306;e.CubeUVRefractionMapping=307;e.RepeatWrapping=1e3;e.ClampToEdgeWrapping=1001;e.MirroredRepeatWrapping=1002;e.NearestFilter=1003;e.NearestMipMapNearestFilter=1004;e.NearestMipMapLinearFilter=1005;e.LinearFilter=1006;e.LinearMipMapNearestFilter=1007;e.LinearMipMapLinearFilter=1008;e.UnsignedByteType=1009;e.ByteType=1010;e.ShortType=1011;e.UnsignedShortType=1012;e.IntType=1013;e.UnsignedIntType=1014;e.FloatType=1015;e.HalfFloatType=1016;e.UnsignedShort4444Type=1017;e.UnsignedShort5551Type=1018;e.UnsignedShort565Type=1019;e.UnsignedInt248Type=1020;e.AlphaFormat=1021;e.RGBFormat=1022;e.RGBAFormat=1023;e.LuminanceFormat=1024;e.LuminanceAlphaFormat=1025;e.RGBEFormat=1023;e.DepthFormat=1026;e.DepthStencilFormat=1027;e.RGB_S3TC_DXT1_Format=33776;e.RGBA_S3TC_DXT1_Format=33777;e.RGBA_S3TC_DXT3_Format=33778;e.RGBA_S3TC_DXT5_Format=33779;e.RGB_PVRTC_4BPPV1_Format=35840;e.RGB_PVRTC_2BPPV1_Format=35841;e.RGBA_PVRTC_4BPPV1_Format=35842;e.RGBA_PVRTC_2BPPV1_Format=35843;e.RGB_ETC1_Format=36196;e.RGBA_ASTC_4x4_Format=37808;e.RGBA_ASTC_5x4_Format=37809;e.RGBA_ASTC_5x5_Format=37810;e.RGBA_ASTC_6x5_Format=37811;e.RGBA_ASTC_6x6_Format=37812;e.RGBA_ASTC_8x5_Format=37813;e.RGBA_ASTC_8x6_Format=37814;e.RGBA_ASTC_8x8_Format=37815;e.RGBA_ASTC_10x5_Format=37816;e.RGBA_ASTC_10x6_Format=37817;e.RGBA_ASTC_10x8_Format=37818;e.RGBA_ASTC_10x10_Format=37819;e.RGBA_ASTC_12x10_Format=37820;e.RGBA_ASTC_12x12_Format=37821;e.LoopOnce=2200;e.LoopRepeat=2201;e.LoopPingPong=2202;e.InterpolateDiscrete=2300;e.InterpolateLinear=2301;e.InterpolateSmooth=2302;e.ZeroCurvatureEnding=2400;e.ZeroSlopeEnding=2401;e.WrapAroundEnding=2402;e.TrianglesDrawMode=0;e.TriangleStripDrawMode=1;e.TriangleFanDrawMode=2;e.LinearEncoding=3e3;e.sRGBEncoding=3001;e.GammaEncoding=3007;e.RGBEEncoding=3002;e.LogLuvEncoding=3003;e.RGBM7Encoding=3004;e.RGBM16Encoding=3005;e.RGBDEncoding=3006;e.BasicDepthPacking=3200;e.RGBADepthPacking=3201;e.TangentSpaceNormalMap=0;e.ObjectSpaceNormalMap=1;e.CubeGeometry=O;e.Face4=function(e,t,r,n,i,o,a){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new D(e,t,r,i,o,a)};e.LineStrip=0;e.LinePieces=1;e.MeshFaceMaterial=function(e){console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead.");return e};e.MultiMaterial=function(e){void 0===e&&(e=[]);console.warn("THREE.MultiMaterial has been removed. Use an Array instead.");e.isMultiMaterial=!0;e.materials=e;e.clone=function(){return e.slice()};return e};e.PointCloud=function(e,t){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new Bt(e,t)};e.Particle=function(e){console.warn("THREE.Particle has been renamed to THREE.Sprite.");return new Ot(e)};e.ParticleSystem=function(e,t){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new Bt(e,t)};e.PointCloudMaterial=function(e){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new Dt(e)};e.ParticleBasicMaterial=function(e){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new Dt(e)};e.ParticleSystemMaterial=function(e){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new Dt(e)};e.Vertex=function(e,t,r){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new xe(e,t,r)};e.DynamicBufferAttribute=function(e,t){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return new _(e,t).setDynamic(!0)};e.Int8Attribute=function(e,t){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.");return new a(e,t)};e.Uint8Attribute=function(e,t){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.");return new l(e,t)};e.Uint8ClampedAttribute=function(e,t){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.");return new d(e,t)};e.Int16Attribute=function(e,t){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.");return new v(e,t)};e.Uint16Attribute=function(e,t){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.");return new y(e,t)};e.Int32Attribute=function(e,t){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.");return new b(e,t)};e.Uint32Attribute=function(e,t){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.");return new w(e,t)};e.Float32Attribute=function(e,t){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.");return new P(e,t)};e.Float64Attribute=function(e,t){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.");return new M(e,t)};e.ClosedSplineCurve3=Zi;e.SplineCurve3=Ji;e.Spline=Qi;e.AxisHelper=function(e){console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper.");return new Ki(e)};e.BoundingBoxHelper=function(e,t){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.");return new qi(e,t)};e.EdgesHelper=function(e,t){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new It(new zr(e.geometry),new kt({color:void 0!==t?t:16777215}))};e.WireframeHelper=function(e,t){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new It(new Gt(e.geometry),new kt({color:void 0!==t?t:16777215}))};e.XHRLoader=function(e){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader.");return new nn(e)};e.BinaryTextureLoader=function(e){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.");return new an(e)};e.GeometryUtils={merge:function(e,t,r){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");if(t.isMesh){t.matrixAutoUpdate&&t.updateMatrix();var n=t.matrix;t=t.geometry}e.merge(t,n,r)},center:function(e){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return e.center()}};e.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project().");e.project(t)};this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");e.unproject(t)};this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};e.SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")};Object.defineProperty(e,"__esModule",{value:!0})})},{}],243:[function(e,t,r){"use strict";t.exports=n;function n(e,t){if(!(this instanceof n))return new n(e,t);this.data=e||[];this.length=this.data.length;this.compare=t||i;if(this.length>0){for(var r=this.length>>1;r>=0;r--)this._down(r)}}function i(e,t){return e<t?-1:e>t?1:0}n.prototype={push:function(e){this.data.push(e);this.length++;this._up(this.length-1)},pop:function(){if(this.length===0)return undefined;var e=this.data[0];this.length--;if(this.length>0){this.data[0]=this.data[this.length];this._down(0)}this.data.pop();return e},peek:function(){return this.data[0]},_up:function(e){var t=this.data;var r=this.compare;var n=t[e];while(e>0){var i=e-1>>1;var o=t[i];if(r(n,o)>=0)break;t[e]=o;e=i}t[e]=n},_down:function(e){var t=this.data;var r=this.compare;var n=this.length;var i=n>>1;var o=t[e];while(e<i){var a=(e<<1)+1;var s=a+1;var u=t[a];if(s<n&&r(t[s],u)<0){a=s;u=t[s]}if(r(u,o)>=0)break;t[e]=u;e=a}t[e]=o}}},{}],244:[function(e,t,r){var n=e("./vdom/create-element.js");t.exports=n},{"./vdom/create-element.js":250}],245:[function(e,t,r){var n=e("./vtree/diff.js");t.exports=n},{"./vtree/diff.js":270}],246:[function(e,t,r){var n=e("./virtual-hyperscript/index.js");t.exports=n},{"./virtual-hyperscript/index.js":257}],247:[function(e,t,r){var n=e("./diff.js");var i=e("./patch.js");var o=e("./h.js");var a=e("./create-element.js");var s=e("./vnode/vnode.js");var u=e("./vnode/vtext.js");t.exports={diff:n,patch:i,h:o,create:a,VNode:s,VText:u}},{"./create-element.js":244,"./diff.js":245,"./h.js":246,"./patch.js":248,"./vnode/vnode.js":266,"./vnode/vtext.js":268}],248:[function(e,t,r){var n=e("./vdom/patch.js");t.exports=n},{"./vdom/patch.js":253}],249:[function(e,t,r){var l=e("is-object");var s=e("../vnode/is-vhook.js");t.exports=n;function n(e,t,r){for(var n in t){var i=t[n];if(i===undefined){o(e,n,i,r)}else if(s(i)){o(e,n,i,r);if(i.hook){i.hook(e,n,r?r[n]:undefined)}}else{if(l(i)){a(e,t,r,n,i)}else{e[n]=i}}}}function o(e,t,r,n){if(n){var i=n[t];if(!s(i)){if(t==="attributes"){for(var o in i){e.removeAttribute(o)}}else if(t==="style"){for(var a in i){e.style[a]=""}}else if(typeof i==="string"){e[t]=""}else{e[t]=null}}else if(i.unhook){i.unhook(e,t,r)}}}function a(e,t,r,n,i){var o=r?r[n]:undefined;if(n==="attributes"){for(var a in i){var s=i[a];if(s===undefined){e.removeAttribute(a)}else{e.setAttribute(a,s)}}return}if(o&&l(o)&&p(o)!==p(i)){e[n]=i;return}if(!l(e[n])){e[n]={}}var u=n==="style"?"":undefined;for(var c in i){var h=i[c];e[n][c]=h===undefined?u:h}}function p(e){if(Object.getPrototypeOf){return Object.getPrototypeOf(e)}else if(e.__proto__){return e.__proto__}else if(e.constructor){return e.constructor.prototype}}},{"../vnode/is-vhook.js":261,"is-object":20}],250:[function(e,t,r){var c=e("global/document");var h=e("./apply-properties");var l=e("../vnode/is-vnode.js");var p=e("../vnode/is-vtext.js");var f=e("../vnode/is-widget.js");var d=e("../vnode/handle-thunk.js");t.exports=v;function v(e,t){var r=t?t.document||c:c;var n=t?t.warn:null;e=d(e).a;if(f(e)){return e.init()}else if(p(e)){return r.createTextNode(e.text)}else if(!l(e)){if(n){n("Item is not a valid virtual dom node",e)}return null}var i=e.namespace===null?r.createElement(e.tagName):r.createElementNS(e.namespace,e.tagName);var o=e.properties;h(i,o);var a=e.children;for(var s=0;s<a.length;s++){var u=v(a[s],t);if(u){i.appendChild(u)}}return i}},{"../vnode/handle-thunk.js":259,"../vnode/is-vnode.js":262,"../vnode/is-vtext.js":263,"../vnode/is-widget.js":264,"./apply-properties":249,"global/document":16}],251:[function(e,t,r){var h={};t.exports=n;function n(e,t,r,n){if(!r||r.length===0){return{}}else{r.sort(i);return l(e,t,r,n,0)}}function l(e,t,r,n,i){n=n||{};if(e){if(p(r,i,i)){n[i]=e}var o=t.children;if(o){var a=e.childNodes;for(var s=0;s<t.children.length;s++){i+=1;var u=o[s]||h;var c=i+(u.count||0);if(p(r,i,c)){l(a[s],u,r,n,i)}i=c}}}return n}function p(e,t,r){if(e.length===0){return false}var n=0;var i=e.length-1;var o;var a;while(n<=i){o=(i+n)/2>>0;a=e[o];if(n===i){return a>=t&&a<=r}else if(a<t){n=o+1}else if(a>r){i=o-1}else{return true}}return false}function i(e,t){return e>t?1:-1}},{}],252:[function(e,t,r){var a=e("./apply-properties");var n=e("../vnode/is-widget.js");var s=e("../vnode/vpatch.js");var u=e("./update-widget");t.exports=i;function i(e,t,r){var n=e.type;var i=e.vNode;var o=e.patch;switch(n){case s.REMOVE:return c(t,i);case s.INSERT:return h(t,o,r);case s.VTEXT:return l(t,i,o,r);case s.WIDGET:return p(t,i,o,r);case s.VNODE:return f(t,i,o,r);case s.ORDER:v(t,o);return t;case s.PROPS:a(t,o,i.properties);return t;case s.THUNK:return m(t,r.patch(t,o,r));default:return t}}function c(e,t){var r=e.parentNode;if(r){r.removeChild(e)}d(e,t);return null}function h(e,t,r){var n=r.render(t,r);if(e){e.appendChild(n)}return e}function l(e,t,r,n){var i;if(e.nodeType===3){e.replaceData(0,e.length,r.text);i=e}else{var o=e.parentNode;i=n.render(r,n);if(o&&i!==e){o.replaceChild(i,e)}}return i}function p(e,t,r,n){var i=u(t,r);var o;if(i){o=r.update(t,e)||e}else{o=n.render(r,n)}var a=e.parentNode;if(a&&o!==e){a.replaceChild(o,e)}if(!i){d(e,t)}return o}function f(e,t,r,n){var i=e.parentNode;var o=n.render(r,n);if(i&&o!==e){i.replaceChild(o,e)}return o}function d(e,t){if(typeof t.destroy==="function"&&n(t)){t.destroy(e)}}function v(e,t){var r=e.childNodes;var n={};var i;var o;var a;for(var s=0;s<t.removes.length;s++){o=t.removes[s];i=r[o.from];if(o.key){n[o.key]=i}e.removeChild(i)}var u=r.length;for(var c=0;c<t.inserts.length;c++){a=t.inserts[c];i=n[a.key];e.insertBefore(i,a.to>=u++?null:r[a.to])}}function m(e,t){if(e&&t&&e!==t&&e.parentNode){e.parentNode.replaceChild(t,e)}return t}},{"../vnode/is-widget.js":264,"../vnode/vpatch.js":267,"./apply-properties":249,"./update-widget":254}],253:[function(e,t,r){var u=e("global/document");var a=e("x-is-array");var n=e("./create-element");var c=e("./dom-index");var s=e("./patch-op");t.exports=i;function i(e,t,r){r=r||{};r.patch=r.patch&&r.patch!==i?r.patch:o;r.render=r.render||n;return r.patch(e,t,r)}function o(e,t,r){var n=l(t);if(n.length===0){return e}var i=c(e,t.a,n);var o=e.ownerDocument;if(!r.document&&o!==u){r.document=o}for(var a=0;a<n.length;a++){var s=n[a];e=h(e,i[s],t[s],r)}return e}function h(e,t,r,n){if(!t){return e}var i;if(a(r)){for(var o=0;o<r.length;o++){i=s(r[o],t,n);if(t===e){e=i}}}else{i=s(r,t,n);if(t===e){e=i}}return e}function l(e){var t=[];for(var r in e){if(r!=="a"){t.push(Number(r))}}return t}},{"./create-element":250,"./dom-index":251,"./patch-op":252,"global/document":16,"x-is-array":289}],254:[function(e,t,r){var n=e("../vnode/is-widget.js");t.exports=i;function i(e,t){if(n(e)&&n(t)){if("name"in e&&"name"in t){return e.id===t.id}else{return e.init===t.init}}return false}},{"../vnode/is-widget.js":264}],255:[function(e,t,r){"use strict";var i=e("ev-store");t.exports=n;function n(e){if(!(this instanceof n)){return new n(e)}this.value=e}n.prototype.hook=function(e,t){var r=i(e);var n=t.substr(3);r[n]=this.value};n.prototype.unhook=function(e,t){var r=i(e);var n=t.substr(3);r[n]=undefined}},{"ev-store":9}],256:[function(e,t,r){"use strict";t.exports=n;function n(e){if(!(this instanceof n)){return new n(e)}this.value=e}n.prototype.hook=function(e,t){if(e[t]!==this.value){e[t]=this.value}}},{}],257:[function(e,t,r){"use strict";var o=e("x-is-array");var u=e("../vnode/vnode.js");var a=e("../vnode/vtext.js");var n=e("../vnode/is-vnode");var i=e("../vnode/is-vtext");var s=e("../vnode/is-widget");var c=e("../vnode/is-vhook");var h=e("../vnode/is-thunk");var l=e("./parse-tag.js");var p=e("./hooks/soft-set-hook.js");var f=e("./hooks/ev-hook.js");t.exports=d;function d(e,t,r){var n=[];var i,o,a,s;if(!r&&_(t)){r=t;o={}}o=o||t||{};i=l(e,o);if(o.hasOwnProperty("key")){a=o.key;o.key=undefined}if(o.hasOwnProperty("namespace")){s=o.namespace;o.namespace=undefined}if(i==="INPUT"&&!s&&o.hasOwnProperty("value")&&o.value!==undefined&&!c(o.value)){o.value=p(o.value)}m(o);if(r!==undefined&&r!==null){v(r,n,i,o)}return new u(i,o,n,a,s)}function v(e,t,r,n){if(typeof e==="string"){t.push(new a(e))}else if(typeof e==="number"){t.push(new a(String(e)))}else if(g(e)){t.push(e)}else if(o(e)){for(var i=0;i<e.length;i++){v(e[i],t,r,n)}}else if(e===null||e===undefined){return}else{throw y({foreignObject:e,parentVnode:{tagName:r,properties:n}})}}function m(e){for(var t in e){if(e.hasOwnProperty(t)){var r=e[t];if(c(r)){continue}if(t.substr(0,3)==="ev-"){e[t]=f(r)}}}}function g(e){return n(e)||i(e)||s(e)||h(e)}function _(e){return typeof e==="string"||o(e)||g(e)}function y(e){var t=new Error;t.type="virtual-hyperscript.unexpected.virtual-element";t.message="Unexpected virtual child passed to h().\n"+"Expected a VNode / Vthunk / VWidget / string but:\n"+"got:\n"+b(e.foreignObject)+".\n"+"The parent vnode is:\n"+b(e.parentVnode);"\n"+"Suggested fix: change your `h(..., [ ... ])` callsite.";t.foreignObject=e.foreignObject;t.parentVnode=e.parentVnode;return t}function b(t){try{return JSON.stringify(t,null,"    ")}catch(e){return String(t)}}},{"../vnode/is-thunk":260,"../vnode/is-vhook":261,"../vnode/is-vnode":262,"../vnode/is-vtext":263,"../vnode/is-widget":264,"../vnode/vnode.js":266,"../vnode/vtext.js":268,"./hooks/ev-hook.js":255,"./hooks/soft-set-hook.js":256,"./parse-tag.js":258,"x-is-array":289}],258:[function(e,t,r){"use strict";var c=e("browser-split");var h=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/;var l=/^\.|#/;t.exports=n;function n(e,t){if(!e){return"DIV"}var r=!t.hasOwnProperty("id");var n=c(e,h);var i=null;if(l.test(n[1])){i="DIV"}var o,a,s,u;for(u=0;u<n.length;u++){a=n[u];if(!a){continue}s=a.charAt(0);if(!i){i=a}else if(s==="."){o=o||[];o.push(a.substring(1,a.length))}else if(s==="#"&&r){t.id=a.substring(1,a.length)}}if(o){if(t.className){o.push(t.className)}t.className=o.join(" ")}return t.namespace?i:i.toUpperCase()}},{"browser-split":5}],259:[function(e,t,r){var n=e("./is-vnode");var i=e("./is-vtext");var o=e("./is-widget");var a=e("./is-thunk");t.exports=s;function s(e,t){var r=e;var n=t;if(a(t)){n=u(t,e)}if(a(e)){r=u(e,null)}return{a:r,b:n}}function u(e,t){var r=e.vnode;if(!r){r=e.vnode=e.render(t)}if(!(n(r)||i(r)||o(r))){throw new Error("thunk did not return a valid node")}return r}},{"./is-thunk":260,"./is-vnode":262,"./is-vtext":263,"./is-widget":264}],260:[function(e,t,r){t.exports=n;function n(e){return e&&e.type==="Thunk"}},{}],261:[function(e,t,r){t.exports=n;function n(e){return e&&(typeof e.hook==="function"&&!e.hasOwnProperty("hook")||typeof e.unhook==="function"&&!e.hasOwnProperty("unhook"))}},{}],262:[function(e,t,r){var n=e("./version");t.exports=i;function i(e){return e&&e.type==="VirtualNode"&&e.version===n}},{"./version":265}],263:[function(e,t,r){var n=e("./version");t.exports=i;function i(e){return e&&e.type==="VirtualText"&&e.version===n}},{"./version":265}],264:[function(e,t,r){t.exports=n;function n(e){return e&&e.type==="Widget"}},{}],265:[function(e,t,r){t.exports="2"},{}],266:[function(e,t,r){var n=e("./version");var v=e("./is-vnode");var m=e("./is-widget");var g=e("./is-thunk");var _=e("./is-vhook");t.exports=i;var y={};var b=[];function i(e,t,r,n,i){this.tagName=e;this.properties=t||y;this.children=r||b;this.key=n!=null?String(n):undefined;this.namespace=typeof i==="string"?i:null;var o=r&&r.length||0;var a=0;var s=false;var u=false;var c=false;var h;for(var l in t){if(t.hasOwnProperty(l)){var p=t[l];if(_(p)&&p.unhook){if(!h){h={}}h[l]=p}}}for(var f=0;f<o;f++){var d=r[f];if(v(d)){a+=d.count||0;if(!s&&d.hasWidgets){s=true}if(!u&&d.hasThunks){u=true}if(!c&&(d.hooks||d.descendantHooks)){c=true}}else if(!s&&m(d)){if(typeof d.destroy==="function"){s=true}}else if(!u&&g(d)){u=true}}this.count=o+a;this.hasWidgets=s;this.hasThunks=u;this.hooks=h;this.descendantHooks=c}i.prototype.version=n;i.prototype.type="VirtualNode"},{"./is-thunk":260,"./is-vhook":261,"./is-vnode":262,"./is-widget":264,"./version":265}],267:[function(e,t,r){var n=e("./version");i.NONE=0;i.VTEXT=1;i.VNODE=2;i.WIDGET=3;i.PROPS=4;i.ORDER=5;i.INSERT=6;i.REMOVE=7;i.THUNK=8;t.exports=i;function i(e,t,r){this.type=Number(e);this.vNode=t;this.patch=r}i.prototype.version=n;i.prototype.type="VirtualPatch"},{"./version":265}],268:[function(e,t,r){var n=e("./version");t.exports=i;function i(e){this.text=String(e)}i.prototype.version=n;i.prototype.type="VirtualText"},{"./version":265}],269:[function(e,t,r){var u=e("is-object");var c=e("../vnode/is-vhook");t.exports=h;function h(e,t){var r;for(var n in e){if(!(n in t)){r=r||{};r[n]=undefined}var i=e[n];var o=t[n];if(i===o){continue}else if(u(i)&&u(o)){if(l(o)!==l(i)){r=r||{};r[n]=o}else if(c(o)){r=r||{};r[n]=o}else{var a=h(i,o);if(a){r=r||{};r[n]=a}}}else{r=r||{};r[n]=o}}for(var s in t){if(!(s in e)){r=r||{};r[s]=t[s]}}return r}function l(e){if(Object.getPrototypeOf){return Object.getPrototypeOf(e)}else if(e.__proto__){return e.__proto__}else if(e.constructor){return e.constructor.prototype}}},{"../vnode/is-vhook":261,"is-object":20}],270:[function(e,t,r){var n=e("x-is-array");var d=e("../vnode/vpatch");var v=e("../vnode/is-vnode");var s=e("../vnode/is-vtext");var u=e("../vnode/is-widget");var c=e("../vnode/is-thunk");var a=e("../vnode/handle-thunk");var h=e("./diff-props");t.exports=l;function l(e,t){var r={a:e};m(e,t,r,0);return r}function m(e,t,r,n){if(e===t){return}var i=r[n];var o=false;if(c(e)||c(t)){_(e,t,r,n)}else if(t==null){if(!u(e)){f(e,r,n);i=r[n]}i=S(i,new d(d.REMOVE,e,t))}else if(v(t)){if(v(e)){if(e.tagName===t.tagName&&e.namespace===t.namespace&&e.key===t.key){var a=h(e.properties,t.properties);if(a){i=S(i,new d(d.PROPS,e,a))}i=p(e,t,r,i,n)}else{i=S(i,new d(d.VNODE,e,t));o=true}}else{i=S(i,new d(d.VNODE,e,t));o=true}}else if(s(t)){if(!s(e)){i=S(i,new d(d.VTEXT,e,t));o=true}else if(e.text!==t.text){i=S(i,new d(d.VTEXT,e,t))}}else if(u(t)){if(!u(e)){o=true}i=S(i,new d(d.WIDGET,e,t))}if(i){r[n]=i}if(o){f(e,r,n)}}function p(e,t,r,n,i){var o=e.children;var a=x(o,t.children);var s=a.children;var u=o.length;var c=s.length;var h=u>c?u:c;for(var l=0;l<h;l++){var p=o[l];var f=s[l];i+=1;if(!p){if(f){n=S(n,new d(d.INSERT,null,f))}}else{m(p,f,r,i)}if(v(p)&&p.count){i+=p.count}}if(a.moves){n=S(n,new d(d.ORDER,e,a.moves))}return n}function f(e,t,r){b(e,t,r);g(e,t,r)}function g(e,t,r){if(u(e)){if(typeof e.destroy==="function"){t[r]=S(t[r],new d(d.REMOVE,e,null))}}else if(v(e)&&(e.hasWidgets||e.hasThunks)){var n=e.children;var i=n.length;for(var o=0;o<i;o++){var a=n[o];r+=1;g(a,t,r);if(v(a)&&a.count){r+=a.count}}}else if(c(e)){_(e,null,t,r)}}function _(e,t,r,n){var i=a(e,t);var o=l(i.a,i.b);if(y(o)){r[n]=new d(d.THUNK,null,o)}}function y(e){for(var t in e){if(t!=="a"){return true}}return false}function b(e,t,r){if(v(e)){if(e.hooks){t[r]=S(t[r],new d(d.PROPS,e,w(e.hooks)))}if(e.descendantHooks||e.hasThunks){var n=e.children;var i=n.length;for(var o=0;o<i;o++){var a=n[o];r+=1;b(a,t,r);if(v(a)&&a.count){r+=a.count}}}}else if(c(e)){_(e,null,t,r)}}function w(e){var t={};for(var r in e){t[r]=undefined}return t}function x(e,t){var r=E(t);var n=r.keys;var i=r.free;if(i.length===t.length){return{children:t,moves:null}}var o=E(e);var a=o.keys;var s=o.free;if(s.length===e.length){return{children:t,moves:null}}var u=[];var c=0;var h=i.length;var l=0;for(var p=0;p<e.length;p++){var f=e[p];var d;if(f.key){if(n.hasOwnProperty(f.key)){d=n[f.key];u.push(t[d])}else{d=p-l++;u.push(null)}}else{if(c<h){d=i[c++];u.push(t[d])}else{d=p-l++;u.push(null)}}}var v=c>=i.length?t.length:i[c];for(var m=0;m<t.length;m++){var g=t[m];if(g.key){if(!a.hasOwnProperty(g.key)){u.push(g)}}else if(m>=v){u.push(g)}}var _=u.slice();var y=0;var b=[];var w=[];var x;for(var S=0;S<t.length;){var M=t[S];x=_[y];while(x===null&&_.length){b.push(C(_,y,null));x=_[y]}if(!x||x.key!==M.key){if(M.key){if(x&&x.key){if(n[x.key]!==S+1){b.push(C(_,y,x.key));x=_[y];if(!x||x.key!==M.key){w.push({key:M.key,to:S})}else{y++}}else{w.push({key:M.key,to:S})}}else{w.push({key:M.key,to:S})}S++}else if(x&&x.key){b.push(C(_,y,x.key))}}else{y++;S++}}while(y<_.length){x=_[y];b.push(C(_,y,x&&x.key))}if(b.length===l&&!w.length){return{children:u,moves:null}}return{children:u,moves:{removes:b,inserts:w}}}function C(e,t,r){e.splice(t,1);return{from:t,key:r}}function E(e){var t={};var r=[];var n=e.length;for(var i=0;i<n;i++){var o=e[i];if(o.key){t[o.key]=i}else{r.push(i)}}return{keys:t,free:r}}function S(e,t){if(e){if(n(e)){e.push(t)}else{e=[e,t]}return e}else{return t}}},{"../vnode/handle-thunk":259,"../vnode/is-thunk":260,"../vnode/is-vnode":262,"../vnode/is-vtext":263,"../vnode/is-widget":264,"../vnode/vpatch":267,"./diff-props":269,"x-is-array":289}],271:[function(t,r,e){(function(e){"use strict";e(function(e){var t=e("./makePromise");var r=e("./Scheduler");var n=e("./env").asap;return t({scheduler:new r(n)})})})(typeof o==="function"&&o.amd?o:function(e){r.exports=e(t)})},{"./Scheduler":272,"./env":284,"./makePromise":286}],272:[function(e,t,r){(function(e){"use strict";e(function(){function e(e){this._async=e;this._running=false;this._queue=this;this._queueLen=0;this._afterQueue={};this._afterQueueLen=0;var t=this;this.drain=function(){t._drain()}}e.prototype.enqueue=function(e){this._queue[this._queueLen++]=e;this.run()};e.prototype.afterQueue=function(e){this._afterQueue[this._afterQueueLen++]=e;this.run()};e.prototype.run=function(){if(!this._running){this._running=true;this._async(this.drain)}};e.prototype._drain=function(){var e=0;for(;e<this._queueLen;++e){this._queue[e].run();this._queue[e]=void 0}this._queueLen=0;this._running=false;for(e=0;e<this._afterQueueLen;++e){this._afterQueue[e].run();this._afterQueue[e]=void 0}this._afterQueueLen=0};return e})})(typeof o==="function"&&o.amd?o:function(e){t.exports=e()})},{}],273:[function(e,t,r){(function(e){"use strict";e(function(){function t(e){Error.call(this);this.message=e;this.name=t.name;if(typeof Error.captureStackTrace==="function"){Error.captureStackTrace(this,t)}}t.prototype=Object.create(Error.prototype);t.prototype.constructor=t;return t})})(typeof o==="function"&&o.amd?o:function(e){t.exports=e()})},{}],274:[function(e,t,r){(function(e){"use strict";e(function(){e.tryCatchResolve=t;return e;function e(a,s){if(arguments.length<2){s=t}return e;function e(e,t,r){var n=a._defer();var i=r.length;var o=new Array(i);u({f:e,thisArg:t,args:r,params:o,i:i-1,call:s},n._handler);return n}function u(e,t){if(e.i<0){return s(e.f,e.thisArg,e.params,t)}var r=a._handler(e.args[e.i]);r.fold(n,e,void 0,t)}function n(e,t,r){e.params[e.i]=t;e.i-=1;u(e,r)}}function t(e,t,r,n){try{n.resolve(e.apply(t,r))}catch(e){n.reject(e)}}})})(typeof o==="function"&&o.amd?o:function(e){t.exports=e()})},{}],275:[function(t,r,e){(function(e){"use strict";e(function(e){var _=e("../state");var y=e("../apply");return function e(f){var i=y(f);var r=f.resolve;var n=f.all;var o=Array.prototype.reduce;var a=Array.prototype.reduceRight;var s=Array.prototype.slice;f.any=t;f.some=u;f.settle=p;f.map=c;f.filter=h;f.reduce=v;f.reduceRight=m;f.prototype.spread=function(t){return this.then(n).then(function(e){return t.apply(this,e)})};return f;function t(e){var t=f._defer();var r=t._handler;var n=e.length>>>0;var i=n;var o=[];for(var a,s,u=0;u<n;++u){s=e[u];if(s===void 0&&!(u in e)){--i;continue}a=f._handler(s);if(a.state()>0){r.become(a);f._visitRemaining(e,u,a);break}else{a.visit(r,c,h)}}if(i===0){r.reject(new RangeError("any(): array must not be empty"))}return t;function c(e){o=null;this.resolve(e)}function h(e){if(this.resolved){return}o.push(e);if(--i===0){this.reject(o)}}}function u(e,t){var r=f._defer();var n=r._handler;var i=[];var o=[];var a=e.length>>>0;var s=0;var u;var c,h;for(h=0;h<a;++h){c=e[h];if(c===void 0&&!(h in e)){continue}++s}t=Math.max(t,0);u=s-t+1;s=Math.min(t,s);if(t>s){n.reject(new RangeError("some(): array must contain at least "+t+" item(s), but had "+s))}else if(s===0){n.resolve(i)}for(h=0;h<a;++h){c=e[h];if(c===void 0&&!(h in e)){continue}f._handler(c).visit(n,l,p,n.notify)}return r;function l(e){if(this.resolved){return}i.push(e);if(--s===0){o=null;this.resolve(i)}}function p(e){if(this.resolved){return}o.push(e);if(--u===0){i=null;this.reject(o)}}}function c(e,t){return f._traverse(t,e)}function h(e,t){var r=s.call(e);return f._traverse(t,r).then(function(e){return l(r,e)})}function l(e,t){var r=t.length;var n=new Array(r);for(var i=0,o=0;i<r;++i){if(t[i]){n[o++]=f._handler(e[i]).value}}n.length=o;return n}function p(e){return n(e.map(d))}function d(e){var t;if(e instanceof f){t=e._handler.join()}if(t&&t.state()===0||!t){return r(e).then(_.fulfilled,_.rejected)}t._unreport();return _.inspect(t)}function v(e,t){return arguments.length>2?o.call(e,g(t),arguments[2]):o.call(e,g(t))}function m(e,t){return arguments.length>2?a.call(e,g(t),arguments[2]):a.call(e,g(t))}function g(n){return function(e,t,r){return i(n,void 0,[e,t,r])}}}})})(typeof o==="function"&&o.amd?o:function(e){r.exports=e(t)})},{"../apply":274,"../state":287}],276:[function(e,t,r){(function(e){"use strict";e(function(){return function e(t){var n=t.resolve;var i=t.reject;var r=t.prototype["catch"];t.prototype.done=function(e,t){this._handler.visit(this._handler.receiver,e,t)};t.prototype["catch"]=t.prototype.otherwise=function(e){if(arguments.length<2){return r.call(this,e)}if(typeof e!=="function"){return this.ensure(u)}return r.call(this,o(arguments[1],e))};function o(t,r){return function(e){return c(e,r)?t.call(this,e):i(e)}}t.prototype["finally"]=t.prototype.ensure=function(t){if(typeof t!=="function"){return this}return this.then(function(e){return a(t,this,l,e)},function(e){return a(t,this,i,e)})};function a(e,t,r,n){var i=e.call(t);return h(i)?s(i,r,n):r(n)}function s(e,t,r){return n(e).then(function(){return t(r)})}t.prototype["else"]=t.prototype.orElse=function(e){return this.then(void 0,function(){return e})};t.prototype["yield"]=function(e){return this.then(function(){return e})};t.prototype.tap=function(e){return this.then(e)["yield"](this)};return t};function u(){throw new TypeError("catch predicate must be a function")}function c(e,t){return r(t)?e instanceof t:t(e)}function r(e){return e===Error||e!=null&&e.prototype instanceof Error}function h(e){return(typeof e==="object"||typeof e==="function")&&e!==null}function l(e){return e}})})(typeof o==="function"&&o.amd?o:function(e){t.exports=e()})},{}],277:[function(e,t,r){(function(e){"use strict";e(function(){return function e(i){i.prototype.fold=function(n,e){var t=this._beget();this._handler.fold(function(e,t,r){i._handler(e).fold(function(e,t,r){r.resolve(n.call(this,t,e))},t,this,r)},e,t._handler.receiver,t._handler);return t};return i}})})(typeof o==="function"&&o.amd?o:function(e){t.exports=e()})},{}],278:[function(t,r,e){(function(e){"use strict";e(function(e){var r=e("../state").inspect;return function e(t){t.prototype.inspect=function(){return r(t._handler(this))};return t}})})(typeof o==="function"&&o.amd?o:function(e){r.exports=e(t)})},{"../state":287}],279:[function(e,t,r){(function(e){"use strict";e(function(){return function e(t){var a=t.resolve;t.iterate=r;t.unfold=s;return t;function r(t,e,r,n){return s(function(e){return[e,t(e)]},e,r,n)}function s(r,n,i,e){return a(e).then(function(t){return a(n(t)).then(function(e){return e?t:a(r(t)).spread(o)})});function o(e,t){return a(i(e)).then(function(){return s(r,n,i,t)})}}}})})(typeof o==="function"&&o.amd?o:function(e){t.exports=e()})},{}],280:[function(e,t,r){(function(e){"use strict";e(function(){return function e(t){t.prototype.progress=function(e){return this.then(void 0,void 0,e)};return t}})})(typeof o==="function"&&o.amd?o:function(e){t.exports=e()})},{}],281:[function(t,r,e){(function(e){"use strict";e(function(e){var a=e("../env");var i=e("../TimeoutError");function s(e,t,r,n){return a.setTimer(function(){e(r,n,t)},t)}return function e(t){t.prototype.delay=function(e){var t=this._beget();this._handler.fold(r,e,void 0,t._handler);return t};function r(e,t,r){s(n,e,t,r)}function n(e,t){t.resolve(e)}t.prototype.timeout=function(e,t){var r=this._beget();var n=r._handler;var i=s(o,e,t,r._handler);this._handler.visit(n,function e(t){a.clearTimer(i);this.resolve(t)},function e(t){a.clearTimer(i);this.reject(t)},n.notify);return r};function o(e,t,r){var n=typeof e==="undefined"?new i("timed out after "+r+"ms"):e;t.reject(n)}return t}})})(typeof o==="function"&&o.amd?o:function(e){r.exports=e(t)})},{"../TimeoutError":273,"../env":284}],282:[function(t,r,e){(function(e){"use strict";e(function(e){var p=e("../env").setTimer;var f=e("../format");return function e(t){var r=v;var n=v;var i;if(typeof console!=="undefined"){i=console;r=typeof i.error!=="undefined"?function(e){i.error(e)}:function(e){i.log(e)};n=typeof i.info!=="undefined"?function(e){i.info(e)}:function(e){i.log(e)}}t.onPotentiallyUnhandledRejection=function(e){h(u,e)};t.onPotentiallyUnhandledRejectionHandled=function(e){h(c,e)};t.onFatalRejection=function(e){h(d,e.value)};var o=[];var a=[];var s=null;function u(e){if(!e.handled){a.push(e);r("Potentially unhandled rejection ["+e.id+"] "+f.formatError(e.value))}}function c(e){var t=a.indexOf(e);if(t>=0){a.splice(t,1);n("Handled previous rejection ["+e.id+"] "+f.formatObject(e.value))}}function h(e,t){o.push(e,t);if(s===null){s=p(l,0)}}function l(){s=null;while(o.length>0){o.shift()(o.shift())}}return t};function d(e){throw e}function v(){}})})(typeof o==="function"&&o.amd?o:function(e){r.exports=e(t)})},{"../env":284,"../format":285}],283:[function(e,t,r){(function(e){"use strict";e(function(){return function e(t){t.prototype["with"]=t.prototype.withThis=function(e){var t=this._beget();var r=t._handler;r.receiver=e;this._handler.chain(r,e);return t};return t}})})(typeof o==="function"&&o.amd?o:function(e){t.exports=e()})},{}],284:[function(t,r,e){(function(l){(function(e){"use strict";e(function(e){var t;var r=typeof setTimeout!=="undefined"&&setTimeout;var n=function(e,t){return setTimeout(e,t)};var i=function(e){return clearTimeout(e)};var o=function(e){return r(e,0)};if(u()){o=function(e){return l.nextTick(e)}}else if(t=c()){o=h(t)}else if(!r){var a=e;var s=a("vertx");n=function(e,t){return s.setTimer(t,e)};i=s.cancelTimer;o=s.runOnLoop||s.runOnContext}return{setTimer:n,clearTimer:i,asap:o};function u(){return typeof l!=="undefined"&&Object.prototype.toString.call(l)==="[object process]"}function c(){return typeof MutationObserver!=="undefined"&&MutationObserver||typeof WebKitMutationObserver!=="undefined"&&WebKitMutationObserver}function h(e){var t;var r=document.createTextNode("");var n=new e(i);n.observe(r,{characterData:true});function i(){var e=t;t=void 0;e()}var o=0;return function(e){t=e;r.data=o^=1}}})})(typeof o==="function"&&o.amd?o:function(e){r.exports=e(t)})}).call(this,t("_process"))},{_process:6}],285:[function(e,t,r){(function(e){"use strict";e(function(){return{formatError:e,formatObject:r,tryStringify:n};function e(e){var t=typeof e==="object"&&e!==null&&(e.stack||e.message)?e.stack||e.message:r(e);return e instanceof Error?t:t+" (WARNING: non-Error used)"}function r(e){var t=String(e);if(t==="[object Object]"&&typeof JSON!=="undefined"){t=n(e,t)}return t}function n(e,t){try{return JSON.stringify(e)}catch(e){return t}}})})(typeof o==="function"&&o.amd?o:function(e){t.exports=e()})},{}],286:[function(e,t,r){(function(ne){(function(e){"use strict";e(function(){return function e(t){var r=t.scheduler;var n=re();var i=Object.create||function(e){function t(){}t.prototype=e;return new t};function l(e,t){this._handler=e===S?t:o(e)}function o(e){var t=new E;try{e(r,n,i)}catch(e){n(e)}return t;function r(e){t.resolve(e)}function n(e){t.reject(e)}function i(e){t.notify(e)}}l.resolve=a;l.reject=s;l.never=u;l._defer=c;l._handler=b;function a(e){return U(e)?e:new l(S,new T(b(e)))}function s(e){return new l(S,new T(new j(e)))}function u(){return I}function c(){return new l(S,new E)}l.prototype.then=function(e,t,r){var n=this._handler;var i=n.join().state();if(typeof e!=="function"&&i>0||typeof t!=="function"&&i<0){return new this.constructor(S,n)}var o=this._beget();var a=o._handler;n.chain(a,n.receiver,e,t,r);return o};l.prototype["catch"]=function(e){return this.then(void 0,e)};l.prototype._beget=function(){return h(this._handler,this.constructor)};function h(e,t){var r=new E(e.receiver,e.join().context);return new t(S,r)}l.all=p;l.race=_;l._traverse=f;function p(e){return d(J,null,e)}function f(e,t){return d(W,e,t)}function d(n,i,o){var e=typeof i==="function"?c:h;var t=new E;var a=o.length>>>0;var s=new Array(a);for(var r=0,u;r<o.length&&!t.resolved;++r){u=o[r];if(u===void 0&&!(r in o)){--a;continue}v(o,e,r,u,t)}if(a===0){t.become(new P(s))}return new l(S,t);function c(e,t,r){if(!r.resolved){v(o,h,e,n(i,t,e),r)}}function h(e,t,r){s[e]=t;if(--a===0){r.become(new P(s))}}}function v(e,t,r,n,i){if(G(n)){var o=w(n);var a=o.state();if(a===0){o.fold(t,r,void 0,i)}else if(a>0){t(r,o.value,i)}else{i.become(o);m(e,r+1,o)}}else{t(r,n,i)}}l._visitRemaining=m;function m(e,t,r){for(var n=t;n<e.length;++n){g(b(e[n]),r)}}function g(e,t){if(e===t){return}var r=e.state();if(r===0){e.visit(e,void 0,e._unreport)}else if(r<0){e._unreport()}}function _(e){if(typeof e!=="object"||e===null){return s(new TypeError("non-iterable passed to race()"))}return e.length===0?u():e.length===1?a(e[0]):y(e)}function y(e){var t=new E;var r,n,i;for(r=0;r<e.length;++r){n=e[r];if(n===void 0&&!(r in e)){continue}i=b(n);if(i.state()!==0){t.become(i);m(e,r+1,i);break}else{i.visit(t,t.resolve,t.reject)}}return new l(S,t)}function b(e){if(U(e)){return e._handler.join()}return G(e)?x(e):new P(e)}function w(e){return U(e)?e._handler.join():x(e)}function x(e){try{var t=e.then;return typeof t==="function"?new O(t,e):new P(e)}catch(e){return new j(e)}}function S(){}S.prototype.when=S.prototype.become=S.prototype.notify=S.prototype.fail=S.prototype._unreport=S.prototype._report=Q;S.prototype._state=0;S.prototype.state=function(){return this._state};S.prototype.join=function(){var e=this;while(e.handler!==void 0){e=e.handler}return e};S.prototype.chain=function(e,t,r,n,i){this.when({resolver:e,receiver:t,fulfilled:r,rejected:n,progress:i})};S.prototype.visit=function(e,t,r,n){this.chain(C,e,t,r,n)};S.prototype.fold=function(e,t,r,n){this.when(new $(e,t,r,n))};function M(){}Z(S,M);M.prototype.become=function(e){e.fail()};var C=new M;function E(e,t){l.createContext(this,t);this.consumers=void 0;this.receiver=e;this.handler=void 0;this.resolved=false}Z(S,E);E.prototype._state=0;E.prototype.resolve=function(e){this.become(b(e))};E.prototype.reject=function(e){if(this.resolved){return}this.become(new j(e))};E.prototype.join=function(){if(!this.resolved){return this}var e=this;while(e.handler!==void 0){e=e.handler;if(e===this){return this.handler=N()}}return e};E.prototype.run=function(){var e=this.consumers;var t=this.handler;this.handler=this.handler.join();this.consumers=void 0;for(var r=0;r<e.length;++r){t.when(e[r])}};E.prototype.become=function(e){if(this.resolved){return}this.resolved=true;this.handler=e;if(this.consumers!==void 0){r.enqueue(this)}if(this.context!==void 0){e._report(this.context)}};E.prototype.when=function(e){if(this.resolved){r.enqueue(new D(e,this.handler))}else{if(this.consumers===void 0){this.consumers=[e]}else{this.consumers.push(e)}}};E.prototype.notify=function(e){if(!this.resolved){r.enqueue(new B(e,this))}};E.prototype.fail=function(e){var t=typeof e==="undefined"?this.context:e;this.resolved&&this.handler.join().fail(t)};E.prototype._report=function(e){this.resolved&&this.handler.join()._report(e)};E.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()};function T(e){this.handler=e}Z(S,T);T.prototype.when=function(e){r.enqueue(new D(e,this))};T.prototype._report=function(e){this.join()._report(e)};T.prototype._unreport=function(){this.join()._unreport()};function O(e,t){E.call(this);r.enqueue(new F(e,t,this))}Z(E,O);function P(e){l.createContext(this);this.value=e}Z(S,P);P.prototype._state=1;P.prototype.fold=function(e,t,r,n){H(e,t,this,r,n)};P.prototype.when=function(e){V(e.fulfilled,this,e.receiver,e.resolver)};var A=0;function j(e){l.createContext(this);this.id=++A;this.value=e;this.handled=false;this.reported=false;this._report()}Z(S,j);j.prototype._state=-1;j.prototype.fold=function(e,t,r,n){n.become(this)};j.prototype.when=function(e){if(typeof e.rejected==="function"){this._unreport()}V(e.rejected,this,e.receiver,e.resolver)};j.prototype._report=function(e){r.afterQueue(new R(this,e))};j.prototype._unreport=function(){if(this.handled){return}this.handled=true;r.afterQueue(new k(this))};j.prototype.fail=function(e){this.reported=true;n("unhandledRejection",this);l.onFatalRejection(this,e===void 0?this.context:e)};function R(e,t){this.rejection=e;this.context=t}R.prototype.run=function(){if(!this.rejection.handled&&!this.rejection.reported){this.rejection.reported=true;n("unhandledRejection",this.rejection)||l.onPotentiallyUnhandledRejection(this.rejection,this.context)}};function k(e){this.rejection=e}k.prototype.run=function(){if(this.rejection.reported){n("rejectionHandled",this.rejection)||l.onPotentiallyUnhandledRejectionHandled(this.rejection)}};l.createContext=l.enterContext=l.exitContext=l.onPotentiallyUnhandledRejection=l.onPotentiallyUnhandledRejectionHandled=l.onFatalRejection=Q;var L=new S;var I=new l(S,L);function N(){return new j(new TypeError("Promise cycle"))}function D(e,t){this.continuation=e;this.handler=t}D.prototype.run=function(){this.handler.join().when(this.continuation)};function B(e,t){this.handler=t;this.value=e}B.prototype.run=function(){var e=this.handler.consumers;if(e===void 0){return}for(var t,r=0;r<e.length;++r){t=e[r];q(t.progress,this.value,this.handler,t.receiver,t.resolver)}};function F(e,t,r){this._then=e;this.thenable=t;this.resolver=r}F.prototype.run=function(){var t=this.resolver;z(this._then,this.thenable,e,r,n);function e(e){t.resolve(e)}function r(e){t.reject(e)}function n(e){t.notify(e)}};function z(e,t,r,n,i){try{e.call(t,r,n,i)}catch(e){n(e)}}function $(e,t,r,n){this.f=e;this.z=t;this.c=r;this.to=n;this.resolver=C;this.receiver=this}$.prototype.fulfilled=function(e){this.f.call(this.c,this.z,e,this.to)};$.prototype.rejected=function(e){this.to.reject(e)};$.prototype.progress=function(e){this.to.notify(e)};function U(e){return e instanceof l}function G(e){return(typeof e==="object"||typeof e==="function")&&e!==null}function V(e,t,r,n){if(typeof e!=="function"){return n.become(t)}l.enterContext(t);X(e,t.value,r,n);l.exitContext()}function H(e,t,r,n,i){if(typeof e!=="function"){return i.become(r)}l.enterContext(r);Y(e,t,r.value,n,i);l.exitContext()}function q(e,t,r,n,i){if(typeof e!=="function"){return i.notify(t)}l.enterContext(r);K(e,t,n,i);l.exitContext()}function W(e,t,r){try{return e(t,r)}catch(e){return s(e)}}function X(e,t,r,n){try{n.become(b(e.call(r,t)))}catch(e){n.become(new j(e))}}function Y(e,t,r,n,i){try{e.call(n,t,r,i)}catch(e){i.become(new j(e))}}function K(e,t,r,n){try{n.notify(e.call(r,t))}catch(e){n.notify(e)}}function Z(e,t){t.prototype=i(e.prototype);t.prototype.constructor=t}function J(e,t){return t}function Q(){}function ee(){if(typeof CustomEvent==="function"){try{var e=new CustomEvent("unhandledRejection");return e instanceof CustomEvent}catch(e){}}return false}function te(){if(typeof document!=="undefined"&&typeof document.createEvent==="function"){try{var e=document.createEvent("CustomEvent");e.initCustomEvent("eventType",false,true,{});return true}catch(e){}}return false}function re(){if(typeof ne!=="undefined"&&ne!==null&&typeof ne.emit==="function"){return function(e,t){return e==="unhandledRejection"?ne.emit(e,t.value,t):ne.emit(e,t)}}else if(typeof self!=="undefined"&&ee()){return function(n,i){return function(e,t){var r=new i(e,{detail:{reason:t.value,key:t},bubbles:false,cancelable:true});return!n.dispatchEvent(r)}}(self,CustomEvent)}else if(typeof self!=="undefined"&&te()){return function(n,i){return function(e,t){var r=i.createEvent("CustomEvent");r.initCustomEvent(e,false,true,{reason:t.value,key:t});return!n.dispatchEvent(r)}}(self,document)}return Q}return l}})})(typeof o==="function"&&o.amd?o:function(e){t.exports=e()})}).call(this,e("_process"))},{_process:6}],287:[function(e,t,r){(function(e){"use strict";e(function(){return{pending:r,fulfilled:i,rejected:n,inspect:e};function r(){return{state:"pending"}}function n(e){return{state:"rejected",reason:e}}function i(e){return{state:"fulfilled",value:e}}function e(e){var t=e.state();return t===0?r():t>0?i(e.value):n(e.value)}})})(typeof o==="function"&&o.amd?o:function(e){t.exports=e()})},{}],288:[function(t,r,e){(function(e){"use strict";e(function(e){var t=e("./lib/decorators/timed");var r=e("./lib/decorators/array");var n=e("./lib/decorators/flow");var i=e("./lib/decorators/fold");var o=e("./lib/decorators/inspect");var a=e("./lib/decorators/iterate");var s=e("./lib/decorators/progress");var u=e("./lib/decorators/with");var c=e("./lib/decorators/unhandledRejection");var h=e("./lib/TimeoutError");var l=[r,n,i,a,s,o,u,t,c].reduce(function(e,t){return t(e)},e("./lib/Promise"));var p=e("./lib/apply")(l);f.promise=d;f.resolve=l.resolve;f.reject=l.reject;f.lift=v;f["try"]=m;f.attempt=m;f.iterate=l.iterate;f.unfold=l.unfold;f.join=b;f.all=w;f.settle=x;f.any=v(l.any);f.some=v(l.some);f.race=v(l.race);f.map=S;f.filter=M;f.reduce=v(l.reduce);f.reduceRight=v(l.reduceRight);f.isPromiseLike=y;f.Promise=l;f.defer=g;f.TimeoutError=h;function f(e,t,r,n){var i=l.resolve(e);if(arguments.length<2){return i}return i.then(t,r,n)}function d(e){return new l(e)}function v(n){return function(){for(var e=0,t=arguments.length,r=new Array(t);e<t;++e){r[e]=arguments[e]}return p(n,this,r)}}function m(e){for(var t=0,r=arguments.length-1,n=new Array(r);t<r;++t){n[t]=arguments[t+1]}return p(e,this,n)}function g(){return new _}function _(){var t=l._defer();function e(e){t._handler.resolve(e)}function r(e){t._handler.reject(e)}function n(e){t._handler.notify(e)}this.promise=t;this.resolve=e;this.reject=r;this.notify=n;this.resolver={resolve:e,reject:r,notify:n}}function y(e){return e&&typeof e.then==="function"}function b(){return l.all(arguments)}function w(e){return f(e,l.all)}function x(e){return f(e,l.settle)}function S(e,t){return f(e,function(e){return l.map(e,t)})}function M(e,t){return f(e,function(e){return l.filter(e,t)})}return f})})(typeof o==="function"&&o.amd?o:function(e){r.exports=e(t)})},{"./lib/Promise":271,"./lib/TimeoutError":273,"./lib/apply":274,"./lib/decorators/array":275,"./lib/decorators/flow":276,"./lib/decorators/fold":277,"./lib/decorators/inspect":278,"./lib/decorators/iterate":279,"./lib/decorators/progress":280,"./lib/decorators/timed":281,"./lib/decorators/unhandledRejection":282,"./lib/decorators/with":283}],289:[function(e,t,r){var n=Array.isArray;var i=Object.prototype.toString;t.exports=n||o;function o(e){return i.call(e)==="[object Array]"}},{}],290:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./api/APIv3");r.APIv3=n.APIv3;var i=e("./api/ModelCreator");r.ModelCreator=i.ModelCreator},{"./api/APIv3":303,"./api/ModelCreator":304}],291:[function(e,t,r){"use strict";function n(e){for(var t in e)if(!r.hasOwnProperty(t))r[t]=e[t]}Object.defineProperty(r,"__esModule",{value:true});var i=e("./component/Component");r.Component=i.Component;var o=e("./component/ComponentService");r.ComponentService=o.ComponentService;var a=e("./component/utils/HandlerBase");r.HandlerBase=a.HandlerBase;var s=e("./component/utils/MeshFactory");r.MeshFactory=s.MeshFactory;var u=e("./component/utils/MeshScene");r.MeshScene=u.MeshScene;var c=e("./component/utils/MouseOperator");r.MouseOperator=c.MouseOperator;var h=e("./component/utils/ComponentSize");r.ComponentSize=h.ComponentSize;var l=e("./component/AttributionComponent");r.AttributionComponent=l.AttributionComponent;var p=e("./component/BackgroundComponent");r.BackgroundComponent=p.BackgroundComponent;var f=e("./component/BearingComponent");r.BearingComponent=f.BearingComponent;var d=e("./component/CacheComponent");r.CacheComponent=d.CacheComponent;var v=e("./component/CoverComponent");r.CoverComponent=v.CoverComponent;var m=e("./component/DebugComponent");r.DebugComponent=m.DebugComponent;var g=e("./component/direction/DirectionComponent");r.DirectionComponent=g.DirectionComponent;var _=e("./component/direction/DirectionDOMCalculator");r.DirectionDOMCalculator=_.DirectionDOMCalculator;var y=e("./component/direction/DirectionDOMRenderer");r.DirectionDOMRenderer=y.DirectionDOMRenderer;var b=e("./component/ImageComponent");r.ImageComponent=b.ImageComponent;var w=e("./component/keyboard/KeyboardComponent");r.KeyboardComponent=w.KeyboardComponent;var x=e("./component/keyboard/KeyPlayHandler");r.KeyPlayHandler=x.KeyPlayHandler;var S=e("./component/keyboard/KeyZoomHandler");r.KeyZoomHandler=S.KeyZoomHandler;var M=e("./component/keyboard/KeySequenceNavigationHandler");r.KeySequenceNavigationHandler=M.KeySequenceNavigationHandler;var C=e("./component/keyboard/KeySpatialNavigationHandler");r.KeySpatialNavigationHandler=C.KeySpatialNavigationHandler;var E=e("./component/LoadingComponent");r.LoadingComponent=E.LoadingComponent;var T=e("./component/marker/marker/Marker");r.Marker=T.Marker;var O=e("./component/marker/MarkerComponent");r.MarkerComponent=O.MarkerComponent;var P=e("./component/marker/MarkerScene");r.MarkerScene=P.MarkerScene;var A=e("./component/marker/MarkerSet");r.MarkerSet=A.MarkerSet;var j=e("./component/mouse/MouseComponent");r.MouseComponent=j.MouseComponent;var R=e("./component/mouse/BounceHandler");r.BounceHandler=R.BounceHandler;var k=e("./component/mouse/DragPanHandler");r.DragPanHandler=k.DragPanHandler;var L=e("./component/mouse/DoubleClickZoomHandler");r.DoubleClickZoomHandler=L.DoubleClickZoomHandler;var I=e("./component/mouse/EarthControlHandler");r.EarthControlHandler=I.EarthControlHandler;var N=e("./component/mouse/ScrollZoomHandler");r.ScrollZoomHandler=N.ScrollZoomHandler;var D=e("./component/mouse/TouchZoomHandler");r.TouchZoomHandler=D.TouchZoomHandler;var B=e("./component/mouse/ImageBoundary");r.ImageBoundary=B;var F=e("./component/popup/popup/Popup");r.Popup=F.Popup;var z=e("./component/popup/PopupComponent");r.PopupComponent=z.PopupComponent;var $=e("./component/NavigationComponent");r.NavigationComponent=$.NavigationComponent;var U=e("./component/RouteComponent");r.RouteComponent=U.RouteComponent;var G=e("./component/sequence/SequenceComponent");r.SequenceComponent=G.SequenceComponent;var V=e("./component/sequence/SequenceDOMRenderer");r.SequenceDOMRenderer=V.SequenceDOMRenderer;var H=e("./component/sequence/SequenceMode");r.SequenceMode=H.SequenceMode;var q=e("./component/spatialdata/SpatialDataCache");r.SpatialDataCache=q.SpatialDataCache;var W=e("./component/spatialdata/SpatialDataComponent");r.SpatialDataComponent=W.SpatialDataComponent;var X=e("./component/spatialdata/SpatialDataScene");r.SpatialDataScene=X.SpatialDataScene;var Y=e("./component/imageplane/ImagePlaneComponent");r.ImagePlaneComponent=Y.ImagePlaneComponent;var K=e("./component/imageplane/ImagePlaneGLRenderer");r.ImagePlaneGLRenderer=K.ImagePlaneGLRenderer;var Z=e("./component/shaders/Shaders");r.Shaders=Z.Shaders;var J=e("./component/marker/marker/SimpleMarker");r.SimpleMarker=J.SimpleMarker;var Q=e("./component/marker/marker/CircleMarker");r.CircleMarker=Q.CircleMarker;var ee=e("./component/slider/SliderComponent");r.SliderComponent=ee.SliderComponent;var te=e("./component/slider/SliderDOMRenderer");r.SliderDOMRenderer=te.SliderDOMRenderer;var re=e("./component/slider/SliderGLRenderer");r.SliderGLRenderer=re.SliderGLRenderer;var ne=e("./component/StatsComponent");r.StatsComponent=ne.StatsComponent;var ie=e("./component/tag/handlers/TagHandlerBase");r.TagHandlerBase=ie.TagHandlerBase;var oe=e("./component/tag/handlers/CreateHandlerBase");r.CreateHandlerBase=oe.CreateHandlerBase;var ae=e("./component/tag/handlers/CreatePointHandler");r.CreatePointHandler=ae.CreatePointHandler;var se=e("./component/tag/handlers/CreateVertexHandler");r.CreateVertexHandler=se.CreateVertexHandler;var ue=e("./component/tag/handlers/CreatePointsHandler");r.CreatePointsHandler=ue.CreatePointsHandler;var ce=e("./component/tag/handlers/CreatePolygonHandler");r.CreatePolygonHandler=ce.CreatePolygonHandler;var he=e("./component/tag/handlers/CreateRectHandler");r.CreateRectHandler=he.CreateRectHandler;var le=e("./component/tag/handlers/CreateRectDragHandler");r.CreateRectDragHandler=le.CreateRectDragHandler;var pe=e("./component/tag/handlers/EditVertexHandler");r.EditVertexHandler=pe.EditVertexHandler;var fe=e("./component/tag/tag/Tag");r.Tag=fe.Tag;var de=e("./component/tag/tag/OutlineTag");r.OutlineTag=de.OutlineTag;var ve=e("./component/tag/tag/ExtremePointTag");r.ExtremePointTag=ve.ExtremePointTag;var me=e("./component/tag/tag/RenderTag");r.RenderTag=me.RenderTag;var ge=e("./component/tag/tag/OutlineRenderTagBase");r.OutlineRenderTagBase=ge.OutlineRenderTagBase;var _e=e("./component/tag/tag/OutlineRenderTag");r.OutlineRenderTag=_e.OutlineRenderTag;var ye=e("./component/tag/tag/ExtremePointRenderTag");r.ExtremePointRenderTag=ye.ExtremePointRenderTag;var be=e("./component/tag/tag/SpotTag");r.SpotTag=be.SpotTag;var we=e("./component/tag/tag/SpotRenderTag");r.SpotRenderTag=we.SpotRenderTag;var xe=e("./component/tag/tag/TagDomain");r.TagDomain=xe.TagDomain;var Se=e("./component/tag/TagComponent");r.TagComponent=Se.TagComponent;var Me=e("./component/tag/TagCreator");r.TagCreator=Me.TagCreator;var Ce=e("./component/tag/TagDOMRenderer");r.TagDOMRenderer=Ce.TagDOMRenderer;var Ee=e("./component/tag/TagMode");r.TagMode=Ee.TagMode;var Te=e("./component/tag/TagOperation");r.TagOperation=Te.TagOperation;var Oe=e("./component/tag/TagScene");r.TagScene=Oe.TagScene;var Pe=e("./component/tag/TagSet");r.TagSet=Pe.TagSet;var Ae=e("./component/tag/geometry/Geometry");r.Geometry=Ae.Geometry;var je=e("./component/tag/geometry/VertexGeometry");r.VertexGeometry=je.VertexGeometry;var Re=e("./component/tag/geometry/RectGeometry");r.RectGeometry=Re.RectGeometry;var ke=e("./component/tag/geometry/PointGeometry");r.PointGeometry=ke.PointGeometry;var Le=e("./component/tag/geometry/PointsGeometry");r.PointsGeometry=Le.PointsGeometry;var Ie=e("./component/tag/geometry/PolygonGeometry");r.PolygonGeometry=Ie.PolygonGeometry;var Ne=e("./component/tag/error/GeometryTagError");r.GeometryTagError=Ne.GeometryTagError;var De=e("./component/zoom/ZoomComponent");r.ZoomComponent=De.ZoomComponent;var Be=e("./component/tag/tag/CreateTag");r.CreateTag=Be.CreateTag;var Fe=e("./component/tag/tag/OutlineCreateTag");r.OutlineCreateTag=Fe.OutlineCreateTag;var ze=e("./component/tag/tag/ExtremePointCreateTag");r.ExtremePointCreateTag=ze.ExtremePointCreateTag;n(e("./component/interfaces/interfaces"))},{"./component/AttributionComponent":305,"./component/BackgroundComponent":306,"./component/BearingComponent":307,"./component/CacheComponent":308,"./component/Component":309,"./component/ComponentService":310,"./component/CoverComponent":311,"./component/DebugComponent":312,"./component/ImageComponent":313,"./component/LoadingComponent":314,"./component/NavigationComponent":315,"./component/RouteComponent":316,"./component/StatsComponent":317,"./component/direction/DirectionComponent":318,"./component/direction/DirectionDOMCalculator":319,"./component/direction/DirectionDOMRenderer":320,"./component/imageplane/ImagePlaneComponent":321,"./component/imageplane/ImagePlaneGLRenderer":322,"./component/interfaces/interfaces":325,"./component/keyboard/KeyPlayHandler":326,"./component/keyboard/KeySequenceNavigationHandler":327,"./component/keyboard/KeySpatialNavigationHandler":328,"./component/keyboard/KeyZoomHandler":329,"./component/keyboard/KeyboardComponent":330,"./component/marker/MarkerComponent":332,"./component/marker/MarkerScene":333,"./component/marker/MarkerSet":334,"./component/marker/marker/CircleMarker":335,"./component/marker/marker/Marker":336,"./component/marker/marker/SimpleMarker":337,"./component/mouse/BounceHandler":338,"./component/mouse/DoubleClickZoomHandler":339,"./component/mouse/DragPanHandler":340,"./component/mouse/EarthControlHandler":341,"./component/mouse/ImageBoundary":342,"./component/mouse/MouseComponent":343,"./component/mouse/ScrollZoomHandler":344,"./component/mouse/TouchZoomHandler":345,"./component/popup/PopupComponent":347,"./component/popup/popup/Popup":348,"./component/sequence/SequenceComponent":349,"./component/sequence/SequenceDOMRenderer":350,"./component/sequence/SequenceMode":351,"./component/shaders/Shaders":352,"./component/slider/SliderComponent":353,"./component/slider/SliderDOMRenderer":354,"./component/slider/SliderGLRenderer":355,"./component/spatialdata/SpatialDataCache":358,"./component/spatialdata/SpatialDataComponent":359,"./component/spatialdata/SpatialDataScene":360,"./component/tag/TagComponent":362,"./component/tag/TagCreator":363,"./component/tag/TagDOMRenderer":364,"./component/tag/TagMode":365,"./component/tag/TagOperation":366,"./component/tag/TagScene":367,"./component/tag/TagSet":368,"./component/tag/error/GeometryTagError":369,"./component/tag/geometry/Geometry":370,"./component/tag/geometry/PointGeometry":371,"./component/tag/geometry/PointsGeometry":372,"./component/tag/geometry/PolygonGeometry":373,"./component/tag/geometry/RectGeometry":374,"./component/tag/geometry/VertexGeometry":375,"./component/tag/handlers/CreateHandlerBase":376,"./component/tag/handlers/CreatePointHandler":377,"./component/tag/handlers/CreatePointsHandler":378,"./component/tag/handlers/CreatePolygonHandler":379,"./component/tag/handlers/CreateRectDragHandler":380,"./component/tag/handlers/CreateRectHandler":381,"./component/tag/handlers/CreateVertexHandler":382,"./component/tag/handlers/EditVertexHandler":383,"./component/tag/handlers/TagHandlerBase":384,"./component/tag/tag/CreateTag":385,"./component/tag/tag/ExtremePointCreateTag":386,"./component/tag/tag/ExtremePointRenderTag":387,"./component/tag/tag/ExtremePointTag":388,"./component/tag/tag/OutlineCreateTag":389,"./component/tag/tag/OutlineRenderTag":390,"./component/tag/tag/OutlineRenderTagBase":391,"./component/tag/tag/OutlineTag":392,"./component/tag/tag/RenderTag":393,"./component/tag/tag/SpotRenderTag":394,"./component/tag/tag/SpotTag":395,"./component/tag/tag/Tag":396,"./component/tag/tag/TagDomain":397,"./component/utils/ComponentSize":398,"./component/utils/HandlerBase":399,"./component/utils/MeshFactory":400,"./component/utils/MeshScene":401,"./component/utils/MouseOperator":402,"./component/zoom/ZoomComponent":403}],292:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./graph/edge/EdgeDirection");r.EdgeDirection=n.EdgeDirection;var i=e("./graph/edge/EdgeCalculatorSettings");r.EdgeCalculatorSettings=i.EdgeCalculatorSettings;var o=e("./graph/edge/EdgeCalculatorDirections");r.EdgeCalculatorDirections=o.EdgeCalculatorDirections;var a=e("./graph/edge/EdgeCalculatorCoefficients");r.EdgeCalculatorCoefficients=a.EdgeCalculatorCoefficients;var s=e("./graph/edge/EdgeCalculator");r.EdgeCalculator=s.EdgeCalculator},{"./graph/edge/EdgeCalculator":425,"./graph/edge/EdgeCalculatorCoefficients":426,"./graph/edge/EdgeCalculatorDirections":427,"./graph/edge/EdgeCalculatorSettings":428,"./graph/edge/EdgeDirection":429}],293:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./error/AbortMapillaryError");r.AbortMapillaryError=n.AbortMapillaryError;var i=e("./error/ArgumentMapillaryError");r.ArgumentMapillaryError=i.ArgumentMapillaryError;var o=e("./error/GraphMapillaryError");r.GraphMapillaryError=o.GraphMapillaryError;var a=e("./error/MapillaryError");r.MapillaryError=a.MapillaryError},{"./error/AbortMapillaryError":404,"./error/ArgumentMapillaryError":405,"./error/GraphMapillaryError":406,"./error/MapillaryError":407}],294:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./geo/Camera");r.Camera=n.Camera;var i=e("./geo/GeoCoords");r.GeoCoords=i.GeoCoords;var o=e("./geo/ViewportCoords");r.ViewportCoords=o.ViewportCoords;var a=e("./geo/Spatial");r.Spatial=a.Spatial;var s=e("./geo/Transform");r.Transform=s.Transform;var u=e("./geo/Geo");r.Geo=u;var c=e("./geo/Lines");r.Lines=c},{"./geo/Camera":408,"./geo/Geo":409,"./geo/GeoCoords":410,"./geo/Lines":411,"./geo/Spatial":412,"./geo/Transform":413,"./geo/ViewportCoords":414}],295:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./graph/FilterCreator");r.FilterCreator=n.FilterCreator;var i=e("./graph/Graph");r.Graph=i.Graph;var o=e("./graph/GraphCalculator");r.GraphCalculator=o.GraphCalculator;var a=e("./graph/GraphMode");r.GraphMode=a.GraphMode;var s=e("./graph/GraphService");r.GraphService=s.GraphService;var u=e("./graph/ImageLoadingService");r.ImageLoadingService=u.ImageLoadingService;var c=e("./graph/MeshReader");r.MeshReader=c.MeshReader;var h=e("./graph/Node");r.Node=h.Node;var l=e("./graph/NodeCache");r.NodeCache=l.NodeCache;var p=e("./graph/Sequence");r.Sequence=p.Sequence},{"./graph/FilterCreator":415,"./graph/Graph":416,"./graph/GraphCalculator":417,"./graph/GraphMode":418,"./graph/GraphService":419,"./graph/ImageLoadingService":420,"./graph/MeshReader":421,"./graph/Node":422,"./graph/NodeCache":423,"./graph/Sequence":424}],296:[function(e,t,r){"use strict";function n(e){for(var t in e)if(!r.hasOwnProperty(t))r[t]=e[t]}Object.defineProperty(r,"__esModule",{value:true});n(e("./Support"));var i=e("./Edge");r.EdgeDirection=i.EdgeDirection;var o=e("./Error");r.AbortMapillaryError=o.AbortMapillaryError;var a=e("./Render");r.RenderMode=a.RenderMode;var s=e("./State");r.TransitionMode=s.TransitionMode;var u=e("./Viewer");r.Alignment=u.Alignment;r.ImageSize=u.ImageSize;r.Viewer=u.Viewer;var c=e("./Component");r.SliderMode=c.SliderMode;r.ComponentSize=c.ComponentSize;var h=e("./component/tag/Tag");r.TagComponent=h;var l=e("./component/marker/Marker");r.MarkerComponent=l;var p=e("./component/popup/Popup");r.PopupComponent=p;var f=e("./component/spatialdata/SpatialData");r.SpatialDataComponent=f},{"./Component":291,"./Edge":292,"./Error":293,"./Render":297,"./State":298,"./Support":299,"./Viewer":302,"./component/marker/Marker":331,"./component/popup/Popup":346,"./component/spatialdata/SpatialData":357,"./component/tag/Tag":361}],297:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./render/DOMRenderer");r.DOMRenderer=n.DOMRenderer;var i=e("./render/GLRenderer");r.GLRenderer=i.GLRenderer;var o=e("./render/GLRenderStage");r.GLRenderStage=o.GLRenderStage;var a=e("./render/RenderCamera");r.RenderCamera=a.RenderCamera;var s=e("./render/RenderMode");r.RenderMode=s.RenderMode;var u=e("./render/RenderService");r.RenderService=u.RenderService},{"./render/DOMRenderer":430,"./render/GLRenderStage":431,"./render/GLRenderer":432,"./render/RenderCamera":433,"./render/RenderMode":434,"./render/RenderService":435}],298:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./state/FrameGenerator");r.FrameGenerator=n.FrameGenerator;var i=e("./state/RotationDelta");r.RotationDelta=i.RotationDelta;var o=e("./state/State");r.State=o.State;var a=e("./state/states/StateBase");r.StateBase=a.StateBase;var s=e("./state/StateContext");r.StateContext=s.StateContext;var u=e("./state/StateService");r.StateService=u.StateService;var c=e("./state/TransitionMode");r.TransitionMode=c.TransitionMode;var h=e("./state/states/EarthState");r.EarthState=h.EarthState;var l=e("./state/states/InteractiveStateBase");r.InteractiveStateBase=l.InteractiveStateBase;var p=e("./state/states/InteractiveWaitingState");r.InteractiveWaitingState=p.InteractiveWaitingState;var f=e("./state/states/TraversingState");r.TraversingState=f.TraversingState;var d=e("./state/states/WaitingState");r.WaitingState=d.WaitingState},{"./state/FrameGenerator":436,"./state/RotationDelta":437,"./state/State":438,"./state/StateContext":439,"./state/StateService":440,"./state/TransitionMode":441,"./state/states/EarthState":442,"./state/states/InteractiveStateBase":443,"./state/states/InteractiveWaitingState":444,"./state/states/StateBase":445,"./state/states/TraversingState":446,"./state/states/WaitingState":447}],299:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./utils/Support");function i(){return o()&&n.isWebGLSupportedCached()}r.isSupported=i;function o(){return n.isBrowser()&&n.isBlobSupported()&&n.isArraySupported()&&n.isFunctionSupported()&&n.isJSONSupported()&&n.isObjectSupported()}r.isFallbackSupported=o},{"./utils/Support":455}],300:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./tiles/ImageTileLoader");r.ImageTileLoader=n.ImageTileLoader;var i=e("./tiles/ImageTileStore");r.ImageTileStore=i.ImageTileStore;var o=e("./tiles/TextureProvider");r.TextureProvider=o.TextureProvider;var a=e("./tiles/RegionOfInterestCalculator");r.RegionOfInterestCalculator=a.RegionOfInterestCalculator},{"./tiles/ImageTileLoader":448,"./tiles/ImageTileStore":449,"./tiles/RegionOfInterestCalculator":450,"./tiles/TextureProvider":451}],301:[function(e,t,r){"use strict";function n(e){for(var t in e)if(!r.hasOwnProperty(t))r[t]=e[t]}Object.defineProperty(r,"__esModule",{value:true});var i=e("./utils/DOM");r.DOM=i.DOM;var o=e("./utils/EventEmitter");r.EventEmitter=o.EventEmitter;var a=e("./utils/Settings");r.Settings=a.Settings;n(e("./utils/Support"));var s=e("./utils/Urls");r.Urls=s.Urls},{"./utils/DOM":452,"./utils/EventEmitter":453,"./utils/Settings":454,"./utils/Support":455,"./utils/Urls":456}],302:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./viewer/Alignment");r.Alignment=n.Alignment;var i=e("./viewer/CacheService");r.CacheService=i.CacheService;var o=e("./viewer/ComponentController");r.ComponentController=o.ComponentController;var a=e("./viewer/Container");r.Container=a.Container;var s=e("./viewer/Observer");r.Observer=s.Observer;var u=e("./viewer/ImageSize");r.ImageSize=u.ImageSize;var c=e("./viewer/KeyboardService");r.KeyboardService=c.KeyboardService;var h=e("./viewer/LoadingService");r.LoadingService=h.LoadingService;var l=e("./viewer/MouseService");r.MouseService=l.MouseService;var p=e("./viewer/Navigator");r.Navigator=p.Navigator;var f=e("./viewer/PlayService");r.PlayService=f.PlayService;var d=e("./viewer/Projection");r.Projection=d.Projection;var v=e("./viewer/SpriteService");r.SpriteService=v.SpriteService;var m=e("./viewer/TouchService");r.TouchService=m.TouchService;var g=e("./viewer/Viewer");r.Viewer=g.Viewer},{"./viewer/Alignment":457,"./viewer/CacheService":458,"./viewer/ComponentController":459,"./viewer/Container":460,"./viewer/ImageSize":461,"./viewer/KeyboardService":462,"./viewer/LoadingService":463,"./viewer/MouseService":464,"./viewer/Navigator":465,"./viewer/Observer":466,"./viewer/PlayService":468,"./viewer/Projection":469,"./viewer/SpriteService":470,"./viewer/TouchService":471,"./viewer/Viewer":472}],303:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var s=e("rxjs/operators");var n=e("rxjs");var i=e("../API");var o=function(){function e(e,t,r){this._clientId=e;this._modelCreator=r!=null?r:new i.ModelCreator;this._model=this._modelCreator.createModel(e,t);this._pageCount=999;this._pathImageByKey="imageByKey";this._pathImageCloseTo="imageCloseTo";this._pathImagesByH="imagesByH";this._pathImageViewAdd="imageViewAdd";this._pathSequenceByKey="sequenceByKey";this._pathSequenceViewAdd="sequenceViewAdd";this._propertiesCore=["cl","l","sequence_key"];this._propertiesFill=["captured_at","captured_with_camera_uuid","user","organization_key","private","project"];this._propertiesKey=["key"];this._propertiesSequence=["keys"];this._propertiesSpatial=["atomic_scale","cluster_key","c_rotation","ca","calt","camera_projection_type","cca","cfocal","ck1","ck2","gpano","height","merge_cc","merge_version","orientation","width"];this._propertiesUser=["username"]}e.prototype.imageByKeyFill$=function(t){return this._catchInvalidateGet$(this._wrapModelResponse$(this._model.get([this._pathImageByKey,t,this._propertiesKey.concat(this._propertiesFill).concat(this._propertiesSpatial),this._propertiesKey.concat(this._propertiesUser)])).pipe(s.map(function(e){if(!e){throw new Error("Images ("+t.join(", ")+") could not be found.")}return e.json.imageByKey})),this._pathImageByKey,t)};e.prototype.imageByKeyFull$=function(t){return this._catchInvalidateGet$(this._wrapModelResponse$(this._model.get([this._pathImageByKey,t,this._propertiesKey.concat(this._propertiesCore).concat(this._propertiesFill).concat(this._propertiesSpatial),this._propertiesKey.concat(this._propertiesUser)])).pipe(s.map(function(e){if(!e){throw new Error("Images ("+t.join(", ")+") could not be found.")}return e.json.imageByKey})),this._pathImageByKey,t)};e.prototype.imageCloseTo$=function(e,t){var r=t+":"+e;return this._catchInvalidateGet$(this._wrapModelResponse$(this._model.get([this._pathImageCloseTo,[r],this._propertiesKey.concat(this._propertiesCore).concat(this._propertiesFill).concat(this._propertiesSpatial),this._propertiesKey.concat(this._propertiesUser)])).pipe(s.map(function(e){return e!=null?e.json.imageCloseTo[r]:null})),this._pathImageCloseTo,[r])};e.prototype.imagesByH$=function(o){var a=this;return this._catchInvalidateGet$(this._wrapModelResponse$(this._model.get([this._pathImagesByH,o,{from:0,to:this._pageCount},this._propertiesKey.concat(this._propertiesCore)])).pipe(s.map(function(e){if(!e){e={json:{imagesByH:{}}};for(var t=0,r=o;t<r.length;t++){var n=r[t];e.json.imagesByH[n]={};for(var i=0;i<=a._pageCount;i++){e.json.imagesByH[n][i]=null}}}return e.json.imagesByH})),this._pathImagesByH,o)};e.prototype.imageViewAdd$=function(e){return this._catchInvalidateCall$(this._wrapCallModelResponse$(this._model.call([this._pathImageViewAdd],[e])),this._pathImageViewAdd,e)};e.prototype.invalidateImageByKey=function(e){this._invalidateGet(this._pathImageByKey,e)};e.prototype.invalidateImagesByH=function(e){this._invalidateGet(this._pathImagesByH,e)};e.prototype.invalidateSequenceByKey=function(e){this._invalidateGet(this._pathSequenceByKey,e)};e.prototype.setToken=function(e){this._model.invalidate([]);this._model=null;this._model=this._modelCreator.createModel(this._clientId,e)};e.prototype.sequenceByKey$=function(i){return this._catchInvalidateGet$(this._wrapModelResponse$(this._model.get([this._pathSequenceByKey,i,this._propertiesKey.concat(this._propertiesSequence)])).pipe(s.map(function(e){if(!e){e={json:{sequenceByKey:{}}}}for(var t=0,r=i;t<r.length;t++){var n=r[t];if(!(n in e.json.sequenceByKey)){console.warn("Sequence data missing ("+n+")");e.json.sequenceByKey[n]={key:n,keys:[]}}}return e.json.sequenceByKey})),this._pathSequenceByKey,i)};e.prototype.sequenceViewAdd$=function(e){return this._catchInvalidateCall$(this._wrapCallModelResponse$(this._model.call([this._pathSequenceViewAdd],[e])),this._pathSequenceViewAdd,e)};Object.defineProperty(e.prototype,"clientId",{get:function(){return this._clientId},enumerable:true,configurable:true});e.prototype._catchInvalidateGet$=function(e,t,r){var n=this;return e.pipe(s.catchError(function(e){n._invalidateGet(t,r);throw e}))};e.prototype._catchInvalidateCall$=function(e,t,r){var n=this;return e.pipe(s.catchError(function(e){n._invalidateCall(t,r);throw e}))};e.prototype._invalidateGet=function(e,t){this._model.invalidate([e,t])};e.prototype._invalidateCall=function(e,t){this._model.invalidate([e],[t])};e.prototype._wrapModelResponse$=function(e){return n.Observable.create(function(t){e.then(function(e){t.next(e);t.complete()},function(e){t.error(e)})})};e.prototype._wrapCallModelResponse$=function(e){return this._wrapModelResponse$(e).pipe(s.map(function(e){return}))};return e}();r.APIv3=o;r.default=o},{"../API":290,rxjs:43,"rxjs/operators":241}],304:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("falcor");var i=e("falcor-http-datasource");var o=e("../Utils");var a=function(){function e(){}e.prototype.createModel=function(e,t){var r={crossDomain:true,withCredentials:false};if(t!=null){r.headers={Authorization:"Bearer "+t}}return new n.Model({maxSize:16*1024*1024,source:new i.default(o.Urls.falcorModel(e),r)})};return e}();r.ModelCreator=a;r.default=a},{"../Utils":301,falcor:15,"falcor-http-datasource":10}],305:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("rxjs");var a=e("rxjs/operators");var d=e("virtual-dom");var n=e("../Component");var v=e("../Utils");var s=function(n){i(e,n);function e(e,t,r){return n.call(this,e,t,r)||this}e.prototype._activate=function(){var n=this;this._disposable=o.combineLatest(this._navigator.stateService.currentNode$,this._container.renderService.size$).pipe(a.map(function(e){var t=e[0],r=e[1];return{name:n._name,vnode:n._getAttributionNode(t.username,t.key,t.capturedAt,r.width)}})).subscribe(this._container.domRenderer.render$)};e.prototype._deactivate=function(){this._disposable.unsubscribe()};e.prototype._getDefaultConfiguration=function(){return{}};e.prototype._getAttributionNode=function(e,t,r,n){var i=n<=640;var o=d.h("div.AttributionMapillaryLogo",[]);var a=d.h("a.AttributionIconContainer",{href:v.Urls.explore,target:"_blank"},[o]);var s=i?""+e:"image by "+e;var u=d.h("div.AttributionUsername",{textContent:s},[]);var c=new Date(r).toDateString().split(" ");var h=(c.length>3?i?[c[3]]:[c[1],c[2]+",",c[3]]:c).join(" ");var l=d.h("div.AttributionDate",{textContent:h},[]);var p=d.h("a.AttributionImageContainer",{href:v.Urls.exporeImage(t),target:"_blank"},[u,l]);var f=i?".AttributionCompact":"";return d.h("div.AttributionContainer"+f,{},[a,p])};e.componentName="attribution";return e}(n.Component);r.AttributionComponent=s;n.ComponentService.register(s);r.default=s},{"../Component":291,"../Utils":301,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],306:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("virtual-dom");var n=e("../Component");var a=function(n){i(e,n);function e(e,t,r){return n.call(this,e,t,r)||this}e.prototype._activate=function(){this._container.domRenderer.render$.next({name:this._name,vnode:this._getBackgroundNode("The viewer can't display the given image.")})};e.prototype._deactivate=function(){return};e.prototype._getDefaultConfiguration=function(){return{}};e.prototype._getBackgroundNode=function(e){return o.h("div.BackgroundWrapper",{},[o.h("p",{textContent:e},[])])};e.componentName="background";return e}(n.Component);r.BackgroundComponent=a;n.ComponentService.register(a);r.default=a},{"../Component":291,"virtual-dom":247}],307:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var a=e("rxjs/operators");var v=e("virtual-dom");var o=e("@mapbox/unitbezier");var s=e("rxjs");var i=e("../Component");var u=e("../Geo");var c=e("../geo/ViewportCoords");var g=e("./utils/ComponentSize");var h=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e,t,r)||this;n._spatial=new u.Spatial;n._viewportCoords=new c.default;n._svgNamespace="http://www.w3.org/2000/svg";n._distinctThreshold=Math.PI/360;n._animationSpeed=.075;n._unitBezier=new o(.74,.67,.38,.96);return n}e.prototype._activate=function(){var m=this;var e=this._container.renderService.renderCamera$.pipe(a.map(function(e){var t=m._spatial.degToRad(e.perspective.fov);var r=e.perspective.aspect===Number.POSITIVE_INFINITY?Math.PI:Math.atan(e.perspective.aspect*Math.tan(.5*t))*2;return[m._spatial.azimuthalToBearing(e.rotation.phi),r]}),a.distinctUntilChanged(function(e,t){return Math.abs(t[0]-e[0])<m._distinctThreshold&&Math.abs(t[1]-e[1])<m._distinctThreshold}));var t=s.combineLatest(this._navigator.stateService.currentState$.pipe(a.distinctUntilChanged(undefined,function(e){return e.state.currentNode.key})),this._navigator.panService.panNodes$).pipe(a.map(function(e){var t=e[0],r=e[1];var n=t.state.currentNode;var i=t.state.currentTransform;if(n.pano){var o=2*Math.PI*n.gpano.CroppedAreaImageWidthPixels/n.gpano.FullPanoWidthPixels;return[o/2,o/2]}var a=m._computeProjectedPoints(i);var s=m._spatial.degToRad(m._computeHorizontalFov(a));var u=s/2;var c=s/2;for(var h=0,l=r;h<l.length;h++){var p=l[h],f=p[0],d=p[2];var v=m._spatial.wrap(f.ca-n.ca,-180,180);if(v<0){u=m._spatial.degToRad(Math.abs(v))+d/2}else{c=m._spatial.degToRad(Math.abs(v))+d/2}}return[u,c]}),a.distinctUntilChanged(function(e,t){var r=e[0],n=e[1];var i=t[0],o=t[1];return Math.abs(i-r)<m._distinctThreshold&&Math.abs(o-n)<m._distinctThreshold}));var r=s.combineLatest(this._navigator.stateService.currentState$.pipe(a.distinctUntilChanged(undefined,function(e){return e.state.currentNode.key})),this._container.renderService.bearing$).pipe(a.map(function(e){var t=e[0],r=e[1];var n=m._spatial.degToRad(t.state.currentNode.ca-r);return n}));var n=new s.Subject;var i=n.pipe(a.scan(function(e,t){return t(e)},{alpha:0,curr:[0,0,0],prev:[0,0,0]}),a.map(function(e){var t=m._unitBezier.solve(e.alpha);var r=e.curr;var n=e.prev;return[m._interpolate(n[0],r[0],t),m._interpolate(n[1],r[1],t)]}));this._fovSubscription=t.pipe(a.map(function(a){return function(e){var t=m._unitBezier.solve(e.alpha);var r=e.curr;var n=e.prev;var i=[m._interpolate(n[0],r[0],t),m._interpolate(n[1],r[1],t)];var o=a.slice();return{alpha:0,curr:o,prev:i}}})).subscribe(n);this._fovAnimationSubscription=t.pipe(a.switchMap(function(){return m._container.renderService.renderCameraFrame$.pipe(a.skip(1),a.scan(function(e){return e+m._animationSpeed},0),a.takeWhile(function(e){return e<=1+m._animationSpeed}),a.map(function(e){return Math.min(e,1)}))}),a.map(function(t){return function(e){return{alpha:t,curr:e.curr.slice(),prev:e.prev.slice()}}})).subscribe(n);var o=s.combineLatest(r,i).pipe(a.map(function(e){var t=e[0],r=e[1];return[t,r[0],r[1]]}));this._renderSubscription=s.combineLatest(e,o,this._configuration$,this._container.renderService.size$).pipe(a.map(function(e){var t=e[0],r=t[0],n=t[1],i=e[1],o=i[0],a=i[1],s=i[2],u=e[2],c=e[3];var h=m._createBackground(r);var l=m._createFovIndicator(a,s,o);var p=m._createNorth(r);var f=m._createCircleSectorCompass(m._createCircleSector(Math.max(Math.PI/20,n),"#FFF"));var d=u.size===g.default.Small||u.size===g.default.Automatic&&c.width<640?".BearingCompact":"";return{name:m._name,vnode:v.h("div.BearingIndicatorContainer"+d,{oncontextmenu:function(e){e.preventDefault()}},[h,l,p,f])}})).subscribe(this._container.domRenderer.render$)};e.prototype._deactivate=function(){this._renderSubscription.unsubscribe();this._fovSubscription.unsubscribe();this._fovAnimationSubscription.unsubscribe()};e.prototype._getDefaultConfiguration=function(){return{size:g.default.Automatic}};e.prototype._createFovIndicator=function(e,t,r){var n=this._createFovArc(e,t);var i=v.h("g",{attributes:{transform:"translate(18,18)"},namespace:this._svgNamespace},[n]);var o=v.h("svg",{attributes:{viewBox:"0 0 36 36"},namespace:this._svgNamespace,style:{height:"36px",left:"2px",position:"absolute",top:"2px",transform:"rotateZ("+this._spatial.radToDeg(r)+"deg)",width:"36px"}},[i]);return o};e.prototype._createFovArc=function(e,t){var r=16.75;var n=2.5;var i=e+t;if(i>2*Math.PI-Math.PI/90){return v.h("circle",{attributes:{cx:"0",cy:"0","fill-opacity":"0",r:""+r,stroke:"#FFF","stroke-width":""+n},namespace:this._svgNamespace},[])}var o=-Math.PI/2-e;var a=o+i;var s=r*Math.cos(o);var u=r*Math.sin(o);var c=r*Math.cos(a);var h=r*Math.sin(a);var l=i>=Math.PI?1:0;var p="M "+s+" "+u+" A "+r+" "+r+" 0 "+l+" 1 "+c+" "+h;return v.h("path",{attributes:{d:p,"fill-opacity":"0",stroke:"#FFF","stroke-width":""+n},namespace:this._svgNamespace},[])};e.prototype._createCircleSectorCompass=function(e){var t=v.h("g",{attributes:{transform:"translate(1,1)"},namespace:this._svgNamespace},[e]);var r=v.h("svg",{attributes:{viewBox:"0 0 2 2"},namespace:this._svgNamespace,style:{height:"26px",left:"7px",position:"absolute",top:"7px",width:"26px"}},[t]);return r};e.prototype._createCircleSector=function(e,t){if(e>2*Math.PI-Math.PI/90){return v.h("circle",{attributes:{cx:"0",cy:"0",fill:t,r:"1"},namespace:this._svgNamespace},[])}var r=-Math.PI/2-e/2;var n=r+e;var i=Math.cos(r);var o=Math.sin(r);var a=Math.cos(n);var s=Math.sin(n);var u=e>=Math.PI?1:0;var c="M 0 0 "+i+" "+o+" A 1 1 0 "+u+" 1 "+a+" "+s;return v.h("path",{attributes:{d:c,fill:t},namespace:this._svgNamespace},[])};e.prototype._createNorth=function(e){var t=v.h("div.BearingNorth",[]);var r=v.h("div.BearingNorthContainer",{style:{transform:"rotateZ("+this._spatial.radToDeg(-e)+"deg)"}},[t]);return r};e.prototype._createBackground=function(e){return v.h("div.BearingIndicatorBackground",{style:{transform:"rotateZ("+this._spatial.radToDeg(-e)+"deg)"}},[v.h("div.BearingIndicatorBackgroundCircle",[]),v.h("div.BearingIndicatorBackgroundArrowContainer",[v.h("div.BearingIndicatorBackgroundArrow",[])])])};e.prototype._computeProjectedPoints=function(e){var t=[[1,0]];var r=[[0,.5]];var n=12;return u.Geo.computeProjectedPoints(e,t,r,n,this._viewportCoords)};e.prototype._computeHorizontalFov=function(e){var t=this;var r=e.map(function(e){return t._coordToFov(e[0])});var n=Math.min.apply(Math,r);return n};e.prototype._coordToFov=function(e){return this._spatial.radToDeg(2*Math.atan(e))};e.prototype._interpolate=function(e,t,r){return(1-r)*e+r*t};e.componentName="bearing";return e}(i.Component);r.BearingComponent=h;i.ComponentService.register(h);r.default=h},{"../Component":291,"../Geo":294,"../geo/ViewportCoords":414,"./utils/ComponentSize":398,"@mapbox/unitbezier":2,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],308:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var y=e("rxjs");var b=e("rxjs/operators");var w=e("../Edge");var n=e("../Component");var o=function(n){i(e,n);function e(e,t,r){return n.call(this,e,t,r)||this}e.prototype.setDepth=function(e){this.configure({depth:e})};e.prototype._activate=function(){var _=this;this._sequenceSubscription=y.combineLatest(this._navigator.stateService.currentNode$.pipe(b.switchMap(function(e){return e.sequenceEdges$}),b.filter(function(e){return e.cached})),this._configuration$).pipe(b.switchMap(function(e){var t=e[0];var r=e[1];var n=Math.max(0,Math.min(4,r.depth.sequence));var i=_._cache$(t.edges,w.EdgeDirection.Next,n);var o=_._cache$(t.edges,w.EdgeDirection.Prev,n);return y.merge(i,o).pipe(b.catchError(function(e,t){console.error("Failed to cache sequence edges.",e);return y.empty()}))})).subscribe(function(){});this._spatialSubscription=y.combineLatest(this._navigator.stateService.currentNode$.pipe(b.switchMap(function(e){return y.combineLatest(y.of(e),e.spatialEdges$.pipe(b.filter(function(e){return e.cached})))})),this._configuration$).pipe(b.switchMap(function(e){var t=e[0],r=t[0],n=t[1],i=e[1];var o=n.edges;var a=i.depth;var s=Math.max(0,Math.min(2,a.pano));var u=r.pano?0:Math.max(0,Math.min(3,a.step));var c=r.pano?0:Math.max(0,Math.min(1,a.turn));var h=_._cache$(o,w.EdgeDirection.Pano,s);var l=_._cache$(o,w.EdgeDirection.StepForward,u);var p=_._cache$(o,w.EdgeDirection.StepBackward,u);var f=_._cache$(o,w.EdgeDirection.StepLeft,u);var d=_._cache$(o,w.EdgeDirection.StepRight,u);var v=_._cache$(o,w.EdgeDirection.TurnLeft,c);var m=_._cache$(o,w.EdgeDirection.TurnRight,c);var g=_._cache$(o,w.EdgeDirection.TurnU,c);return y.merge(l,p,f,d,h,v,m,g).pipe(b.catchError(function(e,t){console.error("Failed to cache spatial edges.",e);return y.empty()}))})).subscribe(function(){})};e.prototype._deactivate=function(){this._sequenceSubscription.unsubscribe();this._spatialSubscription.unsubscribe()};e.prototype._getDefaultConfiguration=function(){return{depth:{pano:1,sequence:2,step:1,turn:0}}};e.prototype._cache$=function(e,s,t){var u=this;return y.zip(y.of(e),y.of(t)).pipe(b.expand(function(e){var t=e[0];var r=e[1];var n=[];if(r>0){for(var i=0,o=t;i<o.length;i++){var a=o[i];if(a.data.direction===s){n.push(y.zip(u._navigator.graphService.cacheNode$(a.to).pipe(b.mergeMap(function(e){return u._nodeToEdges$(e,s)})),y.of(r-1)))}}}return y.from(n).pipe(b.mergeAll())}),b.skip(1))};e.prototype._nodeToEdges$=function(e,t){return([w.EdgeDirection.Next,w.EdgeDirection.Prev].indexOf(t)>-1?e.sequenceEdges$:e.spatialEdges$).pipe(b.first(function(e){return e.cached}),b.map(function(e){return e.edges}))};e.componentName="cache";return e}(n.Component);r.CacheComponent=o;n.ComponentService.register(o);r.default=o},{"../Component":291,"../Edge":292,rxjs:43,"rxjs/operators":241}],309:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("rxjs/operators");var a=e("rxjs");var i=e("../Utils");var s=function(i){n(e,i);function e(e,t,r){var n=i.call(this)||this;n._activated$=new a.BehaviorSubject(false);n._configurationSubject$=new a.Subject;n._activated=false;n._container=t;n._name=e;n._navigator=r;n._configuration$=n._configurationSubject$.pipe(o.startWith(n.defaultConfiguration),o.scan(function(e,t){for(var r in t){if(t.hasOwnProperty(r)){e[r]=t[r]}}return e}),o.publishReplay(1),o.refCount());n._configuration$.subscribe(function(){});return n}Object.defineProperty(e.prototype,"activated",{get:function(){return this._activated},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"activated$",{get:function(){return this._activated$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"defaultConfiguration",{get:function(){return this._getDefaultConfiguration()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"configuration$",{get:function(){return this._configuration$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:true,configurable:true});e.prototype.activate=function(e){if(this._activated){return}if(e!==undefined){this._configurationSubject$.next(e)}this._activated=true;this._activate();this._activated$.next(true)};e.prototype.configure=function(e){this._configurationSubject$.next(e)};e.prototype.deactivate=function(){if(!this._activated){return}this._activated=false;this._deactivate();this._container.domRenderer.clear(this._name);this._container.glRenderer.clear(this._name);this._activated$.next(false)};e.prototype.resize=function(){return};e.componentName="not_worthy";return e}(i.EventEmitter);r.Component=s;r.default=s},{"../Utils":301,rxjs:43,"rxjs/operators":241}],310:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Error");var i=function(){function i(e,t){this._components={};for(var r in i.registeredComponents){if(!i.registeredComponents.hasOwnProperty(r)){continue}var n=i.registeredComponents[r];this._components[r]={active:false,component:new n(r,e,t)}}this._coverComponent=new i.registeredCoverComponent("cover",e,t);this._coverComponent.activate();this._coverActivated=true}i.register=function(e){if(i.registeredComponents[e.componentName]===undefined){i.registeredComponents[e.componentName]=e}};i.registerCover=function(e){i.registeredCoverComponent=e};Object.defineProperty(i.prototype,"coverActivated",{get:function(){return this._coverActivated},enumerable:true,configurable:true});i.prototype.activateCover=function(){if(this._coverActivated){return}this._coverActivated=true;for(var e in this._components){if(!this._components.hasOwnProperty(e)){continue}var t=this._components[e];if(t.active){t.component.deactivate()}}};i.prototype.deactivateCover=function(){if(!this._coverActivated){return}this._coverActivated=false;for(var e in this._components){if(!this._components.hasOwnProperty(e)){continue}var t=this._components[e];if(t.active){t.component.activate()}}};i.prototype.activate=function(e){this._checkName(e);this._components[e].active=true;if(!this._coverActivated){this.get(e).activate()}};i.prototype.configure=function(e,t){this._checkName(e);this.get(e).configure(t)};i.prototype.deactivate=function(e){this._checkName(e);this._components[e].active=false;if(!this._coverActivated){this.get(e).deactivate()}};i.prototype.get=function(e){return this._components[e].component};i.prototype.getCover=function(){return this._coverComponent};i.prototype._checkName=function(e){if(!(e in this._components)){throw new n.ArgumentMapillaryError("Component does not exist: "+e)}};i.registeredComponents={};return i}();r.ComponentService=i;r.default=i},{"../Error":293}],311:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("rxjs");var s=e("rxjs/operators");var u=e("virtual-dom");var c=e("../Component");var a=e("../Utils");var h=e("../Viewer");var n=function(n){i(e,n);function e(e,t,r){return n.call(this,e,t,r)||this}e.prototype._activate=function(){var a=this;this._configuration$.pipe(s.distinctUntilChanged(undefined,function(e){return e.state}),s.switchMap(function(e){return o.combineLatest(o.of(e.state),a._navigator.stateService.currentNode$)}),s.switchMap(function(e){var t=e[0],r=e[1];var n=o.combineLatest(o.of(r.key),r.image$.pipe(s.filter(function(e){return!!e}),s.map(function(e){return e.src})));return t===c.CoverState.Visible?n.pipe(s.first()):n}),s.distinctUntilChanged(function(e,t){var r=e[0],n=e[1];var i=t[0],o=t[1];return r===i&&n===o}),s.map(function(e){var t=e[0],r=e[1];return{key:t,src:r}})).subscribe(this._configurationSubject$);this._renderSubscription=o.combineLatest(this._configuration$,this._container.renderService.size$).pipe(s.map(function(e){var t=e[0],r=e[1];if(!t.key){return{name:a._name,vnode:u.h("div",[])}}var n=r.width<=640||r.height<=480?".CoverCompact":"";if(t.state===c.CoverState.Hidden){var i=u.h("div.CoverContainer.CoverDone"+n,[a._getCoverBackgroundVNode(t)]);return{name:a._name,vnode:i}}var o=u.h("div.CoverContainer"+n,[a._getCoverButtonVNode(t)]);return{name:a._name,vnode:o}})).subscribe(this._container.domRenderer.render$)};e.prototype._deactivate=function(){this._renderSubscription.unsubscribe();this._keySubscription.unsubscribe()};e.prototype._getDefaultConfiguration=function(){return{state:c.CoverState.Visible}};e.prototype._getCoverButtonVNode=function(e){var t=this;var r=e.state===c.CoverState.Loading?"div.Cover.CoverLoading":"div.Cover";var n=u.h("div.CoverButton",[u.h("div.CoverButtonIcon",[])]);var i=u.h("a.CoverLogo",{href:a.Urls.explore,target:"_blank"},[]);var o=u.h("div.CoverIndicator",{onclick:function(){t.configure({state:c.CoverState.Loading})}},[]);return u.h(r,[this._getCoverBackgroundVNode(e),o,n,i])};e.prototype._getCoverBackgroundVNode=function(e){var t=e.src!=null?e.src:a.Urls.thumbnail(e.key,h.ImageSize.Size640);var r={style:{backgroundImage:"url("+t+")"}};var n=[];if(e.state===c.CoverState.Loading){n.push(u.h("div.Spinner",{},[]))}return u.h("div.CoverBackground",r,n)};e.componentName="cover";return e}(c.Component);r.CoverComponent=n;c.ComponentService.registerCover(n);r.default=n},{"../Component":291,"../Utils":301,"../Viewer":302,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],312:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("rxjs");var a=e("rxjs/operators");var u=e("virtual-dom");var i=e("../Component");var s=function(t){n(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e._open$=new o.BehaviorSubject(false);return e}e.prototype._activate=function(){var i=this;this._disposable=o.combineLatest(this._navigator.stateService.currentState$,this._open$,this._navigator.imageLoadingService.loadstatus$).pipe(a.map(function(e){var t=e[0],r=e[1],n=e[2];return{name:i._name,vnode:i._getDebugVNode(r,i._getDebugInfo(t,n))}})).subscribe(this._container.domRenderer.render$)};e.prototype._deactivate=function(){this._disposable.unsubscribe()};e.prototype._getDefaultConfiguration=function(){return{}};e.prototype._getDebugInfo=function(e,t){var r=[];r.push(u.h("h2","Node"));if(e.state.currentNode){r.push(u.h("p","currentNode: "+e.state.currentNode.key))}if(e.state.previousNode){r.push(u.h("p","previousNode: "+e.state.previousNode.key))}r.push(u.h("h2","Loading"));var n=0;var i=0;var o=0;for(var a in t){if(!t.hasOwnProperty(a)){continue}var s=t[a];n+=s.loaded;if(s.loaded!==s.total){o++}else{i++}}r.push(u.h("p","Loaded Images: "+i));r.push(u.h("p","Loading Images: "+o));r.push(u.h("p","Total bytes loaded: "+n));r.push(u.h("h2","Camera"));r.push(u.h("p","camera.position.x: "+e.state.camera.position.x));r.push(u.h("p","camera.position.y: "+e.state.camera.position.y));r.push(u.h("p","camera.position.z: "+e.state.camera.position.z));r.push(u.h("p","camera.lookat.x: "+e.state.camera.lookat.x));r.push(u.h("p","camera.lookat.y: "+e.state.camera.lookat.y));r.push(u.h("p","camera.lookat.z: "+e.state.camera.lookat.z));r.push(u.h("p","camera.up.x: "+e.state.camera.up.x));r.push(u.h("p","camera.up.y: "+e.state.camera.up.y));r.push(u.h("p","camera.up.z: "+e.state.camera.up.z));return r};e.prototype._getDebugVNode=function(e,t){if(e){return u.h("div.Debug",{},[u.h("h2",{},["Debug"]),this._getDebugVNodeButton(e),u.h("pre",{},t)])}else{return this._getDebugVNodeButton(e)}};e.prototype._getDebugVNodeButton=function(e){var t=e?"Disable Debug":"D";var r=e?"":".DebugButtonFixed";if(e){return u.h("button.DebugButton"+r,{onclick:this._closeDebugElement.bind(this)},[t])}else{return u.h("button.DebugButton"+r,{onclick:this._openDebugElement.bind(this)},[t])}};e.prototype._closeDebugElement=function(e){this._open$.next(false)};e.prototype._openDebugElement=function(){this._open$.next(true)};e.componentName="debug";return e}(i.Component);r.DebugComponent=s;i.ComponentService.register(s);r.default=s},{"../Component":291,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],313:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs");var a=e("rxjs/operators");var s=e("virtual-dom");var o=e("../Component");var u=e("../Utils");var c=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e,t,r)||this;i._canvasId=t.id+"-"+i._name;i._dom=!!n?n:new u.DOM;return i}e.prototype._activate=function(){var t=this;var e=this._container.domRenderer.element$.pipe(a.map(function(e){return t._dom.document.getElementById(t._canvasId)}),a.filter(function(e){return!!e}),a.map(function(e){var t=e.parentElement;var r=t.offsetWidth;var n=t.offsetHeight;return[e,{height:n,width:r}]}),a.distinctUntilChanged(function(e,t){return e.height===t.height&&e.width===t.width},function(e){var t=e[0],r=e[1];return r}));this.drawSubscription=i.combineLatest(e,this._navigator.stateService.currentNode$).subscribe(function(e){var t=e[0],r=t[0],n=t[1],i=e[1];r.width=n.width;r.height=n.height;r.getContext("2d").drawImage(i.image,0,0,n.width,n.height)});this._container.domRenderer.renderAdaptive$.next({name:this._name,vnode:s.h("canvas#"+this._canvasId,[])})};e.prototype._deactivate=function(){this.drawSubscription.unsubscribe()};e.prototype._getDefaultConfiguration=function(){return{}};e.componentName="image";return e}(o.Component);r.ImageComponent=c;o.ComponentService.register(c);r.default=c},{"../Component":291,"../Utils":301,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],314:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("rxjs");var s=e("rxjs/operators");var a=e("virtual-dom");var n=e("../Component");var u=function(n){i(e,n);function e(e,t,r){return n.call(this,e,t,r)||this}e.prototype._activate=function(){var a=this;this._loadingSubscription=this._navigator.loadingService.loading$.pipe(s.switchMap(function(e){return e?a._navigator.imageLoadingService.loadstatus$:o.of({})}),s.map(function(e){var t=0;var r=0;for(var n in e){if(!e.hasOwnProperty(n)){continue}var i=e[n];if(i.loaded!==i.total){r+=i.loaded;t+=i.total}}var o=100;if(t!==0){o=r/t*100}return{name:a._name,vnode:a._getBarVNode(o)}})).subscribe(this._container.domRenderer.render$)};e.prototype._deactivate=function(){this._loadingSubscription.unsubscribe()};e.prototype._getDefaultConfiguration=function(){return{}};e.prototype._getBarVNode=function(e){var t={};var r={};if(e!==100){t.width=e.toFixed(0)+"%";t.opacity="1"}else{t.width="100%";t.opacity="0"}return a.h("div.Loading",{style:r},[a.h("div.LoadingBar",{style:t},[])])};e.componentName="loading";return e}(n.Component);r.LoadingComponent=u;n.ComponentService.register(u);r.default=u},{"../Component":291,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],315:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("rxjs");var a=e("rxjs/operators");var c=e("virtual-dom");var s=e("../Edge");var u=e("../Error");var i=e("../Component");var h=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e,t,r)||this;n._seqNames={};n._seqNames[s.EdgeDirection[s.EdgeDirection.Prev]]="Prev";n._seqNames[s.EdgeDirection[s.EdgeDirection.Next]]="Next";n._spaTopNames={};n._spaTopNames[s.EdgeDirection[s.EdgeDirection.TurnLeft]]="Turnleft";n._spaTopNames[s.EdgeDirection[s.EdgeDirection.StepLeft]]="Left";n._spaTopNames[s.EdgeDirection[s.EdgeDirection.StepForward]]="Forward";n._spaTopNames[s.EdgeDirection[s.EdgeDirection.StepRight]]="Right";n._spaTopNames[s.EdgeDirection[s.EdgeDirection.TurnRight]]="Turnright";n._spaBottomNames={};n._spaBottomNames[s.EdgeDirection[s.EdgeDirection.TurnU]]="Turnaround";n._spaBottomNames[s.EdgeDirection[s.EdgeDirection.StepBackward]]="Backward";return n}e.prototype._activate=function(){var u=this;this._renderSubscription=o.combineLatest(this._navigator.stateService.currentNode$,this._configuration$).pipe(a.switchMap(function(e){var t=e[0],r=e[1];var n=r.sequence?t.sequenceEdges$.pipe(a.map(function(e){return e.edges.map(function(e){return e.data.direction})})):o.of([]);var i=!t.pano&&r.spatial?t.spatialEdges$.pipe(a.map(function(e){return e.edges.map(function(e){return e.data.direction})})):o.of([]);return o.combineLatest(n,i).pipe(a.map(function(e){var t=e[0],r=e[1];return t.concat(r)}))}),a.map(function(e){var t=u._createArrowRow(u._seqNames,e);var r=u._createArrowRow(u._spaTopNames,e);var n=u._createArrowRow(u._spaBottomNames,e);var i=c.h("div.NavigationSequence",t);var o=c.h("div.NavigationSpatialTop",r);var a=c.h("div.NavigationSpatialBottom",n);var s=c.h("div.NavigationSpatial",[o,a]);return{name:u._name,vnode:c.h("div.NavigationContainer",[i,s])}})).subscribe(this._container.domRenderer.render$)};e.prototype._deactivate=function(){this._renderSubscription.unsubscribe()};e.prototype._getDefaultConfiguration=function(){return{sequence:true,spatial:true}};e.prototype._createArrowRow=function(e,t){var r=[];for(var n in e){if(!e.hasOwnProperty(n)){continue}var i=s.EdgeDirection[n];if(t.indexOf(i)!==-1){r.push(this._createVNode(i,e[n],"visible"))}else{r.push(this._createVNode(i,e[n],"hidden"))}}return r};e.prototype._createVNode=function(t,e,r){var n=this;return c.h("span.Direction.Direction"+e,{onclick:function(e){n._navigator.moveDir$(t).subscribe(undefined,function(e){if(!(e instanceof u.AbortMapillaryError)){console.error(e)}})},style:{visibility:r}},[])};e.componentName="navigation";return e}(i.Component);r.NavigationComponent=h;i.ComponentService.register(h);r.default=h},{"../Component":291,"../Edge":292,"../Error":293,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],316:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var s=e("rxjs");var o=e("rxjs/operators");var u=e("virtual-dom");var n=e("../Component");var c=function(){function e(){}return e}();var h=function(){function e(){}return e}();var l=function(){function e(){this.nodeInstructions=[];this.nodeInstructionsOrdered=[]}return e}();var a=function(n){i(e,n);function e(e,t,r){return n.call(this,e,t,r)||this}e.prototype._activate=function(){var a=this;var e=this._navigator.stateService.currentState$.pipe(o.filter(function(e){return e.id%2===0}),o.filter(function(e){return e.state.nodesAhead<15}),o.distinctUntilChanged(undefined,function(e){return e.state.lastNode.key}));var t=s.combineLatest(this.configuration$.pipe(o.mergeMap(function(e){return s.from(e.paths)}),o.distinct(function(e){return e.sequenceKey}),o.mergeMap(function(t){return a._navigator.apiV3.sequenceByKey$([t.sequenceKey]).pipe(o.map(function(e){return e[t.sequenceKey]}))})),this.configuration$).pipe(o.map(function(e){var t=e[0],r=e[1];var n=0;var i=[];for(var o=0,a=r.paths;o<a.length;o++){var s=a[o];if(s.sequenceKey===t.key){var u=[];var c=false;for(var h=0,l=t.keys;h<l.length;h++){var p=l[h];if(s.startKey===p){c=true}if(c){var f=null;for(var d=0,v=s.infoKeys;d<v.length;d++){var m=v[d];if(m.key===p){f=m.description}}u.push({description:f,key:p})}if(s.stopKey===p){c=false}}i.push({nodeInstructions:u,place:n})}n++}return i}),o.scan(function(e,t){for(var r=0,n=t;r<n.length;r++){var i=n[r];e.nodeInstructionsOrdered[i.place]=i.nodeInstructions}for(var o in e.nodeInstructionsOrdered){if(!e.nodeInstructionsOrdered.hasOwnProperty(o)){continue}var a=e.nodeInstructionsOrdered[o];for(var s=0,u=a;s<u.length;s++){var c=u[s];e.nodeInstructions.push(c)}}return e},new l));var r=s.combineLatest(e,t,this.configuration$).pipe(o.map(function(e){var t=e[0],r=e[1],n=e[2];return{conf:n,frame:t,routeTrack:r}}),o.scan(function(e,t){if(t.conf.playing===undefined||t.conf.playing){e.routeTrack=t.routeTrack;e.currentNode=t.frame.state.currentNode;e.lastNode=t.frame.state.lastNode;e.playing=true}else{a._navigator.stateService.cutNodes();e.playing=false}return e},new h),o.filter(function(e){return e.playing}),o.filter(function(e){for(var t=0,r=e.routeTrack.nodeInstructions;t<r.length;t++){var n=r[t];if(!n){continue}if(n.key===e.lastNode.key){return true}}return false}),o.distinctUntilChanged(undefined,function(e){return e.lastNode.key}),o.mergeMap(function(e){var t=0;for(var r=0,n=e.routeTrack.nodeInstructions;r<n.length;r++){var i=n[r];if(i.key===e.lastNode.key){break}t++}var o=e.routeTrack.nodeInstructions[t+1];if(!o){return s.of(null)}return a._navigator.graphService.cacheNode$(o.key)}));this._disposable=s.combineLatest(r,this.configuration$).pipe(o.map(function(e){var t=e[0],r=e[1];return{conf:r,node:t}}),o.filter(function(e){return e.node!==null&&e.conf.playing}),o.pluck("node")).subscribe(this._navigator.stateService.appendNode$);this._disposableDescription=s.combineLatest(this._navigator.stateService.currentNode$,t,this.configuration$).pipe(o.map(function(e){var t=e[0],r=e[1],n=e[2];if(n.playing!==undefined&&!n.playing){return"quit"}var i=null;for(var o=0,a=r.nodeInstructions;o<a.length;o++){var s=a[o];if(s.key===t.key){i=s.description;break}}return i}),o.scan(function(e,t){if(t!==e.description&&t!==null){e.description=t;e.showsLeft=6}else{e.showsLeft--}if(t==="quit"){e.description=null}return e},new c),o.map(function(e){if(e.showsLeft>0&&e.description){return{name:a._name,vnode:a._getRouteAnnotationNode(e.description)}}else{return{name:a._name,vnode:u.h("div",[])}}})).subscribe(this._container.domRenderer.render$)};e.prototype._deactivate=function(){this._disposable.unsubscribe();this._disposableDescription.unsubscribe()};e.prototype._getDefaultConfiguration=function(){return{}};e.prototype.play=function(){this.configure({playing:true})};e.prototype.stop=function(){this.configure({playing:false})};e.prototype._getRouteAnnotationNode=function(e){return u.h("div.RouteFrame",{},[u.h("p",{textContent:e},[])])};e.componentName="route";return e}(n.Component);r.RouteComponent=a;n.ComponentService.register(a);r.default=a},{"../Component":291,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],317:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs");var a=e("rxjs/operators");var o=e("../Component");var s=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e,t,r)||this;i._scheduler=n;return i}e.prototype._activate=function(){var e=this;this._sequenceSubscription=this._navigator.stateService.currentNode$.pipe(a.scan(function(e,t){var r=t.sequenceKey;e.report=[];if(!(r in e.reported)){e.report=[r];e.reported[r]=true}return e},{report:[],reported:{}}),a.filter(function(e){return e.report.length>0}),a.mergeMap(function(r){return e._navigator.apiV3.sequenceViewAdd$(r.report).pipe(a.catchError(function(e,t){console.error("Failed to report sequence stats ("+r.report+")",e);return i.empty()}))})).subscribe(function(){});this._imageSubscription=this._navigator.stateService.currentNode$.pipe(a.map(function(e){return e.key})).pipe(a.buffer(this._navigator.stateService.currentNode$.pipe(a.debounceTime(5e3,this._scheduler))),a.scan(function(e,t){e.report=[];for(var r=0,n=t;r<n.length;r++){var i=n[r];if(!(i in e.reported)){e.report.push(i);e.reported[i]=true}}return e},{report:[],reported:{}}),a.filter(function(e){return e.report.length>0}),a.mergeMap(function(r){return e._navigator.apiV3.imageViewAdd$(r.report).pipe(a.catchError(function(e,t){console.error("Failed to report image stats ("+r.report+")",e);return i.empty()}))})).subscribe(function(){})};e.prototype._deactivate=function(){this._sequenceSubscription.unsubscribe();this._imageSubscription.unsubscribe()};e.prototype._getDefaultConfiguration=function(){return{}};e.componentName="stats";return e}(o.Component);r.StatsComponent=s;o.ComponentService.register(s);r.default=s},{"../Component":291,rxjs:43,"rxjs/operators":241}],318:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("virtual-dom");var a=e("rxjs");var s=e("rxjs/operators");var u=e("../../Component");var o=function(o){n(t,o);function t(e,t,r,n){var i=o.call(this,e,t,r)||this;i._renderer=!!n?n:new u.DirectionDOMRenderer(i.defaultConfiguration,{height:t.element.offsetHeight,width:t.element.offsetWidth});i._hoveredKeySubject$=new a.Subject;i._hoveredKey$=i._hoveredKeySubject$.pipe(s.share());return i}Object.defineProperty(t.prototype,"hoveredKey$",{get:function(){return this._hoveredKey$},enumerable:true,configurable:true});t.prototype.setHighlightKey=function(e){this.configure({highlightKey:e})};t.prototype.setMinWidth=function(e){this.configure({minWidth:e})};t.prototype.setMaxWidth=function(e){this.configure({maxWidth:e})};t.prototype._activate=function(){var n=this;this._configurationSubscription=this._configuration$.subscribe(function(e){n._renderer.setConfiguration(e)});this._resizeSubscription=this._container.renderService.size$.subscribe(function(e){n._renderer.resize(e)});this._nodeSubscription=this._navigator.stateService.currentNode$.pipe(s.tap(function(e){n._container.domRenderer.render$.next({name:n._name,vnode:i.h("div",{},[])});n._renderer.setNode(e)}),s.withLatestFrom(this._configuration$),s.switchMap(function(e){var r=e[0],t=e[1];return a.combineLatest(r.spatialEdges$,t.distinguishSequence?n._navigator.graphService.cacheSequence$(r.sequenceKey).pipe(s.catchError(function(e,t){console.error("Failed to cache sequence ("+r.sequenceKey+")",e);return a.of(null)})):a.of(null))})).subscribe(function(e){var t=e[0],r=e[1];n._renderer.setEdges(t,r)});this._renderCameraSubscription=this._container.renderService.renderCameraFrame$.pipe(s.tap(function(e){n._renderer.setRenderCamera(e)}),s.map(function(){return n._renderer}),s.filter(function(e){return e.needsRender}),s.map(function(e){return{name:n._name,vnode:e.render(n._navigator)}})).subscribe(this._container.domRenderer.render$);this._hoveredKeySubscription=a.combineLatest(this._container.domRenderer.element$,this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$.pipe(s.startWith(null)),this._container.mouseService.mouseUp$.pipe(s.startWith(null))).pipe(s.map(function(e){var t=e[0];var r=t.getElementsByClassName("DirectionsPerspective");for(var n=0;n<r.length;n++){var i=r.item(n).querySelector(":hover");if(i!=null&&i.hasAttribute("data-key")){return i.getAttribute("data-key")}}return null}),s.distinctUntilChanged()).subscribe(this._hoveredKeySubject$);this._emitHoveredKeySubscription=this._hoveredKey$.subscribe(function(e){n.fire(t.hoveredkeychanged,e)})};t.prototype._deactivate=function(){this._configurationSubscription.unsubscribe();this._emitHoveredKeySubscription.unsubscribe();this._hoveredKeySubscription.unsubscribe();this._nodeSubscription.unsubscribe();this._renderCameraSubscription.unsubscribe()};t.prototype._getDefaultConfiguration=function(){return{distinguishSequence:false,maxWidth:460,minWidth:260}};t.componentName="direction";t.hoveredkeychanged="hoveredkeychanged";return t}(u.Component);r.DirectionComponent=o;u.ComponentService.register(o);r.default=o},{"../../Component":291,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],319:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../../Geo");var i=function(){function e(e,t){this._spatial=new n.Spatial;this._minThresholdWidth=320;this._maxThresholdWidth=1480;this._minThresholdHeight=240;this._maxThresholdHeight=820;this._configure(e);this._resize(t);this._reset()}Object.defineProperty(e.prototype,"minWidth",{get:function(){return this._minWidth},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"containerWidth",{get:function(){return this._containerWidth},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"containerWidthCss",{get:function(){return this._containerWidthCss},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"containerMarginCss",{get:function(){return this._containerMarginCss},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"containerLeftCss",{get:function(){return this._containerLeftCss},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"containerHeight",{get:function(){return this._containerHeight},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"containerHeightCss",{get:function(){return this._containerHeightCss},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"containerBottomCss",{get:function(){return this._containerBottomCss},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"stepCircleSize",{get:function(){return this._stepCircleSize},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"stepCircleSizeCss",{get:function(){return this._stepCircleSizeCss},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"stepCircleMarginCss",{get:function(){return this._stepCircleMarginCss},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"turnCircleSize",{get:function(){return this._turnCircleSize},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"turnCircleSizeCss",{get:function(){return this._turnCircleSizeCss},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"outerRadius",{get:function(){return this._outerRadius},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"innerRadius",{get:function(){return this._innerRadius},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"shadowOffset",{get:function(){return this._shadowOffset},enumerable:true,configurable:true});e.prototype.configure=function(e){this._configure(e);this._reset()};e.prototype.resize=function(e){this._resize(e);this._reset()};e.prototype.angleToCoordinates=function(e){return[Math.cos(e),Math.sin(e)]};e.prototype.relativeAngleToCoordiantes=function(e,t){var r=this._spatial.wrapAngle(e-t);return this.angleToCoordinates(r)};e.prototype._configure=function(e){this._minWidth=e.minWidth;this._maxWidth=this._getMaxWidth(e.minWidth,e.maxWidth)};e.prototype._resize=function(e){this._elementWidth=e.width;this._elementHeight=e.height};e.prototype._reset=function(){this._containerWidth=this._getContainerWidth(this._elementWidth,this._elementHeight);this._containerHeight=this._getContainerHeight(this.containerWidth);this._stepCircleSize=this._getStepCircleDiameter(this._containerHeight);this._turnCircleSize=this._getTurnCircleDiameter(this.containerHeight);this._outerRadius=this._getOuterRadius(this._containerHeight);this._innerRadius=this._getInnerRadius(this._containerHeight);this._shadowOffset=3;this._containerWidthCss=this._numberToCssPixels(this._containerWidth);this._containerMarginCss=this._numberToCssPixels(-.5*this._containerWidth);this._containerLeftCss=this._numberToCssPixels(Math.floor(.5*this._elementWidth));this._containerHeightCss=this._numberToCssPixels(this._containerHeight);this._containerBottomCss=this._numberToCssPixels(Math.floor(-.08*this._containerHeight));this._stepCircleSizeCss=this._numberToCssPixels(this._stepCircleSize);this._stepCircleMarginCss=this._numberToCssPixels(-.5*this._stepCircleSize);this._turnCircleSizeCss=this._numberToCssPixels(this._turnCircleSize)};e.prototype._getContainerWidth=function(e,t){var r=(e-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth);var n=(t-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight);var i=Math.max(0,Math.min(1,Math.min(r,n)));i=.04*Math.round(25*i);return this._minWidth+i*(this._maxWidth-this._minWidth)};e.prototype._getContainerHeight=function(e){return.77*e};e.prototype._getStepCircleDiameter=function(e){return.34*e};e.prototype._getTurnCircleDiameter=function(e){return.3*e};e.prototype._getOuterRadius=function(e){return.31*e};e.prototype._getInnerRadius=function(e){return.125*e};e.prototype._numberToCssPixels=function(e){return e+"px"};e.prototype._getMaxWidth=function(e,t){return e>t?e:t};return e}();r.DirectionDOMCalculator=i;r.default=i},{"../../Geo":294}],320:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var w=e("virtual-dom");var n=e("../../Component");var f=e("../../Edge");var c=e("../../Error");var i=e("../../Geo");var o=function(){function e(e,t){this._isEdge=false;this._spatial=new i.Spatial;this._calculator=new n.DirectionDOMCalculator(e,t);this._node=null;this._rotation={phi:0,theta:0};this._epsilon=.5*Math.PI/180;this._highlightKey=null;this._distinguishSequence=false;this._needsRender=false;this._stepEdges=[];this._turnEdges=[];this._panoEdges=[];this._sequenceEdgeKeys=[];this._stepDirections=[f.EdgeDirection.StepForward,f.EdgeDirection.StepBackward,f.EdgeDirection.StepLeft,f.EdgeDirection.StepRight];this._turnDirections=[f.EdgeDirection.TurnLeft,f.EdgeDirection.TurnRight,f.EdgeDirection.TurnU];this._turnNames={};this._turnNames[f.EdgeDirection.TurnLeft]="TurnLeft";this._turnNames[f.EdgeDirection.TurnRight]="TurnRight";this._turnNames[f.EdgeDirection.TurnU]="TurnAround";var r=!!document.documentMode;this._isEdge=!r&&!!window.StyleMedia}Object.defineProperty(e.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:true,configurable:true});e.prototype.render=function(e){this._needsRender=false;var t=this._rotation;var r=[];var n=[];if(this._node.pano){r=r.concat(this._createPanoArrows(e,t))}else{r=r.concat(this._createPerspectiveToPanoArrows(e,t));r=r.concat(this._createStepArrows(e,t));n=n.concat(this._createTurnArrows(e))}return this._getContainer(r,n,t)};e.prototype.setEdges=function(e,t){this._setEdges(e,t);this._setNeedsRender()};e.prototype.setNode=function(e){this._node=e;this._clearEdges();this._setNeedsRender()};e.prototype.setRenderCamera=function(e){var t=e.rotation;if(Math.abs(t.phi-this._rotation.phi)<this._epsilon){return}this._rotation=t;this._setNeedsRender()};e.prototype.setConfiguration=function(e){var t=false;if(this._highlightKey!==e.highlightKey||this._distinguishSequence!==e.distinguishSequence){this._highlightKey=e.highlightKey;this._distinguishSequence=e.distinguishSequence;t=true}if(this._calculator.minWidth!==e.minWidth||this._calculator.maxWidth!==e.maxWidth){this._calculator.configure(e);t=true}if(t){this._setNeedsRender()}};e.prototype.resize=function(e){this._calculator.resize(e);this._setNeedsRender()};e.prototype._setNeedsRender=function(){if(this._node!=null){this._needsRender=true}};e.prototype._clearEdges=function(){this._stepEdges=[];this._turnEdges=[];this._panoEdges=[];this._sequenceEdgeKeys=[]};e.prototype._setEdges=function(e,t){this._stepEdges=[];this._turnEdges=[];this._panoEdges=[];this._sequenceEdgeKeys=[];for(var r=0,n=e.edges;r<n.length;r++){var i=n[r];var o=i.data.direction;if(this._stepDirections.indexOf(o)>-1){this._stepEdges.push(i);continue}if(this._turnDirections.indexOf(o)>-1){this._turnEdges.push(i);continue}if(i.data.direction===f.EdgeDirection.Pano){this._panoEdges.push(i)}}if(this._distinguishSequence&&t!=null){var a=this._panoEdges.concat(this._stepEdges).concat(this._turnEdges);for(var s=0,u=a;s<u.length;s++){var i=u[s];var c=i.to;for(var h=0,l=t.keys;h<l.length;h++){var p=l[h];if(p===c){this._sequenceEdgeKeys.push(c);break}}}}};e.prototype._createPanoArrows=function(e,t){var r=[];for(var n=0,i=this._panoEdges;n<i.length;n++){var o=i[n];r.push(this._createVNodeByKey(e,o.to,o.data.worldMotionAzimuth,t,this._calculator.outerRadius,"DirectionsArrowPano"))}for(var a=0,s=this._stepEdges;a<s.length;a++){var u=s[a];r.push(this._createPanoToPerspectiveArrow(e,u.to,u.data.worldMotionAzimuth,t,u.data.direction))}return r};e.prototype._createPanoToPerspectiveArrow=function(e,t,r,n,i){var o=Math.PI/8;var a=n.phi;switch(i){case f.EdgeDirection.StepBackward:a=n.phi-Math.PI;break;case f.EdgeDirection.StepLeft:a=n.phi+Math.PI/2;break;case f.EdgeDirection.StepRight:a=n.phi-Math.PI/2;break;default:break}if(Math.abs(this._spatial.wrapAngle(r-a))<o){return this._createVNodeByKey(e,t,r,n,this._calculator.outerRadius,"DirectionsArrowStep")}return this._createVNodeDisabled(t,r,n)};e.prototype._createPerspectiveToPanoArrows=function(e,t){var r=[];for(var n=0,i=this._panoEdges;n<i.length;n++){var o=i[n];r.push(this._createVNodeByKey(e,o.to,o.data.worldMotionAzimuth,t,this._calculator.innerRadius,"DirectionsArrowPano",true))}return r};e.prototype._createStepArrows=function(e,t){var r=[];for(var n=0,i=this._stepEdges;n<i.length;n++){var o=i[n];r.push(this._createVNodeByDirection(e,o.to,o.data.worldMotionAzimuth,t,o.data.direction))}return r};e.prototype._createTurnArrows=function(e){var t=[];for(var r=0,n=this._turnEdges;r<n.length;r++){var i=n[r];var o=i.data.direction;var a=this._turnNames[o];t.push(this._createVNodeByTurn(e,i.to,a,o))}return t};e.prototype._createVNodeByKey=function(t,r,e,n,i,o,a){var s=function(e){t.moveToKey$(r).subscribe(undefined,function(e){if(!(e instanceof c.AbortMapillaryError)){console.error(e)}})};return this._createVNode(r,e,n,i,o,"DirectionsCircle",s,a)};e.prototype._createVNodeByDirection=function(t,e,r,n,i){var o=function(e){t.moveDir$(i).subscribe(undefined,function(e){if(!(e instanceof c.AbortMapillaryError)){console.error(e)}})};return this._createVNode(e,r,n,this._calculator.outerRadius,"DirectionsArrowStep","DirectionsCircle",o)};e.prototype._createVNodeByTurn=function(t,e,r,n){var i=function(e){t.moveDir$(n).subscribe(undefined,function(e){if(!(e instanceof c.AbortMapillaryError)){console.error(e)}})};var o={height:this._calculator.turnCircleSizeCss,transform:"rotate(0)",width:this._calculator.turnCircleSizeCss};switch(n){case f.EdgeDirection.TurnLeft:o.left="5px";o.top="5px";break;case f.EdgeDirection.TurnRight:o.right="5px";o.top="5px";break;case f.EdgeDirection.TurnU:o.left="5px";o.bottom="5px";break;default:break}var a={attributes:{"data-key":e},onclick:i,style:o};var s="TurnCircle";if(this._sequenceEdgeKeys.indexOf(e)>-1){s+="Sequence"}if(this._highlightKey===e){s+="Highlight"}var u=w.h("div."+r,{},[]);return w.h("div."+s,a,[u])};e.prototype._createVNodeDisabled=function(e,t,r){return this._createVNode(e,t,r,this._calculator.outerRadius,"DirectionsArrowDisabled","DirectionsCircleDisabled")};e.prototype._createVNode=function(e,t,r,n,i,o,a,s){var u=this._calculator.angleToCoordinates(t-r.phi);var c=Math.round(-n*u[1]+.5*this._calculator.containerWidth);var h=Math.round(-n*u[0]+.5*this._calculator.containerHeight);var l=this._calculator.relativeAngleToCoordiantes(t,r.phi);var p=this._calculator.shadowOffset;var f=-p*l[1];var d=p*l[0];var v="drop-shadow("+f+"px "+d+"px 1px rgba(0,0,0,0.8))";var m={style:{"-webkit-filter":v,filter:v}};var g=w.h("div."+i,m,[]);var _=-this._spatial.radToDeg(t-r.phi);var y=s?"translate("+c+"px, "+h+"px) rotate("+_+"deg) translateZ(-0.01px)":"translate("+c+"px, "+h+"px) rotate("+_+"deg)";var b={attributes:{"data-key":e},onclick:a,style:{height:this._calculator.stepCircleSizeCss,marginLeft:this._calculator.stepCircleMarginCss,marginTop:this._calculator.stepCircleMarginCss,transform:y,width:this._calculator.stepCircleSizeCss}};if(this._sequenceEdgeKeys.indexOf(e)>-1){o+="Sequence"}if(this._highlightKey===e){o+="Highlight"}return w.h("div."+o,b,[g])};e.prototype._getContainer=function(e,t,r){var n=this._isEdge?"rotateX(60deg)":"perspective("+this._calculator.containerWidthCss+") rotateX(60deg)";var i={oncontextmenu:function(e){e.preventDefault()},style:{bottom:this._calculator.containerBottomCss,height:this._calculator.containerHeightCss,left:this._calculator.containerLeftCss,marginLeft:this._calculator.containerMarginCss,transform:n,width:this._calculator.containerWidthCss}};return w.h("div.DirectionsPerspective",i,t.concat(e))};return e}();r.DirectionDOMRenderer=o;r.default=o},{"../../Component":291,"../../Edge":292,"../../Error":293,"../../Geo":294,"virtual-dom":247}],321:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var m=e("rxjs");var g=e("rxjs/operators");var o=e("../../Component");var s=e("../../Viewer");var u=e("../../Render");var c=e("../../Tiles");var h=e("../../Utils");var _=e("../../geo/ViewportCoords");var y=e("../../geo/Spatial");var i=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e,t,r)||this;n._imageTileLoader=new c.ImageTileLoader(h.Urls.tileScheme,h.Urls.tileDomain,h.Urls.origin);n._roiCalculator=new c.RegionOfInterestCalculator;n._rendererOperation$=new m.Subject;n._rendererCreator$=new m.Subject;n._rendererDisposer$=new m.Subject;n._renderer$=n._rendererOperation$.pipe(g.scan(function(e,t){return t(e)},null),g.filter(function(e){return e!=null}),g.distinctUntilChanged(undefined,function(e){return e.frameId}));n._rendererCreator$.pipe(g.map(function(){return function(e){if(e!=null){throw new Error("Multiple image plane states can not be created at the same time")}return new o.ImagePlaneGLRenderer}})).subscribe(n._rendererOperation$);n._rendererDisposer$.pipe(g.map(function(){return function(e){e.dispose();return null}})).subscribe(n._rendererOperation$);return n}e.prototype._activate=function(){var v=this;this._rendererSubscription=this._renderer$.pipe(g.map(function(e){var t={name:v._name,render:{frameId:e.frameId,needsRender:e.needsRender,render:e.render.bind(e),stage:u.GLRenderStage.Background}};e.clearNeedsRender();return t})).subscribe(this._container.glRenderer.render$);this._rendererCreator$.next(null);this._stateSubscription=this._navigator.stateService.currentState$.pipe(g.map(function(t){return function(e){e.updateFrame(t);return e}})).subscribe(this._rendererOperation$);var t=this._navigator.stateService.currentState$.pipe(g.distinctUntilChanged(undefined,function(e){return e.state.currentNode.key}),g.withLatestFrom(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),g.map(function(e){var t=e[0],r=e[1],n=e[2];var i=t.state;var o=Math.max(n.width,n.height);var a=i.currentNode;var s=i.currentTransform;var u=o>2048?2048:o>1024?1024:512;return new c.TextureProvider(a.key,s.basicWidth,s.basicHeight,u,a.image,v._imageTileLoader,new c.ImageTileStore,r)}),g.publishReplay(1),g.refCount());this._textureProviderSubscription=t.subscribe(function(){});this._setTextureProviderSubscription=t.pipe(g.map(function(t){return function(e){e.setTextureProvider(t.key,t);return e}})).subscribe(this._rendererOperation$);this._setTileSizeSubscription=this._container.renderService.size$.pipe(g.switchMap(function(e){return m.combineLatest(t,m.of(e)).pipe(g.first())})).subscribe(function(e){var t=e[0],r=e[1];var n=Math.max(r.width,r.height);var i=n>2048?2048:n>1024?1024:512;t.setTileSize(i)});this._abortTextureProviderSubscription=t.pipe(g.pairwise()).subscribe(function(e){var t=e[0];t.abort()});var e=m.combineLatest(this._container.renderService.renderCameraFrame$,this._container.renderService.size$.pipe(g.debounceTime(250))).pipe(g.map(function(e){var t=e[0],r=e[1];return[t.camera.position.clone(),t.camera.lookat.clone(),t.zoom.valueOf(),r.height.valueOf(),r.width.valueOf()]}),g.pairwise(),g.skipWhile(function(e){return e[1][2]-e[0][2]<0||e[1][2]===0}),g.map(function(e){var t=e[0][0].equals(e[1][0]);var r=e[0][1].equals(e[1][1]);var n=e[0][2]===e[1][2];var i=e[0][3]===e[1][3];var o=e[0][4]===e[1][4];return t&&r&&n&&i&&o}),g.distinctUntilChanged(),g.filter(function(e){return e}),g.switchMap(function(e){return v._container.renderService.renderCameraFrame$.pipe(g.first())}),g.withLatestFrom(this._container.renderService.size$,this._navigator.stateService.currentTransform$));this._setRegionOfInterestSubscription=t.pipe(g.switchMap(function(o){return e.pipe(g.map(function(e){var t=e[0],r=e[1],n=e[2];var i=(new _.default).viewportToBasic(0,0,n,t.perspective);if(i[0]<0||i[1]<0||i[0]>1||i[1]>1){return undefined}return[v._roiCalculator.computeRegionOfInterest(t,r,n),o]}),g.filter(function(e){return!!e}))}),g.filter(function(e){return!e[1].disposed})).subscribe(function(e){var t=e[0];var r=e[1];r.setRegionOfInterest(t)});var n=t.pipe(g.switchMap(function(e){return e.hasTexture$}),g.startWith(false),g.publishReplay(1),g.refCount());this._hasTextureSubscription=n.subscribe(function(){});var r=this._navigator.stateService.currentState$.pipe(g.filter(function(e){return e.state.nodesAhead===0}),g.map(function(e){return e.state.currentNode}),g.distinctUntilChanged(undefined,function(e){return e.key}),g.debounceTime(1e3),g.withLatestFrom(n),g.filter(function(e){return!e[1]}),g.map(function(e){return e[0]}),g.filter(function(e){return e.pano?h.Settings.maxImageSize>h.Settings.basePanoramaSize:h.Settings.maxImageSize>h.Settings.baseImageSize}),g.switchMap(function(r){var e=r.pano?h.Settings.basePanoramaSize:h.Settings.baseImageSize;if(Math.max(r.image.width,r.image.height)>e){return m.empty()}var t=r.cacheImage$(h.Settings.maxImageSize).pipe(g.map(function(e){return[e.image,e]}));return t.pipe(g.takeUntil(n.pipe(g.filter(function(e){return e}))),g.catchError(function(e,t){console.error("Failed to fetch high res image ("+r.key+")",e);return m.empty()}))})).pipe(g.publish(),g.refCount());this._updateBackgroundSubscription=r.pipe(g.withLatestFrom(t)).subscribe(function(e){if(e[0][1].key!==e[1].key||e[1].disposed){return}e[1].updateBackground(e[0][0])});this._updateTextureImageSubscription=r.pipe(g.map(function(t){return function(e){e.updateTextureImage(t[0],t[1]);return e}})).subscribe(this._rendererOperation$);this._clearPeripheryPlaneSubscription=this._navigator.panService.panNodes$.pipe(g.filter(function(e){return e.length===0}),g.map(function(){return function(e){e.clearPeripheryPlanes();return e}})).subscribe(this._rendererOperation$);var i=this._navigator.panService.panNodes$.pipe(g.switchMap(function(e){return m.from(e).pipe(g.mergeMap(function(e){var t=e[0],r=e[1];return m.combineLatest(v._navigator.graphService.cacheNode$(t.key).pipe(g.catchError(function(e){console.error("Failed to cache periphery node ("+t.key+")",e);return m.empty()})),m.of(r))}))}),g.share());this._addPeripheryPlaneSubscription=i.pipe(g.map(function(e){var t=e[0],r=e[1];return function(e){e.addPeripheryPlane(t,r);return e}})).subscribe(this._rendererOperation$);this._updatePeripheryPlaneTextureSubscription=i.pipe(g.mergeMap(function(e){var t=e[0];return s.ImageSize.Size2048>Math.max(t.image.width,t.image.height)?t.cacheImage$(s.ImageSize.Size2048).pipe(g.catchError(function(){return m.empty()})):m.empty()}),g.map(function(t){return function(e){e.updateTextureImage(t.image,t);return e}})).subscribe(this._rendererOperation$);var o=this._navigator.stateService.currentState$.pipe(g.map(function(e){return e.state.alpha<1}),g.distinctUntilChanged());var a=m.combineLatest(this._container.mouseService.active$,this._container.touchService.active$,this._navigator.stateService.inMotion$,o).pipe(g.map(function(e){var t=e[0],r=e[1],n=e[2],i=e[3];return!(t||r||n||i)}),g.filter(function(e){return e}));this._moveToPeripheryNodeSubscription=this._navigator.panService.panNodes$.pipe(g.switchMap(function(i){return a.pipe(g.withLatestFrom(v._container.renderService.renderCamera$,v._navigator.stateService.currentNode$,v._navigator.stateService.currentTransform$),g.mergeMap(function(e){var t=e[1],r=e[2],n=e[3];return m.of([t,r,n,i])}))}),g.switchMap(function(e){var t=e[0],r=e[1],n=e[2],i=e[3];var o=t.camera.lookat.clone().sub(t.camera.position);var a=(new y.default).viewingDirection(r.rotation);var s=a.angleTo(o);var u=[s,undefined];var c=(new _.default).viewportToBasic(0,0,n,t.perspective);if(c[0]>=0&&c[0]<=1&&c[1]>=0&&c[1]<=1){u[0]=Number.NEGATIVE_INFINITY}for(var h=0,l=i;h<l.length;h++){var p=l[h][0];var f=(new y.default).viewingDirection(p.rotation);var d=f.angleTo(o);if(d<u[0]){u[0]=d;u[1]=p.key}}if(!u[1]){return m.empty()}return v._navigator.moveToKey$(u[1]).pipe(g.catchError(function(){return m.empty()}))})).subscribe()};e.prototype._deactivate=function(){this._rendererDisposer$.next(null);this._abortTextureProviderSubscription.unsubscribe();this._hasTextureSubscription.unsubscribe();this._rendererSubscription.unsubscribe();this._setRegionOfInterestSubscription.unsubscribe();this._setTextureProviderSubscription.unsubscribe();this._setTileSizeSubscription.unsubscribe();this._stateSubscription.unsubscribe();this._textureProviderSubscription.unsubscribe();this._updateBackgroundSubscription.unsubscribe();this._updateTextureImageSubscription.unsubscribe();this._clearPeripheryPlaneSubscription.unsubscribe();this._addPeripheryPlaneSubscription.unsubscribe();this._updatePeripheryPlaneTextureSubscription.unsubscribe();this._moveToPeripheryNodeSubscription.unsubscribe()};e.prototype._getDefaultConfiguration=function(){return{}};e.componentName="imagePlane";return e}(o.Component);r.ImagePlaneComponent=i;o.ComponentService.register(i);r.default=i},{"../../Component":291,"../../Render":297,"../../Tiles":300,"../../Utils":301,"../../Viewer":302,"../../geo/Spatial":412,"../../geo/ViewportCoords":414,rxjs:43,"rxjs/operators":241}],322:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../../Component");var i=function(){function e(){this._factory=new n.MeshFactory;this._scene=new n.MeshScene;this._alpha=0;this._alphaOld=0;this._fadeOutSpeed=.05;this._currentKey=null;this._previousKey=null;this._providerDisposers={};this._frameId=0;this._needsRender=false}Object.defineProperty(e.prototype,"frameId",{get:function(){return this._frameId},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:true,configurable:true});e.prototype.indicateNeedsRender=function(){this._needsRender=true};e.prototype.addPeripheryPlane=function(e,t){var r=this._factory.createMesh(e,t);var n={};n[e.key]=r;this._scene.addPeripheryPlanes(n);this._needsRender=true};e.prototype.clearPeripheryPlanes=function(){this._scene.setPeripheryPlanes({});this._needsRender=true};e.prototype.updateFrame=function(e){this._updateFrameId(e.id);this._needsRender=this._updateAlpha(e.state.alpha)||this._needsRender;this._needsRender=this._updateAlphaOld(e.state.alpha)||this._needsRender;this._needsRender=this._updateImagePlanes(e.state)||this._needsRender};e.prototype.setTextureProvider=function(e,t){var r=this;if(e!==this._currentKey){return}var n=t.textureCreated$.subscribe(function(e){r._updateTexture(e)});var i=t.textureUpdated$.subscribe(function(e){r._needsRender=true});var o=function(){n.unsubscribe();i.unsubscribe();t.dispose()};if(e in this._providerDisposers){var a=this._providerDisposers[e];a();delete this._providerDisposers[e]}this._providerDisposers[e]=o};e.prototype.updateTextureImage=function(e,t){this._needsRender=true;var r=this._extend({},this._scene.planes,this._scene.planesOld,this._scene.planesPeriphery);for(var n in r){if(!r.hasOwnProperty(n)){continue}if(n!==t.key){continue}var i=r[n];var o=i.material;var a=o.uniforms.projectorTex.value;a.image=e;a.needsUpdate=true}};e.prototype.render=function(e,t){var r=this._scene.planes;var n=this._scene.planesOld;var i=this._scene.planesPeriphery;var o=Object.keys(n).length?1:this._alpha;var a=Object.keys(n).length?1:Math.floor(this._alpha);for(var s in r){if(!r.hasOwnProperty(s)){continue}var u=r[s];u.material.uniforms.opacity.value=o}for(var s in n){if(!n.hasOwnProperty(s)){continue}var u=n[s];u.material.uniforms.opacity.value=this._alphaOld}for(var s in i){if(!i.hasOwnProperty(s)){continue}var u=i[s];u.material.uniforms.opacity.value=a}t.render(this._scene.scenePeriphery,e);t.render(this._scene.scene,e);t.render(this._scene.sceneOld,e);for(var s in r){if(!r.hasOwnProperty(s)){continue}var u=r[s];u.material.uniforms.opacity.value=this._alpha}t.render(this._scene.scene,e)};e.prototype.clearNeedsRender=function(){this._needsRender=false};e.prototype.dispose=function(){this._scene.clear()};e.prototype._updateFrameId=function(e){this._frameId=e};e.prototype._updateAlpha=function(e){if(e===this._alpha){return false}this._alpha=e;return true};e.prototype._updateAlphaOld=function(e){if(e<1||this._alphaOld===0){return false}this._alphaOld=Math.max(0,this._alphaOld-this._fadeOutSpeed);return true};e.prototype._updateImagePlanes=function(e){if(e.currentNode==null||e.currentNode.key===this._currentKey){return false}var t=e.previousNode!=null?e.previousNode.key:null;var r=e.currentNode.key;if(this._previousKey!==t&&this._previousKey!==r&&this._previousKey in this._providerDisposers){var n=this._providerDisposers[this._previousKey];n();delete this._providerDisposers[this._previousKey]}if(t!=null){if(t!==this._currentKey&&t!==this._previousKey){var i=this._factory.createMesh(e.previousNode,e.previousTransform);var o={};o[t]=i;this._scene.updateImagePlanes(o)}this._previousKey=t}this._currentKey=r;var a=this._factory.createMesh(e.currentNode,e.currentTransform);var s={};s[r]=a;this._scene.updateImagePlanes(s);this._alphaOld=1;return true};e.prototype._updateTexture=function(e){this._needsRender=true;var t=this._scene.planes;for(var r in t){if(!t.hasOwnProperty(r)){continue}var n=t[r];var i=n.material;var o=i.uniforms.projectorTex.value;i.uniforms.projectorTex.value=null;o.dispose();i.uniforms.projectorTex.value=e}};e.prototype._extend=function(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}for(var n=0,i=t;n<i.length;n++){var o=i[n];for(var a in o){if(!o.hasOwnProperty(a)){continue}e[a]=o[a]}}return e};return e}();r.ImagePlaneGLRenderer=i;r.default=i},{"../../Component":291}],323:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["Hidden"]=0]="Hidden";e[e["Loading"]=1]="Loading";e[e["Visible"]=2]="Visible"})(n=r.CoverState||(r.CoverState={}))},{}],324:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["Motion"]=0]="Motion";e[e["Stationary"]=1]="Stationary"})(n=r.SliderMode||(r.SliderMode={}))},{}],325:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./ICoverConfiguration");r.CoverState=n.CoverState;var i=e("./ISliderConfiguration");r.SliderMode=i.SliderMode},{"./ICoverConfiguration":323,"./ISliderConfiguration":324}],326:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs/operators");var o=e("../../Component");var l=e("../../Edge");var a=function(e){n(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype._enable=function(){var h=this;this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(i.withLatestFrom(this._navigator.playService.playing$,this._navigator.playService.direction$,this._navigator.playService.speed$,this._navigator.stateService.currentNode$.pipe(i.switchMap(function(e){return e.sequenceEdges$})))).subscribe(function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4];if(t.altKey||t.ctrlKey||t.metaKey){return}switch(t.key){case"D":if(!t.shiftKey){return}var a=r?null:n===l.EdgeDirection.Next?l.EdgeDirection.Prev:n===l.EdgeDirection.Prev?l.EdgeDirection.Next:null;if(a!=null){h._navigator.playService.setDirection(a)}break;case" ":if(t.shiftKey){return}if(r){h._navigator.playService.stop()}else{for(var s=0,u=o.edges;s<u.length;s++){var c=u[s];if(c.data.direction===n){h._navigator.playService.play()}}}break;case"<":h._navigator.playService.setSpeed(i-.05);break;case">":h._navigator.playService.setSpeed(i+.05);break;default:return}t.preventDefault()})};t.prototype._disable=function(){this._keyDownSubscription.unsubscribe()};t.prototype._getConfiguration=function(e){return{keyZoom:e}};return t}(o.HandlerBase);r.KeyPlayHandler=a;r.default=a},{"../../Component":291,"../../Edge":292,"rxjs/operators":241}],327:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs/operators");var o=e("../../Component");var u=e("../../Edge");var c=e("../../Error");var a=function(e){n(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype._enable=function(){var s=this;var e=this._navigator.stateService.currentNode$.pipe(i.switchMap(function(e){return e.sequenceEdges$}));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(i.withLatestFrom(e)).subscribe(function(e){var t=e[0],r=e[1];var n=null;switch(t.keyCode){case 38:n=u.EdgeDirection.Next;break;case 40:n=u.EdgeDirection.Prev;break;default:return}t.preventDefault();if(!t.altKey||t.shiftKey||!r.cached){return}for(var i=0,o=r.edges;i<o.length;i++){var a=o[i];if(a.data.direction===n){s._navigator.moveToKey$(a.to).subscribe(undefined,function(e){if(!(e instanceof c.AbortMapillaryError)){console.error(e)}});return}}})};t.prototype._disable=function(){this._keyDownSubscription.unsubscribe()};t.prototype._getConfiguration=function(e){return{keySequenceNavigation:e}};return t}(o.HandlerBase);r.KeySequenceNavigationHandler=a;r.default=a},{"../../Component":291,"../../Edge":292,"../../Error":293,"rxjs/operators":241}],328:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs/operators");var o=e("../../Component");var _=e("../../Edge");var a=e("../../Error");var s=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e,t,r)||this;i._spatial=n;return i}e.prototype._enable=function(){var g=this;var e=this._navigator.stateService.currentNode$.pipe(i.switchMap(function(e){return e.spatialEdges$}));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(i.withLatestFrom(e,this._navigator.stateService.currentState$)).subscribe(function(e){var t=e[0],r=e[1],n=e[2];var i=n.state.currentNode.pano;var o=null;switch(t.keyCode){case 37:o=t.shiftKey&&!i?_.EdgeDirection.TurnLeft:_.EdgeDirection.StepLeft;break;case 38:o=t.shiftKey&&!i?_.EdgeDirection.Pano:_.EdgeDirection.StepForward;break;case 39:o=t.shiftKey&&!i?_.EdgeDirection.TurnRight:_.EdgeDirection.StepRight;break;case 40:o=t.shiftKey&&!i?_.EdgeDirection.TurnU:_.EdgeDirection.StepBackward;break;default:return}t.preventDefault();if(t.altKey||!r.cached||t.shiftKey&&i){return}if(!i){g._moveDir(o,r)}else{var a={};a[_.EdgeDirection.StepBackward]=Math.PI;a[_.EdgeDirection.StepForward]=0;a[_.EdgeDirection.StepLeft]=Math.PI/2;a[_.EdgeDirection.StepRight]=-Math.PI/2;var s=g._rotationFromCamera(n.state.camera).phi;var u=g._spatial.wrapAngle(s+a[o]);var c=Math.PI/4;var h=r.edges.filter(function(e){return e.data.direction===_.EdgeDirection.Pano||e.data.direction===o});var l=Number.MAX_VALUE;var p=null;for(var f=0,d=h;f<d.length;f++){var v=d[f];var m=Math.abs(g._spatial.wrapAngle(v.data.worldMotionAzimuth-u));if(m<Math.min(l,c)){l=m;p=v.to}}if(p==null){return}g._moveToKey(p)}})};e.prototype._disable=function(){this._keyDownSubscription.unsubscribe()};e.prototype._getConfiguration=function(e){return{keySpatialNavigation:e}};e.prototype._moveDir=function(e,t){for(var r=0,n=t.edges;r<n.length;r++){var i=n[r];if(i.data.direction===e){this._moveToKey(i.to);return}}};e.prototype._moveToKey=function(e){this._navigator.moveToKey$(e).subscribe(undefined,function(e){if(!(e instanceof a.AbortMapillaryError)){console.error(e)}})};e.prototype._rotationFromCamera=function(e){var t=e.lookat.clone().sub(e.position);var r=t.clone().dot(e.up);var n=t.clone().sub(e.up.clone().multiplyScalar(r));var i=Math.atan2(n.y,n.x);var o=Math.PI/2-this._spatial.angleToPlane(t.toArray(),[0,0,1]);return{phi:i,theta:o}};return e}(o.HandlerBase);r.KeySpatialNavigationHandler=s;r.default=s},{"../../Component":291,"../../Edge":292,"../../Error":293,"rxjs/operators":241}],329:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs/operators");var o=e("../../Component");var a=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e,t,r)||this;i._viewportCoords=n;return i}e.prototype._enable=function(){var s=this;this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(i.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe(function(e){var t=e[0],r=e[1],n=e[2];if(t.altKey||t.shiftKey||t.ctrlKey||t.metaKey){return}var i=0;switch(t.key){case"+":i=1;break;case"-":i=-1;break;default:return}t.preventDefault();var o=s._viewportCoords.unprojectFromViewport(0,0,r.perspective);var a=n.projectBasic(o.toArray());s._navigator.stateService.zoomIn(i,a)})};e.prototype._disable=function(){this._keyDownSubscription.unsubscribe()};e.prototype._getConfiguration=function(e){return{keyZoom:e}};return e}(o.HandlerBase);r.KeyZoomHandler=a;r.default=a},{"../../Component":291,"rxjs/operators":241}],330:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("../../Component");var a=e("../../Geo");var i=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e,t,r)||this;n._keyPlayHandler=new o.KeyPlayHandler(n,t,r);n._keySequenceNavigationHandler=new o.KeySequenceNavigationHandler(n,t,r);n._keySpatialNavigationHandler=new o.KeySpatialNavigationHandler(n,t,r,new a.Spatial);n._keyZoomHandler=new o.KeyZoomHandler(n,t,r,new a.ViewportCoords);return n}Object.defineProperty(e.prototype,"keyPlay",{get:function(){return this._keyPlayHandler},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"keySequenceNavigation",{get:function(){return this._keySequenceNavigationHandler},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"keySpatialNavigation",{get:function(){return this._keySpatialNavigationHandler},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"keyZoom",{get:function(){return this._keyZoomHandler},enumerable:true,configurable:true});e.prototype._activate=function(){var t=this;this._configurationSubscription=this._configuration$.subscribe(function(e){if(e.keyPlay){t._keyPlayHandler.enable()}else{t._keyPlayHandler.disable()}if(e.keySequenceNavigation){t._keySequenceNavigationHandler.enable()}else{t._keySequenceNavigationHandler.disable()}if(e.keySpatialNavigation){t._keySpatialNavigationHandler.enable()}else{t._keySpatialNavigationHandler.disable()}if(e.keyZoom){t._keyZoomHandler.enable()}else{t._keyZoomHandler.disable()}})};e.prototype._deactivate=function(){this._configurationSubscription.unsubscribe();this._keyPlayHandler.disable();this._keySequenceNavigationHandler.disable();this._keySpatialNavigationHandler.disable();this._keyZoomHandler.disable()};e.prototype._getDefaultConfiguration=function(){return{keyPlay:true,keySequenceNavigation:true,keySpatialNavigation:true,keyZoom:true}};e.componentName="keyboard";return e}(o.Component);r.KeyboardComponent=i;o.ComponentService.register(i);r.default=i},{"../../Component":291,"../../Geo":294}],331:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./MarkerComponent");r.MarkerComponent=n.MarkerComponent;var i=e("./marker/SimpleMarker");r.SimpleMarker=i.SimpleMarker;var o=e("./marker/CircleMarker");r.CircleMarker=o.CircleMarker},{"./MarkerComponent":332,"./marker/CircleMarker":335,"./marker/SimpleMarker":337}],332:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var p=e("rxjs");var f=e("rxjs/operators");var E=e("three");var o=e("when");var a=e("../../Component");var d=e("../../Render");var s=e("../../Graph");var u=e("../../Geo");var i=function(i){n(C,i);function C(e,t,r){var n=i.call(this,e,t,r)||this;n._relativeGroundAltitude=-2;n._geoCoords=new u.GeoCoords;n._graphCalculator=new s.GraphCalculator;n._markerScene=new a.MarkerScene;n._markerSet=new a.MarkerSet;n._viewportCoords=new u.ViewportCoords;return n}C.prototype.add=function(e){this._markerSet.add(e)};C.prototype.get=function(e){return this._markerSet.get(e)};C.prototype.getAll=function(){return this._markerSet.getAll()};C.prototype.getMarkerIdAt=function(n){var i=this;return o.promise(function(t,r){i._container.renderService.renderCamera$.pipe(f.first(),f.map(function(e){var t=i._viewportCoords.canvasToViewport(n[0],n[1],i._container.element);var r=i._markerScene.intersectObjects(t,e.perspective);return r})).subscribe(function(e){t(e)},function(e){r(e)})})};C.prototype.has=function(e){return this._markerSet.has(e)};C.prototype.remove=function(e){this._markerSet.remove(e)};C.prototype.removeAll=function(){this._markerSet.removeAll()};C.prototype._activate=function(){var M=this;var e=this._navigator.stateService.currentState$.pipe(f.map(function(e){return e.state.camera.position.z+M._relativeGroundAltitude}),f.distinctUntilChanged(function(e,t){return Math.abs(e-t)<.01}),f.publishReplay(1),f.refCount());var t=p.combineLatest(e,this._navigator.stateService.reference$).pipe(f.first(),f.map(function(){}),f.publishReplay(1),f.refCount());var r=this._configuration$.pipe(f.map(function(e){return{visibleBBoxSize:Math.max(1,Math.min(200,e.visibleBBoxSize))}}));var n=this._navigator.stateService.currentNode$.pipe(f.map(function(e){return e.latLon}),f.publishReplay(1),f.refCount());var i=p.combineLatest(r,n).pipe(f.map(function(e){var t=e[0],r=e[1];return M._graphCalculator.boundingBoxCorners(r,t.visibleBBoxSize/2)}),f.publishReplay(1),f.refCount());var o=p.combineLatest(p.concat(p.of(this._markerSet),this._markerSet.changed$),i).pipe(f.map(function(e){var t=e[0],r=e[1];return t.search(r)}));this._setChangedSubscription=t.pipe(f.switchMap(function(){return o.pipe(f.withLatestFrom(M._navigator.stateService.reference$,e))})).subscribe(function(e){var t=e[0],r=e[1],n=e[2];var i=M._geoCoords;var o=M._markerScene;var a=o.markers;var s=Object.assign({},a);for(var u=0,c=t;u<c.length;u++){var h=c[u];if(h.id in a){delete s[h.id]}else{var l=i.geodeticToEnu(h.latLon.lat,h.latLon.lon,r.alt+n,r.lat,r.lon,r.alt);o.add(h,l)}}for(var p in s){if(!s.hasOwnProperty(p)){continue}o.remove(p)}});this._markersUpdatedSubscription=t.pipe(f.switchMap(function(){return M._markerSet.updated$.pipe(f.withLatestFrom(i,M._navigator.stateService.reference$,e))})).subscribe(function(e){var t=e[0],r=e[1],n=r[0],i=r[1],o=e[2],a=e[3];var s=M._geoCoords;var u=M._markerScene;for(var c=0,h=t;c<h.length;c++){var l=h[c];var p=u.has(l.id);var f=l.latLon.lat>n.lat&&l.latLon.lat<i.lat&&l.latLon.lon>n.lon&&l.latLon.lon<i.lon;if(f){var d=s.geodeticToEnu(l.latLon.lat,l.latLon.lon,o.alt+a,o.lat,o.lon,o.alt);u.add(l,d)}else if(!f&&p){u.remove(l.id)}}});this._referenceSubscription=this._navigator.stateService.reference$.pipe(f.skip(1),f.withLatestFrom(e)).subscribe(function(e){var t=e[0],r=e[1];var n=M._geoCoords;var i=M._markerScene;for(var o=0,a=i.getAll();o<a.length;o++){var s=a[o];var u=n.geodeticToEnu(s.latLon.lat,s.latLon.lon,t.alt+r,t.lat,t.lon,t.alt);i.update(s.id,u)}});this._adjustHeightSubscription=e.pipe(f.skip(1),f.withLatestFrom(this._navigator.stateService.reference$,n)).subscribe(function(e){var t=e[0],r=e[1],n=e[2];var i=M._geoCoords;var o=M._markerScene;var a=i.geodeticToEnu(n.lat,n.lon,r.alt+t,r.lat,r.lon,r.alt);for(var s=0,u=o.getAll();s<u.length;s++){var c=u[s];var h=i.geodeticToEnu(c.latLon.lat,c.latLon.lon,r.alt+t,r.lat,r.lon,r.alt);var l=h[0]-a[0];var p=h[1]-a[1];var f=Math.sqrt(l*l+p*p);if(f>50){continue}o.lerpAltitude(c.id,t,Math.min(1,Math.max(0,1.2-1.2*f/50)))}});this._renderSubscription=this._navigator.stateService.currentState$.pipe(f.map(function(e){var t=M._markerScene;return{name:M._name,render:{frameId:e.id,needsRender:t.needsRender,render:t.render.bind(t),stage:d.GLRenderStage.Foreground}}})).subscribe(this._container.glRenderer.render$);var a=p.combineLatest(this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$).pipe(f.map(function(e){var t=e[0],r=e[1];var n=M._container.element;var i=M._viewportCoords.canvasPosition(r,n),o=i[0],a=i[1];var s=M._viewportCoords.canvasToViewport(o,a,n);var u=M._markerScene.intersectObjects(s,t.perspective);return u}),f.publishReplay(1),f.refCount());var s=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(f.map(function(e){return true}));var u=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragEnd$).pipe(f.map(function(e){return false}));var c=p.merge(s,u).pipe(f.startWith(false));this._dragEventSubscription=p.merge(s.pipe(f.withLatestFrom(a)),p.combineLatest(u,p.of(null))).pipe(f.startWith([false,null]),f.pairwise()).subscribe(function(e){var t=e[0],r=e[1];var n=r[0];var i=n?C.dragstart:C.dragend;var o=n?r[1]:t[1];var a=M._markerScene.get(o);var s={marker:a,target:M,type:i};M.fire(i,s)});var h=p.merge(this._container.mouseService.mouseDown$.pipe(f.map(function(e){return true})),this._container.mouseService.documentMouseUp$.pipe(f.map(function(e){return false}))).pipe(f.startWith(false));this._mouseClaimSubscription=p.combineLatest(this._container.mouseService.active$,a.pipe(f.distinctUntilChanged()),h,c).pipe(f.map(function(e){var t=e[0],r=e[1],n=e[2],i=e[3];return!t&&r!=null&&n||i}),f.distinctUntilChanged()).subscribe(function(e){if(e){M._container.mouseService.claimMouse(M._name,1);M._container.mouseService.claimWheel(M._name,1)}else{M._container.mouseService.unclaimMouse(M._name);M._container.mouseService.unclaimWheel(M._name)}});var l=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(f.withLatestFrom(a,this._container.renderService.renderCamera$),f.map(function(e){var t=e[0],r=e[1],n=e[2];var i=M._markerScene.get(r);var o=M._container.element;var a=M._viewportCoords.projectToCanvas(i.geometry.position.toArray(),o,n.perspective),s=a[0],u=a[1];var c=M._viewportCoords.canvasPosition(t,o),h=c[0],l=c[1];var p=[h-s,l-u];return[i,p,n]}),f.publishReplay(1),f.refCount());this._updateMarkerSubscription=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$).pipe(f.withLatestFrom(l,this._navigator.stateService.reference$,r)).subscribe(function(e){var t=e[0],r=e[1],n=r[0],i=r[1],o=r[2],a=e[2],s=e[3];if(!M._markerScene.has(n.id)){return}var u=M._container.element;var c=M._viewportCoords.canvasPosition(t,u),h=c[0],l=c[1];var p=h-i[0];var f=l-i[1];var d=M._viewportCoords.canvasToViewport(p,f,u),v=d[0],m=d[1];var g=new E.Vector3(v,m,1).unproject(o.perspective).sub(o.perspective.position).normalize();var _=Math.min(M._relativeGroundAltitude/g.z,s.visibleBBoxSize/2-.1);if(_<0){return}var y=g.clone().multiplyScalar(_).add(o.perspective.position);y.z=o.perspective.position.z+M._relativeGroundAltitude;var b=M._geoCoords.enuToGeodetic(y.x,y.y,y.z,a.lat,a.lon,a.alt),w=b[0],x=b[1];M._markerScene.update(n.id,y.toArray(),{lat:w,lon:x});M._markerSet.update(n);var S={marker:n,target:M,type:C.changed};M.fire(C.changed,S)})};C.prototype._deactivate=function(){this._adjustHeightSubscription.unsubscribe();this._dragEventSubscription.unsubscribe();this._markersUpdatedSubscription.unsubscribe();this._mouseClaimSubscription.unsubscribe();this._referenceSubscription.unsubscribe();this._renderSubscription.unsubscribe();this._setChangedSubscription.unsubscribe();this._updateMarkerSubscription.unsubscribe();this._markerScene.clear()};C.prototype._getDefaultConfiguration=function(){return{visibleBBoxSize:100}};C.componentName="marker";C.changed="changed";C.dragstart="dragstart";C.dragend="dragend";return C}(a.Component);r.MarkerComponent=i;a.ComponentService.register(i);r.default=i},{"../../Component":291,"../../Geo":294,"../../Graph":295,"../../Render":297,rxjs:43,"rxjs/operators":241,three:242,when:288}],333:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var u=e("three");var n=function(){function e(e,t){this._needsRender=false;this._interactiveObjects=[];this._markers={};this._objectMarkers={};this._raycaster=!!t?t:new u.Raycaster;this._scene=!!e?e:new u.Scene}Object.defineProperty(e.prototype,"markers",{get:function(){return this._markers},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:true,configurable:true});e.prototype.add=function(e,t){if(e.id in this._markers){this._dispose(e.id)}e.createGeometry(t);this._scene.add(e.geometry);this._markers[e.id]=e;for(var r=0,n=e.getInteractiveObjects();r<n.length;r++){var i=n[r];this._interactiveObjects.push(i);this._objectMarkers[i.uuid]=e.id}this._needsRender=true};e.prototype.clear=function(){for(var e in this._markers){if(!this._markers.hasOwnProperty){continue}this._dispose(e)}this._needsRender=true};e.prototype.get=function(e){return this._markers[e]};e.prototype.getAll=function(){var t=this;return Object.keys(this._markers).map(function(e){return t._markers[e]})};e.prototype.has=function(e){return e in this._markers};e.prototype.intersectObjects=function(e,t){var r=e[0],n=e[1];this._raycaster.setFromCamera(new u.Vector2(r,n),t);var i=this._raycaster.intersectObjects(this._interactiveObjects);for(var o=0,a=i;o<a.length;o++){var s=a[o];if(s.object.uuid in this._objectMarkers){return this._objectMarkers[s.object.uuid]}}return null};e.prototype.lerpAltitude=function(e,t,r){if(!(e in this._markers)){return}this._markers[e].lerpAltitude(t,r);this._needsRender=true};e.prototype.remove=function(e){if(!(e in this._markers)){return}this._dispose(e);this._needsRender=true};e.prototype.render=function(e,t){t.render(this._scene,e);this._needsRender=false};e.prototype.update=function(e,t,r){if(!(e in this._markers)){return}var n=this._markers[e];n.updatePosition(t,r);this._needsRender=true};e.prototype._dispose=function(e){var t=this._markers[e];this._scene.remove(t.geometry);for(var r=0,n=t.getInteractiveObjects();r<n.length;r++){var i=n[r];var o=this._interactiveObjects.indexOf(i);if(o!==-1){this._interactiveObjects.splice(o,1)}else{console.warn("Object does not exist ("+i.id+") for "+e)}delete this._objectMarkers[i.uuid]}t.disposeGeometry();delete this._markers[e]};return e}();r.MarkerScene=n;r.default=n},{three:242}],334:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rbush");var i=e("rxjs");var o=function(){function e(){this._hash={};this._index=n(16,[".lon",".lat",".lon",".lat"]);this._indexChanged$=new i.Subject;this._updated$=new i.Subject}Object.defineProperty(e.prototype,"changed$",{get:function(){return this._indexChanged$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"updated$",{get:function(){return this._updated$},enumerable:true,configurable:true});e.prototype.add=function(e){var t=[];var r=this._hash;var n=this._index;for(var i=0,o=e;i<o.length;i++){var a=o[i];var s=a.id;if(s in r){n.remove(r[s]);t.push(a)}var u={lat:a.latLon.lat,lon:a.latLon.lon,marker:a};r[s]=u;n.insert(u)}if(t.length>0){this._updated$.next(t)}if(e.length>t.length){this._indexChanged$.next(this)}};e.prototype.has=function(e){return e in this._hash};e.prototype.get=function(e){return this.has(e)?this._hash[e].marker:undefined};e.prototype.getAll=function(){return this._index.all().map(function(e){return e.marker})};e.prototype.remove=function(e){var t=this._hash;var r=this._index;var n=false;for(var i=0,o=e;i<o.length;i++){var a=o[i];if(!(a in t)){continue}var s=t[a];r.remove(s);delete t[a];n=true}if(n){this._indexChanged$.next(this)}};e.prototype.removeAll=function(){this._hash={};this._index.clear();this._indexChanged$.next(this)};e.prototype.search=function(e){var t=e[0],r=e[1];return this._index.search({maxX:r.lon,maxY:r.lat,minX:t.lon,minY:t.lat}).map(function(e){return e.marker})};e.prototype.update=function(e){var t=this._hash;var r=this._index;var n=e.id;if(!(n in t)){return}r.remove(t[n]);var i={lat:e.latLon.lat,lon:e.latLon.lon,marker:e};t[n]=i;r.insert(i)};return e}();r.MarkerSet=o;r.default=o},{rbush:42,rxjs:43}],335:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("three");var i=e("../../../Component");var a=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e,t)||this;r=!!r?r:{};n._color=r.color!=null?r.color:16777215;n._opacity=r.opacity!=null?r.opacity:.4;n._radius=r.radius!=null?r.radius:1;return n}e.prototype._createGeometry=function(e){var t=new o.Mesh(new o.CircleGeometry(this._radius,16),new o.MeshBasicMaterial({color:this._color,opacity:this._opacity,transparent:true}));t.up.fromArray([0,0,1]);t.renderOrder=-1;var r=new o.Object3D;r.add(t);r.position.fromArray(e);this._geometry=r};e.prototype._disposeGeometry=function(){for(var e=0,t=this._geometry.children;e<t.length;e++){var r=t[e];r.geometry.dispose();r.material.dispose()}};e.prototype._getInteractiveObjects=function(){return[]};return e}(i.Marker);r.CircleMarker=a;r.default=a},{"../../../Component":291,three:242}],336:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(e,t){this._id=e;this._latLon=t}Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"latLon",{get:function(){return this._latLon},enumerable:true,configurable:true});e.prototype.createGeometry=function(e){if(!!this._geometry){return}this._createGeometry(e);this._geometry.updateMatrixWorld(true)};e.prototype.disposeGeometry=function(){if(!this._geometry){return}this._disposeGeometry();this._geometry=undefined};e.prototype.getInteractiveObjects=function(){if(!this._geometry){return[]}return this._getInteractiveObjects()};e.prototype.lerpAltitude=function(e,t){if(!this._geometry){return}this._geometry.position.z=(1-t)*this._geometry.position.z+t*e};e.prototype.updatePosition=function(e,t){if(!!t){this._latLon.lat=t.lat;this._latLon.lon=t.lon}if(!this._geometry){return}this._geometry.position.fromArray(e);this._geometry.updateMatrixWorld(true)};return e}();r.Marker=n;r.default=n},{}],337:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var x=e("three");var i=e("../../../Component");var o=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e,t)||this;r=!!r?r:{};n._ballColor=r.ballColor!=null?r.ballColor:16711680;n._ballOpacity=r.ballOpacity!=null?r.ballOpacity:.8;n._circleToRayAngle=2;n._color=r.color!=null?r.color:16711680;n._interactive=!!r.interactive;n._opacity=r.opacity!=null?r.opacity:.4;n._radius=r.radius!=null?r.radius:1;return n}e.prototype._createGeometry=function(e){var t=this._radius;var r=new x.Mesh(this._markerGeometry(t,8,8),new x.MeshBasicMaterial({color:this._color,opacity:this._opacity,transparent:true}));r.renderOrder=1;var n=new x.Mesh(new x.SphereGeometry(t/2,8,8),new x.MeshBasicMaterial({color:this._ballColor,opacity:this._ballOpacity,transparent:true}));n.position.z=this._markerHeight(t);var i=new x.Object3D;i.add(n);i.add(r);i.position.fromArray(e);this._geometry=i};e.prototype._disposeGeometry=function(){for(var e=0,t=this._geometry.children;e<t.length;e++){var r=t[e];r.geometry.dispose();r.material.dispose()}};e.prototype._getInteractiveObjects=function(){return this._interactive?[this._geometry.children[0]]:[]};e.prototype._markerHeight=function(e){var t=Math.tan(Math.PI-this._circleToRayAngle);return e*Math.sqrt(1+t*t)};e.prototype._markerGeometry=function(e,t,r){var n=new x.Geometry;t=Math.max(3,Math.floor(t)||8);r=Math.max(2,Math.floor(r)||6);var i=this._markerHeight(e);var o=[];for(var a=0;a<=r;++a){var s=[];for(var u=0;u<=t;++u){var c=u/t*Math.PI*2;var h=a/r*Math.PI;var l=void 0;if(h<this._circleToRayAngle){l=e}else{var p=Math.tan(h-this._circleToRayAngle);l=e*Math.sqrt(1+p*p)}var f=new x.Vector3;f.x=l*Math.cos(c)*Math.sin(h);f.y=l*Math.sin(c)*Math.sin(h);f.z=l*Math.cos(h)+i;n.vertices.push(f);s.push(n.vertices.length-1)}o.push(s)}for(var a=0;a<r;++a){for(var u=0;u<t;++u){var d=o[a][u+1];var v=o[a][u];var m=o[a+1][u];var g=o[a+1][u+1];var _=n.vertices[d].clone().normalize();var y=n.vertices[v].clone().normalize();var b=n.vertices[m].clone().normalize();var w=n.vertices[g].clone().normalize();n.faces.push(new x.Face3(d,v,g,[_,y,w]));n.faces.push(new x.Face3(v,m,g,[y.clone(),b,w.clone()]))}}n.computeFaceNormals();n.boundingSphere=new x.Sphere(new x.Vector3,e+i);return n};return e}(i.Marker);r.SimpleMarker=o;r.default=o},{"../../../Component":291,three:242}],338:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs");var o=e("rxjs/operators");var S=e("../../Component");var a=function(a){n(e,a);function e(e,t,r,n,i){var o=a.call(this,e,t,r)||this;o._spatial=i;o._viewportCoords=n;return o}e.prototype._enable=function(){var x=this;var e=this._navigator.stateService.currentState$.pipe(o.map(function(e){return e.state.alpha<1}),o.distinctUntilChanged());this._bounceSubscription=i.combineLatest(e,this._navigator.stateService.inTranslation$,this._container.mouseService.active$,this._container.touchService.active$).pipe(o.map(function(e){return e[0]||e[1]||e[2]||e[3]}),o.distinctUntilChanged(),o.switchMap(function(e){return e?i.empty():i.combineLatest(x._container.renderService.renderCamera$,x._navigator.stateService.currentTransform$.pipe(o.first()))}),o.withLatestFrom(this._navigator.panService.panNodes$)).subscribe(function(e){var t=e[0],r=t[0],n=t[1],i=e[1];if(!n.hasValidScale&&r.camera.focal<.1){return}if(r.perspective.aspect===0||r.perspective.aspect===Number.POSITIVE_INFINITY){return}var o=S.ImageBoundary.viewportDistances(n,r.perspective,x._viewportCoords);var a=x._viewportCoords.viewportToBasic(0,0,n,r.perspective);if((a[0]<0||a[0]>1)&&i.length>0){o[0]=o[2]=0}for(var s=0,u=i;s<u.length;s++){var c=u[s],h=c[1];var l=S.ImageBoundary.viewportDistances(h,r.perspective,x._viewportCoords);for(var p=1;p<o.length;p+=2){if(l[p]<o[p]){o[p]=l[p]}}}if(Math.max.apply(Math,o)<.01){return}var f=o[1]-o[3];var d=o[0]-o[2];var v=x._viewportCoords.unprojectFromViewport(0,0,r.perspective).sub(r.perspective.position);var m=x._viewportCoords.unprojectFromViewport(f,0,r.perspective).sub(r.perspective.position);var g=x._viewportCoords.unprojectFromViewport(0,d,r.perspective).sub(r.perspective.position);var _=(f>0?1:-1)*m.angleTo(v);var y=(d>0?1:-1)*g.angleTo(v);var b=Math.PI/60;var w=.1;_=x._spatial.clamp(w*_,-b,b);y=x._spatial.clamp(w*y,-b,b);x._navigator.stateService.rotateUnbounded({phi:_,theta:y})})};e.prototype._disable=function(){this._bounceSubscription.unsubscribe()};e.prototype._getConfiguration=function(){return{}};return e}(S.HandlerBase);r.BounceHandler=a;r.default=a},{"../../Component":291,rxjs:43,"rxjs/operators":241}],339:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs");var a=e("rxjs/operators");var o=e("../../Component");var s=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e,t,r)||this;i._viewportCoords=n;return i}e.prototype._enable=function(){var l=this;this._zoomSubscription=i.merge(this._container.mouseService.filtered$(this._component.name,this._container.mouseService.dblClick$),this._container.touchService.doubleTap$.pipe(a.map(function(e){var t=e.touches[0];return{clientX:t.clientX,clientY:t.clientY,shiftKey:e.shiftKey}}))).pipe(a.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe(function(e){var t=e[0],r=e[1],n=e[2];var i=l._container.element;var o=l._viewportCoords.canvasPosition(t,i),a=o[0],s=o[1];var u=l._viewportCoords.unprojectFromCanvas(a,s,i,r.perspective);var c=n.projectBasic(u.toArray());var h=!!t.shiftKey?-1:1;l._navigator.stateService.zoomIn(h,c)})};e.prototype._disable=function(){this._zoomSubscription.unsubscribe()};e.prototype._getConfiguration=function(e){return{doubleClickZoom:e}};return e}(o.HandlerBase);r.DoubleClickZoomHandler=s;r.default=s},{"../../Component":291,rxjs:43,"rxjs/operators":241}],340:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var s=e("rxjs");var u=e("rxjs/operators");var E=e("../../Component");var i=function(a){n(e,a);function e(e,t,r,n,i){var o=a.call(this,e,t,r)||this;o._spatial=i;o._viewportCoords=n;return o}e.prototype._enable=function(){var C=this;var e=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragStart$).pipe(u.map(function(){return true}),u.share());var t=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$).pipe(u.map(function(){return false}),u.share());this._activeMouseSubscription=s.merge(e,t).subscribe(this._container.mouseService.activate$);var r=s.merge(e,t).pipe(u.switchMap(function(e){return e?C._container.mouseService.documentMouseMove$:s.empty()}));this._preventDefaultSubscription=s.merge(r,this._container.touchService.touchMove$).subscribe(function(e){e.preventDefault()});var n=this._container.touchService.singleTouchDragStart$.pipe(u.map(function(){return true}));var i=this._container.touchService.singleTouchDragEnd$.pipe(u.map(function(){return false}));this._activeTouchSubscription=s.merge(n,i).subscribe(this._container.touchService.activate$);var o=this._navigator.stateService.currentState$.pipe(u.map(function(e){return e.state.currentNode.fullPano||e.state.nodesAhead<1}),u.distinctUntilChanged(),u.switchMap(function(e){if(!e){return s.empty()}var t=E.MouseOperator.filteredPairwiseMouseDrag$(C._component.name,C._container.mouseService);var r=s.merge(C._container.touchService.singleTouchDragStart$,C._container.touchService.singleTouchDrag$,C._container.touchService.singleTouchDragEnd$.pipe(u.map(function(){return null}))).pipe(u.map(function(e){return e!=null&&e.touches.length>0?e.touches[0]:null}),u.pairwise(),u.filter(function(e){return e[0]!=null&&e[1]!=null}));return s.merge(t,r)}),u.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,this._navigator.panService.panNodes$),u.map(function(e){var t=e[0],r=e[1],n=e[2],i=e[3];var o=t[0];var a=t[1];var s=a.clientX-o.clientX;var u=a.clientY-o.clientY;var c=C._container.element;var h=C._viewportCoords.canvasPosition(a,c),l=h[0],p=h[1];var f=C._viewportCoords.unprojectFromCanvas(l,p,c,r.perspective).sub(r.perspective.position);var d=C._viewportCoords.unprojectFromCanvas(l-s,p,c,r.perspective).sub(r.perspective.position);var v=C._viewportCoords.unprojectFromCanvas(l,p-u,c,r.perspective).sub(r.perspective.position);var m=(s>0?1:-1)*d.angleTo(f);var g=(u>0?-1:1)*v.angleTo(f);var _=E.ImageBoundary.viewportDistances(n,r.perspective,C._viewportCoords);for(var y=0,b=i;y<b.length;y++){var w=b[y],x=w[1];var S=E.ImageBoundary.viewportDistances(x,r.perspective,C._viewportCoords);for(var M=0;M<_.length;M++){if(S[M]<_[M]){_[M]=S[M]}}}if(_[0]>0&&g<0){g/=Math.max(1,200*_[0])}if(_[2]>0&&g>0){g/=Math.max(1,200*_[2])}if(_[1]>0&&m<0){m/=Math.max(1,200*_[1])}if(_[3]>0&&m>0){m/=Math.max(1,200*_[3])}return{phi:m,theta:g}}),u.share());this._rotateWithoutInertiaSubscription=o.subscribe(function(e){C._navigator.stateService.rotateWithoutInertia(e)});this._rotateSubscription=o.pipe(u.scan(function(e,t){C._drainBuffer(e);e.push([Date.now(),t]);return e},[]),u.sample(s.merge(this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$),this._container.touchService.singleTouchDragEnd$)),u.map(function(e){var t=C._drainBuffer(e.slice());var r={phi:0,theta:0};for(var n=0,i=t;n<i.length;n++){var o=i[n];r.phi+=o[1].phi;r.theta+=o[1].theta}var a=t.length;if(a>0){r.phi/=a;r.theta/=a}var s=Math.PI/18;r.phi=C._spatial.clamp(r.phi,-s,s);r.theta=C._spatial.clamp(r.theta,-s,s);return r})).subscribe(function(e){C._navigator.stateService.rotate(e)})};e.prototype._disable=function(){this._activeMouseSubscription.unsubscribe();this._activeTouchSubscription.unsubscribe();this._preventDefaultSubscription.unsubscribe();this._rotateSubscription.unsubscribe();this._rotateWithoutInertiaSubscription.unsubscribe();this._activeMouseSubscription=null;this._activeTouchSubscription=null;this._preventDefaultSubscription=null;this._rotateSubscription=null};e.prototype._getConfiguration=function(e){return{dragPan:e}};e.prototype._drainBuffer=function(e){var t=50;var r=Date.now();while(e.length>0&&r-e[0][0]>t){e.shift()}return e};return e}(E.HandlerBase);r.DragPanHandler=i;r.default=i},{"../../Component":291,rxjs:43,"rxjs/operators":241}],341:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var d=e("three");var i=e("rxjs");var o=e("rxjs/operators");var s=e("../../Component");var u=e("../../State");var a=function(a){n(e,a);function e(e,t,r,n,i){var o=a.call(this,e,t,r)||this;o._spatial=i;o._viewportCoords=n;return o}e.prototype._enable=function(){var l=this;var e=this._navigator.stateService.state$.pipe(o.map(function(e){return e===u.State.Earth}),o.share());this._preventDefaultSubscription=e.pipe(o.switchMap(function(e){return e?l._container.mouseService.mouseWheel$:i.empty()})).subscribe(function(e){e.preventDefault()});this._truckSubscription=e.pipe(o.switchMap(function(e){if(!e){return i.empty()}return s.MouseOperator.filteredPairwiseMouseDrag$(l._component.name,l._container.mouseService).pipe(o.filter(function(e){var t=e[0],r=e[1];return!(t.ctrlKey&&r.ctrlKey)}))}),o.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),o.map(function(e){var t=e[0],r=t[0],n=t[1],i=e[1],o=e[2];var a=[0,0,1];var s=o.unprojectBasic([.5,.5],0);s[2]-=2;var u=l._planeIntersection(n,a,s,i.perspective,l._container.element);var c=l._planeIntersection(r,a,s,i.perspective,l._container.element);if(!u||!c){return null}var h=(new d.Vector3).subVectors(u,c).multiplyScalar(-1).toArray();return h}),o.filter(function(e){return!!e})).subscribe(function(e){l._navigator.stateService.truck(e)});this._orbitSubscription=e.pipe(o.switchMap(function(e){if(!e){return i.empty()}return s.MouseOperator.filteredPairwiseMouseDrag$(l._component.name,l._container.mouseService).pipe(o.filter(function(e){var t=e[0],r=e[1];return t.ctrlKey&&r.ctrlKey}))}),o.map(function(e){var t=e[0],r=e[1];var n=l._eventToViewport(r,l._container.element),i=n[0],o=n[1];var a=l._eventToViewport(t,l._container.element),s=a[0],u=a[1];var c=(s-i)*Math.PI;var h=(o-u)*Math.PI/2;return{phi:c,theta:h}})).subscribe(function(e){l._navigator.stateService.orbit(e)});this._dollySubscription=e.pipe(o.switchMap(function(e){if(!e){return i.empty()}return l._container.mouseService.filteredWheel$(l._component.name,l._container.mouseService.mouseWheel$)}),o.map(function(e){var t=e.deltaY;if(e.deltaMode===1){t=40*t}else if(e.deltaMode===2){t=800*t}var r=l._viewportCoords.containerToCanvas(l._container.element);return-t/r[1]})).subscribe(function(e){l._navigator.stateService.dolly(e)})};e.prototype._disable=function(){this._dollySubscription.unsubscribe();this._orbitSubscription.unsubscribe();this._preventDefaultSubscription.unsubscribe();this._truckSubscription.unsubscribe()};e.prototype._getConfiguration=function(){return{}};e.prototype._eventToViewport=function(e,t){var r=this._viewportCoords.canvasPosition(e,t);return this._viewportCoords.canvasToViewport(r[0],r[1],t)};e.prototype._planeIntersection=function(e,t,r,n,i){var o=this._viewportCoords.canvasPosition(e,i),a=o[0],s=o[1];var u=this._viewportCoords.unprojectFromCanvas(a,s,i,n).sub(n.position).normalize();if(Math.abs(this._spatial.angleToPlane(u.toArray(),t))<Math.PI/90){return null}var c=n.position.clone();var h=(new d.Vector3).fromArray(t);var l=(new d.Vector3).fromArray(r);var p=(new d.Vector3).subVectors(l,c).dot(h)/u.clone().dot(h);var f=(new d.Vector3).addVectors(c,u.multiplyScalar(p));if(this._viewportCoords.worldToCamera(f.toArray(),n)[2]>0){return null}return f};return e}(s.HandlerBase);r.EarthControlHandler=a;r.default=a},{"../../Component":291,"../../State":298,rxjs:43,"rxjs/operators":241,three:242}],342:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var z=e("../../../src/Geo");function $(e){var t=[];var r=[[0,0],[1,0],[1,1],[0,1]];var n=[[1,0],[0,1],[-1,0],[0,-1]];for(var i=0;i<4;++i){var o=r[i];var a=n[i];for(var s=0;s<e;++s){t.push([o[0]+a[0]*s/e,o[1]+a[1]*s/e])}}return t}function U(e,t){return e>=-1&&e<=1&&t>=-1&&t<=1}function G(e,t){return e>=0&&e<=1&&t>=0&&t<=1}function n(t,r,n){var e=$(100);var i=e.map(function(e){return n.basicToViewportSafe(e[0],e[1],t,r)});var o=[];var a=[{x:-1,y:1},{x:1,y:1},{x:1,y:-1},{x:-1,y:-1}];var s=[false,false,false,false];for(var u=0;u<i.length;u++){var c=i[u];var h=i[(u+1)%i.length];if(c===null){continue}if(h===null){if(U(c[0],c[1])){o.push(c)}continue}var l=c[0],p=c[1];var f=h[0],d=h[1];if(U(l,p)){if(U(f,d)){o.push(c)}else{for(var v=0;v<4;v++){var m={p1:{x:l,y:p},p2:{x:f,y:d}};var g={p1:a[v],p2:a[(v+1)%4]};var _=z.Lines.segmentsIntersect(m,g);if(_){var y=z.Lines.segmentIntersection(m,g);o.push(c,[y.x,y.y]);s[v]=true}}}}}var b=n.viewportToBasic(-1,1,t,r),w=b[0],x=b[1];var S=n.viewportToBasic(1,1,t,r),M=S[0],C=S[1];var E=n.viewportToBasic(1,-1,t,r),T=E[0],O=E[1];var P=n.viewportToBasic(-1,-1,t,r),A=P[0],j=P[1];if(G(w,x)){s[3]=s[0]=true}if(G(M,C)){s[0]=s[1]=true}if(G(T,O)){s[1]=s[2]=true}if(G(A,j)){s[2]=s[3]=true}var R=[-1,-1,1,1];for(var k=0,L=o;k<L.length;k++){var I=L[k];var N=I[0];var D=I[1];if(N>R[1]){R[1]=N}if(N<R[3]){R[3]=N}if(D>R[0]){R[0]=D}if(D<R[2]){R[2]=D}}var B=[1,1,-1,-1];var F=[];for(var v=0;v<4;v++){if(s[v]){F.push(0);continue}F.push(Math.abs(B[v]-R[v]))}return F}r.viewportDistances=n},{"../../../src/Geo":294}],343:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var s=e("../../Component");var u=e("../../Geo");var i=function(a){n(e,a);function e(e,t,r){var n=a.call(this,e,t,r)||this;var i=new u.Spatial;var o=new u.ViewportCoords;n._bounceHandler=new s.BounceHandler(n,t,r,o,i);n._doubleClickZoomHandler=new s.DoubleClickZoomHandler(n,t,r,o);n._dragPanHandler=new s.DragPanHandler(n,t,r,o,i);n._earthControlHandler=new s.EarthControlHandler(n,t,r,o,i);n._scrollZoomHandler=new s.ScrollZoomHandler(n,t,r,o);n._touchZoomHandler=new s.TouchZoomHandler(n,t,r,o);return n}Object.defineProperty(e.prototype,"doubleClickZoom",{get:function(){return this._doubleClickZoomHandler},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"dragPan",{get:function(){return this._dragPanHandler},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"scrollZoom",{get:function(){return this._scrollZoomHandler},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"touchZoom",{get:function(){return this._touchZoomHandler},enumerable:true,configurable:true});e.prototype._activate=function(){var t=this;this._bounceHandler.enable();this._earthControlHandler.enable();this._configurationSubscription=this._configuration$.subscribe(function(e){if(e.doubleClickZoom){t._doubleClickZoomHandler.enable()}else{t._doubleClickZoomHandler.disable()}if(e.dragPan){t._dragPanHandler.enable()}else{t._dragPanHandler.disable()}if(e.scrollZoom){t._scrollZoomHandler.enable()}else{t._scrollZoomHandler.disable()}if(e.touchZoom){t._touchZoomHandler.enable()}else{t._touchZoomHandler.disable()}});this._container.mouseService.claimMouse(this._name,0)};e.prototype._deactivate=function(){this._container.mouseService.unclaimMouse(this._name);this._configurationSubscription.unsubscribe();this._bounceHandler.disable();this._doubleClickZoomHandler.disable();this._dragPanHandler.disable();this._earthControlHandler.disable();this._scrollZoomHandler.disable();this._touchZoomHandler.disable()};e.prototype._getDefaultConfiguration=function(){return{doubleClickZoom:false,dragPan:true,scrollZoom:true,touchZoom:true}};e.componentName="mouse";return e}(s.Component);r.MouseComponent=i;s.ComponentService.register(i);r.default=i},{"../../Component":291,"../../Geo":294}],344:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs/operators");var o=e("../../Component");var a=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e,t,r)||this;i._viewportCoords=n;return i}e.prototype._enable=function(){var f=this;this._container.mouseService.claimWheel(this._component.name,0);this._preventDefaultSubscription=this._container.mouseService.mouseWheel$.subscribe(function(e){e.preventDefault()});this._zoomSubscription=this._container.mouseService.filteredWheel$(this._component.name,this._container.mouseService.mouseWheel$).pipe(i.withLatestFrom(this._navigator.stateService.currentState$,function(e,t){return[e,t]}),i.filter(function(e){var t=e[1].state;return t.currentNode.fullPano||t.nodesAhead<1}),i.map(function(e){return e[0]}),i.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,function(e,t,r){return[e,t,r]})).subscribe(function(e){var t=e[0];var r=e[1];var n=e[2];var i=f._container.element;var o=f._viewportCoords.canvasPosition(t,i),a=o[0],s=o[1];var u=f._viewportCoords.unprojectFromCanvas(a,s,i,r.perspective);var c=n.projectBasic(u.toArray());var h=t.deltaY;if(t.deltaMode===1){h=40*h}else if(t.deltaMode===2){h=800*h}var l=f._viewportCoords.containerToCanvas(i);var p=-3*h/l[1];f._navigator.stateService.zoomIn(p,c)})};e.prototype._disable=function(){this._container.mouseService.unclaimWheel(this._component.name);this._preventDefaultSubscription.unsubscribe();this._zoomSubscription.unsubscribe();this._preventDefaultSubscription=null;this._zoomSubscription=null};e.prototype._getConfiguration=function(e){return{scrollZoom:e}};return e}(o.HandlerBase);r.ScrollZoomHandler=a;r.default=a},{"../../Component":291,"rxjs/operators":241}],345:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs");var a=e("rxjs/operators");var o=e("../../Component");var s=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e,t,r)||this;i._viewportCoords=n;return i}e.prototype._enable=function(){var d=this;this._preventDefaultSubscription=this._container.touchService.pinch$.subscribe(function(e){e.originalEvent.preventDefault()});var e=this._container.touchService.pinchStart$.pipe(a.map(function(e){return true}));var t=this._container.touchService.pinchEnd$.pipe(a.map(function(e){return false}));this._activeSubscription=i.merge(e,t).subscribe(this._container.touchService.activate$);this._zoomSubscription=this._container.touchService.pinch$.pipe(a.withLatestFrom(this._navigator.stateService.currentState$),a.filter(function(e){var t=e[1].state;return t.currentNode.fullPano||t.nodesAhead<1}),a.map(function(e){return e[0]}),a.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe(function(e){var t=e[0],r=e[1],n=e[2];var i=d._container.element;var o=d._viewportCoords.canvasPosition(t,i),a=o[0],s=o[1];var u=d._viewportCoords.unprojectFromCanvas(a,s,i,r.perspective);var c=n.projectBasic(u.toArray());var h=d._viewportCoords.containerToCanvas(i),l=h[0],p=h[1];var f=3*t.distanceChange/Math.min(l,p);d._navigator.stateService.zoomIn(f,c)})};e.prototype._disable=function(){this._activeSubscription.unsubscribe();this._preventDefaultSubscription.unsubscribe();this._zoomSubscription.unsubscribe();this._preventDefaultSubscription=null;this._zoomSubscription=null};e.prototype._getConfiguration=function(e){return{touchZoom:e}};return e}(o.HandlerBase);r.TouchZoomHandler=s;r.default=s},{"../../Component":291,rxjs:43,"rxjs/operators":241}],346:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./popup/Popup");r.Popup=n.Popup;var i=e("./PopupComponent");r.PopupComponent=i.PopupComponent},{"./PopupComponent":347,"./popup/Popup":348}],347:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var a=e("rxjs");var i=e("rxjs/operators");var o=e("../../Component");var s=e("../../Utils");var u=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e,t,r)||this;i._dom=!!n?n:new s.DOM;i._popups=[];i._added$=new a.Subject;i._popups$=new a.Subject;return i}e.prototype.add=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];if(this._popups.indexOf(n)!==-1){continue}this._popups.push(n);if(this._activated){n.setParentContainer(this._popupContainer)}}this._added$.next(e);this._popups$.next(this._popups)};e.prototype.getAll=function(){return this._popups.slice()};e.prototype.remove=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];this._remove(n)}this._popups$.next(this._popups)};e.prototype.removeAll=function(){for(var e=0,t=this._popups.slice();e<t.length;e++){var r=t[e];this._remove(r)}this._popups$.next(this._popups)};e.prototype._activate=function(){var s=this;this._popupContainer=this._dom.createElement("div","mapillary-js-popup-container",this._container.element);for(var e=0,t=this._popups;e<t.length;e++){var r=t[e];r.setParentContainer(this._popupContainer)}this._updateAllSubscription=a.combineLatest(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$).subscribe(function(e){var t=e[0],r=e[1],n=e[2];for(var i=0,o=s._popups;i<o.length;i++){var a=o[i];a.update(t,r,n)}});var n=this._popups$.pipe(i.startWith(this._popups),i.switchMap(function(e){return a.from(e).pipe(i.mergeMap(function(e){return e.changed$}))}),i.map(function(e){return[e]}));this._updateAddedChangedSubscription=a.merge(this._added$,n).pipe(i.withLatestFrom(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$)).subscribe(function(e){var t=e[0],r=e[1],n=e[2],i=e[3];for(var o=0,a=t;o<a.length;o++){var s=a[o];s.update(r,n,i)}})};e.prototype._deactivate=function(){this._updateAllSubscription.unsubscribe();this._updateAddedChangedSubscription.unsubscribe();for(var e=0,t=this._popups;e<t.length;e++){var r=t[e];r.remove()}this._container.element.removeChild(this._popupContainer);delete this._popupContainer};e.prototype._getDefaultConfiguration=function(){return{}};e.prototype._remove=function(e){var t=this._popups.indexOf(e);if(t===-1){return}var r=this._popups.splice(t,1)[0];if(this._activated){r.remove()}};e.componentName="popup";return e}(o.Component);r.PopupComponent=u;o.ComponentService.register(u);r.default=u},{"../../Component":291,"../../Utils":301,rxjs:43,"rxjs/operators":241}],348:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rxjs");var i=e("../../../Geo");var o=e("../../../Utils");var w=e("../../../Viewer");var a=function(){function e(e,t,r){this._options={};e=!!e?e:{};this._options.capturePointer=e.capturePointer===false?e.capturePointer:true;this._options.clean=e.clean;this._options.float=e.float;this._options.offset=e.offset;this._options.opacity=e.opacity;this._options.position=e.position;this._dom=!!r?r:new o.DOM;this._viewportCoords=!!t?t:new i.ViewportCoords;this._notifyChanged$=new n.Subject}Object.defineProperty(e.prototype,"changed$",{get:function(){return this._notifyChanged$},enumerable:true,configurable:true});e.prototype.remove=function(){if(this._content&&this._content.parentNode){this._content.parentNode.removeChild(this._content)}if(this._container){this._container.parentNode.removeChild(this._container);delete this._container}if(this._parentContainer){delete this._parentContainer}};e.prototype.setBasicPoint=function(e){this._point=e.slice();this._rect=null;this._notifyChanged$.next(this)};e.prototype.setBasicRect=function(e){this._rect=e.slice();this._point=null;this._notifyChanged$.next(this)};e.prototype.setDOMContent=function(e){if(this._content&&this._content.parentNode){this._content.parentNode.removeChild(this._content)}var t="mapillaryjs-popup-content"+(this._options.clean===true?"-clean":"")+(this._options.capturePointer===true?" mapillaryjs-popup-capture-pointer":"");this._content=this._dom.createElement("div",t,this._container);this._content.appendChild(e);this._notifyChanged$.next(this)};e.prototype.setHTML=function(e){var t=this._dom.document.createDocumentFragment();var r=this._dom.createElement("body");var n;r.innerHTML=e;while(true){n=r.firstChild;if(!n){break}t.appendChild(n)}this.setDOMContent(t)};e.prototype.setText=function(e){this.setDOMContent(this._dom.document.createTextNode(e))};e.prototype.setParentContainer=function(e){this._parentContainer=e};e.prototype.update=function(e,t,r){var n;if(!this._parentContainer||!this._content){return}if(!this._point&&!this._rect){return}if(!this._container){this._container=this._dom.createElement("div","mapillaryjs-popup",this._parentContainer);var i=this._options.clean!==true&&this._options.float!==w.Alignment.Center;if(i){var o="mapillaryjs-popup-tip"+(this._options.capturePointer===true?" mapillaryjs-popup-capture-pointer":"");this._tip=this._dom.createElement("div",o,this._container);this._dom.createElement("div","mapillaryjs-popup-tip-inner",this._tip)}this._container.appendChild(this._content);this._parentContainer.appendChild(this._container);if(this._options.opacity!=null){this._container.style.opacity=this._options.opacity.toString()}}var a=null;var s=this._alignmentToPopupAligment(this._options.position);var u=this._alignmentToPopupAligment(this._options.float);var c=this._container.classList;if(this._point!=null){a=this._viewportCoords.basicToCanvasSafe(this._point[0],this._point[1],{offsetHeight:t.height,offsetWidth:t.width},r,e.perspective)}else{var h=["center","top","bottom","left","right","top-left","top-right","bottom-left","bottom-right"];var l=null;for(var p=0,f=h;p<f.length;p++){var d=f[p];if(c.contains("mapillaryjs-popup-float-"+d)){l=d;break}}n=this._rectToPixel(this._rect,s,l,e,t,r),a=n[0],s=n[1];if(!u){u=s}}if(a==null){this._container.style.display="none";return}this._container.style.display="";if(!u){var v=this._container.offsetWidth;var m=this._container.offsetHeight;var g=this._pixelToFloats(a,t,v,m);u=g.length===0?"top":g.join("-")}var _=this._normalizeOffset(this._options.offset);a=[a[0]+_[u][0],a[1]+_[u][1]];a=[Math.round(a[0]),Math.round(a[1])];var y={bottom:"translate(-50%,0)","bottom-left":"translate(-100%,0)","bottom-right":"translate(0,0)",center:"translate(-50%,-50%)",left:"translate(-100%,-50%)",right:"translate(0,-50%)",top:"translate(-50%,-100%)","top-left":"translate(-100%,-100%)","top-right":"translate(0,-100%)"};for(var b in y){if(!y.hasOwnProperty(b)){continue}c.remove("mapillaryjs-popup-float-"+b)}c.add("mapillaryjs-popup-float-"+u);this._container.style.transform=y[u]+" translate("+a[0]+"px,"+a[1]+"px)"};e.prototype._rectToPixel=function(e,t,r,n,i,o){if(!t){var a=this._container.offsetWidth;var s=this._container.offsetHeight;var u={bottom:[0,s/2],"bottom-left":[-a/2,s/2],"bottom-right":[a/2,s/2],left:[-a/2,0],right:[a/2,0],top:[0,-s/2],"top-left":[-a/2,-s/2],"top-right":[a/2,-s/2]};var c=["top","bottom","left","right"];var h=[0,null,null];for(var l=0,p=c;l<p.length;l++){var f=p[l];var d=this._pointFromRectPosition(e,f);var v=this._viewportCoords.basicToCanvasSafe(d[0],d[1],{offsetHeight:i.height,offsetWidth:i.width},o,n.perspective);if(v==null){continue}var m=u[f];var g=[v[0]+m[0],v[1]+m[1]];var _=r!=null&&r===f?1:.7;var y=this._pixelToFloats(g,i,a/_,s/(2*_));if(y.length===0&&v[0]>0&&v[0]<i.width&&v[1]>0&&v[1]<i.height){return[v,f]}var b=Math.max(g[0]-a/2,0);var w=Math.min(g[0]+a/2,i.width);var x=Math.max(g[1]-s/2,0);var S=Math.min(g[1]+s/2,i.height);var M=Math.max(0,w-b);var C=Math.max(0,S-x);var E=_*M*C;if(E>h[0]){h[0]=E;h[1]=v;h[2]=f}}if(h[0]>0){return[h[1],h[2]]}}var T=this._pointFromRectPosition(e,t);var O=this._viewportCoords.basicToCanvasSafe(T[0],T[1],{offsetHeight:i.height,offsetWidth:i.width},o,n.perspective);return[O,t!=null?t:"top"]};e.prototype._alignmentToPopupAligment=function(e){switch(e){case w.Alignment.Bottom:return"bottom";case w.Alignment.BottomLeft:return"bottom-left";case w.Alignment.BottomRight:return"bottom-right";case w.Alignment.Center:return"center";case w.Alignment.Left:return"left";case w.Alignment.Right:return"right";case w.Alignment.Top:return"top";case w.Alignment.TopLeft:return"top-left";case w.Alignment.TopRight:return"top-right";default:return null}};e.prototype._normalizeOffset=function(e){if(e==null){return this._normalizeOffset(0)}if(typeof e==="number"){var t=e;var r=t>=0?1:-1;var n=r*Math.round(Math.sqrt(.5*Math.pow(t,2)));return{bottom:[0,t],"bottom-left":[-n,n],"bottom-right":[n,n],center:[0,0],left:[-t,0],right:[t,0],top:[0,-t],"top-left":[-n,-n],"top-right":[n,-n]}}else{return{bottom:e.bottom||[0,0],"bottom-left":e.bottomLeft||[0,0],"bottom-right":e.bottomRight||[0,0],center:e.center||[0,0],left:e.left||[0,0],right:e.right||[0,0],top:e.top||[0,0],"top-left":e.topLeft||[0,0],"top-right":e.topRight||[0,0]}}};e.prototype._pixelToFloats=function(e,t,r,n){var i=[];if(e[1]<n){i.push("bottom")}else if(e[1]>t.height-n){i.push("top")}if(e[0]<r/2){i.push("right")}else if(e[0]>t.width-r/2){i.push("left")}return i};e.prototype._pointFromRectPosition=function(e,t){var r=e[0];var n=e[0]<e[2]?e[2]:e[2]+1;var i=e[1];var o=e[3];switch(t){case"bottom":return[(r+n)/2,o];case"bottom-left":return[r,o];case"bottom-right":return[n,o];case"center":return[(r+n)/2,(i+o)/2];case"left":return[r,(i+o)/2];case"right":return[n,(i+o)/2];case"top":return[(r+n)/2,i];case"top-left":return[r,i];case"top-right":return[n,i];default:return[(r+n)/2,o]}};return e}();r.Popup=a;r.default=a},{"../../../Geo":294,"../../../Utils":301,"../../../Viewer":302,rxjs:43}],349:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var c=e("rxjs");var h=e("rxjs/operators");var u=e("../../Component");var i=e("../../Edge");var o=e("../../Graph");var a=function(a){n(s,a);function s(e,t,r,n,i){var o=a.call(this,e,t,r)||this;o._sequenceDOMRenderer=!!n?n:new u.SequenceDOMRenderer(t);o._scheduler=i;o._containerWidth$=new c.Subject;o._hoveredKeySubject$=new c.Subject;o._hoveredKey$=o._hoveredKeySubject$.pipe(h.share());o._navigator.playService.playing$.pipe(h.skip(1),h.withLatestFrom(o._configuration$)).subscribe(function(e){var t=e[0],r=e[1];o.fire(s.playingchanged,t);if(t===r.playing){return}if(t){o.play()}else{o.stop()}});o._navigator.playService.direction$.pipe(h.skip(1),h.withLatestFrom(o._configuration$)).subscribe(function(e){var t=e[0],r=e[1];if(t!==r.direction){o.setDirection(t)}});return o}Object.defineProperty(s.prototype,"hoveredKey$",{get:function(){return this._hoveredKey$},enumerable:true,configurable:true});s.prototype.play=function(){this.configure({playing:true})};s.prototype.stop=function(){this.configure({playing:false})};s.prototype.setDirection=function(e){this.configure({direction:e})};s.prototype.setHighlightKey=function(e){this.configure({highlightKey:e})};s.prototype.setMaxWidth=function(e){this.configure({maxWidth:e})};s.prototype.setMinWidth=function(e){this.configure({minWidth:e})};s.prototype.setVisible=function(e){this.configure({visible:e})};s.prototype._activate=function(){var u=this;this._sequenceDOMRenderer.activate();var t=this._navigator.stateService.currentNode$.pipe(h.switchMap(function(e){return e.sequenceEdges$}),h.publishReplay(1),h.refCount());var e=this._navigator.stateService.currentNode$.pipe(h.distinctUntilChanged(undefined,function(e){return e.sequenceKey}),h.switchMap(function(e){return c.concat(c.of(null),u._navigator.graphService.cacheSequence$(e.sequenceKey).pipe(h.retry(3),h.catchError(function(e){console.error("Failed to cache sequence",e);return c.of(null)})))}),h.startWith(null),h.publishReplay(1),h.refCount());this._sequenceSubscription=e.subscribe();var i=this._sequenceDOMRenderer.index$.pipe(h.withLatestFrom(e),h.map(function(e){var t=e[0],r=e[1];return r!=null?r.keys[t]:null}),h.filter(function(e){return!!e}),h.distinctUntilChanged(),h.publish(),h.refCount());this._moveSubscription=c.merge(i.pipe(h.debounceTime(100,this._scheduler)),i.pipe(h.auditTime(400,this._scheduler))).pipe(h.distinctUntilChanged(),h.switchMap(function(e){return u._navigator.moveToKey$(e).pipe(h.catchError(function(e){return c.empty()}))})).subscribe();this._setSequenceGraphModeSubscription=this._sequenceDOMRenderer.changingPositionChanged$.pipe(h.filter(function(e){return e})).subscribe(function(){u._navigator.graphService.setGraphMode(o.GraphMode.Sequence)});this._setSpatialGraphModeSubscription=this._sequenceDOMRenderer.changingPositionChanged$.pipe(h.filter(function(e){return!e})).subscribe(function(){u._navigator.graphService.setGraphMode(o.GraphMode.Spatial)});this._navigator.graphService.graphMode$.pipe(h.switchMap(function(e){return e===o.GraphMode.Spatial?u._navigator.stateService.currentNode$.pipe(h.take(2)):c.empty()}),h.filter(function(e){return!e.spatialEdges.cached}),h.switchMap(function(e){return u._navigator.graphService.cacheNode$(e.key).pipe(h.catchError(function(e){return c.empty()}))})).subscribe();this._stopSubscription=this._sequenceDOMRenderer.changingPositionChanged$.pipe(h.filter(function(e){return e})).subscribe(function(){u._navigator.playService.stop()});this._cacheSequenceNodesSubscription=c.combineLatest(this._navigator.graphService.graphMode$,this._sequenceDOMRenderer.changingPositionChanged$.pipe(h.startWith(false),h.distinctUntilChanged())).pipe(h.withLatestFrom(this._navigator.stateService.currentNode$),h.switchMap(function(e){var t=e[0],r=t[0],n=t[1],i=e[1];return n&&r===o.GraphMode.Sequence?u._navigator.graphService.cacheSequenceNodes$(i.sequenceKey,i.key).pipe(h.retry(3),h.catchError(function(e){console.error("Failed to cache sequence nodes.",e);return c.empty()})):c.empty()})).subscribe();var r=e.pipe(h.switchMap(function(r){if(!r){return c.of({index:null,max:null})}var n=true;return u._sequenceDOMRenderer.changingPositionChanged$.pipe(h.startWith(false),h.distinctUntilChanged(),h.switchMap(function(e){var t=!e&&n?0:1;n=false;return e?i:u._navigator.stateService.currentNode$.pipe(h.map(function(e){return e.key}),h.distinctUntilChanged(),h.skip(t))}),h.map(function(e){var t=r.keys.indexOf(e);if(t===-1){return{index:null,max:null}}return{index:t,max:r.keys.length-1}}))}));this._renderSubscription=c.combineLatest(t,this._configuration$,this._containerWidth$,this._sequenceDOMRenderer.changed$.pipe(h.startWith(this._sequenceDOMRenderer)),this._navigator.playService.speed$,r).pipe(h.map(function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5];var s=u._sequenceDOMRenderer.render(t,r,n,o,a.index,a.max,u,u._navigator);return{name:u._name,vnode:s}})).subscribe(this._container.domRenderer.render$);this._setSpeedSubscription=this._sequenceDOMRenderer.speed$.subscribe(function(e){u._navigator.playService.setSpeed(e)});this._setDirectionSubscription=this._configuration$.pipe(h.map(function(e){return e.direction}),h.distinctUntilChanged()).subscribe(function(e){u._navigator.playService.setDirection(e)});this._containerWidthSubscription=c.combineLatest(this._container.renderService.size$,this._configuration$.pipe(h.distinctUntilChanged(function(e,t){return e[0]===t[0]&&e[1]===t[1]},function(e){return[e.minWidth,e.maxWidth]}))).pipe(h.map(function(e){var t=e[0],r=e[1];return u._sequenceDOMRenderer.getContainerWidth(t,r)})).subscribe(this._containerWidth$);this._playingSubscription=this._configuration$.pipe(h.map(function(e){return e.playing}),h.distinctUntilChanged()).subscribe(function(e){if(e){u._navigator.playService.play()}else{u._navigator.playService.stop()}});this._hoveredKeySubscription=this._sequenceDOMRenderer.mouseEnterDirection$.pipe(h.switchMap(function(i){var e=t.pipe(h.map(function(e){for(var t=0,r=e.edges;t<r.length;t++){var n=r[t];if(n.data.direction===i){return n.to}}return null}),h.takeUntil(u._sequenceDOMRenderer.mouseLeaveDirection$));return c.concat(e,c.of(null))}),h.distinctUntilChanged()).subscribe(this._hoveredKeySubject$);this._emitHoveredKeySubscription=this._hoveredKey$.subscribe(function(e){u.fire(s.hoveredkeychanged,e)})};s.prototype._deactivate=function(){this._emitHoveredKeySubscription.unsubscribe();this._renderSubscription.unsubscribe();this._playingSubscription.unsubscribe();this._containerWidthSubscription.unsubscribe();this._hoveredKeySubscription.unsubscribe();this._setSpeedSubscription.unsubscribe();this._setDirectionSubscription.unsubscribe();this._setSequenceGraphModeSubscription.unsubscribe();this._setSpatialGraphModeSubscription.unsubscribe();this._sequenceSubscription.unsubscribe();this._moveSubscription.unsubscribe();this._cacheSequenceNodesSubscription.unsubscribe();this._stopSubscription.unsubscribe();this._sequenceDOMRenderer.deactivate()};s.prototype._getDefaultConfiguration=function(){return{direction:i.EdgeDirection.Next,maxWidth:108,minWidth:70,playing:false,visible:true}};s.componentName="sequence";s.playingchanged="playingchanged";s.hoveredkeychanged="hoveredkeychanged";return s}(u.Component);r.SequenceComponent=a;u.ComponentService.register(a);r.default=a},{"../../Component":291,"../../Edge":292,"../../Graph":295,rxjs:43,"rxjs/operators":241}],350:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rxjs");var i=e("rxjs/operators");var x=e("virtual-dom");var S=e("../../Component");var M=e("../../Edge");var f=e("../../Error");var o=function(){function e(e){this._container=e;this._minThresholdWidth=320;this._maxThresholdWidth=1480;this._minThresholdHeight=240;this._maxThresholdHeight=820;this._stepperDefaultWidth=108;this._controlsDefaultWidth=88;this._defaultHeight=30;this._expandControls=false;this._mode=S.SequenceMode.Default;this._speed=.5;this._changingSpeed=false;this._index=null;this._changingPosition=false;this._mouseEnterDirection$=new n.Subject;this._mouseLeaveDirection$=new n.Subject;this._notifyChanged$=new n.Subject;this._notifyChangingPositionChanged$=new n.Subject;this._notifySpeedChanged$=new n.Subject;this._notifyIndexChanged$=new n.Subject}Object.defineProperty(e.prototype,"changed$",{get:function(){return this._notifyChanged$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"changingPositionChanged$",{get:function(){return this._notifyChangingPositionChanged$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"speed$",{get:function(){return this._notifySpeedChanged$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"index$",{get:function(){return this._notifyIndexChanged$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mouseEnterDirection$",{get:function(){return this._mouseEnterDirection$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mouseLeaveDirection$",{get:function(){return this._mouseLeaveDirection$},enumerable:true,configurable:true});e.prototype.activate=function(){var t=this;if(!!this._changingSubscription){return}this._changingSubscription=n.merge(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(i.filter(function(e){return e.touches.length===0}))).subscribe(function(e){if(t._changingSpeed){t._changingSpeed=false}if(t._changingPosition){t._setChangingPosition(false)}})};e.prototype.deactivate=function(){if(!this._changingSubscription){return}this._changingSpeed=false;this._changingPosition=false;this._expandControls=false;this._mode=S.SequenceMode.Default;this._changingSubscription.unsubscribe();this._changingSubscription=null};e.prototype.render=function(e,t,r,n,i,o,a,s){if(t.visible===false){return x.h("div.SequenceContainer",{},[])}var u=this._createStepper(e,t,r,a,s);var c=this._createSequenceControls(r);var h=this._createPlaybackControls(r,n,a,t);var l=this._createTimelineControls(r,i,o);return x.h("div.SequenceContainer",[u,c,h,l])};e.prototype.getContainerWidth=function(e,t){var r=t.minWidth;var n=t.maxWidth;if(n<r){n=r}var i=(e.width-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth);var o=(e.height-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight);var a=Math.max(0,Math.min(1,Math.min(i,o)));return r+a*(n-r)};e.prototype._createPositionInput=function(e,t){var r=this;this._index=e;var n=function(e){r._index=Number(e.target.value);r._notifyIndexChanged$.next(r._index)};var i=this._container.domContainer.getBoundingClientRect();var o=Math.max(276,Math.min(410,5+.8*i.width))-65;var a=function(e){e.stopPropagation();r._setChangingPosition(true)};var s=function(e){if(r._changingPosition===true){e.stopPropagation()}};var u=function(e){if(e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight"||e.key==="ArrowUp"){e.preventDefault()}};var c={max:t!=null?t:1,min:0,onchange:n,oninput:n,onkeydown:u,onmousedown:a,onmousemove:s,ontouchmove:s,ontouchstart:a,style:{width:o+"px"},type:"range",value:e!=null?e:0};var h=e==null||t==null||t<=1;if(h){c.disabled="true"}var l=x.h("input.SequencePosition",c,[]);var p=h?".SequencePositionContainerDisabled":".SequencePositionContainer";return x.h("div"+p,[l])};e.prototype._createSpeedInput=function(e){var t=this;this._speed=e;var r=function(e){t._speed=Number(e.target.value)/1e3;t._notifySpeedChanged$.next(t._speed)};var n=this._container.domContainer.getBoundingClientRect();var i=Math.max(276,Math.min(410,5+.8*n.width))-160;var o=function(e){t._changingSpeed=true;e.stopPropagation()};var a=function(e){if(t._changingSpeed===true){e.stopPropagation()}};var s=function(e){if(e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight"||e.key==="ArrowUp"){e.preventDefault()}};var u=x.h("input.SequenceSpeed",{max:1e3,min:0,onchange:r,oninput:r,onkeydown:s,onmousedown:o,onmousemove:a,ontouchmove:a,ontouchstart:o,style:{width:i+"px"},type:"range",value:1e3*e},[]);return x.h("div.SequenceSpeedContainer",[u])};e.prototype._createPlaybackControls=function(e,t,r,n){var i=this;if(this._mode!==S.SequenceMode.Playback){return x.h("div.SequencePlayback",[])}var o=x.h("div.SequenceSwitchIcon.SequenceIconVisible",[]);var a=n.direction===M.EdgeDirection.Next?M.EdgeDirection.Prev:M.EdgeDirection.Next;var s=n.playing;var u={onclick:function(){if(!s){r.setDirection(a)}}};var c=n.playing?".SequenceSwitchButtonDisabled":".SequenceSwitchButton";var h=x.h("div"+c,u,[o]);var l=x.h("div.SequenceSlowIcon.SequenceIconVisible",[]);var p=x.h("div.SequenceSlowContainer",[l]);var f=x.h("div.SequenceFastIcon.SequenceIconVisible",[]);var d=x.h("div.SequenceFastContainer",[f]);var v=x.h("div.SequenceCloseIcon.SequenceIconVisible",[]);var m={onclick:function(){i._mode=S.SequenceMode.Default;i._notifyChanged$.next(i)}};var g=x.h("div.SequenceCloseButton",m,[v]);var _=this._createSpeedInput(t);var y=[h,p,_,d,g];var b=Math.round(e/this._stepperDefaultWidth*this._defaultHeight+10);var w={style:{top:b+"px"}};return x.h("div.SequencePlayback",w,y)};e.prototype._createPlayingButton=function(e,t,r,n){var i=r.direction===M.EdgeDirection.Next&&e!=null||r.direction===M.EdgeDirection.Prev&&t!=null;var o=r.playing?function(e){n.stop()}:i?function(e){n.play()}:null;var a={onclick:o};var s=r.playing?"Stop":i?"Play":"PlayDisabled";var u={className:s};if(r.direction===M.EdgeDirection.Prev){u.style={transform:"rotate(180deg) translate(50%, 50%)"}}var c=x.h("div.SequenceComponentIcon",u,[]);var h=i?"SequencePlay":"SequencePlayDisabled";return x.h("div."+h,a,[c])};e.prototype._createSequenceControls=function(e){var t=this;var r=Math.round(8/this._stepperDefaultWidth*e);var n={onclick:function(){t._expandControls=!t._expandControls;t._mode=S.SequenceMode.Default;t._notifyChanged$.next(t)},style:{"border-bottom-right-radius":r+"px","border-top-right-radius":r+"px"}};var i=x.h("div.SequenceExpanderBar",[]);var o=x.h("div.SequenceExpanderButton",n,[i]);var a=this._mode===S.SequenceMode.Playback?".SequenceFastIconGrey.SequenceIconVisible":".SequenceFastIcon";var s=x.h("div"+a,[]);var u={onclick:function(){t._mode=t._mode===S.SequenceMode.Playback?S.SequenceMode.Default:S.SequenceMode.Playback;t._notifyChanged$.next(t)}};var c=x.h("div.SequencePlaybackButton",u,[s]);var h=this._mode===S.SequenceMode.Timeline?".SequenceTimelineIconGrey.SequenceIconVisible":".SequenceTimelineIcon";var l=x.h("div"+h,[]);var p={onclick:function(){t._mode=t._mode===S.SequenceMode.Timeline?S.SequenceMode.Default:S.SequenceMode.Timeline;t._notifyChanged$.next(t)}};var f=x.h("div.SequenceTimelineButton",p,[l]);var d={style:{height:this._defaultHeight/this._stepperDefaultWidth*e+"px",transform:"translate("+(e/2+2)+"px, 0)",width:this._controlsDefaultWidth/this._stepperDefaultWidth*e+"px"}};var v=".SequenceControls"+(this._expandControls?".SequenceControlsExpanded":"");return x.h("div"+v,d,[c,f,o])};e.prototype._createSequenceArrows=function(e,t,r,n,i){var o=this;var a={onclick:e!=null?function(e){i.moveDir$(M.EdgeDirection.Next).subscribe(undefined,function(e){if(!(e instanceof f.AbortMapillaryError)){console.error(e)}})}:null,onmouseenter:function(e){o._mouseEnterDirection$.next(M.EdgeDirection.Next)},onmouseleave:function(e){o._mouseLeaveDirection$.next(M.EdgeDirection.Next)}};var s=Math.round(8/this._stepperDefaultWidth*r);var u={onclick:t!=null?function(e){i.moveDir$(M.EdgeDirection.Prev).subscribe(undefined,function(e){if(!(e instanceof f.AbortMapillaryError)){console.error(e)}})}:null,onmouseenter:function(e){o._mouseEnterDirection$.next(M.EdgeDirection.Prev)},onmouseleave:function(e){o._mouseLeaveDirection$.next(M.EdgeDirection.Prev)},style:{"border-bottom-left-radius":s+"px","border-top-left-radius":s+"px"}};var c=this._getStepClassName(M.EdgeDirection.Next,e,n.highlightKey);var h=this._getStepClassName(M.EdgeDirection.Prev,t,n.highlightKey);var l=x.h("div.SequenceComponentIcon",[]);var p=x.h("div.SequenceComponentIcon",[]);return[x.h("div."+h,u,[p]),x.h("div."+c,a,[l])]};e.prototype._createStepper=function(e,t,r,n,i){var o=null;var a=null;for(var s=0,u=e.edges;s<u.length;s++){var c=u[s];if(c.data.direction===M.EdgeDirection.Next){o=c.to}if(c.data.direction===M.EdgeDirection.Prev){a=c.to}}var h=this._createPlayingButton(o,a,t,n);var l=this._createSequenceArrows(o,a,r,t,i);l.splice(1,0,h);var p={oncontextmenu:function(e){e.preventDefault()},style:{height:this._defaultHeight/this._stepperDefaultWidth*r+"px",width:r+"px"}};return x.h("div.SequenceStepper",p,l)};e.prototype._createTimelineControls=function(e,t,r){var n=this;if(this._mode!==S.SequenceMode.Timeline){return x.h("div.SequenceTimeline",[])}var i=this._createPositionInput(t,r);var o=x.h("div.SequenceCloseIcon.SequenceIconVisible",[]);var a={onclick:function(){n._mode=S.SequenceMode.Default;n._notifyChanged$.next(n)}};var s=x.h("div.SequenceCloseButton",a,[o]);var u=Math.round(e/this._stepperDefaultWidth*this._defaultHeight+10);var c={style:{top:u+"px"}};return x.h("div.SequenceTimeline",c,[i,s])};e.prototype._getStepClassName=function(e,t,r){var n=e===M.EdgeDirection.Next?"SequenceStepNext":"SequenceStepPrev";if(t==null){n+="Disabled"}else{if(r===t){n+="Highlight"}}return n};e.prototype._setChangingPosition=function(e){this._changingPosition=e;this._notifyChangingPositionChanged$.next(e)};return e}();r.SequenceDOMRenderer=o;r.default=o},{"../../Component":291,"../../Edge":292,"../../Error":293,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],351:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["Default"]=0]="Default";e[e["Playback"]=1]="Playback";e[e["Timeline"]=2]="Timeline"})(n=r.SequenceMode||(r.SequenceMode={}));r.default=n},{}],352:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("path");var i=function(){function e(){}e.equirectangular={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float phiLength;\nuniform float phiShift;\nuniform float thetaLength;\nuniform float thetaShift;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lon = atan(b.x, b.z);\n    float x = (lon - phiShift) / phiLength + 0.5;\n    float y = (lat - thetaShift) / thetaLength + 0.5;\n    vec4 baseColor = texture2D(projectorTex, vec2(x, y));\n    baseColor.a = opacity;\n    gl_FragColor = baseColor;\n}",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"};e.equirectangularCurtain={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float curtain;\nuniform float opacity;\nuniform float phiLength;\nuniform float phiShift;\nuniform float thetaLength;\nuniform float thetaShift;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lon = atan(b.x, b.z);\n    float x = (lon - phiShift) / phiLength + 0.5;\n    float y = (lat - thetaShift) / thetaLength + 0.5;\n\n    bool inverted = curtain < 0.5;\n\n    float curtainMin = inverted ? curtain + 0.5 : curtain - 0.5;\n    float curtainMax = curtain;\n\n    bool insideCurtain = inverted ?\n        x > curtainMin || x < curtainMax :\n        x > curtainMin && x < curtainMax;\n\n    vec4 baseColor;\n    if (insideCurtain) {\n        baseColor = texture2D(projectorTex, vec2(x, y));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"};e.perspective={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.z;\n    float y = vRstq.y / vRstq.z;\n    float r2 = x * x + y * y;\n\n    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {\n        r2 = radial_peak * radial_peak;\n    }\n\n    float d = 1.0 + k1 * r2 + k2 * r2 * r2;\n    float u = scale_x * focal * d * x + 0.5;\n    float v = - scale_y * focal * d * y + 0.5;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"};e.perspectiveCurtain={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.z;\n    float y = vRstq.y / vRstq.z;\n    float r2 = x * x + y * y;\n\n    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {\n        r2 = radial_peak * radial_peak;\n    }\n\n    float d = 1.0 + k1 * r2 + k2 * r2 * r2;\n    float u = scale_x * focal * d * x + 0.5;\n    float v = - scale_y * focal * d * y + 0.5;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"};e.fisheye={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x;\n    float y = vRstq.y;\n    float z = vRstq.z;\n\n    float r = sqrt(x * x + y * y);\n    float theta = atan(r, z);\n\n    if (radial_peak > 0. && theta > radial_peak) {\n        theta = radial_peak;\n    }\n\n    float theta2 = theta * theta;\n    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));\n    float s = focal * theta_d / r;\n\n    float u = scale_x * s * x + 0.5;\n    float v = -scale_y * s * y + 0.5;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"};e.fisheyeCurtain={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x;\n    float y = vRstq.y;\n    float z = vRstq.z;\n\n    float r2 = sqrt(x * x + y * y);\n    float theta = atan(r2, z);\n\n    if (radial_peak > 0. && theta > radial_peak) {\n        theta = radial_peak;\n    }\n\n    float theta2 = theta * theta;\n    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));\n    float s = focal * theta_d / r2;\n\n    float u = scale_x * s * x + 0.5;\n    float v = -scale_y * s * y + 0.5;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"};e.perspectiveDistorted={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float u = vRstq.x / vRstq.w;\n    float v = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"};e.perspectiveDistortedCurtain={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float u = vRstq.x / vRstq.w;\n    float v = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"};return e}();r.Shaders=i},{path:39}],353:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var d=e("rxjs");var v=e("rxjs/operators");var m=e("../../Component");var a=e("../../Geo");var g=e("../../State");var _=e("../../Render");var y=e("../../Tiles");var b=e("../../Utils");var i=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e,t,r)||this;i._viewportCoords=!!n?n:new a.ViewportCoords;i._domRenderer=new m.SliderDOMRenderer(t);i._imageTileLoader=new y.ImageTileLoader(b.Urls.tileScheme,b.Urls.tileDomain,b.Urls.origin);i._roiCalculator=new y.RegionOfInterestCalculator;i._spatial=new a.Spatial;i._glRendererOperation$=new d.Subject;i._glRendererCreator$=new d.Subject;i._glRendererDisposer$=new d.Subject;i._glRenderer$=i._glRendererOperation$.pipe(v.scan(function(e,t){return t(e)},null),v.filter(function(e){return e!=null}),v.distinctUntilChanged(undefined,function(e){return e.frameId}));i._glRendererCreator$.pipe(v.map(function(){return function(e){if(e!=null){throw new Error("Multiple slider states can not be created at the same time")}return new m.SliderGLRenderer}})).subscribe(i._glRendererOperation$);i._glRendererDisposer$.pipe(v.map(function(){return function(e){e.dispose();return null}})).subscribe(i._glRendererOperation$);return i}e.prototype.setInitialPosition=function(e){this.configure({initialPosition:e})};e.prototype.setKeys=function(e){this.configure({keys:e})};e.prototype.setSliderMode=function(e){this.configure({mode:e})};e.prototype.setSliderVisible=function(e){this.configure({sliderVisible:e})};e.prototype._activate=function(){var z=this;this._modeSubcription=this._domRenderer.mode$.subscribe(function(e){z.setSliderMode(e)});this._glRenderSubscription=this._glRenderer$.pipe(v.map(function(e){var t={name:z._name,render:{frameId:e.frameId,needsRender:e.needsRender,render:e.render.bind(e),stage:_.GLRenderStage.Background}};return t})).subscribe(this._container.glRenderer.render$);var e=d.concat(this.configuration$.pipe(v.map(function(e){return e.initialPosition!=null?e.initialPosition:1}),v.first()),this._domRenderer.position$);var t=this.configuration$.pipe(v.map(function(e){return e.mode}),v.distinctUntilChanged());var r=this._navigator.stateService.currentState$.pipe(v.map(function(e){return e.state.motionless}),v.distinctUntilChanged());var n=this._navigator.stateService.currentState$.pipe(v.map(function(e){return e.state.currentNode.fullPano}),v.distinctUntilChanged());var i=d.combineLatest(this._configuration$.pipe(v.map(function(e){return e.sliderVisible})),this._navigator.stateService.currentState$.pipe(v.map(function(e){return!(e.state.currentNode==null||e.state.previousNode==null||e.state.currentNode.pano&&!e.state.currentNode.fullPano||e.state.previousNode.pano&&!e.state.previousNode.fullPano||e.state.currentNode.fullPano&&!e.state.previousNode.fullPano)}),v.distinctUntilChanged())).pipe(v.map(function(e){var t=e[0],r=e[1];return t&&r}),v.distinctUntilChanged());this._waitSubscription=d.combineLatest(t,r,n,i).pipe(v.withLatestFrom(this._navigator.stateService.state$)).subscribe(function(e){var t=e[0],r=t[0],n=t[1],i=t[2],o=t[3],a=e[1];var s=o&&(n||r===m.SliderMode.Stationary||i);if(s&&a!==g.State.WaitingInteractively){z._navigator.stateService.waitInteractively()}else if(!s&&a!==g.State.Waiting){z._navigator.stateService.wait()}});this._moveSubscription=d.combineLatest(e,t,r,n,i).subscribe(function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4];if(n||r===m.SliderMode.Stationary||i){z._navigator.stateService.moveTo(1)}else{z._navigator.stateService.moveTo(t)}});this._domRenderSubscription=d.combineLatest(e,t,r,n,i,this._container.renderService.size$).pipe(v.map(function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5];return{name:z._name,vnode:z._domRenderer.render(t,r,n,i,o)}})).subscribe(this._container.domRenderer.render$);this._glRendererCreator$.next(null);this._updateCurtainSubscription=d.combineLatest(e,n,i,this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(v.map(function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4];if(!r){return n?t:1}var a=z._viewportCoords.viewportToBasic(-1.15,0,o,i.perspective);var s=z._viewportCoords.viewportToBasic(1.15,0,o,i.perspective);var u=s[0]<a[0]?s[0]+1:s[0];var c=a[0]+t*(u-a[0]);return c>1?c-1:c}),v.map(function(t){return function(e){e.updateCurtain(t);return e}})).subscribe(this._glRendererOperation$);this._stateSubscription=d.combineLatest(this._navigator.stateService.currentState$,t).pipe(v.map(function(e){var t=e[0],r=e[1];return function(e){e.update(t,r);return e}})).subscribe(this._glRendererOperation$);this._setKeysSubscription=this._configuration$.pipe(v.filter(function(e){return e.keys!=null}),v.switchMap(function(e){return d.zip(d.zip(z._catchCacheNode$(e.keys.background),z._catchCacheNode$(e.keys.foreground)).pipe(v.map(function(e){return{background:e[0],foreground:e[1]}})),z._navigator.stateService.currentState$.pipe(v.first())).pipe(v.map(function(e){return{nodes:e[0],state:e[1].state}}))})).subscribe(function(e){if(e.state.currentNode!=null&&e.state.previousNode!=null&&e.state.currentNode.key===e.nodes.foreground.key&&e.state.previousNode.key===e.nodes.background.key){return}if(e.state.currentNode.key===e.nodes.background.key){z._navigator.stateService.setNodes([e.nodes.foreground]);return}if(e.state.currentNode.key===e.nodes.foreground.key&&e.state.trajectory.length===1){z._navigator.stateService.prependNodes([e.nodes.background]);return}z._navigator.stateService.setNodes([e.nodes.background]);z._navigator.stateService.setNodes([e.nodes.foreground])},function(e){console.error(e)});var o=this._navigator.stateService.currentState$.pipe(v.map(function(e){return e.state.previousNode}),v.filter(function(e){return e!=null}),v.distinctUntilChanged(undefined,function(e){return e.key}));var a=this._navigator.stateService.currentState$.pipe(v.distinctUntilChanged(undefined,function(e){return e.state.currentNode.key}),v.withLatestFrom(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),v.map(function(e){var t=e[0],r=e[1],n=e[2];var i=t.state;var o=Math.max(n.width,n.height);var a=i.currentNode;var s=i.currentTransform;var u=o>2048?2048:o>1024?1024:512;return new y.TextureProvider(a.key,s.basicWidth,s.basicHeight,u,a.image,z._imageTileLoader,new y.ImageTileStore,r)}),v.publishReplay(1),v.refCount());this._textureProviderSubscription=a.subscribe(function(){});this._setTextureProviderSubscription=a.pipe(v.map(function(t){return function(e){e.setTextureProvider(t.key,t);return e}})).subscribe(this._glRendererOperation$);this._setTileSizeSubscription=this._container.renderService.size$.pipe(v.switchMap(function(e){return d.combineLatest(a,d.of(e)).pipe(v.first())})).subscribe(function(e){var t=e[0],r=e[1];var n=Math.max(r.width,r.height);var i=n>2048?2048:n>1024?1024:512;t.setTileSize(i)});this._abortTextureProviderSubscription=a.pipe(v.pairwise()).subscribe(function(e){var t=e[0];t.abort()});var s=d.combineLatest(this._container.renderService.renderCameraFrame$,this._container.renderService.size$.pipe(v.debounceTime(250))).pipe(v.map(function(e){var t=e[0],r=e[1];return[t.camera.position.clone(),t.camera.lookat.clone(),t.zoom.valueOf(),r.height.valueOf(),r.width.valueOf()]}),v.pairwise(),v.skipWhile(function(e){return e[1][2]-e[0][2]<0||e[1][2]===0}),v.map(function(e){var t=e[0][0].equals(e[1][0]);var r=e[0][1].equals(e[1][1]);var n=e[0][2]===e[1][2];var i=e[0][3]===e[1][3];var o=e[0][4]===e[1][4];return t&&r&&n&&i&&o}),v.distinctUntilChanged(),v.filter(function(e){return e}),v.switchMap(function(e){return z._container.renderService.renderCameraFrame$.pipe(v.first())}),v.withLatestFrom(this._container.renderService.size$,this._navigator.stateService.currentTransform$));this._setRegionOfInterestSubscription=a.pipe(v.switchMap(function(i){return s.pipe(v.map(function(e){var t=e[0],r=e[1],n=e[2];return[z._roiCalculator.computeRegionOfInterest(t,r,n),i]}))}),v.filter(function(e){return!e[1].disposed})).subscribe(function(e){var t=e[0];var r=e[1];r.setRegionOfInterest(t)});var u=a.pipe(v.switchMap(function(e){return e.hasTexture$}),v.startWith(false),v.publishReplay(1),v.refCount());this._hasTextureSubscription=u.subscribe(function(){});var c=this._navigator.stateService.currentState$.pipe(v.filter(function(e){return e.state.nodesAhead===0}),v.map(function(e){return e.state.currentNode}),v.distinctUntilChanged(undefined,function(e){return e.key}),v.debounceTime(1e3),v.withLatestFrom(u),v.filter(function(e){return!e[1]}),v.map(function(e){return e[0]}),v.filter(function(e){return e.pano?b.Settings.maxImageSize>b.Settings.basePanoramaSize:b.Settings.maxImageSize>b.Settings.baseImageSize}),v.switchMap(function(r){var e=r.pano?b.Settings.basePanoramaSize:b.Settings.baseImageSize;if(Math.max(r.image.width,r.image.height)>e){return d.empty()}var t=r.cacheImage$(b.Settings.maxImageSize).pipe(v.map(function(e){return[e.image,e]}));return t.pipe(v.takeUntil(u.pipe(v.filter(function(e){return e}))),v.catchError(function(e,t){console.error("Failed to fetch high res image ("+r.key+")",e);return d.empty()}))})).pipe(v.publish(),v.refCount());this._updateBackgroundSubscription=c.pipe(v.withLatestFrom(a)).subscribe(function(e){if(e[0][1].key!==e[1].key||e[1].disposed){return}e[1].updateBackground(e[0][0])});this._updateTextureImageSubscription=c.pipe(v.map(function(t){return function(e){e.updateTextureImage(t[0],t[1]);return e}})).subscribe(this._glRendererOperation$);var h=this._navigator.stateService.currentState$.pipe(v.filter(function(e){return!!e.state.previousNode}),v.distinctUntilChanged(undefined,function(e){return e.state.previousNode.key}),v.withLatestFrom(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),v.map(function(e){var t=e[0],r=e[1],n=e[2];var i=t.state;var o=Math.max(n.width,n.height);var a=i.previousNode;var s=i.previousTransform;var u=o>2048?2048:o>1024?1024:512;return new y.TextureProvider(a.key,s.basicWidth,s.basicHeight,u,a.image,z._imageTileLoader,new y.ImageTileStore,r)}),v.publishReplay(1),v.refCount());this._textureProviderSubscriptionPrev=h.subscribe(function(){});this._setTextureProviderSubscriptionPrev=h.pipe(v.map(function(t){return function(e){e.setTextureProviderPrev(t.key,t);return e}})).subscribe(this._glRendererOperation$);this._setTileSizeSubscriptionPrev=this._container.renderService.size$.pipe(v.switchMap(function(e){return d.combineLatest(h,d.of(e)).pipe(v.first())})).subscribe(function(e){var t=e[0],r=e[1];var n=Math.max(r.width,r.height);var i=n>2048?2048:n>1024?1024:512;t.setTileSize(i)});this._abortTextureProviderSubscriptionPrev=h.pipe(v.pairwise()).subscribe(function(e){var t=e[0];t.abort()});var l=d.combineLatest(this._container.renderService.renderCameraFrame$,this._container.renderService.size$.pipe(v.debounceTime(250))).pipe(v.map(function(e){var t=e[0],r=e[1];return[t.camera.position.clone(),t.camera.lookat.clone(),t.zoom.valueOf(),r.height.valueOf(),r.width.valueOf()]}),v.pairwise(),v.skipWhile(function(e){return e[1][2]-e[0][2]<0||e[1][2]===0}),v.map(function(e){var t=e[0][0].equals(e[1][0]);var r=e[0][1].equals(e[1][1]);var n=e[0][2]===e[1][2];var i=e[0][3]===e[1][3];var o=e[0][4]===e[1][4];return t&&r&&n&&i&&o}),v.distinctUntilChanged(),v.filter(function(e){return e}),v.switchMap(function(e){return z._container.renderService.renderCameraFrame$.pipe(v.first())}),v.withLatestFrom(this._container.renderService.size$,this._navigator.stateService.currentTransform$));this._setRegionOfInterestSubscriptionPrev=h.pipe(v.switchMap(function(i){return l.pipe(v.map(function(e){var t=e[0],r=e[1],n=e[2];return[z._roiCalculator.computeRegionOfInterest(t,r,n),i]}))}),v.filter(function(e){return!e[1].disposed}),v.withLatestFrom(this._navigator.stateService.currentState$)).subscribe(function(e){var t=e[0],r=t[0],n=t[1],i=e[1];var o=null;if(i.state.previousNode.fullPano){if(i.state.currentNode.fullPano){var a=z._spatial.viewingDirection(i.state.currentNode.rotation);var s=z._spatial.viewingDirection(i.state.previousNode.rotation);var u=z._spatial.angleBetweenVector2(a.x,a.y,s.x,s.y);var c=u/(2*Math.PI);var h={maxX:z._spatial.wrap(r.bbox.maxX+c,0,1),maxY:r.bbox.maxY,minX:z._spatial.wrap(r.bbox.minX+c,0,1),minY:r.bbox.minY};o={bbox:h,pixelHeight:r.pixelHeight,pixelWidth:r.pixelWidth}}else{var a=z._spatial.viewingDirection(i.state.currentNode.rotation);var s=z._spatial.viewingDirection(i.state.previousNode.rotation);var u=z._spatial.angleBetweenVector2(a.x,a.y,s.x,s.y);var l=u/(2*Math.PI);var p=z._spatial.angleToPlane(a.toArray(),[0,0,1]);var f=z._spatial.angleToPlane(s.toArray(),[0,0,1]);var d=(f-p)/(2*Math.PI);var v=i.state.currentTransform;var m=Math.max(v.basicWidth,v.basicHeight);var g=m>0?2*Math.atan(.5*v.basicWidth/(m*v.focal)):Math.PI/3;var _=m>0?2*Math.atan(.5*v.basicHeight/(m*v.focal)):Math.PI/3;var y=g/(2*Math.PI);var b=_/Math.PI;var w=(r.bbox.maxX-r.bbox.minX)*y;var x=(r.bbox.maxY-r.bbox.minY)*b;var S=r.pixelWidth*y;var M=r.pixelHeight*b;var C=(r.bbox.minX+r.bbox.maxX)/2-.5;var E=(r.bbox.minY+r.bbox.maxY)/2-.5;var T=.5+l+y*C-w/2;var O=.5+l+y*C+w/2;var P=.5+d+b*E-x/2;var A=.5+d+b*E+x/2;var h={maxX:z._spatial.wrap(O,0,1),maxY:A,minX:z._spatial.wrap(T,0,1),minY:P};o={bbox:h,pixelHeight:M,pixelWidth:S}}}else{var j=i.state.currentTransform.basicAspect;var R=i.state.previousTransform.basicAspect;var k=z._getBasicCorners(j,R),L=k[0],I=L[0],N=L[1],D=k[1],B=D[0],F=D[1];var w=B-I;var x=F-N;var S=r.pixelWidth/w;var M=r.pixelHeight/x;var T=(w-1)/(2*w)+r.bbox.minX/w;var O=(w-1)/(2*w)+r.bbox.maxX/w;var P=(x-1)/(2*x)+r.bbox.minY/x;var A=(x-1)/(2*x)+r.bbox.maxY/x;var h={maxX:O,maxY:A,minX:T,minY:P};z._clipBoundingBox(h);o={bbox:h,pixelHeight:M,pixelWidth:S}}n.setRegionOfInterest(o)});var p=h.pipe(v.switchMap(function(e){return e.hasTexture$}),v.startWith(false),v.publishReplay(1),v.refCount());this._hasTextureSubscriptionPrev=p.subscribe(function(){});var f=this._navigator.stateService.currentState$.pipe(v.filter(function(e){return e.state.nodesAhead===0&&!!e.state.previousNode}),v.map(function(e){return e.state.previousNode}),v.distinctUntilChanged(undefined,function(e){return e.key}),v.debounceTime(1e3),v.withLatestFrom(p),v.filter(function(e){return!e[1]}),v.map(function(e){return e[0]}),v.filter(function(e){return e.pano?b.Settings.maxImageSize>b.Settings.basePanoramaSize:b.Settings.maxImageSize>b.Settings.baseImageSize}),v.switchMap(function(r){var e=r.pano?b.Settings.basePanoramaSize:b.Settings.baseImageSize;if(Math.max(r.image.width,r.image.height)>e){return d.empty()}var t=r.cacheImage$(b.Settings.maxImageSize).pipe(v.map(function(e){return[e.image,e]}));return t.pipe(v.takeUntil(p.pipe(v.filter(function(e){return e}))),v.catchError(function(e,t){console.error("Failed to fetch high res image ("+r.key+")",e);return d.empty()}))})).pipe(v.publish(),v.refCount());this._updateBackgroundSubscriptionPrev=f.pipe(v.withLatestFrom(h)).subscribe(function(e){if(e[0][1].key!==e[1].key||e[1].disposed){return}e[1].updateBackground(e[0][0])});this._updateTextureImageSubscriptionPrev=f.pipe(v.map(function(t){return function(e){e.updateTextureImage(t[0],t[1]);return e}})).subscribe(this._glRendererOperation$)};e.prototype._deactivate=function(){var t=this;this._waitSubscription.unsubscribe();this._navigator.stateService.state$.pipe(v.first()).subscribe(function(e){if(e!==g.State.Traversing){t._navigator.stateService.traverse()}});this._glRendererDisposer$.next(null);this._domRenderer.deactivate();this._modeSubcription.unsubscribe();this._setKeysSubscription.unsubscribe();this._stateSubscription.unsubscribe();this._glRenderSubscription.unsubscribe();this._domRenderSubscription.unsubscribe();this._moveSubscription.unsubscribe();this._updateCurtainSubscription.unsubscribe();this._textureProviderSubscription.unsubscribe();this._setTextureProviderSubscription.unsubscribe();this._setTileSizeSubscription.unsubscribe();this._abortTextureProviderSubscription.unsubscribe();this._setRegionOfInterestSubscription.unsubscribe();this._hasTextureSubscription.unsubscribe();this._updateBackgroundSubscription.unsubscribe();this._updateTextureImageSubscription.unsubscribe();this._textureProviderSubscriptionPrev.unsubscribe();this._setTextureProviderSubscriptionPrev.unsubscribe();this._setTileSizeSubscriptionPrev.unsubscribe();this._abortTextureProviderSubscriptionPrev.unsubscribe();this._setRegionOfInterestSubscriptionPrev.unsubscribe();this._hasTextureSubscriptionPrev.unsubscribe();this._updateBackgroundSubscriptionPrev.unsubscribe();this._updateTextureImageSubscriptionPrev.unsubscribe();this.configure({keys:null})};e.prototype._getDefaultConfiguration=function(){return{initialPosition:1,mode:m.SliderMode.Motion,sliderVisible:true}};e.prototype._catchCacheNode$=function(r){return this._navigator.graphService.cacheNode$(r).pipe(v.catchError(function(e,t){console.error("Failed to cache slider node ("+r+")",e);return d.empty()}))};e.prototype._getBasicCorners=function(e,t){var r;var n;if(e>t){r=.5;n=.5*e/t}else{r=.5*t/e;n=.5}return[[.5-r,.5-n],[.5+r,.5+n]]};e.prototype._clipBoundingBox=function(e){e.minX=Math.max(0,Math.min(1,e.minX));e.maxX=Math.max(0,Math.min(1,e.maxX));e.minY=Math.max(0,Math.min(1,e.minY));e.maxY=Math.max(0,Math.min(1,e.maxY))};e.componentName="slider";return e}(m.Component);r.SliderComponent=i;m.ComponentService.register(i);r.default=i},{"../../Component":291,"../../Geo":294,"../../Render":297,"../../State":298,"../../Tiles":300,"../../Utils":301,rxjs:43,"rxjs/operators":241}],354:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rxjs");var i=e("rxjs/operators");var h=e("virtual-dom");var o=e("../../Component");var a=function(){function e(e){this._container=e;this._interacting=false;this._notifyModeChanged$=new n.Subject;this._notifyPositionChanged$=new n.Subject;this._stopInteractionSubscription=null}Object.defineProperty(e.prototype,"mode$",{get:function(){return this._notifyModeChanged$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"position$",{get:function(){return this._notifyPositionChanged$},enumerable:true,configurable:true});e.prototype.activate=function(){var t=this;if(!!this._stopInteractionSubscription){return}this._stopInteractionSubscription=n.merge(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(i.filter(function(e){return e.touches.length===0}))).subscribe(function(e){if(t._interacting){t._interacting=false}})};e.prototype.deactivate=function(){if(!this._stopInteractionSubscription){return}this._interacting=false;this._stopInteractionSubscription.unsubscribe();this._stopInteractionSubscription=null};e.prototype.render=function(e,t,r,n,i){var o=[];if(i){o.push(h.h("div.SliderBorder",[]));var a=!(r||n);if(a){o.push(this._createModeButton(t));o.push(this._createModeButton2d(t))}o.push(this._createPositionInput(e,a))}var s=this._container.domContainer.getBoundingClientRect();var u=Math.max(215,Math.min(400,s.width-100));return h.h("div.SliderContainer",{style:{width:u+"px"}},o)};e.prototype._createModeButton=function(e){var t=this;var r={onclick:function(){if(e===o.SliderMode.Motion){return}t._notifyModeChanged$.next(o.SliderMode.Motion)}};var n=e===o.SliderMode.Stationary?"SliderModeButtonDisabled":"SliderModeButton";return h.h("div."+n,r,[h.h("div.SliderModeIcon",[])])};e.prototype._createModeButton2d=function(e){var t=this;var r={onclick:function(){if(e===o.SliderMode.Stationary){return}t._notifyModeChanged$.next(o.SliderMode.Stationary)}};var n=e===o.SliderMode.Motion?"SliderModeButton2dDisabled":"SliderModeButton2d";return h.h("div."+n,r,[h.h("div.SliderModeIcon2d",[])])};e.prototype._createPositionInput=function(e,t){var r=this;var n=function(e){r._notifyPositionChanged$.next(Number(e.target.value)/1e3)};var i=function(e){r._interacting=true;e.stopPropagation()};var o=function(e){if(r._interacting){e.stopPropagation()}};var a=function(e){if(e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight"||e.key==="ArrowUp"){e.preventDefault()}};var s=this._container.domContainer.getBoundingClientRect();var u=Math.max(215,Math.min(400,s.width-105))-84+(t?0:52);var c=h.h("input.SliderPosition",{max:1e3,min:0,onchange:n,oninput:n,onkeydown:a,onmousedown:i,onmousemove:o,ontouchmove:o,ontouchstart:i,style:{width:u+"px"},type:"range",value:1e3*e},[]);return h.h("div.SliderPositionContainer",[c])};return e}();r.SliderDOMRenderer=a;r.default=a},{"../../Component":291,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],355:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var E=e("../../Component");var T=e("../../Geo");var n=function(){function e(){this._factory=new E.MeshFactory;this._scene=new E.MeshScene;this._spatial=new T.Spatial;this._currentKey=null;this._previousKey=null;this._disabled=false;this._curtain=1;this._frameId=0;this._needsRender=false;this._mode=null;this._currentProviderDisposers={};this._previousProviderDisposers={}}Object.defineProperty(e.prototype,"disabled",{get:function(){return this._disabled},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"frameId",{get:function(){return this._frameId},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:true,configurable:true});e.prototype.setTextureProvider=function(e,t){this._setTextureProvider(e,this._currentKey,t,this._currentProviderDisposers,this._updateTexture.bind(this))};e.prototype.setTextureProviderPrev=function(e,t){this._setTextureProvider(e,this._previousKey,t,this._previousProviderDisposers,this._updateTexturePrev.bind(this))};e.prototype.update=function(e,t){this._updateFrameId(e.id);this._updateImagePlanes(e.state,t)};e.prototype.updateCurtain=function(e){if(this._curtain===e){return}this._curtain=e;this._updateCurtain();this._needsRender=true};e.prototype.updateTexture=function(e,t){var r=t.key===this._currentKey?this._scene.planes:t.key===this._previousKey?this._scene.planesOld:{};if(Object.keys(r).length===0){return}this._needsRender=true;for(var n in r){if(!r.hasOwnProperty(n)){continue}var i=r[n];var o=i.material;var a=o.uniforms.projectorTex.value;a.image=e;a.needsUpdate=true}};e.prototype.updateTextureImage=function(e,t){if(this._currentKey!==t.key){return}this._needsRender=true;var r=this._scene.planes;for(var n in r){if(!r.hasOwnProperty(n)){continue}var i=r[n];var o=i.material;var a=o.uniforms.projectorTex.value;a.image=e;a.needsUpdate=true}};e.prototype.render=function(e,t){if(!this.disabled){t.render(this._scene.sceneOld,e)}t.render(this._scene.scene,e);this._needsRender=false};e.prototype.dispose=function(){this._scene.clear();for(var e in this._currentProviderDisposers){if(!this._currentProviderDisposers.hasOwnProperty(e)){continue}this._currentProviderDisposers[e]()}for(var e in this._previousProviderDisposers){if(!this._previousProviderDisposers.hasOwnProperty(e)){continue}this._previousProviderDisposers[e]()}this._currentProviderDisposers={};this._previousProviderDisposers={}};e.prototype._getBasicCorners=function(e,t){var r;var n;if(e>t){r=.5;n=.5*e/t}else{r=.5*t/e;n=.5}return[[.5-r,.5-n],[.5+r,.5+n]]};e.prototype._setDisabled=function(e){this._disabled=e.currentNode==null||e.previousNode==null||e.currentNode.pano&&!e.currentNode.fullPano||e.previousNode.pano&&!e.previousNode.fullPano||e.currentNode.fullPano&&!e.previousNode.fullPano};e.prototype._setTextureProvider=function(e,t,r,n,i){var o=this;if(e!==t){return}var a=r.textureCreated$.subscribe(i);var s=r.textureUpdated$.subscribe(function(e){o._needsRender=true});var u=function(){a.unsubscribe();s.unsubscribe();r.dispose()};if(e in n){var c=n[e];c();delete n[e]}n[e]=u};e.prototype._updateCurtain=function(){var e=this._scene.planes;for(var t in e){if(!e.hasOwnProperty(t)){continue}var r=e[t];var n=r.material;if(!!n.uniforms.curtain){n.uniforms.curtain.value=this._curtain}}};e.prototype._updateFrameId=function(e){this._frameId=e};e.prototype._updateImagePlanes=function(e,t){var r=e.currentNode!=null&&this._currentKey!==e.currentNode.key;var n=e.previousNode!=null&&this._previousKey!==e.previousNode.key;var i=this._mode!==t;if(!(r||n||i)){return}this._setDisabled(e);this._needsRender=true;this._mode=t;var o=e.motionless||t===E.SliderMode.Stationary||e.currentNode.pano;if(this.disabled||n){if(this._previousKey in this._previousProviderDisposers){this._previousProviderDisposers[this._previousKey]();delete this._previousProviderDisposers[this._previousKey]}}if(this.disabled){this._scene.setImagePlanesOld({})}else{if(n||i){var a=e.previousNode;this._previousKey=a.key;var s=e.currentTransform.rt.elements;var u=[s[12],s[13],s[14]];var c=e.currentTransform.basicAspect;var h=e.previousTransform.basicAspect;var l=c>h?[1,h/c]:[c/h,1];var p=e.currentNode.rotation;var f=e.currentNode.width;var d=e.currentNode.height;if(a.fullPano){p=e.previousNode.rotation;u=this._spatial.rotate(this._spatial.opticalCenter(e.currentNode.rotation,u).toArray(),p).multiplyScalar(-1).toArray();f=e.previousNode.width;d=e.previousNode.height}var v=new T.Transform(e.currentNode.orientation,f,d,e.currentNode.focal,e.currentNode.scale,a.gpano,p,u,a.image,l);var m=undefined;if(a.fullPano){m=this._factory.createMesh(a,o||e.currentNode.fullPano?v:e.previousTransform)}else{if(o){var g=this._getBasicCorners(c,h),_=g[0],y=_[0],b=_[1],w=g[1],x=w[0],S=w[1];m=this._factory.createFlatMesh(e.previousNode,v,y,x,b,S)}else{m=this._factory.createMesh(e.previousNode,e.previousTransform)}}var M={};M[a.key]=m;this._scene.setImagePlanesOld(M)}}if(r||i){if(this._currentKey in this._currentProviderDisposers){this._currentProviderDisposers[this._currentKey]();delete this._currentProviderDisposers[this._currentKey]}this._currentKey=e.currentNode.key;var C={};if(e.currentNode.fullPano){C[e.currentNode.key]=this._factory.createCurtainMesh(e.currentNode,e.currentTransform)}else if(e.currentNode.pano&&!e.currentNode.fullPano){C[e.currentNode.key]=this._factory.createMesh(e.currentNode,e.currentTransform)}else{if(o){C[e.currentNode.key]=this._factory.createDistortedCurtainMesh(e.currentNode,e.currentTransform)}else{C[e.currentNode.key]=this._factory.createCurtainMesh(e.currentNode,e.currentTransform)}}this._scene.setImagePlanes(C);this._updateCurtain()}};e.prototype._updateTexture=function(e){this._needsRender=true;var t=this._scene.planes;for(var r in t){if(!t.hasOwnProperty(r)){continue}var n=t[r];var i=n.material;var o=i.uniforms.projectorTex.value;i.uniforms.projectorTex.value=null;o.dispose();i.uniforms.projectorTex.value=e}};e.prototype._updateTexturePrev=function(e){this._needsRender=true;var t=this._scene.planesOld;for(var r in t){if(!t.hasOwnProperty(r)){continue}var n=t[r];var i=n.material;var o=i.uniforms.projectorTex.value;i.uniforms.projectorTex.value=null;o.dispose();i.uniforms.projectorTex.value=e}};return e}();r.SliderGLRenderer=n;r.default=n},{"../../Component":291,"../../Geo":294}],356:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["Default"]=0]="Default";e[e["Cluster"]=1]="Cluster";e[e["ConnectedComponent"]=2]="ConnectedComponent";e[e["Sequence"]=3]="Sequence"})(n=r.CameraVisualizationMode||(r.CameraVisualizationMode={}));r.default=n},{}],357:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./CameraVisualizationMode");r.CameraVisualizationMode=n.CameraVisualizationMode},{"./CameraVisualizationMode":356}],358:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=e("latlon-geohash");var a=e("pako");var s=e("rxjs");var u=e("rxjs/operators");var c=e("../../Error");var h=e("../../Utils");var n=function(){function e(e){this._graphService=e;this._tiles={};this._cacheRequests={};this._clusterReconstructions={};this._clusterReconstructionTiles={};this._tileClusters={};this._cachingTiles$={};this._cachingClusterReconstructions$={}}e.prototype.cacheClusterReconstructions$=function(t){var r=this;if(!this.hasTile(t)){throw new Error("Cannot cache reconstructions of a non-existing tile.")}if(this.hasClusterReconstructions(t)){throw new Error("Cannot cache reconstructions that already exists.")}if(this.isCachingClusterReconstructions(t)){return this._cachingClusterReconstructions$[t]}var e=this.getTile(t).filter(function(e){return!!e.clusterKey}).map(function(e){return e.clusterKey}).filter(function(e,t,r){return r.indexOf(e)===t});this._tileClusters[t]=e;this._cacheRequests[t]=[];this._cachingClusterReconstructions$[t]=s.from(e).pipe(u.mergeMap(function(e){if(r._hasClusterReconstruction(e)){return s.of(r._getClusterReconstruction(e))}return r._getClusterReconstruction$(e,r._cacheRequests[t]).pipe(u.catchError(function(e){if(e instanceof c.AbortMapillaryError){return s.empty()}console.error(e);return s.empty()}))},6),u.filter(function(){return t in r._tileClusters}),u.tap(function(e){if(!r._hasClusterReconstruction(e.key)){r._clusterReconstructions[e.key]=e}if(!(e.key in r._clusterReconstructionTiles)){r._clusterReconstructionTiles[e.key]=[]}if(r._clusterReconstructionTiles[e.key].indexOf(t)===-1){r._clusterReconstructionTiles[e.key].push(t)}}),u.finalize(function(){if(t in r._cachingClusterReconstructions$){delete r._cachingClusterReconstructions$[t]}if(t in r._cacheRequests){delete r._cacheRequests[t]}}),u.publish(),u.refCount());return this._cachingClusterReconstructions$[t]};e.prototype.cacheTile$=function(r){var n=this;if(r.length!==8){throw new Error("Hash needs to be level 8.")}if(this.hasTile(r)){throw new Error("Cannot cache tile that already exists.")}if(this.isCachingTile(r)){return this._cachingTiles$[r]}var e=o.bounds(r);var t={lat:e.sw.lat,lon:e.sw.lon};var i={lat:e.ne.lat,lon:e.ne.lon};this._cachingTiles$[r]=this._graphService.cacheBoundingBox$(t,i).pipe(u.catchError(function(e){console.error(e);return s.empty()}),u.map(function(e){return e.map(function(e){return n._createNodeData(e)})}),u.filter(function(){return!(r in n._tiles)}),u.tap(function(e){var t;n._tiles[r]=[];(t=n._tiles[r]).push.apply(t,e);delete n._cachingTiles$[r]}),u.finalize(function(){if(r in n._cachingTiles$){delete n._cachingTiles$[r]}}),u.publish(),u.refCount());return this._cachingTiles$[r]};e.prototype.isCachingClusterReconstructions=function(e){return e in this._cachingClusterReconstructions$};e.prototype.isCachingTile=function(e){return e in this._cachingTiles$};e.prototype.hasClusterReconstructions=function(e){if(e in this._cachingClusterReconstructions$||!(e in this._tileClusters)){return false}for(var t=0,r=this._tileClusters[e];t<r.length;t++){var n=r[t];if(!(n in this._clusterReconstructions)){return false}}return true};e.prototype.hasTile=function(e){return!(e in this._cachingTiles$)&&e in this._tiles};e.prototype.getClusterReconstructions=function(e){var t=this;return e in this._tileClusters?this._tileClusters[e].map(function(e){return t._clusterReconstructions[e]}).filter(function(e){return!!e}):[]};e.prototype.getTile=function(e){return e in this._tiles?this._tiles[e]:[]};e.prototype.uncache=function(e){for(var t=0,r=Object.keys(this._cacheRequests);t<r.length;t++){var n=r[t];if(!!e&&e.indexOf(n)!==-1){continue}for(var i=0,o=this._cacheRequests[n];i<o.length;i++){var a=o[i];a.abort()}delete this._cacheRequests[n]}for(var s=0,u=Object.keys(this._tileClusters);s<u.length;s++){var n=u[s];if(!!e&&e.indexOf(n)!==-1){continue}for(var c=0,h=this._tileClusters[n];c<h.length;c++){var l=h[c];if(!(l in this._clusterReconstructionTiles)){continue}var p=this._clusterReconstructionTiles[l].indexOf(n);if(p===-1){continue}this._clusterReconstructionTiles[l].splice(p,1);if(this._clusterReconstructionTiles[l].length>0){continue}delete this._clusterReconstructionTiles[l];delete this._clusterReconstructions[l]}delete this._tileClusters[n]}for(var f=0,d=Object.keys(this._tiles);f<d.length;f++){var n=d[f];if(!!e&&e.indexOf(n)!==-1){continue}delete this._tiles[n]}};e.prototype._createNodeData=function(e){return{alt:e.alt,cameraProjection:e.cameraProjection,clusterKey:e.clusterKey,focal:e.focal,gpano:e.gpano,height:e.height,k1:e.ck1,k2:e.ck2,key:e.key,lat:e.latLon.lat,lon:e.latLon.lon,mergeCC:e.mergeCC,orientation:e.orientation,originalLat:e.originalLatLon.lat,originalLon:e.originalLatLon.lon,rotation:[e.rotation[0],e.rotation[1],e.rotation[2]],scale:e.scale,sequenceKey:e.sequenceKey,width:e.width}};e.prototype._getClusterReconstruction=function(e){return this._clusterReconstructions[e]};e.prototype._getClusterReconstruction$=function(o,e){return s.Observable.create(function(n){var i=new XMLHttpRequest;i.open("GET",h.Urls.clusterReconstruction(o),true);i.responseType="arraybuffer";i.timeout=15e3;i.onload=function(){if(!i.response){n.error(new Error("Cluster reconstruction retreival failed ("+o+")"))}else{var e=a.inflate(i.response,{to:"string"});var t=JSON.parse(e);if(t.length<1){n.error(new Error("No cluster reconstruction exists ("+o+")"))}var r=t[0];r.key=o;n.next(r);n.complete()}};i.onerror=function(){n.error(new Error("Failed to get cluster reconstruction ("+o+")"))};i.ontimeout=function(){n.error(new Error("Cluster reconstruction request timed out ("+o+")"))};i.onabort=function(){n.error(new c.AbortMapillaryError("Cluster reconstruction request was aborted ("+o+")"))};e.push(i);i.send(null)})};e.prototype._hasClusterReconstruction=function(e){return e in this._clusterReconstructions};return e}();r.SpatialDataCache=n;r.default=n},{"../../Error":293,"../../Utils":301,"latlon-geohash":21,pako:23,rxjs:43,"rxjs/operators":241}],359:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var d=e("latlon-geohash");var h=e("rxjs");var l=e("rxjs/operators");var o=e("../../Component");var a=e("../../Geo");var s=e("../../Render");var u=e("../../viewer/PlayService");var p=e("../../state/State");var f=e("./CameraVisualizationMode");var i=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e,t,r)||this;n._cache=new o.SpatialDataCache(r.graphService);n._scene=new o.SpatialDataScene(n._getDefaultConfiguration());n._viewportCoords=new a.ViewportCoords;n._geoCoords=new a.GeoCoords;return n}e.prototype._activate=function(){var c=this;this._earthControlsSubscription=this._configuration$.pipe(l.map(function(e){return e.earthControls}),l.distinctUntilChanged(),l.withLatestFrom(this._navigator.stateService.state$)).subscribe(function(e){var t=e[0],r=e[1];if(t&&r!==p.default.Earth){c._navigator.stateService.earth()}else if(!t&&r===p.default.Earth){c._navigator.stateService.traverse()}});var e=this._container.renderService.bearing$.pipe(l.map(function(e){var t="";if(e>292.5||e<=67.5){t+="n"}if(e>112.5&&e<=247.5){t+="s"}if(e>22.5&&e<=157.5){t+="e"}if(e>202.5&&e<=337.5){t+="w"}return t}),l.distinctUntilChanged(),l.publishReplay(1),l.refCount());var t=this._navigator.stateService.reference$.pipe(l.tap(function(){c._scene.uncache()}),l.switchMap(function(){return c._navigator.stateService.currentNode$.pipe(l.map(function(e){return d.encode(e.latLon.lat,e.latLon.lon,8)}),l.distinctUntilChanged())}),l.publishReplay(1),l.refCount());var r=h.combineLatest(this._navigator.playService.playing$,this._navigator.playService.speed$).pipe(l.map(function(e){var t=e[0],r=e[1];return t&&r>u.default.sequenceSpeed}),l.distinctUntilChanged(),l.publishReplay(1),l.refCount());var n=h.combineLatest(this._navigator.stateService.state$.pipe(l.map(function(e){return e===p.default.Earth}),l.distinctUntilChanged()),t,r,e).pipe(l.distinctUntilChanged(function(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];var a=t[0],s=t[1],u=t[2],c=t[3];if(r!==a){return false}if(r){return n===s&&i===u}return n===s&&i===u&&o===c}),l.concatMap(function(e){var t=e[0],r=e[1],n=e[2],i=e[3];if(t){return n?h.of([r]):h.of(c._adjacentComponent(r,4))}return n?h.of([r,d.neighbours(r)[i]]):h.of(c._computeTiles(r,i))}),l.publish(),l.refCount());var i=n.pipe(l.switchMap(function(e){return h.from(e).pipe(l.mergeMap(function(e){var t=c._cache.hasTile(e)?h.of(c._cache.getTile(e)):c._cache.cacheTile$(e);return h.combineLatest(h.of(e),t)},6))}),l.publish(),l.refCount());this._addTileSubscription=i.pipe(l.withLatestFrom(this._navigator.stateService.reference$)).subscribe(function(e){var t=e[0][0],r=e[1];if(c._scene.hasTile(t)){return}c._scene.addTile(c._computeTileBBox(t,r),t)});this._addNodeSubscription=i.pipe(l.withLatestFrom(this._navigator.stateService.reference$)).subscribe(function(e){var t=e[0],r=t[0],n=t[1],i=e[1];for(var o=0,a=n;o<a.length;o++){var s=a[o];if(c._scene.hasNode(s.key,r)){continue}c._scene.addNode(s,c._createTransform(s,i),c._computeOriginalPosition(s,i),r)}});this._addReconstructionSubscription=i.pipe(l.concatMap(function(e){var t=e[0];var r;if(c._cache.hasClusterReconstructions(t)){r=h.from(c._cache.getClusterReconstructions(t))}else if(c._cache.isCachingClusterReconstructions(t)){r=c._cache.cacheClusterReconstructions$(t).pipe(l.last(null,{}),l.switchMap(function(){return h.from(c._cache.getClusterReconstructions(t))}))}else if(c._cache.hasTile(t)){r=c._cache.cacheClusterReconstructions$(t)}else{r=h.empty()}return h.combineLatest(h.of(t),r)}),l.withLatestFrom(this._navigator.stateService.reference$)).subscribe(function(e){var t=e[0],r=t[0],n=t[1],i=e[1];if(c._scene.hasClusterReconstruction(n.key,r)){return}c._scene.addClusterReconstruction(n,c._computeTranslation(n,i),r)});this._cameraVisibilitySubscription=this._configuration$.pipe(l.map(function(e){return e.camerasVisible}),l.distinctUntilChanged()).subscribe(function(e){c._scene.setCameraVisibility(e)});this._pointVisibilitySubscription=this._configuration$.pipe(l.map(function(e){return e.pointsVisible}),l.distinctUntilChanged()).subscribe(function(e){c._scene.setPointVisibility(e)});this._positionVisibilitySubscription=this._configuration$.pipe(l.map(function(e){return e.positionsVisible}),l.distinctUntilChanged()).subscribe(function(e){c._scene.setPositionVisibility(e)});this._tileVisibilitySubscription=this._configuration$.pipe(l.map(function(e){return e.tilesVisible}),l.distinctUntilChanged()).subscribe(function(e){c._scene.setTileVisibility(e)});this._ccToModeSubscription=this._configuration$.pipe(l.map(function(e){return e.connectedComponents===true?f.default.ConnectedComponent:f.default.Default}),l.distinctUntilChanged()).subscribe(function(e){c.configure({cameraVisualizationMode:e})});this._cameraVisualizationModeSubscription=this._configuration$.pipe(l.map(function(e){return e.cameraVisualizationMode}),l.distinctUntilChanged()).subscribe(function(e){c._scene.setCameraVisualizationMode(e)});this._uncacheSubscription=t.subscribe(function(e){var t=c._adjacentComponent(e,4);c._scene.uncache(t);c._cache.uncache(t)});this._moveSubscription=this._navigator.playService.playing$.pipe(l.switchMap(function(e){return e?h.empty():c._container.mouseService.dblClick$}),l.withLatestFrom(this._container.renderService.renderCamera$),l.switchMap(function(e){var t=e[0],r=e[1];var n=c._container.element;var i=c._viewportCoords.canvasPosition(t,n),o=i[0],a=i[1];var s=c._viewportCoords.canvasToViewport(o,a,n);var u=c._scene.intersectObjects(s,r.perspective);return!!u?c._navigator.moveToKey$(u).pipe(l.catchError(function(){return h.empty()})):h.empty()})).subscribe();this._renderSubscription=this._navigator.stateService.currentState$.pipe(l.map(function(e){var t=c._scene;return{name:c._name,render:{frameId:e.id,needsRender:t.needsRender,render:t.render.bind(t),stage:s.GLRenderStage.Foreground}}})).subscribe(this._container.glRenderer.render$)};e.prototype._deactivate=function(){var t=this;this._cache.uncache();this._scene.uncache();this._addNodeSubscription.unsubscribe();this._addReconstructionSubscription.unsubscribe();this._addTileSubscription.unsubscribe();this._cameraVisibilitySubscription.unsubscribe();this._earthControlsSubscription.unsubscribe();this._moveSubscription.unsubscribe();this._pointVisibilitySubscription.unsubscribe();this._positionVisibilitySubscription.unsubscribe();this._renderSubscription.unsubscribe();this._tileVisibilitySubscription.unsubscribe();this._uncacheSubscription.unsubscribe();this._cameraVisualizationModeSubscription.unsubscribe();this._ccToModeSubscription.unsubscribe();this._navigator.stateService.state$.pipe(l.first()).subscribe(function(e){if(e===p.default.Earth){t._navigator.stateService.traverse()}})};e.prototype._getDefaultConfiguration=function(){return{cameraVisualizationMode:f.default.Default,camerasVisible:false,connectedComponents:false,pointsVisible:true,positionsVisible:false,tilesVisible:false}};e.prototype._adjacentComponent=function(e,t){var r=new Set;r.add(e);this._adjacentComponentRecursive(r,[e],0,t);return this._setToArray(r)};e.prototype._adjacentComponentRecursive=function(e,t,r,n){if(r===n){return}var i=[];for(var o=0,a=t;o<a.length;o++){var s=a[o];var u=d.neighbours(s);for(var c in u){if(!u.hasOwnProperty(c)){continue}i.push(u[c])}}var h=[];for(var l=0,p=i;l<p.length;l++){var f=p[l];if(!e.has(f)){e.add(f);h.push(f)}}this._adjacentComponentRecursive(e,h,r+1,n)};e.prototype._computeOriginalPosition=function(e,t){return this._geoCoords.geodeticToEnu(e.originalLat,e.originalLon,e.alt,t.lat,t.lon,t.alt)};e.prototype._computeTileBBox=function(e,t){var r=d.bounds(e);var n=this._geoCoords.geodeticToEnu(r.sw.lat,r.sw.lon,0,t.lat,t.lon,t.alt);var i=this._geoCoords.geodeticToEnu(r.ne.lat,r.ne.lon,0,t.lat,t.lon,t.alt);return[n,i]};e.prototype._createTransform=function(e,t){var r=a.Geo.computeTranslation({alt:e.alt,lat:e.lat,lon:e.lon},e.rotation,t);var n=new a.Transform(e.orientation,e.width,e.height,e.focal,e.scale,e.gpano,e.rotation,r,undefined,undefined,e.k1,e.k2,e.cameraProjection);return n};e.prototype._computeTiles=function(e,t){var r=new Set;var n=["n","ne","e","se","s","sw","w","nw"];this._computeTilesRecursive(r,e,t,n,0,2);return this._setToArray(r)};e.prototype._computeTilesRecursive=function(e,t,r,n,i,o){e.add(t);if(i===o){return}var a=d.neighbours(t);var s=n.indexOf(r);var u=n.length;var c=[a[n[this._modulo(s-1,u)]],a[r],a[n[this._modulo(s+1,u)]]];for(var h=0,l=c;h<l.length;h++){var p=l[h];this._computeTilesRecursive(e,p,r,n,i+1,o)}};e.prototype._computeTranslation=function(e,t){return this._geoCoords.geodeticToEnu(e.reference_lla.latitude,e.reference_lla.longitude,e.reference_lla.altitude,t.lat,t.lon,t.alt)};e.prototype._modulo=function(e,t){return(e%t+t)%t};e.prototype._setToArray=function(e){var t=[];e.forEach(function(e){t.push(e)});return t};e.componentName="spatialData";return e}(o.Component);r.SpatialDataComponent=i;o.ComponentService.register(i);r.default=i},{"../../Component":291,"../../Geo":294,"../../Render":297,"../../state/State":438,"../../viewer/PlayService":468,"./CameraVisualizationMode":356,"latlon-geohash":21,rxjs:43,"rxjs/operators":241}],360:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var d=e("three");var l=e("./CameraVisualizationMode");var n=function(){function e(e,t,r){this._scene=!!t?t:new d.Scene;this._raycaster=!!r?r:new d.Raycaster(undefined,undefined,.8);this._cameraColors={};this._needsRender=false;this._interactiveObjects=[];this._nodes={};this._tiles={};this._tileClusterReconstructions={};this._clusterReconstructions={};this._cameraVisualizationMode=!!e.cameraVisualizationMode?e.cameraVisualizationMode:l.default.Default;if(this._cameraVisualizationMode===l.default.Default&&e.connectedComponents===true){this._cameraVisualizationMode=l.default.ConnectedComponent}this._camerasVisible=e.camerasVisible;this._pointsVisible=e.pointsVisible;this._positionsVisible=e.positionsVisible;this._tilesVisible=e.tilesVisible}Object.defineProperty(e.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:true,configurable:true});e.prototype.addClusterReconstruction=function(e,t,r){if(this.hasClusterReconstruction(e.key,r)){return}var n=e.key;if(!(n in this._clusterReconstructions)){this._clusterReconstructions[n]={points:new d.Object3D,tiles:[]};this._clusterReconstructions[n].points.visible=this._pointsVisible;this._clusterReconstructions[n].points.add(this._createClusterPoints(e,t));this._scene.add(this._clusterReconstructions[n].points)}if(this._clusterReconstructions[n].tiles.indexOf(r)===-1){this._clusterReconstructions[n].tiles.push(r)}if(!(r in this._tileClusterReconstructions)){this._tileClusterReconstructions[r]={keys:[]}}if(this._tileClusterReconstructions[r].keys.indexOf(n)===-1){this._tileClusterReconstructions[r].keys.push(n)}this._needsRender=true};e.prototype.addNode=function(e,t,r,n){var i=e.key;var o=e.clusterKey;var a=e.sequenceKey;var s=!!e.mergeCC?e.mergeCC.toString():"";if(this.hasNode(i,n)){return}if(!(n in this._nodes)){this._nodes[n]={cameraKeys:{},cameras:new d.Object3D,clusters:{},connectedComponents:{},keys:[],positions:new d.Object3D,sequences:{}};this._nodes[n].cameras.visible=this._camerasVisible;this._nodes[n].positions.visible=this._positionsVisible;this._scene.add(this._nodes[n].cameras,this._nodes[n].positions)}if(!(s in this._nodes[n].connectedComponents)){this._nodes[n].connectedComponents[s]=[]}if(!(o in this._nodes[n].clusters)){this._nodes[n].clusters[o]=[]}if(!(a in this._nodes[n].sequences)){this._nodes[n].sequences[a]=[]}var u=this._createCamera(t);this._nodes[n].cameras.add(u);for(var c=0,h=u.children;c<h.length;c++){var l=h[c];this._nodes[n].cameraKeys[l.uuid]=i;this._interactiveObjects.push(l)}this._nodes[n].connectedComponents[s].push(u);this._nodes[n].clusters[o].push(u);this._nodes[n].sequences[a].push(u);var p=this._getId(o,s,a,this._cameraVisualizationMode);var f=this._getColor(p,this._cameraVisualizationMode);this._setCameraColor(f,u);this._nodes[n].positions.add(this._createPosition(t,r));this._nodes[n].keys.push(i);this._needsRender=true};e.prototype.addTile=function(e,t){if(this.hasTile(t)){return}var r=e[0];var n=e[1];var i=new d.Geometry;i.vertices.push((new d.Vector3).fromArray(r),new d.Vector3(r[0],n[1],(r[2]+n[2])/2),(new d.Vector3).fromArray(n),new d.Vector3(n[0],r[1],(r[2]+n[2])/2),(new d.Vector3).fromArray(r));var o=new d.Line(i,new d.LineBasicMaterial);this._tiles[t]=new d.Object3D;this._tiles[t].visible=this._tilesVisible;this._tiles[t].add(o);this._scene.add(this._tiles[t]);this._needsRender=true};e.prototype.uncache=function(e){for(var t=0,r=Object.keys(this._tileClusterReconstructions);t<r.length;t++){var n=r[t];if(!!e&&e.indexOf(n)!==-1){continue}this._disposeReconstruction(n)}for(var i=0,o=Object.keys(this._nodes);i<o.length;i++){var n=o[i];if(!!e&&e.indexOf(n)!==-1){continue}this._disposeNodes(n)}for(var a=0,s=Object.keys(this._tiles);a<s.length;a++){var n=s[a];if(!!e&&e.indexOf(n)!==-1){continue}this._disposeTile(n)}this._needsRender=true};e.prototype.hasClusterReconstruction=function(e,t){return e in this._clusterReconstructions&&this._clusterReconstructions[e].tiles.indexOf(t)!==-1};e.prototype.hasTile=function(e){return e in this._tiles};e.prototype.hasNode=function(e,t){return t in this._nodes&&this._nodes[t].keys.indexOf(e)!==-1};e.prototype.intersectObjects=function(e,t){var r=e[0],n=e[1];if(!this._camerasVisible){return null}this._raycaster.setFromCamera(new d.Vector2(r,n),t);var i=this._raycaster.intersectObjects(this._interactiveObjects);for(var o=0,a=i;o<a.length;o++){var s=a[o];for(var u in this._nodes){if(!this._nodes.hasOwnProperty(u)){continue}if(s.object.uuid in this._nodes[u].cameraKeys){return this._nodes[u].cameraKeys[s.object.uuid]}}}return null};e.prototype.setCameraVisibility=function(e){if(e===this._camerasVisible){return}for(var t in this._nodes){if(!this._nodes.hasOwnProperty(t)){continue}this._nodes[t].cameras.visible=e}this._camerasVisible=e;this._needsRender=true};e.prototype.setPointVisibility=function(e){if(e===this._pointsVisible){return}for(var t in this._clusterReconstructions){if(!this._clusterReconstructions.hasOwnProperty(t)){continue}this._clusterReconstructions[t].points.visible=e}this._pointsVisible=e;this._needsRender=true};e.prototype.setPositionVisibility=function(e){if(e===this._positionsVisible){return}for(var t in this._nodes){if(!this._nodes.hasOwnProperty(t)){continue}this._nodes[t].positions.visible=e}this._positionsVisible=e;this._needsRender=true};e.prototype.setTileVisibility=function(e){if(e===this._tilesVisible){return}for(var t in this._tiles){if(!this._tiles.hasOwnProperty(t)){continue}this._tiles[t].visible=e}this._tilesVisible=e;this._needsRender=true};e.prototype.setCameraVisualizationMode=function(e){if(e===this._cameraVisualizationMode){return}for(var t in this._nodes){if(!this._nodes.hasOwnProperty(t)){continue}var r=undefined;if(e===l.default.Cluster){r=this._nodes[t].clusters}else if(e===l.default.ConnectedComponent){r=this._nodes[t].connectedComponents}else if(e===l.default.Sequence){r=this._nodes[t].sequences}else{for(var n=0,i=this._nodes[t].cameras.children;n<i.length;n++){var o=i[n];var a=this._getColor("",e);this._setCameraColor(a,o)}continue}for(var s in r){if(!r.hasOwnProperty(s)){continue}var a=this._getColor(s,e);for(var u=0,c=r[s];u<c.length;u++){var h=c[u];this._setCameraColor(a,h)}}}this._cameraVisualizationMode=e;this._needsRender=true};e.prototype.render=function(e,t){t.render(this._scene,e);this._needsRender=false};e.prototype._arrayToFloatArray=function(e,t){var r=e.length;var n=new Float32Array(r*t);for(var i=0;i<r;i++){var o=e[i];var a=3*i;n[a+0]=o[0];n[a+1]=o[1];n[a+2]=o[2]}return n};e.prototype._createAxis=function(e){var t=e.unprojectBasic([.5,0],.22);var r=e.unprojectBasic([.5,1],.16);var n=new d.BufferGeometry;n.addAttribute("position",new d.BufferAttribute(this._arrayToFloatArray([t,r],3),3));return new d.Line(n,new d.LineBasicMaterial)};e.prototype._createCamera=function(e){return!!e.gpano?this._createPanoCamera(e):this._createPrespectiveCamera(e)};e.prototype._createDiagonals=function(e,t){var r=e.unprojectBasic([0,0],0,true);var n=e.unprojectBasic([0,0],t,true);var i=e.unprojectBasic([1,0],t,true);var o=e.unprojectBasic([1,1],t,true);var a=e.unprojectBasic([0,1],t,true);var s=[r,n,r,i,r,o,r,a];var u=new d.BufferGeometry;u.addAttribute("position",new d.BufferAttribute(this._arrayToFloatArray(s,3),3));return new d.LineSegments(u,new d.LineBasicMaterial)};e.prototype._createFrame=function(t,r){var e=[];e.push.apply(e,this._subsample([0,1],[0,0],20));e.push.apply(e,this._subsample([0,0],[1,0],20));e.push.apply(e,this._subsample([1,0],[1,1],20));var n=e.map(function(e){return t.unprojectBasic(e,r,true)});var i=new d.BufferGeometry;i.addAttribute("position",new d.BufferAttribute(this._arrayToFloatArray(n,3),3));return new d.Line(i,new d.LineBasicMaterial)};e.prototype._createLatitude=function(e,t,r){var n=new Float32Array((t+1)*3);for(var i=0;i<=t;i++){var o=r.unprojectBasic([i/t,e],.16);var a=3*i;n[a+0]=o[0];n[a+1]=o[1];n[a+2]=o[2]}var s=new d.BufferGeometry;s.addAttribute("position",new d.BufferAttribute(n,3));return new d.Line(s,new d.LineBasicMaterial)};e.prototype._createLongitude=function(e,t,r){var n=new Float32Array((t+1)*3);for(var i=0;i<=t;i++){var o=r.unprojectBasic([e,i/t],.16);var a=3*i;n[a+0]=o[0];n[a+1]=o[1];n[a+2]=o[2]}var s=new d.BufferGeometry;s.addAttribute("position",new d.BufferAttribute(n,3));return new d.Line(s,new d.LineBasicMaterial)};e.prototype._createPanoCamera=function(e){var t=new d.Object3D;t.children.push(this._createAxis(e));t.children.push(this._createLatitude(.5,10,e));t.children.push(this._createLongitude(0,6,e));t.children.push(this._createLongitude(.25,6,e));t.children.push(this._createLongitude(.5,6,e));t.children.push(this._createLongitude(.75,6,e));return t};e.prototype._createClusterPoints=function(t,e){var r=Object.keys(t.points).map(function(e){return t.points[e]});var n=r.length;var i=new Float32Array(n*3);var o=new Float32Array(n*3);for(var a=0;a<n;a++){var s=3*a;var u=r[a].coordinates;var c=new d.Vector3(u[0],u[1],u[2]).add((new d.Vector3).fromArray(e));i[s+0]=c.x;i[s+1]=c.y;i[s+2]=c.z;var h=r[a].color;o[s+0]=h[0]/255;o[s+1]=h[1]/255;o[s+2]=h[2]/255}var l=new d.BufferGeometry;l.addAttribute("position",new d.BufferAttribute(i,3));l.addAttribute("color",new d.BufferAttribute(o,3));var p=new d.PointsMaterial({size:.1,vertexColors:d.VertexColors});return new d.Points(l,p)};e.prototype._createPosition=function(e,t){var r=e.unprojectBasic([0,0],0);var n=[t,r];var i=new d.BufferGeometry;i.addAttribute("position",new d.BufferAttribute(this._arrayToFloatArray(n,3),3));return new d.Line(i,new d.LineBasicMaterial({color:new d.Color(1,0,0)}))};e.prototype._createPrespectiveCamera=function(e){var t=.2;var r=new d.Object3D;r.children.push(this._createDiagonals(e,t));r.children.push(this._createFrame(e,t));return r};e.prototype._disposeCameras=function(e){var t=this._nodes[e].cameras;for(var r=0,n=t.children.slice();r<n.length;r++){var i=n[r];for(var o=0,a=i.children;o<a.length;o++){var s=a[o];s.geometry.dispose();s.material.dispose();var u=this._interactiveObjects.indexOf(s);if(u!==-1){this._interactiveObjects.splice(u,1)}else{console.warn("Object does not exist ("+s.id+") for "+e)}}t.remove(i)}this._scene.remove(t)};e.prototype._disposePoints=function(e){for(var t=0,r=this._tileClusterReconstructions[e].keys;t<r.length;t++){var n=r[t];if(!(n in this._clusterReconstructions)){continue}var i=this._clusterReconstructions[n].tiles.indexOf(e);if(i===-1){continue}this._clusterReconstructions[n].tiles.splice(i,1);if(this._clusterReconstructions[n].tiles.length>0){continue}for(var o=0,a=this._clusterReconstructions[n].points.children.slice();o<a.length;o++){var s=a[o];s.geometry.dispose();s.material.dispose()}this._scene.remove(this._clusterReconstructions[n].points);delete this._clusterReconstructions[n]}};e.prototype._disposePositions=function(e){var t=this._nodes[e].positions;for(var r=0,n=t.children.slice();r<n.length;r++){var i=n[r];i.geometry.dispose();i.material.dispose();t.remove(i)}this._scene.remove(t)};e.prototype._disposeNodes=function(e){this._disposeCameras(e);this._disposePositions(e);delete this._nodes[e]};e.prototype._disposeReconstruction=function(e){this._disposePoints(e);delete this._tileClusterReconstructions[e]};e.prototype._disposeTile=function(e){var t=this._tiles[e];for(var r=0,n=t.children.slice();r<n.length;r++){var i=n[r];i.geometry.dispose();i.material.dispose();t.remove(i)}this._scene.remove(t);delete this._tiles[e]};e.prototype._getColor=function(e,t){return t!==l.default.Default&&e.length>0?this._getCameraColor(e):"#FFFFFF"};e.prototype._getCameraColor=function(e){if(!(e in this._cameraColors)){this._cameraColors[e]=this._randomColor()}return this._cameraColors[e]};e.prototype._getId=function(e,t,r,n){switch(n){case l.default.Cluster:return e;case l.default.ConnectedComponent:return t;case l.default.Sequence:return r;default:return""}};e.prototype._interpolate=function(e,t,r){return e+r*(t-e)};e.prototype._randomColor=function(){return"hsl("+Math.floor(360*Math.random())+", 100%, 65%)"};e.prototype._setCameraColor=function(e,t){for(var r=0,n=t.children;r<n.length;r++){var i=n[r];i.material.color=new d.Color(e)}};e.prototype._subsample=function(e,t,r){if(r<1){return[e,t]}var n=[];for(var i=0;i<=r+1;i++){var o=[];for(var a=0;a<3;a++){o.push(this._interpolate(e[a],t[a],i/(r+1)))}n.push(o)}return n};return e}();r.SpatialDataScene=n;r.default=n},{"./CameraVisualizationMode":356,three:242}],361:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("./error/GeometryTagError");r.GeometryTagError=n.GeometryTagError;var i=e("./geometry/PointGeometry");r.PointGeometry=i.PointGeometry;var o=e("./geometry/PointsGeometry");r.PointsGeometry=o.PointsGeometry;var a=e("./geometry/RectGeometry");r.RectGeometry=a.RectGeometry;var s=e("./geometry/PolygonGeometry");r.PolygonGeometry=s.PolygonGeometry;var u=e("./tag/OutlineTag");r.OutlineTag=u.OutlineTag;var c=e("./tag/ExtremePointTag");r.ExtremePointTag=c.ExtremePointTag;var h=e("./tag/SpotTag");r.SpotTag=h.SpotTag;var l=e("./tag/TagDomain");r.TagDomain=l.TagDomain;var p=e("./TagComponent");r.TagComponent=p.TagComponent;var f=e("./TagMode");r.TagMode=f.TagMode},{"./TagComponent":362,"./TagMode":365,"./error/GeometryTagError":369,"./geometry/PointGeometry":371,"./geometry/PointsGeometry":372,"./geometry/PolygonGeometry":373,"./geometry/RectGeometry":374,"./tag/ExtremePointTag":388,"./tag/OutlineTag":392,"./tag/SpotTag":395,"./tag/TagDomain":397}],362:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var s=e("rxjs");var u=e("rxjs/operators");var a=e("when");var c=e("../../Component");var h=e("../../Geo");var l=e("../../Render");var i=function(i){n(o,i);function o(e,t,r){var n=i.call(this,e,t,r)||this;n._tagDomRenderer=new c.TagDOMRenderer;n._tagScene=new c.TagScene;n._tagSet=new c.TagSet;n._tagCreator=new c.TagCreator(n,r);n._viewportCoords=new h.ViewportCoords;n._createHandlers={CreatePoint:new c.CreatePointHandler(n,t,r,n._viewportCoords,n._tagCreator),CreatePoints:new c.CreatePointsHandler(n,t,r,n._viewportCoords,n._tagCreator),CreatePolygon:new c.CreatePolygonHandler(n,t,r,n._viewportCoords,n._tagCreator),CreateRect:new c.CreateRectHandler(n,t,r,n._viewportCoords,n._tagCreator),CreateRectDrag:new c.CreateRectDragHandler(n,t,r,n._viewportCoords,n._tagCreator),Default:undefined};n._editVertexHandler=new c.EditVertexHandler(n,t,r,n._viewportCoords,n._tagSet);n._renderTags$=n._tagSet.changed$.pipe(u.map(function(e){var t=e.getAll();t.sort(function(e,t){var r=e.tag.id;var n=t.tag.id;if(r<n){return-1}if(r>n){return 1}return 0});return t}),u.share());n._tagChanged$=n._renderTags$.pipe(u.switchMap(function(e){return s.from(e).pipe(u.mergeMap(function(e){return s.merge(e.tag.changed$,e.tag.geometryChanged$)}))}),u.share());n._renderTagGLChanged$=n._renderTags$.pipe(u.switchMap(function(e){return s.from(e).pipe(u.mergeMap(function(e){return e.glObjectsChanged$}))}),u.share());n._createGeometryChanged$=n._tagCreator.tag$.pipe(u.switchMap(function(e){return e!=null?e.geometryChanged$:s.empty()}),u.share());n._createGLObjectsChanged$=n._tagCreator.tag$.pipe(u.switchMap(function(e){return e!=null?e.glObjectsChanged$:s.empty()}),u.share());n._creatingConfiguration$=n._configuration$.pipe(u.distinctUntilChanged(function(e,t){return e.mode===t.mode},function(e){return{createColor:e.createColor,mode:e.mode}}),u.publishReplay(1),u.refCount());n._creatingConfiguration$.subscribe(function(e){n.fire(o.modechanged,e.mode)});return n}o.prototype.add=function(r){var n=this;if(this._activated){this._navigator.stateService.currentTransform$.pipe(u.first()).subscribe(function(e){n._tagSet.add(r,e);var t=r.map(function(e){return n._tagSet.get(e.id)});n._tagScene.add(t)})}else{this._tagSet.addDeactivated(r)}};o.prototype.calculateRect=function(n){var e=this;return a.promise(function(t,r){e._navigator.stateService.currentTransform$.pipe(u.first(),u.map(function(e){return n.getRect2d(e)})).subscribe(function(e){t(e)},function(e){r(e)})})};o.prototype.create=function(){this._tagCreator.replayedTag$.pipe(u.first(),u.filter(function(e){return!!e})).subscribe(function(e){e.create()})};o.prototype.changeMode=function(e){this.configure({mode:e})};o.prototype.get=function(e){if(this._activated){var t=this._tagSet.get(e);return t!==undefined?t.tag:undefined}else{return this._tagSet.getDeactivated(e)}};o.prototype.getAll=function(){if(this.activated){return this._tagSet.getAll().map(function(e){return e.tag})}else{return this._tagSet.getAllDeactivated()}};o.prototype.getTagIdsAt=function(n){var i=this;return a.promise(function(t,r){i._container.renderService.renderCamera$.pipe(u.first(),u.map(function(e){var t=i._viewportCoords.canvasToViewport(n[0],n[1],i._container.element);var r=i._tagScene.intersectObjects(t,e.perspective);return r})).subscribe(function(e){t(e)},function(e){r(e)})})};o.prototype.has=function(e){return this._activated?this._tagSet.has(e):this._tagSet.hasDeactivated(e)};o.prototype.remove=function(e){if(this._activated){this._tagSet.remove(e);this._tagScene.remove(e)}else{this._tagSet.removeDeactivated(e)}};o.prototype.removeAll=function(){if(this._activated){this._tagSet.removeAll();this._tagScene.removeAll()}else{this._tagSet.removeAllDeactivated()}};o.prototype._activate=function(){var a=this;this._editVertexHandler.enable();var e=s.from(Object.keys(this._createHandlers)).pipe(u.map(function(e){return a._createHandlers[e]}),u.filter(function(e){return!!e}),u.mergeMap(function(e){return e.geometryCreated$}),u.share());this._fireGeometryCreatedSubscription=e.subscribe(function(e){a.fire(o.geometrycreated,e)});this._fireCreateGeometryEventSubscription=this._tagCreator.tag$.pipe(u.skipWhile(function(e){return e==null}),u.distinctUntilChanged()).subscribe(function(e){var t=e!=null?o.creategeometrystart:o.creategeometryend;a.fire(t,a)});this._handlerStopCreateSubscription=e.subscribe(function(){a.changeMode(c.TagMode.Default)});this._handlerEnablerSubscription=this._creatingConfiguration$.subscribe(function(e){a._disableCreateHandlers();var t=c.TagMode[e.mode];var r=a._createHandlers[t];if(!!r){r.enable()}});this._fireTagsChangedSubscription=this._renderTags$.subscribe(function(){a.fire(o.tagschanged,a)});this._stopCreateSubscription=this._tagCreator.tag$.pipe(u.switchMap(function(e){return e!=null?e.aborted$.pipe(u.map(function(){return null})):s.empty()})).subscribe(function(){a.changeMode(c.TagMode.Default)});this._setGLCreateTagSubscription=this._tagCreator.tag$.subscribe(function(e){if(a._tagScene.hasCreateTag()){a._tagScene.removeCreateTag()}if(e!=null){a._tagScene.addCreateTag(e)}});this._createGLObjectsChangedSubscription=this._createGLObjectsChanged$.subscribe(function(e){a._tagScene.updateCreateTagObjects(e)});this._updateGLObjectsSubscription=this._renderTagGLChanged$.subscribe(function(e){a._tagScene.updateObjects(e)});this._updateTagSceneSubscription=this._tagChanged$.subscribe(function(){a._tagScene.update()});this._domSubscription=s.combineLatest(this._renderTags$.pipe(u.startWith([]),u.tap(function(){a._container.domRenderer.render$.next({name:a._name,vnode:a._tagDomRenderer.clear()})})),this._container.renderService.renderCamera$,this._container.spriteService.spriteAtlas$,this._container.renderService.size$,this._tagChanged$.pipe(u.startWith(null)),s.merge(this._tagCreator.tag$,this._createGeometryChanged$).pipe(u.startWith(null))).pipe(u.map(function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[5];return{name:a._name,vnode:a._tagDomRenderer.render(t,o,n,r.perspective,i)}})).subscribe(this._container.domRenderer.render$);this._glSubscription=this._navigator.stateService.currentState$.pipe(u.map(function(e){var t=a._tagScene;return{name:a._name,render:{frameId:e.id,needsRender:t.needsRender,render:t.render.bind(t),stage:l.GLRenderStage.Foreground}}})).subscribe(this._container.glRenderer.render$);this._navigator.stateService.currentTransform$.pipe(u.first()).subscribe(function(e){a._tagSet.activate(e);a._tagScene.add(a._tagSet.getAll())})};o.prototype._deactivate=function(){this._editVertexHandler.disable();this._disableCreateHandlers();this._tagScene.clear();this._tagSet.deactivate();this._tagCreator.delete$.next(null);this._updateGLObjectsSubscription.unsubscribe();this._updateTagSceneSubscription.unsubscribe();this._stopCreateSubscription.unsubscribe();this._setGLCreateTagSubscription.unsubscribe();this._createGLObjectsChangedSubscription.unsubscribe();this._domSubscription.unsubscribe();this._glSubscription.unsubscribe();this._fireCreateGeometryEventSubscription.unsubscribe();this._fireGeometryCreatedSubscription.unsubscribe();this._fireTagsChangedSubscription.unsubscribe();this._handlerStopCreateSubscription.unsubscribe();this._handlerEnablerSubscription.unsubscribe();this._container.element.classList.remove("component-tag-create")};o.prototype._getDefaultConfiguration=function(){return{createColor:16777215,indicatePointsCompleter:true,mode:c.TagMode.Default}};o.prototype._disableCreateHandlers=function(){var e=this._createHandlers;for(var t in e){if(!e.hasOwnProperty(t)){continue}var r=e[t];if(!!r){r.disable()}}};o.componentName="tag";o.creategeometryend="creategeometryend";o.creategeometrystart="creategeometrystart";o.modechanged="modechanged";o.geometrycreated="geometrycreated";o.tagschanged="tagschanged";return o}(c.Component);r.TagComponent=i;c.ComponentService.register(i);r.default=i},{"../../Component":291,"../../Geo":294,"../../Render":297,rxjs:43,"rxjs/operators":241,when:288}],363:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rxjs/operators");var i=e("rxjs");var o=e("../../Component");var a=function(){function e(e,t){this._component=e;this._navigator=t;this._tagOperation$=new i.Subject;this._createPoints$=new i.Subject;this._createPolygon$=new i.Subject;this._createRect$=new i.Subject;this._delete$=new i.Subject;this._tag$=this._tagOperation$.pipe(n.scan(function(e,t){return t(e)},null),n.share());this._replayedTag$=this._tag$.pipe(n.publishReplay(1),n.refCount());this._replayedTag$.subscribe();this._createPoints$.pipe(n.withLatestFrom(this._component.configuration$,this._navigator.stateService.currentTransform$),n.map(function(e){var t=e[0],r=e[1],n=e[2];return function(){var e=new o.PointsGeometry([[t[0],t[1]],[t[0],t[1]]]);return new o.ExtremePointCreateTag(e,{color:r.createColor,indicateCompleter:r.indicatePointsCompleter},n)}})).subscribe(this._tagOperation$);this._createRect$.pipe(n.withLatestFrom(this._component.configuration$,this._navigator.stateService.currentTransform$),n.map(function(e){var t=e[0],r=e[1],n=e[2];return function(){var e=new o.RectGeometry([t[0],t[1],t[0],t[1]]);return new o.OutlineCreateTag(e,{color:r.createColor},n)}})).subscribe(this._tagOperation$);this._createPolygon$.pipe(n.withLatestFrom(this._component.configuration$,this._navigator.stateService.currentTransform$),n.map(function(e){var t=e[0],r=e[1],n=e[2];return function(){var e=new o.PolygonGeometry([[t[0],t[1]],[t[0],t[1]],[t[0],t[1]]]);return new o.OutlineCreateTag(e,{color:r.createColor},n)}})).subscribe(this._tagOperation$);this._delete$.pipe(n.map(function(){return function(){return null}})).subscribe(this._tagOperation$)}Object.defineProperty(e.prototype,"createRect$",{get:function(){return this._createRect$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"createPolygon$",{get:function(){return this._createPolygon$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"createPoints$",{get:function(){return this._createPoints$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"delete$",{get:function(){return this._delete$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"tag$",{get:function(){return this._tag$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"replayedTag$",{get:function(){return this._replayedTag$},enumerable:true,configurable:true});return e}();r.TagCreator=a;r.default=a},{"../../Component":291,rxjs:43,"rxjs/operators":241}],364:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var c=e("virtual-dom");var n=function(){function e(){}e.prototype.render=function(e,t,r,n,i){var o=[];for(var a=0,s=e;a<s.length;a++){var u=s[a];o=o.concat(u.getDOMObjects(r,n,i))}if(t!=null){o=o.concat(t.getDOMObjects(n,i))}return c.h("div.TagContainer",{},o)};e.prototype.clear=function(){return c.h("div",{},[])};return e}();r.TagDOMRenderer=n},{"virtual-dom":247}],365:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["Default"]=0]="Default";e[e["CreatePoint"]=1]="CreatePoint";e[e["CreatePoints"]=2]="CreatePoints";e[e["CreatePolygon"]=3]="CreatePolygon";e[e["CreateRect"]=4]="CreateRect";e[e["CreateRectDrag"]=5]="CreateRectDrag"})(n=r.TagMode||(r.TagMode={}));r.default=n},{}],366:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["None"]=0]="None";e[e["Centroid"]=1]="Centroid";e[e["Vertex"]=2]="Vertex"})(n=r.TagOperation||(r.TagOperation={}));r.default=n},{}],367:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var c=e("three");var n=function(){function e(e,t){this._createTag=null;this._needsRender=false;this._raycaster=!!t?t:new c.Raycaster;this._scene=!!e?e:new c.Scene;this._objectTags={};this._retrievableObjects=[];this._tags={}}Object.defineProperty(e.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:true,configurable:true});e.prototype.add=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];if(n.tag.id in this._tags){this._remove(n.tag.id)}this._add(n)}this._needsRender=true};e.prototype.addCreateTag=function(e){for(var t=0,r=e.glObjects;t<r.length;t++){var n=r[t];this._scene.add(n)}this._createTag={tag:e,objects:e.glObjects};this._needsRender=true};e.prototype.clear=function(){for(var e=0,t=Object.keys(this._tags);e<t.length;e++){var r=t[e];this._remove(r)}this._needsRender=false};e.prototype.get=function(e){return this.has(e)?this._tags[e].tag:undefined};e.prototype.has=function(e){return e in this._tags};e.prototype.hasCreateTag=function(){return this._createTag!=null};e.prototype.intersectObjects=function(e,t){var r=e[0],n=e[1];this._raycaster.setFromCamera(new c.Vector2(r,n),t);var i=this._raycaster.intersectObjects(this._retrievableObjects);var o=[];for(var a=0,s=i;a<s.length;a++){var u=s[a];if(u.object.uuid in this._objectTags){o.push(this._objectTags[u.object.uuid])}}return o};e.prototype.remove=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];this._remove(n)}this._needsRender=true};e.prototype.removeAll=function(){for(var e=0,t=Object.keys(this._tags);e<t.length;e++){var r=t[e];this._remove(r)}this._needsRender=true};e.prototype.removeCreateTag=function(){if(this._createTag==null){return}for(var e=0,t=this._createTag.objects;e<t.length;e++){var r=t[e];this._scene.remove(r)}this._createTag.tag.dispose();this._createTag=null;this._needsRender=true};e.prototype.render=function(e,t){t.render(this._scene,e);this._needsRender=false};e.prototype.update=function(){this._needsRender=true};e.prototype.updateCreateTagObjects=function(e){if(this._createTag.tag!==e){throw new Error("Create tags do not have the same reference.")}for(var t=0,r=this._createTag.objects;t<r.length;t++){var n=r[t];this._scene.remove(n)}for(var i=0,o=e.glObjects;i<o.length;i++){var n=o[i];this._scene.add(n)}this._createTag.objects=e.glObjects;this._needsRender=true};e.prototype.updateObjects=function(e){var t=e.tag.id;if(this._tags[t].tag!==e){throw new Error("Tags do not have the same reference.")}var r=this._tags[t];this._removeObjects(r);delete this._tags[t];this._add(e);this._needsRender=true};e.prototype._add=function(e){var t=e.tag.id;var r={tag:e,objects:[],retrievableObjects:[]};this._tags[t]=r;for(var n=0,i=e.getGLObjects();n<i.length;n++){var o=i[n];r.objects.push(o);this._scene.add(o)}for(var a=0,s=e.getRetrievableObjects();a<s.length;a++){var u=s[a];r.retrievableObjects.push(u);this._retrievableObjects.push(u);this._objectTags[u.uuid]=e.tag.id}};e.prototype._remove=function(e){var t=this._tags[e];this._removeObjects(t);t.tag.dispose();delete this._tags[e]};e.prototype._removeObjects=function(e){for(var t=0,r=e.objects;t<r.length;t++){var n=r[t];this._scene.remove(n)}for(var i=0,o=e.retrievableObjects;i<o.length;i++){var a=o[i];var s=this._retrievableObjects.indexOf(a);if(s!==-1){this._retrievableObjects.splice(s,1)}}};return e}();r.TagScene=n;r.default=n},{three:242}],368:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rxjs");var i=e("../../Component");var o=e("./tag/ExtremePointTag");var a=e("./tag/ExtremePointRenderTag");var s=function(){function e(){this._active=false;this._hash={};this._hashDeactivated={};this._notifyChanged$=new n.Subject}Object.defineProperty(e.prototype,"active",{get:function(){return this._active},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"changed$",{get:function(){return this._notifyChanged$},enumerable:true,configurable:true});e.prototype.activate=function(e){if(this._active){return}for(var t in this._hashDeactivated){if(!this._hashDeactivated.hasOwnProperty(t)){continue}var r=this._hashDeactivated[t];this._add(r,e)}this._hashDeactivated={};this._active=true;this._notifyChanged$.next(this)};e.prototype.deactivate=function(){if(!this._active){return}for(var e in this._hash){if(!this._hash.hasOwnProperty(e)){continue}this._hashDeactivated[e]=this._hash[e].tag}this._hash={};this._active=false};e.prototype.add=function(e,t){this._assertActivationState(true);for(var r=0,n=e;r<n.length;r++){var i=n[r];this._add(i,t)}this._notifyChanged$.next(this)};e.prototype.addDeactivated=function(e){this._assertActivationState(false);for(var t=0,r=e;t<r.length;t++){var n=r[t];if(!(n instanceof i.OutlineTag||n instanceof i.SpotTag||n instanceof o.default)){throw new Error("Tag type not supported")}this._hashDeactivated[n.id]=n}};e.prototype.get=function(e){return this.has(e)?this._hash[e]:undefined};e.prototype.getAll=function(){var t=this._hash;return Object.keys(t).map(function(e){return t[e]})};e.prototype.getAllDeactivated=function(){var t=this._hashDeactivated;return Object.keys(t).map(function(e){return t[e]})};e.prototype.getDeactivated=function(e){return this.hasDeactivated(e)?this._hashDeactivated[e]:undefined};e.prototype.has=function(e){return e in this._hash};e.prototype.hasDeactivated=function(e){return e in this._hashDeactivated};e.prototype.remove=function(e){this._assertActivationState(true);var t=this._hash;for(var r=0,n=e;r<n.length;r++){var i=n[r];if(!(i in t)){continue}delete t[i]}this._notifyChanged$.next(this)};e.prototype.removeAll=function(){this._assertActivationState(true);this._hash={};this._notifyChanged$.next(this)};e.prototype.removeAllDeactivated=function(){this._assertActivationState(false);this._hashDeactivated={}};e.prototype.removeDeactivated=function(e){this._assertActivationState(false);var t=this._hashDeactivated;for(var r=0,n=e;r<n.length;r++){var i=n[r];if(!(i in t)){continue}delete t[i]}};e.prototype._add=function(e,t){if(e instanceof i.OutlineTag){this._hash[e.id]=new i.OutlineRenderTag(e,t)}else if(e instanceof i.SpotTag){this._hash[e.id]=new i.SpotRenderTag(e,t)}else if(e instanceof o.default){this._hash[e.id]=new a.default(e,t)}else{throw new Error("Tag type not supported")}};e.prototype._assertActivationState=function(e){if(e!==this._active){throw new Error("Tag set not in correct state for operation.")}};return e}();r.TagSet=s;r.default=s},{"../../Component":291,"./tag/ExtremePointRenderTag":387,"./tag/ExtremePointTag":388,rxjs:43}],369:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("../../../Error");var o=function(r){i(n,r);function n(e){var t=r.call(this,e!=null?e:"The provided geometry value is incorrect")||this;Object.setPrototypeOf(t,n.prototype);t.name="GeometryTagError";return t}return n}(n.MapillaryError);r.GeometryTagError=o;r.default=n.MapillaryError},{"../../../Error":293}],370:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rxjs");var i=function(){function e(){this._notifyChanged$=new n.Subject}Object.defineProperty(e.prototype,"changed$",{get:function(){return this._notifyChanged$},enumerable:true,configurable:true});return e}();r.Geometry=i;r.default=i},{rxjs:43}],371:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("../../../Component");var i=function(i){n(e,i);function e(e){var t=i.call(this)||this;var r=e[0];var n=e[1];if(r<0||r>1||n<0||n>1){throw new o.GeometryTagError("Basic coordinates must be on the interval [0, 1].")}t._point=e.slice();return t}Object.defineProperty(e.prototype,"point",{get:function(){return this._point},enumerable:true,configurable:true});e.prototype.getCentroid2d=function(){return this._point.slice()};e.prototype.getCentroid3d=function(e){return e.unprojectBasic(this._point,200)};e.prototype.setCentroid2d=function(e,t){var r=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._point[0]=r[0];this._point[1]=r[1];this._notifyChanged$.next(this)};return e}(o.Geometry);r.PointGeometry=i;r.default=i},{"../../../Component":291}],372:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var u=e("../../../Component");var i=function(a){n(e,a);function e(e){var t=a.call(this)||this;var r=e.length;if(r<2){throw new u.GeometryTagError("A points geometry must have two or more positions.")}t._points=[];for(var n=0,i=e;n<i.length;n++){var o=i[n];if(o[0]<0||o[0]>1||o[1]<0||o[1]>1){throw new u.GeometryTagError("Basic coordinates of points must be on the interval [0, 1].")}t._points.push(o.slice())}return t}Object.defineProperty(e.prototype,"points",{get:function(){return this._points},enumerable:true,configurable:true});e.prototype.addPoint2d=function(e){var t=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._points.push(t);this._notifyChanged$.next(this)};e.prototype.getPoint2d=function(e){return this._points[e].slice()};e.prototype.removePoint2d=function(e){if(e<0||e>=this._points.length||this._points.length<3){throw new u.GeometryTagError("Index for removed point must be valid.")}this._points.splice(e,1);this._notifyChanged$.next(this)};e.prototype.setVertex2d=function(e,t,r){this.setPoint2d(e,t,r)};e.prototype.setPoint2d=function(e,t,r){var n=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._points[e]=n;this._notifyChanged$.next(this)};e.prototype.getPoints3d=function(e){return this._getPoints3d(this._points,e)};e.prototype.getPoint3d=function(e,t){return t.unprojectBasic(this._points[e],200)};e.prototype.getPoints2d=function(){return this._points.slice()};e.prototype.getCentroid2d=function(e){if(!e){throw new u.GeometryTagError("Get centroid must be called with a transform for points geometries.")}var t=this.getRect2d(e),r=t[0],n=t[1],i=t[2],o=t[3];var a=r<i?(r+i)/2:(r+i+1)/2%1;var s=(n+o)/2;return[a,s]};e.prototype.getCentroid3d=function(e){var t=this.getCentroid2d();return e.unprojectBasic(t,200)};e.prototype.getRect2d=function(e){var t=1;var r=0;var n=1;var i=0;var o=this._points;for(var a=0,s=o;a<s.length;a++){var u=s[a];if(u[0]<t){t=u[0]}if(u[0]>r){r=u[0]}if(u[1]<n){n=u[1]}if(u[1]>i){i=u[1]}}if(e.fullPano){var c=[];for(var h=0;h<o.length;h++){c[h]=h}c.sort(function(e,t){return o[e][0]<o[t][0]?-1:o[e][0]>o[t][0]?1:e<t?-1:1});var l=o[c[0]][0]+1-o[c[c.length-1]][0];var p=0;for(var h=0;h<c.length-1;h++){var f=c[h];var d=c[h+1];var v=o[d][0]-o[f][0];if(v>l){l=v;p=h+1}}if(p>0){t=o[c[p]][0];r=o[c[p-1]][0]}}return[t,n,r,i]};e.prototype.setCentroid2d=function(e,t){throw new Error("Not implemented")};e.prototype._getPoints3d=function(e,t){return e.map(function(e){return t.unprojectBasic(e,200)})};return e}(u.Geometry);r.PointsGeometry=i;r.default=i},{"../../../Component":291}],373:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var f=e("../../../Component");var i=function(p){n(e,p);function e(e,t){var r=p.call(this)||this;var n=e.length;if(n<3){throw new f.GeometryTagError("A polygon must have three or more positions.")}if(e[0][0]!==e[n-1][0]||e[0][1]!==e[n-1][1]){throw new f.GeometryTagError("First and last positions must be equivalent.")}r._polygon=[];for(var i=0,o=e;i<o.length;i++){var a=o[i];if(a[0]<0||a[0]>1||a[1]<0||a[1]>1){throw new f.GeometryTagError("Basic coordinates of polygon must be on the interval [0, 1].")}r._polygon.push(a.slice())}r._holes=[];if(t==null){return r}for(var s=0;s<t.length;s++){var u=t[s];var c=u.length;if(c<3){throw new f.GeometryTagError("A polygon hole must have three or more positions.")}if(u[0][0]!==u[c-1][0]||u[0][1]!==u[c-1][1]){throw new f.GeometryTagError("First and last positions of hole must be equivalent.")}r._holes.push([]);for(var h=0,l=u;h<l.length;h++){var a=l[h];if(a[0]<0||a[0]>1||a[1]<0||a[1]>1){throw new f.GeometryTagError("Basic coordinates of hole must be on the interval [0, 1].")}r._holes[s].push(a.slice())}}return r}Object.defineProperty(e.prototype,"polygon",{get:function(){return this._polygon},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"holes",{get:function(){return this._holes},enumerable:true,configurable:true});e.prototype.addVertex2d=function(e){var t=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._polygon.splice(this._polygon.length-1,0,t);this._notifyChanged$.next(this)};e.prototype.getVertex2d=function(e){return this._polygon[e].slice()};e.prototype.removeVertex2d=function(e){if(e<0||e>=this._polygon.length||this._polygon.length<4){throw new f.GeometryTagError("Index for removed vertex must be valid.")}if(e>0&&e<this._polygon.length-1){this._polygon.splice(e,1)}else{this._polygon.splice(0,1);this._polygon.pop();var t=this._polygon[0].slice();this._polygon.push(t)}this._notifyChanged$.next(this)};e.prototype.setVertex2d=function(e,t,r){var n=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];if(e===0||e===this._polygon.length-1){this._polygon[0]=n.slice();this._polygon[this._polygon.length-1]=n.slice()}else{this._polygon[e]=n.slice()}this._notifyChanged$.next(this)};e.prototype.setCentroid2d=function(e,t){var r=this._polygon.map(function(e){return e[0]});var n=this._polygon.map(function(e){return e[1]});var i=Math.min.apply(Math,r);var o=Math.max.apply(Math,r);var a=Math.min.apply(Math,n);var s=Math.max.apply(Math,n);var u=this.getCentroid2d();var c=-i;var h=1-o;var l=-a;var p=1-s;var f=Math.max(c,Math.min(h,e[0]-u[0]));var d=Math.max(l,Math.min(p,e[1]-u[1]));for(var v=0,m=this._polygon;v<m.length;v++){var g=m[v];g[0]+=f;g[1]+=d}this._notifyChanged$.next(this)};e.prototype.getPoints3d=function(e){return this._getPoints3d(this._subsample(this._polygon),e)};e.prototype.getVertex3d=function(e,t){return t.unprojectBasic(this._polygon[e],200)};e.prototype.getVertices2d=function(){return this._polygon.slice()};e.prototype.getVertices3d=function(e){return this._getPoints3d(this._polygon,e)};e.prototype.getHolePoints3d=function(t){var r=this;return this._holes.map(function(e){return r._getPoints3d(r._subsample(e),t)})};e.prototype.getHoleVertices3d=function(t){var r=this;return this._holes.map(function(e){return r._getPoints3d(e,t)})};e.prototype.getCentroid2d=function(){var e=this._polygon;var t=0;var r=0;var n=0;for(var i=0;i<e.length-1;i++){var o=e[i][0];var a=e[i][1];var s=e[i+1][0];var u=e[i+1][1];var c=o*u-s*a;t+=c;r+=(o+s)*c;n+=(a+u)*c}t/=2;r/=6*t;n/=6*t;return[r,n]};e.prototype.getCentroid3d=function(e){var t=this.getCentroid2d();return e.unprojectBasic(t,200)};e.prototype.get3dDomainTriangles3d=function(t){var r=this;return this._triangulate(this._project(this._polygon,t),this.getVertices3d(t),this._holes.map(function(e){return r._project(e,t)}),this.getHoleVertices3d(t))};e.prototype.getTriangles3d=function(t){var r=this;if(t.fullPano){return this._triangulatePano(this._polygon.slice(),this.holes.slice(),t)}var e=this._project(this._subsample(this._polygon),t);var n=this.getPoints3d(t);var i=this._holes.map(function(e){return r._project(r._subsample(e),t)});var o=this.getHolePoints3d(t);return this._triangulate(e,n,i,o)};e.prototype.getPoleOfInaccessibility2d=function(){return this._getPoleOfInaccessibility2d(this._polygon.slice())};e.prototype.getPoleOfInaccessibility3d=function(e){var t=this._getPoleOfInaccessibility2d(this._polygon.slice());return e.unprojectBasic(t,200)};e.prototype._getPoints3d=function(e,t){return e.map(function(e){return t.unprojectBasic(e,200)})};return e}(f.VertexGeometry);r.PolygonGeometry=i;r.default=i},{"../../../Component":291}],374:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var a=e("../../../Component");var i=function(o){n(e,o);function e(e){var t=o.call(this)||this;if(e[1]>e[3]){throw new a.GeometryTagError("Basic Y coordinates values can not be inverted.")}for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i<0||i>1){throw new a.GeometryTagError("Basic coordinates must be on the interval [0, 1].")}}t._anchorIndex=undefined;t._rect=e.slice(0,4);t._inverted=t._rect[0]>t._rect[2];return t}Object.defineProperty(e.prototype,"anchorIndex",{get:function(){return this._anchorIndex},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"inverted",{get:function(){return this._inverted},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"rect",{get:function(){return this._rect},enumerable:true,configurable:true});e.prototype.initializeAnchorIndexing=function(e){if(this._anchorIndex!==undefined){throw new Error("Anchor indexing is already initialized.")}if(e<0||e>3){throw new Error("Invalid anchor index: "+e+".")}this._anchorIndex=e===undefined?0:e};e.prototype.terminateAnchorIndexing=function(){this._anchorIndex=undefined};e.prototype.setOppositeVertex2d=function(e,t){if(this._anchorIndex===undefined){throw new Error("Anchor indexing needs to be initialized.")}var r=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];var n=this._rect.slice();var i=this._anchorIndex===0?[n[0],n[3]]:this._anchorIndex===1?[n[0],n[1]]:this._anchorIndex===2?[n[2],n[1]]:[n[2],n[3]];if(t.fullPano){var o=this._anchorIndex<2?r[0]-n[2]:r[0]-n[0];if(!this._inverted&&this._anchorIndex<2&&r[0]<.25&&n[2]>.75&&o<-.5){this._inverted=true;this._anchorIndex=i[1]>r[1]?0:1}else if(!this._inverted&&this._anchorIndex>=2&&r[0]<.25&&n[2]>.75&&o<-.5){this._inverted=true;this._anchorIndex=i[1]>r[1]?0:1}else if(this._inverted&&this._anchorIndex>=2&&r[0]<.25&&n[0]>.75&&o<-.5){this._inverted=false;if(i[0]>r[0]){this._anchorIndex=i[1]>r[1]?3:2}else{this._anchorIndex=i[1]>r[1]?0:1}}else if(!this._inverted&&this._anchorIndex>=2&&r[0]>.75&&n[0]<.25&&o>.5){this._inverted=true;this._anchorIndex=i[1]>r[1]?3:2}else if(!this._inverted&&this._anchorIndex<2&&r[0]>.75&&n[0]<.25&&o>.5){this._inverted=true;this._anchorIndex=i[1]>r[1]?3:2}else if(this._inverted&&this._anchorIndex<2&&r[0]>.75&&n[2]<.25&&o>.5){this._inverted=false;if(i[0]>r[0]){this._anchorIndex=i[1]>r[1]?3:2}else{this._anchorIndex=i[1]>r[1]?0:1}}else if(this._inverted&&this._anchorIndex<2&&r[0]>n[0]){this._inverted=false;this._anchorIndex=i[1]>r[1]?0:1}else if(this._inverted&&this._anchorIndex>=2&&r[0]<n[2]){this._inverted=false;this._anchorIndex=i[1]>r[1]?3:2}else if(this._inverted){if(this._anchorIndex<2){this._anchorIndex=i[1]>r[1]?0:1}else{this._anchorIndex=i[1]>r[1]?3:2}}else{if(i[0]<=r[0]&&i[1]>r[1]){this._anchorIndex=0}else if(i[0]<=r[0]&&i[1]<=r[1]){this._anchorIndex=1}else if(i[0]>r[0]&&i[1]<=r[1]){this._anchorIndex=2}else{this._anchorIndex=3}}var a=[];if(this._anchorIndex===0){a[0]=i[0];a[1]=r[1];a[2]=r[0];a[3]=i[1]}else if(this._anchorIndex===1){a[0]=i[0];a[1]=i[1];a[2]=r[0];a[3]=r[1]}else if(this._anchorIndex===2){a[0]=r[0];a[1]=i[1];a[2]=i[0];a[3]=r[1]}else{a[0]=r[0];a[1]=r[1];a[2]=i[0];a[3]=i[1]}if(!this._inverted&&a[0]>a[2]||this._inverted&&a[0]<a[2]){a[0]=n[0];a[2]=n[2]}if(a[1]>a[3]){a[1]=n[1];a[3]=n[3]}this._rect[0]=a[0];this._rect[1]=a[1];this._rect[2]=a[2];this._rect[3]=a[3]}else{if(i[0]<=r[0]&&i[1]>r[1]){this._anchorIndex=0}else if(i[0]<=r[0]&&i[1]<=r[1]){this._anchorIndex=1}else if(i[0]>r[0]&&i[1]<=r[1]){this._anchorIndex=2}else{this._anchorIndex=3}var a=[];if(this._anchorIndex===0){a[0]=i[0];a[1]=r[1];a[2]=r[0];a[3]=i[1]}else if(this._anchorIndex===1){a[0]=i[0];a[1]=i[1];a[2]=r[0];a[3]=r[1]}else if(this._anchorIndex===2){a[0]=r[0];a[1]=i[1];a[2]=i[0];a[3]=r[1]}else{a[0]=r[0];a[1]=r[1];a[2]=i[0];a[3]=i[1]}if(a[0]>a[2]){a[0]=n[0];a[2]=n[2]}if(a[1]>a[3]){a[1]=n[1];a[3]=n[3]}this._rect[0]=a[0];this._rect[1]=a[1];this._rect[2]=a[2];this._rect[3]=a[3]}this._notifyChanged$.next(this)};e.prototype.setVertex2d=function(e,t,r){var n=this._rect.slice();var i=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];var o=[];if(e===0){o[0]=i[0];o[1]=n[1];o[2]=n[2];o[3]=i[1]}else if(e===1){o[0]=i[0];o[1]=i[1];o[2]=n[2];o[3]=n[3]}else if(e===2){o[0]=n[0];o[1]=i[1];o[2]=i[0];o[3]=n[3]}else if(e===3){o[0]=n[0];o[1]=n[1];o[2]=i[0];o[3]=i[1]}if(r.fullPano){var a=e<2&&i[0]>.75&&n[0]<.25||e>=2&&this._inverted&&i[0]>.75&&n[2]<.25;var s=e<2&&this._inverted&&i[0]<.25&&n[0]>.75||e>=2&&i[0]<.25&&n[2]>.75;if(a||s){this._inverted=!this._inverted}else{if(o[0]-n[0]<-.25){o[0]=n[0]}if(o[2]-n[2]>.25){o[2]=n[2]}}if(!this._inverted&&o[0]>o[2]||this._inverted&&o[0]<o[2]){o[0]=n[0];o[2]=n[2]}}else{if(o[0]>o[2]){o[0]=n[0];o[2]=n[2]}}if(o[1]>o[3]){o[1]=n[1];o[3]=n[3]}this._rect[0]=o[0];this._rect[1]=o[1];this._rect[2]=o[2];this._rect[3]=o[3];this._notifyChanged$.next(this)};e.prototype.setCentroid2d=function(e,t){var r=this._rect.slice();var n=r[0];var i=this._inverted?r[2]+1:r[2];var o=r[1];var a=r[3];var s=n+(i-n)/2;var u=o+(a-o)/2;var c=0;if(t.gpano!=null&&t.gpano.CroppedAreaImageWidthPixels===t.gpano.FullPanoWidthPixels){c=this._inverted?e[0]+1-s:e[0]-s}else{var h=-n;var l=1-i;c=Math.max(h,Math.min(l,e[0]-s))}var p=-o;var f=1-a;var d=Math.max(p,Math.min(f,e[1]-u));this._rect[0]=r[0]+c;this._rect[1]=r[1]+d;this._rect[2]=r[2]+c;this._rect[3]=r[3]+d;if(this._rect[0]<0){this._rect[0]+=1;this._inverted=!this._inverted}else if(this._rect[0]>1){this._rect[0]-=1;this._inverted=!this._inverted}if(this._rect[2]<0){this._rect[2]+=1;this._inverted=!this._inverted}else if(this._rect[2]>1){this._rect[2]-=1;this._inverted=!this._inverted}this._notifyChanged$.next(this)};e.prototype.getPoints3d=function(t){return this._getPoints2d().map(function(e){return t.unprojectBasic(e,200)})};e.prototype.getVertex2d=function(e){return this._rectToVertices2d(this._rect)[e]};e.prototype.getNonAdjustedVertex2d=function(e){return this._rectToNonAdjustedVertices2d(this._rect)[e]};e.prototype.getVertex3d=function(e,t){return t.unprojectBasic(this._rectToVertices2d(this._rect)[e],200)};e.prototype.getVertices2d=function(){return this._rectToVertices2d(this._rect)};e.prototype.getVertices3d=function(t){return this._rectToVertices2d(this._rect).map(function(e){return t.unprojectBasic(e,200)})};e.prototype.getCentroid2d=function(){var e=this._rect;var t=e[0];var r=this._inverted?e[2]+1:e[2];var n=e[1];var i=e[3];var o=(t+r)/2;var a=(n+i)/2;return[o,a]};e.prototype.getCentroid3d=function(e){var t=this.getCentroid2d();return e.unprojectBasic(t,200)};e.prototype.getPoleOfInaccessibility2d=function(){return this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect))};e.prototype.getPoleOfInaccessibility3d=function(e){var t=this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect));return e.unprojectBasic(t,200)};e.prototype.getTriangles3d=function(e){return e.fullPano?[]:this._triangulate(this._project(this._getPoints2d(),e),this.getPoints3d(e))};e.prototype.validate=function(e){var t=this._rect;if(!this._inverted&&e[0]<t[0]||e[0]-t[2]>.25||e[1]<t[1]){return false}return true};e.prototype._getPoints2d=function(){var e=this._rectToVertices2d(this._rect);var t=e.length-1;var r=10;var n=[];for(var i=0;i<t;++i){var o=e[i][0];var a=e[i][1];var s=e[i+1][0];var u=e[i+1][1];var c=(s-o)/(r-1);var h=(u-a)/(r-1);for(var l=0;l<r;++l){var p=[o+l*c,a+l*h];n.push(p)}}return n};e.prototype._rectToVertices2d=function(e){return[[e[0],e[3]],[e[0],e[1]],[this._inverted?e[2]+1:e[2],e[1]],[this._inverted?e[2]+1:e[2],e[3]],[e[0],e[3]]]};e.prototype._rectToNonAdjustedVertices2d=function(e){return[[e[0],e[3]],[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]]]};return e}(a.VertexGeometry);r.RectGeometry=i;r.default=i},{"../../../Component":291}],375:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var g=e("earcut");var w=e("martinez-polygon-clipping");var i=e("@mapbox/polylabel");var o=e("three");var a=e("../../../Component");var s=function(t){n(e,t);function e(){var e=t.call(this)||this;e._subsampleThreshold=.005;return e}e.prototype._getPoleOfInaccessibility2d=function(e){var t=i([e],.03);return t};e.prototype._project=function(e,t){var r=this._createCamera(t.upVector().toArray(),t.unprojectSfM([0,0],0),t.unprojectSfM([0,0],10));return this._deunproject(e,t,r)};e.prototype._subsample=function(e,t){if(t===void 0){t=this._subsampleThreshold}var r=[];var n=e.length;for(var i=0;i<n;i++){var o=e[i];var a=e[(i+1)%n];r.push(o);var s=Math.sqrt(Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2));var u=Math.floor(s/t);var c=1/(u+1);for(var h=1;h<=u;h++){var l=h*c;var p=[(1-l)*o[0]+l*a[0],(1-l)*o[1]+l*a[1]];r.push(p)}}return r};e.prototype._triangulate=function(e,t,r,n){var i=[e.slice(0,-1)];for(var o=0,a=r!=null?r:[];o<a.length;o++){var s=a[o];i.push(s.slice(0,-1))}var u=t.slice(0,-1);for(var c=0,h=n!=null?n:[];c<h.length;c++){var l=h[c];u=u.concat(l.slice(0,-1))}var p=g.default.flatten(i);var f=g.default(p.vertices,p.holes,p.dimensions);var d=[];for(var v=0;v<f.length;++v){var m=u[f[v]];d.push(m[0]);d.push(m[1]);d.push(m[2])}return d};e.prototype._triangulatePano=function(e,t,r){var n=[];var i=1e-9;var o=3;var a=3;for(var s=0;s<o;s++){for(var u=0;u<a;u++){var c=s===0?-i:i;var h=u===0?-i:i;var l=s/o+c;var p=u/a+h;var f=(s+1)/o+i;var d=(u+1)/a+i;var v=[[l,p],[l,d],[f,d],[f,p],[l,p]];var m=[(2*s+1)/(2*o),(2*u+1)/(2*a)];n.push.apply(n,this._triangulateSubarea(e,t,v,m,r))}}return n};e.prototype._unproject=function(e,t,r){if(r===void 0){r=200}return e.map(function(e){return t.unprojectBasic(e,r)})};e.prototype._createCamera=function(e,t,r){var n=new o.Camera;n.up.copy((new o.Vector3).fromArray(e));n.position.copy((new o.Vector3).fromArray(t));n.lookAt((new o.Vector3).fromArray(r));n.updateMatrix();n.updateMatrixWorld(true);return n};e.prototype._deunproject=function(e,n,i){return e.map(function(e){var t=n.unprojectBasic(e,1e4);var r=new o.Vector3(t[0],t[1],t[2]).applyMatrix4(i.matrixWorldInverse);return[r.x/r.z,r.y/r.z]})};e.prototype._triangulateSubarea=function(e,t,r,n,i){var o=w.intersection([e].concat(t),[r]);if(!o){return[]}var a=[];var s=this._subsampleThreshold;var u=this._createCamera(i.upVector().toArray(),i.unprojectSfM([0,0],0),i.unprojectBasic(n,10));for(var c=0,h=o;c<h.length;c++){var l=h[c];var p=this._subsample(l[0],s);var f=this._deunproject(p,i,u);var d=this._unproject(p,i);var v=[];var m=[];for(var g=1;g<l.length;g++){var _=this._subsample(l[g],s);var y=this._deunproject(_,i,u);var b=this._unproject(_,i);v.push(y);m.push(b)}a.push.apply(a,this._triangulate(f,d,v,m))}return a};return e}(a.Geometry);r.VertexGeometry=s;r.default=s},{"../../../Component":291,"@mapbox/polylabel":1,earcut:8,"martinez-polygon-clipping":22,three:242}],376:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("rxjs/operators");var s=e("rxjs");var i=e("../../../Component");var a=function(a){n(e,a);function e(e,t,r,n,i){var o=a.call(this,e,t,r,n)||this;o._tagCreator=i;o._geometryCreated$=new s.Subject;return o}Object.defineProperty(e.prototype,"geometryCreated$",{get:function(){return this._geometryCreated$},enumerable:true,configurable:true});e.prototype._enable=function(){this._enableCreate();this._container.element.classList.add("component-tag-create")};e.prototype._disable=function(){this._container.element.classList.remove("component-tag-create");this._disableCreate()};e.prototype._validateBasic=function(e){var t=e[0];var r=e[1];return 0<=t&&t<=1&&0<=r&&r<=1};e.prototype._mouseEventToBasic$=function(e){var i=this;return e.pipe(o.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),o.map(function(e){var t=e[0],r=e[1],n=e[2];return i._mouseEventToBasic(t,i._container.element,r,n)}))};return e}(i.TagHandlerBase);r.CreateHandlerBase=a;r.default=a},{"../../../Component":291,rxjs:43,"rxjs/operators":241}],377:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs/operators");var o=e("../../../Component");var a=function(e){n(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype._enableCreate=function(){this._container.mouseService.deferPixels(this._name,4);this._geometryCreatedSubscription=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(i.filter(this._validateBasic),i.map(function(e){return new o.PointGeometry(e)})).subscribe(this._geometryCreated$)};t.prototype._disableCreate=function(){this._container.mouseService.undeferPixels(this._name);this._geometryCreatedSubscription.unsubscribe()};t.prototype._getNameExtension=function(){return"create-point"};return t}(o.CreateHandlerBase);r.CreatePointHandler=a;r.default=a},{"../../../Component":291,"rxjs/operators":241}],378:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../../../Component");var o=function(e){n(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype._addPoint=function(e,t){e.geometry.addPoint2d(t)};Object.defineProperty(t.prototype,"_create$",{get:function(){return this._tagCreator.createPoints$},enumerable:true,configurable:true});t.prototype._getNameExtension=function(){return"create-points"};t.prototype._setVertex2d=function(e,t,r){e.geometry.setPoint2d(e.geometry.points.length-1,t,r)};return t}(i.CreateVertexHandler);r.CreatePointsHandler=o;r.default=o},{"../../../Component":291}],379:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../../../Component");var o=function(e){n(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype._addPoint=function(e,t){e.addPoint(t)};Object.defineProperty(t.prototype,"_create$",{get:function(){return this._tagCreator.createPolygon$},enumerable:true,configurable:true});t.prototype._getNameExtension=function(){return"create-polygon"};t.prototype._setVertex2d=function(e,t,r){e.geometry.setVertex2d(e.geometry.polygon.length-2,t,r)};return t}(i.CreateVertexHandler);r.CreatePolygonHandler=o;r.default=o},{"../../../Component":291}],380:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs");var a=e("rxjs/operators");var o=e("../../../Component");var s=function(e){n(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype._enableCreate=function(){var o=this;this._container.mouseService.claimMouse(this._name,2);this._deleteSubscription=this._navigator.stateService.currentTransform$.pipe(a.map(function(e){return null}),a.skip(1)).subscribe(this._tagCreator.delete$);this._createSubscription=this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$)).pipe(a.filter(this._validateBasic)).subscribe(this._tagCreator.createRect$);this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(a.filter(function(e){return!!e})).subscribe(function(e){e.geometry.initializeAnchorIndexing()});var t=i.combineLatest(i.merge(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseMove$),this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseMove$)),this._container.renderService.renderCamera$).pipe(a.withLatestFrom(this._navigator.stateService.currentTransform$),a.map(function(e){var t=e[0],r=t[0],n=t[1],i=e[1];return o._mouseEventToBasic(r,o._container.element,n,i)}));this._setVertexSubscription=this._tagCreator.tag$.pipe(a.switchMap(function(e){return!!e?i.combineLatest(i.of(e),t,o._navigator.stateService.currentTransform$):i.empty()})).subscribe(function(e){var t=e[0],r=e[1],n=e[2];t.geometry.setOppositeVertex2d(r,n)});var r=this._container.mouseService.mouseDragEnd$.pipe(a.withLatestFrom(this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$)).pipe(a.filter(this._validateBasic)),function(e,t){return t}),a.share());this._addPointSubscription=this._tagCreator.tag$.pipe(a.switchMap(function(e){return!!e?i.combineLatest(i.of(e),r):i.empty()})).subscribe(function(e){var t=e[0],r=e[1];var n=t.geometry;if(!n.validate(r)){r=n.getNonAdjustedVertex2d(3)}t.addPoint(r)});this._geometryCreatedSubscription=this._tagCreator.tag$.pipe(a.switchMap(function(e){return!!e?e.created$.pipe(a.map(function(e){return e.geometry})):i.empty()})).subscribe(this._geometryCreated$)};t.prototype._disableCreate=function(){this._container.mouseService.unclaimMouse(this._name);this._tagCreator.delete$.next(null);this._addPointSubscription.unsubscribe();this._createSubscription.unsubscribe();this._deleteSubscription.unsubscribe();this._geometryCreatedSubscription.unsubscribe();this._initializeAnchorIndexingSubscription.unsubscribe();this._setVertexSubscription.unsubscribe()};t.prototype._getNameExtension=function(){return"create-rect-drag"};return t}(o.CreateHandlerBase);r.CreateRectDragHandler=s;r.default=s},{"../../../Component":291,rxjs:43,"rxjs/operators":241}],381:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs/operators");var o=e("../../../Component");var a=function(e){n(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}Object.defineProperty(t.prototype,"_create$",{get:function(){return this._tagCreator.createRect$},enumerable:true,configurable:true});t.prototype._addPoint=function(e,t){var r=e.geometry;if(!r.validate(t)){t=r.getNonAdjustedVertex2d(3)}e.addPoint(t)};t.prototype._enable=function(){e.prototype._enable.call(this);this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(i.filter(function(e){return!!e})).subscribe(function(e){e.geometry.initializeAnchorIndexing()})};t.prototype._disable=function(){e.prototype._disable.call(this);this._initializeAnchorIndexingSubscription.unsubscribe()};t.prototype._getNameExtension=function(){return"create-rect"};t.prototype._setVertex2d=function(e,t,r){e.geometry.setOppositeVertex2d(t,r)};return t}(o.CreateVertexHandler);r.CreateRectHandler=a;r.default=a},{"../../../Component":291,"rxjs/operators":241}],382:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs");var o=e("rxjs/operators");var a=e("../../../Component");var s=function(e){n(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype._enableCreate=function(){var a=this;this._container.mouseService.deferPixels(this._name,4);var e=this._navigator.stateService.currentTransform$.pipe(o.map(function(){}),o.publishReplay(1),o.refCount());this._deleteSubscription=e.pipe(o.skip(1)).subscribe(this._tagCreator.delete$);var t=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(o.share());this._createSubscription=e.pipe(o.switchMap(function(){return t.pipe(o.filter(a._validateBasic),o.take(1))})).subscribe(this._create$);this._setVertexSubscription=this._tagCreator.tag$.pipe(o.switchMap(function(e){return!!e?i.combineLatest(i.of(e),i.merge(a._container.mouseService.mouseMove$,a._container.mouseService.domMouseMove$),a._container.renderService.renderCamera$,a._navigator.stateService.currentTransform$):i.empty()})).subscribe(function(e){var t=e[0],r=e[1],n=e[2],i=e[3];var o=a._mouseEventToBasic(r,a._container.element,n,i);a._setVertex2d(t,o,i)});this._addPointSubscription=this._tagCreator.tag$.pipe(o.switchMap(function(e){return!!e?i.combineLatest(i.of(e),t):i.empty()})).subscribe(function(e){var t=e[0],r=e[1];a._addPoint(t,r)});this._geometryCreateSubscription=this._tagCreator.tag$.pipe(o.switchMap(function(e){return!!e?e.created$.pipe(o.map(function(e){return e.geometry})):i.empty()})).subscribe(this._geometryCreated$)};t.prototype._disableCreate=function(){this._container.mouseService.undeferPixels(this._name);this._tagCreator.delete$.next(null);this._addPointSubscription.unsubscribe();this._createSubscription.unsubscribe();this._deleteSubscription.unsubscribe();this._geometryCreateSubscription.unsubscribe();this._setVertexSubscription.unsubscribe()};return t}(a.CreateHandlerBase);r.CreateVertexHandler=s;r.default=s},{"../../../Component":291,rxjs:43,"rxjs/operators":241}],383:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs");var o=e("rxjs/operators");var u=e("../../../Component");var a=function(a){n(e,a);function e(e,t,r,n,i){var o=a.call(this,e,t,r,n)||this;o._tagSet=i;return o}e.prototype._enable=function(){var s=this;var e=this._tagSet.changed$.pipe(o.map(function(e){return e.getAll()}),o.switchMap(function(e){return i.from(e).pipe(o.mergeMap(function(e){return e.interact$}))}),o.switchMap(function(e){return i.concat(i.of(e),s._container.mouseService.documentMouseUp$.pipe(o.map(function(){return{offsetX:0,offsetY:0,operation:u.TagOperation.None,tag:null}}),o.first()))}),o.share());var t=i.merge(this._container.mouseService.mouseMove$,this._container.mouseService.domMouseMove$).pipe(o.share());this._claimMouseSubscription=e.pipe(o.switchMap(function(e){return!!e.tag?s._container.mouseService.domMouseDragStart$:i.empty()})).subscribe(function(){s._container.mouseService.claimMouse(s._name,3)});this._cursorSubscription=e.pipe(o.map(function(e){return e.cursor}),o.distinctUntilChanged()).subscribe(function(e){var t=["crosshair","move","nesw-resize","nwse-resize"];for(var r=0,n=t;r<n.length;r++){var i=n[r];s._container.element.classList.remove("component-tag-edit-"+i)}if(!!e){s._container.element.classList.add("component-tag-edit-"+e)}});this._unclaimMouseSubscription=this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseDragEnd$).subscribe(function(e){s._container.mouseService.unclaimMouse(s._name)});this._preventDefaultSubscription=e.pipe(o.switchMap(function(e){return!!e.tag?s._container.mouseService.documentMouseMove$:i.empty()})).subscribe(function(e){e.preventDefault()});this._updateGeometrySubscription=e.pipe(o.switchMap(function(e){if(e.operation===u.TagOperation.None||!e.tag){return i.empty()}var t=s._container.mouseService.filtered$(s._name,s._container.mouseService.domMouseDrag$).pipe(o.filter(function(e){return s._viewportCoords.insideElement(e,s._container.element)}));return i.combineLatest(t,s._container.renderService.renderCamera$).pipe(o.withLatestFrom(i.of(e),s._navigator.stateService.currentTransform$,function(e,t,r){var n=e[0],i=e[1];return[n,i,t,r]}))})).subscribe(function(e){var t=e[0],r=e[1],n=e[2],i=e[3];var o=s._mouseEventToBasic(t,s._container.element,r,i,n.offsetX,n.offsetY);var a=n.tag.geometry;if(n.operation===u.TagOperation.Centroid){a.setCentroid2d(o,i)}else if(n.operation===u.TagOperation.Vertex){a.setVertex2d(n.vertexIndex,o,i)}})};e.prototype._disable=function(){this._claimMouseSubscription.unsubscribe();this._cursorSubscription.unsubscribe();this._preventDefaultSubscription.unsubscribe();this._unclaimMouseSubscription.unsubscribe();this._updateGeometrySubscription.unsubscribe()};e.prototype._getNameExtension=function(){return"edit-vertex"};return e}(u.TagHandlerBase);r.EditVertexHandler=a;r.default=a},{"../../../Component":291,rxjs:43,"rxjs/operators":241}],384:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../../../Component");var o=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e,t,r)||this;i._name=i._component.name+"-"+i._getNameExtension();i._viewportCoords=n;return i}e.prototype._getConfiguration=function(e){return{}};e.prototype._mouseEventToBasic=function(e,t,r,n,i,o){i=i!=null?i:0;o=o!=null?o:0;var a=this._viewportCoords.canvasPosition(e,t),s=a[0],u=a[1];var c=this._viewportCoords.canvasToBasic(s-i,u-o,t,n,r.perspective);return c};return e}(i.HandlerBase);r.TagHandlerBase=o;r.default=o},{"../../../Component":291}],385:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rxjs/operators");var o=e("three");var i=e("rxjs");var a=e("../../../Geo");var s=function(){function e(e,t,r){var n=this;this._geometry=e;this._transform=t;this._viewportCoords=!!r?r:new a.ViewportCoords;this._aborted$=new i.Subject;this._created$=new i.Subject;this._glObjectsChanged$=new i.Subject;this._geometryChangedSubscription=this._geometry.changed$.subscribe(function(){n._onGeometryChanged();n._glObjectsChanged$.next(n)})}Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"glObjects",{get:function(){return this._glObjects},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"aborted$",{get:function(){return this._aborted$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"created$",{get:function(){return this._created$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"glObjectsChanged$",{get:function(){return this._glObjectsChanged$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"geometryChanged$",{get:function(){var e=this;return this._geometry.changed$.pipe(n.map(function(){return e}))},enumerable:true,configurable:true});e.prototype.dispose=function(){this._geometryChangedSubscription.unsubscribe()};e.prototype._canvasToTransform=function(e){var t=Math.round(e[0]);var r=Math.round(e[1]);var n="translate(-50%,-50%) translate("+t+"px,"+r+"px)";return n};e.prototype._colorToBackground=function(e){return"#"+("000000"+e.toString(16)).substr(-6)};e.prototype._createOutine=function(e,t){var r=this._getLinePositions(e);var n=new o.BufferGeometry;n.addAttribute("position",new o.BufferAttribute(r,3));var i=new o.LineBasicMaterial({color:t,linewidth:1});return new o.Line(n,i)};e.prototype._disposeLine=function(e){if(e==null){return}e.geometry.dispose();e.material.dispose()};e.prototype._getLinePositions=function(e){var t=e.length;var r=new Float32Array(t*3);for(var n=0;n<t;++n){var i=3*n;var o=e[n];r[i]=o[0];r[i+1]=o[1];r[i+2]=o[2]}return r};return e}();r.CreateTag=s;r.default=s},{"../../../Geo":294,rxjs:43,"rxjs/operators":241,three:242}],386:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var y=e("virtual-dom");var a=e("../Tag");var i=e("../../../Component");var o=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e,r,n)||this;i._options={color:t.color==null?16777215:t.color,indicateCompleter:t.indicateCompleter==null?true:t.indicateCompleter};i._rectGeometry=new a.RectGeometry(i._geometry.getRect2d(r));i._createGlObjects();return i}e.prototype.create=function(){if(this._geometry.points.length<3){return}this._geometry.removePoint2d(this._geometry.points.length-1);this._created$.next(this)};e.prototype.dispose=function(){o.prototype.dispose.call(this);this._disposeObjects()};e.prototype.getDOMObjects=function(p,e){var f=this;var d={offsetHeight:e.height,offsetWidth:e.width};var v=[];var m=this._geometry.getPoints2d();var g=m.length;var t=function(e){var t=e;var r=m[e],n=r[0],i=r[1];var o=_._viewportCoords.basicToCanvasSafe(n,i,d,_._transform,p);if(!o){return"continue"}var a=function(e){e.stopPropagation();f._aborted$.next(f)};var s=function(e){e.stopPropagation();f._geometry.removePoint2d(t)};var u=_._canvasToTransform(o);var c={onclick:e===0&&g<3?a:s,style:{transform:u}};v.push(y.h("div.TagInteractor",c,[]));var h=_._colorToBackground(_._options.color);var l={style:{background:h,transform:u}};v.push(y.h("div.TagVertex",l,[]))};var _=this;for(var r=0;r<g-1;r++){t(r)}if(g>2&&this._options.indicateCompleter===true){var n=this._geometry.getCentroid2d(this._transform),i=n[0],o=n[1];var a=this._viewportCoords.basicToCanvasSafe(i,o,d,this._transform,p);if(!!a){var s=function(e){e.stopPropagation();f._geometry.removePoint2d(f._geometry.points.length-1);f._created$.next(f)};var u=this._canvasToTransform(a);var c={onclick:s,style:{transform:u}};v.push(y.h("div.TagCompleter.TagLarger",c,[]));var h={style:{background:this._colorToBackground(this._options.color),transform:u}};v.push(y.h("div.TagVertex.TagLarger",h,[]));var l={style:{transform:u}};v.push(y.h("div.TagDot",l,[]))}}return v};e.prototype._onGeometryChanged=function(){this._disposeObjects();this._rectGeometry=new a.RectGeometry(this._geometry.getRect2d(this._transform));this._createGlObjects()};e.prototype._createGlObjects=function(){this._glObjects=[];var e=this._rectGeometry.getPoints3d(this._transform);this._outline=this._createOutine(e,this._options.color);this._glObjects.push(this._outline)};e.prototype._disposeObjects=function(){this._disposeLine(this._outline);this._outline=null;this._glObjects=null};return e}(i.CreateTag);r.ExtremePointCreateTag=o},{"../../../Component":291,"../Tag":361,"virtual-dom":247}],387:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("three");var y=e("virtual-dom");var b=e("../../../Component");var n=function(n){i(e,n);function e(e,t){var r=n.call(this,e,t)||this;r._rectGeometry=new b.RectGeometry(r._tag.geometry.getRect2d(t));r._fill=!t.gpano?r._createFill():null;r._outline=r._tag.lineWidth>=1?r._createOutline():null;return r}e.prototype.dispose=function(){n.prototype.dispose.call(this);this._disposeFill();this._disposeOutline()};e.prototype.getDOMObjects=function(e,t,r){var n=[];var i={offsetHeight:r.height,offsetWidth:r.width};if(!this._tag.editable){return n}var o=this._colorToCss(this._tag.lineColor);var a=this._tag.geometry.getPoints2d();for(var s=0;s<a.length;s++){var u=a[s],c=u[0],h=u[1];var l=this._viewportCoords.basicToCanvasSafe(c,h,i,this._transform,t);if(l==null){continue}var p="crosshair";var f=this._interact(b.TagOperation.Vertex,p,s);var d=Math.round(l[0]);var v=Math.round(l[1]);var m="translate(-50%, -50%) translate("+d+"px,"+v+"px)";var g={onmousedown:f,style:{background:o,transform:m,cursor:p}};n.push(y.h("div.TagResizer",g,[]));if(!this._tag.indicateVertices){continue}var _={style:{background:o,transform:m}};n.push(y.h("div.TagVertex",_,[]))}return n};e.prototype.getGLObjects=function(){var e=[];if(this._fill!=null){e.push(this._fill)}if(this._outline!=null){e.push(this._outline)}return e};e.prototype.getRetrievableObjects=function(){return this._fill!=null?[this._fill]:[]};e.prototype._onGeometryChanged=function(){this._rectGeometry=new b.RectGeometry(this._tag.geometry.getRect2d(this._transform));if(this._fill!=null){this._updateFillGeometry()}if(this._outline!=null){this._updateOulineGeometry()}};e.prototype._onTagChanged=function(){var e=false;if(this._fill!=null){this._updateFillMaterial(this._fill.material)}if(this._outline==null){if(this._tag.lineWidth>=1){this._outline=this._createOutline();e=true}}else{this._updateOutlineMaterial()}return e};e.prototype._getPoints3d=function(){return this._rectGeometry.getPoints3d(this._transform)};e.prototype._getTriangles=function(){return this._rectGeometry.getTriangles3d(this._transform)};e.prototype._updateFillMaterial=function(e){e.color=new o.Color(this._tag.fillColor);e.opacity=this._tag.fillOpacity;e.needsUpdate=true};e.prototype._updateLineBasicMaterial=function(e){e.color=new o.Color(this._tag.lineColor);e.linewidth=Math.max(this._tag.lineWidth,1);e.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0;e.opacity=this._tag.lineOpacity;e.transparent=this._tag.lineOpacity<1;e.needsUpdate=true};e.prototype._updateOutlineMaterial=function(){var e=this._outline.material;this._updateLineBasicMaterial(e)};return e}(b.OutlineRenderTagBase);r.ExtremePointRenderTag=n;r.default=n},{"../../../Component":291,three:242,"virtual-dom":247}],388:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../../../Component");var o=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e,t)||this;r=!!r?r:{};n._editable=r.editable==null?false:r.editable;n._fillColor=r.fillColor==null?16777215:r.fillColor;n._fillOpacity=r.fillOpacity==null?0:r.fillOpacity;n._indicateVertices=r.indicateVertices==null?true:r.indicateVertices;n._lineColor=r.lineColor==null?16777215:r.lineColor;n._lineOpacity=r.lineOpacity==null?1:r.lineOpacity;n._lineWidth=r.lineWidth==null?1:r.lineWidth;return n}Object.defineProperty(e.prototype,"editable",{get:function(){return this._editable},set:function(e){this._editable=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"fillColor",{get:function(){return this._fillColor},set:function(e){this._fillColor=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"fillOpacity",{get:function(){return this._fillOpacity},set:function(e){this._fillOpacity=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"indicateVertices",{get:function(){return this._indicateVertices},set:function(e){this._indicateVertices=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"lineColor",{get:function(){return this._lineColor},set:function(e){this._lineColor=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"lineOpacity",{get:function(){return this._lineOpacity},set:function(e){this._lineOpacity=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(e){this._lineWidth=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});e.prototype.setOptions=function(e){this._editable=e.editable==null?this._editable:e.editable;this._indicateVertices=e.indicateVertices==null?this._indicateVertices:e.indicateVertices;this._lineColor=e.lineColor==null?this._lineColor:e.lineColor;this._lineWidth=e.lineWidth==null?this._lineWidth:e.lineWidth;this._fillColor=e.fillColor==null?this._fillColor:e.fillColor;this._fillOpacity=e.fillOpacity==null?this._fillOpacity:e.fillOpacity;this._notifyChanged$.next(this)};return e}(i.Tag);r.ExtremePointTag=o;r.default=o},{"../../../Component":291}],389:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var k=e("virtual-dom");var L=e("../../../Component");var i=function(o){n(e,o);function e(e,t,r,n){var i=o.call(this,e,r,n)||this;i._options={color:t.color==null?16777215:t.color};i._createGlObjects();return i}e.prototype.create=function(){if(this._geometry instanceof L.RectGeometry){this._created$.next(this)}else if(this._geometry instanceof L.PolygonGeometry){var e=this._geometry;e.removeVertex2d(e.polygon.length-2);this._created$.next(this)}};e.prototype.dispose=function(){o.prototype.dispose.call(this);this._disposeLine(this._outline);this._disposeObjects()};e.prototype.getDOMObjects=function(e,t){var r=this;var n=[];var i={offsetHeight:t.height,offsetWidth:t.width};var o=function(e){e.stopPropagation();r._aborted$.next(r)};if(this._geometry instanceof L.RectGeometry){var a=this._geometry.anchorIndex;var s=a===undefined?1:a;var u=this._geometry.getVertex2d(s),c=u[0],h=u[1];var l=this._viewportCoords.basicToCanvasSafe(c,h,i,this._transform,e);if(l!=null){var p=this._colorToBackground(this._options.color);var f=this._canvasToTransform(l);var d={style:{background:p,transform:f}};var v={onclick:o,style:{transform:f}};n.push(k.h("div.TagInteractor",v,[]));n.push(k.h("div.TagVertex",d,[]))}}else if(this._geometry instanceof L.PolygonGeometry){var m=this._geometry;var g=m.getVertex2d(0),_=g[0],y=g[1];var b=this._viewportCoords.basicToCanvasSafe(_,y,i,this._transform,e);if(b!=null){var w=m.polygon.length>4?function(e){e.stopPropagation();m.removeVertex2d(m.polygon.length-2);r._created$.next(r)}:o;var f=this._canvasToTransform(b);var v={onclick:w,style:{transform:f}};var x=m.polygon.length>4?"TagCompleter":"TagInteractor";n.push(k.h("div."+x,v,[]))}if(m.polygon.length>3){var S=m.getVertex2d(m.polygon.length-3),M=S[0],C=S[1];var E=this._viewportCoords.basicToCanvasSafe(M,C,i,this._transform,e);if(E!=null){var T=function(e){e.stopPropagation();m.removeVertex2d(m.polygon.length-3)};var f=this._canvasToTransform(E);var v={onclick:T,style:{transform:f}};n.push(k.h("div.TagInteractor",v,[]))}}var O=m.polygon.slice();O.splice(-2,2);for(var P=0,A=O;P<A.length;P++){var j=A[P];var R=this._viewportCoords.basicToCanvasSafe(j[0],j[1],i,this._transform,e);if(R!=null){var p=this._colorToBackground(this._options.color);var f=this._canvasToTransform(R);var d={style:{background:p,transform:f}};n.push(k.h("div.TagVertex",d,[]))}}}return n};e.prototype.addPoint=function(e){if(this._geometry instanceof L.RectGeometry){var t=this._geometry;if(!t.validate(e)){return}this._created$.next(this)}else if(this._geometry instanceof L.PolygonGeometry){var r=this._geometry;r.addVertex2d(e)}};e.prototype._onGeometryChanged=function(){this._disposeLine(this._outline);this._disposeObjects();this._createGlObjects()};e.prototype._disposeObjects=function(){this._outline=null;this._glObjects=[]};e.prototype._createGlObjects=function(){var e=this._geometry instanceof L.RectGeometry?this._geometry.getPoints3d(this._transform):this._geometry.getVertices3d(this._transform);this._outline=this._createOutine(e,this._options.color);this._glObjects=[this._outline]};return e}(L.CreateTag);r.OutlineCreateTag=i;r.default=i},{"../../../Component":291,"virtual-dom":247}],390:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("three");var U=e("virtual-dom");var G=e("../../../Component");var n=function(n){i(e,n);function e(e,t){var r=n.call(this,e,t)||this;r._fill=!t.gpano?r._createFill():t.fullPano&&e.domain===G.TagDomain.TwoDimensional&&e.geometry instanceof G.PolygonGeometry?r._createFill():null;r._holes=r._tag.lineWidth>=1?r._createHoles():[];r._outline=r._tag.lineWidth>=1?r._createOutline():null;return r}e.prototype.dispose=function(){n.prototype.dispose.call(this);this._disposeFill();this._disposeHoles();this._disposeOutline()};e.prototype.getDOMObjects=function(e,t,r){var n=this;var i=[];var o=this._tag.geometry instanceof G.RectGeometry;var a=!this._transform.gpano;var s={offsetHeight:r.height,offsetWidth:r.width};if(this._tag.icon!=null&&(o||a)){var u=this._tag.geometry instanceof G.RectGeometry?this._tag.geometry.getVertex2d(this._tag.iconIndex):this._tag.geometry.getPoleOfInaccessibility2d(),c=u[0],h=u[1];var l=this._viewportCoords.basicToCanvasSafe(c,h,s,this._transform,t);if(l!=null){var p=function(){n._interact$.next({offsetX:0,offsetY:0,operation:G.TagOperation.None,tag:n._tag})};if(e.loaded){var f=e.getDOMSprite(this._tag.icon,this._tag.iconFloat);var d=Math.round(l[0]);var v=Math.round(l[1]);var m="translate("+d+"px,"+v+"px)";var g=function(e){e.stopPropagation();n._tag.click$.next(n._tag)};var _={onclick:g,onmousedown:p,style:{transform:m}};i.push(U.h("div.TagSymbol",_,[f]))}}}else if(this._tag.text!=null&&(o||a)){var y=this._tag.geometry instanceof G.RectGeometry?this._tag.geometry.getVertex2d(3):this._tag.geometry.getPoleOfInaccessibility2d(),b=y[0],w=y[1];var x=this._viewportCoords.basicToCanvasSafe(b,w,s,this._transform,t);if(x!=null){var S=Math.round(x[0]);var M=Math.round(x[1]);var m=this._tag.geometry instanceof G.RectGeometry?"translate("+S+"px,"+M+"px)":"translate(-50%, -50%) translate("+S+"px,"+M+"px)";var p=function(){n._interact$.next({offsetX:0,offsetY:0,operation:G.TagOperation.None,tag:n._tag})};var _={onmousedown:p,style:{color:this._colorToCss(this._tag.textColor),transform:m},textContent:this._tag.text};i.push(U.h("span.TagSymbol",_,[]))}}if(!this._tag.editable){return i}var C=this._colorToCss(this._tag.lineColor);if(this._tag.geometry instanceof G.RectGeometry){var E=this._tag.geometry.getCentroid2d(),T=E[0],O=E[1];var P=this._viewportCoords.basicToCanvasSafe(T,O,s,this._transform,t);if(P!=null){var p=this._interact(G.TagOperation.Centroid,"move");var A=Math.round(P[0]);var j=Math.round(P[1]);var m="translate(-50%, -50%) translate("+A+"px,"+j+"px)";var _={onmousedown:p,style:{background:C,transform:m}};i.push(U.h("div.TagMover",_,[]))}}var R=this._tag.geometry.getVertices2d();for(var k=0;k<R.length-1;k++){if(o&&(this._tag.icon!=null&&k===this._tag.iconIndex||this._tag.icon==null&&this._tag.text!=null&&k===3)){continue}var L=R[k],I=L[0],N=L[1];var D=this._viewportCoords.basicToCanvasSafe(I,N,s,this._transform,t);if(D==null){continue}var B=o?k%2===0?"nesw-resize":"nwse-resize":"crosshair";var p=this._interact(G.TagOperation.Vertex,B,k);var F=Math.round(D[0]);var z=Math.round(D[1]);var m="translate(-50%, -50%) translate("+F+"px,"+z+"px)";var _={onmousedown:p,style:{background:C,transform:m,cursor:B}};i.push(U.h("div.TagResizer",_,[]));if(!this._tag.indicateVertices){continue}var $={style:{background:C,transform:m}};i.push(U.h("div.TagVertex",$,[]))}return i};e.prototype.getGLObjects=function(){var e=[];if(this._fill!=null){e.push(this._fill)}for(var t=0,r=this._holes;t<r.length;t++){var n=r[t];e.push(n)}if(this._outline!=null){e.push(this._outline)}return e};e.prototype.getRetrievableObjects=function(){return this._fill!=null?[this._fill]:[]};e.prototype._onGeometryChanged=function(){if(this._fill!=null){this._updateFillGeometry()}if(this._holes.length>0){this._updateHoleGeometries()}if(this._outline!=null){this._updateOulineGeometry()}};e.prototype._onTagChanged=function(){var e=false;if(this._fill!=null){this._updateFillMaterial(this._fill.material)}if(this._outline==null){if(this._tag.lineWidth>=1){this._holes=this._createHoles();this._outline=this._createOutline();e=true}}else{this._updateHoleMaterials();this._updateOutlineMaterial()}return e};e.prototype._getPoints3d=function(){return this._in3dDomain()?this._tag.geometry.getVertices3d(this._transform):this._tag.geometry.getPoints3d(this._transform)};e.prototype._getTriangles=function(){return this._in3dDomain()?this._tag.geometry.get3dDomainTriangles3d(this._transform):this._tag.geometry.getTriangles3d(this._transform)};e.prototype._updateFillMaterial=function(e){e.color=new o.Color(this._tag.fillColor);e.opacity=this._tag.fillOpacity;e.needsUpdate=true};e.prototype._updateLineBasicMaterial=function(e){e.color=new o.Color(this._tag.lineColor);e.linewidth=Math.max(this._tag.lineWidth,1);e.visible=this._tag.lineWidth>=1&&this._tag.lineOpacity>0;e.opacity=this._tag.lineOpacity;e.transparent=this._tag.lineOpacity<1;e.needsUpdate=true};e.prototype._createHoles=function(){var e=[];if(this._tag.geometry instanceof G.PolygonGeometry){var t=this._getHoles3d();for(var r=0,n=t;r<n.length;r++){var i=n[r];var o=this._createLine(i);e.push(o)}}return e};e.prototype._disposeHoles=function(){for(var e=0,t=this._holes;e<t.length;e++){var r=t[e];r.geometry.dispose();r.material.dispose()}this._holes=[]};e.prototype._getHoles3d=function(){var e=this._tag.geometry;return this._in3dDomain()?e.getHoleVertices3d(this._transform):e.getHolePoints3d(this._transform)};e.prototype._in3dDomain=function(){return this._tag.geometry instanceof G.PolygonGeometry&&this._tag.domain===G.TagDomain.ThreeDimensional};e.prototype._updateHoleGeometries=function(){var e=this._getHoles3d();if(e.length!==this._holes.length){throw new Error("Changing the number of holes is not supported.")}for(var t=0;t<this._holes.length;t++){var r=e[t];var n=this._holes[t];this._updateLine(n,r)}};e.prototype._updateHoleMaterials=function(){for(var e=0,t=this._holes;e<t.length;e++){var r=t[e];this._updateLineBasicMaterial(r.material)}};e.prototype._updateOutlineMaterial=function(){this._updateLineBasicMaterial(this._outline.material)};return e}(G.OutlineRenderTagBase);r.OutlineRenderTag=n},{"../../../Component":291,three:242,"virtual-dom":247}],391:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("three");var n=e("../../../Component");var a=function(n){i(e,n);function e(e,t){var r=n.call(this,e,t)||this;r._geometryChangedSubscription=r._tag.geometry.changed$.subscribe(function(){r._onGeometryChanged()});r._changedSubscription=r._tag.changed$.subscribe(function(){var e=r._onTagChanged();if(e){r._glObjectsChanged$.next(r)}});return r}e.prototype.dispose=function(){this._changedSubscription.unsubscribe();this._geometryChangedSubscription.unsubscribe()};e.prototype._colorToCss=function(e){return"#"+("000000"+e.toString(16)).substr(-6)};e.prototype._createFill=function(){var e=this._getTriangles();var t=new Float32Array(e);var r=new o.BufferGeometry;r.addAttribute("position",new o.BufferAttribute(t,3));r.computeBoundingSphere();var n=new o.MeshBasicMaterial({side:o.DoubleSide,transparent:true});this._updateFillMaterial(n);return new o.Mesh(r,n)};e.prototype._createLine=function(e){var t=this._getLinePositions(e);var r=new o.BufferGeometry;r.addAttribute("position",new o.BufferAttribute(t,3));r.computeBoundingSphere();var n=new o.LineBasicMaterial;this._updateLineBasicMaterial(n);var i=new o.Line(r,n);i.renderOrder=1;return i};e.prototype._createOutline=function(){return this._createLine(this._getPoints3d())};e.prototype._disposeFill=function(){if(this._fill==null){return}this._fill.geometry.dispose();this._fill.material.dispose();this._fill=null};e.prototype._disposeOutline=function(){if(this._outline==null){return}this._outline.geometry.dispose();this._outline.material.dispose();this._outline=null};e.prototype._getLinePositions=function(e){var t=e.length;var r=new Float32Array(t*3);for(var n=0;n<t;++n){var i=3*n;var o=e[n];r[i+0]=o[0];r[i+1]=o[1];r[i+2]=o[2]}return r};e.prototype._interact=function(n,i,o){var a=this;return function(e){var t=e.offsetX-e.target.offsetWidth/2;var r=e.offsetY-e.target.offsetHeight/2;a._interact$.next({cursor:i,offsetX:t,offsetY:r,operation:n,tag:a._tag,vertexIndex:o})}};e.prototype._updateFillGeometry=function(){var e=this._getTriangles();var t=new Float32Array(e);var r=this._fill.geometry;var n=r.getAttribute("position");if(n.array.length===t.length){n.set(t);n.needsUpdate=true}else{r.removeAttribute("position");r.addAttribute("position",new o.BufferAttribute(t,3))}r.computeBoundingSphere()};e.prototype._updateLine=function(e,t){var r=this._getLinePositions(t);var n=e.geometry;var i=n.getAttribute("position");i.set(r);i.needsUpdate=true;n.computeBoundingSphere()};e.prototype._updateOulineGeometry=function(){this._updateLine(this._outline,this._getPoints3d())};return e}(n.RenderTag);r.OutlineRenderTagBase=a;r.default=a},{"../../../Component":291,three:242}],392:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var u=e("rxjs");var c=e("../../../Component");var h=e("../../../Viewer");var i=function(a){n(s,a);function s(e,t,r){var n=a.call(this,e,t)||this;r=!!r?r:{};var i=r.domain!=null&&t instanceof c.PolygonGeometry?r.domain:c.TagDomain.TwoDimensional;var o=n._twoDimensionalPolygon(i,t);n._domain=i;n._editable=r.editable==null||o?false:r.editable;n._fillColor=r.fillColor==null?16777215:r.fillColor;n._fillOpacity=r.fillOpacity==null?0:r.fillOpacity;n._icon=r.icon===undefined?null:r.icon;n._iconFloat=r.iconFloat==null?h.Alignment.Center:r.iconFloat;n._iconIndex=r.iconIndex==null?3:r.iconIndex;n._indicateVertices=r.indicateVertices==null?true:r.indicateVertices;n._lineColor=r.lineColor==null?16777215:r.lineColor;n._lineOpacity=r.lineOpacity==null?1:r.lineOpacity;n._lineWidth=r.lineWidth==null?1:r.lineWidth;n._text=r.text===undefined?null:r.text;n._textColor=r.textColor==null?16777215:r.textColor;n._click$=new u.Subject;n._click$.subscribe(function(e){n.fire(s.click,n)});return n}Object.defineProperty(s.prototype,"click$",{get:function(){return this._click$},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"domain",{get:function(){return this._domain},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"editable",{get:function(){return this._editable},set:function(e){if(this._twoDimensionalPolygon(this._domain,this._geometry)){return}this._editable=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"fillColor",{get:function(){return this._fillColor},set:function(e){this._fillColor=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"fillOpacity",{get:function(){return this._fillOpacity},set:function(e){this._fillOpacity=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"geometry",{get:function(){return this._geometry},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"icon",{get:function(){return this._icon},set:function(e){this._icon=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"iconFloat",{get:function(){return this._iconFloat},set:function(e){this._iconFloat=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"iconIndex",{get:function(){return this._iconIndex},set:function(e){this._iconIndex=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"indicateVertices",{get:function(){return this._indicateVertices},set:function(e){this._indicateVertices=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"lineColor",{get:function(){return this._lineColor},set:function(e){this._lineColor=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"lineOpacity",{get:function(){return this._lineOpacity},set:function(e){this._lineOpacity=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(e){this._lineWidth=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(s.prototype,"textColor",{get:function(){return this._textColor},set:function(e){this._textColor=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});s.prototype.setOptions=function(e){var t=this._twoDimensionalPolygon(this._domain,this._geometry);this._editable=t||e.editable==null?this._editable:e.editable;this._icon=e.icon===undefined?this._icon:e.icon;this._iconFloat=e.iconFloat==null?this._iconFloat:e.iconFloat;this._iconIndex=e.iconIndex==null?this._iconIndex:e.iconIndex;this._indicateVertices=e.indicateVertices==null?this._indicateVertices:e.indicateVertices;this._lineColor=e.lineColor==null?this._lineColor:e.lineColor;this._lineWidth=e.lineWidth==null?this._lineWidth:e.lineWidth;this._fillColor=e.fillColor==null?this._fillColor:e.fillColor;this._fillOpacity=e.fillOpacity==null?this._fillOpacity:e.fillOpacity;this._text=e.text===undefined?this._text:e.text;this._textColor=e.textColor==null?this._textColor:e.textColor;this._notifyChanged$.next(this)};s.prototype._twoDimensionalPolygon=function(e,t){return e!==c.TagDomain.ThreeDimensional&&t instanceof c.PolygonGeometry};s.click="click";return s}(c.Tag);r.OutlineTag=i;r.default=i},{"../../../Component":291,"../../../Viewer":302,rxjs:43}],393:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rxjs");var i=e("../../../Geo");var o=function(){function e(e,t,r){this._tag=e;this._transform=t;this._viewportCoords=!!r?r:new i.ViewportCoords;this._glObjectsChanged$=new n.Subject;this._interact$=new n.Subject}Object.defineProperty(e.prototype,"glObjectsChanged$",{get:function(){return this._glObjectsChanged$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"interact$",{get:function(){return this._interact$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"tag",{get:function(){return this._tag},enumerable:true,configurable:true});return e}();r.RenderTag=o;r.default=o},{"../../../Geo":294,rxjs:43}],394:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var S=e("virtual-dom");var M=e("../../../Component");var C=e("../../../Viewer");var i=function(e){n(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.dispose=function(){};t.prototype.getDOMObjects=function(e,t,r){var n=this;var i=this._tag;var o={offsetHeight:r.height,offsetWidth:r.width};var a=[];var s=i.geometry.getCentroid2d(),u=s[0],c=s[1];var h=this._viewportCoords.basicToCanvasSafe(u,c,o,this._transform,t);if(h!=null){var l=function(e){n._interact$.next({offsetX:0,offsetY:0,operation:M.TagOperation.None,tag:i})};var p=Math.round(h[0]);var f=Math.round(h[1]);if(i.icon!=null){if(e.loaded){var d=e.getDOMSprite(i.icon,C.Alignment.Bottom);var v="translate("+p+"px,"+(f+8)+"px)";var m={onmousedown:l,style:{pointerEvents:"all",transform:v}};a.push(S.h("div",m,[d]))}}else if(i.text!=null){var g="translate(-50%,0%) translate("+p+"px,"+(f+8)+"px)";var m={onmousedown:l,style:{color:this._colorToCss(i.textColor),transform:g},textContent:i.text};a.push(S.h("span.TagSymbol",m,[]))}var _=this._interact(M.TagOperation.Centroid,i,"move");var y=this._colorToCss(i.color);var b="translate(-50%,-50%) translate("+p+"px,"+f+"px)";if(i.editable){var w={onmousedown:_,style:{background:y,transform:b}};a.push(S.h("div.TagSpotInteractor",w,[]))}var x={style:{background:y,transform:b}};a.push(S.h("div.TagVertex",x,[]))}return a};t.prototype.getGLObjects=function(){return[]};t.prototype.getRetrievableObjects=function(){return[]};t.prototype._colorToCss=function(e){return"#"+("000000"+e.toString(16)).substr(-6)};t.prototype._interact=function(n,i,o,a){var s=this;return function(e){var t=e.offsetX-e.target.offsetWidth/2;var r=e.offsetY-e.target.offsetHeight/2;s._interact$.next({cursor:o,offsetX:t,offsetY:r,operation:n,tag:i,vertexIndex:a})}};return t}(M.RenderTag);r.SpotRenderTag=i},{"../../../Component":291,"../../../Viewer":302,"virtual-dom":247}],395:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../../../Component");var o=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e,t)||this;r=!!r?r:{};n._color=r.color==null?16777215:r.color;n._editable=r.editable==null?false:r.editable;n._icon=r.icon===undefined?null:r.icon;n._text=r.text===undefined?null:r.text;n._textColor=r.textColor==null?16777215:r.textColor;return n}Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"editable",{get:function(){return this._editable},set:function(e){this._editable=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"icon",{get:function(){return this._icon},set:function(e){this._icon=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"textColor",{get:function(){return this._textColor},set:function(e){this._textColor=e;this._notifyChanged$.next(this)},enumerable:true,configurable:true});e.prototype.setOptions=function(e){this._color=e.color==null?this._color:e.color;this._editable=e.editable==null?this._editable:e.editable;this._icon=e.icon===undefined?this._icon:e.icon;this._text=e.text===undefined?this._text:e.text;this._textColor=e.textColor==null?this._textColor:e.textColor;this._notifyChanged$.next(this)};return e}(i.Tag);r.SpotTag=o;r.default=o},{"../../../Component":291}],396:[function(e,t,r){"use strict";var o=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var a=e("rxjs/operators");var s=e("rxjs");var n=e("../../../Utils");var i=function(n){o(i,n);function i(e,t){var r=n.call(this)||this;r._id=e;r._geometry=t;r._notifyChanged$=new s.Subject;r._notifyChanged$.subscribe(function(e){r.fire(i.changed,r)});r._geometry.changed$.subscribe(function(e){r.fire(i.geometrychanged,r)});return r}Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"geometry",{get:function(){return this._geometry},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"changed$",{get:function(){return this._notifyChanged$},enumerable:true,configurable:true});Object.defineProperty(i.prototype,"geometryChanged$",{get:function(){var t=this;return this._geometry.changed$.pipe(a.map(function(e){return t}),a.share())},enumerable:true,configurable:true});i.changed="changed";i.geometrychanged="geometrychanged";return i}(n.EventEmitter);r.Tag=i;r.default=i},{"../../../Utils":301,rxjs:43,"rxjs/operators":241}],397:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["TwoDimensional"]=0]="TwoDimensional";e[e["ThreeDimensional"]=1]="ThreeDimensional"})(n=r.TagDomain||(r.TagDomain={}));r.default=n},{}],398:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["Automatic"]=0]="Automatic";e[e["Large"]=1]="Large";e[e["Small"]=2]="Small"})(n=r.ComponentSize||(r.ComponentSize={}));r.default=n},{}],399:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(e,t,r){this._component=e;this._container=t;this._navigator=r;this._enabled=false}Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:true,configurable:true});e.prototype.enable=function(){if(this._enabled||!this._component.activated){return}this._enable();this._enabled=true;this._component.configure(this._getConfiguration(true))};e.prototype.disable=function(){if(!this._enabled){return}this._disable();this._enabled=false;if(this._component.activated){this._component.configure(this._getConfiguration(false))}};return e}();r.HandlerBase=n;r.default=n},{}],400:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var b=e("three");var h=e("../../Component");var n=function(){function e(e,t){this._imagePlaneDepth=e!=null?e:200;this._imageSphereRadius=t!=null?t:200}e.prototype.createMesh=function(e,t){if(e.pano){return this._createImageSphere(e,t)}else if(t.cameraProjection==="fisheye"){return this._createImagePlaneFisheye(e,t)}else{return this._createImagePlane(e,t)}};e.prototype.createFlatMesh=function(e,t,r,n,i,o){var a=this._createTexture(e.image);var s=this._createDistortedPlaneMaterialParameters(t,a);var u=new b.ShaderMaterial(s);var c=this._getFlatImagePlaneGeoFromBasic(t,r,n,i,o);return new b.Mesh(c,u)};e.prototype.createCurtainMesh=function(e,t){if(e.pano&&!e.fullPano){throw new Error("Cropped panoramas cannot have curtain.")}if(e.pano){return this._createSphereCurtainMesh(e,t)}else if(t.cameraProjection==="fisheye"){return this._createCurtainMeshFisheye(e,t)}else{return this._createCurtainMesh(e,t)}};e.prototype.createDistortedCurtainMesh=function(e,t){if(e.pano){throw new Error("Cropped panoramas cannot have curtain.")}return this._createDistortedCurtainMesh(e,t)};e.prototype._createCurtainMesh=function(e,t){var r=this._createTexture(e.image);var n=this._createCurtainPlaneMaterialParameters(t,r);var i=new b.ShaderMaterial(n);var o=this._useMesh(t,e)?this._getImagePlaneGeo(t,e):this._getRegularFlatImagePlaneGeo(t);return new b.Mesh(o,i)};e.prototype._createCurtainMeshFisheye=function(e,t){var r=this._createTexture(e.image);var n=this._createCurtainPlaneMaterialParametersFisheye(t,r);var i=new b.ShaderMaterial(n);var o=this._useMesh(t,e)?this._getImagePlaneGeoFisheye(t,e):this._getRegularFlatImagePlaneGeo(t);return new b.Mesh(o,i)};e.prototype._createDistortedCurtainMesh=function(e,t){var r=this._createTexture(e.image);var n=this._createDistortedCurtainPlaneMaterialParameters(t,r);var i=new b.ShaderMaterial(n);var o=this._getRegularFlatImagePlaneGeo(t);return new b.Mesh(o,i)};e.prototype._createSphereCurtainMesh=function(e,t){var r=this._createTexture(e.image);var n=this._createCurtainSphereMaterialParameters(t,r);var i=new b.ShaderMaterial(n);return this._useMesh(t,e)?new b.Mesh(this._getImageSphereGeo(t,e),i):new b.Mesh(this._getFlatImageSphereGeo(t),i)};e.prototype._createImageSphere=function(e,t){var r=this._createTexture(e.image);var n=this._createSphereMaterialParameters(t,r);var i=new b.ShaderMaterial(n);var o=this._useMesh(t,e)?new b.Mesh(this._getImageSphereGeo(t,e),i):new b.Mesh(this._getFlatImageSphereGeo(t),i);return o};e.prototype._createImagePlane=function(e,t){var r=this._createTexture(e.image);var n=this._createPlaneMaterialParameters(t,r);var i=new b.ShaderMaterial(n);var o=this._useMesh(t,e)?this._getImagePlaneGeo(t,e):this._getRegularFlatImagePlaneGeo(t);return new b.Mesh(o,i)};e.prototype._createImagePlaneFisheye=function(e,t){var r=this._createTexture(e.image);var n=this._createPlaneMaterialParametersFisheye(t,r);var i=new b.ShaderMaterial(n);var o=this._useMesh(t,e)?this._getImagePlaneGeoFisheye(t,e):this._getRegularFlatImagePlaneGeoFisheye(t);return new b.Mesh(o,i)};e.prototype._createSphereMaterialParameters=function(e,t){var r=e.gpano;var n=(r.FullPanoWidthPixels-r.CroppedAreaImageWidthPixels)/2;var i=2*Math.PI*(r.CroppedAreaLeftPixels-n)/r.FullPanoWidthPixels;var o=2*Math.PI*r.CroppedAreaImageWidthPixels/r.FullPanoWidthPixels;var a=(r.FullPanoHeightPixels-r.CroppedAreaImageHeightPixels)/2;var s=Math.PI*(a-r.CroppedAreaTopPixels)/r.FullPanoHeightPixels;var u=Math.PI*r.CroppedAreaImageHeightPixels/r.FullPanoHeightPixels;var c={depthWrite:false,fragmentShader:h.Shaders.equirectangular.fragment,side:b.DoubleSide,transparent:true,uniforms:{opacity:{type:"f",value:1},phiLength:{type:"f",value:o},phiShift:{type:"f",value:i},projectorMat:{type:"m4",value:e.rt},projectorTex:{type:"t",value:t},thetaLength:{type:"f",value:u},thetaShift:{type:"f",value:s}},vertexShader:h.Shaders.equirectangular.vertex};return c};e.prototype._createCurtainSphereMaterialParameters=function(e,t){var r=e.gpano;var n=(r.FullPanoWidthPixels-r.CroppedAreaImageWidthPixels)/2;var i=2*Math.PI*(r.CroppedAreaLeftPixels-n)/r.FullPanoWidthPixels;var o=2*Math.PI*r.CroppedAreaImageWidthPixels/r.FullPanoWidthPixels;var a=(r.FullPanoHeightPixels-r.CroppedAreaImageHeightPixels)/2;var s=Math.PI*(a-r.CroppedAreaTopPixels)/r.FullPanoHeightPixels;var u=Math.PI*r.CroppedAreaImageHeightPixels/r.FullPanoHeightPixels;var c={depthWrite:false,fragmentShader:h.Shaders.equirectangularCurtain.fragment,side:b.DoubleSide,transparent:true,uniforms:{curtain:{type:"f",value:1},opacity:{type:"f",value:1},phiLength:{type:"f",value:o},phiShift:{type:"f",value:i},projectorMat:{type:"m4",value:e.rt},projectorTex:{type:"t",value:t},thetaLength:{type:"f",value:u},thetaShift:{type:"f",value:s}},vertexShader:h.Shaders.equirectangularCurtain.vertex};return c};e.prototype._createPlaneMaterialParameters=function(e,t){var r={depthWrite:false,fragmentShader:h.Shaders.perspective.fragment,side:b.DoubleSide,transparent:true,uniforms:{focal:{type:"f",value:e.focal},k1:{type:"f",value:e.ck1},k2:{type:"f",value:e.ck2},opacity:{type:"f",value:1},projectorMat:{type:"m4",value:e.basicRt},projectorTex:{type:"t",value:t},radial_peak:{type:"f",value:!!e.radialPeak?e.radialPeak:0},scale_x:{type:"f",value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{type:"f",value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:h.Shaders.perspective.vertex};return r};e.prototype._createPlaneMaterialParametersFisheye=function(e,t){var r={depthWrite:false,fragmentShader:h.Shaders.fisheye.fragment,side:b.DoubleSide,transparent:true,uniforms:{focal:{type:"f",value:e.focal},k1:{type:"f",value:e.ck1},k2:{type:"f",value:e.ck2},opacity:{type:"f",value:1},projectorMat:{type:"m4",value:e.basicRt},projectorTex:{type:"t",value:t},radial_peak:{type:"f",value:!!e.radialPeak?e.radialPeak:0},scale_x:{type:"f",value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{type:"f",value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:h.Shaders.fisheye.vertex};return r};e.prototype._createCurtainPlaneMaterialParametersFisheye=function(e,t){var r={depthWrite:false,fragmentShader:h.Shaders.fisheyeCurtain.fragment,side:b.DoubleSide,transparent:true,uniforms:{curtain:{type:"f",value:1},focal:{type:"f",value:e.focal},k1:{type:"f",value:e.ck1},k2:{type:"f",value:e.ck2},opacity:{type:"f",value:1},projectorMat:{type:"m4",value:e.basicRt},projectorTex:{type:"t",value:t},radial_peak:{type:"f",value:!!e.radialPeak?e.radialPeak:0},scale_x:{type:"f",value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{type:"f",value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:h.Shaders.fisheyeCurtain.vertex};return r};e.prototype._createCurtainPlaneMaterialParameters=function(e,t){var r={depthWrite:false,fragmentShader:h.Shaders.perspectiveCurtain.fragment,side:b.DoubleSide,transparent:true,uniforms:{curtain:{type:"f",value:1},focal:{type:"f",value:e.focal},k1:{type:"f",value:e.ck1},k2:{type:"f",value:e.ck2},opacity:{type:"f",value:1},projectorMat:{type:"m4",value:e.basicRt},projectorTex:{type:"t",value:t},radial_peak:{type:"f",value:!!e.radialPeak?e.radialPeak:0},scale_x:{type:"f",value:Math.max(e.basicHeight,e.basicWidth)/e.basicWidth},scale_y:{type:"f",value:Math.max(e.basicWidth,e.basicHeight)/e.basicHeight}},vertexShader:h.Shaders.perspectiveCurtain.vertex};return r};e.prototype._createDistortedCurtainPlaneMaterialParameters=function(e,t){var r={depthWrite:false,fragmentShader:h.Shaders.perspectiveDistortedCurtain.fragment,side:b.DoubleSide,transparent:true,uniforms:{curtain:{type:"f",value:1},opacity:{type:"f",value:1},projectorMat:{type:"m4",value:e.projectorMatrix()},projectorTex:{type:"t",value:t}},vertexShader:h.Shaders.perspectiveDistortedCurtain.vertex};return r};e.prototype._createDistortedPlaneMaterialParameters=function(e,t){var r={depthWrite:false,fragmentShader:h.Shaders.perspectiveDistorted.fragment,side:b.DoubleSide,transparent:true,uniforms:{opacity:{type:"f",value:1},projectorMat:{type:"m4",value:e.projectorMatrix()},projectorTex:{type:"t",value:t}},vertexShader:h.Shaders.perspectiveDistorted.vertex};return r};e.prototype._createTexture=function(e){var t=new b.Texture(e);t.minFilter=b.LinearFilter;t.needsUpdate=true;return t};e.prototype._useMesh=function(e,t){return t.mesh.vertices.length&&e.hasValidScale};e.prototype._getImageSphereGeo=function(e,t){var r=(new b.Matrix4).getInverse(e.srt);var n=5*e.scale;var i=this._imageSphereRadius*e.scale;var o=t.mesh.vertices;var a=o.length/3;var s=new Float32Array(o.length);for(var u=0;u<a;++u){var c=3*u;var h=o[c+0];var l=o[c+1];var p=o[c+2];var f=Math.sqrt(h*h+l*l+p*p);var d=Math.max(n,Math.min(f,i));var v=d/f;var m=new b.Vector3(h*v,l*v,p*v);m.applyMatrix4(r);s[c+0]=m.x;s[c+1]=m.y;s[c+2]=m.z}var g=t.mesh.faces;var _=new Uint16Array(g.length);for(var u=0;u<g.length;++u){_[u]=g[u]}var y=new b.BufferGeometry;y.addAttribute("position",new b.BufferAttribute(s,3));y.setIndex(new b.BufferAttribute(_,1));return y};e.prototype._getImagePlaneGeo=function(e,t){var r=3;var n=(new b.Matrix4).getInverse(e.srt);var i=5*e.scale;var o=this._imagePlaneDepth*e.scale;var a=t.mesh.vertices;var s=a.length/3;var u=new Float32Array(a.length);for(var c=0;c<s;++c){var h=3*c;var l=a[h+0];var p=a[h+1];var f=a[h+2];if(c<4){l*=r;p*=r}var d=Math.max(i,Math.min(f,o));var v=d/f;var m=new b.Vector3(l*v,p*v,d);m.applyMatrix4(n);u[h+0]=m.x;u[h+1]=m.y;u[h+2]=m.z}var g=t.mesh.faces;var _=new Uint16Array(g.length);for(var c=0;c<g.length;++c){_[c]=g[c]}var y=new b.BufferGeometry;y.addAttribute("position",new b.BufferAttribute(u,3));y.setIndex(new b.BufferAttribute(_,1));return y};e.prototype._getImagePlaneGeoFisheye=function(e,t){var r=(new b.Matrix4).getInverse(e.srt);var n=5*e.scale;var i=this._imagePlaneDepth*e.scale;var o=t.mesh.vertices;var a=o.length/3;var s=new Float32Array(o.length);for(var u=0;u<a;++u){var c=3*u;var h=o[c+0];var l=o[c+1];var p=o[c+2];var f=Math.sqrt(h*h+l*l+p*p);var d=Math.max(n,Math.min(f,i));var v=d/f;var m=new b.Vector3(h*v,l*v,p*v);m.applyMatrix4(r);s[c+0]=m.x;s[c+1]=m.y;s[c+2]=m.z}var g=t.mesh.faces;var _=new Uint16Array(g.length);for(var u=0;u<g.length;++u){_[u]=g[u]}var y=new b.BufferGeometry;y.addAttribute("position",new b.BufferAttribute(s,3));y.setIndex(new b.BufferAttribute(_,1));return y};e.prototype._getFlatImageSphereGeo=function(e){var t=e.gpano;var r=2*Math.PI*t.CroppedAreaLeftPixels/t.FullPanoWidthPixels;var n=2*Math.PI*t.CroppedAreaImageWidthPixels/t.FullPanoWidthPixels;var i=Math.PI*(t.FullPanoHeightPixels-t.CroppedAreaImageHeightPixels-t.CroppedAreaTopPixels)/t.FullPanoHeightPixels;var o=Math.PI*t.CroppedAreaImageHeightPixels/t.FullPanoHeightPixels;var a=new b.SphereGeometry(this._imageSphereRadius,20,40,r-Math.PI/2,n,i,o);a.applyMatrix((new b.Matrix4).getInverse(e.rt));return a};e.prototype._getRegularFlatImagePlaneGeo=function(e){var t=e.width;var r=e.height;var n=Math.max(t,r);var i=t/2/n;var o=r/2/n;return this._getFlatImagePlaneGeo(e,i,o)};e.prototype._getFlatImagePlaneGeo=function(e,t,r){var n=[];n.push(e.unprojectSfM([-t,-r],this._imagePlaneDepth));n.push(e.unprojectSfM([t,-r],this._imagePlaneDepth));n.push(e.unprojectSfM([t,r],this._imagePlaneDepth));n.push(e.unprojectSfM([-t,r],this._imagePlaneDepth));return this._createFlatGeometry(n)};e.prototype._getRegularFlatImagePlaneGeoFisheye=function(e){var t=e.width;var r=e.height;var n=Math.max(t,r);var i=t/2/n;var o=r/2/n;return this._getFlatImagePlaneGeoFisheye(e,i,o)};e.prototype._getFlatImagePlaneGeoFisheye=function(e,t,r){var n=[];n.push(e.unprojectSfM([-t,-r],this._imagePlaneDepth));n.push(e.unprojectSfM([t,-r],this._imagePlaneDepth));n.push(e.unprojectSfM([t,r],this._imagePlaneDepth));n.push(e.unprojectSfM([-t,r],this._imagePlaneDepth));return this._createFlatGeometry(n)};e.prototype._getFlatImagePlaneGeoFromBasic=function(e,t,r,n,i){var o=[];o.push(e.unprojectBasic([t,n],this._imagePlaneDepth));o.push(e.unprojectBasic([r,n],this._imagePlaneDepth));o.push(e.unprojectBasic([r,i],this._imagePlaneDepth));o.push(e.unprojectBasic([t,i],this._imagePlaneDepth));return this._createFlatGeometry(o)};e.prototype._createFlatGeometry=function(e){var t=new Float32Array(12);for(var r=0;r<e.length;r++){var n=3*r;t[n+0]=e[r][0];t[n+1]=e[r][1];t[n+2]=e[r][2]}var i=new Uint16Array(6);i[0]=0;i[1]=1;i[2]=3;i[3]=1;i[4]=2;i[5]=3;var o=new b.BufferGeometry;o.addAttribute("position",new b.BufferAttribute(t,3));o.setIndex(new b.BufferAttribute(i,1));return o};return e}();r.MeshFactory=n;r.default=n},{"../../Component":291,three:242}],401:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("three");var i=function(){function e(){this._planes={};this._planesOld={};this._planesPeriphery={};this._scene=new n.Scene;this._sceneOld=new n.Scene;this._scenePeriphery=new n.Scene}Object.defineProperty(e.prototype,"planes",{get:function(){return this._planes},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"planesOld",{get:function(){return this._planesOld},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"planesPeriphery",{get:function(){return this._planesPeriphery},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sceneOld",{get:function(){return this._sceneOld},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"scenePeriphery",{get:function(){return this._scenePeriphery},enumerable:true,configurable:true});e.prototype.updateImagePlanes=function(e){this._dispose(this._planesOld,this.sceneOld);for(var t in this._planes){if(!this._planes.hasOwnProperty(t)){continue}var r=this._planes[t];this._scene.remove(r);this._sceneOld.add(r)}for(var t in e){if(!e.hasOwnProperty(t)){continue}this._scene.add(e[t])}this._planesOld=this._planes;this._planes=e};e.prototype.addImagePlanes=function(e){for(var t in e){if(!e.hasOwnProperty(t)){continue}var r=e[t];this._scene.add(r);this._planes[t]=r}};e.prototype.addImagePlanesOld=function(e){for(var t in e){if(!e.hasOwnProperty(t)){continue}var r=e[t];this._sceneOld.add(r);this._planesOld[t]=r}};e.prototype.setImagePlanes=function(e){this._clear();this.addImagePlanes(e)};e.prototype.addPeripheryPlanes=function(e){for(var t in e){if(!e.hasOwnProperty(t)){continue}var r=e[t];this._scenePeriphery.add(r);this._planesPeriphery[t]=r}};e.prototype.setPeripheryPlanes=function(e){this._clearPeriphery();this.addPeripheryPlanes(e)};e.prototype.setImagePlanesOld=function(e){this._clearOld();this.addImagePlanesOld(e)};e.prototype.clear=function(){this._clear();this._clearOld()};e.prototype._clear=function(){this._dispose(this._planes,this._scene);this._planes={}};e.prototype._clearOld=function(){this._dispose(this._planesOld,this._sceneOld);this._planesOld={}};e.prototype._clearPeriphery=function(){this._dispose(this._planesPeriphery,this._scenePeriphery);this._planesPeriphery={}};e.prototype._dispose=function(e,t){for(var r in e){if(!e.hasOwnProperty(r)){continue}var n=e[r];t.remove(n);n.geometry.dispose();n.material.dispose();var i=n.material.uniforms.projectorTex.value;if(i!=null){i.dispose()}}};return e}();r.MeshScene=i;r.default=i},{three:242}],402:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=e("rxjs");var a=e("rxjs/operators");var n=function(){function e(){}e.filteredPairwiseMouseDrag$=function(n,i){return i.filtered$(n,i.mouseDragStart$).pipe(a.switchMap(function(e){var t=o.concat(o.of(e),i.filtered$(n,i.mouseDrag$));var r=i.filtered$(n,i.mouseDragEnd$).pipe(a.map(function(){return null}));return o.merge(t,r).pipe(a.takeWhile(function(e){return!!e}),a.startWith(null))}),a.pairwise(),a.filter(function(e){return e[0]!=null&&e[1]!=null}))};return e}();r.MouseOperator=n;r.default=n},{rxjs:43,"rxjs/operators":241}],403:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("rxjs");var a=e("rxjs/operators");var p=e("virtual-dom");var i=e("../../Component");var s=e("../../Geo");var f=e("../../State");var d=e("../utils/ComponentSize");var u=function(i){n(e,i);function e(e,t,r){var n=i.call(this,e,t,r)||this;n._viewportCoords=new s.ViewportCoords;n._zoomDelta$=new o.Subject;return n}e.prototype._activate=function(){var l=this;this._renderSubscription=o.combineLatest(this._navigator.stateService.currentState$,this._navigator.stateService.state$,this._configuration$,this._container.renderService.size$).pipe(a.map(function(e){var t=e[0],r=e[1],n=e[2],i=e[3];var o=t.state.zoom;var a=p.h("div.ZoomInIcon",[]);var s=o>=3||r===f.State.Waiting?p.h("div.ZoomInButtonDisabled",[a]):p.h("div.ZoomInButton",{onclick:function(){l._zoomDelta$.next(1)}},[a]);var u=p.h("div.ZoomOutIcon",[]);var c=o<=0||r===f.State.Waiting?p.h("div.ZoomOutButtonDisabled",[u]):p.h("div.ZoomOutButton",{onclick:function(){l._zoomDelta$.next(-1)}},[u]);var h=n.size===d.default.Small||n.size===d.default.Automatic&&i.width<640?".ZoomCompact":"";return{name:l._name,vnode:p.h("div.ZoomContainer"+h,{oncontextmenu:function(e){e.preventDefault()}},[s,c])}})).subscribe(this._container.domRenderer.render$);this._zoomSubscription=this._zoomDelta$.pipe(a.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe(function(e){var t=e[0],r=e[1],n=e[2];var i=l._viewportCoords.unprojectFromViewport(0,0,r.perspective);var o=n.projectBasic(i.toArray());l._navigator.stateService.zoomIn(t,o)})};e.prototype._deactivate=function(){this._renderSubscription.unsubscribe();this._zoomSubscription.unsubscribe()};e.prototype._getDefaultConfiguration=function(){return{size:d.default.Automatic}};e.componentName="zoom";return e}(i.Component);r.ZoomComponent=u;i.ComponentService.register(u);r.default=u},{"../../Component":291,"../../Geo":294,"../../State":298,"../utils/ComponentSize":398,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],404:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("./MapillaryError");var o=function(r){i(n,r);function n(e){var t=r.call(this,e!=null?e:"The request was aborted.")||this;Object.setPrototypeOf(t,n.prototype);t.name="AbortMapillaryError";return t}return n}(n.MapillaryError);r.AbortMapillaryError=o;r.default=o},{"./MapillaryError":407}],405:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("./MapillaryError");var o=function(r){i(n,r);function n(e){var t=r.call(this,e!=null?e:"The argument is not valid.")||this;Object.setPrototypeOf(t,n.prototype);t.name="ArgumentMapillaryError";return t}return n}(n.MapillaryError);r.ArgumentMapillaryError=o;r.default=o},{"./MapillaryError":407}],406:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=e("./MapillaryError");var o=function(r){i(n,r);function n(e){var t=r.call(this,e)||this;Object.setPrototypeOf(t,n.prototype);t.name="GraphMapillaryError";return t}return n}(n.MapillaryError);r.GraphMapillaryError=o;r.default=o},{"./MapillaryError":407}],407:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var n=function(r){i(n,r);function n(e){var t=r.call(this,e)||this;Object.setPrototypeOf(t,n.prototype);t.name="MapillaryError";return t}return n}(Error);r.MapillaryError=n;r.default=n},{}],408:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("three");var i=function(){function t(e){if(e!=null){this._position=(new n.Vector3).fromArray(e.unprojectSfM([0,0],0));this._lookat=(new n.Vector3).fromArray(e.unprojectSfM([0,0],10));this._up=e.upVector();this._focal=this._getFocal(e)}else{this._position=new n.Vector3(0,0,0);this._lookat=new n.Vector3(0,0,1);this._up=new n.Vector3(0,-1,0);this._focal=1}}Object.defineProperty(t.prototype,"position",{get:function(){return this._position},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"lookat",{get:function(){return this._lookat},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"up",{get:function(){return this._up},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"focal",{get:function(){return this._focal},set:function(e){this._focal=e},enumerable:true,configurable:true});t.prototype.lerpCameras=function(e,t,r){this._position.subVectors(t.position,e.position).multiplyScalar(r).add(e.position);this._lookat.subVectors(t.lookat,e.lookat).multiplyScalar(r).add(e.lookat);this._up.subVectors(t.up,e.up).multiplyScalar(r).add(e.up);this._focal=(1-r)*e.focal+r*t.focal};t.prototype.copy=function(e){this._position.copy(e.position);this._lookat.copy(e.lookat);this._up.copy(e.up);this._focal=e.focal};t.prototype.clone=function(){var e=new t;e.position.copy(this._position);e.lookat.copy(this._lookat);e.up.copy(this._up);e.focal=this._focal;return e};t.prototype.diff=function(e){var t=this._position.distanceToSquared(e.position);var r=this._lookat.distanceToSquared(e.lookat);var n=this._up.distanceToSquared(e.up);var i=100*Math.abs(this._focal-e.focal);return Math.max(t,r,n,i)};t.prototype._getFocal=function(e){if(e.gpano==null){return e.focal}var t=Math.PI*e.gpano.CroppedAreaImageHeightPixels/e.gpano.FullPanoHeightPixels;var r=.5/Math.tan(t/2);return Math.min(1/(2*(Math.sqrt(2)-1)),Math.max(.5,r))};return t}();r.Camera=i},{three:242}],409:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var p=e("three");var n=e("../Geo");var a=new n.GeoCoords;var s=new n.Spatial;function i(e,t,r){var n=a.geodeticToEnu(e.lat,e.lon,e.alt,r.lat,r.lon,r.alt);var i=s.rotate(n,t);var o=[-i.x,-i.y,-i.z];return o}r.computeTranslation=i;function o(n,e,t,r,i){var o=[];for(var a=0;a<e.length;++a){var s=e[a];var u=t[a];for(var c=0;c<=r;++c){o.push([s[0]+u[0]*c/r,s[1]+u[1]*c/r])}}var h=new p.Camera;h.up.copy(n.upVector());h.position.copy((new p.Vector3).fromArray(n.unprojectSfM([0,0],0)));h.lookAt((new p.Vector3).fromArray(n.unprojectSfM([0,0],10)));h.updateMatrix();h.updateMatrixWorld(true);var l=o.map(function(e){var t=n.unprojectBasic(e,1e4);var r=i.worldToCamera(t,h);return[Math.abs(r[0]/r[2]),Math.abs(r[1]/r[2])]});return l}r.computeProjectedPoints=o},{"../Geo":294,three:242}],410:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(){this._wgs84a=6378137;this._wgs84b=6356752.31424518}e.prototype.geodeticToEnu=function(e,t,r,n,i,o){var a=this.geodeticToEcef(e,t,r);return this.ecefToEnu(a[0],a[1],a[2],n,i,o)};e.prototype.enuToGeodetic=function(e,t,r,n,i,o){var a=this.enuToEcef(e,t,r,n,i,o);return this.ecefToGeodetic(a[0],a[1],a[2])};e.prototype.ecefToEnu=function(e,t,r,n,i,o){var a=this.geodeticToEcef(n,i,o);var s=[e-a[0],t-a[1],r-a[2]];n=n*Math.PI/180;i=i*Math.PI/180;var u=Math.cos(n);var c=Math.sin(n);var h=Math.cos(i);var l=Math.sin(i);var p=-l*s[0]+h*s[1];var f=-c*h*s[0]-c*l*s[1]+u*s[2];var d=u*h*s[0]+u*l*s[1]+c*s[2];return[p,f,d]};e.prototype.enuToEcef=function(e,t,r,n,i,o){var a=this.geodeticToEcef(n,i,o);n=n*Math.PI/180;i=i*Math.PI/180;var s=Math.cos(n);var u=Math.sin(n);var c=Math.cos(i);var h=Math.sin(i);var l=-h*e-u*c*t+s*c*r+a[0];var p=c*e-u*h*t+s*h*r+a[1];var f=s*t+u*r+a[2];return[l,p,f]};e.prototype.geodeticToEcef=function(e,t,r){var n=this._wgs84a;var i=this._wgs84b;e=e*Math.PI/180;t=t*Math.PI/180;var o=Math.cos(e);var a=Math.sin(e);var s=Math.cos(t);var u=Math.sin(t);var c=n*n;var h=i*i;var l=1/Math.sqrt(c*o*o+h*a*a);var p=(c*l+r)*o;var f=p*s;var d=p*u;var v=(h*l+r)*a;return[f,d,v]};e.prototype.ecefToGeodetic=function(e,t,r){var n=this._wgs84a;var i=this._wgs84b;var o=n*n;var a=i*i;var s=o-a;var u=Math.sqrt(s/o);var c=Math.sqrt(s/a);var h=Math.sqrt(e*e+t*t);var l=Math.atan2(r*n,h*i);var p=Math.sin(l);var f=Math.cos(l);var d=Math.atan2(t,e);var v=Math.atan2(r+c*c*i*p*p*p,h-u*u*n*f*f*f);var m=Math.sin(v);var g=Math.cos(v);var _=n/Math.sqrt(1-u*u*m*m);var y=h/g-_;return[v*180/Math.PI,d*180/Math.PI,y]};return e}();r.GeoCoords=n;r.default=n},{}],411:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function i(e){return e>0?1:e<0?-1:0}function a(e,t){return e.x<=Math.max(t.p1.x,t.p2.x)&&e.x>=Math.min(t.p1.x,t.p2.x)&&e.y>=Math.max(t.p1.y,t.p2.y)&&e.y>=Math.min(t.p1.y,t.p2.y)}function f(e,t){var r=e.p2.x-e.p1.x;var n=e.p2.y-e.p1.y;var i=t.p2.x-t.p1.x;var o=t.p2.y-t.p1.y;var a=r*o-n*i;var s=r*r+n*n;var u=i*i+o*o;var c=1e-10;return a*a<c*s*u}function s(e,t,r){var n=(t.y-e.y)*(r.x-t.x)-(r.y-t.y)*(t.x-e.x);return i(n)}function n(e,t){if(f(e,t)){return false}var r=s(e.p1,e.p2,t.p1);var n=s(e.p1,e.p2,t.p2);var i=s(t.p1,t.p2,e.p1);var o=s(t.p1,t.p2,e.p2);if(r!==n&&i!==o){return true}if(r===0&&a(t.p1,e)){return true}if(n===0&&a(t.p2,e)){return true}if(i===0&&a(e.p1,t)){return true}if(o===0&&a(e.p2,t)){return true}return false}r.segmentsIntersect=n;function o(e,t){if(f(e,t)){return undefined}var r=e.p1.x;var n=e.p2.x;var i=e.p1.y;var o=e.p2.y;var a=t.p1.x;var s=t.p2.x;var u=t.p1.y;var c=t.p2.y;var h=(r-n)*(u-c)-(i-o)*(a-s);var l=(r*o-i*n)*(a-s)-(r-n)*(a*c-u*s);var p=(r*o-i*n)*(u-c)-(i-o)*(a*c-u*s);return{x:l/h,y:p/h}}r.segmentIntersection=o},{}],412:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var a=e("three");var n=function(){function e(){this._epsilon=1e-9}e.prototype.azimuthalToBearing=function(e){return-e+Math.PI/2};e.prototype.degToRad=function(e){return Math.PI*e/180};e.prototype.radToDeg=function(e){return 180*e/Math.PI};e.prototype.rotationMatrix=function(e){var t=new a.Vector3(e[0],e[1],e[2]);var r=t.length();if(r>0){t.normalize()}return(new a.Matrix4).makeRotationAxis(t,r)};e.prototype.rotate=function(e,t){var r=new a.Vector3(e[0],e[1],e[2]);var n=this.rotationMatrix(t);r.applyMatrix4(n);return r};e.prototype.opticalCenter=function(e,t){var r=[-e[0],-e[1],-e[2]];var n=[-t[0],-t[1],-t[2]];return this.rotate(n,r)};e.prototype.viewingDirection=function(e){var t=[-e[0],-e[1],-e[2]];return this.rotate([0,0,1],t)};e.prototype.wrap=function(e,t,r){if(r<t){throw new Error("Invalid arguments: max must be larger than min.")}var n=r-t;while(e>r||e<t){if(e>r){e=e-n}else if(e<t){e=e+n}}return e};e.prototype.wrapAngle=function(e){return this.wrap(e,-Math.PI,Math.PI)};e.prototype.clamp=function(e,t,r){if(e<t){return t}if(e>r){return r}return e};e.prototype.angleBetweenVector2=function(e,t,r,n){var i=Math.atan2(n,r)-Math.atan2(t,e);return this.wrapAngle(i)};e.prototype.angleDifference=function(e,t){var r=t-e;return this.wrapAngle(r)};e.prototype.relativeRotationAngle=function(e,t){var r=this.rotationMatrix([-e[0],-e[1],-e[2]]);var n=this.rotationMatrix(t);var i=r.multiply(n);var o=i.elements;var a=o[0]+o[5]+o[10];var s=Math.acos(Math.max(Math.min((a-1)/2,1),-1));return s};e.prototype.angleToPlane=function(e,t){var r=(new a.Vector3).fromArray(e);var n=r.length();if(n<this._epsilon){return 0}var i=r.dot((new a.Vector3).fromArray(t));return Math.asin(i/n)};e.prototype.azimuthal=function(e,t){var r=(new a.Vector3).fromArray(e);var n=(new a.Vector3).fromArray(t);var i=r.clone().dot(n);var o=r.clone().sub(n.clone().multiplyScalar(i));return Math.atan2(o.y,o.x)};e.prototype.distanceFromLatLon=function(e,t,r,n){var i=6371e3;var o=this.degToRad(r-e);var a=this.degToRad(n-t);var s=Math.sin(o/2)*Math.sin(o/2)+Math.cos(this.degToRad(e))*Math.cos(this.degToRad(r))*Math.sin(a/2)*Math.sin(a/2);var u=2*i*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return u};return e}();r.Spatial=n;r.default=n},{three:242}],413:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var b=e("three");var n=function(){function e(e,t,r,n,i,o,a,s,u,c,h,l,p){this._orientation=this._getValue(e,1);var f=u!=null?u.width:4;var d=u!=null?u.height:3;var v=this._orientation<5;this._width=this._getValue(t,v?f:d);this._height=this._getValue(r,v?d:f);this._basicAspect=v?this._width/this._height:this._height/this._width;this._basicWidth=v?t:r;this._basicHeight=v?r:t;this._focal=this._getValue(n,1);this._scale=this._getValue(i,0);this._gpano=o!=null?o:null;this._rt=this._getRt(a,s);this._srt=this._getSrt(this._rt,this._scale);this._basicRt=this._getBasicRt(this._rt,e);this._textureScale=!!c?c:[1,1];this._ck1=!!h?h:0;this._ck2=!!l?l:0;this._cameraProjection=!!p?p:!!o?"equirectangular":"perspective";this._radialPeak=this._getRadialPeak(this._ck1,this._ck2)}Object.defineProperty(e.prototype,"ck1",{get:function(){return this._ck1},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"ck2",{get:function(){return this._ck2},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"cameraProjection",{get:function(){return this._cameraProjection},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"basicAspect",{get:function(){return this._basicAspect},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"basicHeight",{get:function(){return this._basicHeight},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"basicRt",{get:function(){return this._basicRt},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"basicWidth",{get:function(){return this._basicWidth},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"focal",{get:function(){return this._focal},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"fullPano",{get:function(){return this._gpano!=null&&this._gpano.CroppedAreaLeftPixels===0&&this._gpano.CroppedAreaTopPixels===0&&this._gpano.CroppedAreaImageWidthPixels===this._gpano.FullPanoWidthPixels&&this._gpano.CroppedAreaImageHeightPixels===this._gpano.FullPanoHeightPixels},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"gpano",{get:function(){return this._gpano},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"orientation",{get:function(){return this._orientation},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"rt",{get:function(){return this._rt},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"srt",{get:function(){return this._srt},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"hasValidScale",{get:function(){return this._scale>.01&&this._scale<50},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"radialPeak",{get:function(){return this._radialPeak},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:true,configurable:true});e.prototype.upVector=function(){var e=this._rt.elements;switch(this._orientation){case 1:return new b.Vector3(-e[1],-e[5],-e[9]);case 3:return new b.Vector3(e[1],e[5],e[9]);case 6:return new b.Vector3(-e[0],-e[4],-e[8]);case 8:return new b.Vector3(e[0],e[4],e[8]);default:return new b.Vector3(-e[1],-e[5],-e[9])}};e.prototype.projectorMatrix=function(){var e=this._normalizedToTextureMatrix();var t=this._focal;var r=(new b.Matrix4).set(t,0,0,0,0,t,0,0,0,0,0,0,0,0,1,0);e.multiply(r);e.multiply(this._rt);return e};e.prototype.projectBasic=function(e){var t=this.projectSfM(e);return this._sfmToBasic(t)};e.prototype.unprojectBasic=function(e,t,r){var n=this._basicToSfm(e);return this.unprojectSfM(n,t,r)};e.prototype.projectSfM=function(e){var t=new b.Vector4(e[0],e[1],e[2],1);t.applyMatrix4(this._rt);return this._bearingToSfm([t.x,t.y,t.z])};e.prototype.unprojectSfM=function(e,t,r){var n=this._sfmToBearing(e);var i=r&&!this.gpano?new b.Vector4(t*n[0]/n[2],t*n[1]/n[2],t,1):new b.Vector4(t*n[0],t*n[1],t*n[2],1);i.applyMatrix4((new b.Matrix4).getInverse(this._rt));return[i.x/i.w,i.y/i.w,i.z/i.w]};e.prototype._sfmToBearing=function(e){if(this._fullPano()){var t=e[0]*2*Math.PI;var r=-e[1]*2*Math.PI;var n=Math.cos(r)*Math.sin(t);var i=-Math.sin(r);var o=Math.cos(r)*Math.cos(t);return[n,i,o]}else if(this._gpano){var a=Math.max(this.gpano.CroppedAreaImageWidthPixels,this.gpano.CroppedAreaImageHeightPixels);var s=[e[0]*a+this.gpano.CroppedAreaImageWidthPixels/2+this.gpano.CroppedAreaLeftPixels,e[1]*a+this.gpano.CroppedAreaImageHeightPixels/2+this.gpano.CroppedAreaTopPixels];var t=2*Math.PI*(s[0]/this.gpano.FullPanoWidthPixels-.5);var r=-Math.PI*(s[1]/this.gpano.FullPanoHeightPixels-.5);var n=Math.cos(r)*Math.sin(t);var i=-Math.sin(r);var o=Math.cos(r)*Math.cos(t);return[n,i,o]}else if(this._cameraProjection==="fisheye"){var u=[e[0]/this._focal,e[1]/this._focal],c=u[0],h=u[1];var l=Math.sqrt(c*c+h*h);var p=this._distortionFromDistortedRadius(l,this._ck1,this._ck2,this._radialPeak);var f=l/p;var o=Math.cos(f);var d=Math.sin(f);var n=d*c/l;var i=d*h/l;return[n,i,o]}else{var v=[e[0]/this._focal,e[1]/this._focal],c=v[0],h=v[1];var m=Math.sqrt(c*c+h*h);var p=this._distortionFromDistortedRadius(m,this._ck1,this._ck2,this._radialPeak);var g=c/p;var _=h/p;var y=new b.Vector3(g,_,1);y.normalize();return[y.x,y.y,y.z]}};e.prototype._distortionFromDistortedRadius=function(e,t,r,n){var i=1;for(var o=0;o<10;o++){var a=e/i;if(a>n){a=n}i=1+t*Math.pow(a,2)+r*Math.pow(a,4)}return i};e.prototype._bearingToSfm=function(e){if(this._fullPano()){var t=e[0];var r=e[1];var n=e[2];var i=Math.atan2(t,n);var o=Math.atan2(-r,Math.sqrt(t*t+n*n));return[i/(2*Math.PI),-o/(2*Math.PI)]}else if(this._gpano){var t=e[0];var r=e[1];var n=e[2];var i=Math.atan2(t,n);var o=Math.atan2(-r,Math.sqrt(t*t+n*n));var a=[(i/(2*Math.PI)+.5)*this.gpano.FullPanoWidthPixels,(-o/Math.PI+.5)*this.gpano.FullPanoHeightPixels];var s=Math.max(this.gpano.CroppedAreaImageWidthPixels,this.gpano.CroppedAreaImageHeightPixels);return[(a[0]-this.gpano.CroppedAreaLeftPixels-this.gpano.CroppedAreaImageWidthPixels/2)/s,(a[1]-this.gpano.CroppedAreaTopPixels-this.gpano.CroppedAreaImageHeightPixels/2)/s]}else if(this._cameraProjection==="fisheye"){if(e[2]>0){var t=e[0],r=e[1],n=e[2];var u=Math.sqrt(t*t+r*r);var c=Math.atan2(u,n);if(c>this._radialPeak){c=this._radialPeak}var h=1+Math.pow(c,2)*(this._ck1+Math.pow(c,2)*this._ck2);var l=this._focal*h*c/u;return[l*t,l*r]}else{return[e[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,e[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}}else{if(e[2]>0){var p=[e[0]/e[2],e[1]/e[2]],f=p[0],d=p[1];var v=f*f+d*d;var m=Math.pow(this._radialPeak,2);if(v>m){v=m}var g=1+this._ck1*v+this._ck2*Math.pow(v,2);return[this._focal*g*f,this._focal*g*d]}else{return[e[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,e[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}}};e.prototype._basicToSfm=function(e){var t;var r;switch(this._orientation){case 1:t=e[0];r=e[1];break;case 3:t=1-e[0];r=1-e[1];break;case 6:t=e[1];r=1-e[0];break;case 8:t=1-e[1];r=e[0];break;default:t=e[0];r=e[1];break}var n=this._width;var i=this._height;var o=Math.max(n,i);var a=t*n/o-n/o/2;var s=r*i/o-i/o/2;return[a,s]};e.prototype._sfmToBasic=function(e){var t=this._width;var r=this._height;var n=Math.max(t,r);var i=(e[0]+t/n/2)/t*n;var o=(e[1]+r/n/2)/r*n;var a;var s;switch(this._orientation){case 1:a=i;s=o;break;case 3:a=1-i;s=1-o;break;case 6:a=1-o;s=i;break;case 8:a=o;s=1-i;break;default:a=i;s=o;break}return[a,s]};e.prototype._fullPano=function(){return this.gpano!=null&&this.gpano.CroppedAreaLeftPixels===0&&this.gpano.CroppedAreaTopPixels===0&&this.gpano.CroppedAreaImageWidthPixels===this.gpano.FullPanoWidthPixels&&this.gpano.CroppedAreaImageHeightPixels===this.gpano.FullPanoHeightPixels};e.prototype._getValue=function(e,t){return e!=null&&e>0?e:t};e.prototype._getRt=function(e,t){var r=new b.Vector3(e[0],e[1],e[2]);var n=r.length();if(n>0){r.normalize()}var i=new b.Matrix4;i.makeRotationAxis(r,n);i.setPosition(new b.Vector3(t[0],t[1],t[2]));return i};e.prototype._getSrt=function(e,t){var r=e.clone();var n=r.elements;n[12]=t*n[12];n[13]=t*n[13];n[14]=t*n[14];r.scale(new b.Vector3(t,t,t));return r};e.prototype._getBasicRt=function(e,t){var r=new b.Vector3(0,0,1);var n=0;switch(t){case 3:n=Math.PI;break;case 6:n=Math.PI/2;break;case 8:n=3*Math.PI/2;break;default:break}return(new b.Matrix4).makeRotationAxis(r,n).multiply(e)};e.prototype._getRadialPeak=function(e,t){var r=5*t;var n=3*e;var i=1;var o=Math.pow(n,2)-4*r*i;if(o<0){return undefined}var a=(-n-Math.sqrt(o))/2/r;var s=(-n+Math.sqrt(o))/2/r;var u=Math.min(a,s);var c=Math.max(a,s);return u>0?Math.sqrt(u):c>0?Math.sqrt(c):undefined};e.prototype._normalizedToTextureMatrix=function(){var e=Math.max(this._width,this._height);var t=this._orientation<5?this._textureScale[0]:this._textureScale[1];var r=this._orientation<5?this._textureScale[1]:this._textureScale[0];var n=e/this._width*t;var i=e/this._height*r;switch(this._orientation){case 1:return(new b.Matrix4).set(n,0,0,.5,0,-i,0,.5,0,0,1,0,0,0,0,1);case 3:return(new b.Matrix4).set(-n,0,0,.5,0,i,0,.5,0,0,1,0,0,0,0,1);case 6:return(new b.Matrix4).set(0,-i,0,.5,-n,0,0,.5,0,0,1,0,0,0,0,1);case 8:return(new b.Matrix4).set(0,i,0,.5,n,0,0,.5,0,0,1,0,0,0,0,1);default:return(new b.Matrix4).set(n,0,0,.5,0,-i,0,.5,0,0,1,0,0,0,0,1)}};return e}();r.Transform=n},{three:242}],414:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var a=e("three");var n=function(){function e(){this._unprojectDepth=200}e.prototype.basicToCanvas=function(e,t,r,n,i){var o=n.unprojectBasic([e,t],this._unprojectDepth);var a=this.projectToCanvas(o,r,i);return a};e.prototype.basicToCanvasSafe=function(e,t,r,n,i){var o=this.basicToViewportSafe(e,t,n,i);if(o===null){return null}var a=this.viewportToCanvas(o[0],o[1],r);return a};e.prototype.basicToViewport=function(e,t,r,n){var i=r.unprojectBasic([e,t],this._unprojectDepth);var o=this.projectToViewport(i,n);return o};e.prototype.basicToViewportSafe=function(e,t,r,n){var i=r.unprojectBasic([e,t],this._unprojectDepth);var o=this.worldToCamera(i,n);if(o[2]>0){return null}var a=this.projectToViewport(i,n);return a};e.prototype.cameraToViewport=function(e,t){var r=(new a.Vector3).fromArray(e).applyMatrix4(t.projectionMatrix);return[r.x,r.y]};e.prototype.canvasPosition=function(e,t){var r=t.getBoundingClientRect();var n=e.clientX-r.left-t.clientLeft;var i=e.clientY-r.top-t.clientTop;return[n,i]};e.prototype.canvasToBasic=function(e,t,r,n,i){var o=this.unprojectFromCanvas(e,t,r,i).toArray();var a=n.projectBasic(o);return a};e.prototype.canvasToViewport=function(e,t,r){var n=this.containerToCanvas(r),i=n[0],o=n[1];var a=2*e/i-1;var s=1-2*t/o;return[a,s]};e.prototype.containerToCanvas=function(e){return[e.offsetWidth,e.offsetHeight]};e.prototype.getBasicDistances=function(e,t){var r=this.viewportToBasic(-1,1,e,t);var n=this.viewportToBasic(1,1,e,t);var i=this.viewportToBasic(1,-1,e,t);var o=this.viewportToBasic(-1,-1,e,t);var a=0;var s=0;var u=0;var c=0;if(r[1]<0&&n[1]<0){a=r[1]>n[1]?-r[1]:-n[1]}if(n[0]>1&&i[0]>1){s=n[0]<i[0]?n[0]-1:i[0]-1}if(i[1]>1&&o[1]>1){u=i[1]<o[1]?i[1]-1:o[1]-1}if(o[0]<0&&r[0]<0){c=o[0]>r[0]?-o[0]:-r[0]}return[a,s,u,c]};e.prototype.getPixelDistances=function(e,t,r){var n=this.viewportToBasic(-1,1,t,r);var i=this.viewportToBasic(1,1,t,r);var o=this.viewportToBasic(1,-1,t,r);var a=this.viewportToBasic(-1,-1,t,r);var s=0;var u=0;var c=0;var h=0;var l=this.containerToCanvas(e),p=l[0],f=l[1];if(n[1]<0&&i[1]<0){var d=n[1]>i[1]?n[0]:i[0];var v=this.basicToCanvas(d,0,e,t,r);s=v[1]>0?v[1]:0}if(i[0]>1&&o[0]>1){var m=i[0]<o[0]?i[1]:o[1];var v=this.basicToCanvas(1,m,e,t,r);u=v[0]<p?p-v[0]:0}if(o[1]>1&&a[1]>1){var d=o[1]<a[1]?o[0]:a[0];var v=this.basicToCanvas(d,1,e,t,r);c=v[1]<f?f-v[1]:0}if(a[0]<0&&n[0]<0){var m=a[0]>n[0]?a[1]:n[1];var v=this.basicToCanvas(0,m,e,t,r);h=v[0]>0?v[0]:0}return[s,u,c,h]};e.prototype.insideElement=function(e,t){var r=t.getBoundingClientRect();var n=r.left+t.clientLeft;var i=n+t.clientWidth;var o=r.top+t.clientTop;var a=o+t.clientHeight;return e.clientX>n&&e.clientX<i&&e.clientY>o&&e.clientY<a};e.prototype.projectToCanvas=function(e,t,r){var n=this.projectToViewport(e,r);var i=this.viewportToCanvas(n[0],n[1],t);return i};e.prototype.projectToCanvasSafe=function(e,t,r){var n=this.worldToCamera(e,r);if(n[2]>0){return null}var i=this.projectToViewport(e,r);var o=this.viewportToCanvas(i[0],i[1],t);return o};e.prototype.projectToViewport=function(e,t){var r=new a.Vector3(e[0],e[1],e[2]).project(t);return[r.x,r.y]};e.prototype.unprojectFromCanvas=function(e,t,r,n){var i=this.canvasToViewport(e,t,r);var o=this.unprojectFromViewport(i[0],i[1],n);return o};e.prototype.unprojectFromViewport=function(e,t,r){var n=new a.Vector3(e,t,1).unproject(r);return n};e.prototype.viewportToBasic=function(e,t,r,n){var i=new a.Vector3(e,t,1).unproject(n).toArray();var o=r.projectBasic(i);return o};e.prototype.viewportToCanvas=function(e,t,r){var n=this.containerToCanvas(r),i=n[0],o=n[1];var a=i*(e+1)/2;var s=-o*(t-1)/2;return[a,s]};e.prototype.worldToCamera=function(e,t){var r=new a.Vector3(e[0],e[1],e[2]).applyMatrix4(t.matrixWorldInverse);return r.toArray()};return e}();r.ViewportCoords=n;r.default=n},{three:242}],415:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(){}e.prototype.createFilter=function(e){return new Function("node","return "+this._compile(e)+";")};e.prototype._compile=function(e){if(e==null||e.length<=1){return"true"}var t=e[0];var r=t==="=="?this._compileComparisonOp("===",e[1],e[2],false):t==="!="?this._compileComparisonOp("!==",e[1],e[2],false):t===">"||t===">="||t==="<"||t==="<="?this._compileComparisonOp(t,e[1],e[2],true):t==="in"?this._compileInOp(e[1],e.slice(2)):t==="!in"?this._compileNegation(this._compileInOp(e[1],e.slice(2))):t==="all"?this._compileLogicalOp(e.slice(1),"&&"):"true";return"("+r+")"};e.prototype._compare=function(e,t){return e<t?-1:e>t?1:0};e.prototype._compileComparisonOp=function(e,t,r,n){var i=this._compilePropertyReference(t);var o=JSON.stringify(r);return(n?"typeof "+i+"===typeof "+o+"&&":"")+i+e+o};e.prototype._compileInOp=function(e,t){var r=this._compare;var n=JSON.stringify(t.sort(r));var i=this._compilePropertyReference(e);return n+".indexOf("+i+")!==-1"};e.prototype._compileLogicalOp=function(e,t){var r=this._compile.bind(this);return e.map(r).join(t)};e.prototype._compileNegation=function(e){return"!("+e+")"};e.prototype._compilePropertyReference=function(e){return"node["+JSON.stringify(e)+"]"};return e}();r.FilterCreator=n;r.default=n},{}],416:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var d=e("rxjs");var v=e("rxjs/operators");var a=e("rbush");var s=e("../Edge");var f=e("../Error");var p=e("../Graph");var n=function(){function e(e,t,r,n,i,o){this._apiV3=e;this._cachedNodes={};this._cachedNodeTiles={};this._cachedSequenceNodes={};this._cachedSpatialEdges={};this._cachedTiles={};this._cachingFill$={};this._cachingFull$={};this._cachingSequenceNodes$={};this._cachingSequences$={};this._cachingSpatialArea$={};this._cachingTiles$={};this._changed$=new d.Subject;this._defaultAlt=2;this._edgeCalculator=n!=null?n:new s.EdgeCalculator;this._filterCreator=i!=null?i:new p.FilterCreator;this._filter=this._filterCreator.createFilter(undefined);this._graphCalculator=r!=null?r:new p.GraphCalculator;this._configuration=o!=null?o:{maxSequences:50,maxUnusedNodes:100,maxUnusedPreStoredNodes:30,maxUnusedTiles:20};this._nodes={};this._nodeIndex=t!=null?t:a(16,[".lat",".lon",".lat",".lon"]);this._nodeIndexTiles={};this._nodeToTile={};this._preStored={};this._requiredNodeTiles={};this._requiredSpatialArea={};this._sequences={};this._tilePrecision=7;this._tileThreshold=20}Object.defineProperty(e.prototype,"changed$",{get:function(){return this._changed$},enumerable:true,configurable:true});e.prototype.cacheBoundingBox$=function(l,p){var f=this;var e=this._graphCalculator.encodeHsFromBoundingBox(l,p).filter(function(e){return!(e in f._cachedTiles)}).map(function(e){return e in f._cachingTiles$?f._cachingTiles$[e]:f._cacheTile$(e)});if(e.length===0){e.push(d.of(this))}return d.from(e).pipe(v.mergeAll(),v.last(),v.mergeMap(function(e){var t=f._nodeIndex.search({maxX:p.lat,maxY:p.lon,minX:l.lat,minY:l.lon}).map(function(e){return e.node});var r=[];var n=[];for(var i=0,o=t;i<o.length;i++){var a=o[i];if(a.full){r.push(a)}else{n.push(a.key)}}var s=[];var u=200;while(n.length>0){s.push(n.splice(0,u))}var c=d.of(r);var h=s.map(function(e){return f._apiV3.imageByKeyFill$(e).pipe(v.map(function(e){var t=[];for(var r in e){if(!e.hasOwnProperty(r)){continue}if(f.hasNode(r)){var n=f.getNode(r);if(!n.full){f._makeFull(n,e[r])}t.push(n)}}return t}))});return d.merge(c,d.from(h).pipe(v.mergeAll()))}),v.reduce(function(e,t){return e.concat(t)}))};e.prototype.cacheFill$=function(t){var r=this;if(t in this._cachingFull$){throw new f.GraphMapillaryError("Cannot fill node while caching full ("+t+").")}if(!this.hasNode(t)){throw new f.GraphMapillaryError("Cannot fill node that does not exist in graph ("+t+").")}if(t in this._cachingFill$){return this._cachingFill$[t]}var n=this.getNode(t);if(n.full){throw new f.GraphMapillaryError("Cannot fill node that is already full ("+t+").")}this._cachingFill$[t]=this._apiV3.imageByKeyFill$([t]).pipe(v.tap(function(e){if(!n.full){r._makeFull(n,e[t])}delete r._cachingFill$[t]}),v.map(function(e){return r}),v.finalize(function(){if(t in r._cachingFill$){delete r._cachingFill$[t]}r._changed$.next(r)}),v.publish(),v.refCount());return this._cachingFill$[t]};e.prototype.cacheFull$=function(i){var o=this;if(i in this._cachingFull$){return this._cachingFull$[i]}if(this.hasNode(i)){throw new f.GraphMapillaryError("Cannot cache full node that already exist in graph ("+i+").")}this._cachingFull$[i]=this._apiV3.imageByKeyFull$([i]).pipe(v.tap(function(e){var t=e[i];if(o.hasNode(i)){var r=o.getNode(i);if(!r.full){o._makeFull(r,t)}}else{if(t.sequence_key==null){throw new f.GraphMapillaryError("Node has no sequence key ("+i+").")}var r=new p.Node(t);o._makeFull(r,t);var n=o._graphCalculator.encodeH(r.originalLatLon,o._tilePrecision);o._preStore(n,r);o._setNode(r);delete o._cachingFull$[i]}}),v.map(function(e){return o}),v.finalize(function(){if(i in o._cachingFull$){delete o._cachingFull$[i]}o._changed$.next(o)}),v.publish(),v.refCount());return this._cachingFull$[i]};e.prototype.cacheNodeSequence$=function(e){if(!this.hasNode(e)){throw new f.GraphMapillaryError("Cannot cache sequence edges of node that does not exist in graph ("+e+").")}var t=this.getNode(e);if(t.sequenceKey in this._sequences){throw new f.GraphMapillaryError("Sequence already cached ("+e+"), ("+t.sequenceKey+").")}return this._cacheSequence$(t.sequenceKey)};e.prototype.cacheSequence$=function(e){if(e in this._sequences){throw new f.GraphMapillaryError("Sequence already cached ("+e+")")}return this._cacheSequence$(e)};e.prototype.cacheSequenceEdges=function(e){var t=this.getNode(e);if(!(t.sequenceKey in this._sequences)){throw new f.GraphMapillaryError("Sequence is not cached ("+e+"), ("+t.sequenceKey+")")}var r=this._sequences[t.sequenceKey].sequence;var n=this._edgeCalculator.computeSequenceEdges(t,r);t.cacheSequenceEdges(n)};e.prototype.cacheSequenceNodes$=function(e,t){var o=this;if(!this.hasSequence(e)){throw new f.GraphMapillaryError("Cannot cache sequence nodes of sequence that does not exist in graph ("+e+").")}if(this.hasSequenceNodes(e)){throw new f.GraphMapillaryError("Sequence nodes already cached ("+e+").")}var r=this.getSequence(e);if(r.key in this._cachingSequenceNodes$){return this._cachingSequenceNodes$[r.key]}var n=[];var i=r.keys.slice();var a=50;if(!!t&&i.length>a){var s=i.indexOf(t);var u=Math.max(0,Math.min(s-a/2,i.length-a));n.push(i.splice(u,a))}var c=200;while(i.length>0){n.push(i.splice(0,c))}var h=n.length;var l=d.from(n).pipe(v.mergeMap(function(e){return o._apiV3.imageByKeyFull$(e).pipe(v.tap(function(e){for(var t in e){if(!e.hasOwnProperty(t)){continue}var r=e[t];if(o.hasNode(t)){var n=o.getNode(r.key);if(!n.full){o._makeFull(n,r)}}else{if(r.sequence_key==null){console.warn("Sequence missing, discarding node ("+r.key+")")}var n=new p.Node(r);o._makeFull(n,r);var i=o._graphCalculator.encodeH(n.originalLatLon,o._tilePrecision);o._preStore(i,n);o._setNode(n)}}h--}),v.map(function(e){return o}))},6),v.last(),v.finalize(function(){delete o._cachingSequenceNodes$[r.key];if(h===0){o._cachedSequenceNodes[r.key]=true}}),v.publish(),v.refCount());this._cachingSequenceNodes$[r.key]=l;return l};e.prototype.cacheSpatialArea$=function(o){var a=this;if(!this.hasNode(o)){throw new f.GraphMapillaryError("Cannot cache spatial area of node that does not exist in graph ("+o+").")}if(o in this._cachedSpatialEdges){throw new f.GraphMapillaryError("Node already spatially cached ("+o+").")}if(!(o in this._requiredSpatialArea)){throw new f.GraphMapillaryError("Spatial area not determined ("+o+").")}var s=this._requiredSpatialArea[o];if(Object.keys(s.cacheNodes).length===0){throw new f.GraphMapillaryError("Spatial nodes already cached ("+o+").")}if(o in this._cachingSpatialArea$){return this._cachingSpatialArea$[o]}var e=[];while(s.cacheKeys.length>0){e.push(s.cacheKeys.splice(0,200))}var u=e.length;var t=[];var r=function(i){var e=n._apiV3.imageByKeyFill$(i).pipe(v.tap(function(e){for(var t in e){if(!e.hasOwnProperty(t)){continue}var r=s.cacheNodes[t];if(r.full){delete s.cacheNodes[t];continue}var n=e[t];a._makeFull(r,n);delete s.cacheNodes[t]}if(--u===0){delete a._cachingSpatialArea$[o]}}),v.map(function(e){return a}),v.catchError(function(e){for(var t=0,r=i;t<r.length;t++){var n=r[t];if(n in s.all){delete s.all[n]}if(n in s.cacheNodes){delete s.cacheNodes[n]}}if(--u===0){delete a._cachingSpatialArea$[o]}throw e}),v.finalize(function(){if(Object.keys(s.cacheNodes).length===0){a._changed$.next(a)}}),v.publish(),v.refCount());t.push(e)};var n=this;for(var i=0,c=e;i<c.length;i++){var h=c[i];r(h)}this._cachingSpatialArea$[o]=t;return t};e.prototype.cacheSpatialEdges=function(e){if(e in this._cachedSpatialEdges){throw new f.GraphMapillaryError("Spatial edges already cached ("+e+").")}var t=this.getNode(e);var r=this._sequences[t.sequenceKey].sequence;var n=[];var i=r.findPrevKey(t.key);if(i!=null){n.push(i)}var o=r.findNextKey(t.key);if(o!=null){n.push(o)}var a=this._requiredSpatialArea[e].all;var s=[];var u=this._filter;for(var c in a){if(!a.hasOwnProperty(c)){continue}var h=a[c];if(u(h)){s.push(h)}}var l=this._edgeCalculator.getPotentialEdges(t,s,n);var p=this._edgeCalculator.computeStepEdges(t,l,i,o);p=p.concat(this._edgeCalculator.computeTurnEdges(t,l));p=p.concat(this._edgeCalculator.computePanoEdges(t,l));p=p.concat(this._edgeCalculator.computePerspectiveToPanoEdges(t,l));p=p.concat(this._edgeCalculator.computeSimilarEdges(t,l));t.cacheSpatialEdges(p);this._cachedSpatialEdges[e]=t;delete this._requiredSpatialArea[e];delete this._cachedNodeTiles[e]};e.prototype.cacheTiles$=function(n){var i=this;if(n in this._cachedNodeTiles){throw new f.GraphMapillaryError("Tiles already cached ("+n+").")}if(n in this._cachedSpatialEdges){throw new f.GraphMapillaryError("Spatial edges already cached so tiles considered cached ("+n+").")}if(!(n in this._requiredNodeTiles)){throw new f.GraphMapillaryError("Tiles have not been determined ("+n+").")}var o=this._requiredNodeTiles[n];if(o.cache.length===0&&o.caching.length===0){throw new f.GraphMapillaryError("Tiles already cached ("+n+").")}if(!this.hasNode(n)){throw new f.GraphMapillaryError("Cannot cache tiles of node that does not exist in graph ("+n+").")}var e=o.cache.slice();o.caching=this._requiredNodeTiles[n].caching.concat(e);o.cache=[];var t=[];var r=function(r){var e=r in a._cachingTiles$?a._cachingTiles$[r]:a._cacheTile$(r);t.push(e.pipe(v.tap(function(e){var t=o.caching.indexOf(r);if(t>-1){o.caching.splice(t,1)}if(o.caching.length===0&&o.cache.length===0){delete i._requiredNodeTiles[n];i._cachedNodeTiles[n]=true}}),v.catchError(function(e){var t=o.caching.indexOf(r);if(t>-1){o.caching.splice(t,1)}if(o.caching.length===0&&o.cache.length===0){delete i._requiredNodeTiles[n];i._cachedNodeTiles[n]=true}throw e}),v.finalize(function(){i._changed$.next(i)}),v.publish(),v.refCount()))};var a=this;for(var s=0,u=o.caching;s<u.length;s++){var c=u[s];r(c)}return t};e.prototype.initializeCache=function(e){if(e in this._cachedNodes){throw new f.GraphMapillaryError("Node already in cache ("+e+").")}var t=this.getNode(e);t.initializeCache(new p.NodeCache);var r=(new Date).getTime();this._cachedNodes[e]={accessed:r,node:t};this._updateCachedTileAccess(e,r)};e.prototype.isCachingFill=function(e){return e in this._cachingFill$};e.prototype.isCachingFull=function(e){return e in this._cachingFull$};e.prototype.isCachingNodeSequence=function(e){var t=this.getNode(e);return t.sequenceKey in this._cachingSequences$};e.prototype.isCachingSequence=function(e){return e in this._cachingSequences$};e.prototype.isCachingSequenceNodes=function(e){return e in this._cachingSequenceNodes$};e.prototype.isCachingTiles=function(e){return e in this._requiredNodeTiles&&this._requiredNodeTiles[e].cache.length===0&&this._requiredNodeTiles[e].caching.length>0};e.prototype.hasInitializedCache=function(e){return e in this._cachedNodes};e.prototype.hasNode=function(e){var t=(new Date).getTime();this._updateCachedNodeAccess(e,t);this._updateCachedTileAccess(e,t);return e in this._nodes};e.prototype.hasNodeSequence=function(e){var t=this.getNode(e);var r=t.sequenceKey;var n=r in this._sequences;if(n){this._sequences[r].accessed=(new Date).getTime()}return n};e.prototype.hasSequence=function(e){var t=e in this._sequences;if(t){this._sequences[e].accessed=(new Date).getTime()}return t};e.prototype.hasSequenceNodes=function(e){return e in this._cachedSequenceNodes};e.prototype.hasSpatialArea=function(e){if(!this.hasNode(e)){throw new f.GraphMapillaryError("Spatial area nodes cannot be determined if node not in graph ("+e+").")}if(e in this._cachedSpatialEdges){return true}if(e in this._requiredSpatialArea){return Object.keys(this._requiredSpatialArea[e].cacheNodes).length===0}var t=this.getNode(e);var r=this._graphCalculator.boundingBoxCorners(t.latLon,this._tileThreshold);var n=this._nodeIndex.search({maxX:r[1].lat,maxY:r[1].lon,minX:r[0].lat,minY:r[0].lon});var i={all:{},cacheKeys:[],cacheNodes:{}};for(var o=0,a=n;o<a.length;o++){var s=a[o];i.all[s.node.key]=s.node;if(!s.node.full){i.cacheKeys.push(s.node.key);i.cacheNodes[s.node.key]=s.node}}this._requiredSpatialArea[e]=i;return i.cacheKeys.length===0};e.prototype.hasTiles=function(e){var t=this;if(e in this._cachedNodeTiles){return true}if(e in this._cachedSpatialEdges){return true}if(!this.hasNode(e)){throw new f.GraphMapillaryError("Node does not exist in graph ("+e+").")}var r={cache:[],caching:[]};if(!(e in this._requiredNodeTiles)){var n=this.getNode(e);r.cache=this._graphCalculator.encodeHs(n.latLon,this._tilePrecision,this._tileThreshold).filter(function(e){return!(e in t._cachedTiles)});if(r.cache.length>0){this._requiredNodeTiles[e]=r}}else{r=this._requiredNodeTiles[e]}return r.cache.length===0&&r.caching.length===0};e.prototype.getNode=function(e){var t=(new Date).getTime();this._updateCachedNodeAccess(e,t);this._updateCachedTileAccess(e,t);return this._nodes[e]};e.prototype.getSequence=function(e){var t=this._sequences[e];t.accessed=(new Date).getTime();return t.sequence};e.prototype.resetSpatialEdges=function(){var e=Object.keys(this._cachedSpatialEdges);for(var t=0,r=e;t<r.length;t++){var n=r[t];var i=this._cachedSpatialEdges[n];i.resetSpatialEdges();delete this._cachedSpatialEdges[n]}};e.prototype.reset=function(e){var t=[];for(var r=0,n=e;r<n.length;r++){var i=n[r];if(!this.hasNode(i)){throw new Error("Node does not exist "+i)}var o=this.getNode(i);o.resetSequenceEdges();o.resetSpatialEdges();t.push(o)}for(var a=0,s=Object.keys(this._cachedNodes);a<s.length;a++){var u=s[a];if(e.indexOf(u)!==-1){continue}this._cachedNodes[u].node.dispose();delete this._cachedNodes[u]}this._cachedNodeTiles={};this._cachedSpatialEdges={};this._cachedTiles={};this._cachingFill$={};this._cachingFull$={};this._cachingSequences$={};this._cachingSpatialArea$={};this._cachingTiles$={};this._nodes={};this._nodeToTile={};this._preStored={};for(var c=0,h=t;c<h.length;c++){var o=h[c];this._nodes[o.key]=o;var l=this._graphCalculator.encodeH(o.originalLatLon,this._tilePrecision);this._preStore(l,o)}this._requiredNodeTiles={};this._requiredSpatialArea={};this._sequences={};this._nodeIndexTiles={};this._nodeIndex.clear()};e.prototype.setFilter=function(e){this._filter=this._filterCreator.createFilter(e)};e.prototype.uncache=function(e,t){var r={};this._addNewKeys(r,this._cachingFull$);this._addNewKeys(r,this._cachingFill$);this._addNewKeys(r,this._cachingSpatialArea$);this._addNewKeys(r,this._requiredNodeTiles);this._addNewKeys(r,this._requiredSpatialArea);for(var n=0,i=e;n<i.length;n++){var o=i[n];if(o in r){continue}r[o]=true}var a={};for(var o in r){if(!r.hasOwnProperty(o)){continue}var s=this._nodes[o];var u=this._graphCalculator.encodeHs(s.latLon);for(var c=0,h=u;c<h.length;c++){var l=h[c];if(!(l in a)){a[l]=true}}}var p=[];for(var f in this._cachedTiles){if(!this._cachedTiles.hasOwnProperty(f)||f in a){continue}p.push([f,this._cachedTiles[f]])}var d=p.sort(function(e,t){return t[1].accessed-e[1].accessed}).slice(this._configuration.maxUnusedTiles).map(function(e){return e[0]});for(var v=0,m=d;v<m.length;v++){var g=m[v];this._uncacheTile(g,t)}var _=[];var y=[];for(var f in this._preStored){if(!this._preStored.hasOwnProperty(f)||f in this._cachingTiles$){continue}var b=this._preStored[f];for(var o in b){if(!b.hasOwnProperty(o)||o in r){continue}if(b[o].sequenceKey===t){continue}if(o in this._cachedNodes){_.push([this._cachedNodes[o],f])}else{y.push([o,f])}}}var w=_.sort(function(e,t){var r=e[0],n=e[1];var i=t[0],o=t[1];return i.accessed-r.accessed}).slice(this._configuration.maxUnusedPreStoredNodes).map(function(e){var t=e[0],r=e[1];return[t.node.key,r]});this._uncachePreStored(y);this._uncachePreStored(w);var x=[];for(var o in this._cachedNodes){if(!this._cachedNodes.hasOwnProperty(o)||o in r){continue}x.push(this._cachedNodes[o])}var S=x.sort(function(e,t){return t.accessed-e.accessed}).slice(this._configuration.maxUnusedNodes);for(var M=0,C=S;M<C.length;M++){var E=C[M];E.node.uncache();var o=E.node.key;delete this._cachedNodes[o];if(o in this._cachedNodeTiles){delete this._cachedNodeTiles[o]}if(o in this._cachedSpatialEdges){delete this._cachedSpatialEdges[o]}}var T=[];for(var O in this._sequences){if(!this._sequences.hasOwnProperty(O)||O in this._cachingSequences$||O===t){continue}T.push(this._sequences[O])}var P=T.sort(function(e,t){return t.accessed-e.accessed}).slice(this._configuration.maxSequences);for(var A=0,j=P;A<j.length;A++){var R=j[A];var O=R.sequence.key;delete this._sequences[O];if(O in this._cachedSequenceNodes){delete this._cachedSequenceNodes[O]}R.sequence.dispose()}};e.prototype._addNewKeys=function(e,t){for(var r in t){if(!t.hasOwnProperty(r)||!this.hasNode(r)){continue}if(!(r in e)){e[r]=true}}};e.prototype._cacheSequence$=function(t){var r=this;if(t in this._cachingSequences$){return this._cachingSequences$[t]}this._cachingSequences$[t]=this._apiV3.sequenceByKey$([t]).pipe(v.tap(function(e){if(!(t in r._sequences)){r._sequences[t]={accessed:(new Date).getTime(),sequence:new p.Sequence(e[t])}}delete r._cachingSequences$[t]}),v.map(function(e){return r}),v.finalize(function(){if(t in r._cachingSequences$){delete r._cachingSequences$[t]}r._changed$.next(r)}),v.publish(),v.refCount());return this._cachingSequences$[t]};e.prototype._cacheTile$=function(h){var l=this;this._cachingTiles$[h]=this._apiV3.imagesByH$([h]).pipe(v.tap(function(e){var t=e[h];if(h in l._cachedTiles){return}l._nodeIndexTiles[h]=[];l._cachedTiles[h]={accessed:(new Date).getTime(),nodes:[]};var r=l._cachedTiles[h].nodes;var n=l._removeFromPreStore(h);for(var i in t){if(!t.hasOwnProperty(i)){continue}var o=t[i];if(o==null){break}if(o.sequence_key==null){console.warn("Sequence missing, discarding node ("+o.key+")");continue}if(n!=null&&o.key in n){var a=n[o.key];delete n[o.key];r.push(a);var s={lat:a.latLon.lat,lon:a.latLon.lon,node:a};l._nodeIndex.insert(s);l._nodeIndexTiles[h].push(s);l._nodeToTile[a.key]=h;continue}var u=new p.Node(o);r.push(u);var c={lat:u.latLon.lat,lon:u.latLon.lon,node:u};l._nodeIndex.insert(c);l._nodeIndexTiles[h].push(c);l._nodeToTile[u.key]=h;l._setNode(u)}delete l._cachingTiles$[h]}),v.map(function(e){return l}),v.catchError(function(e){delete l._cachingTiles$[h];throw e}),v.publish(),v.refCount());return this._cachingTiles$[h]};e.prototype._makeFull=function(e,t){if(t.calt==null){t.calt=this._defaultAlt}if(t.c_rotation==null){t.c_rotation=this._graphCalculator.rotationFromCompass(t.ca,t.orientation)}e.makeFull(t)};e.prototype._preStore=function(e,t){if(!(e in this._preStored)){this._preStored[e]={}}this._preStored[e][t.key]=t};e.prototype._removeFromPreStore=function(e){var t=null;if(e in this._preStored){t=this._preStored[e];delete this._preStored[e]}return t};e.prototype._setNode=function(e){var t=e.key;if(this.hasNode(t)){throw new f.GraphMapillaryError("Node already exist ("+t+").")}this._nodes[t]=e};e.prototype._uncacheTile=function(e,t){for(var r=0,n=this._cachedTiles[e].nodes;r<n.length;r++){var i=n[r];var o=i.key;delete this._nodeToTile[o];if(o in this._cachedNodes){delete this._cachedNodes[o]}if(o in this._cachedNodeTiles){delete this._cachedNodeTiles[o]}if(o in this._cachedSpatialEdges){delete this._cachedSpatialEdges[o]}if(i.sequenceKey===t){this._preStore(e,i);i.uncache()}else{delete this._nodes[o];if(i.sequenceKey in this._cachedSequenceNodes){delete this._cachedSequenceNodes[i.sequenceKey]}i.dispose()}}for(var a=0,s=this._nodeIndexTiles[e];a<s.length;a++){var u=s[a];this._nodeIndex.remove(u)}delete this._nodeIndexTiles[e];delete this._cachedTiles[e]};e.prototype._uncachePreStored=function(e){var t={};for(var r=0,n=e;r<n.length;r++){var i=n[r],o=i[0],a=i[1];if(o in this._nodes){delete this._nodes[o]}if(o in this._cachedNodes){delete this._cachedNodes[o]}var s=this._preStored[a][o];if(s.sequenceKey in this._cachedSequenceNodes){delete this._cachedSequenceNodes[s.sequenceKey]}delete this._preStored[a][o];s.dispose();t[a]=true}for(var a in t){if(!t.hasOwnProperty(a)){continue}if(Object.keys(this._preStored[a]).length===0){delete this._preStored[a]}}};e.prototype._updateCachedTileAccess=function(e,t){if(e in this._nodeToTile){this._cachedTiles[this._nodeToTile[e]].accessed=t}};e.prototype._updateCachedNodeAccess=function(e,t){if(e in this._cachedNodes){this._cachedNodes[e].accessed=t}};return e}();r.Graph=n;r.default=n},{"../Edge":292,"../Error":293,"../Graph":295,rbush:42,rxjs:43,"rxjs/operators":241}],417:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var b=e("latlon-geohash");var c=e("three");var s=e("../Error");var n=e("../Geo");var i=function(){function e(e){this._geoCoords=e!=null?e:new n.GeoCoords}e.prototype.encodeH=function(e,t){if(t===void 0){t=7}return b.encode(e.lat,e.lon,t)};e.prototype.encodeHs=function(e,t,r){if(t===void 0){t=7}if(r===void 0){r=20}var n=b.encode(e.lat,e.lon,t);var i=b.bounds(n);var o=i.ne;var a=i.sw;var s=b.neighbours(n);var u=[0,0,0];var c=this._geoCoords.geodeticToEnu(o.lat,o.lon,0,a.lat,a.lon,0);var h=this._geoCoords.geodeticToEnu(e.lat,e.lon,0,a.lat,a.lon,0);var l=h[0]-u[0];var p=c[0]-h[0];var f=h[1]-u[1];var d=c[1]-h[1];var v=l<r;var m=p<r;var g=f<r;var _=d<r;var y=[n];if(_){y.push(s.n)}if(_&&v){y.push(s.nw)}if(v){y.push(s.w)}if(v&&g){y.push(s.sw)}if(g){y.push(s.s)}if(g&&m){y.push(s.se)}if(m){y.push(s.e)}if(m&&_){y.push(s.ne)}return y};e.prototype.encodeHsFromBoundingBox=function(e,t,r){if(r===void 0){r=7}if(t.lat<=e.lat||t.lon<=e.lon){throw new s.GraphMapillaryError("North east needs to be top right of south west")}var n=(e.lat+t.lat)/2;var i=(e.lon+t.lon)/2;var o=this._geoCoords.geodeticToEnu(t.lat,t.lon,0,n,i,0);var a=Math.max(o[0],o[1]);return this.encodeHs({lat:n,lon:i},r,a)};e.prototype.boundingBoxCorners=function(e,t){var r=this._geoCoords.enuToGeodetic(-t,-t,0,e.lat,e.lon,0);var n=this._geoCoords.enuToGeodetic(t,t,0,e.lat,e.lon,0);return[{lat:r[0],lon:r[1]},{lat:n[0],lon:n[1]}]};e.prototype.rotationFromCompass=function(e,t){var r=0;var n=0;var i=0;switch(t){case 1:r=Math.PI/2;break;case 3:r=-Math.PI/2;i=Math.PI;break;case 6:n=-Math.PI/2;i=-Math.PI/2;break;case 8:n=Math.PI/2;i=Math.PI/2;break;default:break}var o=(new c.Matrix4).makeRotationZ(i);var a=new c.Euler(r,n,e*Math.PI/180,"XYZ");var s=(new c.Matrix4).makeRotationFromEuler(a);var u=(new c.Vector4).setAxisAngleFromRotationMatrix(s.multiply(o));return u.multiplyScalar(u.w).toArray().slice(0,3)};return e}();r.GraphCalculator=i;r.default=i},{"../Error":293,"../Geo":294,"latlon-geohash":21,three:242}],418:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["Sequence"]=0]="Sequence";e[e["Spatial"]=1]="Spatial"})(n=r.GraphMode||(r.GraphMode={}));r.default=n},{}],419:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var c=e("rxjs");var h=e("rxjs/operators");var l=e("../Graph");var n=function(){function e(e,t){this._graph$=c.concat(c.of(e),e.changed$).pipe(h.publishReplay(1),h.refCount());this._graph$.subscribe(function(){});this._graphMode=l.GraphMode.Spatial;this._graphModeSubject$=new c.Subject;this._graphMode$=this._graphModeSubject$.pipe(h.startWith(this._graphMode),h.publishReplay(1),h.refCount());this._graphMode$.subscribe(function(){});this._imageLoadingService=t;this._firstGraphSubjects$=[];this._initializeCacheSubscriptions=[];this._sequenceSubscriptions=[];this._spatialSubscriptions=[]}Object.defineProperty(e.prototype,"graphMode$",{get:function(){return this._graphMode$},enumerable:true,configurable:true});e.prototype.cacheBoundingBox$=function(t,r){return this._graph$.pipe(h.first(),h.mergeMap(function(e){return e.cacheBoundingBox$(t,r)}))};e.prototype.cacheNode$=function(r){var t=this;var n=new c.Subject;this._firstGraphSubjects$.push(n);var e=n.pipe(h.publishReplay(1),h.refCount());var i=e.pipe(h.map(function(e){return e.getNode(r)}),h.mergeMap(function(e){return e.assetsCached?c.of(e):e.cacheAssets$()}),h.publishReplay(1),h.refCount());i.subscribe(function(e){t._imageLoadingService.loadnode$.next(e)},function(e){console.error("Failed to cache node ("+r+")",e)});var o=this._graph$.pipe(h.first(),h.mergeMap(function(e){if(e.isCachingFull(r)||!e.hasNode(r)){return e.cacheFull$(r)}if(e.isCachingFill(r)||!e.getNode(r).full){return e.cacheFill$(r)}return c.of(e)}),h.tap(function(e){if(!e.hasInitializedCache(r)){e.initializeCache(r)}}),h.finalize(function(){if(o==null){return}t._removeFromArray(o,t._initializeCacheSubscriptions);t._removeFromArray(n,t._firstGraphSubjects$)})).subscribe(function(e){n.next(e);n.complete()},function(e){n.error(e)});if(!o.closed){this._initializeCacheSubscriptions.push(o)}var a=e.pipe(h.mergeMap(function(e){if(e.isCachingNodeSequence(r)||!e.hasNodeSequence(r)){return e.cacheNodeSequence$(r)}return c.of(e)}),h.publishReplay(1),h.refCount());var s=a.pipe(h.tap(function(e){if(!e.getNode(r).sequenceEdges.cached){e.cacheSequenceEdges(r)}}),h.finalize(function(){if(s==null){return}t._removeFromArray(s,t._sequenceSubscriptions)})).subscribe(function(e){return},function(e){console.error("Failed to cache sequence edges ("+r+").",e)});if(!s.closed){this._sequenceSubscriptions.push(s)}if(this._graphMode===l.GraphMode.Spatial){var u=e.pipe(h.expand(function(e){if(e.hasTiles(r)){return c.empty()}return c.from(e.cacheTiles$(r)).pipe(h.mergeMap(function(e){return e.pipe(h.mergeMap(function(e){if(e.isCachingTiles(r)){return c.empty()}return c.of(e)}),h.catchError(function(e,t){console.error("Failed to cache tile data ("+r+").",e);return c.empty()}))}))}),h.last(),h.mergeMap(function(e){if(e.hasSpatialArea(r)){return c.of(e)}return c.from(e.cacheSpatialArea$(r)).pipe(h.mergeMap(function(e){return e.pipe(h.catchError(function(e,t){console.error("Failed to cache spatial nodes ("+r+").",e);return c.empty()}))}))}),h.last(),h.mergeMap(function(e){return e.hasNodeSequence(r)?c.of(e):e.cacheNodeSequence$(r)}),h.tap(function(e){if(!e.getNode(r).spatialEdges.cached){e.cacheSpatialEdges(r)}}),h.finalize(function(){if(u==null){return}t._removeFromArray(u,t._spatialSubscriptions)})).subscribe(function(e){return},function(e){console.error("Failed to cache spatial edges ("+r+").",e)});if(!u.closed){this._spatialSubscriptions.push(u)}}return i.pipe(h.first(function(e){return e.assetsCached}))};e.prototype.cacheSequence$=function(t){return this._graph$.pipe(h.first(),h.mergeMap(function(e){if(e.isCachingSequence(t)||!e.hasSequence(t)){return e.cacheSequence$(t)}return c.of(e)}),h.map(function(e){return e.getSequence(t)}))};e.prototype.cacheSequenceNodes$=function(t,r){return this._graph$.pipe(h.first(),h.mergeMap(function(e){if(e.isCachingSequence(t)||!e.hasSequence(t)){return e.cacheSequence$(t)}return c.of(e)}),h.mergeMap(function(e){if(e.isCachingSequenceNodes(t)||!e.hasSequenceNodes(t)){return e.cacheSequenceNodes$(t,r)}return c.of(e)}),h.map(function(e){return e.getSequence(t)}))};e.prototype.setFilter$=function(t){this._resetSubscriptions(this._spatialSubscriptions);return this._graph$.pipe(h.first(),h.tap(function(e){e.resetSpatialEdges();e.setFilter(t)}),h.map(function(e){return undefined}))};e.prototype.setGraphMode=function(e){if(this._graphMode===e){return}if(e===l.GraphMode.Sequence){this._resetSubscriptions(this._spatialSubscriptions)}this._graphMode=e;this._graphModeSubject$.next(this._graphMode)};e.prototype.reset$=function(t){this._abortSubjects(this._firstGraphSubjects$);this._resetSubscriptions(this._initializeCacheSubscriptions);this._resetSubscriptions(this._sequenceSubscriptions);this._resetSubscriptions(this._spatialSubscriptions);return this._graph$.pipe(h.first(),h.tap(function(e){e.reset(t)}),h.map(function(e){return undefined}))};e.prototype.uncache$=function(t,r){return this._graph$.pipe(h.first(),h.tap(function(e){e.uncache(t,r)}),h.map(function(e){return undefined}))};e.prototype._abortSubjects=function(e){for(var t=0,r=e.slice();t<r.length;t++){var n=r[t];this._removeFromArray(n,e);n.error(new Error("Cache node request was aborted."))}};e.prototype._removeFromArray=function(e,t){var r=t.indexOf(e);if(r!==-1){t.splice(r,1)}};e.prototype._resetSubscriptions=function(e){for(var t=0,r=e.slice();t<r.length;t++){var n=r[t];this._removeFromArray(n,e);if(!n.closed){n.unsubscribe()}}};return e}();r.GraphService=n;r.default=n},{"../Graph":295,rxjs:43,"rxjs/operators":241}],420:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rxjs/operators");var i=e("rxjs");var o=function(){function e(){this._loadnode$=new i.Subject;this._loadstatus$=this._loadnode$.pipe(n.scan(function(e,t){var r=e[0];var n=false;if(t.loadStatus.total===0||t.loadStatus.loaded===t.loadStatus.total){if(t.key in r){delete r[t.key];n=true}}else{r[t.key]=t.loadStatus;n=true}return[r,n]},[{},false]),n.filter(function(e){var t=e[0],r=e[1];return r}),n.map(function(e){var t=e[0];return t}),n.publishReplay(1),n.refCount());this._loadstatus$.subscribe(function(){})}Object.defineProperty(e.prototype,"loadnode$",{get:function(){return this._loadnode$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"loadstatus$",{get:function(){return this._loadstatus$},enumerable:true,configurable:true});return e}();r.ImageLoadingService=o},{rxjs:43,"rxjs/operators":241}],421:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("pbf");var i=function(){function r(){}r.read=function(e){var t=new n(e);return t.readFields(r._readMeshField,{faces:[],vertices:[]})};r._readMeshField=function(e,t,r){if(e===1){t.vertices.push(r.readFloat())}else if(e===2){t.faces.push(r.readVarint())}};return r}();r.MeshReader=i},{pbf:40}],422:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rxjs/operators");var i=function(){function e(e){this._cache=null;this._core=e;this._fill=null}Object.defineProperty(e.prototype,"assetsCached",{get:function(){return this._core!=null&&this._fill!=null&&this._cache!=null&&this._cache.image!=null&&this._cache.mesh!=null},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"alt",{get:function(){return this._fill.calt},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"ca",{get:function(){return this._fill.cca!=null?this._fill.cca:this._fill.ca},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"cameraProjection",{get:function(){return this._fill.camera_projection_type},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"capturedAt",{get:function(){return this._fill.captured_at},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"cameraUuid",{get:function(){return this._fill.captured_with_camera_uuid},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"clusterKey",{get:function(){return this._fill.cluster_key},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"ck1",{get:function(){return this._fill.ck1},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"ck2",{get:function(){return this._fill.ck2},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"computedCA",{get:function(){return this._fill.cca},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"computedLatLon",{get:function(){return this._core.cl},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"focal",{get:function(){return this._fill.cfocal},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"full",{get:function(){return this._fill!=null},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"fullPano",{get:function(){return this._fill.gpano!=null&&this._fill.gpano.CroppedAreaLeftPixels===0&&this._fill.gpano.CroppedAreaTopPixels===0&&this._fill.gpano.CroppedAreaImageWidthPixels===this._fill.gpano.FullPanoWidthPixels&&this._fill.gpano.CroppedAreaImageHeightPixels===this._fill.gpano.FullPanoHeightPixels},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"gpano",{get:function(){return this._fill.gpano},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"height",{get:function(){return this._fill.height},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"image",{get:function(){return this._cache.image},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"image$",{get:function(){return this._cache.image$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"key",{get:function(){return this._core.key},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"latLon",{get:function(){return this._core.cl!=null?this._core.cl:this._core.l},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"loadStatus",{get:function(){return this._cache.loadStatus},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"merged",{get:function(){return this._fill!=null&&this._fill.merge_version!=null&&this._fill.merge_version>0},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mergeCC",{get:function(){return this._fill.merge_cc},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mergeVersion",{get:function(){return this._fill.merge_version},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mesh",{get:function(){return this._cache.mesh},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"organizationKey",{get:function(){return this._fill.organization_key},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"orientation",{get:function(){return this._fill.orientation},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"originalCA",{get:function(){return this._fill.ca},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"originalLatLon",{get:function(){return this._core.l},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"pano",{get:function(){return this._fill.gpano!=null&&this._fill.gpano.FullPanoWidthPixels!=null},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"private",{get:function(){return this._fill.private},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"projectKey",{get:function(){return this._fill.project!=null?this._fill.project.key:null},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"rotation",{get:function(){return this._fill.c_rotation},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"scale",{get:function(){return this._fill.atomic_scale},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sequenceKey",{get:function(){return this._core.sequence_key},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sequenceEdges",{get:function(){return this._cache.sequenceEdges},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sequenceEdges$",{get:function(){return this._cache.sequenceEdges$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"spatialEdges",{get:function(){return this._cache.spatialEdges},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"spatialEdges$",{get:function(){return this._cache.spatialEdges$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"userKey",{get:function(){return this._fill.user.key},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"username",{get:function(){return this._fill.user.username},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"width",{get:function(){return this._fill.width},enumerable:true,configurable:true});e.prototype.cacheAssets$=function(){var e=this;return this._cache.cacheAssets$(this.key,this.pano,this.merged).pipe(n.map(function(){return e}))};e.prototype.cacheImage$=function(e){var t=this;return this._cache.cacheImage$(this.key,e).pipe(n.map(function(){return t}))};e.prototype.cacheSequenceEdges=function(e){this._cache.cacheSequenceEdges(e)};e.prototype.cacheSpatialEdges=function(e){this._cache.cacheSpatialEdges(e)};e.prototype.dispose=function(){if(this._cache!=null){this._cache.dispose();this._cache=null}this._core=null;this._fill=null};e.prototype.initializeCache=function(e){if(this._cache!=null){throw new Error("Node cache already initialized ("+this.key+").")}this._cache=e};e.prototype.makeFull=function(e){if(e==null){throw new Error("Fill can not be null.")}this._fill=e};e.prototype.resetSequenceEdges=function(){this._cache.resetSequenceEdges()};e.prototype.resetSpatialEdges=function(){this._cache.resetSpatialEdges()};e.prototype.uncache=function(){if(this._cache==null){return}this._cache.dispose();this._cache=null};return e}();r.Node=i;r.default=i},{"rxjs/operators":241}],423:[function(t,e,r){(function(o){"use strict";Object.defineProperty(r,"__esModule",{value:true});var s=t("rxjs");var a=t("rxjs/operators");var u=t("../Graph");var c=t("../Utils");var e=function(){function e(){this._disposed=false;this._image=null;this._loadStatus={loaded:0,total:0};this._mesh=null;this._sequenceEdges={cached:false,edges:[]};this._spatialEdges={cached:false,edges:[]};this._imageChanged$=new s.Subject;this._image$=this._imageChanged$.pipe(a.startWith(null),a.publishReplay(1),a.refCount());this._iamgeSubscription=this._image$.subscribe();this._sequenceEdgesChanged$=new s.Subject;this._sequenceEdges$=this._sequenceEdgesChanged$.pipe(a.startWith(this._sequenceEdges),a.publishReplay(1),a.refCount());this._sequenceEdgesSubscription=this._sequenceEdges$.subscribe(function(){});this._spatialEdgesChanged$=new s.Subject;this._spatialEdges$=this._spatialEdgesChanged$.pipe(a.startWith(this._spatialEdges),a.publishReplay(1),a.refCount());this._spatialEdgesSubscription=this._spatialEdges$.subscribe(function(){});this._cachingAssets$=null}Object.defineProperty(e.prototype,"image",{get:function(){return this._image},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"image$",{get:function(){return this._image$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"loadStatus",{get:function(){return this._loadStatus},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sequenceEdges",{get:function(){return this._sequenceEdges},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sequenceEdges$",{get:function(){return this._sequenceEdges$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"spatialEdges",{get:function(){return this._spatialEdges},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"spatialEdges$",{get:function(){return this._spatialEdges$},enumerable:true,configurable:true});e.prototype.cacheAssets$=function(e,t,r){var n=this;if(this._cachingAssets$!=null){return this._cachingAssets$}var i=t?c.Settings.basePanoramaSize:c.Settings.baseImageSize;this._cachingAssets$=s.combineLatest(this._cacheImage$(e,i),this._cacheMesh$(e,r)).pipe(a.map(function(e){var t=e[0],r=e[1];n._loadStatus.loaded=0;n._loadStatus.total=0;if(r){n._mesh=r.object;n._loadStatus.loaded+=r.loaded.loaded;n._loadStatus.total+=r.loaded.total}if(t){n._image=t.object;n._loadStatus.loaded+=t.loaded.loaded;n._loadStatus.total+=t.loaded.total}return n}),a.finalize(function(){n._cachingAssets$=null}),a.publishReplay(1),a.refCount());this._cachingAssets$.pipe(a.first(function(e){return!!e._image})).subscribe(function(e){n._imageChanged$.next(n._image)},function(e){});return this._cachingAssets$};e.prototype.cacheImage$=function(e,t){var r=this;if(this._image!=null&&t<=Math.max(this._image.width,this._image.height)){return s.of(this)}var n=this._cacheImage$(e,t).pipe(a.first(function(e){return e.object!=null}),a.tap(function(e){r._disposeImage();r._image=e.object}),a.map(function(e){return r}),a.publishReplay(1),a.refCount());n.subscribe(function(e){r._imageChanged$.next(r._image)},function(e){});return n};e.prototype.cacheSequenceEdges=function(e){this._sequenceEdges={cached:true,edges:e};this._sequenceEdgesChanged$.next(this._sequenceEdges)};e.prototype.cacheSpatialEdges=function(e){this._spatialEdges={cached:true,edges:e};this._spatialEdgesChanged$.next(this._spatialEdges)};e.prototype.dispose=function(){this._iamgeSubscription.unsubscribe();this._sequenceEdgesSubscription.unsubscribe();this._spatialEdgesSubscription.unsubscribe();this._disposeImage();this._mesh=null;this._loadStatus.loaded=0;this._loadStatus.total=0;this._sequenceEdges={cached:false,edges:[]};this._spatialEdges={cached:false,edges:[]};this._imageChanged$.next(null);this._sequenceEdgesChanged$.next(this._sequenceEdges);this._spatialEdgesChanged$.next(this._spatialEdges);this._disposed=true;if(this._imageRequest!=null){this._imageRequest.abort()}if(this._meshRequest!=null){this._meshRequest.abort()}};e.prototype.resetSequenceEdges=function(){this._sequenceEdges={cached:false,edges:[]};this._sequenceEdgesChanged$.next(this._sequenceEdges)};e.prototype.resetSpatialEdges=function(){this._spatialEdges={cached:false,edges:[]};this._spatialEdgesChanged$.next(this._spatialEdges)};e.prototype._cacheImage$=function(o,e){var a=this;return s.Observable.create(function(n){var i=new XMLHttpRequest;i.open("GET",c.Urls.thumbnail(o,e,c.Urls.origin),true);i.responseType="arraybuffer";i.timeout=15e3;i.onload=function(t){if(i.status!==200){a._imageRequest=null;n.error(new Error("Failed to fetch image ("+o+"). Status: "+i.status+", "+i.statusText));return}var r=new Image;r.crossOrigin="Anonymous";r.onload=function(e){a._imageRequest=null;if(a._disposed){window.URL.revokeObjectURL(r.src);n.error(new Error("Image load was aborted ("+o+")"));return}n.next({loaded:{loaded:t.loaded,total:t.total},object:r});n.complete()};r.onerror=function(e){a._imageRequest=null;n.error(new Error("Failed to load image ("+o+")"))};var e=new Blob([i.response]);r.src=window.URL.createObjectURL(e)};i.onprogress=function(e){if(a._disposed){return}n.next({loaded:{loaded:e.loaded,total:e.total},object:null})};i.onerror=function(e){a._imageRequest=null;n.error(new Error("Failed to fetch image ("+o+")"))};i.ontimeout=function(e){a._imageRequest=null;n.error(new Error("Image request timed out ("+o+")"))};i.onabort=function(e){a._imageRequest=null;n.error(new Error("Image request was aborted ("+o+")"))};a._imageRequest=i;i.send(null)})};e.prototype._cacheMesh$=function(t,e){var i=this;return s.Observable.create(function(r){if(!e){r.next(i._createEmptyMeshLoadStatus());r.complete();return}var n=new XMLHttpRequest;n.open("GET",c.Urls.protoMesh(t),true);n.responseType="arraybuffer";n.timeout=15e3;n.onload=function(e){i._meshRequest=null;if(i._disposed){return}var t=n.status===200?u.MeshReader.read(new o(n.response)):{faces:[],vertices:[]};r.next({loaded:{loaded:e.loaded,total:e.total},object:t});r.complete()};n.onprogress=function(e){if(i._disposed){return}r.next({loaded:{loaded:e.loaded,total:e.total},object:null})};n.onerror=function(e){i._meshRequest=null;console.error("Failed to cache mesh ("+t+")");r.next(i._createEmptyMeshLoadStatus());r.complete()};n.ontimeout=function(e){i._meshRequest=null;console.error("Mesh request timed out ("+t+")");r.next(i._createEmptyMeshLoadStatus());r.complete()};n.onabort=function(e){i._meshRequest=null;r.error(new Error("Mesh request was aborted ("+t+")"))};i._meshRequest=n;n.send(null)})};e.prototype._createEmptyMeshLoadStatus=function(){return{loaded:{loaded:0,total:0},object:{faces:[],vertices:[]}}};e.prototype._disposeImage=function(){if(this._image!=null){window.URL.revokeObjectURL(this._image.src)}this._image=null};return e}();r.NodeCache=e;r.default=e}).call(this,t("buffer").Buffer)},{"../Graph":295,"../Utils":301,buffer:7,rxjs:43,"rxjs/operators":241}],424:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(e){this._key=e.key;this._keys=e.keys}Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"keys",{get:function(){return this._keys},enumerable:true,configurable:true});e.prototype.dispose=function(){this._key=null;this._keys=null};e.prototype.findNextKey=function(e){var t=this._keys.indexOf(e);if(t+1>=this._keys.length||t===-1){return null}else{return this._keys[t+1]}};e.prototype.findPrevKey=function(e){var t=this._keys.indexOf(e);if(t===0||t===-1){return null}else{return this._keys[t-1]}};return e}();r.Sequence=n;r.default=n},{}],425:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var M=e("three");var G=e("../../Edge");var V=e("../../Error");var n=e("../../Geo");var i=function(){function e(e,t,r){this._spatial=new n.Spatial;this._geoCoords=new n.GeoCoords;this._settings=e!=null?e:new G.EdgeCalculatorSettings;this._directions=t!=null?t:new G.EdgeCalculatorDirections;this._coefficients=r!=null?r:new G.EdgeCalculatorCoefficients}e.prototype.getPotentialEdges=function(e,t,r){if(!e.full){throw new V.ArgumentMapillaryError("Node has to be full.")}if(!e.merged){return[]}var n=this._spatial.viewingDirection(e.rotation);var i=this._spatial.angleToPlane(n.toArray(),[0,0,1]);var o=[];for(var a=0,s=t;a<s.length;a++){var u=s[a];if(!u.merged||u.key===e.key){continue}var c=this._geoCoords.geodeticToEnu(u.latLon.lat,u.latLon.lon,u.alt,e.latLon.lat,e.latLon.lon,e.alt);var h=new M.Vector3(c[0],c[1],c[2]);var l=h.length();if(l>this._settings.maxDistance&&r.indexOf(u.key)<0){continue}var p=this._spatial.angleBetweenVector2(n.x,n.y,h.x,h.y);var f=this._spatial.angleToPlane(h.toArray(),[0,0,1]);var d=this._spatial.viewingDirection(u.rotation);var v=this._spatial.angleBetweenVector2(n.x,n.y,d.x,d.y);var m=this._spatial.angleToPlane(d.toArray(),[0,0,1]);var g=m-i;var _=this._spatial.relativeRotationAngle(e.rotation,u.rotation);var y=this._spatial.angleBetweenVector2(1,0,h.x,h.y);var b=u.sequenceKey!=null&&e.sequenceKey!=null&&u.sequenceKey===e.sequenceKey;var w=u.mergeCC==null&&e.mergeCC==null||u.mergeCC===e.mergeCC;var x=u.userKey===e.userKey;var S={capturedAt:u.capturedAt,croppedPano:u.pano&&!u.fullPano,directionChange:v,distance:l,fullPano:u.fullPano,key:u.key,motionChange:p,rotation:_,sameMergeCC:w,sameSequence:b,sameUser:x,sequenceKey:u.sequenceKey,verticalDirectionChange:g,verticalMotion:f,worldMotionAzimuth:y};o.push(S)}return o};e.prototype.computeSequenceEdges=function(e,t){if(!e.full){throw new V.ArgumentMapillaryError("Node has to be full.")}if(e.sequenceKey!==t.key){throw new V.ArgumentMapillaryError("Node and sequence does not correspond.")}var r=[];var n=t.findNextKey(e.key);if(n!=null){r.push({data:{direction:G.EdgeDirection.Next,worldMotionAzimuth:Number.NaN},from:e.key,to:n})}var i=t.findPrevKey(e.key);if(i!=null){r.push({data:{direction:G.EdgeDirection.Prev,worldMotionAzimuth:Number.NaN},from:e.key,to:i})}return r};e.prototype.computeSimilarEdges=function(t,e){var r=this;if(!t.full){throw new V.ArgumentMapillaryError("Node has to be full.")}var n=t.fullPano;var i={};for(var o=0,a=e;o<a.length;o++){var s=a[o];if(s.sequenceKey==null){continue}if(s.sameSequence){continue}if(n){if(!s.fullPano){continue}}else{if(!s.fullPano&&Math.abs(s.directionChange)>this._settings.similarMaxDirectionChange){continue}}if(s.distance>this._settings.similarMaxDistance){continue}if(s.sameUser&&Math.abs(s.capturedAt-t.capturedAt)<this._settings.similarMinTimeDifference){continue}if(i[s.sequenceKey]==null){i[s.sequenceKey]=[]}i[s.sequenceKey].push(s)}var u=[];var c=t.fullPano?function(e){return e.distance}:function(e){return r._coefficients.similarDistance*e.distance+r._coefficients.similarRotation*e.rotation};for(var h in i){if(!i.hasOwnProperty(h)){continue}var l=Number.MAX_VALUE;var p=null;for(var f=0,d=i[h];f<d.length;f++){var s=d[f];var v=c(s);if(v<l){l=v;p=s}}if(p==null){continue}u.push(p)}return u.map(function(e){return{data:{direction:G.EdgeDirection.Similar,worldMotionAzimuth:e.worldMotionAzimuth},from:t.key,to:e.key}})};e.prototype.computeStepEdges=function(e,t,r,n){if(!e.full){throw new V.ArgumentMapillaryError("Node has to be full.")}var i=[];if(e.pano){return i}for(var o in this._directions.steps){if(!this._directions.steps.hasOwnProperty(o)){continue}var a=this._directions.steps[o];var s=Number.MAX_VALUE;var u=null;var c=null;for(var h=0,l=t;h<l.length;h++){var p=l[h];if(p.croppedPano||p.fullPano){continue}if(Math.abs(p.directionChange)>this._settings.stepMaxDirectionChange){continue}var f=this._spatial.angleDifference(a.motionChange,p.motionChange);var d=this._spatial.angleDifference(p.directionChange,f);var v=Math.max(Math.abs(f),Math.abs(d));if(Math.abs(v)>this._settings.stepMaxDrift){continue}var m=p.key;if(a.useFallback&&(m===r||m===n)){c=p}if(p.distance>this._settings.stepMaxDistance){continue}f=Math.sqrt(f*f+p.verticalMotion*p.verticalMotion);var g=this._coefficients.stepPreferredDistance*Math.abs(p.distance-this._settings.stepPreferredDistance)/this._settings.stepMaxDistance+this._coefficients.stepMotion*f/this._settings.stepMaxDrift+this._coefficients.stepRotation*p.rotation/this._settings.stepMaxDirectionChange+this._coefficients.stepSequencePenalty*(p.sameSequence?0:1)+this._coefficients.stepMergeCCPenalty*(p.sameMergeCC?0:1);if(g<s){s=g;u=p}}u=u==null?c:u;if(u!=null){i.push({data:{direction:a.direction,worldMotionAzimuth:u.worldMotionAzimuth},from:e.key,to:u.key})}}return i};e.prototype.computeTurnEdges=function(e,t){if(!e.full){throw new V.ArgumentMapillaryError("Node has to be full.")}var r=[];if(e.pano){return r}for(var n in this._directions.turns){if(!this._directions.turns.hasOwnProperty(n)){continue}var i=this._directions.turns[n];var o=Number.MAX_VALUE;var a=null;for(var s=0,u=t;s<u.length;s++){var c=u[s];if(c.croppedPano||c.fullPano){continue}if(c.distance>this._settings.turnMaxDistance){continue}var h=i.direction!==G.EdgeDirection.TurnU&&c.distance<this._settings.turnMaxRigDistance&&Math.abs(c.directionChange)>this._settings.turnMinRigDirectionChange;var l=this._spatial.angleDifference(i.directionChange,c.directionChange);var p=void 0;if(h&&c.directionChange*i.directionChange>0&&Math.abs(c.directionChange)<Math.abs(i.directionChange)){p=-Math.PI/2+Math.abs(c.directionChange)}else{if(Math.abs(l)>this._settings.turnMaxDirectionChange){continue}var f=i.motionChange?this._spatial.angleDifference(i.motionChange,c.motionChange):0;f=Math.sqrt(f*f+c.verticalMotion*c.verticalMotion);p=this._coefficients.turnDistance*c.distance/this._settings.turnMaxDistance+this._coefficients.turnMotion*f/Math.PI+this._coefficients.turnSequencePenalty*(c.sameSequence?0:1)+this._coefficients.turnMergeCCPenalty*(c.sameMergeCC?0:1)}if(p<o){o=p;a=c}}if(a!=null){r.push({data:{direction:i.direction,worldMotionAzimuth:a.worldMotionAzimuth},from:e.key,to:a.key})}}return r};e.prototype.computePerspectiveToPanoEdges=function(e,t){if(!e.full){throw new V.ArgumentMapillaryError("Node has to be full.")}if(e.pano){return[]}var r=Number.MAX_VALUE;var n=null;for(var i=0,o=t;i<o.length;i++){var a=o[i];if(!a.fullPano){continue}var s=this._coefficients.panoPreferredDistance*Math.abs(a.distance-this._settings.panoPreferredDistance)/this._settings.panoMaxDistance+this._coefficients.panoMotion*Math.abs(a.motionChange)/Math.PI+this._coefficients.panoMergeCCPenalty*(a.sameMergeCC?0:1);if(s<r){r=s;n=a}}if(n==null){return[]}return[{data:{direction:G.EdgeDirection.Pano,worldMotionAzimuth:n.worldMotionAzimuth},from:e.key,to:n.key}]};e.prototype.computePanoEdges=function(e,t){if(!e.full){throw new V.ArgumentMapillaryError("Node has to be full.")}if(!e.fullPano){return[]}var r=[];var n=[];var i=[];for(var o=0,a=t;o<a.length;o++){var s=a[o];if(s.distance>this._settings.panoMaxDistance){continue}if(s.fullPano){if(s.distance<this._settings.panoMinDistance){continue}n.push(s)}else{if(s.croppedPano){continue}for(var u in this._directions.panos){if(!this._directions.panos.hasOwnProperty(u)){continue}var c=this._directions.panos[u];var h=this._spatial.angleDifference(s.directionChange,s.motionChange);var l=this._spatial.angleDifference(c.directionChange,h);if(Math.abs(l)>this._settings.panoMaxStepTurnChange){continue}i.push([c.direction,s]);break}}}var p=Math.PI/this._settings.panoMaxItems;var f=[];var d=[];for(var v=0;v<this._settings.panoMaxItems;v++){var m=v/this._settings.panoMaxItems*2*Math.PI;var g=Number.MAX_VALUE;var _=null;for(var y=0,b=n;y<b.length;y++){var s=b[y];var w=this._spatial.angleDifference(m,s.motionChange);if(Math.abs(w)>p){continue}var x=Number.MAX_VALUE;for(var S=0,M=f;S<M.length;S++){var C=M[S];var E=Math.abs(this._spatial.angleDifference(C,s.motionChange));if(E<x){x=E}}if(x<=p){continue}var T=this._coefficients.panoPreferredDistance*Math.abs(s.distance-this._settings.panoPreferredDistance)/this._settings.panoMaxDistance+this._coefficients.panoMotion*Math.abs(w)/p+this._coefficients.panoSequencePenalty*(s.sameSequence?0:1)+this._coefficients.panoMergeCCPenalty*(s.sameMergeCC?0:1);if(T<g){g=T;_=s}}if(_!=null){f.push(_.motionChange);r.push({data:{direction:G.EdgeDirection.Pano,worldMotionAzimuth:_.worldMotionAzimuth},from:e.key,to:_.key})}else{d.push(m)}}var O={};O[G.EdgeDirection.Pano]=f;O[G.EdgeDirection.StepForward]=[];O[G.EdgeDirection.StepLeft]=[];O[G.EdgeDirection.StepBackward]=[];O[G.EdgeDirection.StepRight]=[];for(var P=0,A=d;P<A.length;P++){var j=A[P];var R=[];for(var u in this._directions.panos){if(!this._directions.panos.hasOwnProperty(u)){continue}var c=this._directions.panos[u];var k=O[G.EdgeDirection.Pano].concat(O[c.direction]).concat(O[c.prev]).concat(O[c.next]);var g=Number.MAX_VALUE;var _=null;for(var L=0,I=i;L<I.length;L++){var s=I[L];if(s[0]!==c.direction){continue}var N=this._spatial.angleDifference(j,s[1].motionChange);if(Math.abs(N)>p){continue}var D=Number.MAX_VALUE;for(var B=0,F=k;B<F.length;B++){var C=F[B];var x=Math.abs(this._spatial.angleDifference(C,s[1].motionChange));if(x<D){D=x}}if(D<=p){continue}var T=this._coefficients.panoPreferredDistance*Math.abs(s[1].distance-this._settings.panoPreferredDistance)/this._settings.panoMaxDistance+this._coefficients.panoMotion*Math.abs(N)/p+this._coefficients.panoMergeCCPenalty*(s[1].sameMergeCC?0:1);if(T<g){g=T;_=s}}if(_!=null){R.push(_);r.push({data:{direction:_[0],worldMotionAzimuth:_[1].worldMotionAzimuth},from:e.key,to:_[1].key})}}for(var z=0,$=R;z<$.length;z++){var U=$[z];O[U[0]].push(U[1].motionChange)}}return r};return e}();r.EdgeCalculator=i;r.default=i},{"../../Edge":292,"../../Error":293,"../../Geo":294,three:242}],426:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(){this.panoPreferredDistance=2;this.panoMotion=2;this.panoSequencePenalty=1;this.panoMergeCCPenalty=4;this.stepPreferredDistance=4;this.stepMotion=3;this.stepRotation=4;this.stepSequencePenalty=2;this.stepMergeCCPenalty=6;this.similarDistance=2;this.similarRotation=3;this.turnDistance=4;this.turnMotion=2;this.turnSequencePenalty=1;this.turnMergeCCPenalty=4}return e}();r.EdgeCalculatorCoefficients=n;r.default=n},{}],427:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../../Edge");var i=function(){function e(){this.steps={};this.turns={};this.panos={};this.steps[n.EdgeDirection.StepForward]={direction:n.EdgeDirection.StepForward,motionChange:0,useFallback:true};this.steps[n.EdgeDirection.StepBackward]={direction:n.EdgeDirection.StepBackward,motionChange:Math.PI,useFallback:true};this.steps[n.EdgeDirection.StepLeft]={direction:n.EdgeDirection.StepLeft,motionChange:Math.PI/2,useFallback:false};this.steps[n.EdgeDirection.StepRight]={direction:n.EdgeDirection.StepRight,motionChange:-Math.PI/2,useFallback:false};this.turns[n.EdgeDirection.TurnLeft]={direction:n.EdgeDirection.TurnLeft,directionChange:Math.PI/2,motionChange:Math.PI/4};this.turns[n.EdgeDirection.TurnRight]={direction:n.EdgeDirection.TurnRight,directionChange:-Math.PI/2,motionChange:-Math.PI/4};this.turns[n.EdgeDirection.TurnU]={direction:n.EdgeDirection.TurnU,directionChange:Math.PI,motionChange:null};this.panos[n.EdgeDirection.StepForward]={direction:n.EdgeDirection.StepForward,directionChange:0,next:n.EdgeDirection.StepLeft,prev:n.EdgeDirection.StepRight};this.panos[n.EdgeDirection.StepBackward]={direction:n.EdgeDirection.StepBackward,directionChange:Math.PI,next:n.EdgeDirection.StepRight,prev:n.EdgeDirection.StepLeft};this.panos[n.EdgeDirection.StepLeft]={direction:n.EdgeDirection.StepLeft,directionChange:Math.PI/2,next:n.EdgeDirection.StepBackward,prev:n.EdgeDirection.StepForward};this.panos[n.EdgeDirection.StepRight]={direction:n.EdgeDirection.StepRight,directionChange:-Math.PI/2,next:n.EdgeDirection.StepForward,prev:n.EdgeDirection.StepBackward}}return e}();r.EdgeCalculatorDirections=i},{"../../Edge":292}],428:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(){this.panoMinDistance=.1;this.panoMaxDistance=20;this.panoPreferredDistance=5;this.panoMaxItems=4;this.panoMaxStepTurnChange=Math.PI/8;this.rotationMaxDistance=this.turnMaxRigDistance;this.rotationMaxDirectionChange=Math.PI/6;this.rotationMaxVerticalDirectionChange=Math.PI/8;this.similarMaxDirectionChange=Math.PI/8;this.similarMaxDistance=12;this.similarMinTimeDifference=12*3600*1e3;this.stepMaxDistance=20;this.stepMaxDirectionChange=Math.PI/6;this.stepMaxDrift=Math.PI/6;this.stepPreferredDistance=4;this.turnMaxDistance=15;this.turnMaxDirectionChange=2*Math.PI/9;this.turnMaxRigDistance=.65;this.turnMinRigDirectionChange=Math.PI/6}Object.defineProperty(e.prototype,"maxDistance",{get:function(){return Math.max(this.panoMaxDistance,this.similarMaxDistance,this.stepMaxDistance,this.turnMaxDistance)},enumerable:true,configurable:true});return e}();r.EdgeCalculatorSettings=n;r.default=n},{}],429:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["Next"]=0]="Next";e[e["Prev"]=1]="Prev";e[e["StepLeft"]=2]="StepLeft";e[e["StepRight"]=3]="StepRight";e[e["StepForward"]=4]="StepForward";e[e["StepBackward"]=5]="StepBackward";e[e["TurnLeft"]=6]="TurnLeft";e[e["TurnRight"]=7]="TurnRight";e[e["TurnU"]=8]="TurnU";e[e["Pano"]=9]="Pano";e[e["Similar"]=10]="Similar"})(n=r.EdgeDirection||(r.EdgeDirection={}))},{}],430:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs");var o=e("rxjs/operators");var a=e("virtual-dom");var s=e("rxjs");var u=e("../Render");var n=function(){function e(e,t,r){this._adaptiveOperation$=new s.Subject;this._render$=new s.Subject;this._renderAdaptive$=new s.Subject;this._renderService=t;this._currentFrame$=r;var n=a.create(a.h("div.domRenderer",[]));e.appendChild(n);this._offset$=this._adaptiveOperation$.pipe(o.scan(function(e,t){return t(e)},{elementHeight:e.offsetHeight,elementWidth:e.offsetWidth,imageAspect:0,renderMode:u.RenderMode.Fill}),o.filter(function(e){return e.imageAspect>0&&e.elementWidth>0&&e.elementHeight>0}),o.map(function(e){var t=e.elementWidth/e.elementHeight;var r=e.imageAspect/t;var n=0;var i=0;if(e.renderMode===u.RenderMode.Letterbox){if(e.imageAspect>t){n=e.elementHeight*(1-1/r)/2}else{i=e.elementWidth*(1-r)/2}}else{if(e.imageAspect>t){i=-e.elementWidth*(r-1)/2}else{n=-e.elementHeight*(1/r-1)/2}}return{bottom:n,left:i,right:i,top:n}}));this._currentFrame$.pipe(o.filter(function(e){return e.state.currentNode!=null}),o.distinctUntilChanged(function(e,t){return e===t},function(e){return e.state.currentNode.key}),o.map(function(e){return e.state.currentTransform.basicAspect}),o.map(function(t){return function(e){e.imageAspect=t;return e}})).subscribe(this._adaptiveOperation$);i.combineLatest(this._renderAdaptive$.pipe(o.scan(function(e,t){if(t.vnode==null){delete e[t.name]}else{e[t.name]=t.vnode}return e},{})),this._offset$).pipe(o.map(function(e){var t=[];var r=e[0];for(var n in r){if(!r.hasOwnProperty(n)){continue}t.push(r[n])}var i=e[1];var o={style:{bottom:i.bottom+"px",left:i.left+"px","pointer-events":"none",position:"absolute",right:i.right+"px",top:i.top+"px"}};return{name:"adaptiveDomRenderer",vnode:a.h("div.adaptiveDomRenderer",o,t)}})).subscribe(this._render$);this._vNode$=this._render$.pipe(o.scan(function(e,t){if(t.vnode==null){delete e[t.name]}else{e[t.name]=t.vnode}return e},{}),o.map(function(e){var t=[];for(var r in e){if(!e.hasOwnProperty(r)){continue}t.push(e[r])}return a.h("div.domRenderer",t)}));this._vPatch$=this._vNode$.pipe(o.scan(function(e,t){e.vpatch=a.diff(e.vnode,t);e.vnode=t;return e},{vnode:a.h("div.domRenderer",[]),vpatch:null}),o.pluck("vpatch"));this._element$=this._vPatch$.pipe(o.scan(function(e,t){return a.patch(e,t)},n),o.publishReplay(1),o.refCount());this._element$.subscribe(function(){});this._renderService.size$.pipe(o.map(function(t){return function(e){e.elementWidth=t.width;e.elementHeight=t.height;return e}})).subscribe(this._adaptiveOperation$);this._renderService.renderMode$.pipe(o.map(function(t){return function(e){e.renderMode=t;return e}})).subscribe(this._adaptiveOperation$)}Object.defineProperty(e.prototype,"element$",{get:function(){return this._element$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"render$",{get:function(){return this._render$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"renderAdaptive$",{get:function(){return this._renderAdaptive$},enumerable:true,configurable:true});e.prototype.clear=function(e){this._renderAdaptive$.next({name:e,vnode:null});this._render$.next({name:e,vnode:null})};return e}();r.DOMRenderer=n;r.default=n},{"../Render":297,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],431:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["Background"]=0]="Background";e[e["Foreground"]=1]="Foreground"})(n=r.GLRenderStage||(r.GLRenderStage={}));r.default=n},{}],432:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var h=e("rxjs");var l=e("rxjs/operators");var p=e("three");var f=e("../Render");var d=e("../Utils");var n=function(){function e(i,o,e){var a=this;this._renderFrame$=new h.Subject;this._renderCameraOperation$=new h.Subject;this._render$=new h.Subject;this._clear$=new h.Subject;this._renderOperation$=new h.Subject;this._rendererOperation$=new h.Subject;this._eraserOperation$=new h.Subject;this._renderService=o;this._dom=!!e?e:new d.DOM;this._renderer$=this._rendererOperation$.pipe(l.scan(function(e,t){return t(e)},{needsRender:false,renderer:null}),l.filter(function(e){return!!e.renderer}));this._renderCollection$=this._renderOperation$.pipe(l.scan(function(e,t){return t(e)},{}),l.share());this._renderCamera$=this._renderCameraOperation$.pipe(l.scan(function(e,t){return t(e)},{frameId:-1,needsRender:false,perspective:null}));this._eraser$=this._eraserOperation$.pipe(l.startWith(function(e){return e}),l.scan(function(e,t){return t(e)},{needsRender:false}));h.combineLatest(this._renderer$,this._renderCollection$,this._renderCamera$,this._eraser$).pipe(l.map(function(e){var t=e[0],r=e[1],n=e[2],i=e[3];var o=Object.keys(r).map(function(e){return r[e]});return{camera:n,eraser:i,renderer:t,renders:o}}),l.filter(function(e){var t=e.renderer.needsRender||e.camera.needsRender||e.eraser.needsRender;var r=e.camera.frameId;for(var n=0,i=e.renders;n<i.length;n++){var o=i[n];if(o.frameId!==r){return false}t=t||o.needsRender}return t}),l.distinctUntilChanged(function(e,t){return e===t},function(e){return e.eraser.needsRender?-1:e.camera.frameId})).subscribe(function(e){e.renderer.needsRender=false;e.camera.needsRender=false;e.eraser.needsRender=false;var t=e.camera.perspective;var r=[];var n=[];for(var i=0,o=e.renders;i<o.length;i++){var a=o[i];if(a.stage===f.GLRenderStage.Background){r.push(a.render)}else if(a.stage===f.GLRenderStage.Foreground){n.push(a.render)}}var s=e.renderer.renderer;s.clear();for(var u=0,c=r;u<c.length;u++){var a=c[u];a(t,s)}s.clearDepth();for(var h=0,l=n;h<l.length;h++){var a=l[h];a(t,s)}});this._renderFrame$.pipe(l.map(function(t){return function(e){e.frameId=t.frameId;e.perspective=t.perspective;if(t.changed===true){e.needsRender=true}return e}})).subscribe(this._renderCameraOperation$);this._renderFrameSubscribe();var t=this._render$.pipe(l.map(function(t){return function(e){e[t.name]=t.render;return e}}));var r=this._clear$.pipe(l.map(function(t){return function(e){delete e[t];return e}}));h.merge(t,r).subscribe(this._renderOperation$);this._webGLRenderer$=this._render$.pipe(l.first(),l.map(function(e){var t=a._dom.createElement("canvas","mapillary-js-canvas");t.style.position="absolute";t.setAttribute("tabindex","0");i.appendChild(t);var r=o.element;var n=new p.WebGLRenderer({canvas:t});n.setPixelRatio(window.devicePixelRatio);n.setSize(r.offsetWidth,r.offsetHeight);n.setClearColor(new p.Color(2105376),1);n.autoClear=false;return n}),l.publishReplay(1),l.refCount());this._webGLRenderer$.subscribe(function(){});var n=this._webGLRenderer$.pipe(l.first(),l.map(function(t){return function(e){e.needsRender=true;e.renderer=t;return e}}));var s=this._renderService.size$.pipe(l.map(function(t){return function(e){if(e.renderer==null){return e}e.renderer.setSize(t.width,t.height);e.needsRender=true;return e}}));var u=this._clear$.pipe(l.map(function(e){return function(e){if(e.renderer==null){return e}e.needsRender=true;return e}}));h.merge(n,s,u).subscribe(this._rendererOperation$);var c=this._renderCollection$.pipe(l.filter(function(e){return Object.keys(e).length===0}),l.share());c.subscribe(function(e){if(a._renderFrameSubscription==null){return}a._renderFrameSubscription.unsubscribe();a._renderFrameSubscription=null;a._renderFrameSubscribe()});c.pipe(l.map(function(e){return function(e){e.needsRender=true;return e}})).subscribe(this._eraserOperation$)}Object.defineProperty(e.prototype,"render$",{get:function(){return this._render$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"webGLRenderer$",{get:function(){return this._webGLRenderer$},enumerable:true,configurable:true});e.prototype.clear=function(e){this._clear$.next(e)};e.prototype._renderFrameSubscribe=function(){var t=this;this._render$.pipe(l.first(),l.map(function(e){return function(e){e.needsRender=true;return e}})).subscribe(function(e){t._renderCameraOperation$.next(e)});this._renderFrameSubscription=this._render$.pipe(l.first(),l.mergeMap(function(e){return t._renderService.renderCameraFrame$})).subscribe(this._renderFrame$)};return e}();r.GLRenderer=n;r.default=n},{"../Render":297,"../Utils":301,rxjs:43,"rxjs/operators":241,three:242}],433:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("three");var i=e("../Geo");var s=e("../Render");var u=e("../State");var o=function(){function e(e,t,r){this._spatial=new i.Spatial;this._viewportCoords=new i.ViewportCoords;this._initialFov=50;this._alpha=-1;this._renderMode=r;this._zoom=0;this._frameId=-1;this._changed=false;this._changedForFrame=-1;this._currentNodeId=null;this._previousNodeId=null;this._currentPano=false;this._previousPano=false;this._state=null;this._currentProjectedPoints=[];this._previousProjectedPoints=[];this._currentFov=this._initialFov;this._previousFov=this._initialFov;this._camera=new i.Camera;this._perspective=new n.PerspectiveCamera(this._initialFov,this._computeAspect(e,t),.16,1e4);this._perspective.matrixAutoUpdate=false;this._rotation={phi:0,theta:0}}Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"camera",{get:function(){return this._camera},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"changed",{get:function(){return this._frameId===this._changedForFrame},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"frameId",{get:function(){return this._frameId},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"perspective",{get:function(){return this._perspective},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"renderMode",{get:function(){return this._renderMode},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"zoom",{get:function(){return this._zoom},enumerable:true,configurable:true});e.prototype.getTilt=function(){return 90-this._spatial.radToDeg(this._rotation.theta)};e.prototype.fovToZoom=function(e){e=Math.min(90,Math.max(0,e));var t=this._computeCurrentFov(0);var r=this._alpha===1?t:this._interpolateFov(t,this._computePreviousFov(0),this._alpha);var n=Math.tan(r/2*Math.PI/180);var i=Math.tan(e/2*Math.PI/180);var o=Math.log(n/i)/Math.log(2);return o};e.prototype.setFrame=function(e){var t=e.state;if(t.state!==this._state){this._state=t.state;this._changed=true}var r=t.currentNode.key;var n=!!t.previousNode?t.previousNode.key:null;if(r!==this._currentNodeId){this._currentNodeId=r;this._currentPano=!!t.currentTransform.gpano;this._currentProjectedPoints=this._computeProjectedPoints(t.currentTransform);this._changed=true}if(n!==this._previousNodeId){this._previousNodeId=n;this._previousPano=!!t.previousTransform.gpano;this._previousProjectedPoints=this._computeProjectedPoints(t.previousTransform);this._changed=true}var i=t.zoom;if(i!==this._zoom){this._zoom=i;this._changed=true}if(this._changed){this._currentFov=this._computeCurrentFov(this.zoom);this._previousFov=this._computePreviousFov(this._zoom)}var o=t.alpha;if(this._changed||o!==this._alpha){this._alpha=o;this._perspective.fov=this._state===u.State.Earth?60:this._interpolateFov(this._currentFov,this._previousFov,this._alpha);this._changed=true}var a=t.camera;if(this._camera.diff(a)>1e-9){this._camera.copy(a);this._rotation=this._computeRotation(a);this._perspective.up.copy(a.up);this._perspective.position.copy(a.position);this._perspective.lookAt(a.lookat);this._perspective.updateMatrix();this._perspective.updateMatrixWorld(false);this._changed=true}if(this._changed){this._perspective.updateProjectionMatrix()}this._setFrameId(e.id)};e.prototype.setRenderMode=function(e){this._renderMode=e;this._perspective.fov=this._computeFov();this._perspective.updateProjectionMatrix();this._changed=true};e.prototype.setSize=function(e){this._perspective.aspect=this._computeAspect(e.width,e.height);this._perspective.fov=this._computeFov();this._perspective.updateProjectionMatrix();this._changed=true};e.prototype._computeAspect=function(e,t){return e===0?0:e/t};e.prototype._computeCurrentFov=function(e){if(this._perspective.aspect===0){return 0}if(!this._currentNodeId){return this._initialFov}return this._currentPano?this._yToFov(1,e):this._computeVerticalFov(this._currentProjectedPoints,this._renderMode,e,this.perspective.aspect)};e.prototype._computeFov=function(){this._currentFov=this._computeCurrentFov(this._zoom);this._previousFov=this._computePreviousFov(this._zoom);return this._interpolateFov(this._currentFov,this._previousFov,this._alpha)};e.prototype._computePreviousFov=function(e){if(this._perspective.aspect===0){return 0}if(!this._currentNodeId){return this._initialFov}return!this._previousNodeId?this._currentFov:this._previousPano?this._yToFov(1,e):this._computeVerticalFov(this._previousProjectedPoints,this._renderMode,e,this.perspective.aspect)};e.prototype._computeProjectedPoints=function(e){var t=[[.5,0],[1,0]];var r=[[.5,0],[0,.5]];var n=100;return i.Geo.computeProjectedPoints(e,t,r,n,this._viewportCoords)};e.prototype._computeRequiredVerticalFov=function(e,t,r){var n=Math.max(e[0]/r,e[1]);return this._yToFov(n,t)};e.prototype._computeRotation=function(e){var t=e.lookat.clone().sub(e.position);var r=e.up.clone();var n=this._spatial.azimuthal(t.toArray(),r.toArray());var i=Math.PI/2-this._spatial.angleToPlane(t.toArray(),[0,0,1]);return{phi:n,theta:i}};e.prototype._computeVerticalFov=function(e,t,r,n){var i=this;var o=e.map(function(e){return i._computeRequiredVerticalFov(e,r,n)});var a=t===s.RenderMode.Fill?Math.min.apply(Math,o)*.995:Math.max.apply(Math,o);return a};e.prototype._yToFov=function(e,t){return 2*Math.atan(e/Math.pow(2,t))*180/Math.PI};e.prototype._interpolateFov=function(e,t,r){return r*e+(1-r)*t};e.prototype._setFrameId=function(e){this._frameId=e;if(this._changed){this._changed=false;this._changedForFrame=e}};return e}();r.RenderCamera=o;r.default=o},{"../Geo":294,"../Render":297,"../State":298,three:242}],434:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["Letterbox"]=0]="Letterbox";e[e["Fill"]=1]="Fill"})(n=r.RenderMode||(r.RenderMode={}));r.default=n},{}],435:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=e("rxjs/operators");var a=e("rxjs");var s=e("../Geo");var u=e("../Render");var n=function(){function e(e,t,r,n){var i=this;this._element=e;this._currentFrame$=t;this._spatial=new s.Spatial;r=r!=null?r:u.RenderMode.Fill;this._resize$=new a.Subject;this._renderCameraOperation$=new a.Subject;this._size$=new a.BehaviorSubject({height:this._element.offsetHeight,width:this._element.offsetWidth});this._resize$.pipe(o.map(function(){return{height:i._element.offsetHeight,width:i._element.offsetWidth}})).subscribe(this._size$);this._renderMode$=new a.BehaviorSubject(r);this._renderCameraHolder$=this._renderCameraOperation$.pipe(o.startWith(function(e){return e}),o.scan(function(e,t){return t(e)},!!n?n:new u.RenderCamera(this._element.offsetWidth,this._element.offsetHeight,r)),o.publishReplay(1),o.refCount());this._renderCameraFrame$=this._currentFrame$.pipe(o.withLatestFrom(this._renderCameraHolder$),o.tap(function(e){var t=e[0],r=e[1];r.setFrame(t)}),o.map(function(e){return e[1]}),o.publishReplay(1),o.refCount());this._renderCamera$=this._renderCameraFrame$.pipe(o.filter(function(e){return e.changed}),o.publishReplay(1),o.refCount());this._bearing$=this._renderCamera$.pipe(o.map(function(e){var t=i._spatial.radToDeg(i._spatial.azimuthalToBearing(e.rotation.phi));return i._spatial.wrap(t,0,360)}),o.publishReplay(1),o.refCount());this._size$.pipe(o.skip(1),o.map(function(t){return function(e){e.setSize(t);return e}})).subscribe(this._renderCameraOperation$);this._renderMode$.pipe(o.skip(1),o.map(function(t){return function(e){e.setRenderMode(t);return e}})).subscribe(this._renderCameraOperation$);this._bearing$.subscribe(function(){});this._renderCameraHolder$.subscribe(function(){});this._size$.subscribe(function(){});this._renderMode$.subscribe(function(){});this._renderCamera$.subscribe(function(){});this._renderCameraFrame$.subscribe(function(){})}Object.defineProperty(e.prototype,"bearing$",{get:function(){return this._bearing$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"element",{get:function(){return this._element},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"resize$",{get:function(){return this._resize$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"size$",{get:function(){return this._size$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"renderMode$",{get:function(){return this._renderMode$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"renderCameraFrame$",{get:function(){return this._renderCameraFrame$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"renderCamera$",{get:function(){return this._renderCamera$},enumerable:true,configurable:true});return e}();r.RenderService=n;r.default=n},{"../Geo":294,"../Render":297,rxjs:43,"rxjs/operators":241}],436:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(t){if(t.requestAnimationFrame){this._cancelAnimationFrame=t.cancelAnimationFrame.bind(t);this._requestAnimationFrame=t.requestAnimationFrame.bind(t)}else if(t.mozRequestAnimationFrame){this._cancelAnimationFrame=t.mozCancelAnimationFrame.bind(t);this._requestAnimationFrame=t.mozRequestAnimationFrame.bind(t)}else if(t.webkitRequestAnimationFrame){this._cancelAnimationFrame=t.webkitCancelAnimationFrame.bind(t);this._requestAnimationFrame=t.webkitRequestAnimationFrame.bind(t)}else if(t.msRequestAnimationFrame){this._cancelAnimationFrame=t.msCancelAnimationFrame.bind(t);this._requestAnimationFrame=t.msRequestAnimationFrame.bind(t)}else if(t.oRequestAnimationFrame){this._cancelAnimationFrame=t.oCancelAnimationFrame.bind(t);this._requestAnimationFrame=t.oRequestAnimationFrame.bind(t)}else{this._cancelAnimationFrame=t.clearTimeout.bind(t);this._requestAnimationFrame=function(e){return t.setTimeout(e,1e3/60)}}}Object.defineProperty(e.prototype,"cancelAnimationFrame",{get:function(){return this._cancelAnimationFrame},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"requestAnimationFrame",{get:function(){return this._requestAnimationFrame},enumerable:true,configurable:true});return e}();r.FrameGenerator=n;r.default=n},{}],437:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(e,t){this._phi=e;this._theta=t}Object.defineProperty(e.prototype,"phi",{get:function(){return this._phi},set:function(e){this._phi=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"theta",{get:function(){return this._theta},set:function(e){this._theta=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"isZero",{get:function(){return this._phi===0&&this._theta===0},enumerable:true,configurable:true});e.prototype.copy=function(e){this._phi=e.phi;this._theta=e.theta};e.prototype.lerp=function(e,t){this._phi=(1-t)*this._phi+t*e.phi;this._theta=(1-t)*this._theta+t*e.theta};e.prototype.multiply=function(e){this._phi*=e;this._theta*=e};e.prototype.threshold=function(e){this._phi=Math.abs(this._phi)>e?this._phi:0;this._theta=Math.abs(this._theta)>e?this._theta:0};e.prototype.lengthSquared=function(){return this._phi*this._phi+this._theta*this._theta};e.prototype.reset=function(){this._phi=0;this._theta=0};return e}();r.RotationDelta=n;r.default=n},{}],438:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["Earth"]=0]="Earth";e[e["Traversing"]=1]="Traversing";e[e["Waiting"]=2]="Waiting";e[e["WaitingInteractively"]=3]="WaitingInteractively"})(n=r.State||(r.State={}));r.default=n},{}],439:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../State");var i=e("../Geo");var o=function(){function e(e){this._state=new n.TraversingState({alpha:1,camera:new i.Camera,currentIndex:-1,reference:{alt:0,lat:0,lon:0},trajectory:[],transitionMode:e==null?n.TransitionMode.Default:e,zoom:0})}e.prototype.earth=function(){this._state=this._state.earth()};e.prototype.traverse=function(){this._state=this._state.traverse()};e.prototype.wait=function(){this._state=this._state.wait()};e.prototype.waitInteractively=function(){this._state=this._state.waitInteractively()};Object.defineProperty(e.prototype,"state",{get:function(){if(this._state instanceof n.EarthState){return n.State.Earth}else if(this._state instanceof n.TraversingState){return n.State.Traversing}else if(this._state instanceof n.WaitingState){return n.State.Waiting}else if(this._state instanceof n.InteractiveWaitingState){return n.State.WaitingInteractively}throw new Error("Invalid state")},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"reference",{get:function(){return this._state.reference},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"alpha",{get:function(){return this._state.alpha},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"camera",{get:function(){return this._state.camera},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"zoom",{get:function(){return this._state.zoom},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"currentNode",{get:function(){return this._state.currentNode},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"previousNode",{get:function(){return this._state.previousNode},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"currentCamera",{get:function(){return this._state.currentCamera},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"currentTransform",{get:function(){return this._state.currentTransform},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"previousTransform",{get:function(){return this._state.previousTransform},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"trajectory",{get:function(){return this._state.trajectory},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"currentIndex",{get:function(){return this._state.currentIndex},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"lastNode",{get:function(){return this._state.trajectory[this._state.trajectory.length-1]},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"nodesAhead",{get:function(){return this._state.trajectory.length-1-this._state.currentIndex},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"motionless",{get:function(){return this._state.motionless},enumerable:true,configurable:true});e.prototype.getCenter=function(){return this._state.getCenter()};e.prototype.setCenter=function(e){this._state.setCenter(e)};e.prototype.setZoom=function(e){this._state.setZoom(e)};e.prototype.update=function(e){this._state.update(e)};e.prototype.append=function(e){this._state.append(e)};e.prototype.prepend=function(e){this._state.prepend(e)};e.prototype.remove=function(e){this._state.remove(e)};e.prototype.clear=function(){this._state.clear()};e.prototype.clearPrior=function(){this._state.clearPrior()};e.prototype.cut=function(){this._state.cut()};e.prototype.set=function(e){this._state.set(e)};e.prototype.rotate=function(e){this._state.rotate(e)};e.prototype.rotateUnbounded=function(e){this._state.rotateUnbounded(e)};e.prototype.rotateWithoutInertia=function(e){this._state.rotateWithoutInertia(e)};e.prototype.rotateBasic=function(e){this._state.rotateBasic(e)};e.prototype.rotateBasicUnbounded=function(e){this._state.rotateBasicUnbounded(e)};e.prototype.rotateBasicWithoutInertia=function(e){this._state.rotateBasicWithoutInertia(e)};e.prototype.rotateToBasic=function(e){this._state.rotateToBasic(e)};e.prototype.move=function(e){this._state.move(e)};e.prototype.moveTo=function(e){this._state.moveTo(e)};e.prototype.zoomIn=function(e,t){this._state.zoomIn(e,t)};e.prototype.setSpeed=function(e){this._state.setSpeed(e)};e.prototype.setTransitionMode=function(e){this._state.setTransitionMode(e)};e.prototype.dolly=function(e){this._state.dolly(e)};e.prototype.orbit=function(e){this._state.orbit(e)};e.prototype.truck=function(e){this._state.truck(e)};return e}();r.StateContext=o},{"../Geo":294,"../State":298}],440:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("rxjs");var o=e("rxjs/operators");var a=e("../State");var n=function(){function e(e){var t=this;this._appendNode$=new i.Subject;this._start$=new i.Subject;this._frame$=new i.Subject;this._fpsSampleRate=30;this._contextOperation$=new i.BehaviorSubject(function(e){return e});this._context$=this._contextOperation$.pipe(o.scan(function(e,t){return t(e)},new a.StateContext(e)),o.publishReplay(1),o.refCount());this._state$=this._context$.pipe(o.map(function(e){return e.state}),o.distinctUntilChanged(),o.publishReplay(1),o.refCount());this._fps$=this._start$.pipe(o.switchMap(function(){return t._frame$.pipe(o.bufferCount(1,t._fpsSampleRate),o.map(function(e){return(new Date).getTime()}),o.pairwise(),o.map(function(e){return Math.max(20,1e3*t._fpsSampleRate/(e[1]-e[0]))}),o.startWith(60))}),o.share());this._currentState$=this._frame$.pipe(o.withLatestFrom(this._fps$,this._context$,function(e,t,r){return[e,t,r]}),o.filter(function(e){return e[2].currentNode!=null}),o.tap(function(e){e[2].update(e[1])}),o.map(function(e){return{fps:e[1],id:e[0],state:e[2]}}),o.share());this._lastState$=this._currentState$.pipe(o.publishReplay(1),o.refCount());var r=this._currentState$.pipe(o.distinctUntilChanged(undefined,function(e){return e.state.currentNode.key}),o.publishReplay(1),o.refCount());var n=new i.Subject;r.subscribe(n);this._currentKey$=new i.BehaviorSubject(null);n.pipe(o.map(function(e){return e.state.currentNode.key})).subscribe(this._currentKey$);this._currentNode$=n.pipe(o.map(function(e){return e.state.currentNode}),o.publishReplay(1),o.refCount());this._currentCamera$=n.pipe(o.map(function(e){return e.state.currentCamera}),o.publishReplay(1),o.refCount());this._currentTransform$=n.pipe(o.map(function(e){return e.state.currentTransform}),o.publishReplay(1),o.refCount());this._reference$=n.pipe(o.map(function(e){return e.state.reference}),o.distinctUntilChanged(function(e,t){return e.lat===t.lat&&e.lon===t.lon},function(e){return{lat:e.lat,lon:e.lon}}),o.publishReplay(1),o.refCount());this._currentNodeExternal$=r.pipe(o.map(function(e){return e.state.currentNode}),o.publishReplay(1),o.refCount());this._appendNode$.pipe(o.map(function(t){return function(e){e.append([t]);return e}})).subscribe(this._contextOperation$);this._inMotionOperation$=new i.Subject;r.pipe(o.map(function(e){return true})).subscribe(this._inMotionOperation$);this._inMotionOperation$.pipe(o.distinctUntilChanged(),o.filter(function(e){return e}),o.switchMap(function(e){return t._currentState$.pipe(o.filter(function(e){return e.state.nodesAhead===0}),o.map(function(e){return[e.state.camera.clone(),e.state.zoom]}),o.pairwise(),o.map(function(e){var t=e[0][0];var r=e[1][0];var n=e[0][1];var i=e[1][1];return t.diff(r)>1e-5||Math.abs(n-i)>1e-5}),o.first(function(e){return!e}))})).subscribe(this._inMotionOperation$);this._inMotion$=this._inMotionOperation$.pipe(o.distinctUntilChanged(),o.publishReplay(1),o.refCount());this._inTranslationOperation$=new i.Subject;r.pipe(o.map(function(e){return true})).subscribe(this._inTranslationOperation$);this._inTranslationOperation$.pipe(o.distinctUntilChanged(),o.filter(function(e){return e}),o.switchMap(function(e){return t._currentState$.pipe(o.filter(function(e){return e.state.nodesAhead===0}),o.map(function(e){return e.state.camera.position.clone()}),o.pairwise(),o.map(function(e){return e[0].distanceToSquared(e[1])!==0}),o.first(function(e){return!e}))})).subscribe(this._inTranslationOperation$);this._inTranslation$=this._inTranslationOperation$.pipe(o.distinctUntilChanged(),o.publishReplay(1),o.refCount());this._state$.subscribe(function(){});this._currentNode$.subscribe(function(){});this._currentCamera$.subscribe(function(){});this._currentTransform$.subscribe(function(){});this._reference$.subscribe(function(){});this._currentNodeExternal$.subscribe(function(){});this._lastState$.subscribe(function(){});this._inMotion$.subscribe(function(){});this._inTranslation$.subscribe(function(){});this._frameId=null;this._frameGenerator=new a.FrameGenerator(window)}Object.defineProperty(e.prototype,"currentState$",{get:function(){return this._currentState$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"currentNode$",{get:function(){return this._currentNode$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"currentKey$",{get:function(){return this._currentKey$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"currentNodeExternal$",{get:function(){return this._currentNodeExternal$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"currentCamera$",{get:function(){return this._currentCamera$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"currentTransform$",{get:function(){return this._currentTransform$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"state$",{get:function(){return this._state$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"reference$",{get:function(){return this._reference$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"inMotion$",{get:function(){return this._inMotion$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"inTranslation$",{get:function(){return this._inTranslation$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"appendNode$",{get:function(){return this._appendNode$},enumerable:true,configurable:true});e.prototype.earth=function(){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.earth()})};e.prototype.traverse=function(){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.traverse()})};e.prototype.wait=function(){this._invokeContextOperation(function(e){e.wait()})};e.prototype.waitInteractively=function(){this._invokeContextOperation(function(e){e.waitInteractively()})};e.prototype.appendNodes=function(t){this._invokeContextOperation(function(e){e.append(t)})};e.prototype.prependNodes=function(t){this._invokeContextOperation(function(e){e.prepend(t)})};e.prototype.removeNodes=function(t){this._invokeContextOperation(function(e){e.remove(t)})};e.prototype.clearNodes=function(){this._invokeContextOperation(function(e){e.clear()})};e.prototype.clearPriorNodes=function(){this._invokeContextOperation(function(e){e.clearPrior()})};e.prototype.cutNodes=function(){this._invokeContextOperation(function(e){e.cut()})};e.prototype.setNodes=function(t){this._invokeContextOperation(function(e){e.set(t)})};e.prototype.rotate=function(t){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.rotate(t)})};e.prototype.rotateUnbounded=function(t){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.rotateUnbounded(t)})};e.prototype.rotateWithoutInertia=function(t){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.rotateWithoutInertia(t)})};e.prototype.rotateBasic=function(t){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.rotateBasic(t)})};e.prototype.rotateBasicUnbounded=function(t){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.rotateBasicUnbounded(t)})};e.prototype.rotateBasicWithoutInertia=function(t){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.rotateBasicWithoutInertia(t)})};e.prototype.rotateToBasic=function(t){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.rotateToBasic(t)})};e.prototype.move=function(t){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.move(t)})};e.prototype.moveTo=function(t){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.moveTo(t)})};e.prototype.dolly=function(t){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.dolly(t)})};e.prototype.orbit=function(t){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.orbit(t)})};e.prototype.truck=function(t){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.truck(t)})};e.prototype.zoomIn=function(t,r){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.zoomIn(t,r)})};e.prototype.getCenter=function(){return this._lastState$.pipe(o.first(),o.map(function(e){return e.state.getCenter()}))};e.prototype.getZoom=function(){return this._lastState$.pipe(o.first(),o.map(function(e){return e.state.zoom}))};e.prototype.setCenter=function(t){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.setCenter(t)})};e.prototype.setSpeed=function(t){this._invokeContextOperation(function(e){e.setSpeed(t)})};e.prototype.setTransitionMode=function(t){this._invokeContextOperation(function(e){e.setTransitionMode(t)})};e.prototype.setZoom=function(t){this._inMotionOperation$.next(true);this._invokeContextOperation(function(e){e.setZoom(t)})};e.prototype.start=function(){if(this._frameId==null){this._start$.next(null);this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this));this._frame$.next(this._frameId)}};e.prototype.stop=function(){if(this._frameId!=null){this._frameGenerator.cancelAnimationFrame(this._frameId);this._frameId=null}};e.prototype._invokeContextOperation=function(t){this._contextOperation$.next(function(e){t(e);return e})};e.prototype._frame=function(e){this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this));this._frame$.next(this._frameId)};return e}();r.StateService=n},{"../State":298,rxjs:43,"rxjs/operators":241}],441:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["Default"]=0]="Default";e[e["Instantaneous"]=1]="Instantaneous"})(n=r.TransitionMode||(r.TransitionMode={}));r.default=n},{}],442:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var u=e("three");var o=e("../../State");var n=function(n){i(e,n);function e(e){var t=n.call(this,e)||this;var r=t._camera.lookat.clone().sub(t._camera.position).normalize();t._camera.lookat.copy(t._camera.position);t._camera.position.z=e.camera.position.z+20;t._camera.position.x=e.camera.position.x-16*r.x;t._camera.position.y=e.camera.position.y-16*r.y;t._camera.up.set(0,0,1);return t}e.prototype.traverse=function(){return new o.TraversingState(this)};e.prototype.wait=function(){return new o.WaitingState(this)};e.prototype.waitInteractively=function(){return new o.InteractiveWaitingState(this)};e.prototype.dolly=function(e){var t=this._camera;var r=(new u.Vector3).copy(t.position).sub(t.lookat);var n=r.length();var i=n*Math.pow(2,-e);var o=Math.max(1,Math.min(i,1e3));r.normalize();r.multiplyScalar(o);t.position.copy(t.lookat).add(r)};e.prototype.orbit=function(e){var t=this._camera;var r=(new u.Quaternion).setFromUnitVectors(t.up,new u.Vector3(0,0,1));var n=r.clone().inverse();var i=new u.Vector3;i.copy(t.position).sub(t.lookat);i.applyQuaternion(r);var o=i.length();var a=Math.atan2(i.y,i.x);a+=e.phi;var s=Math.atan2(Math.sqrt(i.x*i.x+i.y*i.y),i.z);s+=e.theta;s=Math.max(.1,Math.min(Math.PI-.1,s));i.x=Math.sin(s)*Math.cos(a);i.y=Math.sin(s)*Math.sin(a);i.z=Math.cos(s);i.applyQuaternion(n);t.position.copy(t.lookat).add(i.multiplyScalar(o))};e.prototype.truck=function(e){this._camera.position.add((new u.Vector3).fromArray(e));this._camera.lookat.add((new u.Vector3).fromArray(e))};e.prototype.update=function(){};return e}(o.StateBase);r.EarthState=n;r.default=n},{"../../State":298,three:242}],443:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var p=e("three");var i=e("../../State");var o=function(r){n(e,r);function e(e){var t=r.call(this,e)||this;t._animationSpeed=1/40;t._rotationDelta=new i.RotationDelta(0,0);t._requestedRotationDelta=null;t._basicRotation=[0,0];t._requestedBasicRotation=null;t._requestedBasicRotationUnbounded=null;t._rotationAcceleration=.86;t._rotationIncreaseAlpha=.97;t._rotationDecreaseAlpha=.9;t._rotationThreshold=.001;t._unboundedRotationAlpha=.8;t._desiredZoom=e.zoom;t._minZoom=0;t._maxZoom=3;t._lookatDepth=10;t._desiredLookat=null;t._desiredCenter=null;return t}e.prototype.rotate=function(e){if(this._currentNode==null){return}if(e.phi===0&&e.theta===0){return}this._desiredZoom=this._zoom;this._desiredLookat=null;this._requestedBasicRotation=null;if(this._requestedRotationDelta!=null){this._requestedRotationDelta.phi=this._requestedRotationDelta.phi+e.phi;this._requestedRotationDelta.theta=this._requestedRotationDelta.theta+e.theta}else{this._requestedRotationDelta=new i.RotationDelta(e.phi,e.theta)}};e.prototype.rotateUnbounded=function(e){if(this._currentNode==null){return}this._requestedBasicRotation=null;this._requestedRotationDelta=null;this._applyRotation(e,this._currentCamera);this._applyRotation(e,this._previousCamera);if(!this._desiredLookat){return}var t=(new p.Quaternion).setFromUnitVectors(this._currentCamera.up,new p.Vector3(0,0,1));var r=t.clone().inverse();var n=(new p.Vector3).copy(this._desiredLookat).sub(this._camera.position).applyQuaternion(t);var i=n.length();var o=Math.atan2(n.y,n.x);o+=e.phi;var a=Math.atan2(Math.sqrt(n.x*n.x+n.y*n.y),n.z);a+=e.theta;a=Math.max(.1,Math.min(Math.PI-.1,a));n.x=Math.sin(a)*Math.cos(o);n.y=Math.sin(a)*Math.sin(o);n.z=Math.cos(a);n.applyQuaternion(r);this._desiredLookat.copy(this._camera.position).add(n.multiplyScalar(i))};e.prototype.rotateWithoutInertia=function(e){if(this._currentNode==null){return}this._desiredZoom=this._zoom;this._desiredLookat=null;this._requestedBasicRotation=null;this._requestedRotationDelta=null;var t=Math.PI/(10*Math.pow(2,this._zoom));var r={phi:this._spatial.clamp(e.phi,-t,t),theta:this._spatial.clamp(e.theta,-t,t)};this._applyRotation(r,this._currentCamera);this._applyRotation(r,this._previousCamera)};e.prototype.rotateBasic=function(e){if(this._currentNode==null){return}this._desiredZoom=this._zoom;this._desiredLookat=null;this._requestedRotationDelta=null;if(this._requestedBasicRotation!=null){this._requestedBasicRotation[0]+=e[0];this._requestedBasicRotation[1]+=e[1];var t=.05/Math.pow(2,this._zoom);this._requestedBasicRotation[0]=this._spatial.clamp(this._requestedBasicRotation[0],-t,t);this._requestedBasicRotation[1]=this._spatial.clamp(this._requestedBasicRotation[1],-t,t)}else{this._requestedBasicRotation=e.slice()}};e.prototype.rotateBasicUnbounded=function(e){if(this._currentNode==null){return}if(this._requestedBasicRotationUnbounded!=null){this._requestedBasicRotationUnbounded[0]+=e[0];this._requestedBasicRotationUnbounded[1]+=e[1]}else{this._requestedBasicRotationUnbounded=e.slice()}};e.prototype.rotateBasicWithoutInertia=function(e){if(this._currentNode==null){return}this._desiredZoom=this._zoom;this._desiredLookat=null;this._requestedRotationDelta=null;this._requestedBasicRotation=null;var t=.05/Math.pow(2,this._zoom);var r=e.slice();r[0]=this._spatial.clamp(r[0],-t,t);r[1]=this._spatial.clamp(r[1],-t,t);this._applyRotationBasic(r)};e.prototype.rotateToBasic=function(e){if(this._currentNode==null){return}this._desiredZoom=this._zoom;this._desiredLookat=null;e[0]=this._spatial.clamp(e[0],0,1);e[1]=this._spatial.clamp(e[1],0,1);var t=this.currentTransform.unprojectBasic(e,this._lookatDepth);this._currentCamera.lookat.fromArray(t)};e.prototype.zoomIn=function(e,t){if(this._currentNode==null){return}this._desiredZoom=Math.max(this._minZoom,Math.min(this._maxZoom,this._desiredZoom+e));var r=this.currentTransform.projectBasic(this._currentCamera.lookat.toArray());var n=r[0];var i=r[1];var o=Math.pow(2,this._zoom);var a=Math.pow(2,this._desiredZoom);var s=t[0];var u=t[1];if(this.currentTransform.gpano!=null&&this.currentTransform.gpano.CroppedAreaImageWidthPixels===this.currentTransform.gpano.FullPanoWidthPixels){if(s-n>.5){s=s-1}else if(n-s>.5){s=1+s}}var c=s-o/a*(s-n);var h=u-o/a*(u-i);var l=this.currentTransform.gpano;if(this._currentNode.fullPano){c=this._spatial.wrap(c+this._basicRotation[0],0,1);h=this._spatial.clamp(h+this._basicRotation[1],.05,.95)}else if(l!=null&&this.currentTransform.gpano.CroppedAreaImageWidthPixels===this.currentTransform.gpano.FullPanoWidthPixels){c=this._spatial.wrap(c+this._basicRotation[0],0,1);h=this._spatial.clamp(h+this._basicRotation[1],0,1)}else{c=this._spatial.clamp(c,0,1);h=this._spatial.clamp(h,0,1)}this._desiredLookat=(new p.Vector3).fromArray(this.currentTransform.unprojectBasic([c,h],this._lookatDepth))};e.prototype.setCenter=function(e){this._desiredLookat=null;this._requestedRotationDelta=null;this._requestedBasicRotation=null;this._desiredZoom=this._zoom;var t=[this._spatial.clamp(e[0],0,1),this._spatial.clamp(e[1],0,1)];if(this._currentNode==null){this._desiredCenter=t;return}this._desiredCenter=null;var r=(new p.Vector3).fromArray(this.currentTransform.unprojectBasic(t,this._lookatDepth));var n=this.previousTransform!=null?this.previousTransform:this.currentTransform;var i=(new p.Vector3).fromArray(n.unprojectBasic(t,this._lookatDepth));this._currentCamera.lookat.copy(r);this._previousCamera.lookat.copy(i)};e.prototype.setZoom=function(e){this._desiredLookat=null;this._requestedRotationDelta=null;this._requestedBasicRotation=null;this._zoom=this._spatial.clamp(e,this._minZoom,this._maxZoom);this._desiredZoom=this._zoom};e.prototype._applyRotation=function(e,t){if(t==null){return}var r=(new p.Quaternion).setFromUnitVectors(t.up,new p.Vector3(0,0,1));var n=r.clone().inverse();var i=new p.Vector3;i.copy(t.lookat).sub(t.position);i.applyQuaternion(r);var o=i.length();var a=Math.atan2(i.y,i.x);a+=e.phi;var s=Math.atan2(Math.sqrt(i.x*i.x+i.y*i.y),i.z);s+=e.theta;s=Math.max(.1,Math.min(Math.PI-.1,s));i.x=Math.sin(s)*Math.cos(a);i.y=Math.sin(s)*Math.sin(a);i.z=Math.cos(s);i.applyQuaternion(n);t.lookat.copy(t.position).add(i.multiplyScalar(o))};e.prototype._applyRotationBasic=function(e){var t=this._currentNode;var r=this._previousNode!=null?this.previousNode:this.currentNode;var n=this._currentCamera;var i=this._previousCamera;var o=this.currentTransform;var a=this.previousTransform!=null?this.previousTransform:this.currentTransform;var s=o.projectBasic(n.lookat.toArray());var u=a.projectBasic(i.lookat.toArray());var c=o.gpano;var h=a.gpano;if(t.fullPano){s[0]=this._spatial.wrap(s[0]+e[0],0,1);s[1]=this._spatial.clamp(s[1]+e[1],.05,.95)}else if(c!=null&&o.gpano.CroppedAreaImageWidthPixels===o.gpano.FullPanoWidthPixels){s[0]=this._spatial.wrap(s[0]+e[0],0,1);s[1]=this._spatial.clamp(s[1]+e[1],0,1)}else{s[0]=this._spatial.clamp(s[0]+e[0],0,1);s[1]=this._spatial.clamp(s[1]+e[1],0,1)}if(r.fullPano){u[0]=this._spatial.wrap(u[0]+e[0],0,1);u[1]=this._spatial.clamp(u[1]+e[1],.05,.95)}else if(h!=null&&a.gpano.CroppedAreaImageWidthPixels===a.gpano.FullPanoWidthPixels){u[0]=this._spatial.wrap(u[0]+e[0],0,1);u[1]=this._spatial.clamp(u[1]+e[1],0,1)}else{u[0]=this._spatial.clamp(u[0]+e[0],0,1);u[1]=this._spatial.clamp(s[1]+e[1],0,1)}var l=o.unprojectBasic(s,this._lookatDepth);n.lookat.fromArray(l);var p=a.unprojectBasic(u,this._lookatDepth);i.lookat.fromArray(p)};e.prototype._updateZoom=function(e){var t=this._desiredZoom-this._zoom;var r=t>0?1:t<0?-1:0;if(t===0){return}else if(Math.abs(t)<.002){this._zoom=this._desiredZoom;if(this._desiredLookat!=null){this._desiredLookat=null}}else{this._zoom+=r*Math.max(Math.abs(5*e*t),.002)}};e.prototype._updateLookat=function(e){if(this._desiredLookat===null){return}var t=this._desiredLookat.distanceToSquared(this._currentCamera.lookat);if(Math.abs(t)<1e-6){this._currentCamera.lookat.copy(this._desiredLookat);this._desiredLookat=null}else{this._currentCamera.lookat.lerp(this._desiredLookat,5*e)}};e.prototype._updateRotation=function(){if(this._requestedRotationDelta!=null){var e=this._rotationDelta.lengthSquared();var t=this._requestedRotationDelta.lengthSquared();if(t>e){this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationIncreaseAlpha)}else{this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationDecreaseAlpha)}this._requestedRotationDelta=null;return}if(this._rotationDelta.isZero){return}var r=this.currentNode.fullPano?1:this._alpha;this._rotationDelta.multiply(this._rotationAcceleration*r);this._rotationDelta.threshold(this._rotationThreshold)};e.prototype._updateRotationBasic=function(){if(this._requestedBasicRotation!=null){var e=this._basicRotation[0];var t=this._basicRotation[1];var r=this._requestedBasicRotation[0];var n=this._requestedBasicRotation[1];if(Math.abs(r)>Math.abs(e)){this._basicRotation[0]=(1-this._rotationIncreaseAlpha)*e+this._rotationIncreaseAlpha*r}else{this._basicRotation[0]=(1-this._rotationDecreaseAlpha)*e+this._rotationDecreaseAlpha*r}if(Math.abs(n)>Math.abs(t)){this._basicRotation[1]=(1-this._rotationIncreaseAlpha)*t+this._rotationIncreaseAlpha*n}else{this._basicRotation[1]=(1-this._rotationDecreaseAlpha)*t+this._rotationDecreaseAlpha*n}this._requestedBasicRotation=null;return}if(this._requestedBasicRotationUnbounded!=null){var r=this._requestedBasicRotationUnbounded[0];var n=this._requestedBasicRotationUnbounded[1];if(Math.abs(r)>0){this._basicRotation[0]=(1-this._unboundedRotationAlpha)*this._basicRotation[0]+this._unboundedRotationAlpha*r}if(Math.abs(n)>0){this._basicRotation[1]=(1-this._unboundedRotationAlpha)*this._basicRotation[1]+this._unboundedRotationAlpha*n}if(this._desiredLookat!=null){var i=this.currentTransform.projectBasic(this._desiredLookat.toArray());i[0]+=r;i[1]+=n;this._desiredLookat=(new p.Vector3).fromArray(this.currentTransform.unprojectBasic(i,this._lookatDepth))}this._requestedBasicRotationUnbounded=null}if(this._basicRotation[0]===0&&this._basicRotation[1]===0){return}this._basicRotation[0]=this._rotationAcceleration*this._basicRotation[0];this._basicRotation[1]=this._rotationAcceleration*this._basicRotation[1];if(Math.abs(this._basicRotation[0])<this._rotationThreshold/Math.pow(2,this._zoom)&&Math.abs(this._basicRotation[1])<this._rotationThreshold/Math.pow(2,this._zoom)){this._basicRotation=[0,0]}};e.prototype._clearRotation=function(){if(this._currentNode.fullPano){return}if(this._requestedRotationDelta!=null){this._requestedRotationDelta=null}if(!this._rotationDelta.isZero){this._rotationDelta.reset()}if(this._requestedBasicRotation!=null){this._requestedBasicRotation=null}if(this._basicRotation[0]>0||this._basicRotation[1]>0){this._basicRotation=[0,0]}};e.prototype._setDesiredCenter=function(){if(this._desiredCenter==null){return}var e=(new p.Vector3).fromArray(this.currentTransform.unprojectBasic(this._desiredCenter,this._lookatDepth)).sub(this._currentCamera.position);this._currentCamera.lookat.copy(this._currentCamera.position.clone().add(e));this._previousCamera.lookat.copy(this._previousCamera.position.clone().add(e));this._desiredCenter=null};e.prototype._setDesiredZoom=function(){this._desiredZoom=this._currentNode.fullPano||this._previousNode==null?this._zoom:0};return e}(i.StateBase);r.InteractiveStateBase=o;r.default=o},{"../../State":298,three:242}],444:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../../State");var o=function(r){n(e,r);function e(e){var t=r.call(this,e)||this;t._adjustCameras();t._motionless=t._motionlessTransition();return t}e.prototype.traverse=function(){return new i.TraversingState(this)};e.prototype.wait=function(){return new i.WaitingState(this)};e.prototype.prepend=function(e){r.prototype.prepend.call(this,e);this._motionless=this._motionlessTransition()};e.prototype.set=function(e){r.prototype.set.call(this,e);this._motionless=this._motionlessTransition()};e.prototype.move=function(e){this._alpha=Math.max(0,Math.min(1,this._alpha+e))};e.prototype.moveTo=function(e){this._alpha=Math.max(0,Math.min(1,e))};e.prototype.update=function(e){this._updateRotation();if(!this._rotationDelta.isZero){this._applyRotation(this._rotationDelta,this._previousCamera);this._applyRotation(this._rotationDelta,this._currentCamera)}this._updateRotationBasic();if(this._basicRotation[0]!==0||this._basicRotation[1]!==0){this._applyRotationBasic(this._basicRotation)}var t=this._animationSpeed*(60/e);this._updateZoom(t);this._updateLookat(t);this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)};e.prototype._getAlpha=function(){return this._motionless?Math.round(this._alpha):this._alpha};e.prototype._setCurrentCamera=function(){r.prototype._setCurrentCamera.call(this);this._adjustCameras()};e.prototype._adjustCameras=function(){if(this._previousNode==null){return}if(this._currentNode.fullPano){var e=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}if(this._previousNode.fullPano){var e=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position))}};return e}(i.InteractiveStateBase);r.InteractiveWaitingState=o;r.default=o},{"../../State":298}],445:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var a=e("../../Error");var s=e("../../Geo");var n=e("../../State");var i=function(){function e(e){this._spatial=new s.Spatial;this._geoCoords=new s.GeoCoords;this._referenceThreshold=.01;this._transitionMode=e.transitionMode;this._reference=e.reference;this._alpha=e.alpha;this._camera=e.camera.clone();this._zoom=e.zoom;this._currentIndex=e.currentIndex;this._trajectory=e.trajectory.slice();this._trajectoryTransforms=[];this._trajectoryCameras=[];for(var t=0,r=this._trajectory;t<r.length;t++){var n=r[t];var i=this._nodeToTranslation(n,this._reference);var o=new s.Transform(n.orientation,n.width,n.height,n.focal,n.scale,n.gpano,n.rotation,i,n.image,undefined,n.ck1,n.ck2,n.cameraProjection);this._trajectoryTransforms.push(o);this._trajectoryCameras.push(new s.Camera(o))}this._currentNode=this._trajectory.length>0?this._trajectory[this._currentIndex]:null;this._previousNode=this._trajectory.length>1&&this.currentIndex>0?this._trajectory[this._currentIndex-1]:null;this._currentCamera=this._trajectoryCameras.length>0?this._trajectoryCameras[this._currentIndex].clone():new s.Camera;this._previousCamera=this._trajectoryCameras.length>1&&this.currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}Object.defineProperty(e.prototype,"reference",{get:function(){return this._reference},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"alpha",{get:function(){return this._getAlpha()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"camera",{get:function(){return this._camera},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"zoom",{get:function(){return this._zoom},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"trajectory",{get:function(){return this._trajectory},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"currentIndex",{get:function(){return this._currentIndex},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"currentNode",{get:function(){return this._currentNode},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"previousNode",{get:function(){return this._previousNode},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"currentCamera",{get:function(){return this._currentCamera},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"currentTransform",{get:function(){return this._trajectoryTransforms.length>0?this._trajectoryTransforms[this.currentIndex]:null},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"previousTransform",{get:function(){return this._trajectoryTransforms.length>1&&this.currentIndex>0?this._trajectoryTransforms[this.currentIndex-1]:null},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"motionless",{get:function(){return this._motionless},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"transitionMode",{get:function(){return this._transitionMode},enumerable:true,configurable:true});e.prototype.earth=function(){throw new Error("Not implemented")};e.prototype.traverse=function(){throw new Error("Not implemented")};e.prototype.wait=function(){throw new Error("Not implemented")};e.prototype.waitInteractively=function(){throw new Error("Not implemented")};e.prototype.move=function(e){};e.prototype.moveTo=function(e){};e.prototype.rotate=function(e){};e.prototype.rotateUnbounded=function(e){};e.prototype.rotateWithoutInertia=function(e){};e.prototype.rotateBasic=function(e){};e.prototype.rotateBasicUnbounded=function(e){};e.prototype.rotateBasicWithoutInertia=function(e){};e.prototype.rotateToBasic=function(e){};e.prototype.setSpeed=function(e){};e.prototype.zoomIn=function(e,t){};e.prototype.update=function(e){};e.prototype.setCenter=function(e){};e.prototype.setZoom=function(e){};e.prototype.dolly=function(e){};e.prototype.orbit=function(e){};e.prototype.truck=function(e){};e.prototype.append=function(e){if(e.length<1){throw Error("Trajectory can not be empty")}if(this._currentIndex<0){this.set(e)}else{this._trajectory=this._trajectory.concat(e);this._appendToTrajectories(e)}};e.prototype.prepend=function(e){if(e.length<1){throw Error("Trajectory can not be empty")}this._trajectory=e.slice().concat(this._trajectory);this._currentIndex+=e.length;this._setCurrentNode();var t=this._setReference(this._currentNode);if(t){this._setTrajectories()}else{this._prependToTrajectories(e)}this._setCurrentCamera()};e.prototype.remove=function(e){if(e<0){throw Error("n must be a positive integer")}if(this._currentIndex-1<e){throw Error("Current and previous nodes can not be removed")}for(var t=0;t<e;t++){this._trajectory.shift();this._trajectoryTransforms.shift();this._trajectoryCameras.shift();this._currentIndex--}this._setCurrentNode()};e.prototype.clearPrior=function(){if(this._currentIndex>0){this.remove(this._currentIndex-1)}};e.prototype.clear=function(){this.cut();if(this._currentIndex>0){this.remove(this._currentIndex-1)}};e.prototype.cut=function(){while(this._trajectory.length-1>this._currentIndex){this._trajectory.pop();this._trajectoryTransforms.pop();this._trajectoryCameras.pop()}};e.prototype.set=function(e){this._setTrajectory(e);this._setCurrentNode();this._setReference(this._currentNode);this._setTrajectories();this._setCurrentCamera()};e.prototype.getCenter=function(){return this._currentNode!=null?this.currentTransform.projectBasic(this._camera.lookat.toArray()):[.5,.5]};e.prototype.setTransitionMode=function(e){this._transitionMode=e};e.prototype._getAlpha=function(){return 1};e.prototype._setCurrent=function(){this._setCurrentNode();var e=this._setReference(this._currentNode);if(e){this._setTrajectories()}this._setCurrentCamera()};e.prototype._setCurrentCamera=function(){this._currentCamera=this._trajectoryCameras[this._currentIndex].clone();this._previousCamera=this._currentIndex>0?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()};e.prototype._motionlessTransition=function(){var e=this._currentNode!=null&&this._previousNode!=null;return e&&(this._transitionMode===n.TransitionMode.Instantaneous||!(this._currentNode.merged&&this._previousNode.merged&&this._withinOriginalDistance()&&this._sameConnectedComponent()))};e.prototype._setReference=function(e){if(Math.abs(e.latLon.lat-this.reference.lat)<this._referenceThreshold&&Math.abs(e.latLon.lon-this.reference.lon)<this._referenceThreshold){return false}if(this._previousNode!=null&&!this._motionlessTransition()){return false}this._reference.lat=e.latLon.lat;this._reference.lon=e.latLon.lon;this._reference.alt=e.alt;return true};e.prototype._setCurrentNode=function(){this._currentNode=this._trajectory.length>0?this._trajectory[this._currentIndex]:null;this._previousNode=this._currentIndex>0?this._trajectory[this._currentIndex-1]:null};e.prototype._setTrajectory=function(e){if(e.length<1){throw new a.ArgumentMapillaryError("Trajectory can not be empty")}if(this._currentNode!=null){this._trajectory=[this._currentNode].concat(e);this._currentIndex=1}else{this._trajectory=e.slice();this._currentIndex=0}};e.prototype._setTrajectories=function(){this._trajectoryTransforms.length=0;this._trajectoryCameras.length=0;this._appendToTrajectories(this._trajectory)};e.prototype._appendToTrajectories=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];if(!n.assetsCached){throw new a.ArgumentMapillaryError("Assets must be cached when node is added to trajectory")}var i=this._nodeToTranslation(n,this.reference);var o=new s.Transform(n.orientation,n.width,n.height,n.focal,n.scale,n.gpano,n.rotation,i,n.image,undefined,n.ck1,n.ck2,n.cameraProjection);this._trajectoryTransforms.push(o);this._trajectoryCameras.push(new s.Camera(o))}};e.prototype._prependToTrajectories=function(e){for(var t=0,r=e.reverse();t<r.length;t++){var n=r[t];if(!n.assetsCached){throw new a.ArgumentMapillaryError("Assets must be cached when added to trajectory")}var i=this._nodeToTranslation(n,this.reference);var o=new s.Transform(n.orientation,n.width,n.height,n.focal,n.scale,n.gpano,n.rotation,i,n.image,undefined,n.ck1,n.ck2,n.cameraProjection);this._trajectoryTransforms.unshift(o);this._trajectoryCameras.unshift(new s.Camera(o))}};e.prototype._nodeToTranslation=function(e,t){return s.Geo.computeTranslation({alt:e.alt,lat:e.latLon.lat,lon:e.latLon.lon},e.rotation,t)};e.prototype._sameConnectedComponent=function(){var e=this._currentNode;var t=this._previousNode;return!!e&&!!t&&e.mergeCC===t.mergeCC};e.prototype._withinOriginalDistance=function(){var e=this._currentNode;var t=this._previousNode;if(!e||!t){return true}var r=this._spatial.distanceFromLatLon(e.originalLatLon.lat,e.originalLatLon.lon,t.originalLatLon.lat,t.originalLatLon.lon);return r<25};return e}();r.StateBase=i},{"../../Error":293,"../../Geo":294,"../../State":298}],446:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("@mapbox/unitbezier");var o=e("../../State");var a=function(r){n(e,r);function e(e){var t=r.call(this,e)||this;t._adjustCameras();t._motionless=t._motionlessTransition();t._baseAlpha=t._alpha;t._speedCoefficient=1;t._unitBezier=new i(.74,.67,.38,.96);t._useBezier=false;return t}e.prototype.earth=function(){return new o.EarthState(this)};e.prototype.wait=function(){return new o.WaitingState(this)};e.prototype.waitInteractively=function(){return new o.InteractiveWaitingState(this)};e.prototype.append=function(e){var t=this._trajectory.length===0;if(t){this._resetTransition()}r.prototype.append.call(this,e);if(t){this._setDesiredCenter();this._setDesiredZoom()}};e.prototype.prepend=function(e){var t=this._trajectory.length===0;if(t){this._resetTransition()}r.prototype.prepend.call(this,e);if(t){this._setDesiredCenter();this._setDesiredZoom()}};e.prototype.set=function(e){r.prototype.set.call(this,e);this._desiredLookat=null;this._resetTransition();this._clearRotation();this._setDesiredCenter();this._setDesiredZoom();if(this._trajectory.length<3){this._useBezier=true}};e.prototype.setSpeed=function(e){this._speedCoefficient=this._spatial.clamp(e,0,10)};e.prototype.update=function(e){if(this._alpha===1&&this._currentIndex+this._alpha<this._trajectory.length){this._currentIndex+=1;this._useBezier=this._trajectory.length<3&&this._currentIndex+1===this._trajectory.length;this._setCurrent();this._resetTransition();this._clearRotation();this._desiredZoom=this._currentNode.fullPano?this._zoom:0;this._desiredLookat=null}var t=this._animationSpeed*(60/e);this._baseAlpha=Math.min(1,this._baseAlpha+this._speedCoefficient*t);if(this._useBezier){this._alpha=this._unitBezier.solve(this._baseAlpha)}else{this._alpha=this._baseAlpha}this._updateRotation();if(!this._rotationDelta.isZero){this._applyRotation(this._rotationDelta,this._previousCamera);this._applyRotation(this._rotationDelta,this._currentCamera)}this._updateRotationBasic();if(this._basicRotation[0]!==0||this._basicRotation[1]!==0){this._applyRotationBasic(this._basicRotation)}this._updateZoom(t);this._updateLookat(t);this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)};e.prototype._getAlpha=function(){return this._motionless?Math.ceil(this._alpha):this._alpha};e.prototype._setCurrentCamera=function(){r.prototype._setCurrentCamera.call(this);this._adjustCameras()};e.prototype._adjustCameras=function(){if(this._previousNode==null){return}var e=this._camera.lookat.clone().sub(this._camera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position));if(this._currentNode.fullPano){this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}};e.prototype._resetTransition=function(){this._alpha=0;this._baseAlpha=0;this._motionless=this._motionlessTransition()};return e}(o.InteractiveStateBase);r.TraversingState=a;r.default=a},{"../../State":298,"@mapbox/unitbezier":2}],447:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var i=e("../../State");var o=function(r){n(e,r);function e(e){var t=r.call(this,e)||this;t._zoom=0;t._adjustCameras();t._motionless=t._motionlessTransition();return t}e.prototype.traverse=function(){return new i.TraversingState(this)};e.prototype.waitInteractively=function(){return new i.InteractiveWaitingState(this)};e.prototype.prepend=function(e){r.prototype.prepend.call(this,e);this._motionless=this._motionlessTransition()};e.prototype.set=function(e){r.prototype.set.call(this,e);this._motionless=this._motionlessTransition()};e.prototype.move=function(e){this._alpha=Math.max(0,Math.min(1,this._alpha+e))};e.prototype.moveTo=function(e){this._alpha=Math.max(0,Math.min(1,e))};e.prototype.update=function(e){this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)};e.prototype._getAlpha=function(){return this._motionless?Math.round(this._alpha):this._alpha};e.prototype._setCurrentCamera=function(){r.prototype._setCurrentCamera.call(this);this._adjustCameras()};e.prototype._adjustCameras=function(){if(this._previousNode==null){return}if(this._currentNode.fullPano){var e=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(e.clone().add(this._currentCamera.position))}if(this._previousNode.fullPano){var e=this._currentCamera.lookat.clone().sub(this._currentCamera.position);this._previousCamera.lookat.copy(e.clone().add(this._previousCamera.position))}};return e}(i.StateBase);r.WaitingState=o;r.default=o},{"../../State":298}],448:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rxjs");var i=function(){function e(e,t,r){this._scheme=e;this._host=t;this._origin=r!=null?"?origin="+r:""}e.prototype.getTile=function(i,o,a,s,u,e,t){var r="/"+i+"/"+o+","+a+","+s+","+u+"/"+e+","+t+"/0/default.jpg";var c=this._scheme+"://"+this._host+r+this._origin;var h=null;return[n.Observable.create(function(n){h=new XMLHttpRequest;h.open("GET",c,true);h.responseType="arraybuffer";h.timeout=15e3;h.onload=function(e){if(h.status!==200){n.error(new Error("Failed to fetch tile ("+i+": "+o+","+a+","+s+","+u+"). "+("Status: "+h.status+", "+h.statusText)));return}var t=new Image;t.crossOrigin="Anonymous";t.onload=function(e){n.next(t);n.complete()};t.onerror=function(e){n.error(new Error("Failed to load tile image ("+i+": "+o+","+a+","+s+","+u+")"))};var r=new Blob([h.response]);t.src=window.URL.createObjectURL(r)};h.onerror=function(e){n.error(new Error("Failed to fetch tile ("+i+": "+o+","+a+","+s+","+u+")"))};h.ontimeout=function(e){n.error(new Error("Tile request timed out ("+i+": "+o+","+a+","+s+","+u+")"))};h.onabort=function(e){n.error(new Error("Tile request was aborted ("+i+": "+o+","+a+","+s+","+u+")"))};h.send(null)}),function(){if(h!=null){h.abort()}}]};return e}();r.ImageTileLoader=i;r.default=i},{rxjs:43}],449:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(){this._images={}}e.prototype.addImage=function(e,t,r){if(!(r in this._images)){this._images[r]={}}this._images[r][t]=e};e.prototype.dispose=function(){for(var e=0,t=Object.keys(this._images);e<t.length;e++){var r=t[e];var n=this._images[r];for(var i=0,o=Object.keys(n);i<o.length;i++){var a=o[i];window.URL.revokeObjectURL(n[a].src);delete n[a]}delete this._images[r]}};e.prototype.getImage=function(e,t){return this._images[t][e]};e.prototype.hasImage=function(e,t){return t in this._images&&e in this._images[t]};return e}();r.ImageTileStore=n;r.default=n},{}],450:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Geo");var i=function(){function e(){this._viewportCoords=new n.ViewportCoords}e.prototype.computeRegionOfInterest=function(e,t,r){var n=this._viewportBoundaryPoints(4);var i=this._viewportPointsBoundingBox(n,e,r);this._clipBoundingBox(i);var o=2/t.width;var a=2/t.height;var s=[[-.5*o,.5*a],[.5*o,.5*a],[.5*o,-.5*a],[-.5*o,-.5*a]];var u=this._viewportPointsBoundingBox(s,e,r);return{bbox:i,pixelHeight:u.maxY-u.minY,pixelWidth:u.maxX-u.minX+(u.minX<u.maxX?0:1)}};e.prototype._viewportBoundaryPoints=function(e){var t=[];var r=[[-1,1],[1,1],[1,-1],[-1,-1]];var n=[[2,0],[0,-2],[-2,0],[0,2]];for(var i=0;i<4;++i){var o=r[i];var a=n[i];for(var s=0;s<e;++s){t.push([o[0]+a[0]*s/e,o[1]+a[1]*s/e])}}return t};e.prototype._viewportPointsBoundingBox=function(e,t,r){var n=this;var i=e.map(function(e){return n._viewportCoords.viewportToBasic(e[0],e[1],r,t.perspective)});if(r.gpano!=null){return this._boundingBoxPano(i)}else{return this._boundingBox(i)}};e.prototype._boundingBox=function(e){var t={maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY,minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY};for(var r=0;r<e.length;++r){t.minX=Math.min(t.minX,e[r][0]);t.maxX=Math.max(t.maxX,e[r][0]);t.minY=Math.min(t.minY,e[r][1]);t.maxY=Math.max(t.maxY,e[r][1])}return t};e.prototype._boundingBoxPano=function(e){var r=this;var t=[];var n=[];for(var i=0;i<e.length;++i){t.push(e[i][0]);n.push(e[i][1])}t.sort(function(e,t){return r._sign(e-t)});n.sort(function(e,t){return r._sign(e-t)});var o=this._intervalPano(t);return{maxX:o[1],maxY:n[n.length-1],minX:o[0],minY:n[0]}};e.prototype._intervalPano=function(e){var t=0;var r=-1;for(var n=0;n<e.length-1;++n){var i=e[n+1]-e[n];if(i>t){t=i;r=n}}var o=e[0]+1-e[e.length-1];if(o>t){return[e[0],e[e.length-1]]}else{return[e[r+1],e[r]]}};e.prototype._clipBoundingBox=function(e){e.minX=Math.max(0,Math.min(1,e.minX));e.maxX=Math.max(0,Math.min(1,e.maxX));e.minY=Math.max(0,Math.min(1,e.minY));e.maxY=Math.max(0,Math.min(1,e.maxY))};e.prototype._sign=function(e){return e>0?1:e<0?-1:0};return e}();r.RegionOfInterestCalculator=i;r.default=i},{"../Geo":294}],451:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var u=e("rxjs/operators");var g=e("three");var c=e("rxjs");var n=function(){function e(e,t,r,n,i,o,a,s){this._disposed=false;this._key=e;if(t<=0||r<=0){console.warn("Original image size ("+t+", "+r+") is invalid ("+e+"). Tiles will not be loaded.")}this._width=t;this._height=r;this._maxLevel=Math.ceil(Math.log(Math.max(r,t))/Math.log(2));this._currentLevel=-1;this._tileSize=n;this._updated$=new c.Subject;this._createdSubject$=new c.Subject;this._created$=this._createdSubject$.pipe(u.publishReplay(1),u.refCount());this._createdSubscription=this._created$.subscribe(function(){});this._hasSubject$=new c.Subject;this._has$=this._hasSubject$.pipe(u.startWith(false),u.publishReplay(1),u.refCount());this._hasSubscription=this._has$.subscribe(function(){});this._abortFunctions=[];this._tileSubscriptions={};this._renderedCurrentLevelTiles={};this._renderedTiles={};this._background=i;this._camera=null;this._imageTileLoader=o;this._imageTileStore=a;this._renderer=s;this._renderTarget=null;this._roi=null}Object.defineProperty(e.prototype,"disposed",{get:function(){return this._disposed},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"hasTexture$",{get:function(){return this._has$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"textureUpdated$",{get:function(){return this._updated$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"textureCreated$",{get:function(){return this._created$},enumerable:true,configurable:true});e.prototype.abort=function(){for(var e in this._tileSubscriptions){if(!this._tileSubscriptions.hasOwnProperty(e)){continue}this._tileSubscriptions[e].unsubscribe()}this._tileSubscriptions={};for(var t=0,r=this._abortFunctions;t<r.length;t++){var n=r[t];n()}this._abortFunctions=[]};e.prototype.dispose=function(){if(this._disposed){console.warn("Texture already disposed ("+this._key+")");return}this.abort();if(this._renderTarget!=null){this._renderTarget.dispose();this._renderTarget=null}this._imageTileStore.dispose();this._imageTileStore=null;this._background=null;this._camera=null;this._imageTileLoader=null;this._renderer=null;this._roi=null;this._createdSubscription.unsubscribe();this._hasSubscription.unsubscribe();this._disposed=true};e.prototype.setRegionOfInterest=function(e){if(this._width<=0||this._height<=0){return}this._roi=e;var t=1/this._roi.pixelWidth;var r=1/this._roi.pixelHeight;var n=Math.max(r,t);var i=Math.max(0,Math.min(this._maxLevel,Math.ceil(Math.log(n)/Math.log(2))));if(i!==this._currentLevel){this.abort();this._currentLevel=i;if(!(this._currentLevel in this._renderedTiles)){this._renderedTiles[this._currentLevel]=[]}this._renderedCurrentLevelTiles={};for(var o=0,a=this._renderedTiles[this._currentLevel];o<a.length;o++){var s=a[o];this._renderedCurrentLevelTiles[this._tileKey(this._tileSize,s)]=true}}var u=this._getTileCoords([this._roi.bbox.minX,this._roi.bbox.minY]);var c=this._getTileCoords([this._roi.bbox.maxX,this._roi.bbox.maxY]);var h=this._getTiles(u,c);if(this._camera==null){this._camera=new g.OrthographicCamera(-this._width/2,this._width/2,this._height/2,-this._height/2,-1,1);this._camera.position.z=1;var l=this._renderer.getContext();var p=l.getParameter(l.MAX_TEXTURE_SIZE);var f=Math.max(this._width,this._height);var d=p>f?1:p/f;var v=Math.floor(d*this._width);var m=Math.floor(d*this._height);this._renderTarget=new g.WebGLRenderTarget(v,m,{depthBuffer:false,format:g.RGBFormat,magFilter:g.LinearFilter,minFilter:g.LinearFilter,stencilBuffer:false});this._renderToTarget(0,0,this._width,this._height,this._background);this._createdSubject$.next(this._renderTarget.texture);this._hasSubject$.next(true)}this._fetchTiles(h)};e.prototype.setTileSize=function(e){this._tileSize=e};e.prototype.updateBackground=function(e){this._background=e};e.prototype._fetchTile=function(t,r,n,i,o,a,e,s){var u=this;var c=this._imageTileLoader.getTile(this._key,n,i,o,a,e,s);var h=c[0];var l=c[1];this._abortFunctions.push(l);var p=this._tileKey(this._tileSize,t);var f=h.subscribe(function(e){u._renderToTarget(n,i,o,a,e);u._removeFromDictionary(p,u._tileSubscriptions);u._removeFromArray(l,u._abortFunctions);u._setTileRendered(t,u._currentLevel);u._imageTileStore.addImage(e,p,r);u._updated$.next(true)},function(e){u._removeFromDictionary(p,u._tileSubscriptions);u._removeFromArray(l,u._abortFunctions);console.error(e)});if(!f.closed){this._tileSubscriptions[p]=f}};e.prototype._fetchTiles=function(e){var t=this._tileSize*Math.pow(2,this._maxLevel-this._currentLevel);for(var r=0,n=e;r<n.length;r++){var i=n[r];var o=this._tileKey(this._tileSize,i);if(o in this._renderedCurrentLevelTiles||o in this._tileSubscriptions){continue}var a=t*i[0];var s=t*i[1];var u=a+t>this._width?this._width-a:t;var c=s+t>this._height?this._height-s:t;if(this._imageTileStore.hasImage(o,this._currentLevel)){this._renderToTarget(a,s,u,c,this._imageTileStore.getImage(o,this._currentLevel));this._setTileRendered(i,this._currentLevel);this._updated$.next(true);continue}var h=Math.floor(u/t*this._tileSize);var l=Math.floor(c/t*this._tileSize);this._fetchTile(i,this._currentLevel,a,s,u,c,h,l)}};e.prototype._getTileCoords=function(e){var t=this._tileSize*Math.pow(2,this._maxLevel-this._currentLevel);var r=Math.ceil(this._width/t)-1;var n=Math.ceil(this._height/t)-1;return[Math.min(Math.floor(this._width*e[0]/t),r),Math.min(Math.floor(this._height*e[1]/t),n)]};e.prototype._getTiles=function(e,t){var r=[];if(e[0]>t[0]){var n=this._tileSize*Math.pow(2,this._maxLevel-this._currentLevel);var i=Math.ceil(this._width/n)-1;for(var o=e[0];o<=i;o++){r.push(o)}for(var o=0;o<=t[0];o++){r.push(o)}}else{for(var o=e[0];o<=t[0];o++){r.push(o)}}var a=[];for(var s=0,u=r;s<u.length;s++){var o=u[s];for(var c=e[1];c<=t[1];c++){a.push([o,c])}}return a};e.prototype._removeFromArray=function(e,t){var r=t.indexOf(e);if(r!==-1){t.splice(r,1)}};e.prototype._removeFromDictionary=function(e,t){if(e in t){delete t[e]}};e.prototype._renderToTarget=function(e,t,r,n,i){var o=new g.Texture(i);o.minFilter=g.LinearFilter;o.needsUpdate=true;var a=new g.PlaneGeometry(r,n);var s=new g.MeshBasicMaterial({map:o,side:g.FrontSide});var u=new g.Mesh(a,s);u.position.x=-this._width/2+e+r/2;u.position.y=this._height/2-t-n/2;var c=new g.Scene;c.add(u);this._renderer.render(c,this._camera,this._renderTarget);this._renderer.setRenderTarget(undefined);c.remove(u);a.dispose();s.dispose();o.dispose()};e.prototype._setTileRendered=function(e,t){var r=Object.keys(this._renderedTiles).map(function(e){return parseInt(e,10)}).filter(function(e){return e!==t});for(var n=0,i=r;n<i.length;n++){var o=i[n];var a=Math.pow(2,o-t);if(o<t){var s=Math.floor(a*e[0]);var u=Math.floor(a*e[1]);for(var c=0,h=this._renderedTiles[o].slice();c<h.length;c++){var l=h[c];if(l[0]===s&&l[1]===u){var p=this._renderedTiles[o].indexOf(l);this._renderedTiles[o].splice(p,1)}}}else{var f=a*e[0];var d=f+a-1;var v=a*e[1];var m=v+a-1;for(var g=0,_=this._renderedTiles[o].slice();g<_.length;g++){var l=_[g];if(l[0]>=f&&l[0]<=d&&l[1]>=v&&l[1]<=m){var p=this._renderedTiles[o].indexOf(l);this._renderedTiles[o].splice(p,1)}}}if(this._renderedTiles[o].length===0){delete this._renderedTiles[o]}}this._renderedTiles[t].push(e);this._renderedCurrentLevelTiles[this._tileKey(this._tileSize,e)]=true};e.prototype._tileKey=function(e,t){return e+"-"+t[0]+"-"+t[1]};return e}();r.TextureProvider=n;r.default=n},{rxjs:43,"rxjs/operators":241,three:242}],452:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(e){this._document=!!e?e:document}Object.defineProperty(e.prototype,"document",{get:function(){return this._document},enumerable:true,configurable:true});e.prototype.createElement=function(e,t,r){var n=this._document.createElement(e);if(!!t){n.className=t}if(!!r){r.appendChild(n)}return n};return e}();r.DOM=n;r.default=n},{}],453:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function e(){this._events={}}e.prototype.on=function(e,t){this._events[e]=this._events[e]||[];this._events[e].push(t);return};e.prototype.off=function(e,t){if(!e){this._events={};return}if(!this._listens(e)){var r=this._events[e].indexOf(t);if(r>=0){this._events[e].splice(r,1)}if(this._events[e].length){delete this._events[e]}}else{delete this._events[e]}return};e.prototype.fire=function(e,t){if(!this._listens(e)){return}for(var r=0,n=this._events[e];r<n.length;r++){var i=n[r];i.call(this,t)}return};e.prototype._listens=function(e){return!!(this._events&&this._events[e])};return e}();r.EventEmitter=n;r.default=n},{}],454:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("../Viewer");var i=function(){function t(){}t.setOptions=function(e){t._baseImageSize=e.baseImageSize!=null?e.baseImageSize:n.ImageSize.Size640;t._basePanoramaSize=e.basePanoramaSize!=null?e.basePanoramaSize:n.ImageSize.Size2048;t._maxImageSize=e.maxImageSize!=null?e.maxImageSize:n.ImageSize.Size2048};Object.defineProperty(t,"baseImageSize",{get:function(){return t._baseImageSize},enumerable:true,configurable:true});Object.defineProperty(t,"basePanoramaSize",{get:function(){return t._basePanoramaSize},enumerable:true,configurable:true});Object.defineProperty(t,"maxImageSize",{get:function(){return t._maxImageSize},enumerable:true,configurable:true});return t}();r.Settings=i;r.default=i},{"../Viewer":302}],455:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});function n(){return typeof window!=="undefined"&&typeof document!=="undefined"}r.isBrowser=n;function i(){return!!(Array.prototype&&Array.prototype.filter&&Array.prototype.indexOf&&Array.prototype.map&&Array.prototype.reverse)}r.isArraySupported=i;function o(){return!!(Function.prototype&&Function.prototype.bind)}r.isFunctionSupported=o;function a(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON}r.isJSONSupported=a;function s(){return!!(Object.keys&&Object.assign)}r.isObjectSupported=s;function u(){return"Blob"in window&&"URL"in window}r.isBlobSupported=u;var c=undefined;function h(){if(c===undefined){c=l()}return c}r.isWebGLSupportedCached=h;function l(){var e={alpha:false,antialias:false,depth:true,failIfMajorPerformanceCaveat:false,premultipliedAlpha:true,preserveDrawingBuffer:false,stencil:true};var t=document.createElement("canvas");var r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);if(!r){return false}var n=["OES_standard_derivatives"];var i=r.getSupportedExtensions();for(var o=0,a=n;o<a.length;o++){var s=a[o];if(i.indexOf(s)===-1){return false}}return true}r.isWebGLSupported=l},{}],456:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=function(){function i(){}Object.defineProperty(i,"explore",{get:function(){return i._scheme+"://"+i._exploreHost},enumerable:true,configurable:true});Object.defineProperty(i,"origin",{get:function(){return i._origin},enumerable:true,configurable:true});Object.defineProperty(i,"tileScheme",{get:function(){return i._scheme},enumerable:true,configurable:true});Object.defineProperty(i,"tileDomain",{get:function(){return i._imageTileHost},enumerable:true,configurable:true});i.clusterReconstruction=function(e){return i._scheme+"://"+i._clusterReconstructionHost+"/"+e+"/v1.0/aligned.jsonz"};i.exporeImage=function(e){return i._scheme+"://"+i._exploreHost+"/app/?pKey="+e+"&focus=photo"};i.exporeUser=function(e){return i._scheme+"://"+i._exploreHost+"/app/user/"+e};i.falcorModel=function(e){return i._scheme+"://"+i._apiHost+"/v3/model.json?client_id="+e};i.protoMesh=function(e){return i._scheme+"://"+i._meshHost+"/v2/mesh/"+e};i.thumbnail=function(e,t,r){var n=!!r?"?origin="+r:"";return i._scheme+"://"+i._imageHost+"/"+e+"/thumb-"+t+".jpg"+n};i.setOptions=function(e){if(!e){return}if(!!e.apiHost){i._apiHost=e.apiHost}if(!!e.clusterReconstructionHost){i._clusterReconstructionHost=e.clusterReconstructionHost}if(!!e.exploreHost){i._exploreHost=e.exploreHost}if(!!e.imageHost){i._imageHost=e.imageHost}if(!!e.imageTileHost){i._imageTileHost=e.imageTileHost}if(!!e.meshHost){i._meshHost=e.meshHost}if(!!e.scheme){i._scheme=e.scheme}};i._apiHost="a.mapillary.com";i._clusterReconstructionHost="cluster-reconstructions.mapillary.com";i._exploreHost="www.mapillary.com";i._imageHost="images.mapillary.com";i._imageTileHost="loris.mapillary.com";i._meshHost="meshes.mapillary.com";i._origin="mapillary.webgl";i._scheme="https";return i}();r.Urls=n;r.default=n},{}],457:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["Bottom"]=0]="Bottom";e[e["BottomLeft"]=1]="BottomLeft";e[e["BottomRight"]=2]="BottomRight";e[e["Center"]=3]="Center";e[e["Left"]=4]="Left";e[e["Right"]=5]="Right";e[e["Top"]=6]="Top";e[e["TopLeft"]=7]="TopLeft";e[e["TopRight"]=8]="TopRight"})(n=r.Alignment||(r.Alignment={}));r.default=n},{}],458:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rxjs");var i=e("rxjs/operators");var a=e("../Graph");var o=function(){function e(e,t){this._graphService=e;this._stateService=t;this._started=false}Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:true,configurable:true});e.prototype.start=function(){var o=this;if(this._started){return}this._uncacheSubscription=this._stateService.currentState$.pipe(i.distinctUntilChanged(undefined,function(e){return e.state.currentNode.key}),i.map(function(e){var t=e.state.trajectory;var r=t.map(function(e){return e.key});var n=t[t.length-1].sequenceKey;return[r,n]}),i.bufferCount(1,5),i.withLatestFrom(this._graphService.graphMode$),i.switchMap(function(e){var t=e[0],r=e[1];var n=t[0][0];var i=r===a.GraphMode.Sequence?t[0][1]:undefined;return o._graphService.uncache$(n,i)})).subscribe(function(){});this._cacheNodeSubscription=this._graphService.graphMode$.pipe(i.skip(1),i.withLatestFrom(this._stateService.currentState$),i.switchMap(function(e){var t=e[0],r=e[1];return t===a.GraphMode.Sequence?o._keyToEdges(r.state.currentNode.key,function(e){return e.sequenceEdges$}):n.from(r.state.trajectory.map(function(e){return e.key}).slice(r.state.currentIndex)).pipe(i.mergeMap(function(e){return o._keyToEdges(e,function(e){return e.spatialEdges$})},6))})).subscribe(function(){});this._started=true};e.prototype.stop=function(){if(!this._started){return}this._uncacheSubscription.unsubscribe();this._uncacheSubscription=null;this._cacheNodeSubscription.unsubscribe();this._cacheNodeSubscription=null;this._started=false};e.prototype._keyToEdges=function(t,e){return this._graphService.cacheNode$(t).pipe(i.switchMap(e),i.first(function(e){return e.cached}),i.timeout(15e3),i.catchError(function(e){console.error("Failed to cache edges ("+t+").",e);return n.empty()}))};return e}();r.CacheService=o;r.default=o},{"../Graph":295,rxjs:43,"rxjs/operators":241}],459:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var s=e("rxjs/operators");var u=e("../Component");var n=function(){function e(e,t,r,n,i,o){var a=this;this._container=e;this._observer=r;this._navigator=t;this._options=i!=null?i:{};this._key=n;this._navigable=n==null;this._componentService=!!o?o:new u.ComponentService(this._container,this._navigator);this._coverComponent=this._componentService.getCover();this._initializeComponents();if(n){this._initilizeCoverComponent();this._subscribeCoverComponent()}else{this._navigator.movedToKey$.pipe(s.first(function(e){return e!=null})).subscribe(function(e){a._key=e;a._componentService.deactivateCover();a._coverComponent.configure({key:a._key,state:u.CoverState.Hidden});a._subscribeCoverComponent();a._navigator.stateService.start();a._navigator.cacheService.start();a._navigator.panService.start();a._observer.startEmit()})}}Object.defineProperty(e.prototype,"navigable",{get:function(){return this._navigable},enumerable:true,configurable:true});e.prototype.get=function(e){return this._componentService.get(e)};e.prototype.activate=function(e){this._componentService.activate(e)};e.prototype.activateCover=function(){this._coverComponent.configure({state:u.CoverState.Visible})};e.prototype.deactivate=function(e){this._componentService.deactivate(e)};e.prototype.deactivateCover=function(){this._coverComponent.configure({state:u.CoverState.Loading})};e.prototype._initializeComponents=function(){var e=this._options;this._uFalse(e.background,"background");this._uFalse(e.debug,"debug");this._uFalse(e.image,"image");this._uFalse(e.marker,"marker");this._uFalse(e.navigation,"navigation");this._uFalse(e.popup,"popup");this._uFalse(e.route,"route");this._uFalse(e.slider,"slider");this._uFalse(e.spatialData,"spatialData");this._uFalse(e.tag,"tag");this._uTrue(e.attribution,"attribution");this._uTrue(e.bearing,"bearing");this._uTrue(e.cache,"cache");this._uTrue(e.direction,"direction");this._uTrue(e.imagePlane,"imagePlane");this._uTrue(e.keyboard,"keyboard");this._uTrue(e.loading,"loading");this._uTrue(e.mouse,"mouse");this._uTrue(e.sequence,"sequence");this._uTrue(e.stats,"stats");this._uTrue(e.zoom,"zoom")};e.prototype._initilizeCoverComponent=function(){var e=this._options;this._coverComponent.configure({key:this._key});if(e.cover===undefined||e.cover){this.activateCover()}else{this.deactivateCover()}};e.prototype._setNavigable=function(e){if(this._navigable===e){return}this._navigable=e;this._observer.navigable$.next(e)};e.prototype._subscribeCoverComponent=function(){var n=this;this._coverComponent.configuration$.pipe(s.distinctUntilChanged(undefined,function(e){return e.state})).subscribe(function(r){if(r.state===u.CoverState.Loading){n._navigator.stateService.currentKey$.pipe(s.first(),s.switchMap(function(e){var t=e==null||e!==r.key;if(t){n._setNavigable(false)}return t?n._navigator.moveToKey$(r.key):n._navigator.stateService.currentNode$.pipe(s.first())})).subscribe(function(){n._navigator.stateService.start();n._navigator.cacheService.start();n._navigator.panService.start();n._observer.startEmit();n._coverComponent.configure({state:u.CoverState.Hidden});n._componentService.deactivateCover();n._setNavigable(true)},function(e){console.error("Failed to deactivate cover.",e);n._coverComponent.configure({state:u.CoverState.Visible})})}else if(r.state===u.CoverState.Visible){n._observer.stopEmit();n._navigator.stateService.stop();n._navigator.cacheService.stop();n._navigator.playService.stop();n._navigator.panService.stop();n._componentService.activateCover();n._setNavigable(r.key==null)}})};e.prototype._uFalse=function(e,t){if(e===undefined){this._componentService.deactivate(t);return}if(typeof e==="boolean"){if(e){this._componentService.activate(t)}else{this._componentService.deactivate(t)}return}this._componentService.configure(t,e);this._componentService.activate(t)};e.prototype._uTrue=function(e,t){if(e===undefined){this._componentService.activate(t);return}if(typeof e==="boolean"){if(e){this._componentService.activate(t)}else{this._componentService.deactivate(t)}return}this._componentService.configure(t,e);this._componentService.activate(t)};return e}();r.ComponentController=n},{"../Component":291,"rxjs/operators":241}],460:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=e("../Render");var o=e("../Utils");var a=e("../Viewer");var n=function(){function e(e,t,r,n){this.id=e;this._dom=!!n?n:new o.DOM;this._container=this._dom.document.getElementById(e);if(!this._container){throw new Error("Container '"+e+"' not found.")}this._container.classList.add("mapillary-js");this._canvasContainer=this._dom.createElement("div","mapillary-js-interactive",this._container);this._domContainer=this._dom.createElement("div","mapillary-js-dom",this._container);this.renderService=new i.RenderService(this._container,t.currentState$,r.renderMode);this.glRenderer=new i.GLRenderer(this._canvasContainer,this.renderService,this._dom);this.domRenderer=new i.DOMRenderer(this._domContainer,this.renderService,t.currentState$);this.keyboardService=new a.KeyboardService(this._canvasContainer);this.mouseService=new a.MouseService(this._container,this._canvasContainer,this._domContainer,document);this.touchService=new a.TouchService(this._canvasContainer,this._domContainer);this.spriteService=new a.SpriteService(r.sprite)}Object.defineProperty(e.prototype,"element",{get:function(){return this._container},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"canvasContainer",{get:function(){return this._canvasContainer},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"domContainer",{get:function(){return this._domContainer},enumerable:true,configurable:true});return e}();r.Container=n;r.default=n},{"../Render":297,"../Utils":301,"../Viewer":302}],461:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n;(function(e){e[e["Size320"]=320]="Size320";e[e["Size640"]=640]="Size640";e[e["Size1024"]=1024]="Size1024";e[e["Size2048"]=2048]="Size2048"})(n=r.ImageSize||(r.ImageSize={}))},{}],462:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rxjs");var i=function(){function e(e){this._keyDown$=n.fromEvent(e,"keydown");this._keyUp$=n.fromEvent(e,"keyup")}Object.defineProperty(e.prototype,"keyDown$",{get:function(){return this._keyDown$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"keyUp$",{get:function(){return this._keyUp$},enumerable:true,configurable:true});return e}();r.KeyboardService=i;r.default=i},{rxjs:43}],463:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var n=e("rxjs/operators");var i=e("rxjs");var o=function(){function e(){this._loadersSubject$=new i.Subject;this._loaders$=this._loadersSubject$.pipe(n.scan(function(e,t){if(t.task!==undefined){e[t.task]=t.loading}return e},{}),n.startWith({}),n.publishReplay(1),n.refCount())}Object.defineProperty(e.prototype,"loading$",{get:function(){return this._loaders$.pipe(n.map(function(e){for(var t in e){if(!e.hasOwnProperty(t)){continue}if(e[t]){return true}}return false}),n.debounceTime(100),n.distinctUntilChanged())},enumerable:true,configurable:true});e.prototype.taskLoading$=function(t){return this._loaders$.pipe(n.map(function(e){return!!e[t]}),n.debounceTime(100),n.distinctUntilChanged())};e.prototype.startLoading=function(e){this._loadersSubject$.next({loading:true,task:e})};e.prototype.stopLoading=function(e){this._loadersSubject$.next({loading:false,task:e})};return e}();r.LoadingService=o;r.default=o},{rxjs:43,"rxjs/operators":241}],464:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var u=e("rxjs");var c=e("rxjs/operators");var n=function(){function e(e,i,t,r){var n=this;this._activeSubject$=new u.BehaviorSubject(false);this._active$=this._activeSubject$.pipe(c.distinctUntilChanged(),c.publishReplay(1),c.refCount());this._claimMouse$=new u.Subject;this._claimWheel$=new u.Subject;this._deferPixelClaims$=new u.Subject;this._deferPixels$=this._deferPixelClaims$.pipe(c.scan(function(e,t){if(t.deferPixels==null){delete e[t.name]}else{e[t.name]=t.deferPixels}return e},{}),c.map(function(e){var t=-1;for(var r in e){if(!e.hasOwnProperty(r)){continue}var n=e[r];if(n>t){t=n}}return t}),c.startWith(-1),c.publishReplay(1),c.refCount());this._deferPixels$.subscribe(function(){});this._documentMouseMove$=u.fromEvent(r,"mousemove");this._documentMouseUp$=u.fromEvent(r,"mouseup");this._mouseDown$=u.fromEvent(i,"mousedown");this._mouseLeave$=u.fromEvent(i,"mouseleave");this._mouseMove$=u.fromEvent(i,"mousemove");this._mouseUp$=u.fromEvent(i,"mouseup");this._mouseOut$=u.fromEvent(i,"mouseout");this._mouseOver$=u.fromEvent(i,"mouseover");this._domMouseDown$=u.fromEvent(t,"mousedown");this._domMouseMove$=u.fromEvent(t,"mousemove");this._click$=u.fromEvent(i,"click");this._contextMenu$=u.fromEvent(i,"contextmenu");this._dblClick$=u.merge(u.fromEvent(e,"click"),u.fromEvent(i,"dblclick")).pipe(c.bufferCount(3,1),c.filter(function(e){var t=e[0];var r=e[1];var n=e[2];return t.type==="click"&&r.type==="click"&&n.type==="dblclick"&&t.target.parentNode===i&&r.target.parentNode===i}),c.map(function(e){return e[2]}),c.share());u.merge(this._domMouseDown$,this._domMouseMove$,this._dblClick$,this._contextMenu$).subscribe(function(e){e.preventDefault()});this._mouseWheel$=u.merge(u.fromEvent(i,"wheel"),u.fromEvent(t,"wheel")).pipe(c.share());this._consistentContextMenu$=u.merge(this._mouseDown$,this._mouseMove$,this._mouseOut$,this._mouseUp$,this._contextMenu$).pipe(c.bufferCount(3,1),c.filter(function(e){return e[0].type==="mousedown"&&e[1].type==="contextmenu"&&e[2].type==="mouseup"}),c.map(function(e){return e[1]}),c.share());var o=u.merge(u.fromEvent(window,"blur"),this._documentMouseUp$.pipe(c.filter(function(e){return e.button===0}))).pipe(c.share());var a=this._createMouseDragInitiate$(this._mouseDown$,o,true).pipe(c.share());this._mouseDragStart$=this._createMouseDragStart$(a).pipe(c.share());this._mouseDrag$=this._createMouseDrag$(a,o).pipe(c.share());this._mouseDragEnd$=this._createMouseDragEnd$(this._mouseDragStart$,o).pipe(c.share());var s=this._createMouseDragInitiate$(this._domMouseDown$,o,false).pipe(c.share());this._domMouseDragStart$=this._createMouseDragStart$(s).pipe(c.share());this._domMouseDrag$=this._createMouseDrag$(s,o).pipe(c.share());this._domMouseDragEnd$=this._createMouseDragEnd$(this._domMouseDragStart$,o).pipe(c.share());this._proximateClick$=this._mouseDown$.pipe(c.switchMap(function(e){return n._click$.pipe(c.takeUntil(n._createDeferredMouseMove$(e,n._documentMouseMove$)),c.take(1))}),c.share());this._staticClick$=this._mouseDown$.pipe(c.switchMap(function(e){return n._click$.pipe(c.takeUntil(n._documentMouseMove$),c.take(1))}),c.share());this._mouseDragStart$.subscribe();this._mouseDrag$.subscribe();this._mouseDragEnd$.subscribe();this._domMouseDragStart$.subscribe();this._domMouseDrag$.subscribe();this._domMouseDragEnd$.subscribe();this._staticClick$.subscribe();this._mouseOwner$=this._createOwner$(this._claimMouse$).pipe(c.publishReplay(1),c.refCount());this._wheelOwner$=this._createOwner$(this._claimWheel$).pipe(c.publishReplay(1),c.refCount());this._mouseOwner$.subscribe(function(){});this._wheelOwner$.subscribe(function(){})}Object.defineProperty(e.prototype,"active$",{get:function(){return this._active$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"activate$",{get:function(){return this._activeSubject$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"documentMouseMove$",{get:function(){return this._documentMouseMove$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"documentMouseUp$",{get:function(){return this._documentMouseUp$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"domMouseDragStart$",{get:function(){return this._domMouseDragStart$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"domMouseDrag$",{get:function(){return this._domMouseDrag$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"domMouseDragEnd$",{get:function(){return this._domMouseDragEnd$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"domMouseDown$",{get:function(){return this._domMouseDown$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"domMouseMove$",{get:function(){return this._domMouseMove$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mouseOwner$",{get:function(){return this._mouseOwner$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mouseDown$",{get:function(){return this._mouseDown$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mouseMove$",{get:function(){return this._mouseMove$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mouseLeave$",{get:function(){return this._mouseLeave$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mouseOut$",{get:function(){return this._mouseOut$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mouseOver$",{get:function(){return this._mouseOver$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mouseUp$",{get:function(){return this._mouseUp$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"click$",{get:function(){return this._click$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"dblClick$",{get:function(){return this._dblClick$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"contextMenu$",{get:function(){return this._consistentContextMenu$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mouseWheel$",{get:function(){return this._mouseWheel$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mouseDragStart$",{get:function(){return this._mouseDragStart$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mouseDrag$",{get:function(){return this._mouseDrag$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"mouseDragEnd$",{get:function(){return this._mouseDragEnd$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"proximateClick$",{get:function(){return this._proximateClick$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"staticClick$",{get:function(){return this._staticClick$},enumerable:true,configurable:true});e.prototype.claimMouse=function(e,t){this._claimMouse$.next({name:e,zindex:t})};e.prototype.unclaimMouse=function(e){this._claimMouse$.next({name:e,zindex:null})};e.prototype.deferPixels=function(e,t){this._deferPixelClaims$.next({name:e,deferPixels:t})};e.prototype.undeferPixels=function(e){this._deferPixelClaims$.next({name:e,deferPixels:null})};e.prototype.claimWheel=function(e,t){this._claimWheel$.next({name:e,zindex:t})};e.prototype.unclaimWheel=function(e){this._claimWheel$.next({name:e,zindex:null})};e.prototype.filtered$=function(e,t){return this._filtered(e,t,this._mouseOwner$)};e.prototype.filteredWheel$=function(e,t){return this._filtered(e,t,this._wheelOwner$)};e.prototype._createDeferredMouseMove$=function(n,e){return e.pipe(c.map(function(e){var t=e.clientX-n.clientX;var r=e.clientY-n.clientY;return[e,Math.sqrt(t*t+r*r)]}),c.withLatestFrom(this._deferPixels$),c.filter(function(e){var t=e[0],r=t[0],n=t[1],i=e[1];return n>i}),c.map(function(e){var t=e[0],r=t[0],n=t[1],i=e[1];return r}))};e.prototype._createMouseDrag$=function(e,t){var r=this;return e.pipe(c.map(function(e){var t=e[0],r=e[1];return r}),c.switchMap(function(e){return u.concat(u.of(e),r._documentMouseMove$).pipe(c.takeUntil(t))}))};e.prototype._createMouseDragEnd$=function(e,t){return e.pipe(c.switchMap(function(e){return t.pipe(c.first())}))};e.prototype._createMouseDragStart$=function(e){return e.pipe(c.map(function(e){var t=e[0],r=e[1];return t}))};e.prototype._createMouseDragInitiate$=function(e,t,r){var n=this;return e.pipe(c.filter(function(e){return e.button===0}),c.switchMap(function(e){return u.combineLatest(u.of(e),r?n._createDeferredMouseMove$(e,n._documentMouseMove$):n._documentMouseMove$).pipe(c.takeUntil(t),c.take(1))}))};e.prototype._createOwner$=function(e){return e.pipe(c.scan(function(e,t){if(t.zindex==null){delete e[t.name]}else{e[t.name]=t.zindex}return e},{}),c.map(function(e){var t=null;var r=-1;for(var n in e){if(!e.hasOwnProperty(n)){continue}if(e[n]>r){r=e[n];t=n}}return t}),c.startWith(null))};e.prototype._filtered=function(n,e,t){return e.pipe(c.withLatestFrom(t),c.filter(function(e){var t=e[0],r=e[1];return r===n}),c.map(function(e){var t=e[0],r=e[1];return t}))};return e}();r.MouseService=n;r.default=n},{rxjs:43,"rxjs/operators":241}],465:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var l=e("rxjs");var o=e("rxjs/operators");var p=e("../API");var f=e("../Graph");var n=e("../Edge");var i=e("../Error");var d=e("../State");var v=e("../Viewer");var m=e("./PanService");var a=function(){function e(e,t,r,n,i,o,a,s,u,c,h){this._apiV3=n!=null?n:new p.APIv3(e,r);this._imageLoadingService=o!=null?o:new f.ImageLoadingService;this._graphService=i!=null?i:new f.GraphService(new f.Graph(this.apiV3),this._imageLoadingService);this._loadingService=a!=null?a:new v.LoadingService;this._loadingName="navigator";this._stateService=s!=null?s:new d.StateService(t.transitionMode);this._cacheService=u!=null?u:new v.CacheService(this._graphService,this._stateService);this._playService=c!=null?c:new v.PlayService(this._graphService,this._stateService);this._panService=h!=null?h:new m.PanService(this._graphService,this._stateService,t.combinedPanning);this._keyRequested$=new l.BehaviorSubject(null);this._movedToKey$=new l.BehaviorSubject(null);this._request$=null;this._requestSubscription=null;this._nodeRequestSubscription=null}Object.defineProperty(e.prototype,"apiV3",{get:function(){return this._apiV3},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"cacheService",{get:function(){return this._cacheService},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"graphService",{get:function(){return this._graphService},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"imageLoadingService",{get:function(){return this._imageLoadingService},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"loadingService",{get:function(){return this._loadingService},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"movedToKey$",{get:function(){return this._movedToKey$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"panService",{get:function(){return this._panService},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"playService",{get:function(){return this._playService},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"stateService",{get:function(){return this._stateService},enumerable:true,configurable:true});e.prototype.moveToKey$=function(e){this._abortRequest("to key "+e);this._loadingService.startLoading(this._loadingName);var t=this._moveToKey$(e);return this._makeRequest$(t)};e.prototype.moveDir$=function(i){var t=this;this._abortRequest("in dir "+n.EdgeDirection[i]);this._loadingService.startLoading(this._loadingName);var e=this.stateService.currentNode$.pipe(o.first(),o.mergeMap(function(e){return([n.EdgeDirection.Next,n.EdgeDirection.Prev].indexOf(i)>-1?e.sequenceEdges$:e.spatialEdges$).pipe(o.first(),o.map(function(e){for(var t=0,r=e.edges;t<r.length;t++){var n=r[t];if(n.data.direction===i){return n.to}}return null}))}),o.mergeMap(function(e){if(e==null){t._loadingService.stopLoading(t._loadingName);return l.throwError(new Error("Direction ("+i+") does not exist for current node."))}return t._moveToKey$(e)}));return this._makeRequest$(e)};e.prototype.moveCloseTo$=function(t,r){var n=this;this._abortRequest("to lat "+t+", lon "+r);this._loadingService.startLoading(this._loadingName);var e=this.apiV3.imageCloseTo$(t,r).pipe(o.mergeMap(function(e){if(e==null){n._loadingService.stopLoading(n._loadingName);return l.throwError(new Error("No image found close to lat "+t+", lon "+r+"."))}return n._moveToKey$(e.key)}));return this._makeRequest$(e)};e.prototype.setFilter$=function(t){var r=this;this._stateService.clearNodes();return this._movedToKey$.pipe(o.first(),o.mergeMap(function(e){if(e!=null){return r._trajectoryKeys$().pipe(o.mergeMap(function(e){return r._graphService.setFilter$(t).pipe(o.mergeMap(function(){return r._cacheKeys$(e)}))}),o.last())}return r._keyRequested$.pipe(o.first(),o.mergeMap(function(e){if(e!=null){return r._graphService.setFilter$(t).pipe(o.mergeMap(function(){return r._graphService.cacheNode$(e)}))}return r._graphService.setFilter$(t).pipe(o.map(function(){return undefined}))}))}),o.map(function(e){return undefined}))};e.prototype.setToken$=function(t){var r=this;this._abortRequest("to set token");this._stateService.clearNodes();return this._movedToKey$.pipe(o.first(),o.tap(function(e){r._apiV3.setToken(t)}),o.mergeMap(function(e){return e==null?r._graphService.reset$([]):r._trajectoryKeys$().pipe(o.mergeMap(function(e){return r._graphService.reset$(e).pipe(o.mergeMap(function(){return r._cacheKeys$(e)}))}),o.last(),o.map(function(e){return undefined}))}))};e.prototype._cacheKeys$=function(e){var t=this;var r=e.map(function(e){return t._graphService.cacheNode$(e)});return l.from(r).pipe(o.mergeAll())};e.prototype._abortRequest=function(e){if(this._requestSubscription!=null){this._requestSubscription.unsubscribe();this._requestSubscription=null}if(this._nodeRequestSubscription!=null){this._nodeRequestSubscription.unsubscribe();this._nodeRequestSubscription=null}if(this._request$!=null){if(!(this._request$.isStopped||this._request$.hasError)){this._request$.error(new i.AbortMapillaryError("Request aborted by a subsequent request "+e+"."))}this._request$=null}};e.prototype._makeRequest$=function(e){var t=this;var r=new l.ReplaySubject(1);this._requestSubscription=r.subscribe(undefined,function(){});this._request$=r;this._nodeRequestSubscription=e.subscribe(function(e){t._request$=null;r.next(e);r.complete()},function(e){t._request$=null;r.error(e)});return r};e.prototype._moveToKey$=function(e){var t=this;this._keyRequested$.next(e);return this._graphService.cacheNode$(e).pipe(o.tap(function(e){t._stateService.setNodes([e]);t._movedToKey$.next(e.key)}),o.finalize(function(){t._loadingService.stopLoading(t._loadingName)}))};e.prototype._trajectoryKeys$=function(){return this._stateService.currentState$.pipe(o.first(),o.map(function(e){return e.state.trajectory.map(function(e){return e.key})}))};return e}();r.Navigator=a;r.default=a},{"../API":290,"../Edge":292,"../Error":293,"../Graph":295,"../State":298,"../Viewer":302,"./PanService":467,rxjs:43,"rxjs/operators":241}],466:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var s=e("rxjs");var c=e("rxjs/operators");var i=e("../Viewer");var n=function(){function e(e,t,r){var n=this;this._container=r;this._eventEmitter=e;this._navigator=t;this._projection=new i.Projection;this._started=false;this._navigable$=new s.Subject;this._navigable$.subscribe(function(e){n._eventEmitter.fire(i.Viewer.navigablechanged,e)});this._navigator.loadingService.loading$.subscribe(function(e){n._eventEmitter.fire(i.Viewer.loadingchanged,e)})}Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"navigable$",{get:function(){return this._navigable$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"projection",{get:function(){return this._projection},enumerable:true,configurable:true});e.prototype.project$=function(o){var a=this;return s.combineLatest(this._container.renderService.renderCamera$,this._navigator.stateService.currentNode$,this._navigator.stateService.reference$).pipe(c.first(),c.map(function(e){var t=e[0],r=e[1],n=e[2];if(a._projection.distanceBetweenLatLons(o,r.latLon)>1e3){return null}var i=a._projection.latLonToCanvas(o,a._container.element,t,n);return!!i?[Math.round(i[0]),Math.round(i[1])]:null}))};e.prototype.projectBasic$=function(i){var o=this;return s.combineLatest(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(c.first(),c.map(function(e){var t=e[0],r=e[1];var n=o._projection.basicToCanvas(i,o._container.element,t,r);return!!n?[Math.round(n[0]),Math.round(n[1])]:null}))};e.prototype.startEmit=function(){var u=this;if(this._started){return}this._started=true;this._currentNodeSubscription=this._navigator.stateService.currentNodeExternal$.subscribe(function(e){u._eventEmitter.fire(i.Viewer.nodechanged,e)});this._sequenceEdgesSubscription=this._navigator.stateService.currentNodeExternal$.pipe(c.switchMap(function(e){return e.sequenceEdges$})).subscribe(function(e){u._eventEmitter.fire(i.Viewer.sequenceedgeschanged,e)});this._spatialEdgesSubscription=this._navigator.stateService.currentNodeExternal$.pipe(c.switchMap(function(e){return e.spatialEdges$})).subscribe(function(e){u._eventEmitter.fire(i.Viewer.spatialedgeschanged,e)});this._moveSubscription=s.combineLatest(this._navigator.stateService.inMotion$,this._container.mouseService.active$,this._container.touchService.active$).pipe(c.map(function(e){return e[0]||e[1]||e[2]}),c.distinctUntilChanged()).subscribe(function(e){if(e){u._eventEmitter.fire(i.Viewer.movestart,null)}else{u._eventEmitter.fire(i.Viewer.moveend,null)}});this._bearingSubscription=this._container.renderService.bearing$.pipe(c.auditTime(100),c.distinctUntilChanged(function(e,t){return Math.abs(t-e)<1})).subscribe(function(e){u._eventEmitter.fire(i.Viewer.bearingchanged,e)});var e=this._container.mouseService.active$.pipe(c.switchMap(function(e){return e?s.empty():u._container.mouseService.mouseMove$}));this._viewerMouseEventSubscription=s.merge(this._mapMouseEvent$(i.Viewer.click,this._container.mouseService.staticClick$),this._mapMouseEvent$(i.Viewer.contextmenu,this._container.mouseService.contextMenu$),this._mapMouseEvent$(i.Viewer.dblclick,this._container.mouseService.dblClick$),this._mapMouseEvent$(i.Viewer.mousedown,this._container.mouseService.mouseDown$),this._mapMouseEvent$(i.Viewer.mousemove,e),this._mapMouseEvent$(i.Viewer.mouseout,this._container.mouseService.mouseOut$),this._mapMouseEvent$(i.Viewer.mouseover,this._container.mouseService.mouseOver$),this._mapMouseEvent$(i.Viewer.mouseup,this._container.mouseService.mouseUp$)).pipe(c.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$),c.map(function(e){var t=e[0],r=t[0],n=t[1],i=e[1],o=e[2],a=e[3];var s=u._projection.eventToUnprojection(n,u._container.element,i,o,a);return{basicPoint:s.basicPoint,latLon:s.latLon,originalEvent:n,pixelPoint:s.pixelPoint,target:u._eventEmitter,type:r}})).subscribe(function(e){u._eventEmitter.fire(e.type,e)});this._positionSubscription=this._container.renderService.renderCamera$.pipe(c.distinctUntilChanged(function(e,t){var r=e[0],n=e[1];var i=t[0],o=t[1];return u._closeTo(r,i,.01)&&u._closeTo(n,o,.01)},function(e){return e.camera.position.toArray()})).subscribe(function(){u._eventEmitter.fire(i.Viewer.positionchanged,{target:u._eventEmitter,type:i.Viewer.positionchanged})});this._povSubscription=this._container.renderService.renderCamera$.pipe(c.distinctUntilChanged(function(e,t){var r=e[0],n=e[1];var i=t[0],o=t[1];return u._closeTo(r,i,.001)&&u._closeTo(n,o,.001)},function(e){return[e.rotation.phi,e.rotation.theta]})).subscribe(function(){u._eventEmitter.fire(i.Viewer.povchanged,{target:u._eventEmitter,type:i.Viewer.povchanged})});this._fovSubscription=this._container.renderService.renderCamera$.pipe(c.distinctUntilChanged(function(e,t){return u._closeTo(e,t,.01)},function(e){return e.perspective.fov})).subscribe(function(){u._eventEmitter.fire(i.Viewer.fovchanged,{target:u._eventEmitter,type:i.Viewer.fovchanged})})};e.prototype.stopEmit=function(){if(!this.started){return}this._started=false;this._bearingSubscription.unsubscribe();this._currentNodeSubscription.unsubscribe();this._fovSubscription.unsubscribe();this._moveSubscription.unsubscribe();this._positionSubscription.unsubscribe();this._povSubscription.unsubscribe();this._sequenceEdgesSubscription.unsubscribe();this._spatialEdgesSubscription.unsubscribe();this._viewerMouseEventSubscription.unsubscribe();this._bearingSubscription=null;this._currentNodeSubscription=null;this._fovSubscription=null;this._moveSubscription=null;this._positionSubscription=null;this._povSubscription=null;this._sequenceEdgesSubscription=null;this._spatialEdgesSubscription=null;this._viewerMouseEventSubscription=null};e.prototype.unproject$=function(o){var a=this;return s.combineLatest(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$).pipe(c.first(),c.map(function(e){var t=e[0],r=e[1],n=e[2];var i=a._projection.canvasToUnprojection(o,a._container.element,t,r,n);return i.latLon}))};e.prototype.unprojectBasic$=function(n){var i=this;return s.combineLatest(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(c.first(),c.map(function(e){var t=e[0],r=e[1];return i._projection.canvasToBasic(n,i._container.element,t,r)}))};e.prototype._closeTo=function(e,t,r){return Math.abs(e-t)<=r};e.prototype._mapMouseEvent$=function(t,e){return e.pipe(c.map(function(e){return[t,e]}))};return e}();r.Observer=n;r.default=n},{"../Viewer":302,rxjs:43,"rxjs/operators":241}],467:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var s=e("rxjs");var u=e("rxjs/operators");var L=e("../geo/Geo");var c=e("../geo/GeoCoords");var h=e("../graph/GraphCalculator");var l=e("../geo/Spatial");var n=e("../geo/Transform");var p=e("../geo/ViewportCoords");var f;(function(e){e[e["Disabled"]=0]="Disabled";e[e["Enabled"]=1]="Enabled";e[e["Started"]=2]="Started"})(f||(f={}));var i=function(){function e(e,t,r,n,i,o,a){this._graphService=e;this._stateService=t;this._geoCoords=!!n?n:new c.default;this._graphCalculator=!!i?i:new h.default(this._geoCoords);this._spatial=!!o?o:new l.default;this._viewportCoords=!!a?a:new p.default;this._mode=r!==false?f.Enabled:f.Disabled;this._panNodesSubject$=new s.Subject;this._panNodes$=this._panNodesSubject$.pipe(u.startWith([]),u.publishReplay(1),u.refCount());this._panNodes$.subscribe()}Object.defineProperty(e.prototype,"panNodes$",{get:function(){return this._panNodes$},enumerable:true,configurable:true});e.prototype.enable=function(){if(this._mode!==f.Disabled){return}this._mode=f.Enabled;this.start()};e.prototype.disable=function(){if(this._mode===f.Disabled){return}this.stop();this._mode=f.Disabled};e.prototype.start=function(){var k=this;if(this._mode!==f.Enabled){return}var t=this._stateService.currentNode$.pipe(u.switchMap(function(o){if(!o.merged){return s.of([])}var e=s.of(o);var t=k._graphCalculator.boundingBoxCorners(o.latLon,20);var r=k._graphService.cacheBoundingBox$(t[0],t[1]).pipe(u.catchError(function(e){console.error("Failed to cache periphery bounding box ("+o.key+")",e);return s.empty()}),u.map(function(e){if(o.pano){return[]}var t=[];for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.key===o.key){continue}if(i.mergeCC!==o.mergeCC){continue}if(i.pano){continue}if(k._distance(i,o)>4){continue}t.push(i)}return t}));return s.combineLatest(e,r).pipe(u.withLatestFrom(k._stateService.reference$),u.map(function(e){var t=e[0],r=t[0],n=t[1],i=e[1];var o=k._spatial.viewingDirection(r.rotation);var a=L.computeTranslation({lat:r.latLon.lat,lon:r.latLon.lon,alt:r.alt},r.rotation,i);var s=k._createTransform(r,a);var u=k._spatial.wrap(k._spatial.azimuthal(o.toArray(),s.upVector().toArray()),0,2*Math.PI);var c=k._computeProjectedPoints(s);var h=k._computeHorizontalFov(c)/180*Math.PI;var l=Math.PI/8;var p=undefined;var f=undefined;for(var d=0,v=n;d<v.length;d++){var m=v[d];var g=L.computeTranslation({lat:m.latLon.lat,lon:m.latLon.lon,alt:m.alt},m.rotation,i);var _=k._createTransform(m,g);var y=k._computeProjectedPoints(_);var b=k._computeHorizontalFov(y)/180*Math.PI;var w=k._spatial.viewingDirection(m.rotation);var x=k._spatial.wrap(k._spatial.azimuthal(w.toArray(),_.upVector().toArray()),0,2*Math.PI);var S=k._spatial.angleBetweenVector2(o.x,o.y,w.x,w.y);var M=Number.NEGATIVE_INFINITY;if(S>0){if(u>x){M=u-2*Math.PI+h/2-(x-b/2)}else{M=u+h/2-(x-b/2)}}else{if(u<x){M=x+b/2-(u+2*Math.PI-h/2)}else{M=x+b/2-(u-h/2)}}var C=Math.abs(b-M);var E=k._distance(m,r);var T=Math.min(k._timeDifference(m,r),4);var O=20*Math.abs(M-l);var P=Math.min(5,1/Math.min(b/h,1));var A=M>0?-2*C:0;var j=E+T+O+P+A;if(M>0&&M<.5*h&&M<.5*b&&C>.5*h){if(S>0){if(!p){p=[j,m,_,b]}else{if(j<p[0]){p=[j,m,_,b]}}}else{if(!f){f=[j,m,_,b]}else{if(j<f[0]){f=[j,m,_,b]}}}}}var R=[];if(!!p){R.push([p[1],p[2],p[3]])}if(!!f){R.push([f[1],f[2],f[3]])}return R}),u.startWith([]))}));this._panNodesSubscription=this._stateService.currentState$.pipe(u.map(function(e){return e.state.nodesAhead>0}),u.distinctUntilChanged(),u.switchMap(function(e){return e?s.of([]):t})).subscribe(function(e){k._panNodesSubject$.next(e)});this._mode=f.Started};e.prototype.stop=function(){if(this._mode!==f.Started){return}this._panNodesSubscription.unsubscribe();this._panNodesSubject$.next([]);this._mode=f.Enabled};e.prototype._distance=function(e,t){var r=this._geoCoords.geodeticToEnu(e.latLon.lat,e.latLon.lon,e.alt,t.latLon.lat,t.latLon.lon,t.alt),n=r[0],i=r[1],o=r[2];return Math.sqrt(n*n+i*i+o*o)};e.prototype._timeDifference=function(e,t){return Math.abs(e.capturedAt-t.capturedAt)/(1e3*60*60*24*30)};e.prototype._createTransform=function(e,t){return new n.Transform(e.orientation,e.width,e.height,e.focal,e.scale,e.gpano,e.rotation,t,e.assetsCached?e.image:undefined,undefined,e.ck1,e.ck2,e.cameraProjection)};e.prototype._computeProjectedPoints=function(e){var t=[[1,0]];var r=[[0,.5]];var n=20;return L.computeProjectedPoints(e,t,r,n,this._viewportCoords)};e.prototype._computeHorizontalFov=function(e){var t=this;var r=e.map(function(e){return t._coordToFov(e[0])});var n=Math.min.apply(Math,r);return n};e.prototype._coordToFov=function(e){return 2*Math.atan(e)*180/Math.PI};return e}();r.PanService=i},{"../geo/Geo":409,"../geo/GeoCoords":410,"../geo/Spatial":412,"../geo/Transform":413,"../geo/ViewportCoords":414,"../graph/GraphCalculator":417,rxjs:43,"rxjs/operators":241}],468:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var c=e("rxjs");var p=e("rxjs/operators");var s=e("../Edge");var u=e("../Graph");var n=function(){function r(e,t,r){this._graphService=e;this._stateService=t;this._graphCalculator=!!r?r:new u.GraphCalculator;this._directionSubject$=new c.Subject;this._direction$=this._directionSubject$.pipe(p.startWith(s.EdgeDirection.Next),p.publishReplay(1),p.refCount());this._direction$.subscribe();this._playing=false;this._playingSubject$=new c.Subject;this._playing$=this._playingSubject$.pipe(p.startWith(this._playing),p.publishReplay(1),p.refCount());this._playing$.subscribe();this._speed=.5;this._speedSubject$=new c.Subject;this._speed$=this._speedSubject$.pipe(p.startWith(this._speed),p.publishReplay(1),p.refCount());this._speed$.subscribe();this._nodesAhead=this._mapNodesAhead(this._mapSpeed(this._speed));this._bridging$=null}Object.defineProperty(r.prototype,"playing",{get:function(){return this._playing},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"direction$",{get:function(){return this._direction$},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"playing$",{get:function(){return this._playing$},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"speed$",{get:function(){return this._speed$},enumerable:true,configurable:true});r.prototype.play=function(){var l=this;if(this._playing){return}this._stateService.cutNodes();var e=this._setSpeed(this._speed);this._stateService.setSpeed(e);this._graphModeSubscription=this._speed$.pipe(p.map(function(e){return e>r.sequenceSpeed?u.GraphMode.Sequence:u.GraphMode.Spatial}),p.distinctUntilChanged()).subscribe(function(e){l._graphService.setGraphMode(e)});this._cacheSubscription=c.combineLatest(this._stateService.currentNode$.pipe(p.map(function(e){return[e.sequenceKey,e.key]}),p.distinctUntilChanged(undefined,function(e){var t=e[0],r=e[1];return t})),this._graphService.graphMode$,this._direction$).pipe(p.switchMap(function(e){var t=e[0],r=t[0],n=t[1],i=e[1],o=e[2];if(o!==s.EdgeDirection.Next&&o!==s.EdgeDirection.Prev){return c.of([undefined,o])}var a=(i===u.GraphMode.Sequence?l._graphService.cacheSequenceNodes$(r,n):l._graphService.cacheSequence$(r)).pipe(p.retry(3),p.catchError(function(e){console.error(e);return c.of(undefined)}));return c.combineLatest(a,c.of(o))}),p.switchMap(function(e){var t=e[0],r=e[1];if(t===undefined){return c.empty()}var h=t.keys.slice();if(r===s.EdgeDirection.Prev){h.reverse()}return l._stateService.currentState$.pipe(p.map(function(e){return[e.state.trajectory[e.state.trajectory.length-1].key,e.state.nodesAhead]}),p.scan(function(e,t){var r=e[0],n=e[1];var i=t[0],o=t[1];if(r===undefined){r=i}var a=h.length-1;if(o>=l._nodesAhead||h[a]===r){return[r,[]]}var s=h.indexOf(i);var u=h.indexOf(r)+1;var c=Math.min(a,s+l._nodesAhead-o)+1;if(c<=u){return[r,[]]}return[h[c-1],h.slice(u,c)]},[undefined,[]]),p.mergeMap(function(e){var t=e[0],r=e[1];return c.from(r)}))}),p.mergeMap(function(e){return l._graphService.cacheNode$(e).pipe(p.catchError(function(){return c.empty()}))},6)).subscribe();this._playingSubscription=this._stateService.currentState$.pipe(p.filter(function(e){return e.state.nodesAhead<l._nodesAhead}),p.distinctUntilChanged(undefined,function(e){return e.state.lastNode.key}),p.map(function(e){var t=e.state.lastNode;var r=e.state.trajectory;var n=undefined;for(var i=r.length-2;i>=0;i--){var o=r[i];if(o.sequenceKey!==t.sequenceKey){break}if(o.capturedAt!==t.capturedAt){n=o.capturedAt<t.capturedAt;break}}return[e.state.lastNode,n]}),p.withLatestFrom(this._direction$),p.switchMap(function(e){var t=e[0],r=t[0],n=t[1],i=e[1];return c.zip(([s.EdgeDirection.Next,s.EdgeDirection.Prev].indexOf(i)>-1?r.sequenceEdges$:r.spatialEdges$).pipe(p.first(function(e){return e.cached}),p.timeout(15e3)),c.of(i)).pipe(p.map(function(e){var t=e[0],r=e[1];for(var n=0,i=t.edges;n<i.length;n++){var o=i[n];if(o.data.direction===r){return o.to}}return null}),p.switchMap(function(e){return e!=null?l._graphService.cacheNode$(e):l._bridge$(r,n).pipe(p.filter(function(e){return!!e}))}))})).subscribe(function(e){l._stateService.appendNodes([e])},function(e){console.error(e);l.stop()});this._clearSubscription=this._stateService.currentNode$.pipe(p.bufferCount(1,10)).subscribe(function(e){l._stateService.clearPriorNodes()});this._setPlaying(true);var t=this._stateService.currentState$.pipe(p.map(function(e){return e.state}),p.distinctUntilChanged(function(e,t){var r=e[0],n=e[1];var i=t[0],o=t[1];return r===i&&n===o},function(e){return[e.currentNode.key,e.lastNode.key]}),p.filter(function(e){return e.currentNode.key===e.lastNode.key&&e.currentIndex===e.trajectory.length-1}),p.map(function(e){return e.currentNode}));this._stopSubscription=c.combineLatest(t,this._direction$).pipe(p.switchMap(function(e){var t=e[0],r=e[1];var n=([s.EdgeDirection.Next,s.EdgeDirection.Prev].indexOf(r)>-1?t.sequenceEdges$:t.spatialEdges$).pipe(p.first(function(e){return e.cached}),p.timeout(15e3),p.catchError(function(e){console.error(e);return c.of({cached:false,edges:[]})}));return c.combineLatest(c.of(r),n).pipe(p.map(function(e){var t=e[0],r=e[1];for(var n=0,i=r.edges;n<i.length;n++){var o=i[n];if(o.data.direction===t){return true}}return false}))}),p.mergeMap(function(e){if(e||!l._bridging$){return c.of(e)}return l._bridging$.pipe(p.map(function(e){return e!=null}),p.catchError(function(e){console.error(e);return c.of(false)}))}),p.first(function(e){return!e})).subscribe(undefined,undefined,function(){l.stop()});if(this._stopSubscription.closed){this._stopSubscription=null}};r.prototype.setDirection=function(e){this._directionSubject$.next(e)};r.prototype.setSpeed=function(e){e=Math.max(0,Math.min(1,e));if(e===this._speed){return}var t=this._setSpeed(e);if(this._playing){this._stateService.setSpeed(t)}this._speedSubject$.next(this._speed)};r.prototype.stop=function(){if(!this._playing){return}if(!!this._stopSubscription){if(!this._stopSubscription.closed){this._stopSubscription.unsubscribe()}this._stopSubscription=null}this._graphModeSubscription.unsubscribe();this._graphModeSubscription=null;this._cacheSubscription.unsubscribe();this._cacheSubscription=null;this._playingSubscription.unsubscribe();this._playingSubscription=null;this._clearSubscription.unsubscribe();this._clearSubscription=null;this._stateService.setSpeed(1);this._stateService.cutNodes();this._graphService.setGraphMode(u.GraphMode.Spatial);this._setPlaying(false)};r.prototype._bridge$=function(a,s){var u=this;if(s===undefined){return c.of(null)}var e=this._graphCalculator.boundingBoxCorners(a.latLon,25);this._bridging$=this._graphService.cacheBoundingBox$(e[0],e[1]).pipe(p.mergeMap(function(e){var t=null;for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.sequenceKey===a.sequenceKey||!i.cameraUuid||i.cameraUuid!==a.cameraUuid||i.capturedAt===a.capturedAt||i.capturedAt>a.capturedAt!==s){continue}var o=Math.abs(i.capturedAt-a.capturedAt);if(o>15e3){continue}if(!t||o<Math.abs(t.capturedAt-a.capturedAt)){t=i}}return!!t?u._graphService.cacheNode$(t.key):c.of(null)}),p.finalize(function(){u._bridging$=null}),p.publish(),p.refCount());return this._bridging$};r.prototype._mapSpeed=function(e){var t=2*e-1;return Math.pow(10,t)-.2*t};r.prototype._mapNodesAhead=function(e){return Math.round(Math.max(10,Math.min(50,8+6*e)))};r.prototype._setPlaying=function(e){this._playing=e;this._playingSubject$.next(e)};r.prototype._setSpeed=function(e){this._speed=e;var t=this._mapSpeed(this._speed);this._nodesAhead=this._mapNodesAhead(t);return t};r.sequenceSpeed=.54;return r}();r.PlayService=n;r.default=n},{"../Edge":292,"../Graph":295,rxjs:43,"rxjs/operators":241}],469:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var _=e("three");var n=e("../Geo");var i=e("../geo/Spatial");var o=function(){function e(e,t,r){this._geoCoords=!!e?e:new n.GeoCoords;this._spatial=!!r?r:new i.default;this._viewportCoords=!!t?t:new n.ViewportCoords}e.prototype.basicToCanvas=function(e,t,r,n){return this._viewportCoords.basicToCanvasSafe(e[0],e[1],t,n,r.perspective)};e.prototype.canvasToBasic=function(e,t,r,n){var i=this._viewportCoords.canvasToBasic(e[0],e[1],t,n,r.perspective);if(i[0]<0||i[0]>1||i[1]<0||i[1]>1){i=null}return i};e.prototype.eventToUnprojection=function(e,t,r,n,i){var o=this._viewportCoords.canvasPosition(e,t);return this.canvasToUnprojection(o,t,r,n,i)};e.prototype.canvasToUnprojection=function(e,t,r,n,i){var o=e[0];var a=e[1];var s=this._viewportCoords.canvasToViewport(o,a,t),u=s[0],c=s[1];var h=new _.Vector3(u,c,1).unproject(r.perspective);var l=i.projectBasic(h.toArray());if(l[0]<0||l[0]>1||l[1]<0||l[1]>1){l=null}var p=h.clone().sub(r.camera.position).normalize();var f=-2/p.z;var d=null;if(f>0&&f<100&&!!l){var v=p.clone().multiplyScalar(f).add(r.camera.position);var m=this._geoCoords.enuToGeodetic(v.x,v.y,v.z,n.lat,n.lon,n.alt).slice(0,2);d={lat:m[0],lon:m[1]}}var g={basicPoint:l,latLon:d,pixelPoint:[o,a]};return g};e.prototype.cameraToLatLon=function(e,t){var r=e.camera.position;var n=this._geoCoords.enuToGeodetic(r.x,r.y,r.z,t.lat,t.lon,t.alt),i=n[0],o=n[1];return{lat:i,lon:o}};e.prototype.latLonToCanvas=function(e,t,r,n){var i=this._geoCoords.geodeticToEnu(e.lat,e.lon,0,n.lat,n.lon,n.alt);var o=this._viewportCoords.projectToCanvasSafe(i,t,r.perspective);return o};e.prototype.distanceBetweenLatLons=function(e,t){return this._spatial.distanceFromLatLon(e.lat,e.lon,t.lat,t.lon)};return e}();r.Projection=o;r.default=o},{"../Geo":294,"../geo/Spatial":412,three:242}],470:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var o=e("rxjs/operators");var a=e("three");var f=e("virtual-dom");var s=e("rxjs");var d=e("../Viewer");var u=function(){function e(){}Object.defineProperty(e.prototype,"json",{set:function(e){this._json=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"image",{set:function(e){this._image=e;this._texture=new a.Texture(this._image);this._texture.minFilter=a.NearestFilter},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"loaded",{get:function(){return!!(this._image&&this._json)},enumerable:true,configurable:true});e.prototype.getGLSprite=function(e){if(!this.loaded){throw new Error("Sprites cannot be retrieved before the atlas is loaded.")}var t=this._json[e];if(!t){console.warn("Sprite with key"+e+"does not exist in sprite definition.");return new a.Object3D}var r=this._texture.clone();r.needsUpdate=true;var n=this._image.width;var i=this._image.height;r.offset.x=t.x/n;r.offset.y=(i-t.y-t.height)/i;r.repeat.x=t.width/n;r.repeat.y=t.height/i;var o=new a.SpriteMaterial({map:r});return new a.Sprite(o)};e.prototype.getDOMSprite=function(e,t){if(!this.loaded){throw new Error("Sprites cannot be retrieved before the atlas is loaded.")}if(t==null){t=d.Alignment.Center}var r=this._json[e];if(!r){console.warn("Sprite with key"+e+"does not exist in sprite definition.");return f.h("div",{},[])}var n=r.y;var i=r.x+r.width;var o=r.y+r.height;var a=r.x;var s=-r.x;var u=-r.y;var c=this._image.height;var h=this._image.width;switch(t){case d.Alignment.Bottom:case d.Alignment.Center:case d.Alignment.Top:s-=r.width/2;break;case d.Alignment.BottomLeft:case d.Alignment.Left:case d.Alignment.TopLeft:s-=r.width;break;case d.Alignment.BottomRight:case d.Alignment.Right:case d.Alignment.TopRight:default:break}switch(t){case d.Alignment.Center:case d.Alignment.Left:case d.Alignment.Right:u-=r.height/2;break;case d.Alignment.Top:case d.Alignment.TopLeft:case d.Alignment.TopRight:u-=r.height;break;case d.Alignment.Bottom:case d.Alignment.BottomLeft:case d.Alignment.BottomRight:default:break}var l=1/r.pixelRatio;n*=l;i*=l;o*=l;a*=l;s*=l;u*=l;c*=l;h*=l;var p={src:this._image.src,style:{clip:"rect("+n+"px, "+i+"px, "+o+"px, "+a+"px)",height:c+"px",left:s+"px",position:"absolute",top:u+"px",width:h+"px"}};return f.h("img",p,[])};return e}();var n=function(){function e(t){var r=this;this._retina=window.devicePixelRatio>1;this._spriteAtlasOperation$=new s.Subject;this._spriteAtlas$=this._spriteAtlasOperation$.pipe(o.startWith(function(e){return e}),o.scan(function(e,t){return t(e)},new u),o.publishReplay(1),o.refCount());this._spriteAtlas$.subscribe(function(){});if(t==null){return}var n=this._retina?"@2x":"";var i=new XMLHttpRequest;i.open("GET",t+n+".png",true);i.responseType="arraybuffer";i.onload=function(){var t=new Image;t.onload=function(){r._spriteAtlasOperation$.next(function(e){e.image=t;return e})};var e=new Blob([i.response]);t.src=window.URL.createObjectURL(e)};i.onerror=function(e){console.error(new Error("Failed to fetch sprite sheet ("+t+n+".png)"))};i.send();var e=new XMLHttpRequest;e.open("GET",t+n+".json",true);e.responseType="text";e.onload=function(){var t=JSON.parse(e.response);r._spriteAtlasOperation$.next(function(e){e.json=t;return e})};e.onerror=function(e){console.error(new Error("Failed to fetch sheet ("+t+n+".json)"))};e.send()}Object.defineProperty(e.prototype,"spriteAtlas$",{get:function(){return this._spriteAtlas$},enumerable:true,configurable:true});return e}();r.SpriteService=n;r.default=n},{"../Viewer":302,rxjs:43,"rxjs/operators":241,three:242,"virtual-dom":247}],471:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var u=e("rxjs");var c=e("rxjs/operators");var n=function(){function e(e,t){var r=this;this._activeSubject$=new u.BehaviorSubject(false);this._active$=this._activeSubject$.pipe(c.distinctUntilChanged(),c.publishReplay(1),c.refCount());u.fromEvent(t,"touchmove").subscribe(function(e){e.preventDefault()});this._touchStart$=u.fromEvent(e,"touchstart");this._touchMove$=u.fromEvent(e,"touchmove");this._touchEnd$=u.fromEvent(e,"touchend");this._touchCancel$=u.fromEvent(e,"touchcancel");var n=this._touchStart$.pipe(c.filter(function(e){return e.touches.length===1&&e.targetTouches.length===1}),c.share());this._doubleTap$=n.pipe(c.bufferWhen(function(){return n.pipe(c.first(),c.switchMap(function(e){return u.merge(u.timer(300),n).pipe(c.take(1))}))}),c.filter(function(e){return e.length===2}),c.map(function(e){return e[e.length-1]}),c.share());this._doubleTap$.subscribe(function(e){e.preventDefault()});this._singleTouchMove$=this._touchMove$.pipe(c.filter(function(e){return e.touches.length===1&&e.targetTouches.length===1}),c.share());var i=u.merge(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(c.filter(function(e){return e.touches.length===1&&e.targetTouches.length===1}));var o=u.merge(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(c.filter(function(e){return e.touches.length>=1}));var a=u.merge(this._touchEnd$,this._touchCancel$).pipe(c.filter(function(e){return e.touches.length===0}));this._singleTouchDragStart$=i.pipe(c.mergeMap(function(e){return r._singleTouchMove$.pipe(c.takeUntil(u.merge(a,o)),c.take(1))}));this._singleTouchDragEnd$=i.pipe(c.mergeMap(function(e){return u.merge(a,o).pipe(c.first())}));this._singleTouchDrag$=i.pipe(c.switchMap(function(e){return r._singleTouchMove$.pipe(c.skip(1),c.takeUntil(u.merge(o,a)))}));var s=u.merge(this._touchStart$,this._touchEnd$,this._touchCancel$);this._pinchStart$=s.pipe(c.filter(function(e){return e.touches.length===2&&e.targetTouches.length===2}));this._pinchEnd$=s.pipe(c.filter(function(e){return e.touches.length!==2||e.targetTouches.length!==2}));this._pinchOperation$=new u.Subject;this._pinch$=this._pinchOperation$.pipe(c.scan(function(e,t){return t(e)},{changeX:0,changeY:0,clientX:0,clientY:0,distance:0,distanceChange:0,distanceX:0,distanceY:0,originalEvent:null,pageX:0,pageY:0,screenX:0,screenY:0,touch1:null,touch2:null}));this._touchMove$.pipe(c.filter(function(e){return e.touches.length===2&&e.targetTouches.length===2}),c.map(function(b){return function(e){var t=b.touches[0];var r=b.touches[1];var n=Math.min(t.clientX,r.clientX);var i=Math.max(t.clientX,r.clientX);var o=Math.min(t.clientY,r.clientY);var a=Math.max(t.clientY,r.clientY);var s=n+(i-n)/2;var u=o+(a-o)/2;var c=s+t.pageX-t.clientX;var h=u+t.pageY-t.clientY;var l=s+t.screenX-t.clientX;var p=u+t.screenY-t.clientY;var f=Math.abs(t.clientX-r.clientX);var d=Math.abs(t.clientY-r.clientY);var v=Math.sqrt(f*f+d*d);var m=v-e.distance;var g=f-e.distanceX;var _=d-e.distanceY;var y={changeX:g,changeY:_,clientX:s,clientY:u,distance:v,distanceChange:m,distanceX:f,distanceY:d,originalEvent:b,pageX:c,pageY:h,screenX:l,screenY:p,touch1:t,touch2:r};return y}})).subscribe(this._pinchOperation$);this._pinchChange$=this._pinchStart$.pipe(c.switchMap(function(e){return r._pinch$.pipe(c.skip(1),c.takeUntil(r._pinchEnd$))}))}Object.defineProperty(e.prototype,"active$",{get:function(){return this._active$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"activate$",{get:function(){return this._activeSubject$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"doubleTap$",{get:function(){return this._doubleTap$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"touchStart$",{get:function(){return this._touchStart$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"touchMove$",{get:function(){return this._touchMove$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"touchEnd$",{get:function(){return this._touchEnd$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"touchCancel$",{get:function(){return this._touchCancel$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"singleTouchDragStart$",{get:function(){return this._singleTouchDragStart$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"singleTouchDrag$",{get:function(){return this._singleTouchDrag$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"singleTouchDragEnd$",{get:function(){return this._singleTouchDragEnd$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"pinch$",{get:function(){return this._pinchChange$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"pinchStart$",{get:function(){return this._pinchStart$},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"pinchEnd$",{get:function(){return this._pinchEnd$},enumerable:true,configurable:true});return e}();r.TouchService=n},{rxjs:43,"rxjs/operators":241}],472:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(r,"__esModule",{value:true});var o=e("rxjs");var s=e("rxjs/operators");var u=e("when");var c=e("../Viewer");var h=e("../Utils");var i=function(a){n(e,a);function e(e,t,r,n,i){var o=a.call(this)||this;n=n!=null?n:{};h.Settings.setOptions(n);h.Urls.setOptions(n.url);o._navigator=new c.Navigator(t,n,i);o._container=new c.Container(e,o._navigator.stateService,n);o._observer=new c.Observer(o,o._navigator,o._container);o._componentController=new c.ComponentController(o._container,o._navigator,o._observer,r,n.component);return o}Object.defineProperty(e.prototype,"isNavigable",{get:function(){return this._componentController.navigable},enumerable:true,configurable:true});e.prototype.activateCombinedPanning=function(){this._navigator.panService.enable()};e.prototype.activateComponent=function(e){this._componentController.activate(e)};e.prototype.activateCover=function(){this._componentController.activateCover()};e.prototype.deactivateCombinedPanning=function(){this._navigator.panService.disable()};e.prototype.deactivateComponent=function(e){this._componentController.deactivate(e)};e.prototype.deactivateCover=function(){this._componentController.deactivateCover()};e.prototype.getBearing=function(){var e=this;return u.promise(function(t,r){e._container.renderService.bearing$.pipe(s.first()).subscribe(function(e){t(e)},function(e){r(e)})})};e.prototype.getCanvasContainer=function(){return this._container.canvasContainer};e.prototype.getCenter=function(){var e=this;return u.promise(function(t,r){e._navigator.stateService.getCenter().subscribe(function(e){t(e)},function(e){r(e)})})};e.prototype.getComponent=function(e){return this._componentController.get(e)};e.prototype.getContainer=function(){return this._container.element};e.prototype.getFieldOfView=function(){var e=this;return u.promise(function(t,r){e._container.renderService.renderCamera$.pipe(s.first()).subscribe(function(e){t(e.perspective.fov)},function(e){r(e)})})};e.prototype.getPointOfView=function(){var e=this;return u.promise(function(n,t){o.combineLatest(e._container.renderService.renderCamera$,e._container.renderService.bearing$).pipe(s.first()).subscribe(function(e){var t=e[0],r=e[1];n({bearing:r,tilt:t.getTilt()})},function(e){t(e)})})};e.prototype.getPosition=function(){var i=this;return u.promise(function(n,t){o.combineLatest(i._container.renderService.renderCamera$,i._navigator.stateService.reference$).pipe(s.first()).subscribe(function(e){var t=e[0],r=e[1];n(i._observer.projection.cameraToLatLon(t,r))},function(e){t(e)})})};e.prototype.getZoom=function(){var e=this;return u.promise(function(t,r){e._navigator.stateService.getZoom().subscribe(function(e){t(e)},function(e){r(e)})})};e.prototype.moveCloseTo=function(e,t){var n=this.isNavigable?this._navigator.moveCloseTo$(e,t):o.throwError(new Error("Calling moveCloseTo is not supported when viewer is not navigable."));return u.promise(function(t,r){n.subscribe(function(e){t(e)},function(e){r(e)})})};e.prototype.moveDir=function(e){var n=this.isNavigable?this._navigator.moveDir$(e):o.throwError(new Error("Calling moveDir is not supported when viewer is not navigable."));return u.promise(function(t,r){n.subscribe(function(e){t(e)},function(e){r(e)})})};e.prototype.moveToKey=function(e){var n=this.isNavigable?this._navigator.moveToKey$(e):o.throwError(new Error("Calling moveToKey is not supported when viewer is not navigable."));return u.promise(function(t,r){n.subscribe(function(e){t(e)},function(e){r(e)})})};e.prototype.project=function(e){var n=this;return u.promise(function(t,r){n._observer.project$(e).subscribe(function(e){t(e)},function(e){r(e)})})};e.prototype.projectFromBasic=function(e){var n=this;return u.promise(function(t,r){n._observer.projectBasic$(e).subscribe(function(e){t(e)},function(e){r(e)})})};e.prototype.resize=function(){this._container.renderService.resize$.next(null)};e.prototype.setAuthToken=function(e){var r=this.isNavigable?this._navigator.setToken$(e):o.throwError(new Error("Calling setAuthToken is not supported when viewer is not navigable."));return u.promise(function(e,t){r.subscribe(function(){e(undefined)},function(e){t(e)})})};e.prototype.setCenter=function(e){this._navigator.stateService.setCenter(e)};e.prototype.setFilter=function(r){var n=this;return u.promise(function(e,t){n._navigator.setFilter$(r).subscribe(function(){e(undefined)},function(e){t(e)})})};e.prototype.setFieldOfView=function(r){var n=this;this._container.renderService.renderCamera$.pipe(s.first()).subscribe(function(e){var t=e.fovToZoom(r);n._navigator.stateService.setZoom(t)})};e.prototype.setRenderMode=function(e){this._container.renderService.renderMode$.next(e)};e.prototype.setTransitionMode=function(e){this._navigator.stateService.setTransitionMode(e)};e.prototype.setZoom=function(e){this._navigator.stateService.setZoom(e)};e.prototype.unproject=function(e){var n=this;return u.promise(function(t,r){n._observer.unproject$(e).subscribe(function(e){t(e)},function(e){r(e)})})};e.prototype.unprojectToBasic=function(e){var n=this;return u.promise(function(t,r){n._observer.unprojectBasic$(e).subscribe(function(e){t(e)},function(e){r(e)})})};e.bearingchanged="bearingchanged";e.click="click";e.contextmenu="contextmenu";e.dblclick="dblclick";e.fovchanged="fovchanged";e.loadingchanged="loadingchanged";e.mousedown="mousedown";e.mousemove="mousemove";e.mouseout="mouseout";e.mouseover="mouseover";e.mouseup="mouseup";e.moveend="moveend";e.movestart="movestart";e.navigablechanged="navigablechanged";e.nodechanged="nodechanged";e.positionchanged="positionchanged";e.povchanged="povchanged";e.sequenceedgeschanged="sequenceedgeschanged";e.spatialedgeschanged="spatialedgeschanged";return e}(h.EventEmitter);r.Viewer=i},{"../Utils":301,"../Viewer":302,rxjs:43,"rxjs/operators":241,when:288}]},{},[296])(296)});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],7:[function(require,module,exports){
(function (global){
/**!
 * @fileOverview Kickass library to create and place poppers near their reference elements.
 * @version 1.16.1
 * @license
 * Copyright (c) 2016 Federico Zivolo and contributors
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
	typeof define === 'function' && define.amd ? define(factory) :
	(global.Popper = factory());
}(this, (function () { 'use strict';

var isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined' && typeof navigator !== 'undefined';

var timeoutDuration = function () {
  var longerTimeoutBrowsers = ['Edge', 'Trident', 'Firefox'];
  for (var i = 0; i < longerTimeoutBrowsers.length; i += 1) {
    if (isBrowser && navigator.userAgent.indexOf(longerTimeoutBrowsers[i]) >= 0) {
      return 1;
    }
  }
  return 0;
}();

function microtaskDebounce(fn) {
  var called = false;
  return function () {
    if (called) {
      return;
    }
    called = true;
    window.Promise.resolve().then(function () {
      called = false;
      fn();
    });
  };
}

function taskDebounce(fn) {
  var scheduled = false;
  return function () {
    if (!scheduled) {
      scheduled = true;
      setTimeout(function () {
        scheduled = false;
        fn();
      }, timeoutDuration);
    }
  };
}

var supportsMicroTasks = isBrowser && window.Promise;

/**
* Create a debounced version of a method, that's asynchronously deferred
* but called in the minimum time possible.
*
* @method
* @memberof Popper.Utils
* @argument {Function} fn
* @returns {Function}
*/
var debounce = supportsMicroTasks ? microtaskDebounce : taskDebounce;

/**
 * Check if the given variable is a function
 * @method
 * @memberof Popper.Utils
 * @argument {Any} functionToCheck - variable to check
 * @returns {Boolean} answer to: is a function?
 */
function isFunction(functionToCheck) {
  var getType = {};
  return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';
}

/**
 * Get CSS computed property of the given element
 * @method
 * @memberof Popper.Utils
 * @argument {Eement} element
 * @argument {String} property
 */
function getStyleComputedProperty(element, property) {
  if (element.nodeType !== 1) {
    return [];
  }
  // NOTE: 1 DOM access here
  var window = element.ownerDocument.defaultView;
  var css = window.getComputedStyle(element, null);
  return property ? css[property] : css;
}

/**
 * Returns the parentNode or the host of the element
 * @method
 * @memberof Popper.Utils
 * @argument {Element} element
 * @returns {Element} parent
 */
function getParentNode(element) {
  if (element.nodeName === 'HTML') {
    return element;
  }
  return element.parentNode || element.host;
}

/**
 * Returns the scrolling parent of the given element
 * @method
 * @memberof Popper.Utils
 * @argument {Element} element
 * @returns {Element} scroll parent
 */
function getScrollParent(element) {
  // Return body, `getScroll` will take care to get the correct `scrollTop` from it
  if (!element) {
    return document.body;
  }

  switch (element.nodeName) {
    case 'HTML':
    case 'BODY':
      return element.ownerDocument.body;
    case '#document':
      return element.body;
  }

  // Firefox want us to check `-x` and `-y` variations as well

  var _getStyleComputedProp = getStyleComputedProperty(element),
      overflow = _getStyleComputedProp.overflow,
      overflowX = _getStyleComputedProp.overflowX,
      overflowY = _getStyleComputedProp.overflowY;

  if (/(auto|scroll|overlay)/.test(overflow + overflowY + overflowX)) {
    return element;
  }

  return getScrollParent(getParentNode(element));
}

/**
 * Returns the reference node of the reference object, or the reference object itself.
 * @method
 * @memberof Popper.Utils
 * @param {Element|Object} reference - the reference element (the popper will be relative to this)
 * @returns {Element} parent
 */
function getReferenceNode(reference) {
  return reference && reference.referenceNode ? reference.referenceNode : reference;
}

var isIE11 = isBrowser && !!(window.MSInputMethodContext && document.documentMode);
var isIE10 = isBrowser && /MSIE 10/.test(navigator.userAgent);

/**
 * Determines if the browser is Internet Explorer
 * @method
 * @memberof Popper.Utils
 * @param {Number} version to check
 * @returns {Boolean} isIE
 */
function isIE(version) {
  if (version === 11) {
    return isIE11;
  }
  if (version === 10) {
    return isIE10;
  }
  return isIE11 || isIE10;
}

/**
 * Returns the offset parent of the given element
 * @method
 * @memberof Popper.Utils
 * @argument {Element} element
 * @returns {Element} offset parent
 */
function getOffsetParent(element) {
  if (!element) {
    return document.documentElement;
  }

  var noOffsetParent = isIE(10) ? document.body : null;

  // NOTE: 1 DOM access here
  var offsetParent = element.offsetParent || null;
  // Skip hidden elements which don't have an offsetParent
  while (offsetParent === noOffsetParent && element.nextElementSibling) {
    offsetParent = (element = element.nextElementSibling).offsetParent;
  }

  var nodeName = offsetParent && offsetParent.nodeName;

  if (!nodeName || nodeName === 'BODY' || nodeName === 'HTML') {
    return element ? element.ownerDocument.documentElement : document.documentElement;
  }

  // .offsetParent will return the closest TH, TD or TABLE in case
  // no offsetParent is present, I hate this job...
  if (['TH', 'TD', 'TABLE'].indexOf(offsetParent.nodeName) !== -1 && getStyleComputedProperty(offsetParent, 'position') === 'static') {
    return getOffsetParent(offsetParent);
  }

  return offsetParent;
}

function isOffsetContainer(element) {
  var nodeName = element.nodeName;

  if (nodeName === 'BODY') {
    return false;
  }
  return nodeName === 'HTML' || getOffsetParent(element.firstElementChild) === element;
}

/**
 * Finds the root node (document, shadowDOM root) of the given element
 * @method
 * @memberof Popper.Utils
 * @argument {Element} node
 * @returns {Element} root node
 */
function getRoot(node) {
  if (node.parentNode !== null) {
    return getRoot(node.parentNode);
  }

  return node;
}

/**
 * Finds the offset parent common to the two provided nodes
 * @method
 * @memberof Popper.Utils
 * @argument {Element} element1
 * @argument {Element} element2
 * @returns {Element} common offset parent
 */
function findCommonOffsetParent(element1, element2) {
  // This check is needed to avoid errors in case one of the elements isn't defined for any reason
  if (!element1 || !element1.nodeType || !element2 || !element2.nodeType) {
    return document.documentElement;
  }

  // Here we make sure to give as "start" the element that comes first in the DOM
  var order = element1.compareDocumentPosition(element2) & Node.DOCUMENT_POSITION_FOLLOWING;
  var start = order ? element1 : element2;
  var end = order ? element2 : element1;

  // Get common ancestor container
  var range = document.createRange();
  range.setStart(start, 0);
  range.setEnd(end, 0);
  var commonAncestorContainer = range.commonAncestorContainer;

  // Both nodes are inside #document

  if (element1 !== commonAncestorContainer && element2 !== commonAncestorContainer || start.contains(end)) {
    if (isOffsetContainer(commonAncestorContainer)) {
      return commonAncestorContainer;
    }

    return getOffsetParent(commonAncestorContainer);
  }

  // one of the nodes is inside shadowDOM, find which one
  var element1root = getRoot(element1);
  if (element1root.host) {
    return findCommonOffsetParent(element1root.host, element2);
  } else {
    return findCommonOffsetParent(element1, getRoot(element2).host);
  }
}

/**
 * Gets the scroll value of the given element in the given side (top and left)
 * @method
 * @memberof Popper.Utils
 * @argument {Element} element
 * @argument {String} side `top` or `left`
 * @returns {number} amount of scrolled pixels
 */
function getScroll(element) {
  var side = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'top';

  var upperSide = side === 'top' ? 'scrollTop' : 'scrollLeft';
  var nodeName = element.nodeName;

  if (nodeName === 'BODY' || nodeName === 'HTML') {
    var html = element.ownerDocument.documentElement;
    var scrollingElement = element.ownerDocument.scrollingElement || html;
    return scrollingElement[upperSide];
  }

  return element[upperSide];
}

/*
 * Sum or subtract the element scroll values (left and top) from a given rect object
 * @method
 * @memberof Popper.Utils
 * @param {Object} rect - Rect object you want to change
 * @param {HTMLElement} element - The element from the function reads the scroll values
 * @param {Boolean} subtract - set to true if you want to subtract the scroll values
 * @return {Object} rect - The modifier rect object
 */
function includeScroll(rect, element) {
  var subtract = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

  var scrollTop = getScroll(element, 'top');
  var scrollLeft = getScroll(element, 'left');
  var modifier = subtract ? -1 : 1;
  rect.top += scrollTop * modifier;
  rect.bottom += scrollTop * modifier;
  rect.left += scrollLeft * modifier;
  rect.right += scrollLeft * modifier;
  return rect;
}

/*
 * Helper to detect borders of a given element
 * @method
 * @memberof Popper.Utils
 * @param {CSSStyleDeclaration} styles
 * Result of `getStyleComputedProperty` on the given element
 * @param {String} axis - `x` or `y`
 * @return {number} borders - The borders size of the given axis
 */

function getBordersSize(styles, axis) {
  var sideA = axis === 'x' ? 'Left' : 'Top';
  var sideB = sideA === 'Left' ? 'Right' : 'Bottom';

  return parseFloat(styles['border' + sideA + 'Width']) + parseFloat(styles['border' + sideB + 'Width']);
}

function getSize(axis, body, html, computedStyle) {
  return Math.max(body['offset' + axis], body['scroll' + axis], html['client' + axis], html['offset' + axis], html['scroll' + axis], isIE(10) ? parseInt(html['offset' + axis]) + parseInt(computedStyle['margin' + (axis === 'Height' ? 'Top' : 'Left')]) + parseInt(computedStyle['margin' + (axis === 'Height' ? 'Bottom' : 'Right')]) : 0);
}

function getWindowSizes(document) {
  var body = document.body;
  var html = document.documentElement;
  var computedStyle = isIE(10) && getComputedStyle(html);

  return {
    height: getSize('Height', body, html, computedStyle),
    width: getSize('Width', body, html, computedStyle)
  };
}

var classCallCheck = function (instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
};

var createClass = function () {
  function defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  return function (Constructor, protoProps, staticProps) {
    if (protoProps) defineProperties(Constructor.prototype, protoProps);
    if (staticProps) defineProperties(Constructor, staticProps);
    return Constructor;
  };
}();





var defineProperty = function (obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
};

var _extends = Object.assign || function (target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i];

    for (var key in source) {
      if (Object.prototype.hasOwnProperty.call(source, key)) {
        target[key] = source[key];
      }
    }
  }

  return target;
};

/**
 * Given element offsets, generate an output similar to getBoundingClientRect
 * @method
 * @memberof Popper.Utils
 * @argument {Object} offsets
 * @returns {Object} ClientRect like output
 */
function getClientRect(offsets) {
  return _extends({}, offsets, {
    right: offsets.left + offsets.width,
    bottom: offsets.top + offsets.height
  });
}

/**
 * Get bounding client rect of given element
 * @method
 * @memberof Popper.Utils
 * @param {HTMLElement} element
 * @return {Object} client rect
 */
function getBoundingClientRect(element) {
  var rect = {};

  // IE10 10 FIX: Please, don't ask, the element isn't
  // considered in DOM in some circumstances...
  // This isn't reproducible in IE10 compatibility mode of IE11
  try {
    if (isIE(10)) {
      rect = element.getBoundingClientRect();
      var scrollTop = getScroll(element, 'top');
      var scrollLeft = getScroll(element, 'left');
      rect.top += scrollTop;
      rect.left += scrollLeft;
      rect.bottom += scrollTop;
      rect.right += scrollLeft;
    } else {
      rect = element.getBoundingClientRect();
    }
  } catch (e) {}

  var result = {
    left: rect.left,
    top: rect.top,
    width: rect.right - rect.left,
    height: rect.bottom - rect.top
  };

  // subtract scrollbar size from sizes
  var sizes = element.nodeName === 'HTML' ? getWindowSizes(element.ownerDocument) : {};
  var width = sizes.width || element.clientWidth || result.width;
  var height = sizes.height || element.clientHeight || result.height;

  var horizScrollbar = element.offsetWidth - width;
  var vertScrollbar = element.offsetHeight - height;

  // if an hypothetical scrollbar is detected, we must be sure it's not a `border`
  // we make this check conditional for performance reasons
  if (horizScrollbar || vertScrollbar) {
    var styles = getStyleComputedProperty(element);
    horizScrollbar -= getBordersSize(styles, 'x');
    vertScrollbar -= getBordersSize(styles, 'y');

    result.width -= horizScrollbar;
    result.height -= vertScrollbar;
  }

  return getClientRect(result);
}

function getOffsetRectRelativeToArbitraryNode(children, parent) {
  var fixedPosition = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

  var isIE10 = isIE(10);
  var isHTML = parent.nodeName === 'HTML';
  var childrenRect = getBoundingClientRect(children);
  var parentRect = getBoundingClientRect(parent);
  var scrollParent = getScrollParent(children);

  var styles = getStyleComputedProperty(parent);
  var borderTopWidth = parseFloat(styles.borderTopWidth);
  var borderLeftWidth = parseFloat(styles.borderLeftWidth);

  // In cases where the parent is fixed, we must ignore negative scroll in offset calc
  if (fixedPosition && isHTML) {
    parentRect.top = Math.max(parentRect.top, 0);
    parentRect.left = Math.max(parentRect.left, 0);
  }
  var offsets = getClientRect({
    top: childrenRect.top - parentRect.top - borderTopWidth,
    left: childrenRect.left - parentRect.left - borderLeftWidth,
    width: childrenRect.width,
    height: childrenRect.height
  });
  offsets.marginTop = 0;
  offsets.marginLeft = 0;

  // Subtract margins of documentElement in case it's being used as parent
  // we do this only on HTML because it's the only element that behaves
  // differently when margins are applied to it. The margins are included in
  // the box of the documentElement, in the other cases not.
  if (!isIE10 && isHTML) {
    var marginTop = parseFloat(styles.marginTop);
    var marginLeft = parseFloat(styles.marginLeft);

    offsets.top -= borderTopWidth - marginTop;
    offsets.bottom -= borderTopWidth - marginTop;
    offsets.left -= borderLeftWidth - marginLeft;
    offsets.right -= borderLeftWidth - marginLeft;

    // Attach marginTop and marginLeft because in some circumstances we may need them
    offsets.marginTop = marginTop;
    offsets.marginLeft = marginLeft;
  }

  if (isIE10 && !fixedPosition ? parent.contains(scrollParent) : parent === scrollParent && scrollParent.nodeName !== 'BODY') {
    offsets = includeScroll(offsets, parent);
  }

  return offsets;
}

function getViewportOffsetRectRelativeToArtbitraryNode(element) {
  var excludeScroll = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

  var html = element.ownerDocument.documentElement;
  var relativeOffset = getOffsetRectRelativeToArbitraryNode(element, html);
  var width = Math.max(html.clientWidth, window.innerWidth || 0);
  var height = Math.max(html.clientHeight, window.innerHeight || 0);

  var scrollTop = !excludeScroll ? getScroll(html) : 0;
  var scrollLeft = !excludeScroll ? getScroll(html, 'left') : 0;

  var offset = {
    top: scrollTop - relativeOffset.top + relativeOffset.marginTop,
    left: scrollLeft - relativeOffset.left + relativeOffset.marginLeft,
    width: width,
    height: height
  };

  return getClientRect(offset);
}

/**
 * Check if the given element is fixed or is inside a fixed parent
 * @method
 * @memberof Popper.Utils
 * @argument {Element} element
 * @argument {Element} customContainer
 * @returns {Boolean} answer to "isFixed?"
 */
function isFixed(element) {
  var nodeName = element.nodeName;
  if (nodeName === 'BODY' || nodeName === 'HTML') {
    return false;
  }
  if (getStyleComputedProperty(element, 'position') === 'fixed') {
    return true;
  }
  var parentNode = getParentNode(element);
  if (!parentNode) {
    return false;
  }
  return isFixed(parentNode);
}

/**
 * Finds the first parent of an element that has a transformed property defined
 * @method
 * @memberof Popper.Utils
 * @argument {Element} element
 * @returns {Element} first transformed parent or documentElement
 */

function getFixedPositionOffsetParent(element) {
  // This check is needed to avoid errors in case one of the elements isn't defined for any reason
  if (!element || !element.parentElement || isIE()) {
    return document.documentElement;
  }
  var el = element.parentElement;
  while (el && getStyleComputedProperty(el, 'transform') === 'none') {
    el = el.parentElement;
  }
  return el || document.documentElement;
}

/**
 * Computed the boundaries limits and return them
 * @method
 * @memberof Popper.Utils
 * @param {HTMLElement} popper
 * @param {HTMLElement} reference
 * @param {number} padding
 * @param {HTMLElement} boundariesElement - Element used to define the boundaries
 * @param {Boolean} fixedPosition - Is in fixed position mode
 * @returns {Object} Coordinates of the boundaries
 */
function getBoundaries(popper, reference, padding, boundariesElement) {
  var fixedPosition = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;

  // NOTE: 1 DOM access here

  var boundaries = { top: 0, left: 0 };
  var offsetParent = fixedPosition ? getFixedPositionOffsetParent(popper) : findCommonOffsetParent(popper, getReferenceNode(reference));

  // Handle viewport case
  if (boundariesElement === 'viewport') {
    boundaries = getViewportOffsetRectRelativeToArtbitraryNode(offsetParent, fixedPosition);
  } else {
    // Handle other cases based on DOM element used as boundaries
    var boundariesNode = void 0;
    if (boundariesElement === 'scrollParent') {
      boundariesNode = getScrollParent(getParentNode(reference));
      if (boundariesNode.nodeName === 'BODY') {
        boundariesNode = popper.ownerDocument.documentElement;
      }
    } else if (boundariesElement === 'window') {
      boundariesNode = popper.ownerDocument.documentElement;
    } else {
      boundariesNode = boundariesElement;
    }

    var offsets = getOffsetRectRelativeToArbitraryNode(boundariesNode, offsetParent, fixedPosition);

    // In case of HTML, we need a different computation
    if (boundariesNode.nodeName === 'HTML' && !isFixed(offsetParent)) {
      var _getWindowSizes = getWindowSizes(popper.ownerDocument),
          height = _getWindowSizes.height,
          width = _getWindowSizes.width;

      boundaries.top += offsets.top - offsets.marginTop;
      boundaries.bottom = height + offsets.top;
      boundaries.left += offsets.left - offsets.marginLeft;
      boundaries.right = width + offsets.left;
    } else {
      // for all the other DOM elements, this one is good
      boundaries = offsets;
    }
  }

  // Add paddings
  padding = padding || 0;
  var isPaddingNumber = typeof padding === 'number';
  boundaries.left += isPaddingNumber ? padding : padding.left || 0;
  boundaries.top += isPaddingNumber ? padding : padding.top || 0;
  boundaries.right -= isPaddingNumber ? padding : padding.right || 0;
  boundaries.bottom -= isPaddingNumber ? padding : padding.bottom || 0;

  return boundaries;
}

function getArea(_ref) {
  var width = _ref.width,
      height = _ref.height;

  return width * height;
}

/**
 * Utility used to transform the `auto` placement to the placement with more
 * available space.
 * @method
 * @memberof Popper.Utils
 * @argument {Object} data - The data object generated by update method
 * @argument {Object} options - Modifiers configuration and options
 * @returns {Object} The data object, properly modified
 */
function computeAutoPlacement(placement, refRect, popper, reference, boundariesElement) {
  var padding = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;

  if (placement.indexOf('auto') === -1) {
    return placement;
  }

  var boundaries = getBoundaries(popper, reference, padding, boundariesElement);

  var rects = {
    top: {
      width: boundaries.width,
      height: refRect.top - boundaries.top
    },
    right: {
      width: boundaries.right - refRect.right,
      height: boundaries.height
    },
    bottom: {
      width: boundaries.width,
      height: boundaries.bottom - refRect.bottom
    },
    left: {
      width: refRect.left - boundaries.left,
      height: boundaries.height
    }
  };

  var sortedAreas = Object.keys(rects).map(function (key) {
    return _extends({
      key: key
    }, rects[key], {
      area: getArea(rects[key])
    });
  }).sort(function (a, b) {
    return b.area - a.area;
  });

  var filteredAreas = sortedAreas.filter(function (_ref2) {
    var width = _ref2.width,
        height = _ref2.height;
    return width >= popper.clientWidth && height >= popper.clientHeight;
  });

  var computedPlacement = filteredAreas.length > 0 ? filteredAreas[0].key : sortedAreas[0].key;

  var variation = placement.split('-')[1];

  return computedPlacement + (variation ? '-' + variation : '');
}

/**
 * Get offsets to the reference element
 * @method
 * @memberof Popper.Utils
 * @param {Object} state
 * @param {Element} popper - the popper element
 * @param {Element} reference - the reference element (the popper will be relative to this)
 * @param {Element} fixedPosition - is in fixed position mode
 * @returns {Object} An object containing the offsets which will be applied to the popper
 */
function getReferenceOffsets(state, popper, reference) {
  var fixedPosition = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

  var commonOffsetParent = fixedPosition ? getFixedPositionOffsetParent(popper) : findCommonOffsetParent(popper, getReferenceNode(reference));
  return getOffsetRectRelativeToArbitraryNode(reference, commonOffsetParent, fixedPosition);
}

/**
 * Get the outer sizes of the given element (offset size + margins)
 * @method
 * @memberof Popper.Utils
 * @argument {Element} element
 * @returns {Object} object containing width and height properties
 */
function getOuterSizes(element) {
  var window = element.ownerDocument.defaultView;
  var styles = window.getComputedStyle(element);
  var x = parseFloat(styles.marginTop || 0) + parseFloat(styles.marginBottom || 0);
  var y = parseFloat(styles.marginLeft || 0) + parseFloat(styles.marginRight || 0);
  var result = {
    width: element.offsetWidth + y,
    height: element.offsetHeight + x
  };
  return result;
}

/**
 * Get the opposite placement of the given one
 * @method
 * @memberof Popper.Utils
 * @argument {String} placement
 * @returns {String} flipped placement
 */
function getOppositePlacement(placement) {
  var hash = { left: 'right', right: 'left', bottom: 'top', top: 'bottom' };
  return placement.replace(/left|right|bottom|top/g, function (matched) {
    return hash[matched];
  });
}

/**
 * Get offsets to the popper
 * @method
 * @memberof Popper.Utils
 * @param {Object} position - CSS position the Popper will get applied
 * @param {HTMLElement} popper - the popper element
 * @param {Object} referenceOffsets - the reference offsets (the popper will be relative to this)
 * @param {String} placement - one of the valid placement options
 * @returns {Object} popperOffsets - An object containing the offsets which will be applied to the popper
 */
function getPopperOffsets(popper, referenceOffsets, placement) {
  placement = placement.split('-')[0];

  // Get popper node sizes
  var popperRect = getOuterSizes(popper);

  // Add position, width and height to our offsets object
  var popperOffsets = {
    width: popperRect.width,
    height: popperRect.height
  };

  // depending by the popper placement we have to compute its offsets slightly differently
  var isHoriz = ['right', 'left'].indexOf(placement) !== -1;
  var mainSide = isHoriz ? 'top' : 'left';
  var secondarySide = isHoriz ? 'left' : 'top';
  var measurement = isHoriz ? 'height' : 'width';
  var secondaryMeasurement = !isHoriz ? 'height' : 'width';

  popperOffsets[mainSide] = referenceOffsets[mainSide] + referenceOffsets[measurement] / 2 - popperRect[measurement] / 2;
  if (placement === secondarySide) {
    popperOffsets[secondarySide] = referenceOffsets[secondarySide] - popperRect[secondaryMeasurement];
  } else {
    popperOffsets[secondarySide] = referenceOffsets[getOppositePlacement(secondarySide)];
  }

  return popperOffsets;
}

/**
 * Mimics the `find` method of Array
 * @method
 * @memberof Popper.Utils
 * @argument {Array} arr
 * @argument prop
 * @argument value
 * @returns index or -1
 */
function find(arr, check) {
  // use native find if supported
  if (Array.prototype.find) {
    return arr.find(check);
  }

  // use `filter` to obtain the same behavior of `find`
  return arr.filter(check)[0];
}

/**
 * Return the index of the matching object
 * @method
 * @memberof Popper.Utils
 * @argument {Array} arr
 * @argument prop
 * @argument value
 * @returns index or -1
 */
function findIndex(arr, prop, value) {
  // use native findIndex if supported
  if (Array.prototype.findIndex) {
    return arr.findIndex(function (cur) {
      return cur[prop] === value;
    });
  }

  // use `find` + `indexOf` if `findIndex` isn't supported
  var match = find(arr, function (obj) {
    return obj[prop] === value;
  });
  return arr.indexOf(match);
}

/**
 * Loop trough the list of modifiers and run them in order,
 * each of them will then edit the data object.
 * @method
 * @memberof Popper.Utils
 * @param {dataObject} data
 * @param {Array} modifiers
 * @param {String} ends - Optional modifier name used as stopper
 * @returns {dataObject}
 */
function runModifiers(modifiers, data, ends) {
  var modifiersToRun = ends === undefined ? modifiers : modifiers.slice(0, findIndex(modifiers, 'name', ends));

  modifiersToRun.forEach(function (modifier) {
    if (modifier['function']) {
      // eslint-disable-line dot-notation
      console.warn('`modifier.function` is deprecated, use `modifier.fn`!');
    }
    var fn = modifier['function'] || modifier.fn; // eslint-disable-line dot-notation
    if (modifier.enabled && isFunction(fn)) {
      // Add properties to offsets to make them a complete clientRect object
      // we do this before each modifier to make sure the previous one doesn't
      // mess with these values
      data.offsets.popper = getClientRect(data.offsets.popper);
      data.offsets.reference = getClientRect(data.offsets.reference);

      data = fn(data, modifier);
    }
  });

  return data;
}

/**
 * Updates the position of the popper, computing the new offsets and applying
 * the new style.<br />
 * Prefer `scheduleUpdate` over `update` because of performance reasons.
 * @method
 * @memberof Popper
 */
function update() {
  // if popper is destroyed, don't perform any further update
  if (this.state.isDestroyed) {
    return;
  }

  var data = {
    instance: this,
    styles: {},
    arrowStyles: {},
    attributes: {},
    flipped: false,
    offsets: {}
  };

  // compute reference element offsets
  data.offsets.reference = getReferenceOffsets(this.state, this.popper, this.reference, this.options.positionFixed);

  // compute auto placement, store placement inside the data object,
  // modifiers will be able to edit `placement` if needed
  // and refer to originalPlacement to know the original value
  data.placement = computeAutoPlacement(this.options.placement, data.offsets.reference, this.popper, this.reference, this.options.modifiers.flip.boundariesElement, this.options.modifiers.flip.padding);

  // store the computed placement inside `originalPlacement`
  data.originalPlacement = data.placement;

  data.positionFixed = this.options.positionFixed;

  // compute the popper offsets
  data.offsets.popper = getPopperOffsets(this.popper, data.offsets.reference, data.placement);

  data.offsets.popper.position = this.options.positionFixed ? 'fixed' : 'absolute';

  // run the modifiers
  data = runModifiers(this.modifiers, data);

  // the first `update` will call `onCreate` callback
  // the other ones will call `onUpdate` callback
  if (!this.state.isCreated) {
    this.state.isCreated = true;
    this.options.onCreate(data);
  } else {
    this.options.onUpdate(data);
  }
}

/**
 * Helper used to know if the given modifier is enabled.
 * @method
 * @memberof Popper.Utils
 * @returns {Boolean}
 */
function isModifierEnabled(modifiers, modifierName) {
  return modifiers.some(function (_ref) {
    var name = _ref.name,
        enabled = _ref.enabled;
    return enabled && name === modifierName;
  });
}

/**
 * Get the prefixed supported property name
 * @method
 * @memberof Popper.Utils
 * @argument {String} property (camelCase)
 * @returns {String} prefixed property (camelCase or PascalCase, depending on the vendor prefix)
 */
function getSupportedPropertyName(property) {
  var prefixes = [false, 'ms', 'Webkit', 'Moz', 'O'];
  var upperProp = property.charAt(0).toUpperCase() + property.slice(1);

  for (var i = 0; i < prefixes.length; i++) {
    var prefix = prefixes[i];
    var toCheck = prefix ? '' + prefix + upperProp : property;
    if (typeof document.body.style[toCheck] !== 'undefined') {
      return toCheck;
    }
  }
  return null;
}

/**
 * Destroys the popper.
 * @method
 * @memberof Popper
 */
function destroy() {
  this.state.isDestroyed = true;

  // touch DOM only if `applyStyle` modifier is enabled
  if (isModifierEnabled(this.modifiers, 'applyStyle')) {
    this.popper.removeAttribute('x-placement');
    this.popper.style.position = '';
    this.popper.style.top = '';
    this.popper.style.left = '';
    this.popper.style.right = '';
    this.popper.style.bottom = '';
    this.popper.style.willChange = '';
    this.popper.style[getSupportedPropertyName('transform')] = '';
  }

  this.disableEventListeners();

  // remove the popper if user explicitly asked for the deletion on destroy
  // do not use `remove` because IE11 doesn't support it
  if (this.options.removeOnDestroy) {
    this.popper.parentNode.removeChild(this.popper);
  }
  return this;
}

/**
 * Get the window associated with the element
 * @argument {Element} element
 * @returns {Window}
 */
function getWindow(element) {
  var ownerDocument = element.ownerDocument;
  return ownerDocument ? ownerDocument.defaultView : window;
}

function attachToScrollParents(scrollParent, event, callback, scrollParents) {
  var isBody = scrollParent.nodeName === 'BODY';
  var target = isBody ? scrollParent.ownerDocument.defaultView : scrollParent;
  target.addEventListener(event, callback, { passive: true });

  if (!isBody) {
    attachToScrollParents(getScrollParent(target.parentNode), event, callback, scrollParents);
  }
  scrollParents.push(target);
}

/**
 * Setup needed event listeners used to update the popper position
 * @method
 * @memberof Popper.Utils
 * @private
 */
function setupEventListeners(reference, options, state, updateBound) {
  // Resize event listener on window
  state.updateBound = updateBound;
  getWindow(reference).addEventListener('resize', state.updateBound, { passive: true });

  // Scroll event listener on scroll parents
  var scrollElement = getScrollParent(reference);
  attachToScrollParents(scrollElement, 'scroll', state.updateBound, state.scrollParents);
  state.scrollElement = scrollElement;
  state.eventsEnabled = true;

  return state;
}

/**
 * It will add resize/scroll events and start recalculating
 * position of the popper element when they are triggered.
 * @method
 * @memberof Popper
 */
function enableEventListeners() {
  if (!this.state.eventsEnabled) {
    this.state = setupEventListeners(this.reference, this.options, this.state, this.scheduleUpdate);
  }
}

/**
 * Remove event listeners used to update the popper position
 * @method
 * @memberof Popper.Utils
 * @private
 */
function removeEventListeners(reference, state) {
  // Remove resize event listener on window
  getWindow(reference).removeEventListener('resize', state.updateBound);

  // Remove scroll event listener on scroll parents
  state.scrollParents.forEach(function (target) {
    target.removeEventListener('scroll', state.updateBound);
  });

  // Reset state
  state.updateBound = null;
  state.scrollParents = [];
  state.scrollElement = null;
  state.eventsEnabled = false;
  return state;
}

/**
 * It will remove resize/scroll events and won't recalculate popper position
 * when they are triggered. It also won't trigger `onUpdate` callback anymore,
 * unless you call `update` method manually.
 * @method
 * @memberof Popper
 */
function disableEventListeners() {
  if (this.state.eventsEnabled) {
    cancelAnimationFrame(this.scheduleUpdate);
    this.state = removeEventListeners(this.reference, this.state);
  }
}

/**
 * Tells if a given input is a number
 * @method
 * @memberof Popper.Utils
 * @param {*} input to check
 * @return {Boolean}
 */
function isNumeric(n) {
  return n !== '' && !isNaN(parseFloat(n)) && isFinite(n);
}

/**
 * Set the style to the given popper
 * @method
 * @memberof Popper.Utils
 * @argument {Element} element - Element to apply the style to
 * @argument {Object} styles
 * Object with a list of properties and values which will be applied to the element
 */
function setStyles(element, styles) {
  Object.keys(styles).forEach(function (prop) {
    var unit = '';
    // add unit if the value is numeric and is one of the following
    if (['width', 'height', 'top', 'right', 'bottom', 'left'].indexOf(prop) !== -1 && isNumeric(styles[prop])) {
      unit = 'px';
    }
    element.style[prop] = styles[prop] + unit;
  });
}

/**
 * Set the attributes to the given popper
 * @method
 * @memberof Popper.Utils
 * @argument {Element} element - Element to apply the attributes to
 * @argument {Object} styles
 * Object with a list of properties and values which will be applied to the element
 */
function setAttributes(element, attributes) {
  Object.keys(attributes).forEach(function (prop) {
    var value = attributes[prop];
    if (value !== false) {
      element.setAttribute(prop, attributes[prop]);
    } else {
      element.removeAttribute(prop);
    }
  });
}

/**
 * @function
 * @memberof Modifiers
 * @argument {Object} data - The data object generated by `update` method
 * @argument {Object} data.styles - List of style properties - values to apply to popper element
 * @argument {Object} data.attributes - List of attribute properties - values to apply to popper element
 * @argument {Object} options - Modifiers configuration and options
 * @returns {Object} The same data object
 */
function applyStyle(data) {
  // any property present in `data.styles` will be applied to the popper,
  // in this way we can make the 3rd party modifiers add custom styles to it
  // Be aware, modifiers could override the properties defined in the previous
  // lines of this modifier!
  setStyles(data.instance.popper, data.styles);

  // any property present in `data.attributes` will be applied to the popper,
  // they will be set as HTML attributes of the element
  setAttributes(data.instance.popper, data.attributes);

  // if arrowElement is defined and arrowStyles has some properties
  if (data.arrowElement && Object.keys(data.arrowStyles).length) {
    setStyles(data.arrowElement, data.arrowStyles);
  }

  return data;
}

/**
 * Set the x-placement attribute before everything else because it could be used
 * to add margins to the popper margins needs to be calculated to get the
 * correct popper offsets.
 * @method
 * @memberof Popper.modifiers
 * @param {HTMLElement} reference - The reference element used to position the popper
 * @param {HTMLElement} popper - The HTML element used as popper
 * @param {Object} options - Popper.js options
 */
function applyStyleOnLoad(reference, popper, options, modifierOptions, state) {
  // compute reference element offsets
  var referenceOffsets = getReferenceOffsets(state, popper, reference, options.positionFixed);

  // compute auto placement, store placement inside the data object,
  // modifiers will be able to edit `placement` if needed
  // and refer to originalPlacement to know the original value
  var placement = computeAutoPlacement(options.placement, referenceOffsets, popper, reference, options.modifiers.flip.boundariesElement, options.modifiers.flip.padding);

  popper.setAttribute('x-placement', placement);

  // Apply `position` to popper before anything else because
  // without the position applied we can't guarantee correct computations
  setStyles(popper, { position: options.positionFixed ? 'fixed' : 'absolute' });

  return options;
}

/**
 * @function
 * @memberof Popper.Utils
 * @argument {Object} data - The data object generated by `update` method
 * @argument {Boolean} shouldRound - If the offsets should be rounded at all
 * @returns {Object} The popper's position offsets rounded
 *
 * The tale of pixel-perfect positioning. It's still not 100% perfect, but as
 * good as it can be within reason.
 * Discussion here: https://github.com/FezVrasta/popper.js/pull/715
 *
 * Low DPI screens cause a popper to be blurry if not using full pixels (Safari
 * as well on High DPI screens).
 *
 * Firefox prefers no rounding for positioning and does not have blurriness on
 * high DPI screens.
 *
 * Only horizontal placement and left/right values need to be considered.
 */
function getRoundedOffsets(data, shouldRound) {
  var _data$offsets = data.offsets,
      popper = _data$offsets.popper,
      reference = _data$offsets.reference;
  var round = Math.round,
      floor = Math.floor;

  var noRound = function noRound(v) {
    return v;
  };

  var referenceWidth = round(reference.width);
  var popperWidth = round(popper.width);

  var isVertical = ['left', 'right'].indexOf(data.placement) !== -1;
  var isVariation = data.placement.indexOf('-') !== -1;
  var sameWidthParity = referenceWidth % 2 === popperWidth % 2;
  var bothOddWidth = referenceWidth % 2 === 1 && popperWidth % 2 === 1;

  var horizontalToInteger = !shouldRound ? noRound : isVertical || isVariation || sameWidthParity ? round : floor;
  var verticalToInteger = !shouldRound ? noRound : round;

  return {
    left: horizontalToInteger(bothOddWidth && !isVariation && shouldRound ? popper.left - 1 : popper.left),
    top: verticalToInteger(popper.top),
    bottom: verticalToInteger(popper.bottom),
    right: horizontalToInteger(popper.right)
  };
}

var isFirefox = isBrowser && /Firefox/i.test(navigator.userAgent);

/**
 * @function
 * @memberof Modifiers
 * @argument {Object} data - The data object generated by `update` method
 * @argument {Object} options - Modifiers configuration and options
 * @returns {Object} The data object, properly modified
 */
function computeStyle(data, options) {
  var x = options.x,
      y = options.y;
  var popper = data.offsets.popper;

  // Remove this legacy support in Popper.js v2

  var legacyGpuAccelerationOption = find(data.instance.modifiers, function (modifier) {
    return modifier.name === 'applyStyle';
  }).gpuAcceleration;
  if (legacyGpuAccelerationOption !== undefined) {
    console.warn('WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!');
  }
  var gpuAcceleration = legacyGpuAccelerationOption !== undefined ? legacyGpuAccelerationOption : options.gpuAcceleration;

  var offsetParent = getOffsetParent(data.instance.popper);
  var offsetParentRect = getBoundingClientRect(offsetParent);

  // Styles
  var styles = {
    position: popper.position
  };

  var offsets = getRoundedOffsets(data, window.devicePixelRatio < 2 || !isFirefox);

  var sideA = x === 'bottom' ? 'top' : 'bottom';
  var sideB = y === 'right' ? 'left' : 'right';

  // if gpuAcceleration is set to `true` and transform is supported,
  //  we use `translate3d` to apply the position to the popper we
  // automatically use the supported prefixed version if needed
  var prefixedProperty = getSupportedPropertyName('transform');

  // now, let's make a step back and look at this code closely (wtf?)
  // If the content of the popper grows once it's been positioned, it
  // may happen that the popper gets misplaced because of the new content
  // overflowing its reference element
  // To avoid this problem, we provide two options (x and y), which allow
  // the consumer to define the offset origin.
  // If we position a popper on top of a reference element, we can set
  // `x` to `top` to make the popper grow towards its top instead of
  // its bottom.
  var left = void 0,
      top = void 0;
  if (sideA === 'bottom') {
    // when offsetParent is <html> the positioning is relative to the bottom of the screen (excluding the scrollbar)
    // and not the bottom of the html element
    if (offsetParent.nodeName === 'HTML') {
      top = -offsetParent.clientHeight + offsets.bottom;
    } else {
      top = -offsetParentRect.height + offsets.bottom;
    }
  } else {
    top = offsets.top;
  }
  if (sideB === 'right') {
    if (offsetParent.nodeName === 'HTML') {
      left = -offsetParent.clientWidth + offsets.right;
    } else {
      left = -offsetParentRect.width + offsets.right;
    }
  } else {
    left = offsets.left;
  }
  if (gpuAcceleration && prefixedProperty) {
    styles[prefixedProperty] = 'translate3d(' + left + 'px, ' + top + 'px, 0)';
    styles[sideA] = 0;
    styles[sideB] = 0;
    styles.willChange = 'transform';
  } else {
    // othwerise, we use the standard `top`, `left`, `bottom` and `right` properties
    var invertTop = sideA === 'bottom' ? -1 : 1;
    var invertLeft = sideB === 'right' ? -1 : 1;
    styles[sideA] = top * invertTop;
    styles[sideB] = left * invertLeft;
    styles.willChange = sideA + ', ' + sideB;
  }

  // Attributes
  var attributes = {
    'x-placement': data.placement
  };

  // Update `data` attributes, styles and arrowStyles
  data.attributes = _extends({}, attributes, data.attributes);
  data.styles = _extends({}, styles, data.styles);
  data.arrowStyles = _extends({}, data.offsets.arrow, data.arrowStyles);

  return data;
}

/**
 * Helper used to know if the given modifier depends from another one.<br />
 * It checks if the needed modifier is listed and enabled.
 * @method
 * @memberof Popper.Utils
 * @param {Array} modifiers - list of modifiers
 * @param {String} requestingName - name of requesting modifier
 * @param {String} requestedName - name of requested modifier
 * @returns {Boolean}
 */
function isModifierRequired(modifiers, requestingName, requestedName) {
  var requesting = find(modifiers, function (_ref) {
    var name = _ref.name;
    return name === requestingName;
  });

  var isRequired = !!requesting && modifiers.some(function (modifier) {
    return modifier.name === requestedName && modifier.enabled && modifier.order < requesting.order;
  });

  if (!isRequired) {
    var _requesting = '`' + requestingName + '`';
    var requested = '`' + requestedName + '`';
    console.warn(requested + ' modifier is required by ' + _requesting + ' modifier in order to work, be sure to include it before ' + _requesting + '!');
  }
  return isRequired;
}

/**
 * @function
 * @memberof Modifiers
 * @argument {Object} data - The data object generated by update method
 * @argument {Object} options - Modifiers configuration and options
 * @returns {Object} The data object, properly modified
 */
function arrow(data, options) {
  var _data$offsets$arrow;

  // arrow depends on keepTogether in order to work
  if (!isModifierRequired(data.instance.modifiers, 'arrow', 'keepTogether')) {
    return data;
  }

  var arrowElement = options.element;

  // if arrowElement is a string, suppose it's a CSS selector
  if (typeof arrowElement === 'string') {
    arrowElement = data.instance.popper.querySelector(arrowElement);

    // if arrowElement is not found, don't run the modifier
    if (!arrowElement) {
      return data;
    }
  } else {
    // if the arrowElement isn't a query selector we must check that the
    // provided DOM node is child of its popper node
    if (!data.instance.popper.contains(arrowElement)) {
      console.warn('WARNING: `arrow.element` must be child of its popper element!');
      return data;
    }
  }

  var placement = data.placement.split('-')[0];
  var _data$offsets = data.offsets,
      popper = _data$offsets.popper,
      reference = _data$offsets.reference;

  var isVertical = ['left', 'right'].indexOf(placement) !== -1;

  var len = isVertical ? 'height' : 'width';
  var sideCapitalized = isVertical ? 'Top' : 'Left';
  var side = sideCapitalized.toLowerCase();
  var altSide = isVertical ? 'left' : 'top';
  var opSide = isVertical ? 'bottom' : 'right';
  var arrowElementSize = getOuterSizes(arrowElement)[len];

  //
  // extends keepTogether behavior making sure the popper and its
  // reference have enough pixels in conjunction
  //

  // top/left side
  if (reference[opSide] - arrowElementSize < popper[side]) {
    data.offsets.popper[side] -= popper[side] - (reference[opSide] - arrowElementSize);
  }
  // bottom/right side
  if (reference[side] + arrowElementSize > popper[opSide]) {
    data.offsets.popper[side] += reference[side] + arrowElementSize - popper[opSide];
  }
  data.offsets.popper = getClientRect(data.offsets.popper);

  // compute center of the popper
  var center = reference[side] + reference[len] / 2 - arrowElementSize / 2;

  // Compute the sideValue using the updated popper offsets
  // take popper margin in account because we don't have this info available
  var css = getStyleComputedProperty(data.instance.popper);
  var popperMarginSide = parseFloat(css['margin' + sideCapitalized]);
  var popperBorderSide = parseFloat(css['border' + sideCapitalized + 'Width']);
  var sideValue = center - data.offsets.popper[side] - popperMarginSide - popperBorderSide;

  // prevent arrowElement from being placed not contiguously to its popper
  sideValue = Math.max(Math.min(popper[len] - arrowElementSize, sideValue), 0);

  data.arrowElement = arrowElement;
  data.offsets.arrow = (_data$offsets$arrow = {}, defineProperty(_data$offsets$arrow, side, Math.round(sideValue)), defineProperty(_data$offsets$arrow, altSide, ''), _data$offsets$arrow);

  return data;
}

/**
 * Get the opposite placement variation of the given one
 * @method
 * @memberof Popper.Utils
 * @argument {String} placement variation
 * @returns {String} flipped placement variation
 */
function getOppositeVariation(variation) {
  if (variation === 'end') {
    return 'start';
  } else if (variation === 'start') {
    return 'end';
  }
  return variation;
}

/**
 * List of accepted placements to use as values of the `placement` option.<br />
 * Valid placements are:
 * - `auto`
 * - `top`
 * - `right`
 * - `bottom`
 * - `left`
 *
 * Each placement can have a variation from this list:
 * - `-start`
 * - `-end`
 *
 * Variations are interpreted easily if you think of them as the left to right
 * written languages. Horizontally (`top` and `bottom`), `start` is left and `end`
 * is right.<br />
 * Vertically (`left` and `right`), `start` is top and `end` is bottom.
 *
 * Some valid examples are:
 * - `top-end` (on top of reference, right aligned)
 * - `right-start` (on right of reference, top aligned)
 * - `bottom` (on bottom, centered)
 * - `auto-end` (on the side with more space available, alignment depends by placement)
 *
 * @static
 * @type {Array}
 * @enum {String}
 * @readonly
 * @method placements
 * @memberof Popper
 */
var placements = ['auto-start', 'auto', 'auto-end', 'top-start', 'top', 'top-end', 'right-start', 'right', 'right-end', 'bottom-end', 'bottom', 'bottom-start', 'left-end', 'left', 'left-start'];

// Get rid of `auto` `auto-start` and `auto-end`
var validPlacements = placements.slice(3);

/**
 * Given an initial placement, returns all the subsequent placements
 * clockwise (or counter-clockwise).
 *
 * @method
 * @memberof Popper.Utils
 * @argument {String} placement - A valid placement (it accepts variations)
 * @argument {Boolean} counter - Set to true to walk the placements counterclockwise
 * @returns {Array} placements including their variations
 */
function clockwise(placement) {
  var counter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

  var index = validPlacements.indexOf(placement);
  var arr = validPlacements.slice(index + 1).concat(validPlacements.slice(0, index));
  return counter ? arr.reverse() : arr;
}

var BEHAVIORS = {
  FLIP: 'flip',
  CLOCKWISE: 'clockwise',
  COUNTERCLOCKWISE: 'counterclockwise'
};

/**
 * @function
 * @memberof Modifiers
 * @argument {Object} data - The data object generated by update method
 * @argument {Object} options - Modifiers configuration and options
 * @returns {Object} The data object, properly modified
 */
function flip(data, options) {
  // if `inner` modifier is enabled, we can't use the `flip` modifier
  if (isModifierEnabled(data.instance.modifiers, 'inner')) {
    return data;
  }

  if (data.flipped && data.placement === data.originalPlacement) {
    // seems like flip is trying to loop, probably there's not enough space on any of the flippable sides
    return data;
  }

  var boundaries = getBoundaries(data.instance.popper, data.instance.reference, options.padding, options.boundariesElement, data.positionFixed);

  var placement = data.placement.split('-')[0];
  var placementOpposite = getOppositePlacement(placement);
  var variation = data.placement.split('-')[1] || '';

  var flipOrder = [];

  switch (options.behavior) {
    case BEHAVIORS.FLIP:
      flipOrder = [placement, placementOpposite];
      break;
    case BEHAVIORS.CLOCKWISE:
      flipOrder = clockwise(placement);
      break;
    case BEHAVIORS.COUNTERCLOCKWISE:
      flipOrder = clockwise(placement, true);
      break;
    default:
      flipOrder = options.behavior;
  }

  flipOrder.forEach(function (step, index) {
    if (placement !== step || flipOrder.length === index + 1) {
      return data;
    }

    placement = data.placement.split('-')[0];
    placementOpposite = getOppositePlacement(placement);

    var popperOffsets = data.offsets.popper;
    var refOffsets = data.offsets.reference;

    // using floor because the reference offsets may contain decimals we are not going to consider here
    var floor = Math.floor;
    var overlapsRef = placement === 'left' && floor(popperOffsets.right) > floor(refOffsets.left) || placement === 'right' && floor(popperOffsets.left) < floor(refOffsets.right) || placement === 'top' && floor(popperOffsets.bottom) > floor(refOffsets.top) || placement === 'bottom' && floor(popperOffsets.top) < floor(refOffsets.bottom);

    var overflowsLeft = floor(popperOffsets.left) < floor(boundaries.left);
    var overflowsRight = floor(popperOffsets.right) > floor(boundaries.right);
    var overflowsTop = floor(popperOffsets.top) < floor(boundaries.top);
    var overflowsBottom = floor(popperOffsets.bottom) > floor(boundaries.bottom);

    var overflowsBoundaries = placement === 'left' && overflowsLeft || placement === 'right' && overflowsRight || placement === 'top' && overflowsTop || placement === 'bottom' && overflowsBottom;

    // flip the variation if required
    var isVertical = ['top', 'bottom'].indexOf(placement) !== -1;

    // flips variation if reference element overflows boundaries
    var flippedVariationByRef = !!options.flipVariations && (isVertical && variation === 'start' && overflowsLeft || isVertical && variation === 'end' && overflowsRight || !isVertical && variation === 'start' && overflowsTop || !isVertical && variation === 'end' && overflowsBottom);

    // flips variation if popper content overflows boundaries
    var flippedVariationByContent = !!options.flipVariationsByContent && (isVertical && variation === 'start' && overflowsRight || isVertical && variation === 'end' && overflowsLeft || !isVertical && variation === 'start' && overflowsBottom || !isVertical && variation === 'end' && overflowsTop);

    var flippedVariation = flippedVariationByRef || flippedVariationByContent;

    if (overlapsRef || overflowsBoundaries || flippedVariation) {
      // this boolean to detect any flip loop
      data.flipped = true;

      if (overlapsRef || overflowsBoundaries) {
        placement = flipOrder[index + 1];
      }

      if (flippedVariation) {
        variation = getOppositeVariation(variation);
      }

      data.placement = placement + (variation ? '-' + variation : '');

      // this object contains `position`, we want to preserve it along with
      // any additional property we may add in the future
      data.offsets.popper = _extends({}, data.offsets.popper, getPopperOffsets(data.instance.popper, data.offsets.reference, data.placement));

      data = runModifiers(data.instance.modifiers, data, 'flip');
    }
  });
  return data;
}

/**
 * @function
 * @memberof Modifiers
 * @argument {Object} data - The data object generated by update method
 * @argument {Object} options - Modifiers configuration and options
 * @returns {Object} The data object, properly modified
 */
function keepTogether(data) {
  var _data$offsets = data.offsets,
      popper = _data$offsets.popper,
      reference = _data$offsets.reference;

  var placement = data.placement.split('-')[0];
  var floor = Math.floor;
  var isVertical = ['top', 'bottom'].indexOf(placement) !== -1;
  var side = isVertical ? 'right' : 'bottom';
  var opSide = isVertical ? 'left' : 'top';
  var measurement = isVertical ? 'width' : 'height';

  if (popper[side] < floor(reference[opSide])) {
    data.offsets.popper[opSide] = floor(reference[opSide]) - popper[measurement];
  }
  if (popper[opSide] > floor(reference[side])) {
    data.offsets.popper[opSide] = floor(reference[side]);
  }

  return data;
}

/**
 * Converts a string containing value + unit into a px value number
 * @function
 * @memberof {modifiers~offset}
 * @private
 * @argument {String} str - Value + unit string
 * @argument {String} measurement - `height` or `width`
 * @argument {Object} popperOffsets
 * @argument {Object} referenceOffsets
 * @returns {Number|String}
 * Value in pixels, or original string if no values were extracted
 */
function toValue(str, measurement, popperOffsets, referenceOffsets) {
  // separate value from unit
  var split = str.match(/((?:\-|\+)?\d*\.?\d*)(.*)/);
  var value = +split[1];
  var unit = split[2];

  // If it's not a number it's an operator, I guess
  if (!value) {
    return str;
  }

  if (unit.indexOf('%') === 0) {
    var element = void 0;
    switch (unit) {
      case '%p':
        element = popperOffsets;
        break;
      case '%':
      case '%r':
      default:
        element = referenceOffsets;
    }

    var rect = getClientRect(element);
    return rect[measurement] / 100 * value;
  } else if (unit === 'vh' || unit === 'vw') {
    // if is a vh or vw, we calculate the size based on the viewport
    var size = void 0;
    if (unit === 'vh') {
      size = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
    } else {
      size = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
    }
    return size / 100 * value;
  } else {
    // if is an explicit pixel unit, we get rid of the unit and keep the value
    // if is an implicit unit, it's px, and we return just the value
    return value;
  }
}

/**
 * Parse an `offset` string to extrapolate `x` and `y` numeric offsets.
 * @function
 * @memberof {modifiers~offset}
 * @private
 * @argument {String} offset
 * @argument {Object} popperOffsets
 * @argument {Object} referenceOffsets
 * @argument {String} basePlacement
 * @returns {Array} a two cells array with x and y offsets in numbers
 */
function parseOffset(offset, popperOffsets, referenceOffsets, basePlacement) {
  var offsets = [0, 0];

  // Use height if placement is left or right and index is 0 otherwise use width
  // in this way the first offset will use an axis and the second one
  // will use the other one
  var useHeight = ['right', 'left'].indexOf(basePlacement) !== -1;

  // Split the offset string to obtain a list of values and operands
  // The regex addresses values with the plus or minus sign in front (+10, -20, etc)
  var fragments = offset.split(/(\+|\-)/).map(function (frag) {
    return frag.trim();
  });

  // Detect if the offset string contains a pair of values or a single one
  // they could be separated by comma or space
  var divider = fragments.indexOf(find(fragments, function (frag) {
    return frag.search(/,|\s/) !== -1;
  }));

  if (fragments[divider] && fragments[divider].indexOf(',') === -1) {
    console.warn('Offsets separated by white space(s) are deprecated, use a comma (,) instead.');
  }

  // If divider is found, we divide the list of values and operands to divide
  // them by ofset X and Y.
  var splitRegex = /\s*,\s*|\s+/;
  var ops = divider !== -1 ? [fragments.slice(0, divider).concat([fragments[divider].split(splitRegex)[0]]), [fragments[divider].split(splitRegex)[1]].concat(fragments.slice(divider + 1))] : [fragments];

  // Convert the values with units to absolute pixels to allow our computations
  ops = ops.map(function (op, index) {
    // Most of the units rely on the orientation of the popper
    var measurement = (index === 1 ? !useHeight : useHeight) ? 'height' : 'width';
    var mergeWithPrevious = false;
    return op
    // This aggregates any `+` or `-` sign that aren't considered operators
    // e.g.: 10 + +5 => [10, +, +5]
    .reduce(function (a, b) {
      if (a[a.length - 1] === '' && ['+', '-'].indexOf(b) !== -1) {
        a[a.length - 1] = b;
        mergeWithPrevious = true;
        return a;
      } else if (mergeWithPrevious) {
        a[a.length - 1] += b;
        mergeWithPrevious = false;
        return a;
      } else {
        return a.concat(b);
      }
    }, [])
    // Here we convert the string values into number values (in px)
    .map(function (str) {
      return toValue(str, measurement, popperOffsets, referenceOffsets);
    });
  });

  // Loop trough the offsets arrays and execute the operations
  ops.forEach(function (op, index) {
    op.forEach(function (frag, index2) {
      if (isNumeric(frag)) {
        offsets[index] += frag * (op[index2 - 1] === '-' ? -1 : 1);
      }
    });
  });
  return offsets;
}

/**
 * @function
 * @memberof Modifiers
 * @argument {Object} data - The data object generated by update method
 * @argument {Object} options - Modifiers configuration and options
 * @argument {Number|String} options.offset=0
 * The offset value as described in the modifier description
 * @returns {Object} The data object, properly modified
 */
function offset(data, _ref) {
  var offset = _ref.offset;
  var placement = data.placement,
      _data$offsets = data.offsets,
      popper = _data$offsets.popper,
      reference = _data$offsets.reference;

  var basePlacement = placement.split('-')[0];

  var offsets = void 0;
  if (isNumeric(+offset)) {
    offsets = [+offset, 0];
  } else {
    offsets = parseOffset(offset, popper, reference, basePlacement);
  }

  if (basePlacement === 'left') {
    popper.top += offsets[0];
    popper.left -= offsets[1];
  } else if (basePlacement === 'right') {
    popper.top += offsets[0];
    popper.left += offsets[1];
  } else if (basePlacement === 'top') {
    popper.left += offsets[0];
    popper.top -= offsets[1];
  } else if (basePlacement === 'bottom') {
    popper.left += offsets[0];
    popper.top += offsets[1];
  }

  data.popper = popper;
  return data;
}

/**
 * @function
 * @memberof Modifiers
 * @argument {Object} data - The data object generated by `update` method
 * @argument {Object} options - Modifiers configuration and options
 * @returns {Object} The data object, properly modified
 */
function preventOverflow(data, options) {
  var boundariesElement = options.boundariesElement || getOffsetParent(data.instance.popper);

  // If offsetParent is the reference element, we really want to
  // go one step up and use the next offsetParent as reference to
  // avoid to make this modifier completely useless and look like broken
  if (data.instance.reference === boundariesElement) {
    boundariesElement = getOffsetParent(boundariesElement);
  }

  // NOTE: DOM access here
  // resets the popper's position so that the document size can be calculated excluding
  // the size of the popper element itself
  var transformProp = getSupportedPropertyName('transform');
  var popperStyles = data.instance.popper.style; // assignment to help minification
  var top = popperStyles.top,
      left = popperStyles.left,
      transform = popperStyles[transformProp];

  popperStyles.top = '';
  popperStyles.left = '';
  popperStyles[transformProp] = '';

  var boundaries = getBoundaries(data.instance.popper, data.instance.reference, options.padding, boundariesElement, data.positionFixed);

  // NOTE: DOM access here
  // restores the original style properties after the offsets have been computed
  popperStyles.top = top;
  popperStyles.left = left;
  popperStyles[transformProp] = transform;

  options.boundaries = boundaries;

  var order = options.priority;
  var popper = data.offsets.popper;

  var check = {
    primary: function primary(placement) {
      var value = popper[placement];
      if (popper[placement] < boundaries[placement] && !options.escapeWithReference) {
        value = Math.max(popper[placement], boundaries[placement]);
      }
      return defineProperty({}, placement, value);
    },
    secondary: function secondary(placement) {
      var mainSide = placement === 'right' ? 'left' : 'top';
      var value = popper[mainSide];
      if (popper[placement] > boundaries[placement] && !options.escapeWithReference) {
        value = Math.min(popper[mainSide], boundaries[placement] - (placement === 'right' ? popper.width : popper.height));
      }
      return defineProperty({}, mainSide, value);
    }
  };

  order.forEach(function (placement) {
    var side = ['left', 'top'].indexOf(placement) !== -1 ? 'primary' : 'secondary';
    popper = _extends({}, popper, check[side](placement));
  });

  data.offsets.popper = popper;

  return data;
}

/**
 * @function
 * @memberof Modifiers
 * @argument {Object} data - The data object generated by `update` method
 * @argument {Object} options - Modifiers configuration and options
 * @returns {Object} The data object, properly modified
 */
function shift(data) {
  var placement = data.placement;
  var basePlacement = placement.split('-')[0];
  var shiftvariation = placement.split('-')[1];

  // if shift shiftvariation is specified, run the modifier
  if (shiftvariation) {
    var _data$offsets = data.offsets,
        reference = _data$offsets.reference,
        popper = _data$offsets.popper;

    var isVertical = ['bottom', 'top'].indexOf(basePlacement) !== -1;
    var side = isVertical ? 'left' : 'top';
    var measurement = isVertical ? 'width' : 'height';

    var shiftOffsets = {
      start: defineProperty({}, side, reference[side]),
      end: defineProperty({}, side, reference[side] + reference[measurement] - popper[measurement])
    };

    data.offsets.popper = _extends({}, popper, shiftOffsets[shiftvariation]);
  }

  return data;
}

/**
 * @function
 * @memberof Modifiers
 * @argument {Object} data - The data object generated by update method
 * @argument {Object} options - Modifiers configuration and options
 * @returns {Object} The data object, properly modified
 */
function hide(data) {
  if (!isModifierRequired(data.instance.modifiers, 'hide', 'preventOverflow')) {
    return data;
  }

  var refRect = data.offsets.reference;
  var bound = find(data.instance.modifiers, function (modifier) {
    return modifier.name === 'preventOverflow';
  }).boundaries;

  if (refRect.bottom < bound.top || refRect.left > bound.right || refRect.top > bound.bottom || refRect.right < bound.left) {
    // Avoid unnecessary DOM access if visibility hasn't changed
    if (data.hide === true) {
      return data;
    }

    data.hide = true;
    data.attributes['x-out-of-boundaries'] = '';
  } else {
    // Avoid unnecessary DOM access if visibility hasn't changed
    if (data.hide === false) {
      return data;
    }

    data.hide = false;
    data.attributes['x-out-of-boundaries'] = false;
  }

  return data;
}

/**
 * @function
 * @memberof Modifiers
 * @argument {Object} data - The data object generated by `update` method
 * @argument {Object} options - Modifiers configuration and options
 * @returns {Object} The data object, properly modified
 */
function inner(data) {
  var placement = data.placement;
  var basePlacement = placement.split('-')[0];
  var _data$offsets = data.offsets,
      popper = _data$offsets.popper,
      reference = _data$offsets.reference;

  var isHoriz = ['left', 'right'].indexOf(basePlacement) !== -1;

  var subtractLength = ['top', 'left'].indexOf(basePlacement) === -1;

  popper[isHoriz ? 'left' : 'top'] = reference[basePlacement] - (subtractLength ? popper[isHoriz ? 'width' : 'height'] : 0);

  data.placement = getOppositePlacement(placement);
  data.offsets.popper = getClientRect(popper);

  return data;
}

/**
 * Modifier function, each modifier can have a function of this type assigned
 * to its `fn` property.<br />
 * These functions will be called on each update, this means that you must
 * make sure they are performant enough to avoid performance bottlenecks.
 *
 * @function ModifierFn
 * @argument {dataObject} data - The data object generated by `update` method
 * @argument {Object} options - Modifiers configuration and options
 * @returns {dataObject} The data object, properly modified
 */

/**
 * Modifiers are plugins used to alter the behavior of your poppers.<br />
 * Popper.js uses a set of 9 modifiers to provide all the basic functionalities
 * needed by the library.
 *
 * Usually you don't want to override the `order`, `fn` and `onLoad` props.
 * All the other properties are configurations that could be tweaked.
 * @namespace modifiers
 */
var modifiers = {
  /**
   * Modifier used to shift the popper on the start or end of its reference
   * element.<br />
   * It will read the variation of the `placement` property.<br />
   * It can be one either `-end` or `-start`.
   * @memberof modifiers
   * @inner
   */
  shift: {
    /** @prop {number} order=100 - Index used to define the order of execution */
    order: 100,
    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */
    enabled: true,
    /** @prop {ModifierFn} */
    fn: shift
  },

  /**
   * The `offset` modifier can shift your popper on both its axis.
   *
   * It accepts the following units:
   * - `px` or unit-less, interpreted as pixels
   * - `%` or `%r`, percentage relative to the length of the reference element
   * - `%p`, percentage relative to the length of the popper element
   * - `vw`, CSS viewport width unit
   * - `vh`, CSS viewport height unit
   *
   * For length is intended the main axis relative to the placement of the popper.<br />
   * This means that if the placement is `top` or `bottom`, the length will be the
   * `width`. In case of `left` or `right`, it will be the `height`.
   *
   * You can provide a single value (as `Number` or `String`), or a pair of values
   * as `String` divided by a comma or one (or more) white spaces.<br />
   * The latter is a deprecated method because it leads to confusion and will be
   * removed in v2.<br />
   * Additionally, it accepts additions and subtractions between different units.
   * Note that multiplications and divisions aren't supported.
   *
   * Valid examples are:
   * ```
   * 10
   * '10%'
   * '10, 10'
   * '10%, 10'
   * '10 + 10%'
   * '10 - 5vh + 3%'
   * '-10px + 5vh, 5px - 6%'
   * ```
   * > **NB**: If you desire to apply offsets to your poppers in a way that may make them overlap
   * > with their reference element, unfortunately, you will have to disable the `flip` modifier.
   * > You can read more on this at this [issue](https://github.com/FezVrasta/popper.js/issues/373).
   *
   * @memberof modifiers
   * @inner
   */
  offset: {
    /** @prop {number} order=200 - Index used to define the order of execution */
    order: 200,
    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */
    enabled: true,
    /** @prop {ModifierFn} */
    fn: offset,
    /** @prop {Number|String} offset=0
     * The offset value as described in the modifier description
     */
    offset: 0
  },

  /**
   * Modifier used to prevent the popper from being positioned outside the boundary.
   *
   * A scenario exists where the reference itself is not within the boundaries.<br />
   * We can say it has "escaped the boundaries" — or just "escaped".<br />
   * In this case we need to decide whether the popper should either:
   *
   * - detach from the reference and remain "trapped" in the boundaries, or
   * - if it should ignore the boundary and "escape with its reference"
   *
   * When `escapeWithReference` is set to`true` and reference is completely
   * outside its boundaries, the popper will overflow (or completely leave)
   * the boundaries in order to remain attached to the edge of the reference.
   *
   * @memberof modifiers
   * @inner
   */
  preventOverflow: {
    /** @prop {number} order=300 - Index used to define the order of execution */
    order: 300,
    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */
    enabled: true,
    /** @prop {ModifierFn} */
    fn: preventOverflow,
    /**
     * @prop {Array} [priority=['left','right','top','bottom']]
     * Popper will try to prevent overflow following these priorities by default,
     * then, it could overflow on the left and on top of the `boundariesElement`
     */
    priority: ['left', 'right', 'top', 'bottom'],
    /**
     * @prop {number} padding=5
     * Amount of pixel used to define a minimum distance between the boundaries
     * and the popper. This makes sure the popper always has a little padding
     * between the edges of its container
     */
    padding: 5,
    /**
     * @prop {String|HTMLElement} boundariesElement='scrollParent'
     * Boundaries used by the modifier. Can be `scrollParent`, `window`,
     * `viewport` or any DOM element.
     */
    boundariesElement: 'scrollParent'
  },

  /**
   * Modifier used to make sure the reference and its popper stay near each other
   * without leaving any gap between the two. Especially useful when the arrow is
   * enabled and you want to ensure that it points to its reference element.
   * It cares only about the first axis. You can still have poppers with margin
   * between the popper and its reference element.
   * @memberof modifiers
   * @inner
   */
  keepTogether: {
    /** @prop {number} order=400 - Index used to define the order of execution */
    order: 400,
    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */
    enabled: true,
    /** @prop {ModifierFn} */
    fn: keepTogether
  },

  /**
   * This modifier is used to move the `arrowElement` of the popper to make
   * sure it is positioned between the reference element and its popper element.
   * It will read the outer size of the `arrowElement` node to detect how many
   * pixels of conjunction are needed.
   *
   * It has no effect if no `arrowElement` is provided.
   * @memberof modifiers
   * @inner
   */
  arrow: {
    /** @prop {number} order=500 - Index used to define the order of execution */
    order: 500,
    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */
    enabled: true,
    /** @prop {ModifierFn} */
    fn: arrow,
    /** @prop {String|HTMLElement} element='[x-arrow]' - Selector or node used as arrow */
    element: '[x-arrow]'
  },

  /**
   * Modifier used to flip the popper's placement when it starts to overlap its
   * reference element.
   *
   * Requires the `preventOverflow` modifier before it in order to work.
   *
   * **NOTE:** this modifier will interrupt the current update cycle and will
   * restart it if it detects the need to flip the placement.
   * @memberof modifiers
   * @inner
   */
  flip: {
    /** @prop {number} order=600 - Index used to define the order of execution */
    order: 600,
    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */
    enabled: true,
    /** @prop {ModifierFn} */
    fn: flip,
    /**
     * @prop {String|Array} behavior='flip'
     * The behavior used to change the popper's placement. It can be one of
     * `flip`, `clockwise`, `counterclockwise` or an array with a list of valid
     * placements (with optional variations)
     */
    behavior: 'flip',
    /**
     * @prop {number} padding=5
     * The popper will flip if it hits the edges of the `boundariesElement`
     */
    padding: 5,
    /**
     * @prop {String|HTMLElement} boundariesElement='viewport'
     * The element which will define the boundaries of the popper position.
     * The popper will never be placed outside of the defined boundaries
     * (except if `keepTogether` is enabled)
     */
    boundariesElement: 'viewport',
    /**
     * @prop {Boolean} flipVariations=false
     * The popper will switch placement variation between `-start` and `-end` when
     * the reference element overlaps its boundaries.
     *
     * The original placement should have a set variation.
     */
    flipVariations: false,
    /**
     * @prop {Boolean} flipVariationsByContent=false
     * The popper will switch placement variation between `-start` and `-end` when
     * the popper element overlaps its reference boundaries.
     *
     * The original placement should have a set variation.
     */
    flipVariationsByContent: false
  },

  /**
   * Modifier used to make the popper flow toward the inner of the reference element.
   * By default, when this modifier is disabled, the popper will be placed outside
   * the reference element.
   * @memberof modifiers
   * @inner
   */
  inner: {
    /** @prop {number} order=700 - Index used to define the order of execution */
    order: 700,
    /** @prop {Boolean} enabled=false - Whether the modifier is enabled or not */
    enabled: false,
    /** @prop {ModifierFn} */
    fn: inner
  },

  /**
   * Modifier used to hide the popper when its reference element is outside of the
   * popper boundaries. It will set a `x-out-of-boundaries` attribute which can
   * be used to hide with a CSS selector the popper when its reference is
   * out of boundaries.
   *
   * Requires the `preventOverflow` modifier before it in order to work.
   * @memberof modifiers
   * @inner
   */
  hide: {
    /** @prop {number} order=800 - Index used to define the order of execution */
    order: 800,
    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */
    enabled: true,
    /** @prop {ModifierFn} */
    fn: hide
  },

  /**
   * Computes the style that will be applied to the popper element to gets
   * properly positioned.
   *
   * Note that this modifier will not touch the DOM, it just prepares the styles
   * so that `applyStyle` modifier can apply it. This separation is useful
   * in case you need to replace `applyStyle` with a custom implementation.
   *
   * This modifier has `850` as `order` value to maintain backward compatibility
   * with previous versions of Popper.js. Expect the modifiers ordering method
   * to change in future major versions of the library.
   *
   * @memberof modifiers
   * @inner
   */
  computeStyle: {
    /** @prop {number} order=850 - Index used to define the order of execution */
    order: 850,
    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */
    enabled: true,
    /** @prop {ModifierFn} */
    fn: computeStyle,
    /**
     * @prop {Boolean} gpuAcceleration=true
     * If true, it uses the CSS 3D transformation to position the popper.
     * Otherwise, it will use the `top` and `left` properties
     */
    gpuAcceleration: true,
    /**
     * @prop {string} [x='bottom']
     * Where to anchor the X axis (`bottom` or `top`). AKA X offset origin.
     * Change this if your popper should grow in a direction different from `bottom`
     */
    x: 'bottom',
    /**
     * @prop {string} [x='left']
     * Where to anchor the Y axis (`left` or `right`). AKA Y offset origin.
     * Change this if your popper should grow in a direction different from `right`
     */
    y: 'right'
  },

  /**
   * Applies the computed styles to the popper element.
   *
   * All the DOM manipulations are limited to this modifier. This is useful in case
   * you want to integrate Popper.js inside a framework or view library and you
   * want to delegate all the DOM manipulations to it.
   *
   * Note that if you disable this modifier, you must make sure the popper element
   * has its position set to `absolute` before Popper.js can do its work!
   *
   * Just disable this modifier and define your own to achieve the desired effect.
   *
   * @memberof modifiers
   * @inner
   */
  applyStyle: {
    /** @prop {number} order=900 - Index used to define the order of execution */
    order: 900,
    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */
    enabled: true,
    /** @prop {ModifierFn} */
    fn: applyStyle,
    /** @prop {Function} */
    onLoad: applyStyleOnLoad,
    /**
     * @deprecated since version 1.10.0, the property moved to `computeStyle` modifier
     * @prop {Boolean} gpuAcceleration=true
     * If true, it uses the CSS 3D transformation to position the popper.
     * Otherwise, it will use the `top` and `left` properties
     */
    gpuAcceleration: undefined
  }
};

/**
 * The `dataObject` is an object containing all the information used by Popper.js.
 * This object is passed to modifiers and to the `onCreate` and `onUpdate` callbacks.
 * @name dataObject
 * @property {Object} data.instance The Popper.js instance
 * @property {String} data.placement Placement applied to popper
 * @property {String} data.originalPlacement Placement originally defined on init
 * @property {Boolean} data.flipped True if popper has been flipped by flip modifier
 * @property {Boolean} data.hide True if the reference element is out of boundaries, useful to know when to hide the popper
 * @property {HTMLElement} data.arrowElement Node used as arrow by arrow modifier
 * @property {Object} data.styles Any CSS property defined here will be applied to the popper. It expects the JavaScript nomenclature (eg. `marginBottom`)
 * @property {Object} data.arrowStyles Any CSS property defined here will be applied to the popper arrow. It expects the JavaScript nomenclature (eg. `marginBottom`)
 * @property {Object} data.boundaries Offsets of the popper boundaries
 * @property {Object} data.offsets The measurements of popper, reference and arrow elements
 * @property {Object} data.offsets.popper `top`, `left`, `width`, `height` values
 * @property {Object} data.offsets.reference `top`, `left`, `width`, `height` values
 * @property {Object} data.offsets.arrow] `top` and `left` offsets, only one of them will be different from 0
 */

/**
 * Default options provided to Popper.js constructor.<br />
 * These can be overridden using the `options` argument of Popper.js.<br />
 * To override an option, simply pass an object with the same
 * structure of the `options` object, as the 3rd argument. For example:
 * ```
 * new Popper(ref, pop, {
 *   modifiers: {
 *     preventOverflow: { enabled: false }
 *   }
 * })
 * ```
 * @type {Object}
 * @static
 * @memberof Popper
 */
var Defaults = {
  /**
   * Popper's placement.
   * @prop {Popper.placements} placement='bottom'
   */
  placement: 'bottom',

  /**
   * Set this to true if you want popper to position it self in 'fixed' mode
   * @prop {Boolean} positionFixed=false
   */
  positionFixed: false,

  /**
   * Whether events (resize, scroll) are initially enabled.
   * @prop {Boolean} eventsEnabled=true
   */
  eventsEnabled: true,

  /**
   * Set to true if you want to automatically remove the popper when
   * you call the `destroy` method.
   * @prop {Boolean} removeOnDestroy=false
   */
  removeOnDestroy: false,

  /**
   * Callback called when the popper is created.<br />
   * By default, it is set to no-op.<br />
   * Access Popper.js instance with `data.instance`.
   * @prop {onCreate}
   */
  onCreate: function onCreate() {},

  /**
   * Callback called when the popper is updated. This callback is not called
   * on the initialization/creation of the popper, but only on subsequent
   * updates.<br />
   * By default, it is set to no-op.<br />
   * Access Popper.js instance with `data.instance`.
   * @prop {onUpdate}
   */
  onUpdate: function onUpdate() {},

  /**
   * List of modifiers used to modify the offsets before they are applied to the popper.
   * They provide most of the functionalities of Popper.js.
   * @prop {modifiers}
   */
  modifiers: modifiers
};

/**
 * @callback onCreate
 * @param {dataObject} data
 */

/**
 * @callback onUpdate
 * @param {dataObject} data
 */

// Utils
// Methods
var Popper = function () {
  /**
   * Creates a new Popper.js instance.
   * @class Popper
   * @param {Element|referenceObject} reference - The reference element used to position the popper
   * @param {Element} popper - The HTML / XML element used as the popper
   * @param {Object} options - Your custom options to override the ones defined in [Defaults](#defaults)
   * @return {Object} instance - The generated Popper.js instance
   */
  function Popper(reference, popper) {
    var _this = this;

    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
    classCallCheck(this, Popper);

    this.scheduleUpdate = function () {
      return requestAnimationFrame(_this.update);
    };

    // make update() debounced, so that it only runs at most once-per-tick
    this.update = debounce(this.update.bind(this));

    // with {} we create a new object with the options inside it
    this.options = _extends({}, Popper.Defaults, options);

    // init state
    this.state = {
      isDestroyed: false,
      isCreated: false,
      scrollParents: []
    };

    // get reference and popper elements (allow jQuery wrappers)
    this.reference = reference && reference.jquery ? reference[0] : reference;
    this.popper = popper && popper.jquery ? popper[0] : popper;

    // Deep merge modifiers options
    this.options.modifiers = {};
    Object.keys(_extends({}, Popper.Defaults.modifiers, options.modifiers)).forEach(function (name) {
      _this.options.modifiers[name] = _extends({}, Popper.Defaults.modifiers[name] || {}, options.modifiers ? options.modifiers[name] : {});
    });

    // Refactoring modifiers' list (Object => Array)
    this.modifiers = Object.keys(this.options.modifiers).map(function (name) {
      return _extends({
        name: name
      }, _this.options.modifiers[name]);
    })
    // sort the modifiers by order
    .sort(function (a, b) {
      return a.order - b.order;
    });

    // modifiers have the ability to execute arbitrary code when Popper.js get inited
    // such code is executed in the same order of its modifier
    // they could add new properties to their options configuration
    // BE AWARE: don't add options to `options.modifiers.name` but to `modifierOptions`!
    this.modifiers.forEach(function (modifierOptions) {
      if (modifierOptions.enabled && isFunction(modifierOptions.onLoad)) {
        modifierOptions.onLoad(_this.reference, _this.popper, _this.options, modifierOptions, _this.state);
      }
    });

    // fire the first update to position the popper in the right place
    this.update();

    var eventsEnabled = this.options.eventsEnabled;
    if (eventsEnabled) {
      // setup event listeners, they will take care of update the position in specific situations
      this.enableEventListeners();
    }

    this.state.eventsEnabled = eventsEnabled;
  }

  // We can't use class properties because they don't get listed in the
  // class prototype and break stuff like Sinon stubs


  createClass(Popper, [{
    key: 'update',
    value: function update$$1() {
      return update.call(this);
    }
  }, {
    key: 'destroy',
    value: function destroy$$1() {
      return destroy.call(this);
    }
  }, {
    key: 'enableEventListeners',
    value: function enableEventListeners$$1() {
      return enableEventListeners.call(this);
    }
  }, {
    key: 'disableEventListeners',
    value: function disableEventListeners$$1() {
      return disableEventListeners.call(this);
    }

    /**
     * Schedules an update. It will run on the next UI update available.
     * @method scheduleUpdate
     * @memberof Popper
     */


    /**
     * Collection of utilities useful when writing custom modifiers.
     * Starting from version 1.7, this method is available only if you
     * include `popper-utils.js` before `popper.js`.
     *
     * **DEPRECATION**: This way to access PopperUtils is deprecated
     * and will be removed in v2! Use the PopperUtils module directly instead.
     * Due to the high instability of the methods contained in Utils, we can't
     * guarantee them to follow semver. Use them at your own risk!
     * @static
     * @private
     * @type {Object}
     * @deprecated since version 1.8
     * @member Utils
     * @memberof Popper
     */

  }]);
  return Popper;
}();

/**
 * The `referenceObject` is an object that provides an interface compatible with Popper.js
 * and lets you use it as replacement of a real DOM node.<br />
 * You can use this method to position a popper relatively to a set of coordinates
 * in case you don't have a DOM node to use as reference.
 *
 * ```
 * new Popper(referenceObject, popperNode);
 * ```
 *
 * NB: This feature isn't supported in Internet Explorer 10.
 * @name referenceObject
 * @property {Function} data.getBoundingClientRect
 * A function that returns a set of coordinates compatible with the native `getBoundingClientRect` method.
 * @property {number} data.clientWidth
 * An ES6 getter that will return the width of the virtual reference element.
 * @property {number} data.clientHeight
 * An ES6 getter that will return the height of the virtual reference element.
 */


Popper.Utils = (typeof window !== 'undefined' ? window : global).PopperUtils;
Popper.placements = placements;
Popper.Defaults = Defaults;

return Popper;

})));


}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],8:[function(require,module,exports){
// shim for using process in browser
var process = module.exports = {};

// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

function defaultSetTimout() {
    throw new Error('setTimeout has not been defined');
}
function defaultClearTimeout () {
    throw new Error('clearTimeout has not been defined');
}
(function () {
    try {
        if (typeof setTimeout === 'function') {
            cachedSetTimeout = setTimeout;
        } else {
            cachedSetTimeout = defaultSetTimout;
        }
    } catch (e) {
        cachedSetTimeout = defaultSetTimout;
    }
    try {
        if (typeof clearTimeout === 'function') {
            cachedClearTimeout = clearTimeout;
        } else {
            cachedClearTimeout = defaultClearTimeout;
        }
    } catch (e) {
        cachedClearTimeout = defaultClearTimeout;
    }
} ())
function runTimeout(fun) {
    if (cachedSetTimeout === setTimeout) {
        //normal enviroments in sane situations
        return setTimeout(fun, 0);
    }
    // if setTimeout wasn't available but was latter defined
    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
        cachedSetTimeout = setTimeout;
        return setTimeout(fun, 0);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedSetTimeout(fun, 0);
    } catch(e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
            return cachedSetTimeout.call(null, fun, 0);
        } catch(e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
            return cachedSetTimeout.call(this, fun, 0);
        }
    }


}
function runClearTimeout(marker) {
    if (cachedClearTimeout === clearTimeout) {
        //normal enviroments in sane situations
        return clearTimeout(marker);
    }
    // if clearTimeout wasn't available but was latter defined
    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
        cachedClearTimeout = clearTimeout;
        return clearTimeout(marker);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedClearTimeout(marker);
    } catch (e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
            return cachedClearTimeout.call(null, marker);
        } catch (e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
            // Some versions of I.E. have different rules for clearTimeout vs setTimeout
            return cachedClearTimeout.call(this, marker);
        }
    }



}
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    if (!draining || !currentQueue) {
        return;
    }
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = runTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    runClearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        runTimeout(drainQueue);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;

process.listeners = function (name) { return [] }

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };

},{}],9:[function(require,module,exports){
/**!
 * @fileOverview Kickass library to create and place poppers near their reference elements.
 * @version 1.3.3
 * @license
 * Copyright (c) 2016 Federico Zivolo and contributors
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('popper.js')) :
	typeof define === 'function' && define.amd ? define(['popper.js'], factory) :
	(global.Tooltip = factory(global.Popper));
}(this, (function (Popper) { 'use strict';

Popper = Popper && Popper.hasOwnProperty('default') ? Popper['default'] : Popper;

/**
 * Check if the given variable is a function
 * @method
 * @memberof Popper.Utils
 * @argument {Any} functionToCheck - variable to check
 * @returns {Boolean} answer to: is a function?
 */
function isFunction(functionToCheck) {
  var getType = {};
  return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';
}

var classCallCheck = function (instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
};

var createClass = function () {
  function defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  return function (Constructor, protoProps, staticProps) {
    if (protoProps) defineProperties(Constructor.prototype, protoProps);
    if (staticProps) defineProperties(Constructor, staticProps);
    return Constructor;
  };
}();







var _extends = Object.assign || function (target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i];

    for (var key in source) {
      if (Object.prototype.hasOwnProperty.call(source, key)) {
        target[key] = source[key];
      }
    }
  }

  return target;
};

var DEFAULT_OPTIONS = {
  container: false,
  delay: 0,
  html: false,
  placement: 'top',
  title: '',
  template: '<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',
  trigger: 'hover focus',
  offset: 0,
  arrowSelector: '.tooltip-arrow, .tooltip__arrow',
  innerSelector: '.tooltip-inner, .tooltip__inner'
};

var Tooltip = function () {
  /**
   * Create a new Tooltip.js instance
   * @class Tooltip
   * @param {HTMLElement} reference - The DOM node used as reference of the tooltip (it can be a jQuery element).
   * @param {Object} options
   * @param {String} options.placement='top'
   *      Placement of the popper accepted values: `top(-start, -end), right(-start, -end), bottom(-start, -end),
   *      left(-start, -end)`
   * @param {String} [options.arrowSelector='.tooltip-arrow, .tooltip__arrow'] - className used to locate the DOM arrow element in the tooltip.
   * @param {String} [options.innerSelector='.tooltip-inner, .tooltip__inner'] - className used to locate the DOM inner element in the tooltip.
   * @param {HTMLElement|String|false} options.container=false - Append the tooltip to a specific element.
   * @param {Number|Object} options.delay=0
   *      Delay showing and hiding the tooltip (ms) - does not apply to manual trigger type.
   *      If a number is supplied, delay is applied to both hide/show.
   *      Object structure is: `{ show: 500, hide: 100 }`
   * @param {Boolean} options.html=false - Insert HTML into the tooltip. If false, the content will inserted with `textContent`.
   * @param {String} [options.template='<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>']
   *      Base HTML to used when creating the tooltip.
   *      The tooltip's `title` will be injected into the `.tooltip-inner` or `.tooltip__inner`.
   *      `.tooltip-arrow` or `.tooltip__arrow` will become the tooltip's arrow.
   *      The outermost wrapper element should have the `.tooltip` class.
   * @param {String|HTMLElement|TitleFunction} options.title='' - Default title value if `title` attribute isn't present.
   * @param {String} [options.trigger='hover focus']
   *      How tooltip is triggered - click, hover, focus, manual.
   *      You may pass multiple triggers; separate them with a space. `manual` cannot be combined with any other trigger.
   * @param {Boolean} options.closeOnClickOutside=false - Close a popper on click outside of the popper and reference element. This has effect only when options.trigger is 'click'.
   * @param {String|HTMLElement} options.boundariesElement
   *      The element used as boundaries for the tooltip. For more information refer to Popper.js'
   *      [boundariesElement docs](https://popper.js.org/popper-documentation.html)
   * @param {Number|String} options.offset=0 - Offset of the tooltip relative to its reference. For more information refer to Popper.js'
   *      [offset docs](https://popper.js.org/popper-documentation.html)
   * @param {Object} options.popperOptions={} - Popper options, will be passed directly to popper instance. For more information refer to Popper.js'
   *      [options docs](https://popper.js.org/popper-documentation.html)
   * @return {Object} instance - The generated tooltip instance
   */
  function Tooltip(reference, options) {
    classCallCheck(this, Tooltip);

    _initialiseProps.call(this);

    // apply user options over default ones
    options = _extends({}, DEFAULT_OPTIONS, options);

    reference.jquery && (reference = reference[0]);

    // cache reference and options
    this.reference = reference;
    this.options = options;

    // get events list
    var events = typeof options.trigger === 'string' ? options.trigger.split(' ').filter(function (trigger) {
      return ['click', 'hover', 'focus'].indexOf(trigger) !== -1;
    }) : [];

    // set initial state
    this._isOpen = false;
    this._popperOptions = {};

    // set event listeners
    this._setEventListeners(reference, events, options);
  }

  //
  // Public methods
  //

  /**
   * Reveals an element's tooltip. This is considered a "manual" triggering of the tooltip.
   * Tooltips with zero-length titles are never displayed.
   * @method Tooltip#show
   * @memberof Tooltip
   */


  /**
   * Hides an element’s tooltip. This is considered a “manual” triggering of the tooltip.
   * @method Tooltip#hide
   * @memberof Tooltip
   */


  /**
   * Hides and destroys an element’s tooltip.
   * @method Tooltip#dispose
   * @memberof Tooltip
   */


  /**
   * Toggles an element’s tooltip. This is considered a “manual” triggering of the tooltip.
   * @method Tooltip#toggle
   * @memberof Tooltip
   */


  /**
   * Updates the tooltip's title content
   * @method Tooltip#updateTitleContent
   * @memberof Tooltip
   * @param {String|HTMLElement} title - The new content to use for the title
   */


  //
  // Private methods
  //

  createClass(Tooltip, [{
    key: '_create',


    /**
     * Creates a new tooltip node
     * @memberof Tooltip
     * @private
     * @param {HTMLElement} reference
     * @param {String} template
     * @param {String|HTMLElement|TitleFunction} title
     * @param {Boolean} allowHtml
     * @return {HTMLElement} tooltipNode
     */
    value: function _create(reference, template, title, allowHtml) {
      // create tooltip element
      var tooltipGenerator = window.document.createElement('div');
      tooltipGenerator.innerHTML = template.trim();
      var tooltipNode = tooltipGenerator.childNodes[0];

      // add unique ID to our tooltip (needed for accessibility reasons)
      tooltipNode.id = 'tooltip_' + Math.random().toString(36).substr(2, 10);

      // set initial `aria-hidden` state to `false` (it's visible!)
      tooltipNode.setAttribute('aria-hidden', 'false');

      // add title to tooltip
      var titleNode = tooltipGenerator.querySelector(this.options.innerSelector);
      this._addTitleContent(reference, title, allowHtml, titleNode);

      // return the generated tooltip node
      return tooltipNode;
    }
  }, {
    key: '_addTitleContent',
    value: function _addTitleContent(reference, title, allowHtml, titleNode) {
      if (title.nodeType === 1 || title.nodeType === 11) {
        // if title is a element node or document fragment, append it only if allowHtml is true
        allowHtml && titleNode.appendChild(title);
      } else if (isFunction(title)) {
        // Recursively call ourself so that the return value of the function gets handled appropriately - either
        // as a dom node, a string, or even as another function.
        this._addTitleContent(reference, title.call(reference), allowHtml, titleNode);
      } else {
        // if it's just a simple text, set textContent or innerHtml depending by `allowHtml` value
        allowHtml ? titleNode.innerHTML = title : titleNode.textContent = title;
      }
    }
  }, {
    key: '_show',
    value: function _show(reference, options) {
      // don't show if it's already visible
      // or if it's not being showed
      if (this._isOpen && !this._isOpening) {
        return this;
      }
      this._isOpen = true;

      // if the tooltipNode already exists, just show it
      if (this._tooltipNode) {
        this._tooltipNode.style.visibility = 'visible';
        this._tooltipNode.setAttribute('aria-hidden', 'false');
        this.popperInstance.update();
        return this;
      }

      // get title
      var title = reference.getAttribute('title') || options.title;

      // don't show tooltip if no title is defined
      if (!title) {
        return this;
      }

      // create tooltip node
      var tooltipNode = this._create(reference, options.template, title, options.html);

      // Add `aria-describedby` to our reference element for accessibility reasons
      reference.setAttribute('aria-describedby', tooltipNode.id);

      // append tooltip to container
      var container = this._findContainer(options.container, reference);

      this._append(tooltipNode, container);

      this._popperOptions = _extends({}, options.popperOptions, {
        placement: options.placement
      });

      this._popperOptions.modifiers = _extends({}, this._popperOptions.modifiers, {
        arrow: _extends({}, this._popperOptions.modifiers && this._popperOptions.modifiers.arrow, {
          element: options.arrowSelector
        }),
        offset: _extends({}, this._popperOptions.modifiers && this._popperOptions.modifiers.offset, {
          offset: options.offset || this._popperOptions.modifiers && this._popperOptions.modifiers.offset && this._popperOptions.modifiers.offset.offset || options.offset
        })
      });

      if (options.boundariesElement) {
        this._popperOptions.modifiers.preventOverflow = {
          boundariesElement: options.boundariesElement
        };
      }

      this.popperInstance = new Popper(reference, tooltipNode, this._popperOptions);

      this._tooltipNode = tooltipNode;

      return this;
    }
  }, {
    key: '_hide',
    value: function _hide() /*reference, options*/{
      // don't hide if it's already hidden
      if (!this._isOpen) {
        return this;
      }

      this._isOpen = false;

      // hide tooltipNode
      this._tooltipNode.style.visibility = 'hidden';
      this._tooltipNode.setAttribute('aria-hidden', 'true');

      return this;
    }
  }, {
    key: '_dispose',
    value: function _dispose() {
      var _this = this;

      // remove event listeners first to prevent any unexpected behaviour
      this._events.forEach(function (_ref) {
        var func = _ref.func,
            event = _ref.event;

        _this.reference.removeEventListener(event, func);
      });
      this._events = [];

      if (this._tooltipNode) {
        this._hide();

        // destroy instance
        this.popperInstance.destroy();

        // destroy tooltipNode if removeOnDestroy is not set, as popperInstance.destroy() already removes the element
        if (!this.popperInstance.options.removeOnDestroy) {
          this._tooltipNode.parentNode.removeChild(this._tooltipNode);
          this._tooltipNode = null;
        }
      }
      return this;
    }
  }, {
    key: '_findContainer',
    value: function _findContainer(container, reference) {
      // if container is a query, get the relative element
      if (typeof container === 'string') {
        container = window.document.querySelector(container);
      } else if (container === false) {
        // if container is `false`, set it to reference parent
        container = reference.parentNode;
      }
      return container;
    }

    /**
     * Append tooltip to container
     * @memberof Tooltip
     * @private
     * @param {HTMLElement} tooltipNode
     * @param {HTMLElement|String|false} container
     */

  }, {
    key: '_append',
    value: function _append(tooltipNode, container) {
      container.appendChild(tooltipNode);
    }
  }, {
    key: '_setEventListeners',
    value: function _setEventListeners(reference, events, options) {
      var _this2 = this;

      var directEvents = [];
      var oppositeEvents = [];

      events.forEach(function (event) {
        switch (event) {
          case 'hover':
            directEvents.push('mouseenter');
            oppositeEvents.push('mouseleave');
            break;
          case 'focus':
            directEvents.push('focus');
            oppositeEvents.push('blur');
            break;
          case 'click':
            directEvents.push('click');
            oppositeEvents.push('click');
            break;
        }
      });

      // schedule show tooltip
      directEvents.forEach(function (event) {
        var func = function func(evt) {
          if (_this2._isOpening === true) {
            return;
          }
          evt.usedByTooltip = true;
          _this2._scheduleShow(reference, options.delay, options, evt);
        };
        _this2._events.push({ event: event, func: func });
        reference.addEventListener(event, func);
      });

      // schedule hide tooltip
      oppositeEvents.forEach(function (event) {
        var func = function func(evt) {
          if (evt.usedByTooltip === true) {
            return;
          }
          _this2._scheduleHide(reference, options.delay, options, evt);
        };
        _this2._events.push({ event: event, func: func });
        reference.addEventListener(event, func);
        if (event === 'click' && options.closeOnClickOutside) {
          document.addEventListener('mousedown', function (e) {
            if (!_this2._isOpening) {
              return;
            }
            var popper = _this2.popperInstance.popper;
            if (reference.contains(e.target) || popper.contains(e.target)) {
              return;
            }
            func(e);
          }, true);
        }
      });
    }
  }, {
    key: '_scheduleShow',
    value: function _scheduleShow(reference, delay, options /*, evt */) {
      var _this3 = this;

      this._isOpening = true;
      // defaults to 0
      var computedDelay = delay && delay.show || delay || 0;
      this._showTimeout = window.setTimeout(function () {
        return _this3._show(reference, options);
      }, computedDelay);
    }
  }, {
    key: '_scheduleHide',
    value: function _scheduleHide(reference, delay, options, evt) {
      var _this4 = this;

      this._isOpening = false;
      // defaults to 0
      var computedDelay = delay && delay.hide || delay || 0;
      window.clearTimeout(this._showTimeout);
      window.setTimeout(function () {
        if (_this4._isOpen === false) {
          return;
        }
        if (!document.body.contains(_this4._tooltipNode)) {
          return;
        }

        // if we are hiding because of a mouseleave, we must check that the new
        // reference isn't the tooltip, because in this case we don't want to hide it
        if (evt.type === 'mouseleave') {
          var isSet = _this4._setTooltipNodeEvent(evt, reference, delay, options);

          // if we set the new event, don't hide the tooltip yet
          // the new event will take care to hide it if necessary
          if (isSet) {
            return;
          }
        }

        _this4._hide(reference, options);
      }, computedDelay);
    }
  }, {
    key: '_updateTitleContent',
    value: function _updateTitleContent(title) {
      if (typeof this._tooltipNode === 'undefined') {
        if (typeof this.options.title !== 'undefined') {
          this.options.title = title;
        }
        return;
      }
      var titleNode = this._tooltipNode.querySelector(this.options.innerSelector);
      this._clearTitleContent(titleNode, this.options.html, this.reference.getAttribute('title') || this.options.title);
      this._addTitleContent(this.reference, title, this.options.html, titleNode);
      this.options.title = title;
      this.popperInstance.update();
    }
  }, {
    key: '_clearTitleContent',
    value: function _clearTitleContent(titleNode, allowHtml, lastTitle) {
      if (lastTitle.nodeType === 1 || lastTitle.nodeType === 11) {
        allowHtml && titleNode.removeChild(lastTitle);
      } else {
        allowHtml ? titleNode.innerHTML = '' : titleNode.textContent = '';
      }
    }
  }]);
  return Tooltip;
}();

/**
 * Title function, its context is the Tooltip instance.
 * @memberof Tooltip
 * @callback TitleFunction
 * @return {String} placement - The desired title.
 */


var _initialiseProps = function _initialiseProps() {
  var _this5 = this;

  this.show = function () {
    return _this5._show(_this5.reference, _this5.options);
  };

  this.hide = function () {
    return _this5._hide();
  };

  this.dispose = function () {
    return _this5._dispose();
  };

  this.toggle = function () {
    if (_this5._isOpen) {
      return _this5.hide();
    } else {
      return _this5.show();
    }
  };

  this.updateTitleContent = function (title) {
    return _this5._updateTitleContent(title);
  };

  this._events = [];

  this._setTooltipNodeEvent = function (evt, reference, delay, options) {
    var relatedreference = evt.relatedreference || evt.toElement || evt.relatedTarget;

    var callback = function callback(evt2) {
      var relatedreference2 = evt2.relatedreference || evt2.toElement || evt2.relatedTarget;

      // Remove event listener after call
      _this5._tooltipNode.removeEventListener(evt.type, callback);

      // If the new reference is not the reference element
      if (!reference.contains(relatedreference2)) {
        // Schedule to hide tooltip
        _this5._scheduleHide(reference, options.delay, options, evt2);
      }
    };

    if (_this5._tooltipNode.contains(relatedreference)) {
      // listen to mouseleave on the tooltip element to be able to hide the tooltip
      _this5._tooltipNode.addEventListener(evt.type, callback);
      return true;
    }

    return false;
  };
};

return Tooltip;

})));


},{"popper.js":7}],10:[function(require,module,exports){
/** @license
 *
 *  Copyright (C) 2012 K. Arthur Endsley (kaendsle@mtu.edu)
 *  Michigan Tech Research Institute (MTRI)
 *  3600 Green Court, Suite 100, Ann Arbor, MI, 48105
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 */

(function (root, factory) {

    if (typeof define === "function" && define.amd) {
        // AMD (+ global for extensions)
        define(function () {
            return factory();
        });
    } else if (typeof module !== 'undefined' && typeof exports === "object") {
        // CommonJS
        module.exports = factory();
    } else {
        // Browser
        root.Wkt = factory();
    }
}(this, function () {


    var beginsWith, endsWith, root, Wkt;

    // Establish the root object, window in the browser, or exports on the server
    root = this;

    /**
     * @desc The Wkt namespace.
     * @property    {String}    delimiter   - The default delimiter for separating components of atomic geometry (coordinates)
     * @namespace
     * @global
     */
    Wkt = function (obj) {
        if (obj instanceof Wkt) return obj;
        if (!(this instanceof Wkt)) return new Wkt(obj);
        this._wrapped = obj;
    };



    /**
     * Returns true if the substring is found at the beginning of the string.
     * @param   str {String}    The String to search
     * @param   sub {String}    The substring of interest
     * @return      {Boolean}
     * @private
     */
    beginsWith = function (str, sub) {
        return str.substring(0, sub.length) === sub;
    };

    /**
     * Returns true if the substring is found at the end of the string.
     * @param   str {String}    The String to search
     * @param   sub {String}    The substring of interest
     * @return      {Boolean}
     * @private
     */
    endsWith = function (str, sub) {
        return str.substring(str.length - sub.length) === sub;
    };

    /**
     * The default delimiter for separating components of atomic geometry (coordinates)
     * @ignore
     */
    Wkt.delimiter = ' ';

    /**
     * Determines whether or not the passed Object is an Array.
     * @param   obj {Object}    The Object in question
     * @return      {Boolean}
     * @member Wkt.isArray
     * @method
     */
    Wkt.isArray = function (obj) {
        return !!(obj && obj.constructor === Array);
    };

    /**
     * Removes given character String(s) from a String.
     * @param   str {String}    The String to search
     * @param   sub {String}    The String character(s) to trim
     * @return      {String}    The trimmed string
     * @member Wkt.trim
     * @method
     */
    Wkt.trim = function (str, sub) {
        sub = sub || ' '; // Defaults to trimming spaces
        // Trim beginning spaces
        while (beginsWith(str, sub)) {
            str = str.substring(1);
        }
        // Trim ending spaces
        while (endsWith(str, sub)) {
            str = str.substring(0, str.length - 1);
        }
        return str;
    };

    /**
     * An object for reading WKT strings and writing geographic features
     * @constructor this.Wkt.Wkt
     * @param   initializer {String}    An optional WKT string for immediate read
     * @property            {Array}     components      - Holder for atomic geometry objects (internal representation of geometric components)
     * @property            {String}    delimiter       - The default delimiter for separating components of atomic geometry (coordinates)
     * @property            {Object}    regExes         - Some regular expressions copied from OpenLayers.Format.WKT.js
     * @property            {String}    type            - The Well-Known Text name (e.g. 'point') of the geometry
     * @property            {Boolean}   wrapVerticies   - True to wrap vertices in MULTIPOINT geometries; If true: MULTIPOINT((30 10),(10 30),(40 40)); If false: MULTIPOINT(30 10,10 30,40 40)
     * @return              {this.Wkt.Wkt}
     * @memberof Wkt
     */
    Wkt.Wkt = function (initializer) {

        /**
         * The default delimiter between X and Y coordinates.
         * @ignore
         */
        this.delimiter = Wkt.delimiter || ' ';

        /**
         * Configuration parameter for controlling how Wicket seralizes
         * MULTIPOINT strings. Examples; both are valid WKT:
         * If true: MULTIPOINT((30 10),(10 30),(40 40))
         * If false: MULTIPOINT(30 10,10 30,40 40)
         * @ignore
         */
        this.wrapVertices = true;

        /**
         * Some regular expressions copied from OpenLayers.Format.WKT.js
         * @ignore
         */
        this.regExes = {
            'typeStr': /^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,
            'spaces': /\s+|\+/, // Matches the '+' or the empty space
            'numeric': /-*\d+(\.*\d+)?/,
            'comma': /\s*,\s*/,
            'parenComma': /\)\s*,\s*\(/,
            'coord': /-*\d+\.*\d+ -*\d+\.*\d+/, // e.g. "24 -14"
            'doubleParenComma': /\)\s*\)\s*,\s*\(\s*\(/,
            'ogcTypes': /^(multi)?(point|line|polygon|box)?(string)?$/i, // Captures e.g. "Multi","Line","String"
            'crudeJson': /^{.*"(type|coordinates|geometries|features)":.*}$/ // Attempts to recognize JSON strings
        };

        /**
         * Strip any whitespace and parens from front and back.
         * This is the equivalent of s/^\s*\(?(.*)\)?\s*$/$1/ but without the risk of catastrophic backtracking.
         * @param   str {String}
         */
        this._stripWhitespaceAndParens = function (fullStr) {
            var trimmed = fullStr.trim();
            var noParens = trimmed.replace(/^\(?(.*?)\)?$/, '$1');
            return noParens;
        };

        /**
         * The internal representation of geometry--the "components" of geometry.
         * @ignore
         */
        this.components = undefined;

        // An initial WKT string may be provided
        if (initializer && typeof initializer === 'string') {
            this.read(initializer);
        } else if (initializer && typeof initializer !== undefined) {
            this.fromObject(initializer);
        }

    };



    /**
     * Returns true if the internal geometry is a collection of geometries.
     * @return  {Boolean}   Returns true when it is a collection
     * @memberof this.Wkt.Wkt
     * @method
     */
    Wkt.Wkt.prototype.isCollection = function () {
        switch (this.type.slice(0, 5)) {
            case 'multi':
                // Trivial; any multi-geometry is a collection
                return true;
            case 'polyg':
                // Polygons with holes are "collections" of rings
                return true;
            default:
                // Any other geometry is not a collection
                return false;
        }
    };

    /**
     * Compares two x,y coordinates for equality.
     * @param   a   {Object}    An object with x and y properties
     * @param   b   {Object}    An object with x and y properties
     * @return      {Boolean}
     * @memberof this.Wkt.Wkt
     * @method
     */
    Wkt.Wkt.prototype.sameCoords = function (a, b) {
        return (a.x === b.x && a.y === b.y);
    };

    /**
     * Sets internal geometry (components) from framework geometry (e.g.
     * Google Polygon objects or google.maps.Polygon).
     * @param   obj {Object}    The framework-dependent geometry representation
     * @return      {this.Wkt.Wkt}   The object itself
     * @memberof this.Wkt.Wkt
     * @method
     */
    Wkt.Wkt.prototype.fromObject = function (obj) {
        var result;

        if (obj.hasOwnProperty('type') && obj.hasOwnProperty('coordinates')) {
            result = this.fromJson(obj);
        } else {
            result = this.deconstruct.call(this, obj);
        }

        this.components = result.components;
        this.isRectangle = result.isRectangle || false;
        this.type = result.type;
        return this;
    };

    /**
     * Creates external geometry objects based on a plug-in framework's
     * construction methods and available geometry classes.
     * @param   config  {Object}    An optional framework-dependent properties specification
     * @return          {Object}    The framework-dependent geometry representation
     * @memberof this.Wkt.Wkt
     * @method
     */
    Wkt.Wkt.prototype.toObject = function (config) {
        var obj = this.construct[this.type].call(this, config);
        // Don't assign the "properties" property to an Array
        if (typeof obj === 'object' && !Wkt.isArray(obj)) {
            obj.properties = this.properties;
        }
        return obj;
    };

    /**
     * Returns the WKT string representation; the same as the write() method.
     * @memberof this.Wkt.Wkt
     * @method
     */
    Wkt.Wkt.prototype.toString = function (config) {
        return this.write();
    };

    /**
     * Parses a JSON representation as an Object.
     * @param	obj	{Object}	An Object with the GeoJSON schema
     * @return	{this.Wkt.Wkt}	The object itself
     * @memberof this.Wkt.Wkt
     * @method
     */
    Wkt.Wkt.prototype.fromJson = function (obj) {
        var i, j, k, coords, iring, oring;

        this.type = obj.type.toLowerCase();
        this.components = [];
        if (obj.hasOwnProperty('geometry')) { //Feature
            this.fromJson(obj.geometry);
            this.properties = obj.properties;
            return this;
        }
        coords = obj.coordinates;

        if (!Wkt.isArray(coords[0])) { // Point
            this.components.push({
                x: coords[0],
                y: coords[1]
            });

        } else {

            for (i in coords) {
                if (coords.hasOwnProperty(i)) {

                    if (!Wkt.isArray(coords[i][0])) { // LineString

                        if (this.type === 'multipoint') { // MultiPoint
                            this.components.push([{
                                x: coords[i][0],
                                y: coords[i][1]
                            }]);

                        } else {
                            this.components.push({
                                x: coords[i][0],
                                y: coords[i][1]
                            });

                        }

                    } else {

                        oring = [];
                        for (j in coords[i]) {
                            if (coords[i].hasOwnProperty(j)) {

                                if (!Wkt.isArray(coords[i][j][0])) {
                                    oring.push({
                                        x: coords[i][j][0],
                                        y: coords[i][j][1]
                                    });

                                } else {

                                    iring = [];
                                    for (k in coords[i][j]) {
                                        if (coords[i][j].hasOwnProperty(k)) {

                                            iring.push({
                                                x: coords[i][j][k][0],
                                                y: coords[i][j][k][1]
                                            });

                                        }
                                    }

                                    oring.push(iring);

                                }

                            }
                        }

                        this.components.push(oring);
                    }
                }
            }

        }

        return this;
    };

    /**
     * Creates a JSON representation, with the GeoJSON schema, of the geometry.
     * @return    {Object}    The corresponding GeoJSON representation
     * @memberof this.Wkt.Wkt
     * @method
     */
    Wkt.Wkt.prototype.toJson = function () {
        var cs, json, i, j, k, ring, rings;

        cs = this.components;
        json = {
            coordinates: [],
            type: (function () {
                var i, type, s;

                type = this.regExes.ogcTypes.exec(this.type).slice(1);
                s = [];

                for (i in type) {
                    if (type.hasOwnProperty(i)) {
                        if (type[i] !== undefined) {
                            s.push(type[i].toLowerCase().slice(0, 1).toUpperCase() + type[i].toLowerCase().slice(1));
                        }
                    }
                }

                return s;
            }.call(this)).join('')
        }

        // Wkt BOX type gets a special bbox property in GeoJSON
        if (this.type.toLowerCase() === 'box') {
            json.type = 'Polygon';
            json.bbox = [];

            for (i in cs) {
                if (cs.hasOwnProperty(i)) {
                    json.bbox = json.bbox.concat([cs[i].x, cs[i].y]);
                }
            }

            json.coordinates = [
                [
                    [cs[0].x, cs[0].y],
                    [cs[0].x, cs[1].y],
                    [cs[1].x, cs[1].y],
                    [cs[1].x, cs[0].y],
                    [cs[0].x, cs[0].y]
                ]
            ];

            return json;
        }

        // For the coordinates of most simple features
        for (i in cs) {
            if (cs.hasOwnProperty(i)) {

                // For those nested structures
                if (Wkt.isArray(cs[i])) {
                    rings = [];

                    for (j in cs[i]) {
                        if (cs[i].hasOwnProperty(j)) {

                            if (Wkt.isArray(cs[i][j])) { // MULTIPOLYGONS
                                ring = [];

                                for (k in cs[i][j]) {
                                    if (cs[i][j].hasOwnProperty(k)) {
                                        ring.push([cs[i][j][k].x, cs[i][j][k].y]);
                                    }
                                }

                                rings.push(ring);

                            } else { // POLYGONS and MULTILINESTRINGS

                                if (cs[i].length > 1) {
                                    rings.push([cs[i][j].x, cs[i][j].y]);

                                } else { // MULTIPOINTS
                                    rings = rings.concat([cs[i][j].x, cs[i][j].y]);
                                }
                            }
                        }
                    }

                    json.coordinates.push(rings);

                } else {
                    if (cs.length > 1) { // For LINESTRING type
                        json.coordinates.push([cs[i].x, cs[i].y]);

                    } else { // For POINT type
                        json.coordinates = json.coordinates.concat([cs[i].x, cs[i].y]);
                    }
                }

            }
        }

        return json;
    };

    /**
     * Absorbs the geometry of another this.Wkt.Wkt instance, merging it with its own,
     * creating a collection (MULTI-geometry) based on their types, which must agree.
     * For example, creates a MULTIPOLYGON from a POLYGON type merged with another
     * POLYGON type, or adds a POLYGON instance to a MULTIPOLYGON instance.
     * @param   wkt {String}    A Wkt.Wkt object
     * @return	{this.Wkt.Wkt}	The object itself
     * @memberof this.Wkt.Wkt
     * @method
     */
    Wkt.Wkt.prototype.merge = function (wkt) {
        var prefix = this.type.slice(0, 5);

        if (this.type !== wkt.type) {
            if (this.type.slice(5, this.type.length) !== wkt.type) {
                throw TypeError('The input geometry types must agree or the calling this.Wkt.Wkt instance must be a multigeometry of the other');
            }
        }

        switch (prefix) {

            case 'point':
                this.components = [this.components.concat(wkt.components)];
                break;

            case 'multi':
                this.components = this.components.concat((wkt.type.slice(0, 5) === 'multi') ? wkt.components : [wkt.components]);
                break;

            default:
                this.components = [
                    this.components,
                    wkt.components
                ];
                break;

        }

        if (prefix !== 'multi') {
            this.type = 'multi' + this.type;
        }
        return this;
    };

    /**
     * Reads a WKT string, validating and incorporating it.
     * @param   str {String}    A WKT or GeoJSON string
     * @return	{this.Wkt.Wkt}	The object itself
     * @memberof this.Wkt.Wkt
     * @method
     */
    Wkt.Wkt.prototype.read = function (str) {
        var matches;
        matches = this.regExes.typeStr.exec(str);
        if (matches) {
            this.type = matches[1].toLowerCase();
            this.base = matches[2];
            if (this.ingest[this.type]) {
                this.components = this.ingest[this.type].apply(this, [this.base]);
            }

        } else {
            if (this.regExes.crudeJson.test(str)) {
                if (typeof JSON === 'object' && typeof JSON.parse === 'function') {
                    this.fromJson(JSON.parse(str));

                } else {
                    console.log('JSON.parse() is not available; cannot parse GeoJSON strings');
                    throw {
                        name: 'JSONError',
                        message: 'JSON.parse() is not available; cannot parse GeoJSON strings'
                    };
                }

            } else {
                console.log('Invalid WKT string provided to read()');
                throw {
                    name: 'WKTError',
                    message: 'Invalid WKT string provided to read()'
                };
            }
        }

        return this;
    }; // eo readWkt

    /**
     * Writes a WKT string.
     * @param   components  {Array}     An Array of internal geometry objects
     * @return              {String}    The corresponding WKT representation
     * @memberof this.Wkt.Wkt
     * @method
     */
    Wkt.Wkt.prototype.write = function (components) {
        var i, pieces, data;

        components = components || this.components;

        pieces = [];

        pieces.push(this.type.toUpperCase() + '(');

        for (i = 0; i < components.length; i += 1) {
            if (this.isCollection() && i > 0) {
                pieces.push(',');
            }

            // There should be an extract function for the named type
            if (!this.extract[this.type]) {
                return null;
            }

            data = this.extract[this.type].apply(this, [components[i]]);
            if (this.isCollection() && this.type !== 'multipoint') {
                pieces.push('(' + data + ')');

            } else {
                pieces.push(data);

                // If not at the end of the components, add a comma
                if (i !== (components.length - 1) && this.type !== 'multipoint') {
                    pieces.push(',');
                }

            }
        }

        pieces.push(')');

        return pieces.join('');
    };

    /**
     * This object contains functions as property names that extract WKT
     * strings from the internal representation.
     * @memberof this.Wkt.Wkt
     * @namespace this.Wkt.Wkt.extract
     * @instance
     */
    Wkt.Wkt.prototype.extract = {
        /**
         * Return a WKT string representing atomic (point) geometry
         * @param   point   {Object}    An object with x and y properties
         * @return          {String}    The WKT representation
         * @memberof this.Wkt.Wkt.extract
         * @instance
         */
        point: function (point) {
            return String(point.x) + this.delimiter + String(point.y);
        },

        /**
         * Return a WKT string representing multiple atoms (points)
         * @param   multipoint  {Array}     Multiple x-and-y objects
         * @return              {String}    The WKT representation
         * @memberof this.Wkt.Wkt.extract
         * @instance
         */
        multipoint: function (multipoint) {
            var i, parts = [],
                s;

            for (i = 0; i < multipoint.length; i += 1) {
                s = this.extract.point.apply(this, [multipoint[i]]);

                if (this.wrapVertices) {
                    s = '(' + s + ')';
                }

                parts.push(s);
            }

            return parts.join(',');
        },

        /**
         * Return a WKT string representing a chain (linestring) of atoms
         * @param   linestring  {Array}     Multiple x-and-y objects
         * @return              {String}    The WKT representation
         * @memberof this.Wkt.Wkt.extract
         * @instance
         */
        linestring: function (linestring) {
            // Extraction of linestrings is the same as for points
            return this.extract.point.apply(this, [linestring]);
        },

        /**
         * Return a WKT string representing multiple chains (multilinestring) of atoms
         * @param   multilinestring {Array}     Multiple of multiple x-and-y objects
         * @return                  {String}    The WKT representation
         * @memberof this.Wkt.Wkt.extract
         * @instance
         */
        multilinestring: function (multilinestring) {
            var i, parts = [];

            if (multilinestring.length) {
                for (i = 0; i < multilinestring.length; i += 1) {
                    parts.push(this.extract.linestring.apply(this, [multilinestring[i]]));
                }
            } else {
                parts.push(this.extract.point.apply(this, [multilinestring]));
            }

            return parts.join(',');
        },

        /**
         * Return a WKT string representing multiple atoms in closed series (polygon)
         * @param   polygon {Array}     Collection of ordered x-and-y objects
         * @return          {String}    The WKT representation
         * @memberof this.Wkt.Wkt.extract
         * @instance
         */
        polygon: function (polygon) {
            // Extraction of polygons is the same as for multilinestrings
            return this.extract.multilinestring.apply(this, [polygon]);
        },

        /**
         * Return a WKT string representing multiple closed series (multipolygons) of multiple atoms
         * @param   multipolygon    {Array}     Collection of ordered x-and-y objects
         * @return                  {String}    The WKT representation
         * @memberof this.Wkt.Wkt.extract
         * @instance
         */
        multipolygon: function (multipolygon) {
            var i, parts = [];
            for (i = 0; i < multipolygon.length; i += 1) {
                parts.push('(' + this.extract.polygon.apply(this, [multipolygon[i]]) + ')');
            }
            return parts.join(',');
        },

        /**
         * Return a WKT string representing a 2DBox
         * @param   multipolygon    {Array}     Collection of ordered x-and-y objects
         * @return                  {String}    The WKT representation
         * @memberof this.Wkt.Wkt.extract
         * @instance
         */
        box: function (box) {
            return this.extract.linestring.apply(this, [box]);
        },

        geometrycollection: function (str) {
            console.log('The geometrycollection WKT type is not yet supported.');
        }
    };

    /**
     * This object contains functions as property names that ingest WKT
     * strings into the internal representation.
     * @memberof this.Wkt.Wkt
     * @namespace this.Wkt.Wkt.ingest
     * @instance
     */
    Wkt.Wkt.prototype.ingest = {

        /**
         * Return point feature given a point WKT fragment.
         * @param   str {String}    A WKT fragment representing the point
         * @memberof this.Wkt.Wkt.ingest
         * @instance
         */
        point: function (str) {
            var coords = Wkt.trim(str).split(this.regExes.spaces);
            // In case a parenthetical group of coordinates is passed...
            return [{ // ...Search for numeric substrings
                x: parseFloat(this.regExes.numeric.exec(coords[0])[0]),
                y: parseFloat(this.regExes.numeric.exec(coords[1])[0])
            }];
        },

        /**
         * Return a multipoint feature given a multipoint WKT fragment.
         * @param   str {String}    A WKT fragment representing the multipoint
         * @memberof this.Wkt.Wkt.ingest
         * @instance
         */
        multipoint: function (str) {
            var i, components, points;
            components = [];
            points = Wkt.trim(str).split(this.regExes.comma);
            for (i = 0; i < points.length; i += 1) {
                components.push(this.ingest.point.apply(this, [points[i]]));
            }
            return components;
        },

        /**
         * Return a linestring feature given a linestring WKT fragment.
         * @param   str {String}    A WKT fragment representing the linestring
         * @memberof this.Wkt.Wkt.ingest
         * @instance
         */
        linestring: function (str) {
            var i, multipoints, components;

            // In our x-and-y representation of components, parsing
            //  multipoints is the same as parsing linestrings
            multipoints = this.ingest.multipoint.apply(this, [str]);

            // However, the points need to be joined
            components = [];
            for (i = 0; i < multipoints.length; i += 1) {
                components = components.concat(multipoints[i]);
            }
            return components;
        },

        /**
         * Return a multilinestring feature given a multilinestring WKT fragment.
         * @param   str {String}    A WKT fragment representing the multilinestring
         * @memberof this.Wkt.Wkt.ingest
         * @instance
         */
        multilinestring: function (str) {
            var i, components, line, lines;
            components = [];

            lines = Wkt.trim(str).split(this.regExes.doubleParenComma);
            if (lines.length === 1) { // If that didn't work...
                lines = Wkt.trim(str).split(this.regExes.parenComma);
            }

            for (i = 0; i < lines.length; i += 1) {
                line = this._stripWhitespaceAndParens(lines[i]);
                components.push(this.ingest.linestring.apply(this, [line]));
            }

            return components;
        },

        /**
         * Return a polygon feature given a polygon WKT fragment.
         * @param   str {String}    A WKT fragment representing the polygon
         * @memberof this.Wkt.Wkt.ingest
         * @instance
         */
        polygon: function (str) {
            var i, j, components, subcomponents, ring, rings;
            rings = Wkt.trim(str).split(this.regExes.parenComma);
            components = []; // Holds one or more rings
            for (i = 0; i < rings.length; i += 1) {
                ring = this._stripWhitespaceAndParens(rings[i]).split(this.regExes.comma);
                subcomponents = []; // Holds the outer ring and any inner rings (holes)
                for (j = 0; j < ring.length; j += 1) {
                    // Split on the empty space or '+' character (between coordinates)
                    var split = ring[j].split(this.regExes.spaces);
                    if (split.length > 2) {
                        //remove the elements which are blanks
                        split = split.filter(function (n) {
                            return n != ""
                        });
                    }
                    if (split.length === 2) {
                        var x_cord = split[0];
                        var y_cord = split[1];

                        //now push
                        subcomponents.push({
                            x: parseFloat(x_cord),
                            y: parseFloat(y_cord)
                        });
                    }
                }
                components.push(subcomponents);
            }
            return components;
        },

        /**
         * Return box vertices (which would become the Rectangle bounds) given a Box WKT fragment.
         * @param   str {String}    A WKT fragment representing the box
         * @memberof this.Wkt.Wkt.ingest
         * @instance
         */
        box: function (str) {
            var i, multipoints, components;

            // In our x-and-y representation of components, parsing
            //  multipoints is the same as parsing linestrings
            multipoints = this.ingest.multipoint.apply(this, [str]);

            // However, the points need to be joined
            components = [];
            for (i = 0; i < multipoints.length; i += 1) {
                components = components.concat(multipoints[i]);
            }

            return components;
        },

        /**
         * Return a multipolygon feature given a multipolygon WKT fragment.
         * @param   str {String}    A WKT fragment representing the multipolygon
         * @memberof this.Wkt.Wkt.ingest
         * @instance
         */
        multipolygon: function (str) {
            var i, components, polygon, polygons;
            components = [];
            polygons = Wkt.trim(str).split(this.regExes.doubleParenComma);
            for (i = 0; i < polygons.length; i += 1) {
                polygon = this._stripWhitespaceAndParens(polygons[i]);
                components.push(this.ingest.polygon.apply(this, [polygon]));
            }
            return components;
        },

        /**
         * Return an array of features given a geometrycollection WKT fragment.
         * @param   str {String}    A WKT fragment representing the geometry collection
         * @memberof this.Wkt.Wkt.ingest
         * @instance
         */
        geometrycollection: function (str) {
            console.log('The geometrycollection WKT type is not yet supported.');
        }

    }; // eo ingest

    return Wkt;
}));

},{}],11:[function(require,module,exports){
var jquery = window.$ = window.jQuery = require('jquery');
window.FastClick = require('fastclick');
// require('jquery-mobile');
window.mapboxgl = require('mapbox-gl');
// require('sidebar-v2/js/jquery-sidebar');
window.Wkt = require('wicket');
window.turf = require('@turf/turf');
require('@popperjs/core');
window.Tooltip = require('tooltip.js');
window.Mapillary = require('mapillary-js');
},{"@popperjs/core":1,"@turf/turf":2,"fastclick":3,"jquery":4,"mapbox-gl":5,"mapillary-js":6,"tooltip.js":9,"wicket":10}]},{},[11]);
