let trailviewToggled=!1,trailviewViewer=null,trailviewMapMarker=null,trailviewMouseOnDot=!1,trailviewLayout="desktopMap",lastMapResize=new Date,trailviewDragging=!1,trailviewDraggingMarker=void 0,trailviewMouseOverButton=!1;async function initTrailView(){const e=document.querySelector("#trailview_enable_button");if(null===e)throw new Error("trailview_enable_button id not found");const i=await fetch("https://trailview.clevelandmetroparks.com/api/health",{method:"GET"});if(200!==i.status||!0!==(await i.json()).success)return void console.warn("TrailView unable to be contacted");$("#trailview_enable_button").fadeIn(),e.addEventListener("click",()=>{toggleTrailView()});const t=document.createElement("div");t.innerHTML='<span class="cm-icon-street-view"></span>',t.classList.add("trailview-dragging-marker"),t.classList.add("trailview-dragging-marker");const a=()=>{!1===trailviewDragging&&(trailviewDragging=!0,trailviewDraggingMarker=new mapboxgl.Marker(t).setLngLat([-81.682665,41.4097766]).addTo(MAP).setRotationAlignment("map"),!1===trailviewToggled&&addTrailViewMapLayer())};e.addEventListener("mousedown",()=>{e.addEventListener("mouseleave",a),window.addEventListener("mouseup",()=>{e.removeEventListener("mouseleave",a)})}),window.addEventListener("mouseup",async()=>{await(async()=>{if(!0===trailviewDragging){if(trailviewDragging=!1,void 0!==trailviewDraggingMarker){const e=trailviewDraggingMarker.getLngLat();if(!1===trailviewToggled)toggleTrailView({latitude:e.lat,longitude:e.lng});else{const i=await fetch(`https://trailview.clevelandmetroparks.com/api/images/near?lat=${encodeURI(e.lat.toString())}&lng=${encodeURI(e.lng.toString())}`,{method:"GET"}),t=await i.json();!0===t.success&&null!==trailviewViewer&&t.data.distance<300&&trailviewViewer.goToImageID(t.data.id)}}!1===trailviewToggled&&removeTrailViewMapLayer(),void 0!==trailviewDraggingMarker&&trailviewDraggingMarker.remove()}})()});MAP.on("mousemove",e=>{!0===trailviewDragging&&void 0!==trailviewDraggingMarker&&(trailviewDraggingMarker.setLngLat(e.lngLat),MAP.getCanvas().style.cursor="grabbing")});const r=document.querySelector("#map_container");new ResizeObserver(()=>{(new Date).valueOf()-lastMapResize.valueOf()>100&&(MAP.resize(),lastMapResize=new Date)}).observe(r),r.addEventListener("transitionend",()=>{MAP.resize(),null!==trailviewMapMarker&&MAP.easeTo({center:trailviewMapMarker.getLngLat(),duration:500})}),window.addEventListener("resize",()=>{!0===trailviewToggled&&checkTrailviewResponsive()});null!==new URLSearchParams(document.location.search).get("trailview")&&toggleTrailView()}function checkTrailviewResponsive(){("desktopMap"===trailviewLayout||"desktopViewer"===trailviewLayout)&&window.innerWidth<768?changeTrailviewLayout("mobileSplit"):window.innerWidth>=768&&("mobileMap"===trailviewLayout||"mobileSplit"===trailviewLayout||"mobileViewer"===trailviewLayout)&&changeTrailviewLayout("desktopMap")}function toggleTrailView(e){if(!1===trailviewToggled){if(trailviewToggled=!0,document.querySelector("#trailview_enable_button").classList.add("trailview-button-active"),MAP.loaded()?(addTrailViewMapLayer(),createTrailviewMapMarker()):MAP.on("load",()=>{addTrailViewMapLayer(),createTrailviewMapMarker()}),$("#trailview_viewer").fadeIn(),null===trailviewViewer){const i=trailviewer.defaultBaseOptions;i.baseUrl="https://trailview.clevelandmetroparks.com";const t=new URLSearchParams(document.location.search);void 0!==e?i.initial=e:null!==t.get("trailview")?i.initial=t.get("trailview"):i.initial={latitude:MAP.getCenter().lat,longitude:MAP.getCenter().lng},i.target="trailview_viewer",trailviewViewer=new trailviewer.TrailViewerBase(i),trailviewViewer.on("image-change",e=>{null!==MAP&&null!==trailviewMapMarker&&(trailviewMapMarker.setLngLat(e.coordinates),MAP.easeTo({center:trailviewMapMarker.getLngLat(),duration:500}),setWindowURLQueryStringParameters({trailview:e.id},!1,!1))})}addTrailviewUI(),checkTrailviewResponsive(),null!==sidebar&&sidebar.close()}else{trailviewToggled=!1,document.querySelector("#trailview_enable_button").classList.remove("trailview-button-active"),changeTrailviewLayout("desktopMap"),removeTrailViewMapLayer(),$("#trailview_viewer").fadeOut(),trailviewViewer.destroy(),trailviewViewer=null;const e=new URLSearchParams(document.location.search);e.delete("trailview"),saveWindowURL(e,!1)}}function removeTrailViewMapLayer(){MAP.getSource("dots")&&(MAP.removeLayer("dots"),MAP.removeSource("dots"))}function addTrailviewUI(){{const e=document.createElement("button");e.type="button",e.id="trailview_expand_button",e.classList.add("trailview-button"),e.setAttribute("data-role","none");const i=document.createElement("span");i.classList.add("cm-icon-expand"),e.appendChild(i),document.querySelector("#trailview_viewer").appendChild(e),e.addEventListener("click",()=>{"desktopViewer"===trailviewLayout?changeTrailviewLayout("desktopMap"):"desktopMap"===trailviewLayout?changeTrailviewLayout("desktopViewer"):"mobileSplit"===trailviewLayout?changeTrailviewLayout("mobileViewer"):("mobileViewer"===trailviewLayout||"mobileMap"===trailviewLayout)&&changeTrailviewLayout("mobileSplit")})}{const e=document.createElement("button");e.type="button",e.id="trailview_close_button",e.classList.add("trailview-button"),e.setAttribute("data-role","none");const i=document.createElement("span");i.classList.add("cm-icon-close"),e.appendChild(i),document.querySelector("#trailview_viewer").appendChild(e),e.addEventListener("click",()=>{toggleTrailView()})}}function resetTrailViewClasses(){void 0!==trailviewViewer.getPanViewer()&&trailviewViewer.getPanViewer().setHfov(120,!1);const e=document.querySelector("#trailview_map_expand_button span");null!==e&&(e.classList=["cm-icon-expand"]),document.querySelector("#map_container").hidden=!1,document.querySelector("#map_container").classList.remove("trailview-map-small"),document.querySelector("#trailview_viewer").classList.remove("trailviewer-focus"),document.querySelector("#trailview_viewer").classList.remove("trailviewer-small"),document.querySelector("#map_container").classList.remove("trailview-map-split"),document.querySelector("#trailview_viewer").classList.remove("trailviewer-split"),document.querySelector("#trailview_viewer").classList.remove("trailviewer-mobile-viewer"),document.querySelector("#map_container").classList.remove("trailview-map-mobile-map"),document.querySelector("#trailview_viewer").classList.remove("trailviewer-mobile-map")}function changeTrailviewLayout(e){if(e!==trailviewLayout)if(trailviewLayout=e,resetTrailViewClasses(),"desktopViewer"===e)document.querySelector("#map_container").classList.add("trailview-map-small"),document.querySelector("#trailview_viewer").classList.add("trailviewer-focus"),document.querySelector("#trailview_expand_button span").classList=["cm-icon-compress"],document.querySelector("#map_container").addEventListener("transitionend",()=>{MAP.resize()},{once:!0}),addTrailviewMapExpandButton();else if("desktopMap"===e){document.querySelector("#trailview_viewer").classList.add("trailviewer-small"),document.querySelector("#trailview_expand_button span").classList=["cm-icon-expand"];const e=document.querySelector("#trailview_map_expand_button");null!==e&&e.remove(),MAP.resize()}else"mobileSplit"===e?(document.querySelector("#map_container").classList.add("trailview-map-split"),document.querySelector("#trailview_viewer").classList.add("trailviewer-split"),document.querySelector("#trailview_expand_button span").classList=["cm-icon-expand"],null===document.querySelector("#trailview_map_expand_button")&&addTrailviewMapExpandButton(),MAP.resize()):"mobileViewer"===e?(trailviewViewer.getPanViewer().setHfov(70),document.querySelector("#map_container").hidden=!0,document.querySelector("#trailview_viewer").classList.add("trailviewer-mobile-viewer"),document.querySelector("#trailview_expand_button span").classList=["cm-icon-compress"]):"mobileMap"===e&&(document.querySelector("#trailview_map_expand_button span").classList=["cm-icon-compress"],document.querySelector("#map_container").classList.add("trailview-map-mobile-map"),document.querySelector("#trailview_viewer").classList.add("trailviewer-mobile-map"))}function addTrailviewMapExpandButton(){const e=document.createElement("button");e.type="button",e.id="trailview_map_expand_button",e.classList.add("trailview-button"),e.setAttribute("data-role","none");const i=document.createElement("span");i.classList.add("cm-icon-expand"),e.appendChild(i),document.querySelector("#map_container").appendChild(e),e.addEventListener("click",()=>{"desktopViewer"===trailviewLayout?changeTrailviewLayout("desktopMap"):"mobileSplit"===trailviewLayout?changeTrailviewLayout("mobileMap"):"mobileMap"===trailviewLayout&&changeTrailviewLayout("mobileSplit")})}function addTrailViewMapLayer(){if(null===MAP)return;removeTrailViewMapLayer();MAP.addSource("dots",{type:"vector",format:"pbf",tiles:["https://trailview.clevelandmetroparks.com/api/tiles/{z}/{x}/{y}"]}),MAP.addLayer({id:"dots","source-layer":"geojsonLayer",source:"dots",type:"circle",paint:{"circle-radius":10,"circle-color":["case",["==",["get","public"],!0],"#00a108","#db8904"]}}),MAP.setPaintProperty("dots","circle-radius",["interpolate",["exponential",.5],["zoom"],13,3,16,5,17,7,20,8]),MAP.setPaintProperty("dots","circle-opacity",["interpolate",["exponential",.5],["zoom"],13,.05,15,.1,17,.25,20,1]),MAP.on("mouseenter","dots",()=>{trailviewMouseOnDot=!0,null!==MAP&&(MAP.getCanvas().style.cursor="pointer")}),MAP.on("mouseleave","dots",()=>{trailviewMouseOnDot=!1,null!==MAP&&(MAP.getCanvas().style.cursor="grab")}),MAP.on("mousedown",()=>{null===MAP||trailviewMouseOnDot||(MAP.getCanvas().style.cursor="grabbing")}),MAP.on("mouseup",()=>{null!==MAP&&trailviewMouseOnDot?MAP.getCanvas().style.cursor="pointer":null!==MAP&&(MAP.getCanvas().style.cursor="grab")}),MAP.on("click","dots",e=>{void 0!==e.features&&null!==e.features[0].properties?trailviewViewer.goToImageID(e.features[0].properties.imageID):console.warn("Features is undefined or properties are null")})}function createTrailviewMapMarker(){const e=document.createElement("div");e.classList.add("trailview-current-marker-wrapper");const i=document.createElement("div");i.classList.add("trailview-current-marker");const t=document.createElement("div");t.classList.add("trailview-marker-viewer"),e.appendChild(i),e.appendChild(t),trailviewMapMarker=new mapboxgl.Marker(e).setLngLat([-81.682665,41.4097766]).addTo(MAP).setRotationAlignment("map"),updateTrailViewMarkerRotation()}function updateTrailViewMarkerRotation(){if(null!==trailviewViewer&&null!==trailviewMapMarker){const e=trailviewViewer.getBearing();void 0!==e&&trailviewMapMarker.setRotation((e+225)%360)}!1!==trailviewToggled?requestAnimationFrame(updateTrailViewMarkerRotation):trailviewMapMarker.remove()}