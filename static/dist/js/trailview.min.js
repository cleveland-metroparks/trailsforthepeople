let trailviewToggled=!1,trailviewViewer=null,trailviewMapMarker=null,trailviewMouseOnDot=!1;function initTrailView(){const e=document.querySelector("#trailviewIcon");if(null===e)throw new Error("trailviewIcon id not found");e.addEventListener("click",()=>{toggleTrailView()})}function toggleTrailView(){if(!1===trailviewToggled){if(trailviewToggled=!0,addTrailViewMapLayer(),$("#trailviewViewer").fadeIn(),null===trailviewViewer){const e=trailviewer.defaultBaseOptions;e.target="trailviewViewer",trailviewViewer=new trailviewer.TrailViewerBase(e),trailviewViewer.on("image-change",e=>{null!==MAP&&null!==trailviewMapMarker&&(trailviewMapMarker.setLngLat([e.longitude,e.latitude]),MAP.easeTo({center:trailviewMapMarker.getLngLat(),duration:500}))})}addTrailViewExpandButton()}else trailviewToggled=!1,removeTrailViewMapLayer(),$("#trailviewViewer").fadeOut(),trailviewViewer.destroy(),trailviewViewer=null}function removeTrailViewMapLayer(){MAP.getSource("dots")&&(MAP.removeLayer("dots"),MAP.removeSource("dots"))}function addTrailViewExpandButton(){const e=document.createElement("button");e.type="button",e.id="trailviewExpandIcon",e.classList.add("trailview-button"),e.setAttribute("data-role","none");const r=document.createElement("span");r.classList.add("cm-icon-expand"),e.appendChild(r),document.querySelector("#trailviewViewer").appendChild(e)}function addTrailViewMapLayer(){if(null===MAP)return;removeTrailViewMapLayer();MAP.addSource("dots",{type:"vector",format:"pbf",tiles:["https://trailview.cmparks.net/api/tiles/{z}/{x}/{y}/standard"]}),MAP.addLayer({id:"dots","source-layer":"geojsonLayer",source:"dots",type:"circle",paint:{"circle-radius":10,"circle-color":["case",["==",["get","visible"],!0],"#00a108","#db8904"]}}),MAP.setPaintProperty("dots","circle-radius",["interpolate",["exponential",.5],["zoom"],13,3,16,5,17,7,20,8]),MAP.setPaintProperty("dots","circle-opacity",["interpolate",["exponential",.5],["zoom"],13,.05,15,.1,17,.25,20,1]),MAP.on("mouseenter","dots",()=>{trailviewMouseOnDot=!0,null!==MAP&&(MAP.getCanvas().style.cursor="pointer")}),MAP.on("mouseleave","dots",()=>{trailviewMouseOnDot=!1,null!==MAP&&(MAP.getCanvas().style.cursor="grab")}),MAP.on("mousedown",()=>{null===MAP||trailviewMouseOnDot||(MAP.getCanvas().style.cursor="grabbing")}),MAP.on("mouseup",()=>{null!==MAP&&trailviewMouseOnDot?MAP.getCanvas().style.cursor="pointer":null!==MAP&&(MAP.getCanvas().style.cursor="grab")}),createTrailviewMapMarker(),MAP.on("click","dots",e=>{void 0!==e.features&&null!==e.features[0].properties?trailviewViewer.goToImageID(e.features[0].properties.imageID):console.warn("Features is undefiend or properties are null")})}function createTrailviewMapMarker(){const e=document.createElement("div");e.classList.add("trailview-current-marker-wrapper");const r=document.createElement("div");r.classList.add("trailview-current-marker");const i=document.createElement("div");i.classList.add("trailview-marker-viewer"),e.appendChild(r),e.appendChild(i),trailviewMapMarker=new mapboxgl.Marker(e).setLngLat([-81.682665,41.4097766]).addTo(MAP).setRotationAlignment("map"),updateTrailViewMarkerRotation()}function updateTrailViewMarkerRotation(){if(null!==trailviewViewer&&null!==trailviewMapMarker){const e=trailviewViewer.getBearing();void 0!==e&&trailviewMapMarker.setRotation((e+225)%360)}!1!==trailviewToggled?requestAnimationFrame(updateTrailViewMarkerRotation):trailviewMapMarker.remove()}