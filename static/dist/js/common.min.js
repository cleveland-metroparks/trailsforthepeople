var ctrlGeolocate,isMobile=/Mobi/.test(navigator.userAgent),MARKER_TARGET=new mapboxgl.Marker({color:"#207FD0"}),MARKER_START=new mapboxgl.Marker({color:"#6BB03E"}),MARKER_END=new mapboxgl.Marker({color:"#FF7866"}),SKIP_TO_DIRECTIONS=!1,SETTINGS=[];function initMap(o){var a;switch(o.base||DEFAULT_LAYER){case"photo":a=STYLE_LAYER_CM_SAT;break;case"map":default:a=STYLE_LAYER_CM_MAP}MAP=new mapboxgl.Map({container:"map_canvas",style:a,center:START_CENTER,zoom:START_ZOOM,preserveDrawingBuffer:!0});var t=new mapboxgl.NavigationControl;MAP.addControl(t,"bottom-right"),ctrlGeolocate=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:0!=o.trackUserLocation}),MAP.addControl(ctrlGeolocate,"bottom-right");var e=new mapboxgl.ScaleControl({maxWidth:80,unit:"imperial"});if(MAP.addControl(e,"bottom-left"),o.lat&&o.lng&&o.zoom){var r=parseFloat(o.lat),n=parseFloat(o.lng),s=parseInt(o.zoom);MAP.setCenter([n,r]),MAP.setZoom(s),o.drop_marker&&(MAP.addLayer(MARKER_TARGET),placeMarker(MARKER_TARGET,n,r))}else MAP.fitBounds(MAX_BOUNDS);$.event.trigger({type:"mapInitialized"})}function placeMarker(o,a,t){o.setLngLat([t,a]).addTo(MAP)}function clearMarker(o){o.remove()}function showInfoPopup(o,a){switch(a){case"warning":classes="info-popup warning";break;case"error":classes="info-popup error";break;default:classes="info-popup"}new mapboxgl.Popup({closeOnClick:!1,className:classes}).setLngLat(MAP.getCenter()).setHTML(o).addTo(MAP)}function changeBasemap(o){active_layer=STYLE_LAYERS[o],MAP.on("load",()=>{MAP.setStyle(active_layer)}),!0===TRAILVIEW_ENABLED&&MAP.on("style.load",()=>{addTrailViewMapLayer()})}function getBasemap(){return style=MAP.getStyle(),STYLE_NAMES[style.name]}function formatCoords(o,a){switch(format=null!=a?a:SETTINGS.coordinate_format,format){case"ddm":return formatCoordsDdm(o);case"dd":return formatCoordsDd(o);case"dms":default:return formatCoordsDms(o)}}function formatCoordsDms(o,a){a=void 0!==a?a:0;var t=o.lat<0?"S":"N",e=o.lng<0?"W":"E";lat_dd=Math.abs(o.lat),lng_dd=Math.abs(o.lng);var r=parseInt(lat_dd),n=parseInt(60*(lat_dd-r)),s=(3600*(lat_dd-r-n/60)).toFixed(a),l=parseInt(lng_dd),d=parseInt(60*(lng_dd-l)),i=(3600*(lng_dd-l-d/60)).toFixed(a);return coordsStr=r+"째 "+n+"' "+s+'" '+t+", "+l+"째 "+d+"' "+i+'" '+e,coordsStr}function formatCoordsDdm(o,a){a=void 0!==a?a:2;var t=o.lat<0?"S":"N",e=o.lng<0?"W":"E",r=Math.abs(o.lat),n=Math.abs(o.lng),s=parseInt(r),l=(60*(r-s)).toFixed(a),d=parseInt(n),i=(60*(n-d)).toFixed(a);return coordsStr=s+"째 "+l+"' "+t+", "+d+"째 "+i+"' "+e,coordsStr}function formatCoordsDd(o,a){return a=void 0!==a?a:4,coordsStr=o.lat.toFixed(a)+", "+o.lng.toFixed(a),coordsStr}function shortenStr(o,a,t){if(o.length<=a)return o;var e=o.substr(0,o.lastIndexOf(" ",a));return t&&(e+="..."),e}function saveWindowURL(o,a){WINDOW_URL=decodeURIComponent(location.pathname+"?"+o),WINDOW_URL_QUERYSTRING=o.toString(),a?window.history.pushState(null,null,WINDOW_URL):window.history.replaceState(null,null,WINDOW_URL)}function setWindowURLQueryStringParameters(o,a,t){var e;e=a?new URLSearchParams:new URLSearchParams(location.search),$.each(o,(function(o,a){e.set(o,a)})),saveWindowURL(e,t)}SETTINGS.coordinate_format="dms";