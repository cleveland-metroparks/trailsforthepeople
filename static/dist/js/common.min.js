var ctrlGeolocate,isMobile=/Mobi/.test(navigator.userAgent),MARKER_TARGET=new mapboxgl.Marker({color:"#207FD0"}),MARKER_START=new mapboxgl.Marker({color:"#6BB03E"}),MARKER_END=new mapboxgl.Marker({color:"#FF7866"}),ELEVATION_PROFILE=null,SKIP_TO_DIRECTIONS=!1,SETTINGS=[];function initMap(a){var t;switch(a.base||"map"){case"photo":t=STYLE_LAYER_CM_SAT;break;case"map":default:t=STYLE_LAYER_CM_MAP}MAP=new mapboxgl.Map({container:"map_canvas",style:t,center:START_CENTER,zoom:START_ZOOM,preserveDrawingBuffer:!0});var e=new mapboxgl.NavigationControl;MAP.addControl(e,"bottom-right"),ctrlGeolocate=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:0!=a.trackUserLocation}),MAP.addControl(ctrlGeolocate,"bottom-right");var n=new mapboxgl.ScaleControl({maxWidth:80,unit:"imperial"});if(MAP.addControl(n,"bottom-left"),a.lat&&a.lng&&a.zoom){var r=parseFloat(a.lat),o=parseFloat(a.lng),l=parseInt(a.zoom);MAP.setCenter([o,r]),MAP.setZoom(l),a.drop_marker&&(MAP.addLayer(MARKER_TARGET),placeMarker(MARKER_TARGET,o,r))}else MAP.fitBounds(MAX_BOUNDS);$.event.trigger({type:"mapInitialized"})}function placeMarker(a,t,e){a.setLngLat([e,t]).addTo(MAP)}function clearMarker(a){a.remove()}function showInfoPopup(a,t){switch(t){case"warning":classes="info-popup warning";break;case"error":classes="info-popup error";break;default:classes="info-popup"}new mapboxgl.Popup({closeOnClick:!1,className:classes}).setLngLat(MAP.getCenter()).setHTML(a).addTo(MAP)}function changeBasemap(a){active_layer=STYLE_LAYERS[a],MAP.setStyle(active_layer)}function getBasemap(){return style=MAP.getStyle(),STYLE_NAMES[style.name]}function latlng_formatted(a,t){switch(format=null!=t?t:SETTINGS.coordinate_format,format){case"dms":return latlng_as_dms(a);case"ddm":return latlng_as_ddm(a);case"dd":return latlng_as_dd(a);default:return latlng_as_dms(a)}}function latlng_as_dms(a,t){t=void 0!==t?t:0;var e=a.lat<0?"S":"N",n=a.lng<0?"W":"E";lat_dd=Math.abs(a.lat),lng_dd=Math.abs(a.lng);var r=parseInt(lat_dd),o=parseInt(60*(lat_dd-r)),l=(3600*(lat_dd-r-o/60)).toFixed(t),s=parseInt(lng_dd),i=parseInt(60*(lng_dd-s)),d=(3600*(lng_dd-s-i/60)).toFixed(t);return latlng_str=r+"째 "+o+"' "+l+'" '+e+", "+s+"째 "+i+"' "+d+'" '+n,latlng_str}function latlng_as_ddm(a,t){t=void 0!==t?t:2;var e=a.lat<0?"S":"N",n=a.lng<0?"W":"E",r=Math.abs(a.lat),o=Math.abs(a.lng),l=parseInt(r),s=(60*(r-l)).toFixed(t),i=parseInt(o),d=(60*(o-i)).toFixed(t);return latlng_str=l+"째 "+s+"' "+e+", "+i+"째 "+d+"' "+n,latlng_str}function latlng_as_dd(a,t){return t=void 0!==t?t:4,latlng_str=a.lat.toFixed(t)+", "+a.lng.toFixed(t),latlng_str}function shortenStr(a,t,e){if(a.length<=t)return a;var n=a.substr(0,a.lastIndexOf(" ",t));return e&&(n+="..."),n}function saveWindowURL(a,t){WINDOW_URL=decodeURIComponent(location.pathname+"?"+a),WINDOW_URL_QUERYSTRING=a.toString(),t?window.history.pushState(null,null,WINDOW_URL):window.history.replaceState(null,null,WINDOW_URL)}function setWindowURLQueryStringParameters(a,t,e){var n;n=t?new URLSearchParams:new URLSearchParams(location.search),$.each(a,function(a,t){n.set(a,t)}),saveWindowURL(n,e)}SETTINGS.coordinate_format="dms";