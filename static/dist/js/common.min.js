function initMap(a){var b,c=a.base||"map";switch(c){case"photo":b=LAYER_MAPBOX_SAT;break;case"map":default:b=isMobile?LAYER_MAPBOX_MAP:LAYER_MAPBOX_GL_MAP}var d={attributionControl:!1,zoomControl:!1,dragging:!0,closePopupOnClick:!1,crs:L.CRS.EPSG3857,minZoom:MIN_ZOOM,maxZoom:MAX_ZOOM,zoomSnap:0,layers:[b]};if(navigator.userAgent.match(/Android (4|5)/)&&(d.fadeAnimation=!0,d.zoomAnimation=!0,d.markerZoomAnimation=!0),MAP=new L.Map("map_canvas",d),new L.Control.Zoom({position:"bottomright"}).addTo(MAP),a.x&&a.y&&a.z){var e=parseFloat(a.x),f=parseFloat(a.y),g=parseInt(a.z);MAP.setView(L.latLng(f,e),g),MAP.addLayer(MARKER_TARGET),MARKER_TARGET.setLatLng(L.latLng(f,e))}else MAP.fitBounds(MAX_BOUNDS);L.control.scale().addTo(MAP),$.event.trigger({type:"mapInitialized"}),MAP.on("click",function(a){if(ENABLE_MAPCLICK)return $(".leaflet-popup").length?MAP.closePopup():void wmsGetFeatureInfoByPoint(a.layerPoint)})}function lineWKTtoFeature(a,b){var c=new Wkt.Wkt;return c.read(a),c.toObject(b)}function placeTargetMarker(a,b){MAP.addLayer(MARKER_TARGET),MARKER_TARGET.setLatLng(L.latLng(a,b))}function clearTargetMarker(){MAP.hasLayer(MARKER_TARGET)&&MAP.removeLayer(MARKER_TARGET)}function placeGPSMarker(a,b){MAP.addLayer(MARKER_GPS),MARKER_GPS.setLatLng(L.latLng(a,b))}function clearGPSMarker(){MAP.removeLayer(MARKER_GPS)}function showInfoPopup(a,b){switch(MAP.removeLayer(INFO_POPUP),b){case"warning":classes="info-popup warning";break;case"error":classes="info-popup error";break;default:classes="info-popup"}INFO_POPUP=L.popup({className:classes}).setLatLng(MAP.getCenter()).setContent(a).openOn(MAP)}function clearInfoPopup(){MAP.removeLayer(INFO_POPUP),INFO_POPUP.options.className}function wmsGetFeatureInfoByPoint(a){var b=MAP.layerPointToLatLng(new L.Point(a.x-20,a.y+20)),c=MAP.layerPointToLatLng(new L.Point(a.x+20,a.y-20));wmsGetFeatureInfoByLatLngBBOX({w:b.lng,s:b.lat,e:c.lng,n:c.lat},MAP.layerPointToLatLng(new L.Point(a.x,a.y)))}function wmsGetFeatureInfoByLatLng(a){wmsGetFeatureInfoByLatLngBBOX({w:a.lng,s:a.lat,e:a.lng,n:a.lat},a)}function wmsGetFeatureInfoByLatLngBBOX(a,b){var c=a;c.zoom=MAP.getZoom(),$.get(API_BASEPATH+"ajax/query",c,function(a){if(a){var c={};c.maxHeight=parseInt($("#map_canvas").height()),c.maxWidth=parseInt($("#map_canvas").width());var d=new L.Popup(c);d.setLatLng(b),d.setContent(a),MAP.openPopup(d)}},"html")}function changeBasemap(a){for("map"==a&&(isMobile||(a="vector")),new_active_layer=AVAILABLE_LAYERS[a],i=0;i<ALL_LAYERS.length;i++)ALL_LAYERS[i]==new_active_layer?(MAP.hasLayer(ALL_LAYERS[i])||MAP.addLayer(ALL_LAYERS[i],!0),"vector"!=a&&new_active_layer.bringToBack()):MAP.hasLayer(ALL_LAYERS[i])&&MAP.removeLayer(ALL_LAYERS[i])}function latlng_formatted(a,b){switch(format=null!=b?b:SETTINGS.coordinate_format,format){case"dms":return latlng_as_dms(a);case"ddm":return latlng_as_ddm(a);case"dd":return latlng_as_dd(a);default:return latlng_as_dms(a)}}function latlng_as_dms(a,b){b=void 0!==b?b:0;var c=a.lat<0?"S":"N",d=a.lng<0?"W":"E";lat_dd=Math.abs(a.lat),lng_dd=Math.abs(a.lng);var e=parseInt(lat_dd),f=parseInt(60*(lat_dd-e)),g=(3600*(lat_dd-e-f/60)).toFixed(b),h=parseInt(lng_dd),i=parseInt(60*(lng_dd-h)),j=(3600*(lng_dd-h-i/60)).toFixed(b);return latlng_str=e+"째 "+f+"' "+g+'" '+c+", "+h+"째 "+i+"' "+j+'" '+d,latlng_str}function latlng_as_ddm(a,b){b=void 0!==b?b:2;var c=a.lat<0?"S":"N",d=a.lng<0?"W":"E",e=Math.abs(a.lat),f=Math.abs(a.lng),g=parseInt(e),h=(60*(e-g)).toFixed(b),i=parseInt(f),j=(60*(f-i)).toFixed(b);return latlng_str=g+"째 "+h+"' "+c+", "+i+"째 "+j+"' "+d,latlng_str}function latlng_as_dd(a,b){return b=void 0!==b?b:4,latlng_str=a.lat.toFixed(b)+", "+a.lng.toFixed(b),latlng_str}var isMobile=/Mobi/.test(navigator.userAgent),ICON_TARGET=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/marker-target.png",iconSize:[25,41],iconAnchor:[13,41],popupAnchor:[0,-41]}),MARKER_TARGET=L.marker(L.latLng(0,0),{clickable:!1,draggable:!1,icon:ICON_TARGET}),ICON_GPS=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/marker-gps.svg",iconSize:[25,41],iconAnchor:[13,41],popupAnchor:[0,-41]}),MARKER_GPS=L.marker(L.latLng(0,0),{clickable:!1,draggable:!1,icon:ICON_GPS}),ICON_FROM=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/measure1.png",iconSize:[20,34],iconAnchor:[10,34]}),ICON_TO=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/measure2.png",iconSize:[20,34],iconAnchor:[10,34]}),MARKER_FROM=L.marker(L.latLng(0,0),{clickable:!0,draggable:!0,icon:ICON_FROM}),MARKER_TO=L.marker(L.latLng(0,0),{clickable:!0,draggable:!0,icon:ICON_TO}),INFO_POPUP_OPTIONS={className:"info-popup"},INFO_POPUP=L.popup(INFO_POPUP_OPTIONS),CIRCLE=new L.Circle(L.latLng(0,0),1),ELEVATION_PROFILE=null,HIGHLIGHT_LINE=null,HIGHLIGHT_LINE_STYLE={color:"#1F6ABD",weight:3,opacity:.75,clickable:!1,smoothFactor:.25},ENABLE_MAPCLICK=!0,SKIP_TO_DIRECTIONS=!1,SETTINGS=[];SETTINGS.coordinate_format="dms";