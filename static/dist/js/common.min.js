var isMobile=/Mobi/.test(navigator.userAgent),ICON_TARGET=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/marker-target.png",iconSize:[25,41],iconAnchor:[13,41],popupAnchor:[0,-41]}),MARKER_TARGET=L.marker(L.latLng(0,0),{clickable:!1,draggable:!1,icon:ICON_TARGET}),ICON_GPS=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/marker-gps.svg",iconSize:[25,41],iconAnchor:[13,41],popupAnchor:[0,-41]}),MARKER_GPS=L.marker(L.latLng(0,0),{clickable:!1,draggable:!1,icon:ICON_GPS}),ICON_FROM=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/measure1.png",iconSize:[20,34],iconAnchor:[10,34]}),ICON_TO=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/measure2.png",iconSize:[20,34],iconAnchor:[10,34]}),MARKER_FROM=L.marker(L.latLng(0,0),{clickable:!0,draggable:!0,icon:ICON_FROM}),MARKER_TO=L.marker(L.latLng(0,0),{clickable:!0,draggable:!0,icon:ICON_TO}),INFO_POPUP_OPTIONS={className:"info-popup"},INFO_POPUP=L.popup(INFO_POPUP_OPTIONS),CIRCLE=new L.Circle(L.latLng(0,0),1),ELEVATION_PROFILE=null,HIGHLIGHT_LINE=null,HIGHLIGHT_LINE_STYLE={color:"#01B3FD",weight:6,opacity:.75,clickable:!1,smoothFactor:.25},ENABLE_MAPCLICK=!0,SKIP_TO_DIRECTIONS=!1,SETTINGS=[];function initMap(a){var e;switch(a.base||"map"){case"photo":e=LAYER_MAPBOX_SAT;break;case"map":default:e=isMobile?LAYER_MAPBOX_MAP:LAYER_MAPBOX_GL_MAP}var t={attributionControl:!1,zoomControl:!1,dragging:!0,closePopupOnClick:!1,crs:L.CRS.EPSG3857,minZoom:MIN_ZOOM,maxZoom:MAX_ZOOM,zoomSnap:0,layers:[e]};if(navigator.userAgent.match(/Android (4|5)/)&&(t.fadeAnimation=!0,t.zoomAnimation=!0,t.markerZoomAnimation=!0),MAP=new L.Map("map_canvas",t),new L.Control.Zoom({position:"bottomright"}).addTo(MAP),a.lat&&a.lng&&a.zoom){var n=parseFloat(a.lat),r=parseFloat(a.lng),o=parseInt(a.zoom);MAP.setView(L.latLng(n,r),o),a.drop_marker&&(MAP.addLayer(MARKER_TARGET),MARKER_TARGET.setLatLng(L.latLng(n,r)))}else MAP.fitBounds(MAX_BOUNDS);L.control.scale().addTo(MAP),$.event.trigger({type:"mapInitialized"})}function lineWKTtoFeature(a,e){var t=new Wkt.Wkt;return t.read(a),t.toObject(e)}function placeTargetMarker(a,e){MAP.addLayer(MARKER_TARGET),MARKER_TARGET.setLatLng(L.latLng(a,e))}function clearTargetMarker(){MAP.hasLayer(MARKER_TARGET)&&MAP.removeLayer(MARKER_TARGET)}function placeGPSMarker(a,e){MAP.addLayer(MARKER_GPS),MARKER_GPS.setLatLng(L.latLng(a,e))}function clearGPSMarker(){MAP.removeLayer(MARKER_GPS)}function showInfoPopup(a,e){switch(MAP.removeLayer(INFO_POPUP),e){case"warning":classes="info-popup warning";break;case"error":classes="info-popup error";break;default:classes="info-popup"}INFO_POPUP=L.popup({className:classes}).setLatLng(MAP.getCenter()).setContent(a).openOn(MAP)}function changeBasemap(a){for("map"==a&&(isMobile||(a="vector")),new_active_layer=AVAILABLE_LAYERS[a],i=0;i<ALL_LAYERS.length;i++)ALL_LAYERS[i]==new_active_layer?(MAP.hasLayer(ALL_LAYERS[i])||MAP.addLayer(ALL_LAYERS[i],!0),"vector"!=a&&new_active_layer.bringToBack()):MAP.hasLayer(ALL_LAYERS[i])&&MAP.removeLayer(ALL_LAYERS[i])}function latlng_formatted(a,e){switch(format=null!=e?e:SETTINGS.coordinate_format,format){case"dms":return latlng_as_dms(a);case"ddm":return latlng_as_ddm(a);case"dd":return latlng_as_dd(a);default:return latlng_as_dms(a)}}function latlng_as_dms(a,e){e=void 0!==e?e:0;var t=a.lat<0?"S":"N",n=a.lng<0?"W":"E";lat_dd=Math.abs(a.lat),lng_dd=Math.abs(a.lng);var r=parseInt(lat_dd),o=parseInt(60*(lat_dd-r)),i=(3600*(lat_dd-r-o/60)).toFixed(e),l=parseInt(lng_dd),s=parseInt(60*(lng_dd-l)),_=(3600*(lng_dd-l-s/60)).toFixed(e);return latlng_str=r+"째 "+o+"' "+i+'" '+t+", "+l+"째 "+s+"' "+_+'" '+n,latlng_str}function latlng_as_ddm(a,e){e=void 0!==e?e:2;var t=a.lat<0?"S":"N",n=a.lng<0?"W":"E",r=Math.abs(a.lat),o=Math.abs(a.lng),i=parseInt(r),l=(60*(r-i)).toFixed(e),s=parseInt(o),_=(60*(o-s)).toFixed(e);return latlng_str=i+"째 "+l+"' "+t+", "+s+"째 "+_+"' "+n,latlng_str}function latlng_as_dd(a,e){return e=void 0!==e?e:4,latlng_str=a.lat.toFixed(e)+", "+a.lng.toFixed(e),latlng_str}SETTINGS.coordinate_format="dms";