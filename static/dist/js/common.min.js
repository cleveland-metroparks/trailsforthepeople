var ctrlGeolocate,isMobile=/Mobi/.test(navigator.userAgent),MARKER_TARGET=new mapboxgl.Marker({color:"#207FD0"}),MARKER_START=new mapboxgl.Marker({color:"#6BB03E"}),MARKER_END=new mapboxgl.Marker({color:"#FF7866"}),ELEVATION_PROFILE=null,SKIP_TO_DIRECTIONS=!1,SETTINGS=[];function initMap(t){var a;switch(t.base||"map"){case"photo":a=STYLE_LAYER_CM_SAT;break;case"map":default:a=STYLE_LAYER_CM_MAP}console.log("pre map"),MAP=new mapboxgl.Map({container:"map_canvas",style:a,center:START_CENTER,zoom:START_ZOOM}),console.log("post map");var e=new mapboxgl.NavigationControl;MAP.addControl(e,"bottom-right"),ctrlGeolocate=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),MAP.addControl(ctrlGeolocate,"bottom-right");var o=new mapboxgl.ScaleControl({maxWidth:80,unit:"imperial"});if(MAP.addControl(o,"bottom-left"),t.lat&&t.lng&&t.zoom){var n=parseFloat(t.lat),l=parseFloat(t.lng),r=parseInt(t.zoom);MAP.setCenter([l,n]),MAP.setZoom(r),t.drop_marker&&(MAP.addLayer(MARKER_TARGET),placeMarker(MARKER_TARGET,l,n))}else MAP.fitBounds(MAX_BOUNDS);$.event.trigger({type:"mapInitialized"})}function placeMarker(t,a,e){t.setLngLat([e,a]).addTo(MAP)}function clearMarker(t){t.remove()}function showInfoPopup(t,a){switch(a){case"warning":classes="info-popup warning";break;case"error":classes="info-popup error";break;default:classes="info-popup"}new mapboxgl.Popup({closeOnClick:!1,className:classes}).setLngLat(MAP.getCenter()).setHTML(t).addTo(MAP)}function changeBasemap(t){active_layer=STYLE_LAYERS[t],MAP.setStyle(active_layer)}function getBasemap(){return style=MAP.getStyle(),STYLE_NAMES[style.name]}function latlng_formatted(t,a){switch(format=null!=a?a:SETTINGS.coordinate_format,format){case"dms":return latlng_as_dms(t);case"ddm":return latlng_as_ddm(t);case"dd":return latlng_as_dd(t);default:return latlng_as_dms(t)}}function latlng_as_dms(t,a){a=void 0!==a?a:0;var e=t.lat<0?"S":"N",o=t.lng<0?"W":"E";lat_dd=Math.abs(t.lat),lng_dd=Math.abs(t.lng);var n=parseInt(lat_dd),l=parseInt(60*(lat_dd-n)),r=(3600*(lat_dd-n-l/60)).toFixed(a),s=parseInt(lng_dd),d=parseInt(60*(lng_dd-s)),i=(3600*(lng_dd-s-d/60)).toFixed(a);return latlng_str=n+"째 "+l+"' "+r+'" '+e+", "+s+"째 "+d+"' "+i+'" '+o,latlng_str}function latlng_as_ddm(t,a){a=void 0!==a?a:2;var e=t.lat<0?"S":"N",o=t.lng<0?"W":"E",n=Math.abs(t.lat),l=Math.abs(t.lng),r=parseInt(n),s=(60*(n-r)).toFixed(a),d=parseInt(l),i=(60*(l-d)).toFixed(a);return latlng_str=r+"째 "+s+"' "+e+", "+d+"째 "+i+"' "+o,latlng_str}function latlng_as_dd(t,a){return a=void 0!==a?a:4,latlng_str=t.lat.toFixed(a)+", "+t.lng.toFixed(a),latlng_str}function boundsContain(t,a){var e=turf.point(a.toArray()),o=t.toArray().flat(),n=turf.bboxPolygon(o);return 1==turf.pointsWithinPolygon(e,n).features.length}SETTINGS.coordinate_format="dms";