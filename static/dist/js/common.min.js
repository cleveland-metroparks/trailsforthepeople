function initMap(a){var b,c=a.base||"map";switch(c){case"photo":b=LAYER_MAPBOX_SAT;break;case"map":default:b=isMobile?LAYER_MAPBOX_MAP:LAYER_MAPBOX_GL_MAP}var d={attributionControl:!1,zoomControl:!1,dragging:!0,closePopupOnClick:!1,crs:L.CRS.EPSG3857,minZoom:MIN_ZOOM,maxZoom:MAX_ZOOM,zoomSnap:0,layers:[b]},e=navigator.userAgent.match(/Android (4|5)/);if(e&&(d.fadeAnimation=!0,d.zoomAnimation=!0,d.markerZoomAnimation=!0),MAP=new L.Map("map_canvas",d),new L.Control.Zoom({position:"bottomright"}).addTo(MAP),a.x&&a.y&&a.z){var f=parseFloat(a.x),g=parseFloat(a.y),h=parseInt(a.z);MAP.setView(L.latLng(g,f),h),MAP.addLayer(MARKER_TARGET),MARKER_TARGET.setLatLng(L.latLng(g,f))}else MAP.fitBounds(MAX_BOUNDS);L.control.scale().addTo(MAP),$.event.trigger({type:"mapInitialized"}),MAP.on("click",function(a){if(ENABLE_MAPCLICK)return $(".leaflet-popup").length?MAP.closePopup():void wmsGetFeatureInfoByPoint(a.layerPoint)})}function lineWKTtoFeature(a,b){var c=new Wkt.Wkt;return c.read(a),c.toObject(b)}function placeTargetMarker(a,b){MAP.addLayer(MARKER_TARGET),MARKER_TARGET.setLatLng(L.latLng(a,b))}function clearTargetMarker(){MAP.removeLayer(MARKER_TARGET)}function placeGPSMarker(a,b){MAP.addLayer(MARKER_GPS),MARKER_GPS.setLatLng(L.latLng(a,b))}function clearGPSMarker(){MAP.removeLayer(MARKER_GPS)}function showInfoPopup(a,b){switch(MAP.removeLayer(INFO_POPUP),b){case"warning":classes="info-popup warning";break;case"error":classes="info-popup error";break;default:classes="info-popup"}INFO_POPUP=L.popup({className:classes}).setLatLng(MAP.getCenter()).setContent(a).openOn(MAP)}function clearInfoPopup(){MAP.removeLayer(INFO_POPUP),INFO_POPUP.options.className}function wmsGetFeatureInfoByPoint(a){var b=20,c=MAP.layerPointToLatLng(new L.Point(a.x-b,a.y+b)),d=MAP.layerPointToLatLng(new L.Point(a.x+b,a.y-b)),e={w:c.lng,s:c.lat,e:d.lng,n:d.lat},f=MAP.layerPointToLatLng(new L.Point(a.x,a.y));wmsGetFeatureInfoByLatLngBBOX(e,f)}function wmsGetFeatureInfoByLatLng(a){var b={w:a.lng,s:a.lat,e:a.lng,n:a.lat},c=a;wmsGetFeatureInfoByLatLngBBOX(b,c)}function wmsGetFeatureInfoByLatLngBBOX(a,b){var c=a;c.zoom=MAP.getZoom(),$.get(API_BASEPATH+"ajax/query",c,function(a){if(a){var c={};c.maxHeight=parseInt($("#map_canvas").height()),c.maxWidth=parseInt($("#map_canvas").width());var d=new L.Popup(c);d.setLatLng(b),d.setContent(a),MAP.openPopup(d)}},"html")}function changeBasemap(a){for("map"==a&&(isMobile||(a="vector")),new_active_layer=AVAILABLE_LAYERS[a],i=0;i<ALL_LAYERS.length;i++)ALL_LAYERS[i]==new_active_layer?(MAP.hasLayer(ALL_LAYERS[i])||MAP.addLayer(ALL_LAYERS[i],!0),"vector"!=a&&new_active_layer.bringToBack()):MAP.hasLayer(ALL_LAYERS[i])&&MAP.removeLayer(ALL_LAYERS[i])}var MOBILE,isMobile=/Mobi/.test(navigator.userAgent),ICON_TARGET=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/marker-target.png",iconSize:[25,41],iconAnchor:[13,41],popupAnchor:[0,-41]}),MARKER_TARGET=L.marker(L.latLng(0,0),{clickable:!1,draggable:!1,icon:ICON_TARGET}),ICON_GPS=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/marker-gps.png",iconSize:[25,41],iconAnchor:[13,41],popupAnchor:[0,-41]}),MARKER_GPS=L.marker(L.latLng(0,0),{clickable:!1,draggable:!1,icon:ICON_GPS}),ICON_FROM=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/measure1.png",iconSize:[20,34],iconAnchor:[10,34]}),ICON_TO=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/measure2.png",iconSize:[20,34],iconAnchor:[10,34]}),MARKER_FROM=L.marker(L.latLng(0,0),{clickable:!0,draggable:!0,icon:ICON_FROM}),MARKER_TO=L.marker(L.latLng(0,0),{clickable:!0,draggable:!0,icon:ICON_TO}),INFO_POPUP_OPTIONS={className:"info-popup"},INFO_POPUP=L.popup(INFO_POPUP_OPTIONS),CIRCLE=new L.Circle(L.latLng(0,0),1),ELEVATION_PROFILE=null,HIGHLIGHT_LINE=null,HIGHLIGHT_LINE_STYLE={color:"#FF00FF",weight:3,opacity:.75,clickable:!1,smoothFactor:.25},ENABLE_MAPCLICK=!0,SKIP_TO_DIRECTIONS=!1;