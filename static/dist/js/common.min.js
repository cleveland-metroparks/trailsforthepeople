var isMobile=/Mobi/.test(navigator.userAgent),markerTargetEl=document.createElement("div");markerTargetEl.id="marker-target";var markerTargetIconWidth=25,markerTargetIconHeight=41,MARKER_TARGET=new mapboxgl.Marker(markerTargetEl,{offset:[-markerTargetIconWidth/2,-markerTargetIconHeight]}),markerGpsEl=document.createElement("div");markerGpsEl.id="marker-gps";var markerGpsIconSize=16,MARKER_GPS=new mapboxgl.Marker(markerGpsEl,{offset:[-markerGpsIconSize/2,-markerGpsIconSize/2]}),markerFromEl=document.createElement("div");markerFromEl.id="marker-from";var markerFromIconWidth=20,markerFromIconHeight=34,MARKER_FROM=new mapboxgl.Marker(markerFromEl,{offset:[-markerFromIconWidth/2,-markerFromIconHeight]}),markerToEl=document.createElement("div");markerToEl.id="marker-to";var ctrlGeolocate,markerToIconWidth=20,markerToIconHeight=34,MARKER_TO=new mapboxgl.Marker(markerToEl,{offset:[-markerToIconWidth/2,-markerToIconHeight]}),ELEVATION_PROFILE=null,HIGHLIGHT_LINE=null,HIGHLIGHT_LINE_STYLE={color:"#01B3FD",weight:6,opacity:.75,clickable:!1,smoothFactor:.25},ENABLE_MAPCLICK=!0,SKIP_TO_DIRECTIONS=!1,SETTINGS=[];function initMap(e){var a;switch(e.base||"map"){case"photo":a=STYLE_LAYER_CM_SAT;break;case"map":default:a=STYLE_LAYER_CM_MAP}MAP=new mapboxgl.Map({container:"map_canvas",style:a,center:[START_LON,START_LAT],zoom:START_ZOOM});var r=new mapboxgl.NavigationControl;MAP.addControl(r,"bottom-right"),ctrlGeolocate=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),MAP.addControl(ctrlGeolocate,"bottom-right");var t=new mapboxgl.ScaleControl({maxWidth:80,unit:"imperial"});if(MAP.addControl(t,"bottom-left"),e.lat&&e.lng&&e.zoom){var o=parseFloat(e.lat),n=parseFloat(e.lng),l=parseInt(e.zoom);MAP.setCenter([n,o]),MAP.setZoom(l),e.drop_marker&&(MAP.addLayer(MARKER_TARGET),placeMarker(MARKER_TARGET,n,o))}else MAP.fitBounds(MAX_BOUNDS);$.event.trigger({type:"mapInitialized"})}function lineWKTtoFeature(e,a){var r=new Wkt.Wkt;return r.read(e),r.toObject(a)}function placeTargetMarker(e,a){MARKER_TARGET.setLngLat([a,e]).addTo(MAP)}function clearTargetMarker(){MARKER_TARGET.remove()}function placeGPSMarker(e,a){MARKER_GPS.setLngLat([a,e]).addTo(MAP)}function clearGPSMarker(){MARKER_GPS.remove()}function showInfoPopup(e,a){switch(a){case"warning":classes="info-popup warning";break;case"error":classes="info-popup error";break;default:classes="info-popup"}new mapboxgl.Popup({closeOnClick:!1,className:classes}).setLngLat(MAP.getCenter()).setHTML(e).addTo(MAP)}function changeBasemap(e){active_layer=STYLE_LAYERS[e],MAP.setStyle(active_layer)}function getBasemap(){return style=MAP.getStyle(),STYLE_NAMES[style.name]}function latlng_formatted(e,a){switch(format=null!=a?a:SETTINGS.coordinate_format,format){case"dms":return latlng_as_dms(e);case"ddm":return latlng_as_ddm(e);case"dd":return latlng_as_dd(e);default:return latlng_as_dms(e)}}function latlng_as_dms(e,a){a=void 0!==a?a:0;var r=e.lat<0?"S":"N",t=e.lng<0?"W":"E";lat_dd=Math.abs(e.lat),lng_dd=Math.abs(e.lng);var o=parseInt(lat_dd),n=parseInt(60*(lat_dd-o)),l=(3600*(lat_dd-o-n/60)).toFixed(a),s=parseInt(lng_dd),m=parseInt(60*(lng_dd-s)),i=(3600*(lng_dd-s-m/60)).toFixed(a);return latlng_str=o+"째 "+n+"' "+l+'" '+r+", "+s+"째 "+m+"' "+i+'" '+t,latlng_str}function latlng_as_ddm(e,a){a=void 0!==a?a:2;var r=e.lat<0?"S":"N",t=e.lng<0?"W":"E",o=Math.abs(e.lat),n=Math.abs(e.lng),l=parseInt(o),s=(60*(o-l)).toFixed(a),m=parseInt(n),i=(60*(n-m)).toFixed(a);return latlng_str=l+"째 "+s+"' "+r+", "+m+"째 "+i+"' "+t,latlng_str}function latlng_as_dd(e,a){return a=void 0!==a?a:4,latlng_str=e.lat.toFixed(a)+", "+e.lng.toFixed(a),latlng_str}SETTINGS.coordinate_format="dms";