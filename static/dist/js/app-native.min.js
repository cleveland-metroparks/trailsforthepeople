var WEBAPP_BASEPATH="/",API_BASEPATH="/",MAP=null,WEBAPP_BASE_URL_ABSOLUTE_PROTOCOL="https",WEBAPP_BASE_URL_ABSOLUTE_HOST="maps.clevelandmetroparks.com",WEBAPP_BASE_URL_ABSOLUTE=WEBAPP_BASE_URL_ABSOLUTE_PROTOCOL+"://"+WEBAPP_BASE_URL_ABSOLUTE_HOST+"/",NATIVE_APP=!1,MAX_BOUND_SW=new mapboxgl.LngLat(-82.08504,41.11816),MAX_BOUND_NE=new mapboxgl.LngLat(-81.28029,41.70009),MAX_BOUNDS=new mapboxgl.LngLatBounds(MAX_BOUND_SW,MAX_BOUND_NE),DEFAULT_POI_ZOOM=15,GEOCODE_BIAS_BOX="41.202048178648, -81.9627793163304, 41.5885467839419, -81.386224018357",PRINT_URL="/pdf/create.json",PRINT_PICKUP_BASEURL="/pdf/",BING_API_KEY="AjBuYw8goYn_CWiqk65Rbf_Cm-j1QFPH-gGfOxjBipxuEB2N3n9yACKu5s8Dl18N",PRINT_SIZES={"Letter portrait":[580,714],"Letter landscape":[762,526],"Ledger portrait":[744,1126],"Ledger landscape":[1178,690]},START_LAT=41.3953,START_LON=-81.673,START_ZOOM=14;mapboxgl.accessToken="pk.eyJ1IjoiY2xldmVsYW5kLW1ldHJvcGFya3MiLCJhIjoiWHRKaDhuRSJ9.FGqNSOHwiCr2dmTH2JTMAA";var STYLE_LAYER_CM_MAP="mapbox://styles/cleveland-metroparks/cisvvmgwe00112xlk4jnmrehn",STYLE_LAYER_CM_SAT="mapbox://styles/cleveland-metroparks/cjcutetjg07892ro6wunp2da9",STYLE_LAYERS={map:STYLE_LAYER_CM_MAP,photo:STYLE_LAYER_CM_SAT},STYLE_NAMES={"CM Light":"map","CM-Aerial":"photo"};API_BASEPATH="https://maps.clevelandmetroparks.com/",NATIVE_APP=!(WEBAPP_BASEPATH="");var isMobile=/Mobi/.test(navigator.userAgent),markerTargetEl=document.createElement("div");markerTargetEl.id="marker-target";var markerTargetIconWidth=25,markerTargetIconHeight=41,MARKER_TARGET=new mapboxgl.Marker(markerTargetEl,{offset:[-markerTargetIconWidth/2,-markerTargetIconHeight]}),markerGpsEl=document.createElement("div");markerGpsEl.id="marker-gps";var markerGpsIconSize=16,MARKER_GPS=new mapboxgl.Marker(markerGpsEl,{offset:[-markerGpsIconSize/2,-markerGpsIconSize/2]}),markerFromEl=document.createElement("div");markerFromEl.id="marker-from";var markerFromIconWidth=20,markerFromIconHeight=34,MARKER_FROM=new mapboxgl.Marker(markerFromEl,{offset:[-markerFromIconWidth/2,-markerFromIconHeight]}),markerToEl=document.createElement("div");markerToEl.id="marker-to";var ctrlGeolocate,markerToIconWidth=20,markerToIconHeight=34,MARKER_TO=new mapboxgl.Marker(markerToEl,{offset:[-markerToIconWidth/2,-markerToIconHeight]}),ELEVATION_PROFILE=null,HIGHLIGHT_LINE=null,HIGHLIGHT_LINE_STYLE={color:"#01B3FD",weight:6,opacity:.75,clickable:!1,smoothFactor:.25},ENABLE_MAPCLICK=!0,SKIP_TO_DIRECTIONS=!1,SETTINGS=[];function initMap(e){var t;switch(e.base||"map"){case"photo":t=STYLE_LAYER_CM_SAT;break;case"map":default:t=STYLE_LAYER_CM_MAP}MAP=new mapboxgl.Map({container:"map_canvas",style:t,center:[START_LON,START_LAT],zoom:START_ZOOM});var a=new mapboxgl.NavigationControl;MAP.addControl(a,"bottom-right"),ctrlGeolocate=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),MAP.addControl(ctrlGeolocate,"bottom-right");var n=new mapboxgl.ScaleControl({maxWidth:80,unit:"imperial"});if(MAP.addControl(n,"bottom-left"),e.lat&&e.lng&&e.zoom){var r=parseFloat(e.lat),i=parseFloat(e.lng),o=parseInt(e.zoom);MAP.setCenter([i,r]),MAP.setZoom(o),e.drop_marker&&(MAP.addLayer(MARKER_TARGET),placeMarker(MARKER_TARGET,i,r))}else MAP.fitBounds(MAX_BOUNDS);$.event.trigger({type:"mapInitialized"})}function lineWKTtoFeature(e,t){var a=new Wkt.Wkt;return a.read(e),a.toObject(t)}function placeTargetMarker(e,t){MARKER_TARGET.setLngLat([t,e]).addTo(MAP)}function clearTargetMarker(){MARKER_TARGET.remove()}function placeGPSMarker(e,t){MARKER_GPS.setLngLat([t,e]).addTo(MAP)}function clearGPSMarker(){MARKER_GPS.remove()}function showInfoPopup(e,t){switch(t){case"warning":classes="info-popup warning";break;case"error":classes="info-popup error";break;default:classes="info-popup"}new mapboxgl.Popup({closeOnClick:!1,className:classes}).setLngLat(MAP.getCenter()).setHTML(e).addTo(MAP)}function changeBasemap(e){active_layer=STYLE_LAYERS[e],MAP.setStyle(active_layer)}function getBasemap(){return style=MAP.getStyle(),STYLE_NAMES[style.name]}function latlng_formatted(e,t){switch(format=null!=t?t:SETTINGS.coordinate_format,format){case"dms":return latlng_as_dms(e);case"ddm":return latlng_as_ddm(e);case"dd":return latlng_as_dd(e);default:return latlng_as_dms(e)}}function latlng_as_dms(e,t){t=void 0!==t?t:0;var a=e.lat<0?"S":"N",n=e.lng<0?"W":"E";lat_dd=Math.abs(e.lat),lng_dd=Math.abs(e.lng);var r=parseInt(lat_dd),i=parseInt(60*(lat_dd-r)),o=(3600*(lat_dd-r-i/60)).toFixed(t),s=parseInt(lng_dd),l=parseInt(60*(lng_dd-s)),c=(3600*(lng_dd-s-l/60)).toFixed(t);return latlng_str=r+"째 "+i+"' "+o+'" '+a+", "+s+"째 "+l+"' "+c+'" '+n,latlng_str}function latlng_as_ddm(e,t){t=void 0!==t?t:2;var a=e.lat<0?"S":"N",n=e.lng<0?"W":"E",r=Math.abs(e.lat),i=Math.abs(e.lng),o=parseInt(r),s=(60*(r-o)).toFixed(t),l=parseInt(i),c=(60*(i-l)).toFixed(t);return latlng_str=o+"째 "+s+"' "+a+", "+l+"째 "+c+"' "+n,latlng_str}function latlng_as_dd(e,t){return t=void 0!==t?t:4,latlng_str=e.lat.toFixed(t)+", "+e.lng.toFixed(t),latlng_str}SETTINGS.coordinate_format="dms";var WINDOW_URL=null,sidebar=null,LAST_BEEP_IDS=[],LAST_KNOWN_LOCATION=L.latLng(41.3953,-81.673),AUTO_CENTER_ON_LOCATION=!1,DEFAULT_SORT="distance",URL_PARAMS=null;function createStartHereTooltip(){var e=$(".sidebar-tabs ul li:first")[0],t=$("body > div.ui-page")[0];return new Tooltip(e,{title:"Start exploring here!",container:t,placement:"right",trigger:"manual"})}function disableClicksMomentarily(){}function disableClicks(){MAP&&(ENABLE_MAPCLICK=!1,MAP.dragging.removeHooks(),MAP.touchZoom.removeHooks())}function enableClicks(){MAP&&(ENABLE_MAPCLICK=!0,MAP.dragging.addHooks(),MAP.touchZoom.addHooks())}function switchToMap(e){sidebarCoversMap()&&sidebar.close(),e&&setTimeout(e,0)}function showPhoto(e){$("#photo").prop("src",e),sidebar.open("pane-photo")}function showElevation(e){$("#elevation").prop("src",e),sidebar.open("pane-elevationprofile")}function showAttractionInfo(e,t){if($("#directions_target_lat").val(t.lat),$("#directions_target_lng").val(t.lng),$("#directions_target_type").val(t.type),$("#directions_target_gid").val(t.gid),$("#directions_target_title").text(t.title),sidebar.open("pane-info"),set_pane_back_button("#pane-info","#pane-browse"),$("#getdirections_disabled").hide(),$("#getdirections_enabled").show(),$("#show_on_map").data("wkt",null),$("#info-content").text("Loading..."),t.gid||t.record_id){var a={};a.type=e,a.gid=t.gid||t.record_id,$.get(API_BASEPATH+"ajax/moreinfo",a,function(e){$("#info-content").html(e)},"html")}}function zoomElementClick(e){if(ENABLE_MAPCLICK){disableClicksMomentarily();var t=e.attr("type"),a=e.attr("gid");"reservation_new"==t&&(a=e.attr("record_id")),$("#show_on_map").data("zoomelement",e),$("#directions_target_lat").val(e.attr("lat")),$("#directions_target_lng").val(e.attr("lng")),$("#directions_target_type").val(e.attr("type")),$("#directions_target_gid").val(e.attr("gid")),$("#directions_target_title").text(e.attr("title")),sidebar.open("pane-info");var n=e.attr("backbutton");if(n=n||"#pane-browse",set_pane_back_button("#pane-info",n),$("#getdirections_disabled").hide(),$("#getdirections_enabled").show(),$("#show_on_map").data("wkt",null),$("#info-content").text("Loading..."),t&&a){var r={};r.type=t,r.gid=a,r.lat=LAST_KNOWN_LOCATION.lat,r.lng=LAST_KNOWN_LOCATION.lng,$.get(API_BASEPATH+"ajax/moreinfo",r,function(e){$("#info-content").html(e);var t=$("#info-content").find("div.wkt");t&&($("#show_on_map").data("wkt",t.text()),t.remove()),SKIP_TO_DIRECTIONS&&($("#directions_car").click(),SKIP_TO_DIRECTIONS=!1)},"html")}else $("#info-content").html($("<h1></h1>").text(e.attr("title"))),$("#directions_car").click()}}function sortLists(e){if(e||(e=$(".sidebar-pane.active ul.distance_sortable").eq(0)).length){switch(e.find(".zoom_distance").each(function(){var e=$(this).parent().parent(),t=L.latLng(e.attr("lat"),e.attr("lng")),a=LAST_KNOWN_LOCATION.distanceTo(t),n=LAST_KNOWN_LOCATION.bearingWordTo(t),r=3.2808399*a,i=900<r?(a/1609.344).toFixed(1)+" mi":r.toFixed(0)+" ft";i+=" "+n,$(this).text(i),e.data("meters",a)}),DEFAULT_SORT){case"distance":e.children("li").sort(function(e,t){return $(e).data("meters")>$(t).data("meters")?1:-1});break;case"alphabetical":e.children("li").sort(function(e,t){return $(e).attr("title")>$(t).attr("title")?1:-1})}e.children("li.ui-first-child").removeClass("ui-first-child"),e.children("li").first().addClass("ui-first-child"),e.children("li.ui-last-child").removeClass("ui-last-child"),e.children("li").last().addClass("ui-last-child")}}function zoomToAddress(e){if(!e)return!1;var t={};t.address=e,t.bing_key=BING_API_KEY,t.bbox=GEOCODE_BIAS_BOX,$.get(API_BASEPATH+"ajax/geocode",t,function(a){if(!a)return alert("We couldn't find that address or city.\nPlease try again.");var n=L.latLng(a.lat,a.lng);if(!MAX_BOUNDS.contains(n))return alert("The only results we could find are too far away to zoom the map there.");switchToMap(function(){MAP.setView(n,16),placeTargetMarker(a.lat,a.lng);var e="";e+='<h3 class="popup_title">'+a.title+"</h3>",e+='<span class="fakelink zoom" title="'+a.title+'" lat="'+a.lat+'" lng="'+a.lng+'" w="'+a.w+'" s="'+a.s+'" e="'+a.e+'" n="'+a.n+'" onClick="zoomElementClick( $(this) );">Directions</span>';var t=new L.Popup;t.setLatLng(n),t.setContent(e),MAP.openPopup(t)})},"json")}function showOnMap(){var e=$(this).data("zoomelement"),t={};e&&(t.w=e.attr("w"),t.s=e.attr("s"),t.e=e.attr("e"),t.n=e.attr("n"),t.lng=e.attr("lng"),t.lat=e.attr("lat"),t.type=e.attr("type"),t.wkt=$(this).data("wkt"),t.gid=e.attr("gid"),"reservation_new"==t.type&&(t.gid=e.attr("record_id")),zoomToFeature(t))}function zoomToFeature(t){t.type&&setWindowURLQueryStringParameter("type",t.type),t.gid&&0!=t.gid&&setWindowURLQueryStringParameter("gid",t.gid),clearTargetMarker(),MAP.hasLayer(HIGHLIGHT_LINE)&&MAP.removeLayer(HIGHLIGHT_LINE),switchToMap(function(){if(0!=t.w&&0!=t.s&&0!=t.e&&0!=t.n){var e=L.latLngBounds(L.latLng(t.s,t.w),L.latLng(t.n,t.e)).pad(.15);MAP.flyToBounds(e)}else MAP.flyTo(L.latLng(t.lat,t.lng),DEFAULT_POI_ZOOM);"poi"!=t.type&&"attraction"!=t.type&&"loop"!=t.type||placeTargetMarker(t.lat,t.lng),t.wkt&&(HIGHLIGHT_LINE=lineWKTtoFeature(t.wkt,HIGHLIGHT_LINE_STYLE),MAP.addLayer(HIGHLIGHT_LINE))})}function createCopiedToClipboardTooltip(e,t){return new Tooltip(e,{title:"Copied to clipboard.",container:t,placement:"bottom",trigger:"manual"})}function setupWindowUrlUpdates(){MAP.on("zoomend",updateWindowURLZoom),MAP.on("moveend",updateWindowURLCenter),MAP.on("layerremove",updateWindowURLLayer),MAP.on("layeradd",updateWindowURLLayer)}function updateWindowURLCenter(){var e=MAP.getCenter(),t=e.lat.toFixed(7),a=e.lng.toFixed(7);invalidateMapURL(),setWindowURLQueryStringParameter("lat",t),setWindowURLQueryStringParameter("lng",a)}function updateWindowURLZoom(){var e=MAP.getZoom().toFixed(1);invalidateMapURL(),setWindowURLQueryStringParameter("zoom",e)}function updateWindowURLLayer(){var e="map";MAP.hasLayer(AVAILABLE_LAYERS.photo)&&(e="photo"),invalidateMapURL(),setWindowURLQueryStringParameter("base",e)}function invalidateMapURL(){hideShareURL()}function updateWindowURLAll(){updateWindowURLCenter(),updateWindowURLZoom(),updateWindowURLLayer()}function setWindowURLQueryStringParameter(e,t){var a=new URLSearchParams(location.search);a.set(e,t),a.has("y")&&"lat"==e&&a.delete("y"),a.has("x")&&"lng"==e&&a.delete("x"),a.has("z")&&"zoom"==e&&a.delete("z"),WINDOW_URL=decodeURIComponent(location.pathname+"?"+a),window.history.replaceState(null,null,WINDOW_URL)}function WSENtoBounds(e,t,a,n){return L.latLngBounds([[t,e],[n,a]])}function changeCoordinateFormat(e){setSessionCoordinateFormat(SETTINGS.coordinate_format=e)}function getSessionCoordinateFormat(){$.get(API_BASEPATH+"ajax/get_session_coordinate_format",{},function(e){return e?(SETTINGS.coordinate_format=e,update_user_latlon_display(),e):void console.log("Error: get_session_coordinate_format: Could not get coordinate format.")},"json")}function setSessionCoordinateFormat(e){var t={coordinate_format:e};$.get(API_BASEPATH+"ajax/set_session_coordinate_format",t,function(e){e||console.log("Error: set_session_coordinate_format: No reply.")},"json")}function wmsGetFeatureInfoByPoint(e){var t=MAP.layerPointToLatLng(new L.Point(e.x-20,e.y+20)),a=MAP.layerPointToLatLng(new L.Point(e.x+20,e.y-20));wmsGetFeatureInfoByLatLngBBOX({w:t.lng,s:t.lat,e:a.lng,n:a.lat},MAP.layerPointToLatLng(new L.Point(e.x,e.y)))}function wmsGetFeatureInfoByLatLng(e){wmsGetFeatureInfoByLatLngBBOX({w:e.lng,s:e.lat,e:e.lng,n:e.lat},e)}function wmsGetFeatureInfoByLatLngBBOX(e,n){var t=e;t.zoom=MAP.getZoom(),$.get(API_BASEPATH+"ajax/query",t,function(e){if(e){var t={};t.maxHeight=parseInt($("#map_canvas").height()),t.maxWidth=parseInt($("#map_canvas").width());var a=new L.Popup(t);a.setLatLng(n),a.setContent(e),MAP.openPopup(a)}},"html")}function sidebarCoversMap(){return window_width=$(window).width(),window_width<=768}function update_user_latlon_display(e){!e&&LAST_KNOWN_LOCATION&&(e=LAST_KNOWN_LOCATION),latlng_str=e?latlng_formatted(e):"unknown",$("#gps_location").val(latlng_str)}$(document).on("mapInitialized",function(){if(sidebar=L.control.sidebar("sidebar").addTo(MAP),"/"!=window.location.pathname&&!window.location.pathname.endsWith("index.html")||""!=window.location.search||sidebarCoversMap()){var e=createStartHereTooltip();setTimeout(e.show,2500),setTimeout(e.dispose,15e3),$(document).click(function(){e.hide()})}else sidebar.open("pane-welcome")}),$(document).on("mapInitialized",function(){$(window).bind("orientationchange pageshow resize",function(){MAP.invalidateSize()})}),$(document).ready(function(){var e=(URL_PARAMS=$.url()).param("lat")||URL_PARAMS.param("y"),t=URL_PARAMS.param("lng")||URL_PARAMS.param("x"),a=URL_PARAMS.param("zoom")||URL_PARAMS.param("z");if(mapOptions={base:URL_PARAMS.param("base"),lat:e,lng:t,zoom:a,drop_marker:!1},initMap(mapOptions),URL_PARAMS.param("type")&&URL_PARAMS.param("name")){var n={type:URL_PARAMS.param("type"),name:URL_PARAMS.param("name")};$.get(API_BASEPATH+"ajax/exactnamesearch",n,function(e){if(!(e&&e.s&&e.w&&e.n&&e.e))return alert("Cound not find that feature.");var t=L.latLngBounds(L.latLng(e.s,e.w),L.latLng(e.n,e.e));MAP.fitBounds(t),e.lat&&e.lng?placeTargetMarker(e.lat,e.lng):e.wkt&&(HIGHLIGHT_LINE=lineWKTtoFeature(e.wkt,HIGHLIGHT_LINE_STYLE),MAP.addLayer(HIGHLIGHT_LINE))},"json")}if(URL_PARAMS.param("type")&&URL_PARAMS.param("gid"))if("attraction"==URL_PARAMS.param("type")){n={gid:URL_PARAMS.param("gid")};$.get(API_BASEPATH+"ajax/get_attraction",n,function(e){if(!e||!e.lat||!e.lng)return alert("Cound not find that feature.");zoomToFeature(e),showAttractionInfo(URL_PARAMS.param("type"),e)},"json")}else if("reservation_new"==URL_PARAMS.param("type")){n={gid:URL_PARAMS.param("gid")};$.get(API_BASEPATH+"ajax/get_reservation",n,function(e){if(!e||!e.lat||!e.lng)return alert("Cound not find that reservation.");feature=e,feature.gid=e.record_id,feature.w=e.boxw,feature.n=e.boxn,feature.e=e.boxe,feature.s=e.boxs,zoomToFeature(feature),showAttractionInfo(URL_PARAMS.param("type"),e)},"json")}if(URL_PARAMS.param("routefrom")&&URL_PARAMS.param("routeto")&&URL_PARAMS.param("routevia")){var r=URL_PARAMS.param("routefrom").split(",")[0],i=URL_PARAMS.param("routefrom").split(",")[1],o=URL_PARAMS.param("routeto").split(",")[0],s=URL_PARAMS.param("routeto").split(",")[1],l=URL_PARAMS.param("routevia");sidebar.open("pane-getdirections"),$("#getdirections_disabled").hide(),$("#getdirections_enabled").show(),$("#directions_target_title").text(URL_PARAMS.param("routetitle")),$("#directions_via").val(URL_PARAMS.param("routevia")),$("#directions_via").selectmenu("refresh"),$("#directions_type").val("geocode"),$("#directions_type").selectmenu("refresh"),$("#directions_type_geocode_wrap").show(),$("#directions_address").val(URL_PARAMS.param("routefrom")),$("#directions_target_lat").val(o),$("#directions_target_lng").val(s),$("#directions_via").trigger("change"),$("#directions_address").val(URL_PARAMS.param("fromaddr")),$("#directions_reverse").val(URL_PARAMS.param("whichway")),$("#directions_via_bike").val(URL_PARAMS.param("routevia_bike")),setTimeout(function(){$("#directions_reverse").trigger("change")},1e3),$("#directions_type").val(URL_PARAMS.param("loctype")),getDirections(r,i,o,s,"to",l)}var c=URL_PARAMS.param("base")||"map",d=$('input[name="basemap"][value="photo"]'),p=$('input[name="basemap"][value="map"]');switch(c){case"photo":d.prop("checked",!0).checkboxradio("refresh"),p.prop("checked",!1).checkboxradio("refresh");break;case"map":default:d.prop("checked",!1).checkboxradio("refresh"),p.prop("checked",!0).checkboxradio("refresh")}$.event.trigger({type:"mapReady"})}),$(document).ready(function(){$('input[type="radio"][name="basemap"]').change(function(){changeBasemap($(this).val())})}),$(document).ready(function(){$("div.sortpicker span").click(function(){DEFAULT_SORT=$(this).attr("value"),sortLists()})}),$(document).ready(function(){$(".zoom").click(function(){zoomElementClick($(this))})}),$(document).ready(function(){$("#geocode_button").click(function(){zoomToAddress($("#geocode_text").val())}),$("#geocode_text").keydown(function(e){13==e.keyCode&&$("#geocode_button").click()})}),$(document).ready(function(){$("#show_on_map").click(showOnMap)}),$(document).ready(function(){$(".copy-to-clipboard").click(function(){var e=$(this).attr("data-copy-id"),t=$(this).closest(".sidebar-pane")[0],a=$("#"+e),n=createCopiedToClipboardTooltip(a[0],t);n.show(),$(document).on("click",function(e){$(e.target).closest(".copy-to-clipboard").length||n.hide()}),a.focus(),a.select(),a[0].setSelectionRange(0,9999),document.execCommand("copy")})}),$(document).on("mapReady",setupWindowUrlUpdates),$(document).ready(function(){$('input[type="radio"][name="coordinate_format"]').change(function(){changeCoordinateFormat($(this).val()),update_user_latlon_display()})}),$(document).ready(function(){getSessionCoordinateFormat()}),$(document).on("mapReady",function(){MAP.on("click",function(e){if(ENABLE_MAPCLICK)return $(".leaflet-popup").length?MAP.closePopup():void wmsGetFeatureInfoByPoint(e.layerPoint)})}),$(document).ready(function(){$(".sidebar-pane-link").click(function(){link=$(this).attr("href"),"#"==link.charAt(0)&&(pane=link.substr(1)),sidebar.open(pane)}),$('#pane-browse li a[href="#pane-activities"]').click(function(){set_pane_back_button("#pane-activities","#pane-browse")}),$('#pane-browse li a[href="#pane-trails"]').click(function(){set_pane_back_button("#pane-trails","#pane-browse"),filterLoops()}),$('.sidebar-tabs li a[href="#pane-nearby"]').click(function(){updateNearYouNow()}),$("#pane-activities li a").click(function(){re=/id=(\d*)/;var e=this.hash.match(re);2==e.length&&(activity_id=e[1]),sidebar.open("pane-browse-results"),pane_title=$(this).text().trim(),set_pane_back_button("#pane-browse-results","#pane-activities"),$.get(API_BASEPATH+"ajax/get_attractions_by_activity",{activity_ids:activity_id},function(e){display_attractions_results(pane_title,e)},"json")}),$("#pane-amenities li a").click(function(){re=/amenity_id=(\d*)/;var e=this.hash.match(re);2==e.length&&(amenity_id=e[1]),pane_title=$(this).text().trim(),set_pane_back_button("#pane-browse-results","#pane-amenities"),$.get(API_BASEPATH+"ajax/get_attractions_by_amenity",{amenity_ids:amenity_id},function(e){display_attractions_results(pane_title,e)},"json")}),$("#pane-welcome .welcome-pane-visitorcenters a").click(function(){pane_title="Visitor Centers",set_pane_back_button("#pane-browse-results","#pane-welcome"),$.get(API_BASEPATH+"ajax/get_visitor_centers",null,function(e){display_attractions_results(pane_title,e)},"json")}),$("#pane-welcome .welcome-pane-parks a").click(function(){pane_title="Parks",set_pane_back_button("#pane-browse-results","#pane-welcome"),$.get(API_BASEPATH+"ajax/get_reservations",null,function(e){display_attractions_results(pane_title,e)},"json")}),$("#pane-welcome .welcome-pane-activities a").click(function(){set_pane_back_button("#pane-activities","#pane-welcome")}),$("#pane-welcome .welcome-pane-trails a").click(function(){set_pane_back_button("#pane-trails","#pane-welcome"),filterLoops()}),display_attractions_results=function(e,t){$("#pane-browse-results h1.sidebar-header .title-text").text(e),sidebar.open("pane-browse-results");var a=$("ul#browse_results");a.empty();for(var n=0,r=t.results.length;n<r;n++){var i=t.results[n],o=$("<li></li>").addClass("zoom").attr("title",i.name).attr("gid",i.gid).attr("record_id",i.record_id).attr("type",i.type).attr("w",i.w).attr("s",i.s).attr("e",i.e).attr("n",i.n).attr("lat",i.lat).attr("lng",i.lng).attr("backbutton","#pane-browse-results");link=$("<a></a>"),link.attr("class","ui-btn ui-btn-text"),o.append(link),o.click(function(){zoomElementClick($(this))}),link.append($("<span></span>").addClass("ui-li-heading").text(i.name)),i.note&&link.append($("<span></span>").addClass("ui-li-desc").html(i.note)),link.append($("<span></span>").addClass("zoom_distance").addClass("ui-li-count").addClass("ui-btn-up-c").addClass("ui-btn-corner-all").text("0 mi")),o.append(link),a.append(o)}a.listview("refresh"),sortLists(a)},$("#share_facebook").click(function(){var e=$("#share_url").val();return e="http://www.facebook.com/share.php?u="+encodeURIComponent(e),$("#share_facebook").prop("href",e),!0}),$("#share_twitter").click(function(){var e=$("#share_url").val();return e="http://twitter.com/home?status="+encodeURIComponent(e),$("#share_twitter").prop("href",e),!0})}),set_pane_back_button=function(e,t){$(".sidebar-back",$(e)).prop("href",t)},$(document).bind("pagechange",function(e,t){}),$(document).ready(function(){$(function(){FastClick.attach(document.getElementById("sidebar"))})}),$(document).on("mapInitialized",function(){MAP.on("locationfound",function(e){if(console.log("locationfound"),LAST_KNOWN_LOCATION=e.latlng,updateNearYouNow(),$("#nearby_enabled").is(":checked")){var t=$("#nearby_radius").val(),a=[];$('input[name="nearby_category"]:checked').each(function(){a[a.length]=$(this).val()}),placeCircle(e.latlng.lat,e.latlng.lng,t),checkNearby(e.latlng,t,a)}update_user_latlon_display(e.latlng)})});var DIRECTIONS_LINE=null,DIRECTIONS_LINE_STYLE={color:"#0000FF",weight:5,opacity:1,clickable:!1,smoothFactor:.25};function launchNativeExternalDirections(e,t,a,n,r,i,o){var s=[e,t],l=[a,n];"from"==r&&(s=[a,n],l=[e,t]),options={enableDebug:!0,transportMode:c},o||(options.start=s);var c="bus"==i?launchnavigator.TRANSPORT_MODE.TRANSIT:launchnavigator.TRANSPORT_MODE.DRIVING;launchnavigator.navigate(l,options)}function getDirections(e,t,a,n,r,i,o){$("#directions_steps").empty(),disableDirectionsButton(),$("#directions_source_lat").val(e),$("#directions_source_lng").val(t);var s=$("#directions_prefer").val();if(NATIVE_APP&&("car"==i||"bus"==i))return launchNativeExternalDirections(e,t,a,n,r,i,o),void enableDirectionsButton();var l={sourcelat:e,sourcelng:t,targetlat:a,targetlng:n,tofrom:r,via:i,prefer:s,bing_key:BING_API_KEY};$.get(API_BASEPATH+"ajax/directions",l,function(e){if(enableDirectionsButton(),!e||!e.wkt){var t="Could not find directions.";return"hike"!=i&&(t+="\nTry a different type of trail, terrain, or difficulty."),alert(t)}renderDirectionsStructure(e)},"json")}function disableDirectionsButton(){var e=$("#directions_button");e.button("disable"),e.closest(".ui-btn").find(".ui-btn-text").text(e.attr("value0"))}function enableDirectionsButton(){var e=$("#directions_button");e.button("enable"),e.closest(".ui-btn").find(".ui-btn-text").text(e.attr("value1"))}function processGetDirectionsForm(){var i,o,e=$("#directions_reverse").val(),t=$("#directions_via").val();"bike"==t&&(t=$("#directions_via_bike").val()),$("#directions_source_gid").val(""),$("#directions_source_type").val(""),$.ajaxSetup({async:!1});var a=!1;switch($("#directions_type").val()){case"gps":a=!0,i=LAST_KNOWN_LOCATION.lat,o=LAST_KNOWN_LOCATION.lng;break;case"geocode":var r=$("#directions_address").val();if(!r)return alert("Please enter an address, city, or landmark.");var n=/^(\d+\.\d+)\,(\-\d+\.\d+)$/.exec(r);if(n)i=parseFloat(n[1]),o=parseFloat(n[2]),getDirections(i,o,l,c,e,t);else disableDirectionsButton(),(s={}).address=r,s.bing_key=BING_API_KEY,s.bbox=GEOCODE_BIAS_BOX,$.get(API_BASEPATH+"ajax/geocode",s,function(e){if(enableDirectionsButton(),!e)return alert("We couldn't find that address or city.\nPlease try again.");if(i=e.lat,o=e.lng,!MAX_BOUNDS.contains(L.latLng(i,o))){var t={rtp:"adr."+r+"~"+("pos."+l+"_"+c)},a="http://bing.com/maps/default.aspx?"+$.param(t),n=$("#directions_steps");return n.empty(),n.append($("<div></div>").html("The address you have chosen is outside of the covered area.<br/>Click the link below to go to Bing Maps for directions.")),void n.append($("<a></a>").text("Click here for directions from Bing Maps").prop("href",a).prop("target","_blank"))}},"json");break;case"features":var s;if(disableDirectionsButton(),(s={}).keyword=$("#directions_address").val(),s.limit=30,s.lat=LAST_KNOWN_LOCATION.lat,s.lng=LAST_KNOWN_LOCATION.lng,s.via=t,$.get(API_BASEPATH+"ajax/keyword",s,function(e){if(enableDirectionsButton(),!e||!e.length)return alert("We couldn't find any matching landmarks.");for(var t=$("#directions_address").val().replace(/\W/g,"").toLowerCase(),a=0,n=e.length;a<n;a++){if(e[a].name.replace(/\W/g,"").toLowerCase()==t){e=[e[a]];break}}if(1<e.length)return o=i=null,void populateDidYouMean(e);var r=e[0].name.replace(/^\s*/,"").replace(/\s*$/,"");$("#directions_address").val(r),$("#directions_source_gid").val(e[0].gid),$("#directions_source_type").val(e[0].type),i=parseFloat(e[0].lat),o=parseFloat(e[0].lng)},"json"),!i||!o)return}var l=parseFloat($("#directions_target_lat").val()),c=parseFloat($("#directions_target_lng").val()),d=$("#directions_source_gid").val(),p=$("#directions_source_type").val();if("poi"==p||"attraction"==p||"reservation"==p||"trail"==p){var _=geocodeLocationForDirections(p,d,l,c,t,"#directions_source_lat","#directions_source_lng");i=_.lat,o=_.lng}var u=$("#directions_target_gid").val(),g=$("#directions_target_type").val();if("poi"==g||"attraction"==g||"reservation"==g||"trail"==g){var m=geocodeLocationForDirections(g,u,i,o,t,"#directions_target_lat","#directions_target_lng");l=m.lat,c=m.lng}if(!l||!c)return alert("Please close the directions panel, and pick a location.");$.ajaxSetup({async:!0}),getDirections(i,o,l,c,e,t,a)}function geocodeLocationForDirections(e,t,a,n,r,i,o){var s=new Object,l={type:e,gid:t,lat:a,lng:n,via:r};return $.get(API_BASEPATH+"ajax/geocode_for_directions",l,function(e){s.lat=e.lat,s.lng=e.lng,$(i).val(e.lat),$(o).val(e.lng)},"json"),s}function populateDidYouMean(e){var t=$("#directions_steps");t.empty();var a=$("<li></li>").addClass("did-you-mean").text("Did you mean:");t.append(a);for(var n=0,r=e.length;n<r;n++){var i=e[n],o=i.name.replace(/^\s*/,"").replace(/\s*$/,"");(a=$("<li></li>")).append($("<span></span>").addClass("ui-li-heading").text(o)).attr("type",i.type).attr("gid",i.gid);a.click(function(){$("#directions_address").val($(this).text()),$("#directions_source_gid").val($(this).attr("gid")),$("#directions_source_type").val($(this).attr("type")),$("#directions_button").click()}),a.css({cursor:"pointer"}),t.append(a)}t.listview("refresh")}function renderDirectionsStructure(e,t,a){a=a||{},clearDirectionsLine(),placeDirectionsLine(lineWKTtoFeature(e.wkt,DIRECTIONS_LINE_STYLE),L.latLng(e.start.lat,e.start.lng),L.latLng(e.end.lat,e.end.lng)),DIRECTIONS_LINE.extent=WSENtoBounds(e.bounds.west,e.bounds.south,e.bounds.east,e.bounds.north);var n=DIRECTIONS_LINE.extent.pad(.15);MAP.fitBounds(n),(t=t||$("#directions_steps")).empty();for(var r=0,i=e.steps.length;r<i;r++){var o=e.steps[r],s=$("<li></li>"),l=o.stepnumber?o.stepnumber+". "+(o.turnword?o.turnword:"")+" "+o.text:o.turnword+" "+o.text;if(s.append($("<span></span>").addClass("ui-li-heading").text(l)),o.distance&&o.duration&&"0"!=o.distance.substr(0,1)){var c=o.distance+", "+o.duration;s.append($("<span></span>").addClass("ui-li-desc").text(c))}t.append(s)}var d=$("<span></span>").addClass("ui-li-desc").html("");e.retries&&3<e.retries&&d.html("Route may be approximated.");var p=$("<span></span>").addClass("ui-li-heading").html("<b>Total:</b> "+e.totals.distance+", "+e.totals.duration);t.append($("<li></li>").append(p).append(d));var _=$("<div></div>").addClass("directions_functions");if(e.elevationprofile){var u=$("<a></a>").addClass("ui-btn").addClass("ui-btn-inline").addClass("ui-corner-all").prop("id","elevationprofile_button").text("Elevation Profile");u.attr("value1","Elevation Profile").attr("value0","Loading"),u.click(function(){openElevationProfileBySegments()}),_.append(u)}var g=$("<a></a>").addClass("ui-btn").addClass("ui-btn-inline").addClass("ui-corner-all").text("Clear");if(g.click(function(){$("#directions_steps").empty(),clearDirectionsLine(),$(".directions_functions").empty()}),_.append(g),!a.noshare){var m=$("<a></a>").addClass("ui-btn").addClass("ui-btn-inline").addClass("ui-corner-all").prop("id","share_route_button").text("Share");m.click(function(){updateShareUrlByDirections(),makeAndShowShortURL(),sidebar.open("pane-share")}),_.append(m)}if(!NATIVE_APP){var f=$("<a></a>").addClass("ui-btn").addClass("ui-btn-inline").addClass("ui-corner-all").text("Print");f.click(function(){$("#button_print").click()}),_.append(f)}t.after(_),ELEVATION_PROFILE=[],e.elevationprofile&&(ELEVATION_PROFILE=e.elevationprofile),t.listview("refresh"),$(".directions_functions img:first").removeClass("ui-li-thumb")}function clearDirectionsLine(){DIRECTIONS_LINE&&(MAP.removeLayer(DIRECTIONS_LINE),DIRECTIONS_LINE=null),MAP.hasLayer(MARKER_FROM)&&(MARKER_FROM.setLatLng(L.latLng(0,0)),MAP.removeLayer(MARKER_FROM)),MAP.hasLayer(MARKER_TO)&&(MARKER_TO.setLatLng(L.latLng(0,0)),MAP.removeLayer(MARKER_TO)),$("#directions_steps").empty(),$("#measure_steps").empty()}function placeDirectionsLine(e,t,a){DIRECTIONS_LINE=e,MAP.addLayer(DIRECTIONS_LINE),MARKER_FROM.setLatLng(t),MAP.addLayer(MARKER_FROM),MARKER_TO.setLatLng(a),MAP.addLayer(MARKER_TO),MARKER_FROM.dragging.disable(),MARKER_TO.dragging.disable()}function openElevationProfileBySegments(){if(ELEVATION_PROFILE){for(var e=[],t=[],a=0,n=ELEVATION_PROFILE.length;a<n;a++)e[e.length]=ELEVATION_PROFILE[a].x,t[t.length]=ELEVATION_PROFILE[a].y;e=e.join(","),t=t.join(","),$.post(API_BASEPATH+"ajax/elevationprofilebysegments",{x:e,y:t},function(e){if(0!=e.indexOf("http"))return alert(e);showElevation(e)})}}function showShareURL(){$("#share_url_controls").show(),$("#make_share_url_controls").hide(),setShareURLBoxWidth()}function hideShareURL(){$("#share_url_controls").hide(),$("#make_share_url_controls").show()}function makeAndShowShortURL(){var e=WINDOW_URL;"/"==e.charAt(0)&&(e=e.substr(1)),"?"==e.charAt(0)&&(e=e.substr(1));var t={uri:"/",querystring:e};$.get(API_BASEPATH+"ajax/make_shorturl",t,function(e){if(!e)return alert("Unable to fetch a short URL.\nPlease try again.");var t=("file"!=URL_PARAMS.attr("protocol")?URL_PARAMS.attr("protocol"):WEBAPP_BASE_URL_ABSOLUTE_PROTOCOL)+"://"+(URL_PARAMS.attr("host")?URL_PARAMS.attr("host"):WEBAPP_BASE_URL_ABSOLUTE_HOST)+"/url/"+e;$("#share_url").val(t),showShareURL()})}function setShareURLBoxWidth(){var e=$("#share_url_controls").width(),t=$("#pane-share .copy-to-clipboard").outerWidth(),a=$("#share_url_controls .ui-input-text"),n=e-t-(a.outerWidth()-a.width());a.width(n)}function updateShareUrlByFeature(e){var t={};t.type=e.attr("type"),t.name=e.attr("title"),SHARE_URL_STRING=$.param(t)}function updateShareUrlByDirections(){if($("#directions_source_lat").val()){var e={};MAP.hasLayer(AVAILABLE_LAYERS.photo)?e.base="photo":(MAP.hasLayer(AVAILABLE_LAYERS.map)||MAP.hasLayer(AVAILABLE_LAYERS.vector))&&(e.base="map"),e.routevia=$("#directions_via").val(),e.routevia_bike=$("#directions_via_bike").val(),e.routefrom=$("#directions_source_lat").val()+","+$("#directions_source_lng").val(),e.routeto=$("#directions_target_lat").val()+","+$("#directions_target_lng").val(),e.routetitle=$("#directions_target_title").text(),e.whichway=$("#directions_reverse").val(),e.loctype=$("#directions_type").val(),e.fromaddr=$("#directions_address").val(),"trail"==e.routevia&&(e.routevia=$("#directions_via_trail").val()),SHARE_URL_STRING=$.param(e)}}function disableKeywordButton(){var e=$("#search_keyword_button");e.button("disable"),e.closest(".ui-btn").find(".ui-btn-text").text(e.attr("value0"))}function enableKeywordButton(){var e=$("#search_keyword_button");e.button("enable"),e.closest(".ui-btn").find(".ui-btn-text").text(e.attr("value1"))}function strToLngLat(e){if((e=e.replace(/\s+$/,"").replace(/^\s+/,"")).match(/^[\d\.\-\,\s]+$/)){var t=e.split(/[\s\,]+/);if(2==t.length)if(t[0]=parseFloat(t[0]),t[1]=parseFloat(t[1]),t[0]&&t[1])return r=t[0]<0?(n=t[1],t[0]):(n=t[0],t[1]),new mapboxgl.LngLat(r,n)}var a=e.match(/^N\s*(\d\d)\s+(\d\d\.\d\d\d)\s+W\s*(\d\d\d)\s+(\d\d\.\d\d\d)$/i);if(a){var n=parseInt(a[1])+parseInt(a[2])/60,r=-parseInt(a[3])-parseInt(a[4])/60;return new mapboxgl.LngLat(r,n)}return null}function searchByKeyword(i){var e=strToLngLat(i);if(e)return MAP.flyTo({center:e,zoom:16}),void placeTargetMarker(e.lat,e.lng);var o=$("#keyword_results");o.empty(),disableKeywordButton(),$("#pane-search .sortpicker").hide(),$.get(API_BASEPATH+"ajax/keyword",{keyword:i,limit:100},function(e){if(enableKeywordButton(),$("#pane-search .sortpicker").show(),!e.length)return $("<li></li>").text("No Cleveland Metroparks results found. Trying an address search.").appendTo(o),void zoomToAddress(i);for(var t=0,a=e.length;t<a;t++){var n=e[t],r=$("<li></li>").addClass("zoom").addClass("ui-li-has-count");r.attr("title",n.name).attr("gid",n.gid).attr("type",n.type).attr("w",n.w).attr("s",n.s).attr("e",n.e).attr("n",n.n).attr("lat",n.lat).attr("lng",n.lng),r.attr("backbutton","#pane-search"),link=$("<a></a>"),link.attr("class","ui-btn ui-btn-text"),r.click(function(){zoomElementClick($(this))}),r.append(link),link.append($("<h4></h4>").addClass("ui-li-heading").text(n.name)),link.append($("<span></span>").addClass("ui-li-desc").text(n.description)),link.append($("<span></span>").addClass("zoom_distance").addClass("ui-li-count").addClass("ui-btn-up-c").addClass("ui-btn-corner-all").text("0 mi")),r.append(link),o.append(r)}o.listview("refresh"),sortLists(o)},"json")}$(document).ready(function(){function e(e){$("#directions_via").val(e),$("#directions_via").trigger("change"),$("#directions_via").selectmenu("refresh"),sidebar.open("pane-getdirections")}$("#directions_hike").click(function(){e("hike")}),$("#directions_bike").click(function(){e("bike")}),$("#directions_bridle").click(function(){e("bridle")}),$("#directions_car").click(function(){e("car")}),$("#directions_bus").click(function(){e("bus")}),$("#directions_type").change(function(){var e=$(this).val(),t=$("#directions_type_geocode_wrap");"gps"==e?t.hide():t.show()}),$("#directions_reverse").change(function(){var t="to"==$(this).val()?"from":"to";$("#directions_type option").each(function(){var e=$(this).text();e=t+" "+e.replace(/^to /,"").replace(/^from /,""),$(this).text(e)}),$("#directions_type").selectmenu("refresh",!0)}),$("#directions_button").click(function(){$("#directions_steps").empty(),$(".directions_functions").remove(),processGetDirectionsForm()}),$("#directions_address").keydown(function(e){13==e.keyCode&&$("#directions_button").click()}),$("#change_directions_target2").click(function(){sidebar.open("pane-browse"),SKIP_TO_DIRECTIONS=!0})}),$(document).ready(function(){$("#getdirections_clear").click(function(){clearDirectionsLine(),$("#directions_steps").empty()}),$("#directions_via").change(function(){switch($("#directions_via_bike_wrap").hide(),$(this).val()){case"bike":$("#directions_via_bike_wrap").show()}})}),$(document).ready(function(){hideShareURL(),$("#share_url").click(function(){$(this).select()}),$("#make_share_url_btn").click(function(){makeAndShowShortURL()}),$("#share_feature").click(function(){var e=$("#show_on_map").data("zoomelement");e&&(updateShareUrlByFeature(e),makeAndShowShortURL(),sidebar.open("pane-share"))})}),$(document).ready(function(){$("#browse_keyword_button").click(function(){sidebar.open("pane-search"),$("#search_keyword").val($("#browse_keyword").val()),$("#search_keyword_button").click()}),$("#browse_keyword").keydown(function(e){13==e.keyCode&&$("#browse_keyword_button").click()}),$("#search_keyword_button").click(function(){searchByKeyword($("#search_keyword").val())}),$("#search_keyword").keydown(function(e){13==e.keyCode&&$("#search_keyword_button").click()})}),$(document).ready(function(){$.get(API_BASEPATH+"ajax/autocomplete_keywords",{},function(e){$("#browse_keyword").autocomplete({target:$("#browse_keyword_autocomplete"),source:e,callback:function(e){var t=$(e.currentTarget);$("#browse_keyword").val(t.text()),$("#browse_keyword").autocomplete("clear"),$("#browse_keyword_button").click()},minLength:3,matchFromStart:!1}),$("#search_keyword").autocomplete({target:$("#search_keyword_autocomplete"),source:e,callback:function(e){var t=$(e.currentTarget);$("#search_keyword").val(t.text()),$("#search_keyword").autocomplete("clear"),$("#search_keyword_button").click()},minLength:3,matchFromStart:!1})},"json")});var ALL_POIS=[];function updateNearYouNow(){for(var e=$("#alerts"),t=0,a=ALL_POIS.length;t<a;t++){var n=ALL_POIS[t],r=L.latLng(n.lat,n.lng);n.meters=LAST_KNOWN_LOCATION.distanceTo(r),n.miles=n.meters/1609.344,n.feet=3.2808399*n.meters,n.range=900<n.feet?n.miles.toFixed(1)+" mi":n.feet.toFixed(0)+" ft",n.bearing=LAST_KNOWN_LOCATION.bearingWordTo(r)}ALL_POIS.sort(function(e,t){return e.meters-t.meters});var i=ALL_POIS.slice(0,25);e.empty();for(t=0,a=i.length;t<a;t++){n=i[t];var o=$("<li></li>").addClass("zoom").addClass("ui-li-has-count");o.attr("title",n.title),o.attr("category",n.categories),o.attr("type","poi").attr("gid",n.gid),o.attr("w",n.w).attr("s",n.s).attr("e",n.e).attr("n",n.n),o.attr("lat",n.lat).attr("lng",n.lng),o.attr("backbutton","#pane-nearby");var s=$("<div></div>").addClass("ui-btn-text");s.append($("<h2></h2>").text(n.title)),s.append($("<p></p>").text(n.categories)),s.append($("<span></span>").addClass("zoom_distance").addClass("ui-li-count").addClass("ui-btn-up-c").addClass("ui-btn-corner-all").text(n.range+" "+n.bearing)),o.click(function(){zoomElementClick($(this))}),o.append(s),e.append(o)}e.listview("refresh")}function placeCircle(e,t,a){MAP.removeLayer(CIRCLE),CIRCLE.setLatLng(L.latLng(e,t)),CIRCLE.setRadius(a),MAP.addLayer(CIRCLE)}function clearCircle(){CIRCLE.setLatLng(L.latLng(0,0)),CIRCLE.setRadius(1),MAP.removeLayer(CIRCLE)}function checkNearby(e,t,a){t=parseFloat(t);for(var n=[],r=0,i=ALL_POIS.length;r<i;r++){var o=ALL_POIS[r],s=e.distanceTo(L.latLng(o.lat,o.lng));if(!(t<s)){if(a){for(var l=o.categories.split("; "),c=!1,d=0,p=l.length;d<p;d++)for(var _=0,u=a.length;_<u;_++)if(a[_]==l[d]){c=!0;break}if(!c)continue}var g=3.2808399*s,m=900<g?(s/1609.344).toFixed(1)+" mi":g.toFixed(0)+" ft";n[n.length]={gid:o.gid,title:o.title,range:m}}}var f=!1;for(r=0,i=n.length;r<i;r++){var h=parseInt(n[r].gid);if(-1==LAST_BEEP_IDS.indexOf(h)){f=!0;break}}LAST_BEEP_IDS=[];for(r=0,i=n.length;r<i;r++){h=parseInt(n[r].gid);LAST_BEEP_IDS[LAST_BEEP_IDS.length]=h}if(LAST_BEEP_IDS.sort(),f){document.getElementById("alert_beep").play();var A=[];for(r=0,i=n.length;r<i;r++)A[A.length]=n[r].title+", "+n[r].range;setTimeout(function(){alert(A.join("\n"))},1e3)}}function filterLoops(){$("#loops_list li").show();var e={};e.filter_type=$("#loops_filter_type").val(),e.filter_paved=$("#loops_filter_paved").val(),e.minseconds=60*parseInt($("#loops_filter_duration_min").val()),e.maxseconds=60*parseInt($("#loops_filter_duration_max").val()),e.minfeet=5280*parseInt($("#loops_filter_distance_min").val()),e.maxfeet=5280*parseInt($("#loops_filter_distance_max").val()),e.reservation=$("#loops_filter_reservation").val(),$.get(API_BASEPATH+"ajax/search_loops",e,function(e){var t=$("#loops_list");if(t.empty(),$(".results-notes").remove(),!e||!e.length){t.after('<p class="results-notes">No results.</p>')}for(var a=0,n=e.length;a<n;a++){var r=e[a],i=$("<li></li>").addClass("zoom").addClass("ui-li-has-count");i.attr("title",r.title).attr("gid",r.gid).attr("type","loop").attr("w",r.w).attr("s",r.s).attr("e",r.e).attr("n",r.n).attr("lat",r.lat).attr("lng",r.lng),i.attr("backbutton","#pane-trails"),link=$("<a></a>"),link.attr("class","ui-btn ui-btn-text"),i.click(function(){zoomElementClick($(this))}),i.append(link),link.append($("<h4></h4>").addClass("ui-li-heading").text(r.title)),link.append($("<span></span>").addClass("ui-li-desc").html(r.distance+" &nbsp;&nbsp; "+r.duration)),link.append($("<span></span>").addClass("zoom_distance").addClass("ui-li-count").addClass("ui-btn-up-c").addClass("ui-btn-corner-all").text("0 mi")),i.append(link),t.append(i)}$("#pane-trails .sortpicker").show(),t.listview("refresh"),sortLists(t)},"json")}function printMapPrepare(){$("#print_waiting").show(),$("#print_ready").hide()}function printMapDone(e){$("#print_waiting").hide(),e&&($("#print_link").prop("href",e),$("#print_ready").show())}function printMap(){var e=$("#print_comment").val(),t=$("#print_paper").val(),a="",n="",r="",i=PRINT_SIZES[t][0],o=PRINT_SIZES[t][1],s=MAP.latLngToLayerPoint(MAP.getCenter()),l=wgsToLocalSRS(MAP.layerPointToLatLng(new L.Point(s.x-i/2,s.y+o/2))),c=wgsToLocalSRS(MAP.layerPointToLatLng(new L.Point(s.x+i/2,s.y-o/2))),d=[l[0],l[1],c[0],c[1]],p={format_options:"dpi:300"},_=[];if(MAP.hasLayer(AVAILABLE_LAYERS.photo)){if(MAP.getZoom()<14)return alert("Before printing, zoom in closer.");_[_.length]={baseURL:"http://maps.clevelandmetroparks.com/proxy/ohioimagery",opacity:1,singleTile:!1,type:"WMS",layers:["0"],format:"image/png",styles:[""]}}if((MAP.hasLayer(AVAILABLE_LAYERS.photo)||MAP.hasLayer(AVAILABLE_LAYERS.vector))&&(_[_.length]={baseURL:"http://maps.clevelandmetroparks.com/gwms",opacity:1,singleTile:!0,type:"WMS",layers:["group_basemap"],format:"image/jpeg",styles:[""],customParams:p},_[_.length]={baseURL:"http://maps.clevelandmetroparks.com/gwms",opacity:1,singleTile:!0,type:"WMS",layers:["cm:trails","cm:closures","cm:markers_other","cm:markers_swgh"],format:"image/png",styles:"",customParams:p}),DIRECTIONS_LINE&&MAP.hasLayer(DIRECTIONS_LINE)){var u=[];for(var g in DIRECTIONS_LINE._layers){for(var m=DIRECTIONS_LINE._layers[g],f=[],h=0,A=m._latlngs.length;h<A;h++)f[f.length]=wgsToLocalSRS([m._latlngs[h].lng,m._latlngs[h].lat]);u[u.length]=f}var v=DIRECTIONS_LINE_STYLE.opacity,y=DIRECTIONS_LINE_STYLE.color,b=3;_[_.length]={type:"Vector",name:"Directions Line",opacity:v,styles:{default:{strokeColor:y,strokeWidth:b,strokeLinecap:"round"}},styleProperty:"style_index",geoJson:{type:"FeatureCollection",features:[{type:"Feature",properties:{style_index:"default"},geometry:{type:"MultiLineString",coordinates:u}}]}};var k=ICON_FROM.options.iconUrl.replace("maps.clevelandmetroparks.com","10.0.0.23").replace("https:","http:"),P=wgsToLocalSRS(MARKER_FROM.getLatLng()),T=-10,w=0,R=15;_[_.length]={type:"Vector",name:"Target Marker",opacity:1,styleProperty:"style_index",styles:{default:{externalGraphic:k,fillOpacity:1,pointRadius:R,graphicXOffset:T,graphicYOffset:w}},geoJson:{type:"FeatureCollection",features:[{type:"Feature",properties:{style_index:"default"},geometry:{type:"Point",coordinates:P}}]}};k=ICON_TO.options.iconUrl.replace("maps.clevelandmetroparks.com","10.0.0.23").replace("https:","http:"),P=wgsToLocalSRS(MARKER_TO.getLatLng()),T=-10,w=0,R=15;_[_.length]={type:"Vector",name:"Target Marker",opacity:1,styleProperty:"style_index",styles:{default:{externalGraphic:k,fillOpacity:1,pointRadius:R,graphicXOffset:T,graphicYOffset:w}},geoJson:{type:"FeatureCollection",features:[{type:"Feature",properties:{style_index:"default"},geometry:{type:"Point",coordinates:P}}]}},t+=" with directions";var E=$("#directions_reverse").val(),S="to"==E?"from":"to",I=$("#directions_target_title").text(),M=$("#directions_address").val(),C=$("#directions_via option:selected").text().toLowerCase();U=E&&S&&I&&M?(a="Directions\n"+E+" "+I+"\n"+S+" "+M+"\n"+C,$("#directions_steps li")):(a="Measurement directions",$("#measure_steps li"));var O=25;switch(t){case"Letter portrait with directions":O=40;break;case"Letter landscape with directions":O=31;break;case"Ledger portrait with directions":O=65;break;case"Ledger landscape with directions":O=45}n=[],r=[],U.each(function(){var e=$(this).find(".ui-li-heading").eq(0).text()+"\n     "+$(this).find(".ui-li-desc").eq(0).text();n.length<O?n[n.length]=e:r[r.length]=e}),n=n.join("\n"),r=r.join("\n")}if(HIGHLIGHT_LINE&&MAP.hasLayer(HIGHLIGHT_LINE)){u=[];for(var x=HIGHLIGHT_LINE.getLatLngs(),N=(g=0,x.length);g<N;g++){var B=[];for(vi=0,vl=x[g].length;vi<vl;vi++)B[B.length]=wgsToLocalSRS([x[g][vi].lng,x[g][vi].lat]);u[u.length]=B}v=HIGHLIGHT_LINE_STYLE.opacity,y=HIGHLIGHT_LINE_STYLE.color,b=3;if(_[_.length]={type:"Vector",name:"Highlight Line",opacity:v,styles:{default:{strokeColor:y,strokeWidth:b,strokeLinecap:"round"}},styleProperty:"style_index",geoJson:{type:"FeatureCollection",features:[{type:"Feature",properties:{style_index:"default"},geometry:{type:"MultiLineString",coordinates:u}}]}},"loop"==$("#show_on_map").data("zoomelement").attr("type")){var U=$("#moreinfo_steps li");t+=" with directions",a=$("#show_on_map").data("zoomelement").attr("title");O=25;switch(t){case"Letter portrait with directions":O=40;break;case"Letter landscape with directions":O=31;break;case"Ledger portrait with directions":O=65;break;case"Ledger landscape with directions":O=45}n=[],r=[],U.each(function(){var e=$(this).find(".ui-li-heading").eq(0).text()+"\n     "+$(this).find(".ui-li-desc").eq(0).text();n.length<O?n[n.length]=e:r[r.length]=e}),n=n.join("\n"),r=r.join("\n")}}if(MARKER_TARGET&&MAP.hasLayer(MARKER_TARGET)){k=ICON_TARGET.options.iconUrl,P=wgsToLocalSRS(MARKER_TARGET.getLatLng()),T=-10,w=0,R=15;_[_.length]={type:"Vector",name:"Target Marker",opacity:1,styleProperty:"style_index",styles:{default:{externalGraphic:k,fillOpacity:1,pointRadius:R,graphicXOffset:T,graphicYOffset:w}},geoJson:{type:"FeatureCollection",features:[{type:"Feature",properties:{style_index:"default"},geometry:{type:"Point",coordinates:P}}]}}}var F={units:"feet",srs:"EPSG:3734",layout:t,dpi:300,layers:_,pages:[{bbox:d,rotation:"0",comment:e}],layersMerging:!0,page2title:a,page2text1:n,page2text2:r};printMapPrepare(),$.ajax({url:PRINT_URL,type:"POST",data:JSON.stringify(F),processData:!1,contentType:"application/json",success:function(e){var t=e.getURL;t=(t=t.split("/"))[t.length-1],printMapDone(t=PRINT_PICKUP_BASEURL+t)},error:function(e,t,a){alert("Printing failed. Please try again."),printMapDone()}})}function wgsToLocalSRS(e){var t=new Proj4js.Proj("EPSG:4326"),a=new Proj4js.Proj("EPSG:3734"),n=e.lat?new Proj4js.Point(e.lng,e.lat):new Proj4js.Point(e[0],e[1]);return Proj4js.transform(t,a,n),[n.x,n.y]}$(document).ready(function(){$.get(API_BASEPATH+"ajax/load_pois",{},function(e){for(var t=0,a=e.length;t<a;t++)ALL_POIS[ALL_POIS.length]=e[t];updateNearYouNow()},"json")}),$(document).ready(function(){$("#nearby_enabled").change(function(){var e=$(this).is(":checked");e?$("#nearby_config").show():$("#nearby_config").hide(),e||($("#alerts li").slice(0,25).show(),$("#alerts li").slice(25).hide(),clearCircle())})}),$(document).ready(function(){$("#loops_typeicons img").click(function(){var t=$(this),e=t.attr("data-value");$("#loops_filter_type").val(e).trigger("change"),$("#loops_typeicons img").each(function(){var e=$(this).prop("src");$(this).is(t)?e.includes("-on.svg")||(e=e.replace(".svg","-on.svg")):e=e.replace("-on.svg",".svg"),$(this).prop("src",e)})}).first().click(),$("#loops_filter_distancepicker a").click(function(){var e=$(this),t=e.attr("data-min"),a=e.attr("data-max");$("#loops_filter_distance_min").val(t),$("#loops_filter_distance_max").val(a),$("#loops_filter_distancepicker a").each(function(){$(this).is(e)?$(this).addClass("active"):$(this).removeClass("active")}),filterLoops()}),$("#loops_filter_reservation").change(function(){filterLoops()}),$("#loops_filter_distance_min").change(),$("#loops_filter_distance_max").change(),$("#loops_filter_duration_min").change(),$("#loops_filter_duration_max").change(),$("#loops_filter_type").change(function(){switch($(this).val()){case"hike":case"exercise":$(".time_estimate").hide(),$(".time_hike").show(),$(".time_estimate_prefix").hide();break;case"bridle":$(".time_estimate").hide(),$(".time_bridle").show(),$(".time_estimate_prefix").hide();break;case"bike":case"bike_Novice":case"bike_Beginner":case"bike_Intermediate":case"bike_Advanced":case"mountainbike":$(".time_estimate").hide(),$(".time_bike").show(),$(".time_estimate_prefix").hide();break;default:$(".time_estimate").show(),$(".time_estimate_prefix").show()}filterLoops()})});