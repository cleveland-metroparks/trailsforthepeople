function initMap(a){var b,c=a.base||"map";switch(c){case"photo":b=LAYER_MAPBOX_SAT;break;case"map":default:b=isMobile?LAYER_MAPBOX_MAP:LAYER_MAPBOX_GL_MAP}var d={attributionControl:!1,zoomControl:!1,dragging:!0,closePopupOnClick:!1,crs:L.CRS.EPSG3857,minZoom:MIN_ZOOM,maxZoom:MAX_ZOOM,zoomSnap:0,layers:[b]};if(navigator.userAgent.match(/Android (4|5)/)&&(d.fadeAnimation=!0,d.zoomAnimation=!0,d.markerZoomAnimation=!0),MAP=new L.Map("map_canvas",d),new L.Control.Zoom({position:"bottomright"}).addTo(MAP),a.x&&a.y&&a.z){var e=parseFloat(a.x),f=parseFloat(a.y),g=parseInt(a.z);MAP.setView(L.latLng(f,e),g),MAP.addLayer(MARKER_TARGET),MARKER_TARGET.setLatLng(L.latLng(f,e))}else MAP.fitBounds(MAX_BOUNDS);L.control.scale().addTo(MAP),$.event.trigger({type:"mapInitialized"}),MAP.on("click",function(a){if(ENABLE_MAPCLICK)return $(".leaflet-popup").length?MAP.closePopup():void wmsGetFeatureInfoByPoint(a.layerPoint)})}function lineWKTtoFeature(a,b){var c=new Wkt.Wkt;return c.read(a),c.toObject(b)}function placeTargetMarker(a,b){MAP.addLayer(MARKER_TARGET),MARKER_TARGET.setLatLng(L.latLng(a,b))}function clearTargetMarker(){MAP.removeLayer(MARKER_TARGET)}function placeGPSMarker(a,b){MAP.addLayer(MARKER_GPS),MARKER_GPS.setLatLng(L.latLng(a,b))}function clearGPSMarker(){MAP.removeLayer(MARKER_GPS)}function showInfoPopup(a,b){switch(MAP.removeLayer(INFO_POPUP),b){case"warning":classes="info-popup warning";break;case"error":classes="info-popup error";break;default:classes="info-popup"}INFO_POPUP=L.popup({className:classes}).setLatLng(MAP.getCenter()).setContent(a).openOn(MAP)}function clearInfoPopup(){MAP.removeLayer(INFO_POPUP),INFO_POPUP.options.className}function wmsGetFeatureInfoByPoint(a){var b=MAP.layerPointToLatLng(new L.Point(a.x-20,a.y+20)),c=MAP.layerPointToLatLng(new L.Point(a.x+20,a.y-20));wmsGetFeatureInfoByLatLngBBOX({w:b.lng,s:b.lat,e:c.lng,n:c.lat},MAP.layerPointToLatLng(new L.Point(a.x,a.y)))}function wmsGetFeatureInfoByLatLng(a){wmsGetFeatureInfoByLatLngBBOX({w:a.lng,s:a.lat,e:a.lng,n:a.lat},a)}function wmsGetFeatureInfoByLatLngBBOX(a,b){var c=a;c.zoom=MAP.getZoom(),$.get(API_BASEPATH+"ajax/query",c,function(a){if(a){var c={};c.maxHeight=parseInt($("#map_canvas").height()),c.maxWidth=parseInt($("#map_canvas").width());var d=new L.Popup(c);d.setLatLng(b),d.setContent(a),MAP.openPopup(d)}},"html")}function changeBasemap(a){for("map"==a&&(isMobile||(a="vector")),new_active_layer=AVAILABLE_LAYERS[a],i=0;i<ALL_LAYERS.length;i++)ALL_LAYERS[i]==new_active_layer?(MAP.hasLayer(ALL_LAYERS[i])||MAP.addLayer(ALL_LAYERS[i],!0),"vector"!=a&&new_active_layer.bringToBack()):MAP.hasLayer(ALL_LAYERS[i])&&MAP.removeLayer(ALL_LAYERS[i])}function createStartHereTooltip(){var a=$(".sidebar-tabs ul li:first")[0],b=$("body > div.ui-page")[0];return new Tooltip(a,{title:"Start exploring here!",container:b,placement:"right",trigger:"manual"})}function disableClicksMomentarily(){}function disableClicks(){MAP&&(ENABLE_MAPCLICK=!1,MAP.dragging.removeHooks(),MAP.touchZoom.removeHooks())}function enableClicks(){MAP&&(ENABLE_MAPCLICK=!0,MAP.dragging.addHooks(),MAP.touchZoom.addHooks())}function switchToMap(a){sidebarCoversMap()&&sidebar.close(),a&&setTimeout(a,100)}function showPhoto(a){$("#photo").prop("src",a),sidebar.open("pane-photo")}function showElevation(a){$("#elevation").prop("src",a),sidebar.open("pane-elevationprofile")}function showAttractionInfo(a){if($("#directions_target_lat").val(a.lat),$("#directions_target_lng").val(a.lng),$("#directions_target_type").val(a.type),$("#directions_target_gid").val(a.gid),$("#directions_target_title").text(a.title),sidebar.open("pane-info"),set_pane_back_button("#pane-info","#pane-browse"),$("#getdirections_disabled").hide(),$("#getdirections_enabled").show(),$("#show_on_map").data("wkt",null),$("#info-content").text("Loading..."),a.gid){var b={};b.type="attraction",b.gid=a.gid,$.get(API_BASEPATH+"ajax/moreinfo",b,function(a){$("#info-content").html(a)},"html")}}function zoomElementClick(a){if(ENABLE_MAPCLICK){disableClicksMomentarily();var b=a.attr("type"),c=a.attr("gid");"reservation_new"==b&&(c=a.attr("record_id")),$("#show_on_map").data("zoomelement",a),$("#directions_target_lat").val(a.attr("lat")),$("#directions_target_lng").val(a.attr("lng")),$("#directions_target_type").val(a.attr("type")),$("#directions_target_gid").val(a.attr("gid")),$("#directions_target_title").text(a.attr("title")),sidebar.open("pane-info");var d=a.attr("backbutton");if(d||(d="#pane-browse"),set_pane_back_button("#pane-info",d),$("#getdirections_disabled").hide(),$("#getdirections_enabled").show(),$("#show_on_map").data("wkt",null),$("#info-content").text("Loading..."),b&&c){var e={};e.type=b,e.gid=c,e.lat=LAST_KNOWN_LOCATION.lat,e.lng=LAST_KNOWN_LOCATION.lng,$.get(API_BASEPATH+"ajax/moreinfo",e,function(a){$("#info-content").html(a);var b=$("#info-content").find("div.wkt");b&&($("#show_on_map").data("wkt",b.text()),b.remove()),SKIP_TO_DIRECTIONS&&($("#directions_car").click(),SKIP_TO_DIRECTIONS=!1)},"html")}else $("#info-content").html($("<h1></h1>").text(a.attr("title"))),$("#directions_car").click()}}function sortLists(a){if(a||(a=$(".sidebar-pane.active ul.distance_sortable").eq(0),a.length)){switch(a.find(".zoom_distance").each(function(){var a=$(this).parent().parent(),b=L.latLng(a.attr("lat"),a.attr("lng")),c=LAST_KNOWN_LOCATION.distanceTo(b),d=LAST_KNOWN_LOCATION.bearingWordTo(b),e=c/1609.344,f=3.2808399*c,g=f>900?e.toFixed(1)+" mi":f.toFixed(0)+" ft";g+=" "+d,$(this).text(g),a.data("meters",c)}),DEFAULT_SORT){case"distance":a.children("li").sort(function(a,b){return $(a).data("meters")>$(b).data("meters")?1:-1});break;case"alphabetical":a.children("li").sort(function(a,b){return $(a).attr("title")>$(b).attr("title")?1:-1})}a.children("li.ui-first-child").removeClass("ui-first-child"),a.children("li").first().addClass("ui-first-child"),a.children("li.ui-last-child").removeClass("ui-last-child"),a.children("li").last().addClass("ui-last-child")}}function zoomToAddress(a){if(!a)return!1;var b={};b.address=a,b.bing_key=BING_API_KEY,b.bbox=GEOCODE_BIAS_BOX,$.get(API_BASEPATH+"ajax/geocode",b,function(a){if(!a)return alert("We couldn't find that address or city.\nPlease try again.");var b=L.latLng(a.lat,a.lng);if(!MAX_BOUNDS.contains(b))return alert("The only results we could find are too far away to zoom the map there.");switchToMap(function(){MAP.setView(b,16),placeTargetMarker(a.lat,a.lng);var c="";c+='<h3 class="popup_title">'+a.title+"</h3>",c+='<span class="fakelink zoom" title="'+a.title+'" lat="'+a.lat+'" lng="'+a.lng+'" w="'+a.w+'" s="'+a.s+'" e="'+a.e+'" n="'+a.n+'" onClick="zoomElementClick( $(this) );">Directions</span>';var d=new L.Popup;d.setLatLng(b),d.setContent(c),MAP.openPopup(d)})},"json")}function WSENtoBounds(a,b,c,d){return L.latLngBounds([[b,a],[d,c]])}function sidebarCoversMap(){return window_width=$(window).width(),window_width<=768}function is_ios(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)}function enableGeolocate(){MAP.locate({watch:!0,enableHighAccuracy:!0})}function toggle_gps_follow(){AUTO_CENTER_ON_LOCATION?disable_gps_follow():enable_gps_follow()}function enable_gps_follow(){AUTO_CENTER_ON_LOCATION=!0;var a=is_ios()?WEBAPP_BASEPATH+"static/images/map_controls/mapbutton_gps_ios_on.png":WEBAPP_BASEPATH+"static/images/map_controls/mapbutton_gps_on.png";$("#mapbutton_gps img").prop("src",a),zoom_to_user_geolocation()}function disable_gps_follow(){AUTO_CENTER_ON_LOCATION=!1;var a=is_ios()?WEBAPP_BASEPATH+"static/images/map_controls/mapbutton_gps_ios_off.png":WEBAPP_BASEPATH+"static/images/map_controls/mapbutton_gps_off.png";$("#mapbutton_gps img").prop("src",a)}function zoom_to_user_geolocation(a){!a&&LAST_KNOWN_LOCATION&&(a=LAST_KNOWN_LOCATION),a&&(placeGPSMarker(a.lat,a.lng),MAP.panTo(a),MAP.getZoom()<12&&MAP.setZoom(16))}function launchNativeExternalDirections(a,b,c,d,e,f,g){var h=[a,b],i=[c,d];"from"==e&&(h=[c,d],i=[a,b]),options={enableDebug:!0,transportMode:j},g||(options.start=h);var j="bus"==f?launchnavigator.TRANSPORT_MODE.TRANSIT:launchnavigator.TRANSPORT_MODE.DRIVING;launchnavigator.navigate(i,options)}function getDirections(a,b,c,d,e,f,g){$("#directions_steps").empty(),disableDirectionsButton(),$("#directions_source_lat").val(a),$("#directions_source_lng").val(b);var h=$("#directions_prefer").val();if(NATIVE_APP&&("car"==f||"bus"==f))return launchNativeExternalDirections(a,b,c,d,e,f,g),void enableDirectionsButton();var i={sourcelat:a,sourcelng:b,targetlat:c,targetlng:d,tofrom:e,via:f,prefer:h,bing_key:BING_API_KEY};$.get(API_BASEPATH+"ajax/directions",i,function(a){if(enableDirectionsButton(),!a||!a.wkt){var b="Could not find directions.";return"hike"!=f&&(b+="\nTry a different type of trail, terrain, or difficulty."),alert(b)}renderDirectionsStructure(a)},"json")}function disableDirectionsButton(){var a=$("#directions_button");a.button("disable"),a.closest(".ui-btn").find(".ui-btn-text").text(a.attr("value0"))}function enableDirectionsButton(){var a=$("#directions_button");a.button("enable"),a.closest(".ui-btn").find(".ui-btn-text").text(a.attr("value1"))}function processGetDirectionsForm(){var a=$("#directions_reverse").val(),b=$("#directions_via").val();"bike"==b&&(b=$("#directions_via_bike").val()),$("#directions_source_gid").val(""),$("#directions_source_type").val(""),$.ajaxSetup({async:!1});var c,d,e=$("#directions_type").val(),f=!1;switch(e){case"gps":f=!0,c=LAST_KNOWN_LOCATION.lat,d=LAST_KNOWN_LOCATION.lng;break;case"geocode":var g=$("#directions_address").val();if(!g)return alert("Please enter an address, city, or landmark.");var h=/^(\d+\.\d+)\,(\-\d+\.\d+)$/.exec(g);if(h)c=parseFloat(h[1]),d=parseFloat(h[2]),getDirections(c,d,j,k,a,b);else{disableDirectionsButton();var i={};i.address=g,i.bing_key=BING_API_KEY,i.bbox=GEOCODE_BIAS_BOX,$.get(API_BASEPATH+"ajax/geocode",i,function(a){if(enableDirectionsButton(),!a)return alert("We couldn't find that address or city.\nPlease try again.");if(c=a.lat,d=a.lng,!MAX_BOUNDS.contains(L.latLng(c,d))){var b="adr."+g,e="pos."+j+"_"+k,f={rtp:b+"~"+e},h="http://bing.com/maps/default.aspx?"+$.param(f),i=$("#directions_steps");return i.empty(),i.append($("<div></div>").html("The address you have chosen is outside of the covered area.<br/>Click the link below to go to Bing Maps for directions.")),void i.append($("<a></a>").text("Click here for directions from Bing Maps").prop("href",h).prop("target","_blank"))}},"json")}break;case"features":disableDirectionsButton();var i={};if(i.keyword=$("#directions_address").val(),i.limit=30,i.lat=LAST_KNOWN_LOCATION.lat,i.lng=LAST_KNOWN_LOCATION.lng,i.via=b,$.get(API_BASEPATH+"ajax/keyword",i,function(a){if(enableDirectionsButton(),!a||!a.length)return alert("We couldn't find any matching landmarks.");for(var b=$("#directions_address").val().replace(/\W/g,"").toLowerCase(),e=0,f=a.length;e<f;e++){if(a[e].name.replace(/\W/g,"").toLowerCase()==b){a=[a[e]];break}}if(a.length>1)return c=null,d=null,void populateDidYouMean(a);var g=a[0].name.replace(/^\s*/,"").replace(/\s*$/,"");$("#directions_address").val(g),$("#directions_source_gid").val(a[0].gid),$("#directions_source_type").val(a[0].type),c=parseFloat(a[0].lat),d=parseFloat(a[0].lng)},"json"),!c||!d)return}var j=parseFloat($("#directions_target_lat").val()),k=parseFloat($("#directions_target_lng").val()),l=$("#directions_source_gid").val(),m=$("#directions_source_type").val();if("poi"==m||"attraction"==m||"reservation"==m||"building"==m||"trail"==m){var n=geocodeLocationForDirections(m,l,j,k,b,"#directions_source_lat","#directions_source_lng");c=n.lat,d=n.lng}var o=$("#directions_target_gid").val(),p=$("#directions_target_type").val();if("poi"==p||"attraction"==p||"reservation"==p||"building"==p||"trail"==p){var q=geocodeLocationForDirections(p,o,c,d,b,"#directions_target_lat","#directions_target_lng");j=q.lat,k=q.lng}if(!j||!k)return alert("Please close the directions panel, and pick a location.");$.ajaxSetup({async:!0}),getDirections(c,d,j,k,a,b,f)}function geocodeLocationForDirections(a,b,c,d,e,f,g){var h=new Object,i={type:a,gid:b,lat:c,lng:d,via:e};return $.get(API_BASEPATH+"ajax/geocode_for_directions",i,function(a){h.lat=a.lat,h.lng=a.lng,$(f).val(a.lat),$(g).val(a.lng)},"json"),h}function populateDidYouMean(a){var b=$("#directions_steps");b.empty();var c=$("<li></li>").addClass("did-you-mean").text("Did you mean:");b.append(c);for(var d=0,e=a.length;d<e;d++){var f=a[d],g=f.name.replace(/^\s*/,"").replace(/\s*$/,""),c=$("<li></li>");c.append($("<span></span>").addClass("ui-li-heading").text(g)).attr("type",f.type).attr("gid",f.gid);var h=function(){$("#directions_address").val($(this).text()),$("#directions_source_gid").val($(this).attr("gid")),$("#directions_source_type").val($(this).attr("type")),$("#directions_button").click()};c.click(h),c.css({cursor:"pointer"}),b.append(c)}b.listview("refresh")}function renderDirectionsStructure(a,b,c){c||(c={}),clearDirectionsLine(),placeDirectionsLine(lineWKTtoFeature(a.wkt,DIRECTIONS_LINE_STYLE),L.latLng(a.start.lat,a.start.lng),L.latLng(a.end.lat,a.end.lng)),DIRECTIONS_LINE.extent=WSENtoBounds(a.bounds.west,a.bounds.south,a.bounds.east,a.bounds.north);var d=DIRECTIONS_LINE.extent.pad(.15);MAP.fitBounds(d),b||(b=$("#directions_steps")),b.empty();for(var e=0,f=a.steps.length;e<f;e++){var g=a.steps[e],h=$("<li></li>"),i=g.stepnumber?g.stepnumber+". "+(g.turnword?g.turnword:"")+" "+g.text:g.turnword+" "+g.text;if(h.append($("<span></span>").addClass("ui-li-heading").text(i)),g.distance&&g.duration&&"0"!=g.distance.substr(0,1)){var j=g.distance+", "+g.duration;h.append($("<span></span>").addClass("ui-li-desc").text(j))}b.append(h)}var k=$("<span></span>").addClass("ui-li-desc").html("");a.retries&&a.retries>3&&k.html("Route may be approximated.");var l=$("<span></span>").addClass("ui-li-heading").html("<b>Total:</b> "+a.totals.distance+", "+a.totals.duration);b.append($("<li></li>").append(l).append(k));var m=$("<div></div>").addClass("directions_functions");if(a.elevationprofile){var n=$("<a></a>").addClass("ui-btn").addClass("ui-btn-inline").addClass("ui-corner-all").prop("id","elevationprofile_button").text("Elevation Profile");n.attr("value1","Elevation Profile").attr("value0","Loading"),n.click(function(){openElevationProfileBySegments()}),m.append(n)}var o=$("<a></a>").addClass("ui-btn").addClass("ui-btn-inline").addClass("ui-corner-all").text("Clear");if(o.click(function(){$("#directions_steps").empty(),clearDirectionsLine(),$(".directions_functions").empty()}),m.append(o),!c.noshare){var p=$("<a></a>").addClass("ui-btn").addClass("ui-btn-inline").addClass("ui-corner-all").prop("id","share_route_button").text("Share");p.click(function(){updateShareUrlByDirections(),populateShareBox(),sidebar.open("pane-share")}),m.append(p)}if(!NATIVE_APP){var q=$("<a></a>").addClass("ui-btn").addClass("ui-btn-inline").addClass("ui-corner-all").text("Print");q.click(function(){$("#button_print").click()}),m.append(q)}b.after(m),ELEVATION_PROFILE=[],a.elevationprofile&&(ELEVATION_PROFILE=a.elevationprofile),b.listview("refresh"),$(".directions_functions img:first").removeClass("ui-li-thumb")}function clearDirectionsLine(){DIRECTIONS_LINE&&(MAP.removeLayer(DIRECTIONS_LINE),DIRECTIONS_LINE=null),MAP.hasLayer(MARKER_FROM)&&(MARKER_FROM.setLatLng(L.latLng(0,0)),MAP.removeLayer(MARKER_FROM)),MAP.hasLayer(MARKER_TO)&&(MARKER_TO.setLatLng(L.latLng(0,0)),MAP.removeLayer(MARKER_TO)),$("#directions_steps").empty(),$("#measure_steps").empty()}function placeDirectionsLine(a,b,c){DIRECTIONS_LINE=a,MAP.addLayer(DIRECTIONS_LINE),MARKER_FROM.setLatLng(b),MAP.addLayer(MARKER_FROM),MARKER_TO.setLatLng(c),MAP.addLayer(MARKER_TO),MARKER_FROM.dragging.disable(),MARKER_TO.dragging.disable()}function openElevationProfileBySegments(){if(ELEVATION_PROFILE){for(var a=[],b=[],c=0,d=ELEVATION_PROFILE.length;c<d;c++)a[a.length]=ELEVATION_PROFILE[c].x,b[b.length]=ELEVATION_PROFILE[c].y;a=a.join(","),b=b.join(","),$.post(API_BASEPATH+"ajax/elevationprofilebysegments",{x:a,y:b},function(a){if(0!=a.indexOf("http"))return alert(a);showElevation(a)})}}function setupShareUrlUpdates(){MAP.on("moveend",updateShareUrl),MAP.on("zoomend",updateShareUrl),MAP.on("layerremove",updateShareUrl),MAP.on("layeradd",updateShareUrl),updateShareUrl()}function populateShareBox(){var a="file"!=URL_PARAMS.attr("protocol")?URL_PARAMS.attr("protocol"):WEBAPP_BASE_URL_ABSOLUTE_PROTOCOL,b=URL_PARAMS.attr("host")?URL_PARAMS.attr("host"):WEBAPP_BASE_URL_ABSOLUTE_HOST,c={uri:"/",querystring:SHARE_URL_STRING};$.get(API_BASEPATH+"ajax/make_shorturl",c,function(c){if(!c)return alert("Unable to fetch a short URL.\nPlease try again.");var d=a+"://"+b+"/url/"+c;$("#share_url").val(d)})}function updateShareUrl(){var a={};a.z=MAP.getZoom(),a.x=MAP.getCenter().lng,a.y=MAP.getCenter().lat,MAP.hasLayer(AVAILABLE_LAYERS.photo)&&(a.base="photo"),(MAP.hasLayer(AVAILABLE_LAYERS.map)||MAP.hasLayer(AVAILABLE_LAYERS.vector))&&(a.base="map"),SHARE_URL_STRING=$.param(a)}function updateShareUrlByFeature(a){var b={};b.type=a.attr("type"),b.name=a.attr("title"),SHARE_URL_STRING=$.param(b)}function updateShareUrlByDirections(){if($("#directions_source_lat").val()){var a={};MAP.hasLayer(AVAILABLE_LAYERS.photo)?a.base="photo":(MAP.hasLayer(AVAILABLE_LAYERS.map)||MAP.hasLayer(AVAILABLE_LAYERS.vector))&&(a.base="map"),a.routevia=$("#directions_via").val(),a.routevia_bike=$("#directions_via_bike").val(),a.routefrom=$("#directions_source_lat").val()+","+$("#directions_source_lng").val(),a.routeto=$("#directions_target_lat").val()+","+$("#directions_target_lng").val(),a.routetitle=$("#directions_target_title").text(),a.whichway=$("#directions_reverse").val(),a.loctype=$("#directions_type").val(),a.fromaddr=$("#directions_address").val(),"trail"==a.routevia&&(a.routevia=$("#directions_via_trail").val()),SHARE_URL_STRING=$.param(a)}}function disableKeywordButton(){var a=$("#search_keyword_button");a.button("disable"),a.closest(".ui-btn").find(".ui-btn-text").text(a.attr("value0"))}function enableKeywordButton(){var a=$("#search_keyword_button");a.button("enable"),a.closest(".ui-btn").find(".ui-btn-text").text(a.attr("value1"))}function strToLatLng(a){var a=a.replace(/\s+$/,"").replace(/^\s+/,"");if(a.match(/^[\d\.\-\,\s]+$/)){var b=a.split(/[\s\,]+/);if(2==b.length&&(b[0]=parseFloat(b[0]),b[1]=parseFloat(b[1]),b[0]&&b[1])){var c,d;return b[0]<0?(c=b[1],d=b[0]):(c=b[0],d=b[1]),L.latLng([c,d])}}var e=a.match(/^N\s*(\d\d)\s+(\d\d\.\d\d\d)\s+W\s*(\d\d\d)\s+(\d\d\.\d\d\d)$/i);if(e){var f=parseInt(e[1]),g=parseInt(e[2]),h=parseInt(e[3]),i=parseInt(e[4]),c=f+g/60,d=-h-i/60;return L.latLng([c,d])}return null}function searchByKeyword(a){var b=strToLatLng(a);if(b)return MAP.setView(b,16),void placeTargetMarker(b.lat,b.lng);var c=$("#keyword_results");c.empty(),disableKeywordButton(),$("#pane-search .sortpicker").hide(),$.get(API_BASEPATH+"ajax/keyword",{keyword:a,limit:100},function(b){if(enableKeywordButton(),$("#pane-search .sortpicker").show(),!b.length)return $("<li></li>").text("No Cleveland Metroparks results found. Trying an address search.").appendTo(c),void zoomToAddress(a);for(var d=0,e=b.length;d<e;d++){var f=b[d],g=$("<li></li>").addClass("zoom").addClass("ui-li-has-count");g.attr("title",f.name).attr("gid",f.gid).attr("type",f.type).attr("w",f.w).attr("s",f.s).attr("e",f.e).attr("n",f.n).attr("lat",f.lat).attr("lng",f.lng),g.attr("backbutton","#pane-search"),link=$("<a></a>"),link.attr("class","ui-btn ui-btn-text"),g.click(function(){zoomElementClick($(this))}),g.append(link),link.append($("<h4></h4>").addClass("ui-li-heading").text(f.name)),link.append($("<span></span>").addClass("ui-li-desc").text(f.description)),link.append($("<span></span>").addClass("zoom_distance").addClass("ui-li-count").addClass("ui-btn-up-c").addClass("ui-btn-corner-all").text("0 mi")),g.append(link),c.append(g)}c.listview("refresh"),sortLists(c)},"json")}function updateNearYouNow(){for(var a=$("#alerts"),b=0,c=ALL_POIS.length;b<c;b++){var d=ALL_POIS[b],e=L.latLng(d.lat,d.lng);d.meters=LAST_KNOWN_LOCATION.distanceTo(e),d.miles=d.meters/1609.344,d.feet=3.2808399*d.meters,d.range=d.feet>900?d.miles.toFixed(1)+" mi":d.feet.toFixed(0)+" ft",d.bearing=LAST_KNOWN_LOCATION.bearingWordTo(e)}ALL_POIS.sort(function(a,b){return a.meters-b.meters});var f=ALL_POIS.slice(0,25);a.empty();for(var b=0,c=f.length;b<c;b++){var d=f[b],g=$("<li></li>").addClass("zoom").addClass("ui-li-has-count");g.attr("title",d.title),g.attr("category",d.categories),g.attr("type","poi").attr("gid",d.gid),g.attr("w",d.w).attr("s",d.s).attr("e",d.e).attr("n",d.n),g.attr("lat",d.lat).attr("lng",d.lng);var h=$("<div></div>").addClass("ui-btn-text");h.append($("<h2></h2>").text(d.title)),h.append($("<p></p>").text(d.categories)),h.append($("<span></span>").addClass("zoom_distance").addClass("ui-li-count").addClass("ui-btn-up-c").addClass("ui-btn-corner-all").text(d.range+" "+d.bearing)),g.click(function(){zoomElementClick($(this))}),g.append(h),a.append(g)}a.listview("refresh")}function placeCircle(a,b,c){MAP.removeLayer(CIRCLE),CIRCLE.setLatLng(L.latLng(a,b)),CIRCLE.setRadius(c),MAP.addLayer(CIRCLE)}function clearCircle(){CIRCLE.setLatLng(L.latLng(0,0)),CIRCLE.setRadius(1),MAP.removeLayer(CIRCLE)}function checkRadar(a,b,c){b=parseFloat(b);for(var d=[],e=0,f=ALL_POIS.length;e<f;e++){var g=ALL_POIS[e],h=a.distanceTo(L.latLng(g.lat,g.lng));if(!(h>b)){if(c){for(var i=g.categories.split("; "),j=!1,k=0,l=i.length;k<l;k++)for(var m=0,n=c.length;m<n;m++)if(c[m]==i[k]){j=!0;break}if(!j)continue}var o=h/1609.344,p=3.2808399*h,q=p>900?o.toFixed(1)+" mi":p.toFixed(0)+" ft";d[d.length]={gid:g.gid,title:g.title,range:q}}}for(var r=!1,e=0,f=d.length;e<f;e++){var s=parseInt(d[e].gid);if(-1==LAST_BEEP_IDS.indexOf(s)){r=!0;break}}LAST_BEEP_IDS=[];for(var e=0,f=d.length;e<f;e++){var s=parseInt(d[e].gid);LAST_BEEP_IDS[LAST_BEEP_IDS.length]=s}if(LAST_BEEP_IDS.sort(),r){document.getElementById("alert_beep").play();for(var t=[],e=0,f=d.length;e<f;e++)t[t.length]=d[e].title+", "+d[e].range;setTimeout(function(){alert(t.join("\n"))},1e3)}}function filterLoops(){$("#loops_list li").show();var a={};a.filter_type=$("#loops_filter_type").val(),a.filter_paved=$("#loops_filter_paved").val(),a.minseconds=60*parseInt($("#loops_filter_duration_min").val()),a.maxseconds=60*parseInt($("#loops_filter_duration_max").val()),a.minfeet=5280*parseInt($("#loops_filter_distance_min").val()),a.maxfeet=5280*parseInt($("#loops_filter_distance_max").val()),a.reservation=$("#loops_filter_reservation").val(),$.get(API_BASEPATH+"ajax/search_loops",a,function(a){var b=$("#loops_list");if(b.empty(),$(".results-notes").remove(),!a||!a.length){b.after('<p class="results-notes">No results.</p>')}for(var c=0,d=a.length;c<d;c++){var e=a[c],f=$("<li></li>").addClass("zoom").addClass("ui-li-has-count");f.attr("title",e.title).attr("gid",e.gid).attr("type","loop").attr("w",e.w).attr("s",e.s).attr("e",e.e).attr("n",e.n).attr("lat",e.lat).attr("lng",e.lng),f.attr("backbutton","#pane-trails"),link=$("<a></a>"),link.attr("class","ui-btn ui-btn-text"),f.click(function(){zoomElementClick($(this))}),f.append(link),link.append($("<h4></h4>").addClass("ui-li-heading").text(e.title)),link.append($("<span></span>").addClass("ui-li-desc").html(e.distance+" &nbsp;&nbsp; "+e.duration)),link.append($("<span></span>").addClass("zoom_distance").addClass("ui-li-count").addClass("ui-btn-up-c").addClass("ui-btn-corner-all").text("0 mi")),f.append(link),b.append(f)}$("#pane-trails .sortpicker").show(),b.listview("refresh"),sortLists(b)},"json")}function printMapPrepare(){$("#print_waiting").show(),$("#print_ready").hide()}function printMapDone(a){$("#print_waiting").hide(),a&&($("#print_link").prop("href",a),$("#print_ready").show())}function printMap(){var a=$("#print_comment").val(),b=$("#print_paper").val(),c="",d="",e="",f=PRINT_SIZES[b][0],g=PRINT_SIZES[b][1],h=MAP.latLngToLayerPoint(MAP.getCenter()),i=wgsToLocalSRS(MAP.layerPointToLatLng(new L.Point(h.x-f/2,h.y+g/2))),j=wgsToLocalSRS(MAP.layerPointToLatLng(new L.Point(h.x+f/2,h.y-g/2))),k=[i[0],i[1],j[0],j[1]],l={format_options:"dpi:300"},m=[];if(MAP.hasLayer(AVAILABLE_LAYERS.photo)){if(MAP.getZoom()<14)return alert("Before printing, zoom in closer.");m[m.length]={baseURL:"http://maps.clevelandmetroparks.com/proxy/ohioimagery",opacity:1,singleTile:!1,type:"WMS",layers:["0"],format:"image/png",styles:[""]}}if((MAP.hasLayer(AVAILABLE_LAYERS.photo)||MAP.hasLayer(AVAILABLE_LAYERS.vector))&&(m[m.length]={baseURL:"http://maps.clevelandmetroparks.com/gwms",opacity:1,singleTile:!0,type:"WMS",layers:["group_basemap"],format:"image/jpeg",styles:[""],customParams:l},m[m.length]={baseURL:"http://maps.clevelandmetroparks.com/gwms",opacity:1,singleTile:!0,type:"WMS",layers:["cm:trails","cm:closures","cm:markers_other","cm:markers_swgh"],format:"image/png",styles:"",customParams:l}),DIRECTIONS_LINE&&MAP.hasLayer(DIRECTIONS_LINE)){var n=[];for(var o in DIRECTIONS_LINE._layers){for(var p=DIRECTIONS_LINE._layers[o],q=[],r=0,s=p._latlngs.length;r<s;r++)q[q.length]=wgsToLocalSRS([p._latlngs[r].lng,p._latlngs[r].lat]);n[n.length]=q}var t=DIRECTIONS_LINE_STYLE.opacity,u=DIRECTIONS_LINE_STYLE.color,v=3;m[m.length]={type:"Vector",name:"Directions Line",opacity:t,styles:{default:{strokeColor:u,strokeWidth:v,strokeLinecap:"round"}},styleProperty:"style_index",geoJson:{type:"FeatureCollection",features:[{type:"Feature",properties:{style_index:"default"},geometry:{type:"MultiLineString",coordinates:n}}]}};var w=ICON_FROM.options.iconUrl.replace("maps.clevelandmetroparks.com","10.0.0.23").replace("https:","http:"),x=wgsToLocalSRS(MARKER_FROM.getLatLng()),y=-10,z=0,A=15;m[m.length]={type:"Vector",name:"Target Marker",opacity:1,styleProperty:"style_index",styles:{default:{externalGraphic:w,fillOpacity:1,pointRadius:A,graphicXOffset:y,graphicYOffset:z}},geoJson:{type:"FeatureCollection",features:[{type:"Feature",properties:{style_index:"default"},geometry:{type:"Point",coordinates:x}}]}};var w=ICON_TO.options.iconUrl.replace("maps.clevelandmetroparks.com","10.0.0.23").replace("https:","http:"),x=wgsToLocalSRS(MARKER_TO.getLatLng()),y=-10,z=0,A=15;m[m.length]={type:"Vector",name:"Target Marker",opacity:1,styleProperty:"style_index",styles:{default:{externalGraphic:w,fillOpacity:1,pointRadius:A,graphicXOffset:y,graphicYOffset:z}},geoJson:{type:"FeatureCollection",features:[{type:"Feature",properties:{style_index:"default"},geometry:{type:"Point",coordinates:x}}]}},b+=" with directions";var B,C=$("#directions_reverse").val(),D="to"==C?"from":"to",E=$("#directions_target_title").text(),F=$("#directions_address").val(),G=$("#directions_via option:selected").text().toLowerCase();C&&D&&E&&F?(c="Directions\n"+C+" "+E+"\n"+D+" "+F+"\n"+G,B=$("#directions_steps li")):(c="Measurement directions",B=$("#measure_steps li"));var H=25;switch(b){case"Letter portrait with directions":H=40;break;case"Letter landscape with directions":H=31;break;case"Ledger portrait with directions":H=65;break;case"Ledger landscape with directions":H=45}d=[],e=[],B.each(function(){var a=$(this).find(".ui-li-heading").eq(0).text(),b=$(this).find(".ui-li-desc").eq(0).text(),c=a+"\n     "+b;d.length<H?d[d.length]=c:e[e.length]=c}),d=d.join("\n"),e=e.join("\n")}if(HIGHLIGHT_LINE&&MAP.hasLayer(HIGHLIGHT_LINE)){for(var n=[],I=HIGHLIGHT_LINE.getLatLngs(),o=0,J=I.length;o<J;o++){var K=[];for(vi=0,vl=I[o].length;vi<vl;vi++)K[K.length]=wgsToLocalSRS([I[o][vi].lng,I[o][vi].lat]);n[n.length]=K}var t=HIGHLIGHT_LINE_STYLE.opacity,u=HIGHLIGHT_LINE_STYLE.color,v=3;m[m.length]={type:"Vector",name:"Highlight Line",opacity:t,styles:{default:{strokeColor:u,strokeWidth:v,strokeLinecap:"round"}},styleProperty:"style_index",geoJson:{type:"FeatureCollection",features:[{type:"Feature",properties:{style_index:"default"},geometry:{type:"MultiLineString",coordinates:n}}]}};if("loop"==$("#show_on_map").data("zoomelement").attr("type")){var B=$("#moreinfo_steps li");b+=" with directions",c=$("#show_on_map").data("zoomelement").attr("title");var H=25;switch(b){case"Letter portrait with directions":H=40;break;case"Letter landscape with directions":H=31;break;case"Ledger portrait with directions":H=65;break;case"Ledger landscape with directions":H=45}d=[],e=[],B.each(function(){var a=$(this).find(".ui-li-heading").eq(0).text(),b=$(this).find(".ui-li-desc").eq(0).text(),c=a+"\n     "+b;d.length<H?d[d.length]=c:e[e.length]=c}),d=d.join("\n"),e=e.join("\n")}}if(MARKER_TARGET&&MAP.hasLayer(MARKER_TARGET)){var w=ICON_TARGET.options.iconUrl,x=wgsToLocalSRS(MARKER_TARGET.getLatLng()),y=-10,z=0,A=15;m[m.length]={type:"Vector",name:"Target Marker",opacity:1,styleProperty:"style_index",styles:{default:{externalGraphic:w,fillOpacity:1,pointRadius:A,graphicXOffset:y,graphicYOffset:z}},geoJson:{type:"FeatureCollection",features:[{type:"Feature",properties:{style_index:"default"},geometry:{type:"Point",coordinates:x}}]}}}var M={units:"feet",srs:"EPSG:3734",layout:b,dpi:300,layers:m,pages:[{bbox:k,rotation:"0",comment:a}],layersMerging:!0,page2title:c,page2text1:d,page2text2:e};printMapPrepare(),$.ajax({url:PRINT_URL,type:"POST",data:JSON.stringify(M),processData:!1,contentType:"application/json",success:function(a){var b=a.getURL;b=b.split("/"),b=b[b.length-1],b=PRINT_PICKUP_BASEURL+b,printMapDone(b)},error:function(a,b,c){alert("Printing failed. Please try again."),printMapDone()}})}function wgsToLocalSRS(a){var b=new Proj4js.Proj("EPSG:4326"),c=new Proj4js.Proj("EPSG:3734"),d=a.lat?new Proj4js.Point(a.lng,a.lat):new Proj4js.Point(a[0],a[1]);return Proj4js.transform(b,c,d),[d.x,d.y]}var WEBAPP_BASEPATH="/",API_BASEPATH="/",MAP=null,WEBAPP_BASE_URL_ABSOLUTE_PROTOCOL="https",WEBAPP_BASE_URL_ABSOLUTE_HOST="maps.clevelandmetroparks.com",WEBAPP_BASE_URL_ABSOLUTE=WEBAPP_BASE_URL_ABSOLUTE_PROTOCOL+"://"+WEBAPP_BASE_URL_ABSOLUTE_HOST+"/",NATIVE_APP=!1,BBOX_SOUTHWEST=L.latLng(41.11816,-82.08504),BBOX_NORTHEAST=L.latLng(41.70009,-81.28029),MAX_BOUNDS=L.latLngBounds(BBOX_SOUTHWEST,BBOX_NORTHEAST),MIN_ZOOM=10,MAX_ZOOM=18,DEFAULT_POI_ZOOM=15,GEOCODE_BIAS_BOX="41.202048178648, -81.9627793163304, 41.5885467839419, -81.386224018357",PRINT_URL="/pdf/create.json",PRINT_PICKUP_BASEURL="/pdf/",BING_API_KEY="AjBuYw8goYn_CWiqk65Rbf_Cm-j1QFPH-gGfOxjBipxuEB2N3n9yACKu5s8Dl18N",PRINT_SIZES={"Letter portrait":[580,714],"Letter landscape":[762,526],"Ledger portrait":[744,1126],"Ledger landscape":[1178,690]};const MAPBOX_TOKEN="pk.eyJ1IjoiY2xldmVsYW5kLW1ldHJvcGFya3MiLCJhIjoiWHRKaDhuRSJ9.FGqNSOHwiCr2dmTH2JTMAA";L.mapbox.accessToken=MAPBOX_TOKEN;const MAPBOX_MAP_URL_FRAG="cleveland-metroparks/cisvvmgwe00112xlk4jnmrehn";var LAYER_MAPBOX_MAP=L.tileLayer("https://api.mapbox.com/styles/v1/"+MAPBOX_MAP_URL_FRAG+"/tiles/{z}/{x}/{y}?access_token="+L.mapbox.accessToken,{tileSize:512,zoomOffset:-1,attribution:'© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'});const MAPBOX_SAT_URL_FRAG="cleveland-metroparks/cjcutetjg07892ro6wunp2da9";var LAYER_MAPBOX_SAT=L.tileLayer("https://api.mapbox.com/styles/v1/"+MAPBOX_SAT_URL_FRAG+"/tiles/{z}/{x}/{y}?access_token="+L.mapbox.accessToken,{tileSize:512,zoomOffset:-1,attribution:'© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),LAYER_MAPBOX_GL_MAP=L.mapboxGL({accessToken:MAPBOX_TOKEN,style:"mapbox://styles/"+MAPBOX_MAP_URL_FRAG});const ALL_LAYERS=[LAYER_MAPBOX_MAP,LAYER_MAPBOX_SAT,LAYER_MAPBOX_GL_MAP],AVAILABLE_LAYERS={map:LAYER_MAPBOX_MAP,photo:LAYER_MAPBOX_SAT,vector:LAYER_MAPBOX_GL_MAP};var isMobile=/Mobi/.test(navigator.userAgent),ICON_TARGET=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/marker-target.png",iconSize:[25,41],iconAnchor:[13,41],popupAnchor:[0,-41]}),MARKER_TARGET=L.marker(L.latLng(0,0),{clickable:!1,draggable:!1,icon:ICON_TARGET}),ICON_GPS=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/marker-gps.svg",iconSize:[25,41],iconAnchor:[13,41],popupAnchor:[0,-41]}),MARKER_GPS=L.marker(L.latLng(0,0),{clickable:!1,draggable:!1,icon:ICON_GPS}),ICON_FROM=L.icon({
iconUrl:WEBAPP_BASEPATH+"static/images/markers/measure1.png",iconSize:[20,34],iconAnchor:[10,34]}),ICON_TO=L.icon({iconUrl:WEBAPP_BASEPATH+"static/images/markers/measure2.png",iconSize:[20,34],iconAnchor:[10,34]}),MARKER_FROM=L.marker(L.latLng(0,0),{clickable:!0,draggable:!0,icon:ICON_FROM}),MARKER_TO=L.marker(L.latLng(0,0),{clickable:!0,draggable:!0,icon:ICON_TO}),INFO_POPUP_OPTIONS={className:"info-popup"},INFO_POPUP=L.popup(INFO_POPUP_OPTIONS),CIRCLE=new L.Circle(L.latLng(0,0),1),ELEVATION_PROFILE=null,HIGHLIGHT_LINE=null,HIGHLIGHT_LINE_STYLE={color:"#FF00FF",weight:3,opacity:.75,clickable:!1,smoothFactor:.25},ENABLE_MAPCLICK=!0,SKIP_TO_DIRECTIONS=!1,sidebar=null;$(document).on("mapInitialized",function(){if(sidebar=L.control.sidebar("sidebar").addTo(MAP),"/"!=window.location.pathname&&!window.location.pathname.endsWith("index.html")||""!=window.location.search||sidebarCoversMap()){var a=createStartHereTooltip();setTimeout(a.show,2500),setTimeout(a.dispose,15e3),document.onclick=a.hide}else sidebar.open("pane-welcome")});var LAST_BEEP_IDS=[],LAST_KNOWN_LOCATION=L.latLng(41.3953,-81.673),AUTO_CENTER_ON_LOCATION=!1,DEFAULT_SORT="distance",URL_PARAMS=null;$(window).bind("orientationchange pageshow resize",function(){var a=$(":jqmData(role='page'):visible"),b=$(":jqmData(role='header'):visible"),c=($(":jqmData(role='c=ontent'):visible"),$(window).height()),d=c-b.outerHeight();a.height(d+1),$(":jqmData(role='content')").first().height(d),$("#map_canvas").is(":visible")&&($("#map_canvas").height(d),MAP&&MAP.invalidateSize())}),$(document).ready(function(){if(URL_PARAMS=$.url(),mapOptions={base:URL_PARAMS.param("base"),x:URL_PARAMS.param("x"),y:URL_PARAMS.param("y"),z:URL_PARAMS.param("z")},initMap(mapOptions),URL_PARAMS.param("type")&&URL_PARAMS.param("name")){var a={type:URL_PARAMS.param("type"),name:URL_PARAMS.param("name")};$.get(API_BASEPATH+"ajax/exactnamesearch",a,function(a){if(!(a&&a.s&&a.w&&a.n&&a.e))return alert("Cound not find that feature.");var b=L.latLngBounds(L.latLng(a.s,a.w),L.latLng(a.n,a.e));MAP.fitBounds(b),a.lat&&a.lng?placeTargetMarker(a.lat,a.lng):a.wkt&&(HIGHLIGHT_LINE=lineWKTtoFeature(a.wkt,HIGHLIGHT_LINE_STYLE),MAP.addLayer(HIGHLIGHT_LINE))},"json")}if(URL_PARAMS.param("type")&&URL_PARAMS.param("gid")&&"attraction"==URL_PARAMS.param("type")){var a={gid:URL_PARAMS.param("gid")};$.get(API_BASEPATH+"ajax/get_attraction",a,function(a){if(!a||!a.lat||!a.lng)return alert("Cound not find that feature.");placeTargetMarker(a.lat,a.lng),MAP.flyTo(L.latLng(a.lat,a.lng),DEFAULT_POI_ZOOM),showAttractionInfo(a)},"json")}if(URL_PARAMS.param("routefrom")&&URL_PARAMS.param("routeto")&&URL_PARAMS.param("routevia")){var b=URL_PARAMS.param("routefrom").split(",")[0],c=URL_PARAMS.param("routefrom").split(",")[1],d=URL_PARAMS.param("routeto").split(",")[0],e=URL_PARAMS.param("routeto").split(",")[1],f=URL_PARAMS.param("routevia");sidebar.open("pane-getdirections"),$("#getdirections_disabled").hide(),$("#getdirections_enabled").show(),$("#directions_target_title").text(URL_PARAMS.param("routetitle")),$("#directions_via").val(URL_PARAMS.param("routevia")),$("#directions_via").selectmenu("refresh"),$("#directions_type").val("geocode"),$("#directions_type").selectmenu("refresh"),$("#directions_type_geocode_wrap").show(),$("#directions_address").val(URL_PARAMS.param("routefrom")),$("#directions_target_lat").val(d),$("#directions_target_lng").val(e),$("#directions_via").trigger("change"),$("#directions_address").val(URL_PARAMS.param("fromaddr")),$("#directions_reverse").val(URL_PARAMS.param("whichway")),$("#directions_via_bike").val(URL_PARAMS.param("routevia_bike")),setTimeout(function(){$("#directions_reverse").trigger("change")},1e3),$("#directions_type").val(URL_PARAMS.param("loctype")),getDirections(b,c,d,e,"to",f)}var g=URL_PARAMS.param("base")||"map",h=$('input[name="basemap"][value="photo"]'),i=$('input[name="basemap"][value="map"]');switch(g){case"photo":h.prop("checked",!0).checkboxradio("refresh"),i.prop("checked",!1).checkboxradio("refresh");break;case"map":default:h.prop("checked",!1).checkboxradio("refresh"),i.prop("checked",!0).checkboxradio("refresh")}$.event.trigger({type:"mapReady"})}),$(document).ready(function(){$('input[type="radio"][name="basemap"]').change(function(){changeBasemap($(this).val())})}),$(document).ready(function(){$("div.sortpicker span").click(function(){DEFAULT_SORT=$(this).attr("value"),sortLists()})}),$(document).ready(function(){var a=function(){zoomToAddress($("#geocode_text").val())};$("#geocode_button").click(a),$("#geocode_text").keydown(function(a){13==a.keyCode&&$("#geocode_button").click()})});var showOnMap=function(){var a=$(this).data("zoomelement");if(a){var b=a.attr("w"),c=a.attr("s"),d=a.attr("e"),e=a.attr("n"),f=a.attr("lng"),g=a.attr("lat"),h=a.attr("type"),i=$(this).data("wkt");switchToMap(function(){if(0!=b&&0!=c&&0!=d&&0!=e){var a=L.latLngBounds(L.latLng(c,b),L.latLng(e,d));a=a.pad(.15),MAP.flyToBounds(a)}else MAP.flyTo(L.latLng(g,f),DEFAULT_POI_ZOOM);"poi"!=h&&"attraction"!=h&&"loop"!=h||placeTargetMarker(g,f),i&&(HIGHLIGHT_LINE&&(MAP.removeLayer(HIGHLIGHT_LINE),HIGHLIGHT_LINE=null),HIGHLIGHT_LINE=lineWKTtoFeature(i,HIGHLIGHT_LINE_STYLE),MAP.addLayer(HIGHLIGHT_LINE))})}};$(document).ready(function(){$("#show_on_map").click(showOnMap)}),$(document).ready(function(){var a=function(){zoomElementClick($(this))};$(".zoom").click(a)}),$(document).ready(function(){$(".sidebar-pane-link").click(function(){link=$(this).attr("href"),"#"==link.charAt(0)&&(pane=link.substr(1)),sidebar.open(pane)}),$('#pane-browse li a[href="#pane-activities"]').click(function(){set_pane_back_button("#pane-activities","#pane-browse")}),$('#pane-browse li a[href="#pane-trails"]').click(function(){set_pane_back_button("#pane-trails","#pane-browse"),filterLoops()}),$('.sidebar-tabs li a[href="#pane-radar"]').click(function(){updateNearYouNow()}),$("#pane-activities li a").click(function(){re=/id=(\d*)/;var a=this.hash.match(re);2==a.length&&(activity_id=a[1]),sidebar.open("pane-browse-results"),pane_title=$(this).text().trim(),set_pane_back_button("#pane-browse-results","#pane-activities"),$.get(API_BASEPATH+"ajax/get_attractions_by_activity",{activity_ids:activity_id},function(a){display_attractions_results(pane_title,a)},"json")}),$("#pane-amenities li a").click(function(){re=/amenity_id=(\d*)/;var a=this.hash.match(re);2==a.length&&(amenity_id=a[1]),pane_title=$(this).text().trim(),set_pane_back_button("#pane-browse-results","#pane-amenities"),$.get(API_BASEPATH+"ajax/get_attractions_by_amenity",{amenity_ids:amenity_id},function(a){display_attractions_results(pane_title,a)},"json")}),$("#pane-welcome .welcome-pane-visitorcenters a").click(function(){pane_title="Visitor Centers",set_pane_back_button("#pane-browse-results","#pane-welcome"),$.get(API_BASEPATH+"ajax/get_visitor_centers",null,function(a){display_attractions_results(pane_title,a)},"json")}),$("#pane-welcome .welcome-pane-parks a").click(function(){pane_title="Parks",set_pane_back_button("#pane-browse-results","#pane-welcome"),$.get(API_BASEPATH+"ajax/get_reservations",null,function(a){display_attractions_results(pane_title,a)},"json")}),$("#pane-welcome .welcome-pane-activities a").click(function(){set_pane_back_button("#pane-activities","#pane-welcome")}),$("#pane-welcome .welcome-pane-trails a").click(function(){set_pane_back_button("#pane-trails","#pane-welcome"),filterLoops()}),display_attractions_results=function(a,b){$("#pane-browse-results h1.sidebar-header .title-text").text(a),sidebar.open("pane-browse-results");var c=$("ul#browse_results");c.empty();for(var d=0,e=b.results.length;d<e;d++){var f=b.results[d],g=$("<li></li>").addClass("zoom").attr("title",f.name).attr("gid",f.gid).attr("record_id",f.record_id).attr("type",f.type).attr("w",f.w).attr("s",f.s).attr("e",f.e).attr("n",f.n).attr("lat",f.lat).attr("lng",f.lng).attr("backbutton","#pane-browse-results");link=$("<a></a>"),link.attr("class","ui-btn ui-btn-text"),g.append(link),g.click(function(){zoomElementClick($(this))}),link.append($("<span></span>").addClass("ui-li-heading").text(f.name)),f.note&&link.append($("<span></span>").addClass("ui-li-desc").html(f.note)),link.append($("<span></span>").addClass("zoom_distance").addClass("ui-li-count").addClass("ui-btn-up-c").addClass("ui-btn-corner-all").text("0 mi")),g.append(link),c.append(g)}c.listview("refresh"),sortLists(c)},$('.sidebar-tabs a[href="#pane-share"]').click(function(){populateShareBox()}),$("#share_facebook").click(function(){var a=$("#share_url").val();return a="http://www.facebook.com/share.php?u="+encodeURIComponent(a),$("#share_facebook").prop("href",a),!0}),$("#share_twitter").click(function(){var a=$("#share_url").val();return a="http://twitter.com/home?status="+encodeURIComponent(a),$("#share_twitter").prop("href",a),!0})}),set_pane_back_button=function(a,b){$(".sidebar-back",$(a)).prop("href",b)},$(document).bind("pagechange",function(a,b){}),$(document).ready(function(){$(function(){FastClick.attach(document.getElementById("sidebar"))})}),$(function(){document.addEventListener("deviceready",enableGeolocate,!1)}),$(document).ready(function(){$("#mapbutton_gps").click(function(){toggle_gps_follow()})}),$(document).ready(function(){disable_gps_follow()}),$(document).ready(function(){$("#map_canvas").bind("swipe",function(){disable_gps_follow()})}),$(document).ready(function(){MAP.on("locationfound",function(a){if(LAST_KNOWN_LOCATION=a.latlng,AUTO_CENTER_ON_LOCATION?zoom_to_user_geolocation(a.latlng):placeGPSMarker(a.latlng.lat,a.latlng.lng),updateNearYouNow(),$("#radar_enabled").is(":checked")){var b=$("#radar_radius").val(),c=[];$('input[name="radar_category"]:checked').each(function(){c[c.length]=$(this).val()}),placeCircle(a.latlng.lat,a.latlng.lng,b),checkRadar(a.latlng,b,c)}var d=a.latlng.lat,e=a.latlng.lng,f=d<0?"S":"N",g=e<0?"W":"E",h=Math.abs(parseInt(d)),i=Math.abs(parseInt(e)),j=(60*(Math.abs(d)-Math.abs(parseInt(d)))).toFixed(3),k=(60*(Math.abs(e)-Math.abs(parseInt(e)))).toFixed(3),l=f+" "+h+" "+j+" "+g+" "+i+" "+k;$("#gps_location").text(l)}),NATIVE_APP||enableGeolocate()});var DIRECTIONS_LINE=null,DIRECTIONS_LINE_STYLE={color:"#0000FF",weight:5,opacity:1,clickable:!1,smoothFactor:.25};$(document).ready(function(){function a(a){$("#directions_via").val(a),$("#directions_via").trigger("change"),$("#pane-getdirections").page(),$("#directions_via").selectmenu("refresh"),sidebar.open("pane-getdirections")}$("#directions_hike").click(function(){a("hike")}),$("#directions_bike").click(function(){a("bike")}),$("#directions_bridle").click(function(){a("bridle")}),$("#directions_car").click(function(){a("car")}),$("#directions_bus").click(function(){a("bus")}),$("#directions_type").change(function(){var a=$(this).val(),b=$("#directions_type_geocode_wrap");"gps"==a?b.hide():b.show()}),$("#directions_reverse").change(function(){var a="to"==$(this).val()?"from":"to";$("#directions_type option").each(function(){var b=$(this).text();b=a+" "+b.replace(/^to /,"").replace(/^from /,""),$(this).text(b)}),$("#directions_type").selectmenu("refresh",!0)}),$("#directions_button").click(function(){$("#directions_steps").empty(),$(".directions_functions").remove(),processGetDirectionsForm()}),$("#directions_address").keydown(function(a){13==a.keyCode&&$("#directions_button").click()}),$("#change_directions_target2").click(function(){sidebar.open("pane-browse"),SKIP_TO_DIRECTIONS=!0})}),$(document).ready(function(){$("#getdirections_clear").click(function(){clearDirectionsLine(),$("#directions_steps").empty()}),$("#directions_via").change(function(){switch($("#directions_via_bike_wrap").hide(),$(this).val()){case"bike":$("#directions_via_bike_wrap").show()}})});var SHARE_URL_STRING=null;$(document).on("mapReady",setupShareUrlUpdates),$(document).ready(function(){$("#share_url").click(function(){$(this).select()}),$("#pane-share .copy-to-clipboard").click(function(){$("#share_url").focus(),$("#share_url")[0].setSelectionRange(0,9999),document.execCommand("copy")}),$("#share_feature").click(function(){var a=$("#show_on_map").data("zoomelement");a&&(updateShareUrlByFeature(a),populateShareBox(),sidebar.open("pane-share"))})}),$(document).ready(function(){$("#browse_keyword_button").click(function(){sidebar.open("pane-search"),$("#search_keyword").val($("#browse_keyword").val()),$("#search_keyword_button").click()}),$("#browse_keyword").keydown(function(a){13==a.keyCode&&$("#browse_keyword_button").click()}),$("#search_keyword_button").click(function(){searchByKeyword($("#search_keyword").val())}),$("#search_keyword").keydown(function(a){13==a.keyCode&&$("#search_keyword_button").click()})}),$(document).ready(function(){$.get(API_BASEPATH+"ajax/autocomplete_keywords",{},function(a){$("#browse_keyword").autocomplete({target:$("#browse_keyword_autocomplete"),source:a,callback:function(a){var b=$(a.currentTarget);$("#browse_keyword").val(b.text()),$("#browse_keyword").autocomplete("clear"),$("#browse_keyword_button").click()},minLength:3,matchFromStart:!1}),$("#search_keyword").autocomplete({target:$("#search_keyword_autocomplete"),source:a,callback:function(a){var b=$(a.currentTarget);$("#search_keyword").val(b.text()),$("#search_keyword").autocomplete("clear"),$("#search_keyword_button").click()},minLength:3,matchFromStart:!1})},"json")});var ALL_POIS=[];$(document).ready(function(){$.get(API_BASEPATH+"ajax/load_pois",{},function(a){for(var b=0,c=a.length;b<c;b++)ALL_POIS[ALL_POIS.length]=a[b];updateNearYouNow()},"json")}),L.LatLng.prototype.bearingTo=function(a){var b=L.LatLng.DEG_TO_RAD,c=L.LatLng.RAD_TO_DEG,d=this.lat*b,e=a.lat*b,f=(a.lng-this.lng)*b,g=Math.sin(f)*Math.cos(e),h=Math.cos(d)*Math.sin(e)-Math.sin(d)*Math.cos(e)*Math.cos(f),i=Math.atan2(g,h);return i=parseInt(i*c),i=(i+360)%360},L.LatLng.prototype.bearingWordTo=function(a){var b=this.bearingTo(a),c="";return b>=22&&b<=67?c="NE":b>=67&&b<=112?c="E":b>=112&&b<=157?c="SE":b>=157&&b<=202?c="S":b>=202&&b<=247?c="SW":b>=247&&b<=292?c="W":b>=292&&b<=337?c="NW":(b>=337||b<=22)&&(c="N"),c},$(document).ready(function(){$("#radar_enabled").change(function(){var a=$(this).is(":checked");a?$("#radar_config").show():$("#radar_config").hide(),a||($("#alerts li").slice(0,25).show(),$("#alerts li").slice(25).hide(),clearCircle())})}),$(document).ready(function(){$("#pane-trails").page(),$("#loops_typeicons img").click(function(){var a=$(this),b=a.attr("data-value");$("#loops_filter_type").val(b).trigger("change"),$("#loops_typeicons img").each(function(){var b=$(this).prop("src");$(this).is(a)?b.includes("-on.svg")||(b=b.replace(".svg","-on.svg")):b=b.replace("-on.svg",".svg"),$(this).prop("src",b)})}).first().click(),$("#loops_filter_distancepicker a").click(function(){var a=$(this),b=a.attr("data-min"),c=a.attr("data-max");$("#loops_filter_distance_min").val(b),$("#loops_filter_distance_max").val(c),$("#loops_filter_distancepicker a").each(function(){$(this).is(a)?$(this).addClass("active"):$(this).removeClass("active")}),filterLoops()}),$("#loops_filter_reservation").change(function(){filterLoops()}),$("#loops_filter_distance_min").change(),$("#loops_filter_distance_max").change(),$("#loops_filter_duration_min").change(),$("#loops_filter_duration_max").change(),$("#loops_filter_type").change(function(){switch($(this).val()){case"hike":$(".time_estimate").hide(),$(".time_hike").show(),$(".time_estimate_prefix").hide();break;case"bridle":$(".time_estimate").hide(),$(".time_bridle").show(),$(".time_estimate_prefix").hide();break;case"bike":case"bike_Novice":case"bike_Beginner":case"bike_Intermediate":case"bike_Advanced":case"mountainbike":$(".time_estimate").hide(),$(".time_bike").show(),$(".time_estimate_prefix").hide();break;case"exercise":$(".time_estimate").hide(),$(".time_hike").show(),$(".time_estimate_prefix").hide();break;default:$(".time_estimate").show(),$(".time_estimate_prefix").show()}filterLoops()})});