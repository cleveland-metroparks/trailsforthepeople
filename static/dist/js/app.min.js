var WEBAPP_BASEPATH="/",API_BASEPATH="/",MAP=null,API_NEW_HOST="maps-api.clevelandmetroparks.com",API_NEW_PROTOCOL="https:",API_NEW_BASEPATH="/api/v1/",API_NEW_BASE_URL=API_NEW_PROTOCOL+"//"+API_NEW_HOST+API_NEW_BASEPATH,WEBAPP_BASE_URL_ABSOLUTE_PROTOCOL="https:",WEBAPP_BASE_URL_ABSOLUTE_HOST="maps.clevelandmetroparks.com",WEBAPP_BASE_URL_ABSOLUTE=WEBAPP_BASE_URL_ABSOLUTE_PROTOCOL+"//"+WEBAPP_BASE_URL_ABSOLUTE_HOST+"/",CM_SITE_BASEURL="https://www.clevelandmetroparks.com/",MAX_BOUND_SW=new mapboxgl.LngLat(-82.08504,41.11816),MAX_BOUND_NE=new mapboxgl.LngLat(-81.28029,41.70009),MAX_BOUNDS=new mapboxgl.LngLatBounds(MAX_BOUND_SW,MAX_BOUND_NE),DEFAULT_POI_ZOOM=15,GEOCODE_BIAS_BOX="41.202048178648, -81.9627793163304, 41.5885467839419, -81.386224018357",PRINT_URL="/pdf/create.json",PRINT_PICKUP_BASEURL="/pdf/",BING_API_KEY="AjBuYw8goYn_CWiqk65Rbf_Cm-j1QFPH-gGfOxjBipxuEB2N3n9yACKu5s8Dl18N",PRINT_SIZES={"Letter portrait":[580,714],"Letter landscape":[762,526],"Ledger portrait":[744,1126],"Ledger landscape":[1178,690]},START_CENTER=[-81.673,41.3953],START_ZOOM=14;mapboxgl.accessToken="pk.eyJ1IjoiY2xldmVsYW5kLW1ldHJvcGFya3MiLCJhIjoiWHRKaDhuRSJ9.FGqNSOHwiCr2dmTH2JTMAA";var ctrlGeolocate,STYLE_LAYER_CM_MAP="mapbox://styles/cleveland-metroparks/cisvvmgwe00112xlk4jnmrehn",STYLE_LAYER_CM_SAT="mapbox://styles/cleveland-metroparks/cjcutetjg07892ro6wunp2da9",STYLE_LAYERS={map:STYLE_LAYER_CM_MAP,photo:STYLE_LAYER_CM_SAT},DEFAULT_LAYER="map",STYLE_NAMES={"CM Light":"map","CM-Aerial":"photo"},isMobile=/Mobi/.test(navigator.userAgent),MARKER_TARGET=new mapboxgl.Marker({color:"#207FD0"}),MARKER_START=new mapboxgl.Marker({color:"#6BB03E"}),MARKER_END=new mapboxgl.Marker({color:"#FF7866"}),SKIP_TO_DIRECTIONS=!1,SETTINGS=[];function initMap(t){var e;switch(t.base||DEFAULT_LAYER){case"photo":e=STYLE_LAYER_CM_SAT;break;case"map":default:e=STYLE_LAYER_CM_MAP}MAP=new mapboxgl.Map({container:"map_canvas",style:e,center:START_CENTER,zoom:START_ZOOM,preserveDrawingBuffer:!0});var a=new mapboxgl.NavigationControl;MAP.addControl(a,"bottom-right"),ctrlGeolocate=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:0!=t.trackUserLocation}),MAP.addControl(ctrlGeolocate,"bottom-right");var n=new mapboxgl.ScaleControl({maxWidth:80,unit:"imperial"});if(MAP.addControl(n,"bottom-left"),t.lat&&t.lng&&t.zoom){var i=parseFloat(t.lat),r=parseFloat(t.lng),o=parseInt(t.zoom);MAP.setCenter([r,i]),MAP.setZoom(o),t.drop_marker&&(MAP.addLayer(MARKER_TARGET),placeMarker(MARKER_TARGET,r,i))}else MAP.fitBounds(MAX_BOUNDS);$.event.trigger({type:"mapInitialized"})}function placeMarker(t,e,a){t.setLngLat([a,e]).addTo(MAP)}function clearMarker(t){t.remove()}function showInfoPopup(t,e){switch(e){case"warning":classes="info-popup warning";break;case"error":classes="info-popup error";break;default:classes="info-popup"}new mapboxgl.Popup({closeOnClick:!1,className:classes}).setLngLat(MAP.getCenter()).setHTML(t).addTo(MAP)}function changeBasemap(t){active_layer=STYLE_LAYERS[t],MAP.setStyle(active_layer)}function getBasemap(){return style=MAP.getStyle(),STYLE_NAMES[style.name]}function formatCoords(t,e){switch(format=null!=e?e:SETTINGS.coordinate_format,format){case"ddm":return formatCoordsDdm(t);case"dd":return formatCoordsDd(t);case"dms":default:return formatCoordsDms(t)}}function formatCoordsDms(t,e){e=void 0!==e?e:0;var a=t.lat<0?"S":"N",n=t.lng<0?"W":"E";lat_dd=Math.abs(t.lat),lng_dd=Math.abs(t.lng);var i=parseInt(lat_dd),r=parseInt(60*(lat_dd-i)),o=(3600*(lat_dd-i-r/60)).toFixed(e),l=parseInt(lng_dd),s=parseInt(60*(lng_dd-l)),c=(3600*(lng_dd-l-s/60)).toFixed(e);return coordsStr=i+"째 "+r+"' "+o+'" '+a+", "+l+"째 "+s+"' "+c+'" '+n,coordsStr}function formatCoordsDdm(t,e){e=void 0!==e?e:2;var a=t.lat<0?"S":"N",n=t.lng<0?"W":"E",i=Math.abs(t.lat),r=Math.abs(t.lng),o=parseInt(i),l=(60*(i-o)).toFixed(e),s=parseInt(r),c=(60*(r-s)).toFixed(e);return coordsStr=o+"째 "+l+"' "+a+", "+s+"째 "+c+"' "+n,coordsStr}function formatCoordsDd(t,e){return e=void 0!==e?e:4,coordsStr=t.lat.toFixed(e)+", "+t.lng.toFixed(e),coordsStr}function shortenStr(t,e,a){if(t.length<=e)return t;var n=t.substr(0,t.lastIndexOf(" ",e));return a&&(n+="..."),n}function saveWindowURL(t,e){WINDOW_URL=decodeURIComponent(location.pathname+"?"+t),WINDOW_URL_QUERYSTRING=t.toString(),e?window.history.pushState(null,null,WINDOW_URL):window.history.replaceState(null,null,WINDOW_URL)}function setWindowURLQueryStringParameters(t,e,a){var n;n=e?new URLSearchParams:new URLSearchParams(location.search),$.each(t,(function(t,e){n.set(t,e)})),saveWindowURL(n,a)}SETTINGS.coordinate_format="dms";var CM={activities:[],amenities:[],attractions:[],attractions_nearby:[],autocomplete_keywords:[],categories:[],reservations:[],trails:[],visitor_centers:[]},fuseOptions={keys:["title"],includeScore:!0,ignoreLocation:!0},dummySearchItem={title:"title",gid:"gid",type:"type",w:"boxw",s:"boxs",e:"boxe",n:"boxn",lat:"latitude",lng:"longitude",drivingLat:"drivingDestinationLatitude",drivingLng:"drivingDestinationLongitude"},fuse=new Fuse([dummySearchItem],fuseOptions);function activity_icon_filepath(t){var e={1:"bike",2:"swim",3:"boat",4:"hike",5:"fish",6:"archery",7:"xcski",9:"geocache",11:"horse",12:"mtnbike",13:"picnic",14:"",15:"sled",16:"snowshoe",17:"",18:"leafman",19:"geology",20:"history",21:"dine",22:"",23:"leafman",24:"",25:"fitness",26:"",30:"golf",39:"fitness",41:""}[t];return e?"/static/images/activities/"+e+".svg":null}function str_to_bool(t){switch(t){case"Yes":case"yes":case"True":case"true":case"1":case 1:case!0:return!0;case"No":case"no":case"False":case"false":case"0":case 0:case!1:case"":case null:default:return!1}}$.get(API_NEW_BASE_URL+"categories",null,(function(t){for(var e=0;e<t.data.length;e++){var a=t.data[e].categorytypeid;CM.categories[a]={name:t.data[e].name}}$.event.trigger({type:"dataReadyCategories"})}),"json"),$.get(API_NEW_BASE_URL+"amenities",null,(function(t){CM.amenities=t.data;var e={221:"baseball",231:"basketball",280:"boat_rental",14:"drink",243:"playground",13:"restroom",28:"gifts",240:"volleyball"};CM.amenities.forEach((function(t){t.icon=e[t.amenitytypeid]})),$.event.trigger({type:"dataReadyAmenities"})}),"json"),$.get(API_NEW_BASE_URL+"visitor_centers",null,(function(t){CM.visitor_centers=t.data,CM.visitor_centers.forEach((function(t){t.categories=t.categories?t.categories.split("|").map(Number):null,t.amenities=t.amenities?t.amenities.split("|").map(Number):null,t.activities=t.activities?t.activities.split("|").map(Number):null})),$.event.trigger({type:"dataReadyVisitorCenters"})}),"json"),$.get(API_NEW_BASE_URL+"reservations",null,(function(t){CM.reservations=t.data,CM.reservations.forEach((function(t){searchItem={title:t.pagetitle,gid:t.record_id,type:"reservation_new",w:t.boxw,s:t.boxs,e:t.boxe,n:t.boxn,lat:t.latitude,lng:t.longitude,drivingLat:t.drivingdestinationlatitude,drivingLng:t.drivingdestinationlongitude},fuse.add(searchItem)})),$.event.trigger({type:"dataReadyReservations"})}),"json"),$.get(API_NEW_BASE_URL+"attractions",null,(function(t){CM.attractions=t.data,CM.attractions.forEach((function(t){t.categories=t.categories?t.categories.split("|").map(Number):null,t.amenities=t.amenities?t.amenities.split("|").map(Number):null,t.activities=t.activities?t.activities.split("|").map(Number):null})),CM.attractions.forEach((function(t){searchItem={title:t.pagetitle,gid:t.gis_id,type:"attraction",w:null,s:null,e:null,n:null,lat:t.latitude,lng:t.longitude,drivingLat:t.drivingdestinationlatitude,drivingLng:t.drivingdestinationlongitude},fuse.add(searchItem)})),$.event.trigger({type:"dataReadyAttractions"})}),"json"),$.get(API_NEW_BASE_URL+"activities",null,(function(t){for(var e=0;e<t.data.length;e++){var a=t.data[e].eventactivitytypeid;CM.activities[a]=t.data[e],CM.activities[a].icon=activity_icon_filepath(a)}$.event.trigger({type:"dataReadyActivities"})}),"json"),$.get(API_NEW_BASE_URL+"autocomplete_keywords",null,(function(t){for(var e=0;e<t.data.length;e++)CM.autocomplete_keywords.push(t.data[e].word);$.event.trigger({type:"dataReadyAutocompleteKeywords"})}),"json"),$.get(API_NEW_BASE_URL+"trails",null,(function(t){for(var e=0;e<t.data.length;e++)0!==t.data[e].status&&(trail=t.data[e],trail.bike=str_to_bool(trail.bike),trail.hike=str_to_bool(trail.hike),trail.bridle=str_to_bool(trail.bridle),trail.mountainbike=str_to_bool(trail.mountainbike),CM.trails[t.data[e].id]=trail);CM.trails.forEach((function(t){searchItem={title:t.name,gid:t.id,type:"loop",w:t.boxw,s:t.boxs,e:t.boxe,n:t.boxn,lat:t.lat,lng:t.lng},fuse.add(searchItem)})),$.event.trigger({type:"dataReadyTrails"})}),"json"),CM.get_reservation=function(t){for(var e=0;e<CM.reservations.length;e++)if(CM.reservations[e].record_id==t)return CM.reservations[e]},CM.get_attraction=function(t){for(var e=0;e<CM.attractions.length;e++)if(CM.attractions[e].gis_id==t)return CM.attractions[e]},CM.get_attractions_by_activity=function(t){t=(t=Array.isArray(t)?t:[t]).map(Number);var e=[];return CM.attractions.forEach((function(a){for(var n=!0,i=0;i<t.length;i++)if(!a.activities||!a.activities.includes(t[i])){n=!1;break}n&&e.push(a)})),e},CM.get_attractions_by_amenity=function(t){t=(t=Array.isArray(t)?t:[t]).map(Number);var e=[];return CM.attractions.forEach((function(a){for(var n=!0,i=0;i<t.length;i++)if(!a.amenities||!a.amenities.includes(t[i])){n=!1;break}n&&e.push(a)})),e};var WINDOW_URL=null,WINDOW_URL_QUERYSTRING=null,sidebar=null,LAST_BEEP_IDS=[],LAST_KNOWN_LOCATION=mapboxgl.LngLat.convert(START_CENTER),AUTO_CENTER_ON_LOCATION=!1,DEFAULT_SORT="distance";function createStartHereTooltip(){var t=$(".sidebar-tabs ul li:first")[0],e=$("body > div.ui-page")[0];return new Tooltip(t,{title:"Start exploring here!",container:e,placement:"right",trigger:"manual"})}function switchToMap(){sidebarCoversMap()&&sidebar.close()}function loadMapAndStartingState(){var t=new URLSearchParams(location.search),e=t.get("lat")||t.get("y"),a=t.get("lng")||t.get("x"),n=t.get("zoom")||t.get("z");if(mapOptions={base:t.get("base"),lat:e,lng:a,zoom:n,drop_marker:!1},initMap(mapOptions),t.get("type")&&t.get("gid")){var i=t.get("type");switch(i){case"attraction":$(document).on("dataReadyAttractions",(function(){var e=t.get("gid"),a={};if((attraction=CM.get_attraction(e))&&(a.gid=attraction.gis_id,a.title=attraction.pagetitle,a.lat=attraction.latitude,a.lng=attraction.longitude),!a.lat||!a.lng)return alert("Cound not find that feature.");zoomToFeature(a),showFeatureInfo(i,a)}));break;case"reservation_new":$(document).on("dataReadyReservations",(function(){var e=t.get("gid"),a={type:"reservation_new"};if((reservation=CM.get_reservation(e))&&(a.gid=reservation.record_id,a.w=reservation.boxw,a.n=reservation.boxn,a.e=reservation.boxe,a.s=reservation.boxs,a.lat=reservation.latitude,a.lng=reservation.longitude),!(a.w&&a.n&&a.e&&a.s||a.lat&&a.lng))return alert("Cound not find that reservation.");zoomToFeature(a),showFeatureInfo(i,a)}));break;case"loop":$(document).on("dataReadyTrails",(function(){var e={type:"loop",gid:t.get("gid")};showFeatureInfo(i,e)}))}}if("directions"==t.get("action")){var r=t.get("via"),o=t.get("sourceText");o&&$("#source-input").val(o);var l=t.get("sourceLatLng").split(",")[0],s=t.get("sourceLatLng").split(",")[1],c=new mapboxgl.LngLat(s,l);setDirectionsInputLngLat($("#source-input"),c);var d=t.get("targetText");d&&$("#target-input").val(d);var u=t.get("targetLatLng").split(",")[0],p=t.get("targetLatLng").split(",")[1],g=new mapboxgl.LngLat(p,u);setDirectionsInputLngLat($("#target-input"),g),sidebar.open("pane-directions"),getDirections(c,g,r)}var f=t.get("base")||DEFAULT_LAYER,m=$('input[name="basemap"][value="photo"]'),h=$('input[name="basemap"][value="map"]');switch(f){case"photo":m.prop("checked",!0).checkboxradio("refresh"),h.prop("checked",!1).checkboxradio("refresh");break;case"map":default:m.prop("checked",!1).checkboxradio("refresh"),h.prop("checked",!0).checkboxradio("refresh")}$.event.trigger({type:"mapReady"})}function make_image_from_pagethumbnail(t,e){t=t.replace("~/","https://www.clevelandmetroparks.com/");var a=new URL(t),n=a.searchParams.get("width"),i=a.searchParams.get("height"),r=a.searchParams;return new_height=parseInt(i/(n/e)),r.set("width",2*e),r.set("height",2*new_height),{src:a.protocol+"//"+a.hostname+a.pathname+"?"+r.toString(),width:e,height:new_height}}function make_activity_icons_list(t){var e=[];return t.forEach((function(t){CM.activities[t]?e.push({src:CM.activities[t].icon,title:CM.activities[t].pagetitle,alt:CM.activities[t].pagetitle}):console.error("Error in make_activity_icons_list(): Activity "+t+" does not exist.")})),e}function showFeatureInfoContent(t,e){switch(t){case"attraction":var a=CM.get_attraction(e),n=CM.Templates.info_attraction,i=[];a.activities&&(i=make_activity_icons_list(a.activities));var r=[];if(a.pagethumbnail&&(r=make_image_from_pagethumbnail(a.pagethumbnail,320)),a.latitude&&a.longitude){var o=new mapboxgl.LngLat(a.longitude,a.latitude);a.coords_formatted=formatCoords(o)}if(a.cmp_url){var l=a.cmp_url;const t=/^\//;a.main_site_url=CM_SITE_BASEURL+l.replace(t,"")}var s={feature:a,activity_icons:i,img:r};$("#info-content").html(n(s));break;case"reservation_new":var c=CM.get_reservation(e);n=CM.Templates.info_reservation;c.pagethumbnail&&(r=make_image_from_pagethumbnail(c.pagethumbnail,320));s={feature:c,img:r};$("#info-content").html(n(s));break;case"loop":if(e in CM.trails){$.get(API_NEW_BASE_URL+"trail_geometries/"+e,null,(function(t){t.data.geom_geojson&&drawHighlightLine(JSON.parse(t.data.geom_geojson))})),$.get(API_NEW_BASE_URL+"trail_profiles/"+e,null,(function(t){t.data.elevation_profile&&makeElevationProfileChart(t.data.elevation_profile,"elevation-profile-trail")}));var d=CM.trails[e];n=CM.Templates.info_trail,s={feature:d,img_src:"static/images/loops/"+d.id+".jpg"};$("#info-content").html(n(s))}else console.error("Error: loop id: "+e+" does not exist in CM.trails (app_view_trails).")}}function makeElevationProfileChart(t,e){if(!t){if(!CM.elevationProfileData)return;t=CM.elevationProfileData}for(var a=[],n=0,i=t.length;n<i;n++)a.push({x:t[n].x/5280,y:t[n].y});e||(e="elevation-profile");var r=document.getElementById(e).getContext("2d");new Chart(r,{type:"line",data:{datasets:[{label:"Elevation Profile",data:a,pointRadius:0,backgroundColor:"rgba(0, 0, 0, 0.2)",borderColor:"rgba(0, 0, 0, 1)",borderWidth:2,fill:!1}]},options:{plugins:{legend:{display:!1}},responsive:!0,scales:{y:{title:{display:!0,text:"Elevation (feet)",color:"#000"}},x:{type:"linear",title:{display:!0,text:"Distance (miles)",color:"#000"},ticks:{min:0,precision:2}}}}})}function zoomElementClick(t){var e=getFeatureFromElement(t);showFeatureInfo(e.type,e),showOnMap(e)}function setUpDirectionsTarget(t){}function showFeatureInfo(t,e){$("#show_on_map").data("zoomelement",e),$("#show_on_map").data("wkt",null),setUpDirectionsTarget(e),sidebar.open("pane-info"),e.back_url||(e.back_url="#pane-browse"),set_pane_back_button("#pane-info",e.back_url),$("#info-content").text("Loading...");var a=e.gid||e.record_id;a&&showFeatureInfoContent(t,a)}function getFeatureFromElement(t){var e={};return e.title=t.attr("title"),e.w=t.attr("w"),e.s=t.attr("s"),e.e=t.attr("e"),e.n=t.attr("n"),e.lat=t.attr("lat"),e.lng=t.attr("lng"),e.type=t.attr("type"),"reservation_new"==e.type&&t.attr("record_id")?e.gid=t.attr("record_id"):e.gid=t.attr("gid"),e.back_url=t.attr("backbutton"),e}function getListDistances(t){(t||(t=$(".sidebar-pane.active ul.distance_sortable").eq(0)).length)&&t.find(".zoom_distance").each((function(){var t=$(this).parent().parent(),e=new mapboxgl.LngLat(t.attr("lng"),t.attr("lat")),a=distanceTo(LAST_KNOWN_LOCATION,e),n=bearingToInNESW(LAST_KNOWN_LOCATION,e),i=3.2808399*a,r=i>900?(a/1609.344).toFixed(1)+" mi":i.toFixed(0)+" ft";r+=" "+n,$(this).text(r),t.data("meters",a)}))}function sortLists(t,e){if(t||(t=$(".sidebar-pane.active ul.distance_sortable").eq(0)).length){switch(getListDistances(t),e||(e=DEFAULT_SORT),e){case"distance":t.children("li").sort((function(t,e){return $(t).data("meters")>$(e).data("meters")?1:-1}));break;case"alphabetical":t.children("li").sort((function(t,e){return $(t).text()>$(e).text()?1:-1}))}t.children("li.ui-first-child").removeClass("ui-first-child"),t.children("li").first().addClass("ui-first-child"),t.children("li.ui-last-child").removeClass("ui-last-child"),t.children("li").last().addClass("ui-last-child")}}function showWkt(t){drawHighlightLine(new Wkt.Wkt(t).toJson())}function drawHighlightLine(t){clearHighlightLine(),MAP.addLayer({id:"highlightLine",type:"line",source:{type:"geojson",data:t},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#01B3FD","line-width":6,"line-opacity":.75}})}function clearHighlightLine(){MAP.getLayer("highlightLine")&&MAP.removeLayer("highlightLine"),MAP.getSource("highlightLine")&&MAP.removeSource("highlightLine")}function zoomToAddress(t){if(!t)return!1;$.get(API_NEW_BASE_URL+"geocode/"+t,null,(function(t){if(!t.data)return alert("We couldn't find that address or city.\nPlease try again.");var e=new mapboxgl.LngLat(t.data.lng,t.data.lat);if(!MAX_BOUNDS.contains(e))return alert("The only results we could find are too far away to zoom the map there.");switchToMap(),placeMarker(MARKER_TARGET,t.data.lat,t.data.lng),MAP.flyTo({center:e,zoom:DEFAULT_POI_ZOOM});var a='<h3 class="popup_title">'+t.data.title+"</h3>";a+='<span class="fakelink zoom" title="'+t.data.title+'" lat="'+t.data.lat+'" lng="'+t.data.lng+'" w="'+t.data.w+'" s="'+t.data.s+'" e="'+t.data.e+'" n="'+t.data.n+'" onClick="zoomElementClick($(this));">Directions</span>';(new mapboxgl.Popup).setLngLat(e).setHTML(a).addTo(MAP)}),"json")}function showOnMap(t,e){t.type&&t.gid&&0!=t.gid&&setWindowURLQueryStringParameters({type:t.type,gid:t.gid},!1,!0);zoomToFeature(t,e)}function zoomToFeature(t,e){if(clearMarker(MARKER_TARGET),clearHighlightLine(),e&&switchToMap(),t.w&&t.s&&t.e&&t.n&&0!=t.w&&0!=t.s&&0!=t.e&&0!=t.n){var a=new mapboxgl.LngLat(t.w,t.s),n=new mapboxgl.LngLat(t.e,t.n),i=new mapboxgl.LngLatBounds(a,n);MAP.fitBounds(i,{padding:10})}else t.lng&&t.lat&&MAP.flyTo({center:[t.lng,t.lat],zoom:DEFAULT_POI_ZOOM});"poi"!=t.type&&"attraction"!=t.type&&"loop"!=t.type||placeMarker(MARKER_TARGET,t.lat,t.lng),t.wkt&&showWkt(t.wkt)}function setupWindowURLUpdates(){MAP.on("zoomend",updateWindowURLZoom),MAP.on("moveend",updateWindowURLCenter),MAP.on("layerremove",updateWindowURLLayer),MAP.on("layeradd",updateWindowURLLayer)}function updateWindowURLCenter(){var t=MAP.getCenter(),e=t.lat.toFixed(7),a=t.lng.toFixed(7);invalidateWindowURL(),params={lat:e,lng:a},setWindowURLQueryStringParameters(params,!1,!1)}function updateWindowURLZoom(){var t=MAP.getZoom().toFixed(1);invalidateWindowURL(),setWindowURLQueryStringParameters({zoom:t},!1)}function updateWindowURLLayer(){var t=DEFAULT_LAYER;"photo"==getBasemap()&&(t="photo"),invalidateWindowURL(),setWindowURLQueryStringParameters({base:t},!1)}function invalidateWindowURL(){hideShareURL()}function changeCoordinateFormat(t){SETTINGS.coordinate_format=t,localStorage.setItem("coordinateFormat",t)}function getSessionCoordinateFormat(){var t=localStorage.getItem("coordinateFormat");"dms"!=t&&"ddm"!=t&&"dd"!=t||(SETTINGS.coordinate_format=t,$("#coordinate_format input[name=coordinate_format]").prop("checked",!1).checkboxradio("refresh"),$("#coordinate_format input[name=coordinate_format][value="+t+"]").prop("checked",!0).checkboxradio("refresh"),updateUserCoordsDisplay())}function populateSidebarPanes(){$(document).on("dataReadyActivities",(function(){populatePaneActivities()})),$(document).on("dataReadyAmenities",(function(){populatePaneAmenities()})),$(document).on("dataReadyReservations",(function(){populatePaneTrails()}))}function populatePaneActivities(){var t=CM.Templates.pane_activities_item;CM.activities.forEach((function(e){if(e.icon){var a="pois_usetype_"+encodeURIComponent(e.pagetitle);e.link_url="#browse-results?id="+e.eventactivitytypeid+"&category="+a;var n={activity:e};$("#activities-list").append(t(n))}})),$("#activities-list").listview("refresh"),sortLists($("#activities-list"),"alphabetical"),$("#activities-list li a").click((function(){re=/id=(\d*)/;var t=this.hash.match(re);2==t.length&&(activity_id=t[1]),sidebar.open("pane-browse-results"),pane_title=$(this).text().trim(),set_pane_back_button("#pane-browse-results","#pane-activities");var e=CM.get_attractions_by_activity(activity_id);CM.display_attractions_results(pane_title,e,"attraction")}))}function populatePaneAmenities(){var t=CM.Templates.pane_amenities_item;CM.amenities.forEach((function(e){e.link_url="#browse-results?amenity_id="+e.amenitytypeid;var a={amenity:e};$("#amenities-list").append(t(a))})),$("#amenities-list").listview("refresh"),sortLists($("#amenities-list"),"alphabetical"),$("#amenities-list li a").click((function(){re=/amenity_id=(\d*)/;var t=this.hash.match(re);2==t.length&&(amenity_id=t[1]),pane_title=$(this).text().trim(),set_pane_back_button("#pane-browse-results","#pane-amenities");var e=CM.get_attractions_by_amenity(amenity_id);CM.display_attractions_results(pane_title,e,"attraction")}))}function populatePaneTrails(){var t=CM.Templates.pane_trails_reservation_filter_option;CM.reservations.forEach((function(e){var a={reservation:e};$("#loops_filter_reservation").append(t(a))}))}function sidebarCoversMap(){return window_width=$(window).width(),window_width<=768}function basicGeolocate(){navigator.geolocation.getCurrentPosition(geolocateSuccess,null,{enableHighAccuracy:!0})}function geolocateSuccess(t){LAST_KNOWN_LOCATION.lng=t.coords.longitude,LAST_KNOWN_LOCATION.lat=t.coords.latitude}function updateUserCoordsDisplay(){var t=LAST_KNOWN_LOCATION?formatCoords(LAST_KNOWN_LOCATION):"unknown";$("#gps_location").val(t)}function getDirections(t,e,a,n){disableDirectionsButton();var i={sourcelat:sourcelat=parseFloat(t.lat),sourcelng:sourcelng=parseFloat(t.lng),targetlat:targetlat=parseFloat(e.lat),targetlng:targetlng=parseFloat(e.lng)};switch(a){case"car":$.get(API_NEW_BASE_URL+"directions_driving",i,(function(t){renderDirectionsStructure(t.data),updateWindowURLWithDirections()}),"json").fail((function(t,e,a){showInfoPopup("Error getting driving directions.","error"),console.error(e+": "+a)})).always((function(){enableDirectionsButton()}));break;case"bus":$.get(API_NEW_BASE_URL+"directions_transit",i,(function(t){renderDirectionsStructure(t.data),updateWindowURLWithDirections()}),"json").fail((function(t,e,a){showInfoPopup("Error getting transit directions.","error"),console.error(e+": "+a)})).always((function(){enableDirectionsButton()}));break;default:i.via=a,$.get(API_NEW_BASE_URL+"directions_trails",i,(function(t){if(t.data&&t.data.wkt)renderDirectionsStructure(t.data),updateWindowURLWithDirections();else{var e="Could not find directions over trails for this start and endpoint.";"hike"!=a&&(e+="\nTry a different type of trail, terrain, or difficulty."),showInfoPopup(e,"error")}}),"json").fail((function(t,e,a){showInfoPopup("Error getting directions.","error"),console.error(e+": "+a)})).always((function(){enableDirectionsButton()}))}}function disableDirectionsButton(){$("#get-directions").prop("disabled",!0)}function enableDirectionsButton(){$("#get-directions").prop("disabled",!1)}function setDirectionsInputLngLat(t,e,a,n){t.data("lat",e.lat),t.data("lng",e.lng),a?(t.data("trail-lat",a.lat),t.data("trail-lng",a.lng)):(t.removeData("trail-lat"),t.removeData("trail-lng")),n?(t.data("driving-lat",n.lat),t.data("driving-lng",n.lng)):(t.removeData("driving-lat"),t.removeData("driving-lng")),placeMarker("target"==getSourceTargetInputId(t)?MARKER_END:MARKER_START,e.lat,e.lng),zoomToDirectionsBounds()}function setAppropriateDestination(t){useDrivingDestination()?t.data("driving-lat")&&t.data("driving-lat")&&(t.data("lat",t.data("driving-lat")),t.data("lng",t.data("driving-lng"))):t.data("trail-lat")&&t.data("trail-lat")&&(t.data("lat",t.data("trail-lat")),t.data("lng",t.data("trail-lng")))}function useDrivingDestination(){return"hike"!=$("#directions-via").attr("data-value")}function getDirectionsInputLngLat(t){var e=t.data("lat"),a=t.data("lng");if(e&&a)return new mapboxgl.LngLat(a,e)}function clearDirectionsInputData(t,e){t.removeData("lat"),t.removeData("lng"),t.removeData("isFromGeolocation")}function geolocateUserForDirectionsInput(t){basicGeolocate(),isFromGeolocation=!0;var e=LAST_KNOWN_LOCATION;t.val(e.lat+", "+e.lng),setDirectionsInputLngLat(t,e)}function zoomToDirectionsBounds(){var t=new mapboxgl.LngLatBounds,e=getDirectionsInputLngLat($("#source-input"));e&&t.extend(e);var a=getDirectionsInputLngLat($("#target-input"));a&&t.extend(a),(e||a)&&MAP.fitBounds(t,{padding:100})}function geocodeDirectionsInput(t){var e=t.val();return $.ajax({url:API_NEW_BASE_URL+"geocode/"+e,dataType:"json",success:function(e){if(e&&e.data.lng&&e.data.lat){var a=new mapboxgl.LngLat(e.data.lng,e.data.lat);setDirectionsInputLngLat(t,a)}else{console.error("geocodeDirectionsInput(): failure"),showInfoPopup("source"==getSourceTargetInputId(t)?'Can\'t find the source ("From:") address.\nPlease try again.':'Can\'t find the target ("To:") address.\nPlease try again.',"error")}}})}function setRoutingNotes(t){$("#directions-notes").text(t)}function checkDirectionsInput(t){var e=t.val();if(0==e.length)return!1;if(t.data("lat")&&t.data("lng"))return!0;var a=/(^[-+]?(?:[1-8]?\d(?:\.\d+)?|90(?:\.0+)?))\s*,\s*([-+]?(?:180(?:\.0+)?|(?:(?:1[0-7]\d)|(?:[1-9]?\d))(?:\.\d+)?))$/.exec(e);if(a)return setDirectionsInputLngLat(t,new mapboxgl.LngLat(a[2],a[1])),!0;var n=fuse.search(e);if(n.length){var i=n[0].item;if(simplifyTextForMatch(i.title)==simplifyTextForMatch(e))return setInputToKnownFeature(t,i.title,i.lng,i.lat,i.drivingLng,i.drivingLat),!0}return geocodeDirectionsInput(t).fail((function(){console.error("geocode failure")}))}async function processGetDirectionsForm(){clearDirectionsLine(),clearDirectionsSteps();var t=checkDirectionsInput($("#source-input")),e=checkDirectionsInput($("#target-input"));$.when(t,e).done((function(){processDirectionsInputsWithLatLngs()}))}function processDirectionsInputsWithLatLngs(){var t=parseFloat($("#source-input").data("lat")),e=parseFloat($("#source-input").data("lng")),a=new mapboxgl.LngLat(e,t),n=parseFloat($("#target-input").data("lat")),i=parseFloat($("#target-input").data("lng")),r=new mapboxgl.LngLat(i,n),o=!!$("#target-input").data("isFromGeolocation");getDirections(a,r,$("#directions-via").attr("data-value"),o)}function simplifyTextForMatch(t){return t.replace(/\W/g,"").toLowerCase()}function renderDirectionsStructure(t){var e=new mapboxgl.LngLat(t.start.lng,t.start.lat),a=new mapboxgl.LngLat(t.end.lng,t.end.lat);drawDirectionsLine(new Wkt.Wkt(t.wkt).toJson(),e,a);var n=new mapboxgl.LngLat(t.bounds.west,t.bounds.south),i=new mapboxgl.LngLat(t.bounds.east,t.bounds.north),r=new mapboxgl.LngLatBounds(n,i);MAP.fitBounds(r,{padding:10});var o=$("#directions-steps");o.empty();for(var l=0,s=t.steps.length;l<s;l++){var c=t.steps[l],d=$("<li></li>"),u=l+1+". "+(c.step_action?c.step_action:"")+" "+c.text;if(d.append($("<span></span>").addClass("ui-li-heading").text(u)),c.distance&&c.duration){var p=c.distance+", "+c.duration;d.append($("<span></span>").addClass("ui-li-desc").text(p))}o.append(d)}var g=$("<span></span>").addClass("ui-li-desc").html("");t.retries&&t.retries>3&&g.html("Route may be approximated.");var f=$("<span></span>").addClass("ui-li-heading").html("<b>Total:</b> "+t.totals.distance+", "+t.totals.duration);o.append($("<li></li>").append(f).append(g));var m=$("<div></div>").addClass("directions-functions");if(t.elevationprofile){var h=$("<a></a>").addClass("ui-btn").addClass("ui-btn-inline").addClass("ui-corner-all").prop("id","elevationprofile_button").text("Elevation Profile");h.attr("value1","Elevation Profile").attr("value0","Loading"),h.click((function(){makeElevationProfileChart(),sidebar.open("pane-elevationprofile")})),m.append(h)}var _=$("<a></a>").addClass("ui-btn").addClass("ui-btn-inline").addClass("ui-corner-all").text("Clear");_.click((function(){clearDirectionsLine(),clearDirectionsMarkers(),clearDirectionsSteps()})),m.append(_);var v=$("<a></a>").addClass("ui-btn").addClass("ui-btn-inline").addClass("ui-corner-all").prop("id","share_route_button").text("Share");v.click((function(){makeAndShowShortURL(),sidebar.open("pane-share")})),m.append(v);var b=$("<a></a>").addClass("ui-btn").addClass("ui-btn-inline").addClass("ui-corner-all").text("Print");b.click((function(){$("#button_print").click()})),m.append(b),o.after(m),CM.elevationProfileData=[],t.elevationprofile&&(CM.elevationProfileData=t.elevationprofile),o.listview("refresh")}function updateWindowURLWithDirections(){var t={};t.base="photo"==getBasemap()?"photo":"map",t.action="directions";var e=$("#directions-via").attr("data-value");t.via=e||"hike",t.sourceText=$("#source-input").val();var a=parseFloat($("#source-input").data("lat")),n=parseFloat($("#source-input").data("lng"));a&&n&&(t.sourceLatLng=a+","+n),t.targetText=$("#target-input").val();var i=parseFloat($("#target-input").data("lat")),r=parseFloat($("#target-input").data("lng"));i&&r&&(t.targetLatLng=i+","+r),setWindowURLQueryStringParameters(t,!0,!0)}function drawDirectionsLine(t,e,a){clearDirectionsLine(),clearDirectionsMarkers(),placeMarker(MARKER_START,e.lat,e.lng),placeMarker(MARKER_END,a.lat,a.lng),MAP.addLayer({id:"directionsLine",type:"line",source:{type:"geojson",data:t},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#0000FF","line-width":6,"line-opacity":.5}})}function clearDirectionsLine(){MAP.getLayer("directionsLine")&&MAP.removeLayer("directionsLine"),MAP.getSource("directionsLine")&&MAP.removeSource("directionsLine")}function clearDirectionsMarkers(){clearMarker(MARKER_START),clearMarker(MARKER_END)}function clearDirectionsSteps(){$("#directions-steps").empty(),$(".directions-functions").remove()}function launchGetDirections(t){$("#directions-via a[data-value='"+t+"']").click(),sidebar.open("pane-directions")}function getSourceTargetInputId(t){if(t.attr("data-value-sourcetarget"))return t.attr("data-value-sourcetarget")}function setInputToKnownFeature(t,e,a,n,i,r){t.val(e);var o,l=new mapboxgl.LngLat(a,n);i&&r&&(o=new mapboxgl.LngLat(i,r)),setDirectionsInputLngLat(t,useDrivingDestination()&&o?o:l,l,o)}function showShareURL(){$("#share_url_controls").show(),$("#make_share_url_controls").hide(),setShareURLBoxWidth()}function hideShareURL(){$("#share_url_controls").hide(),$("#make_share_url_controls").show()}function makeAndShowShortURL(){var t=WINDOW_URL;"/"==t.charAt(0)&&(t=t.substr(1)),"?"==t.charAt(0)&&(t=t.substr(1));var e={querystring:t="/?"+t};$.post(API_NEW_BASE_URL+"shorturls",e,(function(t){var e=new URL(location.href),a=("file:"!=e.protocol?e.protocol:WEBAPP_BASE_URL_ABSOLUTE_PROTOCOL)+"//"+(e.host?e.host:WEBAPP_BASE_URL_ABSOLUTE_HOST)+"/url/"+t.data.shortcode;$("#share_url").val(a),showShareURL()})).fail((function(){alert("Unable to fetch a short URL.\nPlease try again.")}))}function setShareURLBoxWidth(){var t=$("#share_url_controls").width(),e=$("#pane-share .copy-to-clipboard").outerWidth(),a=$("#share_url_controls .ui-input-text"),n=t-e-(a.outerWidth()-a.width());a.width(n)}function createCopiedToClipboardTooltip(t,e){return new Tooltip(t,{title:"Copied to clipboard.",container:e,placement:"bottom",trigger:"manual"})}function disableKeywordButton(){var t=$("#search_keyword_button");t.button("disable"),t.closest(".ui-btn").find(".ui-btn-text").text(t.attr("value0"))}function enableKeywordButton(){var t=$("#search_keyword_button");t.button("enable"),t.closest(".ui-btn").find(".ui-btn-text").text(t.attr("value1"))}function strToLngLat(t){if((t=t.replace(/\s+$/,"").replace(/^\s+/,"")).match(/^[\d\.\-\,\s]+$/)){var e=t.split(/[\s\,]+/);if(2==e.length)if(e[0]=parseFloat(e[0]),e[1]=parseFloat(e[1]),e[0]&&e[1])return e[0]<0?(n=e[1],i=e[0]):(n=e[0],i=e[1]),new mapboxgl.LngLat(i,n)}var a=t.match(/^N\s*(\d\d)\s+(\d\d\.\d\d\d)\s+W\s*(\d\d\d)\s+(\d\d\.\d\d\d)$/i);if(a){var n=parseInt(a[1])+parseInt(a[2])/60,i=-parseInt(a[3])-parseInt(a[4])/60;return new mapboxgl.LngLat(i,n)}return null}function searchByKeyword(t){var e=strToLngLat(t);if(e)return MAP.flyTo({center:e,zoom:16}),void placeMarker(MARKER_TARGET,e.lat,e.lng);var a=$("#keyword_results");a.empty(),disableKeywordButton(),$("#pane-search .sortpicker").hide();var n=fuse.search(t);enableKeywordButton(),$("#pane-search .sortpicker").show();var i=n.filter(t=>t.score<.5);if(!i.length)return $("<li></li>").text("No Cleveland Metroparks results found. Trying an address search.").appendTo(a),void zoomToAddress(t);for(var r=0,o=i.length;r<o;r++){var l=i[r];if(l.item.lat&&l.item.lng){var s=$("<li></li>").addClass("zoom").addClass("ui-li-has-count");s.attr("title",l.item.title).attr("gid",l.item.gid).attr("type",l.item.type).attr("w",l.item.w).attr("s",l.item.s).attr("e",l.item.e).attr("n",l.item.n).attr("lat",l.item.lat).attr("lng",l.item.lng),s.attr("backbutton","#pane-search"),link=$("<a></a>"),link.attr("class","ui-btn ui-btn-text"),s.click((function(){zoomElementClick($(this))})),s.append(link),link.append($("<h4></h4>").addClass("ui-li-heading").text(l.item.title)),resultTypeNames[l.item.type]&&link.append($("<span></span>").addClass("ui-li-desc").text(resultTypeNames[l.item.type])),link.append($("<span></span>").addClass("zoom_distance").addClass("ui-li-count").addClass("ui-btn-up-c").addClass("ui-btn-corner-all").text("0 mi")),s.append(link),a.append(s)}}a.listview("refresh"),getListDistances(a)}$(document).on("mapInitialized",(function(){if(sidebar||(sidebar=$("#sidebar").sidebar()),"/"!=window.location.pathname||""!=window.location.search||sidebarCoversMap()){var t=createStartHereTooltip();setTimeout(t.show,2500),setTimeout(t.dispose,15e3),$(document).click((function(){t.hide()}))}else sidebar.open("pane-welcome")})),$(document).ready((function(){loadMapAndStartingState(),populateSidebarPanes()})),window.onpopstate=function(){loadMapAndStartingState()},$(document).ready((function(){$('input[type="radio"][name="basemap"]').change((function(){changeBasemap($(this).val())}))})),$(document).ready((function(){$("div.sortpicker span").click((function(){DEFAULT_SORT=$(this).attr("value"),sortLists()}))})),$(document).ready((function(){$(".zoom").click((function(){zoomElementClick($(this))}))})),$(document).ready((function(){$("#geocode_button").click((function(){zoomToAddress($("#geocode_text").val())})),$("#geocode_text").keydown((function(t){13==t.keyCode&&$("#geocode_button").click()}))})),$(document).ready((function(){$("#show_on_map").click((function(){var t=$(this).data("zoomelement");t&&(t.wkt=$(this).data("wkt"),showOnMap(t,!0))}))})),$(document).on("mapReady",setupWindowURLUpdates),$(document).ready((function(){$('input[type="radio"][name="coordinate_format"]').change((function(){changeCoordinateFormat($(this).val()),updateUserCoordsDisplay()}))})),$(document).ready((function(){getSessionCoordinateFormat()})),$(document).on("mapReady",(function(){MAP.on("mousemove",(function(t){var e=MAP.queryRenderedFeatures(t.point);document.getElementById("debug-features").innerHTML=JSON.stringify(e,null,2)}))})),$(document).ready((function(){$(".sidebar-pane-link").click((function(){link=$(this).attr("href"),"#"==link.charAt(0)&&(pane=link.substr(1)),sidebar.open(pane)})),$('#pane-browse li a[href="#pane-activities"]').click((function(){set_pane_back_button("#pane-activities","#pane-browse")})),$('#pane-browse li a[href="#pane-trails"]').click((function(){set_pane_back_button("#pane-trails","#pane-browse"),doTrailSearch()})),$('.sidebar-tabs li a[href="#pane-nearby"]').click((function(){updateNearYouNow()})),$("#pane-welcome .welcome-pane-visitorcenters a").click((function(){pane_title="Visitor Centers",set_pane_back_button("#pane-browse-results","#pane-welcome"),CM.display_attractions_results(pane_title,CM.visitor_centers,"attraction")})),$("#pane-welcome .welcome-pane-parks a").click((function(){pane_title="Parks",set_pane_back_button("#pane-browse-results","#pane-welcome"),CM.display_attractions_results(pane_title,CM.reservations,"reservation_new")})),$("#pane-welcome .welcome-pane-activities a").click((function(){set_pane_back_button("#pane-activities","#pane-welcome")})),$("#pane-welcome .welcome-pane-trails a").click((function(){set_pane_back_button("#pane-trails","#pane-welcome"),doTrailSearch()})),$("#share_facebook").click((function(){var t=$("#share_url").val();return t="http://www.facebook.com/share.php?u="+encodeURIComponent(t),$("#share_facebook").prop("href",t),!0})),$("#share_twitter").click((function(){var t=$("#share_url").val();return t="http://twitter.com/home?status="+encodeURIComponent(t),$("#share_twitter").prop("href",t),!0}))})),CM.display_attractions_results=function(t,e,a){$("#pane-browse-results h1.sidebar-header .title-text").text(t),sidebar.open("pane-browse-results");var n=$("ul#browse_results");n.empty();for(var i=0,r=e.length;i<r;i++){var o=e[i],l=$("<li></li>").addClass("zoom").attr("title",o.pagetitle).attr("gid",o.gis_id).attr("record_id",o.record_id).attr("type",a).attr("w",o.boxw).attr("s",o.boxs).attr("e",o.boxe).attr("n",o.boxn).attr("lat",o.latitude).attr("lng",o.longitude).attr("backbutton","#pane-browse-results");link=$("<a></a>"),link.attr("class","ui-btn ui-btn-text"),l.append(link),l.click((function(){zoomElementClick($(this))})),link.append($("<span></span>").addClass("ui-li-heading").text(o.pagetitle)),link.append($("<span></span>").addClass("zoom_distance").addClass("ui-li-count").addClass("ui-btn-up-c").addClass("ui-btn-corner-all").text("0 mi")),l.append(link),n.append(l)}n.listview("refresh"),sortLists(n)},set_pane_back_button=function(t,e){$(".sidebar-back",$(t)).prop("href",e)},$(document).bind("pagechange",(function(t,e){})),$(document).ready((function(){$((function(){FastClick.FastClick.attach(document.getElementById("sidebar"))}))})),$(document).on("mapInitialized",(function(){ctrlGeolocate.on("geolocate",(function(t){if(geolocateSuccess(t),updateNearYouNow(),$("#nearby_enabled").is(":checked")){var e=$("#nearby-radius").val(),a=[];$('input[name="nearby-category"]:checked').each((function(){a[a.length]=$(this).val()}));var n=mapboxgl.LngLat.convert([t.coords.longitude,t.coords.latitude]);placeCircle(n,e),checkNearby(n,e,a)}updateUserCoordsDisplay()})),basicGeolocate()})),$(document).ready((function(){$("#directions_hike").click((function(){launchGetDirections("hike")})),$("#directions_bike").click((function(){launchGetDirections("bike")})),$("#directions_car").click((function(){launchGetDirections("car")})),$("#directions_bus").click((function(){launchGetDirections("bus")})),$("#source-geolocate-btn").click((function(){geolocateUserForDirectionsInput($("#source-input"))})),$("#get-directions").click((function(){processGetDirectionsForm()})),$(".via-buttons a").click((function(){$(this).parent().attr("data-value",$(this).attr("data-value")),$(this).parent().children().removeClass("active"),$(this).addClass("active"),setAppropriateDestination($("#source-input")),setAppropriateDestination($("#target-input")),processGetDirectionsForm()})),$(".feature-search-autocomplete").on("filterablebeforefilter",(function(t,e){var a=$(this),n=$(e.input),i=n.val(),r="";if(a.html(""),clearDirectionsInputData(n),i&&i.length>2){var o=fuse.search(i);o&&($.each(o,(function(t,e){var a="";a+="<li>",a+='<a href="#" data-transition="fade" class="ui-btn"',a+='data-value-lat="'+e.item.lat+'" ',a+='data-value-lng="'+e.item.lng+'" ',a+='data-value-drivinglat="'+e.item.drivingLat+'" ',a+='data-value-drivinglng="'+e.item.drivingLng+'" ',a+=">"+e.item.title+"</a>",r+=a+="</li>"})),a.html(r),a.show(),a.listview("refresh").trigger("updatelayout"),a.children().each((function(){$(this).click((function(){setInputToKnownFeature(n,$(this).text(),$(this).children("a").attr("data-value-lng"),$(this).children("a").attr("data-value-lat"),$(this).children("a").attr("data-value-drivinglng"),$(this).children("a").attr("data-value-drivinglat")),a.hide()}))})))}}))})),$(document).ready((function(){hideShareURL(),$("#share_url").click((function(){$(this).select()})),$("#make_share_url_btn").click((function(){makeAndShowShortURL()}))})),$(document).ready((function(){$(".copy-to-clipboard").click((function(){var t=$(this).attr("data-copy-id"),e=$(this).closest(".sidebar-pane")[0],a=$("#"+t);a.focus(),a.select(),a[0].setSelectionRange(0,9999),document.execCommand("copy");var n=createCopiedToClipboardTooltip(a[0],e);n.show(),$(document).on("click",(function(t){$(t.target).closest(".copy-to-clipboard").length||n.hide()}))}))})),$(document).ready((function(){$("#browse_keyword_button").click((function(){sidebar.open("pane-search"),$("#search_keyword").val($("#browse_keyword").val()),$("#search_keyword_button").click()})),$("#browse_keyword").keydown((function(t){13==t.keyCode&&$("#browse_keyword_button").click()})),$("#search_keyword_button").click((function(){searchByKeyword($("#search_keyword").val())})),$("#search_keyword").keydown((function(t){13==t.keyCode&&$("#search_keyword_button").click()}))}));var resultTypeNames={attraction:"Attraction",loop:"Trail",reservation:"Reservation",reservation_new:"Reservation"};function turfPointToLngLat(t){return mapboxgl.LngLat.convert(t.geometry.coordinates)}function distanceTo(t,e){var a=turf.point(t.toArray()),n=turf.point(e.toArray());return turf.distance(a,n,{units:"meters"})}function bearingTo(t,e){var a=turf.point(t.toArray()),n=turf.point(e.toArray());return turf.bearing(a,n,{final:!0})}function bearingToInNESW(t,e){var a=bearingTo(t,e);return a>=22&&a<=67?"NE":a>=67&&a<=112?"E":a>=112&&a<=157?"SE":a>=157&&a<=202?"S":a>=202&&a<=247?"SW":a>=247&&a<=292?"W":a>=292&&a<=337?"NW":a>=337||a<=22?"N":void 0}function addActivityTypesToNearby(){var t='<fieldset id="nearby-activities" data-role="controlgroup">';$.each(CM.activities,(function(e,a){a&&a.pagetitle&&(t+='<label><input type="checkbox" name="nearby-category" value="'+a.pagetitle+'">'+a.pagetitle+"</label>")})),t+="</fieldset>",$(".form-group-wrapper").append(t).enhanceWithin()}function updateNearYouNow(){for(var t=$("#alerts"),e=0,a=CM.attractions_nearby.length;e<a;e++){var n=CM.attractions_nearby[e],i=new mapboxgl.LngLat(n.longitude,n.latitude);n.meters=distanceTo(LAST_KNOWN_LOCATION,i),n.miles=n.meters/1609.344,n.feet=3.2808399*n.meters,n.range=n.feet>900?n.miles.toFixed(1)+" mi":n.feet.toFixed(0)+" ft",n.bearing=bearingToInNESW(LAST_KNOWN_LOCATION,i)}CM.attractions_nearby.sort((function(t,e){return t.meters-e.meters}));var r=CM.attractions_nearby.slice(0,25);t.empty();for(e=0,a=r.length;e<a;e++){n=r[e];var o=$("<li></li>").addClass("zoom").addClass("ui-li-has-count");o.attr("title",n.pagetitle),o.attr("category",n.categories),o.attr("type","attraction").attr("gid",n.gis_id),o.attr("lat",n.latitude).attr("lng",n.longitude),o.attr("backbutton","#pane-nearby");var l=$("<div></div>").addClass("ui-btn-text");l.append($("<h2></h2>").text(n.pagetitle));var s="";Array.isArray(n.categories)&&n.categories.forEach((function(t,e){e>0&&(s+="; "),s+=CM.categories[t].name})),l.append($("<p></p>").text(s)),l.append($("<span></span>").addClass("zoom_distance").addClass("ui-li-count").addClass("ui-btn-up-c").addClass("ui-btn-corner-all").text(n.range+" "+n.bearing)),o.click((function(){zoomElementClick($(this))})),o.append(l),t.append(o)}t.listview("refresh")}function placeCircle(t,e){clearCircle();var a=e/1e3,n=turf.circle(turf.point(t.toArray()),a,{units:"kilometers"});MAP.addLayer({id:"circle",type:"fill",source:{type:"geojson",data:n},layout:{},paint:{"fill-color":"#21A1F3","fill-opacity":.3}})}function clearCircle(){MAP.getLayer("circle")&&MAP.removeLayer("circle"),MAP.getSource("circle")&&MAP.removeSource("circle")}function checkNearby(t,e,a){e=parseFloat(e);for(var n=[],i=0,r=CM.attractions_nearby.length;i<r;i++){var o=CM.attractions_nearby[i],l=distanceTo(t,new mapboxgl.LngLat(o.longitude,o.latitude));if(!(l>e)){if(a){for(var s=o.categories.split("; "),c=!1,d=0,u=s.length;d<u;d++)for(var p=0,g=a.length;p<g;p++)if(a[p]==s[d]){c=!0;break}if(!c)continue}var f=3.2808399*l,m=f>900?(l/1609.344).toFixed(1)+" mi":f.toFixed(0)+" ft";n[n.length]={gid:o.gid,title:o.title,range:m}}}var h=!1;for(i=0,r=n.length;i<r;i++){var _=parseInt(n[i].gid);if(-1==LAST_BEEP_IDS.indexOf(_)){h=!0;break}}LAST_BEEP_IDS=[];for(i=0,r=n.length;i<r;i++){_=parseInt(n[i].gid);LAST_BEEP_IDS[LAST_BEEP_IDS.length]=_}if(LAST_BEEP_IDS.sort(),h){document.getElementById("alert_beep").play();var v=[];for(i=0,r=n.length;i<r;i++)v[v.length]=n[i].title+", "+n[i].range;setTimeout((function(){alert(v.join("\n"))}),1e3)}}function filterTrails(t,e,a,n){"bike"==t.substr(0,4)&&(t="bike");var i=CM.trails.filter((function(i){return!(t&&!i[t])&&((!e||i.res==e)&&(void 0===a||!n||!(i.distance_feet<a||i.distance_feet>n)))}));return i}function doTrailSearch(){$("#loops_list li").show();var t=$("#loops_filter_type").val(),e=filterTrails(t,$("#loops_filter_reservation").val(),5280*parseInt($("#loops_filter_distance_min").val()),5280*parseInt($("#loops_filter_distance_max").val())),a=$("#loops_list");if(a.empty(),$(".results-notes").remove(),!e||!e.length){a.after('<p class="results-notes">No results.</p>')}for(var n=0;n<e.length;n++){var i,r=e[n],o=$("<li></li>").addClass("zoom").addClass("ui-li-has-count");switch(o.attr("title",r.name).attr("gid",r.id).attr("type","loop").attr("w",r.boxw).attr("s",r.boxs).attr("e",r.boxe).attr("n",r.boxn).attr("lat",r.lat).attr("lng",r.lng),o.attr("backbutton","#pane-trails"),link=$("<a></a>"),link.attr("class","ui-btn ui-btn-text"),o.click((function(){zoomElementClick($(this))})),o.append(link),link.append($("<h4></h4>").addClass("ui-li-heading").text(r.name)),t){case"mountainbike":case"bike_Advanced":i=r.durationtext_bike;break;case"bridle":i=r.durationtext_bridle;break;case"hike":default:i=r.durationtext_hike}link.append($("<span></span>").addClass("ui-li-desc").html(r.distancetext+" &nbsp;&nbsp; "+i)),link.append($("<span></span>").addClass("zoom_distance").addClass("ui-li-count").addClass("ui-btn-up-c").addClass("ui-btn-corner-all").text("0 mi")),o.append(link),a.append(o)}$("#pane-trails .sortpicker").show(),a.listview("refresh"),sortLists(a)}$(document).on("dataReadyAutocompleteKeywords",(function(){$.each(CM.autocomplete_keywords,(function(t,e){var a="";a+='<li data-icon="arrow-r">',a+='<a href="#" data-transition="fade" class="ui-btn ui-btn-icon-right ui-icon-arrow-r">'+e+"</a>",a+="</li>",$("#browse_keyword_autocomplete").append(a),$("#search_keyword_autocomplete").append(a)})),$("#browse_keyword_autocomplete").listview("refresh").trigger("updatelayout"),$("#search_keyword_autocomplete").listview("refresh").trigger("updatelayout"),$("#browse_keyword_autocomplete li").click((function(){$("#browse_keyword").val("").trigger("change"),$("#browse_keyword").val($(this).text()),$("#browse_keyword_button").click()})),$("#search_keyword_autocomplete li").click((function(){$("#search_keyword").val("").trigger("change"),$("#search_keyword").val($(this).text()),$("#search_keyword_button").click()}))})),$(document).on("dataReadyAttractions",(function(){CM.attractions_nearby=CM.attractions.slice(0),updateNearYouNow()})),$(document).on("dataReadyAttractions",(function(){addActivityTypesToNearby()})),$(document).ready((function(){$("#nearby_enabled").change((function(){var t=$(this).is(":checked");t?$("#nearby-config").show():$("#nearby-config").hide(),t||($("#alerts li").slice(0,25).show(),$("#alerts li").slice(25).hide(),clearCircle())}))})),$(document).ready((function(){$("#loops_typeicons img").click((function(){var t=$(this),e=t.attr("data-value");$("#loops_filter_type").val(e).trigger("change"),$("#loops_typeicons img").each((function(){var e=$(this).prop("src");$(this).is(t)?e.includes("-on.svg")||(e=e.replace(".svg","-on.svg")):e=e.replace("-on.svg",".svg"),$(this).prop("src",e)}))})).first().click(),$("#loops_filter_distancepicker a").click((function(){var t=$(this),e=t.attr("data-min"),a=t.attr("data-max");$("#loops_filter_distance_min").val(e),$("#loops_filter_distance_max").val(a),$("#loops_filter_distancepicker a").each((function(){$(this).is(t)?$(this).addClass("active"):$(this).removeClass("active")})),doTrailSearch()})),$("#loops_filter_reservation").change((function(){doTrailSearch()})),$("#loops_filter_distance_min").change(),$("#loops_filter_distance_max").change(),$("#loops_filter_type").change((function(){switch($(this).val()){case"hike":case"exercise":$(".time_estimate").hide(),$(".time_hike").show(),$(".time_estimate_prefix").hide();break;case"bridle":$(".time_estimate").hide(),$(".time_bridle").show(),$(".time_estimate_prefix").hide();break;case"bike":case"bike_Novice":case"bike_Beginner":case"bike_Intermediate":case"bike_Advanced":case"mountainbike":$(".time_estimate").hide(),$(".time_bike").show(),$(".time_estimate_prefix").hide();break;default:$(".time_estimate").show(),$(".time_estimate_prefix").show()}doTrailSearch()}))})),this.CM=this.CM||{},this.CM.Templates=this.CM.Templates||{},this.CM.Templates.info_attraction=Handlebars.template({1:function(t,e,a,n,i){var r,o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <h4>Activities:</h4>\n    <ul class="activities-icon-list">\n'+(null!=(r=o(a,"each").call(null!=e?e:t.nullContext||{},null!=e?o(e,"activity_icons"):e,{name:"each",hash:{},fn:t.program(2,i,0),inverse:t.noop,data:i,loc:{start:{line:6,column:8},end:{line:8,column:17}}}))?r:"")+"    </ul>\n"},2:function(t,e,a,n,i){var r=t.lambda,o=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <li><img src="'+o(r(null!=e?l(e,"src"):e,e))+'" title="'+o(r(null!=e?l(e,"title"):e,e))+'" alt="'+o(r(null!=e?l(e,"title"):e,e))+'"></li>\n'},4:function(t,e,a,n,i){var r,o=t.lambda,l=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <img src="'+l(o(null!=(r=null!=e?s(e,"img"):e)?s(r,"src"):r,e))+'" width="'+l(o(null!=(r=null!=e?s(e,"img"):e)?s(r,"width"):r,e))+'" height="'+l(o(null!=(r=null!=e?s(e,"img"):e)?s(r,"height"):r,e))+'" alt="'+l(o(null!=(r=null!=e?s(e,"feature"):e)?s(r,"pagetitle"):r,e))+'">\n'},6:function(t,e,a,n,i){var r,o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div class="feature-description">'+t.escapeExpression(t.lambda(null!=(r=null!=e?o(e,"feature"):e)?o(r,"descr"):r,e))+"</div>\n"},8:function(t,e,a,n,i){var r,o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <ul class="nobull">\n        <li><a href="'+t.escapeExpression(t.lambda(null!=(r=null!=e?o(e,"feature"):e)?o(r,"main_site_url"):r,e))+'" target="_blank">More info</a></li>\n    </ul>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,a,n,i){var r,o=t.lambda,l=t.escapeExpression,s=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+l(o(null!=(r=null!=e?c(e,"feature"):e)?c(r,"pagetitle"):r,e))+"</h2>\n\n"+(null!=(r=c(a,"if").call(s,null!=(r=null!=e?c(e,"feature"):e)?c(r,"activities"):r,{name:"if",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i,loc:{start:{line:3,column:0},end:{line:10,column:7}}}))?r:"")+"\n"+(null!=(r=c(a,"if").call(s,null!=e?c(e,"img"):e,{name:"if",hash:{},fn:t.program(4,i,0),inverse:t.noop,data:i,loc:{start:{line:12,column:0},end:{line:14,column:7}}}))?r:"")+"\n"+(null!=(r=c(a,"if").call(s,null!=(r=null!=e?c(e,"feature"):e)?c(r,"descr"):r,{name:"if",hash:{},fn:t.program(6,i,0),inverse:t.noop,data:i,loc:{start:{line:16,column:0},end:{line:18,column:7}}}))?r:"")+"\n"+(null!=(r=c(a,"if").call(s,null!=(r=null!=e?c(e,"feature"):e)?c(r,"cmp_url"):r,{name:"if",hash:{},fn:t.program(8,i,0),inverse:t.noop,data:i,loc:{start:{line:20,column:0},end:{line:24,column:7}}}))?r:"")+'\n<h4>GPS coordinates:</h4>\n<div class="small-light">\n    '+l(o(null!=(r=null!=e?c(e,"feature"):e)?c(r,"coords_formatted"):r,e))+"\n</div>"},useData:!0}),this.CM.Templates.info_reservation=Handlebars.template({1:function(t,e,a,n,i){var r,o=t.lambda,l=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <img src="'+l(o(null!=(r=null!=e?s(e,"img"):e)?s(r,"src"):r,e))+'" width="'+l(o(null!=(r=null!=e?s(e,"img"):e)?s(r,"width"):r,e))+'" height="'+l(o(null!=(r=null!=e?s(e,"img"):e)?s(r,"height"):r,e))+'" alt="'+l(o(null!=(r=null!=e?s(e,"feature"):e)?s(r,"pagetitle"):r,e))+'">\n'},3:function(t,e,a,n,i){var r,o=t.lambda,l=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t<h4>Phone</h4>\n\t<a title="Call '+l(o(null!=(r=null!=e?s(e,"feature"):e)?s(r,"pagetitle"):r,e))+'" href="tel:'+l(o(null!=(r=null!=e?s(e,"feature"):e)?s(r,"phone"):r,e))+'">'+l(o(null!=(r=null!=e?s(e,"feature"):e)?s(r,"phone"):r,e))+"</a>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,a,n,i){var r,o=t.lambda,l=t.escapeExpression,s=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+l(o(null!=(r=null!=e?c(e,"feature"):e)?c(r,"pagetitle"):r,e))+"</h2>\n\n"+(null!=(r=c(a,"if").call(s,null!=e?c(e,"img"):e,{name:"if",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i,loc:{start:{line:3,column:0},end:{line:5,column:7}}}))?r:"")+"\n<p>"+l(o(null!=(r=null!=e?c(e,"feature"):e)?c(r,"descr"):r,e))+"</p>\n\n<h4>Hours of Operation</h4>\n"+l(o(null!=(r=null!=e?c(e,"feature"):e)?c(r,"hoursofoperation"):r,e))+"\n\n"+(null!=(r=c(a,"if").call(s,null!=(r=null!=e?c(e,"feature"):e)?c(r,"phone"):r,{name:"if",hash:{},fn:t.program(3,i,0),inverse:t.noop,data:i,loc:{start:{line:12,column:0},end:{line:15,column:7}}}))?r:"")+'\n<div class="lat_driving">'+l(o(null!=(r=null!=e?c(e,"feature"):e)?c(r,"drivingdestinationlatitude"):r,e))+'</div>\n<div class="lng_driving">'+l(o(null!=(r=null!=e?c(e,"feature"):e)?c(r,"drivingdestinationlongitude"):r,e))+"</div>"},useData:!0}),this.CM.Templates.info_trail=Handlebars.template({1:function(t,e,a,n,i){var r,o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"\tEst time, walking: "+t.escapeExpression(t.lambda(null!=(r=null!=e?o(e,"feature"):e)?o(r,"durationtext_hike"):r,e))+"<br/>\n"},3:function(t,e,a,n,i){var r,o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"\tEst time, bicycle: "+t.escapeExpression(t.lambda(null!=(r=null!=e?o(e,"feature"):e)?o(r,"durationtext_bike"):r,e))+"<br/>\n"},5:function(t,e,a,n,i){var r,o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"\tEst time, horseback: "+t.escapeExpression(t.lambda(null!=(r=null!=e?o(e,"feature"):e)?o(r,"durationtext_bridle"):r,e))+"<br/>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,a,n,i){var r,o=t.lambda,l=t.escapeExpression,s=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+l(o(null!=(r=null!=e?c(e,"feature"):e)?c(r,"name"):r,e))+"</h2>\n\n<p>\nLength: "+l(o(null!=(r=null!=e?c(e,"feature"):e)?c(r,"distancetext"):r,e))+"<br/>\n"+(null!=(r=c(a,"if").call(s,null!=(r=null!=e?c(e,"feature"):e)?c(r,"hike"):r,{name:"if",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i,loc:{start:{line:5,column:0},end:{line:7,column:7}}}))?r:"")+(null!=(r=c(a,"if").call(s,null!=(r=null!=e?c(e,"feature"):e)?c(r,"bike"):r,{name:"if",hash:{},fn:t.program(3,i,0),inverse:t.noop,data:i,loc:{start:{line:8,column:0},end:{line:10,column:7}}}))?r:"")+(null!=(r=c(a,"if").call(s,null!=(r=null!=e?c(e,"feature"):e)?c(r,"bridle"):r,{name:"if",hash:{},fn:t.program(5,i,0),inverse:t.noop,data:i,loc:{start:{line:11,column:0},end:{line:13,column:7}}}))?r:"")+"</p>\n\n"+(null!=(r=o(null!=(r=null!=e?c(e,"feature"):e)?c(r,"description"):r,e))?r:"")+'\n\n<div class="elevationprofileimage" style="text-align:center;">\n    <canvas id="elevation-profile-trail" alt="Elevation profile"></canvas>\n</div>\n'},useData:!0}),this.CM.Templates.pane_activities_item=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,a,n,i){var r,o=t.lambda,l=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li>\n    <a href="'+l(o(null!=(r=null!=e?s(e,"activity"):e)?s(r,"link_url"):r,e))+'">\n        <img class="ui-li-icon" src="'+l(o(null!=(r=null!=e?s(e,"activity"):e)?s(r,"icon"):r,e))+'" /> <span class="title">'+l(o(null!=(r=null!=e?s(e,"activity"):e)?s(r,"pagetitle"):r,e))+"</span>\n    </a>\n</li>\n"},useData:!0}),this.CM.Templates.pane_amenities_item=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,a,n,i){var r,o=t.lambda,l=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li>\n    <a href="'+l(o(null!=(r=null!=e?s(e,"amenity"):e)?s(r,"link_url"):r,e))+'">\n        <i class="cm-icon cm-icon-'+l(o(null!=(r=null!=e?s(e,"amenity"):e)?s(r,"icon"):r,e))+'"></i>\n        '+l(o(null!=(r=null!=e?s(e,"amenity"):e)?s(r,"name"):r,e))+"\n    </a>\n</li>\n"},useData:!0}),this.CM.Templates.pane_trails_reservation_filter_option=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,a,n,i){var r,o=t.lambda,l=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<option value="'+l(o(null!=(r=null!=e?s(e,"reservation"):e)?s(r,"pagetitle"):r,e))+'">'+l(o(null!=(r=null!=e?s(e,"reservation"):e)?s(r,"pagetitle"):r,e))+"</option>\n"},useData:!0});