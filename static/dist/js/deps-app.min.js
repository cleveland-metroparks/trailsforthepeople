!function o(a,s,u){function c(e,t){if(!s[e]){if(!a[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(l)return l(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var i=s[e]={exports:{}};a[e][0].call(i.exports,function(t){return c(a[e][1][t]||t)},i,i.exports,o,a,s,u)}return s[e].exports}for(var l="function"==typeof require&&require,t=0;t<u.length;t++)c(u[t]);return c}({1:[function(t,e,Q){(function(f){"use strict";function P(t){var e=t.getBoundingClientRect();return{width:e.width,height:e.height,top:e.top,right:e.right,bottom:e.bottom,left:e.left,x:e.left,y:e.top}}function b(t){if("[object Window]"===t.toString())return t;var e=t.ownerDocument;return e?e.defaultView:window}function s(t){var e=b(t);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function O(t){return t instanceof b(t).Element||t instanceof Element}function u(t){return t instanceof b(t).HTMLElement||t instanceof HTMLElement}function c(t){return t?(t.nodeName||"").toLowerCase():null}function A(t){return(O(t)?t.ownerDocument:t.document).documentElement}function l(t){return P(A(t)).left+s(t).scrollLeft}function d(t,e,r){var n;void 0===r&&(r=!1);var i=P(t),o={scrollLeft:0,scrollTop:0},a={x:0,y:0};return r||("body"!==c(e)&&(o=function(t){return t!==b(t)&&u(t)?function(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}(t):s(t)}(e)),u(e)?((a=P(e)).x+=e.clientLeft,a.y+=e.clientTop):(n=A(e))&&(a.x=l(n))),{x:i.left+o.scrollLeft-a.x,y:i.top+o.scrollTop-a.y,width:i.width,height:i.height}}function tt(t){return{x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth,height:t.offsetHeight}}function a(t){return"html"===c(t)?t:t.parentNode||t.host||document.ownerDocument||document.documentElement}function m(t){return b(t).getComputedStyle(t)}function g(t,e){void 0===e&&(e=[]);var r=function t(e){if(0<=["html","body","#document"].indexOf(c(e)))return e.ownerDocument.body;if(u(e)){var r=m(e),n=r.overflow,i=r.overflowX,o=r.overflowY;if(/auto|scroll|overlay|hidden/.test(n+o+i))return e}return t(a(e))}(t),n="body"===c(r),i=n?b(r):r,o=e.concat(i);return n?o:o.concat(g(a(i)))}function n(t){return u(t)&&"fixed"!==m(t).position?t.offsetParent:null}function et(t){for(var e=b(t),r=n(t);r&&0<=["table","td","th"].indexOf(c(r));)r=n(r);return r&&"body"===c(r)&&"static"===m(r).position?e:r||e}Object.defineProperty(Q,"__esModule",{value:!0});var rt="top",nt="bottom",it="right",ot="left",L="auto",R=[rt,nt,it,ot],at="start",h="end",I="clippingParents",N="viewport",k="popper",D="reference",j=R.reduce(function(t,e){return t.concat([e+"-"+at,e+"-"+h])},[]),p=[].concat(R,[L]).reduce(function(t,e){return t.concat([e,e+"-"+at,e+"-"+h])},[]),y=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function v(t){var n=new Map,i=new Set,e=[];return t.forEach(function(t){n.set(t.name,t)}),t.forEach(function(t){i.has(t.name)||!function r(t){i.add(t.name),[].concat(t.requires||[],t.requiresIfExists||[]).forEach(function(t){if(!i.has(t)){var e=n.get(t);e&&r(e)}}),e.push(t)}(t)}),e}function _(t){for(var e=arguments.length,r=new Array(1<e?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return[].concat(r).reduce(function(t,e){return t.replace(/%s/,e)},t)}var x='Popper: modifier "%s" provided an invalid %s property, expected %s but got %s',w='Popper: modifier "%s" requires "%s", but "%s" modifier is not available',S=["name","enabled","phase","fn","effect","requires","options"];function st(t){return t.split("-")[0]}var E="Popper: Invalid reference or popper argument provided. They must be either a DOM element or virtual element.",C={placement:"bottom",modifiers:[],strategy:"absolute"};function M(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return!e.some(function(t){return!(t&&"function"==typeof t.getBoundingClientRect)})}function t(t){void 0===t&&(t={});var e=t,r=e.defaultModifiers,s=void 0===r?[]:r,n=e.defaultOptions,u=void 0===n?C:n;return function(n,i,e){void 0===e&&(e=u);var l={placement:"bottom",orderedModifiers:[],options:Object.assign({},C,{},u),modifiersData:{},elements:{reference:n,popper:i},attributes:{},styles:{}},a=[],h=!1,p={state:l,setOptions:function(t){o(),l.options=Object.assign({},u,{},l.options,{},t),l.scrollParents={reference:O(n)?g(n):n.contextElement?g(n.contextElement):[],popper:g(i)};var e=function(t){var r=v(t);return y.reduce(function(t,e){return t.concat(r.filter(function(t){return t.phase===e}))},[])}(function(t){var e=t.reduce(function(t,e){var r=t[e.name];return t[e.name]=r?Object.assign({},r,{},e,{options:Object.assign({},r.options,{},e.options),data:Object.assign({},r.data,{},e.data)}):e,t},{});return Object.keys(e).map(function(t){return e[t]})}([].concat(s,l.options.modifiers)));if(l.orderedModifiers=e.filter(function(t){return t.enabled}),"production"!==f.env.NODE_ENV){if(function(n){n.forEach(function(r){Object.keys(r).forEach(function(t){switch(t){case"name":"string"!=typeof r.name&&console.error(_(x,String(r.name),'"name"','"string"','"'+String(r.name)+'"'));break;case"enabled":"boolean"!=typeof r.enabled&&console.error(_(x,r.name,'"enabled"','"boolean"','"'+String(r.enabled)+'"'));case"phase":y.indexOf(r.phase)<0&&console.error(_(x,r.name,'"phase"',"either "+y.join(", "),'"'+String(r.phase)+'"'));break;case"fn":"function"!=typeof r.fn&&console.error(_(x,r.name,'"fn"','"function"','"'+String(r.fn)+'"'));break;case"effect":"function"!=typeof r.effect&&console.error(_(x,r.name,'"effect"','"function"','"'+String(r.fn)+'"'));break;case"requires":Array.isArray(r.requires)||console.error(_(x,r.name,'"requires"','"array"','"'+String(r.requires)+'"'));break;case"requiresIfExists":Array.isArray(r.requiresIfExists)||console.error(_(x,r.name,'"requiresIfExists"','"array"','"'+String(r.requiresIfExists)+'"'));break;case"options":case"data":break;default:console.error('PopperJS: an invalid property has been provided to the "'+r.name+'" modifier, valid properties are '+S.map(function(t){return'"'+t+'"'}).join(", ")+'; but "'+t+'" was provided.')}r.requires&&r.requires.forEach(function(e){null==n.find(function(t){return t.name===e})&&console.error(_(w,String(r.name),e,e))})})})}(function(t,r){var n=new Set;return t.filter(function(t){var e=r(t);if(!n.has(e))return n.add(e),!0})}([].concat(e,l.options.modifiers),function(t){return t.name})),st(l.options.placement)===L)l.orderedModifiers.find(function(t){return"flip"===t.name})||console.error(['Popper: "auto" placements require the "flip" modifier be',"present and enabled to work."].join(" "));var r=m(i);[r.marginTop,r.marginRight,r.marginBottom,r.marginLeft].some(function(t){return parseFloat(t)})&&console.warn(['Popper: CSS "margin" styles cannot be used to apply padding',"between the popper and its reference element or boundary.","To replicate margin, use the `offset` modifier, as well as","the `padding` option in the `preventOverflow` and `flip`","modifiers."].join(" "))}return l.orderedModifiers.forEach(function(t){var e=t.name,r=t.options,n=void 0===r?{}:r,i=t.effect;if("function"==typeof i){var o=i({state:l,name:e,instance:p,options:n});a.push(o||function(){})}}),p.update()},forceUpdate:function(){if(!h){var t=l.elements,e=t.reference,r=t.popper;if(M(e,r)){l.rects={reference:d(e,et(r),"fixed"===l.options.strategy),popper:tt(r)},l.reset=!1,l.placement=l.options.placement,l.orderedModifiers.forEach(function(t){return l.modifiersData[t.name]=Object.assign({},t.data)});for(var n=0,i=0;i<l.orderedModifiers.length;i++){if("production"!==f.env.NODE_ENV&&100<(n+=1)){console.error("Popper: An infinite loop in the modifiers cycle has been detected! The cycle has been interrupted to prevent a browser crash.");break}if(!0!==l.reset){var o=l.orderedModifiers[i],a=o.fn,s=o.options,u=void 0===s?{}:s,c=o.name;"function"==typeof a&&(l=a({state:l,options:u,name:c,instance:p})||l)}else l.reset=!1,i=-1}}else"production"!==f.env.NODE_ENV&&console.error(E)}},update:function(e){var r;return function(){return r=r||new Promise(function(t){Promise.resolve().then(function(){r=void 0,t(e())})})}}(function(){return new Promise(function(t){p.forceUpdate(),t(l)})}),destroy:function(){o(),h=!0}};if(!M(n,i))return"production"!==f.env.NODE_ENV&&console.error(E),p;function o(){a.forEach(function(t){return t()}),a=[]}return p.setOptions(e).then(function(t){!h&&e.onFirstUpdate&&e.onFirstUpdate(t)}),p}}var T={passive:!0};function ut(t){return t.split("-")[1]}function ct(t){return 0<=["top","bottom"].indexOf(t)?"x":"y"}function z(t){var e,r=t.reference,n=t.element,i=t.placement,o=i?st(i):null,a=i?ut(i):null,s=r.x+r.width/2-n.width/2,u=r.y+r.height/2-n.height/2;switch(o){case rt:e={x:s,y:r.y-n.height};break;case nt:e={x:s,y:r.y+r.height};break;case it:e={x:r.x+r.width,y:u};break;case ot:e={x:r.x-n.width,y:u};break;default:e={x:r.x,y:r.y}}var c=o?ct(o):null;if(null!=c){var l="y"===c?"height":"width";switch(a){case at:e[c]=Math.floor(e[c])-Math.floor(r[l]/2-n[l]/2);break;case h:e[c]=Math.floor(e[c])+Math.ceil(r[l]/2-n[l]/2)}}return e}var F={top:"auto",right:"auto",bottom:"auto",left:"auto"};function B(t){var e,r=t.popper,n=t.popperRect,i=t.placement,o=t.offsets,a=t.position,s=t.gpuAcceleration,u=t.adaptive,c=function(t){var e=t.x,r=t.y,n=window.devicePixelRatio||1;return{x:Math.round(e*n)/n||0,y:Math.round(r*n)/n||0}}(o),l=c.x,h=c.y,p=o.hasOwnProperty("x"),f=o.hasOwnProperty("y"),d=ot,m=rt,g=window;if(u){var y=et(r);y===b(r)&&(y=A(r)),i===rt&&(m=nt,h-=y.clientHeight-n.height,h*=s?1:-1),i===ot&&(d=it,l-=y.clientWidth-n.width,l*=s?1:-1)}var v,_=Object.assign({position:a},u&&F);return s?Object.assign({},_,((v={})[m]=f?"0":"",v[d]=p?"0":"",v.transform=(g.devicePixelRatio||1)<2?"translate("+l+"px, "+h+"px)":"translate3d("+l+"px, "+h+"px, 0)",v)):Object.assign({},_,((e={})[m]=f?h+"px":"",e[d]=p?l+"px":"",e.transform="",e))}var e={left:"right",right:"left",bottom:"top",top:"bottom"};function U(t){return t.replace(/left|right|bottom|top/g,function(t){return e[t]})}var r={start:"end",end:"start"};function V(t){return t.replace(/start|end/g,function(t){return r[t]})}function G(t){return parseFloat(t)||0}function q(t){var e=b(t),r=function(t){var e=u(t)?m(t):{};return{top:G(e.borderTopWidth),right:G(e.borderRightWidth),bottom:G(e.borderBottomWidth),left:G(e.borderLeftWidth)}}(t),n="html"===c(t),i=l(t),o=t.clientWidth+r.right,a=t.clientHeight+r.bottom;return n&&50<e.innerHeight-t.clientHeight&&(a=e.innerHeight-r.bottom),{top:n?0:t.clientTop,right:t.clientLeft>r.left?r.right:n?e.innerWidth-o-i:t.offsetWidth-o,bottom:n?e.innerHeight-a:t.offsetHeight-a,left:n?i:t.clientLeft}}function H(t,e){var r=Boolean(e.getRootNode&&e.getRootNode().host);if(t.contains(e))return!0;if(r){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function $(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function W(t,e){return e===N?$(function(t){var e=b(t);return{width:e.innerWidth,height:e.innerHeight,x:0,y:0}}(t)):u(e)?P(e):$(function(t){var e=b(t),r=s(t),n=d(A(t),e);return n.height=Math.max(n.height,e.innerHeight),n.width=Math.max(n.width,e.innerWidth),n.x=-r.scrollLeft,n.y=-r.scrollTop,n}(A(t)))}function X(i,t,e){var r="clippingParents"===t?function(t){var e=g(t),r=0<=["absolute","fixed"].indexOf(m(t).position)&&u(t)?et(t):t;return O(r)?e.filter(function(t){return O(t)&&H(t,r)}):[]}(i):[].concat(t),n=[].concat(r,[e]),o=n[0],a=n.reduce(function(t,e){var r=W(i,e),n=q(u(e)?e:A(i));return t.top=Math.max(r.top+n.top,t.top),t.right=Math.min(r.right-n.right,t.right),t.bottom=Math.min(r.bottom-n.bottom,t.bottom),t.left=Math.max(r.left+n.left,t.left),t},W(i,o));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function Y(t){return Object.assign({},{top:0,right:0,bottom:0,left:0},{},t)}function Z(r,t){return t.reduce(function(t,e){return t[e]=r,t},{})}function lt(t,e){void 0===e&&(e={});var r=e,n=r.placement,i=void 0===n?t.placement:n,o=r.boundary,a=void 0===o?I:o,s=r.rootBoundary,u=void 0===s?N:s,c=r.elementContext,l=void 0===c?k:c,h=r.altBoundary,p=void 0!==h&&h,f=r.padding,d=void 0===f?0:f,m=Y("number"!=typeof d?d:Z(d,R)),g=l===k?D:k,y=t.elements.reference,v=t.rects.popper,_=t.elements[p?g:l],b=X(O(_)?_:_.contextElement||A(t.elements.popper),a,u),x=P(y),w=z({reference:x,element:v,strategy:"absolute",placement:i}),S=$(Object.assign({},v,{},w)),E=l===k?S:x,C={top:b.top-E.top+m.top,bottom:E.bottom-b.bottom+m.bottom,left:b.left-E.left+m.left,right:E.right-b.right+m.right},M=t.modifiersData.offset;if(l===k&&M){var T=M[i];Object.keys(C).forEach(function(t){var e=0<=[it,nt].indexOf(t)?1:-1,r=0<=[rt,nt].indexOf(t)?"y":"x";C[t]+=T[r]*e})}return C}function ht(t,e,r){return Math.max(t,Math.min(e,r))}function K(t,e,r){return void 0===r&&(r={x:0,y:0}),{top:t.top-e.height-r.y,right:t.right-e.width+r.x,bottom:t.bottom-e.height+r.y,left:t.left-e.width-r.x}}function J(e){return[rt,it,nt,ot].some(function(t){return 0<=e[t]})}var i=[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(t){var e=t.state,r=t.instance,n=t.options,i=n.scroll,o=void 0===i||i,a=n.resize,s=void 0===a||a,u=b(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&c.forEach(function(t){t.addEventListener("scroll",r.update,T)}),s&&u.addEventListener("resize",r.update,T),function(){o&&c.forEach(function(t){t.removeEventListener("scroll",r.update,T)}),s&&u.removeEventListener("resize",r.update,T)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(t){var e=t.state,r=t.name;e.modifiersData[r]=z({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(t){var e=t.state,r=t.options,n=r.gpuAcceleration,i=void 0===n||n,o=r.adaptive,a=void 0===o||o;if("production"!==f.env.NODE_ENV){var s=m(e.elements.popper).transitionProperty;a&&["transform","top","right","bottom","left"].some(function(t){return 0<=s.indexOf(t)})&&console.warn(["Popper: Detected CSS transitions on at least one of the following",'CSS properties: "transform", "top", "right", "bottom", "left".',"\n\n",'Disable the "computeStyles" modifier\'s `adaptive` option to allow',"for smooth transitions, or remove these properties from the CSS","transition declaration on the popper element if only transitioning","opacity or background-color for example.","\n\n","We recommend using the popper element as a wrapper around an inner","element that can have any CSS property transitioned for animations."].join(" "))}var u={placement:st(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i};e.styles.popper=Object.assign({},e.styles.popper,{},B(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:a}))),null!=e.modifiersData.arrow&&(e.styles.arrow=Object.assign({},e.styles.arrow,{},B(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function(t){var i=t.state;Object.keys(i.elements).forEach(function(t){var e=i.styles[t]||{},r=i.attributes[t]||{},n=i.elements[t];u(n)&&c(n)&&(Object.assign(n.style,e),Object.keys(r).forEach(function(t){var e=r[t];!1===e?n.removeAttribute(t):n.setAttribute(t,!0===e?"":e)}))})},effect:function(t){var i=t.state,o={popper:{position:"absolute",left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(i.elements.popper.style,o.popper),i.elements.arrow&&Object.assign(i.elements.arrow.style,o.arrow),function(){Object.keys(i.elements).forEach(function(t){var e=i.elements[t],r=i.attributes[t]||{},n=Object.keys(i.styles.hasOwnProperty(t)?i.styles[t]:o[t]).reduce(function(t,e){return t[e]="",t},{});u(e)&&c(e)&&(Object.assign(e.style,n),Object.keys(r).forEach(function(t){e.removeAttribute(t)}))})}},requires:["computeStyles"]},{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(t){var r=t.state,e=t.options,n=t.name,i=e.offset,o=void 0===i?[0,0]:i,a=p.reduce(function(t,e){return t[e]=function(t,e,r){var n=st(t),i=0<=[ot,rt].indexOf(n)?-1:1,o="function"==typeof r?r(Object.assign({},e,{placement:t})):r,a=o[0],s=o[1];return a=a||0,s=(s||0)*i,0<=[ot,it].indexOf(n)?{x:s,y:a}:{x:a,y:s}}(e,r.rects,o),t},{}),s=a[r.placement],u=s.x,c=s.y;r.modifiersData.popperOffsets.x+=u,r.modifiersData.popperOffsets.y+=c,r.modifiersData[n]=a}},{name:"flip",enabled:!0,phase:"main",fn:function(t){var r=t.state,e=t.options,n=t.name;if(!r.modifiersData[n]._skip){for(var i=e.fallbackPlacements,o=e.padding,a=e.boundary,s=e.rootBoundary,u=e.altBoundary,c=e.flipVariations,l=void 0===c||c,h=r.options.placement,p=st(h),f=i||(p===h||!l?[U(h)]:function(t){if(st(t)===L)return[];var e=U(t);return[V(t),e,V(e)]}(h)),d=[h].concat(f).reduce(function(t,e){return t.concat(st(e)===L?function(r,t){void 0===t&&(t={});var e=t,n=e.placement,i=e.boundary,o=e.rootBoundary,a=e.padding,s=e.flipVariations,u=ut(n),c=(u?s?j:j.filter(function(t){return ut(t)===u}):R).reduce(function(t,e){return t[e]=lt(r,{placement:e,boundary:i,rootBoundary:o,padding:a})[st(e)],t},{});return Object.keys(c).sort(function(t,e){return c[t]-c[e]})}(r,{placement:e,boundary:a,rootBoundary:s,padding:o,flipVariations:l}):e)},[]),m=r.rects.reference,g=r.rects.popper,y=new Map,v=!0,_=d[0],b=0;b<d.length;b++){var x=d[b],w=st(x),S=ut(x)===at,E=0<=[rt,nt].indexOf(w),C=E?"width":"height",M=lt(r,{placement:x,boundary:a,rootBoundary:s,altBoundary:u,padding:o}),T=E?S?it:ot:S?nt:rt;m[C]>g[C]&&(T=U(T));var P=U(T),O=[M[w]<=0,M[T]<=0,M[P]<=0];if(O.every(function(t){return t})){_=x,v=!1;break}y.set(x,O)}if(v)for(var A=function(r){var t=d.find(function(t){var e=y.get(t);if(e)return e.slice(0,r).every(function(t){return t})});if(t)return _=t,"break"},I=l?3:1;0<I;I--){if("break"===A(I))break}r.placement!==_&&(r.modifiersData[n]._skip=!0,r.placement=_,r.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},{name:"preventOverflow",enabled:!0,phase:"main",fn:function(t){var e=t.state,r=t.options,n=t.name,i=r.mainAxis,o=void 0===i||i,a=r.altAxis,s=void 0!==a&&a,u=r.boundary,c=r.rootBoundary,l=r.altBoundary,h=r.padding,p=r.tether,f=void 0===p||p,d=r.tetherOffset,m=void 0===d?0:d,g=lt(e,{boundary:u,rootBoundary:c,padding:h,altBoundary:l}),y=st(e.placement),v=ut(e.placement),_=!v,b=ct(y),x=function(t){return"x"===t?"y":"x"}(b),w=e.modifiersData.popperOffsets,S=e.rects.reference,E=e.rects.popper,C="function"==typeof m?m(Object.assign({},e.rects,{placement:e.placement})):m,M={x:0,y:0};if(o){var T="y"===b?rt:ot,P="y"===b?nt:it,O="y"===b?"height":"width",A=w[b],I=w[b]+g[T],L=w[b]-g[P],R=f?-E[O]/2:0,N=v===at?S[O]:E[O],k=v===at?-E[O]:-S[O],D=e.elements.arrow,j=f&&D?tt(D):{width:0,height:0},z=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},F=z[T],B=z[P],U=ht(0,S[O],j[O]),V=_?S[O]/2-R-U-F-C:N-U-F-C,G=_?-S[O]/2+R+U+B+C:k+U+B+C,q=e.elements.arrow&&et(e.elements.arrow),H=q?"y"===b?q.clientTop||0:q.clientLeft||0:0,$=e.modifiersData.offset?e.modifiersData.offset[e.placement][b]:0,W=w[b]+V-$-H,X=w[b]+G-$,Y=ht(f?Math.min(I,W):I,A,f?Math.max(L,X):L);w[b]=Y,M[b]=Y-A}if(s){var Z="x"===b?rt:ot,K="x"===b?nt:it,J=w[x],Q=ht(J+g[Z],J,J-g[K]);e.modifiersData.popperOffsets[x]=Q,M[x]=Q-J}e.modifiersData[n]=M},requiresIfExists:["offset"]},{name:"arrow",enabled:!0,phase:"main",fn:function(t){var e,r=t.state,n=t.name,i=r.elements.arrow,o=r.modifiersData.popperOffsets,a=st(r.placement),s=ct(a),u=0<=[ot,it].indexOf(a)?"height":"width";if(i){var c=r.modifiersData[n+"#persistent"].padding,l=tt(i),h="y"===s?rt:ot,p="y"===s?nt:it,f=r.rects.reference[u]+r.rects.reference[s]-o[s]-r.rects.popper[u],d=o[s]-r.rects.reference[s],m=r.elements.arrow&&et(r.elements.arrow),g=m?"y"===s?m.clientHeight||0:m.clientWidth||0:0,y=f/2-d/2,v=c[h],_=g-l[u]-c[p],b=g/2-l[u]/2+y,x=ht(v,b,_),w=s;r.modifiersData[n]=((e={})[w]=x,e.centerOffset=x-b,e)}},effect:function(t){var e=t.state,r=t.options,n=t.name,i=r.element,o=void 0===i?"[data-popper-arrow]":i,a=r.padding,s=void 0===a?0:a;"string"==typeof o&&!(o=e.elements.popper.querySelector(o))||(H(e.elements.popper,o)?(e.elements.arrow=o,e.modifiersData[n+"#persistent"]={padding:Y("number"!=typeof s?s:Z(s,R))}):"production"!==f.env.NODE_ENV&&console.error(['Popper: "arrow" modifier\'s `element` must be a child of the popper',"element."].join(" ")))},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(t){var e=t.state,r=t.name,n=e.rects.reference,i=e.rects.popper,o=e.modifiersData.preventOverflow,a=lt(e,{elementContext:"reference"}),s=lt(e,{altBoundary:!0}),u=K(a,n),c=K(s,i,o),l=J(u),h=J(c);e.modifiersData[r]={referenceClippingOffsets:u,popperEscapeOffsets:c,isReferenceHidden:l,hasPopperEscaped:h},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":l,"data-popper-escaped":h})}}],o=t({defaultModifiers:i});Q.createPopper=o,Q.defaultModifiers=i,Q.detectOverflow=lt,Q.popperGenerator=t}).call(this,t("_process"))},{_process:8}],2:[function(t,e,r){var n,i;n=this,i=function(t){"use strict";function F(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n=r.bbox,i=r.id;if(void 0===t)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");n&&h(n),i&&g(i);var o={type:"Feature"};return i&&(o.id=i),n&&(o.bbox=n),o.properties=e||{},o.geometry=t,o}function e(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n,i=r.bbox;if(!t)throw new Error("type is required");if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");switch(i&&h(i),t){case"Point":n=B(e).geometry;break;case"LineString":n=V(e).geometry;break;case"Polygon":n=U(e).geometry;break;case"MultiPoint":n=o(e).geometry;break;case"MultiLineString":n=_(e).geometry;break;case"MultiPolygon":n=b(e).geometry;break;default:throw new Error(t+" is invalid")}return i&&(n.bbox=i),n}function B(t,e,r){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!q(t[0])||!q(t[1]))throw new Error("coordinates must contain numbers");return F({type:"Point",coordinates:t},e,r)}function r(t,e,r){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");return G(t.map(function(t){return B(t,e)}),r)}function U(t,e,r){if(!t)throw new Error("coordinates is required");for(var n=0;n<t.length;n++){var i=t[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<i[i.length-1].length;o++){if(0===n&&0===o&&!q(i[0][0])||!q(i[0][1]))throw new Error("coordinates must contain numbers");if(i[i.length-1][o]!==i[0][o])throw new Error("First and last Position are not equivalent.")}}return F({type:"Polygon",coordinates:t},e,r)}function n(t,e,r){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");return G(t.map(function(t){return U(t,e)}),r)}function V(t,e,r){if(!t)throw new Error("coordinates is required");if(t.length<2)throw new Error("coordinates must be an array of two or more positions");if(!q(t[0][1])||!q(t[0][1]))throw new Error("coordinates must contain numbers");return F({type:"LineString",coordinates:t},e,r)}function i(t,e,r){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");return G(t.map(function(t){return V(t,e)}),r)}function G(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.bbox,n=e.id;if(!t)throw new Error("No features passed");if(!Array.isArray(t))throw new Error("features must be an Array");r&&h(r),n&&g(n);var i={type:"FeatureCollection"};return n&&(i.id=n),r&&(i.bbox=r),i.features=t,i}function _(t,e,r){if(!t)throw new Error("coordinates is required");return F({type:"MultiLineString",coordinates:t},e,r)}function o(t,e,r){if(!t)throw new Error("coordinates is required");return F({type:"MultiPoint",coordinates:t},e,r)}function b(t,e,r){if(!t)throw new Error("coordinates is required");return F({type:"MultiPolygon",coordinates:t},e,r)}function a(t,e,r){if(!t)throw new Error("geometries is required");if(!Array.isArray(t))throw new Error("geometries must be an Array");return F({type:"GeometryCollection",geometries:t},e,r)}function s(t,e){if(null==t||isNaN(t))throw new Error("num is required");if(e&&!(0<=e))throw new Error("precision must be a positive number");var r=Math.pow(10,e||0);return Math.round(t*r)/r}function d(t,e){if(null==t)throw new Error("radians is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var r=mo[e||"kilometers"];if(!r)throw new Error(e+" units is invalid");return t*r}function m(t,e){if(null==t)throw new Error("distance is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var r=mo[e||"kilometers"];if(!r)throw new Error(e+" units is invalid");return t/r}function u(t,e){return f(m(t,e))}function p(t){if(null==t)throw new Error("bearing is required");var e=t%360;return e<0&&(e+=360),e}function f(t){if(null==t)throw new Error("radians is required");return t%(2*Math.PI)*180/Math.PI}function v(t){if(null==t)throw new Error("degrees is required");return t%360*Math.PI/180}function c(t,e,r){if(null==t)throw new Error("length is required");if(!(0<=t))throw new Error("length must be a positive number");return d(m(t,e),r||"kilometers")}function l(t,e,r){if(null==t)throw new Error("area is required");if(!(0<=t))throw new Error("area must be a positive number");var n=yo[e||"meters"];if(!n)throw new Error("invalid original units");var i=yo[r||"kilometers"];if(!i)throw new Error("invalid final units");return t/n*i}function q(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function H(t){return!!t&&t.constructor===Object}function h(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(t){if(!q(t))throw new Error("bbox must only contain numbers")})}function g(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}function w(t,e,r){if(null!==t)for(var n,i,o,a,s,u,c,l,h=0,p=0,f=t.type,d="FeatureCollection"===f,m="Feature"===f,g=d?t.features.length:1,y=0;y<g;y++){s=(l=!!(c=d?t.features[y].geometry:m?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var v=0;v<s;v++){var _=0,b=0;if(null!==(a=l?c.geometries[v]:c)){u=a.coordinates;var x=a.type;switch(h=!r||"Polygon"!==x&&"MultiPolygon"!==x?0:1,x){case null:break;case"Point":e(u,p,y,_,b),p++,_++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++)e(u[n],p,y,_,b),p++,"MultiPoint"===x&&_++;"LineString"===x&&_++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(i=0;i<u[n].length-h;i++)e(u[n][i],p,y,_,b),p++;"MultiLineString"===x&&_++,"Polygon"===x&&b++}"Polygon"===x&&_++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for("MultiPolygon"===x&&(b=0),i=0;i<u[n].length;i++){for(o=0;o<u[n][i].length-h;o++)e(u[n][i][o],p,y,_,b),p++;b++}_++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)w(a.geometries[n],e,r);break;default:throw new Error("Unknown Geometry Type")}}}}}function y(t,o,a,e){var s=a;return w(t,function(t,e,r,n,i){s=0===e&&void 0===a?t:o(s,t,e,r,n,i)},e),s}function x(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length;r++)e(t.features[r].properties,r);break;case"Feature":e(t.properties,0)}}function S(t,r,n){var i=n;return x(t,function(t,e){i=0===e&&void 0===n?t:r(i,t,e)}),i}function E(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)e(t.features[r],r)}function C(t,r,n){var i=n;return E(t,function(t,e){i=0===e&&void 0===n?t:r(i,t,e)}),i}function M(t){var e=[];return w(t,function(t){e.push(t)}),e}function T(t,e){var r,n,i,o,a,s,u,c,l,h,p=0,f="FeatureCollection"===t.type,d="Feature"===t.type,m=f?t.features.length:1;for(r=0;r<m;r++){for(s=f?t.features[r].geometry:d?t.geometry:t,c=f?t.features[r].properties:d?t.properties:{},l=f?t.features[r].bbox:d?t.bbox:void 0,h=f?t.features[r].id:d?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":e(o,p,c,l,h);break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)e(o.geometries[n],p,c,l,h);break;default:throw new Error("Unknown Geometry Type")}else e(null,p,c,l,h);p++}}function P(t,o,a){var s=a;return T(t,function(t,e,r,n,i){s=0===e&&void 0===a?t:o(s,t,e,r,n,i)}),s}function O(t,s){T(t,function(t,r,n,e,i){var o,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return void s(F(t,n,{bbox:e,id:i}),r,0)}switch(a){case"MultiPoint":o="Point";break;case"MultiLineString":o="LineString";break;case"MultiPolygon":o="Polygon"}t.coordinates.forEach(function(t,e){s(F({type:o,coordinates:t},n),r,e)})})}function A(t,n,i){var o=i;return O(t,function(t,e,r){o=0===e&&0===r&&void 0===i?t:n(o,t,e,r)}),o}function I(t,h){O(t,function(s,u,c){var l=0;if(s.geometry){var t=s.geometry.type;"Point"!==t&&"MultiPoint"!==t&&y(s,function(t,e,r,n,i,o){var a=V([t,e],s.properties);return h(a,u,c,o,l),l++,e})}})}function L(t,o,a){var s=a,u=!1;return I(t,function(t,e,r,n,i){s=!1===u&&void 0===a?t:o(s,t,e,r,n,i),u=!0}),s}function R(t,a){if(!t)throw new Error("geojson is required");O(t,function(t,e,r){if(null!==t.geometry){var n=t.geometry.type,i=t.geometry.coordinates;switch(n){case"LineString":a(t,e,r,0,0);break;case"Polygon":for(var o=0;o<i.length;o++)a(V(i[o],t.properties),e,r,o)}}})}function N(t,i,o){var a=o;return R(t,function(t,e,r,n){a=0===e&&void 0===o?t:i(a,t,e,r,n)}),a}function $(t){var e=[1/0,1/0,-1/0,-1/0];return w(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}function W(t){if(!t)throw new Error("obj is required");var e=k(t);if(1<e.length&&q(e[0])&&q(e[1]))return e;throw new Error("Coordinate is not a valid Point")}function k(t){if(!t)throw new Error("obj is required");var e;if(t.length?e=t:t.coordinates?e=t.coordinates:t.geometry&&t.geometry.coordinates&&(e=t.geometry.coordinates),e)return D(e),e;throw new Error("No valid coordinates")}function D(t){if(1<t.length&&q(t[0])&&q(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return D(t[0]);throw new Error("coordinates must only contain numbers")}function j(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)}function z(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}function X(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||"FeatureCollection"!==t.type)throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0;n<t.features.length;n++){var i=t.features[n];if(!i||"Feature"!==i.type||!i.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!i.geometry||i.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+i.geometry.type)}}function Y(t){if(!t)throw new Error("geojson is required");if(void 0!==t.geometry)return t.geometry;if(t.coordinates||t.geometries)return t;throw new Error("geojson must be a valid Feature or Geometry Object")}function Z(){throw new Error("invariant.getGeomType has been deprecated in v5.0 in favor of invariant.getType")}function K(t,e){if(!t)throw new Error((e||"geojson")+" is required");if(t.geometry&&t.geometry.type)return t.geometry.type;if(t.type)return t.type;throw new Error((e||"geojson")+" is invalid")}function J(t,e,r){r=r||{};for(var n=Object.keys(xo),i=0;i<n.length;i++){var o=n[i],a=r[o];a=null!=a?a:xo[o],wo[o]=a}wo.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+e);var l,h,p,s=(l=function(t,e){for(var r=t.length-1,n=t[0].length-1,i={rows:r,cols:n,cells:[]},o=0;o<r;++o){i.cells[o]=[];for(var a=0;a<n;++a){var s=0,u=t[o+1][a],c=t[o+1][a+1],l=t[o][a+1],h=t[o][a];if(!(isNaN(u)||isNaN(c)||isNaN(l)||isNaN(h))){s|=e<=u?8:0,s|=e<=c?4:0,s|=e<=l?2:0;var p,f,d,m,g=!1;if(5==(s|=e<=h?1:0)||10===s){var y=(u+c+l+h)/4;5===s&&y<e?(s=10,g=!0):10===s&&y<e&&(s=5,g=!0)}if(0!==s&&15!==s)p=f=d=m=.5,1===s?(d=1-Q(e,u,h),f=1-Q(e,l,h)):2===s?(f=Q(e,h,l),m=1-Q(e,c,l)):3===s?(d=1-Q(e,u,h),m=1-Q(e,c,l)):4===s?(p=Q(e,u,c),m=Q(e,l,c)):5===s?(p=Q(e,u,c),m=Q(e,l,c),f=1-Q(e,l,h),d=1-Q(e,u,h)):6===s?(f=Q(e,h,l),p=Q(e,u,c)):7===s?(d=1-Q(e,u,h),p=Q(e,u,c)):8===s?(d=Q(e,h,u),p=1-Q(e,c,u)):9===s?(f=1-Q(e,l,h),p=1-Q(e,c,u)):10===s?(p=1-Q(e,c,u),m=1-Q(e,c,l),f=Q(e,h,l),d=Q(e,h,u)):11===s?(p=1-Q(e,c,u),m=1-Q(e,c,l)):12===s?(d=Q(e,h,u),m=Q(e,l,c)):13===s?(f=1-Q(e,l,h),m=Q(e,l,c)):14===s?(d=Q(e,h,u),f=Q(e,h,l)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+s),i.cells[o][a]={cval:s,flipped:g,top:p,right:m,bottom:f,left:d}}}}return i}(t,e),h=[],p=0,l.rows,l.cols,l.cells.forEach(function(t,c){t.forEach(function(t,e){if(void 0!==t&&5!==(u=t).cval&&10!==u.cval&&!tt(t)){var r=function(t,e,r){var n,i,o,a=t.length,s=[],u=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],c=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],l=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],h=(t[e][r],t[e][r]),p=h.cval,f=rt(h,o=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"][p]);s.push([r+f[0],e+f[1]]),f=rt(h,o=l[p]),s.push([r+f[0],e+f[1]]),et(h);for(var d=r+u[p],m=e+c[p],g=p;0<=d&&0<=m&&m<a&&(d!=r||m!=e)&&void 0!==(h=t[m][d]);){if(0===(p=h.cval)||15===p)return{path:s,info:"mergeable"};o=l[p],n=u[p],i=c[p],5!==p&&10!==p||(5===p?h.flipped?(n=-1===c[g]?(o="left",-1):(o="right",1),i=0):-1===u[g]&&(o="bottom",n=0,i=-1):10===p&&(h.flipped?i=-1===u[g]?(o="top",n=0,1):(o="bottom",n=0,-1):1===c[g]&&(o="left",n=-1,i=0))),f=rt(h,o),s.push([d+f[0],m+f[1]]),et(h),d+=n,m+=i,g=p}return{path:s,info:"closed"}}(l.cells,c,e),n=!1;if("mergeable"===r.info)for(var i=r.path[r.path.length-1][0],o=r.path[r.path.length-1][1],a=p-1;0<=a;a--)if(Math.abs(h[a][0][0]-i)<=1e-7&&Math.abs(h[a][0][1]-o)<=1e-7){for(var s=r.path.length-2;0<=s;--s)h[a].unshift(r.path[s]);n=!0;break}n||(h[p++]=r.path)}var u})}),h);return"function"==typeof wo.successCallback&&wo.successCallback(s),s}function Q(t,e,r){return(t-e)/(r-e)}function tt(t){return 0===t.cval||15===t.cval}function et(t){tt(t)||5===t.cval||10===t.cval||(t.cval=15)}function rt(t,e){return"top"===e?[t.top,1]:"bottom"===e?[t.bottom,0]:"right"===e?[1,t.right]:"left"===e?[0,t.left]:void 0}function nt(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function it(t,e){if(!(this instanceof it))return new it(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function ot(t,e){at(t,0,t.children.length,e,t)}function at(t,e,r,n,i){(i=i||dt(null)).minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=e;a<r;a++)o=t.children[a],st(i,t.leaf?n(o):o);return i}function st(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function ut(t,e){return t.minX-e.minX}function ct(t,e){return t.minY-e.minY}function lt(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function ht(t){return t.maxX-t.minX+(t.maxY-t.minY)}function pt(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function ft(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function dt(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function mt(t,e,r,n,i){for(var o,a=[e,r];a.length;)(r=a.pop())-(e=a.pop())<=n||(o=e+Math.ceil((r-e)/n/2)*n,So(t,o,e,r,i),a.push(e,o,o,r))}function gt(t,e){return t(e={exports:{}},e.exports),e.exports}function yt(t,e){if(!(this instanceof yt))return new yt(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||function(t,e){return t<e?-1:e<t?1:0},0<this.length)for(var r=(this.length>>1)-1;0<=r;r--)this._down(r)}function vt(t,e,r){e=Math.max(0,void 0===e?2:e),r=r||0;for(var n,i=function(t){for(var e=t[0],r=t[0],n=t[0],i=t[0],o=0;o<t.length;o++){var a=t[o];a[0]<e[0]&&(e=a),a[0]>n[0]&&(n=a),a[1]<r[1]&&(r=a),a[1]>i[1]&&(i=a)}var s=[e,r,n,i],u=s.slice();for(o=0;o<t.length;o++)No(t[o],s)||u.push(t[o]);var c=function(n){var t=n.length;if(t<3){for(var e=new Array(t),r=0;r<t;++r)e[r]=r;return 2===t&&n[0][0]===n[1][0]&&n[0][1]===n[1][1]?[0]:e}var i=new Array(t);for(r=0;r<t;++r)i[r]=r;i.sort(function(t,e){var r=n[t][0]-n[e][0];return r||n[t][1]-n[e][1]});var o=[i[0],i[1]],a=[i[0],i[1]];for(r=2;r<t;++r){for(var s=i[r],u=n[s],c=o.length;c>1&&Io(n[o[c-2]],n[o[c-1]],u)<=0;)c-=1,o.pop();for(o.push(s),c=a.length;c>1&&Io(n[a[c-2]],n[a[c-1]],u)>=0;)c-=1,a.pop();a.push(s)}e=new Array(a.length+o.length-2);for(var l=0,h=(r=0,o.length);r<h;++r)e[l++]=o[r];for(var p=a.length-2;p>0;--p)e[l++]=a[p];return e}(u),l=[];for(o=0;o<c.length;o++)l.push(u[c[o]]);return l}(t),o=Eo(16,["[0]","[1]","[0]","[1]"]).load(t),a=[],s=0;s<i.length;s++){var u=i[s];o.remove(u),n=St(u,n),a.push(n)}var c=Eo(16);for(s=0;s<a.length;s++)c.insert(wt(a[s]));for(var l=e*e,h=r*r;a.length;){var p=a.shift(),f=p.p,d=p.next.p,m=Et(f,d);if(!(m<h)){var g=m/l;(u=function(t,e,r,n,i,o,a){for(var s=new Lo(null,_t),u=t.data;u;){for(var c=0;c<u.children.length;c++){var l=u.children[c],h=u.leaf?Ct(l,r,n):function(t,e,r){if(bt(t,r)||bt(e,r))return 0;var n=Mt(t[0],t[1],e[0],e[1],r.minX,r.minY,r.maxX,r.minY);if(0===n)return 0;var i=Mt(t[0],t[1],e[0],e[1],r.minX,r.minY,r.minX,r.maxY);if(0===i)return 0;var o=Mt(t[0],t[1],e[0],e[1],r.maxX,r.minY,r.maxX,r.maxY);if(0===o)return 0;var a=Mt(t[0],t[1],e[0],e[1],r.minX,r.maxY,r.maxX,r.maxY);return 0===a?0:Math.min(n,i,o,a)}(r,n,l);o<h||s.push({node:l,dist:h})}for(;s.length&&!s.peek().node.children;){var p=s.pop(),f=p.node,d=Ct(f,e,r),m=Ct(f,n,i);if(p.dist<d&&p.dist<m&&xt(r,f,a)&&xt(n,f,a))return f}(u=s.pop())&&(u=u.node)}return null}(o,p.prev.p,f,d,p.next.next.p,g,c))&&Math.min(Et(u,f),Et(u,d))<=g&&(a.push(p),a.push(St(u,p)),o.remove(u),c.remove(p),c.insert(wt(p)),c.insert(wt(p.next)))}}p=n;for(var y=[];y.push(p.p),(p=p.next)!==n;);return y.push(p.p),y}function _t(t,e){return t.dist-e.dist}function bt(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function xt(t,e,r){for(var n=Math.min(t[0],e[0]),i=Math.min(t[1],e[1]),o=Math.max(t[0],e[0]),a=Math.max(t[1],e[1]),s=r.search({minX:n,minY:i,maxX:o,maxY:a}),u=0;u<s.length;u++)if(c=s[u].p,l=s[u].next.p,h=t,c!==(p=e)&&l!==h&&0<ko(c,l,h)!=0<ko(c,l,p)&&0<ko(h,p,c)!=0<ko(h,p,l))return!1;var c,l,h,p;return!0}function wt(t){var e=t.p,r=t.next.p;return t.minX=Math.min(e[0],r[0]),t.minY=Math.min(e[1],r[1]),t.maxX=Math.max(e[0],r[0]),t.maxY=Math.max(e[1],r[1]),t}function St(t,e){var r={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(r.next=e.next,(r.prev=e).next.prev=r,e.next=r):(r.prev=r).next=r,r}function Et(t,e){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function Ct(t,e,r){var n=e[0],i=e[1],o=r[0]-n,a=r[1]-i;if(0!==o||0!==a){var s=((t[0]-n)*o+(t[1]-i)*a)/(o*o+a*a);1<s?(n=r[0],i=r[1]):0<s&&(n+=o*s,i+=a*s)}return(o=t[0]-n)*o+(a=t[1]-i)*a}function Mt(t,e,r,n,i,o,a,s){var u,c,l,h,p=r-t,f=n-e,d=a-i,m=s-o,g=t-i,y=e-o,v=p*p+f*f,_=p*d+f*m,b=d*d+m*m,x=p*g+f*y,w=d*g+m*y,S=v*b-_*_,E=S,C=S;0==S?(c=0,E=1,h=w,C=b):(h=v*w-_*x,(c=_*w-b*x)<0?(c=0,h=w,C=b):E<c&&(c=E,h=w+_,C=b)),h<0?-x<(h=0)?c=0:v<-x?c=E:(c=-x,E=v):C<h&&(h=C,_-x<0?c=0:v<_-x?c=E:(c=_-x,E=v));var M=(1-(l=0===h?0:h/C))*i+l*a-((1-(u=0===c?0:c/E))*t+u*r),T=(1-l)*o+l*s-((1-u)*e+u*n);return M*M+T*T}function Tt(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.concavity||1/0,n=[];if(w(t,function(t){n.push([t[0],t[1]])}),!n.length)return null;var i=Do(n,r);return 3<i.length?U([i]):null}function Pt(t,e,r){if("object"!=typeof(r=r||{}))throw new Error("options is invalid");var n=r.ignoreBoundary;if(!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var i,o,a=W(t),s=k(e),u=e.geometry?e.geometry.type:e.type,c=e.bbox;if(c&&!1==(i=a,(o=c)[0]<=i[0]&&o[1]<=i[1]&&o[2]>=i[0]&&o[3]>=i[1]))return!1;"Polygon"===u&&(s=[s]);for(var l=0,h=!1;l<s.length&&!h;l++)if(Ot(a,s[l][0],n)){for(var p=!1,f=1;f<s[l].length&&!p;)Ot(a,s[l][f],!n)&&(p=!0),f++;p||(h=!0)}return h}function Ot(t,e,r){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var i=0,o=e.length-1;i<e.length;o=i++){var a=e[i][0],s=e[i][1],u=e[o][0],c=e[o][1];if(t[1]*(a-u)+s*(u-t[0])+c*(t[0]-a)==0&&(a-t[0])*(u-t[0])<=0&&(s-t[1])*(c-t[1])<=0)return!r;s>t[1]!=c>t[1]&&t[0]<(u-a)*(t[1]-s)/(c-s)+a&&(n=!n)}return n}function At(t,e){var r=[];return T(e,function(e){E(t,function(t){Pt(t,e)&&r.push(t)})}),G(r)}function It(t,r){if("FeatureCollection"!==t.type)throw new Error("points must be a FeatureCollection");var o=!1;return G(function(t){if(t.length<3)return[];t.sort(Rt);for(var e,r,n,i,o,a,s=t.length-1,u=t[s].x,c=t[0].x,l=t[s].y,h=l;s--;)t[s].y<l&&(l=t[s].y),t[s].y>h&&(h=t[s].y);var p,f=c-u,d=h-l,m=d<f?f:d,g=.5*(c+u),y=.5*(h+l),v=[new Lt({x:g-20*m,y:y-m,__sentinel:!0},{x:g,y:y+20*m,__sentinel:!0},{x:g+20*m,y:y-m,__sentinel:!0})],_=[],b=[];for(s=t.length;s--;){for(b.length=0,p=v.length;p--;)0<(f=t[s].x-v[p].x)&&f*f>v[p].r?(_.push(v[p]),v.splice(p,1)):f*f+(d=t[s].y-v[p].y)*d>v[p].r||(b.push(v[p].a,v[p].b,v[p].b,v[p].c,v[p].c,v[p].a),v.splice(p,1));for(Nt(b),p=b.length;p;)r=b[--p],e=b[--p],n=t[s],i=r.x-e.x,o=r.y-e.y,a=2*(i*(n.y-r.y)-o*(n.x-r.x)),1e-12<Math.abs(a)&&v.push(new Lt(e,r,n))}for(Array.prototype.push.apply(_,v),s=_.length;s--;)(_[s].a.__sentinel||_[s].b.__sentinel||_[s].c.__sentinel)&&_.splice(s,1);return _}(t.features.map(function(t){var e={x:t.geometry.coordinates[0],y:t.geometry.coordinates[1]};return r?e.z=t.properties[r]:3===t.geometry.coordinates.length&&(o=!0,e.z=t.geometry.coordinates[2]),e})).map(function(t){var e=[t.a.x,t.a.y],r=[t.b.x,t.b.y],n=[t.c.x,t.c.y],i={};return o?(e.push(t.a.z),r.push(t.b.z),n.push(t.c.z)):i={a:t.a.z,b:t.b.z,c:t.c.z},U([[e,r,n,e]],i)}))}function Lt(t,e,r){this.a=t,this.b=e,this.c=r;var n,i,o=e.x-t.x,a=e.y-t.y,s=r.x-t.x,u=r.y-t.y,c=o*(t.x+e.x)+a*(t.y+e.y),l=s*(t.x+r.x)+u*(t.y+r.y),h=2*(o*(r.y-e.y)-a*(r.x-e.x));this.x=(u*c-a*l)/h,this.y=(o*l-s*c)/h,n=this.x-t.x,i=this.y-t.y,this.r=n*n+i*i}function Rt(t,e){return e.x-t.x}function Nt(t){var e,r,n,i,o,a=t.length;t:for(;a;)for(r=t[--a],e=t[--a],n=a;n;)if(o=t[--n],i=t[--n],e===i&&r===o||e===o&&r===i){t.splice(a,2),t.splice(n,2),a-=2;continue t}}function kt(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n=r.units,i=W(t),o=W(e),a=v(o[1]-i[1]),s=v(o[0]-i[0]),u=v(i[1]),c=v(o[1]),l=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(c);return d(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),n)}function Dt(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return jt(t);case"FeatureCollection":return e=t,r={type:"FeatureCollection"},Object.keys(e).forEach(function(t){switch(t){case"type":case"features":return;default:r[t]=e[t]}}),r.features=e.features.map(function(t){return jt(t)}),r;case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return zt(t);default:throw new Error("unknown GeoJSON type")}var e,r}function jt(e){var r={type:"Feature"};return Object.keys(e).forEach(function(t){switch(t){case"type":case"properties":case"geometry":return;default:r[t]=e[t]}}),r.properties=function r(n){var i={};return n&&Object.keys(n).forEach(function(t){var e=n[t];"object"==typeof e?null===e?i[t]=null:e.length?i[t]=e.map(function(t){return t}):i[t]=r(e):i[t]=e}),i}(e.properties),r.geometry=zt(e.geometry),r}function zt(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?e.geometries=t.geometries.map(function(t){return zt(t)}):e.coordinates=function e(t){return"object"!=typeof t[0]?t.slice():t.map(function(t){return e(t)})}(t.coordinates),e}function Ft(t,e){function i(t,e){e.length&&e.pop();for(var r=c[t<0?~t:t],n=0,i=r.length;n<i;++n)e.push(u(r[n],n));t<0&&$o(e,i)}function o(t){return u(t)}function a(t){for(var e=[],r=0,n=t.length;r<n;++r)i(t[r],e);return e.length<2&&e.push(e[0]),e}function r(t){for(var e=a(t);e.length<4;)e.push(e[0]);return e}function s(t){return t.map(r)}var u=Ho(t.transform),c=t.arcs;return function t(e){var r,n=e.type;switch(n){case"GeometryCollection":return{type:n,geometries:e.geometries.map(t)};case"Point":r=o(e.coordinates);break;case"MultiPoint":r=e.coordinates.map(o);break;case"LineString":r=a(e.arcs);break;case"MultiLineString":r=e.arcs.map(a);break;case"Polygon":r=s(e.arcs);break;case"MultiPolygon":r=e.arcs.map(s);break;default:return null}return{type:n,coordinates:r}}(e)}function Bt(s,t){function r(e){e.forEach(function(t){t.forEach(function(t){(c[t=t<0?~t:t]||(c[t]=[])).push(e)})}),n.push(e)}function u(t){return function(t){for(var e,r=-1,n=t.length,i=t[n-1],o=0;++r<n;)e=i,i=t[r],o+=e[0]*i[1]-e[1]*i[0];return Math.abs(o)}(Ft(s,{type:"Polygon",arcs:[t]}).coordinates[0])}var c={},n=[],i=[];return t.forEach(function t(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"Polygon":r(e.arcs);break;case"MultiPolygon":e.arcs.forEach(r)}}),n.forEach(function(t){if(!t._){var e=[],r=[t];for(t._=1,i.push(e);t=r.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){c[t<0?~t:t].forEach(function(t){t._||(t._=1,r.push(t))})})})}}),n.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:i.map(function(t){var e,r=[];if(t.forEach(function(t){t.forEach(function(t){t.forEach(function(t){c[t<0?~t:t].length<2&&r.push(t)})})}),1<(e=(r=function(u,i){function t(t,e){for(var r in t){var n=t[r];delete e[n.start],delete n.start,delete n.end,n.forEach(function(t){o[t<0?~t:t]=1}),a.push(n)}}var o={},c={},l={},a=[],s=-1;return i.forEach(function(t,e){var r,n=u.arcs[t<0?~t:t];n.length<3&&!n[1][0]&&!n[1][1]&&(r=i[++s],i[s]=t,i[e]=r)}),i.forEach(function(t){var e,r,n=function(t){var e,r=u.arcs[t<0?~t:t],n=r[0];return u.transform?(e=[0,0],r.forEach(function(t){e[0]+=t[0],e[1]+=t[1]})):e=r[r.length-1],t<0?[e,n]:[n,e]}(t),i=n[0],o=n[1];if(e=l[i])if(delete l[e.end],e.push(t),e.end=o,r=c[o]){delete c[r.start];var a=r===e?e:e.concat(r);c[a.start=e.start]=l[a.end=r.end]=a}else c[e.start]=l[e.end]=e;else if(e=c[o])if(delete c[e.start],e.unshift(t),e.start=i,r=l[i]){delete l[r.end];var s=r===e?e:r.concat(e);c[s.start=r.start]=l[s.end=e.end]=s}else c[e.start]=l[e.end]=e;else c[(e=[t]).start=i]=l[e.end=o]=e}),t(l,c),t(c,l),i.forEach(function(t){o[t<0?~t:t]||a.push([t])}),a}(s,r)).length))for(var n,i,o=1,a=u(r[0]);o<e;++o)(n=u(r[o]))>a&&(i=r[0],r[0]=r[o],r[o]=i,a=n);return r})}}function Ut(t,e,r){for(var n,i=e+(r---e>>1);e<i;++e,--r)n=t[e],t[e]=t[r],t[r]=n}function Vt(t){return null==t?{type:null}:("FeatureCollection"===t.type?function(t){var e={type:"GeometryCollection",geometries:t.features.map(Gt)};return null!=t.bbox&&(e.bbox=t.bbox),e}:"Feature"===t.type?Gt:qt)(t)}function Gt(t){var e,r=qt(t.geometry);for(e in null!=t.id&&(r.id=t.id),null!=t.bbox&&(r.bbox=t.bbox),t.properties){r.properties=t.properties;break}return r}function qt(t){if(null==t)return{type:null};var e="GeometryCollection"===t.type?{type:"GeometryCollection",geometries:t.geometries.map(qt)}:"Point"===t.type||"MultiPoint"===t.type?{type:t.type,coordinates:t.coordinates}:{type:t.type,arcs:t.coordinates};return null!=t.bbox&&(e.bbox=t.bbox),e}function Ht(t){var e,r=t[0],n=t[1];return n<r&&(e=r,r=n,n=e),r+31*n}function $t(t,e){var r,n=t[0],i=t[1],o=e[0],a=e[1];return i<n&&(r=n,n=i,i=r),a<o&&(r=o,o=a,a=r),n===o&&i===a}function Wt(t){return t[0].toString()+","+t[1].toString()}function Xt(r,t){if(!H(t=t||{}))throw new Error("options is invalid");var e=t.mutate;if("FeatureCollection"!==K(r))throw new Error("geojson must be a FeatureCollection");if(!r.features.length)throw new Error("geojson is empty");!1!==e&&void 0!==e||(r=Dt(r));var n=function(){var e={};O(r,function(t){e[t.geometry.type]=!0});var t=Object.keys(e);return 1===t.length?t[0]:null}();if(!n)throw new Error("geojson must be homogenous");switch(n){case"LineString":return function(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.mutate;if("FeatureCollection"!==K(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==r&&void 0!==r||(t=Dt(t));var n=[],i=N(t,function(c,t){return function(t,e){var r,n=c.geometry.coordinates,i=e.geometry.coordinates,o=Wt(n[0]),a=Wt(n[n.length-1]),s=Wt(i[0]),u=Wt(i[i.length-1]);if(o===u)r=i.concat(n.slice(1));else if(s===a)r=n.concat(i.slice(1));else if(o===s)r=n.slice(1).reverse().concat(i);else{if(a!==u)return null;r=n.concat(i.reverse().slice(1))}return V(r)}(0,t)||(n.push(c),t)});return i&&n.push(i),n.length?1===n.length?n[0]:_(n.map(function(t){return t.coordinates})):null}(r,t);case"Polygon":return function(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.mutate;if("FeatureCollection"!==K(t))throw new Error("geojson must be a FeatureCollection");if(!t.features.length)throw new Error("geojson is empty");!1!==r&&void 0!==r||(t=Dt(t));var n=[];O(t,function(t){n.push(t.geometry)});var i=function(t,e){function r(t){t&&l.hasOwnProperty(t.type)&&l[t.type](t)}function n(t){var e=[];do{var r=c.get(t);e.push(t[0]<t[1]?r:~r)}while(t=t.next);return e}function i(t){return t.map(n)}var o=function(t){function e(t){null!=t&&c.hasOwnProperty(t.type)&&c[t.type](t)}function r(t){var e=t[0],r=t[1];e<o&&(o=e),e>s&&(s=e),r<a&&(a=r),r>u&&(u=r)}function n(t){t.forEach(r)}function i(t){t.forEach(n)}var o=1/0,a=1/0,s=-1/0,u=-1/0,c={GeometryCollection:function(t){t.geometries.forEach(e)},Point:function(t){r(t.coordinates)},MultiPoint:function(t){t.coordinates.forEach(r)},LineString:function(t){n(t.arcs)},MultiLineString:function(t){t.arcs.forEach(n)},Polygon:function(t){t.arcs.forEach(n)},MultiPolygon:function(t){t.arcs.forEach(i)}};for(var l in t)e(t[l]);return s>=o&&u>=a?[o,a,s,u]:void 0}(t=function(t){var e,r={};for(e in t)r[e]=Vt(t[e]);return r}(t)),a=e>0&&o&&function(t,e,r){function n(t){return[Math.round((t[0]-h)*f),Math.round((t[1]-p)*d)]}function i(t,e){for(var r,n,i,o,a,s=-1,u=0,c=t.length,l=new Array(c);++s<c;)r=t[s],o=Math.round((r[0]-h)*f),a=Math.round((r[1]-p)*d),o===n&&a===i||(l[u++]=[n=o,i=a]);for(l.length=u;u<e;)u=l.push([l[0][0],l[0][1]]);return l}function o(t){return i(t,2)}function a(t){return i(t,4)}function s(t){return t.map(a)}function u(t){null!=t&&m.hasOwnProperty(t.type)&&m[t.type](t)}var h=e[0],p=e[1],c=e[2],l=e[3],f=c-h?(r-1)/(c-h):1,d=l-p?(r-1)/(l-p):1,m={GeometryCollection:function(t){t.geometries.forEach(u)},Point:function(t){t.coordinates=n(t.coordinates)},MultiPoint:function(t){t.coordinates=t.coordinates.map(n)},LineString:function(t){t.arcs=o(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(o)},Polygon:function(t){t.arcs=s(t.arcs)},MultiPolygon:function(t){t.arcs=t.arcs.map(s)}};for(var g in t)u(t[g]);return{scale:[1/f,1/d],translate:[h,p]}}(t,o,e),s=Go(Vo(function(t){function e(t){t&&c.hasOwnProperty(t.type)&&c[t.type](t)}function r(t){for(var e=0,r=t.length;e<r;++e)u[++o]=t[e];var n={0:o-r+1,1:o};return a.push(n),n}function n(t){for(var e=0,r=t.length;e<r;++e)u[++o]=t[e];var n={0:o-r+1,1:o};return s.push(n),n}function i(t){return t.map(n)}var o=-1,a=[],s=[],u=[],c={GeometryCollection:function(t){t.geometries.forEach(e)},LineString:function(t){t.arcs=r(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(r)},Polygon:function(t){t.arcs=t.arcs.map(n)},MultiPolygon:function(t){t.arcs=t.arcs.map(i)}};for(var l in t)e(t[l]);return{type:"Topology",coordinates:u,lines:a,rings:s,objects:t}}(t))),u=s.coordinates,c=Fo(1.4*s.arcs.length,Ht,$t);t=s.objects,s.bbox=o,s.arcs=s.arcs.map(function(t,e){return c.set(t,e),u.slice(t[0],t[1]+1)}),delete s.coordinates,u=null;var l={GeometryCollection:function(t){t.geometries.forEach(r)},LineString:function(t){t.arcs=n(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(n)},Polygon:function(t){t.arcs=t.arcs.map(n)},MultiPolygon:function(t){t.arcs=t.arcs.map(i)}};for(var h in t)r(t[h]);return a&&(s.transform=a,s.arcs=function(t){for(var e=-1,r=t.length;++e<r;){for(var n,i,o=t[e],a=0,s=1,u=o.length,c=o[0],l=c[0],h=c[1];++a<u;)n=(c=o[a])[0],i=c[1],n===l&&i===h||(o[s++]=[n-l,i-h],l=n,h=i);1===s&&(o[s++]=[0,0]),o.length=s}return t}(s.arcs)),s}({geoms:a(n).geometry});return function(t){return Ft(t,Bt.apply(this,arguments))}(i,i.objects.geoms.geometries)}(r,t);default:throw new Error(n+" is not supported")}}function Yt(t,e){var r="object"==typeof e?e.mutate:e;if(!t)throw new Error("geojson is required");var n=K(t),i=[];switch(n){case"LineString":i=Zt(t);break;case"MultiLineString":case"Polygon":k(t).forEach(function(t){i.push(Zt(t))});break;case"MultiPolygon":k(t).forEach(function(t){var e=[];t.forEach(function(t){e.push(Zt(t))}),i.push(e)});break;case"Point":return t;case"MultiPoint":var o={};k(t).forEach(function(t){var e=t.join("-");o.hasOwnProperty(e)||(i.push(t),o[e]=!0)});break;default:throw new Error(n+" geometry not supported")}return t.coordinates?!0===r?(t.coordinates=i,t):{type:n,coordinates:i}:!0===r?(t.geometry.coordinates=i,t):F({type:n,coordinates:i},t.properties,t.bbox,t.id)}function Zt(t){var e,r,n=k(t);if(2===n.length&&(e=n[0],r=n[1],e[0]!==r[0]||e[1]!==r[1]))return n;var i,o,a,s,u,c,l,h,p,f,d,m,g,y,v=[],_=n.length-1;v.push(n[0]);for(var b=1;b<_;b++)i=n[b-1],o=n[b],s=i,u=a=n[b+1],void 0,l=(c=o)[0],h=c[1],p=s[0],f=s[1],d=u[0],m=u[1],(l-p)*(y=m-f)-(h-f)*(g=d-p)==0&&(Math.abs(g)>=Math.abs(y)?0<g?p<=l&&l<=d:d<=l&&l<=p:0<y?f<=h&&h<=m:m<=h&&h<=f)||v.push(o);return v.push(a),v}function Kt(t,e,r){var n=e.x,i=e.y,o=r.x-n,a=r.y-i;if(0!==o||0!==a){var s=((t.x-n)*o+(t.y-i)*a)/(o*o+a*a);1<s?(n=r.x,i=r.y):0<s&&(n+=o*s,i+=a*s)}return(o=t.x-n)*o+(a=t.y-i)*a}function Jt(t,e,r){if(t.length<=2)return t;var n,i,o,a,s=void 0!==e?e*e:1;return t=r?t:function(t,e){for(var r,n=t[0],i=[n],o=1,a=t.length;o<a;o++)s=r=t[o],u=n,void 0,c=s.x-u.x,l=s.y-u.y,e<c*c+l*l&&(i.push(r),n=r);var s,u,c,l;return n!==r&&i.push(r),i}(t,s),i=s,o=(n=t).length-1,a=[n[0]],function t(e,r,n,i,o){for(var a,s=i,u=r+1;u<n;u++){var c=Kt(e[u],e[r],e[n]);s<c&&(a=u,s=c)}i<s&&(1<a-r&&t(e,r,a,i,o),o.push(e[a]),1<n-a&&t(e,a,n,i,o))}(n,0,o,i,a),a.push(n[o]),a}function Qt(t,e,r){return Jt(t.map(function(t){return{x:t[0],y:t[1],z:t[2]}}),e,r).map(function(t){return t.z?[t.x,t.y,t.z]:[t.x,t.y]})}function te(t,i,o){return t.map(function(t){var e,r=t.map(function(t){return{x:t[0],y:t[1]}});if(r.length<4)throw new Error("invalid polygon");for(var n=Jt(r,i,o).map(function(t){return[t.x,t.y]});(e=n).length<3||3===e.length&&e[2][0]===e[0][0]&&e[2][1]===e[0][1];)n=Jt(r,i-=.01*i,o).map(function(t){return[t.x,t.y]});return n[n.length-1][0]===n[0][0]&&n[n.length-1][1]===n[0][1]||n.push(n[0]),n})}function ee(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.resolution||1e4,n=e.sharpness||.85;if(!t)throw new Error("line is required");if(!q(r))throw new Error("resolution must be an number");if(!q(n))throw new Error("sharpness must be an number");for(var i=[],o=new qo({points:Y(t).coordinates.map(function(t){return{x:t[0],y:t[1]}}),duration:r,sharpness:n}),a=0;a<o.duration;a+=10){var s=o.pos(a);Math.floor(a/100)%2==0&&i.push([s.x,s.y])}return V(i,t.properties)}function re(t){h(t);var e=Number(t[0]),r=Number(t[1]),n=Number(t[2]),i=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var o=[e,r];return U([[o,[n,r],[n,i],[e,i],o]])}function ne(t){return re($(t))}function ie(t){var e=t[0],r=t[1],n=t[2],i=t[3];if(kt(t.slice(0,2),[n,r])>=kt(t.slice(0,2),[e,i])){var o=(r+i)/2;return[e,o-(n-e)/2,n,o+(n-e)/2]}var a=(e+n)/2;return[a-(i-r)/2,r,a+(i-r)/2,i]}function oe(t,e,r,n){if(!H(n=n||{}))throw new Error("options is invalid");var i=n.units,o=n.properties,a=W(t),s=v(a[0]),u=v(a[1]),c=v(r),l=m(e,i),h=Math.asin(Math.sin(u)*Math.cos(l)+Math.cos(u)*Math.sin(l)*Math.cos(c));return B([f(s+Math.atan2(Math.sin(c)*Math.sin(l)*Math.cos(u),Math.cos(l)-Math.sin(u)*Math.sin(h))),f(h)],o)}function ae(t,e,r){var n=(r=r||{}).steps||64,i=r.properties;if(!t)throw new Error("center is required");if(!e)throw new Error("radius is required");if("object"!=typeof r)throw new Error("options must be an object");if("number"!=typeof n)throw new Error("steps must be a number");n=n||64,i=i||t.properties||{};for(var o=[],a=0;a<n;a++)o.push(oe(t,e,-360*a/n,r).geometry.coordinates);return o.push(o[0]),U([o],i)}function se(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");if(!0===r.final)return(se(e,t)+180)%360;var n=W(t),i=W(e),o=v(n[0]),a=v(i[0]),s=v(n[1]),u=v(i[1]),c=Math.sin(a-o)*Math.cos(u),l=Math.cos(s)*Math.sin(u)-Math.sin(s)*Math.cos(u)*Math.cos(a-o);return f(Math.atan2(c,l))}function ue(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.properties;if(!t)throw new Error("geojson is required");var n=$(t);return B([(n[0]+n[2])/2,(n[1]+n[3])/2],r)}function ce(t,e){var r=0,n=0,i=0;return w(t,function(t){r+=t[0],n+=t[1],i++},!0),B([r/i,n/i],e)}function le(e){var r=[];return"FeatureCollection"===e.type?E(e,function(e){w(e,function(t){r.push(B(t,e.properties))})}):w(e,function(t){r.push(B(t,e.properties))}),G(r)}function he(t,e,r){r=r||2;var n,i,o,a,s,u,c,l=e&&e.length,h=l?e[0]*r:t.length,p=pe(t,0,h,r,!0),f=[];if(!p)return f;if(l&&(p=function(t,e,r,n){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=pe(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),s.push(function(t){for(var e=t,r=t;e.x<r.x&&(r=e),(e=e.next)!==t;);return r}(a));for(s.sort(de),i=0;i<s.length;i++)!function(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&a<s){if((a=s)===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r.prev;var u,c=r,l=r.x,h=r.y,p=1/0;for(n=r.next;n!==c;)i>=n.x&&n.x>=l&&i!==n.x&&ge(o<h?i:a,o,l,h,o<h?a:i,o,n.x,n.y)&&((u=Math.abs(o-n.y)/(i-n.x))<p||u===p&&n.x>r.x)&&be(n,t)&&(r=n,p=u),n=n.next;return r}(t,e)){var r=xe(e,t);fe(r,r.next)}}(s[i],r),r=fe(r,r.next);return r}(t,e,p,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var d=r;d<h;d+=r)(s=t[d])<n&&(n=s),(u=t[d+1])<i&&(i=u),o<s&&(o=s),a<u&&(a=u);c=0!==(c=Math.max(o-n,a-i))?1/c:0}return function c(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){for(var i=t;null===i.z&&(i.z=me(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,(i=i.next)!==t;);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,u,c=1;do{for(r=t,o=t=null,a=0;r;){for(a++,n=r,e=s=0;e<c&&(s++,n=n.nextZ);e++);for(u=c;0<s||0<u&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(r=(i=r).nextZ,s--):(n=(i=n).nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(1<a)}(i)}(t,n,i,o);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?function(t,e,r,n){var i=t.prev,o=t,a=t.next;if(0<=ye(i,o,a))return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=me(s,u,e,r,n),p=me(c,l,e,r,n),f=t.nextZ;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&ge(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&0<=ye(f.prev,f,f.next))return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&ge(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&0<=ye(f.prev,f,f.next))return!1;f=f.prevZ}return!0}(t,n,i,o):function(t){var e=t.prev,r=t,n=t.next;if(0<=ye(e,r,n))return!1;for(var i=t.next.next;i!==t.prev;){if(ge(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&0<=ye(i.prev,i,i.next))return!1;i=i.next}return!0}(t))e.push(s.i/r),e.push(t.i/r),e.push(u.i/r),Se(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?c(t=function(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!ve(i,o)&&_e(i,n,n.next,o)&&be(i,o)&&be(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),Se(n),Se(n.next),n=t=o),n=n.next}while(n!==t);return n}(t,e,r),e,r,n,i,o,2):2===a&&function(t,e,r,n,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&_e(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&be(t,e)&&be(e,t)&&function(t,e){for(var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),(r=r.next)!==t;);return n}(t,e)}(a,s)){var u=xe(a,s);return a=fe(a,a.next),u=fe(u,u.next),c(a,e,r,n,i,o),c(u,e,r,n,i,o)}s=s.next}a=a.next}while(a!==t)}(t,e,r,n,i,o):c(fe(t),e,r,n,i,o,1);break}}}(p,f,r,n,i,c),f}function pe(t,e,r,n,i){var o,a;if(i===0<Ce(t,e,r,n))for(o=e;o<r;o+=n)a=we(o,t[o],t[o+1],a);else for(o=r-n;e<=o;o-=n)a=we(o,t[o],t[o+1],a);return a&&ve(a,a.next)&&(Se(a),a=a.next),a}function fe(t,e){if(!t)return t;e=e||t;var r,n=t;do{if(r=!1,n.steiner||!ve(n,n.next)&&0!==ye(n.prev,n,n.next))n=n.next;else{if(Se(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function de(t,e){return t.x-e.x}function me(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ge(t,e,r,n,i,o,a,s){return 0<=(i-a)*(e-s)-(t-a)*(o-s)&&0<=(t-a)*(n-s)-(r-a)*(e-s)&&0<=(r-a)*(o-s)-(i-a)*(n-s)}function ye(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function ve(t,e){return t.x===e.x&&t.y===e.y}function _e(t,e,r,n){return!!(ve(t,e)&&ve(r,n)||ve(t,n)&&ve(r,e))||0<ye(t,e,r)!=0<ye(t,e,n)&&0<ye(r,n,t)!=0<ye(r,n,e)}function be(t,e){return ye(t.prev,t,t.next)<0?0<=ye(t,e,t.next)&&0<=ye(t,t.prev,e):ye(t,e,t.prev)<0||ye(t,t.next,e)<0}function xe(t,e){var r=new Ee(t.i,t.x,t.y),n=new Ee(e.i,e.x,e.y),i=t.next,o=e.prev;return(t.next=e).prev=t,(r.next=i).prev=r,(n.next=r).prev=n,(o.next=n).prev=o,n}function we(t,e,r,n){var i=new Ee(t,e,r);return n?(i.next=n.next,(i.prev=n).next.prev=i,n.next=i):(i.prev=i).next=i,i}function Se(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ee(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ce(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function Me(t){var n=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);0<i&&(n+=t[i-1].length,r.holes.push(n))}return r}(t),i=Zo(n.vertices,n.holes,2),e=[],o=[];i.forEach(function(t,e){var r=i[e];o.push([n.vertices[2*r],n.vertices[2*r+1]])});for(var r=0;r<o.length;r+=3){var a=o.slice(r,r+3);a.push(o[r]),e.push(U([a]))}return e}function Te(n,t){if(!n)throw new Error("targetPoint is required");if(!t)throw new Error("points is required");var i,o=1/0;return E(t,function(t,e){var r=kt(n,t);r<o&&((i=Dt(t)).properties.featureIndex=e,i.properties.distanceToPoint=r,o=r)}),i}function Pe(t,e,r,n,i){!function t(e,r,n,i,o){for(;n<i;){if(600<i-n){var a=i-n+1,s=r-n+1,u=Math.log(a),c=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*c*(a-c)/a)*(s-a/2<0?-1:1);t(e,r,Math.max(n,Math.floor(r-s*c/a+l)),Math.min(i,Math.floor(r+(a-s)*c/a+l)),o)}var h=e[r],p=n,f=i;for(Oe(e,n,r),0<o(e[i],h)&&Oe(e,n,i);p<f;){for(Oe(e,p,f),p++,f--;o(e[p],h)<0;)p++;for(;0<o(e[f],h);)f--}0===o(e[n],h)?Oe(e,n,f):Oe(e,++f,i),f<=r&&(n=f+1),r<=f&&(i=f-1)}}(t,e,r||0,n||t.length-1,i||function(t,e){return t<e?-1:e<t?1:0})}function Oe(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function Ae(t,e){if(!(this instanceof Ae))return new Ae(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function Ie(t,e){Le(t,0,t.children.length,e,t)}function Le(t,e,r,n,i){(i=i||Be(null)).minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=e;a<r;a++)o=t.children[a],Re(i,t.leaf?n(o):o);return i}function Re(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Ne(t,e){return t.minX-e.minX}function ke(t,e){return t.minY-e.minY}function De(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function je(t){return t.maxX-t.minX+(t.maxY-t.minY)}function ze(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Fe(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Be(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ue(t,e,r,n,i){for(var o,a=[e,r];a.length;)(r=a.pop())-(e=a.pop())<=n||(Pe(t,o=e+Math.ceil((r-e)/n/2)*n,e,r,i),a.push(e,o,o,r))}function Ve(t){var e=Ae(t);return e.insert=function(t){if(Array.isArray(t)){var e=t;(t=Ge(e)).bbox=e}else t.bbox=t.bbox?t.bbox:qe(t);return Ae.prototype.insert.call(this,t)},e.load=function(t){var r=[];return Array.isArray(t)?t.forEach(function(t){var e=Ge(t);e.bbox=t,r.push(e)}):E(t,function(t){t.bbox=t.bbox?t.bbox:qe(t),r.push(t)}),Ae.prototype.load.call(this,r)},e.remove=function(t){if(Array.isArray(t)){var e=t;(t=Ge(e)).bbox=e}return Ae.prototype.remove.call(this,t)},e.clear=function(){return Ae.prototype.clear.call(this)},e.search=function(t){return{type:"FeatureCollection",features:Ae.prototype.search.call(this,this.toBBox(t))}},e.collides=function(t){return Ae.prototype.collides.call(this,this.toBBox(t))},e.all=function(){return{type:"FeatureCollection",features:Ae.prototype.all.call(this)}},e.toJSON=function(){return Ae.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ae.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;return{minX:(e=t.bbox?t.bbox:Array.isArray(t)&&4===t.length?t:qe(t))[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}function Ge(t){var e=[t[0],t[1]],r=[t[0],t[3]],n=[t[2],t[3]];return{type:"Feature",bbox:t,properties:{},geometry:{type:"Polygon",coordinates:[[e,[t[2],t[1]],n,r,e]]}}}function qe(t){var e=[1/0,1/0,-1/0,-1/0];return w(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}function He(t){if(!t)throw new Error("geojson is required");var e=[];return O(t,function(t){!function(r,n){var t=[],e=r.geometry;switch(e.type){case"Polygon":t=k(e);break;case"LineString":t=[k(e)]}t.forEach(function(t){var e,c,l;(e=t,c=r.properties,l=[],e.reduce(function(t,e){var r,n,i,o,a,s,u=V([t,e],c);return u.bbox=(n=e,i=(r=t)[0],o=r[1],a=n[0],s=n[1],[i<a?i:a,o<s?o:s,a<i?i:a,s<o?o:s]),l.push(u),e}),l).forEach(function(t){t.id=n.length,n.push(t)})})}(t,e)}),G(e)}function $e(t,e){var i={},o=[];if("LineString"===t.type&&(t=F(t)),"LineString"===e.type&&(e=F(e)),"Feature"===t.type&&"Feature"===e.type&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var r=We(t,e);return r&&o.push(r),G(o)}var a=Ve();return a.load(He(e)),E(He(t),function(n){E(a.search(n),function(t){var e=We(n,t);if(e){var r=k(e).join(",");i[r]||(i[r]=!0,o.push(e))}})}),G(o)}function We(t,e){var r=k(t),n=k(e);if(2!==r.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==n.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=r[0][0],o=r[0][1],a=r[1][0],s=r[1][1],u=n[0][0],c=n[0][1],l=n[1][0],h=n[1][1],p=(h-c)*(a-i)-(l-u)*(s-o);if(0==p)return null;var f=((l-u)*(o-c)-(h-c)*(i-u))/p,d=((a-i)*(o-c)-(s-o)*(i-u))/p;return 0<=f&&f<=1&&0<=d&&d<=1?B([i+f*(a-i),o+f*(s-o)]):null}function Xe(t,p,f){if(!H(f=f||{}))throw new Error("options is invalid");var e=t.geometry?t.geometry.type:t.type;if("LineString"!==e&&"MultiLineString"!==e)throw new Error("lines must be LineString or MultiLineString");var d=B([1/0,1/0],{dist:1/0}),m=0;return O(t,function(t){for(var e=k(t),r=0;r<e.length-1;r++){var n=B(e[r]);n.properties.dist=kt(p,n,f);var i=B(e[r+1]);i.properties.dist=kt(p,i,f);var o=kt(n,i,f),a=Math.max(n.properties.dist,i.properties.dist),s=se(n,i),u=oe(p,a,s+90,f),c=oe(p,a,s-90,f),l=$e(V([u.geometry.coordinates,c.geometry.coordinates]),V([n.geometry.coordinates,i.geometry.coordinates])),h=null;0<l.features.length&&((h=l.features[0]).properties.dist=kt(p,h,f),h.properties.location=m+kt(n,h,f)),n.properties.dist<d.properties.dist&&((d=n).properties.index=r,d.properties.location=m),i.properties.dist<d.properties.dist&&((d=i).properties.index=r+1,d.properties.location=m+o),h&&h.properties.dist<d.properties.dist&&((d=h).properties.index=r),m+=o}}),d}function Ye(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n,i=r.final;if(!t)throw new Error("start point is required");if(!e)throw new Error("end point is required");return 180<(n=i?Ze(W(e),W(t)):Ze(W(t),W(e)))?-(360-n):n}function Ze(t,e){var r=v(t[1]),n=v(e[1]),i=v(e[0]-t[0]);i>Math.PI&&(i-=2*Math.PI),i<-Math.PI&&(i+=2*Math.PI);var o=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(r/2+Math.PI/4));return(f(Math.atan2(i,o))+360)%360}function Ke(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n=r.units;if(!t)throw new Error("from point is required");if(!e)throw new Error("to point is required");var i=W(t),o=W(e);return o[0]+=180<o[0]-i[0]?-360:180<i[0]-o[0]?360:0,c(function(t,e,r){var n=r=void 0===r?fo:Number(r),i=t[1]*Math.PI/180,o=e[1]*Math.PI/180,a=o-i,s=Math.abs(e[0]-t[0])*Math.PI/180;s>Math.PI&&(s-=2*Math.PI);var u=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),c=1e-11<Math.abs(u)?a/u:Math.cos(i);return Math.sqrt(a*a+c*c*s*s)*n}(i,o),"meters",n)}function Je(t,e){return tr(t,"mercator",e)}function Qe(t,e){return tr(t,"wgs84",e)}function tr(t,r,e){if(!H(e=e||{}))throw new Error("options is invalid");var n=e.mutate;if(!t)throw new Error("geojson is required");return Array.isArray(t)&&q(t[0])?t="mercator"===r?er(t):rr(t):(!0!==n&&(t=Dt(t)),w(t,function(t){var e="mercator"===r?er(t):rr(t);t[0]=e[0],t[1]=e[1]})),t}function er(t){var e,r=Math.PI/180,n=20037508.342789244,i=[6378137*(Math.abs(t[0])<=180?t[0]:t[0]-360*(e=t[0],e<0?-1:0<e?1:0))*r,6378137*Math.log(Math.tan(.25*Math.PI+.5*t[1]*r))];return i[0]>n&&(i[0]=n),i[0]<-n&&(i[0]=-n),i[1]>n&&(i[1]=n),i[1]<-n&&(i[1]=-n),i}function rr(t){var e=180/Math.PI;return[t[0]*e/6378137,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/6378137)))*e]}function nr(t,e,i){if(!H(i=i||{}))throw new Error("options is invalid");if(!t)throw new Error("pt is required");if(Array.isArray(t)?t=B(t):"Point"===t.type?t=F(t):z(t,"Point","point"),!e)throw new Error("line is required");Array.isArray(e)?e=V(e):"LineString"===e.type?e=F(e):z(e,"LineString","line");var o=1/0,a=t.geometry.coordinates;return I(e,function(t){var e=t.geometry.coordinates[0],r=t.geometry.coordinates[1],n=function(t,e,r,n){var i=n.mercator,o=!0!==i?kt(e,t,n):ir(e,t,n),a=p(!0!==i?se(e,t):Ye(e,t)),s=p(!0!==i?se(e,r):Ye(e,r)),u=Math.abs(a-s);if(90<u)return o;var c=(s+180)%360,l=p(!0!==i?se(r,t):Ye(r,t)),h=Math.abs(l-c);return 180<h&&(h=Math.abs(h-360)),90<h?!0!==i?kt(t,r,n):ir(t,r,n):!0!==i?o*Math.sin(v(u)):function(t,e,r,n){var i=0;(180<=Math.abs(t[0])||180<=Math.abs(e[0])||180<=Math.abs(r[0]))&&(i=0<t[0]||0<e[0]||0<r[0]?-180:180);var o,a,s,u,c,l,h,p,f=B(r),d=Je([t[0]+i,t[1]]),m=Je([e[0]+i,e[1]]),g=Je([r[0]+i,r[1]]),y=Qe((a=m,s=g,u=(o=d)[0],c=o[1],l=a[0]-u,h=a[1]-c,p=((s[0]-u)*l+(s[1]-c)*h)/(l*l+h*h),[u+p*l,c+p*h]));return 0!==i&&(y[0]-=i),Ke(f,y,n)}(e,r,t,n)}(a,e,r,i);n<o&&(o=n)}),o}function ir(t,e,r){var n=r.units,i=0;180<=Math.abs(t[0])&&(i=0<t[0]?-180:180),180<=Math.abs(e[0])&&(i=0<e[0]?-180:180);function o(t){return t*t}var a=Je([t[0]+i,t[1]]),s=Je([e[0]+i,e[1]]),u=o(a[0]-s[0])+o(a[1]-s[1]);return c(Math.sqrt(u),"meters",n)}function or(t){for(var e="FeatureCollection"!==(h=t).type?"Feature"!==h.type?G([F(h)]):G([h]):h,r=ue(e),n=!1,i=0;!n&&i<e.features.length;){var o,a=e.features[i].geometry,s=!1;if("Point"===a.type)r.geometry.coordinates[0]===a.coordinates[0]&&r.geometry.coordinates[1]===a.coordinates[1]&&(n=!0);else if("MultiPoint"===a.type){var u=!1;for(o=0;!u&&o<a.coordinates.length;)r.geometry.coordinates[0]===a.coordinates[o][0]&&r.geometry.coordinates[1]===a.coordinates[o][1]&&(u=n=!0),o++}else if("LineString"===a.type)for(o=0;!s&&o<a.coordinates.length-1;)ar(r.geometry.coordinates[0],r.geometry.coordinates[1],a.coordinates[o][0],a.coordinates[o][1],a.coordinates[o+1][0],a.coordinates[o+1][1])&&(n=s=!0),o++;else if("MultiLineString"===a.type)for(var c=0;c<a.coordinates.length;){s=!1,o=0;for(var l=a.coordinates[c];!s&&o<l.length-1;)ar(r.geometry.coordinates[0],r.geometry.coordinates[1],l[o][0],l[o][1],l[o+1][0],l[o+1][1])&&(n=s=!0),o++;c++}else"Polygon"!==a.type&&"MultiPolygon"!==a.type||Pt(r,a)&&(n=!0);i++}var h;if(n)return r;var p=G([]);for(i=0;i<e.features.length;i++)p.features=p.features.concat(le(e.features[i]).features);return B(Te(r,p).geometry.coordinates)}function ar(t,e,r,n,i,o){return Math.sqrt((i-r)*(i-r)+(o-n)*(o-n))===Math.sqrt((t-r)*(t-r)+(e-n)*(e-n))+Math.sqrt((i-t)*(i-t)+(o-e)*(o-e))}function sr(t){return P(t,function(t,e){return t+function t(e){var r,n=0;switch(e.type){case"Polygon":return ur(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)n+=ur(e.coordinates[r]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<e.geometries.length;r++)n+=t(e.geometries[r]);return n}}(e)},0)}function ur(t){var e=0;if(t&&0<t.length){e+=Math.abs(cr(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs(cr(t[r]))}return e}function cr(t){var e,r,n,i,o,a,s=0,u=t.length;if(2<u){for(a=0;a<u;a++)o=a===u-2?(n=u-2,i=u-1,0):a===u-1?(n=u-1,i=0,1):(i=(n=a)+1,a+2),e=t[n],r=t[i],s+=(lr(t[o][0])-lr(e[0]))*Math.sin(lr(r[1]));s=s*ta*ta/2}return s}function lr(t){return t*Math.PI/180}function hr(t,n){if(!H(n=n||{}))throw new Error("options is invalid");if(!t)throw new Error("geojson is required");return L(t,function(t,e){var r=e.geometry.coordinates;return t+kt(r[0],r[1],n)},0)}function pr(t,e,r,n){if(!H(n=n||{}))throw new Error("options is invalid");var i,o=[];if("Feature"===t.type)i=t.geometry.coordinates;else{if("LineString"!==t.type)throw new Error("input must be a LineString Feature or Geometry");i=t.coordinates}for(var a,s,u,c=0,l=0;l<i.length&&!(c<=e&&l===i.length-1);l++){if(e<c&&0===o.length){if(!(a=e-c))return o.push(i[l]),V(o);s=se(i[l],i[l-1])-180,u=oe(i[l],a,s,n),o.push(u.geometry.coordinates)}if(r<=c)return(a=r-c)?(s=se(i[l],i[l-1])-180,u=oe(i[l],a,s,n),o.push(u.geometry.coordinates)):o.push(i[l]),V(o);if(e<=c&&o.push(i[l]),l===i.length-1)return V(o);c+=kt(i[l],i[l+1],n)}return V(i[i.length-1])}function fr(t,e,r){var n,i,o,a,s,u,c,l,h,p,f,d,m=(r=r||{}).ignoreEndVertices;if(!H(r))throw new Error("invalid options");if(!t)throw new Error("pt is required");if(!e)throw new Error("line is required");for(var g=W(t),y=k(e),v=0;v<y.length-1;v++){var _=!1;if(m&&(0===v&&(_="start"),v===y.length-2&&(_="end"),0===v&&v+1===y.length-1&&(_="both")),n=y[v],i=y[v+1],a=_,void 0,s=(o=g)[0],u=o[1],c=n[0],l=n[1],h=i[0],p=i[1],f=h-c,d=p-l,(o[0]-c)*d-(o[1]-l)*f==0&&(a?"start"===a?Math.abs(f)>=Math.abs(d)?0<f?c<s&&s<=h:h<=s&&s<c:0<d?l<u&&u<=p:p<=u&&u<l:"end"===a?Math.abs(f)>=Math.abs(d)?0<f?c<=s&&s<h:h<s&&s<=c:0<d?l<=u&&u<p:p<u&&u<=l:"both"===a?Math.abs(f)>=Math.abs(d)?0<f?c<s&&s<h:h<s&&s<c:0<d?l<u&&u<p:p<u&&u<l:void 0:Math.abs(f)>=Math.abs(d)?0<f?c<=s&&s<=h:h<=s&&s<=c:0<d?l<=u&&u<=p:p<=u&&u<=l))return!0}return!1}function dr(t,e){var r=K(t),n=K(e),i=Y(t),o=Y(e);switch(r){case"Point":switch(n){case"MultiPoint":return function(t,e){var r,n=!1;for(r=0;r<e.coordinates.length;r++)if(gr(e.coordinates[r],t.coordinates)){n=!0;break}return n}(i,o);case"LineString":return fr(i,o,{ignoreEndVertices:!0});case"Polygon":return Pt(i,o,{ignoreBoundary:!0});default:throw new Error("feature2 "+n+" geometry not supported")}case"MultiPoint":switch(n){case"MultiPoint":return function(t,e){for(var r=0;r<t.coordinates.length;r++){for(var n=!1,i=0;i<e.coordinates.length;i++)gr(t.coordinates[r],e.coordinates[i])&&(n=!0);if(!n)return!1}return!0}(i,o);case"LineString":return function(t,e){for(var r=!1,n=0;n<t.coordinates.length;n++){if(!fr(t.coordinates[n],e))return!1;r=r||fr(t.coordinates[n],e,{ignoreEndVertices:!0})}return r}(i,o);case"Polygon":return function(t,e){for(var r=!0,n=0;n<t.coordinates.length;n++){var i=Pt(t.coordinates[1],e);if(!i){r=!1;break}i=Pt(t.coordinates[1],e,{ignoreBoundary:!0})}return r&&i}(i,o);default:throw new Error("feature2 "+n+" geometry not supported")}case"LineString":switch(n){case"LineString":return function(t,e){for(var r=0;r<t.coordinates.length;r++)if(!fr(t.coordinates[r],e))return!1;return!0}(i,o);case"Polygon":return function(t,e){var r,n;if(!mr($(e),$(t)))return!1;for(var i=!1,o=0;o<t.coordinates.length-1;o++){if(!Pt(t.coordinates[o],e))return!1;if(!(i=i||Pt(t.coordinates[o],e,{ignoreBoundary:!0})))i=Pt((r=t.coordinates[o],n=t.coordinates[o+1],[(r[0]+n[0])/2,(r[1]+n[1])/2]),e,{ignoreBoundary:!0})}return i}(i,o);default:throw new Error("feature2 "+n+" geometry not supported")}case"Polygon":switch(n){case"Polygon":return function(t,e){var r=$(t);if(!mr($(e),r))return!1;for(var n=0;n<t.coordinates[0].length;n++)if(!Pt(t.coordinates[0][n],e))return!1;return!0}(i,o);default:throw new Error("feature2 "+n+" geometry not supported")}default:throw new Error("feature1 "+r+" geometry not supported")}}function mr(t,e){return!(t[0]>e[0]||t[2]<e[2]||t[1]>e[1]||t[3]<e[3])}function gr(t,e){return t[0]===e[0]&&t[1]===e[1]}function yr(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n=r.mask,i=r.properties,o=[];if(null==e)throw new Error("cellSide is required");if(!q(e))throw new Error("cellSide is invalid");if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be array");if(4!==t.length)throw new Error("bbox must contain 4 numbers");if(n&&-1===["Polygon","MultiPolygon"].indexOf(K(n)))throw new Error("options.mask must be a (Multi)Polygon");for(var a=t[0],s=t[1],u=t[2],c=t[3],l=e/kt([a,s],[u,s],r)*(u-a),h=e/kt([a,s],[a,c],r)*(c-s),p=u-a,f=c-s,d=Math.floor(p/l),m=(f-Math.floor(f/h)*h)/2,g=a+(p-d*l)/2;g<=u;){for(var y=s+m;y<=c;){var v=B([g,y],i);n?dr(v,n)&&o.push(v):o.push(v),y+=h}g+=l}return G(o)}function vr(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.precision,n=e.coordinates,i=e.mutate;if(r=null==r||isNaN(r)?6:r,n=null==n||isNaN(n)?3:n,!t)throw new Error("<geojson> is required");if("number"!=typeof r)throw new Error("<precision> must be a number");if("number"!=typeof n)throw new Error("<coordinates> must be a number");!1!==i&&void 0!==i||(t=JSON.parse(JSON.stringify(t)));var o=Math.pow(10,r);return w(t,function(t){!function(t,e,r){t.length>r&&t.splice(r,t.length);for(var n=0;n<t.length;n++)t[n]=Math.round(t[n]*e)/e}(t,o,n)}),t}function _r(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var r=0,n=t.length;r<n;r++)if(t[r]instanceof Array&&e[r]instanceof Array){if(!_r(t[r],e[r]))return!1}else if(t[r]!==e[r])return!1;return!0}function br(t,e){if(void 0===e&&(e=!0),3!=t.length)throw new Error("This function requires an array of three points [x,y]");return 0<=(t[1][0]-t[0][0])*(t[2][1]-t[0][1])-(t[1][1]-t[0][1])*(t[2][0]-t[0][0])==e}function xr(t,e){if(!t||!e)return!1;if(t.length!=e.length)return!1;for(var r=0,n=t.length;r<n;r++)if(t[r]instanceof Array&&e[r]instanceof Array){if(!xr(t[r],e[r]))return!1}else if(t[r]!=e[r])return!1;return!0}function wr(n,t){var i=[],o=Ve();return O(t,function(t){if(i.forEach(function(t,e){t.id=e}),i.length){var e=o.search(t);if(e.features.length){var r=Er(t,e);i=i.filter(function(t){return t.id!==r.id}),o.remove(r),E(Sr(r,t),function(t){i.push(t),o.insert(t)})}}else(i=Sr(n,t).features).forEach(function(t){t.bbox||(t.bbox=ie($(t)))}),o.load(G(i))}),G(i)}function Sr(t,o){var a=[],e=k(t)[0],r=k(t)[t.geometry.coordinates.length-1];if(Cr(e,W(o))||Cr(r,W(o)))return G([t]);var n=Ve(),i=He(t);n.load(i);var s=n.search(o);if(!s.features.length)return G([t]);var u=Er(o,s),c=C(i,function(t,e,r){var n=k(e)[1],i=W(o);return r===u.id?(t.push(i),a.push(V(t)),Cr(i,n)?[i]:[i,n]):(t.push(n),t)},[e]);return 1<c.length&&a.push(V(c)),G(a)}function Er(r,t){if(!t.features.length)throw new Error("lines must contain features");if(1===t.features.length)return t.features[0];var n,i=1/0;return E(t,function(t){var e=Xe(t,r).properties.dist;e<i&&(n=t,i=e)}),n}function Cr(t,e){return t[0]===e[0]&&t[1]===e[1]}function Mr(t,e,r,n,i){if(!H(i=i||{}))throw new Error("options is invalid");var o=i.steps,a=i.units;if(!t)throw new Error("center is required");if(!e)throw new Error("radius is required");if(null==r)throw new Error("bearing1 is required");if(null==n)throw new Error("bearing2 is required");if("object"!=typeof i)throw new Error("options must be an object");o=o||64;var s=Tr(r),u=Tr(n),c=t.properties;if(s===u)return V(ae(t,e,i).geometry.coordinates[0],c);for(var l=s,h=s<u?u:u+360,p=l,f=[],d=0;p<h;)f.push(oe(t,e,p,a).geometry.coordinates),p=l+360*++d/o;return h<p&&f.push(oe(t,e,h,a).geometry.coordinates),V(f,c)}function Tr(t){var e=t%360;return e<0&&(e+=360),e}function Pr(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.properties,n=K(t),i=k(t);if(r=r||t.properties||{},!i.length)throw new Error("polygon must contain coordinates");switch(n){case"Polygon":return Or(i,r);case"MultiPolygon":var o=[];return i.forEach(function(t){o.push(Or(t,r))}),G(o);default:throw new Error("geom "+n+" not supported")}}function Or(t,e){return 1<t.length?_(t,e):V(t[0],e)}function Ar(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.properties,n=e.autoComplete,i=e.orderCoords;if(!t)throw new Error("lines is required");switch(n=void 0===n||n,i=void 0===i||i,K(t)){case"FeatureCollection":case"GeometryCollection":var o=[];return(t.features?t.features:t.geometries).forEach(function(t){o.push(k(Ir(t,{},n,i)))}),b(o,r)}return Ir(t,r,n,i)}function Ir(t,e,s,u){e=e||t.properties||{};var r=k(t),n=K(t);if(!r.length)throw new Error("line must contain coordinates");switch(n){case"LineString":return s&&(r=Lr(r)),U([r],e);case"MultiLineString":var c=[],l=0;return r.forEach(function(t){if(s&&(t=Lr(t)),u){var e=(r=$(V(t)),n=r[0],i=r[1],o=r[2],a=r[3],Math.abs(n-o)*Math.abs(i-a));l<e?(c.unshift(t),l=e):c.push(t)}else c.push(t);var r,n,i,o,a}),U(c,e);default:throw new Error("geometry type "+n+" is not supported")}}function Lr(t){var e=t[0],r=e[0],n=e[1],i=t[t.length-1],o=i[0],a=i[1];return r===o&&n===a||t.push(e),t}function Rr(t,e,r){var n,i,o,a,s,u=t.length,c=kr(t[0],e),l=[];for(r=r||[],n=1;n<u;n++){for(i=t[n-1],a=s=kr(o=t[n],e);;){if(!(c|a)){l.push(i),a!==s?(l.push(o),n<u-1&&(r.push(l),l=[])):n===u-1&&l.push(o);break}if(c&a)break;c?c=kr(i=Nr(i,o,c,e),e):a=kr(o=Nr(i,o,a,e),e)}c=s}return l.length&&r.push(l),r}function Nr(t,e,r,n){return 8&r?[t[0]+(e[0]-t[0])*(n[3]-t[1])/(e[1]-t[1]),n[3]]:4&r?[t[0]+(e[0]-t[0])*(n[1]-t[1])/(e[1]-t[1]),n[1]]:2&r?[n[2],t[1]+(e[1]-t[1])*(n[2]-t[0])/(e[0]-t[0])]:1&r?[n[0],t[1]+(e[1]-t[1])*(n[0]-t[0])/(e[0]-t[0])]:null}function kr(t,e){var r=0;return t[0]<e[0]?r|=1:t[0]>e[2]&&(r|=2),t[1]<e[1]?r|=4:t[1]>e[3]&&(r|=8),r}function Dr(t,e){for(var r=[],n=0;n<t.length;n++){var i=ca.polygon(t[n],e);0<i.length&&(i[0][0]===i[i.length-1][0]&&i[0][1]===i[i.length-1][1]||i.push(i[0]),4<=i.length&&r.push(i))}return r}function jr(t){return"[object Arguments]"===Object.prototype.toString.call(t)}function zr(t,e,r){return r=r||{},t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():!t||!e||"object"!=typeof t&&"object"!=typeof e?(r.strict,t===e):function(t,e,r){var n,i;if(Fr(t)||Fr(e))return!1;if(t.prototype!==e.prototype)return!1;if(jr(t))return!!jr(e)&&zr(t=la.call(t),e=la.call(e),r);if(Br(t)){if(!Br(e))return!1;if(t.length!==e.length)return!1;for(n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}try{var o=Object.keys(t),a=Object.keys(e)}catch(t){return!1}if(o.length!==a.length)return!1;for(o.sort(),a.sort(),n=o.length-1;0<=n;n--)if(o[n]!==a[n])return!1;for(n=o.length-1;0<=n;n--)if(!zr(t[i=o[n]],e[i],r))return!1;return typeof t==typeof e}(t,e,r))}function Fr(t){return null==t}function Br(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length||"function"!=typeof t.copy||"function"!=typeof t.slice||0<t.length&&"number"!=typeof t[0])}function Ur(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var o,a=r.tolerance||0,s=[],u=Ve();return u.load(He(t)),I(e,function(n){var i=!1;E(u.search(n),function(t){if(!1===i){var e=k(n).sort(),r=k(t).sort();zr(e,r)?(i=!0,o=o?Vr(o,n):n):(0===a?fr(e[0],t)&&fr(e[1],t):Xe(t,e[0]).properties.dist<=a&&Xe(t,e[1]).properties.dist<=a)?(i=!0,o=o?Vr(o,n):n):(0===a?fr(r[0],n)&&fr(r[1],n):Xe(n,r[0]).properties.dist<=a&&Xe(n,r[1]).properties.dist<=a)&&(o=o?Vr(o,t):t)}}),!1===i&&o&&(s.push(o),o=void 0)}),o&&s.push(o),G(s)}function Vr(t,e){var r=k(e),n=k(t),i=n[0],o=n[n.length-1],a=t.geometry.coordinates;return zr(r[0],i)?a.unshift(r[1]):zr(r[0],o)?a.push(r[1]):zr(r[1],i)?a.unshift(r[0]):zr(r[1],o)&&a.push(r[0]),t}function Gr(t){var e=t%360;return e<0&&(e+=360),e}function qr(t,e,r,n){if(!H(n=n||{}))throw new Error("options is invalid");var i=n.units,o=n.properties;if(!t)throw new Error("origin is required");if(null==e)throw new Error("distance is required");if(null==r)throw new Error("bearing is required");if(!(0<=e))throw new Error("distance must be greater than 0");var p=c(e,i,"meters"),a=W(t),s=function(t,e,r,n){var i=p/(n=void 0===n?fo:Number(n)),o=t[0]*Math.PI/180,a=v(t[1]),s=v(r),u=i*Math.cos(s),c=a+u;Math.abs(c)>Math.PI/2&&(c=0<c?Math.PI-c:-Math.PI-c);var l=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)),h=1e-11<Math.abs(l)?u/l:Math.cos(a);return[(180*(o+i*Math.sin(s)/h)/Math.PI+540)%360-180,180*c/Math.PI]}(a,0,r);return s[0]+=180<s[0]-a[0]?-360:180<a[0]-s[0]?360:0,B(s,o)}function Hr(t,e,r,n,i,o){for(var a=0;a<t.length;a++){var s=t[a],u=t[a+1];a===t.length-1&&(u=t[0]),n=$r(s,u,e),r<=0&&0<n?$r(e,s,i)<0||(i=s):0<r&&n<=0&&(0<$r(e,s,o)||(o=s)),r=n}return[i,o]}function $r(t,e,r){return(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])}function Wr(t){if(!t)throw new Error("line is required");var e=t.geometry?t.geometry.type:t.type;if(!Array.isArray(t)&&"LineString"!==e)throw new Error("geometry must be a LineString");for(var r,n,i=k(t),o=0,a=1;a<i.length;)r=n||i[0],o+=((n=i[a])[0]-r[0])*(n[1]+r[1]),a++;return 0<o}function Xr(t,e){switch("Feature"===t.type?t.geometry.type:t.type){case"GeometryCollection":return T(t,function(t){Xr(t,e)}),t;case"LineString":return Yr(k(t),e),t;case"Polygon":return Zr(k(t),e),t;case"MultiLineString":return k(t).forEach(function(t){Yr(t,e)}),t;case"MultiPolygon":return k(t).forEach(function(t){Zr(t,e)}),t;case"Point":case"MultiPoint":return t}}function Yr(t,e){Wr(t)===e&&t.reverse()}function Zr(t,e){Wr(t[0])!==e&&t[0].reverse();for(var r=1;r<t.length;r++)Wr(t[r])===e&&t[r].reverse()}function Kr(t,e,r,n){n=n||{};for(var i=Object.keys(ha),o=0;o<i.length;o++){var a=i[o],s=n[a];s=null!=s?s:ha[a],pa[a]=s}pa.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+e+":"+(e+r)+"]");var u,c,l,h=function(t,e,r){for(var n=t.length-1,i=t[0].length-1,o={rows:n,cols:i,cells:[]},a=e+Math.abs(r),s=0;s<n;++s){o.cells[s]=[];for(var u=0;u<i;++u){var c=0,l=t[s+1][u],h=t[s+1][u+1],p=t[s][u+1],f=t[s][u];if(!(isNaN(l)||isNaN(h)||isNaN(p)||isNaN(f))){c|=l<e?0:a<l?128:64,c|=h<e?0:a<h?32:16,c|=p<e?0:a<p?8:4;var d=+(c|=f<e?0:a<f?2:1),m=0;if(17===c||18===c||33===c||34===c||38===c||68===c||72===c||98===c||102===c||132===c||136===c||137===c||152===c||153===c){var g=(l+h+p+f)/4;m=a<g?2:g<e?0:1,34===c?1===m?c=35:0===m&&(c=136):136===c?1===m?(c=35,m=4):0===m&&(c=34):17===c?1===m?(c=155,m=4):0===m&&(c=153):68===c?1===m?(c=103,m=4):0===m&&(c=102):153===c?1===m&&(c=155):102===c?1===m&&(c=103):152===c?m<2&&(c=156,m=1):137===c?m<2&&(c=139,m=1):98===c?m<2&&(c=99,m=1):38===c?m<2&&(c=39,m=1):18===c?0<m?(c=156,m=4):c=152:33===c?0<m?(c=139,m=4):c=137:72===c?0<m?(c=99,m=4):c=98:132===c&&(0<m?(c=39,m=4):c=38)}if(0!=c&&170!=c){var y,v,_,b,x,w,S,E;y=v=_=b=x=w=S=E=.5;var C=[];1===c?(_=1-Jr(e,p,f),E=1-Jr(e,l,f),C.push(Ja[c])):169===c?(_=Jr(a,f,p),E=Jr(a,f,l),C.push(Ja[c])):4===c?(w=1-Jr(e,h,p),b=Jr(e,f,p),C.push(Za[c])):166===c?(w=Jr(a,p,h),b=1-Jr(a,p,f),C.push(Za[c])):16===c?(x=Jr(e,p,h),v=Jr(e,l,h),C.push(Ya[c])):154===c?(x=1-Jr(a,h,p),v=1-Jr(a,h,l),C.push(Ya[c])):64===c?(S=Jr(e,f,l),y=1-Jr(e,h,l),C.push(ts[c])):106===c?(S=1-Jr(a,l,f),y=Jr(a,l,h),C.push(ts[c])):168===c?(b=Jr(a,f,p),_=Jr(e,f,p),E=Jr(e,f,l),S=Jr(a,f,l),C.push(Ka[c]),C.push(Ja[c])):2===c?(b=1-Jr(e,p,f),_=1-Jr(a,p,f),E=1-Jr(a,l,f),S=1-Jr(e,l,f),C.push(Ka[c]),C.push(Ja[c])):162===c?(x=Jr(a,p,h),w=Jr(e,p,h),b=1-Jr(e,p,f),_=1-Jr(a,p,f),C.push(Ka[c]),C.push(Ja[c])):8===c?(x=1-Jr(e,h,p),w=1-Jr(a,h,p),b=Jr(a,f,p),_=Jr(e,f,p),C.push(Ya[c]),C.push(Za[c])):138===c?(x=1-Jr(e,h,p),w=1-Jr(a,h,p),y=1-Jr(a,h,l),v=1-Jr(e,h,l),C.push(Ya[c]),C.push(Za[c])):32===c?(x=Jr(a,p,h),w=Jr(e,p,h),y=Jr(e,l,h),v=Jr(a,l,h),C.push(Ya[c]),C.push(Za[c])):42===c?(E=1-Jr(a,l,f),S=1-Jr(e,l,f),y=Jr(e,l,h),v=Jr(a,l,h),C.push(Qa[c]),C.push(ts[c])):128===c&&(E=Jr(e,f,l),S=Jr(a,f,l),y=1-Jr(a,h,l),v=1-Jr(e,h,l),C.push(Qa[c]),C.push(ts[c])),5===c?(w=1-Jr(e,h,p),E=1-Jr(e,l,f),C.push(Za[c])):165===c?(w=Jr(a,p,h),E=Jr(a,f,l),C.push(Za[c])):20===c?(b=Jr(e,f,p),v=Jr(e,l,h),C.push(Ka[c])):150===c?(b=1-Jr(a,p,f),v=1-Jr(a,h,l),C.push(Ka[c])):80===c?(x=Jr(e,p,h),S=Jr(e,f,l),C.push(Ya[c])):90===c?(x=1-Jr(a,h,p),S=1-Jr(a,l,f),C.push(Ya[c])):65===c?(_=1-Jr(e,p,f),y=1-Jr(e,h,l),C.push(Ja[c])):105===c?(_=Jr(a,f,p),y=Jr(a,l,h),C.push(Ja[c])):160===c?(x=Jr(a,p,h),w=Jr(e,p,h),E=Jr(e,f,l),S=Jr(a,f,l),C.push(Ya[c]),C.push(Za[c])):10===c?(x=1-Jr(e,h,p),w=1-Jr(a,h,p),E=1-Jr(a,l,f),S=1-Jr(e,l,f),C.push(Ya[c]),C.push(Za[c])):130===c?(b=1-Jr(e,p,f),_=1-Jr(a,p,f),y=1-Jr(a,h,l),v=1-Jr(e,h,l),C.push(Ka[c]),C.push(Ja[c])):40===c?(b=Jr(a,f,p),_=Jr(e,f,p),y=Jr(e,l,h),v=Jr(a,l,h),C.push(Ka[c]),C.push(Ja[c])):101===c?(w=Jr(a,p,h),y=Jr(a,l,h),C.push(Za[c])):69===c?(w=1-Jr(e,h,p),y=1-Jr(e,h,l),C.push(Za[c])):149===c?(E=Jr(a,f,l),v=1-Jr(a,h,l),C.push(Qa[c])):21===c?(E=1-Jr(e,l,f),v=Jr(e,l,h),C.push(Qa[c])):86===c?(b=1-Jr(a,p,f),S=1-Jr(a,l,f),C.push(Ka[c])):84===c?(b=Jr(e,f,p),S=Jr(e,f,l),C.push(Ka[c])):89===c?(x=1-Jr(a,h,p),_=Jr(a,f,p),C.push(Ja[c])):81===c?(x=Jr(e,p,h),_=1-Jr(e,p,f),C.push(Ja[c])):96===c?(x=Jr(a,p,h),w=Jr(e,p,h),S=Jr(e,f,l),y=Jr(a,l,h),C.push(Ya[c]),C.push(Za[c])):74===c?(x=1-Jr(e,h,p),w=1-Jr(a,h,p),S=1-Jr(a,l,f),y=1-Jr(e,h,l),C.push(Ya[c]),C.push(Za[c])):24===c?(x=1-Jr(a,h,p),b=Jr(a,f,p),_=Jr(e,f,p),v=Jr(e,l,h),C.push(Ya[c]),C.push(Ja[c])):146===c?(x=Jr(e,p,h),b=1-Jr(e,p,f),_=1-Jr(a,p,f),v=1-Jr(a,h,l),C.push(Ya[c]),C.push(Ja[c])):6===c?(w=1-Jr(e,h,p),b=1-Jr(a,p,f),E=1-Jr(a,l,f),S=1-Jr(e,l,f),C.push(Za[c]),C.push(Ka[c])):164===c?(w=Jr(a,p,h),b=Jr(e,f,p),E=Jr(e,f,l),S=Jr(a,f,l),C.push(Za[c]),C.push(Ka[c])):129===c?(_=1-Jr(e,p,f),E=Jr(a,f,l),y=1-Jr(a,h,l),v=1-Jr(e,h,l),C.push(Ja[c]),C.push(Qa[c])):41===c?(_=Jr(a,f,p),E=1-Jr(e,l,f),y=Jr(e,l,h),v=Jr(a,l,h),C.push(Ja[c]),C.push(Qa[c])):66===c?(b=1-Jr(e,p,f),_=1-Jr(a,p,f),S=1-Jr(a,l,f),y=1-Jr(e,h,l),C.push(Ka[c]),C.push(Ja[c])):104===c?(b=Jr(a,f,p),_=Jr(e,f,p),S=Jr(e,f,l),y=Jr(a,l,h),C.push(Ja[c]),C.push(es[c])):144===c?(x=Jr(e,p,h),E=Jr(e,f,l),S=Jr(a,f,l),v=1-Jr(a,h,l),C.push(Ya[c]),C.push(ts[c])):26===c?(x=1-Jr(a,h,p),E=1-Jr(a,l,f),S=1-Jr(e,l,f),v=Jr(e,l,h),C.push(Ya[c]),C.push(ts[c])):36===c?(w=Jr(a,p,h),b=Jr(e,f,p),y=Jr(e,l,h),v=Jr(a,l,h),C.push(Za[c]),C.push(Ka[c])):134===c?(w=1-Jr(e,h,p),b=1-Jr(a,p,f),y=1-Jr(a,h,l),v=1-Jr(e,h,l),C.push(Za[c]),C.push(Ka[c])):9===c?(x=1-Jr(e,h,p),w=1-Jr(a,h,p),_=Jr(a,f,p),E=1-Jr(e,l,f),C.push(Ya[c]),C.push(Za[c])):161===c?(x=Jr(a,p,h),w=Jr(e,p,h),_=1-Jr(e,p,f),E=Jr(a,f,l),C.push(Ya[c]),C.push(Za[c])):37===c?(w=Jr(a,p,h),E=1-Jr(e,l,f),y=Jr(e,l,h),v=Jr(a,l,h),C.push(Za[c]),C.push(Qa[c])):133===c?(w=1-Jr(e,h,p),E=Jr(a,f,l),y=1-Jr(a,h,l),v=1-Jr(e,h,l),C.push(Za[c]),C.push(Qa[c])):148===c?(b=Jr(e,f,p),E=Jr(e,f,l),S=Jr(a,f,l),v=1-Jr(a,h,l),C.push(Ka[c]),C.push(ts[c])):22===c?(b=1-Jr(a,p,f),E=1-Jr(a,l,f),S=1-Jr(e,l,f),v=Jr(e,l,h),C.push(Ka[c]),C.push(ts[c])):82===c?(x=Jr(e,p,h),b=1-Jr(e,p,f),_=1-Jr(a,p,f),S=1-Jr(a,l,f),C.push(Ya[c]),C.push(Ja[c])):88===c?(x=1-Jr(a,h,p),b=Jr(a,f,p),_=Jr(e,f,p),S=Jr(e,f,l),C.push(Ya[c]),C.push(Ja[c])):73===c?(x=1-Jr(e,h,p),w=1-Jr(a,h,p),_=Jr(a,f,p),y=1-Jr(e,h,l),C.push(Ya[c]),C.push(Za[c])):97===c?(x=Jr(a,p,h),w=Jr(e,p,h),_=1-Jr(e,p,f),y=Jr(a,l,h),C.push(Ya[c]),C.push(Za[c])):145===c?(x=Jr(e,p,h),_=1-Jr(e,p,f),E=Jr(a,f,l),v=1-Jr(a,h,l),C.push(Ya[c]),C.push(Qa[c])):25===c?(x=1-Jr(a,h,p),_=Jr(a,f,p),E=1-Jr(e,l,f),v=Jr(e,l,h),C.push(Ya[c]),C.push(Qa[c])):70===c?(w=1-Jr(e,h,p),b=1-Jr(a,p,f),S=1-Jr(a,l,f),y=1-Jr(e,h,l),C.push(Za[c]),C.push(Ka[c])):100===c?(w=Jr(a,p,h),b=Jr(e,f,p),S=Jr(e,f,l),y=Jr(a,l,h),C.push(Za[c]),C.push(Ka[c])):34===c?(v=0===m?(x=1-Jr(e,h,p),w=1-Jr(a,h,p),b=Jr(a,f,p),_=Jr(e,f,p),E=Jr(e,f,l),S=Jr(a,f,l),y=1-Jr(a,h,l),1-Jr(e,h,l)):(x=Jr(a,p,h),w=Jr(e,p,h),b=1-Jr(e,p,f),_=1-Jr(a,p,f),E=1-Jr(a,l,f),S=1-Jr(e,l,f),y=Jr(e,l,h),Jr(a,l,h)),C.push(Ya[c]),C.push(Za[c]),C.push(Qa[c]),C.push(ts[c])):35===c?(v=4===m?(x=1-Jr(e,h,p),w=1-Jr(a,h,p),b=Jr(a,f,p),_=Jr(e,f,p),E=Jr(e,f,l),S=Jr(a,f,l),y=1-Jr(a,h,l),1-Jr(e,h,l)):(x=Jr(a,p,h),w=Jr(e,p,h),b=1-Jr(e,p,f),_=1-Jr(a,p,f),E=1-Jr(a,l,f),S=1-Jr(e,l,f),y=Jr(e,l,h),Jr(a,l,h)),C.push(Ya[c]),C.push(Za[c]),C.push(Ja[c]),C.push(ts[c])):136===c?(v=0===m?(x=Jr(a,p,h),w=Jr(e,p,h),b=1-Jr(e,p,f),_=1-Jr(a,p,f),E=1-Jr(a,l,f),S=1-Jr(e,l,f),y=Jr(e,l,h),Jr(a,l,h)):(x=1-Jr(e,h,p),w=1-Jr(a,h,p),b=Jr(a,f,p),_=Jr(e,f,p),E=Jr(e,f,l),S=Jr(a,f,l),y=1-Jr(a,h,l),1-Jr(e,h,l)),C.push(Ya[c]),C.push(Za[c]),C.push(Qa[c]),C.push(ts[c])):153===c?(v=0===m?(x=Jr(e,p,h),_=1-Jr(e,p,f),E=1-Jr(e,l,f),Jr(e,l,h)):(x=1-Jr(a,h,p),_=Jr(a,f,p),E=Jr(a,f,l),1-Jr(a,h,l)),C.push(Ya[c]),C.push(Ja[c])):102===c?(y=0===m?(w=1-Jr(e,h,p),b=Jr(e,f,p),S=Jr(e,f,l),1-Jr(e,h,l)):(w=Jr(a,p,h),b=1-Jr(a,p,f),S=1-Jr(a,l,f),Jr(a,l,h)),C.push(Za[c]),C.push(ts[c])):155===c?(v=4===m?(x=Jr(e,p,h),_=1-Jr(e,p,f),E=1-Jr(e,l,f),Jr(e,l,h)):(x=1-Jr(a,h,p),_=Jr(a,f,p),E=Jr(a,f,l),1-Jr(a,h,l)),C.push(Ya[c]),C.push(Qa[c])):103===c?(y=4===m?(w=1-Jr(e,h,p),b=Jr(e,f,p),S=Jr(e,f,l),1-Jr(e,h,l)):(w=Jr(a,p,h),b=1-Jr(a,p,f),S=1-Jr(a,l,f),Jr(a,l,h)),C.push(Za[c]),C.push(Ka[c])):152===c?(v=0===m?(x=Jr(e,p,h),b=1-Jr(e,p,f),_=1-Jr(a,p,f),E=1-Jr(a,l,f),S=1-Jr(e,l,f),Jr(e,l,h)):(x=1-Jr(a,h,p),b=Jr(a,f,p),_=Jr(e,f,p),E=Jr(e,f,l),S=Jr(a,f,l),1-Jr(a,h,l)),C.push(Ya[c]),C.push(Ka[c]),C.push(Ja[c])):156===c?(v=4===m?(x=Jr(e,p,h),b=1-Jr(e,p,f),_=1-Jr(a,p,f),E=1-Jr(a,l,f),S=1-Jr(e,l,f),Jr(e,l,h)):(x=1-Jr(a,h,p),b=Jr(a,f,p),_=Jr(e,f,p),E=Jr(e,f,l),S=Jr(a,f,l),1-Jr(a,h,l)),C.push(Ya[c]),C.push(Ja[c]),C.push(ts[c])):137===c?(v=0===m?(x=Jr(a,p,h),w=Jr(e,p,h),_=1-Jr(e,p,f),E=1-Jr(e,l,f),y=Jr(e,l,h),Jr(a,l,h)):(x=1-Jr(e,h,p),w=1-Jr(a,h,p),_=Jr(a,f,p),E=Jr(a,f,l),y=1-Jr(a,h,l),1-Jr(e,h,l)),C.push(Ya[c]),C.push(Za[c]),C.push(Ja[c])):139===c?(v=4===m?(x=Jr(a,p,h),w=Jr(e,p,h),_=1-Jr(e,p,f),E=1-Jr(e,l,f),y=Jr(e,l,h),Jr(a,l,h)):(x=1-Jr(e,h,p),w=1-Jr(a,h,p),_=Jr(a,f,p),E=Jr(a,f,l),y=1-Jr(a,h,l),1-Jr(e,h,l)),C.push(Ya[c]),C.push(Za[c]),C.push(Qa[c])):98===c?(y=0===m?(x=1-Jr(e,h,p),w=1-Jr(a,h,p),b=Jr(a,f,p),_=Jr(e,f,p),S=Jr(e,f,l),1-Jr(e,h,l)):(x=Jr(a,p,h),w=Jr(e,p,h),b=1-Jr(e,p,f),_=1-Jr(a,p,f),S=1-Jr(a,l,f),Jr(a,l,h)),C.push(Ya[c]),C.push(Za[c]),C.push(ts[c])):99===c?(y=4===m?(x=1-Jr(e,h,p),w=1-Jr(a,h,p),b=Jr(a,f,p),_=Jr(e,f,p),S=Jr(e,f,l),1-Jr(e,h,l)):(x=Jr(a,p,h),w=Jr(e,p,h),b=1-Jr(e,p,f),_=1-Jr(a,p,f),S=1-Jr(a,l,f),Jr(a,l,h)),C.push(Ya[c]),C.push(Za[c]),C.push(Ja[c])):38===c?(v=0===m?(w=1-Jr(e,h,p),b=Jr(e,f,p),E=Jr(e,f,l),S=Jr(a,f,l),y=1-Jr(a,h,l),1-Jr(e,h,l)):(w=Jr(a,p,h),b=1-Jr(a,p,f),E=1-Jr(a,l,f),S=1-Jr(e,l,f),y=Jr(e,l,h),Jr(a,l,h)),C.push(Za[c]),C.push(Qa[c]),C.push(ts[c])):39===c?(v=4===m?(w=1-Jr(e,h,p),b=Jr(e,f,p),E=Jr(e,f,l),S=Jr(a,f,l),y=1-Jr(a,h,l),1-Jr(e,h,l)):(w=Jr(a,p,h),b=1-Jr(a,p,f),E=1-Jr(a,l,f),S=1-Jr(e,l,f),y=Jr(e,l,h),Jr(a,l,h)),C.push(Za[c]),C.push(Ka[c]),C.push(ts[c])):85===c&&(y=E=_=w=0,v=S=b=x=1),(y<0||1<y||v<0||1<v||x<0||1<x||b<0||1<b||E<0||1<E||S<0||1<S)&&console.log("MarchingSquaresJS-isoBands: "+c+" "+d+" "+l+","+h+","+p+","+f+" "+m+" "+y+" "+v+" "+x+" "+w+" "+b+" "+_+" "+E+" "+S),o.cells[s][u]={cval:c,cval_real:d,flipped:m,topleft:y,topright:v,righttop:x,rightbottom:w,bottomright:b,bottomleft:_,leftbottom:E,lefttop:S,edges:C}}}}}return o}(t,e,r);return u=pa.polygons?(pa.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),c=[],l=0,h.cells.forEach(function(t,n){t.forEach(function(t,e){if(void 0!==t){var r=ns[t.cval](t);"object"==typeof r&&Qr(r)?"object"==typeof r[0]&&Qr(r[0])?"object"==typeof r[0][0]&&Qr(r[0][0])?r.forEach(function(t){t.forEach(function(t){t[0]+=e,t[1]+=n}),c[l++]=t}):(r.forEach(function(t){t[0]+=e,t[1]+=n}),c[l++]=r):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates")}})}),c):(pa.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),function(t){for(var e=[],r=t.rows,n=t.cols,i=[],o=0;o<r;o++)for(var a=0;a<n;a++)if(void 0!==t.cells[o][a]&&0<t.cells[o][a].edges.length){var s=function(t){if(0<t.edges.length){var e=t.edges[t.edges.length-1],r=t.cval_real;switch(e){case 0:return r&da?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 1:return r&ma?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 2:return r&ma?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 3:return r&ga?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 4:return r&da?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 5:return r&ma?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 6:return r&ma?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 7:return r&ga?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 8:return r&ma?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.righttop],x:-1,y:0,o:1};case 9:return r&ga?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 10:return r&ga?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.righttop],x:-1,y:0,o:1};case 11:return r&fa?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 12:return r&ma?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 13:return r&ga?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 14:return r&ga?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 15:return r&fa?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 16:return r&ma?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 17:return r&fa?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 18:return r&ga?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 19:return r&fa?{p:[t.bottomleft,0],x:0,y:1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 20:return r&fa?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 21:return r&da?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.topright,1],x:0,y:-1,o:1};case 22:return r&fa?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 23:return r&da?{p:[0,t.lefttop],x:1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t)}}return null}(t.cells[o][a]),u=null,c=a,l=o;null!==s&&i.push([s.p[0]+c,s.p[1]+l]);do{if(null===(u=function(t,e,r,n){var i,o,a,s,u,c=t.cval;switch(e){case-1:switch(n){case 0:i=Za[c],a=Ma[c],s=Ta[c],u=Pa[c];break;default:i=Ya[c],a=Sa[c],s=Ea[c],u=Ca[c]}break;case 1:switch(n){case 0:i=Qa[c],a=za[c],s=Fa[c],u=Ba[c];break;default:i=ts[c],a=ka[c],s=Da[c],u=ja[c]}break;default:switch(r){case-1:switch(n){case 0:i=es[c],a=ya[c],s=va[c],u=_a[c];break;default:i=rs[c],a=ba[c],s=xa[c],u=wa[c]}break;case 1:switch(n){case 0:i=Ja[c],a=Oa[c],s=Aa[c],u=Ia[c];break;default:i=Ka[c],a=La[c],s=Ra[c],u=Na[c]}}}if(o=t.edges.indexOf(i),void 0===t.edges[o])return null;switch(function(t,e){delete t.edges[e];for(var r=e+1;r<t.edges.length;r++)t.edges[r-1]=t.edges[r];t.edges.pop()}(t,o),c=t.cval_real,i){case 0:r=c&da?(e=t.topleft,1):(e=1,t.righttop);break;case 1:r=c&ma?(e=1,t.rightbottom):(e=t.topleft,1);break;case 2:r=c&ma?(e=t.topleft,1):(e=t.bottomright,0);break;case 3:r=c&ga?(e=t.bottomleft,0):(e=t.topleft,1);break;case 4:r=c&da?(e=t.topright,1):(e=1,t.righttop);break;case 5:r=c&ma?(e=1,t.rightbottom):(e=t.topright,1);break;case 6:r=c&ma?(e=t.topright,1):(e=t.bottomright,0);break;case 7:r=c&ga?(e=t.bottomleft,0):(e=t.topright,1);break;case 8:r=c&ma?(e=1,t.righttop):(e=t.bottomright,0);break;case 9:r=c&ga?(e=t.bottomleft,0):(e=1,t.righttop);break;case 10:r=c&ga?(e=1,t.righttop):(e=0,t.leftbottom);break;case 11:r=c&fa?(e=0,t.lefttop):(e=1,t.righttop);break;case 12:r=c&ma?(e=1,t.rightbottom):(e=t.bottomright,0);break;case 13:r=c&ga?(e=t.bottomleft,0):(e=1,t.rightbottom);break;case 14:r=c&ga?(e=1,t.rightbottom):(e=0,t.leftbottom);break;case 15:r=c&fa?(e=0,t.lefttop):(e=1,t.rightbottom);break;case 16:r=c&ma?(e=0,t.leftbottom):(e=t.bottomright,0);break;case 17:r=c&fa?(e=0,t.lefttop):(e=t.bottomright,0);break;case 18:r=c&ga?(e=t.bottomleft,0):(e=0,t.leftbottom);break;case 19:r=c&fa?(e=0,t.lefttop):(e=t.bottomleft,0);break;case 20:r=c&fa?(e=0,t.leftbottom):(e=t.topleft,1);break;case 21:r=c&da?(e=t.topright,1):(e=0,t.leftbottom);break;case 22:r=c&fa?(e=0,t.lefttop):(e=t.topleft,1);break;case 23:r=c&da?(e=t.topright,1):(e=0,t.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t),null}return void 0!==e&&void 0!==r&&void 0!==a&&void 0!==s&&void 0!==u||(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(t),console.log(e+" "+r+" "+a+" "+s+" "+u)),{p:[e,r],x:a,y:s,o:u}}(t.cells[l][c],s.x,s.y,s.o)))break;if(i.push([u.p[0]+c,u.p[1]+l]),c+=u.x,(l+=(s=u).y)<0||r<=l||c<0||n<=c||void 0===t.cells[l][c]){var h=function(t,e,r,n,i,o){for(var a=t.cells[r][e],s=a.cval_real,u=e+n,c=r+i,l=[],h=!1;!h;){if(void 0===t.cells[c]||void 0===t.cells[c][u])if(c-=i,u-=n,s=(a=t.cells[c][u]).cval_real,-1===i)if(0===o)if(s&ga)l.push([u,c]),n=-1,o=i=0;else{if(!(s&ma)){l.push([u+a.bottomright,c]),o=i=1,h=!(n=0);break}l.push([u+1,c]),n=1,o=i=0}else{if(!(s&ga)){if(s&ma){l.push([u+a.bottomright,c]),o=i=1,h=!(n=0);break}l.push([u+a.bottomleft,c]),i=1,h=!(o=n=0);break}l.push([u,c]),n=-1,o=i=0}else if(1===i)if(0===o){if(!(s&da)){if(s&fa){l.push([u+a.topleft,c+1]),i=-1,h=!(o=n=0);break}l.push([u+a.topright,c+1]),i=-1,o=1,h=!(n=0);break}l.push([u+1,c+1]),i=0,o=n=1}else l.push([u+1,c+1]),i=0,o=n=1;else if(-1===n)if(0===o){if(!(s&fa)){if(s&ga){l.push([u,c+a.leftbottom]),n=1,h=!(o=i=0);break}l.push([u,c+a.lefttop]),o=n=1,h=!(i=0);break}l.push([u,c+1]),i=1,o=n=0}else{if(!(s&fa)){console.log("MarchingSquaresJS-isoBands: wtf");break}l.push([u,c+1]),i=1,o=n=0}else{if(1!==n){console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}if(0===o){if(!(s&ma)){l.push([u+1,c+a.rightbottom]),n=-1,h=!(o=i=0);break}l.push([u+1,c]),n=0,i=-1,o=1}else{if(!(s&ma)){if(s&da){l.push([u+1,c+a.righttop]),n=-1,i=0,o=1;break}l.push([u+1,c+a.rightbottom]),n=-1,h=!(o=i=0);break}l.push([u+1,c]),n=0,i=-1,o=1}}else if(s=(a=t.cells[c][u]).cval_real,-1===n)if(0===o)if(void 0!==t.cells[c-1]&&void 0!==t.cells[c-1][u])n=0,i=-1,o=1;else{if(!(s&ga)){l.push([u+a.bottomright,c]),o=i=1,h=!(n=0);break}l.push([u,c])}else{if(!(s&fa)){console.log("MarchingSquaresJS-isoBands: found entry from top at "+u+","+c);break}console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!")}else if(1===n){if(0===o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[c+1]&&void 0!==t.cells[c+1][u])i=1,o=n=0;else{if(!(s&da)){l.push([u+a.topleft,c+1]),i=-1,h=!(o=n=0);break}l.push([u+1,c+1]),i=0,o=n=1}}else if(-1===i){if(1!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[c][u+1])i=0,o=n=1;else{if(!(s&ma)){l.push([u+1,c+a.righttop]),n=-1,o=1,h=!(i=0);break}l.push([u+1,c]),n=0,i=-1,o=1}}else{if(1!==i){console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(0!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[c][u-1])n=-1,o=i=0;else{if(!(s&fa)){l.push([u,c+a.leftbottom]),n=1,h=!(o=i=0);break}l.push([u,c+1]),i=1,o=n=0}}if(c+=i,(u+=n)===e&&c===r)break}return{path:l,i:u,j:c,x:n,y:i,o:o}}(t,c-=u.x,l-=u.y,u.x,u.y,u.o);if(null===h)break;h.path.forEach(function(t){i.push(t)}),c=h.i,l=h.j,s=h}}while(void 0!==t.cells[l][c]&&0<t.cells[l][c].edges.length);e.push(i),i=[],0<t.cells[o][a].edges.length&&a--}return e}(h)),"function"==typeof pa.successCallback&&pa.successCallback(u),u}function Jr(t,e,r){return(t-e)/(r-e)}function Qr(t){return-1<t.constructor.toString().indexOf("Array")}function tn(t,i,e){if(!H(e=e||{}))throw new Error("options is invalid");var o=e.pivot,r=e.mutate;if(!t)throw new Error("geojson is required");if(null==i||isNaN(i))throw new Error("angle is required");return 0===i||(o=o||ce(t),!1!==r&&void 0!==r||(t=Dt(t)),w(t,function(t){var e=Ye(o,t)+i,r=Ke(o,t),n=k(qr(o,r,e));t[0]=n[0],t[1]=n[1]})),t}function en(r,n,t){if(!H(t=t||{}))throw new Error("options is invalid");var i=t.origin,e=t.mutate;if(!r)throw new Error("geojson required");if("number"!=typeof n||0===n)throw new Error("invalid factor");var o=Array.isArray(i)||"object"==typeof i;return!0!==e&&(r=Dt(r)),"FeatureCollection"!==r.type||o?rn(r,n,i):(E(r,function(t,e){r.features[e]=rn(t,n,i)}),r)}function rn(t,i,o){var e="Point"===K(t);return o=function(t,e){if(null!=e||(e="centroid"),Array.isArray(e)||"object"==typeof e)return W(e);var r=t.bbox?t.bbox:$(t),n=r[0],i=r[1],o=r[2],a=r[3];switch(e){case"sw":case"southwest":case"westsouth":case"bottomleft":return B([n,i]);case"se":case"southeast":case"eastsouth":case"bottomright":return B([o,i]);case"nw":case"northwest":case"westnorth":case"topleft":return B([n,a]);case"ne":case"northeast":case"eastnorth":case"topright":return B([o,a]);case"center":return ue(t);case void 0:case null:case"centroid":return ce(t);default:throw new Error("invalid origin")}}(t,o),1===i||e||w(t,function(t){var e=Ke(o,t),r=Ye(o,t),n=k(qr(o,e*i,r));t[0]=n[0],t[1]=n[1],3===t.length&&(t[2]*=i)}),t}function nn(t){var e=t[0],r=t[1];return[r[0]-e[0],r[1]-e[1]]}function on(t,e){return t[0]*e[1]-e[0]*t[1]}function an(t,e,r){var h=[],p=u(e,r),f=k(t),d=[];return f.forEach(function(t,e){if(e!==f.length-1){var r=(o=t,a=f[e+1],s=p,u=Math.sqrt((o[0]-a[0])*(o[0]-a[0])+(o[1]-a[1])*(o[1]-a[1])),c=o[0]+s*(a[1]-o[1])/u,l=a[0]+s*(a[1]-o[1])/u,[[c,o[1]+s*(o[0]-a[0])/u],[l,a[1]+s*(o[0]-a[0])/u]]);if(h.push(r),0<e){var n=h[e-1],i=function(t,e){return m=e,!(0===on(nn(t),nn(m)))&&(n=e,l=(r=t)[0],h=nn(r),p=n[0],f=nn(n),d=on(h,f),a=on((c=i=l,[(u=p)[0]-c[0],u[1]-c[1]]),f)/d,o=[a*(s=h)[0],a*s[1]],[i[0]+o[0],i[1]+o[1]]);var r,n,i,o,a,s,u,c,l,h,p,f,d,m}(r,n);!1!==i&&(n[1]=i,r[0]=i),d.push(n[0]),e===f.length-2&&(d.push(r[0]),d.push(r[1]))}2===f.length&&(d.push(r[0]),d.push(r[1]))}var o,a,s,u,c,l}),V(d,t.properties)}function sn(t,e,r){var n=e[0]-t[0],i=e[1]-t[1],o=r[0]-e[0],a=r[1]-e[1];return Math.sign(n*a-o*i)}function un(e,t){return t.geometry.coordinates[0].every(function(t){return Pt(B(t),e)})}function cn(t,e){for(var r=0;r<t.coordinates.length-1;r++)if(n=t.coordinates[r],i=t.coordinates[r+1],o=e.coordinates,void 0,a=o[0]-n[0],s=o[1]-n[1],u=i[0]-n[0],c=i[1]-n[1],a*c-s*u==0&&(Math.abs(u)>=Math.abs(c)?0<u?n[0]<=o[0]&&o[0]<=i[0]:i[0]<=o[0]&&o[0]<=n[0]:0<c?n[1]<=o[1]&&o[1]<=i[1]:i[1]<=o[1]&&o[1]<=n[1]))return!0;var n,i,o,a,s,u,c;return!1}function ln(t,e){return 0<$e(e,Pr(t)).features.length}function hn(t,e){return!(t[0]>e[0]||t[2]<e[2]||t[1]>e[1]||t[3]<e[3])}function pn(t,e){return t[0]===e[0]&&t[1]===e[1]}function fn(t,e){for(var r=!1,n=!1,i=t.coordinates.length,o=0;o<i&&!r&&!n;){for(var a=0;a<e.coordinates.length-1;a++){var s=!0;0!==a&&a!==e.coordinates.length-2||(s=!1),gn(e.coordinates[a],e.coordinates[a+1],t.coordinates[o],s)?r=!0:n=!0}o++}return r&&n}function dn(t,e){return 0<$e(t,Pr(e)).features.length}function mn(t,e){for(var r=!1,n=!1,i=t.coordinates[0].length,o=0;o<i&&r&&n;)Pt(B(t.coordinates[0][o]),e)?r=!0:n=!0,o++;return n&&n}function gn(t,e,r,n){var i=r[0]-t[0],o=r[1]-t[1],a=e[0]-t[0],s=e[1]-t[1];return 0==i*s-o*a&&(n?Math.abs(a)>=Math.abs(s)?0<a?t[0]<=r[0]&&r[0]<=e[0]:e[0]<=r[0]&&r[0]<=t[0]:0<s?t[1]<=r[1]&&r[1]<=e[1]:e[1]<=r[1]&&r[1]<=t[1]:Math.abs(a)>=Math.abs(s)?0<a?t[0]<r[0]&&r[0]<e[0]:e[0]<r[0]&&r[0]<t[0]:0<s?t[1]<r[1]&&r[1]<e[1]:e[1]<r[1]&&r[1]<t[1])}function yn(e){return e.coordinates.map(function(t){return{type:e.type.replace("Multi",""),coordinates:t}})}function vn(t,e){return t.hasOwnProperty("coordinates")?t.coordinates.length===e.coordinates.length:t.length===e.length}function _n(t,e){return ps(t,e,{strict:!0})}function bn(t,r){if(!t)throw new Error("feature1 is required");if(!r)throw new Error("feature2 is required");var e=K(t);if(e!==K(r))throw new Error("features must be of the same type");if("Point"===e)throw new Error("Point geometry not supported");if(new ms({precision:6}).compare(t,r))return!1;var n=0;switch(e){case"MultiPoint":var i=M(t),o=M(r);i.forEach(function(e){o.forEach(function(t){e[0]===t[0]&&e[1]===t[1]&&n++})});break;case"LineString":case"MultiLineString":I(t,function(e){I(r,function(t){Ur(e,t).features.length&&n++})});break;case"Polygon":case"MultiPolygon":I(t,function(e){I(r,function(t){$e(e,t).features.length&&n++})})}return 0<n}function xn(t,e,r){r=r||[];for(var n=0;n<t;n++)r[n]=e;return r}function wn(t,e){if(t.geometry&&t.geometry.type)return t.geometry.type;if(t.type)return t.type;throw new Error("Invalid GeoJSON object for "+e)}function Sn(t){for(var e=t,r=[];e.parent;)r.unshift(e),e=e.parent;return r}function En(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var r=0;r<t.length;r++){this.grid[r]=[];for(var n=0,i=t[r];n<i.length;n++){var o=new Cn(r,n,i[n]);this.grid[r][n]=o,this.nodes.push(o)}}this.init()}function Cn(t,e,r){this.x=t,this.y=e,this.weight=r}function Mn(t){this.content=[],this.scoreFunction=t}function Tn(t){return t[0]}function Pn(t){return t[1]}function On(){this._=null}function An(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function In(t,e){var r=e,n=e.R,i=r.U;i?i.L===r?i.L=n:i.R=n:t._=n,n.U=i,r.U=n,r.R=n.L,r.R&&(r.R.U=r),n.L=r}function Ln(t,e){var r=e,n=e.L,i=r.U;i?i.L===r?i.L=n:i.R=n:t._=n,n.U=i,r.U=n,r.L=n.R,r.L&&(r.L.U=r),n.R=r}function Rn(t){for(;t.L;)t=t.L;return t}function Nn(t,e,r,n){var i=[null,null],o=As.push(i)-1;return i.left=t,i.right=e,r&&Dn(i,t,e,r),n&&Dn(i,e,t,n),Ps[t.index].halfedges.push(o),Ps[e.index].halfedges.push(o),i}function kn(t,e,r){var n=[e,r];return n.left=t,n}function Dn(t,e,r,n){t[0]||t[1]?t.left===r?t[1]=n:t[0]=n:(t[0]=n,t.left=e,t.right=r)}function jn(t,e,r,n,i){var o,a=t[0],s=t[1],u=a[0],c=a[1],l=0,h=1,p=s[0]-u,f=s[1]-c;if(o=e-u,p||!(0<o)){if(o/=p,p<0){if(o<l)return;o<h&&(h=o)}else if(0<p){if(h<o)return;l<o&&(l=o)}if(o=n-u,p||!(o<0)){if(o/=p,p<0){if(h<o)return;l<o&&(l=o)}else if(0<p){if(o<l)return;o<h&&(h=o)}if(o=r-c,f||!(0<o)){if(o/=f,f<0){if(o<l)return;o<h&&(h=o)}else if(0<f){if(h<o)return;l<o&&(l=o)}if(o=i-c,f||!(o<0)){if(o/=f,f<0){if(h<o)return;l<o&&(l=o)}else if(0<f){if(o<l)return;o<h&&(h=o)}return!(0<l||h<1)||(0<l&&(t[0]=[u+l*p,c+l*f]),h<1&&(t[1]=[u+h*p,c+h*f]),!0)}}}}}function zn(t,e,r,n,i){var o=t[1];if(o)return!0;var a,s,u=t[0],c=t.left,l=t.right,h=c[0],p=c[1],f=l[0],d=l[1],m=(h+f)/2,g=(p+d)/2;if(d===p){if(m<e||n<=m)return;if(f<h){if(u){if(u[1]>=i)return}else u=[m,r];o=[m,i]}else{if(u){if(u[1]<r)return}else u=[m,i];o=[m,r]}}else if(s=g-(a=(h-f)/(d-p))*m,a<-1||1<a)if(f<h){if(u){if(u[1]>=i)return}else u=[(r-s)/a,r];o=[(i-s)/a,i]}else{if(u){if(u[1]<r)return}else u=[(i-s)/a,i];o=[(r-s)/a,r]}else if(p<d){if(u){if(u[0]>=n)return}else u=[e,a*e+s];o=[n,a*n+s]}else{if(u){if(u[0]<e)return}else u=[n,a*n+s];o=[e,a*e+s]}return t[0]=u,t[1]=o,!0}function Fn(t,e){return e[+(e.left!==t.site)]}function Bn(t){var e=t.P,r=t.N;if(e&&r){var n=e.site,i=t.site,o=r.site;if(n!==o){var a=i[0],s=i[1],u=n[0]-a,c=n[1]-s,l=o[0]-a,h=o[1]-s,p=2*(u*h-c*l);if(!(-Ns<=p)){var f=u*u+c*c,d=l*l+h*h,m=(h*f-c*d)/p,g=(u*d-l*f)/p,y=Is.pop()||new function(){An(this),this.x=this.y=this.arc=this.site=this.cy=null};y.arc=t,y.site=i,y.x=m+a,y.y=(y.cy=g+s)+Math.sqrt(m*m+g*g),t.circle=y;for(var v=null,_=Os._;_;)if(y.y<_.y||y.y===_.y&&y.x<=_.x){if(!_.L){v=_.P;break}_=_.L}else{if(!_.R){v=_;break}_=_.R}Os.insert(v,y),v||(Ms=y)}}}}function Un(t){var e=t.circle;e&&(e.P||(Ms=e.N),Os.remove(e),Is.push(e),An(e),t.circle=null)}function Vn(t){var e=Ls.pop()||new function(){An(this),this.edge=this.site=this.circle=null};return e.site=t,e}function Gn(t){Un(t),Ts.remove(t),Ls.push(t),An(t)}function qn(t){var e=t.circle,r=e.x,n=e.cy,i=[r,n],o=t.P,a=t.N,s=[t];Gn(t);for(var u=o;u.circle&&Math.abs(r-u.circle.x)<Rs&&Math.abs(n-u.circle.cy)<Rs;)o=u.P,s.unshift(u),Gn(u),u=o;s.unshift(u),Un(u);for(var c=a;c.circle&&Math.abs(r-c.circle.x)<Rs&&Math.abs(n-c.circle.cy)<Rs;)a=c.N,s.push(c),Gn(c),c=a;s.push(c),Un(c);var l,h=s.length;for(l=1;l<h;++l)c=s[l],u=s[l-1],Dn(c.edge,u.site,c.site,i);u=s[0],(c=s[h-1]).edge=Nn(u.site,c.site,null,i),Bn(u),Bn(c)}function Hn(t){for(var e,r,n,i,o=t[0],a=t[1],s=Ts._;s;)if((n=$n(s,a)-o)>Rs)s=s.L;else{if(!((i=o-function(t,e){var r=t.N;if(r)return $n(r,e);var n=t.site;return n[1]===e?n[0]:1/0}(s,a))>Rs)){-Rs<n?(e=s.P,r=s):-Rs<i?r=(e=s).N:e=r=s;break}if(!s.R){e=s;break}s=s.R}var u;Ps[(u=t).index]={site:u,halfedges:[]};var c=Vn(t);if(Ts.insert(e,c),e||r){if(e===r)return Un(e),r=Vn(e.site),Ts.insert(c,r),c.edge=r.edge=Nn(e.site,c.site),Bn(e),void Bn(r);if(r){Un(e),Un(r);var l=e.site,h=l[0],p=l[1],f=t[0]-h,d=t[1]-p,m=r.site,g=m[0]-h,y=m[1]-p,v=2*(f*y-d*g),_=f*f+d*d,b=g*g+y*y,x=[(y*_-d*b)/v+h,(f*b-g*_)/v+p];Dn(r.edge,l,m,x),c.edge=Nn(l,t,null,x),r.edge=Nn(t,m,null,x),Bn(e),Bn(r)}else c.edge=Nn(e.site,c.site)}}function $n(t,e){var r=t.site,n=r[0],i=r[1],o=i-e;if(!o)return n;var a=t.P;if(!a)return-1/0;var s=(r=a.site)[0],u=r[1],c=u-e;if(!c)return s;var l=s-n,h=1/o-1/c,p=l/c;return h?(-p+Math.sqrt(p*p-2*h*(l*l/(-2*c)-u+c/2+i-o/2)))/h+n:(n+s)/2}function Wn(t,e){return e[1]-t[1]||e[0]-t[0]}function Xn(t,e){var r,n,i,o=t.sort(Wn).pop();for(As=[],Ps=new Array(t.length),Ts=new On,Os=new On;;)if(i=Ms,o&&(!i||o[1]<i.y||o[1]===i.y&&o[0]<i.x))o[0]===r&&o[1]===n||(Hn(o),r=o[0],n=o[1]),o=t.pop();else{if(!i)break;qn(i.arc)}if(function(){for(var t,e,r,n,i=0,o=Ps.length;i<o;++i)if((t=Ps[i])&&(n=(e=t.halfedges).length)){var a=new Array(n),s=new Array(n);for(r=0;r<n;++r)a[r]=r,s[r]=(u=t,c=As[e[r]],p=h=void 0,l=u.site,h=c.left,p=c.right,l===p&&(p=h,h=l),p?Math.atan2(p[1]-h[1],p[0]-h[0]):(p=l===h?(h=c[1],c[0]):(h=c[0],c[1]),Math.atan2(h[0]-p[0],p[1]-h[1])));for(a.sort(function(t,e){return s[e]-s[t]}),r=0;r<n;++r)s[r]=e[a[r]];for(r=0;r<n;++r)e[r]=s[r]}var u,c,l,h,p}(),e){var a=+e[0][0],s=+e[0][1],u=+e[1][0],c=+e[1][1];!function(t,e,r,n){for(var i,o=As.length;o--;)zn(i=As[o],t,e,r,n)&&jn(i,t,e,r,n)&&(Math.abs(i[0][0]-i[1][0])>Rs||Math.abs(i[0][1]-i[1][1])>Rs)||delete As[o]}(a,s,u,c),function(t,e,r,n){var i,o,a,s,u,c,l,h,p,f,d,m,g,y,v=Ps.length,_=!0;for(i=0;i<v;++i)if(o=Ps[i]){for(a=o.site,s=(u=o.halfedges).length;s--;)As[u[s]]||u.splice(s,1);for(s=0,c=u.length;s<c;)d=(g=o,f=(y=As[u[s]])[+(y.left===g.site)])[0],m=f[1],h=(l=Fn(o,As[u[++s%c]]))[0],p=l[1],(Math.abs(d-h)>Rs||Math.abs(m-p)>Rs)&&(u.splice(s,0,As.push(kn(a,f,Math.abs(d-t)<Rs&&Rs<n-m?[t,Math.abs(h-t)<Rs?p:n]:Math.abs(m-n)<Rs&&Rs<r-d?[Math.abs(p-n)<Rs?h:r,n]:Math.abs(d-r)<Rs&&Rs<m-e?[r,Math.abs(h-r)<Rs?p:e]:Math.abs(m-e)<Rs&&Rs<d-t?[Math.abs(p-e)<Rs?h:t,e]:null))-1),++c);c&&(_=!1)}if(_){var b,x,w,S=1/0;for(i=0,_=null;i<v;++i)(o=Ps[i])&&(w=(b=(a=o.site)[0]-t)*b+(x=a[1]-e)*x)<S&&(S=w,_=o);if(_){var E=[t,e],C=[t,n],M=[r,n],T=[r,e];_.halfedges.push(As.push(kn(a=_.site,E,C))-1,As.push(kn(a,C,M))-1,As.push(kn(a,M,T))-1,As.push(kn(a,T,E))-1)}}for(i=0;i<v;++i)(o=Ps[i])&&(o.halfedges.length||delete Ps[i])}(a,s,u,c)}this.edges=As,this.cells=Ps,Ts=Os=As=Ps=null}function Yn(t){return(t=t.slice()).push(t[0]),U([t])}function Zn(t,e,r,n){var i=(n=n||{}).steps||64,o=n.units||"kilometers",a=n.angle||0,s=n.pivot||t,u=n.properties||t.properties||{};if(!t)throw new Error("center is required");if(!e)throw new Error("xSemiAxis is required");if(!r)throw new Error("ySemiAxis is required");if(!H(n))throw new Error("options must be an object");if(!q(i))throw new Error("steps must be a number");if(!q(a))throw new Error("angle must be a number");var c=W(t);if("degrees"===o)var l=v(a);else e=qr(t,e,90,{units:o}),r=qr(t,r,0,{units:o}),e=W(e)[0]-c[0],r=W(r)[1]-c[1];for(var h=[],p=0;p<i;p+=1){var f=-360*p/i,d=e*r/Math.sqrt(Math.pow(r,2)+Math.pow(e,2)*Math.pow(Kn(f),2)),m=e*r/Math.sqrt(Math.pow(e,2)+Math.pow(r,2)/Math.pow(Kn(f),2));if(f<-90&&-270<=f&&(d=-d),f<-180&&-360<=f&&(m=-m),"degrees"===o){var g=d*Math.cos(l)+m*Math.sin(l),y=m*Math.cos(l)-d*Math.sin(l);d=g,m=y}h.push([d+c[0],m+c[1]])}return h.push(h[0]),"degrees"===o?U([h],u):tn(U([h],u),a,{pivot:s})}function Kn(t){var e=t*Math.PI/180;return Math.tan(e)}function Jn(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.properties,i=e.weight;if(!t)throw new Error("geojson is required");var o=0,a=0,s=0;return T(t,function(t,e,r){var n=r[i];if(!q(n=null==n?1:n))throw new Error("weight value must be a number for feature index "+e);0<(n=Number(n))&&w(t,function(t){o+=t[0]*n,a+=t[1]*n,s+=n})}),B([o/s,a/s],r)}function Qn(t,e){return{x:t[0]-e[0],y:t[1]-e[1]}}function ti(t){if(H(t)&&(t=t.bbox),t&&!Array.isArray(t))throw new Error("bbox is invalid");return t?(e=t,[Math.random()*(e[2]-e[0])+e[0],Math.random()*(e[3]-e[1])+e[1]]):[360*ii(),180*ii()];var e}function ei(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.bbox;null!=t||(t=1);for(var n=[],i=0;i<t;i++)n.push(B(ti(r)));return G(n)}function ri(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.bbox,n=e.num_vertices,i=e.max_radial_length;null!=t||(t=1),q(n)||(n=10),q(i)||(i=10);for(var o=[],a=0;a<t;a++){var s=[],u=Array.apply(null,new Array(n+1)).map(Math.random);u.forEach(function(t,e,r){r[e]=0<e?t+r[e-1]:t}),u.forEach(function(t){t=2*t*Math.PI/u[u.length-1];var e=Math.random();s.push([e*i*Math.sin(t),e*i*Math.cos(t)])}),s[s.length-1]=s[0],s=s.map(function(e){return function(t){return[t[0]+e[0],t[1]+e[1]]}}(ti(r))),o.push(U([s]))}return G(o)}function ni(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.bbox,n=e.num_vertices,i=e.max_length,o=e.max_rotation;null!=t||(t=1),(!q(n)||n<2)&&(n=10),q(i)||(i=1e-4),q(o)||(o=Math.PI/8);for(var a=[],s=0;s<t;s++){for(var u=[ti(r)],c=0;c<n-1;c++){var l=(0===c?2*Math.random()*Math.PI:Math.tan((u[c][1]-u[c-1][1])/(u[c][0]-u[c-1][0])))+(Math.random()-.5)*o*2,h=Math.random()*i;u.push([u[c][0]+h*Math.cos(l),u[c][1]+h*Math.sin(l)])}a.push(V(u))}return G(a)}function ii(){return Math.random()-.5}function oi(t,e){if(!t)throw new Error("geojson is required");if("FeatureCollection"!==t.type)throw new Error("geojson must be a FeatureCollection");if(null==e)throw new Error("filter is required");var r=[];return E(t,function(t){ci(t.properties,e)&&r.push(t)}),G(r)}function ai(t,e,r){if(!t)throw new Error("geojson is required");if("FeatureCollection"!==t.type)throw new Error("geojson must be a FeatureCollection");if(null==e)throw new Error("property is required");for(var n=ui(t,e),i=Object.keys(n),o=0;o<i.length;o++){for(var a=i[o],s=n[a],u=[],c=0;c<s.length;c++)u.push(t.features[s[c]]);r(G(u),a,o)}}function si(t,e,n,i){var o=i;return ai(t,e,function(t,e,r){o=0===r&&void 0===i?t:n(o,t,e,r)}),o}function ui(t,i){var o={};return E(t,function(t,e){var r=t.properties||{};if(r.hasOwnProperty(i)){var n=r[i];o.hasOwnProperty(n)?o[n].push(e):o[n]=[e]}}),o}function ci(t,e){if(void 0===t)return!1;var r=typeof e;if("number"==r||"string"==r)return t.hasOwnProperty(e);if(Array.isArray(e)){for(var n=0;n<e.length;n++)if(!ci(t,e[n]))return!1;return!0}return li(t,e)}function li(t,e){for(var r=Object.keys(e),n=0;n<r.length;n++){var i=r[n];if(t[i]!==e[i])return!1}return!0}function hi(t,e){if(!e)return{};if(!e.length)return{};for(var r={},n=0;n<e.length;n++){var i=e[n];t.hasOwnProperty(i)&&(r[i]=t[i])}return r}function pi(){}function fi(t){this.message=t||""}function di(t){this.message=t||""}function mi(){}function gi(t){return null===t?_c:t.color}function yi(t){return null===t?null:t.parent}function vi(t,e){null!==t&&(t.color=e)}function _i(t){return null===t?null:t.left}function bi(t){return null===t?null:t.right}function xi(){this.root_=null,this.size_=0}function wi(){}function Si(){this.array_=[],arguments[0]instanceof Xu&&this.addAll(arguments[0])}function Ei(){}function Ci(t){this.message=t||""}function Mi(){this.array_=[]}function Ti(t){switch(t.type){case"Polygon":return 1<sr(t)?t:null;case"MultiPolygon":var e=[];if(O(t,function(t){1<sr(t)&&e.push(t.geometry.coordinates)}),e.length)return{type:"MultiPolygon",coordinates:e}}}function Pi(){this.reset()}function Oi(t,e,r){var n=t.s=e+r,i=n-e,o=n-i;t.t=e-o+(r-i)}function Ai(t){return 1<t?cd:t<-1?-cd:Math.asin(t)}function Ii(){}function Li(t,e){t&&Ed.hasOwnProperty(t.type)&&Ed[t.type](t,e)}function Ri(t,e,r){var n,i=-1,o=t.length-r;for(e.lineStart();++i<o;)n=t[i],e.point(n[0],n[1],n[2]);e.lineEnd()}function Ni(t,e){var r=-1,n=t.length;for(e.polygonStart();++r<n;)Ri(t[r],e,1);e.polygonEnd()}function ki(t){return[gd(t[1],t[0]),Ai(t[2])]}function Di(t){var e=t[0],r=t[1],n=yd(r);return[n*yd(e),n*bd(e),bd(r)]}function ji(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function zi(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Fi(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Bi(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Ui(t){var e=xd(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function Vi(t,e){return[ud<t?t-hd:t<-ud?t+hd:t,e]}function Gi(t,e,r){return(t%=hd)?e||r?Md(Hi(t),$i(e,r)):Hi(t):e||r?$i(e,r):Vi}function qi(r){return function(t,e){return[ud<(t+=r)?t-hd:t<-ud?t+hd:t,e]}}function Hi(t){var e=qi(t);return e.invert=qi(-t),e}function $i(t,e){function r(t,e){var r=yd(e),n=yd(t)*r,i=bd(t)*r,o=bd(e),a=o*s+n*u;return[gd(i*c-a*l,n*s-o*u),Ai(a*c+i*l)]}var s=yd(t),u=bd(t),c=yd(e),l=bd(e);return r.invert=function(t,e){var r=yd(e),n=yd(t)*r,i=bd(t)*r,o=bd(e),a=o*c-i*l;return[gd(i*c+o*l,n*s+a*u),Ai(a*s-n*u)]},r}function Wi(t,e){(e=Di(e))[0]-=t,Ui(e);var r,n=1<(r=-e[1])?0:r<-1?ud:Math.acos(r);return((-e[2]<0?-n:n)+hd-sd)%hd}function Xi(t,e,r,n){this.x=t,this.z=e,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function Yi(t){if(e=t.length){for(var e,r,n=0,i=t[0];++n<e;)i.n=r=t[n],r.p=i,i=r;i.n=r=t[0],r.p=i}}function Zi(t){return 1<t.length}function Ki(t,e){return((t=t.x)[0]<0?t[1]-cd-sd:cd-t[1])-((e=e.x)[0]<0?e[1]-cd-sd:cd-e[1])}function Ji(n){return function(t){var e=new Qi;for(var r in n)e[r]=n[r];return e.stream=t,e}}function Qi(){}function to(t,e,r){var n=e[1][0]-e[0][0],i=e[1][1]-e[0][1],o=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),null!=o&&t.clipExtent(null),Cd(r,t.stream(Gd));var a=Gd.result(),s=Math.min(n/(a[1][0]-a[0][0]),i/(a[1][1]-a[0][1])),u=+e[0][0]+(n-s*(a[1][0]+a[0][0]))/2,c=+e[0][1]+(i-s*(a[1][1]+a[0][1]))/2;return null!=o&&t.clipExtent(o),t.scale(150*s).translate([u,c])}function eo(t){return m=150,g=480,y=250,w=x=b=_=v=0,E=Hd,C=S=null,M=zd,P=$d(e,T=.5),r.stream=function(t){return f&&d===t?f:f=Xd(E(u,P(M(d=t))))},r.clipAngle=function(t){return arguments.length?(E=+t?function(i,o){function f(t,e){return yd(t)*yd(e)>M}function d(t,e,r){var n=[1,0,0],i=zi(Di(t),Di(e)),o=ji(i,i),a=i[0],s=o-a*a;if(!s)return!r&&t;var u=M*o/s,c=-M*a/s,l=zi(n,i),h=Bi(n,u);Fi(h,Bi(i,c));var p=l,f=ji(h,p),d=ji(p,p),m=f*f-d*(ji(h,h)-1);if(!(m<0)){var g=xd(m),y=Bi(p,(-f-g)/d);if(Fi(y,h),y=ki(y),!r)return y;var v,_=t[0],b=e[0],x=t[1],w=e[1];b<_&&(v=_,_=b,b=v);var S=b-_,E=dd(S-ud)<sd;if(!E&&w<x&&(v=x,x=w,w=v),E||S<sd?E?0<x+w^y[1]<(dd(y[0]-_)<sd?x:w):x<=y[1]&&y[1]<=w:ud<S^(_<=y[0]&&y[0]<=b)){var C=Bi(p,(-f+g)/d);return Fi(C,h),[y,ki(C)]}}}function m(t,e){var r=g?i:ud-i,n=0;return t<-r?n|=1:r<t&&(n|=2),e<-r?n|=4:r<e&&(n|=8),n}var M=yd(i),g=0<M,y=dd(M)>sd;return qd(f,function(s){var u,c,l,h,p;return{lineStart:function(){h=l=!1,p=1},point:function(t,e){var r,n=[t,e],i=f(t,e),o=g?i?0:m(t,e):i?m(t+(t<0?ud:-ud),e):0;if(!u&&(h=l=i)&&s.lineStart(),i===l||(r=d(u,n))&&!Td(u,r)&&!Td(n,r)||(n[0]+=sd,n[1]+=sd,i=f(n[0],n[1])),i!==l)p=0,i?(s.lineStart(),r=d(n,u),s.point(r[0],r[1])):(r=d(u,n),s.point(r[0],r[1]),s.lineEnd()),u=r;else if(y&&u&&g^i){var a;o&c||!(a=d(n,u,!0))||(p=0,g?(s.lineStart(),s.point(a[0][0],a[0][1]),s.point(a[1][0],a[1][1]),s.lineEnd()):(s.point(a[1][0],a[1][1]),s.lineEnd(),s.lineStart(),s.point(a[0][0],a[0][1])))}!i||u&&Td(u,n)||s.point(n[0],n[1]),u=n,l=i,c=o},lineEnd:function(){l&&s.lineEnd(),u=null},clean:function(){return p|(h&&l)<<1}}},function(t,e,r,n){!function(t,e,r,n,i,o){if(r){var a=yd(e),s=bd(e),u=n*r;null==i?(i=e+n*hd,o=e-u/2):(i=Wi(a,i),o=Wi(a,o),(0<n?i<o:o<i)&&(i+=n*hd));for(var c,l=i;0<n?o<l:l<o;l-=u)c=ki([a,-s*yd(l),-s*bd(l)]),t.point(c[0],c[1])}}(n,i,o,r,t,e)},g?[0,-i]:[-ud,i-ud])}(S=t*fd,6*fd):(S=null,Hd),i()):S*pd},r.clipExtent=function(t){return arguments.length?(M=null==t?(C=l=h=p=null,zd):function(y,v,_,b){function x(t,e){return y<=t&&t<=_&&v<=e&&e<=b}function w(t,e,r,n){var i=0,o=0;if(null==t||(i=a(t,r))!==(o=a(e,r))||s(t,e)<0^0<r)for(;n.point(0===i||3===i?y:_,1<i?b:v),(i=(i+r+4)%4)!==o;);else n.point(e[0],e[1])}function a(t,e){return dd(t[0]-y)<sd?0<e?0:3:dd(t[0]-_)<sd?0<e?2:1:dd(t[1]-v)<sd?0<e?1:0:0<e?3:2}function S(t,e){return s(t.x,e.x)}function s(t,e){var r=a(t,1),n=a(e,1);return r!==n?r-n:0===r?e[1]-t[1]:1===r?t[0]-e[0]:2===r?t[1]-e[1]:e[0]-t[0]}return function(n){function t(t,e){x(t,e)&&m.point(t,e)}function e(t,e){var r=x(t,e);if(h&&o.push([t,e]),f)a=t,s=e,f=!1,(u=r)&&(m.lineStart(),m.point(t,e));else if(r&&p)m.point(t,e);else{var n=[c=Math.max(Dd,Math.min(kd,c)),l=Math.max(Dd,Math.min(kd,l))],i=[t=Math.max(Dd,Math.min(kd,t)),e=Math.max(Dd,Math.min(kd,e))];Ld(n,i,y,v,_,b)?(p||(m.lineStart(),m.point(n[0],n[1])),m.point(i[0],i[1]),r||m.lineEnd(),d=!1):r&&(m.lineStart(),m.point(t,e),d=!1)}c=t,l=e,p=r}var i,h,o,a,s,u,c,l,p,f,d,m=n,r=Id(),g={point:t,lineStart:function(){g.point=e,h&&h.push(o=[]),p=!(f=!0),c=l=NaN},lineEnd:function(){i&&(e(a,s),u&&p&&r.rejoin(),i.push(r.result())),g.point=t,p&&m.lineEnd()},polygonStart:function(){m=r,i=[],h=[],d=!0},polygonEnd:function(){var t=function(){for(var t=0,e=0,r=h.length;e<r;++e)for(var n,i,o=h[e],a=1,s=o.length,u=o[0],c=u[0],l=u[1];a<s;++a)n=c,i=l,c=(u=o[a])[0],l=u[1],i<=b?b<l&&(l-i)*(y-n)<(c-n)*(b-i)&&++t:l<=b&&(c-n)*(b-i)<(l-i)*(y-n)&&--t;return t}(),e=d&&t,r=(i=Nd(i)).length;(e||r)&&(n.polygonStart(),e&&(n.lineStart(),w(null,null,1,n),n.lineEnd()),r&&Rd(i,S,t,w,n),n.polygonEnd()),m=n,i=h=o=null}};return g}}(C=+t[0][0],l=+t[0][1],h=+t[1][0],p=+t[1][1]),i()):null==C?null:[[C,l],[h,p]]},r.scale=function(t){return arguments.length?(m=+t,n()):m},r.translate=function(t){return arguments.length?(g=+t[0],y=+t[1],n()):[g,y]},r.center=function(t){return arguments.length?(v=t[0]%360*fd,_=t[1]%360*fd,n()):[v*pd,_*pd]},r.rotate=function(t){return arguments.length?(b=t[0]%360*fd,x=t[1]%360*fd,w=2<t.length?t[2]%360*fd:0,n()):[b*pd,x*pd,w*pd]},r.precision=function(t){return arguments.length?(P=$d(e,T=t*t),i()):xd(T)},r.fitExtent=function(t,e){return to(r,t,e)},r.fitSize=function(t,e){return to(r,[[0,0],t],e)},function(){return o=function(){return t}.apply(this,arguments),r.invert=o.invert&&function(t){return(t=c.invert((t[0]-a)/m,(s-t[1])/m))&&[t[0]*pd,t[1]*pd]},n()}();function r(t){return[(t=c(t[0]*fd,t[1]*fd))[0]*m+a,s-t[1]*m]}function e(t,e){return[(t=o(t,e))[0]*m+a,s-t[1]*m]}function n(){c=Md(u=Gi(b,x,w),o);var t=o(v,_);return a=g-t[0]*m,s=y+t[1]*m,i()}function i(){return f=d=null,r}var o,a,s,u,c,l,h,p,f,d,m,g,y,v,_,b,x,w,S,E,C,M,T,P}function ro(t,e){return[t,_d(wd((cd+e)/2))]}function no(t,e){return[_d(wd((cd+e)/2)),-t]}function io(t,r,n,i){var e=t.properties||{},o="Feature"===t.type?t.geometry:t;if("GeometryCollection"===o.type){var a=[];return T(t,function(t){var e=io(t,r,n,i);e&&a.push(e)}),G(a)}var s,u=$(t),c=50<u[1]&&50<u[3];s=c?{type:o.type,coordinates:function e(t,r){return"object"!=typeof t[0]?r(t):t.map(function(t){return e(t,r)})}(o.coordinates,oo(o))}:Je(o);var l,h=(new pl).read(s),p=d(m(r,n),"meters"),f=Cp.bufferOp(h,p);if(!function t(e){return Array.isArray(e[0])?t(e[0]):isNaN(e[0])}((f=(new fl).write(f)).coordinates))return(l=c?{type:f.type,coordinates:function e(t,r){return"object"!=typeof t[0]?r.invert(t):t.map(function(t){return e(t,r)})}(f.coordinates,oo(o))}:Qe(f)).geometry?l:F(l,e)}function oo(t){var e=ue(t).geometry.coordinates.reverse(),r=e.map(function(t){return-t});return Yd().center(e).rotate(r).scale(fo)}function ao(){for(var t=new pl,e=t.read(JSON.stringify(arguments[0].geometry)),r=1;r<arguments.length;r++)e=id.union(e,t.read(JSON.stringify(arguments[r].geometry)));return{type:"Feature",geometry:e=(new fl).write(e),properties:arguments[0].properties}}function so(t,e){var r=Y(t),n=Y(e);if(Yt(vr(n,{precision:4})).coordinates[0].length<4)return null;if(Yt(vr(r,{precision:4})).coordinates[0].length<4)return null;var i=new pl,o=i.read(vr(r)),a=i.read(vr(n)),s=Xf.intersection(o,a);return s.isEmpty()?null:F((new fl).write(s))}function uo(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n=r.properties||{},i=r.triangles,o=r.mask;if(null==e)throw new Error("cellSide is required");if(!q(e))throw new Error("cellSide is invalid");if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be array");if(4!==t.length)throw new Error("bbox must contain 4 numbers");if(o&&-1===["Polygon","MultiPolygon"].indexOf(K(o)))throw new Error("options.mask must be a (Multi)Polygon");var a=t[0],s=t[1],u=t[2],c=t[3],l=(s+c)/2,h=(a+u)/2,p=2*e/kt([a,l],[u,l],r)*(u-a),f=2*e/kt([h,s],[h,c],r)*(c-s),d=p/2,m=2*d,g=Math.sqrt(3)/2*f,y=u-a,v=c-s,_=.75*m,b=g,x=(y-m)/(m-d/2),w=Math.floor(x),S=(w*_-d/2-y)/2-d/2+_/2,E=Math.floor((v-g)/g),C=(v-E*g)/2,M=g/2<E*g-v;M&&(C-=g/4);for(var T=[],P=[],O=0;O<6;O++){var A=2*Math.PI/6*O;T.push(Math.cos(A)),P.push(Math.sin(A))}for(var I=[],L=0;L<=w;L++)for(var R=0;R<=E;R++){var N=L%2==1;if(!(0===R&&N||0===R&&M)){var k=L*_+a-S,D=R*b+s+C;if(N&&(D-=g/2),!0===i)(function(t,e,r,n,i,o){for(var a=[],s=0;s<6;s++){var u=[];u.push(t),u.push([t[0]+e*i[s],t[1]+r*o[s]]),u.push([t[0]+e*i[(s+1)%6],t[1]+r*o[(s+1)%6]]),u.push(t),a.push(U([u],n))}return a})([k,D],p/2,f/2,n,T,P).forEach(function(t){o?so(o,t)&&I.push(t):I.push(t)});else{var j=function(t,e,r,n,i,o){for(var a=[],s=0;s<6;s++){var u=t[0]+e*i[s],c=t[1]+r*o[s];a.push([u,c])}return a.push(a[0].slice()),U([a],n)}([k,D],p/2,f/2,n,T,P);o?so(o,j)&&I.push(j):I.push(j)}}}return G(I)}function co(t){if(t.features.length<=1)return t;var e,r,n,o=(e=t,r=Eo(),n=[],O(e,function(t,e){var r=$(t);n.push({minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],geojson:t,index:e})}),r.load(n),r),a=[],s={};return O(t,function(t,e){if(s[e])return!0;for(o.remove({index:e},lo),s[e]=!0;;){var r=$(t),n=o.search({minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]});if(0<n.length){var i=n.map(function(t){return s[t.index]=!0,o.remove({index:t.index},lo),t.geojson});i.push(t),t=ao.apply(this,i)}if(0===n.length)break}a.push(t)}),G(a)}function lo(t,e){return t.index===e.index}function ho(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n=r.properties,i=r.mask,o=[];if(null==e)throw new Error("cellSide is required");if(!q(e))throw new Error("cellSide is invalid");if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be array");if(4!==t.length)throw new Error("bbox must contain 4 numbers");if(i&&-1===["Polygon","MultiPolygon"].indexOf(K(i)))throw new Error("options.mask must be a (Multi)Polygon");for(var a=t[0],s=t[1],u=t[2],c=t[3],l=e/kt([a,s],[u,s],r)*(u-a),h=e/kt([a,s],[a,c],r)*(c-s),p=u-a,f=c-s,d=Math.floor(p/l),m=Math.floor(f/h),g=(f-m*h)/2,y=a+(p-d*l)/2,v=0;v<d;v++){for(var _=s+g,b=0;b<m;b++){var x=U([[[y,_],[y,_+h],[y+l,_+h],[y+l,_],[y,_]]],n);i?so(i,x)&&o.push(x):o.push(x),_+=h}y+=l}return G(o)}function po(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n=r.properties,i=r.mask,o=[];if(null==e)throw new Error("cellSide is required");if(!q(e))throw new Error("cellSide is invalid");if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be array");if(4!==t.length)throw new Error("bbox must contain 4 numbers");if(i&&-1===["Polygon","MultiPolygon"].indexOf(K(i)))throw new Error("options.mask must be a (Multi)Polygon");for(var a=e/kt([t[0],t[1]],[t[2],t[1]],r)*(t[2]-t[0]),s=e/kt([t[0],t[1]],[t[0],t[3]],r)*(t[3]-t[1]),u=0,c=t[0];c<=t[2];){for(var l=0,h=t[1];h<=t[3];){var p=null,f=null;u%2==0&&l%2==0?(p=U([[[c,h],[c,h+s],[c+a,h],[c,h]]],n),f=U([[[c,h+s],[c+a,h+s],[c+a,h],[c,h+s]]],n)):u%2==0&&l%2==1?(p=U([[[c,h],[c+a,h+s],[c+a,h],[c,h]]],n),f=U([[[c,h],[c,h+s],[c+a,h+s],[c,h]]],n)):l%2==0&&u%2==1?(p=U([[[c,h],[c,h+s],[c+a,h+s],[c,h]]],n),f=U([[[c,h],[c+a,h+s],[c+a,h],[c,h]]],n)):l%2==1&&u%2==1&&(p=U([[[c,h],[c,h+s],[c+a,h],[c,h]]],n),f=U([[[c,h+s],[c+a,h+s],[c+a,h],[c,h+s]]],n)),i?(so(i,p)&&o.push(p),so(i,f)&&o.push(f)):(o.push(p),o.push(f)),h+=s,l++}u++,c+=a}return G(o)}var fo=6371008.8,mo={meters:fo,metres:fo,millimeters:1e3*fo,millimetres:1e3*fo,centimeters:100*fo,centimetres:100*fo,kilometers:fo/1e3,kilometres:fo/1e3,miles:fo/1609.344,nauticalmiles:fo/1852,inches:39.37*fo,yards:fo/1.0936,feet:3.28084*fo,radians:1,degrees:fo/111325},go={meters:1,metres:1,millimeters:1e3,millimetres:1e3,centimeters:100,centimetres:100,kilometers:.001,kilometres:.001,miles:1/1609.344,nauticalmiles:1/1852,inches:39.37,yards:1/1.0936,feet:3.28084,radians:1/fo,degrees:1/111325},yo={meters:1,metres:1,millimeters:1e6,millimetres:1e6,centimeters:1e4,centimetres:1e4,kilometers:1e-6,kilometres:1e-6,acres:247105e-9,miles:386e-9,yards:1.195990046,feet:10.763910417,inches:1550.003100006},vo=Object.freeze({earthRadius:fo,factors:mo,unitsFactors:go,areaFactors:yo,feature:F,geometry:e,point:B,points:r,polygon:U,polygons:n,lineString:V,lineStrings:i,featureCollection:G,multiLineString:_,multiPoint:o,multiPolygon:b,geometryCollection:a,round:s,radiansToLength:d,lengthToRadians:m,lengthToDegrees:u,bearingToAzimuth:p,radiansToDegrees:f,degreesToRadians:v,convertLength:c,convertArea:l,isNumber:q,isObject:H,validateBBox:h,validateId:g,radians2degrees:function(){throw new Error("method has been renamed to `radiansToDegrees`")},degrees2radians:function(){throw new Error("method has been renamed to `degreesToRadians`")},distanceToDegrees:function(){throw new Error("method has been renamed to `lengthToDegrees`")},distanceToRadians:function(){throw new Error("method has been renamed to `lengthToRadians`")},radiansToDistance:function(){throw new Error("method has been renamed to `radiansToLength`")},bearingToAngle:function(){throw new Error("method has been renamed to `bearingToAzimuth`")},convertDistance:function(){throw new Error("method has been renamed to `convertLength`")}}),_o=Object.freeze({coordEach:w,coordReduce:y,propEach:x,propReduce:S,featureEach:E,featureReduce:C,coordAll:M,geomEach:T,geomReduce:P,flattenEach:O,flattenReduce:A,segmentEach:I,segmentReduce:L,lineEach:R,lineReduce:N}),bo=Object.freeze({getCoord:W,getCoords:k,containsNumber:D,geojsonType:j,featureOf:z,collectionOf:X,getGeom:Y,getGeomType:Z,getType:K}),xo={successCallback:null,verbose:!1},wo={},So=function t(e,r,n,i,o){for(n=n||0,i=i||e.length-1,o=o||function(t,e){return t<e?-1:e<t?1:0};n<i;){if(600<i-n){var a=i-n+1,s=r-n+1,u=Math.log(a),c=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*c*(a-c)/a)*(s-a/2<0?-1:1);t(e,r,Math.max(n,Math.floor(r-s*c/a+l)),Math.min(i,Math.floor(r+(a-s)*c/a+l)),o)}var h=e[r],p=n,f=i;for(nt(e,n,r),0<o(e[i],h)&&nt(e,n,i);p<f;){for(nt(e,p,f),p++,f--;o(e[p],h)<0;)p++;for(;0<o(e[f],h);)f--}0===o(e[n],h)?nt(e,n,f):nt(e,++f,i),f<=r&&(n=f+1),r<=f&&(i=f-1)}},Eo=it;it.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],n=this.toBBox;if(!ft(t,e))return r;for(var i,o,a,s,u=[];e;){for(i=0,o=e.children.length;i<o;i++)a=e.children[i],ft(t,s=e.leaf?n(a):a)&&(e.leaf?r.push(a):pt(t,s)?this._all(a,r):u.push(a));e=u.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!ft(t,e))return!1;for(var n,i,o,a,s=[];e;){for(n=0,i=e.children.length;n<i;n++)if(o=e.children[n],ft(t,a=e.leaf?r(o):o)){if(e.leaf||pt(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=dt([]),this},remove:function(t,e){if(!t)return this;for(var r,n,i,o,a=this.data,s=this.toBBox(t),u=[],c=[];a||u.length;){if(a||(a=u.pop(),n=u[u.length-1],r=c.pop(),o=!0),a.leaf&&-1!==(i=function(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}(t,a.children,e)))return a.children.splice(i,1),u.push(a),this._condense(u),this;o||a.leaf||!pt(a,s)?n?(r++,a=n.children[r],o=!1):a=null:(u.push(a),c.push(r),r=0,a=(n=a).children[0])}return this},toBBox:function(t){return t},compareMinX:ut,compareMinY:ct,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,n){var i,o=r-e+1,a=this._maxEntries;if(o<=a)return ot(i=dt(t.slice(e,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),(i=dt([])).leaf=!1,i.height=n;var s,u,c,l,h=Math.ceil(o/a),p=h*Math.ceil(Math.sqrt(a));for(mt(t,e,r,p,this.compareMinX),s=e;s<=r;s+=p)for(mt(t,s,c=Math.min(s+p-1,r),h,this.compareMinY),u=s;u<=c;u+=h)l=Math.min(u+h-1,c),i.children.push(this._build(t,u,l,n-1));return ot(i,this.toBBox),i},_chooseSubtree:function(t,e,r,n){for(var i,o,a,s,u,c,l,h;n.push(e),!e.leaf&&n.length-1!==r;){for(l=h=1/0,i=0,o=e.children.length;i<o;i++)u=lt(a=e.children[i]),p=t,f=a,(c=(Math.max(f.maxX,p.maxX)-Math.min(f.minX,p.minX))*(Math.max(f.maxY,p.maxY)-Math.min(f.minY,p.minY))-u)<h?(h=c,l=u<l?u:l,s=a):c===h&&u<l&&(l=u,s=a);e=s||e.children[0]}var p,f;return e},_insert:function(t,e,r){var n=this.toBBox,i=r?t:n(t),o=[],a=this._chooseSubtree(i,this.data,e,o);for(a.children.push(t),st(a,i);0<=e&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n),a=dt(r.children.splice(o,r.children.length-o));a.height=r.height,a.leaf=r.leaf,ot(r,this.toBBox),ot(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(r,a)},_splitRoot:function(t,e){this.data=dt([t,e]),this.data.height=t.height+1,this.data.leaf=!1,ot(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var n,i,o,a,s,u,c,l,h,p,f,d,m,g;for(u=c=1/0,n=e;n<=r-e;n++)h=i=at(t,0,n,this.toBBox),p=o=at(t,n,r,this.toBBox),void 0,f=Math.max(h.minX,p.minX),d=Math.max(h.minY,p.minY),m=Math.min(h.maxX,p.maxX),g=Math.min(h.maxY,p.maxY),a=Math.max(0,m-f)*Math.max(0,g-d),s=lt(i)+lt(o),a<u?(u=a,l=n,c=s<c?s:c):a===u&&s<c&&(c=s,l=n);return l},_chooseSplitAxis:function(t,e,r){var n=t.leaf?this.compareMinX:ut,i=t.leaf?this.compareMinY:ct;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)},_allDistMargin:function(t,e,r,n){t.children.sort(n);var i,o,a=this.toBBox,s=at(t,0,e,a),u=at(t,r-e,r,a),c=ht(s)+ht(u);for(i=e;i<r-e;i++)o=t.children[i],st(s,t.leaf?a(o):o),c+=ht(s);for(i=r-e-1;e<=i;i--)o=t.children[i],st(u,t.leaf?a(o):o),c+=ht(u);return c},_adjustParentBBoxes:function(t,e,r){for(var n=r;0<=n;n--)st(e[n],t)},_condense:function(t){for(var e,r=t.length-1;0<=r;r--)0===t[r].children.length?0<r?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():ot(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};function Co(t,e,r){var n=t*e,i=Oo*t,o=i-(i-t),a=t-o,s=Oo*e,u=s-(s-e),c=e-u,l=a*c-(n-o*u-a*u-o*c);return r?(r[0]=l,r[1]=n,r):[l,n]}function Mo(t,e){var r,n,i,o,a,s=0|t.length,u=0|e.length;if(1==s&&1==u)return r=t[0],n=e[0],(a=r-((i=r+n)-(o=i-r))+(n-o))?[a,i]:[i];var c,l,h=new Array(s+u),p=0,f=0,d=0,m=Math.abs,g=t[f],y=m(g),v=e[d],_=m(v);y<_?(l=g,(f+=1)<s&&(y=m(g=t[f]))):(l=v,(d+=1)<u&&(_=m(v=e[d]))),f<s&&y<_||u<=d?(c=g,(f+=1)<s&&(y=m(g=t[f]))):(c=v,(d+=1)<u&&(_=m(v=e[d])));for(var b,x,w=c+l,S=w-c,E=l-S,C=E,M=w;f<s&&d<u;)y<_?(c=g,(f+=1)<s&&(y=m(g=t[f]))):(c=v,(d+=1)<u&&(_=m(v=e[d]))),(E=(l=C)-(S=(w=c+l)-c))&&(h[p++]=E),C=M-((b=M+w)-(x=b-M))+(w-x),M=b;for(;f<s;)(E=(l=C)-(S=(w=(c=g)+l)-c))&&(h[p++]=E),C=M-((b=M+w)-(x=b-M))+(w-x),M=b,(f+=1)<s&&(g=t[f]);for(;d<u;)(E=(l=C)-(S=(w=(c=v)+l)-c))&&(h[p++]=E),C=M-((b=M+w)-(x=b-M))+(w-x),M=b,(d+=1)<u&&(v=e[d]);return C&&(h[p++]=C),M&&(h[p++]=M),p||(h[p++]=0),h.length=p,h}function To(t,e){var r=t.length;if(1===r){var n=Co(t[0],e);return n[0]?n:[n[1]]}var i,o,a,s,u,c,l,h=new Array(2*r),p=[.1,.1],f=[.1,.1],d=0;Co(t[0],e,p),p[0]&&(h[d++]=p[0]);for(var m=1;m<r;++m){Co(t[m],e,f);var g=p[1];void 0,c=(o=f[0])-(u=(s=(i=g)+o)-i),l=i-(s-u),(a=p)&&(a[0]=l+c,a[1]=s),p[0]&&(h[d++]=p[0]);var y=f[1],v=p[1],_=y+v,b=v-(_-y);p[1]=_,b&&(h[d++]=b)}return p[1]&&(h[d++]=p[1]),0===d&&(h[d++]=0),h.length=d,h}function Po(t,e){var r,n,i,o,a,s=0|t.length,u=0|e.length;if(1==s&&1==u)return r=t[0],n=-e[0],(a=r-((i=r+n)-(o=i-r))+(n-o))?[a,i]:[i];var c,l,h=new Array(s+u),p=0,f=0,d=0,m=Math.abs,g=t[f],y=m(g),v=-e[d],_=m(v);y<_?(l=g,(f+=1)<s&&(y=m(g=t[f]))):(l=v,(d+=1)<u&&(_=m(v=-e[d]))),f<s&&y<_||u<=d?(c=g,(f+=1)<s&&(y=m(g=t[f]))):(c=v,(d+=1)<u&&(_=m(v=-e[d])));for(var b,x,w=c+l,S=w-c,E=l-S,C=E,M=w;f<s&&d<u;)y<_?(c=g,(f+=1)<s&&(y=m(g=t[f]))):(c=v,(d+=1)<u&&(_=m(v=-e[d]))),(E=(l=C)-(S=(w=c+l)-c))&&(h[p++]=E),C=M-((b=M+w)-(x=b-M))+(w-x),M=b;for(;f<s;)(E=(l=C)-(S=(w=(c=g)+l)-c))&&(h[p++]=E),C=M-((b=M+w)-(x=b-M))+(w-x),M=b,(f+=1)<s&&(g=t[f]);for(;d<u;)(E=(l=C)-(S=(w=(c=v)+l)-c))&&(h[p++]=E),C=M-((b=M+w)-(x=b-M))+(w-x),M=b,(d+=1)<u&&(v=-e[d]);return C&&(h[p++]=C),M&&(h[p++]=M),p||(h[p++]=0),h.length=p,h}var Oo=+(Math.pow(2,27)+1),Ao=gt(function(o){function l(t,e){for(var r=new Array(t.length-1),n=1;n<t.length;++n)for(var i=r[n-1]=new Array(t.length-1),o=0,a=0;o<t.length;++o)o!==e&&(i[a++]=t[n][o]);return r}function h(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",h(t.slice(0,e)),",",h(t.slice(e)),")"].join("")}function p(t){if(2===t.length)return[["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("")];for(var e=[],r=0;r<t.length;++r)e.push(["scale(",h(p(l(t,r))),",",(n=r,1&n?"-":""),t[0][r],")"].join(""));var n;return e}function a(t){for(var e=[],r=[],n=function(t){for(var e=new Array(t),r=0;r<t;++r){e[r]=new Array(t);for(var n=0;n<t;++n)e[r][n]=["m",n,"[",t-r-1,"]"].join("")}return e}(t),i=[],o=0;o<t;++o)0==(1&o)?e.push.apply(e,p(l(n,o))):r.push.apply(r,p(l(n,o))),i.push("m"+o);var a=h(e),s=h(r),u="orientation"+t+"Exact",c=["function ",u,"(",i.join(),"){var p=",a,",n=",s,",d=sub(p,n);return d[d.length-1];};return ",u].join("");return new Function("sum","prod","scale","sub",c)(Mo,Co,To,Po)}var u=a(3),x=a(4),s=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,r){var n,i=(t[1]-r[1])*(e[0]-r[0]),o=(t[0]-r[0])*(e[1]-r[1]),a=i-o;if(0<i){if(o<=0)return a;n=i+o}else{if(!(i<0))return a;if(0<=o)return a;n=-(i+o)}var s=33306690738754716e-32*n;return s<=a||a<=-s?a:u(t,e,r)},function(t,e,r,n){var i=t[0]-n[0],o=e[0]-n[0],a=r[0]-n[0],s=t[1]-n[1],u=e[1]-n[1],c=r[1]-n[1],l=t[2]-n[2],h=e[2]-n[2],p=r[2]-n[2],f=o*c,d=a*u,m=a*s,g=i*c,y=i*u,v=o*s,_=l*(f-d)+h*(m-g)+p*(y-v),b=7771561172376103e-31*((Math.abs(f)+Math.abs(d))*Math.abs(l)+(Math.abs(m)+Math.abs(g))*Math.abs(h)+(Math.abs(y)+Math.abs(v))*Math.abs(p));return b<_||b<-_?_:x(t,e,r,n)}];!function(){for(;s.length<=5;)s.push(a(s.length));for(var t=[],e=["slow"],r=0;r<=5;++r)t.push("a"+r),e.push("o"+r);var n=["function getOrientation(",t.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(r=2;r<=5;++r)n.push("case ",r,":return o",r,"(",t.slice(0,r).join(),");");n.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),e.push(n.join(""));var i=Function.apply(void 0,e);for(o.exports=i.apply(void 0,[function(t){var e=s[t.length];return(e=e||(s[t.length]=a(t.length))).apply(void 0,t)}].concat(s)),r=0;r<=5;++r)o.exports[r]=s[r]}()}),Io=Ao[3],Lo=yt,Ro=yt;yt.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,r=this.compare,n=e[t];0<t;){var i=t-1>>1,o=e[i];if(0<=r(n,o))break;e[t]=o,t=i}e[t]=n},_down:function(t){for(var e=this.data,r=this.compare,n=this.length>>1,i=e[t];t<n;){var o=1+(t<<1),a=o+1,s=e[o];if(a<this.length&&r(e[a],s)<0&&(s=e[o=a]),0<=r(s,i))break;e[t]=s,t=o}e[t]=i}},Lo.default=Ro;function No(t,e){for(var r=t[0],n=t[1],i=!1,o=0,a=e.length-1;o<e.length;a=o++){var s=e[o][0],u=e[o][1],c=e[a][0],l=e[a][1];n<u!=n<l&&r<(c-s)*(n-u)/(l-u)+s&&(i=!i)}return i}var ko=Ao[3],Do=vt,jo=vt;Do.default=jo;function zo(t){return t}function Fo(o,a,s,t,u,e){3===arguments.length&&(t=e=Array,u=null);for(var c=new t(o=1<<Math.max(4,Math.ceil(Math.log(o)/Math.LN2))),l=new e(o),h=o-1,r=0;r<o;++r)c[r]=u;return{set:function(t,e){for(var r=a(t)&h,n=c[r],i=0;n!=u;){if(s(n,t))return l[r]=e;if(++i>=o)throw new Error("full hashmap");n=c[r=r+1&h]}return c[r]=t,l[r]=e},maybeSet:function(t,e){for(var r=a(t)&h,n=c[r],i=0;n!=u;){if(s(n,t))return l[r];if(++i>=o)throw new Error("full hashmap");n=c[r=r+1&h]}return c[r]=t,l[r]=e},get:function(t,e){for(var r=a(t)&h,n=c[r],i=0;n!=u;){if(s(n,t))return l[r];if(++i>=o)break;n=c[r=r+1&h]}return e},keys:function(){for(var t=[],e=0,r=c.length;e<r;++e){var n=c[e];n!=u&&t.push(n)}return t}}}function Bo(t,e){return t[0]===e[0]&&t[1]===e[1]}function Uo(t){Xo[0]=t[0],Xo[1]=t[1];var e=Yo[0]^Yo[1];return 2147483647&(e<<5^e>>7^Yo[2]^Yo[3])}function Vo(t){var e,r,n,i,o,a,s,u=function(t){function e(t,e,r,n){if(p[r]!==t){p[r]=t;var i=f[r];if(0<=i){var o=d[r];i===e&&o===n||i===n&&o===e||(++g,m[r]=1)}else f[r]=e,d[r]=n}}function i(t){return Uo(u[t])}function o(t,e){return Bo(u[t],u[e])}var r,n,a,s,u=t.coordinates,c=t.lines,l=t.rings,h=function(){for(var t=Fo(1.4*u.length,i,o,Int32Array,-1,Int32Array),e=new Int32Array(u.length),r=0,n=u.length;r<n;++r)e[r]=t.maybeSet(r,r);return e}(),p=new Int32Array(u.length),f=new Int32Array(u.length),d=new Int32Array(u.length),m=new Int8Array(u.length),g=0;for(r=0,n=u.length;r<n;++r)p[r]=f[r]=d[r]=-1;for(r=0,n=c.length;r<n;++r){var y=c[r],v=y[0],_=y[1];for(a=h[v],s=h[++v],++g,m[a]=1;++v<=_;)e(r,a,a=s,s=h[v]);++g,m[s]=1}for(r=0,n=u.length;r<n;++r)p[r]=-1;for(r=0,n=l.length;r<n;++r){var b=l[r],x=b[0]+1,w=b[1];for(e(r,h[w-1],a=h[x-1],s=h[x]);++x<=w;)e(r,a,a=s,s=h[x])}p=f=d=null;var S,E=function(i,o,a,t,s){3===arguments.length&&(t=Array,s=null);for(var u=new t(i=1<<Math.max(4,Math.ceil(Math.log(i)/Math.LN2))),c=i-1,e=0;e<i;++e)u[e]=s;return{add:function(t){for(var e=o(t)&c,r=u[e],n=0;r!=s;){if(a(r,t))return!0;if(++n>=i)throw new Error("full hashset");r=u[e=e+1&c]}return u[e]=t,!0},has:function(t){for(var e=o(t)&c,r=u[e],n=0;r!=s;){if(a(r,t))return!0;if(++n>=i)break;r=u[e=e+1&c]}return!1},values:function(){for(var t=[],e=0,r=u.length;e<r;++e){var n=u[e];n!=s&&t.push(n)}return t}}}(1.4*g,Uo,Bo);for(r=0,n=u.length;r<n;++r)m[S=h[r]]&&E.add(u[S]);return E}(t),c=t.coordinates,l=t.lines,h=t.rings;for(r=0,n=l.length;r<n;++r)for(var p=l[r],f=p[0],d=p[1];++f<d;)u.has(c[f])&&(e={0:f,1:p[1]},p[1]=f,p=p.next=e);for(r=0,n=h.length;r<n;++r)for(var m=h[r],g=m[0],y=g,v=m[1],_=u.has(c[g]);++y<v;)u.has(c[y])&&(_?(e={0:y,1:m[1]},m[1]=y,m=m.next=e):(s=(a=v)-y,Ut(i=c,o=g,a),Ut(i,o,o+s),Ut(i,o+s,a),c[v]=c[g],_=!0,y=g));return t}function Go(t){function e(t){var e,r,n,i,o,a,s,u;if(n=f.get(e=h[t[0]]))for(s=0,u=n.length;s<u;++s)if(function(t,e){var r=t[0],n=e[0],i=t[1];if(r-i!=n-e[1])return!1;for(;r<=i;++r,++n)if(!Bo(h[r],h[n]))return!1;return!0}(i=n[s],t))return t[0]=i[0],void(t[1]=i[1]);if(o=f.get(r=h[t[1]]))for(s=0,u=o.length;s<u;++s)if(function(t,e){var r=t[0],n=e[0],i=t[1],o=e[1];if(r-i!=n-o)return!1;for(;r<=i;++r,--o)if(!Bo(h[r],h[o]))return!1;return!0}(a=o[s],t))return t[1]=a[0],void(t[0]=a[1]);n?n.push(t):f.set(e,[t]),o?o.push(t):f.set(r,[t]),d.push(t)}function a(t,e){var r=t[0],n=e[0],i=t[1]-r;if(i!=e[1]-n)return!1;for(var o=l(t),a=l(e),s=0;s<i;++s)if(!Bo(h[r+(s+o)%i],h[n+(s+a)%i]))return!1;return!0}function s(t,e){var r=t[0],n=e[0],i=t[1],o=e[1],a=i-r;if(a!=o-n)return!1;for(var s=l(t),u=a-l(e),c=0;c<a;++c)if(!Bo(h[r+(c+s)%a],h[o-(c+u)%a]))return!1;return!0}function l(t){for(var e=t[0],r=t[1],n=e,i=n,o=h[n];++n<r;){var a=h[n];(a[0]<o[0]||a[0]===o[0]&&a[1]<o[1])&&(i=n,o=a)}return i-e}var r,n,i,o,h=t.coordinates,u=t.lines,c=t.rings,p=u.length+c.length;for(delete t.lines,delete t.rings,i=0,o=u.length;i<o;++i)for(r=u[i];r=r.next;)++p;for(i=0,o=c.length;i<o;++i)for(n=c[i];n=n.next;)++p;var f=Fo(2*p*1.4,Uo,Bo),d=t.arcs=[];for(i=0,o=u.length;i<o;++i)for(r=u[i];e(r),r=r.next;);for(i=0,o=c.length;i<o;++i)if((n=c[i]).next)for(;e(n),n=n.next;);else!function(t){var e,r,n,i,o;if(r=f.get(h[t[0]]))for(i=0,o=r.length;i<o;++i){if(a(n=r[i],t))return t[0]=n[0],t[1]=n[1];if(s(n,t))return t[0]=n[1],t[1]=n[0]}if(r=f.get(e=h[t[0]+l(t)]))for(i=0,o=r.length;i<o;++i){if(a(n=r[i],t))return t[0]=n[0],t[1]=n[1];if(s(n,t))return t[0]=n[1],t[1]=n[0]}r?r.push(t):f.set(e,[t]),d.push(t)}(n);return t}function qo(t){this.points=t.points||[],this.duration=t.duration||1e4,this.sharpness=t.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=t.stepLength||60,this.length=this.points.length;for(var e=this.delay=0;e<this.length;e++)this.points[e].z=this.points[e].z||0;for(e=0;e<this.length-1;e++){var r=this.points[e],n=this.points[e+1];this.centers.push({x:(r.x+n.x)/2,y:(r.y+n.y)/2,z:(r.z+n.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),e=0;e<this.centers.length-1;e++){r=this.centers[e],n=this.centers[e+1];var i=this.points[e+1].x-(this.centers[e].x+this.centers[e+1].x)/2,o=this.points[e+1].y-(this.centers[e].y+this.centers[e+1].y)/2,a=this.points[e+1].z-(this.centers[e].y+this.centers[e+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e].z+a)},{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e+1].x+i),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e+1].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e+1].z+a)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}var Ho=function(t){if(null==t)return zo;var o,a,s=t.scale[0],u=t.scale[1],c=t.translate[0],l=t.translate[1];return function(t,e){e||(o=a=0);var r=2,n=t.length,i=new Array(n);for(i[0]=(o+=t[0])*s+c,i[1]=(a+=t[1])*u+l;r<n;)i[r]=t[r],++r;return i}},$o=function(t,e){for(var r,n=t.length,i=n-e;i<--n;)r=t[i],t[i++]=t[n],t[n]=r},Wo=new ArrayBuffer(16),Xo=new Float64Array(Wo),Yo=new Uint32Array(Wo);qo.prototype.cacheSteps=function(t){var e=[],r=this.pos(0);e.push(0);for(var n=0;n<this.duration;n+=10){var i=this.pos(n);Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y)+(i.z-r.z)*(i.z-r.z))>t&&(e.push(n),r=i)}return e},qo.prototype.vector=function(t){var e=this.pos(t+10),r=this.pos(t-10);return{angle:180*Math.atan2(e.y-r.y,e.x-r.x)/3.14,speed:Math.sqrt((r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y)+(r.z-e.z)*(r.z-e.z))}},qo.prototype.pos=function(t){var e=t-this.delay;e<0&&(e=0),e>this.duration&&(e=this.duration-1);var r=e/this.duration;if(1<=r)return this.points[this.length-1];var n,i,o,a,s,u,c,l=Math.floor((this.points.length-1)*r);return n=(this.length-1)*r-l,i=this.points[l],o=this.controls[l][1],a=this.controls[l+1][0],s=this.points[l+1],c=[(u=n*n)*n,3*u*(1-n),3*n*(1-n)*(1-n),(1-n)*(1-n)*(1-n)],{x:s.x*c[0]+a.x*c[1]+o.x*c[2]+i.x*c[3],y:s.y*c[0]+a.y*c[1]+o.y*c[2]+i.y*c[3],z:s.z*c[0]+a.z*c[1]+o.z*c[2]+i.z*c[3]}};var Zo=he,Ko=he;he.deviation=function(t,e,r,n){var i=e&&e.length,o=i?e[0]*r:t.length,a=Math.abs(Ce(t,0,o,r));if(i)for(var s=0,u=e.length;s<u;s++){var c=e[s]*r,l=s<u-1?e[s+1]*r:t.length;a-=Math.abs(Ce(t,c,l,r))}var h=0;for(s=0;s<n.length;s+=3){var p=n[s]*r,f=n[s+1]*r,d=n[s+2]*r;h+=Math.abs((t[p]-t[d])*(t[1+f]-t[1+p])-(t[p]-t[f])*(t[1+d]-t[1+p]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},he.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);0<i&&(n+=t[i-1].length,r.holes.push(n))}return r},Zo.default=Ko,Ae.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],n=this.toBBox;if(!Fe(t,e))return r;for(var i,o,a,s,u=[];e;){for(i=0,o=e.children.length;i<o;i++)a=e.children[i],Fe(t,s=e.leaf?n(a):a)&&(e.leaf?r.push(a):ze(t,s)?this._all(a,r):u.push(a));e=u.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!Fe(t,e))return!1;for(var n,i,o,a,s=[];e;){for(n=0,i=e.children.length;n<i;n++)if(o=e.children[n],Fe(t,a=e.leaf?r(o):o)){if(e.leaf||ze(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=Be([]),this},remove:function(t,e){if(!t)return this;for(var r,n,i,o,a=this.data,s=this.toBBox(t),u=[],c=[];a||u.length;){if(a||(a=u.pop(),n=u[u.length-1],r=c.pop(),o=!0),a.leaf&&-1!==(i=function(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}(t,a.children,e)))return a.children.splice(i,1),u.push(a),this._condense(u),this;o||a.leaf||!ze(a,s)?n?(r++,a=n.children[r],o=!1):a=null:(u.push(a),c.push(r),r=0,a=(n=a).children[0])}return this},toBBox:function(t){return t},compareMinX:Ne,compareMinY:ke,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,n){var i,o=r-e+1,a=this._maxEntries;if(o<=a)return Ie(i=Be(t.slice(e,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),(i=Be([])).leaf=!1,i.height=n;var s,u,c,l,h=Math.ceil(o/a),p=h*Math.ceil(Math.sqrt(a));for(Ue(t,e,r,p,this.compareMinX),s=e;s<=r;s+=p)for(Ue(t,s,c=Math.min(s+p-1,r),h,this.compareMinY),u=s;u<=c;u+=h)l=Math.min(u+h-1,c),i.children.push(this._build(t,u,l,n-1));return Ie(i,this.toBBox),i},_chooseSubtree:function(t,e,r,n){for(var i,o,a,s,u,c,l,h;n.push(e),!e.leaf&&n.length-1!==r;){for(l=h=1/0,i=0,o=e.children.length;i<o;i++)u=De(a=e.children[i]),p=t,f=a,(c=(Math.max(f.maxX,p.maxX)-Math.min(f.minX,p.minX))*(Math.max(f.maxY,p.maxY)-Math.min(f.minY,p.minY))-u)<h?(h=c,l=u<l?u:l,s=a):c===h&&u<l&&(l=u,s=a);e=s||e.children[0]}var p,f;return e},_insert:function(t,e,r){var n=this.toBBox,i=r?t:n(t),o=[],a=this._chooseSubtree(i,this.data,e,o);for(a.children.push(t),Re(a,i);0<=e&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n),a=Be(r.children.splice(o,r.children.length-o));a.height=r.height,a.leaf=r.leaf,Ie(r,this.toBBox),Ie(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(r,a)},_splitRoot:function(t,e){this.data=Be([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Ie(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var n,i,o,a,s,u,c,l,h,p,f,d,m,g;for(u=c=1/0,n=e;n<=r-e;n++)h=i=Le(t,0,n,this.toBBox),p=o=Le(t,n,r,this.toBBox),void 0,f=Math.max(h.minX,p.minX),d=Math.max(h.minY,p.minY),m=Math.min(h.maxX,p.maxX),g=Math.min(h.maxY,p.maxY),a=Math.max(0,m-f)*Math.max(0,g-d),s=De(i)+De(o),a<u?(u=a,l=n,c=s<c?s:c):a===u&&s<c&&(c=s,l=n);return l},_chooseSplitAxis:function(t,e,r){var n=t.leaf?this.compareMinX:Ne,i=t.leaf?this.compareMinY:ke;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)},_allDistMargin:function(t,e,r,n){t.children.sort(n);var i,o,a=this.toBBox,s=Le(t,0,e,a),u=Le(t,r-e,r,a),c=je(s)+je(u);for(i=e;i<r-e;i++)o=t.children[i],Re(s,t.leaf?a(o):o),c+=je(s);for(i=r-e-1;e<=i;i--)o=t.children[i],Re(u,t.leaf?a(o):o),c+=je(u);return c},_adjustParentBBoxes:function(t,e,r){for(var n=r;0<=n;n--)Re(e[n],t)},_condense:function(t){for(var e,r=t.length-1;0<=r;r--)0===t[r].children.length?0<r?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():Ie(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};function Jo(t){function e(){for(var t=[],e=0;e<p.features.length;e++)-1==p.features[e].properties.parent&&t.push(e);if(1<t.length)for(e=0;e<t.length;e++){for(var r=-1,n=0;n<p.features.length;n++)t[e]!=n&&Pt(p.features[t[e]].geometry.coordinates[0][0],p.features[n],{ignoreBoundary:!0})&&sr(p.features[n])<1/0&&(r=n);p.features[t[e]].properties.parent=r}}function r(){for(var t=0;t<p.features.length;t++)if(-1==p.features[t].properties.parent){var e=p.features[t].properties.winding;i(t,p.features[t].properties.netWinding=e)}}function i(t,e){for(var r=0;r<p.features.length;r++)if(p.features[r].properties.parent==t){var n=e+p.features[r].properties.winding;i(r,p.features[r].properties.netWinding=n)}}if("Feature"!=t.type)throw new Error("The input must a geojson object of type Feature");if(void 0===t.geometry||null==t.geometry)throw new Error("The input must a geojson object with a non-empty geometry");if("Polygon"!=t.geometry.type)throw new Error("The input must be a geojson Polygon");for(var n=t.geometry.coordinates.length,o=[],a=0;a<n;a++){var s=t.geometry.coordinates[a];xr(s[0],s[s.length-1])||s.push(s[0]),o.push.apply(o,s.slice(0,s.length-1))}if(!function(t){for(var e={},r=1,n=0,i=t.length;n<i;++n){if(e.hasOwnProperty(t[n])){r=0;break}e[t[n]]=1}return r}(o))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var u=o.length,c=function(t,f,e){function n(t,e,r,n){var i,o,a=d[t][e],s=d[t][e+1],u=d[r][n],c=d[r][n+1],l=function(t,e,r,n){if(_r(t,r)||_r(t,n)||_r(e,r)||_r(n,r))return null;var i=t[0],o=t[1],a=e[0],s=e[1],u=r[0],c=r[1],l=n[0],h=n[1],p=(i-a)*(c-h)-(o-s)*(u-l);return 0==p?null:[((i*s-o*a)*(u-l)-(i-a)*(u*h-c*l))/p,((i*s-o*a)*(c-h)-(o-s)*(u*h-c*l))/p]}(a,s,u,c);if(null!==l&&(i=s[0]!==a[0]?(l[0]-a[0])/(s[0]-a[0]):(l[1]-a[1])/(s[1]-a[1]),o=c[0]!==u[0]?(l[0]-u[0])/(c[0]-u[0]):(l[1]-u[1])/(c[1]-u[1]),!(1<=i||i<=0||1<=o||o<=0))){var h=l,p=!g[h];p&&(g[h]=!0),f?m.push(f(l,t,e,a,s,i,r,n,u,c,o,p)):m.push(l)}}function r(t,e){var r,n,i,o,a=d[t][e],s=d[t][e+1];return n=a[0]<s[0]?(r=a[0],s[0]):(r=s[0],a[0]),o=a[1]<s[1]?(i=a[1],s[1]):(i=s[1],a[1]),{minX:r,minY:i,maxX:n,maxY:o,ring:t,edge:e}}if("Polygon"!==t.geometry.type)throw new Error("The input feature must be a Polygon");void 0===e&&(e=1);var d=t.geometry.coordinates,m=[],g={};if(e){for(var i=[],o=0;o<d.length;o++)for(var a=0;a<d[o].length-1;a++)i.push(r(o,a));var s=Eo();s.load(i)}for(var u=0;u<d.length;u++)for(var c=0;c<d[u].length-1;c++)if(e)s.search(r(u,c)).forEach(function(t){var e=t.ring,r=t.edge;n(u,c,e,r)});else for(var l=0;l<d.length;l++)for(var h=0;h<d[l].length-1;h++)n(u,c,l,h);return f||(m={type:"Feature",geometry:{type:"MultiPoint",coordinates:m}}),m}(t,function(t,e,r,n,i,o,a,s,u,c,l,h){return[t,e,r,n,i,o,a,s,u,c,l,h]}),l=c.length;if(0==l){var h=[];for(a=0;a<n;a++)h.push(U([t.geometry.coordinates[a]],{parent:-1,winding:function(t){for(var e=0,r=0;r<t.length-1;r++)t[r][0]<t[e][0]&&(e=r);if(br([t[(e-1).modulo(t.length-1)],t[e],t[(e+1).modulo(t.length-1)]],!0))var n=1;else n=-1;return n}(t.geometry.coordinates[a])}));var p=G(h);return e(),r(),p}var f=[],d=[];for(a=0;a<n;a++){f.push([]);for(var m=0;m<t.geometry.coordinates[a].length-1;m++)f[a].push([new ea(t.geometry.coordinates[a][(m+1).modulo(t.geometry.coordinates[a].length-1)],1,[a,m],[a,(m+1).modulo(t.geometry.coordinates[a].length-1)],void 0)]),d.push(new ra(t.geometry.coordinates[a][m],[a,(m-1).modulo(t.geometry.coordinates[a].length-1)],[a,m],void 0,void 0,!1,!0))}for(a=0;a<l;a++)f[c[a][1]][c[a][2]].push(new ea(c[a][0],c[a][5],[c[a][1],c[a][2]],[c[a][6],c[a][7]],void 0)),c[a][11]&&d.push(new ra(c[a][0],[c[a][1],c[a][2]],[c[a][6],c[a][7]],void 0,void 0,!0,!0));var g=d.length;for(a=0;a<f.length;a++)for(m=0;m<f[a].length;m++)f[a][m].sort(function(t,e){return t.param<e.param?-1:1});var y=[];for(a=0;a<g;a++)y.push({minX:d[a].coord[0],minY:d[a].coord[1],maxX:d[a].coord[0],maxY:d[a].coord[1],index:a});var v=Eo();for(v.load(y),a=0;a<f.length;a++)for(m=0;m<f[a].length;m++)for(var _=0;_<f[a][m].length;_++){x=_==f[a][m].length-1?f[a][(m+1).modulo(t.geometry.coordinates[a].length-1)][0].coord:f[a][m][_+1].coord;var b=v.search({minX:x[0],minY:x[1],maxX:x[0],maxY:x[1]})[0];f[a][m][_].nxtIsectAlongEdgeIn=b.index}for(a=0;a<f.length;a++)for(m=0;m<f[a].length;m++)for(_=0;_<f[a][m].length;_++){var x=f[a][m][_].coord,w=(b=v.search({minX:x[0],minY:x[1],maxX:x[0],maxY:x[1]})[0]).index;w<u?d[w].nxtIsectAlongRingAndEdge2=f[a][m][_].nxtIsectAlongEdgeIn:xr(d[w].ringAndEdge1,f[a][m][_].ringAndEdgeIn)?d[w].nxtIsectAlongRingAndEdge1=f[a][m][_].nxtIsectAlongEdgeIn:d[w].nxtIsectAlongRingAndEdge2=f[a][m][_].nxtIsectAlongEdgeIn}var S=[];for(m=a=0;m<n;m++){var E=a;for(_=0;_<t.geometry.coordinates[m].length-1;_++)d[a].coord[0]<d[E].coord[0]&&(E=a),a++;var C=d[E].nxtIsectAlongRingAndEdge2;for(_=0;_<d.length;_++)if(d[_].nxtIsectAlongRingAndEdge1==E||d[_].nxtIsectAlongRingAndEdge2==E){var M=_;break}var T=br([d[M].coord,d[E].coord,d[C].coord],!0)?1:-1;S.push({isect:E,parent:-1,winding:T})}for(S.sort(function(t,e){return d[t.isect].coord>d[e.isect].coord?-1:1}),h=[];0<S.length;){var P=S.pop(),O=P.isect,A=P.parent,I=P.winding,L=h.length,R=[d[O].coord],N=O;if(d[O].ringAndEdge1Walkable)var k=d[O].ringAndEdge1,D=d[O].nxtIsectAlongRingAndEdge1;else k=d[O].ringAndEdge2,D=d[O].nxtIsectAlongRingAndEdge2;for(;!xr(d[O].coord,d[D].coord);){R.push(d[D].coord);var j=void 0;for(a=0;a<S.length;a++)if(S[a].isect==D){j=a;break}if(null!=j&&S.splice(j,1),xr(k,d[D].ringAndEdge1)){if(k=d[D].ringAndEdge2,d[D].ringAndEdge2Walkable=!1,d[D].ringAndEdge1Walkable){var z={isect:D};br([d[N].coord,d[D].coord,d[d[D].nxtIsectAlongRingAndEdge2].coord],1==I)?(z.parent=A,z.winding=-I):(z.parent=L,z.winding=I),S.push(z)}D=d[N=D].nxtIsectAlongRingAndEdge2}else k=d[D].ringAndEdge1,d[D].ringAndEdge1Walkable=!1,d[D].ringAndEdge2Walkable&&(z={isect:D},br([d[N].coord,d[D].coord,d[d[D].nxtIsectAlongRingAndEdge1].coord],1==I)?(z.parent=A,z.winding=-I):(z.parent=L,z.winding=I),S.push(z)),D=d[N=D].nxtIsectAlongRingAndEdge1}R.push(d[D].coord),h.push(U([R],{index:L,parent:A,winding:I,netWinding:void 0}))}return p=G(h),e(),r(),p}var Qo=Object.freeze({toMercator:Je,toWgs84:Qe}),ta=6378137,ea=function(t,e,r,n,i){this.coord=t,this.param=e,this.ringAndEdgeIn=r,this.ringAndEdgeOut=n,this.nxtIsectAlongEdgeIn=i},ra=function(t,e,r,n,i,o,a){this.coord=t,this.ringAndEdge1=e,this.ringAndEdge2=r,this.nxtIsectAlongRingAndEdge1=n,this.nxtIsectAlongRingAndEdge2=i,this.ringAndEdge1Walkable=o,this.ringAndEdge2Walkable=a};Number.prototype.modulo=function(t){return(this%t+t)%t};function na(t,e){this.lon=t,this.lat=e,this.x=ia*t,this.y=ia*e}var ia=Math.PI/180,oa=180/Math.PI;na.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},na.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:-1*(180-this.lon);return new na(e,t)};function aa(){this.coords=[],this.length=0}aa.prototype.move_to=function(t){this.length++,this.coords.push(t)};function sa(t){this.properties=t||{},this.geometries=[]}sa.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},sa.prototype.wkt=function(){for(var t="",e="LINESTRING(",r=function(t){e+=t[0]+" "+t[1]+","},n=0;n<this.geometries.length;n++){if(0===this.geometries[n].coords.length)return"LINESTRING(empty)";this.geometries[n].coords.forEach(r),t+=e.substring(0,e.length-1)+")"}return t};function ua(t,e,r){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new na(t.x,t.y),this.end=new na(e.x,e.y),this.properties=r||{};var n=this.start.x-this.end.x,i=this.start.y-this.end.y,o=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(n/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g===Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)}ua.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),r=Math.sin(t*this.g)/Math.sin(this.g),n=e*Math.cos(this.start.y)*Math.cos(this.start.x)+r*Math.cos(this.end.y)*Math.cos(this.end.x),i=e*Math.cos(this.start.y)*Math.sin(this.start.x)+r*Math.cos(this.end.y)*Math.sin(this.end.x),o=e*Math.sin(this.start.y)+r*Math.sin(this.end.y),a=oa*Math.atan2(o,Math.sqrt(Math.pow(n,2)+Math.pow(i,2)));return[oa*Math.atan2(i,n),a]},ua.prototype.Arc=function(t,e){var r=[];if(!t||t<=2)r.push([this.start.lon,this.start.lat]),r.push([this.end.lon,this.end.lat]);else for(var n=1/(t-1),i=0;i<t;++i){var o=n*i,a=this.interpolate(o);r.push(a)}for(var s=!1,u=0,c=e&&e.offset?e.offset:10,l=180-c,h=-180+c,p=360-c,f=1;f<r.length;++f){var d=r[f-1][0],m=r[f][0],g=Math.abs(m-d);p<g&&(l<m&&d<h||l<d&&m<h)?s=!0:u<g&&(u=g)}var y=[];if(s&&u<c){var v=[];y.push(v);for(var _=0;_<r.length;++_){var b=parseFloat(r[_][0]);if(0<_&&Math.abs(b-r[_-1][0])>p){var x=parseFloat(r[_-1][0]),w=parseFloat(r[_-1][1]),S=parseFloat(r[_][0]),E=parseFloat(r[_][1]);if(-180<x&&x<h&&180===S&&_+1<r.length&&-180<r[_-1][0]&&r[_-1][0]<h){v.push([-180,r[_][1]]),_++,v.push([r[_][0],r[_][1]]);continue}if(l<x&&x<180&&-180===S&&_+1<r.length&&r[_-1][0]>l&&r[_-1][0]<180){v.push([180,r[_][1]]),_++,v.push([r[_][0],r[_][1]]);continue}if(x<h&&l<S){var C=x;x=S,S=C;var M=w;w=E,E=M}if(l<x&&S<h&&(S+=360),x<=180&&180<=S&&x<S){var T=(180-x)/(S-x),P=T*E+(1-T)*w;v.push([r[_-1][0]>l?180:-180,P]),(v=[]).push([r[_-1][0]>l?-180:180,P]),y.push(v)}else v=[],y.push(v);v.push([b,r[_][1]])}else v.push([r[_][0],r[_][1]])}}else{var O=[];y.push(O);for(var A=0;A<r.length;++A)O.push([r[A][0],r[A][1]])}for(var I=new sa(this.properties),L=0;L<y.length;++L){var R=new aa;I.geometries.push(R);for(var N=y[L],k=0;k<N.length;++k)R.move_to(N[k])}return I};var ca=Rr;(Rr.polyline=Rr).polygon=function(t,e){var r,n,i,o,a,s,u;for(n=1;n<=8;n*=2){for(r=[],o=!(kr(i=t[t.length-1],e)&n),a=0;a<t.length;a++)(u=!(kr(s=t[a],e)&n))!==o&&r.push(Nr(i,s,n,e)),u&&r.push(s),i=s,o=u;if(!(t=r).length)break}return r};var la=Array.prototype.slice,ha={successCallback:null,verbose:!1,polygons:!1},pa={},fa=64,da=16,ma=4,ga=1,ya=[],va=[],_a=[],ba=[],xa=[],wa=[],Sa=[],Ea=[],Ca=[],Ma=[],Ta=[],Pa=[],Oa=[],Aa=[],Ia=[],La=[],Ra=[],Na=[],ka=[],Da=[],ja=[],za=[],Fa=[],Ba=[];Sa[85]=Ma[85]=-1,Ea[85]=Ta[85]=0,Ca[85]=Pa[85]=1,ka[85]=za[85]=1,Da[85]=Fa[85]=0,ja[85]=Ba[85]=1,ya[85]=ba[85]=0,va[85]=xa[85]=-1,_a[85]=Ia[85]=0,La[85]=Oa[85]=0,Ra[85]=Aa[85]=1,wa[85]=Na[85]=1,za[1]=za[169]=0,Fa[1]=Fa[169]=-1,Ba[1]=Ba[169]=0,Oa[1]=Oa[169]=-1,Aa[1]=Aa[169]=0,Ia[1]=Ia[169]=0,Ma[4]=Ma[166]=0,Ta[4]=Ta[166]=-1,Pa[4]=Pa[166]=1,La[4]=La[166]=1,Ra[4]=Ra[166]=0,Na[4]=Na[166]=0,Sa[16]=Sa[154]=0,Ea[16]=Ea[154]=1,Ca[16]=Ca[154]=1,ba[16]=ba[154]=1,xa[16]=xa[154]=0,wa[16]=wa[154]=1,ka[64]=ka[106]=0,Da[64]=Da[106]=1,ja[64]=ja[106]=0,ya[64]=ya[106]=-1,va[64]=va[106]=0,_a[64]=_a[106]=1,ka[2]=ka[168]=0,Da[2]=Da[168]=-1,ja[2]=ja[168]=1,za[2]=za[168]=0,Fa[2]=Fa[168]=-1,Ba[2]=Ba[168]=0,Oa[2]=Oa[168]=-1,Aa[2]=Aa[168]=0,Ia[2]=Ia[168]=0,La[2]=La[168]=-1,Ra[2]=Ra[168]=0,Na[2]=Na[168]=1,Sa[8]=Sa[162]=0,Ea[8]=Ea[162]=-1,Ca[8]=Ca[162]=0,Ma[8]=Ma[162]=0,Ta[8]=Ta[162]=-1,Pa[8]=Pa[162]=1,Oa[8]=Oa[162]=1,Aa[8]=Aa[162]=0,Ia[8]=Ia[162]=1,La[8]=La[162]=1,Ra[8]=Ra[162]=0,Na[8]=Na[162]=0,Sa[32]=Sa[138]=0,Ea[32]=Ea[138]=1,Ca[32]=Ca[138]=1,Ma[32]=Ma[138]=0,Ta[32]=Ta[138]=1,Pa[32]=Pa[138]=0,ya[32]=ya[138]=1,va[32]=va[138]=0,_a[32]=_a[138]=0,ba[32]=ba[138]=1,xa[32]=xa[138]=0,wa[32]=wa[138]=1,za[128]=za[42]=0,Fa[128]=Fa[42]=1,Ba[128]=Ba[42]=1,ka[128]=ka[42]=0,Da[128]=Da[42]=1,ja[128]=ja[42]=0,ya[128]=ya[42]=-1,va[128]=va[42]=0,_a[128]=_a[42]=1,ba[128]=ba[42]=-1,xa[128]=xa[42]=0,wa[128]=wa[42]=0,Ma[5]=Ma[165]=-1,Ta[5]=Ta[165]=0,Pa[5]=Pa[165]=0,za[5]=za[165]=1,Fa[5]=Fa[165]=0,Ba[5]=Ba[165]=0,La[20]=La[150]=0,Ra[20]=Ra[150]=1,Na[20]=Na[150]=1,ba[20]=ba[150]=0,xa[20]=xa[150]=-1,wa[20]=wa[150]=1,Sa[80]=Sa[90]=-1,Ea[80]=Ea[90]=0,Ca[80]=Ca[90]=1,ka[80]=ka[90]=1,Da[80]=Da[90]=0,ja[80]=ja[90]=1,Oa[65]=Oa[105]=0,Aa[65]=Aa[105]=1,Ia[65]=Ia[105]=0,ya[65]=ya[105]=0,va[65]=va[105]=-1,_a[65]=_a[105]=0,Sa[160]=Sa[10]=-1,Ea[160]=Ea[10]=0,Ca[160]=Ca[10]=1,Ma[160]=Ma[10]=-1,Ta[160]=Ta[10]=0,Pa[160]=Pa[10]=0,za[160]=za[10]=1,Fa[160]=Fa[10]=0,Ba[160]=Ba[10]=0,ka[160]=ka[10]=1,Da[160]=Da[10]=0,ja[160]=ja[10]=1,La[130]=La[40]=0,Ra[130]=Ra[40]=1,Na[130]=Na[40]=1,Oa[130]=Oa[40]=0,Aa[130]=Aa[40]=1,Ia[130]=Ia[40]=0,ya[130]=ya[40]=0,va[130]=va[40]=-1,_a[130]=_a[40]=0,ba[130]=ba[40]=0,xa[130]=xa[40]=-1,wa[130]=wa[40]=1,Ma[37]=Ma[133]=0,Ta[37]=Ta[133]=1,Pa[37]=Pa[133]=1,za[37]=za[133]=0,Fa[37]=Fa[133]=1,Ba[37]=Ba[133]=0,ya[37]=ya[133]=-1,va[37]=va[133]=0,_a[37]=_a[133]=0,ba[37]=ba[133]=1,xa[37]=xa[133]=0,wa[37]=wa[133]=0,La[148]=La[22]=-1,Ra[148]=Ra[22]=0,Na[148]=Na[22]=0,za[148]=za[22]=0,Fa[148]=Fa[22]=-1,Ba[148]=Ba[22]=1,ka[148]=ka[22]=0,Da[148]=Da[22]=1,ja[148]=ja[22]=1,ba[148]=ba[22]=-1,xa[148]=xa[22]=0,wa[148]=wa[22]=1,Sa[82]=Sa[88]=0,Ea[82]=Ea[88]=-1,Ca[82]=Ca[88]=1,La[82]=La[88]=1,Ra[82]=Ra[88]=0,Na[82]=Na[88]=1,Oa[82]=Oa[88]=-1,Aa[82]=Aa[88]=0,Ia[82]=Ia[88]=1,ka[82]=ka[88]=0,Da[82]=Da[88]=-1,ja[82]=ja[88]=0,Sa[73]=Sa[97]=0,Ea[73]=Ea[97]=1,Ca[73]=Ca[97]=0,Ma[73]=Ma[97]=0,Ta[73]=Ta[97]=-1,Pa[73]=Pa[97]=0,Oa[73]=Oa[97]=1,Aa[73]=Aa[97]=0,Ia[73]=Ia[97]=0,ya[73]=ya[97]=1,va[73]=va[97]=0,_a[73]=_a[97]=1,Sa[145]=Sa[25]=0,Ea[145]=Ea[25]=-1,Ca[145]=Ca[25]=0,Oa[145]=Oa[25]=1,Aa[145]=Aa[25]=0,Ia[145]=Ia[25]=1,za[145]=za[25]=0,Fa[145]=Fa[25]=1,Ba[145]=Ba[25]=1,ba[145]=ba[25]=-1,xa[145]=xa[25]=0,wa[145]=wa[25]=0,Ma[70]=Ma[100]=0,Ta[70]=Ta[100]=1,Pa[70]=Pa[100]=0,La[70]=La[100]=-1,Ra[70]=Ra[100]=0,Na[70]=Na[100]=1,ka[70]=ka[100]=0,Da[70]=Da[100]=-1,ja[70]=ja[100]=1,ya[70]=ya[100]=1,va[70]=va[100]=0,_a[70]=_a[100]=0,Ma[101]=Ma[69]=0,Ta[101]=Ta[69]=1,Pa[101]=Pa[69]=0,ya[101]=ya[69]=1,va[101]=va[69]=0,_a[101]=_a[69]=0,za[149]=za[21]=0,Fa[149]=Fa[21]=1,Ba[149]=Ba[21]=1,ba[149]=ba[21]=-1,xa[149]=xa[21]=0,wa[149]=wa[21]=0,La[86]=La[84]=-1,Ra[86]=Ra[84]=0,Na[86]=Na[84]=1,ka[86]=ka[84]=0,Da[86]=Da[84]=-1,ja[86]=ja[84]=1,Sa[89]=Sa[81]=0,Ea[89]=Ea[81]=-1,Ca[89]=Ca[81]=0,Oa[89]=Oa[81]=1,Aa[89]=Aa[81]=0,Ia[89]=Ia[81]=1,Sa[96]=Sa[74]=0,Ea[96]=Ea[74]=1,Ca[96]=Ca[74]=0,Ma[96]=Ma[74]=-1,Ta[96]=Ta[74]=0,Pa[96]=Pa[74]=1,ka[96]=ka[74]=1,Da[96]=Da[74]=0,ja[96]=ja[74]=0,ya[96]=ya[74]=1,va[96]=va[74]=0,_a[96]=_a[74]=1,Sa[24]=Sa[146]=0,Ea[24]=Ea[146]=-1,Ca[24]=Ca[146]=1,La[24]=La[146]=1,Ra[24]=Ra[146]=0,Na[24]=Na[146]=1,Oa[24]=Oa[146]=0,Aa[24]=Aa[146]=1,Ia[24]=Ia[146]=1,ba[24]=ba[146]=0,xa[24]=xa[146]=-1,wa[24]=wa[146]=0,Ma[6]=Ma[164]=-1,Ta[6]=Ta[164]=0,Pa[6]=Pa[164]=1,La[6]=La[164]=-1,Ra[6]=Ra[164]=0,Na[6]=Na[164]=0,za[6]=za[164]=0,Fa[6]=Fa[164]=-1,Ba[6]=Ba[164]=1,ka[6]=ka[164]=1,Da[6]=Da[164]=0,ja[6]=ja[164]=0,Oa[129]=Oa[41]=0,Aa[129]=Aa[41]=1,Ia[129]=Ia[41]=1,za[129]=za[41]=0,Fa[129]=Fa[41]=1,Ba[129]=Ba[41]=0,ya[129]=ya[41]=-1,va[129]=va[41]=0,_a[129]=_a[41]=0,ba[129]=ba[41]=0,xa[129]=xa[41]=-1,wa[129]=wa[41]=0,La[66]=La[104]=0,Ra[66]=Ra[104]=1,Na[66]=Na[104]=0,Oa[66]=Oa[104]=-1,Aa[66]=Aa[104]=0,Ia[66]=Ia[104]=1,ka[66]=ka[104]=0,Da[66]=Da[104]=-1,ja[66]=ja[104]=0,ya[66]=ya[104]=0,va[66]=va[104]=-1,_a[66]=_a[104]=1,Sa[144]=Sa[26]=-1,Ea[144]=Ea[26]=0,Ca[144]=Ca[26]=0,za[144]=za[26]=1,Fa[144]=Fa[26]=0,Ba[144]=Ba[26]=1,ka[144]=ka[26]=0,Da[144]=Da[26]=1,ja[144]=ja[26]=1,ba[144]=ba[26]=-1,xa[144]=xa[26]=0,wa[144]=wa[26]=1,Ma[36]=Ma[134]=0,Ta[36]=Ta[134]=1,Pa[36]=Pa[134]=1,La[36]=La[134]=0,Ra[36]=Ra[134]=1,Na[36]=Na[134]=0,ya[36]=ya[134]=0,va[36]=va[134]=-1,_a[36]=_a[134]=1,ba[36]=ba[134]=1,xa[36]=xa[134]=0,wa[36]=wa[134]=0,Sa[9]=Sa[161]=-1,Ea[9]=Ea[161]=0,Ca[9]=Ca[161]=0,Ma[9]=Ma[161]=0,Ta[9]=Ta[161]=-1,Pa[9]=Pa[161]=0,Oa[9]=Oa[161]=1,Aa[9]=Aa[161]=0,Ia[9]=Ia[161]=0,za[9]=za[161]=1,Fa[9]=Fa[161]=0,Ba[9]=Ba[161]=1,Sa[136]=0,Ea[136]=1,Ca[136]=1,Ma[136]=0,Ta[136]=1,Pa[136]=0,La[136]=-1,Ra[136]=0,Na[136]=1,Oa[136]=-1,Aa[136]=0,Ia[136]=0,za[136]=0,Fa[136]=-1,Ba[136]=0,ka[136]=0,Da[136]=-1,ja[136]=1,ya[136]=1,va[136]=0,_a[136]=0,ba[136]=1,xa[136]=0,wa[136]=1,Sa[34]=0,Ea[34]=-1,Ca[34]=0,Ma[34]=0,Ta[34]=-1,Pa[34]=1,La[34]=1,Ra[34]=0,Na[34]=0,Oa[34]=1,Aa[34]=0,Ia[34]=1,za[34]=0,Fa[34]=1,Ba[34]=1,ka[34]=0,Da[34]=1,ja[34]=0,ya[34]=-1,va[34]=0,_a[34]=1,ba[34]=-1,xa[34]=0,wa[34]=0,Sa[35]=0,Ea[35]=1,Ca[35]=1,Ma[35]=0,Ta[35]=-1,Pa[35]=1,La[35]=1,Ra[35]=0,Na[35]=0,Oa[35]=-1,Aa[35]=0,Ia[35]=0,za[35]=0,Fa[35]=-1,Ba[35]=0,ka[35]=0,Da[35]=1,ja[35]=0,ya[35]=-1,va[35]=0,_a[35]=1,ba[35]=1,xa[35]=0,wa[35]=1,Sa[153]=0,Ea[153]=1,Ca[153]=1,Oa[153]=-1,Aa[153]=0,Ia[153]=0,za[153]=0,Fa[153]=-1,Ba[153]=0,ba[153]=1,xa[153]=0,wa[153]=1,Ma[102]=0,Ta[102]=-1,Pa[102]=1,La[102]=1,Ra[102]=0,Na[102]=0,ka[102]=0,Da[102]=1,ja[102]=0,ya[102]=-1,va[102]=0,_a[102]=1,Sa[155]=0,Ea[155]=-1,Ca[155]=0,Oa[155]=1,Aa[155]=0,Ia[155]=1,za[155]=0,Fa[155]=1,Ba[155]=1,ba[155]=-1,xa[155]=0,wa[155]=0,Ma[103]=0,Ta[103]=1,Pa[103]=0,La[103]=-1,Ra[103]=0,Na[103]=1,ka[103]=0,Da[103]=-1,ja[103]=1,ya[103]=1,va[103]=0,_a[103]=0,Sa[152]=0,Ea[152]=1,Ca[152]=1,La[152]=-1,Ra[152]=0,Na[152]=1,Oa[152]=-1,Aa[152]=0,Ia[152]=0,za[152]=0,Fa[152]=-1,Ba[152]=0,ka[152]=0,Da[152]=-1,ja[152]=1,ba[152]=1,xa[152]=0,wa[152]=1,Sa[156]=0,Ea[156]=-1,Ca[156]=1,La[156]=1,Ra[156]=0,Na[156]=1,Oa[156]=-1,Aa[156]=0,Ia[156]=0,za[156]=0,Fa[156]=-1,Ba[156]=0,ka[156]=0,Da[156]=1,ja[156]=1,ba[156]=-1,xa[156]=0,wa[156]=1,Sa[137]=0,Ea[137]=1,Ca[137]=1,Ma[137]=0,Ta[137]=1,Pa[137]=0,Oa[137]=-1,Aa[137]=0,Ia[137]=0,za[137]=0,Fa[137]=-1,Ba[137]=0,ya[137]=1,va[137]=0,_a[137]=0,ba[137]=1,xa[137]=0,wa[137]=1,Sa[139]=0,Ea[139]=1,Ca[139]=1,Ma[139]=0,Ta[139]=-1,Pa[139]=0,Oa[139]=1,Aa[139]=0,Ia[139]=0,za[139]=0,Fa[139]=1,Ba[139]=0,ya[139]=-1,va[139]=0,_a[139]=0,ba[139]=1,xa[139]=0,wa[139]=1,Sa[98]=0,Ea[98]=-1,Ca[98]=0,Ma[98]=0,Ta[98]=-1,Pa[98]=1,La[98]=1,Ra[98]=0,Na[98]=0,Oa[98]=1,Aa[98]=0,Ia[98]=1,ka[98]=0,Da[98]=1,ja[98]=0,ya[98]=-1,va[98]=0,_a[98]=1,Sa[99]=0,Ea[99]=1,Ca[99]=0,Ma[99]=0,Ta[99]=-1,Pa[99]=1,La[99]=1,Ra[99]=0,Na[99]=0,Oa[99]=-1,Aa[99]=0,Ia[99]=1,ka[99]=0,Da[99]=-1,ja[99]=0,ya[99]=1,va[99]=0,_a[99]=1,Ma[38]=0,Ta[38]=-1,Pa[38]=1,La[38]=1,Ra[38]=0,Na[38]=0,za[38]=0,Fa[38]=1,Ba[38]=1,ka[38]=0,Da[38]=1,ja[38]=0,ya[38]=-1,va[38]=0,_a[38]=1,ba[38]=-1,xa[38]=0,wa[38]=0,Ma[39]=0,Ta[39]=1,Pa[39]=1,La[39]=-1,Ra[39]=0,Na[39]=0,za[39]=0,Fa[39]=-1,Ba[39]=1,ka[39]=0,Da[39]=1,ja[39]=0,ya[39]=-1,va[39]=0,_a[39]=1,ba[39]=1,xa[39]=0,wa[39]=0;function Ua(t){return[[t.bottomleft,0],[0,0],[0,t.leftbottom]]}function Va(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0]]}function Ga(t){return[[t.topright,1],[1,1],[1,t.righttop]]}function qa(t){return[[0,t.lefttop],[0,1],[t.topleft,1]]}function Ha(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop]]}function $a(t){return[[t.bottomright,0],[t.bottomleft,0],[1,t.righttop],[1,t.rightbottom]]}function Wa(t){return[[1,t.righttop],[1,t.rightbottom],[t.topleft,1],[t.topright,1]]}function Xa(t){return[[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]}var Ya=[],Za=[],Ka=[],Ja=[],Qa=[],ts=[],es=[],rs=[];Ja[1]=Qa[1]=18,Ja[169]=Qa[169]=18,Ka[4]=Za[4]=12,Ka[166]=Za[166]=12,Ya[16]=rs[16]=4,Ya[154]=rs[154]=4,ts[64]=es[64]=22,ts[106]=es[106]=22,Ka[2]=ts[2]=17,Ja[2]=Qa[2]=18,Ka[168]=ts[168]=17,Ja[168]=Qa[168]=18,Ya[8]=Ja[8]=9,Za[8]=Ka[8]=12,Ya[162]=Ja[162]=9,Za[162]=Ka[162]=12,Ya[32]=rs[32]=4,Za[32]=es[32]=1,Ya[138]=rs[138]=4,Za[138]=es[138]=1,Qa[128]=rs[128]=21,ts[128]=es[128]=22,Qa[42]=rs[42]=21,ts[42]=es[42]=22,Za[5]=Qa[5]=14,Za[165]=Qa[165]=14,Ka[20]=rs[20]=6,Ka[150]=rs[150]=6,Ya[80]=ts[80]=11,Ya[90]=ts[90]=11,Ja[65]=es[65]=3,Ja[105]=es[105]=3,Ya[160]=ts[160]=11,Za[160]=Qa[160]=14,Ya[10]=ts[10]=11,Za[10]=Qa[10]=14,Ka[130]=rs[130]=6,Ja[130]=es[130]=3,Ka[40]=rs[40]=6,Ja[40]=es[40]=3,Za[101]=es[101]=1,Za[69]=es[69]=1,Qa[149]=rs[149]=21,Qa[21]=rs[21]=21,Ka[86]=ts[86]=17,Ka[84]=ts[84]=17,Ya[89]=Ja[89]=9,Ya[81]=Ja[81]=9,Ya[96]=es[96]=0,Za[96]=ts[96]=15,Ya[74]=es[74]=0,Za[74]=ts[74]=15,Ya[24]=Ka[24]=8,Ja[24]=rs[24]=7,Ya[146]=Ka[146]=8,Ja[146]=rs[146]=7,Za[6]=ts[6]=15,Ka[6]=Qa[6]=16,Za[164]=ts[164]=15,Ka[164]=Qa[164]=16,Ja[129]=rs[129]=7,Qa[129]=es[129]=20,Ja[41]=rs[41]=7,Qa[41]=es[41]=20,Ka[66]=es[66]=2,Ja[66]=ts[66]=19,Ka[104]=es[104]=2,Ja[104]=ts[104]=19,Ya[144]=Qa[144]=10,ts[144]=rs[144]=23,Ya[26]=Qa[26]=10,ts[26]=rs[26]=23,Za[36]=rs[36]=5,Ka[36]=es[36]=2,Za[134]=rs[134]=5,Ka[134]=es[134]=2,Ya[9]=Qa[9]=10,Za[9]=Ja[9]=13,Ya[161]=Qa[161]=10,Za[161]=Ja[161]=13,Za[37]=rs[37]=5,Qa[37]=es[37]=20,Za[133]=rs[133]=5,Qa[133]=es[133]=20,Ka[148]=Qa[148]=16,ts[148]=rs[148]=23,Ka[22]=Qa[22]=16,ts[22]=rs[22]=23,Ya[82]=Ka[82]=8,Ja[82]=ts[82]=19,Ya[88]=Ka[88]=8,Ja[88]=ts[88]=19,Ya[73]=es[73]=0,Za[73]=Ja[73]=13,Ya[97]=es[97]=0,Za[97]=Ja[97]=13,Ya[145]=Ja[145]=9,Qa[145]=rs[145]=21,Ya[25]=Ja[25]=9,Qa[25]=rs[25]=21,Za[70]=es[70]=1,Ka[70]=ts[70]=17,Za[100]=es[100]=1,Ka[100]=ts[100]=17,Ya[34]=Ja[34]=9,Za[34]=Ka[34]=12,Qa[34]=rs[34]=21,ts[34]=es[34]=22,Ya[136]=rs[136]=4,Za[136]=es[136]=1,Ka[136]=ts[136]=17,Ja[136]=Qa[136]=18,Ya[35]=rs[35]=4,Za[35]=Ka[35]=12,Ja[35]=Qa[35]=18,ts[35]=es[35]=22,Ya[153]=rs[153]=4,Ja[153]=Qa[153]=18,Za[102]=Ka[102]=12,ts[102]=es[102]=22,Ya[155]=Ja[155]=9,Qa[155]=rs[155]=23,Za[103]=es[103]=1,Ka[103]=ts[103]=17,Ya[152]=rs[152]=4,Ka[152]=ts[152]=17,Ja[152]=Qa[152]=18,Ya[156]=Ka[156]=8,Ja[156]=Qa[156]=18,ts[156]=rs[156]=23,Ya[137]=rs[137]=4,Za[137]=es[137]=1,Ja[137]=Qa[137]=18,Ya[139]=rs[139]=4,Za[139]=Ja[139]=13,Qa[139]=es[139]=20,Ya[98]=Ja[98]=9,Za[98]=Ka[98]=12,ts[98]=es[98]=22,Ya[99]=es[99]=0,Za[99]=Ka[99]=12,Ja[99]=ts[99]=19,Za[38]=Ka[38]=12,Qa[38]=rs[38]=21,ts[38]=es[38]=22,Za[39]=rs[39]=5,Ka[39]=Qa[39]=16,ts[39]=es[39]=22;var ns=[];ns[1]=ns[169]=Ua,ns[4]=ns[166]=Va,ns[16]=ns[154]=Ga,ns[64]=ns[106]=qa,ns[168]=ns[2]=Ha,ns[162]=ns[8]=$a,ns[138]=ns[32]=Wa,ns[42]=ns[128]=Xa,ns[5]=ns[165]=function(t){return[[0,0],[0,t.leftbottom],[1,t.rightbottom],[1,0]]},ns[20]=ns[150]=function(t){return[[1,0],[t.bottomright,0],[t.topright,1],[1,1]]},ns[80]=ns[90]=function(t){return[[1,1],[1,t.righttop],[0,t.lefttop],[0,1]]},ns[65]=ns[105]=function(t){return[[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},ns[160]=ns[10]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.leftbottom],[0,t.lefttop]]},ns[130]=ns[40]=function(t){return[[t.topleft,1],[t.topright,1],[t.bottomright,0],[t.bottomleft,0]]},ns[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},ns[101]=ns[69]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,1],[t.topleft,1]]},ns[149]=ns[21]=function(t){return[[t.topright,1],[1,1],[1,0],[0,0],[0,t.leftbottom]]},ns[86]=ns[84]=function(t){return[[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[1,1]]},ns[89]=ns[81]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,1]]},ns[96]=ns[74]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.lefttop],[0,1],[t.topleft,1]]},ns[24]=ns[146]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[t.topright,1]]},ns[6]=ns[164]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop]]},ns[129]=ns[41]=function(t){return[[t.topright,1],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1]]},ns[66]=ns[104]=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},ns[144]=ns[26]=function(t){return[[1,1],[1,t.righttop],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},ns[36]=ns[134]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[t.topleft,1],[t.topright,1]]},ns[9]=ns[161]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom]]},ns[37]=ns[133]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},ns[148]=ns[22]=function(t){return[[1,1],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},ns[82]=ns[88]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1]]},ns[73]=ns[97]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},ns[145]=ns[25]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},ns[70]=ns[100]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},ns[34]=function(t){return[Xa(t),$a(t)]},ns[35]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},ns[136]=function(t){return[Wa(t),Ha(t)]},ns[153]=function(t){return[Ga(t),Ua(t)]},ns[102]=function(t){return[Va(t),qa(t)]},ns[155]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},ns[103]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},ns[152]=function(t){return[Ga(t),Ha(t)]},ns[156]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},ns[137]=function(t){return[Wa(t),Ua(t)]},ns[139]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},ns[98]=function(t){return[$a(t),qa(t)]},ns[99]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},ns[38]=function(t){return[Va(t),Xa(t)]},ns[39]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]};function is(t){this.id=is.buildId(t),this.coordinates=t,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}is.buildId=function(t){return t.join(",")},is.prototype.removeInnerEdge=function(e){this.innerEdges=this.innerEdges.filter(function(t){return t.from.id!==e.from.id})},is.prototype.removeOuterEdge=function(e){this.outerEdges=this.outerEdges.filter(function(t){return t.to.id!==e.to.id})},is.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1},is.prototype.sortOuterEdges=function(){var o=this;this.outerEdgesSorted||(this.outerEdges.sort(function(t,e){var r=t.to,n=e.to;if(0<=r.coordinates[0]-o.coordinates[0]&&n.coordinates[0]-o.coordinates[0]<0)return 1;if(r.coordinates[0]-o.coordinates[0]<0&&0<=n.coordinates[0]-o.coordinates[0])return-1;if(r.coordinates[0]-o.coordinates[0]==0&&n.coordinates[0]-o.coordinates[0]==0)return 0<=r.coordinates[1]-o.coordinates[1]||0<=n.coordinates[1]-o.coordinates[1]?r.coordinates[1]-n.coordinates[1]:n.coordinates[1]-r.coordinates[1];var i=sn(o.coordinates,r.coordinates,n.coordinates);return i<0?1:0<i?-1:Math.pow(r.coordinates[0]-o.coordinates[0],2)+Math.pow(r.coordinates[1]-o.coordinates[1],2)-(Math.pow(n.coordinates[0]-o.coordinates[0],2)+Math.pow(n.coordinates[1]-o.coordinates[1],2))}),this.outerEdgesSorted=!0)},is.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},is.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]},is.prototype.addInnerEdge=function(t){this.innerEdges.push(t)};function os(t,e){this.from=t,this.to=e,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}os.prototype.getSymetric=function(){return this.symetric||(this.symetric=new os(this.to,this.from),this.symetric.symetric=this),this.symetric},os.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},os.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id},os.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},os.prototype.toLineString=function(){return V([this.from.coordinates,this.to.coordinates])},os.prototype.compareTo=function(t){return sn(t.from.coordinates,t.to.coordinates,this.to.coordinates)};function as(){this.edges=[],this.polygon=void 0,this.envelope=void 0}var ss={length:{configurable:!0}};as.prototype.push=function(t){this[this.edges.length]=t,this.edges.push(t),this.polygon=this.envelope=void 0},as.prototype.get=function(t){return this.edges[t]},ss.length.get=function(){return this.edges.length},as.prototype.forEach=function(t){this.edges.forEach(t)},as.prototype.map=function(t){return this.edges.map(t)},as.prototype.some=function(t){return this.edges.some(t)},as.prototype.isValid=function(){return!0},as.prototype.isHole=function(){var n=this,t=this.edges.reduce(function(t,e,r){return e.from.coordinates[1]>n.edges[t].from.coordinates[1]&&(t=r),t},0),e=(0===t?this.length:t)-1,r=(t+1)%this.length,i=sn(this.edges[e].from.coordinates,this.edges[t].from.coordinates,this.edges[r].from.coordinates);return 0===i?this.edges[e].from.coordinates[0]>this.edges[r].from.coordinates[0]:0<i},as.prototype.toMultiPoint=function(){return o(this.edges.map(function(t){return t.from.coordinates}))},as.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map(function(t){return t.from.coordinates});return t.push(this.edges[0].from.coordinates),this.polygon=U([t])},as.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=ne(this.toPolygon())},as.findEdgeRingContaining=function(c,t){var l,h,p=c.getEnvelope();return t.forEach(function(t){var e,r,n,i,o,a,s=t.getEnvelope();if(h&&(l=h.getEnvelope()),r=p,n=(e=s).geometry.coordinates.map(function(t){return t[0]}),i=e.geometry.coordinates.map(function(t){return t[1]}),o=r.geometry.coordinates.map(function(t){return t[0]}),a=r.geometry.coordinates.map(function(t){return t[1]}),(Math.max(null,n)!==Math.max(null,o)||Math.max(null,i)!==Math.max(null,a)||Math.min(null,n)!==Math.min(null,o)||Math.min(null,i)!==Math.min(null,a))&&un(s,p)){var u=c.map(function(t){return t.from.coordinates}).find(function(n){return!t.some(function(t){return e=n,r=t.from.coordinates,e[0]===r[0]&&e[1]===r[1];var e,r})});u&&t.inside(B(u))&&(h&&!un(l,s)||(h=t))}}),h},as.prototype.inside=function(t){return Pt(t,this.toPolygon())},Object.defineProperties(as.prototype,ss);function us(){this.edges=[],this.nodes={}}us.fromGeoJson=function(t){!function(t){if(!t)throw new Error("No geojson passed");if("FeatureCollection"!==t.type&&"GeometryCollection"!==t.type&&"MultiLineString"!==t.type&&"LineString"!==t.type&&"Feature"!==t.type)throw new Error("Invalid input type '"+t.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(t);var i=new us;return O(t,function(t){z(t,"LineString","Graph::fromGeoJson"),y(t,function(t,e){if(t){var r=i.getNode(t),n=i.getNode(e);i.addEdge(r,n)}return e})}),i},us.prototype.getNode=function(t){var e=is.buildId(t),r=this.nodes[e];return r=r||(this.nodes[e]=new is(t))},us.prototype.addEdge=function(t,e){var r=new os(t,e),n=r.getSymetric();this.edges.push(r),this.edges.push(n)},us.prototype.deleteDangles=function(){var e=this;Object.keys(this.nodes).map(function(t){return e.nodes[t]}).forEach(function(t){return e._removeIfDangle(t)})},us.prototype._removeIfDangle=function(t){var e=this;if(t.innerEdges.length<=1){var r=t.getOuterEdges().map(function(t){return t.to});this.removeNode(t),r.forEach(function(t){return e._removeIfDangle(t)})}},us.prototype.deleteCutEdges=function(){var e=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(t){t.label===t.symetric.label&&(e.removeEdge(t.symetric),e.removeEdge(t))})},us.prototype._computeNextCWEdges=function(r){var e=this;void 0===r?Object.keys(this.nodes).forEach(function(t){return e._computeNextCWEdges(e.nodes[t])}):r.getOuterEdges().forEach(function(t,e){r.getOuterEdge((0===e?r.getOuterEdges().length:e)-1).symetric.next=t})},us.prototype._computeNextCCWEdges=function(t,e){for(var r,n,i=t.getOuterEdges(),o=i.length-1;0<=o;--o){var a=i[o],s=a.symetric,u=void 0,c=void 0;a.label===e&&(u=a),s.label===e&&(c=s),u&&c&&(c&&(n=c),u&&(n&&(n.next=u,n=void 0),r=r||u))}n&&(n.next=r)},us.prototype._findLabeledEdgeRings=function(){var r=[],n=0;return this.edges.forEach(function(t){if(!(0<=t.label)){r.push(t);for(var e=t;e.label=n,e=e.next,!t.isEqual(e););n++}}),r},us.prototype.getEdgeRings=function(){var r=this;this._computeNextCWEdges(),this.edges.forEach(function(t){t.label=void 0}),this._findLabeledEdgeRings().forEach(function(e){r._findIntersectionNodes(e).forEach(function(t){r._computeNextCCWEdges(t,e.label)})});var e=[];return this.edges.forEach(function(t){t.ring||e.push(r._findEdgeRing(t))}),e},us.prototype._findIntersectionNodes=function(r){for(var t=[],n=r,e=function(){var e=0;n.from.getOuterEdges().forEach(function(t){t.label===r.label&&++e}),1<e&&t.push(n.from),n=n.next};e(),!r.isEqual(n););return t},us.prototype._findEdgeRing=function(t){for(var e=t,r=new as;r.push(e),e.ring=r,e=e.next,!t.isEqual(e););return r},us.prototype.removeNode=function(t){var e=this;t.getOuterEdges().forEach(function(t){return e.removeEdge(t)}),t.innerEdges.forEach(function(t){return e.removeEdge(t)}),delete this.nodes[t.id]},us.prototype.removeEdge=function(e){this.edges=this.edges.filter(function(t){return!t.isEqual(e)}),e.deleteEdge()};function cs(t){this.precision=t&&t.precision?t.precision:17,this.direction=!(!t||!t.direction)&&t.direction,this.pseudoNode=!(!t||!t.pseudoNode)&&t.pseudoNode,this.objectComparator=t&&t.objectComparator?t.objectComparator:_n}var ls=gt(function(t,e){function r(t){var e=[];for(var r in t)e.push(r);return e}(t.exports="function"==typeof Object.keys?Object.keys:r).shim=r}),hs=(ls.shim,gt(function(t,e){function r(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function n(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Object.prototype.hasOwnProperty.call(t,"callee")&&!Object.prototype.propertyIsEnumerable.call(t,"callee")||!1}var i="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();(e=t.exports=i?r:n).supported=r,e.unsupported=n})),ps=(hs.supported,hs.unsupported,gt(function(t){function s(t){return null==t}function u(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length||"function"!=typeof t.copy||"function"!=typeof t.slice||0<t.length&&"number"!=typeof t[0])}var c=Array.prototype.slice,l=t.exports=function(t,e,r){return r=r||{},t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():!t||!e||"object"!=typeof t&&"object"!=typeof e?r.strict?t===e:t==e:function(t,e,r){var n,i;if(s(t)||s(e))return!1;if(t.prototype!==e.prototype)return!1;if(hs(t))return!!hs(e)&&(t=c.call(t),e=c.call(e),l(t,e,r));if(u(t)){if(!u(e))return!1;if(t.length!==e.length)return!1;for(n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}try{var o=ls(t),a=ls(e)}catch(t){return!1}if(o.length!=a.length)return!1;for(o.sort(),a.sort(),n=o.length-1;0<=n;n--)if(o[n]!=a[n])return!1;for(n=o.length-1;0<=n;n--)if(i=o[n],!l(t[i],e[i],r))return!1;return typeof t==typeof e}(t,e,r))}}));cs.prototype.compare=function(t,e){if(t.type!==e.type||!vn(t,e))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,e.coordinates);case"LineString":return this.compareLine(t.coordinates,e.coordinates,0,!1);case"Polygon":return this.comparePolygon(t,e);case"Feature":return this.compareFeature(t,e);default:if(0===t.type.indexOf("Multi")){var r=this,n=yn(t),i=yn(e);return n.every(function(e){return this.some(function(t){return r.compare(e,t)})},i)}}return!1},cs.prototype.compareCoord=function(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r].toFixed(this.precision)!==e[r].toFixed(this.precision))return!1;return!0},cs.prototype.compareLine=function(t,e,r,n){if(!vn(t,e))return!1;var i=this.pseudoNode?t:this.removePseudo(t),o=this.pseudoNode?e:this.removePseudo(e);if(!n||this.compareCoord(i[0],o[0])||(o=this.fixStartIndex(o,i))){var a=this.compareCoord(i[r],o[r]);return this.direction||a?this.comparePath(i,o):!!this.compareCoord(i[r],o[o.length-(1+r)])&&this.comparePath(i.slice().reverse(),o)}},cs.prototype.fixStartIndex=function(t,e){for(var r,n=-1,i=0;i<t.length;i++)if(this.compareCoord(t[i],e[0])){n=i;break}return 0<=n&&(r=[].concat(t.slice(n,t.length),t.slice(1,n+1))),r},cs.prototype.comparePath=function(t,e){var r=this;return t.every(function(t,e){return r.compareCoord(t,this[e])},e)},cs.prototype.comparePolygon=function(t,e){if(this.compareLine(t.coordinates[0],e.coordinates[0],1,!0)){var r=t.coordinates.slice(1,t.coordinates.length),n=e.coordinates.slice(1,e.coordinates.length),i=this;return r.every(function(e){return this.some(function(t){return i.compareLine(e,t,1,!0)})},n)}return!1},cs.prototype.compareFeature=function(t,e){return!(t.id!==e.id||!this.objectComparator(t.properties,e.properties)||!this.compareBBox(t,e))&&this.compare(t.geometry,e.geometry)},cs.prototype.compareBBox=function(t,e){return!!(!t.bbox&&!e.bbox||t.bbox&&e.bbox&&this.compareCoord(t.bbox,e.bbox))},cs.prototype.removePseudo=function(t){return t};function fs(t,e,r){var n=Math.abs(t-e);return r?n:n*n}function ds(t,e,r,n){var i=[],o=[],a=[],s=[],u=!1,c=n||1e4,l=t.length,h=t[0].length,p=0<h,f=[];if(r)i="kmrand"==r?function(t,e){for(var r={},n=[],i=e<<2,o=t.length,a=0<t[0].length;n.length<e&&0<i--;){var s=t[Math.floor(Math.random()*o)],u=a?s.join("_"):""+s;r[u]||(r[u]=!0,n.push(s))}if(n.length<e)throw new Error("Error initializating clusters");return n}(t,e):"kmpp"==r?function(t,e){var r=t[0].length?ws:fs,n=[],i=t.length,o=0<t[0].length,a=t[Math.floor(Math.random()*i)];for(o&&a.join("_"),n.push(a);n.length<e;){for(var s=[],u=n.length,c=0,l=[],h=0;h<i;h++){for(var p=1/0,f=0;f<u;f++){var d=r(t[h],n[f]);d<=p&&(p=d)}s[h]=p}for(var m=0;m<i;m++)c+=s[m];for(var g=0;g<i;g++)l[g]={i:g,v:t[g],pr:s[g]/c,cs:0};l.sort(function(t,e){return t.pr-e.pr}),l[0].cs=l[0].pr;for(var y=1;y<i;y++)l[y].cs=l[y-1].cs+l[y].pr;for(var v=Math.random(),_=0;_<i-1&&l[_++].cs<v;);n.push(l[_-1].v)}return n}(t,e):r;else for(var d={};i.length<e;){var m=Math.floor(Math.random()*l);d[m]||(d[m]=!0,i.push(t[m]))}do{xn(e,0,f);for(var g=0;g<l;g++){for(var y=1/0,v=0,_=0;_<e;_++)(s=p?Ss(t[g],i[_]):Math.abs(t[g]-i[_]))<=y&&(y=s,v=_);f[a[g]=v]++}for(var b=[],x=(o=[],0);x<e;x++)b[x]=p?xn(h,0,b[x]):0,o[x]=i[x];if(p){for(var w=0;w<e;w++)i[w]=[];for(var S=0;S<l;S++)for(var E=b[a[S]],C=t[S],M=0;M<h;M++)E[M]+=C[M];u=!0;for(var T=0;T<e;T++){for(var P=i[T],O=b[T],A=o[T],I=f[T],L=0;L<h;L++)P[L]=O[L]/I||0;if(u)for(var R=0;R<h;R++)if(A[R]!=P[R]){u=!1;break}}}else{for(var N=0;N<l;N++)b[a[N]]+=t[N];for(var k=0;k<e;k++)i[k]=b[k]/f[k]||0;u=!0;for(var D=0;D<e;D++)if(o[D]!=i[D]){u=!1;break}}u=u||--c<=0}while(!u);return{it:1e4-c,k:e,idxs:a,centroids:i}}var ms=cs,gs=gt(function(t){function e(t,e,r,n){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(t,e,r,n)}e.prototype.run=function(t,e,r,n){this._init(t,e,r,n);for(var i=0;i<this._datasetLength;i++)if(1!==this._visited[i]){this._visited[i]=1;var o=this._regionQuery(i);if(o.length<this.minPts)this.noise.push(i);else{var a=this.clusters.length;this.clusters.push([]),this._addToCluster(i,a),this._expandCluster(a,o)}}return this.clusters},e.prototype._init=function(t,e,r,n){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this.noise=[],this._datasetLength=t.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}e&&(this.epsilon=e),r&&(this.minPts=r),n&&(this.distance=n)},e.prototype._expandCluster=function(t,e){for(var r=0;r<e.length;r++){var n=e[r];if(1!==this._visited[n]){this._visited[n]=1;var i=this._regionQuery(n);i.length>=this.minPts&&(e=this._mergeArrays(e,i))}1!==this._assigned[n]&&this._addToCluster(n,t)}},e.prototype._addToCluster=function(t,e){this.clusters[e].push(t),this._assigned[t]=1},e.prototype._regionQuery=function(t){for(var e=[],r=0;r<this._datasetLength;r++)this.distance(this.dataset[t],this.dataset[r])<this.epsilon&&e.push(r);return e},e.prototype._mergeArrays=function(t,e){for(var r=e.length,n=0;n<r;n++){var i=e[n];t.indexOf(i)<0&&t.push(i)}return t},e.prototype._euclideanDistance=function(t,e){for(var r=0,n=Math.min(t.length,e.length);n--;)r+=(t[n]-e[n])*(t[n]-e[n]);return Math.sqrt(r)},t.exports&&(t.exports=e)}),ys=gt(function(t){function e(t,e,r){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(t,e,r)}e.prototype.init=function(t,e,r){this.assignments=[],this.centroids=[],void 0!==t&&(this.dataset=t),void 0!==e&&(this.k=e),void 0!==r&&(this.distance=r)},e.prototype.run=function(t,e){this.init(t,e);for(var r=this.dataset.length,n=0;n<this.k;n++)this.centroids[n]=this.randomCentroid();for(var i=!0;i;){i=this.assign();for(var o=0;o<this.k;o++){for(var a=new Array(l),s=0,u=0;u<l;u++)a[u]=0;for(var c=0;c<r;c++){var l=this.dataset[c].length;if(o===this.assignments[c]){for(u=0;u<l;u++)a[u]+=this.dataset[c][u];s++}}if(0<s){for(u=0;u<l;u++)a[u]/=s;this.centroids[o]=a}else this.centroids[o]=this.randomCentroid(),i=!0}}return this.getClusters()},e.prototype.randomCentroid=function(){for(var t,e,r=this.dataset.length-1;e=Math.round(Math.random()*r),t=this.dataset[e],0<=this.centroids.indexOf(t););return t},e.prototype.assign=function(){for(var t,e=!1,r=this.dataset.length,n=0;n<r;n++)(t=this.argmin(this.dataset[n],this.centroids,this.distance))!=this.assignments[n]&&(this.assignments[n]=t,e=!0);return e},e.prototype.getClusters=function(){for(var t,e=new Array(this.k),r=0;r<this.assignments.length;r++)void 0===e[t=this.assignments[r]]&&(e[t]=[]),e[t].push(r);return e},e.prototype.argmin=function(t,e,r){for(var n,i=Number.MAX_VALUE,o=0,a=e.length,s=0;s<a;s++)(n=r(t,e[s]))<i&&(i=n,o=s);return o},e.prototype.distance=function(t,e){for(var r=0,n=Math.min(t.length,e.length);n--;){var i=t[n]-e[n];r+=i*i}return Math.sqrt(r)},t.exports&&(t.exports=e)}),vs=gt(function(t){function e(t,e,r){this._queue=[],this._priorities=[],this._sorting="desc",this._init(t,e,r)}e.prototype.insert=function(t,e){for(var r=this._queue.length,n=r;n--;){var i=this._priorities[n];"desc"===this._sorting?i<e&&(r=n):e<i&&(r=n)}this._insertAt(t,e,r)},e.prototype.remove=function(t){for(var e=this._queue.length;e--;)if(t===this._queue[e]){this._queue.splice(e,1),this._priorities.splice(e,1);break}},e.prototype.forEach=function(t){this._queue.forEach(t)},e.prototype.getElements=function(){return this._queue},e.prototype.getElementPriority=function(t){return this._priorities[t]},e.prototype.getPriorities=function(){return this._priorities},e.prototype.getElementsWithPriorities=function(){for(var t=[],e=0,r=this._queue.length;e<r;e++)t.push([this._queue[e],this._priorities[e]]);return t},e.prototype._init=function(t,e,r){if(t&&e){if(this._queue=[],this._priorities=[],t.length!==e.length)throw new Error("Arrays must have the same length");for(var n=0;n<t.length;n++)this.insert(t[n],e[n])}r&&(this._sorting=r)},e.prototype._insertAt=function(t,e,r){this._queue.length===r?(this._queue.push(t),this._priorities.push(e)):(this._queue.splice(r,0,t),this._priorities.splice(r,0,e))},t.exports&&(t.exports=e)}),_s=gt(function(t){function e(t,e,r,n){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(t,e,r,n)}if(t.exports)var c=vs;e.prototype.run=function(t,e,r,n){this._init(t,e,r,n);for(var i=0,o=this.dataset.length;i<o;i++)if(1!==this._processed[i]){this._processed[i]=1,this.clusters.push([i]);var a=this.clusters.length-1;this._orderedList.push(i);var s=new c(null,null,"asc"),u=this._regionQuery(i);void 0!==this._distanceToCore(i)&&(this._updateQueue(i,u,s),this._expandCluster(a,s))}return this.clusters},e.prototype.getReachabilityPlot=function(){for(var t=[],e=0,r=this._orderedList.length;e<r;e++){var n=this._orderedList[e],i=this._reachability[n];t.push([n,i])}return t},e.prototype._init=function(t,e,r,n){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}e&&(this.epsilon=e),r&&(this.minPts=r),n&&(this.distance=n)},e.prototype._updateQueue=function(n,t,i){var o=this;this._coreDistance=this._distanceToCore(n),t.forEach(function(t){if(void 0===o._processed[t]){var e=o.distance(o.dataset[n],o.dataset[t]),r=Math.max(o._coreDistance,e);void 0===o._reachability[t]?(o._reachability[t]=r,i.insert(t,r)):r<o._reachability[t]&&(o._reachability[t]=r,i.remove(t),i.insert(t,r))}})},e.prototype._expandCluster=function(t,e){for(var r=e.getElements(),n=0,i=r.length;n<i;n++){var o=r[n];if(void 0===this._processed[o]){var a=this._regionQuery(o);this._processed[o]=1,this.clusters[t].push(o),this._orderedList.push(o),void 0!==this._distanceToCore(o)&&(this._updateQueue(o,a,e),this._expandCluster(t,e))}}},e.prototype._distanceToCore=function(t){for(var e=this.epsilon,r=0;r<e;r++)if(this._regionQuery(t,r).length>=this.minPts)return r},e.prototype._regionQuery=function(t,e){e=e||this.epsilon;for(var r=[],n=0,i=this.dataset.length;n<i;n++)this.distance(this.dataset[t],this.dataset[n])<e&&r.push(n);return r},e.prototype._euclideanDistance=function(t,e){for(var r=0,n=Math.min(t.length,e.length);n--;)r+=(t[n]-e[n])*(t[n]-e[n]);return Math.sqrt(r)},t.exports&&(t.exports=e)}),bs=gt(function(t){t.exports&&(t.exports={DBSCAN:gs,KMEANS:ys,OPTICS:_s,PriorityQueue:vs})}),xs=(bs.DBSCAN,bs.KMEANS,bs.OPTICS,bs.PriorityQueue,function(t,e,r){for(var n=t.length,i=0,o=0;o<n;o++){var a=(t[o]||0)-(e[o]||0);i+=a*a}return r?Math.sqrt(i):i}),ws=xs,Ss=xs,Es={search:function(t,e,r,n){t.cleanDirty();var i=(n=n||{}).heuristic||Es.heuristics.manhattan,o=n.closest||!1,a=new Mn(function(t){return t.f}),s=e;for(e.h=i(e,r),a.push(e);0<a.size();){var u=a.pop();if(u===r)return Sn(u);u.closed=!0;for(var c=t.neighbors(u),l=0,h=c.length;l<h;++l){var p=c[l];if(!p.closed&&!p.isWall()){var f=u.g+p.getCost(u),d=p.visited;(!d||f<p.g)&&(p.visited=!0,p.parent=u,p.h=p.h||i(p,r),p.g=f,p.f=p.g+p.h,t.markDirty(p),o&&(p.h<s.h||p.h===s.h&&p.g<s.g)&&(s=p),d?a.rescoreElement(p):a.push(p))}}}return o?Sn(s):[]},heuristics:{manhattan:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},diagonal:function(t,e){var r=Math.sqrt(2),n=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return 1*(n+i)+(r-2)*Math.min(n,i)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};En.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)Es.cleanNode(this.nodes[t])},En.prototype.cleanDirty=function(){for(var t=0;t<this.dirtyNodes.length;t++)Es.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]},En.prototype.markDirty=function(t){this.dirtyNodes.push(t)},En.prototype.neighbors=function(t){var e=[],r=t.x,n=t.y,i=this.grid;return i[r-1]&&i[r-1][n]&&e.push(i[r-1][n]),i[r+1]&&i[r+1][n]&&e.push(i[r+1][n]),i[r]&&i[r][n-1]&&e.push(i[r][n-1]),i[r]&&i[r][n+1]&&e.push(i[r][n+1]),this.diagonal&&(i[r-1]&&i[r-1][n-1]&&e.push(i[r-1][n-1]),i[r+1]&&i[r+1][n-1]&&e.push(i[r+1][n-1]),i[r-1]&&i[r-1][n+1]&&e.push(i[r-1][n+1]),i[r+1]&&i[r+1][n+1]&&e.push(i[r+1][n+1])),e},En.prototype.toString=function(){for(var t,e,r,n,i=[],o=this.grid,a=0,s=o.length;a<s;a++){for(t=[],r=0,n=(e=o[a]).length;r<n;r++)t.push(e[r].weight);i.push(t.join(" "))}return i.join("\n")},Cn.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},Cn.prototype.getCost=function(t){return t&&t.x!==this.x&&t.y!==this.y?1.41421*this.weight:this.weight},Cn.prototype.isWall=function(){return 0===this.weight},Mn.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return 0<this.content.length&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),r=this.content.pop();e!==this.content.length-1&&(this.content[e]=r,this.scoreFunction(r)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];0<t;){var r=(t+1>>1)-1,n=this.content[r];if(!(this.scoreFunction(e)<this.scoreFunction(n)))break;this.content[r]=e,this.content[t]=n,t=r}},bubbleUp:function(t){for(var e=this.content.length,r=this.content[t],n=this.scoreFunction(r);;){var i,o=t+1<<1,a=o-1,s=null;if(a<e){var u=this.content[a];(i=this.scoreFunction(u))<n&&(s=a)}if(o<e){var c=this.content[o];this.scoreFunction(c)<(null===s?n:i)&&(s=o)}if(null===s)break;this.content[t]=this.content[s],this.content[s]=r,t=s}}};function Cs(t){return function(){return t}}On.prototype={constructor:On,insert:function(t,e){var r,n,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;r=t}else r=this._?(t=Rn(this._),e.P=null,(e.N=t).P=t.L=e,t):(e.P=e.N=null,this._=e,null);for(e.L=e.R=null,e.U=r,e.C=!0,t=e;r&&r.C;)r===(n=r.U).L?(i=n.R)&&i.C?(r.C=i.C=!1,n.C=!0,t=n):(t===r.R&&(In(this,r),r=(t=r).U),r.C=!1,n.C=!0,Ln(this,n)):(i=n.L)&&i.C?(r.C=i.C=!1,n.C=!0,t=n):(t===r.L&&(Ln(this,r),r=(t=r).U),r.C=!1,n.C=!0,In(this,n)),r=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,r,n,i=t.U,o=t.L,a=t.R;if(r=o?a?Rn(a):o:a,i?i.L===t?i.L=r:i.R=r:this._=r,o&&a?(n=r.C,r.C=t.C,((r.L=o).U=r)!==a?(i=r.U,r.U=t.U,t=r.R,i.L=t,(r.R=a).U=r):(r.U=i,t=(i=r).R)):(n=t.C,t=r),t&&(t.U=i),!n)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===i.L){if((e=i.R).C&&(e.C=!1,i.C=!0,In(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,Ln(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,In(this,i),t=this._;break}}else if((e=i.L).C&&(e.C=!1,i.C=!0,Ln(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,In(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,Ln(this,i),t=this._;break}e.C=!0,i=(t=i).U}while(!t.C);t&&(t.C=!1)}}};var Ms,Ts,Ps,Os,As,Is=[],Ls=[],Rs=1e-6,Ns=1e-12;Xn.prototype={constructor:Xn,polygons:function(){var r=this.edges;return this.cells.map(function(e){var t=e.halfedges.map(function(t){return Fn(e,r[t])});return t.data=e.site.data,t})},triangles:function(){var p=[],f=this.edges;return this.cells.forEach(function(t,e){if(n=(r=t.halfedges).length)for(var r,n,i,o=t.site,a=-1,s=f[r[n-1]],u=s.left===o?s.right:s.left;++a<n;)i=u,u=(s=f[r[a]]).left===o?s.right:s.left,i&&u&&e<i.index&&e<u.index&&(l=i,h=u,((c=o)[0]-h[0])*(l[1]-c[1])-(c[0]-l[0])*(h[1]-c[1])<0)&&p.push([o.data,i.data,u.data]);var c,l,h}),p},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(a,s,t){for(var e,u,c=this,l=c._found||0,r=c.cells.length;!(u=c.cells[l]);)if(++l>=r)return null;for(var n=a-u.site[0],i=s-u.site[1],h=n*n+i*i;u=c.cells[e=l],l=null,u.halfedges.forEach(function(t){var e=c.edges[t],r=e.left;if(r!==u.site&&r||(r=e.right)){var n=a-r[0],i=s-r[1],o=n*n+i*i;o<h&&(h=o,l=r.index)}}),null!==l;);return c._found=e,null==t||h<=t*t?u.site:null}};var ks=Object.freeze({randomPosition:ti,randomPoint:ei,randomPolygon:ri,randomLineString:ni}),Ds=Object.freeze({getCluster:oi,clusterEach:ai,clusterReduce:si,createBins:ui,applyFilter:ci,propertiesContainsFilter:li,filterProperties:hi});"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(null==this)throw new TypeError(this+" is not an object");var e=Object(this),r=Math.max(Math.min(e.length,9007199254740991),0)||0,n=1 in arguments&&parseInt(Number(arguments[1]),10)||0;n=n<0?Math.max(r+n,0):Math.min(n,r);var i=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:r;for(i=i<0?Math.max(r+arguments[2],0):Math.min(i,r);n<i;)e[n]=t,++n;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!=t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};function js(){}js.prototype.interfaces_=function(){return[]},js.prototype.getClass=function(){return js},js.prototype.equalsWithTolerance=function(t,e,r){return Math.abs(t-e)<=r};function zs(){}function Fs(){}var Bs={MAX_VALUE:{configurable:!0}};Fs.isNaN=function(t){return Number.isNaN(t)},Fs.doubleToLongBits=function(t){return t},Fs.longBitsToDouble=function(t){return t},Fs.isInfinite=function(t){return!Number.isFinite(t)},Bs.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(Fs,Bs);function Us(){}function Vs(){}function Gs(){}function qs(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=qs.NULL_ORDINATE;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=qs.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])}var Hs={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};qs.prototype.setOrdinate=function(t,e){switch(t){case qs.X:this.x=e;break;case qs.Y:this.y=e;break;case qs.Z:this.z=e;break;default:throw new zs("Invalid ordinate index: "+t)}},qs.prototype.equals2D=function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],r=arguments[1];return!!js.equalsWithTolerance(this.x,e.x,r)&&!!js.equalsWithTolerance(this.y,e.y,r)}},qs.prototype.getOrdinate=function(t){switch(t){case qs.X:return this.x;case qs.Y:return this.y;case qs.Z:return this.z}throw new zs("Invalid ordinate index: "+t)},qs.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||Fs.isNaN(this.z))&&Fs.isNaN(t.z)},qs.prototype.equals=function(t){return t instanceof qs&&this.equals2D(t)},qs.prototype.equalInZ=function(t,e){return js.equalsWithTolerance(this.z,t.z,e)},qs.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},qs.prototype.clone=function(){},qs.prototype.copy=function(){return new qs(this)},qs.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},qs.prototype.distance3D=function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return Math.sqrt(e*e+r*r+n*n)},qs.prototype.distance=function(t){var e=this.x-t.x,r=this.y-t.y;return Math.sqrt(e*e+r*r)},qs.prototype.hashCode=function(){var t=17;return 37*(t=37*t+qs.hashCode(this.x))+qs.hashCode(this.y)},qs.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z},qs.prototype.interfaces_=function(){return[Us,Vs,pi]},qs.prototype.getClass=function(){return qs},qs.hashCode=function(){if(1===arguments.length){var t=Fs.doubleToLongBits(arguments[0]);return Math.trunc((t^t)>>>32)}},Hs.DimensionalComparator.get=function(){return $s},Hs.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},Hs.NULL_ORDINATE.get=function(){return Fs.NaN},Hs.X.get=function(){return 0},Hs.Y.get=function(){return 1},Hs.Z.get=function(){return 2},Object.defineProperties(qs,Hs);var $s=function(t){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var e=t;if(2!==e&&3!==e)throw new zs("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};$s.prototype.compare=function(t,e){var r=t,n=e,i=$s.compare(r.x,n.x);if(0!==i)return i;var o=$s.compare(r.y,n.y);return 0!==o?o:this._dimensionsToTest<=2?0:$s.compare(r.z,n.z)},$s.prototype.interfaces_=function(){return[Gs]},$s.prototype.getClass=function(){return $s},$s.compare=function(t,e){return t<e?-1:e<t?1:Fs.isNaN(t)?Fs.isNaN(e)?0:-1:Fs.isNaN(e)?1:0};function Ws(){}Ws.prototype.create=function(){},Ws.prototype.interfaces_=function(){return[]},Ws.prototype.getClass=function(){return Ws};function Xs(){}var Ys={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Xs.prototype.interfaces_=function(){return[]},Xs.prototype.getClass=function(){return Xs},Xs.toLocationSymbol=function(t){switch(t){case Xs.EXTERIOR:return"e";case Xs.BOUNDARY:return"b";case Xs.INTERIOR:return"i";case Xs.NONE:return"-"}throw new zs("Unknown location value: "+t)},Ys.INTERIOR.get=function(){return 0},Ys.BOUNDARY.get=function(){return 1},Ys.EXTERIOR.get=function(){return 2},Ys.NONE.get=function(){return-1},Object.defineProperties(Xs,Ys);function Zs(t,e){return t.interfaces_&&-1<t.interfaces_().indexOf(e)}function Ks(){}var Js={LOG_10:{configurable:!0}};Ks.prototype.interfaces_=function(){return[]},Ks.prototype.getClass=function(){return Ks},Ks.log10=function(t){var e=Math.log(t);return Fs.isInfinite(e)?e:Fs.isNaN(e)?e:e/Ks.LOG_10},Ks.min=function(t,e,r,n){var i=t;return e<i&&(i=e),r<i&&(i=r),n<i&&(i=n),i},Ks.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],r=arguments[2];return t<e?e:r<t?r:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var n=arguments[0],i=arguments[1],o=arguments[2];return n<i?i:o<n?o:n}},Ks.wrap=function(t,e){return t<0?e- -t%e:t%e},Ks.max=function(){if(3===arguments.length){var t=arguments[1],e=arguments[2],r=arguments[0];return r<t&&(r=t),r<e&&(r=e),r}if(4===arguments.length){var n=arguments[1],i=arguments[2],o=arguments[3],a=arguments[0];return a<n&&(a=n),a<i&&(a=i),a<o&&(a=o),a}},Ks.average=function(t,e){return(t+e)/2},Js.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(Ks,Js);function Qs(t){this.str=t}Qs.prototype.append=function(t){this.str+=t},Qs.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},Qs.prototype.toString=function(t){return this.str};function tu(t){this.value=t}tu.prototype.intValue=function(){return this.value},tu.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},tu.isNaN=function(t){return Number.isNaN(t)};function eu(){}eu.isWhitespace=function(t){return t<=32&&0<=t||127===t},eu.toUpperCase=function(t){return t.toUpperCase()};function ru(){if(this._hi=0,(this._lo=0)===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof ru){var e=arguments[0];this.init(e)}else if("string"==typeof arguments[0]){ru.call(this,ru.parse(arguments[0]))}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.init(r,n)}}var nu={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};ru.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo},ru.prototype.extractSignificantDigits=function(t,e){var r=this.abs(),n=ru.magnitude(r._hi),i=ru.TEN.pow(n);(r=r.divide(i)).gt(ru.TEN)?(r=r.divide(ru.TEN),n+=1):r.lt(ru.ONE)&&(r=r.multiply(ru.TEN),n-=1);for(var o=n+1,a=new Qs,s=ru.MAX_PRINT_DIGITS-1,u=0;u<=s;u++){t&&u===o&&a.append(".");var c=Math.trunc(r._hi);if(c<0)break;var l=!1,h=0;h=9<c?(l=!0,"9"):"0"+c,a.append(h),r=r.subtract(ru.valueOf(c)).multiply(ru.TEN),l&&r.selfAdd(ru.TEN);var p=!0,f=ru.magnitude(r._hi);if(f<0&&Math.abs(f)>=s-u&&(p=!1),!p)break}return e[0]=n,a.toString()},ru.prototype.sqr=function(){return this.multiply(this)},ru.prototype.doubleValue=function(){return this._hi+this._lo},ru.prototype.subtract=function(){if(arguments[0]instanceof ru){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},ru.prototype.equals=function(){if(1===arguments.length){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}},ru.prototype.isZero=function(){return 0===this._hi&&0===this._lo},ru.prototype.selfSubtract=function(){if(arguments[0]instanceof ru){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},ru.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},ru.prototype.min=function(t){return this.le(t)?this:t},ru.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof ru){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var r,n,i,o,a=arguments[0],s=arguments[1],u=null,c=null,l=null,h=null;return i=this._hi/a,h=(u=(l=ru.SPLIT*i)-(u=l-i))*(c=(h=ru.SPLIT*a)-(c=h-a))-(o=i*a)+u*(n=a-c)+(r=i-u)*c+r*n,h=i+(l=(this._hi-o-h+this._lo-i*s)/a),this._hi=h,this._lo=i-h+l,this}},ru.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},ru.prototype.divide=function(){if(arguments[0]instanceof ru){var t,e,r,n,i=arguments[0],o=null,a=null,s=null,u=null;return t=(r=this._hi/i._hi)-(o=(s=ru.SPLIT*r)-(o=s-r)),u=o*(a=(u=ru.SPLIT*i._hi)-(a=u-i._hi))-(n=r*i._hi)+o*(e=i._hi-a)+t*a+t*e,s=(this._hi-n-u+this._lo-r*i._lo)/i._hi,new ru(u=r+s,r-u+s)}if("number"==typeof arguments[0]){var c=arguments[0];return Fs.isNaN(c)?ru.createNaN():ru.copy(this).selfDivide(c,0)}},ru.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo},ru.prototype.pow=function(t){if(0===t)return ru.valueOf(1);var e=new ru(this),r=ru.valueOf(1),n=Math.abs(t);if(1<n)for(;0<n;)n%2==1&&r.selfMultiply(e),0<(n/=2)&&(e=e.sqr());else r=e;return t<0?r.reciprocal():r},ru.prototype.ceil=function(){if(this.isNaN())return ru.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new ru(t,e)},ru.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0},ru.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},ru.prototype.setValue=function(){if(arguments[0]instanceof ru){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},ru.prototype.max=function(t){return this.ge(t)?this:t},ru.prototype.sqrt=function(){if(this.isZero())return ru.valueOf(0);if(this.isNegative())return ru.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,r=ru.valueOf(e),n=this.subtract(r.sqr())._hi*(.5*t);return r.add(n)},ru.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof ru){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var e,r,n,i,o,a=arguments[0],s=null;return s=(n=this._hi+a)-(i=n-this._hi),r=(o=(s=a-i+(this._hi-s))+this._lo)+(n-(e=n+o)),this._hi=e+r,this._lo=r+(e-this._hi),this}}else if(2===arguments.length){var u,c,l,h,p=arguments[0],f=arguments[1],d=null,m=null,g=null;l=this._hi+p,c=this._lo+f,m=l-(g=l-this._hi),d=c-(h=c-this._lo);var y=(u=l+(g=(m=p-g+(this._hi-m))+c))+(g=(d=f-h+(this._lo-d))+(g+(l-u))),v=g+(u-y);return this._hi=y,this._lo=v,this}},ru.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof ru){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var r,n,i=arguments[0],o=arguments[1],a=null,s=null,u=null,c=null;a=(u=ru.SPLIT*this._hi)-this._hi,c=ru.SPLIT*i,a=u-a,r=this._hi-a,s=c-i;var l=(u=this._hi*i)+(c=a*(s=c-s)-u+a*(n=i-s)+r*s+r*n+(this._hi*o+this._lo*i)),h=c+(a=u-l);return this._hi=l,this._lo=h,this}},ru.prototype.selfSqr=function(){return this.selfMultiply(this)},ru.prototype.floor=function(){if(this.isNaN())return ru.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new ru(t,e)},ru.prototype.negate=function(){return this.isNaN()?this:new ru(-this._hi,-this._lo)},ru.prototype.clone=function(){},ru.prototype.multiply=function(){if(arguments[0]instanceof ru){var t=arguments[0];return t.isNaN()?ru.createNaN():ru.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return Fs.isNaN(e)?ru.createNaN():ru.copy(this).selfMultiply(e,0)}},ru.prototype.isNaN=function(){return Fs.isNaN(this._hi)},ru.prototype.intValue=function(){return Math.trunc(this._hi)},ru.prototype.toString=function(){var t=ru.magnitude(this._hi);return-3<=t&&t<=20?this.toStandardNotation():this.toSciNotation()},ru.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),r=this.extractSignificantDigits(!0,e),n=e[0]+1,i=r;if("."===r.charAt(0))i="0"+r;else if(n<0)i="0."+ru.stringOfChar("0",-n)+r;else if(-1===r.indexOf(".")){var o=n-r.length;i=r+ru.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+i:i},ru.prototype.reciprocal=function(){var t,e,r,n,i=null,o=null,a=null,s=null;t=(r=1/this._hi)-(i=(a=ru.SPLIT*r)-(i=a-r)),o=(s=ru.SPLIT*this._hi)-this._hi;var u=r+(a=(1-(n=r*this._hi)-(s=i*(o=s-o)-n+i*(e=this._hi-o)+t*o+t*e)-r*this._lo)/this._hi);return new ru(u,r-u+a)},ru.prototype.toSciNotation=function(){if(this.isZero())return ru.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),r=this.extractSignificantDigits(!1,e),n=ru.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===r.charAt(0))throw new Error("Found leading zero: "+r);var i="";1<r.length&&(i=r.substring(1));var o=r.charAt(0)+"."+i;return this.isNegative()?"-"+o+n:o+n},ru.prototype.abs=function(){return this.isNaN()?ru.NaN:this.isNegative()?this.negate():new ru(this)},ru.prototype.isPositive=function(){return(0<this._hi||0===this._hi)&&0<this._lo},ru.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo},ru.prototype.add=function(){if(arguments[0]instanceof ru){var t=arguments[0];return ru.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return ru.copy(this).selfAdd(e)}},ru.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof ru){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this._hi=r,this._lo=n}},ru.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo},ru.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},ru.prototype.trunc=function(){return this.isNaN()?ru.NaN:this.isPositive()?this.floor():this.ceil()},ru.prototype.signum=function(){return 0<this._hi?1:this._hi<0?-1:0<this._lo?1:this._lo<0?-1:0},ru.prototype.interfaces_=function(){return[pi,Us,Vs]},ru.prototype.getClass=function(){return ru},ru.sqr=function(t){return ru.valueOf(t).selfMultiply(t)},ru.valueOf=function(){return"string"==typeof arguments[0]?ru.parse(arguments[0]):"number"==typeof arguments[0]?new ru(arguments[0]):void 0},ru.sqrt=function(t){return ru.valueOf(t).sqrt()},ru.parse=function(t){for(var e=0,r=t.length;eu.isWhitespace(t.charAt(e));)e++;var n=!1;if(e<r){var i=t.charAt(e);"-"!==i&&"+"!==i||(e++,"-"===i&&(n=!0))}for(var o=new ru,a=0,s=0,u=0;!(r<=e);){var c=t.charAt(e);if(e++,eu.isDigit(c)){var l=c-"0";o.selfMultiply(ru.TEN),o.selfAdd(l),a++}else{if("."!==c){if("e"!==c&&"E"!==c)throw new Error("Unexpected character '"+c+"' at position "+e+" in string "+t);var h=t.substring(e);try{u=tu.parseInt(h)}catch(e){throw e instanceof Error?new Error("Invalid exponent "+h+" in string "+t):e}break}s=a}}var p=o,f=a-s-u;if(0==f)p=o;else if(0<f){var d=ru.TEN.pow(f);p=o.divide(d)}else if(f<0){var m=ru.TEN.pow(-f);p=o.multiply(m)}return n?p.negate():p},ru.createNaN=function(){return new ru(Fs.NaN,Fs.NaN)},ru.copy=function(t){return new ru(t)},ru.magnitude=function(t){var e=Math.abs(t),r=Math.log(e)/Math.log(10),n=Math.trunc(Math.floor(r));return 10*Math.pow(10,n)<=e&&(n+=1),n},ru.stringOfChar=function(t,e){for(var r=new Qs,n=0;n<e;n++)r.append(t);return r.toString()},nu.PI.get=function(){return new ru(3.141592653589793,12246467991473532e-32)},nu.TWO_PI.get=function(){return new ru(6.283185307179586,24492935982947064e-32)},nu.PI_2.get=function(){return new ru(1.5707963267948966,6123233995736766e-32)},nu.E.get=function(){return new ru(2.718281828459045,14456468917292502e-32)},nu.NaN.get=function(){return new ru(Fs.NaN,Fs.NaN)},nu.EPS.get=function(){return 123259516440783e-46},nu.SPLIT.get=function(){return 134217729},nu.MAX_PRINT_DIGITS.get=function(){return 32},nu.TEN.get=function(){return ru.valueOf(10)},nu.ONE.get=function(){return ru.valueOf(1)},nu.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},nu.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(ru,nu);function iu(){}var ou={DP_SAFE_EPSILON:{configurable:!0}};iu.prototype.interfaces_=function(){return[]},iu.prototype.getClass=function(){return iu},iu.orientationIndex=function(t,e,r){var n=iu.orientationIndexFilter(t,e,r);if(n<=1)return n;var i=ru.valueOf(e.x).selfAdd(-t.x),o=ru.valueOf(e.y).selfAdd(-t.y),a=ru.valueOf(r.x).selfAdd(-e.x),s=ru.valueOf(r.y).selfAdd(-e.y);return i.selfMultiply(s).selfSubtract(o.selfMultiply(a)).signum()},iu.signOfDet2x2=function(t,e,r,n){return t.multiply(n).selfSubtract(e.multiply(r)).signum()},iu.intersection=function(t,e,r,n){var i=ru.valueOf(n.y).selfSubtract(r.y).selfMultiply(ru.valueOf(e.x).selfSubtract(t.x)),o=ru.valueOf(n.x).selfSubtract(r.x).selfMultiply(ru.valueOf(e.y).selfSubtract(t.y)),a=i.subtract(o),s=ru.valueOf(n.x).selfSubtract(r.x).selfMultiply(ru.valueOf(t.y).selfSubtract(r.y)),u=ru.valueOf(n.y).selfSubtract(r.y).selfMultiply(ru.valueOf(t.x).selfSubtract(r.x)),c=s.subtract(u).selfDivide(a).doubleValue(),l=ru.valueOf(t.x).selfAdd(ru.valueOf(e.x).selfSubtract(t.x).selfMultiply(c)).doubleValue(),h=ru.valueOf(e.x).selfSubtract(t.x).selfMultiply(ru.valueOf(t.y).selfSubtract(r.y)),p=ru.valueOf(e.y).selfSubtract(t.y).selfMultiply(ru.valueOf(t.x).selfSubtract(r.x)),f=h.subtract(p).selfDivide(a).doubleValue(),d=ru.valueOf(r.y).selfAdd(ru.valueOf(n.y).selfSubtract(r.y).selfMultiply(f)).doubleValue();return new qs(l,d)},iu.orientationIndexFilter=function(t,e,r){var n=null,i=(t.x-r.x)*(e.y-r.y),o=(t.y-r.y)*(e.x-r.x),a=i-o;if(0<i){if(o<=0)return iu.signum(a);n=i+o}else{if(!(i<0))return iu.signum(a);if(0<=o)return iu.signum(a);n=-i-o}var s=iu.DP_SAFE_EPSILON*n;return s<=a||s<=-a?iu.signum(a):2},iu.signum=function(t){return 0<t?1:t<0?-1:0},ou.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(iu,ou);function au(){}var su={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};su.X.get=function(){return 0},su.Y.get=function(){return 1},su.Z.get=function(){return 2},su.M.get=function(){return 3},au.prototype.setOrdinate=function(t,e,r){},au.prototype.size=function(){},au.prototype.getOrdinate=function(t,e){},au.prototype.getCoordinate=function(){},au.prototype.getCoordinateCopy=function(t){},au.prototype.getDimension=function(){},au.prototype.getX=function(t){},au.prototype.clone=function(){},au.prototype.expandEnvelope=function(t){},au.prototype.copy=function(){},au.prototype.getY=function(t){},au.prototype.toCoordinateArray=function(){},au.prototype.interfaces_=function(){return[Vs]},au.prototype.getClass=function(){return au},Object.defineProperties(au,su);function uu(){}function cu(){}var lu,hu=((lu=uu)&&(pu.__proto__=lu),((pu.prototype=Object.create(lu&&lu.prototype)).constructor=pu).prototype.interfaces_=function(){return[]},pu.prototype.getClass=function(){return pu},pu);function pu(){lu.call(this,"Projective point not representable on the Cartesian plane.")}cu.arraycopy=function(t,e,r,n,i){for(var o=0,a=e;a<e+i;a++)r[n+o]=t[a],o++},cu.getProperty=function(t){return{"line.separator":"\n"}[t]};function fu(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],r=arguments[1];this.x=e,this.y=r,this.w=1}else if(arguments[0]instanceof fu&&arguments[1]instanceof fu){var n=arguments[0],i=arguments[1];this.x=n.y*i.w-i.y*n.w,this.y=i.x*n.w-n.x*i.w,this.w=n.x*i.y-i.x*n.y}else if(arguments[0]instanceof qs&&arguments[1]instanceof qs){var o=arguments[0],a=arguments[1];this.x=o.y-a.y,this.y=a.x-o.x,this.w=o.x*a.y-a.x*o.y}}else if(3===arguments.length){var s=arguments[0],u=arguments[1],c=arguments[2];this.x=s,this.y=u,this.w=c}else if(4===arguments.length){var l=arguments[0],h=arguments[1],p=arguments[2],f=arguments[3],d=l.y-h.y,m=h.x-l.x,g=l.x*h.y-h.x*l.y,y=p.y-f.y,v=f.x-p.x,_=p.x*f.y-f.x*p.y;this.x=m*_-v*g,this.y=y*g-d*_,this.w=d*v-y*m}}fu.prototype.getY=function(){var t=this.y/this.w;if(Fs.isNaN(t)||Fs.isInfinite(t))throw new hu;return t},fu.prototype.getX=function(){var t=this.x/this.w;if(Fs.isNaN(t)||Fs.isInfinite(t))throw new hu;return t},fu.prototype.getCoordinate=function(){var t=new qs;return t.x=this.getX(),t.y=this.getY(),t},fu.prototype.interfaces_=function(){return[]},fu.prototype.getClass=function(){return fu},fu.intersection=function(t,e,r,n){var i=t.y-e.y,o=e.x-t.x,a=t.x*e.y-e.x*t.y,s=r.y-n.y,u=n.x-r.x,c=r.x*n.y-n.x*r.y,l=i*u-s*o,h=(o*c-u*a)/l,p=(s*a-i*c)/l;if(Fs.isNaN(h)||Fs.isInfinite(h)||Fs.isNaN(p)||Fs.isInfinite(p))throw new hu;return new qs(h,p)};function du(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof qs){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof du){var e=arguments[0];this.init(e)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.init(r.x,n.x,r.y,n.y)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];this.init(i,o,a,s)}}var mu={serialVersionUID:{configurable:!0}};du.prototype.getArea=function(){return this.getWidth()*this.getHeight()},du.prototype.equals=function(t){if(!(t instanceof du))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()},du.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new du;var e=this._minx>t._minx?this._minx:t._minx,r=this._miny>t._miny?this._miny:t._miny,n=this._maxx<t._maxx?this._maxx:t._maxx,i=this._maxy<t._maxy?this._maxy:t._maxy;return new du(e,n,r,i)},du.prototype.isNull=function(){return this._maxx<this._minx},du.prototype.getMaxX=function(){return this._maxx},du.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof qs){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof du){var e=arguments[0];return!this.isNull()&&!e.isNull()&&e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];return!this.isNull()&&r>=this._minx&&r<=this._maxx&&n>=this._miny&&n<=this._maxy}},du.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof du){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof qs){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];return!this.isNull()&&!(r>this._maxx||r<this._minx||n>this._maxy||n<this._miny)}},du.prototype.getMinY=function(){return this._miny},du.prototype.getMinX=function(){return this._minx},du.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof qs){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof du){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.isNull()?(this._minx=r,this._maxx=r,this._miny=n,this._maxy=n):(r<this._minx&&(this._minx=r),r>this._maxx&&(this._maxx=r),n<this._miny&&(this._miny=n),n>this._maxy&&(this._maxy=n))}},du.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},du.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},du.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0},du.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},du.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},du.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},du.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},du.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return e<t?t:e},du.prototype.expandBy=function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=r,this._maxy+=r,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},du.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof du){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof qs){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];return this.covers(r,n)}},du.prototype.centre=function(){return this.isNull()?null:new qs((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},du.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof qs){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof du){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.init(r.x,n.x,r.y,n.y)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];i<o?(this._minx=i,this._maxx=o):(this._minx=o,this._maxx=i),a<s?(this._miny=a,this._maxy=s):(this._miny=s,this._maxy=a)}},du.prototype.getMaxY=function(){return this._maxy},du.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var r=0;return this._maxy<t._miny?r=t._miny-this._maxy:this._miny>t._maxy&&(r=this._miny-t._maxy),0===e?r:0===r?e:Math.sqrt(e*e+r*r)},du.prototype.hashCode=function(){var t=17;return 37*(t=37*(t=37*(t=37*t+qs.hashCode(this._minx))+qs.hashCode(this._maxx))+qs.hashCode(this._miny))+qs.hashCode(this._maxy)},du.prototype.interfaces_=function(){return[Us,pi]},du.prototype.getClass=function(){return du},du.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],r=arguments[2];return r.x>=(t.x<e.x?t.x:e.x)&&r.x<=(t.x>e.x?t.x:e.x)&&r.y>=(t.y<e.y?t.y:e.y)&&r.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3],s=Math.min(o.x,a.x),u=Math.max(o.x,a.x),c=Math.min(n.x,i.x),l=Math.max(n.x,i.x);return!(u<c||l<s||(s=Math.min(o.y,a.y),u=Math.max(o.y,a.y),c=Math.min(n.y,i.y),l=Math.max(n.y,i.y),u<c||l<s))}},mu.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(du,mu);function gu(t){this.geometryFactory=t||new al}var yu={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};gu.prototype.read=function(t){var e,r,n;t=t.replace(/[\n\r]/g," ");var i=yu.typeStr.exec(t);if(-1!==t.search("EMPTY")&&((i=yu.emptyTypeStr.exec(t))[2]=void 0),i&&(r=i[1].toLowerCase(),n=i[2],bu[r]&&(e=bu[r].apply(this,[n]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},gu.prototype.write=function(t){return this.extractGeometry(t)},gu.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!_u[e])return null;var r=e.toUpperCase();return t.isEmpty()?r+" EMPTY":r+"("+_u[e].apply(this,[t])+")"};function vu(t){this.parser=new gu(t)}var _u={coordinate:function(t){return t.x+" "+t.y},point:function(t){return _u.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=[],r=0,n=t._geometries.length;r<n;++r)e.push("("+_u.point.apply(this,[t._geometries[r]])+")");return e.join(",")},linestring:function(t){for(var e=[],r=0,n=t._points._coordinates.length;r<n;++r)e.push(_u.coordinate.apply(this,[t._points._coordinates[r]]));return e.join(",")},linearring:function(t){for(var e=[],r=0,n=t._points._coordinates.length;r<n;++r)e.push(_u.coordinate.apply(this,[t._points._coordinates[r]]));return e.join(",")},multilinestring:function(t){for(var e=[],r=0,n=t._geometries.length;r<n;++r)e.push("("+_u.linestring.apply(this,[t._geometries[r]])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+_u.linestring.apply(this,[t._shell])+")");for(var r=0,n=t._holes.length;r<n;++r)e.push("("+_u.linestring.apply(this,[t._holes[r]])+")");return e.join(",")},multipolygon:function(t){for(var e=[],r=0,n=t._geometries.length;r<n;++r)e.push("("+_u.polygon.apply(this,[t._geometries[r]])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],r=0,n=t._geometries.length;r<n;++r)e.push(this.extractGeometry(t._geometries[r]));return e.join(",")}},bu={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split(yu.spaces);return this.geometryFactory.createPoint(new qs(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){if(void 0===t)return this.geometryFactory.createMultiPoint();for(var e,r=t.trim().split(","),n=[],i=0,o=r.length;i<o;++i)e=r[i].replace(yu.trimParens,"$1"),n.push(bu.point.apply(this,[e]));return this.geometryFactory.createMultiPoint(n)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,r=t.trim().split(","),n=[],i=0,o=r.length;i<o;++i)e=r[i].trim().split(yu.spaces),n.push(new qs(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(n)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,r=t.trim().split(","),n=[],i=0,o=r.length;i<o;++i)e=r[i].trim().split(yu.spaces),n.push(new qs(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(t){if(void 0===t)return this.geometryFactory.createMultiLineString();for(var e,r=t.trim().split(yu.parenComma),n=[],i=0,o=r.length;i<o;++i)e=r[i].replace(yu.trimParens,"$1"),n.push(bu.linestring.apply(this,[e]));return this.geometryFactory.createMultiLineString(n)},polygon:function(t){if(void 0===t)return this.geometryFactory.createPolygon();for(var e,r,n,i,o=t.trim().split(yu.parenComma),a=[],s=0,u=o.length;s<u;++s)e=o[s].replace(yu.trimParens,"$1"),r=bu.linestring.apply(this,[e]),n=this.geometryFactory.createLinearRing(r._points),0===s?i=n:a.push(n);return this.geometryFactory.createPolygon(i,a)},multipolygon:function(t){if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var e,r=t.trim().split(yu.doubleParenComma),n=[],i=0,o=r.length;i<o;++i)e=r[i].replace(yu.trimParens,"$1"),n.push(bu.polygon.apply(this,[e]));return this.geometryFactory.createMultiPolygon(n)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();for(var e=(t=t.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),r=[],n=0,i=e.length;n<i;++n)r.push(this.read(e[n]));return this.geometryFactory.createGeometryCollection(r)}};vu.prototype.write=function(t){return this.parser.write(t)},vu.toLineString=function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};function xu(){}var wu,Su,Eu=((Su=Error)&&(Tu.__proto__=Su),(Tu.prototype=Object.create(Su&&Su.prototype)).constructor=Tu),Cu=((wu=Eu)&&(Mu.__proto__=wu),((Mu.prototype=Object.create(wu&&wu.prototype)).constructor=Mu).prototype.interfaces_=function(){return[]},Mu.prototype.getClass=function(){return Mu},Mu);function Mu(){if(wu.call(this),0===arguments.length)wu.call(this);else if(1===arguments.length){var t=arguments[0];wu.call(this,t)}}function Tu(t){Su.call(this,t),this.name="RuntimeException",this.message=t,this.stack=(new Su).stack}xu.prototype.interfaces_=function(){return[]},xu.prototype.getClass=function(){return xu},xu.shouldNeverReachHere=function(){if(0===arguments.length)xu.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new Cu("Should never reach here"+(null!==t?": "+t:""))}},xu.isTrue=function(){var t;if(1===arguments.length)xu.isTrue(arguments[0],null);else if(2===arguments.length&&(t=arguments[1],!arguments[0]))throw null===t?new Cu:new Cu(t)},xu.equals=function(){var t,e,r;if(2===arguments.length)xu.equals(t=arguments[0],e=arguments[1],null);else if(3===arguments.length&&(t=arguments[0],r=arguments[2],!(e=arguments[1]).equals(t)))throw new Cu("Expected "+t+" but encountered "+e+(null!==r?": "+r:""))};function Pu(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new qs,this._intPt[1]=new qs,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}var Ou={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Pu.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]},Pu.prototype.getTopologySummary=function(){var t=new Qs;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},Pu.prototype.computeIntersection=function(t,e,r,n){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=r,this._inputLines[1][1]=n,this._result=this.computeIntersect(t,e,r,n)},Pu.prototype.getIntersectionNum=function(){return this._result},Pu.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0];this.getEdgeDistance(t,0)>this.getEdgeDistance(t,1)?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}},Pu.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},Pu.prototype.setPrecisionModel=function(t){this._precisionModel=t},Pu.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=arguments[0],e=0;e<this._result;e++)if(!this._intPt[e].equals2D(this._inputLines[t][0])&&!this._intPt[e].equals2D(this._inputLines[t][1]))return!0;return!1}},Pu.prototype.getIntersection=function(t){return this._intPt[t]},Pu.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},Pu.prototype.hasIntersection=function(){return this._result!==Pu.NO_INTERSECTION},Pu.prototype.getEdgeDistance=function(t,e){return Pu.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])},Pu.prototype.isCollinear=function(){return this._result===Pu.COLLINEAR_INTERSECTION},Pu.prototype.toString=function(){return vu.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+vu.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},Pu.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]},Pu.prototype.isIntersection=function(t){for(var e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1},Pu.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]},Pu.prototype.interfaces_=function(){return[]},Pu.prototype.getClass=function(){return Pu},Pu.computeEdgeDistance=function(t,e,r){var n=Math.abs(r.x-e.x),i=Math.abs(r.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(r))o=i<n?n:i;else{var a=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);0!==(o=i<n?a:s)||t.equals(e)||(o=Math.max(a,s))}return xu.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o},Pu.nonRobustComputeEdgeDistance=function(t,e,r){var n=t.x-e.x,i=t.y-e.y,o=Math.sqrt(n*n+i*i);return xu.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o},Ou.DONT_INTERSECT.get=function(){return 0},Ou.DO_INTERSECT.get=function(){return 1},Ou.COLLINEAR.get=function(){return 2},Ou.NO_INTERSECTION.get=function(){return 0},Ou.POINT_INTERSECTION.get=function(){return 1},Ou.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(Pu,Ou);function Au(){}var Iu,Lu=((Iu=Pu)&&(Ru.__proto__=Iu),((Ru.prototype=Object.create(Iu&&Iu.prototype)).constructor=Ru).prototype.isInSegmentEnvelopes=function(t){var e=new du(this._inputLines[0][0],this._inputLines[0][1]),r=new du(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&r.contains(t)},Ru.prototype.computeIntersection=function(){if(3!==arguments.length)return Iu.prototype.computeIntersection.apply(this,arguments);var t=arguments[0],e=arguments[1],r=arguments[2];if(this._isProper=!1,du.intersects(e,r,t)&&0===ku.orientationIndex(e,r,t)&&0===ku.orientationIndex(r,e,t))return this._isProper=!0,(t.equals(e)||t.equals(r))&&(this._isProper=!1),this._result=Iu.POINT_INTERSECTION,null;this._result=Iu.NO_INTERSECTION},Ru.prototype.normalizeToMinimum=function(t,e,r,n,i){i.x=this.smallestInAbsValue(t.x,e.x,r.x,n.x),i.y=this.smallestInAbsValue(t.y,e.y,r.y,n.y),t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,r.x-=i.x,r.y-=i.y,n.x-=i.x,n.y-=i.y},Ru.prototype.safeHCoordinateIntersection=function(e,r,n,i){var o=null;try{o=fu.intersection(e,r,n,i)}catch(t){if(!(t instanceof hu))throw t;o=Ru.nearestEndpoint(e,r,n,i)}return o},Ru.prototype.intersection=function(t,e,r,n){var i=this.intersectionWithNormalization(t,e,r,n);return this.isInSegmentEnvelopes(i)||(i=new qs(Ru.nearestEndpoint(t,e,r,n))),null!==this._precisionModel&&this._precisionModel.makePrecise(i),i},Ru.prototype.smallestInAbsValue=function(t,e,r,n){var i=t,o=Math.abs(i);return Math.abs(e)<o&&(i=e,o=Math.abs(e)),Math.abs(r)<o&&(i=r,o=Math.abs(r)),Math.abs(n)<o&&(i=n),i},Ru.prototype.checkDD=function(t,e,r,n,i){var o=iu.intersection(t,e,r,n),a=this.isInSegmentEnvelopes(o);cu.out.println("DD in env = "+a+"  --------------------- "+o),1e-4<i.distance(o)&&cu.out.println("Distance = "+i.distance(o))},Ru.prototype.intersectionWithNormalization=function(t,e,r,n){var i=new qs(t),o=new qs(e),a=new qs(r),s=new qs(n),u=new qs;this.normalizeToEnvCentre(i,o,a,s,u);var c=this.safeHCoordinateIntersection(i,o,a,s);return c.x+=u.x,c.y+=u.y,c},Ru.prototype.computeCollinearIntersection=function(t,e,r,n){var i=du.intersects(t,e,r),o=du.intersects(t,e,n),a=du.intersects(r,n,t),s=du.intersects(r,n,e);return i&&o?(this._intPt[0]=r,this._intPt[1]=n,Iu.COLLINEAR_INTERSECTION):a&&s?(this._intPt[0]=t,this._intPt[1]=e,Iu.COLLINEAR_INTERSECTION):i&&a?(this._intPt[0]=r,this._intPt[1]=t,!r.equals(t)||o||s?Iu.COLLINEAR_INTERSECTION:Iu.POINT_INTERSECTION):i&&s?(this._intPt[0]=r,this._intPt[1]=e,!r.equals(e)||o||a?Iu.COLLINEAR_INTERSECTION:Iu.POINT_INTERSECTION):o&&a?(this._intPt[0]=n,this._intPt[1]=t,!n.equals(t)||i||s?Iu.COLLINEAR_INTERSECTION:Iu.POINT_INTERSECTION):o&&s?(this._intPt[0]=n,this._intPt[1]=e,!n.equals(e)||i||a?Iu.COLLINEAR_INTERSECTION:Iu.POINT_INTERSECTION):Iu.NO_INTERSECTION},Ru.prototype.normalizeToEnvCentre=function(t,e,r,n,i){var o=t.x<e.x?t.x:e.x,a=t.y<e.y?t.y:e.y,s=t.x>e.x?t.x:e.x,u=t.y>e.y?t.y:e.y,c=r.x<n.x?r.x:n.x,l=r.y<n.y?r.y:n.y,h=r.x>n.x?r.x:n.x,p=r.y>n.y?r.y:n.y,f=((c<o?o:c)+(s<h?s:h))/2,d=((l<a?a:l)+(u<p?u:p))/2;i.x=f,i.y=d,t.x-=i.x,t.y-=i.y,e.x-=i.x,e.y-=i.y,r.x-=i.x,r.y-=i.y,n.x-=i.x,n.y-=i.y},Ru.prototype.computeIntersect=function(t,e,r,n){if(this._isProper=!1,!du.intersects(t,e,r,n))return Iu.NO_INTERSECTION;var i=ku.orientationIndex(t,e,r),o=ku.orientationIndex(t,e,n);if(0<i&&0<o||i<0&&o<0)return Iu.NO_INTERSECTION;var a=ku.orientationIndex(r,n,t),s=ku.orientationIndex(r,n,e);return 0<a&&0<s||a<0&&s<0?Iu.NO_INTERSECTION:0===i&&0===o&&0===a&&0===s?this.computeCollinearIntersection(t,e,r,n):(0===i||0===o||0===a||0===s?(this._isProper=!1,t.equals2D(r)||t.equals2D(n)?this._intPt[0]=t:e.equals2D(r)||e.equals2D(n)?this._intPt[0]=e:0===i?this._intPt[0]=new qs(r):0===o?this._intPt[0]=new qs(n):0===a?this._intPt[0]=new qs(t):0===s&&(this._intPt[0]=new qs(e))):(this._isProper=!0,this._intPt[0]=this.intersection(t,e,r,n)),Iu.POINT_INTERSECTION)},Ru.prototype.interfaces_=function(){return[]},Ru.prototype.getClass=function(){return Ru},Ru.nearestEndpoint=function(t,e,r,n){var i=t,o=ku.distancePointLine(t,r,n),a=ku.distancePointLine(e,r,n);return a<o&&(o=a,i=e),(a=ku.distancePointLine(r,t,e))<o&&(o=a,i=r),(a=ku.distancePointLine(n,t,e))<o&&(o=a,i=n),i},Ru);function Ru(){Iu.apply(this,arguments)}Au.prototype.interfaces_=function(){return[]},Au.prototype.getClass=function(){return Au},Au.orientationIndex=function(t,e,r){var n=e.x-t.x,i=e.y-t.y,o=r.x-e.x,a=r.y-e.y;return Au.signOfDet2x2(n,i,o,a)},Au.signOfDet2x2=function(t,e,r,n){var i=null,o=null,a=null;if(i=1,0===t||0===n)return 0===e||0===r?0:0<e?0<r?-i:i:0<r?i:-i;if(0===e||0===r)return 0<n?0<t?i:-i:0<t?-i:i;if(0<e?0<n?e<=n||(i=-i,o=t,t=r,r=o,o=e,e=n,n=o):n=e<=-n?(i=-i,r=-r,-n):(o=t,t=-r,r=o,o=e,e=-n,o):0<n?-e<=n?(i=-i,t=-t,e=-e):(o=-t,t=r,r=o,o=-e,e=n,n=o):n=n<=e?(t=-t,e=-e,r=-r,-n):(i=-i,o=-t,t=-r,r=o,o=-e,e=-n,o),0<t){if(!(0<r))return i;if(!(t<=r))return i}else{if(0<r)return-i;if(!(r<=t))return-i;i=-i,t=-t,r=-r}for(;;){if((n-=(a=Math.floor(r/t))*e)<0)return-i;if(e<n)return i;if((r-=a*t)+r<t){if(e<n+n)return i}else{if(n+n<e)return-i;r=t-r,n=e-n,i=-i}if(0===n)return 0===r?0:-i;if(0===r)return i;if((e-=(a=Math.floor(t/r))*n)<0)return i;if(n<e)return-i;if((t-=a*r)+t<r){if(n<e+e)return-i}else{if(e+e<n)return i;t=r-t,e=n-e,i=-i}if(0===e)return 0===t?0:i;if(0===t)return-i}};function Nu(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t}Nu.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var r=t.x,n=e.x;return n<r&&(r=e.x,n=t.x),this._p.x>=r&&this._p.x<=n&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var i=t.x-this._p.x,o=t.y-this._p.y,a=e.x-this._p.x,s=e.y-this._p.y,u=Au.signOfDet2x2(i,o,a,s);if(0===u)return this._isPointOnSegment=!0,null;s<o&&(u=-u),0<u&&this._crossingCount++}},Nu.prototype.isPointInPolygon=function(){return this.getLocation()!==Xs.EXTERIOR},Nu.prototype.getLocation=function(){return this._isPointOnSegment?Xs.BOUNDARY:this._crossingCount%2==1?Xs.INTERIOR:Xs.EXTERIOR},Nu.prototype.isOnSegment=function(){return this._isPointOnSegment},Nu.prototype.interfaces_=function(){return[]},Nu.prototype.getClass=function(){return Nu},Nu.locatePointInRing=function(){if(arguments[0]instanceof qs&&Zs(arguments[1],au)){for(var t=arguments[1],e=new Nu(arguments[0]),r=new qs,n=new qs,i=1;i<t.size();i++)if(t.getCoordinate(i,r),t.getCoordinate(i-1,n),e.countSegment(r,n),e.isOnSegment())return e.getLocation();return e.getLocation()}if(arguments[0]instanceof qs&&arguments[1]instanceof Array){for(var o=arguments[1],a=new Nu(arguments[0]),s=1;s<o.length;s++){var u=o[s],c=o[s-1];if(a.countSegment(u,c),a.isOnSegment())return a.getLocation()}return a.getLocation()}};var ku=function(){},Du={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};ku.prototype.interfaces_=function(){return[]},ku.prototype.getClass=function(){return ku},ku.orientationIndex=function(t,e,r){return iu.orientationIndex(t,e,r)},ku.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,r=t[0].x,n=1;n<t.length-1;n++){var i=t[n].x-r,o=t[n+1].y;e+=i*(t[n-1].y-o)}return e/2}if(Zs(arguments[0],au)){var a=arguments[0],s=a.size();if(s<3)return 0;var u=new qs,c=new qs,l=new qs;a.getCoordinate(0,c),a.getCoordinate(1,l);var h=c.x;l.x-=h;for(var p=0,f=1;f<s-1;f++)u.y=c.y,c.x=l.x,c.y=l.y,a.getCoordinate(f+1,l),l.x-=h,p+=c.x*(u.y-l.y);return p/2}},ku.distanceLineLine=function(t,e,r,n){if(t.equals(e))return ku.distancePointLine(t,r,n);if(r.equals(n))return ku.distancePointLine(n,t,e);var i=!1;if(du.intersects(t,e,r,n)){var o=(e.x-t.x)*(n.y-r.y)-(e.y-t.y)*(n.x-r.x);if(0==o)i=!0;else{var a=(t.y-r.y)*(n.x-r.x)-(t.x-r.x)*(n.y-r.y),s=((t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y))/o,u=a/o;(u<0||1<u||s<0||1<s)&&(i=!0)}}else i=!0;return i?Ks.min(ku.distancePointLine(t,r,n),ku.distancePointLine(e,r,n),ku.distancePointLine(r,t,e),ku.distancePointLine(n,t,e)):0},ku.isPointInRing=function(t,e){return ku.locatePointInRing(t,e)!==Xs.EXTERIOR},ku.computeLength=function(t){var e=t.size();if(e<=1)return 0;var r=0,n=new qs;t.getCoordinate(0,n);for(var i=n.x,o=n.y,a=1;a<e;a++){t.getCoordinate(a,n);var s=n.x,u=n.y,c=s-i,l=u-o;r+=Math.sqrt(c*c+l*l),i=s,o=u}return r},ku.isCCW=function(t){var e=t.length-1;if(e<3)throw new zs("Ring has fewer than 4 points, so orientation cannot be determined");for(var r=t[0],n=0,i=1;i<=e;i++){var o=t[i];o.y>r.y&&(r=o,n=i)}for(var a=n;(a-=1)<0&&(a=e),t[a].equals2D(r)&&a!==n;);for(var s=n;t[s=(s+1)%e].equals2D(r)&&s!==n;);var u=t[a],c=t[s];if(u.equals2D(r)||c.equals2D(r)||u.equals2D(c))return!1;var l=ku.computeOrientation(u,r,c);return 0===l?u.x>c.x:0<l},ku.locatePointInRing=function(t,e){return Nu.locatePointInRing(t,e)},ku.distancePointLinePerpendicular=function(t,e,r){var n=(r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y),i=((e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y))/n;return Math.abs(i)*Math.sqrt(n)},ku.computeOrientation=function(t,e,r){return ku.orientationIndex(t,e,r)},ku.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new zs("Line array must contain at least one vertex");for(var r=t.distance(e[0]),n=0;n<e.length-1;n++){var i=ku.distancePointLine(t,e[n],e[n+1]);i<r&&(r=i)}return r}if(3===arguments.length){var o=arguments[0],a=arguments[1],s=arguments[2];if(a.x===s.x&&a.y===s.y)return o.distance(a);var u=(s.x-a.x)*(s.x-a.x)+(s.y-a.y)*(s.y-a.y),c=((o.x-a.x)*(s.x-a.x)+(o.y-a.y)*(s.y-a.y))/u;if(c<=0)return o.distance(a);if(1<=c)return o.distance(s);var l=((a.y-o.y)*(s.x-a.x)-(a.x-o.x)*(s.y-a.y))/u;return Math.abs(l)*Math.sqrt(u)}},ku.isOnLine=function(t,e){for(var r=new Lu,n=1;n<e.length;n++){var i=e[n-1],o=e[n];if(r.computeIntersection(t,i,o),r.hasIntersection())return!0}return!1},Du.CLOCKWISE.get=function(){return-1},Du.RIGHT.get=function(){return ku.CLOCKWISE},Du.COUNTERCLOCKWISE.get=function(){return 1},Du.LEFT.get=function(){return ku.COUNTERCLOCKWISE},Du.COLLINEAR.get=function(){return 0},Du.STRAIGHT.get=function(){return ku.COLLINEAR},Object.defineProperties(ku,Du);function ju(){}ju.prototype.filter=function(t){},ju.prototype.interfaces_=function(){return[]},ju.prototype.getClass=function(){return ju};function zu(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()}var Fu={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};zu.prototype.isGeometryCollection=function(){return this.getSortIndex()===zu.SORTINDEX_GEOMETRYCOLLECTION},zu.prototype.getFactory=function(){return this._factory},zu.prototype.getGeometryN=function(t){return this},zu.prototype.getArea=function(){return 0},zu.prototype.isRectangle=function(){return!1},zu.prototype.equals=function(){if(arguments[0]instanceof zu){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof zu))return!1;var r=e;return this.equalsExact(r)}},zu.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)},zu.prototype.geometryChanged=function(){this.apply(zu.geometryChangedFilter)},zu.prototype.geometryChangedAction=function(){this._envelope=null},zu.prototype.equalsNorm=function(t){return null!==t&&this.norm().equalsExact(t.norm())},zu.prototype.getLength=function(){return 0},zu.prototype.getNumGeometries=function(){return 1},zu.prototype.compareTo=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var r=arguments[0],n=arguments[1];return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(r,n)}},zu.prototype.getUserData=function(){return this._userData},zu.prototype.getSRID=function(){return this._SRID},zu.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},zu.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===zu.SORTINDEX_GEOMETRYCOLLECTION)throw new zs("This method does not support GeometryCollection arguments")},zu.prototype.equal=function(t,e,r){return 0===r?t.equals(e):t.distance(e)<=r},zu.prototype.norm=function(){var t=this.copy();return t.normalize(),t},zu.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},zu.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new du(this._envelope)},zu.prototype.setSRID=function(t){this._SRID=t},zu.prototype.setUserData=function(t){this._userData=t},zu.prototype.compare=function(t,e){for(var r=t.iterator(),n=e.iterator();r.hasNext()&&n.hasNext();){var i=r.next(),o=n.next(),a=i.compareTo(o);if(0!==a)return a}return r.hasNext()?1:n.hasNext()?-1:0},zu.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},zu.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===zu.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===zu.SORTINDEX_MULTIPOINT||this.getSortIndex()===zu.SORTINDEX_MULTILINESTRING||this.getSortIndex()===zu.SORTINDEX_MULTIPOLYGON},zu.prototype.interfaces_=function(){return[Vs,Us,pi]},zu.prototype.getClass=function(){return zu},zu.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},zu.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},Fu.serialVersionUID.get=function(){return 0x799ea46522854c00},Fu.SORTINDEX_POINT.get=function(){return 0},Fu.SORTINDEX_MULTIPOINT.get=function(){return 1},Fu.SORTINDEX_LINESTRING.get=function(){return 2},Fu.SORTINDEX_LINEARRING.get=function(){return 3},Fu.SORTINDEX_MULTILINESTRING.get=function(){return 4},Fu.SORTINDEX_POLYGON.get=function(){return 5},Fu.SORTINDEX_MULTIPOLYGON.get=function(){return 6},Fu.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},Fu.geometryChangedFilter.get=function(){return Bu},Object.defineProperties(zu,Fu);var Bu=function(){};Bu.interfaces_=function(){return[ju]},Bu.filter=function(t){t.geometryChangedAction()};function Uu(){}Uu.prototype.filter=function(t){},Uu.prototype.interfaces_=function(){return[]},Uu.prototype.getClass=function(){return Uu};function Vu(){}var Gu={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Vu.prototype.isInBoundary=function(t){},Vu.prototype.interfaces_=function(){return[]},Vu.prototype.getClass=function(){return Vu},Gu.Mod2BoundaryNodeRule.get=function(){return qu},Gu.EndPointBoundaryNodeRule.get=function(){return Hu},Gu.MultiValentEndPointBoundaryNodeRule.get=function(){return $u},Gu.MonoValentEndPointBoundaryNodeRule.get=function(){return Wu},Gu.MOD2_BOUNDARY_RULE.get=function(){return new qu},Gu.ENDPOINT_BOUNDARY_RULE.get=function(){return new Hu},Gu.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new $u},Gu.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Wu},Gu.OGC_SFS_BOUNDARY_RULE.get=function(){return Vu.MOD2_BOUNDARY_RULE},Object.defineProperties(Vu,Gu);var qu=function(){};qu.prototype.isInBoundary=function(t){return t%2==1},qu.prototype.interfaces_=function(){return[Vu]},qu.prototype.getClass=function(){return qu};var Hu=function(){};Hu.prototype.isInBoundary=function(t){return 0<t},Hu.prototype.interfaces_=function(){return[Vu]},Hu.prototype.getClass=function(){return Hu};var $u=function(){};$u.prototype.isInBoundary=function(t){return 1<t},$u.prototype.interfaces_=function(){return[Vu]},$u.prototype.getClass=function(){return $u};var Wu=function(){};Wu.prototype.isInBoundary=function(t){return 1===t},Wu.prototype.interfaces_=function(){return[Vu]},Wu.prototype.getClass=function(){return Wu};function Xu(){}Xu.prototype.add=function(){},Xu.prototype.addAll=function(){},Xu.prototype.isEmpty=function(){},Xu.prototype.iterator=function(){},Xu.prototype.size=function(){},Xu.prototype.toArray=function(){},Xu.prototype.remove=function(){};function Yu(){}var Zu=function(e){function t(t){e.call(this),this.message=t||""}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={name:{configurable:!0}};return r.name.get=function(){return"IndexOutOfBoundsException"},Object.defineProperties(t,r),t}(Error);Yu.prototype.hasNext=function(){},Yu.prototype.next=function(){},Yu.prototype.remove=function(){};var Ku,Ju=((Ku=Xu)&&(Qu.__proto__=Ku),((Qu.prototype=Object.create(Ku&&Ku.prototype)).constructor=Qu).prototype.get=function(){},Qu.prototype.set=function(){},Qu.prototype.isEmpty=function(){},Qu);function Qu(){Ku.apply(this,arguments)}(fi.prototype=new Error).name="NoSuchElementException";function tc(){}var ec,rc,nc=((rc=Ju)&&(uc.__proto__=rc),((uc.prototype=Object.create(rc&&rc.prototype)).constructor=uc).prototype.ensureCapacity=function(){},uc.prototype.interfaces_=function(){return[rc,Xu]},uc.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(t,arguments[1]),!0},uc.prototype.clear=function(){this.array_=[]},uc.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},uc.prototype.set=function(t,e){var r=this.array_[t];return this.array_[t]=e,r},uc.prototype.iterator=function(){return new ic(this)},uc.prototype.get=function(t){if(t<0||t>=this.size())throw new Zu;return this.array_[t]},uc.prototype.isEmpty=function(){return 0===this.array_.length},uc.prototype.size=function(){return this.array_.length},uc.prototype.toArray=function(){for(var t=[],e=0,r=this.array_.length;e<r;e++)t.push(this.array_[e]);return t},uc.prototype.remove=function(t){for(var e=!1,r=0,n=this.array_.length;r<n;r++)if(this.array_[r]===t){this.array_.splice(r,1),e=!0;break}return e},uc),ic=((ec=Yu)&&(sc.__proto__=ec),((sc.prototype=Object.create(ec&&ec.prototype)).constructor=sc).prototype.next=function(){if(this.position_===this.arrayList_.size())throw new fi;return this.arrayList_.get(this.position_++)},sc.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},sc.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},sc.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},sc),oc=function(_){function t(){if(_.call(this),0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.ensureCapacity(t.length),this.add(t,!0)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this.ensureCapacity(e.length),this.add(e,r)}}_&&(t.__proto__=_),(t.prototype=Object.create(_&&_.prototype)).constructor=t;var e={coordArrayType:{configurable:!0}};return e.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(t){return this.get(t)},t.prototype.addAll=function(){if(2!==arguments.length)return _.prototype.addAll.apply(this,arguments);for(var t=arguments[1],e=!1,r=arguments[0].iterator();r.hasNext();)this.add(r.next(),t),e=!0;return e},t.prototype.clone=function(){for(var t=_.prototype.clone.call(this),e=0;e<this.size();e++)t.add(e,this.get(e).copy());return t},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){if(1===arguments.length){var t=arguments[0];_.prototype.add.call(this,t)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var e=arguments[0],r=arguments[1];return this.add(e,r,!0),!0}if(arguments[0]instanceof qs&&"boolean"==typeof arguments[1]){var n=arguments[0];if(!arguments[1]&&1<=this.size()&&this.get(this.size()-1).equals2D(n))return null;_.prototype.add.call(this,n)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var i=arguments[0],o=arguments[1];return this.add(i,o),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var a=arguments[0],s=arguments[1];if(arguments[2])for(var u=0;u<a.length;u++)this.add(a[u],s);else for(var c=a.length-1;0<=c;c--)this.add(a[c],s);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof qs){var l=arguments[0],h=arguments[1];if(!arguments[2]){var p=this.size();if(0<p){if(0<l&&this.get(l-1).equals2D(h))return null;if(l<p&&this.get(l).equals2D(h))return null}}_.prototype.add.call(this,l,h)}}else if(4===arguments.length){var f=arguments[0],d=arguments[1],m=arguments[2],g=arguments[3],y=1;g<m&&(y=-1);for(var v=m;v!==g;v+=y)this.add(f[v],d);return!0}},t.prototype.closeRing=function(){0<this.size()&&this.add(new qs(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,e),t}(nc),ac={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};function sc(t){ec.call(this),this.arrayList_=t,this.position_=0}function uc(){rc.call(this),this.array_=[],arguments[0]instanceof Xu&&this.addAll(arguments[0])}ac.ForwardComparator.get=function(){return cc},ac.BidirectionalComparator.get=function(){return lc},ac.coordArrayType.get=function(){return new Array(0).fill(null)},tc.prototype.interfaces_=function(){return[]},tc.prototype.getClass=function(){return tc},tc.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))},tc.ptNotInList=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(tc.indexOf(n,e)<0)return n}return null},tc.scroll=function(t,e){var r=tc.indexOf(e,t);if(r<0)return null;var n=new Array(t.length).fill(null);cu.arraycopy(t,r,n,0,t.length-r),cu.arraycopy(t,0,n,t.length-r,r),cu.arraycopy(n,0,t,0,t.length)},tc.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!t[r].equals(e[r]))return!1;return!0}if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2];if(n===i)return!0;if(null===n||null===i)return!1;if(n.length!==i.length)return!1;for(var a=0;a<n.length;a++)if(0!==o.compare(n[a],i[a]))return!1;return!0}},tc.intersection=function(t,e){for(var r=new oc,n=0;n<t.length;n++)e.intersects(t[n])&&r.add(t[n],!0);return r.toCoordinateArray()},tc.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},tc.removeRepeatedPoints=function(t){return tc.hasRepeatedPoints(t)?new oc(t,!1).toCoordinateArray():t},tc.reverse=function(t){for(var e=t.length-1,r=Math.trunc(e/2),n=0;n<=r;n++){var i=t[n];t[n]=t[e-n],t[e-n]=i}},tc.removeNull=function(t){for(var e=0,r=0;r<t.length;r++)null!==t[r]&&e++;var n=new Array(e).fill(null);if(0===e)return n;for(var i=0,o=0;o<t.length;o++)null!==t[o]&&(n[i++]=t[o]);return n},tc.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),r=0;r<t.length;r++)e[r]=new qs(t[r]);return e}if(5===arguments.length)for(var n=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3],s=arguments[4],u=0;u<s;u++)o[a+u]=new qs(n[i+u])},tc.isEqualReversed=function(t,e){for(var r=0;r<t.length;r++){var n=t[r],i=e[t.length-r-1];if(0!==n.compareTo(i))return!1}return!0},tc.envelope=function(t){for(var e=new du,r=0;r<t.length;r++)e.expandToInclude(t[r]);return e},tc.toCoordinateArray=function(t){return t.toArray(tc.coordArrayType)},tc.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},tc.indexOf=function(t,e){for(var r=0;r<e.length;r++)if(t.equals(e[r]))return r;return-1},tc.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var r=t.length-1-e,n=t[e].compareTo(t[r]);if(0!==n)return n}return 1},tc.compare=function(t,e){for(var r=0;r<t.length&&r<e.length;){var n=t[r].compareTo(e[r]);if(0!==n)return n;r++}return r<e.length?-1:r<t.length?1:0},tc.minCoordinate=function(t){for(var e=null,r=0;r<t.length;r++)(null===e||0<e.compareTo(t[r]))&&(e=t[r]);return e},tc.extract=function(t,e,r){e=Ks.clamp(e,0,t.length);var n=(r=Ks.clamp(r,-1,t.length))-e+1;r<0&&(n=0),e>=t.length&&(n=0),r<e&&(n=0);var i=new Array(n).fill(null);if(0===n)return i;for(var o=0,a=e;a<=r;a++)i[o++]=t[a];return i},Object.defineProperties(tc,ac);var cc=function(){};cc.prototype.compare=function(t,e){return tc.compare(t,e)},cc.prototype.interfaces_=function(){return[Gs]},cc.prototype.getClass=function(){return cc};var lc=function(){};lc.prototype.compare=function(t,e){var r=t,n=e;if(r.length<n.length)return-1;if(r.length>n.length)return 1;if(0===r.length)return 0;var i=tc.compare(r,n);return tc.isEqualReversed(r,n)?0:i},lc.prototype.OLDcompare=function(t,e){var r=t,n=e;if(r.length<n.length)return-1;if(r.length>n.length)return 1;if(0===r.length)return 0;for(var i=tc.increasingDirection(r),o=tc.increasingDirection(n),a=0<i?0:r.length-1,s=0<o?0:r.length-1,u=0;u<r.length;u++){var c=r[a].compareTo(n[s]);if(0!==c)return c;a+=i,s+=o}return 0},lc.prototype.interfaces_=function(){return[Gs]},lc.prototype.getClass=function(){return lc};function hc(){}hc.prototype.get=function(){},hc.prototype.put=function(){},hc.prototype.size=function(){},hc.prototype.values=function(){},hc.prototype.entrySet=function(){};var pc,fc=((pc=hc)&&(dc.__proto__=pc),(dc.prototype=Object.create(pc&&pc.prototype)).constructor=dc);function dc(){pc.apply(this,arguments)}(di.prototype=new Error).name="OperationNotSupported",(mi.prototype=new Xu).contains=function(){};var mc,gc,yc=((gc=mi)&&(xc.__proto__=gc),((xc.prototype=Object.create(gc&&gc.prototype)).constructor=xc).prototype.contains=function(t){for(var e=0,r=this.array_.length;e<r;e++)if(this.array_[e]===t)return!0;return!1},xc.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},xc.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},xc.prototype.remove=function(t){throw new Error},xc.prototype.size=function(){return this.array_.length},xc.prototype.isEmpty=function(){return 0===this.array_.length},xc.prototype.toArray=function(){for(var t=[],e=0,r=this.array_.length;e<r;e++)t.push(this.array_[e]);return t},xc.prototype.iterator=function(){return new vc(this)},xc),vc=((mc=Yu)&&(bc.__proto__=mc),((bc.prototype=Object.create(mc&&mc.prototype)).constructor=bc).prototype.next=function(){if(this.position_===this.hashSet_.size())throw new fi;return this.hashSet_.array_[this.position_++]},bc.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},bc.prototype.remove=function(){throw new di},bc),_c=0;function bc(t){mc.call(this),this.hashSet_=t,this.position_=0}function xc(){gc.call(this),this.array_=[],arguments[0]instanceof Xu&&this.addAll(arguments[0])}(xi.prototype=new fc).get=function(t){for(var e=this.root_;null!==e;){var r=t.compareTo(e.key);if(r<0)e=e.left;else{if(!(0<r))return e.value;e=e.right}}return null},xi.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:_c,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var r,n,i=this.root_;do{if(r=i,(n=t.compareTo(i.key))<0)i=i.left;else{if(!(0<n)){var o=i.value;return i.value=e,o}i=i.right}}while(null!==i);var a={key:t,left:null,right:null,value:e,parent:r,color:_c,getValue:function(){return this.value},getKey:function(){return this.key}};return n<0?r.left=a:r.right=a,this.fixAfterInsertion(a),this.size_++,null},xi.prototype.fixAfterInsertion=function(t){for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)if(yi(t)===_i(yi(yi(t)))){var e=bi(yi(yi(t)));1===gi(e)?(vi(yi(t),_c),vi(e,_c),vi(yi(yi(t)),1),t=yi(yi(t))):(t===bi(yi(t))&&(t=yi(t),this.rotateLeft(t)),vi(yi(t),_c),vi(yi(yi(t)),1),this.rotateRight(yi(yi(t))))}else{var r=_i(yi(yi(t)));1===gi(r)?(vi(yi(t),_c),vi(r,_c),vi(yi(yi(t)),1),t=yi(yi(t))):(t===_i(yi(t))&&(t=yi(t),this.rotateRight(t)),vi(yi(t),_c),vi(yi(yi(t)),1),this.rotateLeft(yi(yi(t))))}this.root_.color=_c},xi.prototype.values=function(){var t=new nc,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=xi.successor(e));)t.add(e.value);return t},xi.prototype.entrySet=function(){var t=new yc,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=xi.successor(e));)t.add(e);return t},xi.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,(e.left=t).parent=e}},xi.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,(e.right=t).parent=e}},xi.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},xi.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var r=t.parent,n=t;null!==r&&n===r.right;)r=(n=r).parent;return r},xi.prototype.size=function(){return this.size_};function wc(){}wc.prototype.interfaces_=function(){return[]},wc.prototype.getClass=function(){return wc},wi.prototype=new mi,(Si.prototype=new wi).contains=function(t){for(var e=0,r=this.array_.length;e<r;e++)if(0===this.array_[e].compareTo(t))return!0;return!1},Si.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,r=this.array_.length;e<r;e++)if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0;return this.array_.push(t),!0},Si.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},Si.prototype.remove=function(t){throw new di},Si.prototype.size=function(){return this.array_.length},Si.prototype.isEmpty=function(){return 0===this.array_.length},Si.prototype.toArray=function(){for(var t=[],e=0,r=this.array_.length;e<r;e++)t.push(this.array_[e]);return t},Si.prototype.iterator=function(){return new Sc(this)};var Sc=function(t){this.treeSet_=t,this.position_=0};Sc.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new fi;return this.treeSet_.array_[this.position_++]},Sc.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Sc.prototype.remove=function(){throw new di};function Ec(){}Ec.sort=function(){var t,e,r,n,i=arguments[0];if(1===arguments.length)n=function(t,e){return t.compareTo(e)},i.sort(n);else if(2===arguments.length)r=arguments[1],n=function(t,e){return r.compare(t,e)},i.sort(n);else if(3===arguments.length){(e=i.slice(arguments[1],arguments[2])).sort();var o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length));for(i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])}else if(4===arguments.length)for(e=i.slice(arguments[1],arguments[2]),r=arguments[3],n=function(t,e){return r.compare(t,e)},e.sort(n),o=i.slice(0,arguments[1]).concat(e,i.slice(arguments[2],i.length)),i.splice(0,i.length),t=0;t<o.length;t++)i.push(o[t])},Ec.asList=function(t){for(var e=new nc,r=0,n=t.length;r<n;r++)e.add(t[r]);return e};function Cc(){}var Mc={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Mc.P.get=function(){return 0},Mc.L.get=function(){return 1},Mc.A.get=function(){return 2},Mc.FALSE.get=function(){return-1},Mc.TRUE.get=function(){return-2},Mc.DONTCARE.get=function(){return-3},Mc.SYM_FALSE.get=function(){return"F"},Mc.SYM_TRUE.get=function(){return"T"},Mc.SYM_DONTCARE.get=function(){return"*"},Mc.SYM_P.get=function(){return"0"},Mc.SYM_L.get=function(){return"1"},Mc.SYM_A.get=function(){return"2"},Cc.prototype.interfaces_=function(){return[]},Cc.prototype.getClass=function(){return Cc},Cc.toDimensionSymbol=function(t){switch(t){case Cc.FALSE:return Cc.SYM_FALSE;case Cc.TRUE:return Cc.SYM_TRUE;case Cc.DONTCARE:return Cc.SYM_DONTCARE;case Cc.P:return Cc.SYM_P;case Cc.L:return Cc.SYM_L;case Cc.A:return Cc.SYM_A}throw new zs("Unknown dimension value: "+t)},Cc.toDimensionValue=function(t){switch(eu.toUpperCase(t)){case Cc.SYM_FALSE:return Cc.FALSE;case Cc.SYM_TRUE:return Cc.TRUE;case Cc.SYM_DONTCARE:return Cc.DONTCARE;case Cc.SYM_P:return Cc.P;case Cc.SYM_L:return Cc.L;case Cc.SYM_A:return Cc.A}throw new zs("Unknown dimension symbol: "+t)},Object.defineProperties(Cc,Mc);function Tc(){}Tc.prototype.filter=function(t){},Tc.prototype.interfaces_=function(){return[]},Tc.prototype.getClass=function(){return Tc};function Pc(){}Pc.prototype.filter=function(t,e){},Pc.prototype.isDone=function(){},Pc.prototype.isGeometryChanged=function(){},Pc.prototype.interfaces_=function(){return[]},Pc.prototype.getClass=function(){return Pc};var Oc=function(i){function r(t,e){if(i.call(this,e),this._geometries=t||[],i.hasNullElements(this._geometries))throw new zs("geometries must not contain null elements")}i&&(r.__proto__=i);var t={serialVersionUID:{configurable:!0}};return((r.prototype=Object.create(i&&i.prototype)).constructor=r).prototype.computeEnvelopeInternal=function(){for(var t=new du,e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t},r.prototype.getGeometryN=function(t){return this._geometries[t]},r.prototype.getSortIndex=function(){return i.SORTINDEX_GEOMETRYCOLLECTION},r.prototype.getCoordinates=function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,r=0;r<this._geometries.length;r++)for(var n=this._geometries[r].getCoordinates(),i=0;i<n.length;i++)t[++e]=n[i];return t},r.prototype.getArea=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t},r.prototype.equalsExact=function(){if(2!==arguments.length)return i.prototype.equalsExact.apply(this,arguments);var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var r=t;if(this._geometries.length!==r._geometries.length)return!1;for(var n=0;n<this._geometries.length;n++)if(!this._geometries[n].equalsExact(r._geometries[n],e))return!1;return!0},r.prototype.normalize=function(){for(var t=0;t<this._geometries.length;t++)this._geometries[t].normalize();Ec.sort(this._geometries)},r.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},r.prototype.getBoundaryDimension=function(){for(var t=Cc.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t},r.prototype.getDimension=function(){for(var t=Cc.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t},r.prototype.getLength=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t},r.prototype.getNumPoints=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t},r.prototype.getNumGeometries=function(){return this._geometries.length},r.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),r=0;r<this._geometries.length;r++)e[r]=this._geometries[r].reverse();return this.getFactory().createGeometryCollection(e)},r.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=new Si(Ec.asList(this._geometries)),r=new Si(Ec.asList(t._geometries));return this.compare(e,r)}if(2===arguments.length){for(var n=arguments[1],i=arguments[0],o=this.getNumGeometries(),a=i.getNumGeometries(),s=0;s<o&&s<a;){var u=this.getGeometryN(s),c=i.getGeometryN(s),l=u.compareToSameClass(c,n);if(0!==l)return l;s++}return s<o?1:s<a?-1:0}},r.prototype.apply=function(){if(Zs(arguments[0],Uu))for(var t=arguments[0],e=0;e<this._geometries.length;e++)this._geometries[e].apply(t);else if(Zs(arguments[0],Pc)){var r=arguments[0];if(0===this._geometries.length)return null;for(var n=0;n<this._geometries.length&&(this._geometries[n].apply(r),!r.isDone());n++);r.isGeometryChanged()&&this.geometryChanged()}else if(Zs(arguments[0],Tc)){var i=arguments[0];i.filter(this);for(var o=0;o<this._geometries.length;o++)this._geometries[o].apply(i)}else if(Zs(arguments[0],ju)){var a=arguments[0];a.filter(this);for(var s=0;s<this._geometries.length;s++)this._geometries[s].apply(a)}},r.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),xu.shouldNeverReachHere(),null},r.prototype.clone=function(){var t=i.prototype.clone.call(this);t._geometries=new Array(this._geometries.length).fill(null);for(var e=0;e<this._geometries.length;e++)t._geometries[e]=this._geometries[e].clone();return t},r.prototype.getGeometryType=function(){return"GeometryCollection"},r.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new r(t,this._factory)},r.prototype.isEmpty=function(){for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},t.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(r,t),r}(zu),Ac=function(r){function n(){r.apply(this,arguments)}r&&(n.__proto__=r);var t={serialVersionUID:{configurable:!0}};return((n.prototype=Object.create(r&&r.prototype)).constructor=n).prototype.getSortIndex=function(){return zu.SORTINDEX_MULTILINESTRING},n.prototype.equalsExact=function(){if(2!==arguments.length)return r.prototype.equalsExact.apply(this,arguments);var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&r.prototype.equalsExact.call(this,t,e)},n.prototype.getBoundaryDimension=function(){return this.isClosed()?Cc.FALSE:0},n.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0},n.prototype.getDimension=function(){return 1},n.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),r=0;r<this._geometries.length;r++)e[t-1-r]=this._geometries[r].reverse();return this.getFactory().createMultiLineString(e)},n.prototype.getBoundary=function(){return new Ic(this).getBoundary()},n.prototype.getGeometryType=function(){return"MultiLineString"},n.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new n(t,this._factory)},n.prototype.interfaces_=function(){return[wc]},n.prototype.getClass=function(){return n},t.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(n,t),n}(Oc),Ic=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var t=arguments[0],e=Vu.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this._geom=r,this._geomFact=r.getFactory(),this._bnRule=n}};Ic.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)},Ic.prototype.getBoundary=function(){return this._geom instanceof jc?this.boundaryLineString(this._geom):this._geom instanceof Ac?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Ic.prototype.boundaryLineString=function(t){return this._geom.isEmpty()?this.getEmptyMultiPoint():t.isClosed()?this._bnRule.isInBoundary(2)?t.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},Ic.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Ic.prototype.computeBoundaryCoordinates=function(t){var e=new nc;this._endpointMap=new xi;for(var r=0;r<t.getNumGeometries();r++){var n=t.getGeometryN(r);0!==n.getNumPoints()&&(this.addEndpoint(n.getCoordinateN(0)),this.addEndpoint(n.getCoordinateN(n.getNumPoints()-1)))}for(var i=this._endpointMap.entrySet().iterator();i.hasNext();){var o=i.next(),a=o.getValue().count;this._bnRule.isInBoundary(a)&&e.add(o.getKey())}return tc.toCoordinateArray(e)},Ic.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);null===e&&(e=new Lc,this._endpointMap.put(t,e)),e.count++},Ic.prototype.interfaces_=function(){return[]},Ic.prototype.getClass=function(){return Ic},Ic.getBoundary=function(){return 1===arguments.length?new Ic(arguments[0]).getBoundary():2===arguments.length?new Ic(arguments[0],arguments[1]).getBoundary():void 0};var Lc=function(){this.count=null};Lc.prototype.interfaces_=function(){return[]},Lc.prototype.getClass=function(){return Lc};function Rc(){}var Nc={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Rc.prototype.interfaces_=function(){return[]},Rc.prototype.getClass=function(){return Rc},Rc.chars=function(t,e){for(var r=new Array(e).fill(null),n=0;n<e;n++)r[n]=t;return String(r)},Rc.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new function(){},r=new function(){}(e);return t.printStackTrace(r),e.toString()}if(2===arguments.length){for(var n=arguments[1],i="",o=new function(){}(new function(){}(Rc.getStackTrace(arguments[0]))),a=0;a<n;a++)try{i+=o.readLine()+Rc.NEWLINE}catch(t){if(!(t instanceof Ei))throw t;xu.shouldNeverReachHere()}return i}},Rc.split=function(t,e){for(var r=e.length,n=new nc,i=""+t,o=i.indexOf(e);0<=o;){var a=i.substring(0,o);n.add(a),o=(i=i.substring(o+r)).indexOf(e)}0<i.length&&n.add(i);for(var s=new Array(n.size()).fill(null),u=0;u<s.length;u++)s[u]=n.get(u);return s},Rc.toString=function(){if(1===arguments.length){var t=arguments[0];return Rc.SIMPLE_ORDINATE_FORMAT.format(t)}},Rc.spaces=function(t){return Rc.chars(" ",t)},Nc.NEWLINE.get=function(){return cu.getProperty("line.separator")},Nc.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(Rc,Nc);function kc(){}kc.prototype.interfaces_=function(){return[]},kc.prototype.getClass=function(){return kc},kc.copyCoord=function(t,e,r,n){for(var i=Math.min(t.getDimension(),r.getDimension()),o=0;o<i;o++)r.setOrdinate(n,o,t.getOrdinate(e,o))},kc.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&t.getOrdinate(0,au.X)===t.getOrdinate(e-1,au.X)&&t.getOrdinate(0,au.Y)===t.getOrdinate(e-1,au.Y)},kc.isEqual=function(t,e){var r=t.size();if(r!==e.size())return!1;for(var n=Math.min(t.getDimension(),e.getDimension()),i=0;i<r;i++)for(var o=0;o<n;o++){var a=t.getOrdinate(i,o),s=e.getOrdinate(i,o);if(!(t.getOrdinate(i,o)===e.getOrdinate(i,o)||Fs.isNaN(a)&&Fs.isNaN(s)))return!1}return!0},kc.extend=function(t,e,r){var n=t.create(r,e.getDimension()),i=e.size();if(kc.copy(e,0,n,0,i),0<i)for(var o=i;o<r;o++)kc.copy(e,i-1,n,o,1);return n},kc.reverse=function(t){for(var e=t.size()-1,r=Math.trunc(e/2),n=0;n<=r;n++)kc.swap(t,n,e-n)},kc.swap=function(t,e,r){if(e===r)return null;for(var n=0;n<t.getDimension();n++){var i=t.getOrdinate(e,n);t.setOrdinate(e,n,t.getOrdinate(r,n)),t.setOrdinate(r,n,i)}},kc.copy=function(t,e,r,n,i){for(var o=0;o<i;o++)kc.copyCoord(t,e+o,r,n+o)},kc.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var r=t.getDimension(),n=new Qs;n.append("(");for(var i=0;i<e;i++){0<i&&n.append(" ");for(var o=0;o<r;o++)0<o&&n.append(","),n.append(Rc.toString(t.getOrdinate(i,o)))}return n.append(")"),n.toString()}},kc.ensureValidRing=function(t,e){var r=e.size();return 0===r?e:r<=3?kc.createClosedRing(t,e,4):e.getOrdinate(0,au.X)===e.getOrdinate(r-1,au.X)&&e.getOrdinate(0,au.Y)===e.getOrdinate(r-1,au.Y)?e:kc.createClosedRing(t,e,r+1)},kc.createClosedRing=function(t,e,r){var n=t.create(r,e.getDimension()),i=e.size();kc.copy(e,0,n,0,i);for(var o=i;o<r;o++)kc.copy(e,0,n,o,1);return n};function Dc(){}var jc=function(i){function e(t,e){i.call(this,e),this._points=null,this.init(t)}i&&(e.__proto__=i);var t={serialVersionUID:{configurable:!0}};return((e.prototype=Object.create(i&&i.prototype)).constructor=e).prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new du:this._points.expandEnvelope(new du)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return i.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){if(2!==arguments.length)return i.prototype.equalsExact.apply(this,arguments);var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var r=t;if(this._points.size()!==r._points.size())return!1;for(var n=0;n<this._points.size();n++)if(!this.equal(this._points.getCoordinate(n),r._points.getCoordinate(n),e))return!1;return!0},e.prototype.normalize=function(){for(var t=0;t<Math.trunc(this._points.size()/2);t++){var e=this._points.size()-1-t;if(!this._points.getCoordinate(t).equals(this._points.getCoordinate(e)))return 0<this._points.getCoordinate(t).compareTo(this._points.getCoordinate(e))&&kc.reverse(this._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Cc.FALSE:0},e.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return ku.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var t=this._points.copy();return kc.reverse(t),this.getFactory().createLineString(t)},e.prototype.compareToSameClass=function(){if(1===arguments.length){for(var t=arguments[0],e=0,r=0;e<this._points.size()&&r<t._points.size();){var n=this._points.getCoordinate(e).compareTo(t._points.getCoordinate(r));if(0!==n)return n;e++,r++}return e<this._points.size()?1:r<t._points.size()?-1:0}if(2===arguments.length){var i=arguments[0];return arguments[1].compare(this._points,i._points)}},e.prototype.apply=function(){if(Zs(arguments[0],Uu))for(var t=arguments[0],e=0;e<this._points.size();e++)t.filter(this._points.getCoordinate(e));else if(Zs(arguments[0],Pc)){var r=arguments[0];if(0===this._points.size())return null;for(var n=0;n<this._points.size()&&(r.filter(this._points,n),!r.isDone());n++);r.isGeometryChanged()&&this.geometryChanged()}else Zs(arguments[0],Tc)?arguments[0].filter(this):Zs(arguments[0],ju)&&arguments[0].filter(this)},e.prototype.getBoundary=function(){return new Ic(this).getBoundary()},e.prototype.isEquivalentClass=function(t){return t instanceof e},e.prototype.clone=function(){var t=i.prototype.clone.call(this);return t._points=this._points.clone(),t},e.prototype.getCoordinateN=function(t){return this._points.getCoordinate(t)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return 0===this._points.size()},e.prototype.init=function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new zs("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t},e.prototype.isCoordinate=function(t){for(var e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(t){return this.getFactory().createPoint(this._points.getCoordinate(t))},e.prototype.interfaces_=function(){return[wc]},e.prototype.getClass=function(){return e},t.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,t),e}(zu);Dc.prototype.interfaces_=function(){return[]},Dc.prototype.getClass=function(){return Dc};function zc(){}var Fc=function(r){function t(t,e){r.call(this,e),this._coordinates=t||null,this.init(this._coordinates)}r&&(t.__proto__=r);var e={serialVersionUID:{configurable:!0}};return((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new du;var t=new du;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t},t.prototype.getSortIndex=function(){return r.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(2!==arguments.length)return r.prototype.equalsExact.apply(this,arguments);var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&(!(!this.isEmpty()||!t.isEmpty())||this.isEmpty()===t.isEmpty()&&this.equal(t.getCoordinate(),this.getCoordinate(),e))},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return Cc.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0];return this.getCoordinate().compareTo(t.getCoordinate())}if(2===arguments.length){var e=arguments[0];return arguments[1].compare(this._coordinates,e._coordinates)}},t.prototype.apply=function(){if(Zs(arguments[0],Uu)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(Zs(arguments[0],Pc)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this._coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else Zs(arguments[0],Tc)?arguments[0].filter(this):Zs(arguments[0],ju)&&arguments[0].filter(this)},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var t=r.prototype.clone.call(this);return t._coordinates=this._coordinates.clone(),t},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return 0===this._coordinates.size()},t.prototype.init=function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),xu.isTrue(t.size()<=1),this._coordinates=t},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[Dc]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(t,e),t}(zu);zc.prototype.interfaces_=function(){return[]},zc.prototype.getClass=function(){return zc};function Bc(t){this._factory=t||null,this._isUserDataCopied=!1}var Uc=function(a){function n(t,e,r){if(a.call(this,r),this._shell=null,(this._holes=null)===t&&(t=this.getFactory().createLinearRing()),null===e&&(e=[]),a.hasNullElements(e))throw new zs("holes must not contain null elements");if(t.isEmpty()&&a.hasNonEmptyElements(e))throw new zs("shell is empty but holes are not");this._shell=t,this._holes=e}a&&(n.__proto__=a);var t={serialVersionUID:{configurable:!0}};return((n.prototype=Object.create(a&&a.prototype)).constructor=n).prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},n.prototype.getSortIndex=function(){return a.SORTINDEX_POLYGON},n.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,r=this._shell.getCoordinates(),n=0;n<r.length;n++)t[++e]=r[n];for(var i=0;i<this._holes.length;i++)for(var o=this._holes[i].getCoordinates(),a=0;a<o.length;a++)t[++e]=o[a];return t},n.prototype.getArea=function(){var t=0;t+=Math.abs(ku.signedArea(this._shell.getCoordinateSequence()));for(var e=0;e<this._holes.length;e++)t-=Math.abs(ku.signedArea(this._holes[e].getCoordinateSequence()));return t},n.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),r=0;r<5;r++){var n=t.getX(r);if(n!==e.getMinX()&&n!==e.getMaxX())return!1;var i=t.getY(r);if(i!==e.getMinY()&&i!==e.getMaxY())return!1}for(var o=t.getX(0),a=t.getY(0),s=1;s<=4;s++){var u=t.getX(s),c=t.getY(s);if(u!==o==(c!==a))return!1;o=u,a=c}return!0},n.prototype.equalsExact=function(){if(2!==arguments.length)return a.prototype.equalsExact.apply(this,arguments);var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var r=t,n=this._shell,i=r._shell;if(!n.equalsExact(i,e))return!1;if(this._holes.length!==r._holes.length)return!1;for(var o=0;o<this._holes.length;o++)if(!this._holes[o].equalsExact(r._holes[o],e))return!1;return!0},n.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var t=0;t<this._holes.length;t++)this.normalize(this._holes[t],!1);Ec.sort(this._holes)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(e.isEmpty())return null;var n=new Array(e.getCoordinates().length-1).fill(null);cu.arraycopy(e.getCoordinates(),0,n,0,n.length);var i=tc.minCoordinate(e.getCoordinates());tc.scroll(n,i),cu.arraycopy(n,0,e.getCoordinates(),0,n.length),e.getCoordinates()[n.length]=n[0],ku.isCCW(e.getCoordinates())===r&&tc.reverse(e.getCoordinates())}},n.prototype.getCoordinate=function(){return this._shell.getCoordinate()},n.prototype.getNumInteriorRing=function(){return this._holes.length},n.prototype.getBoundaryDimension=function(){return 1},n.prototype.getDimension=function(){return 2},n.prototype.getLength=function(){var t=0;t+=this._shell.getLength();for(var e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t},n.prototype.getNumPoints=function(){for(var t=this._shell.getNumPoints(),e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t},n.prototype.reverse=function(){var t=this.copy();t._shell=this._shell.copy().reverse(),t._holes=new Array(this._holes.length).fill(null);for(var e=0;e<this._holes.length;e++)t._holes[e]=this._holes[e].copy().reverse();return t},n.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},n.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=this._shell,r=t._shell;return e.compareToSameClass(r)}if(2===arguments.length){var n=arguments[1],i=arguments[0],o=this._shell,a=i._shell,s=o.compareToSameClass(a,n);if(0!==s)return s;for(var u=this.getNumInteriorRing(),c=i.getNumInteriorRing(),l=0;l<u&&l<c;){var h=this.getInteriorRingN(l),p=i.getInteriorRingN(l),f=h.compareToSameClass(p,n);if(0!==f)return f;l++}return l<u?1:l<c?-1:0}},n.prototype.apply=function(t){if(Zs(t,Uu)){this._shell.apply(t);for(var e=0;e<this._holes.length;e++)this._holes[e].apply(t)}else if(Zs(t,Pc)){if(this._shell.apply(t),!t.isDone())for(var r=0;r<this._holes.length&&(this._holes[r].apply(t),!t.isDone());r++);t.isGeometryChanged()&&this.geometryChanged()}else if(Zs(t,Tc))t.filter(this);else if(Zs(t,ju)){t.filter(this),this._shell.apply(t);for(var n=0;n<this._holes.length;n++)this._holes[n].apply(t)}},n.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(var e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},n.prototype.clone=function(){var t=a.prototype.clone.call(this);t._shell=this._shell.clone(),t._holes=new Array(this._holes.length).fill(null);for(var e=0;e<this._holes.length;e++)t._holes[e]=this._holes[e].clone();return t},n.prototype.getGeometryType=function(){return"Polygon"},n.prototype.copy=function(){for(var t=this._shell.copy(),e=new Array(this._holes.length).fill(null),r=0;r<e.length;r++)e[r]=this._holes[r].copy();return new n(t,e,this._factory)},n.prototype.getExteriorRing=function(){return this._shell},n.prototype.isEmpty=function(){return this._shell.isEmpty()},n.prototype.getInteriorRingN=function(t){return this._holes[t]},n.prototype.interfaces_=function(){return[zc]},n.prototype.getClass=function(){return n},t.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(n,t),n}(zu),Vc=function(r){function n(){r.apply(this,arguments)}r&&(n.__proto__=r);var t={serialVersionUID:{configurable:!0}};return((n.prototype=Object.create(r&&r.prototype)).constructor=n).prototype.getSortIndex=function(){return zu.SORTINDEX_MULTIPOINT},n.prototype.isValid=function(){return!0},n.prototype.equalsExact=function(){if(2!==arguments.length)return r.prototype.equalsExact.apply(this,arguments);var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&r.prototype.equalsExact.call(this,t,e)},n.prototype.getCoordinate=function(){if(1!==arguments.length)return r.prototype.getCoordinate.apply(this,arguments);var t=arguments[0];return this._geometries[t].getCoordinate()},n.prototype.getBoundaryDimension=function(){return Cc.FALSE},n.prototype.getDimension=function(){return 0},n.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},n.prototype.getGeometryType=function(){return"MultiPoint"},n.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new n(t,this._factory)},n.prototype.interfaces_=function(){return[Dc]},n.prototype.getClass=function(){return n},t.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(n,t),n}(Oc),Gc=function(r){function t(t,e){t instanceof qs&&e instanceof al&&(t=e.getCoordinateSequenceFactory().create(t)),r.call(this,t,e),this.validateConstruction()}r&&(t.__proto__=r);var e={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.getSortIndex=function(){return zu.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return Cc.FALSE},t.prototype.isClosed=function(){return!!this.isEmpty()||r.prototype.isClosed.call(this)},t.prototype.reverse=function(){var t=this._points.copy();return kc.reverse(t),this.getFactory().createLinearRing(t)},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!r.prototype.isClosed.call(this))throw new zs("Points of LinearRing do not form a closed linestring");if(1<=this.getCoordinateSequence().size()&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new zs("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},e.MINIMUM_VALID_SIZE.get=function(){return 4},e.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,e),t}(jc),qc=function(r){function n(){r.apply(this,arguments)}r&&(n.__proto__=r);var t={serialVersionUID:{configurable:!0}};return((n.prototype=Object.create(r&&r.prototype)).constructor=n).prototype.getSortIndex=function(){return zu.SORTINDEX_MULTIPOLYGON},n.prototype.equalsExact=function(){if(2!==arguments.length)return r.prototype.equalsExact.apply(this,arguments);var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&r.prototype.equalsExact.call(this,t,e)},n.prototype.getBoundaryDimension=function(){return 1},n.prototype.getDimension=function(){return 2},n.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),r=0;r<this._geometries.length;r++)e[r]=this._geometries[r].reverse();return this.getFactory().createMultiPolygon(e)},n.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new nc,e=0;e<this._geometries.length;e++)for(var r=this._geometries[e].getBoundary(),n=0;n<r.getNumGeometries();n++)t.add(r.getGeometryN(n));var i=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(i))},n.prototype.getGeometryType=function(){return"MultiPolygon"},n.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new n(t,this._factory)},n.prototype.interfaces_=function(){return[zc]},n.prototype.getClass=function(){return n},t.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(n,t),n}(Oc),Hc={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Bc.prototype.setCopyUserData=function(t){this._isUserDataCopied=t},Bc.prototype.edit=function(t,e){if(null===t)return null;var r=this.editInternal(t,e);return this._isUserDataCopied&&r.setUserData(t.getUserData()),r},Bc.prototype.editInternal=function(t,e){return null===this._factory&&(this._factory=t.getFactory()),t instanceof Oc?this.editGeometryCollection(t,e):t instanceof Uc?this.editPolygon(t,e):t instanceof Fc?e.edit(t,this._factory):t instanceof jc?e.edit(t,this._factory):(xu.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},Bc.prototype.editGeometryCollection=function(t,e){for(var r=e.edit(t,this._factory),n=new nc,i=0;i<r.getNumGeometries();i++){var o=this.edit(r.getGeometryN(i),e);null===o||o.isEmpty()||n.add(o)}return r.getClass()===Vc?this._factory.createMultiPoint(n.toArray([])):r.getClass()===Ac?this._factory.createMultiLineString(n.toArray([])):r.getClass()===qc?this._factory.createMultiPolygon(n.toArray([])):this._factory.createGeometryCollection(n.toArray([]))},Bc.prototype.editPolygon=function(t,e){var r=e.edit(t,this._factory);if(null===r&&(r=this._factory.createPolygon(null)),r.isEmpty())return r;var n=this.edit(r.getExteriorRing(),e);if(null===n||n.isEmpty())return this._factory.createPolygon();for(var i=new nc,o=0;o<r.getNumInteriorRing();o++){var a=this.edit(r.getInteriorRingN(o),e);null===a||a.isEmpty()||i.add(a)}return this._factory.createPolygon(n,i.toArray([]))},Bc.prototype.interfaces_=function(){return[]},Bc.prototype.getClass=function(){return Bc},Bc.GeometryEditorOperation=function(){},Hc.NoOpGeometryOperation.get=function(){return $c},Hc.CoordinateOperation.get=function(){return Wc},Hc.CoordinateSequenceOperation.get=function(){return Xc},Object.defineProperties(Bc,Hc);var $c=function(){};$c.prototype.edit=function(t,e){return t},$c.prototype.interfaces_=function(){return[Bc.GeometryEditorOperation]},$c.prototype.getClass=function(){return $c};var Wc=function(){};Wc.prototype.edit=function(t,e){var r=this.editCoordinates(t.getCoordinates(),t);return null===r?t:t instanceof Gc?e.createLinearRing(r):t instanceof jc?e.createLineString(r):t instanceof Fc?0<r.length?e.createPoint(r[0]):e.createPoint():t},Wc.prototype.interfaces_=function(){return[Bc.GeometryEditorOperation]},Wc.prototype.getClass=function(){return Wc};var Xc=function(){};Xc.prototype.edit=function(t,e){return t instanceof Gc?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof jc?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Fc?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},Xc.prototype.interfaces_=function(){return[Bc.GeometryEditorOperation]},Xc.prototype.getClass=function(){return Xc};function Yc(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var e=0;e<t;e++)this._coordinates[e]=new qs}else if(Zs(arguments[0],au)){var r=arguments[0];if(null===r)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._coordinates=new Array(r.size()).fill(null);for(var n=0;n<this._coordinates.length;n++)this._coordinates[n]=r.getCoordinateCopy(n)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var i=arguments[0],o=arguments[1];this._coordinates=i,this._dimension=o,null===i&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var a=arguments[0],s=arguments[1];this._coordinates=new Array(a).fill(null),this._dimension=s;for(var u=0;u<a;u++)this._coordinates[u]=new qs}}var Zc={serialVersionUID:{configurable:!0}};Yc.prototype.setOrdinate=function(t,e,r){switch(e){case au.X:this._coordinates[t].x=r;break;case au.Y:this._coordinates[t].y=r;break;case au.Z:this._coordinates[t].z=r;break;default:throw new zs("invalid ordinateIndex")}},Yc.prototype.size=function(){return this._coordinates.length},Yc.prototype.getOrdinate=function(t,e){switch(e){case au.X:return this._coordinates[t].x;case au.Y:return this._coordinates[t].y;case au.Z:return this._coordinates[t].z}return Fs.NaN},Yc.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this._coordinates[t]}if(2===arguments.length){var e=arguments[0],r=arguments[1];r.x=this._coordinates[e].x,r.y=this._coordinates[e].y,r.z=this._coordinates[e].z}},Yc.prototype.getCoordinateCopy=function(t){return new qs(this._coordinates[t])},Yc.prototype.getDimension=function(){return this._dimension},Yc.prototype.getX=function(t){return this._coordinates[t].x},Yc.prototype.clone=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].clone();return new Yc(t,this._dimension)},Yc.prototype.expandEnvelope=function(t){for(var e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t},Yc.prototype.copy=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].copy();return new Yc(t,this._dimension)},Yc.prototype.toString=function(){if(0<this._coordinates.length){var t=new Qs(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}return"()"},Yc.prototype.getY=function(t){return this._coordinates[t].y},Yc.prototype.toCoordinateArray=function(){return this._coordinates},Yc.prototype.interfaces_=function(){return[au,pi]},Yc.prototype.getClass=function(){return Yc},Zc.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(Yc,Zc);function Kc(){}var Jc={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Kc.prototype.readResolve=function(){return Kc.instance()},Kc.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new Yc(arguments[0]);if(Zs(arguments[0],au))return new Yc(arguments[0])}else if(2===arguments.length){var t=arguments[0],e=arguments[1];return 3<e&&(e=3),e<2?new Yc(t):new Yc(t,e)}},Kc.prototype.interfaces_=function(){return[Ws,pi]},Kc.prototype.getClass=function(){return Kc},Kc.instance=function(){return Kc.instanceObject},Jc.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},Jc.instanceObject.get=function(){return new Kc},Object.defineProperties(Kc,Jc);function Qc(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=Qc.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof il){var t=arguments[0];(this._modelType=t)===Qc.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var e=arguments[0];this._modelType=Qc.FIXED,this.setScale(e)}else if(arguments[0]instanceof Qc){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}}var tl,el=((tl=hc)&&(nl.__proto__=tl),((nl.prototype=Object.create(tl&&tl.prototype)).constructor=nl).prototype.get=function(t){return this.map_.get(t)||null},nl.prototype.put=function(t,e){return this.map_.set(t,e),e},nl.prototype.values=function(){for(var t=new nc,e=this.map_.values(),r=e.next();!r.done;)t.add(r.value),r=e.next();return t},nl.prototype.entrySet=function(){var e=new yc;return this.map_.entries().forEach(function(t){return e.add(t)}),e},nl.prototype.size=function(){return this.map_.size()},nl),rl={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};function nl(){tl.call(this),this.map_=new Map}Qc.prototype.equals=function(t){if(!(t instanceof Qc))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale},Qc.prototype.compareTo=function(t){var e=t,r=this.getMaximumSignificantDigits(),n=e.getMaximumSignificantDigits();return new tu(r).compareTo(new tu(n))},Qc.prototype.getScale=function(){return this._scale},Qc.prototype.isFloating=function(){return this._modelType===Qc.FLOATING||this._modelType===Qc.FLOATING_SINGLE},Qc.prototype.getType=function(){return this._modelType},Qc.prototype.toString=function(){var t="UNKNOWN";return this._modelType===Qc.FLOATING?t="Floating":this._modelType===Qc.FLOATING_SINGLE?t="Floating-Single":this._modelType===Qc.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},Qc.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var t=arguments[0];return Fs.isNaN(t)?t:this._modelType===Qc.FLOATING_SINGLE?t:this._modelType===Qc.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof qs){var e=arguments[0];if(this._modelType===Qc.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},Qc.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===Qc.FLOATING?t=16:this._modelType===Qc.FLOATING_SINGLE?t=6:this._modelType===Qc.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},Qc.prototype.setScale=function(t){this._scale=Math.abs(t)},Qc.prototype.interfaces_=function(){return[pi,Us]},Qc.prototype.getClass=function(){return Qc},Qc.mostPrecise=function(t,e){return 0<=t.compareTo(e)?t:e},rl.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},rl.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(Qc,rl);var il=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},ol={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};il.prototype.readResolve=function(){return il.nameToTypeMap.get(this._name)},il.prototype.toString=function(){return this._name},il.prototype.interfaces_=function(){return[pi]},il.prototype.getClass=function(){return il},ol.serialVersionUID.get=function(){return-552860263173159e4},ol.nameToTypeMap.get=function(){return new el},Object.defineProperties(il,ol),Qc.Type=il,Qc.FIXED=new il("FIXED"),Qc.FLOATING=new il("FLOATING"),Qc.FLOATING_SINGLE=new il("FLOATING SINGLE");var al=function t(){this._precisionModel=new Qc,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?Zs(arguments[0],Ws)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Qc&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},sl={serialVersionUID:{configurable:!0}};al.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new qs(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new qs(t.getMinX(),t.getMinY()),new qs(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new qs(t.getMinX(),t.getMinY()),new qs(t.getMinX(),t.getMaxY()),new qs(t.getMaxX(),t.getMaxY()),new qs(t.getMaxX(),t.getMinY()),new qs(t.getMinX(),t.getMinY())]),null)},al.prototype.createLineString=function(t){return t?t instanceof Array?new jc(this.getCoordinateSequenceFactory().create(t),this):Zs(t,au)?new jc(t,this):void 0:new jc(this.getCoordinateSequenceFactory().create([]),this)},al.prototype.createMultiLineString=function(){return 0===arguments.length?new Ac(null,this):1===arguments.length?new Ac(arguments[0],this):void 0},al.prototype.buildGeometry=function(t){for(var e=null,r=!1,n=!1,i=t.iterator();i.hasNext();){var o=i.next(),a=o.getClass();null===e&&(e=a),a!==e&&(r=!0),o.isGeometryCollectionOrDerived()&&(n=!0)}if(null===e)return this.createGeometryCollection();if(r||n)return this.createGeometryCollection(al.toGeometryArray(t));var s=t.iterator().next();if(1<t.size()){if(s instanceof Uc)return this.createMultiPolygon(al.toPolygonArray(t));if(s instanceof jc)return this.createMultiLineString(al.toLineStringArray(t));if(s instanceof Fc)return this.createMultiPoint(al.toPointArray(t));xu.shouldNeverReachHere("Unhandled class: "+s.getClass().getName())}return s},al.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},al.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof qs){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(Zs(arguments[0],au))return new Fc(arguments[0],this)}},al.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},al.prototype.createPolygon=function(){if(0===arguments.length)return new Uc(null,null,this);if(1===arguments.length){if(Zs(arguments[0],au)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof Gc){var r=arguments[0];return this.createPolygon(r,null)}}else if(2===arguments.length){return new Uc(arguments[0],arguments[1],this)}},al.prototype.getSRID=function(){return this._SRID},al.prototype.createGeometryCollection=function(){return 0===arguments.length?new Oc(null,this):1===arguments.length?new Oc(arguments[0],this):void 0},al.prototype.createGeometry=function(t){return new Bc(this).edit(t,{edit:function(){if(2===arguments.length){var t=arguments[0];return this._coordinateSequenceFactory.create(t)}}})},al.prototype.getPrecisionModel=function(){return this._precisionModel},al.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(Zs(arguments[0],au))return new Gc(arguments[0],this)}},al.prototype.createMultiPolygon=function(){return 0===arguments.length?new qc(null,this):1===arguments.length?new qc(arguments[0],this):void 0},al.prototype.createMultiPoint=function(){if(0===arguments.length)return new Vc(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new Vc(arguments[0],this);if(arguments[0]instanceof Array){var t=arguments[0];return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(Zs(arguments[0],au)){var e=arguments[0];if(null===e)return this.createMultiPoint(new Array(0).fill(null));for(var r=new Array(e.size()).fill(null),n=0;n<e.size();n++){var i=this.getCoordinateSequenceFactory().create(1,e.getDimension());kc.copy(e,n,i,0,1),r[n]=this.createPoint(i)}return this.createMultiPoint(r)}}},al.prototype.interfaces_=function(){return[pi]},al.prototype.getClass=function(){return al},al.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},al.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},al.getDefaultCoordinateSequenceFactory=function(){return Kc.instance()},al.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},al.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},al.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},al.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},al.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},al.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},al.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},sl.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(al,sl);function ul(t){this.geometryFactory=t||new al}var cl=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"];ul.prototype.read=function(t){var e,r=(e="string"==typeof t?JSON.parse(t):t).type;if(!ll[r])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==cl.indexOf(r)?ll[r].apply(this,[e.coordinates]):"GeometryCollection"===r?ll[r].apply(this,[e.geometries]):ll[r].apply(this,[e])},ul.prototype.write=function(t){var e=t.getGeometryType();if(!hl[e])throw new Error("Geometry is not supported");return hl[e].apply(this,[t])};var ll={Feature:function(t){var e={};for(var r in t)e[r]=t[r];if(t.geometry){var n=t.geometry.type;if(!ll[n])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=ll.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var r=0;r<t.features.length;++r)e.features.push(this.read(t.features[r]))}return t.bbox&&(e.bbox=this.parse.bbox.apply(this,[t.bbox])),e},coordinates:function(t){for(var e=[],r=0;r<t.length;++r){var n=t[r];e.push(new qs(n[0],n[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new qs(t[0],t[1]),new qs(t[2],t[1]),new qs(t[2],t[3]),new qs(t[0],t[3]),new qs(t[0],t[1])])},Point:function(t){var e=new qs(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],r=0;r<t.length;++r)e.push(ll.Point.apply(this,[t[r]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=ll.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],r=0;r<t.length;++r)e.push(ll.LineString.apply(this,[t[r]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=ll.coordinates.apply(this,[t[0]]),r=this.geometryFactory.createLinearRing(e),n=[],i=1;i<t.length;++i){var o=t[i],a=ll.coordinates.apply(this,[o]),s=this.geometryFactory.createLinearRing(a);n.push(s)}return this.geometryFactory.createPolygon(r,n)},MultiPolygon:function(t){for(var e=[],r=0;r<t.length;++r){var n=t[r];e.push(ll.Polygon.apply(this,[n]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],r=0;r<t.length;++r){var n=t[r];e.push(this.read(n))}return this.geometryFactory.createGeometryCollection(e)}},hl={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:hl.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=[],r=0;r<t._geometries.length;++r){var n=t._geometries[r],i=hl.Point.apply(this,[n]);e.push(i.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],r=t.getCoordinates(),n=0;n<r.length;++n){var i=r[n];e.push(hl.coordinate.apply(this,[i]))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],r=0;r<t._geometries.length;++r){var n=t._geometries[r],i=hl.LineString.apply(this,[n]);e.push(i.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],r=hl.LineString.apply(this,[t._shell]);e.push(r.coordinates);for(var n=0;n<t._holes.length;++n){var i=t._holes[n],o=hl.LineString.apply(this,[i]);e.push(o.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],r=0;r<t._geometries.length;++r){var n=t._geometries[r],i=hl.Polygon.apply(this,[n]);e.push(i.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],r=0;r<t._geometries.length;++r){var n=t._geometries[r],i=n.getGeometryType();e.push(hl[i].apply(this,[n]))}return{type:"GeometryCollection",geometries:e}}},pl=function(t){this.geometryFactory=t||new al,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new ul(this.geometryFactory)};pl.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===Qc.FIXED&&this.reducePrecision(e),e},pl.prototype.reducePrecision=function(t){var e,r;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,r=t.points.length;e<r;e++)this.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,r=t.geometries.length;e<r;e++)this.reducePrecision(t.geometries[e])};var fl=function(){this.parser=new ul(this.geometryFactory)};fl.prototype.write=function(t){return this.parser.write(t)};function dl(){}var ml={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};dl.prototype.interfaces_=function(){return[]},dl.prototype.getClass=function(){return dl},dl.opposite=function(t){return t===dl.LEFT?dl.RIGHT:t===dl.RIGHT?dl.LEFT:t},ml.ON.get=function(){return 0},ml.LEFT.get=function(){return 1},ml.RIGHT.get=function(){return 2},Object.defineProperties(dl,ml),(Ci.prototype=new Error).name="EmptyStackException",(Mi.prototype=new Ju).add=function(t){return this.array_.push(t),!0},Mi.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]},Mi.prototype.push=function(t){return this.array_.push(t),t},Mi.prototype.pop=function(t){if(0===this.array_.length)throw new Ci;return this.array_.pop()},Mi.prototype.peek=function(){if(0===this.array_.length)throw new Ci;return this.array_[this.array_.length-1]},Mi.prototype.empty=function(){return 0===this.array_.length},Mi.prototype.isEmpty=function(){return this.empty()},Mi.prototype.search=function(t){return this.array_.indexOf(t)},Mi.prototype.size=function(){return this.array_.length},Mi.prototype.toArray=function(){for(var t=[],e=0,r=this.array_.length;e<r;e++)t.push(this.array_[e]);return t};function gl(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}gl.prototype.getCoordinate=function(){return this._minCoord},gl.prototype.getRightmostSide=function(t,e){var r=this.getRightmostSideOfSegment(t,e);return r<0&&(r=this.getRightmostSideOfSegment(t,e-1)),r<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),r},gl.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();xu.isTrue(0<this._minIndex&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],r=t[this._minIndex+1],n=ku.computeOrientation(this._minCoord,r,e),i=!1;e.y<this._minCoord.y&&r.y<this._minCoord.y&&n===ku.COUNTERCLOCKWISE?i=!0:e.y>this._minCoord.y&&r.y>this._minCoord.y&&n===ku.CLOCKWISE&&(i=!0),i&&(this._minIndex=this._minIndex-1)},gl.prototype.getRightmostSideOfSegment=function(t,e){var r=t.getEdge().getCoordinates();if(e<0||e+1>=r.length)return-1;if(r[e].y===r[e+1].y)return-1;var n=dl.LEFT;return r[e].y<r[e+1].y&&(n=dl.RIGHT),n},gl.prototype.getEdge=function(){return this._orientedDe},gl.prototype.checkForRightmostCoordinate=function(t){for(var e=t.getEdge().getCoordinates(),r=0;r<e.length-1;r++)(null===this._minCoord||e[r].x>this._minCoord.x)&&(this._minDe=t,this._minIndex=r,this._minCoord=e[r])},gl.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode().getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},gl.prototype.findEdge=function(t){for(var e=t.iterator();e.hasNext();){var r=e.next();r.isForward()&&this.checkForRightmostCoordinate(r)}xu.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===dl.LEFT&&(this._orientedDe=this._minDe.getSym())},gl.prototype.interfaces_=function(){return[]},gl.prototype.getClass=function(){return gl};function yl(){this.array_=[]}var vl,_l=((vl=Eu)&&(bl.__proto__=vl),((bl.prototype=Object.create(vl&&vl.prototype)).constructor=bl).prototype.getCoordinate=function(){return this.pt},bl.prototype.interfaces_=function(){return[]},bl.prototype.getClass=function(){return bl},bl.msgWithCoord=function(t,e){return e?t:t+" [ "+e+" ]"},bl);function bl(t,e){vl.call(this,bl.msgWithCoord(t,e)),this.pt=e?new qs(e):null,this.name="TopologyException"}yl.prototype.addLast=function(t){this.array_.push(t)},yl.prototype.removeFirst=function(){return this.array_.shift()},yl.prototype.isEmpty=function(){return 0===this.array_.length};function xl(){this._finder=null,this._dirEdgeList=new nc,this._nodes=new nc,this._rightMostCoord=null,this._env=null,this._finder=new gl}xl.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();)t.next().setVisited(!1)},xl.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},xl.prototype.computeNodeDepth=function(t){for(var e=null,r=t.getEdges().iterator();r.hasNext();){var n=r.next();if(n.isVisited()||n.getSym().isVisited()){e=n;break}}if(null===e)throw new _l("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var i=t.getEdges().iterator();i.hasNext();){var o=i.next();o.setVisited(!0),this.copySymDepths(o)}},xl.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(dl.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},xl.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},xl.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();1<=e.getDepth(dl.RIGHT)&&e.getDepth(dl.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},xl.prototype.computeDepths=function(t){var e=new yc,r=new yl,n=t.getNode();for(r.addLast(n),e.add(n),t.setVisited(!0);!r.isEmpty();){var i=r.removeFirst();e.add(i),this.computeNodeDepth(i);for(var o=i.getEdges().iterator();o.hasNext();){var a=o.next().getSym();if(!a.isVisited()){var s=a.getNode();e.contains(s)||(r.addLast(s),e.add(s))}}}},xl.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0},xl.prototype.getEnvelope=function(){if(null===this._env){for(var t=new du,e=this._dirEdgeList.iterator();e.hasNext();)for(var r=e.next().getEdge().getCoordinates(),n=0;n<r.length-1;n++)t.expandToInclude(r[n]);this._env=t}return this._env},xl.prototype.addReachable=function(t){var e=new Mi;for(e.add(t);!e.empty();){var r=e.pop();this.add(r,e)}},xl.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(dl.LEFT,t.getDepth(dl.RIGHT)),e.setDepth(dl.RIGHT,t.getDepth(dl.LEFT))},xl.prototype.add=function(t,e){t.setVisited(!0),this._nodes.add(t);for(var r=t.getEdges().iterator();r.hasNext();){var n=r.next();this._dirEdgeList.add(n);var i=n.getSym().getNode();i.isVisited()||e.push(i)}},xl.prototype.getNodes=function(){return this._nodes},xl.prototype.getDirectedEdges=function(){return this._dirEdgeList},xl.prototype.interfaces_=function(){return[Us]},xl.prototype.getClass=function(){return xl};function wl(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){var e=arguments[0];this.init(1),this.location[dl.ON]=e}else if(arguments[0]instanceof wl){var r=arguments[0];if(this.init(r.location.length),null!==r)for(var n=0;n<this.location.length;n++)this.location[n]=r.location[n]}}else if(3===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2];this.init(3),this.location[dl.ON]=i,this.location[dl.LEFT]=o,this.location[dl.RIGHT]=a}}wl.prototype.setAllLocations=function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},wl.prototype.isNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==Xs.NONE)return!1;return!0},wl.prototype.setAllLocationsIfNull=function(t){for(var e=0;e<this.location.length;e++)this.location[e]===Xs.NONE&&(this.location[e]=t)},wl.prototype.isLine=function(){return 1===this.location.length},wl.prototype.merge=function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[dl.ON]=this.location[dl.ON],e[dl.LEFT]=Xs.NONE,e[dl.RIGHT]=Xs.NONE,this.location=e}for(var r=0;r<this.location.length;r++)this.location[r]===Xs.NONE&&r<t.location.length&&(this.location[r]=t.location[r])},wl.prototype.getLocations=function(){return this.location},wl.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[dl.LEFT];this.location[dl.LEFT]=this.location[dl.RIGHT],this.location[dl.RIGHT]=t},wl.prototype.toString=function(){var t=new Qs;return 1<this.location.length&&t.append(Xs.toLocationSymbol(this.location[dl.LEFT])),t.append(Xs.toLocationSymbol(this.location[dl.ON])),1<this.location.length&&t.append(Xs.toLocationSymbol(this.location[dl.RIGHT])),t.toString()},wl.prototype.setLocations=function(t,e,r){this.location[dl.ON]=t,this.location[dl.LEFT]=e,this.location[dl.RIGHT]=r},wl.prototype.get=function(t){return t<this.location.length?this.location[t]:Xs.NONE},wl.prototype.isArea=function(){return 1<this.location.length},wl.prototype.isAnyNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===Xs.NONE)return!0;return!1},wl.prototype.setLocation=function(){if(1===arguments.length){var t=arguments[0];this.setLocation(dl.ON,t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this.location[e]=r}},wl.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(Xs.NONE)},wl.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]},wl.prototype.allPositionsEqual=function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},wl.prototype.interfaces_=function(){return[]},wl.prototype.getClass=function(){return wl};function Sl(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new wl(t),this.elt[1]=new wl(t)}else if(arguments[0]instanceof Sl){var e=arguments[0];this.elt[0]=new wl(e.elt[0]),this.elt[1]=new wl(e.elt[1])}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.elt[0]=new wl(Xs.NONE),this.elt[1]=new wl(Xs.NONE),this.elt[r].setLocation(n)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2];this.elt[0]=new wl(i,o,a),this.elt[1]=new wl(i,o,a)}else if(4===arguments.length){var s=arguments[0],u=arguments[1],c=arguments[2],l=arguments[3];this.elt[0]=new wl(Xs.NONE,Xs.NONE,Xs.NONE),this.elt[1]=new wl(Xs.NONE,Xs.NONE,Xs.NONE),this.elt[s].setLocations(u,c,l)}}Sl.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},Sl.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)},Sl.prototype.isNull=function(t){return this.elt[t].isNull()},Sl.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this.elt[e].setAllLocationsIfNull(r)}},Sl.prototype.isLine=function(t){return this.elt[t].isLine()},Sl.prototype.merge=function(t){for(var e=0;e<2;e++)null===this.elt[e]&&null!==t.elt[e]?this.elt[e]=new wl(t.elt[e]):this.elt[e].merge(t.elt[e])},Sl.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Sl.prototype.getLocation=function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(dl.ON)}if(2===arguments.length){var e=arguments[0],r=arguments[1];return this.elt[e].get(r)}},Sl.prototype.toString=function(){var t=new Qs;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},Sl.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},Sl.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()},Sl.prototype.setLocation=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(dl.ON,e)}else if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];this.elt[r].setLocation(n,i)}},Sl.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},Sl.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)},Sl.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new wl(this.elt[t].location[0]))},Sl.prototype.interfaces_=function(){return[]},Sl.prototype.getClass=function(){return Sl},Sl.toLineLabel=function(t){for(var e=new Sl(Xs.NONE),r=0;r<2;r++)e.setLocation(r,t.getLocation(r));return e};function El(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new nc,this._pts=new nc,this._label=new Sl(Xs.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new nc,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()}El.prototype.computeRing=function(){if(null!==this._ring)return null;for(var t=new Array(this._pts.size()).fill(null),e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=ku.isCCW(this._ring.getCoordinates())},El.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},El.prototype.computePoints=function(t){var e=this._startDe=t,r=!0;do{if(null===e)throw new _l("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new _l("Directed Edge visited twice during ring-building at "+e.getCoordinate());this._edges.add(e);var n=e.getLabel();xu.isTrue(n.isArea()),this.mergeLabel(n),this.addPoints(e.getEdge(),e.isForward(),r),r=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this._startDe)},El.prototype.getLinearRing=function(){return this._ring},El.prototype.getCoordinate=function(t){return this._pts.get(t)},El.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var t=this._startDe;do{var e=t.getNode().getEdges().getOutgoingDegree(this);e>this._maxNodeDegree&&(this._maxNodeDegree=e),t=this.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2},El.prototype.addPoints=function(t,e,r){var n=t.getCoordinates();if(e){var i=1;r&&(i=0);for(var o=i;o<n.length;o++)this._pts.add(n[o])}else{var a=n.length-2;r&&(a=n.length-1);for(var s=a;0<=s;s--)this._pts.add(n[s])}},El.prototype.isHole=function(){return this._isHole},El.prototype.setInResult=function(){for(var t=this._startDe;t.getEdge().setInResult(!0),(t=t.getNext())!==this._startDe;);},El.prototype.containsPoint=function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!ku.isPointInRing(t,e.getCoordinates()))return!1;for(var r=this._holes.iterator();r.hasNext();)if(r.next().containsPoint(t))return!1;return!0},El.prototype.addHole=function(t){this._holes.add(t)},El.prototype.isShell=function(){return null===this._shell},El.prototype.getLabel=function(){return this._label},El.prototype.getEdges=function(){return this._edges},El.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},El.prototype.getShell=function(){return this._shell},El.prototype.mergeLabel=function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[1],r=arguments[0].getLocation(e,dl.RIGHT);if(r===Xs.NONE)return null;if(this._label.getLocation(e)===Xs.NONE)return this._label.setLocation(e,r),null}},El.prototype.setShell=function(t){null!==(this._shell=t)&&t.addHole(this)},El.prototype.toPolygon=function(t){for(var e=new Array(this._holes.size()).fill(null),r=0;r<this._holes.size();r++)e[r]=this._holes.get(r).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},El.prototype.interfaces_=function(){return[]},El.prototype.getClass=function(){return El};function Cl(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._label=t}}var Ml,Tl,Pl=((Tl=El)&&(Il.__proto__=Tl),((Il.prototype=Object.create(Tl&&Tl.prototype)).constructor=Il).prototype.setEdgeRing=function(t,e){t.setMinEdgeRing(e)},Il.prototype.getNext=function(t){return t.getNextMin()},Il.prototype.interfaces_=function(){return[]},Il.prototype.getClass=function(){return Il},Il),Ol=((Ml=El)&&(Al.__proto__=Ml),((Al.prototype=Object.create(Ml&&Ml.prototype)).constructor=Al).prototype.buildMinimalRings=function(){var t=new nc,e=this._startDe;do{if(null===e.getMinEdgeRing()){var r=new Pl(e,this._geometryFactory);t.add(r)}e=e.getNext()}while(e!==this._startDe);return t},Al.prototype.setEdgeRing=function(t,e){t.setEdgeRing(e)},Al.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){for(var t=this._startDe;t.getNode().getEdges().linkMinimalDirectedEdges(this),(t=t.getNext())!==this._startDe;);},Al.prototype.getNext=function(t){return t.getNext()},Al.prototype.interfaces_=function(){return[]},Al.prototype.getClass=function(){return Al},Al);function Al(){var t=arguments[0],e=arguments[1];Ml.call(this,t,e)}function Il(){var t=arguments[0],e=arguments[1];Tl.call(this,t,e)}Cl.prototype.setVisited=function(t){this._isVisited=t},Cl.prototype.setInResult=function(t){this._isInResult=t},Cl.prototype.isCovered=function(){return this._isCovered},Cl.prototype.isCoveredSet=function(){return this._isCoveredSet},Cl.prototype.setLabel=function(t){this._label=t},Cl.prototype.getLabel=function(){return this._label},Cl.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0},Cl.prototype.updateIM=function(t){xu.isTrue(2<=this._label.getGeometryCount(),"found partial label"),this.computeIM(t)},Cl.prototype.isInResult=function(){return this._isInResult},Cl.prototype.isVisited=function(){return this._isVisited},Cl.prototype.interfaces_=function(){return[]},Cl.prototype.getClass=function(){return Cl};function Ll(){this.nodeMap=new xi,this.nodeFact=null;var t=arguments[0];this.nodeFact=t}var Rl,Nl=((Rl=Cl)&&(kl.__proto__=Rl),((kl.prototype=Object.create(Rl&&Rl.prototype)).constructor=kl).prototype.isIncidentEdgeInResult=function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1},kl.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},kl.prototype.getCoordinate=function(){return this._coord},kl.prototype.print=function(t){t.println("node "+this._coord+" lbl: "+this._label)},kl.prototype.computeIM=function(t){},kl.prototype.computeMergedLocation=function(t,e){var r=Xs.NONE;if(r=this._label.getLocation(e),!t.isNull(e)){var n=t.getLocation(e);r!==Xs.BOUNDARY&&(r=n)}return r},kl.prototype.setLabel=function(){if(2!==arguments.length)return Rl.prototype.setLabel.apply(this,arguments);var t=arguments[0],e=arguments[1];null===this._label?this._label=new Sl(t,e):this._label.setLocation(t,e)},kl.prototype.getEdges=function(){return this._edges},kl.prototype.mergeLabel=function(){if(arguments[0]instanceof kl){var t=arguments[0];this.mergeLabel(t._label)}else if(arguments[0]instanceof Sl)for(var e=arguments[0],r=0;r<2;r++){var n=this.computeMergedLocation(e,r);this._label.getLocation(r)===Xs.NONE&&this._label.setLocation(r,n)}},kl.prototype.add=function(t){this._edges.insert(t),t.setNode(this)},kl.prototype.setLabelBoundary=function(t){if(null===this._label)return null;var e=Xs.NONE;null!==this._label&&(e=this._label.getLocation(t));var r=null;switch(e){case Xs.BOUNDARY:r=Xs.INTERIOR;break;case Xs.INTERIOR:default:r=Xs.BOUNDARY}this._label.setLocation(t,r)},kl.prototype.interfaces_=function(){return[]},kl.prototype.getClass=function(){return kl},kl);function kl(){Rl.call(this),this._coord=null,this._edges=null;var t=arguments[0],e=arguments[1];this._coord=t,this._edges=e,this._label=new Sl(0,Xs.NONE)}Ll.prototype.find=function(t){return this.nodeMap.get(t)},Ll.prototype.addNode=function(){if(arguments[0]instanceof qs){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof Nl){var r=arguments[0],n=this.nodeMap.get(r.getCoordinate());return null===n?(this.nodeMap.put(r.getCoordinate(),r),r):(n.mergeLabel(r),n)}},Ll.prototype.print=function(t){for(var e=this.iterator();e.hasNext();)e.next().print(t)},Ll.prototype.iterator=function(){return this.nodeMap.values().iterator()},Ll.prototype.values=function(){return this.nodeMap.values()},Ll.prototype.getBoundaryNodes=function(t){for(var e=new nc,r=this.iterator();r.hasNext();){var n=r.next();n.getLabel().getLocation(t)===Xs.BOUNDARY&&e.add(n)}return e},Ll.prototype.add=function(t){var e=t.getCoordinate();this.addNode(e).add(t)},Ll.prototype.interfaces_=function(){return[]},Ll.prototype.getClass=function(){return Ll};function Dl(){}var jl={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Dl.prototype.interfaces_=function(){return[]},Dl.prototype.getClass=function(){return Dl},Dl.isNorthern=function(t){return t===Dl.NE||t===Dl.NW},Dl.isOpposite=function(t,e){return t!==e&&2==(t-e+4)%4},Dl.commonHalfPlane=function(t,e){if(t===e)return t;if(2==(t-e+4)%4)return-1;var r=t<e?t:e;return 0===r&&3===(e<t?t:e)?3:r},Dl.isInHalfPlane=function(t,e){return e===Dl.SE?t===Dl.SE||t===Dl.SW:t===e||t===e+1},Dl.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new zs("Cannot compute the quadrant for point ( "+t+", "+e+" )");return 0<=t?0<=e?Dl.NE:Dl.SE:0<=e?Dl.NW:Dl.SW}if(arguments[0]instanceof qs&&arguments[1]instanceof qs){var r=arguments[0],n=arguments[1];if(n.x===r.x&&n.y===r.y)throw new zs("Cannot compute the quadrant for two identical points "+r);return n.x>=r.x?n.y>=r.y?Dl.NE:Dl.SE:n.y>=r.y?Dl.NW:Dl.SW}},jl.NE.get=function(){return 0},jl.NW.get=function(){return 1},jl.SW.get=function(){return 2},jl.SE.get=function(){return 3},Object.defineProperties(Dl,jl);function zl(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var e=arguments[0],r=arguments[1],n=arguments[2];this._edge=e,this.init(r,n),this._label=null}else if(4===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];this._edge=i,this.init(o,a),this._label=s}}zl.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:ku.computeOrientation(t._p0,t._p1,this._p1)},zl.prototype.getDy=function(){return this._dy},zl.prototype.getCoordinate=function(){return this._p0},zl.prototype.setNode=function(t){this._node=t},zl.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),r=this.getClass().getName(),n=r.lastIndexOf("."),i=r.substring(n+1);t.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)},zl.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)},zl.prototype.getDirectedCoordinate=function(){return this._p1},zl.prototype.getDx=function(){return this._dx},zl.prototype.getLabel=function(){return this._label},zl.prototype.getEdge=function(){return this._edge},zl.prototype.getQuadrant=function(){return this._quadrant},zl.prototype.getNode=function(){return this._node},zl.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),r=e.lastIndexOf(".");return"  "+e.substring(r+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label},zl.prototype.computeLabel=function(t){},zl.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Dl.quadrant(this._dx,this._dy),xu.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},zl.prototype.interfaces_=function(){return[Us]},zl.prototype.getClass=function(){return zl};function Fl(){}var Bl,Ul=((Bl=zl)&&(Vl.__proto__=Bl),((Vl.prototype=Object.create(Bl&&Bl.prototype)).constructor=Vl).prototype.getNextMin=function(){return this._nextMin},Vl.prototype.getDepth=function(t){return this._depth[t]},Vl.prototype.setVisited=function(t){this._isVisited=t},Vl.prototype.computeDirectedLabel=function(){this._label=new Sl(this._edge.getLabel()),this._isForward||this._label.flip()},Vl.prototype.getNext=function(){return this._next},Vl.prototype.setDepth=function(t,e){if(-999!==this._depth[t]&&this._depth[t]!==e)throw new _l("assigned depths do not match",this.getCoordinate());this._depth[t]=e},Vl.prototype.isInteriorAreaEdge=function(){for(var t=!0,e=0;e<2;e++)this._label.isArea(e)&&this._label.getLocation(e,dl.LEFT)===Xs.INTERIOR&&this._label.getLocation(e,dl.RIGHT)===Xs.INTERIOR||(t=!1);return t},Vl.prototype.setNextMin=function(t){this._nextMin=t},Vl.prototype.print=function(t){Bl.prototype.print.call(this,t),t.print(" "+this._depth[dl.LEFT]+"/"+this._depth[dl.RIGHT]),t.print(" ("+this.getDepthDelta()+")"),this._isInResult&&t.print(" inResult")},Vl.prototype.setMinEdgeRing=function(t){this._minEdgeRing=t},Vl.prototype.isLineEdge=function(){var t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,Xs.EXTERIOR),r=!this._label.isArea(1)||this._label.allPositionsEqual(1,Xs.EXTERIOR);return t&&e&&r},Vl.prototype.setEdgeRing=function(t){this._edgeRing=t},Vl.prototype.getMinEdgeRing=function(){return this._minEdgeRing},Vl.prototype.getDepthDelta=function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t},Vl.prototype.setInResult=function(t){this._isInResult=t},Vl.prototype.getSym=function(){return this._sym},Vl.prototype.isForward=function(){return this._isForward},Vl.prototype.getEdge=function(){return this._edge},Vl.prototype.printEdge=function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)},Vl.prototype.setSym=function(t){this._sym=t},Vl.prototype.setVisitedEdge=function(t){this.setVisited(t),this._sym.setVisited(t)},Vl.prototype.setEdgeDepths=function(t,e){var r=this.getEdge().getDepthDelta();this._isForward||(r=-r);var n=1;t===dl.LEFT&&(n=-1);var i=dl.opposite(t),o=e+r*n;this.setDepth(t,e),this.setDepth(i,o)},Vl.prototype.getEdgeRing=function(){return this._edgeRing},Vl.prototype.isInResult=function(){return this._isInResult},Vl.prototype.setNext=function(t){this._next=t},Vl.prototype.isVisited=function(){return this._isVisited},Vl.prototype.interfaces_=function(){return[]},Vl.prototype.getClass=function(){return Vl},Vl.depthFactor=function(t,e){return t===Xs.EXTERIOR&&e===Xs.INTERIOR?1:t===Xs.INTERIOR&&e===Xs.EXTERIOR?-1:0},Vl);function Vl(){var t=arguments[0],e=arguments[1];if(Bl.call(this,t),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=e)this.init(t.getCoordinate(0),t.getCoordinate(1));else{var r=t.getNumPoints()-1;this.init(t.getCoordinate(r),t.getCoordinate(r-1))}this.computeDirectedLabel()}Fl.prototype.createNode=function(t){return new Nl(t,null)},Fl.prototype.interfaces_=function(){return[]},Fl.prototype.getClass=function(){return Fl};function Gl(){if(this._edges=new nc,this._nodes=null,this._edgeEndList=new nc,0===arguments.length)this._nodes=new Ll(new Fl);else if(1===arguments.length){var t=arguments[0];this._nodes=new Ll(t)}}Gl.prototype.printEdges=function(t){t.println("Edges:");for(var e=0;e<this._edges.size();e++){t.println("edge "+e+":");var r=this._edges.get(e);r.print(t),r.eiList.print(t)}},Gl.prototype.find=function(t){return this._nodes.find(t)},Gl.prototype.addNode=function(){if(arguments[0]instanceof Nl){var t=arguments[0];return this._nodes.addNode(t)}if(arguments[0]instanceof qs){var e=arguments[0];return this._nodes.addNode(e)}},Gl.prototype.getNodeIterator=function(){return this._nodes.iterator()},Gl.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()},Gl.prototype.debugPrintln=function(t){cu.out.println(t)},Gl.prototype.isBoundaryNode=function(t,e){var r=this._nodes.find(e);if(null===r)return!1;var n=r.getLabel();return null!==n&&n.getLocation(t)===Xs.BOUNDARY},Gl.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()},Gl.prototype.matchInSameDirection=function(t,e,r,n){return!!t.equals(r)&&ku.computeOrientation(t,e,n)===ku.COLLINEAR&&Dl.quadrant(t,e)===Dl.quadrant(r,n)},Gl.prototype.getEdgeEnds=function(){return this._edgeEndList},Gl.prototype.debugPrint=function(t){cu.out.print(t)},Gl.prototype.getEdgeIterator=function(){return this._edges.iterator()},Gl.prototype.findEdgeInSameDirection=function(t,e){for(var r=0;r<this._edges.size();r++){var n=this._edges.get(r),i=n.getCoordinates();if(this.matchInSameDirection(t,e,i[0],i[1]))return n;if(this.matchInSameDirection(t,e,i[i.length-1],i[i.length-2]))return n}return null},Gl.prototype.insertEdge=function(t){this._edges.add(t)},Gl.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var r=e.next();if(r.getEdge()===t)return r}return null},Gl.prototype.addEdges=function(t){for(var e=t.iterator();e.hasNext();){var r=e.next();this._edges.add(r);var n=new Ul(r,!0),i=new Ul(r,!1);n.setSym(i),i.setSym(n),this.add(n),this.add(i)}},Gl.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)},Gl.prototype.getNodes=function(){return this._nodes.values()},Gl.prototype.findEdge=function(t,e){for(var r=0;r<this._edges.size();r++){var n=this._edges.get(r),i=n.getCoordinates();if(t.equals(i[0])&&e.equals(i[1]))return n}return null},Gl.prototype.interfaces_=function(){return[]},Gl.prototype.getClass=function(){return Gl},Gl.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()};function ql(){this._geometryFactory=null,this._shellList=new nc;var t=arguments[0];this._geometryFactory=t}ql.prototype.sortShellsAndHoles=function(t,e,r){for(var n=t.iterator();n.hasNext();){var i=n.next();i.isHole()?r.add(i):e.add(i)}},ql.prototype.computePolygons=function(t){for(var e=new nc,r=t.iterator();r.hasNext();){var n=r.next().toPolygon(this._geometryFactory);e.add(n)}return e},ql.prototype.placeFreeHoles=function(t,e){for(var r=e.iterator();r.hasNext();){var n=r.next();if(null===n.getShell()){var i=this.findEdgeRingContaining(n,t);if(null===i)throw new _l("unable to assign hole to a shell",n.getCoordinate(0));n.setShell(i)}}},ql.prototype.buildMinimalEdgeRings=function(t,e,r){for(var n=new nc,i=t.iterator();i.hasNext();){var o=i.next();if(2<o.getMaxNodeDegree()){o.linkDirectedEdgesForMinimalEdgeRings();var a=o.buildMinimalRings(),s=this.findShell(a);null!==s?(this.placePolygonHoles(s,a),e.add(s)):r.addAll(a)}else n.add(o)}return n},ql.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();)if(e.next().containsPoint(t))return!0;return!1},ql.prototype.buildMaximalEdgeRings=function(t){for(var e=new nc,r=t.iterator();r.hasNext();){var n=r.next();if(n.isInResult()&&n.getLabel().isArea()&&null===n.getEdgeRing()){var i=new Ol(n,this._geometryFactory);e.add(i),i.setInResult()}}return e},ql.prototype.placePolygonHoles=function(t,e){for(var r=e.iterator();r.hasNext();){var n=r.next();n.isHole()&&n.setShell(t)}},ql.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},ql.prototype.findEdgeRingContaining=function(t,e){for(var r=t.getLinearRing(),n=r.getEnvelopeInternal(),i=r.getCoordinateN(0),o=null,a=null,s=e.iterator();s.hasNext();){var u=s.next(),c=u.getLinearRing(),l=c.getEnvelopeInternal();null!==o&&(a=o.getLinearRing().getEnvelopeInternal());var h=!1;l.contains(n)&&ku.isPointInRing(i,c.getCoordinates())&&(h=!0),h&&(null===o||a.contains(l))&&(o=u)}return o},ql.prototype.findShell=function(t){for(var e=0,r=null,n=t.iterator();n.hasNext();){var i=n.next();i.isHole()||(r=i,e++)}return xu.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),r},ql.prototype.add=function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0];Gl.linkResultDirectedEdges(arguments[1]);var r=this.buildMaximalEdgeRings(e),n=new nc,i=this.buildMinimalEdgeRings(r,this._shellList,n);this.sortShellsAndHoles(i,this._shellList,n),this.placeFreeHoles(this._shellList,n)}},ql.prototype.interfaces_=function(){return[]},ql.prototype.getClass=function(){return ql};function Hl(){}Hl.prototype.getBounds=function(){},Hl.prototype.interfaces_=function(){return[]},Hl.prototype.getClass=function(){return Hl};function $l(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e}$l.prototype.getItem=function(){return this._item},$l.prototype.getBounds=function(){return this._bounds},$l.prototype.interfaces_=function(){return[Hl,pi]},$l.prototype.getClass=function(){return $l};function Wl(){this._size=null,this._items=null,this._size=0,this._items=new nc,this._items.add(null)}Wl.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t},Wl.prototype.size=function(){return this._size},Wl.prototype.reorder=function(t){for(var e=null,r=this._items.get(t);2*t<=this._size&&((e=2*t)!==this._size&&this._items.get(e+1).compareTo(this._items.get(e))<0&&e++,this._items.get(e).compareTo(r)<0);t=e)this._items.set(t,this._items.get(e));this._items.set(t,r)},Wl.prototype.clear=function(){this._size=0,this._items.clear()},Wl.prototype.isEmpty=function(){return 0===this._size},Wl.prototype.add=function(t){this._items.add(null),this._size+=1;var e=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,t)},Wl.prototype.interfaces_=function(){return[]},Wl.prototype.getClass=function(){return Wl};function Xl(){}Xl.prototype.visitItem=function(t){},Xl.prototype.interfaces_=function(){return[]},Xl.prototype.getClass=function(){return Xl};function Yl(){}Yl.prototype.insert=function(t,e){},Yl.prototype.remove=function(t,e){},Yl.prototype.query=function(){},Yl.prototype.interfaces_=function(){return[]},Yl.prototype.getClass=function(){return Yl};function Zl(){if(this._childBoundables=new nc,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._level=t}}var Kl={serialVersionUID:{configurable:!0}};Zl.prototype.getLevel=function(){return this._level},Zl.prototype.size=function(){return this._childBoundables.size()},Zl.prototype.getChildBoundables=function(){return this._childBoundables},Zl.prototype.addChildBoundable=function(t){xu.isTrue(null===this._bounds),this._childBoundables.add(t)},Zl.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},Zl.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},Zl.prototype.interfaces_=function(){return[Hl,pi]},Zl.prototype.getClass=function(){return Zl},Kl.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(Zl,Kl);function Jl(){}Jl.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}},Jl.min=function(t){return Jl.sort(t),t.get(0)},Jl.sort=function(t,e){var r=t.toArray();e?Ec.sort(r,e):Ec.sort(r);for(var n=t.iterator(),i=0,o=r.length;i<o;i++)n.next(),n.set(r[i])},Jl.singletonList=function(t){var e=new nc;return e.add(t),e};function Ql(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],r=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=r,this._distance=this.distance()}Ql.prototype.expandToQueue=function(t,e){var r=Ql.isComposite(this._boundable1),n=Ql.isComposite(this._boundable2);if(r&&n)return Ql.area(this._boundable1)>Ql.area(this._boundable2)?this.expand(this._boundable1,this._boundable2,t,e):this.expand(this._boundable2,this._boundable1,t,e),null;if(r)return this.expand(this._boundable1,this._boundable2,t,e),null;if(n)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new zs("neither boundable is composite")},Ql.prototype.isLeaves=function(){return!(Ql.isComposite(this._boundable1)||Ql.isComposite(this._boundable2))},Ql.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},Ql.prototype.expand=function(t,e,r,n){for(var i=t.getChildBoundables().iterator();i.hasNext();){var o=i.next(),a=new Ql(o,e,this._itemDistance);a.getDistance()<n&&r.add(a)}},Ql.prototype.getBoundable=function(t){return 0===t?this._boundable1:this._boundable2},Ql.prototype.getDistance=function(){return this._distance},Ql.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},Ql.prototype.interfaces_=function(){return[Us]},Ql.prototype.getClass=function(){return Ql},Ql.area=function(t){return t.getBounds().getArea()},Ql.isComposite=function(t){return t instanceof Zl};function th(){if(this._root=null,this._built=!1,this._itemBoundables=new nc,this._nodeCapacity=null,0===arguments.length){var t=th.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(1===arguments.length){var e=arguments[0];xu.isTrue(1<e,"Node capacity must be greater than 1"),this._nodeCapacity=e}}var eh={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};th.prototype.getNodeCapacity=function(){return this._nodeCapacity},th.prototype.lastNode=function(t){return t.get(t.size()-1)},th.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var r=e.next();r instanceof Zl?t+=this.size(r):r instanceof $l&&(t+=1)}return t}},th.prototype.removeItem=function(t,e){for(var r=null,n=t.getChildBoundables().iterator();n.hasNext();){var i=n.next();i instanceof $l&&i.getItem()===e&&(r=i)}return null!==r&&(t.getChildBoundables().remove(r),!0)},th.prototype.itemsTree=function(){if(0===arguments.length){this.build();var t=this.itemsTree(this._root);return null===t?new nc:t}if(1===arguments.length){for(var e=arguments[0],r=new nc,n=e.getChildBoundables().iterator();n.hasNext();){var i=n.next();if(i instanceof Zl){var o=this.itemsTree(i);null!==o&&r.add(o)}else i instanceof $l?r.add(i.getItem()):xu.shouldNeverReachHere()}return r.size()<=0?null:r}},th.prototype.insert=function(t,e){xu.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new $l(t,e))},th.prototype.boundablesAtLevel=function(){if(1===arguments.length){var t=arguments[0],e=new nc;return this.boundablesAtLevel(t,this._root,e),e}if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];if(xu.isTrue(-2<r),n.getLevel()===r)return i.add(n),null;for(var o=n.getChildBoundables().iterator();o.hasNext();){var a=o.next();a instanceof Zl?this.boundablesAtLevel(r,a,i):(xu.isTrue(a instanceof $l),-1===r&&i.add(a))}return null}},th.prototype.query=function(){if(1===arguments.length){var t=arguments[0];this.build();var e=new nc;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,e),e}if(2===arguments.length){var r=arguments[0],n=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,n)}else if(3===arguments.length)if(Zs(arguments[2],Xl)&&arguments[0]instanceof Object&&arguments[1]instanceof Zl)for(var i=arguments[0],o=arguments[2],a=arguments[1].getChildBoundables(),s=0;s<a.size();s++){var u=a.get(s);this.getIntersectsOp().intersects(u.getBounds(),i)&&(u instanceof Zl?this.query(i,u,o):u instanceof $l?o.visitItem(u.getItem()):xu.shouldNeverReachHere())}else if(Zs(arguments[2],Ju)&&arguments[0]instanceof Object&&arguments[1]instanceof Zl)for(var c=arguments[0],l=arguments[2],h=arguments[1].getChildBoundables(),p=0;p<h.size();p++){var f=h.get(p);this.getIntersectsOp().intersects(f.getBounds(),c)&&(f instanceof Zl?this.query(c,f,l):f instanceof $l?l.add(f.getItem()):xu.shouldNeverReachHere())}},th.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},th.prototype.getRoot=function(){return this.build(),this._root},th.prototype.remove=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.remove(t,this._root,e)}if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2],o=this.removeItem(n,i);if(o)return!0;for(var a=null,s=n.getChildBoundables().iterator();s.hasNext();){var u=s.next();if(this.getIntersectsOp().intersects(u.getBounds(),r)&&u instanceof Zl&&(o=this.remove(r,u,i))){a=u;break}}return null!==a&&a.getChildBoundables().isEmpty()&&n.getChildBoundables().remove(a),o}},th.prototype.createHigherLevels=function(t,e){xu.isTrue(!t.isEmpty());var r=this.createParentBoundables(t,e+1);return 1===r.size()?r.get(0):this.createHigherLevels(r,e+1)},th.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var r=e.next();if(r instanceof Zl){var n=this.depth(r);t<n&&(t=n)}}return t+1}},th.prototype.createParentBoundables=function(t,e){xu.isTrue(!t.isEmpty());var r=new nc;r.add(this.createNode(e));var n=new nc(t);Jl.sort(n,this.getComparator());for(var i=n.iterator();i.hasNext();){var o=i.next();this.lastNode(r).getChildBoundables().size()===this.getNodeCapacity()&&r.add(this.createNode(e)),this.lastNode(r).addChildBoundable(o)}return r},th.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},th.prototype.interfaces_=function(){return[pi]},th.prototype.getClass=function(){return th},th.compareDoubles=function(t,e){return e<t?1:t<e?-1:0},eh.IntersectsOp.get=function(){return nh},eh.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},eh.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(th,eh);function rh(){}var nh=function(){};rh.prototype.distance=function(t,e){},rh.prototype.interfaces_=function(){return[]},rh.prototype.getClass=function(){return rh};function ih(){}var oh,ah=function(c){function m(t){t=t||m.DEFAULT_NODE_CAPACITY,c.call(this,t)}c&&(m.__proto__=c);var t={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return((m.prototype=Object.create(c&&c.prototype)).constructor=m).prototype.createParentBoundablesFromVerticalSlices=function(t,e){xu.isTrue(0<t.length);for(var r=new nc,n=0;n<t.length;n++)r.addAll(this.createParentBoundablesFromVerticalSlice(t[n],e));return r},m.prototype.createNode=function(t){return new sh(t)},m.prototype.size=function(){return 0===arguments.length?c.prototype.size.call(this):c.prototype.size.apply(this,arguments)},m.prototype.insert=function(){if(2!==arguments.length)return c.prototype.insert.apply(this,arguments);var t=arguments[0],e=arguments[1];if(t.isNull())return null;c.prototype.insert.call(this,t,e)},m.prototype.getIntersectsOp=function(){return m.intersectsOp},m.prototype.verticalSlices=function(t,e){for(var r=Math.trunc(Math.ceil(t.size()/e)),n=new Array(e).fill(null),i=t.iterator(),o=0;o<e;o++){n[o]=new nc;for(var a=0;i.hasNext()&&a<r;){var s=i.next();n[o].add(s),a++}}return n},m.prototype.query=function(){if(1===arguments.length){var t=arguments[0];return c.prototype.query.call(this,t)}if(2===arguments.length){var e=arguments[0],r=arguments[1];c.prototype.query.call(this,e,r)}else if(3===arguments.length)if(Zs(arguments[2],Xl)&&arguments[0]instanceof Object&&arguments[1]instanceof Zl){var n=arguments[0],i=arguments[1],o=arguments[2];c.prototype.query.call(this,n,i,o)}else if(Zs(arguments[2],Ju)&&arguments[0]instanceof Object&&arguments[1]instanceof Zl){var a=arguments[0],s=arguments[1],u=arguments[2];c.prototype.query.call(this,a,s,u)}},m.prototype.getComparator=function(){return m.yComparator},m.prototype.createParentBoundablesFromVerticalSlice=function(t,e){return c.prototype.createParentBoundables.call(this,t,e)},m.prototype.remove=function(){if(2!==arguments.length)return c.prototype.remove.apply(this,arguments);var t=arguments[0],e=arguments[1];return c.prototype.remove.call(this,t,e)},m.prototype.depth=function(){return 0===arguments.length?c.prototype.depth.call(this):c.prototype.depth.apply(this,arguments)},m.prototype.createParentBoundables=function(t,e){xu.isTrue(!t.isEmpty());var r=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),n=new nc(t);Jl.sort(n,m.xComparator);var i=this.verticalSlices(n,Math.trunc(Math.ceil(Math.sqrt(r))));return this.createParentBoundablesFromVerticalSlices(i,e)},m.prototype.nearestNeighbour=function(){if(1===arguments.length){if(Zs(arguments[0],rh)){var t=arguments[0],e=new Ql(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(e)}if(arguments[0]instanceof Ql){var r=arguments[0];return this.nearestNeighbour(r,Fs.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof m&&Zs(arguments[1],rh)){var n=arguments[0],i=arguments[1],o=new Ql(this.getRoot(),n.getRoot(),i);return this.nearestNeighbour(o)}if(arguments[0]instanceof Ql&&"number"==typeof arguments[1]){var a=arguments[0],s=arguments[1],u=null,c=new Wl;for(c.add(a);!c.isEmpty()&&0<s;){var l=c.poll(),h=l.getDistance();if(s<=h)break;l.isLeaves()?(s=h,u=l):l.expandToQueue(c,s)}return[u.getBoundable(0).getItem(),u.getBoundable(1).getItem()]}}else if(3===arguments.length){var p=arguments[2],f=new $l(arguments[0],arguments[1]),d=new Ql(this.getRoot(),f,p);return this.nearestNeighbour(d)[0]}},m.prototype.interfaces_=function(){return[Yl,pi]},m.prototype.getClass=function(){return m},m.centreX=function(t){return m.avg(t.getMinX(),t.getMaxX())},m.avg=function(t,e){return(t+e)/2},m.centreY=function(t){return m.avg(t.getMinY(),t.getMaxY())},t.STRtreeNode.get=function(){return sh},t.serialVersionUID.get=function(){return 0x39920f7d5f261e0},t.xComparator.get=function(){return{interfaces_:function(){return[Gs]},compare:function(t,e){return c.compareDoubles(m.centreX(t.getBounds()),m.centreX(e.getBounds()))}}},t.yComparator.get=function(){return{interfaces_:function(){return[Gs]},compare:function(t,e){return c.compareDoubles(m.centreY(t.getBounds()),m.centreY(e.getBounds()))}}},t.intersectsOp.get=function(){return{interfaces_:function(){return[c.IntersectsOp]},intersects:function(t,e){return t.intersects(e)}}},t.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(m,t),m}(th),sh=((oh=Zl)&&(uh.__proto__=oh),((uh.prototype=Object.create(oh&&oh.prototype)).constructor=uh).prototype.computeBounds=function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var r=e.next();null===t?t=new du(r.getBounds()):t.expandToInclude(r.getBounds())}return t},uh.prototype.interfaces_=function(){return[]},uh.prototype.getClass=function(){return uh},uh);function uh(){var t=arguments[0];oh.call(this,t)}ih.prototype.interfaces_=function(){return[]},ih.prototype.getClass=function(){return ih},ih.relativeSign=function(t,e){return t<e?-1:e<t?1:0},ih.compare=function(t,e,r){if(e.equals2D(r))return 0;var n=ih.relativeSign(e.x,r.x),i=ih.relativeSign(e.y,r.y);switch(t){case 0:return ih.compareValue(n,i);case 1:return ih.compareValue(i,n);case 2:return ih.compareValue(i,-n);case 3:return ih.compareValue(-n,i);case 4:return ih.compareValue(-n,-i);case 5:return ih.compareValue(-i,-n);case 6:return ih.compareValue(-i,n);case 7:return ih.compareValue(n,-i)}return xu.shouldNeverReachHere("invalid octant value"),0},ih.compareValue=function(t,e){return t<0?-1:0<t?1:e<0?-1:0<e?1:0};function ch(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3];this._segString=t,this.coord=new qs(e),this.segmentIndex=r,this._segmentOctant=n,this._isInterior=!e.equals2D(t.getCoordinate(r))}ch.prototype.getCoordinate=function(){return this.coord},ch.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},ch.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:ih.compare(this._segmentOctant,this.coord,e.coord)},ch.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},ch.prototype.isInterior=function(){return this._isInterior},ch.prototype.interfaces_=function(){return[Us]},ch.prototype.getClass=function(){return ch};function lh(){this._nodeMap=new xi,this._edge=null;var t=arguments[0];this._edge=t}lh.prototype.getSplitCoordinates=function(){var t=new oc;this.addEndpoints();for(var e=this.iterator(),r=e.next();e.hasNext();){var n=e.next();this.addEdgeCoordinates(r,n,t),r=n}return t.toCoordinateArray()},lh.prototype.addCollapsedNodes=function(){var t=new nc;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var r=e.next().intValue();this.add(this._edge.getCoordinate(r),r)}},lh.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},lh.prototype.findCollapsesFromExistingVertices=function(t){for(var e=0;e<this._edge.size()-2;e++){var r=this._edge.getCoordinate(e),n=this._edge.getCoordinate(e+2);r.equals2D(n)&&t.add(new tu(e+1))}},lh.prototype.addEdgeCoordinates=function(t,e,r){var n=this._edge.getCoordinate(e.segmentIndex),i=e.isInterior()||!e.coord.equals2D(n);r.add(new qs(t.coord),!1);for(var o=t.segmentIndex+1;o<=e.segmentIndex;o++)r.add(this._edge.getCoordinate(o));i&&r.add(new qs(e.coord))},lh.prototype.iterator=function(){return this._nodeMap.values().iterator()},lh.prototype.addSplitEdges=function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),r=e.next();e.hasNext();){var n=e.next(),i=this.createSplitEdge(r,n);t.add(i),r=n}},lh.prototype.findCollapseIndex=function(t,e,r){if(!t.coord.equals2D(e.coord))return!1;var n=e.segmentIndex-t.segmentIndex;return e.isInterior()||n--,1===n&&(r[0]=t.segmentIndex+1,!0)},lh.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=new Array(1).fill(null),r=this.iterator(),n=r.next();r.hasNext();){var i=r.next();this.findCollapseIndex(n,i,e)&&t.add(new tu(e[0])),n=i}},lh.prototype.getEdge=function(){return this._edge},lh.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)},lh.prototype.createSplitEdge=function(t,e){var r=e.segmentIndex-t.segmentIndex+2,n=this._edge.getCoordinate(e.segmentIndex),i=e.isInterior()||!e.coord.equals2D(n);i||r--;var o=new Array(r).fill(null),a=0;o[a++]=new qs(t.coord);for(var s=t.segmentIndex+1;s<=e.segmentIndex;s++)o[a++]=this._edge.getCoordinate(s);return i&&(o[a]=new qs(e.coord)),new dh(o,this._edge.getData())},lh.prototype.add=function(t,e){var r=new ch(this._edge,t,e,this._edge.getSegmentOctant(e)),n=this._nodeMap.get(r);return null!==n?(xu.isTrue(n.coord.equals2D(t),"Found equal nodes with different coordinates"),n):(this._nodeMap.put(r,r),r)},lh.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),r=t.get(0).getCoordinate(0);if(!r.equals2D(e[0]))throw new Eu("bad split edge start point at "+r);var n=t.get(t.size()-1).getCoordinates(),i=n[n.length-1];if(!i.equals2D(e[e.length-1]))throw new Eu("bad split edge end point at "+i)},lh.prototype.interfaces_=function(){return[]},lh.prototype.getClass=function(){return lh};function hh(){}hh.prototype.interfaces_=function(){return[]},hh.prototype.getClass=function(){return hh},hh.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new zs("Cannot compute the octant for point ( "+t+", "+e+" )");var r=Math.abs(t),n=Math.abs(e);return 0<=t?0<=e?n<=r?0:1:n<=r?7:6:0<=e?n<=r?3:2:n<=r?4:5}if(arguments[0]instanceof qs&&arguments[1]instanceof qs){var i=arguments[0],o=arguments[1],a=o.x-i.x,s=o.y-i.y;if(0==a&&0==s)throw new zs("Cannot compute the octant for two identical points "+i);return hh.octant(a,s)}};function ph(){}ph.prototype.getCoordinates=function(){},ph.prototype.size=function(){},ph.prototype.getCoordinate=function(t){},ph.prototype.isClosed=function(){},ph.prototype.setData=function(t){},ph.prototype.getData=function(){},ph.prototype.interfaces_=function(){return[]},ph.prototype.getClass=function(){return ph};function fh(){}fh.prototype.addIntersection=function(t,e){},fh.prototype.interfaces_=function(){return[ph]},fh.prototype.getClass=function(){return fh};var dh=function(){this._nodeList=new lh(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};dh.prototype.getCoordinates=function(){return this._pts},dh.prototype.size=function(){return this._pts.length},dh.prototype.getCoordinate=function(t){return this._pts[t]},dh.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},dh.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},dh.prototype.setData=function(t){this._data=t},dh.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:hh.octant(t,e)},dh.prototype.getData=function(){return this._data},dh.prototype.addIntersection=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var r=arguments[1],n=arguments[3],i=new qs(arguments[0].getIntersection(n));this.addIntersection(i,r)}},dh.prototype.toString=function(){return vu.toLineString(new Yc(this._pts))},dh.prototype.getNodeList=function(){return this._nodeList},dh.prototype.addIntersectionNode=function(t,e){var r=e,n=r+1;if(n<this._pts.length){var i=this._pts[n];t.equals2D(i)&&(r=n)}return this._nodeList.add(t,r)},dh.prototype.addIntersections=function(t,e,r){for(var n=0;n<t.getIntersectionNum();n++)this.addIntersection(t,e,r,n)},dh.prototype.interfaces_=function(){return[fh]},dh.prototype.getClass=function(){return dh},dh.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new nc;return dh.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var r=arguments[1],n=arguments[0].iterator();n.hasNext();)n.next().getNodeList().addSplitEdges(r)};function mh(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new qs,this.p1=new qs;else if(1===arguments.length){var t=arguments[0];this.p0=new qs(t.p0),this.p1=new qs(t.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var e=arguments[0],r=arguments[1],n=arguments[2],i=arguments[3];this.p0=new qs(e,r),this.p1=new qs(n,i)}}var gh={serialVersionUID:{configurable:!0}};mh.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},mh.prototype.orientationIndex=function(){if(arguments[0]instanceof mh){var t=arguments[0],e=ku.orientationIndex(this.p0,this.p1,t.p0),r=ku.orientationIndex(this.p0,this.p1,t.p1);return 0<=e&&0<=r?Math.max(e,r):e<=0&&r<=0?Math.max(e,r):0}if(arguments[0]instanceof qs){var n=arguments[0];return ku.orientationIndex(this.p0,this.p1,n)}},mh.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])},mh.prototype.isVertical=function(){return this.p0.x===this.p1.x},mh.prototype.equals=function(t){if(!(t instanceof mh))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},mh.prototype.intersection=function(t){var e=new Lu;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},mh.prototype.project=function(){if(arguments[0]instanceof qs){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new qs(t);var e=this.projectionFactor(t),r=new qs;return r.x=this.p0.x+e*(this.p1.x-this.p0.x),r.y=this.p0.y+e*(this.p1.y-this.p0.y),r}if(arguments[0]instanceof mh){var n=arguments[0],i=this.projectionFactor(n.p0),o=this.projectionFactor(n.p1);if(1<=i&&1<=o)return null;if(i<=0&&o<=0)return null;var a=this.project(n.p0);i<0&&(a=this.p0),1<i&&(a=this.p1);var s=this.project(n.p1);return o<0&&(s=this.p0),1<o&&(s=this.p1),new mh(a,s)}},mh.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},mh.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},mh.prototype.getCoordinate=function(t){return 0===t?this.p0:this.p1},mh.prototype.distancePerpendicular=function(t){return ku.distancePointLinePerpendicular(t,this.p0,this.p1)},mh.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},mh.prototype.midPoint=function(){return mh.midPoint(this.p0,this.p1)},mh.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,r=this.p1.y-this.p0.y,n=e*e+r*r;return n<=0?Fs.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*r)/n},mh.prototype.closestPoints=function(t){var e=this.intersection(t);if(null!==e)return[e,e];var r=new Array(2).fill(null),n=Fs.MAX_VALUE,i=null,o=this.closestPoint(t.p0);n=o.distance(t.p0),r[0]=o,r[1]=t.p0;var a=this.closestPoint(t.p1);(i=a.distance(t.p1))<n&&(n=i,r[0]=a,r[1]=t.p1);var s=t.closestPoint(this.p0);(i=s.distance(this.p0))<n&&(n=i,r[0]=this.p0,r[1]=s);var u=t.closestPoint(this.p1);return(i=u.distance(this.p1))<n&&(n=i,r[0]=this.p1,r[1]=u),r},mh.prototype.closestPoint=function(t){var e=this.projectionFactor(t);return 0<e&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},mh.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},mh.prototype.getLength=function(){return this.p0.distance(this.p1)},mh.prototype.compareTo=function(t){var e=t,r=this.p0.compareTo(e.p0);return 0!==r?r:this.p1.compareTo(e.p1)},mh.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t},mh.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)},mh.prototype.lineIntersection=function(t){try{return fu.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof hu))throw t}return null},mh.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},mh.prototype.pointAlongOffset=function(t,e){var r=this.p0.x+t*(this.p1.x-this.p0.x),n=this.p0.y+t*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,a=Math.sqrt(i*i+o*o),s=0,u=0;if(0!==e){if(a<=0)throw new Error("Cannot compute offset from zero-length line segment");s=e*i/a,u=e*o/a}return new qs(r-u,n+s)},mh.prototype.setCoordinates=function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=r.x,this.p1.y=r.y}},mh.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(1<e||Fs.isNaN(e))&&(e=1),e},mh.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},mh.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},mh.prototype.distance=function(){if(arguments[0]instanceof mh){var t=arguments[0];return ku.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof qs){var e=arguments[0];return ku.distancePointLine(e,this.p0,this.p1)}},mh.prototype.pointAlong=function(t){var e=new qs;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},mh.prototype.hashCode=function(){var t=Fs.doubleToLongBits(this.p0.x);t^=31*Fs.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),r=Fs.doubleToLongBits(this.p1.x);return r^=31*Fs.doubleToLongBits(this.p1.y),e^Math.trunc(r)^Math.trunc(r>>32)},mh.prototype.interfaces_=function(){return[Us,pi]},mh.prototype.getClass=function(){return mh},mh.midPoint=function(t,e){return new qs((t.x+e.x)/2,(t.y+e.y)/2)},gh.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(mh,gh);function yh(){this.tempEnv1=new du,this.tempEnv2=new du,this._overlapSeg1=new mh,this._overlapSeg2=new mh}yh.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[1],e=arguments[2],r=arguments[3];arguments[0].getLineSegment(t,this._overlapSeg1),e.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},yh.prototype.interfaces_=function(){return[]},yh.prototype.getClass=function(){return yh};function vh(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3];this._pts=t,this._start=e,this._end=r,this._context=n}vh.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]},vh.prototype.computeSelect=function(t,e,r,n){var i=this._pts[e],o=this._pts[r];if(n.tempEnv1.init(i,o),r-e==1)return n.select(this,e),null;if(!t.intersects(n.tempEnv1))return null;var a=Math.trunc((e+r)/2);e<a&&this.computeSelect(t,e,a,n),a<r&&this.computeSelect(t,a,r,n)},vh.prototype.getCoordinates=function(){for(var t=new Array(this._end-this._start+1).fill(null),e=0,r=this._start;r<=this._end;r++)t[e++]=this._pts[r];return t},vh.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)},vh.prototype.setId=function(t){this._id=t},vh.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)},vh.prototype.getEnvelope=function(){if(null===this._env){var t=this._pts[this._start],e=this._pts[this._end];this._env=new du(t,e)}return this._env},vh.prototype.getEndIndex=function(){return this._end},vh.prototype.getStartIndex=function(){return this._start},vh.prototype.getContext=function(){return this._context},vh.prototype.getId=function(){return this._id},vh.prototype.computeOverlapsInternal=function(t,e,r,n,i,o){var a=this._pts[t],s=this._pts[e],u=r._pts[n],c=r._pts[i];if(e-t==1&&i-n==1)return o.overlap(this,t,r,n),null;if(o.tempEnv1.init(a,s),o.tempEnv2.init(u,c),!o.tempEnv1.intersects(o.tempEnv2))return null;var l=Math.trunc((t+e)/2),h=Math.trunc((n+i)/2);t<l&&(n<h&&this.computeOverlapsInternal(t,l,r,n,h,o),h<i&&this.computeOverlapsInternal(t,l,r,h,i,o)),l<e&&(n<h&&this.computeOverlapsInternal(l,e,r,n,h,o),h<i&&this.computeOverlapsInternal(l,e,r,h,i,o))},vh.prototype.interfaces_=function(){return[]},vh.prototype.getClass=function(){return vh};function _h(){}_h.prototype.interfaces_=function(){return[]},_h.prototype.getClass=function(){return _h},_h.getChainStartIndices=function(t){var e=0,r=new nc;r.add(new tu(e));do{var n=_h.findChainEnd(t,e);r.add(new tu(n)),e=n}while(e<t.length-1);return _h.toIntArray(r)},_h.findChainEnd=function(t,e){for(var r=e;r<t.length-1&&t[r].equals2D(t[r+1]);)r++;if(r>=t.length-1)return t.length-1;for(var n=Dl.quadrant(t[r],t[r+1]),i=e+1;i<t.length&&(t[i-1].equals2D(t[i])||Dl.quadrant(t[i-1],t[i])===n);)i++;return i-1},_h.getChains=function(){if(1===arguments.length)return _h.getChains(arguments[0],null);if(2===arguments.length){for(var t=arguments[0],e=arguments[1],r=new nc,n=_h.getChainStartIndices(t),i=0;i<n.length-1;i++){var o=new vh(t,n[i],n[i+1],e);r.add(o)}return r}},_h.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),r=0;r<e.length;r++)e[r]=t.get(r).intValue();return e};function bh(){}bh.prototype.computeNodes=function(t){},bh.prototype.getNodedSubstrings=function(){},bh.prototype.interfaces_=function(){return[]},bh.prototype.getClass=function(){return bh};function xh(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}}xh.prototype.setSegmentIntersector=function(t){this._segInt=t},xh.prototype.interfaces_=function(){return[bh]},xh.prototype.getClass=function(){return xh};function wh(){if(this._quadrantSegments=wh.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=wh.CAP_ROUND,this._joinStyle=wh.JOIN_ROUND,this._mitreLimit=wh.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=wh.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this.setQuadrantSegments(e),this.setEndCapStyle(r)}else if(4===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2],a=arguments[3];this.setQuadrantSegments(n),this.setEndCapStyle(i),this.setJoinStyle(o),this.setMitreLimit(a)}}var Sh,Eh=function(e){function t(t){t?e.call(this,t):e.call(this),this._monoChains=new nc,this._index=new ah,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}e&&(t.__proto__=e);var r={SegmentOverlapAction:{configurable:!0}};return((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return dh.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(t){for(var e=_h.getChains(t.getCoordinates(),t).iterator();e.hasNext();){var r=e.next();r.setId(this._idCounter++),this._index.insert(r.getEnvelope(),r),this._monoChains.add(r)}},t.prototype.computeNodes=function(t){for(var e=(this._nodedSegStrings=t).iterator();e.hasNext();)this.add(e.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var t=new Ch(this._segInt),e=this._monoChains.iterator();e.hasNext();)for(var r=e.next(),n=this._index.query(r.getEnvelope()).iterator();n.hasNext();){var i=n.next();if(i.getId()>r.getId()&&(r.computeOverlaps(i,t),this._nOverlaps++),this._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},r.SegmentOverlapAction.get=function(){return Ch},Object.defineProperties(t,r),t}(xh),Ch=((Sh=yh)&&(Th.__proto__=Sh),((Th.prototype=Object.create(Sh&&Sh.prototype)).constructor=Th).prototype.overlap=function(){if(4!==arguments.length)return Sh.prototype.overlap.apply(this,arguments);var t=arguments[1],e=arguments[2],r=arguments[3],n=arguments[0].getContext(),i=e.getContext();this._si.processIntersections(n,t,i,r)},Th.prototype.interfaces_=function(){return[]},Th.prototype.getClass=function(){return Th},Th),Mh={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};function Th(){Sh.call(this),this._si=null;var t=arguments[0];this._si=t}wh.prototype.getEndCapStyle=function(){return this._endCapStyle},wh.prototype.isSingleSided=function(){return this._isSingleSided},wh.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=wh.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=wh.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==wh.JOIN_ROUND&&(this._quadrantSegments=wh.DEFAULT_QUADRANT_SEGMENTS)},wh.prototype.getJoinStyle=function(){return this._joinStyle},wh.prototype.setJoinStyle=function(t){this._joinStyle=t},wh.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t},wh.prototype.getSimplifyFactor=function(){return this._simplifyFactor},wh.prototype.getQuadrantSegments=function(){return this._quadrantSegments},wh.prototype.setEndCapStyle=function(t){this._endCapStyle=t},wh.prototype.getMitreLimit=function(){return this._mitreLimit},wh.prototype.setMitreLimit=function(t){this._mitreLimit=t},wh.prototype.setSingleSided=function(t){this._isSingleSided=t},wh.prototype.interfaces_=function(){return[]},wh.prototype.getClass=function(){return wh},wh.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},Mh.CAP_ROUND.get=function(){return 1},Mh.CAP_FLAT.get=function(){return 2},Mh.CAP_SQUARE.get=function(){return 3},Mh.JOIN_ROUND.get=function(){return 1},Mh.JOIN_MITRE.get=function(){return 2},Mh.JOIN_BEVEL.get=function(){return 3},Mh.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Mh.DEFAULT_MITRE_LIMIT.get=function(){return 5},Mh.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(wh,Mh);function Ph(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=ku.COUNTERCLOCKWISE,this._inputLine=t||null}var Oh={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Ph.prototype.isDeletable=function(t,e,r,n){var i=this._inputLine[t],o=this._inputLine[e],a=this._inputLine[r];return!!this.isConcave(i,o,a)&&!!this.isShallow(i,o,a,n)&&this.isShallowSampled(i,o,t,r,n)},Ph.prototype.deleteShallowConcavities=function(){for(var t=1,e=this.findNextNonDeletedIndex(t),r=this.findNextNonDeletedIndex(e),n=!1;r<this._inputLine.length;){var i=!1;this.isDeletable(t,e,r,this._distanceTol)&&(this._isDeleted[e]=Ph.DELETE,n=i=!0),t=i?r:e,e=this.findNextNonDeletedIndex(t),r=this.findNextNonDeletedIndex(e)}return n},Ph.prototype.isShallowConcavity=function(t,e,r,n){return ku.computeOrientation(t,e,r)===this._angleOrientation&&ku.distancePointLine(e,t,r)<n},Ph.prototype.isShallowSampled=function(t,e,r,n,i){var o=Math.trunc((n-r)/Ph.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var a=r;a<n;a+=o)if(!this.isShallow(t,e,this._inputLine[a],i))return!1;return!0},Ph.prototype.isConcave=function(t,e,r){return ku.computeOrientation(t,e,r)===this._angleOrientation},Ph.prototype.simplify=function(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=ku.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);for(;this.deleteShallowConcavities(););return this.collapseLine()},Ph.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===Ph.DELETE;)e++;return e},Ph.prototype.isShallow=function(t,e,r,n){return ku.distancePointLine(e,t,r)<n},Ph.prototype.collapseLine=function(){for(var t=new oc,e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==Ph.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()},Ph.prototype.interfaces_=function(){return[]},Ph.prototype.getClass=function(){return Ph},Ph.simplify=function(t,e){return new Ph(t).simplify(e)},Oh.INIT.get=function(){return 0},Oh.DELETE.get=function(){return 1},Oh.KEEP.get=function(){return 1},Oh.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Ph,Oh);function Ah(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new nc}var Ih={COORDINATE_ARRAY_TYPE:{configurable:!0}};Ah.prototype.getCoordinates=function(){return this._ptList.toArray(Ah.COORDINATE_ARRAY_TYPE)},Ah.prototype.setPrecisionModel=function(t){this._precisionModel=t},Ah.prototype.addPt=function(t){var e=new qs(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)},Ah.prototype.revere=function(){},Ah.prototype.addPts=function(t,e){if(e)for(var r=0;r<t.length;r++)this.addPt(t[r]);else for(var n=t.length-1;0<=n;n--)this.addPt(t[n])},Ah.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance},Ah.prototype.toString=function(){return(new al).createLineString(this.getCoordinates()).toString()},Ah.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new qs(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)},Ah.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t},Ah.prototype.interfaces_=function(){return[]},Ah.prototype.getClass=function(){return Ah},Ih.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Ah,Ih);function Lh(){}var Rh={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Lh.prototype.interfaces_=function(){return[]},Lh.prototype.getClass=function(){return Lh},Lh.toDegrees=function(t){return 180*t/Math.PI},Lh.normalize=function(t){for(;t>Math.PI;)t-=Lh.PI_TIMES_2;for(;t<=-Math.PI;)t+=Lh.PI_TIMES_2;return t},Lh.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],r=arguments[1],n=r.x-e.x,i=r.y-e.y;return Math.atan2(i,n)}},Lh.isAcute=function(t,e,r){var n=t.x-e.x,i=t.y-e.y;return 0<n*(r.x-e.x)+i*(r.y-e.y)},Lh.isObtuse=function(t,e,r){var n=t.x-e.x,i=t.y-e.y;return n*(r.x-e.x)+i*(r.y-e.y)<0},Lh.interiorAngle=function(t,e,r){var n=Lh.angle(e,t),i=Lh.angle(e,r);return Math.abs(i-n)},Lh.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Lh.PI_TIMES_2;Lh.PI_TIMES_2<=t&&(t=0)}else{for(;Lh.PI_TIMES_2<=t;)t-=Lh.PI_TIMES_2;t<0&&(t=0)}return t},Lh.angleBetween=function(t,e,r){var n=Lh.angle(e,t),i=Lh.angle(e,r);return Lh.diff(n,i)},Lh.diff=function(t,e){var r=null;return(r=t<e?e-t:t-e)>Math.PI&&(r=2*Math.PI-r),r},Lh.toRadians=function(t){return t*Math.PI/180},Lh.getTurn=function(t,e){var r=Math.sin(e-t);return 0<r?Lh.COUNTERCLOCKWISE:r<0?Lh.CLOCKWISE:Lh.NONE},Lh.angleBetweenOriented=function(t,e,r){var n=Lh.angle(e,t),i=Lh.angle(e,r)-n;return i<=-Math.PI?i+Lh.PI_TIMES_2:i>Math.PI?i-Lh.PI_TIMES_2:i},Rh.PI_TIMES_2.get=function(){return 2*Math.PI},Rh.PI_OVER_2.get=function(){return Math.PI/2},Rh.PI_OVER_4.get=function(){return Math.PI/4},Rh.COUNTERCLOCKWISE.get=function(){return ku.COUNTERCLOCKWISE},Rh.CLOCKWISE.get=function(){return ku.CLOCKWISE},Rh.NONE.get=function(){return ku.COLLINEAR},Object.defineProperties(Lh,Rh);function Nh(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new mh,this._seg1=new mh,this._offset0=new mh,this._offset1=new mh,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],e=arguments[1],r=arguments[2];this._precisionModel=t,this._bufParams=e,this._li=new Lu,this._filletAngleQuantum=Math.PI/2/e.getQuadrantSegments(),8<=e.getQuadrantSegments()&&e.getJoinStyle()===wh.JOIN_ROUND&&(this._closingSegLengthFactor=Nh.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)}var kh={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Nh.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var r=ku.computeOrientation(this._s0,this._s1,this._s2),n=r===ku.CLOCKWISE&&this._side===dl.LEFT||r===ku.COUNTERCLOCKWISE&&this._side===dl.RIGHT;0===r?this.addCollinear(e):n?this.addOutsideTurn(r,e):this.addInsideTurn(r,e)},Nh.prototype.addLineEndCap=function(t,e){var r=new mh(t,e),n=new mh;this.computeOffsetSegment(r,dl.LEFT,this._distance,n);var i=new mh;this.computeOffsetSegment(r,dl.RIGHT,this._distance,i);var o=e.x-t.x,a=e.y-t.y,s=Math.atan2(a,o);switch(this._bufParams.getEndCapStyle()){case wh.CAP_ROUND:this._segList.addPt(n.p1),this.addFilletArc(e,s+Math.PI/2,s-Math.PI/2,ku.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case wh.CAP_FLAT:this._segList.addPt(n.p1),this._segList.addPt(i.p1);break;case wh.CAP_SQUARE:var u=new qs;u.x=Math.abs(this._distance)*Math.cos(s),u.y=Math.abs(this._distance)*Math.sin(s);var c=new qs(n.p1.x+u.x,n.p1.y+u.y),l=new qs(i.p1.x+u.x,i.p1.y+u.y);this._segList.addPt(c),this._segList.addPt(l)}},Nh.prototype.getCoordinates=function(){return this._segList.getCoordinates()},Nh.prototype.addMitreJoin=function(t,e,r,n){var i=!0,o=null;try{o=fu.intersection(e.p0,e.p1,r.p0,r.p1),(n<=0?1:o.distance(t)/Math.abs(n))>this._bufParams.getMitreLimit()&&(i=!1)}catch(t){if(!(t instanceof hu))throw t;o=new qs(0,0),i=!1}i?this._segList.addPt(o):this.addLimitedMitreJoin(e,r,n,this._bufParams.getMitreLimit())},Nh.prototype.addFilletCorner=function(t,e,r,n,i){var o=e.x-t.x,a=e.y-t.y,s=Math.atan2(a,o),u=r.x-t.x,c=r.y-t.y,l=Math.atan2(c,u);n===ku.CLOCKWISE?s<=l&&(s+=2*Math.PI):l<=s&&(s-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,s,l,n,i),this._segList.addPt(r)},Nh.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Nh.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===wh.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===wh.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))},Nh.prototype.createSquare=function(t){this._segList.addPt(new qs(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new qs(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new qs(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new qs(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()},Nh.prototype.addSegments=function(t,e){this._segList.addPts(t,e)},Nh.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},Nh.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},Nh.prototype.initSideSegments=function(t,e,r){this._s1=t,this._s2=e,this._side=r,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,r,this._distance,this._offset1)},Nh.prototype.addLimitedMitreJoin=function(t,e,r,n){var i=this._seg0.p1,o=Lh.angle(i,this._seg0.p0),a=Lh.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1)/2,s=Lh.normalize(o+a),u=Lh.normalize(s+Math.PI),c=n*r,l=r-c*Math.abs(Math.sin(a)),h=i.x+c*Math.cos(u),p=i.y+c*Math.sin(u),f=new qs(h,p),d=new mh(i,f),m=d.pointAlongOffset(1,l),g=d.pointAlongOffset(1,-l);this._side===dl.LEFT?(this._segList.addPt(m),this._segList.addPt(g)):(this._segList.addPt(g),this._segList.addPt(m))},Nh.prototype.computeOffsetSegment=function(t,e,r,n){var i=e===dl.LEFT?1:-1,o=t.p1.x-t.p0.x,a=t.p1.y-t.p0.y,s=Math.sqrt(o*o+a*a),u=i*r*o/s,c=i*r*a/s;n.p0.x=t.p0.x-c,n.p0.y=t.p0.y+u,n.p1.x=t.p1.x-c,n.p1.y=t.p1.y+u},Nh.prototype.addFilletArc=function(t,e,r,n,i){var o=n===ku.CLOCKWISE?-1:1,a=Math.abs(e-r),s=Math.trunc(a/this._filletAngleQuantum+.5);if(s<1)return null;for(var u=a/s,c=0,l=new qs;c<a;){var h=e+o*c;l.x=t.x+i*Math.cos(h),l.y=t.y+i*Math.sin(h),this._segList.addPt(l),c+=u}},Nh.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Nh.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),0<this._closingSegLengthFactor){var r=new qs((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r);var n=new qs((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},Nh.prototype.createCircle=function(t){var e=new qs(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},Nh.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)},Nh.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Ah,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Nh.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Nh.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),2<=this._li.getIntersectionNum()&&(this._bufParams.getJoinStyle()===wh.JOIN_BEVEL||this._bufParams.getJoinStyle()===wh.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,ku.CLOCKWISE,this._distance))},Nh.prototype.closeRing=function(){this._segList.closeRing()},Nh.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},Nh.prototype.interfaces_=function(){return[]},Nh.prototype.getClass=function(){return Nh},kh.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},kh.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},kh.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},kh.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Nh,kh);function Dh(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e}Dh.prototype.getOffsetCurve=function(t,e){if(0===(this._distance=e))return null;var r=e<0,n=Math.abs(e),i=this.getSegGen(n);t.length<=1?this.computePointCurve(t[0],i):this.computeOffsetCurve(t,r,i);var o=i.getCoordinates();return r&&tc.reverse(o),o},Dh.prototype.computeSingleSidedBufferCurve=function(t,e,r){var n=this.simplifyTolerance(this._distance);if(e){r.addSegments(t,!0);var i=Ph.simplify(t,-n),o=i.length-1;r.initSideSegments(i[o],i[o-1],dl.LEFT),r.addFirstSegment();for(var a=o-2;0<=a;a--)r.addNextSegment(i[a],!0)}else{r.addSegments(t,!1);var s=Ph.simplify(t,n),u=s.length-1;r.initSideSegments(s[0],s[1],dl.LEFT),r.addFirstSegment();for(var c=2;c<=u;c++)r.addNextSegment(s[c],!0)}r.addLastSegment(),r.closeRing()},Dh.prototype.computeRingBufferCurve=function(t,e,r){var n=this.simplifyTolerance(this._distance);e===dl.RIGHT&&(n=-n);var i=Ph.simplify(t,n),o=i.length-1;r.initSideSegments(i[o-1],i[0],e);for(var a=1;a<=o;a++){var s=1!==a;r.addNextSegment(i[a],s)}r.closeRing()},Dh.prototype.computeLineBufferCurve=function(t,e){var r=this.simplifyTolerance(this._distance),n=Ph.simplify(t,r),i=n.length-1;e.initSideSegments(n[0],n[1],dl.LEFT);for(var o=2;o<=i;o++)e.addNextSegment(n[o],!0);e.addLastSegment(),e.addLineEndCap(n[i-1],n[i]);var a=Ph.simplify(t,-r),s=a.length-1;e.initSideSegments(a[s],a[s-1],dl.LEFT);for(var u=s-2;0<=u;u--)e.addNextSegment(a[u],!0);e.addLastSegment(),e.addLineEndCap(a[1],a[0]),e.closeRing()},Dh.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case wh.CAP_ROUND:e.createCircle(t);break;case wh.CAP_SQUARE:e.createSquare(t)}},Dh.prototype.getLineCurve=function(t,e){if((this._distance=e)<0&&!this._bufParams.isSingleSided())return null;if(0===e)return null;var r=Math.abs(e),n=this.getSegGen(r);if(t.length<=1)this.computePointCurve(t[0],n);else if(this._bufParams.isSingleSided()){var i=e<0;this.computeSingleSidedBufferCurve(t,i,n)}else this.computeLineBufferCurve(t,n);return n.getCoordinates()},Dh.prototype.getBufferParameters=function(){return this._bufParams},Dh.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()},Dh.prototype.getRingCurve=function(t,e,r){if(this._distance=r,t.length<=2)return this.getLineCurve(t,r);if(0===r)return Dh.copyCoordinates(t);var n=this.getSegGen(r);return this.computeRingBufferCurve(t,e,n),n.getCoordinates()},Dh.prototype.computeOffsetCurve=function(t,e,r){var n=this.simplifyTolerance(this._distance);if(e){var i=Ph.simplify(t,-n),o=i.length-1;r.initSideSegments(i[o],i[o-1],dl.LEFT),r.addFirstSegment();for(var a=o-2;0<=a;a--)r.addNextSegment(i[a],!0)}else{var s=Ph.simplify(t,n),u=s.length-1;r.initSideSegments(s[0],s[1],dl.LEFT),r.addFirstSegment();for(var c=2;c<=u;c++)r.addNextSegment(s[c],!0)}r.addLastSegment()},Dh.prototype.getSegGen=function(t){return new Nh(this._precisionModel,this._bufParams,t)},Dh.prototype.interfaces_=function(){return[]},Dh.prototype.getClass=function(){return Dh},Dh.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),r=0;r<e.length;r++)e[r]=new qs(t[r]);return e};function jh(){this._subgraphs=null,this._seg=new mh,this._cga=new ku;var t=arguments[0];this._subgraphs=t}var zh={DepthSegment:{configurable:!0}};jh.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var t=arguments[0],e=new nc,r=this._subgraphs.iterator();r.hasNext();){var n=r.next(),i=n.getEnvelope();t.y<i.getMinY()||t.y>i.getMaxY()||this.findStabbedSegments(t,n.getDirectedEdges(),e)}return e}if(3===arguments.length)if(Zs(arguments[2],Ju)&&arguments[0]instanceof qs&&arguments[1]instanceof Ul){for(var o=arguments[0],a=arguments[1],s=arguments[2],u=a.getEdge().getCoordinates(),c=0;c<u.length-1;c++)if(this._seg.p0=u[c],this._seg.p1=u[c+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<o.x||this._seg.isHorizontal()||o.y<this._seg.p0.y||o.y>this._seg.p1.y||ku.computeOrientation(this._seg.p0,this._seg.p1,o)===ku.RIGHT)){var l=a.getDepth(dl.LEFT);this._seg.p0.equals(u[c])||(l=a.getDepth(dl.RIGHT));var h=new Fh(this._seg,l);s.add(h)}}else if(Zs(arguments[2],Ju)&&arguments[0]instanceof qs&&Zs(arguments[1],Ju))for(var p=arguments[0],f=arguments[2],d=arguments[1].iterator();d.hasNext();){var m=d.next();m.isForward()&&this.findStabbedSegments(p,m,f)}},jh.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:Jl.min(e)._leftDepth},jh.prototype.interfaces_=function(){return[]},jh.prototype.getClass=function(){return jh},zh.DepthSegment.get=function(){return Fh},Object.defineProperties(jh,zh);var Fh=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new mh(t),this._leftDepth=e};Fh.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var r=this._upwardSeg.orientationIndex(e._upwardSeg);return 0!==r?r:0!=(r=-1*e._upwardSeg.orientationIndex(this._upwardSeg))?r:this._upwardSeg.compareTo(e._upwardSeg)},Fh.prototype.compareX=function(t,e){var r=t.p0.compareTo(e.p0);return 0!==r?r:t.p1.compareTo(e.p1)},Fh.prototype.toString=function(){return this._upwardSeg.toString()},Fh.prototype.interfaces_=function(){return[Us]},Fh.prototype.getClass=function(){return Fh};function Bh(t,e,r){this.p0=t||null,this.p1=e||null,this.p2=r||null}Bh.prototype.area=function(){return Bh.area(this.p0,this.p1,this.p2)},Bh.prototype.signedArea=function(){return Bh.signedArea(this.p0,this.p1,this.p2)},Bh.prototype.interpolateZ=function(t){if(null===t)throw new zs("Supplied point is null.");return Bh.interpolateZ(t,this.p0,this.p1,this.p2)},Bh.prototype.longestSideLength=function(){return Bh.longestSideLength(this.p0,this.p1,this.p2)},Bh.prototype.isAcute=function(){return Bh.isAcute(this.p0,this.p1,this.p2)},Bh.prototype.circumcentre=function(){return Bh.circumcentre(this.p0,this.p1,this.p2)},Bh.prototype.area3D=function(){return Bh.area3D(this.p0,this.p1,this.p2)},Bh.prototype.centroid=function(){return Bh.centroid(this.p0,this.p1,this.p2)},Bh.prototype.inCentre=function(){return Bh.inCentre(this.p0,this.p1,this.p2)},Bh.prototype.interfaces_=function(){return[]},Bh.prototype.getClass=function(){return Bh},Bh.area=function(t,e,r){return Math.abs(((r.x-t.x)*(e.y-t.y)-(e.x-t.x)*(r.y-t.y))/2)},Bh.signedArea=function(t,e,r){return((r.x-t.x)*(e.y-t.y)-(e.x-t.x)*(r.y-t.y))/2},Bh.det=function(t,e,r,n){return t*n-e*r},Bh.interpolateZ=function(t,e,r,n){var i=e.x,o=e.y,a=r.x-i,s=n.x-i,u=r.y-o,c=n.y-o,l=a*c-s*u,h=t.x-i,p=t.y-o,f=(c*h-s*p)/l,d=(-u*h+a*p)/l;return e.z+f*(r.z-e.z)+d*(n.z-e.z)},Bh.longestSideLength=function(t,e,r){var n=t.distance(e),i=e.distance(r),o=r.distance(t),a=n;return a<i&&(a=i),a<o&&(a=o),a},Bh.isAcute=function(t,e,r){return!!Lh.isAcute(t,e,r)&&!!Lh.isAcute(e,r,t)&&!!Lh.isAcute(r,t,e)},Bh.circumcentre=function(t,e,r){var n=r.x,i=r.y,o=t.x-n,a=t.y-i,s=e.x-n,u=e.y-i,c=2*Bh.det(o,a,s,u),l=Bh.det(a,o*o+a*a,u,s*s+u*u),h=Bh.det(o,o*o+a*a,s,s*s+u*u);return new qs(n-l/c,i+h/c)},Bh.perpendicularBisector=function(t,e){var r=e.x-t.x,n=e.y-t.y,i=new fu(t.x+r/2,t.y+n/2,1),o=new fu(t.x-n+r/2,t.y+r+n/2,1);return new fu(i,o)},Bh.angleBisector=function(t,e,r){var n=e.distance(t),i=n/(n+e.distance(r)),o=r.x-t.x,a=r.y-t.y;return new qs(t.x+i*o,t.y+i*a)},Bh.area3D=function(t,e,r){var n=e.x-t.x,i=e.y-t.y,o=e.z-t.z,a=r.x-t.x,s=r.y-t.y,u=r.z-t.z,c=i*u-o*s,l=o*a-n*u,h=n*s-i*a,p=c*c+l*l+h*h;return Math.sqrt(p)/2},Bh.centroid=function(t,e,r){var n=(t.x+e.x+r.x)/3,i=(t.y+e.y+r.y)/3;return new qs(n,i)},Bh.inCentre=function(t,e,r){var n=e.distance(r),i=t.distance(r),o=t.distance(e),a=n+i+o,s=(n*t.x+i*e.x+o*r.x)/a,u=(n*t.y+i*e.y+o*r.y)/a;return new qs(s,u)};function Uh(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new nc;var t=arguments[0],e=arguments[1],r=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=r}Uh.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),r=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(r,Xs.EXTERIOR,Xs.INTERIOR)},Uh.prototype.addPolygon=function(t){var e=this._distance,r=dl.LEFT;this._distance<0&&(e=-this._distance,r=dl.RIGHT);var n=t.getExteriorRing(),i=tc.removeRepeatedPoints(n.getCoordinates());if(this._distance<0&&this.isErodedCompletely(n,this._distance))return null;if(this._distance<=0&&i.length<3)return null;this.addPolygonRing(i,e,r,Xs.EXTERIOR,Xs.INTERIOR);for(var o=0;o<t.getNumInteriorRing();o++){var a=t.getInteriorRingN(o),s=tc.removeRepeatedPoints(a.getCoordinates());0<this._distance&&this.isErodedCompletely(a,-this._distance)||this.addPolygonRing(s,e,dl.opposite(r),Xs.INTERIOR,Xs.EXTERIOR)}},Uh.prototype.isTriangleErodedCompletely=function(t,e){var r=new Bh(t[0],t[1],t[2]),n=r.inCentre();return ku.distancePointLine(n,r.p0,r.p1)<Math.abs(e)},Uh.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=tc.removeRepeatedPoints(t.getCoordinates()),r=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(r,Xs.EXTERIOR,Xs.INTERIOR)},Uh.prototype.addCurve=function(t,e,r){if(null===t||t.length<2)return null;var n=new dh(t,new Sl(0,Xs.BOUNDARY,e,r));this._curveList.add(n)},Uh.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Uh.prototype.addPolygonRing=function(t,e,r,n,i){if(0===e&&t.length<Gc.MINIMUM_VALID_SIZE)return null;var o=n,a=i;t.length>=Gc.MINIMUM_VALID_SIZE&&ku.isCCW(t)&&(o=i,a=n,r=dl.opposite(r));var s=this._curveBuilder.getRingCurve(t,r,e);this.addCurve(s,o,a)},Uh.prototype.add=function(t){if(t.isEmpty())return null;t instanceof Uc?this.addPolygon(t):t instanceof jc?this.addLineString(t):t instanceof Fc?this.addPoint(t):t instanceof Vc?this.addCollection(t):t instanceof Ac?this.addCollection(t):t instanceof qc?this.addCollection(t):t instanceof Oc&&this.addCollection(t)},Uh.prototype.isErodedCompletely=function(t,e){var r=t.getCoordinates();if(r.length<4)return e<0;if(4===r.length)return this.isTriangleErodedCompletely(r,e);var n=t.getEnvelopeInternal(),i=Math.min(n.getHeight(),n.getWidth());return e<0&&2*Math.abs(e)>i},Uh.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var r=t.getGeometryN(e);this.add(r)}},Uh.prototype.interfaces_=function(){return[]},Uh.prototype.getClass=function(){return Uh};function Vh(){}Vh.prototype.locate=function(t){},Vh.prototype.interfaces_=function(){return[]},Vh.prototype.getClass=function(){return Vh};function Gh(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()}Gh.prototype.next=function(){if(this._atStart)return this._atStart=!1,Gh.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new fi;var t=this._parent.getGeometryN(this._index++);return t instanceof Oc?(this._subcollectionIterator=new Gh(t),this._subcollectionIterator.next()):t},Gh.prototype.remove=function(){throw new Error(this.getClass().getName())},Gh.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},Gh.prototype.interfaces_=function(){return[Yu]},Gh.prototype.getClass=function(){return Gh},Gh.isAtomic=function(t){return!(t instanceof Oc)};function qh(){this._geom=null;var t=arguments[0];this._geom=t}qh.prototype.locate=function(t){return qh.locate(t,this._geom)},qh.prototype.interfaces_=function(){return[Vh]},qh.prototype.getClass=function(){return qh},qh.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&ku.isPointInRing(t,e.getCoordinates())},qh.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var r=e.getExteriorRing();if(!qh.isPointInRing(t,r))return!1;for(var n=0;n<e.getNumInteriorRing();n++){var i=e.getInteriorRingN(n);if(qh.isPointInRing(t,i))return!1}return!0},qh.containsPoint=function(t,e){if(e instanceof Uc)return qh.containsPointInPolygon(t,e);if(e instanceof Oc)for(var r=new Gh(e);r.hasNext();){var n=r.next();if(n!==e&&qh.containsPoint(t,n))return!0}return!1},qh.locate=function(t,e){return e.isEmpty()?Xs.EXTERIOR:qh.containsPoint(t,e)?Xs.INTERIOR:Xs.EXTERIOR};function Hh(){this._edgeMap=new xi,this._edgeList=null,this._ptInAreaLocation=[Xs.NONE,Xs.NONE]}Hh.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),r=e-1;return 0===e&&(r=this._edgeList.size()-1),this._edgeList.get(r)},Hh.prototype.propagateSideLabels=function(t){for(var e=Xs.NONE,r=this.iterator();r.hasNext();){var n=r.next().getLabel();n.isArea(t)&&n.getLocation(t,dl.LEFT)!==Xs.NONE&&(e=n.getLocation(t,dl.LEFT))}if(e===Xs.NONE)return null;for(var i=e,o=this.iterator();o.hasNext();){var a=o.next(),s=a.getLabel();if(s.getLocation(t,dl.ON)===Xs.NONE&&s.setLocation(t,dl.ON,i),s.isArea(t)){var u=s.getLocation(t,dl.LEFT),c=s.getLocation(t,dl.RIGHT);if(c!==Xs.NONE){if(c!==i)throw new _l("side location conflict",a.getCoordinate());u===Xs.NONE&&xu.shouldNeverReachHere("found single null side (at "+a.getCoordinate()+")"),i=u}else xu.isTrue(s.getLocation(t,dl.LEFT)===Xs.NONE,"found single null side"),s.setLocation(t,dl.RIGHT,i),s.setLocation(t,dl.LEFT,i)}}},Hh.prototype.getCoordinate=function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},Hh.prototype.print=function(t){cu.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();)e.next().print(t)},Hh.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},Hh.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var r=e.size()-1,n=e.get(r).getLabel().getLocation(t,dl.LEFT);xu.isTrue(n!==Xs.NONE,"Found unlabelled area edge");for(var i=n,o=this.iterator();o.hasNext();){var a=o.next().getLabel();xu.isTrue(a.isArea(t),"Found non-area edge");var s=a.getLocation(t,dl.LEFT),u=a.getLocation(t,dl.RIGHT);if(s===u)return!1;if(u!==i)return!1;i=s}return!0},Hh.prototype.findIndex=function(t){this.iterator();for(var e=0;e<this._edgeList.size();e++)if(this._edgeList.get(e)===t)return e;return-1},Hh.prototype.iterator=function(){return this.getEdges().iterator()},Hh.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new nc(this._edgeMap.values())),this._edgeList},Hh.prototype.getLocation=function(t,e,r){return this._ptInAreaLocation[t]===Xs.NONE&&(this._ptInAreaLocation[t]=qh.locate(e,r[t].getGeometry())),this._ptInAreaLocation[t]},Hh.prototype.toString=function(){var t=new Qs;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var r=e.next();t.append(r),t.append("\n")}return t.toString()},Hh.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();)e.next().computeLabel(t)},Hh.prototype.computeLabelling=function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],r=this.iterator();r.hasNext();)for(var n=r.next().getLabel(),i=0;i<2;i++)n.isLine(i)&&n.getLocation(i)===Xs.BOUNDARY&&(e[i]=!0);for(var o=this.iterator();o.hasNext();)for(var a=o.next(),s=a.getLabel(),u=0;u<2;u++)if(s.isAnyNull(u)){var c=Xs.NONE;if(e[u])c=Xs.EXTERIOR;else{var l=a.getCoordinate();c=this.getLocation(u,l,t)}s.setAllLocationsIfNull(u,c)}},Hh.prototype.getDegree=function(){return this._edgeMap.size()},Hh.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null},Hh.prototype.interfaces_=function(){return[]},Hh.prototype.getClass=function(){return Hh};function $h(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=$h.orientation(t)}var Wh,Xh,Yh=((Xh=Hh)&&(Jh.__proto__=Xh),((Jh.prototype=Object.create(Xh&&Xh.prototype)).constructor=Jh).prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var t=null,e=null,r=this._SCANNING_FOR_INCOMING,n=0;n<this._resultAreaEdgeList.size();n++){var i=this._resultAreaEdgeList.get(n),o=i.getSym();if(i.getLabel().isArea())switch(null===t&&i.isInResult()&&(t=i),r){case this._SCANNING_FOR_INCOMING:if(!o.isInResult())continue;e=o,r=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!i.isInResult())continue;e.setNext(i),r=this._SCANNING_FOR_INCOMING}}if(r===this._LINKING_TO_OUTGOING){if(null===t)throw new _l("no outgoing dirEdge found",this.getCoordinate());xu.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),e.setNext(t)}},Jh.prototype.insert=function(t){var e=t;this.insertEdgeEnd(e,e)},Jh.prototype.getRightmostEdge=function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var r=t.get(0);if(1===e)return r;var n=t.get(e-1),i=r.getQuadrant(),o=n.getQuadrant();return Dl.isNorthern(i)&&Dl.isNorthern(o)?r:Dl.isNorthern(i)||Dl.isNorthern(o)?0!==r.getDy()?r:0!==n.getDy()?n:(xu.shouldNeverReachHere("found two horizontal edges incident on node"),null):n},Jh.prototype.print=function(t){cu.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var r=e.next();t.print("out "),r.print(t),t.println(),t.print("in "),r.getSym().print(t),t.println()}},Jh.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new nc;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList},Jh.prototype.updateLabelling=function(t){for(var e=this.iterator();e.hasNext();){var r=e.next().getLabel();r.setAllLocationsIfNull(0,t.getLocation(0)),r.setAllLocationsIfNull(1,t.getLocation(1))}},Jh.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var t=null,e=null,r=this._edgeList.size()-1;0<=r;r--){var n=this._edgeList.get(r),i=n.getSym();null===e&&(e=i),null!==t&&i.setNext(t),t=n}e.setNext(t)},Jh.prototype.computeDepths=function(){if(1===arguments.length){var t=arguments[0],e=this.findIndex(t),r=t.getDepth(dl.LEFT),n=t.getDepth(dl.RIGHT),i=this.computeDepths(e+1,this._edgeList.size(),r);if(this.computeDepths(0,e,i)!==n)throw new _l("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var o=arguments[1],a=arguments[2],s=arguments[0];s<o;s++){var u=this._edgeList.get(s);u.setEdgeDepths(dl.RIGHT,a),a=u.getDepth(dl.LEFT)}return a}},Jh.prototype.mergeSymLabels=function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},Jh.prototype.linkMinimalDirectedEdges=function(t){for(var e=null,r=null,n=this._SCANNING_FOR_INCOMING,i=this._resultAreaEdgeList.size()-1;0<=i;i--){var o=this._resultAreaEdgeList.get(i),a=o.getSym();switch(null===e&&o.getEdgeRing()===t&&(e=o),n){case this._SCANNING_FOR_INCOMING:if(a.getEdgeRing()!==t)continue;r=a,n=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(o.getEdgeRing()!==t)continue;r.setNextMin(o),n=this._SCANNING_FOR_INCOMING}}n===this._LINKING_TO_OUTGOING&&(xu.isTrue(null!==e,"found null for first outgoing dirEdge"),xu.isTrue(e.getEdgeRing()===t,"unable to link last incoming dirEdge"),r.setNextMin(e))},Jh.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();)e.next().isInResult()&&t++;return t}if(1===arguments.length){for(var r=arguments[0],n=0,i=this.iterator();i.hasNext();)i.next().getEdgeRing()===r&&n++;return n}},Jh.prototype.getLabel=function(){return this._label},Jh.prototype.findCoveredLineEdges=function(){for(var t=Xs.NONE,e=this.iterator();e.hasNext();){var r=e.next(),n=r.getSym();if(!r.isLineEdge()){if(r.isInResult()){t=Xs.INTERIOR;break}if(n.isInResult()){t=Xs.EXTERIOR;break}}}if(t===Xs.NONE)return null;for(var i=t,o=this.iterator();o.hasNext();){var a=o.next(),s=a.getSym();a.isLineEdge()?a.getEdge().setCovered(i===Xs.INTERIOR):(a.isInResult()&&(i=Xs.EXTERIOR),s.isInResult()&&(i=Xs.INTERIOR))}},Jh.prototype.computeLabelling=function(t){Xh.prototype.computeLabelling.call(this,t),this._label=new Sl(Xs.NONE);for(var e=this.iterator();e.hasNext();)for(var r=e.next().getEdge().getLabel(),n=0;n<2;n++){var i=r.getLocation(n);i!==Xs.INTERIOR&&i!==Xs.BOUNDARY||this._label.setLocation(n,Xs.INTERIOR)}},Jh.prototype.interfaces_=function(){return[]},Jh.prototype.getClass=function(){return Jh},Jh),Zh=((Wh=Fl)&&(Kh.__proto__=Wh),((Kh.prototype=Object.create(Wh&&Wh.prototype)).constructor=Kh).prototype.createNode=function(t){return new Nl(t,new Yh)},Kh.prototype.interfaces_=function(){return[]},Kh.prototype.getClass=function(){return Kh},Kh);function Kh(){Wh.apply(this,arguments)}function Jh(){Xh.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}$h.prototype.compareTo=function(t){var e=t;return $h.compareOriented(this._pts,this._orientation,e._pts,e._orientation)},$h.prototype.interfaces_=function(){return[Us]},$h.prototype.getClass=function(){return $h},$h.orientation=function(t){return 1===tc.increasingDirection(t)},$h.compareOriented=function(t,e,r,n){for(var i=e?1:-1,o=n?1:-1,a=e?t.length:-1,s=n?r.length:-1,u=e?0:t.length-1,c=n?0:r.length-1;;){var l=t[u].compareTo(r[c]);if(0!==l)return l;var h=(u+=i)===a,p=(c+=o)===s;if(h&&!p)return-1;if(!h&&p)return 1;if(h&&p)return 0}};function Qh(){this._edges=new nc,this._ocaMap=new xi}Qh.prototype.print=function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this._edges.size();e++){var r=this._edges.get(e);0<e&&t.print(","),t.print("(");for(var n=r.getCoordinates(),i=0;i<n.length;i++)0<i&&t.print(","),t.print(n[i].x+" "+n[i].y);t.println(")")}t.print(")  ")},Qh.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},Qh.prototype.findEdgeIndex=function(t){for(var e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1},Qh.prototype.iterator=function(){return this._edges.iterator()},Qh.prototype.getEdges=function(){return this._edges},Qh.prototype.get=function(t){return this._edges.get(t)},Qh.prototype.findEqualEdge=function(t){var e=new $h(t.getCoordinates());return this._ocaMap.get(e)},Qh.prototype.add=function(t){this._edges.add(t);var e=new $h(t.getCoordinates());this._ocaMap.put(e,t)},Qh.prototype.interfaces_=function(){return[]},Qh.prototype.getClass=function(){return Qh};function tp(){}tp.prototype.processIntersections=function(t,e,r,n){},tp.prototype.isDone=function(){},tp.prototype.interfaces_=function(){return[]},tp.prototype.getClass=function(){return tp};function ep(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0;var t=arguments[this.numTests=0];this._li=t}ep.prototype.isTrivialIntersection=function(t,e,r,n){if(t===r&&1===this._li.getIntersectionNum()){if(ep.isAdjacentSegments(e,n))return!0;if(t.isClosed()){var i=t.size()-1;if(0===e&&n===i||0===n&&e===i)return!0}}return!1},ep.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},ep.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},ep.prototype.getLineIntersector=function(){return this._li},ep.prototype.hasProperIntersection=function(){return this._hasProper},ep.prototype.processIntersections=function(t,e,r,n){if(t===r&&e===n)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=r.getCoordinates()[n],s=r.getCoordinates()[n+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,r,n)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),r.addIntersections(this._li,n,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},ep.prototype.hasIntersection=function(){return this._hasIntersection},ep.prototype.isDone=function(){return!1},ep.prototype.hasInteriorIntersection=function(){return this._hasInterior},ep.prototype.interfaces_=function(){return[tp]},ep.prototype.getClass=function(){return ep},ep.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};function rp(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],r=arguments[2];this.coord=new qs(t),this.segmentIndex=e,this.dist=r}rp.prototype.getSegmentIndex=function(){return this.segmentIndex},rp.prototype.getCoordinate=function(){return this.coord},rp.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},rp.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},rp.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},rp.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},rp.prototype.getDistance=function(){return this.dist},rp.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},rp.prototype.interfaces_=function(){return[Us]},rp.prototype.getClass=function(){return rp};function np(){this._nodeMap=new xi,this.edge=null;var t=arguments[0];this.edge=t}np.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},np.prototype.iterator=function(){return this._nodeMap.values().iterator()},np.prototype.addSplitEdges=function(t){this.addEndpoints();for(var e=this.iterator(),r=e.next();e.hasNext();){var n=e.next(),i=this.createSplitEdge(r,n);t.add(i),r=n}},np.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},np.prototype.createSplitEdge=function(t,e){var r=e.segmentIndex-t.segmentIndex+2,n=this.edge.pts[e.segmentIndex],i=0<e.dist||!e.coord.equals2D(n);i||r--;var o=new Array(r).fill(null),a=0;o[a++]=new qs(t.coord);for(var s=t.segmentIndex+1;s<=e.segmentIndex;s++)o[a++]=this.edge.pts[s];return i&&(o[a]=e.coord),new lp(o,new Sl(this.edge._label))},np.prototype.add=function(t,e,r){var n=new rp(t,e,r),i=this._nodeMap.get(n);return null!==i?i:(this._nodeMap.put(n,n),n)},np.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1},np.prototype.interfaces_=function(){return[]},np.prototype.getClass=function(){return np};function ip(){}ip.prototype.getChainStartIndices=function(t){var e=0,r=new nc;r.add(new tu(e));do{var n=this.findChainEnd(t,e);r.add(new tu(n)),e=n}while(e<t.length-1);return ip.toIntArray(r)},ip.prototype.findChainEnd=function(t,e){for(var r=Dl.quadrant(t[e],t[e+1]),n=e+1;n<t.length&&Dl.quadrant(t[n-1],t[n])===r;)n++;return n-1},ip.prototype.interfaces_=function(){return[]},ip.prototype.getClass=function(){return ip},ip.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),r=0;r<e.length;r++)e[r]=t.get(r).intValue();return e};function op(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new du,this.env2=new du;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new ip;this.startIndex=e.getChainStartIndices(this.pts)}op.prototype.getCoordinates=function(){return this.pts},op.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,r=this.pts[this.startIndex[t+1]].x;return r<e?e:r},op.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,r=this.pts[this.startIndex[t+1]].x;return e<r?e:r},op.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],r=arguments[2],n=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[r],e.startIndex[r+1],n)}else if(6===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3],u=arguments[4],c=arguments[5],l=this.pts[i],h=this.pts[o],p=a.pts[s],f=a.pts[u];if(o-i==1&&u-s==1)return c.addIntersections(this.e,i,a.e,s),null;if(this.env1.init(l,h),this.env2.init(p,f),!this.env1.intersects(this.env2))return null;var d=Math.trunc((i+o)/2),m=Math.trunc((s+u)/2);i<d&&(s<m&&this.computeIntersectsForChain(i,d,a,s,m,c),m<u&&this.computeIntersectsForChain(i,d,a,m,u,c)),d<o&&(s<m&&this.computeIntersectsForChain(d,o,a,s,m,c),m<u&&this.computeIntersectsForChain(d,o,a,m,u,c))}},op.prototype.getStartIndexes=function(){return this.startIndex},op.prototype.computeIntersects=function(t,e){for(var r=0;r<this.startIndex.length-1;r++)for(var n=0;n<t.startIndex.length-1;n++)this.computeIntersectsForChain(r,t,n,e)},op.prototype.interfaces_=function(){return[]},op.prototype.getClass=function(){return op};function ap(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var t=0;t<2;t++)for(var e=0;e<3;e++)this._depth[t][e]=ap.NULL_VALUE}var sp={NULL_VALUE:{configurable:!0}};ap.prototype.getDepth=function(t,e){return this._depth[t][e]},ap.prototype.setDepth=function(t,e,r){this._depth[t][e]=r},ap.prototype.isNull=function(){if(0===arguments.length){for(var t=0;t<2;t++)for(var e=0;e<3;e++)if(this._depth[t][e]!==ap.NULL_VALUE)return!1;return!0}if(1===arguments.length){var r=arguments[0];return this._depth[r][1]===ap.NULL_VALUE}if(2===arguments.length){var n=arguments[0],i=arguments[1];return this._depth[n][i]===ap.NULL_VALUE}},ap.prototype.normalize=function(){for(var t=0;t<2;t++)if(!this.isNull(t)){var e=this._depth[t][1];this._depth[t][2]<e&&(e=this._depth[t][2]),e<0&&(e=0);for(var r=1;r<3;r++){var n=0;this._depth[t][r]>e&&(n=1),this._depth[t][r]=n}}},ap.prototype.getDelta=function(t){return this._depth[t][dl.RIGHT]-this._depth[t][dl.LEFT]},ap.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?Xs.EXTERIOR:Xs.INTERIOR},ap.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},ap.prototype.add=function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<2;e++)for(var r=1;r<3;r++){var n=t.getLocation(e,r);n!==Xs.EXTERIOR&&n!==Xs.INTERIOR||(this.isNull(e,r)?this._depth[e][r]=ap.depthAtLocation(n):this._depth[e][r]+=ap.depthAtLocation(n))}else if(3===arguments.length){var i=arguments[0],o=arguments[1];arguments[2]===Xs.INTERIOR&&this._depth[i][o]++}},ap.prototype.interfaces_=function(){return[]},ap.prototype.getClass=function(){return ap},ap.depthAtLocation=function(t){return t===Xs.EXTERIOR?0:t===Xs.INTERIOR?1:ap.NULL_VALUE},sp.NULL_VALUE.get=function(){return-1},Object.defineProperties(ap,sp);function up(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Qh,this._bufParams=t||null}var cp,lp=((cp=Cl)&&(hp.__proto__=cp),((hp.prototype=Object.create(cp&&cp.prototype)).constructor=hp).prototype.getDepth=function(){return this._depth},hp.prototype.getCollapsedEdge=function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new hp(t,Sl.toLineLabel(this._label))},hp.prototype.isIsolated=function(){return this._isIsolated},hp.prototype.getCoordinates=function(){return this.pts},hp.prototype.setIsolated=function(t){this._isIsolated=t},hp.prototype.setName=function(t){this._name=t},hp.prototype.equals=function(t){if(!(t instanceof hp))return!1;var e=t;if(this.pts.length!==e.pts.length)return!1;for(var r=!0,n=!0,i=this.pts.length,o=0;o<this.pts.length;o++)if(this.pts[o].equals2D(e.pts[o])||(r=!1),this.pts[o].equals2D(e.pts[--i])||(n=!1),!r&&!n)return!1;return!0},hp.prototype.getCoordinate=function(){if(0===arguments.length)return 0<this.pts.length?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},hp.prototype.print=function(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)0<e&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)},hp.prototype.computeIM=function(t){hp.updateIM(this._label,t)},hp.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},hp.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},hp.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},hp.prototype.getDepthDelta=function(){return this._depthDelta},hp.prototype.getNumPoints=function(){return this.pts.length},hp.prototype.printReverse=function(t){t.print("edge "+this._name+": ");for(var e=this.pts.length-1;0<=e;e--)t.print(this.pts[e]+" ");t.println("")},hp.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new op(this)),this._mce},hp.prototype.getEnvelope=function(){if(null===this._env){this._env=new du;for(var t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env},hp.prototype.addIntersection=function(t,e,r,n){var i=new qs(t.getIntersection(n)),o=e,a=t.getEdgeDistance(r,n),s=o+1;if(s<this.pts.length){var u=this.pts[s];i.equals2D(u)&&(o=s,a=0)}this.eiList.add(i,o,a)},hp.prototype.toString=function(){var t=new Qs;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)0<e&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()},hp.prototype.isPointwiseEqual=function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},hp.prototype.setDepthDelta=function(t){this._depthDelta=t},hp.prototype.getEdgeIntersectionList=function(){return this.eiList},hp.prototype.addIntersections=function(t,e,r){for(var n=0;n<t.getIntersectionNum();n++)this.addIntersection(t,e,r,n)},hp.prototype.interfaces_=function(){return[]},hp.prototype.getClass=function(){return hp},hp.updateIM=function(){if(2!==arguments.length)return cp.prototype.updateIM.apply(this,arguments);var t=arguments[0],e=arguments[1];e.setAtLeastIfValid(t.getLocation(0,dl.ON),t.getLocation(1,dl.ON),1),t.isArea()&&(e.setAtLeastIfValid(t.getLocation(0,dl.LEFT),t.getLocation(1,dl.LEFT),2),e.setAtLeastIfValid(t.getLocation(0,dl.RIGHT),t.getLocation(1,dl.RIGHT),2))},hp);function hp(){if(cp.call(this),this.pts=null,this._env=null,this.eiList=new np(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ap,this._depthDelta=0,1===arguments.length)hp.call(this,arguments[0],null);else if(2===arguments.length){var t=arguments[0],e=arguments[1];this.pts=t,this._label=e}}up.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t},up.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var r=e.getLabel(),n=t.getLabel();e.isPointwiseEqual(t)||(n=new Sl(t.getLabel())).flip(),r.merge(n);var i=up.depthDelta(n),o=e.getDepthDelta()+i;e.setDepthDelta(o)}else this._edgeList.add(t),t.setDepthDelta(up.depthDelta(t.getLabel()))},up.prototype.buildSubgraphs=function(t,e){for(var r=new nc,n=t.iterator();n.hasNext();){var i=n.next(),o=i.getRightmostCoordinate(),a=new jh(r).getDepth(o);i.computeDepth(a),i.findResultEdges(),r.add(i),e.add(i.getDirectedEdges(),i.getNodes())}},up.prototype.createSubgraphs=function(t){for(var e=new nc,r=t.getNodes().iterator();r.hasNext();){var n=r.next();if(!n.isVisited()){var i=new xl;i.create(n),e.add(i)}}return Jl.sort(e,Jl.reverseOrder()),e},up.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},up.prototype.getNoder=function(t){if(null!==this._workingNoder)return this._workingNoder;var e=new Eh,r=new Lu;return r.setPrecisionModel(t),e.setSegmentIntersector(new ep(r)),e},up.prototype.buffer=function(t,e){var r=this._workingPrecisionModel;null===r&&(r=t.getPrecisionModel()),this._geomFact=t.getFactory();var n=new Dh(r,this._bufParams),i=new Uh(t,e,n).getCurves();if(i.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(i,r),this._graph=new Gl(new Zh),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),a=new ql(this._geomFact);this.buildSubgraphs(o,a);var s=a.getPolygons();return s.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(s)},up.prototype.computeNodedEdges=function(t,e){var r=this.getNoder(e);r.computeNodes(t);for(var n=r.getNodedSubstrings().iterator();n.hasNext();){var i=n.next(),o=i.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var a=i.getData(),s=new lp(i.getCoordinates(),new Sl(a));this.insertUniqueEdge(s)}}},up.prototype.setNoder=function(t){this._workingNoder=t},up.prototype.interfaces_=function(){return[]},up.prototype.getClass=function(){return up},up.depthDelta=function(t){var e=t.getLocation(0,dl.LEFT),r=t.getLocation(0,dl.RIGHT);return e===Xs.INTERIOR&&r===Xs.EXTERIOR?1:e===Xs.EXTERIOR&&r===Xs.INTERIOR?-1:0},up.convertSegStrings=function(t){for(var e=new al,r=new nc;t.hasNext();){var n=t.next(),i=e.createLineString(n.getCoordinates());r.add(i)}return e.buildGeometry(r)};function pp(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2],o=arguments[3];this._noder=r,this._scaleFactor=n,this._offsetX=i,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}}pp.prototype.rescale=function(){if(Zs(arguments[0],Xu))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.rescale(e.getCoordinates())}else if(arguments[0]instanceof Array){for(var r=arguments[0],n=0;n<r.length;n++)r[n].x=r[n].x/this._scaleFactor+this._offsetX,r[n].y=r[n].y/this._scaleFactor+this._offsetY;2===r.length&&r[0].equals2D(r[1])&&cu.out.println(r)}},pp.prototype.scale=function(){if(Zs(arguments[0],Xu)){for(var t=arguments[0],e=new nc,r=t.iterator();r.hasNext();){var n=r.next();e.add(new dh(this.scale(n.getCoordinates()),n.getData()))}return e}if(arguments[0]instanceof Array){for(var i=arguments[0],o=new Array(i.length).fill(null),a=0;a<i.length;a++)o[a]=new qs(Math.round((i[a].x-this._offsetX)*this._scaleFactor),Math.round((i[a].y-this._offsetY)*this._scaleFactor),i[a].z);return tc.removeRepeatedPoints(o)}},pp.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},pp.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t},pp.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)},pp.prototype.interfaces_=function(){return[bh]},pp.prototype.getClass=function(){return pp};function fp(){this._li=new Lu,this._segStrings=null;var t=arguments[0];this._segStrings=t}var dp={fact:{configurable:!0}};fp.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next().getCoordinates();this.checkEndPtVertexIntersections(e[0],this._segStrings),this.checkEndPtVertexIntersections(e[e.length-1],this._segStrings)}else if(2===arguments.length)for(var r=arguments[0],n=arguments[1].iterator();n.hasNext();)for(var i=n.next().getCoordinates(),o=1;o<i.length-1;o++)if(i[o].equals(r))throw new Eu("found endpt/interior pt intersection at index "+o+" :pt "+r)},fp.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();)for(var e=t.next(),r=this._segStrings.iterator();r.hasNext();){var n=r.next();this.checkInteriorIntersections(e,n)}else if(2===arguments.length)for(var i=arguments[0],o=arguments[1],a=i.getCoordinates(),s=o.getCoordinates(),u=0;u<a.length-1;u++)for(var c=0;c<s.length-1;c++)this.checkInteriorIntersections(i,u,o,c);else if(4===arguments.length){var l=arguments[0],h=arguments[1],p=arguments[2],f=arguments[3];if(l===p&&h===f)return null;var d=l.getCoordinates()[h],m=l.getCoordinates()[h+1],g=p.getCoordinates()[f],y=p.getCoordinates()[f+1];if(this._li.computeIntersection(d,m,g,y),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,d,m)||this.hasInteriorIntersection(this._li,g,y)))throw new Eu("found non-noded intersection at "+d+"-"+m+" and "+g+"-"+y)}},fp.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},fp.prototype.checkCollapses=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next();this.checkCollapses(e)}else if(1===arguments.length)for(var r=arguments[0].getCoordinates(),n=0;n<r.length-2;n++)this.checkCollapse(r[n],r[n+1],r[n+2])},fp.prototype.hasInteriorIntersection=function(t,e,r){for(var n=0;n<t.getIntersectionNum();n++){var i=t.getIntersection(n);if(!i.equals(e)&&!i.equals(r))return!0}return!1},fp.prototype.checkCollapse=function(t,e,r){if(t.equals(r))throw new Eu("found non-noded collapse at "+fp.fact.createLineString([t,e,r]))},fp.prototype.interfaces_=function(){return[]},fp.prototype.getClass=function(){return fp},dp.fact.get=function(){return new al},Object.defineProperties(fp,dp);function mp(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],r=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=r,e<=0)throw new zs("Scale factor must be non-zero");1!==e&&(this._pt=new qs(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new qs,this._p1Scaled=new qs),this.initCorners(this._pt)}var gp={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};mp.prototype.intersectsScaled=function(t,e){var r=Math.min(t.x,e.x),n=Math.max(t.x,e.x),i=Math.min(t.y,e.y),o=Math.max(t.y,e.y),a=this._maxx<r||this._minx>n||this._maxy<i||this._miny>o;if(a)return!1;var s=this.intersectsToleranceSquare(t,e);return xu.isTrue(!(a&&s),"Found bad envelope test"),s},mp.prototype.initCorners=function(t){this._minx=t.x-.5,this._maxx=t.x+.5,this._miny=t.y-.5,this._maxy=t.y+.5,this._corner[0]=new qs(this._maxx,this._maxy),this._corner[1]=new qs(this._minx,this._maxy),this._corner[2]=new qs(this._minx,this._miny),this._corner[3]=new qs(this._maxx,this._miny)},mp.prototype.intersects=function(t,e){return 1===this._scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},mp.prototype.scale=function(t){return Math.round(t*this._scaleFactor)},mp.prototype.getCoordinate=function(){return this._originalPt},mp.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},mp.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var t=mp.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new du(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv},mp.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},mp.prototype.intersectsToleranceSquare=function(t,e){var r=!1,n=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper()||r&&n||t.equals(this._pt)||e.equals(this._pt)))))},mp.prototype.addSnappedNode=function(t,e){var r=t.getCoordinate(e),n=t.getCoordinate(e+1);return!!this.intersects(r,n)&&(t.addIntersection(this.getCoordinate(),e),!0)},mp.prototype.interfaces_=function(){return[]},mp.prototype.getClass=function(){return mp},gp.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(mp,gp);function yp(){this.tempEnv1=new du,this.selectedSegment=new mh}yp.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var t=arguments[1];arguments[0].getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}},yp.prototype.interfaces_=function(){return[]},yp.prototype.getClass=function(){return yp};function vp(){this._index=null;var t=arguments[0];this._index=t}var _p={HotPixelSnapAction:{configurable:!0}};vp.prototype.snap=function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],r=arguments[1],n=arguments[2],i=e.getSafeEnvelope(),o=new wp(e,r,n);return this._index.query(i,{interfaces_:function(){return[Xl]},visitItem:function(t){t.select(i,o)}}),o.isNodeAdded()}},vp.prototype.interfaces_=function(){return[]},vp.prototype.getClass=function(){return vp},_p.HotPixelSnapAction.get=function(){return wp},Object.defineProperties(vp,_p);function bp(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new nc}var xp,wp=((xp=yp)&&(Sp.__proto__=xp),((Sp.prototype=Object.create(xp&&xp.prototype)).constructor=Sp).prototype.isNodeAdded=function(){return this._isNodeAdded},Sp.prototype.select=function(){if(2!==arguments.length)return xp.prototype.select.apply(this,arguments);var t=arguments[1],e=arguments[0].getContext();if(null!==this._parentEdge&&e===this._parentEdge&&t===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(e,t)},Sp.prototype.interfaces_=function(){return[]},Sp.prototype.getClass=function(){return Sp},Sp);function Sp(){xp.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var t=arguments[0],e=arguments[1],r=arguments[2];this._hotPixel=t,this._parentEdge=e,this._hotPixelVertexIndex=r}bp.prototype.processIntersections=function(t,e,r,n){if(t===r&&e===n)return null;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=r.getCoordinates()[n],s=r.getCoordinates()[n+1];if(this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var u=0;u<this._li.getIntersectionNum();u++)this._interiorIntersections.add(this._li.getIntersection(u));t.addIntersections(this._li,e,0),r.addIntersections(this._li,n,1)}},bp.prototype.isDone=function(){return!1},bp.prototype.getInteriorIntersections=function(){return this._interiorIntersections},bp.prototype.interfaces_=function(){return[tp]},bp.prototype.getClass=function(){return bp};function Ep(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new Lu,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()}Ep.prototype.checkCorrectness=function(t){var e=dh.getNodedSubstrings(t),r=new fp(e);try{r.checkValid()}catch(t){if(!(t instanceof uu))throw t;t.printStackTrace()}},Ep.prototype.getNodedSubstrings=function(){return dh.getNodedSubstrings(this._nodedSegStrings)},Ep.prototype.snapRound=function(t,e){var r=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(r),this.computeVertexSnaps(t)},Ep.prototype.findInteriorIntersections=function(t,e){var r=new bp(e);return this._noder.setSegmentIntersector(r),this._noder.computeNodes(t),r.getInteriorIntersections()},Ep.prototype.computeVertexSnaps=function(){if(Zs(arguments[0],Xu))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.computeVertexSnaps(e)}else if(arguments[0]instanceof dh)for(var r=arguments[0],n=r.getCoordinates(),i=0;i<n.length;i++){var o=new mp(n[i],this._scaleFactor,this._li);this._pointSnapper.snap(o,r,i)&&r.addIntersection(n[i],i)}},Ep.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new Eh,this._pointSnapper=new vp(this._noder.getIndex()),this.snapRound(t,this._li)},Ep.prototype.computeIntersectionSnaps=function(t){for(var e=t.iterator();e.hasNext();){var r=e.next(),n=new mp(r,this._scaleFactor,this._li);this._pointSnapper.snap(n)}},Ep.prototype.interfaces_=function(){return[bh]},Ep.prototype.getClass=function(){return Ep};var Cp=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new wh,this._resultGeometry=null,this._saveException=null,1===arguments.length){var t=arguments[0];this._argGeom=t}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this._argGeom=e,this._bufParams=r}},Mp={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};Cp.prototype.bufferFixedPrecision=function(t){var e=new pp(new Ep(new Qc(1)),t.getScale()),r=new up(this._bufParams);r.setWorkingPrecisionModel(t),r.setNoder(e),this._resultGeometry=r.buffer(this._argGeom,this._distance)},Cp.prototype.bufferReducedPrecision=function(){var t=this;if(0===arguments.length){for(var e=Cp.MAX_PRECISION_DIGITS;0<=e;e--){try{t.bufferReducedPrecision(e)}catch(e){if(!(e instanceof _l))throw e;t._saveException=e}if(null!==t._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var r=arguments[0],n=Cp.precisionScaleFactor(this._argGeom,this._distance,r),i=new Qc(n);this.bufferFixedPrecision(i)}},Cp.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===Qc.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},Cp.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)},Cp.prototype.bufferOriginalPrecision=function(){try{var t=new up(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof Eu))throw t;this._saveException=t}},Cp.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry},Cp.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)},Cp.prototype.interfaces_=function(){return[]},Cp.prototype.getClass=function(){return Cp},Cp.bufferOp=function(){if(2===arguments.length){var t=arguments[1];return new Cp(arguments[0]).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof zu&&"number"==typeof arguments[1]){var e=arguments[1],r=arguments[2],n=new Cp(arguments[0]);return n.setQuadrantSegments(r),n.getResultGeometry(e)}if(arguments[2]instanceof wh&&arguments[0]instanceof zu&&"number"==typeof arguments[1]){var i=arguments[1];return new Cp(arguments[0],arguments[2]).getResultGeometry(i)}}else if(4===arguments.length){var o=arguments[1],a=arguments[2],s=arguments[3],u=new Cp(arguments[0]);return u.setQuadrantSegments(a),u.setEndCapStyle(s),u.getResultGeometry(o)}},Cp.precisionScaleFactor=function(t,e,r){var n=t.getEnvelopeInternal(),i=Ks.max(Math.abs(n.getMaxX()),Math.abs(n.getMaxY()),Math.abs(n.getMinX()),Math.abs(n.getMinY()))+2*(0<e?e:0),o=r-Math.trunc(Math.log(i)/Math.log(10)+1);return Math.pow(10,o)},Mp.CAP_ROUND.get=function(){return wh.CAP_ROUND},Mp.CAP_BUTT.get=function(){return wh.CAP_FLAT},Mp.CAP_FLAT.get=function(){return wh.CAP_FLAT},Mp.CAP_SQUARE.get=function(){return wh.CAP_SQUARE},Mp.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(Cp,Mp);function Tp(){this._pt=[new qs,new qs],this._distance=Fs.NaN,this._isNull=!0}Tp.prototype.getCoordinates=function(){return this._pt},Tp.prototype.getCoordinate=function(t){return this._pt[t]},Tp.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var n=e.distance(r);n<this._distance&&this.initialize(e,r,n)}},Tp.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(n),this._distance=i,this._isNull=!1}},Tp.prototype.getDistance=function(){return this._distance},Tp.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var n=e.distance(r);n>this._distance&&this.initialize(e,r,n)}},Tp.prototype.interfaces_=function(){return[]},Tp.prototype.getClass=function(){return Tp};function Pp(){}Pp.prototype.interfaces_=function(){return[]},Pp.prototype.getClass=function(){return Pp},Pp.computeDistance=function(){if(arguments[2]instanceof Tp&&arguments[0]instanceof jc&&arguments[1]instanceof qs)for(var t=arguments[1],e=arguments[2],r=arguments[0].getCoordinates(),n=new mh,i=0;i<r.length-1;i++){n.setCoordinates(r[i],r[i+1]);var o=n.closestPoint(t);e.setMinimum(o,t)}else if(arguments[2]instanceof Tp&&arguments[0]instanceof Uc&&arguments[1]instanceof qs){var a=arguments[0],s=arguments[1],u=arguments[2];Pp.computeDistance(a.getExteriorRing(),s,u);for(var c=0;c<a.getNumInteriorRing();c++)Pp.computeDistance(a.getInteriorRingN(c),s,u)}else if(arguments[2]instanceof Tp&&arguments[0]instanceof zu&&arguments[1]instanceof qs){var l=arguments[0],h=arguments[1],p=arguments[2];if(l instanceof jc)Pp.computeDistance(l,h,p);else if(l instanceof Uc)Pp.computeDistance(l,h,p);else if(l instanceof Oc)for(var f=l,d=0;d<f.getNumGeometries();d++){var m=f.getGeometryN(d);Pp.computeDistance(m,h,p)}else p.setMinimum(l.getCoordinate(),h)}else if(arguments[2]instanceof Tp&&arguments[0]instanceof mh&&arguments[1]instanceof qs){var g=arguments[1],y=arguments[2],v=arguments[0].closestPoint(g);y.setMinimum(v,g)}};function Op(t){this._maxPtDist=new Tp,this._inputGeom=t||null}var Ap={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Op.prototype.computeMaxMidpointDistance=function(t){var e=new Lp(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},Op.prototype.computeMaxVertexDistance=function(t){var e=new Ip(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},Op.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()},Op.prototype.getDistancePoints=function(){return this._maxPtDist},Op.prototype.interfaces_=function(){return[]},Op.prototype.getClass=function(){return Op},Ap.MaxPointDistanceFilter.get=function(){return Ip},Ap.MaxMidpointDistanceFilter.get=function(){return Lp},Object.defineProperties(Op,Ap);var Ip=function(t){this._maxPtDist=new Tp,this._minPtDist=new Tp,this._geom=t||null};Ip.prototype.filter=function(t){this._minPtDist.initialize(),Pp.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Ip.prototype.getMaxPointDistance=function(){return this._maxPtDist},Ip.prototype.interfaces_=function(){return[Uu]},Ip.prototype.getClass=function(){return Ip};var Lp=function(t){this._maxPtDist=new Tp,this._minPtDist=new Tp,this._geom=t||null};Lp.prototype.filter=function(t,e){if(0===e)return null;var r=t.getCoordinate(e-1),n=t.getCoordinate(e),i=new qs((r.x+n.x)/2,(r.y+n.y)/2);this._minPtDist.initialize(),Pp.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Lp.prototype.isDone=function(){return!1},Lp.prototype.isGeometryChanged=function(){return!1},Lp.prototype.getMaxPointDistance=function(){return this._maxPtDist},Lp.prototype.interfaces_=function(){return[Pc]},Lp.prototype.getClass=function(){return Lp};function Rp(t){this._comps=t||null}Rp.prototype.filter=function(t){t instanceof Uc&&this._comps.add(t)},Rp.prototype.interfaces_=function(){return[Tc]},Rp.prototype.getClass=function(){return Rp},Rp.getPolygons=function(){if(1===arguments.length)return Rp.getPolygons(arguments[0],new nc);if(2===arguments.length){var t=arguments[0],e=arguments[1];return t instanceof Uc?e.add(t):t instanceof Oc&&t.apply(new Rp(e)),e}};function Np(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this._lines=t}else if(2===arguments.length){var e=arguments[0],r=arguments[1];this._lines=e,this._isForcedToLineString=r}}Np.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof Gc){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof jc&&this._lines.add(t)},Np.prototype.setForceToLineString=function(t){this._isForcedToLineString=t},Np.prototype.interfaces_=function(){return[ju]},Np.prototype.getClass=function(){return Np},Np.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(Np.getLines(t))}if(2===arguments.length){var e=arguments[0],r=arguments[1];return e.getFactory().buildGeometry(Np.getLines(e,r))}},Np.getLines=function(){if(1===arguments.length)return Np.getLines(arguments[0],!1);if(2===arguments.length){if(Zs(arguments[0],Xu)&&Zs(arguments[1],Xu)){for(var t=arguments[1],e=arguments[0].iterator();e.hasNext();){var r=e.next();Np.getLines(r,t)}return t}if(arguments[0]instanceof zu&&"boolean"==typeof arguments[1]){var n=arguments[0],i=arguments[1],o=new nc;return n.apply(new Np(o,i)),o}if(arguments[0]instanceof zu&&Zs(arguments[1],Xu)){var a=arguments[0],s=arguments[1];return a instanceof jc?s.add(a):a.apply(new Np(s)),s}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&Zs(arguments[0],Xu)&&Zs(arguments[1],Xu)){for(var u=arguments[1],c=arguments[2],l=arguments[0].iterator();l.hasNext();){var h=l.next();Np.getLines(h,u,c)}return u}if("boolean"==typeof arguments[2]&&arguments[0]instanceof zu&&Zs(arguments[1],Xu)){var p=arguments[1],f=arguments[2];return arguments[0].apply(new Np(p,f)),p}}};function kp(){if(this._boundaryRule=Vu.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new zs("Rule must be non-null");this._boundaryRule=t}}kp.prototype.locateInternal=function(){if(arguments[0]instanceof qs&&arguments[1]instanceof Uc){var t=arguments[0],e=arguments[1];if(e.isEmpty())return Xs.EXTERIOR;var r=e.getExteriorRing(),n=this.locateInPolygonRing(t,r);if(n===Xs.EXTERIOR)return Xs.EXTERIOR;if(n===Xs.BOUNDARY)return Xs.BOUNDARY;for(var i=0;i<e.getNumInteriorRing();i++){var o=e.getInteriorRingN(i),a=this.locateInPolygonRing(t,o);if(a===Xs.INTERIOR)return Xs.EXTERIOR;if(a===Xs.BOUNDARY)return Xs.BOUNDARY}return Xs.INTERIOR}if(arguments[0]instanceof qs&&arguments[1]instanceof jc){var s=arguments[0],u=arguments[1];if(!u.getEnvelopeInternal().intersects(s))return Xs.EXTERIOR;var c=u.getCoordinates();return u.isClosed()||!s.equals(c[0])&&!s.equals(c[c.length-1])?ku.isOnLine(s,c)?Xs.INTERIOR:Xs.EXTERIOR:Xs.BOUNDARY}if(arguments[0]instanceof qs&&arguments[1]instanceof Fc){var l=arguments[0];return arguments[1].getCoordinate().equals2D(l)?Xs.INTERIOR:Xs.EXTERIOR}},kp.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?ku.locatePointInRing(t,e.getCoordinates()):Xs.EXTERIOR},kp.prototype.intersects=function(t,e){return this.locate(t,e)!==Xs.EXTERIOR},kp.prototype.updateLocationInfo=function(t){t===Xs.INTERIOR&&(this._isIn=!0),t===Xs.BOUNDARY&&this._numBoundaries++},kp.prototype.computeLocation=function(t,e){if(e instanceof Fc&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof jc)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Uc)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Ac)for(var r=e,n=0;n<r.getNumGeometries();n++){var i=r.getGeometryN(n);this.updateLocationInfo(this.locateInternal(t,i))}else if(e instanceof qc)for(var o=e,a=0;a<o.getNumGeometries();a++){var s=o.getGeometryN(a);this.updateLocationInfo(this.locateInternal(t,s))}else if(e instanceof Oc)for(var u=new Gh(e);u.hasNext();){var c=u.next();c!==e&&this.computeLocation(t,c)}},kp.prototype.locate=function(t,e){return e.isEmpty()?Xs.EXTERIOR:e instanceof jc?this.locateInternal(t,e):e instanceof Uc?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?Xs.BOUNDARY:0<this._numBoundaries||this._isIn?Xs.INTERIOR:Xs.EXTERIOR)},kp.prototype.interfaces_=function(){return[]},kp.prototype.getClass=function(){return kp};function Dp(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)Dp.call(this,arguments[0],Dp.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var t=arguments[0],e=arguments[1],r=arguments[2];this._component=t,this._segIndex=e,this._pt=r}}var jp={INSIDE_AREA:{configurable:!0}};Dp.prototype.isInsideArea=function(){return this._segIndex===Dp.INSIDE_AREA},Dp.prototype.getCoordinate=function(){return this._pt},Dp.prototype.getGeometryComponent=function(){return this._component},Dp.prototype.getSegmentIndex=function(){return this._segIndex},Dp.prototype.interfaces_=function(){return[]},Dp.prototype.getClass=function(){return Dp},jp.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Dp,jp);function zp(t){this._pts=t||null}zp.prototype.filter=function(t){t instanceof Fc&&this._pts.add(t)},zp.prototype.interfaces_=function(){return[Tc]},zp.prototype.getClass=function(){return zp},zp.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof Fc?Jl.singletonList(t):zp.getPoints(t,new nc)}if(2===arguments.length){var e=arguments[0],r=arguments[1];return e instanceof Fc?r.add(e):e instanceof Oc&&e.apply(new zp(r)),r}};function Fp(){this._locations=null;var t=arguments[0];this._locations=t}Fp.prototype.filter=function(t){(t instanceof Fc||t instanceof jc||t instanceof Uc)&&this._locations.add(new Dp(t,0,t.getCoordinate()))},Fp.prototype.interfaces_=function(){return[Tc]},Fp.prototype.getClass=function(){return Fp},Fp.getLocations=function(t){var e=new nc;return t.apply(new Fp(e)),e};function Bp(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new kp,this._minDistanceLocation=null,this._minDistance=Fs.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=r,this._geom[1]=n,this._terminateDistance=i}}Bp.prototype.computeContainmentDistance=function(){if(0===arguments.length){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1],n=1-e,i=Rp.getPolygons(this._geom[e]);if(0<i.size()){var o=Fp.getLocations(this._geom[n]);if(this.computeContainmentDistance(o,i,r),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[n]=r[0],this._minDistanceLocation[e]=r[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&Zs(arguments[0],Ju)&&Zs(arguments[1],Ju)){for(var a=arguments[0],s=arguments[1],u=arguments[2],c=0;c<a.size();c++)for(var l=a.get(c),h=0;h<s.size();h++)if(this.computeContainmentDistance(l,s.get(h),u),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Dp&&arguments[1]instanceof Uc){var p=arguments[0],f=arguments[1],d=arguments[2],m=p.getCoordinate();if(Xs.EXTERIOR!==this._ptLocator.locate(m,f))return d[this._minDistance=0]=p,d[1]=new Dp(f,m),null}},Bp.prototype.computeMinDistanceLinesPoints=function(t,e,r){for(var n=0;n<t.size();n++)for(var i=t.get(n),o=0;o<e.size();o++){var a=e.get(o);if(this.computeMinDistance(i,a,r),this._minDistance<=this._terminateDistance)return null}},Bp.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=Np.getLines(this._geom[0]),r=Np.getLines(this._geom[1]),n=zp.getPoints(this._geom[0]),i=zp.getPoints(this._geom[1]);return this.computeMinDistanceLines(e,r,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(r,n,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(n,i,t),void this.updateMinDistance(t,!1))))},Bp.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Bp.prototype.updateMinDistance=function(t,e){if(null===t[0])return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])},Bp.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Bp.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof jc&&arguments[1]instanceof Fc){var t=arguments[0],e=arguments[1],r=arguments[2];if(t.getEnvelopeInternal().distance(e.getEnvelopeInternal())>this._minDistance)return null;for(var n=t.getCoordinates(),i=e.getCoordinate(),o=0;o<n.length-1;o++){var a=ku.distancePointLine(i,n[o],n[o+1]);if(a<this._minDistance){this._minDistance=a;var s=new mh(n[o],n[o+1]).closestPoint(i);r[0]=new Dp(t,o,s),r[1]=new Dp(e,0,i)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof jc&&arguments[1]instanceof jc){var u=arguments[0],c=arguments[1],l=arguments[2];if(u.getEnvelopeInternal().distance(c.getEnvelopeInternal())>this._minDistance)return null;for(var h=u.getCoordinates(),p=c.getCoordinates(),f=0;f<h.length-1;f++)for(var d=0;d<p.length-1;d++){var m=ku.distanceLineLine(h[f],h[f+1],p[d],p[d+1]);if(m<this._minDistance){this._minDistance=m;var g=new mh(h[f],h[f+1]),y=new mh(p[d],p[d+1]),v=g.closestPoints(y);l[0]=new Dp(u,f,v[0]),l[1]=new Dp(c,d,v[1])}if(this._minDistance<=this._terminateDistance)return null}}},Bp.prototype.computeMinDistancePoints=function(t,e,r){for(var n=0;n<t.size();n++)for(var i=t.get(n),o=0;o<e.size();o++){var a=e.get(o),s=i.getCoordinate().distance(a.getCoordinate());if(s<this._minDistance&&(this._minDistance=s,r[0]=new Dp(i,0,i.getCoordinate()),r[1]=new Dp(a,0,a.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},Bp.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new zs("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Bp.prototype.computeMinDistanceLines=function(t,e,r){for(var n=0;n<t.size();n++)for(var i=t.get(n),o=0;o<e.size();o++){var a=e.get(o);if(this.computeMinDistance(i,a,r),this._minDistance<=this._terminateDistance)return null}},Bp.prototype.interfaces_=function(){return[]},Bp.prototype.getClass=function(){return Bp},Bp.distance=function(t,e){return new Bp(t,e).distance()},Bp.isWithinDistance=function(t,e,r){return new Bp(t,e,r).distance()<=r},Bp.nearestPoints=function(t,e){return new Bp(t,e).nearestPoints()};function Up(){this._pt=[new qs,new qs],this._distance=Fs.NaN,this._isNull=!0}Up.prototype.getCoordinates=function(){return this._pt},Up.prototype.getCoordinate=function(t){return this._pt[t]},Up.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var n=e.distance(r);n<this._distance&&this.initialize(e,r,n)}},Up.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(n),this._distance=i,this._isNull=!1}},Up.prototype.toString=function(){return vu.toLineString(this._pt[0],this._pt[1])},Up.prototype.getDistance=function(){return this._distance},Up.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var n=e.distance(r);n>this._distance&&this.initialize(e,r,n)}},Up.prototype.interfaces_=function(){return[]},Up.prototype.getClass=function(){return Up};function Vp(){}Vp.prototype.interfaces_=function(){return[]},Vp.prototype.getClass=function(){return Vp},Vp.computeDistance=function(){if(arguments[2]instanceof Up&&arguments[0]instanceof jc&&arguments[1]instanceof qs)for(var t=arguments[0],e=arguments[1],r=arguments[2],n=new mh,i=t.getCoordinates(),o=0;o<i.length-1;o++){n.setCoordinates(i[o],i[o+1]);var a=n.closestPoint(e);r.setMinimum(a,e)}else if(arguments[2]instanceof Up&&arguments[0]instanceof Uc&&arguments[1]instanceof qs){var s=arguments[0],u=arguments[1],c=arguments[2];Vp.computeDistance(s.getExteriorRing(),u,c);for(var l=0;l<s.getNumInteriorRing();l++)Vp.computeDistance(s.getInteriorRingN(l),u,c)}else if(arguments[2]instanceof Up&&arguments[0]instanceof zu&&arguments[1]instanceof qs){var h=arguments[0],p=arguments[1],f=arguments[2];if(h instanceof jc)Vp.computeDistance(h,p,f);else if(h instanceof Uc)Vp.computeDistance(h,p,f);else if(h instanceof Oc)for(var d=h,m=0;m<d.getNumGeometries();m++){var g=d.getGeometryN(m);Vp.computeDistance(g,p,f)}else f.setMinimum(h.getCoordinate(),p)}else if(arguments[2]instanceof Up&&arguments[0]instanceof mh&&arguments[1]instanceof qs){var y=arguments[1],v=arguments[2],_=arguments[0].closestPoint(y);v.setMinimum(_,y)}};function Gp(){this._g0=null,this._g1=null,this._ptDist=new Up;var t=arguments[this._densifyFrac=0],e=arguments[1];this._g0=t,this._g1=e}var qp={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Gp.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},Gp.prototype.setDensifyFraction=function(t){if(1<t||t<=0)throw new zs("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t},Gp.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)},Gp.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},Gp.prototype.computeOrientedDistance=function(t,e,r){var n=new Hp(e);if(t.apply(n),r.setMaximum(n.getMaxPointDistance()),0<this._densifyFrac){var i=new $p(e,this._densifyFrac);t.apply(i),r.setMaximum(i.getMaxPointDistance())}},Gp.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},Gp.prototype.interfaces_=function(){return[]},Gp.prototype.getClass=function(){return Gp},Gp.distance=function(){if(2===arguments.length)return new Gp(arguments[0],arguments[1]).distance();if(3===arguments.length){var t=arguments[2],e=new Gp(arguments[0],arguments[1]);return e.setDensifyFraction(t),e.distance()}},qp.MaxPointDistanceFilter.get=function(){return Hp},qp.MaxDensifiedByFractionDistanceFilter.get=function(){return $p},Object.defineProperties(Gp,qp);var Hp=function(){this._maxPtDist=new Up,this._minPtDist=new Up,this._euclideanDist=new Vp,this._geom=null;var t=arguments[0];this._geom=t};Hp.prototype.filter=function(t){this._minPtDist.initialize(),Vp.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Hp.prototype.getMaxPointDistance=function(){return this._maxPtDist},Hp.prototype.interfaces_=function(){return[Uu]},Hp.prototype.getClass=function(){return Hp};var $p=function(){this._maxPtDist=new Up,this._minPtDist=new Up,this._geom=null;var t=arguments[this._numSubSegs=0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};$p.prototype.filter=function(t,e){if(0===e)return null;for(var r=t.getCoordinate(e-1),n=t.getCoordinate(e),i=(n.x-r.x)/this._numSubSegs,o=(n.y-r.y)/this._numSubSegs,a=0;a<this._numSubSegs;a++){var s=r.x+a*i,u=r.y+a*o,c=new qs(s,u);this._minPtDist.initialize(),Vp.computeDistance(this._geom,c,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},$p.prototype.isDone=function(){return!1},$p.prototype.isGeometryChanged=function(){return!1},$p.prototype.getMaxPointDistance=function(){return this._maxPtDist},$p.prototype.interfaces_=function(){return[Pc]},$p.prototype.getClass=function(){return $p};function Wp(t,e,r){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=r||null}var Xp={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Wp.prototype.checkMaximumDistance=function(t,e,r){var n=new Gp(e,t);if(n.setDensifyFraction(.25),this._maxDistanceFound=n.orientedDistance(),this._maxDistanceFound>r){this._isValid=!1;var i=n.getCoordinates();this._errorLocation=i[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+vu.toLineString(i[0],i[1])+")"}},Wp.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=Wp.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,!(!this._input.isEmpty()&&!this._result.isEmpty())||(0<this._bufDistance?this.checkPositiveValid():this.checkNegativeValid(),Wp.VERBOSE&&cu.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Wp.prototype.checkNegativeValid=function(){if(!(this._input instanceof Uc||this._input instanceof qc||this._input instanceof Oc))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)},Wp.prototype.getErrorIndicator=function(){return this._errorIndicator},Wp.prototype.checkMinimumDistance=function(t,e,r){var n=new Bp(t,e,r);if(this._minDistanceFound=n.distance(),this._minDistanceFound<r){this._isValid=!1;var i=n.nearestPoints();this._errorLocation=n.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+vu.toLineString(i[0],i[1])+" )"}},Wp.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)},Wp.prototype.getErrorLocation=function(){return this._errorLocation},Wp.prototype.getPolygonLines=function(t){for(var e=new nc,r=new Np(e),n=Rp.getPolygons(t).iterator();n.hasNext();)n.next().apply(r);return t.getFactory().buildGeometry(e)},Wp.prototype.getErrorMessage=function(){return this._errMsg},Wp.prototype.interfaces_=function(){return[]},Wp.prototype.getClass=function(){return Wp},Xp.VERBOSE.get=function(){return!1},Xp.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Wp,Xp);function Yp(t,e,r){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=r||null}var Zp={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Yp.prototype.isValid=function(){return this.checkPolygonal(),this._isValid&&(this.checkExpectedEmpty(),this._isValid&&(this.checkEnvelope(),this._isValid&&(this.checkArea(),this._isValid&&this.checkDistance()))),this._isValid},Yp.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*Yp.MAX_ENV_DIFF_FRAC;0===t&&(t=.001);var e=new du(this._input.getEnvelopeInternal());e.expandBy(this._distance);var r=new du(this._result.getEnvelopeInternal());r.expandBy(t),r.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(r)),this.report("Envelope")},Yp.prototype.checkDistance=function(){var t=new Wp(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")},Yp.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();0<this._distance&&e<t&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},Yp.prototype.checkPolygonal=function(){this._result instanceof Uc||this._result instanceof qc||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},Yp.prototype.getErrorIndicator=function(){return this._errorIndicator},Yp.prototype.getErrorLocation=function(){return this._errorLocation},Yp.prototype.checkExpectedEmpty=function(){return 2<=this._input.getDimension()?null:0<this._distance?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},Yp.prototype.report=function(t){if(!Yp.VERBOSE)return null;cu.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))},Yp.prototype.getErrorMessage=function(){return this._errorMsg},Yp.prototype.interfaces_=function(){return[]},Yp.prototype.getClass=function(){return Yp},Yp.isValidMsg=function(t,e,r){var n=new Yp(t,e,r);return n.isValid()?null:n.getErrorMessage()},Yp.isValid=function(t,e,r){return!!new Yp(t,e,r).isValid()},Zp.VERBOSE.get=function(){return!1},Zp.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Yp,Zp);function Kp(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e}Kp.prototype.getCoordinates=function(){return this._pts},Kp.prototype.size=function(){return this._pts.length},Kp.prototype.getCoordinate=function(t){return this._pts[t]},Kp.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},Kp.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:hh.octant(this.getCoordinate(t),this.getCoordinate(t+1))},Kp.prototype.setData=function(t){this._data=t},Kp.prototype.getData=function(){return this._data},Kp.prototype.toString=function(){return vu.toLineString(new Yc(this._pts))},Kp.prototype.interfaces_=function(){return[ph]},Kp.prototype.getClass=function(){return Kp};function Jp(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new nc,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null}Jp.prototype.getInteriorIntersection=function(){return this._interiorIntersection},Jp.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t},Jp.prototype.getIntersectionSegments=function(){return this._intSegments},Jp.prototype.count=function(){return this._intersectionCount},Jp.prototype.getIntersections=function(){return this._intersections},Jp.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},Jp.prototype.setKeepIntersections=function(t){this._keepIntersections=t},Jp.prototype.processIntersections=function(t,e,r,n){if(!this._findAllIntersections&&this.hasIntersection())return null;if(t===r&&e===n)return null;if(this._isCheckEndSegmentsOnly&&!this.isEndSegment(t,e)&&!this.isEndSegment(r,n))return null;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=r.getCoordinates()[n],s=r.getCoordinates()[n+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=i,this._intSegments[1]=o,this._intSegments[2]=a,this._intSegments[3]=s,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},Jp.prototype.isEndSegment=function(t,e){return 0===e||e>=t.size()-2},Jp.prototype.hasIntersection=function(){return null!==this._interiorIntersection},Jp.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},Jp.prototype.interfaces_=function(){return[tp]},Jp.prototype.getClass=function(){return Jp},Jp.createAllIntersectionsFinder=function(t){var e=new Jp(t);return e.setFindAllIntersections(!0),e},Jp.createAnyIntersectionFinder=function(t){return new Jp(t)},Jp.createIntersectionCounter=function(t){var e=new Jp(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};function Qp(){this._li=new Lu,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t}Qp.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},Qp.prototype.getIntersections=function(){return this._segInt.getIntersections()},Qp.prototype.isValid=function(){return this.execute(),this._isValid},Qp.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},Qp.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Jp(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new Eh;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},Qp.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new _l(this.getErrorMessage(),this._segInt.getInteriorIntersection())},Qp.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+vu.toLineString(t[0],t[1])+" and "+vu.toLineString(t[2],t[3])},Qp.prototype.interfaces_=function(){return[]},Qp.prototype.getClass=function(){return Qp},Qp.computeIntersections=function(t){var e=new Qp(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};function tf(){this._nv=null;var t=arguments[0];this._nv=new Qp(tf.toSegmentStrings(t))}tf.prototype.checkValid=function(){this._nv.checkValid()},tf.prototype.interfaces_=function(){return[]},tf.prototype.getClass=function(){return tf},tf.toSegmentStrings=function(t){for(var e=new nc,r=t.iterator();r.hasNext();){var n=r.next();e.add(new Kp(n.getCoordinates(),n))}return e},tf.checkValid=function(t){new tf(t).checkValid()};function ef(t){this._mapOp=t}ef.prototype.map=function(t){for(var e=new nc,r=0;r<t.getNumGeometries();r++){var n=this._mapOp.map(t.getGeometryN(r));n.isEmpty()||e.add(n)}return t.getFactory().createGeometryCollection(al.toGeometryArray(e))},ef.prototype.interfaces_=function(){return[]},ef.prototype.getClass=function(){return ef},ef.map=function(t,e){return new ef(e).map(t)};function rf(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new nc,this._resultLineList=new nc;var t=arguments[0],e=arguments[1],r=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=r}rf.prototype.collectLines=function(t){for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var r=e.next();this.collectLineEdge(r,t,this._lineEdgesList),this.collectBoundaryTouchEdge(r,t,this._lineEdgesList)}},rf.prototype.labelIsolatedLine=function(t,e){var r=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,r)},rf.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList},rf.prototype.collectLineEdge=function(t,e,r){var n=t.getLabel(),i=t.getEdge();t.isLineEdge()&&(t.isVisited()||!Xf.isResultOfOp(n,e)||i.isCovered()||(r.add(i),t.setVisitedEdge(!0)))},rf.prototype.findCoveredLineEdges=function(){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();)t.next().getEdges().findCoveredLineEdges();for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var r=e.next(),n=r.getEdge();if(r.isLineEdge()&&!n.isCoveredSet()){var i=this._op.isCoveredByA(r.getCoordinate());n.setCovered(i)}}},rf.prototype.labelIsolatedLines=function(t){for(var e=t.iterator();e.hasNext();){var r=e.next(),n=r.getLabel();r.isIsolated()&&(n.isNull(0)?this.labelIsolatedLine(r,0):this.labelIsolatedLine(r,1))}},rf.prototype.buildLines=function(t){for(var e=this._lineEdgesList.iterator();e.hasNext();){var r=e.next(),n=this._geometryFactory.createLineString(r.getCoordinates());this._resultLineList.add(n),r.setInResult(!0)}},rf.prototype.collectBoundaryTouchEdge=function(t,e,r){var n=t.getLabel();return t.isLineEdge()?null:t.isVisited()?null:t.isInteriorAreaEdge()?null:t.getEdge().isInResult()?null:(xu.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(Xf.isResultOfOp(n,e)&&e===Xf.INTERSECTION&&(r.add(t.getEdge()),t.setVisitedEdge(!0))))},rf.prototype.interfaces_=function(){return[]},rf.prototype.getClass=function(){return rf};function nf(){this._op=null,this._geometryFactory=null,this._resultPointList=new nc;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e}nf.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var r=this._geometryFactory.createPoint(e);this._resultPointList.add(r)}},nf.prototype.extractNonCoveredResultNodes=function(t){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();){var r=e.next();if(!(r.isInResult()||r.isIncidentEdgeInResult()||0!==r.getEdges().getDegree()&&t!==Xf.INTERSECTION)){var n=r.getLabel();Xf.isResultOfOp(n,t)&&this.filterCoveredNodeToPoint(r)}}},nf.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList},nf.prototype.interfaces_=function(){return[]},nf.prototype.getClass=function(){return nf};function of(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1}of.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},of.prototype.transformPolygon=function(t,e){var r=!0,n=this.transformLinearRing(t.getExteriorRing(),t);null!==n&&n instanceof Gc&&!n.isEmpty()||(r=!1);for(var i=new nc,o=0;o<t.getNumInteriorRing();o++){var a=this.transformLinearRing(t.getInteriorRingN(o),t);null===a||a.isEmpty()||(a instanceof Gc||(r=!1),i.add(a))}if(r)return this._factory.createPolygon(n,i.toArray([]));var s=new nc;return null!==n&&s.add(n),s.addAll(i),this._factory.buildGeometry(s)},of.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)},of.prototype.getInputGeometry=function(){return this._inputGeom},of.prototype.transformMultiLineString=function(t,e){for(var r=new nc,n=0;n<t.getNumGeometries();n++){var i=this.transformLineString(t.getGeometryN(n),t);null!==i&&(i.isEmpty()||r.add(i))}return this._factory.buildGeometry(r)},of.prototype.transformCoordinates=function(t,e){return this.copy(t)},of.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},of.prototype.transformMultiPoint=function(t,e){for(var r=new nc,n=0;n<t.getNumGeometries();n++){var i=this.transformPoint(t.getGeometryN(n),t);null!==i&&(i.isEmpty()||r.add(i))}return this._factory.buildGeometry(r)},of.prototype.transformMultiPolygon=function(t,e){for(var r=new nc,n=0;n<t.getNumGeometries();n++){var i=this.transformPolygon(t.getGeometryN(n),t);null!==i&&(i.isEmpty()||r.add(i))}return this._factory.buildGeometry(r)},of.prototype.copy=function(t){return t.copy()},of.prototype.transformGeometryCollection=function(t,e){for(var r=new nc,n=0;n<t.getNumGeometries();n++){var i=this.transform(t.getGeometryN(n));null!==i&&(this._pruneEmptyGeometry&&i.isEmpty()||r.add(i))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(al.toGeometryArray(r)):this._factory.buildGeometry(r)},of.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof Fc)return this.transformPoint(t,null);if(t instanceof Vc)return this.transformMultiPoint(t,null);if(t instanceof Gc)return this.transformLinearRing(t,null);if(t instanceof jc)return this.transformLineString(t,null);if(t instanceof Ac)return this.transformMultiLineString(t,null);if(t instanceof Uc)return this.transformPolygon(t,null);if(t instanceof qc)return this.transformMultiPolygon(t,null);if(t instanceof Oc)return this.transformGeometryCollection(t,null);throw new zs("Unknown Geometry subtype: "+t.getClass().getName())},of.prototype.transformLinearRing=function(t,e){var r=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===r)return this._factory.createLinearRing(null);var n=r.size();return 0<n&&n<4&&!this._preserveType?this._factory.createLineString(r):this._factory.createLinearRing(r)},of.prototype.interfaces_=function(){return[]},of.prototype.getClass=function(){return of};function af(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new mh,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof jc&&"number"==typeof arguments[1]){var t=arguments[1];af.call(this,arguments[0].getCoordinates(),t)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var e=arguments[0],r=arguments[1];this._srcPts=e,this._isClosed=af.isClosed(e),this._snapTolerance=r}}af.prototype.snapVertices=function(t,e){for(var r=this._isClosed?t.size()-1:t.size(),n=0;n<r;n++){var i=t.get(n),o=this.findSnapForVertex(i,e);null!==o&&(t.set(n,new qs(o)),0===n&&this._isClosed&&t.set(t.size()-1,new qs(o)))}},af.prototype.findSnapForVertex=function(t,e){for(var r=0;r<e.length;r++){if(t.equals2D(e[r]))return null;if(t.distance(e[r])<this._snapTolerance)return e[r]}return null},af.prototype.snapTo=function(t){var e=new oc(this._srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},af.prototype.snapSegments=function(t,e){if(0===e.length)return null;var r=e.length;e[0].equals2D(e[e.length-1])&&(r=e.length-1);for(var n=0;n<r;n++){var i=e[n],o=this.findSegmentIndexToSnap(i,t);0<=o&&t.add(o+1,new qs(i),!1)}},af.prototype.findSegmentIndexToSnap=function(t,e){for(var r=Fs.MAX_VALUE,n=-1,i=0;i<e.size()-1;i++){if(this._seg.p0=e.get(i),this._seg.p1=e.get(i+1),this._seg.p0.equals2D(t)||this._seg.p1.equals2D(t)){if(this._allowSnappingToSourceVertices)continue;return-1}var o=this._seg.distance(t);o<this._snapTolerance&&o<r&&(r=o,n=i)}return n},af.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t},af.prototype.interfaces_=function(){return[]},af.prototype.getClass=function(){return af},af.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])};function sf(t){this._srcGeom=t||null}var uf={SNAP_PRECISION_FACTOR:{configurable:!0}};sf.prototype.snapTo=function(t,e){var r=this.extractTargetCoordinates(t);return new hf(e,r).transform(this._srcGeom)},sf.prototype.snapToSelf=function(t,e){var r=this.extractTargetCoordinates(this._srcGeom),n=new hf(t,r,!0).transform(this._srcGeom),i=n;return e&&Zs(i,zc)&&(i=n.buffer(0)),i},sf.prototype.computeSnapTolerance=function(t){return this.computeMinimumSegmentLength(t)/10},sf.prototype.extractTargetCoordinates=function(t){for(var e=new Si,r=t.getCoordinates(),n=0;n<r.length;n++)e.add(r[n]);return e.toArray(new Array(0).fill(null))},sf.prototype.computeMinimumSegmentLength=function(t){for(var e=Fs.MAX_VALUE,r=0;r<t.length-1;r++){var n=t[r].distance(t[r+1]);n<e&&(e=n)}return e},sf.prototype.interfaces_=function(){return[]},sf.prototype.getClass=function(){return sf},sf.snap=function(t,e,r){var n=new Array(2).fill(null),i=new sf(t);n[0]=i.snapTo(e,r);var o=new sf(e);return n[1]=o.snapTo(n[0],r),n},sf.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=sf.computeSizeBasedSnapTolerance(t),r=t.getPrecisionModel();if(r.getType()===Qc.FIXED){var n=1/r.getScale()*2/1.415;e<n&&(e=n)}return e}if(2===arguments.length){var i=arguments[0],o=arguments[1];return Math.min(sf.computeOverlaySnapTolerance(i),sf.computeOverlaySnapTolerance(o))}},sf.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*sf.SNAP_PRECISION_FACTOR},sf.snapToSelf=function(t,e,r){return new sf(t).snapToSelf(e,r)},uf.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(sf,uf);function cf(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null}var lf,hf=((lf=of)&&(pf.__proto__=lf),((pf.prototype=Object.create(lf&&lf.prototype)).constructor=pf).prototype.snapLine=function(t,e){var r=new af(t,this._snapTolerance);return r.setAllowSnappingToSourceVertices(this._isSelfSnap),r.snapTo(e)},pf.prototype.transformCoordinates=function(t,e){var r=t.toCoordinateArray(),n=this.snapLine(r,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(n)},pf.prototype.interfaces_=function(){return[]},pf.prototype.getClass=function(){return pf},pf);function pf(t,e,r){lf.call(this),this._snapTolerance=t||null,this._snapPts=e||null,this._isSelfSnap=void 0!==r&&r}cf.prototype.getCommon=function(){return Fs.longBitsToDouble(this._commonBits)},cf.prototype.add=function(t){var e=Fs.doubleToLongBits(t);return this._isFirst?(this._commonBits=e,this._commonSignExp=cf.signExpBits(this._commonBits),this._isFirst=!1,null):cf.signExpBits(e)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=cf.numCommonMostSigMantissaBits(this._commonBits,e),void(this._commonBits=cf.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},cf.prototype.toString=function(){if(1===arguments.length){var t=arguments[0],e=Fs.longBitsToDouble(t),r="0000000000000000000000000000000000000000000000000000000000000000"+Fs.toBinaryString(t),n=r.substring(r.length-64);return n.substring(0,1)+"  "+n.substring(1,12)+"(exp) "+n.substring(12)+" [ "+e+" ]"}},cf.prototype.interfaces_=function(){return[]},cf.prototype.getClass=function(){return cf},cf.getBit=function(t,e){return 0!=(t&1<<e)?1:0},cf.signExpBits=function(t){return t>>52},cf.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},cf.numCommonMostSigMantissaBits=function(t,e){for(var r=0,n=52;0<=n;n--){if(cf.getBit(t,n)!==cf.getBit(e,n))return r;r++}return 52};function ff(){this._commonCoord=null,this._ccFilter=new mf}var df={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};ff.prototype.addCommonBits=function(t){var e=new gf(this._commonCoord);t.apply(e),t.geometryChanged()},ff.prototype.removeCommonBits=function(t){if(0===this._commonCoord.x&&0===this._commonCoord.y)return t;var e=new qs(this._commonCoord);e.x=-e.x,e.y=-e.y;var r=new gf(e);return t.apply(r),t.geometryChanged(),t},ff.prototype.getCommonCoordinate=function(){return this._commonCoord},ff.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},ff.prototype.interfaces_=function(){return[]},ff.prototype.getClass=function(){return ff},df.CommonCoordinateFilter.get=function(){return mf},df.Translater.get=function(){return gf},Object.defineProperties(ff,df);var mf=function(){this._commonBitsX=new cf,this._commonBitsY=new cf};mf.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)},mf.prototype.getCommonCoordinate=function(){return new qs(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},mf.prototype.interfaces_=function(){return[Uu]},mf.prototype.getClass=function(){return mf};var gf=function(){this.trans=null;var t=arguments[0];this.trans=t};gf.prototype.filter=function(t,e){var r=t.getOrdinate(e,0)+this.trans.x,n=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,r),t.setOrdinate(e,1,n)},gf.prototype.isDone=function(){return!1},gf.prototype.isGeometryChanged=function(){return!0},gf.prototype.interfaces_=function(){return[Pc]},gf.prototype.getClass=function(){return gf};function yf(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()}yf.prototype.selfSnap=function(t){return new sf(t).snapTo(t,this._snapTolerance)},yf.prototype.removeCommonBits=function(t){this._cbr=new ff,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e},yf.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t},yf.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),r=Xf.overlayOp(e[0],e[1],t);return this.prepareResult(r)},yf.prototype.checkValid=function(t){t.isValid()||cu.out.println("Snapped geometry is invalid")},yf.prototype.computeSnapTolerance=function(){this._snapTolerance=sf.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},yf.prototype.snap=function(t){var e=this.removeCommonBits(t);return sf.snap(e[0],e[1],this._snapTolerance)},yf.prototype.interfaces_=function(){return[]},yf.prototype.getClass=function(){return yf},yf.overlayOp=function(t,e,r){return new yf(t,e).getResultGeometry(r)},yf.union=function(t,e){return yf.overlayOp(t,e,Xf.UNION)},yf.intersection=function(t,e){return yf.overlayOp(t,e,Xf.INTERSECTION)},yf.symDifference=function(t,e){return yf.overlayOp(t,e,Xf.SYMDIFFERENCE)},yf.difference=function(t,e){return yf.overlayOp(t,e,Xf.DIFFERENCE)};function vf(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e}vf.prototype.getResultGeometry=function(t){var e=null,r=!1,n=null;try{e=Xf.overlayOp(this._geom[0],this._geom[1],t),r=!0}catch(t){if(!(t instanceof Eu))throw t;n=t}if(!r)try{e=yf.overlayOp(this._geom[0],this._geom[1],t)}catch(t){throw t instanceof Eu?n:t}return e},vf.prototype.interfaces_=function(){return[]},vf.prototype.getClass=function(){return vf},vf.overlayOp=function(t,e,r){return new vf(t,e).getResultGeometry(r)},vf.union=function(t,e){return vf.overlayOp(t,e,Xf.UNION)},vf.intersection=function(t,e){return vf.overlayOp(t,e,Xf.INTERSECTION)},vf.symDifference=function(t,e){return vf.overlayOp(t,e,Xf.SYMDIFFERENCE)},vf.difference=function(t,e){return vf.overlayOp(t,e,Xf.DIFFERENCE)};function _f(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e}_f.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},_f.prototype.interfaces_=function(){return[]},_f.prototype.getClass=function(){return _f};function bf(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var t=arguments[0],e=arguments[1];this._eventType=bf.DELETE,this._xValue=t,this._insertEvent=e}else if(3===arguments.length){var r=arguments[0],n=arguments[1],i=arguments[2];this._eventType=bf.INSERT,this._label=r,this._xValue=n,this._obj=i}}var xf={INSERT:{configurable:!0},DELETE:{configurable:!0}};bf.prototype.isDelete=function(){return this._eventType===bf.DELETE},bf.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t},bf.prototype.getObject=function(){return this._obj},bf.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0},bf.prototype.getInsertEvent=function(){return this._insertEvent},bf.prototype.isInsert=function(){return this._eventType===bf.INSERT},bf.prototype.isSameLabel=function(t){return null!==this._label&&this._label===t._label},bf.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},bf.prototype.interfaces_=function(){return[Us]},bf.prototype.getClass=function(){return bf},xf.INSERT.get=function(){return 1},xf.DELETE.get=function(){return 2},Object.defineProperties(bf,xf);function wf(){}wf.prototype.interfaces_=function(){return[]},wf.prototype.getClass=function(){return wf};function Sf(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],r=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=r}Sf.prototype.isTrivialIntersection=function(t,e,r,n){if(t===r&&1===this._li.getIntersectionNum()){if(Sf.isAdjacentSegments(e,n))return!0;if(t.isClosed()){var i=t.getNumPoints()-1;if(0===e&&n===i||0===n&&e===i)return!0}}return!1},Sf.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Sf.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t},Sf.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Sf.prototype.isBoundaryPointInternal=function(t,e){for(var r=e.iterator();r.hasNext();){var n=r.next().getCoordinate();if(t.isIntersection(n))return!0}return!1},Sf.prototype.hasProperIntersection=function(){return this._hasProper},Sf.prototype.hasIntersection=function(){return this._hasIntersection},Sf.prototype.isDone=function(){return this._isDone},Sf.prototype.isBoundaryPoint=function(t,e){return!(null===e||!this.isBoundaryPointInternal(t,e[0])&&!this.isBoundaryPointInternal(t,e[1]))},Sf.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e},Sf.prototype.addIntersections=function(t,e,r,n){if(t===r&&e===n)return null;this.numTests++;var i=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=r.getCoordinates()[n],s=r.getCoordinates()[n+1];this._li.computeIntersection(i,o,a,s),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),r.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,r,n)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(t.addIntersections(this._li,e,0),r.addIntersections(this._li,n,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},Sf.prototype.interfaces_=function(){return[]},Sf.prototype.getClass=function(){return Sf},Sf.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};function Ef(){this._min=Fs.POSITIVE_INFINITY,this._max=Fs.NEGATIVE_INFINITY}var Cf,Mf=((Cf=wf)&&(Pf.__proto__=Cf),((Pf.prototype=Object.create(Cf&&Cf.prototype)).constructor=Pf).prototype.prepareEvents=function(){Jl.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},Pf.prototype.computeIntersections=function(){if(1===arguments.length){var t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var e=0;e<this.events.size();e++){var r=this.events.get(e);if(r.isInsert()&&this.processOverlaps(e,r.getDeleteEventIndex(),r,t),t.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof Sf&&Zs(arguments[0],Ju)&&Zs(arguments[1],Ju)){var n=arguments[0],i=arguments[1],o=arguments[2];this.addEdges(n,n),this.addEdges(i,i),this.computeIntersections(o)}else if("boolean"==typeof arguments[2]&&Zs(arguments[0],Ju)&&arguments[1]instanceof Sf){var a=arguments[0],s=arguments[1];arguments[2]?this.addEdges(a,null):this.addEdges(a),this.computeIntersections(s)}},Pf.prototype.addEdge=function(t,e){for(var r=t.getMonotoneChainEdge(),n=r.getStartIndexes(),i=0;i<n.length-1;i++){var o=new _f(r,i),a=new bf(e,r.getMinX(i),o);this.events.add(a),this.events.add(new bf(r.getMaxX(i),a))}},Pf.prototype.processOverlaps=function(t,e,r,n){for(var i=r.getObject(),o=t;o<e;o++){var a=this.events.get(o);if(a.isInsert()){var s=a.getObject();r.isSameLabel(a)||(i.computeIntersections(s,n),this.nOverlaps++)}}},Pf.prototype.addEdges=function(){if(1===arguments.length)for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.addEdge(e,e)}else if(2===arguments.length)for(var r=arguments[1],n=arguments[0].iterator();n.hasNext();){var i=n.next();this.addEdge(i,r)}},Pf.prototype.interfaces_=function(){return[]},Pf.prototype.getClass=function(){return Pf},Pf),Tf={NodeComparator:{configurable:!0}};function Pf(){Cf.call(this),this.events=new nc,this.nOverlaps=null}Ef.prototype.getMin=function(){return this._min},Ef.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)},Ef.prototype.getMax=function(){return this._max},Ef.prototype.toString=function(){return vu.toLineString(new qs(this._min,0),new qs(this._max,0))},Ef.prototype.interfaces_=function(){return[]},Ef.prototype.getClass=function(){return Ef},Tf.NodeComparator.get=function(){return Of},Object.defineProperties(Ef,Tf);var Of=function(){};Of.prototype.compare=function(t,e){var r=t,n=e,i=(r._min+r._max)/2,o=(n._min+n._max)/2;return i<o?-1:o<i?1:0},Of.prototype.interfaces_=function(){return[Gs]},Of.prototype.getClass=function(){return Of};function Af(){this._leaves=new nc,this._root=null,this._level=0}var If,Lf,Rf=((Lf=Ef)&&(Df.__proto__=Lf),((Df.prototype=Object.create(Lf&&Lf.prototype)).constructor=Df).prototype.query=function(t,e,r){if(!this.intersects(t,e))return null;r.visitItem(this._item)},Df.prototype.interfaces_=function(){return[]},Df.prototype.getClass=function(){return Df},Df),Nf=((If=Ef)&&(kf.__proto__=If),((kf.prototype=Object.create(If&&If.prototype)).constructor=kf).prototype.buildExtent=function(t,e){this._min=Math.min(t._min,e._min),this._max=Math.max(t._max,e._max)},kf.prototype.query=function(t,e,r){if(!this.intersects(t,e))return null;null!==this._node1&&this._node1.query(t,e,r),null!==this._node2&&this._node2.query(t,e,r)},kf.prototype.interfaces_=function(){return[]},kf.prototype.getClass=function(){return kf},kf);function kf(){If.call(this),this._node1=null,this._node2=null;var t=arguments[0],e=arguments[1];this._node1=t,this._node2=e,this.buildExtent(this._node1,this._node2)}function Df(){Lf.call(this),this._item=null;var t=arguments[0],e=arguments[1],r=arguments[2];this._min=t,this._max=e,this._item=r}Af.prototype.buildTree=function(){Jl.sort(this._leaves,new Ef.NodeComparator);for(var t=this._leaves,e=null,r=new nc;;){if(this.buildLevel(t,r),1===r.size())return r.get(0);e=t,t=r,r=e}},Af.prototype.insert=function(t,e,r){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new Rf(t,e,r))},Af.prototype.query=function(t,e,r){this.init(),this._root.query(t,e,r)},Af.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},Af.prototype.printNode=function(t){cu.out.println(vu.toLineString(new qs(t._min,this._level),new qs(t._max,this._level)))},Af.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},Af.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var r=0;r<t.size();r+=2){var n=t.get(r);if(null===(r+1<t.size()?t.get(r):null))e.add(n);else{var i=new Nf(t.get(r),t.get(r+1));e.add(i)}}},Af.prototype.interfaces_=function(){return[]},Af.prototype.getClass=function(){return Af};function jf(){this._items=new nc}jf.prototype.visitItem=function(t){this._items.add(t)},jf.prototype.getItems=function(){return this._items},jf.prototype.interfaces_=function(){return[Xl]},jf.prototype.getClass=function(){return jf};function zf(){this._index=null;var t=arguments[0];if(!Zs(t,zc))throw new zs("Argument must be Polygonal");this._index=new Uf(t)}var Ff={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};zf.prototype.locate=function(t){var e=new Nu(t),r=new Bf(e);return this._index.query(t.y,t.y,r),e.getLocation()},zf.prototype.interfaces_=function(){return[Vh]},zf.prototype.getClass=function(){return zf},Ff.SegmentVisitor.get=function(){return Bf},Ff.IntervalIndexedGeometry.get=function(){return Uf},Object.defineProperties(zf,Ff);var Bf=function(){this._counter=null;var t=arguments[0];this._counter=t};Bf.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},Bf.prototype.interfaces_=function(){return[Xl]},Bf.prototype.getClass=function(){return Bf};var Uf=function(){this._index=new Af;var t=arguments[0];this.init(t)};Uf.prototype.init=function(t){for(var e=Np.getLines(t).iterator();e.hasNext();){var r=e.next().getCoordinates();this.addLine(r)}},Uf.prototype.addLine=function(t){for(var e=1;e<t.length;e++){var r=new mh(t[e-1],t[e]),n=Math.min(r.p0.y,r.p1.y),i=Math.max(r.p0.y,r.p1.y);this._index.insert(n,i,r)}},Uf.prototype.query=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],r=new jf;return this._index.query(t,e,r),r.getItems()}if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2];this._index.query(n,i,o)}},Uf.prototype.interfaces_=function(){return[]},Uf.prototype.getClass=function(){return Uf};function Vf(){if(this._li=new Lu,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new qf(0,t)}else if(2===arguments.length){var e=arguments[0],r=arguments[1],n=Vu.OGC_SFS_BOUNDARY_RULE;0<=e.getPrecisionModel().compareTo(r.getPrecisionModel())?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(r.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new qf(0,e,n),this._arg[1]=new qf(1,r,n)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],a=arguments[2];0<=i.getPrecisionModel().compareTo(o.getPrecisionModel())?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new qf(0,i,a),this._arg[1]=new qf(1,o,a)}}var Gf,qf=((Gf=Gl)&&(Hf.__proto__=Gf),((Hf.prototype=Object.create(Gf&&Gf.prototype)).constructor=Hf).prototype.insertBoundaryPoint=function(t,e){var r=this._nodes.addNode(e).getLabel(),n=1;r.getLocation(t,dl.ON)===Xs.BOUNDARY&&n++;var i=Hf.determineBoundary(this._boundaryNodeRule,n);r.setLocation(t,i)},Hf.prototype.computeSelfNodes=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var r=arguments[1],n=arguments[2],i=new Sf(arguments[0],!0,!1);i.setIsDoneIfProperInt(n);var o=this.createEdgeSetIntersector(),a=this._parentGeom instanceof Gc||this._parentGeom instanceof Uc||this._parentGeom instanceof qc,s=r||!a;return o.computeIntersections(this._edges,i,s),this.addSelfIntersectionNodes(this._argIndex),i}},Hf.prototype.computeSplitEdges=function(t){for(var e=this._edges.iterator();e.hasNext();)e.next().eiList.addSplitEdges(t)},Hf.prototype.computeEdgeIntersections=function(t,e,r){var n=new Sf(e,r,!0);return n.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,t._edges,n),n},Hf.prototype.getGeometry=function(){return this._parentGeom},Hf.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},Hf.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},Hf.prototype.addPoint=function(){if(arguments[0]instanceof Fc){var t=arguments[0].getCoordinate();this.insertPoint(this._argIndex,t,Xs.INTERIOR)}else if(arguments[0]instanceof qs){var e=arguments[0];this.insertPoint(this._argIndex,e,Xs.INTERIOR)}},Hf.prototype.addPolygon=function(t){this.addPolygonRing(t.getExteriorRing(),Xs.EXTERIOR,Xs.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var r=t.getInteriorRingN(e);this.addPolygonRing(r,Xs.INTERIOR,Xs.EXTERIOR)}},Hf.prototype.addEdge=function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this._argIndex,e[0],Xs.BOUNDARY),this.insertPoint(this._argIndex,e[e.length-1],Xs.BOUNDARY)},Hf.prototype.addLineString=function(t){var e=tc.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=e[0],null;var r=new lp(e,new Sl(this._argIndex,Xs.INTERIOR));this._lineEdgeMap.put(t,r),this.insertEdge(r),xu.isTrue(2<=e.length,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,e[0]),this.insertBoundaryPoint(this._argIndex,e[e.length-1])},Hf.prototype.getInvalidPoint=function(){return this._invalidPoint},Hf.prototype.getBoundaryPoints=function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),r=0,n=t.iterator();n.hasNext();){var i=n.next();e[r++]=i.getCoordinate().copy()}return e},Hf.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},Hf.prototype.addSelfIntersectionNode=function(t,e,r){if(this.isBoundaryNode(t,e))return null;r===Xs.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,r)},Hf.prototype.addPolygonRing=function(t,e,r){if(t.isEmpty())return null;var n=tc.removeRepeatedPoints(t.getCoordinates());if(n.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=n[0],null;var i=e,o=r;ku.isCCW(n)&&(i=r,o=e);var a=new lp(n,new Sl(this._argIndex,Xs.BOUNDARY,i,o));this._lineEdgeMap.put(t,a),this.insertEdge(a),this.insertPoint(this._argIndex,n[0],Xs.BOUNDARY)},Hf.prototype.insertPoint=function(t,e,r){var n=this._nodes.addNode(e),i=n.getLabel();null===i?n._label=new Sl(t,r):i.setLocation(t,r)},Hf.prototype.createEdgeSetIntersector=function(){return new Mf},Hf.prototype.addSelfIntersectionNodes=function(t){for(var e=this._edges.iterator();e.hasNext();)for(var r=e.next(),n=r.getLabel().getLocation(t),i=r.eiList.iterator();i.hasNext();){var o=i.next();this.addSelfIntersectionNode(t,o.coord,n)}},Hf.prototype.add=function(){if(1!==arguments.length)return Gf.prototype.add.apply(this,arguments);var t=arguments[0];if(t.isEmpty())return null;if(t instanceof qc&&(this._useBoundaryDeterminationRule=!1),t instanceof Uc)this.addPolygon(t);else if(t instanceof jc)this.addLineString(t);else if(t instanceof Fc)this.addPoint(t);else if(t instanceof Vc)this.addCollection(t);else if(t instanceof Ac)this.addCollection(t);else if(t instanceof qc)this.addCollection(t);else{if(!(t instanceof Oc))throw new Error(t.getClass().getName());this.addCollection(t)}},Hf.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var r=t.getGeometryN(e);this.add(r)}},Hf.prototype.locate=function(t){return Zs(this._parentGeom,zc)&&50<this._parentGeom.getNumGeometries()?(null===this._areaPtLocator&&(this._areaPtLocator=new zf(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)},Hf.prototype.findEdge=function(){if(1!==arguments.length)return Gf.prototype.findEdge.apply(this,arguments);var t=arguments[0];return this._lineEdgeMap.get(t)},Hf.prototype.interfaces_=function(){return[]},Hf.prototype.getClass=function(){return Hf},Hf.determineBoundary=function(t,e){return t.isInBoundary(e)?Xs.BOUNDARY:Xs.INTERIOR},Hf);function Hf(){if(Gf.call(this),this._parentGeom=null,this._lineEdgeMap=new el,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new kp,2===arguments.length){var t=arguments[0],e=arguments[1],r=Vu.OGC_SFS_BOUNDARY_RULE;this._argIndex=t,this._parentGeom=e,this._boundaryNodeRule=r,null!==e&&this.add(e)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2];this._argIndex=n,this._parentGeom=i,this._boundaryNodeRule=o,null!==i&&this.add(i)}}Vf.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()},Vf.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)},Vf.prototype.interfaces_=function(){return[]},Vf.prototype.getClass=function(){return Vf};function $f(){}$f.prototype.interfaces_=function(){return[]},$f.prototype.getClass=function(){return $f},$f.map=function(){if(arguments[0]instanceof zu&&Zs(arguments[1],$f.MapOp)){for(var t=arguments[0],e=arguments[1],r=new nc,n=0;n<t.getNumGeometries();n++){var i=e.map(t.getGeometryN(n));null!==i&&r.add(i)}return t.getFactory().buildGeometry(r)}if(Zs(arguments[0],Xu)&&Zs(arguments[1],$f.MapOp)){for(var o=arguments[0],a=arguments[1],s=new nc,u=o.iterator();u.hasNext();){var c=u.next(),l=a.map(c);null!==l&&s.add(l)}return s}},$f.MapOp=function(){};var Wf,Xf=((Wf=Vf)&&(Yf.__proto__=Wf),((Yf.prototype=Object.create(Wf&&Wf.prototype)).constructor=Yf).prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var r=e.getLabel(),n=t.getLabel();e.isPointwiseEqual(t)||(n=new Sl(t.getLabel())).flip();var i=e.getDepth();i.isNull()&&i.add(r),i.add(n),r.merge(n)}else this._edgeList.add(t)},Yf.prototype.getGraph=function(){return this._graph},Yf.prototype.cancelDuplicateResultEdges=function(){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),r=e.getSym();e.isInResult()&&r.isInResult()&&(e.setInResult(!1),r.setInResult(!1))}},Yf.prototype.isCoveredByLA=function(t){return!!this.isCovered(t,this._resultLineList)||!!this.isCovered(t,this._resultPolyList)},Yf.prototype.computeGeometry=function(t,e,r,n){var i=new nc;return i.addAll(t),i.addAll(e),i.addAll(r),i.isEmpty()?Yf.createEmptyResult(n,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(i)},Yf.prototype.mergeSymLabels=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().mergeSymLabels()},Yf.prototype.isCovered=function(t,e){for(var r=e.iterator();r.hasNext();){var n=r.next();if(this._ptLocator.locate(t,n)!==Xs.EXTERIOR)return!0}return!1},Yf.prototype.replaceCollapsedEdges=function(){for(var t=new nc,e=this._edgeList.iterator();e.hasNext();){var r=e.next();r.isCollapsed()&&(e.remove(),t.add(r.getCollapsedEdge()))}this._edgeList.addAll(t)},Yf.prototype.updateNodeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),r=e.getEdges().getLabel();e.getLabel().merge(r)}},Yf.prototype.getResultGeometry=function(t){return this.computeOverlay(t),this._resultGeom},Yf.prototype.insertUniqueEdges=function(t){for(var e=t.iterator();e.hasNext();){var r=e.next();this.insertUniqueEdge(r)}},Yf.prototype.computeOverlay=function(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var e=new nc;this._arg[0].computeSplitEdges(e),this._arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),tf.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var r=new ql(this._geomFact);r.add(this._graph),this._resultPolyList=r.getPolygons();var n=new rf(this,this._geomFact,this._ptLocator);this._resultLineList=n.build(t);var i=new nf(this,this._geomFact,this._ptLocator);this._resultPointList=i.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)},Yf.prototype.labelIncompleteNode=function(t,e){var r=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setLocation(e,r)},Yf.prototype.copyPoints=function(t){for(var e=this._arg[t].getNodeIterator();e.hasNext();){var r=e.next();this._graph.addNode(r.getCoordinate()).setLabel(t,r.getLabel().getLocation(t))}},Yf.prototype.findResultAreaEdges=function(t){for(var e=this._graph.getEdgeEnds().iterator();e.hasNext();){var r=e.next(),n=r.getLabel();n.isArea()&&!r.isInteriorAreaEdge()&&Yf.isResultOfOp(n.getLocation(0,dl.RIGHT),n.getLocation(1,dl.RIGHT),t)&&r.setInResult(!0)}},Yf.prototype.computeLabelsFromDepths=function(){for(var t=this._edgeList.iterator();t.hasNext();){var e=t.next(),r=e.getLabel(),n=e.getDepth();if(!n.isNull()){n.normalize();for(var i=0;i<2;i++)r.isNull(i)||!r.isArea()||n.isNull(i)||(0===n.getDelta(i)?r.toLine(i):(xu.isTrue(!n.isNull(i,dl.LEFT),"depth of LEFT side has not been initialized"),r.setLocation(i,dl.LEFT,n.getLocation(i,dl.LEFT)),xu.isTrue(!n.isNull(i,dl.RIGHT),"depth of RIGHT side has not been initialized"),r.setLocation(i,dl.RIGHT,n.getLocation(i,dl.RIGHT))))}}},Yf.prototype.computeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},Yf.prototype.labelIncompleteNodes=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),r=e.getLabel();e.isIsolated()&&(r.isNull(0)?this.labelIncompleteNode(e,0):this.labelIncompleteNode(e,1)),e.getEdges().updateLabelling(r)}},Yf.prototype.isCoveredByA=function(t){return!!this.isCovered(t,this._resultPolyList)},Yf.prototype.interfaces_=function(){return[]},Yf.prototype.getClass=function(){return Yf},Yf);function Yf(){var t=arguments[0],e=arguments[1];Wf.call(this,t,e),this._ptLocator=new kp,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Qh,this._resultPolyList=new nc,this._resultLineList=new nc,this._resultPointList=new nc,this._graph=new Gl(new Zh),this._geomFact=t.getFactory()}Xf.overlayOp=function(t,e,r){return new Xf(t,e).getResultGeometry(r)},Xf.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return Xf.createEmptyResult(Xf.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var r=e;return ef.map(t,{interfaces_:function(){return[$f.MapOp]},map:function(t){return t.intersection(r)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),vf.overlayOp(t,e,Xf.INTERSECTION)},Xf.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Xf.createEmptyResult(Xf.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),vf.overlayOp(t,e,Xf.SYMDIFFERENCE)},Xf.resultDimension=function(t,e,r){var n=e.getDimension(),i=r.getDimension(),o=-1;switch(t){case Xf.INTERSECTION:o=Math.min(n,i);break;case Xf.UNION:o=Math.max(n,i);break;case Xf.DIFFERENCE:o=n;break;case Xf.SYMDIFFERENCE:o=Math.max(n,i)}return o},Xf.createEmptyResult=function(t,e,r,n){var i=null;switch(Xf.resultDimension(t,e,r)){case-1:i=n.createGeometryCollection(new Array(0).fill(null));break;case 0:i=n.createPoint();break;case 1:i=n.createLineString();break;case 2:i=n.createPolygon()}return i},Xf.difference=function(t,e){return t.isEmpty()?Xf.createEmptyResult(Xf.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),vf.overlayOp(t,e,Xf.DIFFERENCE))},Xf.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],r=t.getLocation(0),n=t.getLocation(1);return Xf.isResultOfOp(r,n,e)}if(3===arguments.length){var i=arguments[0],o=arguments[1];switch(i===Xs.BOUNDARY&&(i=Xs.INTERIOR),o===Xs.BOUNDARY&&(o=Xs.INTERIOR),arguments[2]){case Xf.INTERSECTION:return i===Xs.INTERIOR&&o===Xs.INTERIOR;case Xf.UNION:return i===Xs.INTERIOR||o===Xs.INTERIOR;case Xf.DIFFERENCE:return i===Xs.INTERIOR&&o!==Xs.INTERIOR;case Xf.SYMDIFFERENCE:return i===Xs.INTERIOR&&o!==Xs.INTERIOR||i!==Xs.INTERIOR&&o===Xs.INTERIOR}return!1}},Xf.INTERSECTION=1,Xf.UNION=2,Xf.DIFFERENCE=3,Xf.SYMDIFFERENCE=4;function Zf(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new kp,this._seg=new mh;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)}Zf.prototype.isWithinToleranceOfBoundary=function(t){for(var e=0;e<this._linework.getNumGeometries();e++)for(var r=this._linework.getGeometryN(e).getCoordinateSequence(),n=0;n<r.size()-1;n++)if(r.getCoordinate(n,this._seg.p0),r.getCoordinate(n+1,this._seg.p1),this._seg.distance(t)<=this._boundaryDistanceTolerance)return!0;return!1},Zf.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?Xs.BOUNDARY:this._ptLocator.locate(t,this._g)},Zf.prototype.extractLinework=function(t){var e=new Kf;t.apply(e);var r=e.getLinework(),n=al.toLineStringArray(r);return t.getFactory().createMultiLineString(n)},Zf.prototype.interfaces_=function(){return[]},Zf.prototype.getClass=function(){return Zf};var Kf=function(){this._linework=null,this._linework=new nc};Kf.prototype.getLinework=function(){return this._linework},Kf.prototype.filter=function(t){if(t instanceof Uc){var e=t;this._linework.add(e.getExteriorRing());for(var r=0;r<e.getNumInteriorRing();r++)this._linework.add(e.getInteriorRingN(r))}},Kf.prototype.interfaces_=function(){return[Tc]},Kf.prototype.getClass=function(){return Kf};function Jf(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t}Jf.prototype.extractPoints=function(t,e,r){for(var n=t.getCoordinates(),i=0;i<n.length-1;i++)this.computeOffsetPoints(n[i],n[i+1],e,r)},Jf.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e},Jf.prototype.getPoints=function(t){for(var e=new nc,r=Np.getLines(this._g).iterator();r.hasNext();){var n=r.next();this.extractPoints(n,t,e)}return e},Jf.prototype.computeOffsetPoints=function(t,e,r,n){var i=e.x-t.x,o=e.y-t.y,a=Math.sqrt(i*i+o*o),s=r*i/a,u=r*o/a,c=(e.x+t.x)/2,l=(e.y+t.y)/2;if(this._doLeft){var h=new qs(c-u,l+s);n.add(h)}if(this._doRight){var p=new qs(c+u,l-s);n.add(p)}},Jf.prototype.interfaces_=function(){return[]},Jf.prototype.getClass=function(){return Jf};function Qf(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=Qf.TOLERANCE,this._testCoords=new nc;var t=arguments[0],e=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=Qf.computeBoundaryDistanceTolerance(t,e),this._geom=[t,e,r],this._locFinder=[new Zf(this._geom[0],this._boundaryDistanceTolerance),new Zf(this._geom[1],this._boundaryDistanceTolerance),new Zf(this._geom[2],this._boundaryDistanceTolerance)]}var td={TOLERANCE:{configurable:!0}};Qf.prototype.reportResult=function(t,e,r){cu.out.println("Overlay result invalid - A:"+Xs.toLocationSymbol(e[0])+" B:"+Xs.toLocationSymbol(e[1])+" expected:"+(r?"i":"e")+" actual:"+Xs.toLocationSymbol(e[2]))},Qf.prototype.isValid=function(t){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(t)},Qf.prototype.checkValid=function(){if(1===arguments.length){for(var t=arguments[0],e=0;e<this._testCoords.size();e++){var r=this._testCoords.get(e);if(!this.checkValid(t,r))return this._invalidLocation=r,!1}return!0}if(2===arguments.length){var n=arguments[0],i=arguments[1];return this._location[0]=this._locFinder[0].getLocation(i),this._location[1]=this._locFinder[1].getLocation(i),this._location[2]=this._locFinder[2].getLocation(i),!!Qf.hasLocation(this._location,Xs.BOUNDARY)||this.isValidResult(n,this._location)}},Qf.prototype.addTestPts=function(t){var e=new Jf(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))},Qf.prototype.isValidResult=function(t,e){var r=Xf.isResultOfOp(e[0],e[1],t),n=!(r^e[2]===Xs.INTERIOR);return n||this.reportResult(t,e,r),n},Qf.prototype.getInvalidLocation=function(){return this._invalidLocation},Qf.prototype.interfaces_=function(){return[]},Qf.prototype.getClass=function(){return Qf},Qf.hasLocation=function(t,e){for(var r=0;r<3;r++)if(t[r]===e)return!0;return!1},Qf.computeBoundaryDistanceTolerance=function(t,e){return Math.min(sf.computeSizeBasedSnapTolerance(t),sf.computeSizeBasedSnapTolerance(e))},Qf.isValid=function(t,e,r,n){return new Qf(t,e,n).isValid(r)},td.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Qf,td);function ed(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=ed.extractFactory(t),this._inputGeoms=t}ed.prototype.extractElements=function(t,e){if(null===t)return null;for(var r=0;r<t.getNumGeometries();r++){var n=t.getGeometryN(r);this._skipEmpty&&n.isEmpty()||e.add(n)}},ed.prototype.combine=function(){for(var t=new nc,e=this._inputGeoms.iterator();e.hasNext();){var r=e.next();this.extractElements(r,t)}return 0===t.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)},ed.prototype.interfaces_=function(){return[]},ed.prototype.getClass=function(){return ed},ed.combine=function(){return 1===arguments.length?new ed(arguments[0]).combine():2===arguments.length?new ed(ed.createList(arguments[0],arguments[1])).combine():3===arguments.length?new ed(ed.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},ed.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},ed.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],r=new nc;return r.add(t),r.add(e),r}if(3===arguments.length){var n=arguments[0],i=arguments[1],o=arguments[2],a=new nc;return a.add(n),a.add(i),a.add(o),a}};function rd(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,null===this._inputPolys&&(this._inputPolys=new nc)}var nd={STRTREE_NODE_CAPACITY:{configurable:!0}};rd.prototype.reduceToGeometries=function(t){for(var e=new nc,r=t.iterator();r.hasNext();){var n=r.next(),i=null;Zs(n,Ju)?i=this.unionTree(n):n instanceof zu&&(i=n),e.add(i)}return e},rd.prototype.extractByEnvelope=function(t,e,r){for(var n=new nc,i=0;i<e.getNumGeometries();i++){var o=e.getGeometryN(i);o.getEnvelopeInternal().intersects(t)?n.add(o):r.add(o)}return this._geomFactory.buildGeometry(n)},rd.prototype.unionOptimized=function(t,e){var r=t.getEnvelopeInternal(),n=e.getEnvelopeInternal();if(!r.intersects(n))return ed.combine(t,e);if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var i=r.intersection(n);return this.unionUsingEnvelopeIntersection(t,e,i)},rd.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new ah(rd.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var r=e.next();t.insert(r.getEnvelopeInternal(),r)}this._inputPolys=null;var n=t.itemsTree();return this.unionTree(n)},rd.prototype.binaryUnion=function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],r=arguments[1],n=arguments[2];if(n-r<=1){var i=rd.getGeometry(e,r);return this.unionSafe(i,null)}if(n-r==2)return this.unionSafe(rd.getGeometry(e,r),rd.getGeometry(e,r+1));var o=Math.trunc((n+r)/2),a=this.binaryUnion(e,r,o),s=this.binaryUnion(e,o,n);return this.unionSafe(a,s)}},rd.prototype.repeatedUnion=function(t){for(var e=null,r=t.iterator();r.hasNext();){var n=r.next();e=null===e?n.copy():e.union(n)}return e},rd.prototype.unionSafe=function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},rd.prototype.unionActual=function(t,e){return rd.restrictToPolygons(t.union(e))},rd.prototype.unionTree=function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},rd.prototype.unionUsingEnvelopeIntersection=function(t,e,r){var n=new nc,i=this.extractByEnvelope(r,t,n),o=this.extractByEnvelope(r,e,n),a=this.unionActual(i,o);return n.add(a),ed.combine(n)},rd.prototype.bufferUnion=function(){if(1===arguments.length){var t=arguments[0];return t.get(0).getFactory().buildGeometry(t).buffer(0)}if(2===arguments.length){var e=arguments[0],r=arguments[1];return e.getFactory().createGeometryCollection([e,r]).buffer(0)}},rd.prototype.interfaces_=function(){return[]},rd.prototype.getClass=function(){return rd},rd.restrictToPolygons=function(t){if(Zs(t,zc))return t;var e=Rp.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(al.toPolygonArray(e))},rd.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},rd.union=function(t){return new rd(t).union()},nd.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(rd,nd);var id=function(){};id.prototype.interfaces_=function(){return[]},id.prototype.getClass=function(){return id},id.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Xf.createEmptyResult(Xf.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),vf.overlayOp(t,e,Xf.UNION)};function od(){return new Pi}Pi.prototype={constructor:Pi,reset:function(){this.s=this.t=0},add:function(t){Oi(ad,t,this.t),Oi(this,ad.s,this.s),this.s?this.t+=ad.t:this.s=ad.t},valueOf:function(){return this.s}};var ad=new Pi,sd=1e-6,ud=Math.PI,cd=ud/2,ld=ud/4,hd=2*ud,pd=180/ud,fd=ud/180,dd=Math.abs,md=Math.atan,gd=Math.atan2,yd=Math.cos,vd=Math.exp,_d=Math.log,bd=Math.sin,xd=Math.sqrt,wd=Math.tan,Sd={Feature:function(t,e){Li(t.geometry,e)},FeatureCollection:function(t,e){for(var r=t.features,n=-1,i=r.length;++n<i;)Li(r[n].geometry,e)}},Ed={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var r=t.coordinates,n=-1,i=r.length;++n<i;)t=r[n],e.point(t[0],t[1],t[2])},LineString:function(t,e){Ri(t.coordinates,e,0)},MultiLineString:function(t,e){for(var r=t.coordinates,n=-1,i=r.length;++n<i;)Ri(r[n],e,0)},Polygon:function(t,e){Ni(t.coordinates,e)},MultiPolygon:function(t,e){for(var r=t.coordinates,n=-1,i=r.length;++n<i;)Ni(r[n],e)},GeometryCollection:function(t,e){for(var r=t.geometries,n=-1,i=r.length;++n<i;)Li(r[n],e)}},Cd=function(t,e){t&&Sd.hasOwnProperty(t.type)?Sd[t.type](t,e):Li(t,e)},Md=(od(),od(),od(),function(r,n){function t(t,e){return t=r(t,e),n(t[0],t[1])}return r.invert&&n.invert&&(t.invert=function(t,e){return(t=n.invert(t,e))&&r.invert(t[0],t[1])}),t});Vi.invert=Vi;function Td(t,e){return dd(t[0]-e[0])<sd&&dd(t[1]-e[1])<sd}function Pd(t,e){return t<e?-1:e<t?1:e<=t?0:NaN}var Od,Ad,Id=function(){var r,e=[];return{point:function(t,e){r.push([t,e])},lineStart:function(){e.push(r=[])},lineEnd:Ii,rejoin:function(){1<e.length&&e.push(e.pop().concat(e.shift()))},result:function(){var t=e;return e=[],r=null,t}}},Ld=function(t,e,r,n,i,o){var a,s=t[0],u=t[1],c=0,l=1,h=e[0]-s,p=e[1]-u;if(a=r-s,h||!(0<a)){if(a/=h,h<0){if(a<c)return;a<l&&(l=a)}else if(0<h){if(l<a)return;c<a&&(c=a)}if(a=i-s,h||!(a<0)){if(a/=h,h<0){if(l<a)return;c<a&&(c=a)}else if(0<h){if(a<c)return;a<l&&(l=a)}if(a=n-u,p||!(0<a)){if(a/=p,p<0){if(a<c)return;a<l&&(l=a)}else if(0<p){if(l<a)return;c<a&&(c=a)}if(a=o-u,p||!(a<0)){if(a/=p,p<0){if(l<a)return;c<a&&(c=a)}else if(0<p){if(a<c)return;a<l&&(l=a)}return 0<c&&(t[0]=s+c*h,t[1]=u+c*p),l<1&&(e[0]=s+l*h,e[1]=u+l*p),!0}}}}},Rd=function(t,e,r,n,o){var a,i,s=[],u=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,r,n=t[0],i=t[e];if(Td(n,i)){for(o.lineStart(),a=0;a<e;++a)o.point((n=t[a])[0],n[1]);o.lineEnd()}else s.push(r=new Xi(n,t,null,!0)),u.push(r.o=new Xi(n,null,r,!1)),s.push(r=new Xi(i,t,null,!1)),u.push(r.o=new Xi(i,null,r,!0))}}),s.length){for(u.sort(e),Yi(s),Yi(u),a=0,i=u.length;a<i;++a)u[a].e=r=!r;for(var c,l,h=s[0];;){for(var p=h,f=!0;p.v;)if((p=p.n)===h)return;c=p.z,o.lineStart();do{if(p.v=p.o.v=!0,p.e){if(f)for(a=0,i=c.length;a<i;++a)o.point((l=c[a])[0],l[1]);else n(p.x,p.n.x,1,o);p=p.n}else{if(f)for(c=p.p.z,a=c.length-1;0<=a;--a)o.point((l=c[a])[0],l[1]);else n(p.x,p.p.x,-1,o);p=p.p}c=(p=p.o).z,f=!f}while(!p.v);o.lineEnd()}}},Nd=(1===(Od=Pd).length&&(Ad=Od,Od=function(t,e){return Pd(Ad(t),e)}),function(t){for(var e,r,n,i=t.length,o=-1,a=0;++o<i;)a+=t[o].length;for(r=new Array(a);0<=--i;)for(e=(n=t[i]).length;0<=--e;)r[--a]=n[e];return r}),kd=1e9,Dd=-kd,jd=od(),zd=(od(),function(t){return t}),Fd=(od(),od(),1/0),Bd=Fd,Ud=-Fd,Vd=Ud,Gd={point:function(t,e){t<Fd&&(Fd=t),Ud<t&&(Ud=t),e<Bd&&(Bd=e),Vd<e&&(Vd=e)},lineStart:Ii,lineEnd:Ii,polygonStart:Ii,polygonEnd:Ii,result:function(){var t=[[Fd,Bd],[Ud,Vd]];return Ud=Vd=-(Bd=Fd=1/0),t}},qd=(od(),function(v,_,b,x){return function(n,s){function e(t,e){var r=n(t,e);v(t=r[0],e=r[1])&&s.point(t,e)}function t(t,e){var r=n(t,e);p.point(r[0],r[1])}function r(){y.point=t,p.lineStart()}function i(){y.point=e,p.lineEnd()}function u(t,e){h.push([t,e]);var r=n(t,e);m.point(r[0],r[1])}function o(){m.lineStart(),h=[]}function a(){u(h[0][0],h[0][1]),m.lineEnd();var t,e,r,n,i=m.clean(),o=d.result(),a=o.length;if(h.pop(),c.push(h),h=null,a)if(1&i){if(0<(e=(r=o[0]).length-1)){for(g||(s.polygonStart(),g=!0),s.lineStart(),t=0;t<e;++t)s.point((n=r[t])[0],n[1]);s.lineEnd()}}else 1<a&&2&i&&o.push(o.pop().concat(o.shift())),l.push(o.filter(Zi))}var c,l,h,p=_(s),f=n.invert(x[0],x[1]),d=Id(),m=_(d),g=!1,y={point:e,lineStart:r,lineEnd:i,polygonStart:function(){y.point=u,y.lineStart=o,y.lineEnd=a,l=[],c=[]},polygonEnd:function(){y.point=e,y.lineStart=r,y.lineEnd=i,l=Nd(l);var t=function(t,e){var r=e[0],n=e[1],i=[bd(r),-yd(r),0],o=0,a=0;jd.reset();for(var s=0,u=t.length;s<u;++s)if(l=(c=t[s]).length)for(var c,l,h=c[l-1],p=h[0],f=h[1]/2+ld,d=bd(f),m=yd(f),g=0;g<l;++g,p=v,d=b,m=x,h=y){var y=c[g],v=y[0],_=y[1]/2+ld,b=bd(_),x=yd(_),w=v-p,S=0<=w?1:-1,E=S*w,C=ud<E,M=d*b;if(jd.add(gd(M*S*bd(E),m*x+M*yd(E))),o+=C?w+S*hd:w,C^r<=p^r<=v){var T=zi(Di(h),Di(y));Ui(T);var P=zi(i,T);Ui(P);var O=(C^0<=w?-1:1)*Ai(P[2]);(O<n||n===O&&(T[0]||T[1]))&&(a+=C^0<=w?1:-1)}}return(o<-sd||o<sd&&jd<-sd)^1&a}(c,f);l.length?(g||(s.polygonStart(),g=!0),Rd(l,Ki,t,b,s)):t&&(g||(s.polygonStart(),g=!0),s.lineStart(),b(null,null,1,s),s.lineEnd()),g&&(s.polygonEnd(),g=!1),l=c=null},sphere:function(){s.polygonStart(),s.lineStart(),b(null,null,1,s),s.lineEnd(),s.polygonEnd()}};return y}}),Hd=qd(function(){return!0},function(h){var p,f=NaN,d=NaN,m=NaN;return{lineStart:function(){h.lineStart(),p=1},point:function(t,e){var r,n,i,o,a,s,u,c=0<t?ud:-ud,l=dd(t-f);dd(l-ud)<sd?(h.point(f,d=0<(d+e)/2?cd:-cd),h.point(m,d),h.lineEnd(),h.lineStart(),h.point(c,d),h.point(t,d),p=0):m!==c&&ud<=l&&(dd(f-m)<sd&&(f-=m*sd),dd(t-c)<sd&&(t-=c*sd),n=d,o=e,u=bd((r=f)-(i=t)),d=dd(u)>sd?md((bd(n)*(s=yd(o))*bd(i)-bd(o)*(a=yd(n))*bd(r))/(a*s*u)):(n+o)/2,h.point(m,d),h.lineEnd(),h.lineStart(),h.point(c,d),p=0),h.point(f=t,d=e),m=c},lineEnd:function(){h.lineEnd(),f=d=NaN},clean:function(){return 2-p}}},function(t,e,r,n){var i;if(null==t)i=r*cd,n.point(-ud,i),n.point(0,i),n.point(ud,i),n.point(ud,0),n.point(ud,-i),n.point(0,-i),n.point(-ud,-i),n.point(-ud,0),n.point(-ud,i);else if(dd(t[0]-e[0])>sd){var o=t[0]<e[0]?ud:-ud;i=r*o/2,n.point(-o,i),n.point(0,i),n.point(o,i)}else n.point(e[0],e[1])},[-ud,-cd]);Qi.prototype={constructor:Qi,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function $d(t,e){return+e?(O=t,A=e,function(i){function t(t,e){t=O(t,e),i.point(t[0],t[1])}function e(){m=NaN,b.point=r,i.lineStart()}function r(t,e){var r=Di([t,e]),n=O(t,e);I(m,g,d,y,v,_,m=n[0],g=n[1],d=t,y=r[0],v=r[1],_=r[2],16,i),i.point(m,g)}function n(){b.point=t,i.lineEnd()}function o(){e(),b.point=a,b.lineEnd=s}function a(t,e){r(u=t,e),c=m,l=g,h=y,p=v,f=_,b.point=r}function s(){I(m,g,d,y,v,_,c,l,u,h,p,f,16,i),(b.lineEnd=n)()}var u,c,l,h,p,f,d,m,g,y,v,_,b={point:t,lineStart:e,lineEnd:n,polygonStart:function(){i.polygonStart(),b.lineStart=o},polygonEnd:function(){i.polygonEnd(),b.lineStart=e}};return b}):(r=t,Ji({point:function(t,e){t=r(t,e),this.stream.point(t[0],t[1])}}));var r,O,A;function I(t,e,r,n,i,o,a,s,u,c,l,h,p,f){var d=a-t,m=s-e,g=d*d+m*m;if(4*A<g&&p--){var y=n+c,v=i+l,_=o+h,b=xd(y*y+v*v+_*_),x=Ai(_/=b),w=dd(dd(_)-1)<sd||dd(r-u)<sd?(r+u)/2:gd(v,y),S=O(w,x),E=S[0],C=S[1],M=E-t,T=C-e,P=m*M-d*T;(A<P*P/g||.3<dd((d*M+m*T)/g-.5)||n*c+i*l+o*h<Wd)&&(I(t,e,r,n,i,o,E,C,w,y/=b,v/=b,_,p,f),f.point(E,C),I(E,C,w,y,v,_,a,s,u,c,l,h,p,f))}}}var Wd=yd(30*fd),Xd=Ji({point:function(t,e){this.stream.point(t*fd,e*fd)}});ro.invert=function(t,e){return[t,2*md(vd(e))-cd]},no.invert=function(t,e){return[-e,2*md(vd(t))-cd]};var Yd=function(){var r,n,i,o,a,e,s,u,c,l,t=(a=eo(r=no),e=a.center,s=a.scale,u=a.translate,c=a.clipExtent,l=null,a.scale=function(t){return arguments.length?(s(t),f()):s()},a.translate=function(t){return arguments.length?(u(t),f()):u()},a.center=function(t){return arguments.length?(e(t),f()):e()},a.clipExtent=function(t){return arguments.length?(null==t?l=n=i=o=null:(l=+t[0][0],n=+t[0][1],i=+t[1][0],o=+t[1][1]),f()):null==l?null:[[l,n],[i,o]]},f()),h=t.center,p=t.rotate;function f(){var t=ud*s(),e=a(function(e){function t(t){return(t=e(t[0]*fd,t[1]*fd))[0]*=pd,t[1]*=pd,t}return e=Gi(e[0]*fd,e[1]*fd,2<e.length?e[2]*fd:0),t.invert=function(t){return(t=e.invert(t[0]*fd,t[1]*fd))[0]*=pd,t[1]*=pd,t},t}(a.rotate()).invert([0,0]));return c(null==l?[[e[0]-t,e[1]-t],[e[0]+t,e[1]+t]]:r===ro?[[Math.max(e[0]-t,l),n],[Math.min(e[0]+t,i),o]]:[[l,Math.max(e[1]-t,n)],[i,Math.min(e[1]+t,o)]])}return t.center=function(t){return arguments.length?h([-t[1],t[0]]):[(t=h())[1],-t[0]]},t.rotate=function(t){return arguments.length?p([t[0],t[1],2<t.length?t[2]+90:90]):[(t=p())[0],t[1],t[2]-90]},p([0,0,90]).scale(159.155)};t.projection=Qo,t.random=ks,t.clusters=Ds,t.helpers=vo,t.invariant=bo,t.meta=_o,t.isolines=function(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n=r.zProperty||"elevation",i=r.commonProperties||{},o=r.breaksProperties||[];if(X(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks must be an Array");if(!H(i))throw new Error("commonProperties must be an Object");if(!Array.isArray(o))throw new Error("breaksProperties must be an Array");var a,s,u,c,l,h,p,f,d,m,g,y=function(e,t){if(!H(t=t||{}))throw new Error("options is invalid");var r=t.zProperty||"elevation",n=t.flip,i=t.flags;X(e,"Point","input must contain Points");for(var o=function(t,r){var n={};return E(e,function(t){var e=k(t)[1];n[e]||(n[e]=[]),n[e].push(t)}),Object.keys(n).map(function(t){return n[t].sort(function(t,e){return k(t)[0]-k(e)[0]})}).sort(function(t,e){return r?k(t[0])[1]-k(e[0])[1]:k(e[0])[1]-k(t[0])[1]})}(0,n),a=[],s=0;s<o.length;s++){for(var u=o[s],c=[],l=0;l<u.length;l++){var h=u[l];h.properties[r]?c.push(h.properties[r]):c.push(0),!0===i&&(h.properties.matrixPosition=[s,l])}a.push(c)}return a}(t,{zProperty:n,flip:!0});return G((a=function(t,e,r,n,i){for(var o=[],a=1;a<e.length;a++){var s=+e[a],u=Object.assign({},n,i[a]),c=_(J(t,u[r]=s),u);o.push(c)}return o}(y,e,n,i,o),s=y,u=$(t),c=u[2]-u[0],l=u[3]-u[1],h=u[0],p=u[1],f=s[0].length-1,d=s.length-1,m=c/f,g=l/d,a.forEach(function(t){w(t,v)}),a));function v(t){t[0]=t[0]*m+h,t[1]=t[1]*g+p}},t.convex=Tt,t.pointsWithinPolygon=At,t.concave=function(t,s){if(!H(s=s||{}))throw new Error("options is invalid");if(!t)throw new Error("points is required");var u=s.maxEdge||1/0;if(!q(u))throw new Error("maxEdge is invalid");var r,n,e=It((r=[],n={},E(t,function(t){if(t.geometry){var e=t.geometry.coordinates.join("-");n.hasOwnProperty(e)||(r.push(t),n[e]=!0)}}),G(r)));if(e.features=e.features.filter(function(t){var e=t.geometry.coordinates[0][0],r=t.geometry.coordinates[0][1],n=t.geometry.coordinates[0][2],i=kt(e,r,s),o=kt(r,n,s),a=kt(e,n,s);return i<=u&&o<=u&&a<=u}),e.features.length<1)return null;var i=Xt(e,s);return 1===i.coordinates.length&&(i.coordinates=i.coordinates[0],i.type="Polygon"),F(i)},t.collect=function(t,e,r,n){var i=Eo(6),o=e.features.map(function(t){return{minX:t.geometry.coordinates[0],minY:t.geometry.coordinates[1],maxX:t.geometry.coordinates[0],maxY:t.geometry.coordinates[1],property:t.properties[r]}});return i.load(o),t.features.forEach(function(e){e.properties||(e.properties={});var t=$(e),r=[];i.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}).forEach(function(t){Pt([t.minX,t.minY],e)&&r.push(t.property)}),e.properties[n]=r}),t},t.flip=function(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.mutate;if(!t)throw new Error("geojson is required");return!1!==r&&void 0!==r||(t=Dt(t)),w(t,function(t){var e=t[0],r=t[1];t[0]=r,t[1]=e}),t},t.simplify=function(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=void 0!==e.tolerance?e.tolerance:1,n=e.highQuality||!1,i=e.mutate||!1;if(!t)throw new Error("geojson is required");if(r&&r<0)throw new Error("invalid tolerance");return!0!==i&&(t=Dt(t)),T(t,function(t){!function(t,e,r){var n=t.type;if("Point"===n||"MultiPoint"===n)return;Yt(t,!0);var i=t.coordinates;switch(n){case"LineString":t.coordinates=Qt(i,e,r);break;case"MultiLineString":t.coordinates=i.map(function(t){return Qt(t,e,r)});break;case"Polygon":t.coordinates=te(i,e,r);break;case"MultiPolygon":t.coordinates=i.map(function(t){return te(t,e,r)})}}(t,r,n)}),t},t.bezierSpline=ee,t.tag=function(t,r,n,i){return t=Dt(t),r=Dt(r),E(t,function(e){e.properties||(e.properties={}),E(r,function(t){void 0===e.properties[i]&&Pt(e,t)&&(e.properties[i]=t.properties[n])})}),t},t.sample=function(t,e){if(!t)throw new Error("featurecollection is required");if(null==e)throw new Error("num is required");if("number"!=typeof e)throw new Error("num must be a number");return G(function(t,e){for(var r,n,i=t.slice(0),o=t.length,a=o-e;o-- >a;)r=i[n=Math.floor((o+1)*Math.random())],i[n]=i[o],i[o]=r;return i.slice(a)}(t.features,e))},t.envelope=ne,t.square=ie,t.circle=ae,t.midpoint=function(t,e){return oe(t,kt(t,e)/2,se(t,e))},t.center=ue,t.centerOfMass=function t(e,r){switch(K(e)){case"Point":return e;case"Polygon":var n=[];w(e,function(t){n.push(t)});var i,o,a,s,u,c,l,h,p=ce(e,r),f=p.geometry.coordinates,d=0,m=0,g=0,y=n.map(function(t){return[t[0]-f[0],t[1]-f[1]]});for(i=0;i<n.length-1;i++)s=(o=y[i])[0],c=o[1],u=(a=y[i+1])[0],g+=h=s*(l=a[1])-u*c,d+=(s+u)*h,m+=(c+l)*h;if(0===g)return p;var v=1/(.5*g*6);return B([f[0]+v*d,f[1]+v*m],r);default:var _=Tt(e);return _?t(_,r):ce(e,r)}},t.centroid=ce,t.combine=function(t){function e(t,e,r){r?n[e].coordinates=n[e].coordinates.concat(t.geometry.coordinates):n[e].coordinates.push(t.geometry.coordinates),n[e].properties.push(t.properties)}var n={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}},r=Object.keys(n).reduce(function(t,e){return t[e.replace("Multi","")]=e,t},{});return E(t,function(t){t.geometry&&(n[t.geometry.type]?e(t,t.geometry.type,!0):r[t.geometry.type]&&e(t,r[t.geometry.type],!1))}),G(Object.keys(n).filter(function(t){return n[t].coordinates.length}).sort().map(function(t){return F({type:t,coordinates:n[t].coordinates},{collectedProperties:n[t].properties})}))},t.distance=kt,t.explode=le,t.bbox=$,t.tesselate=function(t){if(!t.geometry||"Polygon"!==t.geometry.type&&"MultiPolygon"!==t.geometry.type)throw new Error("input must be a Polygon or MultiPolygon");var e={type:"FeatureCollection",features:[]};return"Polygon"===t.geometry.type?e.features=Me(t.geometry.coordinates):t.geometry.coordinates.forEach(function(t){e.features=e.features.concat(Me(t))}),e},t.bboxPolygon=re,t.booleanPointInPolygon=Pt,t.nearestPoint=Te,t.nearestPointOnLine=Xe,t.nearestPointToLine=function(t,r,e){if(!H(e=e||{}))throw new Error("options is invalid");var n=e.units,i=e.properties||{};if(!t)throw new Error("points is required");if(!(t=function(t){var e=[];switch(t.geometry?t.geometry.type:t.type){case"GeometryCollection":return T(t,function(t){"Point"===t.type&&e.push({type:"Feature",properties:{},geometry:t})}),{type:"FeatureCollection",features:e};case"FeatureCollection":return t.features=t.features.filter(function(t){return"Point"===t.geometry.type}),t;default:throw new Error("points must be a Point Collection")}}(t)).features.length)throw new Error("points must contain features");if(!r)throw new Error("line is required");if("LineString"!==K(r))throw new Error("line must be a LineString");var o=1/0,a=null;return E(t,function(t){var e=nr(t,r,{units:n});e<o&&(o=e,a=t)}),a&&(a.properties=Object.assign({dist:o},a.properties,i)),a},t.planepoint=function(t,e){var r=W(t),n=Y(e).coordinates[0];if(n.length<4)throw new Error("OuterRing of a Polygon must have 4 or more Positions.");var i=e.properties||{},o=i.a,a=i.b,s=i.c,u=r[0],c=r[1],l=n[0][0],h=n[0][1],p=void 0!==o?o:n[0][2],f=n[1][0],d=n[1][1],m=void 0!==a?a:n[1][2],g=n[2][0],y=n[2][1],v=void 0!==s?s:n[2][2];return(v*(u-l)*(c-d)+p*(u-f)*(c-y)+m*(u-g)*(c-h)-m*(u-l)*(c-y)-v*(u-f)*(c-h)-p*(u-g)*(c-d))/((u-l)*(c-d)+(u-f)*(c-y)+(u-g)*(c-h)-(u-l)*(c-y)-(u-f)*(c-h)-(u-g)*(c-d))},t.tin=It,t.bearing=se,t.destination=oe,t.kinks=function(t){var e,r,v={type:"FeatureCollection",features:[]};if("LineString"===(r="Feature"===t.type?t.geometry:t).type)e=[r.coordinates];else if("MultiLineString"===r.type)e=r.coordinates;else if("MultiPolygon"===r.type)e=[].concat.apply([],r.coordinates);else{if("Polygon"!==r.type)throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");e=r.coordinates}return e.forEach(function(y){e.forEach(function(t){for(var e=0;e<y.length-1;e++)for(var r=e;r<t.length-1;r++){if(y===t){if(1===Math.abs(e-r))continue;if(0===e&&r===y.length-2&&y[e][0]===y[y.length-1][0]&&y[e][1]===y[y.length-1][1])continue}var n=(i=y[e][0],o=y[e][1],a=y[e+1][0],s=y[e+1][1],u=t[r][0],c=t[r][1],l=t[r+1][0],h=t[r+1][1],g=m=d=f=p=void 0,g={x:null,y:null,onLine1:!1,onLine2:!1},0==(p=(h-c)*(a-i)-(l-u)*(s-o))?null!==g.x&&null!==g.y&&g:(m=(a-i)*(f=o-c)-(s-o)*(d=i-u),f=((l-u)*f-(h-c)*d)/p,d=m/p,g.x=i+f*(a-i),g.y=o+f*(s-o),0<=f&&f<=1&&(g.onLine1=!0),0<=d&&d<=1&&(g.onLine2=!0),!(!g.onLine1||!g.onLine2)&&[g.x,g.y]));n&&v.features.push(B([n[0],n[1]]))}var i,o,a,s,u,c,l,h,p,f,d,m,g})}),v},t.pointOnFeature=or,t.area=sr,t.along=function(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n;if("Feature"===t.type)n=t.geometry.coordinates;else{if("LineString"!==t.type)throw new Error("input must be a LineString Feature or Geometry");n=t.coordinates}if(!q(e))throw new Error("distance must be a number");for(var i=0,o=0;o<n.length&&!(i<=e&&o===n.length-1);o++){if(e<=i){var a=e-i;if(a){var s=se(n[o],n[o-1])-180;return oe(n[o],a,s,r)}return B(n[o])}i+=kt(n[o],n[o+1],r)}return B(n[n.length-1])},t.length=hr,t.lineSlice=function(t,e,r){var n=k(r);if("LineString"!==K(r))throw new Error("line must be a LineString");for(var i,o=Xe(r,t),a=Xe(r,e),s=[(i=o.properties.index<=a.properties.index?[o,a]:[a,o])[0].geometry.coordinates],u=i[0].properties.index+1;u<i[1].properties.index+1;u++)s.push(n[u]);return s.push(i[1].geometry.coordinates),V(s,r.properties)},t.lineSliceAlong=pr,t.pointGrid=yr,t.truncate=vr,t.flatten=function(t){if(!t)throw new Error("geojson is required");var e=[];return O(t,function(t){e.push(t)}),G(e)},t.lineIntersect=$e,t.lineChunk=function(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n=r.units,i=r.reverse;if(!t)throw new Error("geojson is required");if(e<=0)throw new Error("segmentLength must be greater than 0");var o=[];return O(t,function(t){i&&(t.geometry.coordinates=t.geometry.coordinates.reverse()),function(t,e,r,n){var i=hr(t,{units:r});if(i<=e)return n(t);var o=i/e;Number.isInteger(o)||(o=Math.floor(o)+1);for(var a=0;a<o;a++){n(pr(t,e*a,e*(a+1),{units:r}))}}(t,e,n,function(t){o.push(t)})}),G(o)},t.unkinkPolygon=function(t){var r=[];return O(t,function(e){"Polygon"===e.geometry.type&&E(Jo(e),function(t){r.push(U(t.geometry.coordinates,e.properties))})}),G(r)},t.greatCircle=function(t,e,r){if("object"!=typeof(r=r||{}))throw new Error("options is invalid");var n=r.properties,i=r.npoints,o=r.offset;return t=W(t),e=W(e),n=n||{},i=i||100,o=o||10,new ua({x:t[0],y:t[1]},{x:e[0],y:e[1]},n).Arc(i,{offset:o}).json()},t.lineSegment=He,t.lineSplit=function(t,e){if(!t)throw new Error("line is required");if(!e)throw new Error("splitter is required");var r=K(t),n=K(e);if("LineString"!==r)throw new Error("line must be LineString");if("FeatureCollection"===n)throw new Error("splitter cannot be a FeatureCollection");if("GeometryCollection"===n)throw new Error("splitter cannot be a GeometryCollection");var i=vr(e,{precision:7});switch(n){case"Point":return Sr(t,i);case"MultiPoint":return wr(t,i);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return wr(t,$e(t,i))}},t.lineArc=Mr,t.polygonToLine=Pr,t.lineToPolygon=Ar,t.bboxClip=function(t,e){var r,n=(r=t).geometry?r.geometry.type:r.type,i=k(t),o=t.properties;switch(n){case"LineString":case"MultiLineString":var a=[];return"LineString"===n&&(i=[i]),i.forEach(function(t){ca(t,e,a)}),1===a.length?V(a[0],o):_(a,o);case"Polygon":return U(Dr(i,e),o);case"MultiPolygon":return b(i.map(function(t){return Dr(t,e)}),o);default:throw new Error("geometry "+n+" not supported")}},t.lineOverlap=Ur,t.sector=function(t,e,r,n,i){if(!H(i=i||{}))throw new Error("options is invalid");if(!t)throw new Error("center is required");if(null==r)throw new Error("bearing1 is required");if(null==n)throw new Error("bearing2 is required");if(!e)throw new Error("radius is required");if("object"!=typeof i)throw new Error("options must be an object");if(Gr(r)===Gr(n))return ae(t,e,i);var o=k(t),a=[[o]];return w(Mr(t,e,r,n,i),function(t){a[0].push(t)}),a[0].push(o),U(a)},t.rhumbBearing=Ye,t.rhumbDistance=Ke,t.rhumbDestination=qr,t.polygonTangents=function(t,e){var r,n,i,o=k(t),a=k(e);switch(K(e)){case"Polygon":r=a[0][0],n=a[0][0],i=$r(a[0][0],a[0][a[0].length-1],o);var s=Hr(a[0],o,i,void 0,r,n);r=s[0],n=s[1];break;case"MultiPolygon":r=a[0][0][0],n=a[0][0][0],i=$r(a[0][0][0],a[0][0][a[0][0].length-1],o),a.forEach(function(t){var e=Hr(t[0],o,i,void 0,r,n);r=e[0],n=e[1]})}return G([B(r),B(n)])},t.rewind=function(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.reverse||!1,n=e.mutate||!1;if(!t)throw new Error("<geojson> is required");if("boolean"!=typeof r)throw new Error("<reverse> must be a boolean");if("boolean"!=typeof n)throw new Error("<mutate> must be a boolean");!1===n&&(t=Dt(t));var i=[];switch(t.type){case"GeometryCollection":return T(t,function(t){Xr(t,r)}),t;case"FeatureCollection":return E(t,function(t){E(Xr(t,r),function(t){i.push(t)})}),G(i)}return Xr(t,r)},t.isobands=function(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n=r.zProperty||"elevation",i=r.commonProperties||{},o=r.breaksProperties||[];if(X(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks is not an Array");if(!H(i))throw new Error("commonProperties is not an Object");if(!Array.isArray(o))throw new Error("breaksProperties is not an Array");var a,s,u,c,l,h,p,f,d,m,g,y=function(e,t){if(!H(t=t||{}))throw new Error("options is invalid");var r=t.zProperty||"elevation",n=t.flip,i=t.flags;X(e,"Point","input must contain Points");for(var o=function(t,r){var n={};return E(e,function(t){var e=k(t)[1];n[e]||(n[e]=[]),n[e].push(t)}),Object.keys(n).map(function(t){return n[t].sort(function(t,e){return k(t)[0]-k(e)[0]})}).sort(function(t,e){return r?k(t[0])[1]-k(e[0])[1]:k(e[0])[1]-k(t[0])[1]})}(0,n),a=[],s=0;s<o.length;s++){for(var u=o[s],c=[],l=0;l<u.length;l++){var h=u[l];h.properties[r]?c.push(h.properties[r]):c.push(0),!0===i&&(h.properties.matrixPosition=[s,l])}a.push(c)}return a}(t,{zProperty:n,flip:!0}),v=function(t,e,r){for(var n=[],i=1;i<e.length;i++){var o=+e[i-1],a=+e[i],s=Kr(t,o,a-o),u=function(){var r=[],n=[];s.forEach(function(t){var e=sr(U([t]));n.push(e),r.push({ring:t,area:e})}),n.sort(function(t,e){return e-t});var i=[];return n.forEach(function(t){for(var e=0;e<r.length;e++)if(r[e].area===t){i.push(r[e].ring),r.splice(e,1);break}}),i}(),c=function(){for(var t=u.map(function(t){return{lrCoordinates:t,grouped:!1}}),e=[];!function(t){for(var e=0;e<t.length;e++)if(!1===t[e].grouped)return!1;return!0}(t);)for(var r=0;r<t.length;r++)if(!t[r].grouped){var n=[];n.push(t[r].lrCoordinates),t[r].grouped=!0;for(var i=U([t[r].lrCoordinates]),o=r+1;o<t.length;o++)if(!t[o].grouped){var a=U([t[o].lrCoordinates]);!function(t,e){for(var r=le(a),n=0;n<r.features.length;n++)if(!Pt(r.features[n],e))return!1;return!0}(0,i)||(n.push(t[o].lrCoordinates),t[o].grouped=!0)}e.push(n)}return e}(),l={};l.groupedRings=c,l[r]=o+"-"+a,n.push(l)}return n}(y,e,n);return G((a=v,s=y,u=$(t),c=u[2]-u[0],l=u[3]-u[1],h=u[0],p=u[1],f=s[0].length-1,d=s.length-1,m=c/f,g=l/d,a.forEach(function(t){t.groupedRings.forEach(function(t){t.forEach(function(t){t.forEach(_)})})}),v=a).map(function(t,e){if(o[e]&&!H(o[e]))throw new Error("Each mappedProperty is required to be an Object");var r=Object.assign({},i,o[e]);return r[n]=t[n],b(t.groupedRings,r)}));function _(t){t[0]=t[0]*m+h,t[1]=t[1]*g+p}},t.transformRotate=tn,t.transformScale=en,t.transformTranslate=function(t,r,n,e){if(!H(e=e||{}))throw new Error("options is invalid");var i=e.units,o=e.zTranslation,a=e.mutate;if(!t)throw new Error("geojson is required");if(null==r||isNaN(r))throw new Error("distance is required");if(o&&"number"!=typeof o&&isNaN(o))throw new Error("zTranslation is not a number");if(o=void 0!==o?o:0,0===r&&0===o)return t;if(null==n||isNaN(n))throw new Error("direction is required");return r<0&&(r=-r,n=-n),!1!==a&&void 0!==a||(t=Dt(t)),w(t,function(t){var e=k(qr(t,r,n,{units:i}));t[0]=e[0],t[1]=e[1],o&&3===t.length&&(t[2]+=o)}),t},t.lineOffset=function(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n=r.units;if(!t)throw new Error("geojson is required");if(null==e||isNaN(e))throw new Error("distance is required");var i=K(t),o=t.properties;switch(i){case"LineString":return an(t,e,n);case"MultiLineString":var a=[];return O(t,function(t){a.push(an(t,e,n).geometry.coordinates)}),_(a,o);default:throw new Error("geometry "+i+" is not supported")}},t.polygonize=function(t){var e=us.fromGeoJson(t);e.deleteDangles(),e.deleteCutEdges();var r=[],n=[];return e.getEdgeRings().filter(function(t){return t.isValid()}).forEach(function(t){t.isHole()?r.push(t):n.push(t)}),r.forEach(function(t){as.findEdgeRingContaining(t,n)&&n.push(t)}),G(n.map(function(t){return t.toPolygon()}))},t.booleanDisjoint=function(t,r){var n;return O(t,function(e){O(r,function(t){if(!1===n)return!1;n=function(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return r=t.coordinates,n=e.coordinates,!(r[0]===n[0]&&r[1]===n[1]);case"LineString":return!cn(e,t);case"Polygon":return!Pt(t,e)}break;case"LineString":switch(e.type){case"Point":return!cn(t,e);case"LineString":return!(0<$e(t,e).features.length);case"Polygon":return!ln(e,t)}break;case"Polygon":switch(e.type){case"Point":return!Pt(e,t);case"LineString":return!ln(t,e);case"Polygon":return!function(t,e){for(var r=0;r<t.coordinates[0].length;r++)if(Pt(t.coordinates[0][r],e))return!0;for(var n=0;n<e.coordinates[0].length;n++)if(Pt(e.coordinates[0][n],t))return!0;return!1}(e,t)}}var r,n}(e.geometry,t.geometry)})}),n},t.booleanContains=function(t,e){var r=K(t),n=K(e),i=Y(t),o=Y(e),a=k(t),s=k(e);switch(r){case"Point":switch(n){case"Point":return pn(a,s);default:throw new Error("feature2 "+n+" geometry not supported")}case"MultiPoint":switch(n){case"Point":return function(t,e){var r,n=!1;for(r=0;r<t.coordinates.length;r++)if(pn(t.coordinates[r],e.coordinates)){n=!0;break}return n}(i,o);case"MultiPoint":return function(t,e){for(var r=0;r<e.coordinates.length;r++){for(var n=!1,i=0;i<t.coordinates.length;i++)if(pn(e.coordinates[r],t.coordinates[i])){n=!0;break}if(!n)return!1}return!0}(i,o);default:throw new Error("feature2 "+n+" geometry not supported")}case"LineString":switch(n){case"Point":return fr(o,i,{ignoreEndVertices:!0});case"LineString":return function(t,e){for(var r=!1,n=0;n<e.coordinates.length;n++)if(fr({type:"Point",coordinates:e.coordinates[n]},t,{ignoreEndVertices:!0})&&(r=!0),!fr({type:"Point",coordinates:e.coordinates[n]},t,{ignoreEndVertices:!1}))return!1;return r}(i,o);case"MultiPoint":return function(t,e){for(var r=!1,n=0;n<e.coordinates.length;n++)if(fr(e.coordinates[n],t,{ignoreEndVertices:!0})&&(r=!0),!fr(e.coordinates[n],t))return!1;return!!r}(i,o);default:throw new Error("feature2 "+n+" geometry not supported")}case"Polygon":switch(n){case"Point":return Pt(o,i,{ignoreBoundary:!0});case"LineString":return function(t,e){var r,n,i=!1,o=0;if(!hn($(t),$(e)))return!1;for(;o<e.coordinates.length-1;o++){if(Pt({type:"Point",coordinates:(r=e.coordinates[o],n=e.coordinates[o+1],[(r[0]+n[0])/2,(r[1]+n[1])/2])},t,{ignoreBoundary:!0})){i=!0;break}}return i}(i,o);case"Polygon":return function(t,e){if(!hn($(t),$(e)))return!1;for(var r=0;r<e.coordinates[0].length;r++)if(!Pt(e.coordinates[0][r],t))return!1;return!0}(i,o);case"MultiPoint":return function(t,e){for(var r=0;r<e.coordinates.length;r++)if(!Pt(e.coordinates[r],t,{ignoreBoundary:!0}))return!1;return!0}(i,o);default:throw new Error("feature2 "+n+" geometry not supported")}default:throw new Error("feature1 "+r+" geometry not supported")}},t.booleanCrosses=function(t,e){var r=K(t),n=K(e),i=Y(t),o=Y(e);switch(r){case"MultiPoint":switch(n){case"LineString":return fn(i,o);case"Polygon":return mn(i,o);default:throw new Error("feature2 "+n+" geometry not supported")}case"LineString":switch(n){case"MultiPoint":return fn(o,i);case"LineString":return function(t,e){if(0<$e(t,e).features.length)for(var r=0;r<t.coordinates.length-1;r++)for(var n=0;n<e.coordinates.length-1;n++){var i=!0;if(0!==n&&n!==e.coordinates.length-2||(i=!1),gn(t.coordinates[r],t.coordinates[r+1],e.coordinates[n],i))return!0}return!1}(i,o);case"Polygon":return dn(i,o);default:throw new Error("feature2 "+n+" geometry not supported")}case"Polygon":switch(n){case"MultiPoint":return mn(o,i);case"LineString":return dn(o,i);default:throw new Error("feature2 "+n+" geometry not supported")}default:throw new Error("feature1 "+r+" geometry not supported")}},t.booleanClockwise=Wr,t.booleanOverlap=bn,t.booleanPointOnLine=fr,t.booleanEqual=function(t,e){if(!t)throw new Error("feature1 is required");if(!e)throw new Error("feature2 is required");return K(t)===K(e)&&new ms({precision:6}).compare(Yt(t),Yt(e))},t.booleanWithin=dr,t.clone=Dt,t.cleanCoords=Yt,t.clustersDbscan=function(r,t,e){if("object"!=typeof(e=e||{}))throw new Error("options is invalid");var n=e.minPoints,i=e.units;if(X(r,"Point","Input must contain Points"),null==t)throw new Error("maxDistance is required");if(!(0<Math.sign(t)))throw new Error("Invalid maxDistance");if(!(null==n||0<Math.sign(n)))throw new Error("Invalid minPoints");r=Dt(r),n=n||3;var o=new bs.DBSCAN,a=-1;return o.run(M(r),c(t,i),n,kt).forEach(function(t){a++,t.forEach(function(t){var e=r.features[t];e.properties||(e.properties={}),e.properties.cluster=a,e.properties.dbscan="core"})}),o.noise.forEach(function(t){var e=r.features[t];e.properties||(e.properties={}),e.properties.cluster?e.properties.dbscan="edge":e.properties.dbscan="noise"}),r},t.clustersKmeans=function(t,e){if("object"!=typeof(e=e||{}))throw new Error("options is invalid");var r=e.numberOfClusters,n=e.mutate;X(t,"Point","Input must contain Points");var i=t.features.length;(r=r||Math.round(Math.sqrt(i/2)))>i&&(r=i),!1!==n&&void 0!==n||(t=Dt(t));var o=M(t),a=o.slice(0,r),s=ds(o,r,a),u={};return s.centroids.forEach(function(t,e){u[e]=t}),E(t,function(t,e){var r=s.idxs[e];t.properties.cluster=r,t.properties.centroid=u[r]}),t},t.pointToLineDistance=nr,t.booleanParallel=function(t,e){if(!t)throw new Error("line1 is required");if(!e)throw new Error("line2 is required");if("LineString"!==wn(t,"line1"))throw new Error("line1 must be a LineString");if("LineString"!==wn(e,"line2"))throw new Error("line2 must be a LineString");for(var r=He(Yt(t)).features,n=He(Yt(e)).features,i=0;i<r.length;i++){var o=r[i].geometry.coordinates;if(!n[i])break;if(a=o,s=n[i].geometry.coordinates,p(Ye(a[0],a[1]))!==p(Ye(s[0],s[1])))return!1}var a,s;return!0},t.shortestPath=function(t,e,r){if(!H(r=r||{}))throw new Error("options is invalid");var n=r.resolution,i=r.minDistance,o=r.obstacles||G([]);if(!t)throw new Error("start is required");if(!e)throw new Error("end is required");if(n&&!q(n)||n<=0)throw new Error("options.resolution must be a number, greater than 0");if(i)throw new Error("options.minDistance is not yet implemented");var a=W(t),s=W(e);switch(t=B(a),e=B(s),K(o)){case"FeatureCollection":if(0===o.features.length)return V([a,s]);break;case"Polygon":o=G([F(Y(o))]);break;default:throw new Error("invalid obstacles")}var u=o;u.features.push(t),u.features.push(e);var c=$(en(re($(u)),1.15));n=n||kt([c[0],c[1]],[c[2],c[1]],r)/100,u.features.pop(),u.features.pop();for(var l=c[0],h=c[1],p=c[2],f=c[3],d=n/kt([l,h],[p,h],r)*(p-l),m=n/kt([l,h],[l,f],r)*(f-h),g=p-l,y=f-h,v=(g-Math.floor(g/d)*d)/2,_=[],b=[],x=[],w=[],S=1/0,E=1/0,C=f-(y-Math.floor(y/m)*m)/2,M=0;h<=C;){for(var T=[],P=[],O=l+v,A=0;O<=p;){var I=B([O,C]),L=function(t,e){for(var r=0;r<e.features.length;r++)if(Pt(t,e.features[r]))return!0;return!1}(I,o);T.push(L?0:1),P.push(O+"|"+C);var R=kt(I,t);!L&&R<S&&(S=R,x={x:A,y:M});var N=kt(I,e);!L&&N<E&&(E=N,w={x:A,y:M}),O+=d,A++}b.push(T),_.push(P),C-=m,M++}var k=new En(b,{diagonal:!0}),D=k.grid[x.y][x.x],j=k.grid[w.y][w.x],z=[a];return Es.search(k,D,j).forEach(function(t){var e=_[t.x][t.y].split("|");z.push([+e[0],+e[1]])}),z.push(s),Yt(V(z))},t.voronoi=function(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.bbox||[-180,-85,180,85];if(!t)throw new Error("points is required");if(!Array.isArray(r))throw new Error("bbox is invalid");return X(t,"Point","points"),G(function(){function e(n){return new Xn(n.map(function(t,e){var r=[Math.round(i(t,e,n)/Rs)*Rs,Math.round(o(t,e,n)/Rs)*Rs];return r.index=e,r.data=t,r}),r)}var i=Tn,o=Pn,r=null;return e.polygons=function(t){return e(t).polygons()},e.links=function(t){return e(t).links()},e.triangles=function(t){return e(t).triangles()},e.x=function(t){return arguments.length?(i="function"==typeof t?t:Cs(+t),e):i},e.y=function(t){return arguments.length?(o="function"==typeof t?t:Cs(+t),e):o},e.extent=function(t){return arguments.length?(r=null==t?null:[[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]],e):r&&[[r[0][0],r[0][1]],[r[1][0],r[1][1]]]},e.size=function(t){return arguments.length?(r=null==t?null:[[0,0],[+t[0],+t[1]]],e):r&&[r[1][0]-r[0][0],r[1][1]-r[0][1]]},e}().x(function(t){return t.geometry.coordinates[0]}).y(function(t){return t.geometry.coordinates[1]}).extent([[r[0],r[1]],[r[2],r[3]]]).polygons(t.features).map(Yn))},t.ellipse=Zn,t.centerMean=Jn,t.centerMedian=function(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.counter||10;if(!q(r))throw new Error("counter must be a number");var n=e.weight,i=Jn(t,{weight:e.weight}),o=G([]);return E(t,function(t){o.features.push(ce(t,{weight:t.properties[n]}))}),o.properties={tolerance:e.tolerance,medianCandidates:[]},function t(o,e,r,n){var i=r.properties.tolerance||.001,a=0,s=0,u=0,c=0;if(E(r,function(t){var e=t.properties.weight,r=null==e?1:e;if(!q(r=Number(r)))throw new Error("weight value must be a number");if(0<r){c+=1;var n=r*kt(t,o);0===n&&(n=1);var i=r/n;a+=t.geometry.coordinates[0]*i,s+=t.geometry.coordinates[1]*i,u+=i}}),c<1)throw new Error("no features to measure");var l=a/u,h=s/u;return 1===c||0===n||Math.abs(l-e[0])<i&&Math.abs(h-e[1])<i?B([l,h],{medianCandidates:r.properties.medianCandidates}):(r.properties.medianCandidates.push([l,h]),t([l,h],o,r,n-1))}(i.geometry.coordinates,[0,0],o,r)},t.standardDeviationalEllipse=function(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var r=e.steps||64,n=e.weight,i=e.properties||{};if(!q(r))throw new Error("steps must be a number");if(!H(i))throw new Error("properties must be a number");var o=M(t).length,a=Jn(t,{weight:n}),s=0,u=0,c=0;E(t,function(t){var e=t.properties[n]||1,r=Qn(k(t),k(a));s+=Math.pow(r.x,2)*e,u+=Math.pow(r.y,2)*e,c+=r.x*r.y*e});var l=s-u,h=Math.sqrt(Math.pow(l,2)+4*Math.pow(c,2)),p=2*c,f=Math.atan((l+h)/p),d=180*f/Math.PI,m=0,g=0,y=0;E(t,function(t){var e=t.properties[n]||1,r=Qn(k(t),k(a));m+=Math.pow(r.x*Math.cos(f)-r.y*Math.sin(f),2)*e,g+=Math.pow(r.x*Math.sin(f)+r.y*Math.cos(f),2)*e,y+=e});var v=Math.sqrt(2*m/y),_=Math.sqrt(2*g/y),b=Zn(a,v,_,{units:"degrees",angle:d,steps:r,properties:i}),x=At(t,G([b])),w={meanCenterCoordinates:k(a),semiMajorAxis:v,semiMinorAxis:_,numberOfFeatures:o,angle:d,percentageWithinEllipse:100*M(x).length/o};return b.properties.standardDeviationalEllipse=w,b},t.difference=function(t,e){var r=Y(t),n=Y(e),i=t.properties||{};if(r=Ti(r),n=Ti(n),!r)return null;if(!n)return F(r,i);var o=new pl,a=o.read(r),s=o.read(n),u=Xf.difference(a,s);return u.isEmpty()?null:F((new fl).write(u),i)},t.buffer=function(t,r,e){var n=(e=e||{}).units,i=e.steps||64;if(!t)throw new Error("geojson is required");if("object"!=typeof e)throw new Error("options must be an object");if("number"!=typeof i)throw new Error("steps must be an number");if(void 0===r)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");i=i||64,n=n||"kilometers";var o=[];switch(t.type){case"GeometryCollection":return T(t,function(t){var e=io(t,r,n,i);e&&o.push(e)}),G(o);case"FeatureCollection":return E(t,function(t){var e=io(t,r,n,i);e&&E(e,function(t){t&&o.push(t)})}),G(o)}return io(t,r,n,i)},t.union=ao,t.intersect=so,t.dissolve=function(t,e){if(!H(e=e||{}))throw new Error("options is invalid");var o=e.propertyName;X(t,"Polygon","dissolve");var r=Dt(t),a=r.features,s=[];a.forEach(function(t,e){t.properties.origIndexPosition=e});var u=Ve();for(var c in u.load(r),a){var l=a[c],h=!1;if(u.search(l).features.forEach(function(t){l=a[c];var e,r=t.properties.origIndexPosition;if(0<s.length&&0!==r)if(r>s[s.length-1])r-=s.length;else{var n=function(n,t){var i,o;if(!Array.isArray(t))throw new Error("Get closest expects an array as second argument");return t.forEach(function(t,e){var r=function(t,e){return t-e}(t,n);0<=r&&(void 0===o||r<o)&&(o=r,i=e)}),i}(r,s);0!==n&&(r-=n)}if(r!==+c){var i=a[r];i&&l&&(void 0!==o&&i.properties[o]!==l.properties[o]||bn(l,i)&&(e=i,0<$e(V(M(l)),V(M(e))).features.length)&&(a[c]=ao(l,i),s.push(t.properties.origIndexPosition),s.sort(function(t,e){return t-e}),u.remove(t),a.splice(r,1),l.properties.origIndexPosition=c,u.remove(l,function(t,e){return t.properties.origIndexPosition===e.properties.origIndexPosition}),h=!0))}}),h){if(!l)continue;l.properties.origIndexPosition=c,u.insert(l),c--}}return a.forEach(function(t){delete t.properties.origIndexPosition,delete t.bbox}),r},t.hexGrid=uo,t.mask=function(t,e){var i,o,r,n,a,s,u=U(e&&e.geometry.coordinates||[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),c=(i=[],o=[],O(t,function(t){var e=t.geometry.coordinates,r=e[0],n=e.slice(1);i.push(U([r])),n.forEach(function(t){o.push(U([t]))})}),[G(i),G(o)]),l=c[0],h=c[1];return r=u,n=l=co(l),a=h=co(h),(s=[]).push(r.geometry.coordinates[0]),O(n,function(t){s.push(t.geometry.coordinates[0])}),O(a,function(t){s.push(t.geometry.coordinates[0])}),U(s)},t.squareGrid=ho,t.triangleGrid=po,t.interpolate=function(e,t,s){if("object"!=typeof(s=s||{}))throw new Error("options is invalid");var u=s.gridType,c=s.property,l=s.weight;if(!e)throw new Error("points is required");if(X(e,"Point","input must contain Points"),!t)throw new Error("cellSize is required");if(void 0!==l&&"number"!=typeof l)throw new Error("weight must be a number");c=c||"elevation",u=u||"square",l=l||1;var r,n=$(e);switch(u){case"point":case"points":r=yr(n,t,s);break;case"square":case"squares":r=ho(n,t,s);break;case"hex":case"hexes":r=uo(n,t,s);break;case"triangle":case"triangles":r=po(n,t,s);break;default:throw new Error("invalid gridType")}var h=[];return E(r,function(i){var o=0,a=0;E(e,function(t){var e,r=kt("point"===u?i:ce(i),t,s);if(void 0!==c&&(e=t.properties[c]),void 0===e&&(e=t.geometry.coordinates[2]),void 0===e)throw new Error("zValue is missing");0===r&&(o=e);var n=1/Math.pow(r,l);a+=n,o+=n*e});var t=Dt(i);t.properties[c]=o/a,h.push(t)}),G(h)},t.pointOnSurface=or,t.polygonToLineString=Pr,t.lineStringToPolygon=Ar,t.inside=Pt,t.within=At,t.bezier=ee,t.nearest=Te,t.pointOnLine=Xe,t.lineDistance=hr,t.radians2degrees=f,t.degrees2radians=v,t.distanceToDegrees=u,t.distanceToRadians=m,t.radiansToDistance=d,t.bearingToAngle=p,t.convertDistance=c,t.toMercator=Je,t.toWgs84=Qe,t.randomPosition=ti,t.randomPoint=ei,t.randomPolygon=ri,t.randomLineString=ni,t.getCluster=oi,t.clusterEach=ai,t.clusterReduce=si,t.createBins=ui,t.applyFilter=ci,t.propertiesContainsFilter=li,t.filterProperties=hi,t.earthRadius=fo,t.factors=mo,t.unitsFactors=go,t.areaFactors=yo,t.feature=F,t.geometry=e,t.point=B,t.points=r,t.polygon=U,t.polygons=n,t.lineString=V,t.lineStrings=i,t.featureCollection=G,t.multiLineString=_,t.multiPoint=o,t.multiPolygon=b,t.geometryCollection=a,t.round=s,t.radiansToLength=d,t.lengthToRadians=m,t.lengthToDegrees=u,t.bearingToAzimuth=p,t.radiansToDegrees=f,t.degreesToRadians=v,t.convertLength=c,t.convertArea=l,t.isNumber=q,t.isObject=H,t.validateBBox=h,t.validateId=g,t.getCoord=W,t.getCoords=k,t.containsNumber=D,t.geojsonType=j,t.featureOf=z,t.collectionOf=X,t.getGeom=Y,t.getGeomType=Z,t.getType=K,t.coordEach=w,t.coordReduce=y,t.propEach=x,t.propReduce=S,t.featureEach=E,t.featureReduce=C,t.coordAll=M,t.geomEach=T,t.geomReduce=P,t.flattenEach=O,t.flattenReduce=A,t.segmentEach=I,t.segmentReduce=L,t.lineEach=R,t.lineReduce=N,Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof r&&void 0!==e?i(r):"function"==typeof define&&define.amd?define(["exports"],i):i(n.turf={})},{}],3:[function(t,e,r){!function(){"use strict";function s(i,t){var e;if(t=t||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=t.touchBoundary||10,this.layer=i,this.tapDelay=t.tapDelay||200,this.tapTimeout=t.tapTimeout||700,!s.notNeeded(i)){for(var r=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],n=0,o=r.length;n<o;n++)this[r[n]]=a(this[r[n]],this);u&&(i.addEventListener("mouseover",this.onMouse,!0),i.addEventListener("mousedown",this.onMouse,!0),i.addEventListener("mouseup",this.onMouse,!0)),i.addEventListener("click",this.onClick,!0),i.addEventListener("touchstart",this.onTouchStart,!1),i.addEventListener("touchmove",this.onTouchMove,!1),i.addEventListener("touchend",this.onTouchEnd,!1),i.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(i.removeEventListener=function(t,e,r){var n=Node.prototype.removeEventListener;"click"===t?n.call(i,t,e.hijacked||e,r):n.call(i,t,e,r)},i.addEventListener=function(t,e,r){var n=Node.prototype.addEventListener;"click"===t?n.call(i,t,e.hijacked||(e.hijacked=function(t){t.propagationStopped||e(t)}),r):n.call(i,t,e,r)}),"function"==typeof i.onclick&&(e=i.onclick,i.addEventListener("click",function(t){e(t)},!1),i.onclick=null)}function a(t,e){return function(){return t.apply(e,arguments)}}}var t=0<=navigator.userAgent.indexOf("Windows Phone"),u=0<navigator.userAgent.indexOf("Android")&&!t,c=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,l=c&&/OS 4_\d(_\d)?/.test(navigator.userAgent),h=c&&/OS [6-7]_\d/.test(navigator.userAgent),i=0<navigator.userAgent.indexOf("BB10");s.prototype.needsClick=function(t){switch(t.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(t.disabled)return!0;break;case"input":if(c&&"file"===t.type||t.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(t.className)},s.prototype.needsFocus=function(t){switch(t.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!u;case"input":switch(t.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!t.disabled&&!t.readOnly;default:return/\bneedsfocus\b/.test(t.className)}},s.prototype.sendClick=function(t,e){var r,n;document.activeElement&&document.activeElement!==t&&document.activeElement.blur(),n=e.changedTouches[0],(r=document.createEvent("MouseEvents")).initMouseEvent(this.determineEventType(t),!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),r.forwardedTouchEvent=!0,t.dispatchEvent(r)},s.prototype.determineEventType=function(t){return u&&"select"===t.tagName.toLowerCase()?"mousedown":"click"},s.prototype.focus=function(t){var e;c&&t.setSelectionRange&&0!==t.type.indexOf("date")&&"time"!==t.type&&"month"!==t.type?(e=t.value.length,t.setSelectionRange(e,e)):t.focus()},s.prototype.updateScrollParent=function(t){var e,r;if(!(e=t.fastClickScrollParent)||!e.contains(t)){r=t;do{if(r.scrollHeight>r.offsetHeight){e=r,t.fastClickScrollParent=r;break}r=r.parentElement}while(r)}e&&(e.fastClickLastScrollTop=e.scrollTop)},s.prototype.getTargetElementFromEventTarget=function(t){return t.nodeType===Node.TEXT_NODE?t.parentNode:t},s.prototype.onTouchStart=function(t){var e,r,n;if(1<t.targetTouches.length)return!0;if(e=this.getTargetElementFromEventTarget(t.target),r=t.targetTouches[0],c){if((n=window.getSelection()).rangeCount&&!n.isCollapsed)return!0;if(!l){if(r.identifier&&r.identifier===this.lastTouchIdentifier)return t.preventDefault(),!1;this.lastTouchIdentifier=r.identifier,this.updateScrollParent(e)}}return this.trackingClick=!0,this.trackingClickStart=t.timeStamp,this.targetElement=e,this.touchStartX=r.pageX,this.touchStartY=r.pageY,t.timeStamp-this.lastClickTime<this.tapDelay&&t.preventDefault(),!0},s.prototype.touchHasMoved=function(t){var e=t.changedTouches[0],r=this.touchBoundary;return Math.abs(e.pageX-this.touchStartX)>r||Math.abs(e.pageY-this.touchStartY)>r},s.prototype.onTouchMove=function(t){return this.trackingClick&&(this.targetElement===this.getTargetElementFromEventTarget(t.target)&&!this.touchHasMoved(t)||(this.trackingClick=!1,this.targetElement=null)),!0},s.prototype.findControl=function(t){return void 0!==t.control?t.control:t.htmlFor?document.getElementById(t.htmlFor):t.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},s.prototype.onTouchEnd=function(t){var e,r,n,i,o,a=this.targetElement;if(!this.trackingClick)return!0;if(t.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0;if(t.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=t.timeStamp,r=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,h&&(o=t.changedTouches[0],(a=document.elementFromPoint(o.pageX-window.pageXOffset,o.pageY-window.pageYOffset)||a).fastClickScrollParent=this.targetElement.fastClickScrollParent),"label"===(n=a.tagName.toLowerCase())){if(e=this.findControl(a)){if(this.focus(a),u)return!1;a=e}}else if(this.needsFocus(a))return 100<t.timeStamp-r||c&&window.top!==window&&"input"===n?this.targetElement=null:(this.focus(a),this.sendClick(a,t),c&&"select"===n||(this.targetElement=null,t.preventDefault())),!1;return!(!c||l||!(i=a.fastClickScrollParent)||i.fastClickLastScrollTop===i.scrollTop)||(this.needsClick(a)||(t.preventDefault(),this.sendClick(a,t)),!1)},s.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},s.prototype.onMouse=function(t){return!this.targetElement||(!!t.forwardedTouchEvent||(!t.cancelable||(!(!this.needsClick(this.targetElement)||this.cancelNextClick)||(t.stopImmediatePropagation?t.stopImmediatePropagation():t.propagationStopped=!0,t.stopPropagation(),t.preventDefault(),!1))))},s.prototype.onClick=function(t){var e;return this.trackingClick?(this.targetElement=null,!(this.trackingClick=!1)):"submit"===t.target.type&&0===t.detail||((e=this.onMouse(t))||(this.targetElement=null),e)},s.prototype.destroy=function(){var t=this.layer;u&&(t.removeEventListener("mouseover",this.onMouse,!0),t.removeEventListener("mousedown",this.onMouse,!0),t.removeEventListener("mouseup",this.onMouse,!0)),t.removeEventListener("click",this.onClick,!0),t.removeEventListener("touchstart",this.onTouchStart,!1),t.removeEventListener("touchmove",this.onTouchMove,!1),t.removeEventListener("touchend",this.onTouchEnd,!1),t.removeEventListener("touchcancel",this.onTouchCancel,!1)},s.notNeeded=function(t){var e,r,n;if(void 0===window.ontouchstart)return!0;if(r=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!u)return!0;if(e=document.querySelector("meta[name=viewport]")){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(31<r&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(i&&10<=(n=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/))[1]&&3<=n[2]&&(e=document.querySelector("meta[name=viewport]"))){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===t.style.msTouchAction||"manipulation"===t.style.touchAction||(!!(27<=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]&&(e=document.querySelector("meta[name=viewport]"))&&(-1!==e.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))||("none"===t.style.touchAction||"manipulation"===t.style.touchAction))},s.attach=function(t,e){return new s(t,e)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return s}):void 0!==e&&e.exports?(e.exports=s.attach,e.exports.FastClick=s):window.FastClick=s}()},{}],4:[function(t,e,r){var n,i;n="undefined"!=typeof window?window:this,i=function(S,t){function e(t,e){return e.toUpperCase()}var h=[],d=S.document,l=h.slice,m=h.concat,s=h.push,i=h.indexOf,r={},n=r.toString,g=r.hasOwnProperty,y={},E=function(t,e){return new E.fn.init(t,e)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,a=/^-ms-/,u=/-([\da-z])/gi;function c(t){var e=!!t&&"length"in t&&t.length,r=E.type(t);return"function"!==r&&!E.isWindow(t)&&("array"===r||0===e||"number"==typeof e&&0<e&&e-1 in t)}E.fn=E.prototype={jquery:"1.12.4",constructor:E,selector:"",length:0,toArray:function(){return l.call(this)},get:function(t){return null!=t?t<0?this[t+this.length]:this[t]:l.call(this)},pushStack:function(t){var e=E.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t){return E.each(this,t)},map:function(r){return this.pushStack(E.map(this,function(t,e){return r.call(t,e,t)}))},slice:function(){return this.pushStack(l.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,r=+t+(t<0?e:0);return this.pushStack(0<=r&&r<e?[this[r]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:h.sort,splice:h.splice},E.extend=E.fn.extend=function(){var t,e,r,n,i,o,a=arguments[0]||{},s=1,u=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[s]||{},s++),"object"==typeof a||E.isFunction(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(i=arguments[s]))for(n in i)t=a[n],a!==(r=i[n])&&(c&&r&&(E.isPlainObject(r)||(e=E.isArray(r)))?(o=e?(e=!1,t&&E.isArray(t)?t:[]):t&&E.isPlainObject(t)?t:{},a[n]=E.extend(c,o,r)):void 0!==r&&(a[n]=r));return a},E.extend({expando:"jQuery"+("1.12.4"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===E.type(t)},isArray:Array.isArray||function(t){return"array"===E.type(t)},isWindow:function(t){return null!=t&&t==t.window},isNumeric:function(t){var e=t&&t.toString();return!E.isArray(t)&&0<=e-parseFloat(e)+1},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},isPlainObject:function(t){var e;if(!t||"object"!==E.type(t)||t.nodeType||E.isWindow(t))return!1;try{if(t.constructor&&!g.call(t,"constructor")&&!g.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}if(!y.ownFirst)for(e in t)return g.call(t,e);for(e in t);return void 0===e||g.call(t,e)},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?r[n.call(t)]||"object":typeof t},globalEval:function(t){t&&E.trim(t)&&(S.execScript||function(t){S.eval.call(S,t)})(t)},camelCase:function(t){return t.replace(a,"ms-").replace(u,e)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e){var r,n=0;if(c(t))for(r=t.length;n<r&&!1!==e.call(t[n],n,t[n]);n++);else for(n in t)if(!1===e.call(t[n],n,t[n]))break;return t},trim:function(t){return null==t?"":(t+"").replace(o,"")},makeArray:function(t,e){var r=e||[];return null!=t&&(c(Object(t))?E.merge(r,"string"==typeof t?[t]:t):s.call(r,t)),r},inArray:function(t,e,r){var n;if(e){if(i)return i.call(e,t,r);for(n=e.length,r=r?r<0?Math.max(0,n+r):r:0;r<n;r++)if(r in e&&e[r]===t)return r}return-1},merge:function(t,e){for(var r=+e.length,n=0,i=t.length;n<r;)t[i++]=e[n++];if(r!=r)for(;void 0!==e[n];)t[i++]=e[n++];return t.length=i,t},grep:function(t,e,r){for(var n=[],i=0,o=t.length,a=!r;i<o;i++)!e(t[i],i)!=a&&n.push(t[i]);return n},map:function(t,e,r){var n,i,o=0,a=[];if(c(t))for(n=t.length;o<n;o++)null!=(i=e(t[o],o,r))&&a.push(i);else for(o in t)null!=(i=e(t[o],o,r))&&a.push(i);return m.apply([],a)},guid:1,proxy:function(t,e){var r,n,i;if("string"==typeof e&&(i=t[e],e=t,t=i),E.isFunction(t))return r=l.call(arguments,2),(n=function(){return t.apply(e||this,r.concat(l.call(arguments)))}).guid=t.guid=t.guid||E.guid++,n},now:function(){return+new Date},support:y}),"function"==typeof Symbol&&(E.fn[Symbol.iterator]=h[Symbol.iterator]),E.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){r["[object "+e+"]"]=e.toLowerCase()});var p=function(r){function h(t,e,r){var n="0x"+e-65536;return n!=n||r?e:n<0?String.fromCharCode(65536+n):String.fromCharCode(n>>10|55296,1023&n|56320)}function i(){w()}var t,d,b,o,a,m,p,g,x,u,c,w,S,s,E,y,l,f,v,C="sizzle"+1*new Date,_=r.document,M=0,n=0,T=it(),P=it(),O=it(),A=function(t,e){return t===e&&(c=!0),0},I={}.hasOwnProperty,e=[],L=e.pop,R=e.push,N=e.push,k=e.slice,D=function(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",z="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",B="\\["+z+"*("+F+")(?:"+z+"*([*^$|!~]?=)"+z+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+F+"))|)"+z+"*\\]",U=":("+F+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+B+")*)|.*)\\)|)",V=new RegExp(z+"+","g"),G=new RegExp("^"+z+"+|((?:^|[^\\\\])(?:\\\\.)*)"+z+"+$","g"),q=new RegExp("^"+z+"*,"+z+"*"),H=new RegExp("^"+z+"*([>+~]|"+z+")"+z+"*"),$=new RegExp("="+z+"*([^\\]'\"]*?)"+z+"*\\]","g"),W=new RegExp(U),X=new RegExp("^"+F+"$"),Y={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),TAG:new RegExp("^("+F+"|[*])"),ATTR:new RegExp("^"+B),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+z+"*(even|odd|(([+-]|)(\\d*)n|)"+z+"*(?:([+-]|)"+z+"*(\\d+)|))"+z+"*\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+z+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+z+"*((?:-\\d)?\\d*)"+z+"*\\)|)(?=[^-]|$)","i")},Z=/^(?:input|select|textarea|button)$/i,K=/^h\d$/i,J=/^[^{]+\{\s*\[native \w/,Q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tt=/[+~]/,et=/'|\\/g,rt=new RegExp("\\\\([\\da-f]{1,6}"+z+"?|("+z+")|.)","ig");try{N.apply(e=k.call(_.childNodes),_.childNodes),e[_.childNodes.length].nodeType}catch(t){N={apply:e.length?function(t,e){R.apply(t,k.call(e))}:function(t,e){for(var r=t.length,n=0;t[r++]=e[n++];);t.length=r-1}}}function nt(t,e,r,n){var i,o,a,s,u,c,l,h,p=e&&e.ownerDocument,f=e?e.nodeType:9;if(r=r||[],"string"!=typeof t||!t||1!==f&&9!==f&&11!==f)return r;if(!n&&((e?e.ownerDocument||e:_)!==S&&w(e),e=e||S,E)){if(11!==f&&(c=Q.exec(t)))if(i=c[1]){if(9===f){if(!(a=e.getElementById(i)))return r;if(a.id===i)return r.push(a),r}else if(p&&(a=p.getElementById(i))&&v(e,a)&&a.id===i)return r.push(a),r}else{if(c[2])return N.apply(r,e.getElementsByTagName(t)),r;if((i=c[3])&&d.getElementsByClassName&&e.getElementsByClassName)return N.apply(r,e.getElementsByClassName(i)),r}if(d.qsa&&!O[t+" "]&&(!y||!y.test(t))){if(1!==f)p=e,h=t;else if("object"!==e.nodeName.toLowerCase()){for((s=e.getAttribute("id"))?s=s.replace(et,"\\$&"):e.setAttribute("id",s=C),o=(l=m(t)).length,u=X.test(s)?"#"+s:"[id='"+s+"']";o--;)l[o]=u+" "+dt(l[o]);h=l.join(","),p=tt.test(t)&&pt(e.parentNode)||e}if(h)try{return N.apply(r,p.querySelectorAll(h)),r}catch(t){}finally{s===C&&e.removeAttribute("id")}}}return g(t.replace(G,"$1"),e,r,n)}function it(){var n=[];return function t(e,r){return n.push(e+" ")>b.cacheLength&&delete t[n.shift()],t[e+" "]=r}}function ot(t){return t[C]=!0,t}function at(t){var e=S.createElement("div");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function st(t,e){for(var r=t.split("|"),n=r.length;n--;)b.attrHandle[r[n]]=e}function ut(t,e){var r=e&&t,n=r&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||1<<31)-(~t.sourceIndex||1<<31);if(n)return n;if(r)for(;r=r.nextSibling;)if(r===e)return-1;return t?1:-1}function ct(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function lt(r){return function(t){var e=t.nodeName.toLowerCase();return("input"===e||"button"===e)&&t.type===r}}function ht(a){return ot(function(o){return o=+o,ot(function(t,e){for(var r,n=a([],t.length,o),i=n.length;i--;)t[r=n[i]]&&(t[r]=!(e[r]=t[r]))})})}function pt(t){return t&&void 0!==t.getElementsByTagName&&t}for(t in d=nt.support={},a=nt.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},w=nt.setDocument=function(t){var e,r,n=t?t.ownerDocument||t:_;return n!==S&&9===n.nodeType&&n.documentElement&&(s=(S=n).documentElement,E=!a(S),(r=S.defaultView)&&r.top!==r&&(r.addEventListener?r.addEventListener("unload",i,!1):r.attachEvent&&r.attachEvent("onunload",i)),d.attributes=at(function(t){return t.className="i",!t.getAttribute("className")}),d.getElementsByTagName=at(function(t){return t.appendChild(S.createComment("")),!t.getElementsByTagName("*").length}),d.getElementsByClassName=J.test(S.getElementsByClassName),d.getById=at(function(t){return s.appendChild(t).id=C,!S.getElementsByName||!S.getElementsByName(C).length}),d.getById?(b.find.ID=function(t,e){if(void 0!==e.getElementById&&E){var r=e.getElementById(t);return r?[r]:[]}},b.filter.ID=function(t){var e=t.replace(rt,h);return function(t){return t.getAttribute("id")===e}}):(delete b.find.ID,b.filter.ID=function(t){var r=t.replace(rt,h);return function(t){var e=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return e&&e.value===r}}),b.find.TAG=d.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):d.qsa?e.querySelectorAll(t):void 0}:function(t,e){var r,n=[],i=0,o=e.getElementsByTagName(t);if("*"!==t)return o;for(;r=o[i++];)1===r.nodeType&&n.push(r);return n},b.find.CLASS=d.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&E)return e.getElementsByClassName(t)},l=[],y=[],(d.qsa=J.test(S.querySelectorAll))&&(at(function(t){s.appendChild(t).innerHTML="<a id='"+C+"'></a><select id='"+C+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&y.push("[*^$]="+z+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||y.push("\\["+z+"*(?:value|"+j+")"),t.querySelectorAll("[id~="+C+"-]").length||y.push("~="),t.querySelectorAll(":checked").length||y.push(":checked"),t.querySelectorAll("a#"+C+"+*").length||y.push(".#.+[+~]")}),at(function(t){var e=S.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&y.push("name"+z+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||y.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),y.push(",.*:")})),(d.matchesSelector=J.test(f=s.matches||s.webkitMatchesSelector||s.mozMatchesSelector||s.oMatchesSelector||s.msMatchesSelector))&&at(function(t){d.disconnectedMatch=f.call(t,"div"),f.call(t,"[s!='']:x"),l.push("!=",U)}),y=y.length&&new RegExp(y.join("|")),l=l.length&&new RegExp(l.join("|")),e=J.test(s.compareDocumentPosition),v=e||J.test(s.contains)?function(t,e){var r=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(r.contains?r.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},A=e?function(t,e){if(t===e)return c=!0,0;var r=!t.compareDocumentPosition-!e.compareDocumentPosition;return r||(1&(r=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!d.sortDetached&&e.compareDocumentPosition(t)===r?t===S||t.ownerDocument===_&&v(_,t)?-1:e===S||e.ownerDocument===_&&v(_,e)?1:u?D(u,t)-D(u,e):0:4&r?-1:1)}:function(t,e){if(t===e)return c=!0,0;var r,n=0,i=t.parentNode,o=e.parentNode,a=[t],s=[e];if(!i||!o)return t===S?-1:e===S?1:i?-1:o?1:u?D(u,t)-D(u,e):0;if(i===o)return ut(t,e);for(r=t;r=r.parentNode;)a.unshift(r);for(r=e;r=r.parentNode;)s.unshift(r);for(;a[n]===s[n];)n++;return n?ut(a[n],s[n]):a[n]===_?-1:s[n]===_?1:0}),S},nt.matches=function(t,e){return nt(t,null,null,e)},nt.matchesSelector=function(t,e){if((t.ownerDocument||t)!==S&&w(t),e=e.replace($,"='$1']"),d.matchesSelector&&E&&!O[e+" "]&&(!l||!l.test(e))&&(!y||!y.test(e)))try{var r=f.call(t,e);if(r||d.disconnectedMatch||t.document&&11!==t.document.nodeType)return r}catch(t){}return 0<nt(e,S,null,[t]).length},nt.contains=function(t,e){return(t.ownerDocument||t)!==S&&w(t),v(t,e)},nt.attr=function(t,e){(t.ownerDocument||t)!==S&&w(t);var r=b.attrHandle[e.toLowerCase()],n=r&&I.call(b.attrHandle,e.toLowerCase())?r(t,e,!E):void 0;return void 0!==n?n:d.attributes||!E?t.getAttribute(e):(n=t.getAttributeNode(e))&&n.specified?n.value:null},nt.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},nt.uniqueSort=function(t){var e,r=[],n=0,i=0;if(c=!d.detectDuplicates,u=!d.sortStable&&t.slice(0),t.sort(A),c){for(;e=t[i++];)e===t[i]&&(n=r.push(i));for(;n--;)t.splice(r[n],1)}return u=null,t},o=nt.getText=function(t){var e,r="",n=0,i=t.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)r+=o(t)}else if(3===i||4===i)return t.nodeValue}else for(;e=t[n++];)r+=o(e);return r},(b=nt.selectors={cacheLength:50,createPseudo:ot,match:Y,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(rt,h),t[3]=(t[3]||t[4]||t[5]||"").replace(rt,h),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||nt.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&nt.error(t[0]),t},PSEUDO:function(t){var e,r=!t[6]&&t[2];return Y.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":r&&W.test(r)&&(e=m(r,!0))&&(e=r.indexOf(")",r.length-e)-r.length)&&(t[0]=t[0].slice(0,e),t[2]=r.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(rt,h).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=T[t+" "];return e||(e=new RegExp("(^|"+z+")"+t+"("+z+"|$)"))&&T(t,function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(r,n,i){return function(t){var e=nt.attr(t,r);return null==e?"!="===n:!n||(e+="","="===n?e===i:"!="===n?e!==i:"^="===n?i&&0===e.indexOf(i):"*="===n?i&&-1<e.indexOf(i):"$="===n?i&&e.slice(-i.length)===i:"~="===n?-1<(" "+e.replace(V," ")+" ").indexOf(i):"|="===n&&(e===i||e.slice(0,i.length+1)===i+"-"))}},CHILD:function(d,t,e,m,g){var y="nth"!==d.slice(0,3),v="last"!==d.slice(-4),_="of-type"===t;return 1===m&&0===g?function(t){return!!t.parentNode}:function(t,e,r){var n,i,o,a,s,u,c=y!=v?"nextSibling":"previousSibling",l=t.parentNode,h=_&&t.nodeName.toLowerCase(),p=!r&&!_,f=!1;if(l){if(y){for(;c;){for(a=t;a=a[c];)if(_?a.nodeName.toLowerCase()===h:1===a.nodeType)return!1;u=c="only"===d&&!u&&"nextSibling"}return!0}if(u=[v?l.firstChild:l.lastChild],v&&p){for(f=(s=(n=(i=(o=(a=l)[C]||(a[C]={}))[a.uniqueID]||(o[a.uniqueID]={}))[d]||[])[0]===M&&n[1])&&n[2],a=s&&l.childNodes[s];a=++s&&a&&a[c]||(f=s=0)||u.pop();)if(1===a.nodeType&&++f&&a===t){i[d]=[M,s,f];break}}else if(p&&(f=s=(n=(i=(o=(a=t)[C]||(a[C]={}))[a.uniqueID]||(o[a.uniqueID]={}))[d]||[])[0]===M&&n[1]),!1===f)for(;(a=++s&&a&&a[c]||(f=s=0)||u.pop())&&((_?a.nodeName.toLowerCase()!==h:1!==a.nodeType)||!++f||(p&&((i=(o=a[C]||(a[C]={}))[a.uniqueID]||(o[a.uniqueID]={}))[d]=[M,f]),a!==t)););return(f-=g)===m||f%m==0&&0<=f/m}}},PSEUDO:function(t,o){var e,a=b.pseudos[t]||b.setFilters[t.toLowerCase()]||nt.error("unsupported pseudo: "+t);return a[C]?a(o):1<a.length?(e=[t,t,"",o],b.setFilters.hasOwnProperty(t.toLowerCase())?ot(function(t,e){for(var r,n=a(t,o),i=n.length;i--;)t[r=D(t,n[i])]=!(e[r]=n[i])}):function(t){return a(t,0,e)}):a}},pseudos:{not:ot(function(t){var n=[],i=[],s=p(t.replace(G,"$1"));return s[C]?ot(function(t,e,r,n){for(var i,o=s(t,null,n,[]),a=t.length;a--;)(i=o[a])&&(t[a]=!(e[a]=i))}):function(t,e,r){return n[0]=t,s(n,null,r,i),n[0]=null,!i.pop()}}),has:ot(function(e){return function(t){return 0<nt(e,t).length}}),contains:ot(function(e){return e=e.replace(rt,h),function(t){return-1<(t.textContent||t.innerText||o(t)).indexOf(e)}}),lang:ot(function(r){return X.test(r||"")||nt.error("unsupported lang: "+r),r=r.replace(rt,h).toLowerCase(),function(t){var e;do{if(e=E?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(e=e.toLowerCase())===r||0===e.indexOf(r+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var e=r.location&&r.location.hash;return e&&e.slice(1)===t.id},root:function(t){return t===s},focus:function(t){return t===S.activeElement&&(!S.hasFocus||S.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return!1===t.disabled},disabled:function(t){return!0===t.disabled},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!b.pseudos.empty(t)},header:function(t){return K.test(t.nodeName)},input:function(t){return Z.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:ht(function(){return[0]}),last:ht(function(t,e){return[e-1]}),eq:ht(function(t,e,r){return[r<0?r+e:r]}),even:ht(function(t,e){for(var r=0;r<e;r+=2)t.push(r);return t}),odd:ht(function(t,e){for(var r=1;r<e;r+=2)t.push(r);return t}),lt:ht(function(t,e,r){for(var n=r<0?r+e:r;0<=--n;)t.push(n);return t}),gt:ht(function(t,e,r){for(var n=r<0?r+e:r;++n<e;)t.push(n);return t})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[t]=ct(t);for(t in{submit:!0,reset:!0})b.pseudos[t]=lt(t);function ft(){}function dt(t){for(var e=0,r=t.length,n="";e<r;e++)n+=t[e].value;return n}function mt(s,t,e){var u=t.dir,c=e&&"parentNode"===u,l=n++;return t.first?function(t,e,r){for(;t=t[u];)if(1===t.nodeType||c)return s(t,e,r)}:function(t,e,r){var n,i,o,a=[M,l];if(r){for(;t=t[u];)if((1===t.nodeType||c)&&s(t,e,r))return!0}else for(;t=t[u];)if(1===t.nodeType||c){if((n=(i=(o=t[C]||(t[C]={}))[t.uniqueID]||(o[t.uniqueID]={}))[u])&&n[0]===M&&n[1]===l)return a[2]=n[2];if((i[u]=a)[2]=s(t,e,r))return!0}}}function gt(i){return 1<i.length?function(t,e,r){for(var n=i.length;n--;)if(!i[n](t,e,r))return!1;return!0}:i[0]}function yt(t,e,r,n,i){for(var o,a=[],s=0,u=t.length,c=null!=e;s<u;s++)(o=t[s])&&(r&&!r(o,n,i)||(a.push(o),c&&e.push(s)));return a}function vt(f,d,m,g,y,t){return g&&!g[C]&&(g=vt(g)),y&&!y[C]&&(y=vt(y,t)),ot(function(t,e,r,n){var i,o,a,s=[],u=[],c=e.length,l=t||function(t,e,r){for(var n=0,i=e.length;n<i;n++)nt(t,e[n],r);return r}(d||"*",r.nodeType?[r]:r,[]),h=!f||!t&&d?l:yt(l,s,f,r,n),p=m?y||(t?f:c||g)?[]:e:h;if(m&&m(h,p,r,n),g)for(i=yt(p,u),g(i,[],r,n),o=i.length;o--;)(a=i[o])&&(p[u[o]]=!(h[u[o]]=a));if(t){if(y||f){if(y){for(i=[],o=p.length;o--;)(a=p[o])&&i.push(h[o]=a);y(null,p=[],i,n)}for(o=p.length;o--;)(a=p[o])&&-1<(i=y?D(t,a):s[o])&&(t[i]=!(e[i]=a))}}else p=yt(p===e?p.splice(c,p.length):p),y?y(null,e,p,n):N.apply(e,p)})}function _t(t){for(var i,e,r,n=t.length,o=b.relative[t[0].type],a=o||b.relative[" "],s=o?1:0,u=mt(function(t){return t===i},a,!0),c=mt(function(t){return-1<D(i,t)},a,!0),l=[function(t,e,r){var n=!o&&(r||e!==x)||((i=e).nodeType?u(t,e,r):c(t,e,r));return i=null,n}];s<n;s++)if(e=b.relative[t[s].type])l=[mt(gt(l),e)];else{if((e=b.filter[t[s].type].apply(null,t[s].matches))[C]){for(r=++s;r<n&&!b.relative[t[r].type];r++);return vt(1<s&&gt(l),1<s&&dt(t.slice(0,s-1).concat({value:" "===t[s-2].type?"*":""})).replace(G,"$1"),e,s<r&&_t(t.slice(s,r)),r<n&&_t(t=t.slice(r)),r<n&&dt(t))}l.push(e)}return gt(l)}return ft.prototype=b.filters=b.pseudos,b.setFilters=new ft,m=nt.tokenize=function(t,e){var r,n,i,o,a,s,u,c=P[t+" "];if(c)return e?0:c.slice(0);for(a=t,s=[],u=b.preFilter;a;){for(o in r&&!(n=q.exec(a))||(n&&(a=a.slice(n[0].length)||a),s.push(i=[])),r=!1,(n=H.exec(a))&&(r=n.shift(),i.push({value:r,type:n[0].replace(G," ")}),a=a.slice(r.length)),b.filter)!(n=Y[o].exec(a))||u[o]&&!(n=u[o](n))||(r=n.shift(),i.push({value:r,type:o,matches:n}),a=a.slice(r.length));if(!r)break}return e?a.length:a?nt.error(t):P(t,s).slice(0)},p=nt.compile=function(t,e){var r,n=[],i=[],o=O[t+" "];if(!o){for(r=(e=e||m(t)).length;r--;)(o=_t(e[r]))[C]?n.push(o):i.push(o);(o=O(t,function(g,y){function t(t,e,r,n,i){var o,a,s,u=0,c="0",l=t&&[],h=[],p=x,f=t||_&&b.find.TAG("*",i),d=M+=null==p?1:Math.random()||.1,m=f.length;for(i&&(x=e===S||e||i);c!==m&&null!=(o=f[c]);c++){if(_&&o){for(a=0,e||o.ownerDocument===S||(w(o),r=!E);s=g[a++];)if(s(o,e||S,r)){n.push(o);break}i&&(M=d)}v&&((o=!s&&o)&&u--,t&&l.push(o))}if(u+=c,v&&c!==u){for(a=0;s=y[a++];)s(l,h,e,r);if(t){if(0<u)for(;c--;)l[c]||h[c]||(h[c]=L.call(n));h=yt(h)}N.apply(n,h),i&&!t&&0<h.length&&1<u+y.length&&nt.uniqueSort(n)}return i&&(M=d,x=p),l}var v=0<y.length,_=0<g.length;return v?ot(t):t}(i,n))).selector=t}return o},g=nt.select=function(t,e,r,n){var i,o,a,s,u,c="function"==typeof t&&t,l=!n&&m(t=c.selector||t);if(r=r||[],1===l.length){if(2<(o=l[0]=l[0].slice(0)).length&&"ID"===(a=o[0]).type&&d.getById&&9===e.nodeType&&E&&b.relative[o[1].type]){if(!(e=(b.find.ID(a.matches[0].replace(rt,h),e)||[])[0]))return r;c&&(e=e.parentNode),t=t.slice(o.shift().value.length)}for(i=Y.needsContext.test(t)?0:o.length;i--&&(a=o[i],!b.relative[s=a.type]);)if((u=b.find[s])&&(n=u(a.matches[0].replace(rt,h),tt.test(o[0].type)&&pt(e.parentNode)||e))){if(o.splice(i,1),!(t=n.length&&dt(o)))return N.apply(r,n),r;break}}return(c||p(t,l))(n,e,!E,r,!e||tt.test(t)&&pt(e.parentNode)||e),r},d.sortStable=C.split("").sort(A).join("")===C,d.detectDuplicates=!!c,w(),d.sortDetached=at(function(t){return 1&t.compareDocumentPosition(S.createElement("div"))}),at(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||st("type|href|height|width",function(t,e,r){if(!r)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),d.attributes&&at(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||st("value",function(t,e,r){if(!r&&"input"===t.nodeName.toLowerCase())return t.defaultValue}),at(function(t){return null==t.getAttribute("disabled")})||st(j,function(t,e,r){var n;if(!r)return!0===t[e]?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null}),nt}(S);E.find=p,E.expr=p.selectors,E.expr[":"]=E.expr.pseudos,E.uniqueSort=E.unique=p.uniqueSort,E.text=p.getText,E.isXMLDoc=p.isXML,E.contains=p.contains;function f(t,e,r){for(var n=[],i=void 0!==r;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(i&&E(t).is(r))break;n.push(t)}return n}function v(t,e){for(var r=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&r.push(t);return r}var _=E.expr.match.needsContext,b=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,x=/^.[^:#\[\.,]*$/;function w(t,r,n){if(E.isFunction(r))return E.grep(t,function(t,e){return!!r.call(t,e,t)!==n});if(r.nodeType)return E.grep(t,function(t){return t===r!==n});if("string"==typeof r){if(x.test(r))return E.filter(r,t,n);r=E.filter(r,t)}return E.grep(t,function(t){return-1<E.inArray(t,r)!==n})}E.filter=function(t,e,r){var n=e[0];return r&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?E.find.matchesSelector(n,t)?[n]:[]:E.find.matches(t,E.grep(e,function(t){return 1===t.nodeType}))},E.fn.extend({find:function(t){var e,r=[],n=this,i=n.length;if("string"!=typeof t)return this.pushStack(E(t).filter(function(){for(e=0;e<i;e++)if(E.contains(n[e],this))return!0}));for(e=0;e<i;e++)E.find(t,n[e],r);return(r=this.pushStack(1<i?E.unique(r):r)).selector=this.selector?this.selector+" "+t:t,r},filter:function(t){return this.pushStack(w(this,t||[],!1))},not:function(t){return this.pushStack(w(this,t||[],!0))},is:function(t){return!!w(this,"string"==typeof t&&_.test(t)?E(t):t||[],!1).length}});var C,M=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(E.fn.init=function(t,e,r){var n,i;if(!t)return this;if(r=r||C,"string"!=typeof t)return t.nodeType?(this.context=this[0]=t,this.length=1,this):E.isFunction(t)?void 0!==r.ready?r.ready(t):t(E):(void 0!==t.selector&&(this.selector=t.selector,this.context=t.context),E.makeArray(t,this));if(!(n="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&3<=t.length?[null,t,null]:M.exec(t))||!n[1]&&e)return!e||e.jquery?(e||r).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof E?e[0]:e,E.merge(this,E.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:d,!0)),b.test(n[1])&&E.isPlainObject(e))for(n in e)E.isFunction(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}if((i=d.getElementById(n[2]))&&i.parentNode){if(i.id!==n[2])return C.find(t);this.length=1,this[0]=i}return this.context=d,this.selector=t,this}).prototype=E.fn,C=E(d);var T=/^(?:parents|prev(?:Until|All))/,P={children:!0,contents:!0,next:!0,prev:!0};function O(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}E.fn.extend({has:function(t){var e,r=E(t,this),n=r.length;return this.filter(function(){for(e=0;e<n;e++)if(E.contains(this,r[e]))return!0})},closest:function(t,e){for(var r,n=0,i=this.length,o=[],a=_.test(t)||"string"!=typeof t?E(t,e||this.context):0;n<i;n++)for(r=this[n];r&&r!==e;r=r.parentNode)if(r.nodeType<11&&(a?-1<a.index(r):1===r.nodeType&&E.find.matchesSelector(r,t))){o.push(r);break}return this.pushStack(1<o.length?E.uniqueSort(o):o)},index:function(t){return t?"string"==typeof t?E.inArray(this[0],E(t)):E.inArray(t.jquery?t[0]:t,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(E.uniqueSort(E.merge(this.get(),E(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),E.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return f(t,"parentNode")},parentsUntil:function(t,e,r){return f(t,"parentNode",r)},next:function(t){return O(t,"nextSibling")},prev:function(t){return O(t,"previousSibling")},nextAll:function(t){return f(t,"nextSibling")},prevAll:function(t){return f(t,"previousSibling")},nextUntil:function(t,e,r){return f(t,"nextSibling",r)},prevUntil:function(t,e,r){return f(t,"previousSibling",r)},siblings:function(t){return v((t.parentNode||{}).firstChild,t)},children:function(t){return v(t.firstChild)},contents:function(t){return E.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:E.merge([],t.childNodes)}},function(n,i){E.fn[n]=function(t,e){var r=E.map(this,i,t);return"Until"!==n.slice(-5)&&(e=t),e&&"string"==typeof e&&(r=E.filter(e,r)),1<this.length&&(P[n]||(r=E.uniqueSort(r)),T.test(n)&&(r=r.reverse())),this.pushStack(r)}});var A,I,L=/\S+/g;function R(){d.addEventListener?(d.removeEventListener("DOMContentLoaded",N),S.removeEventListener("load",N)):(d.detachEvent("onreadystatechange",N),S.detachEvent("onload",N))}function N(){!d.addEventListener&&"load"!==S.event.type&&"complete"!==d.readyState||(R(),E.ready())}for(I in E.Callbacks=function(n){n="string"==typeof n?function(t){var r={};return E.each(t.match(L)||[],function(t,e){r[e]=!0}),r}(n):E.extend({},n);function r(){for(o=n.once,e=i=!0;s.length;u=-1)for(t=s.shift();++u<a.length;)!1===a[u].apply(t[0],t[1])&&n.stopOnFalse&&(u=a.length,t=!1);n.memory||(t=!1),i=!1,o&&(a=t?[]:"")}var i,t,e,o,a=[],s=[],u=-1,c={add:function(){return a&&(t&&!i&&(u=a.length-1,s.push(t)),function r(t){E.each(t,function(t,e){E.isFunction(e)?n.unique&&c.has(e)||a.push(e):e&&e.length&&"string"!==E.type(e)&&r(e)})}(arguments),t&&!i&&r()),this},remove:function(){return E.each(arguments,function(t,e){for(var r;-1<(r=E.inArray(e,a,r));)a.splice(r,1),r<=u&&u--}),this},has:function(t){return t?-1<E.inArray(t,a):0<a.length},empty:function(){return a=a&&[],this},disable:function(){return o=s=[],a=t="",this},disabled:function(){return!a},lock:function(){return o=!0,t||c.disable(),this},locked:function(){return!!o},fireWith:function(t,e){return o||(e=[t,(e=e||[]).slice?e.slice():e],s.push(e),i||r()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!e}};return c},E.extend({Deferred:function(t){var o=[["resolve","done",E.Callbacks("once memory"),"resolved"],["reject","fail",E.Callbacks("once memory"),"rejected"],["notify","progress",E.Callbacks("memory")]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},then:function(){var i=arguments;return E.Deferred(function(n){E.each(o,function(t,e){var r=E.isFunction(i[t])&&i[t];s[e[1]](function(){var t=r&&r.apply(this,arguments);t&&E.isFunction(t.promise)?t.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[e[0]+"With"](this===a?n.promise():this,r?[t]:arguments)})}),i=null}).promise()},promise:function(t){return null!=t?E.extend(t,a):a}},s={};return a.pipe=a.then,E.each(o,function(t,e){var r=e[2],n=e[3];a[e[1]]=r.add,n&&r.add(function(){i=n},o[1^t][2].disable,o[2][2].lock),s[e[0]]=function(){return s[e[0]+"With"](this===s?a:this,arguments),this},s[e[0]+"With"]=r.fireWith}),a.promise(s),t&&t.call(s,s),s},when:function(t){function e(e,r,n){return function(t){r[e]=this,n[e]=1<arguments.length?l.call(arguments):t,n===i?c.notifyWith(r,n):--u||c.resolveWith(r,n)}}var i,r,n,o=0,a=l.call(arguments),s=a.length,u=1!==s||t&&E.isFunction(t.promise)?s:0,c=1===u?t:E.Deferred();if(1<s)for(i=new Array(s),r=new Array(s),n=new Array(s);o<s;o++)a[o]&&E.isFunction(a[o].promise)?a[o].promise().progress(e(o,r,i)).done(e(o,n,a)).fail(c.reject):--u;return u||c.resolveWith(n,a),c.promise()}}),E.fn.ready=function(t){return E.ready.promise().done(t),this},E.extend({isReady:!1,readyWait:1,holdReady:function(t){t?E.readyWait++:E.ready(!0)},ready:function(t){(!0===t?--E.readyWait:E.isReady)||(E.isReady=!0)!==t&&0<--E.readyWait||(A.resolveWith(d,[E]),E.fn.triggerHandler&&(E(d).triggerHandler("ready"),E(d).off("ready")))}}),E.ready.promise=function(t){if(!A)if(A=E.Deferred(),"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll)S.setTimeout(E.ready);else if(d.addEventListener)d.addEventListener("DOMContentLoaded",N),S.addEventListener("load",N);else{d.attachEvent("onreadystatechange",N),S.attachEvent("onload",N);var r=!1;try{r=null==S.frameElement&&d.documentElement}catch(t){}r&&r.doScroll&&!function e(){if(!E.isReady){try{r.doScroll("left")}catch(t){return S.setTimeout(e,50)}R(),E.ready()}}()}return A.promise(t)},E.ready.promise(),E(y))break;y.ownFirst="0"===I,y.inlineBlockNeedsLayout=!1,E(function(){var t,e,r,n;(r=d.getElementsByTagName("body")[0])&&r.style&&(e=d.createElement("div"),(n=d.createElement("div")).style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",r.appendChild(n).appendChild(e),void 0!==e.style.zoom&&(e.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",y.inlineBlockNeedsLayout=t=3===e.offsetWidth,t&&(r.style.zoom=1)),r.removeChild(n))}),function(){var t=d.createElement("div");y.deleteExpando=!0;try{delete t.test}catch(t){y.deleteExpando=!1}t=null}();function k(t){var e=E.noData[(t.nodeName+" ").toLowerCase()],r=+t.nodeType||1;return(1===r||9===r)&&(!e||!0!==e&&t.getAttribute("classid")===e)}var D,j=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,z=/([A-Z])/g;function F(t,e,r){if(void 0===r&&1===t.nodeType){var n="data-"+e.replace(z,"-$1").toLowerCase();if("string"==typeof(r=t.getAttribute(n))){try{r="true"===r||"false"!==r&&("null"===r?null:+r+""===r?+r:j.test(r)?E.parseJSON(r):r)}catch(t){}E.data(t,e,r)}else r=void 0}return r}function B(t){var e;for(e in t)if(("data"!==e||!E.isEmptyObject(t[e]))&&"toJSON"!==e)return!1;return!0}function U(t,e,r,n){if(k(t)){var i,o,a=E.expando,s=t.nodeType,u=s?E.cache:t,c=s?t[a]:t[a]&&a;if(c&&u[c]&&(n||u[c].data)||void 0!==r||"string"!=typeof e)return u[c=c||(s?t[a]=h.pop()||E.guid++:a)]||(u[c]=s?{}:{toJSON:E.noop}),"object"!=typeof e&&"function"!=typeof e||(n?u[c]=E.extend(u[c],e):u[c].data=E.extend(u[c].data,e)),o=u[c],n||(o.data||(o.data={}),o=o.data),void 0!==r&&(o[E.camelCase(e)]=r),"string"==typeof e?null==(i=o[e])&&(i=o[E.camelCase(e)]):i=o,i}}function V(t,e,r){if(k(t)){var n,i,o=t.nodeType,a=o?E.cache:t,s=o?t[E.expando]:E.expando;if(a[s]){if(e&&(n=r?a[s]:a[s].data)){i=(e=E.isArray(e)?e.concat(E.map(e,E.camelCase)):e in n?[e]:(e=E.camelCase(e))in n?[e]:e.split(" ")).length;for(;i--;)delete n[e[i]];if(r?!B(n):!E.isEmptyObject(n))return}(r||(delete a[s].data,B(a[s])))&&(o?E.cleanData([t],!0):y.deleteExpando||a!=a.window?delete a[s]:a[s]=void 0)}}}E.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(t){return!!(t=t.nodeType?E.cache[t[E.expando]]:t[E.expando])&&!B(t)},data:function(t,e,r){return U(t,e,r)},removeData:function(t,e){return V(t,e)},_data:function(t,e,r){return U(t,e,r,!0)},_removeData:function(t,e){return V(t,e,!0)}}),E.fn.extend({data:function(t,e){var r,n,i,o=this[0],a=o&&o.attributes;if(void 0!==t)return"object"==typeof t?this.each(function(){E.data(this,t)}):1<arguments.length?this.each(function(){E.data(this,t,e)}):o?F(o,t,E.data(o,t)):void 0;if(this.length&&(i=E.data(o),1===o.nodeType&&!E._data(o,"parsedAttrs"))){for(r=a.length;r--;)a[r]&&0===(n=a[r].name).indexOf("data-")&&F(o,n=E.camelCase(n.slice(5)),i[n]);E._data(o,"parsedAttrs",!0)}return i},removeData:function(t){return this.each(function(){E.removeData(this,t)})}}),E.extend({queue:function(t,e,r){var n;if(t)return e=(e||"fx")+"queue",n=E._data(t,e),r&&(!n||E.isArray(r)?n=E._data(t,e,E.makeArray(r)):n.push(r)),n||[]},dequeue:function(t,e){e=e||"fx";var r=E.queue(t,e),n=r.length,i=r.shift(),o=E._queueHooks(t,e);"inprogress"===i&&(i=r.shift(),n--),i&&("fx"===e&&r.unshift("inprogress"),delete o.stop,i.call(t,function(){E.dequeue(t,e)},o)),!n&&o&&o.empty.fire()},_queueHooks:function(t,e){var r=e+"queueHooks";return E._data(t,r)||E._data(t,r,{empty:E.Callbacks("once memory").add(function(){E._removeData(t,e+"queue"),E._removeData(t,r)})})}}),E.fn.extend({queue:function(e,r){var t=2;return"string"!=typeof e&&(r=e,e="fx",t--),arguments.length<t?E.queue(this[0],e):void 0===r?this:this.each(function(){var t=E.queue(this,e,r);E._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&E.dequeue(this,e)})},dequeue:function(t){return this.each(function(){E.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){function r(){--i||o.resolveWith(a,[a])}var n,i=1,o=E.Deferred(),a=this,s=this.length;for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";s--;)(n=E._data(a[s],t+"queueHooks"))&&n.empty&&(i++,n.empty.add(r));return r(),o.promise(e)}}),y.shrinkWrapBlocks=function(){return null!=D?D:(D=!1,(e=d.getElementsByTagName("body")[0])&&e.style?(t=d.createElement("div"),(r=d.createElement("div")).style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",e.appendChild(r).appendChild(t),void 0!==t.style.zoom&&(t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",t.appendChild(d.createElement("div")).style.width="5px",D=3!==t.offsetWidth),e.removeChild(r),D):void 0);var t,e,r};function G(t,e){return t=e||t,"none"===E.css(t,"display")||!E.contains(t.ownerDocument,t)}var q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,H=new RegExp("^(?:([+-])=|)("+q+")([a-z%]*)$","i"),$=["Top","Right","Bottom","Left"];function W(t,e,r,n){var i,o=1,a=20,s=n?function(){return n.cur()}:function(){return E.css(t,e,"")},u=s(),c=r&&r[3]||(E.cssNumber[e]?"":"px"),l=(E.cssNumber[e]||"px"!==c&&+u)&&H.exec(E.css(t,e));if(l&&l[3]!==c)for(c=c||l[3],r=r||[],l=+u||1;l/=o=o||".5",E.style(t,e,l+c),o!==(o=s()/u)&&1!==o&&--a;);return r&&(l=+l||+u||0,i=r[1]?l+(r[1]+1)*r[2]:+r[2],n&&(n.unit=c,n.start=l,n.end=i)),i}var X,Y,Z,K=function(t,e,r,n,i,o,a){var s=0,u=t.length,c=null==r;if("object"===E.type(r))for(s in i=!0,r)K(t,e,s,r[s],!0,o,a);else if(void 0!==n&&(i=!0,E.isFunction(n)||(a=!0),c&&(e=a?(e.call(t,n),null):(c=e,function(t,e,r){return c.call(E(t),r)})),e))for(;s<u;s++)e(t[s],r,a?n:n.call(t[s],s,e(t[s],r)));return i?t:c?e.call(t):u?e(t[0],r):o},J=/^(?:checkbox|radio)$/i,Q=/<([\w:-]+)/,tt=/^$|\/(?:java|ecma)script/i,et=/^\s+/,rt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video";function nt(t){var e=rt.split("|"),r=t.createDocumentFragment();if(r.createElement)for(;e.length;)r.createElement(e.pop());return r}X=d.createElement("div"),Y=d.createDocumentFragment(),Z=d.createElement("input"),X.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",y.leadingWhitespace=3===X.firstChild.nodeType,y.tbody=!X.getElementsByTagName("tbody").length,y.htmlSerialize=!!X.getElementsByTagName("link").length,y.html5Clone="<:nav></:nav>"!==d.createElement("nav").cloneNode(!0).outerHTML,Z.type="checkbox",Z.checked=!0,Y.appendChild(Z),y.appendChecked=Z.checked,X.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!X.cloneNode(!0).lastChild.defaultValue,Y.appendChild(X),(Z=d.createElement("input")).setAttribute("type","radio"),Z.setAttribute("checked","checked"),Z.setAttribute("name","t"),X.appendChild(Z),y.checkClone=X.cloneNode(!0).cloneNode(!0).lastChild.checked,y.noCloneEvent=!!X.addEventListener,X[E.expando]=1,y.attributes=!X.getAttribute(E.expando);var it={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:y.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};function ot(t,e){var r,n,i=0,o=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):void 0;if(!o)for(o=[],r=t.childNodes||t;null!=(n=r[i]);i++)!e||E.nodeName(n,e)?o.push(n):E.merge(o,ot(n,e));return void 0===e||e&&E.nodeName(t,e)?E.merge([t],o):o}function at(t,e){for(var r,n=0;null!=(r=t[n]);n++)E._data(r,"globalEval",!e||E._data(e[n],"globalEval"))}it.optgroup=it.option,it.tbody=it.tfoot=it.colgroup=it.caption=it.thead,it.th=it.td;var st=/<|&#?\w+;/,ut=/<tbody/i;function ct(t){J.test(t.type)&&(t.defaultChecked=t.checked)}function lt(t,e,r,n,i){for(var o,a,s,u,c,l,h,p=t.length,f=nt(e),d=[],m=0;m<p;m++)if((a=t[m])||0===a)if("object"===E.type(a))E.merge(d,a.nodeType?[a]:a);else if(st.test(a)){for(u=u||f.appendChild(e.createElement("div")),c=(Q.exec(a)||["",""])[1].toLowerCase(),h=it[c]||it._default,u.innerHTML=h[1]+E.htmlPrefilter(a)+h[2],o=h[0];o--;)u=u.lastChild;if(!y.leadingWhitespace&&et.test(a)&&d.push(e.createTextNode(et.exec(a)[0])),!y.tbody)for(o=(a="table"!==c||ut.test(a)?"<table>"!==h[1]||ut.test(a)?0:u:u.firstChild)&&a.childNodes.length;o--;)E.nodeName(l=a.childNodes[o],"tbody")&&!l.childNodes.length&&a.removeChild(l);for(E.merge(d,u.childNodes),u.textContent="";u.firstChild;)u.removeChild(u.firstChild);u=f.lastChild}else d.push(e.createTextNode(a));for(u&&f.removeChild(u),y.appendChecked||E.grep(ot(d,"input"),ct),m=0;a=d[m++];)if(n&&-1<E.inArray(a,n))i&&i.push(a);else if(s=E.contains(a.ownerDocument,a),u=ot(f.appendChild(a),"script"),s&&at(u),r)for(o=0;a=u[o++];)tt.test(a.type||"")&&r.push(a);return u=null,f}!function(){var t,e,r=d.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})e="on"+t,(y[t]=e in S)||(r.setAttribute(e,"t"),y[t]=!1===r.attributes[e].expando);r=null}();var ht=/^(?:input|select|textarea)$/i,pt=/^key/,ft=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,dt=/^(?:focusinfocus|focusoutblur)$/,mt=/^([^.]*)(?:\.(.+)|)/;function gt(){return!0}function yt(){return!1}function vt(){try{return d.activeElement}catch(t){}}function _t(t,e,r,n,i,o){var a,s;if("object"==typeof e){for(s in"string"!=typeof r&&(n=n||r,r=void 0),e)_t(t,s,r,n,e[s],o);return t}if(null==n&&null==i?(i=r,n=r=void 0):null==i&&("string"==typeof r?(i=n,n=void 0):(i=n,n=r,r=void 0)),!1===i)i=yt;else if(!i)return t;return 1===o&&(a=i,(i=function(t){return E().off(t),a.apply(this,arguments)}).guid=a.guid||(a.guid=E.guid++)),t.each(function(){E.event.add(this,e,i,n,r)})}E.event={global:{},add:function(t,e,r,n,i){var o,a,s,u,c,l,h,p,f,d,m,g=E._data(t);if(g){for(r.handler&&(r=(u=r).handler,i=u.selector),r.guid||(r.guid=E.guid++),(a=g.events)||(a=g.events={}),(l=g.handle)||((l=g.handle=function(t){return void 0===E||t&&E.event.triggered===t.type?void 0:E.event.dispatch.apply(l.elem,arguments)}).elem=t),s=(e=(e||"").match(L)||[""]).length;s--;)f=m=(o=mt.exec(e[s])||[])[1],d=(o[2]||"").split(".").sort(),f&&(c=E.event.special[f]||{},f=(i?c.delegateType:c.bindType)||f,c=E.event.special[f]||{},h=E.extend({type:f,origType:m,data:n,handler:r,guid:r.guid,selector:i,needsContext:i&&E.expr.match.needsContext.test(i),namespace:d.join(".")},u),(p=a[f])||((p=a[f]=[]).delegateCount=0,c.setup&&!1!==c.setup.call(t,n,d,l)||(t.addEventListener?t.addEventListener(f,l,!1):t.attachEvent&&t.attachEvent("on"+f,l))),c.add&&(c.add.call(t,h),h.handler.guid||(h.handler.guid=r.guid)),i?p.splice(p.delegateCount++,0,h):p.push(h),E.event.global[f]=!0);t=null}},remove:function(t,e,r,n,i){var o,a,s,u,c,l,h,p,f,d,m,g=E.hasData(t)&&E._data(t);if(g&&(l=g.events)){for(c=(e=(e||"").match(L)||[""]).length;c--;)if(f=m=(s=mt.exec(e[c])||[])[1],d=(s[2]||"").split(".").sort(),f){for(h=E.event.special[f]||{},p=l[f=(n?h.delegateType:h.bindType)||f]||[],s=s[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=o=p.length;o--;)a=p[o],!i&&m!==a.origType||r&&r.guid!==a.guid||s&&!s.test(a.namespace)||n&&n!==a.selector&&("**"!==n||!a.selector)||(p.splice(o,1),a.selector&&p.delegateCount--,h.remove&&h.remove.call(t,a));u&&!p.length&&(h.teardown&&!1!==h.teardown.call(t,d,g.handle)||E.removeEvent(t,f,g.handle),delete l[f])}else for(f in l)E.event.remove(t,f+e[c],r,n,!0);E.isEmptyObject(l)&&(delete g.handle,E._removeData(t,"events"))}},trigger:function(t,e,r,n){var i,o,a,s,u,c,l,h=[r||d],p=g.call(t,"type")?t.type:t,f=g.call(t,"namespace")?t.namespace.split("."):[];if(a=c=r=r||d,3!==r.nodeType&&8!==r.nodeType&&!dt.test(p+E.event.triggered)&&(-1<p.indexOf(".")&&(p=(f=p.split(".")).shift(),f.sort()),o=p.indexOf(":")<0&&"on"+p,(t=t[E.expando]?t:new E.Event(p,"object"==typeof t&&t)).isTrigger=n?2:3,t.namespace=f.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),e=null==e?[t]:E.makeArray(e,[t]),u=E.event.special[p]||{},n||!u.trigger||!1!==u.trigger.apply(r,e))){if(!n&&!u.noBubble&&!E.isWindow(r)){for(s=u.delegateType||p,dt.test(s+p)||(a=a.parentNode);a;a=a.parentNode)h.push(a),c=a;c===(r.ownerDocument||d)&&h.push(c.defaultView||c.parentWindow||S)}for(l=0;(a=h[l++])&&!t.isPropagationStopped();)t.type=1<l?s:u.bindType||p,(i=(E._data(a,"events")||{})[t.type]&&E._data(a,"handle"))&&i.apply(a,e),(i=o&&a[o])&&i.apply&&k(a)&&(t.result=i.apply(a,e),!1===t.result&&t.preventDefault());if(t.type=p,!n&&!t.isDefaultPrevented()&&(!u._default||!1===u._default.apply(h.pop(),e))&&k(r)&&o&&r[p]&&!E.isWindow(r)){(c=r[o])&&(r[o]=null),E.event.triggered=p;try{r[p]()}catch(t){}E.event.triggered=void 0,c&&(r[o]=c)}return t.result}},dispatch:function(t){t=E.event.fix(t);var e,r,n,i,o,a,s=l.call(arguments),u=(E._data(this,"events")||{})[t.type]||[],c=E.event.special[t.type]||{};if((s[0]=t).delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,t)){for(a=E.event.handlers.call(this,t,u),e=0;(i=a[e++])&&!t.isPropagationStopped();)for(t.currentTarget=i.elem,r=0;(o=i.handlers[r++])&&!t.isImmediatePropagationStopped();)t.rnamespace&&!t.rnamespace.test(o.namespace)||(t.handleObj=o,t.data=o.data,void 0!==(n=((E.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(t.result=n)&&(t.preventDefault(),t.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,t),t.result}},handlers:function(t,e){var r,n,i,o,a=[],s=e.delegateCount,u=t.target;if(s&&u.nodeType&&("click"!==t.type||isNaN(t.button)||t.button<1))for(;u!=this;u=u.parentNode||this)if(1===u.nodeType&&(!0!==u.disabled||"click"!==t.type)){for(n=[],r=0;r<s;r++)void 0===n[i=(o=e[r]).selector+" "]&&(n[i]=o.needsContext?-1<E(i,this).index(u):E.find(i,this,null,[u]).length),n[i]&&n.push(o);n.length&&a.push({elem:u,handlers:n})}return s<e.length&&a.push({elem:this,handlers:e.slice(s)}),a},fix:function(t){if(t[E.expando])return t;var e,r,n,i=t.type,o=t,a=this.fixHooks[i];for(a||(this.fixHooks[i]=a=ft.test(i)?this.mouseHooks:pt.test(i)?this.keyHooks:{}),n=a.props?this.props.concat(a.props):this.props,t=new E.Event(o),e=n.length;e--;)t[r=n[e]]=o[r];return t.target||(t.target=o.srcElement||d),3===t.target.nodeType&&(t.target=t.target.parentNode),t.metaKey=!!t.metaKey,a.filter?a.filter(t,o):t},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var r,n,i,o=e.button,a=e.fromElement;return null==t.pageX&&null!=e.clientX&&(i=(n=t.target.ownerDocument||d).documentElement,r=n.body,t.pageX=e.clientX+(i&&i.scrollLeft||r&&r.scrollLeft||0)-(i&&i.clientLeft||r&&r.clientLeft||0),t.pageY=e.clientY+(i&&i.scrollTop||r&&r.scrollTop||0)-(i&&i.clientTop||r&&r.clientTop||0)),!t.relatedTarget&&a&&(t.relatedTarget=a===t.target?e.toElement:a),t.which||void 0===o||(t.which=1&o?1:2&o?3:4&o?2:0),t}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==vt()&&this.focus)try{return this.focus(),!1}catch(t){}},delegateType:"focusin"},blur:{trigger:function(){if(this===vt()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(E.nodeName(this,"input")&&"checkbox"===this.type&&this.click)return this.click(),!1},_default:function(t){return E.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}},simulate:function(t,e,r){var n=E.extend(new E.Event,r,{type:t,isSimulated:!0});E.event.trigger(n,null,e),n.isDefaultPrevented()&&r.preventDefault()}},E.removeEvent=d.removeEventListener?function(t,e,r){t.removeEventListener&&t.removeEventListener(e,r)}:function(t,e,r){var n="on"+e;t.detachEvent&&(void 0===t[n]&&(t[n]=null),t.detachEvent(n,r))},E.Event=function(t,e){if(!(this instanceof E.Event))return new E.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?gt:yt):this.type=t,e&&E.extend(this,e),this.timeStamp=t&&t.timeStamp||E.now(),this[E.expando]=!0},E.Event.prototype={constructor:E.Event,isDefaultPrevented:yt,isPropagationStopped:yt,isImmediatePropagationStopped:yt,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=gt,t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=gt,t&&!this.isSimulated&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=gt,t&&t.stopImmediatePropagation&&t.stopImmediatePropagation(),this.stopPropagation()}},E.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,i){E.event.special[t]={delegateType:i,bindType:i,handle:function(t){var e,r=t.relatedTarget,n=t.handleObj;return r&&(r===this||E.contains(this,r))||(t.type=n.origType,e=n.handler.apply(this,arguments),t.type=i),e}}}),y.submit||(E.event.special.submit={setup:function(){if(E.nodeName(this,"form"))return!1;E.event.add(this,"click._submit keypress._submit",function(t){var e=t.target,r=E.nodeName(e,"input")||E.nodeName(e,"button")?E.prop(e,"form"):void 0;r&&!E._data(r,"submit")&&(E.event.add(r,"submit._submit",function(t){t._submitBubble=!0}),E._data(r,"submit",!0))})},postDispatch:function(t){t._submitBubble&&(delete t._submitBubble,this.parentNode&&!t.isTrigger&&E.event.simulate("submit",this.parentNode,t))},teardown:function(){if(E.nodeName(this,"form"))return!1;E.event.remove(this,"._submit")}}),y.change||(E.event.special.change={setup:function(){if(ht.test(this.nodeName))return"checkbox"!==this.type&&"radio"!==this.type||(E.event.add(this,"propertychange._change",function(t){"checked"===t.originalEvent.propertyName&&(this._justChanged=!0)}),E.event.add(this,"click._change",function(t){this._justChanged&&!t.isTrigger&&(this._justChanged=!1),E.event.simulate("change",this,t)})),!1;E.event.add(this,"beforeactivate._change",function(t){var e=t.target;ht.test(e.nodeName)&&!E._data(e,"change")&&(E.event.add(e,"change._change",function(t){!this.parentNode||t.isSimulated||t.isTrigger||E.event.simulate("change",this.parentNode,t)}),E._data(e,"change",!0))})},handle:function(t){var e=t.target;if(this!==e||t.isSimulated||t.isTrigger||"radio"!==e.type&&"checkbox"!==e.type)return t.handleObj.handler.apply(this,arguments)},teardown:function(){return E.event.remove(this,"._change"),!ht.test(this.nodeName)}}),y.focusin||E.each({focus:"focusin",blur:"focusout"},function(r,n){function i(t){E.event.simulate(n,t.target,E.event.fix(t))}E.event.special[n]={setup:function(){var t=this.ownerDocument||this,e=E._data(t,n);e||t.addEventListener(r,i,!0),E._data(t,n,(e||0)+1)},teardown:function(){var t=this.ownerDocument||this,e=E._data(t,n)-1;e?E._data(t,n,e):(t.removeEventListener(r,i,!0),E._removeData(t,n))}}}),E.fn.extend({on:function(t,e,r,n){return _t(this,t,e,r,n)},one:function(t,e,r,n){return _t(this,t,e,r,n,1)},off:function(t,e,r){var n,i;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,E(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"!=typeof t)return!1!==e&&"function"!=typeof e||(r=e,e=void 0),!1===r&&(r=yt),this.each(function(){E.event.remove(this,t,r,e)});for(i in t)this.off(i,e,t[i]);return this},trigger:function(t,e){return this.each(function(){E.event.trigger(t,e,this)})},triggerHandler:function(t,e){var r=this[0];if(r)return E.event.trigger(t,e,r,!0)}});var bt=/ jQuery\d+="(?:null|\d+)"/g,xt=new RegExp("<(?:"+rt+")[\\s/>]","i"),wt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,St=/<script|<style|<link/i,Et=/checked\s*(?:[^=]|=\s*.checked.)/i,Ct=/^true\/(.*)/,Mt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Tt=nt(d).appendChild(d.createElement("div"));function Pt(t,e){return E.nodeName(t,"table")&&E.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function Ot(t){return t.type=(null!==E.find.attr(t,"type"))+"/"+t.type,t}function At(t){var e=Ct.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function It(t,e){if(1===e.nodeType&&E.hasData(t)){var r,n,i,o=E._data(t),a=E._data(e,o),s=o.events;if(s)for(r in delete a.handle,a.events={},s)for(n=0,i=s[r].length;n<i;n++)E.event.add(e,r,s[r][n]);a.data&&(a.data=E.extend({},a.data))}}function Lt(t,e){var r,n,i;if(1===e.nodeType){if(r=e.nodeName.toLowerCase(),!y.noCloneEvent&&e[E.expando]){for(n in(i=E._data(e)).events)E.removeEvent(e,n,i.handle);e.removeAttribute(E.expando)}"script"===r&&e.text!==t.text?(Ot(e).text=t.text,At(e)):"object"===r?(e.parentNode&&(e.outerHTML=t.outerHTML),y.html5Clone&&t.innerHTML&&!E.trim(e.innerHTML)&&(e.innerHTML=t.innerHTML)):"input"===r&&J.test(t.type)?(e.defaultChecked=e.checked=t.checked,e.value!==t.value&&(e.value=t.value)):"option"===r?e.defaultSelected=e.selected=t.defaultSelected:"input"!==r&&"textarea"!==r||(e.defaultValue=t.defaultValue)}}function Rt(r,n,i,o){n=m.apply([],n);var t,e,a,s,u,c,l=0,h=r.length,p=h-1,f=n[0],d=E.isFunction(f);if(d||1<h&&"string"==typeof f&&!y.checkClone&&Et.test(f))return r.each(function(t){var e=r.eq(t);d&&(n[0]=f.call(this,t,e.html())),Rt(e,n,i,o)});if(h&&(t=(c=lt(n,r[0].ownerDocument,!1,r,o)).firstChild,1===c.childNodes.length&&(c=t),t||o)){for(a=(s=E.map(ot(c,"script"),Ot)).length;l<h;l++)e=c,l!==p&&(e=E.clone(e,!0,!0),a&&E.merge(s,ot(e,"script"))),i.call(r[l],e,l);if(a)for(u=s[s.length-1].ownerDocument,E.map(s,At),l=0;l<a;l++)e=s[l],tt.test(e.type||"")&&!E._data(e,"globalEval")&&E.contains(u,e)&&(e.src?E._evalUrl&&E._evalUrl(e.src):E.globalEval((e.text||e.textContent||e.innerHTML||"").replace(Mt,"")));c=t=null}return r}function Nt(t,e,r){for(var n,i=e?E.filter(e,t):t,o=0;null!=(n=i[o]);o++)r||1!==n.nodeType||E.cleanData(ot(n)),n.parentNode&&(r&&E.contains(n.ownerDocument,n)&&at(ot(n,"script")),n.parentNode.removeChild(n));return t}E.extend({htmlPrefilter:function(t){return t.replace(wt,"<$1></$2>")},clone:function(t,e,r){var n,i,o,a,s,u=E.contains(t.ownerDocument,t);if(y.html5Clone||E.isXMLDoc(t)||!xt.test("<"+t.nodeName+">")?o=t.cloneNode(!0):(Tt.innerHTML=t.outerHTML,Tt.removeChild(o=Tt.firstChild)),!(y.noCloneEvent&&y.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||E.isXMLDoc(t)))for(n=ot(o),s=ot(t),a=0;null!=(i=s[a]);++a)n[a]&&Lt(i,n[a]);if(e)if(r)for(s=s||ot(t),n=n||ot(o),a=0;null!=(i=s[a]);a++)It(i,n[a]);else It(t,o);return 0<(n=ot(o,"script")).length&&at(n,!u&&ot(t,"script")),n=s=i=null,o},cleanData:function(t,e){for(var r,n,i,o,a=0,s=E.expando,u=E.cache,c=y.attributes,l=E.event.special;null!=(r=t[a]);a++)if((e||k(r))&&(o=(i=r[s])&&u[i])){if(o.events)for(n in o.events)l[n]?E.event.remove(r,n):E.removeEvent(r,n,o.handle);u[i]&&(delete u[i],c||void 0===r.removeAttribute?r[s]=void 0:r.removeAttribute(s),h.push(i))}}}),E.fn.extend({domManip:Rt,detach:function(t){return Nt(this,t,!0)},remove:function(t){return Nt(this,t)},text:function(t){return K(this,function(t){return void 0===t?E.text(this):this.empty().append((this[0]&&this[0].ownerDocument||d).createTextNode(t))},null,t,arguments.length)},append:function(){return Rt(this,arguments,function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Pt(this,t).appendChild(t)})},prepend:function(){return Rt(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=Pt(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return Rt(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return Rt(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,e=0;null!=(t=this[e]);e++){for(1===t.nodeType&&E.cleanData(ot(t,!1));t.firstChild;)t.removeChild(t.firstChild);t.options&&E.nodeName(t,"select")&&(t.options.length=0)}return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return E.clone(this,t,e)})},html:function(t){return K(this,function(t){var e=this[0]||{},r=0,n=this.length;if(void 0===t)return 1===e.nodeType?e.innerHTML.replace(bt,""):void 0;if("string"==typeof t&&!St.test(t)&&(y.htmlSerialize||!xt.test(t))&&(y.leadingWhitespace||!et.test(t))&&!it[(Q.exec(t)||["",""])[1].toLowerCase()]){t=E.htmlPrefilter(t);try{for(;r<n;r++)1===(e=this[r]||{}).nodeType&&(E.cleanData(ot(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var r=[];return Rt(this,arguments,function(t){var e=this.parentNode;E.inArray(this,r)<0&&(E.cleanData(ot(this)),e&&e.replaceChild(t,this))},r)}}),E.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,a){E.fn[t]=function(t){for(var e,r=0,n=[],i=E(t),o=i.length-1;r<=o;r++)e=r===o?this:this.clone(!0),E(i[r])[a](e),s.apply(n,e.get());return this.pushStack(n)}});var kt,Dt={HTML:"block",BODY:"block"};function jt(t,e){var r=E(e.createElement(t)).appendTo(e.body),n=E.css(r[0],"display");return r.detach(),n}function zt(t){var e=d,r=Dt[t];return r||("none"!==(r=jt(t,e))&&r||((e=((kt=(kt||E("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement))[0].contentWindow||kt[0].contentDocument).document).write(),e.close(),r=jt(t,e),kt.detach()),Dt[t]=r),r}function Ft(t,e,r,n){var i,o,a={};for(o in e)a[o]=t.style[o],t.style[o]=e[o];for(o in i=r.apply(t,n||[]),e)t.style[o]=a[o];return i}var Bt,Ut,Vt,Gt,qt,Ht,$t,Wt,Xt=/^margin/,Yt=new RegExp("^("+q+")(?!px)[a-z%]+$","i"),Zt=d.documentElement;function Kt(){var t,e,r=d.documentElement;r.appendChild($t),Wt.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",Bt=Vt=Ht=!1,Ut=qt=!0,S.getComputedStyle&&(e=S.getComputedStyle(Wt),Bt="1%"!==(e||{}).top,Ht="2px"===(e||{}).marginLeft,Vt="4px"===(e||{width:"4px"}).width,Wt.style.marginRight="50%",Ut="4px"===(e||{marginRight:"4px"}).marginRight,(t=Wt.appendChild(d.createElement("div"))).style.cssText=Wt.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",t.style.marginRight=t.style.width="0",Wt.style.width="1px",qt=!parseFloat((S.getComputedStyle(t)||{}).marginRight),Wt.removeChild(t)),Wt.style.display="none",(Gt=0===Wt.getClientRects().length)&&(Wt.style.display="",Wt.innerHTML="<table><tr><td></td><td>t</td></tr></table>",Wt.childNodes[0].style.borderCollapse="separate",(t=Wt.getElementsByTagName("td"))[0].style.cssText="margin:0;border:0;padding:0;display:none",(Gt=0===t[0].offsetHeight)&&(t[0].style.display="",t[1].style.display="none",Gt=0===t[0].offsetHeight)),r.removeChild($t)}$t=d.createElement("div"),(Wt=d.createElement("div")).style&&(Wt.style.cssText="float:left;opacity:.5",y.opacity="0.5"===Wt.style.opacity,y.cssFloat=!!Wt.style.cssFloat,Wt.style.backgroundClip="content-box",Wt.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===Wt.style.backgroundClip,($t=d.createElement("div")).style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",Wt.innerHTML="",$t.appendChild(Wt),y.boxSizing=""===Wt.style.boxSizing||""===Wt.style.MozBoxSizing||""===Wt.style.WebkitBoxSizing,E.extend(y,{reliableHiddenOffsets:function(){return null==Bt&&Kt(),Gt},boxSizingReliable:function(){return null==Bt&&Kt(),Vt},pixelMarginRight:function(){return null==Bt&&Kt(),Ut},pixelPosition:function(){return null==Bt&&Kt(),Bt},reliableMarginRight:function(){return null==Bt&&Kt(),qt},reliableMarginLeft:function(){return null==Bt&&Kt(),Ht}}));var Jt,Qt,te=/^(top|right|bottom|left)$/;function ee(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}S.getComputedStyle?(Jt=function(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=S),e.getComputedStyle(t)},Qt=function(t,e,r){var n,i,o,a,s=t.style;return""!==(a=(r=r||Jt(t))?r.getPropertyValue(e)||r[e]:void 0)&&void 0!==a||E.contains(t.ownerDocument,t)||(a=E.style(t,e)),r&&!y.pixelMarginRight()&&Yt.test(a)&&Xt.test(e)&&(n=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=r.width,s.width=n,s.minWidth=i,s.maxWidth=o),void 0===a?a:a+""}):Zt.currentStyle&&(Jt=function(t){return t.currentStyle},Qt=function(t,e,r){var n,i,o,a,s=t.style;return null==(a=(r=r||Jt(t))?r[e]:void 0)&&s&&s[e]&&(a=s[e]),Yt.test(a)&&!te.test(e)&&(n=s.left,(o=(i=t.runtimeStyle)&&i.left)&&(i.left=t.currentStyle.left),s.left="fontSize"===e?"1em":a,a=s.pixelLeft+"px",s.left=n,o&&(i.left=o)),void 0===a?a:a+""||"auto"});var re=/alpha\([^)]*\)/i,ne=/opacity\s*=\s*([^)]*)/i,ie=/^(none|table(?!-c[ea]).+)/,oe=new RegExp("^("+q+")(.*)$","i"),ae={position:"absolute",visibility:"hidden",display:"block"},se={letterSpacing:"0",fontWeight:"400"},ue=["Webkit","O","Moz","ms"],ce=d.createElement("div").style;function le(t){if(t in ce)return t;for(var e=t.charAt(0).toUpperCase()+t.slice(1),r=ue.length;r--;)if((t=ue[r]+e)in ce)return t}function he(t,e){for(var r,n,i,o=[],a=0,s=t.length;a<s;a++)(n=t[a]).style&&(o[a]=E._data(n,"olddisplay"),r=n.style.display,e?(o[a]||"none"!==r||(n.style.display=""),""===n.style.display&&G(n)&&(o[a]=E._data(n,"olddisplay",zt(n.nodeName)))):(i=G(n),(r&&"none"!==r||!i)&&E._data(n,"olddisplay",i?r:E.css(n,"display"))));for(a=0;a<s;a++)(n=t[a]).style&&(e&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=e?o[a]||"":"none"));return t}function pe(t,e,r){var n=oe.exec(e);return n?Math.max(0,n[1]-(r||0))+(n[2]||"px"):e}function fe(t,e,r,n,i){for(var o=r===(n?"border":"content")?4:"width"===e?1:0,a=0;o<4;o+=2)"margin"===r&&(a+=E.css(t,r+$[o],!0,i)),n?("content"===r&&(a-=E.css(t,"padding"+$[o],!0,i)),"margin"!==r&&(a-=E.css(t,"border"+$[o]+"Width",!0,i))):(a+=E.css(t,"padding"+$[o],!0,i),"padding"!==r&&(a+=E.css(t,"border"+$[o]+"Width",!0,i)));return a}function de(t,e,r){var n=!0,i="width"===e?t.offsetWidth:t.offsetHeight,o=Jt(t),a=y.boxSizing&&"border-box"===E.css(t,"boxSizing",!1,o);if(i<=0||null==i){if(((i=Qt(t,e,o))<0||null==i)&&(i=t.style[e]),Yt.test(i))return i;n=a&&(y.boxSizingReliable()||i===t.style[e]),i=parseFloat(i)||0}return i+fe(t,e,r||(a?"border":"content"),n,o)+"px"}function me(t,e,r,n,i){return new me.prototype.init(t,e,r,n,i)}E.extend({cssHooks:{opacity:{get:function(t,e){if(e){var r=Qt(t,"opacity");return""===r?"1":r}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:y.cssFloat?"cssFloat":"styleFloat"},style:function(t,e,r,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var i,o,a,s=E.camelCase(e),u=t.style;if(e=E.cssProps[s]||(E.cssProps[s]=le(s)||s),a=E.cssHooks[e]||E.cssHooks[s],void 0===r)return a&&"get"in a&&void 0!==(i=a.get(t,!1,n))?i:u[e];if("string"===(o=typeof r)&&(i=H.exec(r))&&i[1]&&(r=W(t,e,i),o="number"),null!=r&&r==r&&("number"===o&&(r+=i&&i[3]||(E.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==r||0!==e.indexOf("background")||(u[e]="inherit"),!(a&&"set"in a&&void 0===(r=a.set(t,r,n)))))try{u[e]=r}catch(t){}}},css:function(t,e,r,n){var i,o,a,s=E.camelCase(e);return e=E.cssProps[s]||(E.cssProps[s]=le(s)||s),(a=E.cssHooks[e]||E.cssHooks[s])&&"get"in a&&(o=a.get(t,!0,r)),void 0===o&&(o=Qt(t,e,n)),"normal"===o&&e in se&&(o=se[e]),""===r||r?(i=parseFloat(o),!0===r||isFinite(i)?i||0:o):o}}),E.each(["height","width"],function(t,i){E.cssHooks[i]={get:function(t,e,r){if(e)return ie.test(E.css(t,"display"))&&0===t.offsetWidth?Ft(t,ae,function(){return de(t,i,r)}):de(t,i,r)},set:function(t,e,r){var n=r&&Jt(t);return pe(0,e,r?fe(t,i,r,y.boxSizing&&"border-box"===E.css(t,"boxSizing",!1,n),n):0)}}}),y.opacity||(E.cssHooks.opacity={get:function(t,e){return ne.test((e&&t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":e?"1":""},set:function(t,e){var r=t.style,n=t.currentStyle,i=E.isNumeric(e)?"alpha(opacity="+100*e+")":"",o=n&&n.filter||r.filter||"";((r.zoom=1)<=e||""===e)&&""===E.trim(o.replace(re,""))&&r.removeAttribute&&(r.removeAttribute("filter"),""===e||n&&!n.filter)||(r.filter=re.test(o)?o.replace(re,i):o+" "+i)}}),E.cssHooks.marginRight=ee(y.reliableMarginRight,function(t,e){if(e)return Ft(t,{display:"inline-block"},Qt,[t,"marginRight"])}),E.cssHooks.marginLeft=ee(y.reliableMarginLeft,function(t,e){if(e)return(parseFloat(Qt(t,"marginLeft"))||(E.contains(t.ownerDocument,t)?t.getBoundingClientRect().left-Ft(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}):0))+"px"}),E.each({margin:"",padding:"",border:"Width"},function(i,o){E.cssHooks[i+o]={expand:function(t){for(var e=0,r={},n="string"==typeof t?t.split(" "):[t];e<4;e++)r[i+$[e]+o]=n[e]||n[e-2]||n[0];return r}},Xt.test(i)||(E.cssHooks[i+o].set=pe)}),E.fn.extend({css:function(t,e){return K(this,function(t,e,r){var n,i,o={},a=0;if(E.isArray(e)){for(n=Jt(t),i=e.length;a<i;a++)o[e[a]]=E.css(t,e[a],!1,n);return o}return void 0!==r?E.style(t,e,r):E.css(t,e)},t,e,1<arguments.length)},show:function(){return he(this,!0)},hide:function(){return he(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){G(this)?E(this).show():E(this).hide()})}}),((E.Tween=me).prototype={constructor:me,init:function(t,e,r,n,i,o){this.elem=t,this.prop=r,this.easing=i||E.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=o||(E.cssNumber[r]?"":"px")},cur:function(){var t=me.propHooks[this.prop];return t&&t.get?t.get(this):me.propHooks._default.get(this)},run:function(t){var e,r=me.propHooks[this.prop];return this.options.duration?this.pos=e=E.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):me.propHooks._default.set(this),this}}).init.prototype=me.prototype,(me.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=E.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){E.fx.step[t.prop]?E.fx.step[t.prop](t):1!==t.elem.nodeType||null==t.elem.style[E.cssProps[t.prop]]&&!E.cssHooks[t.prop]?t.elem[t.prop]=t.now:E.style(t.elem,t.prop,t.now+t.unit)}}}).scrollTop=me.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},E.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},E.fx=me.prototype.init,E.fx.step={};var ge,ye,ve,_e,be,xe,we,Se=/^(?:toggle|show|hide)$/,Ee=/queueHooks$/;function Ce(){return S.setTimeout(function(){ge=void 0}),ge=E.now()}function Me(t,e){var r,n={height:t},i=0;for(e=e?1:0;i<4;i+=2-e)n["margin"+(r=$[i])]=n["padding"+r]=t;return e&&(n.opacity=n.width=t),n}function Te(t,e,r){for(var n,i=(Pe.tweeners[e]||[]).concat(Pe.tweeners["*"]),o=0,a=i.length;o<a;o++)if(n=i[o].call(r,e,t))return n}function Pe(o,t,e){var r,a,n=0,i=Pe.prefilters.length,s=E.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var t=ge||Ce(),e=Math.max(0,c.startTime+c.duration-t),r=1-(e/c.duration||0),n=0,i=c.tweens.length;n<i;n++)c.tweens[n].run(r);return s.notifyWith(o,[c,r,e]),r<1&&i?e:(s.resolveWith(o,[c]),!1)},c=s.promise({elem:o,props:E.extend({},t),opts:E.extend(!0,{specialEasing:{},easing:E.easing._default},e),originalProperties:t,originalOptions:e,startTime:ge||Ce(),duration:e.duration,tweens:[],createTween:function(t,e){var r=E.Tween(o,c.opts,t,e,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(r),r},stop:function(t){var e=0,r=t?c.tweens.length:0;if(a)return this;for(a=!0;e<r;e++)c.tweens[e].run(1);return t?(s.notifyWith(o,[c,1,0]),s.resolveWith(o,[c,t])):s.rejectWith(o,[c,t]),this}}),l=c.props;for(!function(t,e){var r,n,i,o,a;for(r in t)if(i=e[n=E.camelCase(r)],o=t[r],E.isArray(o)&&(i=o[1],o=t[r]=o[0]),r!==n&&(t[n]=o,delete t[r]),(a=E.cssHooks[n])&&"expand"in a)for(r in o=a.expand(o),delete t[n],o)r in t||(t[r]=o[r],e[r]=i);else e[n]=i}(l,c.opts.specialEasing);n<i;n++)if(r=Pe.prefilters[n].call(c,o,l,c.opts))return E.isFunction(r.stop)&&(E._queueHooks(c.elem,c.opts.queue).stop=E.proxy(r.stop,r)),r;return E.map(l,Te,c),E.isFunction(c.opts.start)&&c.opts.start.call(o,c),E.fx.timer(E.extend(u,{elem:o,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}E.Animation=E.extend(Pe,{tweeners:{"*":[function(t,e){var r=this.createTween(t,e);return W(r.elem,t,H.exec(e),r),r}]},tweener:function(t,e){for(var r,n=0,i=(t=E.isFunction(t)?(e=t,["*"]):t.match(L)).length;n<i;n++)r=t[n],Pe.tweeners[r]=Pe.tweeners[r]||[],Pe.tweeners[r].unshift(e)},prefilters:[function(e,t,r){var n,i,o,a,s,u,c,l=this,h={},p=e.style,f=e.nodeType&&G(e),d=E._data(e,"fxshow");for(n in r.queue||(null==(s=E._queueHooks(e,"fx")).unqueued&&(s.unqueued=0,u=s.empty.fire,s.empty.fire=function(){s.unqueued||u()}),s.unqueued++,l.always(function(){l.always(function(){s.unqueued--,E.queue(e,"fx").length||s.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(r.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===("none"===(c=E.css(e,"display"))?E._data(e,"olddisplay")||zt(e.nodeName):c)&&"none"===E.css(e,"float")&&(y.inlineBlockNeedsLayout&&"inline"!==zt(e.nodeName)?p.zoom=1:p.display="inline-block")),r.overflow&&(p.overflow="hidden",y.shrinkWrapBlocks()||l.always(function(){p.overflow=r.overflow[0],p.overflowX=r.overflow[1],p.overflowY=r.overflow[2]})),t)if(i=t[n],Se.exec(i)){if(delete t[n],o=o||"toggle"===i,i===(f?"hide":"show")){if("show"!==i||!d||void 0===d[n])continue;f=!0}h[n]=d&&d[n]||E.style(e,n)}else c=void 0;if(E.isEmptyObject(h))"inline"===("none"===c?zt(e.nodeName):c)&&(p.display=c);else for(n in d?"hidden"in d&&(f=d.hidden):d=E._data(e,"fxshow",{}),o&&(d.hidden=!f),f?E(e).show():l.done(function(){E(e).hide()}),l.done(function(){var t;for(t in E._removeData(e,"fxshow"),h)E.style(e,t,h[t])}),h)a=Te(f?d[n]:0,n,l),n in d||(d[n]=a.start,f&&(a.end=a.start,a.start="width"===n||"height"===n?1:0))}],prefilter:function(t,e){e?Pe.prefilters.unshift(t):Pe.prefilters.push(t)}}),E.speed=function(t,e,r){var n=t&&"object"==typeof t?E.extend({},t):{complete:r||!r&&e||E.isFunction(t)&&t,duration:t,easing:r&&e||e&&!E.isFunction(e)&&e};return n.duration=E.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in E.fx.speeds?E.fx.speeds[n.duration]:E.fx.speeds._default,null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){E.isFunction(n.old)&&n.old.call(this),n.queue&&E.dequeue(this,n.queue)},n},E.fn.extend({fadeTo:function(t,e,r,n){return this.filter(G).css("opacity",0).show().end().animate({opacity:e},t,r,n)},animate:function(e,t,r,n){function i(){var t=Pe(this,E.extend({},e),a);(o||E._data(this,"finish"))&&t.stop(!0)}var o=E.isEmptyObject(e),a=E.speed(t,r,n);return i.finish=i,o||!1===a.queue?this.each(i):this.queue(a.queue,i)},stop:function(i,t,o){function a(t){var e=t.stop;delete t.stop,e(o)}return"string"!=typeof i&&(o=t,t=i,i=void 0),t&&!1!==i&&this.queue(i||"fx",[]),this.each(function(){var t=!0,e=null!=i&&i+"queueHooks",r=E.timers,n=E._data(this);if(e)n[e]&&n[e].stop&&a(n[e]);else for(e in n)n[e]&&n[e].stop&&Ee.test(e)&&a(n[e]);for(e=r.length;e--;)r[e].elem!==this||null!=i&&r[e].queue!==i||(r[e].anim.stop(o),t=!1,r.splice(e,1));!t&&o||E.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var t,e=E._data(this),r=e[a+"queue"],n=e[a+"queueHooks"],i=E.timers,o=r?r.length:0;for(e.finish=!0,E.queue(this,a,[]),n&&n.stop&&n.stop.call(this,!0),t=i.length;t--;)i[t].elem===this&&i[t].queue===a&&(i[t].anim.stop(!0),i.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete e.finish})}}),E.each(["toggle","show","hide"],function(t,n){var i=E.fn[n];E.fn[n]=function(t,e,r){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(Me(n,!0),t,e,r)}}),E.each({slideDown:Me("show"),slideUp:Me("hide"),slideToggle:Me("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,n){E.fn[t]=function(t,e,r){return this.animate(n,t,e,r)}}),E.timers=[],E.fx.tick=function(){var t,e=E.timers,r=0;for(ge=E.now();r<e.length;r++)(t=e[r])()||e[r]!==t||e.splice(r--,1);e.length||E.fx.stop(),ge=void 0},E.fx.timer=function(t){E.timers.push(t),t()?E.fx.start():E.timers.pop()},E.fx.interval=13,E.fx.start=function(){ye=ye||S.setInterval(E.fx.tick,E.fx.interval)},E.fx.stop=function(){S.clearInterval(ye),ye=null},E.fx.speeds={slow:600,fast:200,_default:400},E.fn.delay=function(n,t){return n=E.fx&&E.fx.speeds[n]||n,t=t||"fx",this.queue(t,function(t,e){var r=S.setTimeout(t,n);e.stop=function(){S.clearTimeout(r)}})},_e=d.createElement("input"),be=d.createElement("div"),xe=d.createElement("select"),we=xe.appendChild(d.createElement("option")),(be=d.createElement("div")).setAttribute("className","t"),be.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",ve=be.getElementsByTagName("a")[0],_e.setAttribute("type","checkbox"),be.appendChild(_e),(ve=be.getElementsByTagName("a")[0]).style.cssText="top:1px",y.getSetAttribute="t"!==be.className,y.style=/top/.test(ve.getAttribute("style")),y.hrefNormalized="/a"===ve.getAttribute("href"),y.checkOn=!!_e.value,y.optSelected=we.selected,y.enctype=!!d.createElement("form").enctype,xe.disabled=!0,y.optDisabled=!we.disabled,(_e=d.createElement("input")).setAttribute("value",""),y.input=""===_e.getAttribute("value"),_e.value="t",_e.setAttribute("type","radio"),y.radioValue="t"===_e.value;var Oe=/\r/g,Ae=/[\x20\t\r\n\f]+/g;E.fn.extend({val:function(r){var n,t,i,e=this[0];return arguments.length?(i=E.isFunction(r),this.each(function(t){var e;1===this.nodeType&&(null==(e=i?r.call(this,t,E(this).val()):r)?e="":"number"==typeof e?e+="":E.isArray(e)&&(e=E.map(e,function(t){return null==t?"":t+""})),(n=E.valHooks[this.type]||E.valHooks[this.nodeName.toLowerCase()])&&"set"in n&&void 0!==n.set(this,e,"value")||(this.value=e))})):e?(n=E.valHooks[e.type]||E.valHooks[e.nodeName.toLowerCase()])&&"get"in n&&void 0!==(t=n.get(e,"value"))?t:"string"==typeof(t=e.value)?t.replace(Oe,""):null==t?"":t:void 0}}),E.extend({valHooks:{option:{get:function(t){var e=E.find.attr(t,"value");return null!=e?e:E.trim(E.text(t)).replace(Ae," ")}},select:{get:function(t){for(var e,r,n=t.options,i=t.selectedIndex,o="select-one"===t.type||i<0,a=o?null:[],s=o?i+1:n.length,u=i<0?s:o?i:0;u<s;u++)if(((r=n[u]).selected||u===i)&&(y.optDisabled?!r.disabled:null===r.getAttribute("disabled"))&&(!r.parentNode.disabled||!E.nodeName(r.parentNode,"optgroup"))){if(e=E(r).val(),o)return e;a.push(e)}return a},set:function(t,e){for(var r,n,i=t.options,o=E.makeArray(e),a=i.length;a--;)if(n=i[a],-1<E.inArray(E.valHooks.option.get(n),o))try{n.selected=r=!0}catch(t){n.scrollHeight}else n.selected=!1;return r||(t.selectedIndex=-1),i}}}}),E.each(["radio","checkbox"],function(){E.valHooks[this]={set:function(t,e){if(E.isArray(e))return t.checked=-1<E.inArray(E(t).val(),e)}},y.checkOn||(E.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var Ie,Le,Re=E.expr.attrHandle,Ne=/^(?:checked|selected)$/i,ke=y.getSetAttribute,De=y.input;E.fn.extend({attr:function(t,e){return K(this,E.attr,t,e,1<arguments.length)},removeAttr:function(t){return this.each(function(){E.removeAttr(this,t)})}}),E.extend({attr:function(t,e,r){var n,i,o=t.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===t.getAttribute?E.prop(t,e,r):(1===o&&E.isXMLDoc(t)||(e=e.toLowerCase(),i=E.attrHooks[e]||(E.expr.match.bool.test(e)?Le:Ie)),void 0!==r?null===r?void E.removeAttr(t,e):i&&"set"in i&&void 0!==(n=i.set(t,r,e))?n:(t.setAttribute(e,r+""),r):i&&"get"in i&&null!==(n=i.get(t,e))?n:null==(n=E.find.attr(t,e))?void 0:n)},attrHooks:{type:{set:function(t,e){if(!y.radioValue&&"radio"===e&&E.nodeName(t,"input")){var r=t.value;return t.setAttribute("type",e),r&&(t.value=r),e}}}},removeAttr:function(t,e){var r,n,i=0,o=e&&e.match(L);if(o&&1===t.nodeType)for(;r=o[i++];)n=E.propFix[r]||r,E.expr.match.bool.test(r)?De&&ke||!Ne.test(r)?t[n]=!1:t[E.camelCase("default-"+r)]=t[n]=!1:E.attr(t,r,""),t.removeAttribute(ke?r:n)}}),Le={set:function(t,e,r){return!1===e?E.removeAttr(t,r):De&&ke||!Ne.test(r)?t.setAttribute(!ke&&E.propFix[r]||r,r):t[E.camelCase("default-"+r)]=t[r]=!0,r}},E.each(E.expr.match.bool.source.match(/\w+/g),function(t,e){var o=Re[e]||E.find.attr;De&&ke||!Ne.test(e)?Re[e]=function(t,e,r){var n,i;return r||(i=Re[e],Re[e]=n,n=null!=o(t,e,r)?e.toLowerCase():null,Re[e]=i),n}:Re[e]=function(t,e,r){if(!r)return t[E.camelCase("default-"+e)]?e.toLowerCase():null}}),De&&ke||(E.attrHooks.value={set:function(t,e,r){if(!E.nodeName(t,"input"))return Ie&&Ie.set(t,e,r);t.defaultValue=e}}),ke||(Ie={set:function(t,e,r){var n=t.getAttributeNode(r);if(n||t.setAttributeNode(n=t.ownerDocument.createAttribute(r)),n.value=e+="","value"===r||e===t.getAttribute(r))return e}},Re.id=Re.name=Re.coords=function(t,e,r){var n;if(!r)return(n=t.getAttributeNode(e))&&""!==n.value?n.value:null},E.valHooks.button={get:function(t,e){var r=t.getAttributeNode(e);if(r&&r.specified)return r.value},set:Ie.set},E.attrHooks.contenteditable={set:function(t,e,r){Ie.set(t,""!==e&&e,r)}},E.each(["width","height"],function(t,r){E.attrHooks[r]={set:function(t,e){if(""===e)return t.setAttribute(r,"auto"),e}}})),y.style||(E.attrHooks.style={get:function(t){return t.style.cssText||void 0},set:function(t,e){return t.style.cssText=e+""}});var je=/^(?:input|select|textarea|button|object)$/i,ze=/^(?:a|area)$/i;E.fn.extend({prop:function(t,e){return K(this,E.prop,t,e,1<arguments.length)},removeProp:function(t){return t=E.propFix[t]||t,this.each(function(){try{this[t]=void 0,delete this[t]}catch(t){}})}}),E.extend({prop:function(t,e,r){var n,i,o=t.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&E.isXMLDoc(t)||(e=E.propFix[e]||e,i=E.propHooks[e]),void 0!==r?i&&"set"in i&&void 0!==(n=i.set(t,r,e))?n:t[e]=r:i&&"get"in i&&null!==(n=i.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){var e=E.find.attr(t,"tabindex");return e?parseInt(e,10):je.test(t.nodeName)||ze.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),y.hrefNormalized||E.each(["href","src"],function(t,e){E.propHooks[e]={get:function(t){return t.getAttribute(e,4)}}}),y.optSelected||(E.propHooks.selected={get:function(t){var e=t.parentNode;return e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex),null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),E.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){E.propFix[this.toLowerCase()]=this}),y.enctype||(E.propFix.enctype="encoding");var Fe=/[\t\r\n\f]/g;function Be(t){return E.attr(t,"class")||""}E.fn.extend({addClass:function(e){var t,r,n,i,o,a,s,u=0;if(E.isFunction(e))return this.each(function(t){E(this).addClass(e.call(this,t,Be(this)))});if("string"==typeof e&&e)for(t=e.match(L)||[];r=this[u++];)if(i=Be(r),n=1===r.nodeType&&(" "+i+" ").replace(Fe," ")){for(a=0;o=t[a++];)n.indexOf(" "+o+" ")<0&&(n+=o+" ");i!==(s=E.trim(n))&&E.attr(r,"class",s)}return this},removeClass:function(e){var t,r,n,i,o,a,s,u=0;if(E.isFunction(e))return this.each(function(t){E(this).removeClass(e.call(this,t,Be(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(L)||[];r=this[u++];)if(i=Be(r),n=1===r.nodeType&&(" "+i+" ").replace(Fe," ")){for(a=0;o=t[a++];)for(;-1<n.indexOf(" "+o+" ");)n=n.replace(" "+o+" "," ");i!==(s=E.trim(n))&&E.attr(r,"class",s)}return this},toggleClass:function(i,e){var o=typeof i;return"boolean"==typeof e&&"string"==o?e?this.addClass(i):this.removeClass(i):E.isFunction(i)?this.each(function(t){E(this).toggleClass(i.call(this,t,Be(this),e),e)}):this.each(function(){var t,e,r,n;if("string"==o)for(e=0,r=E(this),n=i.match(L)||[];t=n[e++];)r.hasClass(t)?r.removeClass(t):r.addClass(t);else void 0!==i&&"boolean"!=o||((t=Be(this))&&E._data(this,"__className__",t),E.attr(this,"class",t||!1===i?"":E._data(this,"__className__")||""))})},hasClass:function(t){var e,r,n=0;for(e=" "+t+" ";r=this[n++];)if(1===r.nodeType&&-1<(" "+Be(r)+" ").replace(Fe," ").indexOf(e))return!0;return!1}}),E.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,r){E.fn[r]=function(t,e){return 0<arguments.length?this.on(r,null,t,e):this.trigger(r)}}),E.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}});var Ue=S.location,Ve=E.now(),Ge=/\?/,qe=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;E.parseJSON=function(t){if(S.JSON&&S.JSON.parse)return S.JSON.parse(t+"");var i,o=null,e=E.trim(t+"");return e&&!E.trim(e.replace(qe,function(t,e,r,n){return i&&e&&(o=0),0===o?t:(i=r||e,o+=!n-!r,"")}))?Function("return "+e)():E.error("Invalid JSON: "+t)},E.parseXML=function(t){var e;if(!t||"string"!=typeof t)return null;try{S.DOMParser?e=(new S.DOMParser).parseFromString(t,"text/xml"):((e=new S.ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t))}catch(t){e=void 0}return e&&e.documentElement&&!e.getElementsByTagName("parsererror").length||E.error("Invalid XML: "+t),e};var He=/#.*$/,$e=/([?&])_=[^&]*/,We=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Xe=/^(?:GET|HEAD)$/,Ye=/^\/\//,Ze=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Ke={},Je={},Qe="*/".concat("*"),tr=Ue.href,er=Ze.exec(tr.toLowerCase())||[];function rr(o){return function(t,e){"string"!=typeof t&&(e=t,t="*");var r,n=0,i=t.toLowerCase().match(L)||[];if(E.isFunction(e))for(;r=i[n++];)"+"===r.charAt(0)?(r=r.slice(1)||"*",(o[r]=o[r]||[]).unshift(e)):(o[r]=o[r]||[]).push(e)}}function nr(e,i,o,a){var s={},u=e===Je;function c(t){var n;return s[t]=!0,E.each(e[t]||[],function(t,e){var r=e(i,o,a);return"string"!=typeof r||u||s[r]?u?!(n=r):void 0:(i.dataTypes.unshift(r),c(r),!1)}),n}return c(i.dataTypes[0])||!s["*"]&&c("*")}function ir(t,e){var r,n,i=E.ajaxSettings.flatOptions||{};for(n in e)void 0!==e[n]&&((i[n]?t:r=r||{})[n]=e[n]);return r&&E.extend(!0,t,r),t}E.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:tr,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(er[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Qe,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":E.parseJSON,"text xml":E.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?ir(ir(t,E.ajaxSettings),e):ir(E.ajaxSettings,t)},ajaxPrefilter:rr(Ke),ajaxTransport:rr(Je),ajax:function(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var r,n,l,h,p,f,d,i,m=E.ajaxSetup({},e),g=m.context||m,y=m.context&&(g.nodeType||g.jquery)?E(g):E.event,v=E.Deferred(),_=E.Callbacks("once memory"),b=m.statusCode||{},o={},a={},x=0,s="canceled",w={readyState:0,getResponseHeader:function(t){var e;if(2===x){if(!i)for(i={};e=We.exec(h);)i[e[1].toLowerCase()]=e[2];e=i[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===x?h:null},setRequestHeader:function(t,e){var r=t.toLowerCase();return x||(t=a[r]=a[r]||t,o[t]=e),this},overrideMimeType:function(t){return x||(m.mimeType=t),this},statusCode:function(t){var e;if(t)if(x<2)for(e in t)b[e]=[b[e],t[e]];else w.always(t[w.status]);return this},abort:function(t){var e=t||s;return d&&d.abort(e),u(0,e),this}};if(v.promise(w).complete=_.add,w.success=w.done,w.error=w.fail,m.url=((t||m.url||tr)+"").replace(He,"").replace(Ye,er[1]+"//"),m.type=e.method||e.type||m.method||m.type,m.dataTypes=E.trim(m.dataType||"*").toLowerCase().match(L)||[""],null==m.crossDomain&&(r=Ze.exec(m.url.toLowerCase()),m.crossDomain=!(!r||r[1]===er[1]&&r[2]===er[2]&&(r[3]||("http:"===r[1]?"80":"443"))===(er[3]||("http:"===er[1]?"80":"443")))),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=E.param(m.data,m.traditional)),nr(Ke,m,e,w),2===x)return w;for(n in(f=E.event&&m.global)&&0==E.active++&&E.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!Xe.test(m.type),l=m.url,m.hasContent||(m.data&&(l=m.url+=(Ge.test(l)?"&":"?")+m.data,delete m.data),!1===m.cache&&(m.url=$e.test(l)?l.replace($e,"$1_="+Ve++):l+(Ge.test(l)?"&":"?")+"_="+Ve++)),m.ifModified&&(E.lastModified[l]&&w.setRequestHeader("If-Modified-Since",E.lastModified[l]),E.etag[l]&&w.setRequestHeader("If-None-Match",E.etag[l])),(m.data&&m.hasContent&&!1!==m.contentType||e.contentType)&&w.setRequestHeader("Content-Type",m.contentType),w.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+Qe+"; q=0.01":""):m.accepts["*"]),m.headers)w.setRequestHeader(n,m.headers[n]);if(m.beforeSend&&(!1===m.beforeSend.call(g,w,m)||2===x))return w.abort();for(n in s="abort",{success:1,error:1,complete:1})w[n](m[n]);if(d=nr(Je,m,e,w)){if(w.readyState=1,f&&y.trigger("ajaxSend",[w,m]),2===x)return w;m.async&&0<m.timeout&&(p=S.setTimeout(function(){w.abort("timeout")},m.timeout));try{x=1,d.send(o,u)}catch(t){if(!(x<2))throw t;u(-1,t)}}else u(-1,"No Transport");function u(t,e,r,n){var i,o,a,s,u,c=e;2!==x&&(x=2,p&&S.clearTimeout(p),d=void 0,h=n||"",w.readyState=0<t?4:0,i=200<=t&&t<300||304===t,r&&(s=function(t,e,r){for(var n,i,o,a,s=t.contents,u=t.dataTypes;"*"===u[0];)u.shift(),void 0===i&&(i=t.mimeType||e.getResponseHeader("Content-Type"));if(i)for(a in s)if(s[a]&&s[a].test(i)){u.unshift(a);break}if(u[0]in r)o=u[0];else{for(a in r){if(!u[0]||t.converters[a+" "+u[0]]){o=a;break}n=n||a}o=o||n}if(o)return o!==u[0]&&u.unshift(o),r[o]}(m,w,r)),s=function(t,e,r,n){var i,o,a,s,u,c={},l=t.dataTypes.slice();if(l[1])for(a in t.converters)c[a.toLowerCase()]=t.converters[a];for(o=l.shift();o;)if(t.responseFields[o]&&(r[t.responseFields[o]]=e),!u&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),u=o,o=l.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=c[u+" "+o]||c["* "+o]))for(i in c)if((s=i.split(" "))[1]===o&&(a=c[u+" "+s[0]]||c["* "+s[0]])){!0===a?a=c[i]:!0!==c[i]&&(o=s[0],l.unshift(s[1]));break}if(!0!==a)if(a&&t.throws)e=a(e);else try{e=a(e)}catch(t){return{state:"parsererror",error:a?t:"No conversion from "+u+" to "+o}}}return{state:"success",data:e}}(m,s,w,i),i?(m.ifModified&&((u=w.getResponseHeader("Last-Modified"))&&(E.lastModified[l]=u),(u=w.getResponseHeader("etag"))&&(E.etag[l]=u)),204===t||"HEAD"===m.type?c="nocontent":304===t?c="notmodified":(c=s.state,o=s.data,i=!(a=s.error))):(a=c,!t&&c||(c="error",t<0&&(t=0))),w.status=t,w.statusText=(e||c)+"",i?v.resolveWith(g,[o,c,w]):v.rejectWith(g,[w,c,a]),w.statusCode(b),b=void 0,f&&y.trigger(i?"ajaxSuccess":"ajaxError",[w,m,i?o:a]),_.fireWith(g,[w,c]),f&&(y.trigger("ajaxComplete",[w,m]),--E.active||E.event.trigger("ajaxStop")))}return w},getJSON:function(t,e,r){return E.get(t,e,r,"json")},getScript:function(t,e){return E.get(t,void 0,e,"script")}}),E.each(["get","post"],function(t,i){E[i]=function(t,e,r,n){return E.isFunction(e)&&(n=n||r,r=e,e=void 0),E.ajax(E.extend({url:t,type:i,dataType:n,data:e,success:r},E.isPlainObject(t)&&t))}}),E._evalUrl=function(t){return E.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},E.fn.extend({wrapAll:function(e){if(E.isFunction(e))return this.each(function(t){E(this).wrapAll(e.call(this,t))});if(this[0]){var t=E(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(r){return E.isFunction(r)?this.each(function(t){E(this).wrapInner(r.call(this,t))}):this.each(function(){var t=E(this),e=t.contents();e.length?e.wrapAll(r):t.append(r)})},wrap:function(e){var r=E.isFunction(e);return this.each(function(t){E(this).wrapAll(r?e.call(this,t):e)})},unwrap:function(){return this.parent().each(function(){E.nodeName(this,"body")||E(this).replaceWith(this.childNodes)}).end()}}),E.expr.filters.hidden=function(t){return y.reliableHiddenOffsets()?t.offsetWidth<=0&&t.offsetHeight<=0&&!t.getClientRects().length:function(t){if(!E.contains(t.ownerDocument||d,t))return!0;for(;t&&1===t.nodeType;){if("none"===((e=t).style&&e.style.display||E.css(e,"display"))||"hidden"===t.type)return!0;t=t.parentNode}var e;return!1}(t)},E.expr.filters.visible=function(t){return!E.expr.filters.hidden(t)};var or=/%20/g,ar=/\[\]$/,sr=/\r?\n/g,ur=/^(?:submit|button|image|reset|file)$/i,cr=/^(?:input|select|textarea|keygen)/i;function lr(r,t,n,i){var e;if(E.isArray(t))E.each(t,function(t,e){n||ar.test(r)?i(r,e):lr(r+"["+("object"==typeof e&&null!=e?t:"")+"]",e,n,i)});else if(n||"object"!==E.type(t))i(r,t);else for(e in t)lr(r+"["+e+"]",t[e],n,i)}E.param=function(t,e){function r(t,e){e=E.isFunction(e)?e():null==e?"":e,i[i.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)}var n,i=[];if(void 0===e&&(e=E.ajaxSettings&&E.ajaxSettings.traditional),E.isArray(t)||t.jquery&&!E.isPlainObject(t))E.each(t,function(){r(this.name,this.value)});else for(n in t)lr(n,t[n],e,r);return i.join("&").replace(or,"+")},E.fn.extend({serialize:function(){return E.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=E.prop(this,"elements");return t?E.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!E(this).is(":disabled")&&cr.test(this.nodeName)&&!ur.test(t)&&(this.checked||!J.test(t))}).map(function(t,e){var r=E(this).val();return null==r?null:E.isArray(r)?E.map(r,function(t){return{name:e.name,value:t.replace(sr,"\r\n")}}):{name:e.name,value:r.replace(sr,"\r\n")}}).get()}}),E.ajaxSettings.xhr=void 0!==S.ActiveXObject?function(){return this.isLocal?mr():8<d.documentMode?dr():/^(get|post|head|put|delete|options)$/i.test(this.type)&&dr()||mr()}:dr;var hr=0,pr={},fr=E.ajaxSettings.xhr();function dr(){try{return new S.XMLHttpRequest}catch(t){}}function mr(){try{return new S.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}S.attachEvent&&S.attachEvent("onunload",function(){for(var t in pr)pr[t](void 0,!0)}),y.cors=!!fr&&"withCredentials"in fr,(fr=y.ajax=!!fr)&&E.ajaxTransport(function(u){var c;if(!u.crossDomain||y.cors)return{send:function(t,o){var e,a=u.xhr(),s=++hr;if(a.open(u.type,u.url,u.async,u.username,u.password),u.xhrFields)for(e in u.xhrFields)a[e]=u.xhrFields[e];for(e in u.mimeType&&a.overrideMimeType&&a.overrideMimeType(u.mimeType),u.crossDomain||t["X-Requested-With"]||(t["X-Requested-With"]="XMLHttpRequest"),t)void 0!==t[e]&&a.setRequestHeader(e,t[e]+"");a.send(u.hasContent&&u.data||null),c=function(t,e){var r,n,i;if(c&&(e||4===a.readyState))if(delete pr[s],c=void 0,a.onreadystatechange=E.noop,e)4!==a.readyState&&a.abort();else{i={},r=a.status,"string"==typeof a.responseText&&(i.text=a.responseText);try{n=a.statusText}catch(t){n=""}r||!u.isLocal||u.crossDomain?1223===r&&(r=204):r=i.text?200:404}i&&o(r,n,i,a.getAllResponseHeaders())},u.async?4===a.readyState?S.setTimeout(c):a.onreadystatechange=pr[s]=c:c()},abort:function(){c&&c(void 0,!0)}}}),E.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return E.globalEval(t),t}}}),E.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET",t.global=!1)}),E.ajaxTransport("script",function(e){if(e.crossDomain){var n,i=d.head||E("head")[0]||d.documentElement;return{send:function(t,r){(n=d.createElement("script")).async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(t,e){!e&&n.readyState&&!/loaded|complete/.test(n.readyState)||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,e||r(200,"success"))},i.insertBefore(n,i.firstChild)},abort:function(){n&&n.onload(void 0,!0)}}}});var gr=[],yr=/(=)\?(?=&|$)|\?\?/;E.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=gr.pop()||E.expando+"_"+Ve++;return this[t]=!0,t}}),E.ajaxPrefilter("json jsonp",function(t,e,r){var n,i,o,a=!1!==t.jsonp&&(yr.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&yr.test(t.data)&&"data");if(a||"jsonp"===t.dataTypes[0])return n=t.jsonpCallback=E.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(yr,"$1"+n):!1!==t.jsonp&&(t.url+=(Ge.test(t.url)?"&":"?")+t.jsonp+"="+n),t.converters["script json"]=function(){return o||E.error(n+" was not called"),o[0]},t.dataTypes[0]="json",i=S[n],S[n]=function(){o=arguments},r.always(function(){void 0===i?E(S).removeProp(n):S[n]=i,t[n]&&(t.jsonpCallback=e.jsonpCallback,gr.push(n)),o&&E.isFunction(i)&&i(o[0]),o=i=void 0}),"script"}),E.parseHTML=function(t,e,r){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(r=e,e=!1),e=e||d;var n=b.exec(t),i=!r&&[];return n?[e.createElement(n[1])]:(n=lt([t],e,i),i&&i.length&&E(i).remove(),E.merge([],n.childNodes))};var vr=E.fn.load;function _r(t){return E.isWindow(t)?t:9===t.nodeType&&(t.defaultView||t.parentWindow)}E.fn.load=function(t,e,r){if("string"!=typeof t&&vr)return vr.apply(this,arguments);var n,i,o,a=this,s=t.indexOf(" ");return-1<s&&(n=E.trim(t.slice(s,t.length)),t=t.slice(0,s)),E.isFunction(e)?(r=e,e=void 0):e&&"object"==typeof e&&(i="POST"),0<a.length&&E.ajax({url:t,type:i||"GET",dataType:"html",data:e}).done(function(t){o=arguments,a.html(n?E("<div>").append(E.parseHTML(t)).find(n):t)}).always(r&&function(t,e){a.each(function(){r.apply(this,o||[t.responseText,e,t])})}),this},E.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){E.fn[e]=function(t){return this.on(e,t)}}),E.expr.filters.animated=function(e){return E.grep(E.timers,function(t){return e===t.elem}).length},E.offset={setOffset:function(t,e,r){var n,i,o,a,s,u,c=E.css(t,"position"),l=E(t),h={};"static"===c&&(t.style.position="relative"),s=l.offset(),o=E.css(t,"top"),u=E.css(t,"left"),i=("absolute"===c||"fixed"===c)&&-1<E.inArray("auto",[o,u])?(a=(n=l.position()).top,n.left):(a=parseFloat(o)||0,parseFloat(u)||0),E.isFunction(e)&&(e=e.call(t,r,E.extend({},s))),null!=e.top&&(h.top=e.top-s.top+a),null!=e.left&&(h.left=e.left-s.left+i),"using"in e?e.using.call(t,h):l.css(h)}},E.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){E.offset.setOffset(this,e,t)});var t,r,n={top:0,left:0},i=this[0],o=i&&i.ownerDocument;return o?(t=o.documentElement,E.contains(t,i)?(void 0!==i.getBoundingClientRect&&(n=i.getBoundingClientRect()),r=_r(o),{top:n.top+(r.pageYOffset||t.scrollTop)-(t.clientTop||0),left:n.left+(r.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):n):void 0},position:function(){if(this[0]){var t,e,r={top:0,left:0},n=this[0];return"fixed"===E.css(n,"position")?e=n.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),E.nodeName(t[0],"html")||(r=t.offset()),r.top+=E.css(t[0],"borderTopWidth",!0),r.left+=E.css(t[0],"borderLeftWidth",!0)),{top:e.top-r.top-E.css(n,"marginTop",!0),left:e.left-r.left-E.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&!E.nodeName(t,"html")&&"static"===E.css(t,"position");)t=t.offsetParent;return t||Zt})}}),E.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,i){var o=/Y/.test(i);E.fn[e]=function(t){return K(this,function(t,e,r){var n=_r(t);if(void 0===r)return n?i in n?n[i]:n.document.documentElement[e]:t[e];n?n.scrollTo(o?E(n).scrollLeft():r,o?r:E(n).scrollTop()):t[e]=r},e,t,arguments.length,null)}}),E.each(["top","left"],function(t,r){E.cssHooks[r]=ee(y.pixelPosition,function(t,e){if(e)return e=Qt(t,r),Yt.test(e)?E(t).position()[r]+"px":e})}),E.each({Height:"height",Width:"width"},function(o,a){E.each({padding:"inner"+o,content:a,"":"outer"+o},function(n,t){E.fn[t]=function(t,e){var r=arguments.length&&(n||"boolean"!=typeof t),i=n||(!0===t||!0===e?"margin":"border");return K(this,function(t,e,r){var n;return E.isWindow(t)?t.document.documentElement["client"+o]:9===t.nodeType?(n=t.documentElement,Math.max(t.body["scroll"+o],n["scroll"+o],t.body["offset"+o],n["offset"+o],n["client"+o])):void 0===r?E.css(t,e,i):E.style(t,e,r,i)},a,r?t:void 0,r,null)}})}),E.fn.extend({bind:function(t,e,r){return this.on(t,null,e,r)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,r,n){return this.on(e,t,r,n)},undelegate:function(t,e,r){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",r)}}),E.fn.size=function(){return this.length},E.fn.andSelf=E.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return E});var br=S.jQuery,xr=S.$;return E.noConflict=function(t){return S.$===E&&(S.$=xr),t&&S.jQuery===E&&(S.jQuery=br),E},t||(S.jQuery=S.$=E),E},"object"==typeof e&&"object"==typeof e.exports?e.exports=n.document?i(n,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return i(t)}:i(n)},{}],5:[function(t,e,r){var n,i;n=this,i=function(){"use strict";var i,o,a;function t(t,e){if(i)if(o){var r="var sharedChunk = {}; ("+i+")(sharedChunk); ("+o+")(sharedChunk);",n={};i(n),(a=e(n)).workerUrl=window.URL.createObjectURL(new Blob([r],{type:"text/javascript"}))}else o=e;else i=e}return t(0,function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var o=r;function r(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}r.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},r.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},r.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},r.prototype.solveCurveX=function(t,e){var r,n,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;o<t?r=i:n=i,i=.5*(n-r)+r}return i},r.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var ht=n;function n(t,e){this.x=t,this.y=e}function i(t,e,r,n){var i=new o(t,e,r,n);return function(t){return i.solve(t)}}n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t};var a=i(.25,.1,.25,1);function s(t,e,r){return Math.min(r,Math.max(e,t))}function u(t,e,r){var n=r-e,i=((t-e)%n+n)%n+e;return i===e?r:i}function f(t){for(var e=[],r=arguments.length-1;0<r--;)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var o=i[n];for(var a in o)t[a]=o[a]}return t}var c=1;function l(){return c++}function h(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function p(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function d(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})}function m(t,e){return-1!==t.indexOf(e,t.length-e.length)}function g(t,e,r){var n={};for(var i in t)n[i]=e.call(r||this,t[i],i,t);return n}function y(t,e,r){var n={};for(var i in t)e.call(r||this,t[i],i,t)&&(n[i]=t[i]);return n}function v(t){return Array.isArray(t)?t.map(v):"object"==typeof t&&t?g(t,v):t}var _={};function pt(t){_[t]||("undefined"!=typeof console&&console.warn(t),_[t]=!0)}function b(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function x(t){for(var e=0,r=0,n=t.length,i=n-1,o=void 0,a=void 0;r<n;i=r++)e+=((a=t[i]).x-(o=t[r]).x)*(o.y+a.y);return e}function w(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function S(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(t,e,r,n){var i=r||n;return o[e]=!i||i.toLowerCase(),""}),o["max-age"]){var e=parseInt(o["max-age"],10);isNaN(e)?delete o["max-age"]:o["max-age"]=e}return o}var E=null;function C(t){if(null==E){var e=t.navigator?t.navigator.userAgent:null;E=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return E}function M(t){try{var e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var T,P,O,A,I=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date),L=self.requestAnimationFrame||self.mozRequestAnimationFrame||self.webkitRequestAnimationFrame||self.msRequestAnimationFrame,R=self.cancelAnimationFrame||self.mozCancelAnimationFrame||self.webkitCancelAnimationFrame||self.msCancelAnimationFrame,N={now:I,frame:function(t){var e=L(t);return{cancel:function(){return R(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var r=self.document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return r.width=t.width,r.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return(T=T||self.document.createElement("a")).href=t,T.href},hardwareConcurrency:self.navigator.hardwareConcurrency||4,get devicePixelRatio(){return self.devicePixelRatio},get prefersReducedMotion(){return!!self.matchMedia&&(null==P&&(P=self.matchMedia("(prefers-reduced-motion: reduce)")),P.matches)}},k={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},D={supported:!1,testSupport:function(t){!j&&A&&(z?F(t):O=t)}},j=!1,z=!1;function F(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,A),t.isContextLost())return;D.supported=!0}catch(t){}t.deleteTexture(e),j=!0}self.document&&((A=self.document.createElement("img")).onload=function(){O&&F(O),z=!(O=null)},A.onerror=function(){j=!0,O=null},A.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");function B(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()}var U="01";function V(t){return 0===t.indexOf("mapbox:")}B.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",U,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},B.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},B.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},B.prototype.normalizeStyleURL=function(t,e){if(!V(t))return t;var r=$(t);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},B.prototype.normalizeGlyphsURL=function(t,e){if(!V(t))return t;var r=$(t);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},B.prototype.normalizeSourceURL=function(t,e){if(!V(t))return t;var r=$(t);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)},B.prototype.normalizeSpriteURL=function(t,e,r,n){var i=$(t);return V(t)?(i.path="/styles/v1"+i.path+"/sprite"+e+r,this._makeAPIURL(i,this._customAccessToken||n)):(i.path+=""+e+r,W(i))},B.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!V(t))return t;var n=$(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,(2<=N.devicePixelRatio||512===e?"@2x":"")+(D.supported?".webp":"$1")),n.path=n.path.replace(/^.+\/v4\//,"/"),n.path="/v4"+n.path;var r=this._customAccessToken||function(){for(var t=0,e=n.params;t<e.length;t+=1){var r=e[t].match(/^access_token=(.*)$/);if(r)return r[1]}return null}()||k.ACCESS_TOKEN;return k.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&n.params.push("sku="+this._skuToken),this._makeAPIURL(n,r)},B.prototype.canonicalizeTileURL=function(t,e){var r=$(t);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return t;var n="mapbox://tiles/";n+=r.path.replace("/v4/","");var i=r.params;return e&&(i=i.filter(function(t){return!t.match(/^access_token=/)})),i.length&&(n+="?"+i.join("&")),n},B.prototype.canonicalizeTileset=function(t,e){for(var r=!!e&&V(e),n=[],i=0,o=t.tiles||[];i<o.length;i+=1){var a=o[i];q(a)?n.push(this.canonicalizeTileURL(a,r)):n.push(a)}return n},B.prototype._makeAPIURL=function(t,e){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=$(k.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,"/"!==n.path&&(t.path=""+n.path+t.path),!k.REQUIRE_ACCESS_TOKEN)return W(t);if(!(e=e||k.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return t.params=t.params.filter(function(t){return-1===t.indexOf("access_token")}),t.params.push("access_token="+e),W(t)};var G=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function q(t){return G.test(t)}var H=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function $(t){var e=t.match(H);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function W(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function X(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(self.atob(e[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(t){return null}}function Y(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}Y.prototype.getStorageKey=function(t){var e,r=X(k.ACCESS_TOKEN);return e=r&&r.u?self.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode(Number("0x"+e))})):k.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},Y.prototype.fetchEventData=function(){var t=M("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{var n=self.localStorage.getItem(e);n&&(this.eventData=JSON.parse(n));var i=self.localStorage.getItem(r);i&&(this.anonId=i)}catch(t){pt("Unable to read from LocalStorage")}},Y.prototype.saveEventData=function(){var t=M("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{self.localStorage.setItem(r,this.anonId),1<=Object.keys(this.eventData).length&&self.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){pt("Unable to write to LocalStorage")}},Y.prototype.processRequests=function(t){},Y.prototype.postEvent=function(t,e,r,n){var i=this;if(k.EVENTS_URL){var o=$(k.EVENTS_URL);o.params.push("access_token="+(n||k.ACCESS_TOKEN||""));var a={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.9.1",skuId:U,userId:this.anonId},s=e?f(a,e):a,u={url:W(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=Mt(u,function(t){i.pendingRequest=null,r(t),i.saveEventData(),i.processRequests(n)})}},Y.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var Z,K,J,Q,tt=((Q=Y)&&(ct.__proto__=Q),((ct.prototype=Object.create(Q&&Q.prototype)).constructor=ct).prototype.postMapLoadEvent=function(t,e,r,n){this.skuToken=r,(k.EVENTS_URL&&n||k.ACCESS_TOKEN&&Array.isArray(t)&&t.some(function(t){return V(t)||q(t)}))&&this.queueRequest({id:e,timestamp:Date.now()},n)},ct.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var r=this.queue.shift(),n=r.id,i=r.timestamp;n&&this.success[n]||(this.anonId||this.fetchEventData(),p(this.anonId)||(this.anonId=h()),this.postEvent(i,{skuToken:this.skuToken},function(t){t||n&&(e.success[n]=!0)},t))}},ct),et=((J=Y)&&(ut.__proto__=J),((ut.prototype=Object.create(J&&J.prototype)).constructor=ut).prototype.postTurnstileEvent=function(t,e){k.EVENTS_URL&&k.ACCESS_TOKEN&&Array.isArray(t)&&t.some(function(t){return V(t)||q(t)})&&this.queueRequest(Date.now(),e)},ut.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var r=X(k.ACCESS_TOKEN),n=r?r.u:k.ACCESS_TOKEN,i=n!==this.eventData.tokenU;p(this.anonId)||(this.anonId=h(),i=!0);var o=this.queue.shift();if(this.eventData.lastSuccess){var a=new Date(this.eventData.lastSuccess),s=new Date(o),u=(o-this.eventData.lastSuccess)/864e5;i=i||1<=u||u<-1||a.getDate()!==s.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(o,{"enabled.telemetry":!1},function(t){t||(e.eventData.lastSuccess=o,e.eventData.tokenU=n)},t)}},new ut),rt=et.postTurnstileEvent.bind(et),nt=new tt,it=nt.postMapLoadEvent.bind(nt),ot="mapbox-tiles",at=500,st=50;function ut(t){J.call(this,"appUserTurnstile"),this._customAccessToken=t}function ct(){Q.call(this,"map.load"),this.success={},this.skuToken=""}function lt(){self.caches&&!Z&&(Z=self.caches.open(ot))}function ft(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var dt,mt=1/0;function gt(){return null==dt&&(dt=self.OffscreenCanvas&&new self.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),dt}var yt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(yt);var vt,_t=((vt=Error)&&(xt.__proto__=vt),((xt.prototype=Object.create(vt&&vt.prototype)).constructor=xt).prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},xt),bt=w()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===self.location.protocol?self.parent:self).location.href};function xt(t,e,r){401===e&&q(r)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),vt.call(this,t),this.status=e,this.url=r,this.name=this.constructor.name,this.message=t}function wt(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(bt())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&self.Request.prototype.hasOwnProperty("signal"))return function(i,o){var t,e=new self.AbortController,a=new self.Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:bt(),signal:e.signal}),s=!1,u=!1,c=0<(t=a.url).indexOf("sku=")&&q(t);"json"===i.type&&a.headers.set("Accept","application/json");function r(t,e,r){if(!u){if(t&&"SecurityError"!==t.message&&pt(t),e&&r)return l(e);var n=Date.now();self.fetch(a).then(function(t){if(t.ok){var e=c?t.clone():null;return l(t,e,n)}return o(new _t(t.statusText,t.status,i.url))}).catch(function(t){20!==t.code&&o(new Error(t.message))})}}var l=function(e,r,n){("arrayBuffer"===i.type?e.arrayBuffer():"json"===i.type?e.json():e.text()).then(function(t){u||(r&&n&&function(r,t,e){if(lt(),Z){var n={status:t.status,statusText:t.statusText,headers:new self.Headers};t.headers.forEach(function(t,e){return n.headers.set(e,t)});var i=S(t.headers.get("Cache-Control")||"");i["no-store"]||(i["max-age"]&&n.headers.set("Expires",new Date(e+1e3*i["max-age"]).toUTCString()),new Date(n.headers.get("Expires")).getTime()-e<42e4||function(t,e){if(void 0===K)try{new Response(new ReadableStream),K=!0}catch(t){K=!1}K?e(t.body):t.blob().then(e)}(t,function(t){var e=new self.Response(t,n);lt(),Z&&Z.then(function(t){return t.put(ft(r.url),e)}).catch(function(t){return pt(t.message)})}))}}(a,r,n),s=!0,o(null,t,e.headers.get("Cache-Control"),e.headers.get("Expires")))}).catch(function(t){u||o(new Error(t.message))})};return c?function(t,n){if(lt(),!Z)return n(null);var i=ft(t.url);Z.then(function(r){r.match(i).then(function(t){var e=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")||0),r=S(t.headers.get("Cache-Control")||"");return e>Date.now()&&!r["no-cache"]}(t);r.delete(i),e&&r.put(i,t.clone()),n(null,t,e)}).catch(n)}).catch(n)}(a,r):r(null,null),{cancel:function(){u=!0,s||e.abort()}}}(t,e);if(w()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(e,r){var n=new self.XMLHttpRequest;for(var t in n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer"),e.headers)n.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if((200<=n.status&&n.status<300||0===n.status)&&null!==n.response){var t=n.response;if("json"===e.type)try{t=JSON.parse(n.response)}catch(t){return r(t)}r(null,t,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else r(new _t(n.statusText,n.status,e.url))},n.send(e.body),{cancel:function(){return n.abort()}}}(t,e)}function St(t,e){return wt(f(t,{type:"arrayBuffer"}),e)}var Et,Ct,Mt=function(t,e){return wt(f(t,{method:"POST"}),e)};Et=[],Ct=0;var Tt=function(t,s){if(D.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ct>=k.MAX_PARALLEL_IMAGE_REQUESTS){var e={requestParameters:t,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return Et.push(e),e}Ct++;function u(){if(!r)for(r=!0,Ct--;Et.length&&Ct<k.MAX_PARALLEL_IMAGE_REQUESTS;){var t=Et.shift();t.cancelled||(t.cancel=Tt(t.requestParameters,t.callback).cancel)}}var r=!1,n=St(t,function(t,e,r,n){var i,o,a;u(),t?s(t):e&&(gt()?(i=e,o=s,a=new self.Blob([new Uint8Array(i)],{type:"image/png"}),self.createImageBitmap(a).then(function(t){o(null,t)}).catch(function(t){o(new Error("Could not load image because of "+t.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})):function(t,e,r,n){var i=new self.Image,o=self.URL;i.onload=function(){e(null,i),o.revokeObjectURL(i.src)},i.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var a=new self.Blob([new Uint8Array(t)],{type:"image/png"});i.cacheControl=r,i.expires=n,i.src=t.byteLength?o.createObjectURL(a):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}(e,s,r,n))});return{cancel:function(){n.cancel(),u()}}};function Pt(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e))}function Ot(t,e,r){if(r&&r[t]){var n=r[t].indexOf(e);-1!==n&&r[t].splice(n,1)}}function At(t,e){void 0===e&&(e={}),f(this,e),this.type=t}function It(){}var Lt,Rt=((Lt=At)&&(Nt.__proto__=Lt),(Nt.prototype=Object.create(Lt&&Lt.prototype)).constructor=Nt);function Nt(t,e){void 0===e&&(e={}),Lt.call(this,"error",f({error:t},e))}It.prototype.on=function(t,e){return this._listeners=this._listeners||{},Pt(t,e,this._listeners),this},It.prototype.off=function(t,e){return Ot(t,e,this._listeners),Ot(t,e,this._oneTimeListeners),this},It.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},Pt(t,e,this._oneTimeListeners),this},It.prototype.fire=function(t,e){"string"==typeof t&&(t=new At(t,e||{}));var r=t.type;if(this.listens(r)){for(var n=0,i=(t.target=this)._listeners&&this._listeners[r]?this._listeners[r].slice():[];n<i.length;n+=1)i[n].call(this,t);for(var o=0,a=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];o<a.length;o+=1){var s=a[o];Ot(r,s,this._oneTimeListeners),s.call(this,t)}var u=this._eventedParent;u&&(f(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t))}else t instanceof Rt&&console.error(t.error);return this},It.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&0<this._listeners[t].length||this._oneTimeListeners&&this._oneTimeListeners[t]&&0<this._oneTimeListeners[t].length||this._eventedParent&&this._eventedParent.listens(t)};var kt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!(It.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this})},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},in:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},image:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},within:{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Dt=function(t,e,r,n){this.message=(t?t+": ":"")+r,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)};function jt(t){var e=t.value;return e?[new Dt(t.key,e,"constants have been deprecated as of v8")]:[]}function zt(t){for(var e=[],r=arguments.length-1;0<r--;)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var o=i[n];for(var a in o)t[a]=o[a]}return t}function Ft(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Bt(t){if(Array.isArray(t))return t.map(Bt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var r in t)e[r]=Bt(t[r]);return e}return Ft(t)}function Ut(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var r=0,n=e;r<n.length;r+=1){var i=n[r];this.bindings[i[0]]=i[1]}}var Vt,Gt=((Vt=Error)&&(qt.__proto__=Vt),(qt.prototype=Object.create(Vt&&Vt.prototype)).constructor=qt);function qt(t,e){Vt.call(this,e),this.message=e,this.key=t}Ut.prototype.concat=function(t){return new Ut(this,t)},Ut.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Ut.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Ht={kind:"null"},$t={kind:"number"},Wt={kind:"string"},Xt={kind:"boolean"},Yt={kind:"color"},Zt={kind:"object"},Kt={kind:"value"},Jt={kind:"collator"},Qt={kind:"formatted"},te={kind:"resolvedImage"};function ee(t,e){return{kind:"array",itemType:t,N:e}}function re(t){if("array"!==t.kind)return t.kind;var e=re(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}var ne=[Ht,$t,Wt,Xt,Yt,Qt,Zt,ee(Kt),te];function ie(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!ie(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var r=0,n=ne;r<n.length;r+=1)if(!ie(n[r],e))return null}return"Expected "+re(t)+" but found "+re(e)+" instead."}var oe=e(function(t,e){var f={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function d(t){return(t=Math.round(t))<0?0:255<t?255:t}function m(t){return d("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function g(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:1<e?1:e;var e}function y(t,e,r){return r<0?r+=1:1<r&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{e.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in f)return f[r].slice();if("#"===r[0])return 4===r.length?0<=(e=parseInt(r.substr(1),16))&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===r.length&&0<=(e=parseInt(r.substr(1),16))&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=r.indexOf("("),i=r.indexOf(")");if(-1!==n&&i+1===r.length){var o=r.substr(0,n),a=r.substr(n+1,i-(n+1)).split(","),s=1;switch(o){case"rgba":if(4!==a.length)return null;s=g(a.pop());case"rgb":return 3!==a.length?null:[m(a[0]),m(a[1]),m(a[2]),s];case"hsla":if(4!==a.length)return null;s=g(a.pop());case"hsl":if(3!==a.length)return null;var u=(parseFloat(a[0])%360+360)%360/360,c=g(a[1]),l=g(a[2]),h=l<=.5?l*(c+1):l+c-l*c,p=2*l-h;return[d(255*y(p,h,u+1/3)),d(255*y(p,h,u)),d(255*y(p,h,u-1/3)),s];default:return null}}return null}}catch(t){}}).parseCSSColor,ae=function(t,e,r,n){void 0===n&&(n=1),this.r=t,this.g=e,this.b=r,this.a=n};ae.parse=function(t){if(t){if(t instanceof ae)return t;if("string"==typeof t){var e=oe(t);if(e)return new ae(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},ae.prototype.toString=function(){var t=this.toArray(),e=t[1],r=t[2],n=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(r)+","+n+")"},ae.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},ae.black=new ae(0,0,0,1),ae.white=new ae(1,1,1,1),ae.transparent=new ae(0,0,0,0),ae.red=new ae(1,0,0,1);var se=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};se.prototype.compare=function(t,e){return this.collator.compare(t,e)},se.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};function ue(t,e,r,n,i){this.text=t,this.image=e,this.scale=r,this.fontStack=n,this.textColor=i}var ce=function(t){this.sections=t};ce.fromString=function(t){return new ce([new ue(t,null,null,null,null)])},ce.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some(function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length})},ce.factory=function(t){return t instanceof ce?t:ce.fromString(t)},ce.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map(function(t){return t.text}).join("")},ce.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];if(n.image)t.push(["image",n.image.name]);else{t.push(n.text);var i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(i)}}return t};var le=function(t){this.name=t.name,this.available=t.available};function he(t,e,r,n){return"number"==typeof t&&0<=t&&t<=255&&"number"==typeof e&&0<=e&&e<=255&&"number"==typeof r&&0<=r&&r<=255?void 0===n||"number"==typeof n&&0<=n&&n<=1?null:"Invalid rgba value ["+[t,e,r,n].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof n?[t,e,r,n]:[t,e,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function pe(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof ae)return!0;if(t instanceof se)return!0;if(t instanceof ce)return!0;if(t instanceof le)return!0;if(Array.isArray(t)){for(var e=0,r=t;e<r.length;e+=1)if(!pe(r[e]))return!1;return!0}if("object"!=typeof t)return!1;for(var n in t)if(!pe(t[n]))return!1;return!0}function fe(t){if(null===t)return Ht;if("string"==typeof t)return Wt;if("boolean"==typeof t)return Xt;if("number"==typeof t)return $t;if(t instanceof ae)return Yt;if(t instanceof se)return Jt;if(t instanceof ce)return Qt;if(t instanceof le)return te;if(Array.isArray(t)){for(var e,r=t.length,n=0,i=t;n<i.length;n+=1){var o=fe(i[n]);if(e){if(e===o)continue;e=Kt;break}e=o}return ee(e||Kt,r)}return Zt}function de(t){var e=typeof t;return null===t?"":"string"==e||"number"==e||"boolean"==e?String(t):t instanceof ae||t instanceof ce||t instanceof le?t.toString():JSON.stringify(t)}le.prototype.toString=function(){return this.name},le.fromString=function(t){return t?new le({name:t,available:!1}):null},le.prototype.serialize=function(){return["image",this.name]};function me(t,e){this.type=t,this.value=e}me.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!pe(t[1]))return e.error("invalid value");var r=t[1],n=fe(r),i=e.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new me(n,r)},me.prototype.evaluate=function(){return this.value},me.prototype.eachChild=function(){},me.prototype.outputDefined=function(){return!0},me.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ae?["rgba"].concat(this.value.toArray()):this.value instanceof ce?this.value.serialize():this.value};var ge=function(t){this.name="ExpressionEvaluationError",this.message=t};ge.prototype.toJSON=function(){return this.message};function ye(t,e){this.type=t,this.args=e}var ve={string:Wt,number:$t,boolean:Xt,object:Zt};ye.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r,n=1,i=t[0];if("array"===i){var o,a;if(2<t.length){var s=t[1];if("string"!=typeof s||!(s in ve)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=ve[s],n++}else o=Kt;if(3<t.length){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],n++}r=ee(o,a)}else r=ve[i];for(var u=[];n<t.length;n++){var c=e.parse(t[n],n,Kt);if(!c)return null;u.push(c)}return new ye(r,u)},ye.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!ie(this.type,fe(r)))return r;if(e===this.args.length-1)throw new ge("Expected value to be of type "+re(this.type)+", but found "+re(fe(r))+" instead.")}return null},ye.prototype.eachChild=function(t){this.args.forEach(t)},ye.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ye.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var r=t.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){e.push(r.kind);var n=t.N;("number"==typeof n||1<this.args.length)&&e.push(n)}}return e.concat(this.args.map(function(t){return t.serialize()}))};function _e(t){this.type=Qt,this.sections=t}_e.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[1];if(!Array.isArray(r)&&"object"==typeof r)return e.error("First argument must be an image or text section.");for(var n=[],i=!1,o=1;o<=t.length-1;++o){var a=t[o];if(i&&"object"==typeof a&&!Array.isArray(a)){i=!1;var s=null;if(a["font-scale"]&&!(s=e.parse(a["font-scale"],1,$t)))return null;var u=null;if(a["text-font"]&&!(u=e.parse(a["text-font"],1,ee(Wt))))return null;var c=null;if(a["text-color"]&&!(c=e.parse(a["text-color"],1,Yt)))return null;var l=n[n.length-1];l.scale=s,l.font=u,l.textColor=c}else{var h=e.parse(t[o],1,Kt);if(!h)return null;var p=h.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:h,scale:null,font:null,textColor:null})}}return new _e(n)},_e.prototype.evaluate=function(r){return new ce(this.sections.map(function(t){var e=t.content.evaluate(r);return fe(e)===te?new ue("",e,null,null,null):new ue(de(e),null,t.scale?t.scale.evaluate(r):null,t.font?t.font.evaluate(r).join(","):null,t.textColor?t.textColor.evaluate(r):null)}))},_e.prototype.eachChild=function(t){for(var e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}},_e.prototype.outputDefined=function(){return!1},_e.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t.push(n.content.serialize());var i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),t.push(i)}return t};function be(t){this.type=te,this.input=t}be.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,Wt);return r?new be(r):e.error("No image name provided.")},be.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=le.fromString(e);return r&&t.availableImages&&(r.available=-1<t.availableImages.indexOf(e)),r},be.prototype.eachChild=function(t){t(this.input)},be.prototype.outputDefined=function(){return!1},be.prototype.serialize=function(){return["image",this.input.serialize()]};function xe(t,e){this.type=t,this.args=e}var we={"to-boolean":Xt,"to-color":Yt,"to-number":$t,"to-string":Wt};xe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[0];if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return e.error("Expected one argument.");for(var n=we[r],i=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,Kt);if(!a)return null;i.push(a)}return new xe(n,i)},xe.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,r,n=0,i=this.args;n<i.length;n+=1){if(r=null,(e=i[n].evaluate(t))instanceof ae)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(r=e.length<3||4<e.length?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":he(e[0],e[1],e[2],e[3])))return new ae(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ge(r||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"!==this.type.kind)return"formatted"===this.type.kind?ce.fromString(de(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?le.fromString(de(this.args[0].evaluate(t))):de(this.args[0].evaluate(t));for(var a=null,s=0,u=this.args;s<u.length;s+=1){if(null===(a=u[s].evaluate(t)))return 0;var c=Number(a);if(!isNaN(c))return c}throw new ge("Could not convert "+JSON.stringify(a)+" to number.")},xe.prototype.eachChild=function(t){this.args.forEach(t)},xe.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},xe.prototype.serialize=function(){if("formatted"===this.type.kind)return new _e([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new be(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};function Se(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}var Ee=["Unknown","Point","LineString","Polygon"];Se.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Se.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?Ee[this.feature.type]:this.feature.type:null},Se.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Se.prototype.canonicalID=function(){return this.canonical},Se.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Se.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e=e||(this._parseColorCache[t]=ae.parse(t))};var Ce=function(t,e,r,n){this.name=t,this.type=e,this._evaluate=r,this.args=n};Ce.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Ce.prototype.eachChild=function(t){this.args.forEach(t)},Ce.prototype.outputDefined=function(){return!1},Ce.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Ce.parse=function(r,t){var e,n=r[0],i=Ce.definitions[n];if(!i)return t.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=a.filter(function(t){var e=t[0];return!Array.isArray(e)||e.length===r.length-1}),u=null,c=0,l=s;c<l.length;c+=1){var h=l[c],p=h[0],f=h[1];u=new Je(t.registry,t.path,null,t.scope);for(var d=[],m=!1,g=1;g<r.length;g++){var y=r[g],v=Array.isArray(p)?p[g-1]:p.type,_=u.parse(y,1+d.length,v);if(!_){m=!0;break}d.push(_)}if(!m)if(Array.isArray(p)&&p.length!==d.length)u.error("Expected "+p.length+" arguments, but found "+d.length+" instead.");else{for(var b=0;b<d.length;b++){var x=Array.isArray(p)?p[b]:p.type,w=d[b];u.concat(b+1).checkSubtype(x,w.type)}if(0===u.errors.length)return new Ce(n,o,f,d)}}if(1===s.length)(e=t.errors).push.apply(e,u.errors);else{for(var S=(s.length?s:a).map(function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(re).join(", ")+")":"("+re(e.type)+"...)"}).join(" | "),E=[],C=1;C<r.length;C++){var M=t.parse(r[C],1+E.length);if(!M)return null;E.push(re(M.type))}t.error("Expected arguments of type "+S+", but found ("+E.join(", ")+") instead.")}return null},Ce.register=function(t,e){for(var r in Ce.definitions=e)t[r]=Ce};function Me(t,e,r){this.type=Jt,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e}Me.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var r=t[1];if("object"!=typeof r||Array.isArray(r))return e.error("Collator options argument must be an object.");var n=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,Xt);if(!n)return null;var i=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,Xt);if(!i)return null;var o=null;return r.locale&&!(o=e.parse(r.locale,1,Wt))?null:new Me(n,i,o)},Me.prototype.evaluate=function(t){return new se(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Me.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Me.prototype.outputDefined=function(){return!1},Me.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};function Te(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}Te.prototype.setNorthEast=function(t){return this._ne=t instanceof Pe?new Pe(t.lng,t.lat):Pe.convert(t),this},Te.prototype.setSouthWest=function(t){return this._sw=t instanceof Pe?new Pe(t.lng,t.lat):Pe.convert(t),this},Te.prototype.extend=function(t){var e,r,n=this._sw,i=this._ne;if(t instanceof Pe)r=e=t;else{if(!(t instanceof Te))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Te.convert(t)):this.extend(Pe.convert(t)):this;if(r=t._ne,!(e=t._sw)||!r)return this}return n||i?(n.lng=Math.min(e.lng,n.lng),n.lat=Math.min(e.lat,n.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new Pe(e.lng,e.lat),this._ne=new Pe(r.lng,r.lat)),this},Te.prototype.getCenter=function(){return new Pe((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Te.prototype.getSouthWest=function(){return this._sw},Te.prototype.getNorthEast=function(){return this._ne},Te.prototype.getNorthWest=function(){return new Pe(this.getWest(),this.getNorth())},Te.prototype.getSouthEast=function(){return new Pe(this.getEast(),this.getSouth())},Te.prototype.getWest=function(){return this._sw.lng},Te.prototype.getSouth=function(){return this._sw.lat},Te.prototype.getEast=function(){return this._ne.lng},Te.prototype.getNorth=function(){return this._ne.lat},Te.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Te.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Te.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Te.prototype.contains=function(t){var e=Pe.convert(t),r=e.lng,n=e.lat,i=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i},Te.convert=function(t){return!t||t instanceof Te?t:new Te(t)};var Pe=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,90<this.lat||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Pe.prototype.wrap=function(){return new Pe(u(this.lng,-180,180),this.lat)},Pe.prototype.toArray=function(){return[this.lng,this.lat]},Pe.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Pe.prototype.distanceTo=function(t){var e=Math.PI/180,r=this.lat*e,n=t.lat*e,i=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return 6371008.8*Math.acos(Math.min(i,1))},Pe.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,r=e/Math.cos(Math.PI/180*this.lat);return new Te(new Pe(this.lng-r,this.lat-e),new Pe(this.lng+r,this.lat+e))},Pe.convert=function(t){if(t instanceof Pe)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Pe(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Pe(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Oe=2*Math.PI*6371008.8;function Ae(t){return Oe*Math.cos(t*Math.PI/180)}function Ie(t){return(180+t)/360}function Le(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Re(t,e){return t/Ae(e)}function Ne(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var ke=function(t,e,r){void 0===r&&(r=0),this.x=+t,this.y=+e,this.z=+r};ke.fromLngLat=function(t,e){void 0===e&&(e=0);var r=Pe.convert(t);return new ke(Ie(r.lng),Le(r.lat),Re(e,r.lat))},ke.prototype.toLngLat=function(){return new Pe(360*this.x-180,Ne(this.y))},ke.prototype.toAltitude=function(){return this.z*Ae(Ne(this.y))},ke.prototype.meterInMercatorCoordinateUnits=function(){return 1/Oe*(t=Ne(this.y),1/Math.cos(t*Math.PI/180));var t};var De=8192;function je(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ze(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Fe(t,e){for(var r,n,i,o,a,s,u,c=!1,l=0,h=e.length;l<h;l++)for(var p=e[l],f=0,d=p.length;f<d-1;f++){if((o=(r=t)[0]-(n=p[f])[0])*(u=r[1]-(i=p[f+1])[1])-(s=r[0]-i[0])*(a=r[1]-n[1])==0&&o*s<=0&&a*u<=0)return!1;m=t,g=p[f],y=p[f+1],g[1]>m[1]!=y[1]>m[1]&&m[0]<(y[0]-g[0])*(m[1]-g[1])/(y[1]-g[1])+g[0]&&(c=!c)}var m,g,y;return c}function Be(t,e){for(var r=0;r<e.length;r++)if(Fe(t,e[r]))return!0;return!1}function Ue(t,e,r,n){var i=n[0]-r[0],o=n[1]-r[1];return((t[0]-r[0])*o-i*(t[1]-r[1]))*((e[0]-r[0])*o-i*(e[1]-r[1]))<0}function Ve(t,e,r){for(var n=0,i=r;n<i.length;n+=1)for(var o=i[n],a=0;a<o.length-1;++a)if(0!=(h=[(l=o[a+1])[0]-(c=o[a])[0],l[1]-c[1]])[0]*(p=[(u=e)[0]-(s=t)[0],u[1]-s[1]])[1]-h[1]*p[0]&&Ue(s,u,c,l)&&Ue(c,l,s,u))return!0;var s,u,c,l,h,p;return!1}function Ge(t,e){for(var r=0;r<t.length;++r)if(!Fe(t[r],e))return!1;for(var n=0;n<t.length-1;++n)if(Ve(t[n],t[n+1],e))return!1;return!0}function qe(t,e){for(var r=0;r<e.length;r++)if(Ge(t,e[r]))return!0;return!1}function He(t,e,r){for(var n=[],i=0;i<t.length;i++){for(var o=[],a=0;a<t[i].length;a++){var s=(u=t[i][a],c=r,void 0,l=ke.fromLngLat({lng:u[0],lat:u[1]},0),h=Math.pow(2,c.z),[Math.round(l.x*h*De),Math.round(l.y*h*De)]);je(e,s),o.push(s)}n.push(o)}var u,c,l,h;return n}function $e(t,e,r){for(var n=[],i=0;i<t.length;i++){var o=He(t[i],e,r);n.push(o)}return n}var We=function(t,e){this.type=Xt,this.geojson=t,this.geometries=e};function Xe(t){if(t instanceof Ce){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof We)return!1;var e=!0;return t.eachChild(function(t){e&&!Xe(t)&&(e=!1)}),e}function Ye(t){if(t instanceof Ce&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild(function(t){e&&!Ye(t)&&(e=!1)}),e}function Ze(t,e){if(t instanceof Ce&&0<=e.indexOf(t.name))return!1;var r=!0;return t.eachChild(function(t){r&&!Ze(t,e)&&(r=!1)}),r}We.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(pe(t[1])){var r=t[1];if("FeatureCollection"===r.type)for(var n=0;n<r.features.length;++n){var i=r.features[n].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new We(r,r.features[n].geometry)}else if("Feature"===r.type){var o=r.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new We(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new We(r,r)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},We.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){for(var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID(),o=[i.x*De,i.y*De],a=[],s=0,u=t.geometry();s<u.length;s+=1)for(var c=0,l=u[s];c<l.length;c+=1){var h=l[c],p=[h.x+o[0],h.y+o[1]];je(r,p),a.push(p)}if("Polygon"===e.type){var f=He(e.coordinates,n,i);if(!ze(r,n))return!1;for(var d=0,m=a;d<m.length;d+=1)if(!Fe(m[d],f))return!1}if("MultiPolygon"===e.type){var g=$e(e.coordinates,n,i);if(!ze(r,n))return!1;for(var y=0,v=a;y<v.length;y+=1)if(!Be(v[y],g))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){for(var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID(),o=[i.x*De,i.y*De],a=[],s=0,u=t.geometry();s<u.length;s+=1){for(var c=[],l=0,h=u[s];l<h.length;l+=1){var p=h[l],f=[p.x+o[0],p.y+o[1]];je(r,f),c.push(f)}a.push(c)}if("Polygon"===e.type){var d=He(e.coordinates,n,i);if(!ze(r,n))return!1;for(var m=0,g=a;m<g.length;m+=1)if(!Ge(g[m],d))return!1}if("MultiPolygon"===e.type){var y=$e(e.coordinates,n,i);if(!ze(r,n))return!1;for(var v=0,_=a;v<_.length;v+=1)if(!qe(_[v],y))return!1}return!0}(t,this.geometries)}return!1},We.prototype.eachChild=function(){},We.prototype.outputDefined=function(){return!0},We.prototype.serialize=function(){return["within",this.geojson]};function Ke(t,e){this.type=e.type,this.name=t,this.boundExpression=e}Ke.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new Ke(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},Ke.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ke.prototype.eachChild=function(){},Ke.prototype.outputDefined=function(){return!1},Ke.prototype.serialize=function(){return["var",this.name]};var Je=function(t,e,r,n,i){void 0===e&&(e=[]),void 0===n&&(n=new Ut),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map(function(t){return"["+t+"]"}).join(""),this.scope=n,this.errors=i,this.expectedType=r};function Qe(t,e){for(var r,n=t.length-1,i=0,o=n,a=0;i<=o;)if((r=t[a=Math.floor((i+o)/2)])<=e){if(a===n||e<t[a+1])return a;i=a+1}else{if(!(e<r))throw new ge("Input is not a number.");o=a-1}return 0}Je.prototype.parse=function(t,e,r,n,i){return void 0===i&&(i={}),e?this.concat(e,r,n)._parse(t,i):this._parse(t,i)},Je.prototype._parse=function(t,e){function r(t,e,r){return"assert"===r?new ye(e,[t]):"coerce"===r?new xe(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var n=t[0];if("string"!=typeof n)return this.error("Expression name must be a string, but found "+typeof n+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[n];if(i){var o=i.parse(t,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind&&"resolvedImage"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=r(o,a,e.typeAnnotation||"coerce");else o=r(o,a,e.typeAnnotation||"assert")}if(!(o instanceof me)&&"resolvedImage"!==o.type.kind&&function e(t){if(t instanceof Ke)return e(t.boundExpression);if(t instanceof Ce&&"error"===t.name)return!1;if(t instanceof Me)return!1;if(t instanceof We)return!1;var r=t instanceof xe||t instanceof ye,n=!0;return t.eachChild(function(t){n=r?n&&e(t):n&&t instanceof me}),!!n&&Xe(t)&&Ze(t,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(o)){var u=new Se;try{o=new me(o.type,o.evaluate(u))}catch(t){return this.error(t.message),null}}return o}return this.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Je.prototype.concat=function(t,e,r){var n="number"==typeof t?this.path.concat(t):this.path,i=r?this.scope.concat(r):this.scope;return new Je(this.registry,n,e||null,i,this.errors)},Je.prototype.error=function(t){for(var e=[],r=arguments.length-1;0<r--;)e[r]=arguments[r+1];var n=""+this.key+e.map(function(t){return"["+t+"]"}).join("");this.errors.push(new Gt(n,t))},Je.prototype.checkSubtype=function(t,e){var r=ie(t,e);return r&&this.error(r),r};var tr=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var n=0,i=r;n<i.length;n+=1){var o=i[n],a=o[1];this.labels.push(o[0]),this.outputs.push(a)}};tr.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var r=e.parse(t[1],1,$t);if(!r)return null;var n=[],i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var o=1;o<t.length;o+=2){var a=1===o?-1/0:t[o],s=t[o+1],u=o,c=o+1;if("number"!=typeof a)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(n.length&&n[n.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var l=e.parse(s,c,i);if(!l)return null;i=i||l.type,n.push([a,l])}return new tr(i,r,n)},tr.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;return n>=e[i-1]?r[i-1].evaluate(t):r[Qe(e,n)].evaluate(t)},tr.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},tr.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},tr.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)0<e&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var er=rr;function rr(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}function nr(t,e,r){return t*(1-r)+e*r}rr.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},rr.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},rr.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},rr.prototype.solveCurveX=function(t,e){var r,n,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;o<t?r=i:n=i,i=.5*(n-r)+r}return i},rr.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var ir=Object.freeze({__proto__:null,number:nr,color:function(t,e,r){return new ae(nr(t.r,e.r,r),nr(t.g,e.g,r),nr(t.b,e.b,r),nr(t.a,e.a,r))},array:function(t,r,n){return t.map(function(t,e){return nr(t,r[e],n)})}}),or=4/29,ar=6/29,sr=3*ar*ar,ur=ar*ar*ar,cr=Math.PI/180,lr=180/Math.PI;function hr(t){return ur<t?Math.pow(t,1/3):t/sr+or}function pr(t){return ar<t?t*t*t:sr*(t-or)}function fr(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function dr(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function mr(t){var e=dr(t.r),r=dr(t.g),n=dr(t.b),i=hr((.4124564*e+.3575761*r+.1804375*n)/.95047),o=hr((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-hr((.0193339*e+.119192*r+.9503041*n)/1.08883)),alpha:t.a}}function gr(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*pr(e),r=.95047*pr(r),n=1.08883*pr(n),new ae(fr(3.2404542*r-1.5371385*e-.4985314*n),fr(-.969266*r+1.8760108*e+.041556*n),fr(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}var yr={forward:mr,reverse:gr,interpolate:function(t,e,r){return{l:nr(t.l,e.l,r),a:nr(t.a,e.a,r),b:nr(t.b,e.b,r),alpha:nr(t.alpha,e.alpha,r)}}},vr={forward:function(t){var e=mr(t),r=e.l,n=e.a,i=e.b,o=Math.atan2(i,n)*lr;return{h:o<0?360+o:o,c:Math.sqrt(n*n+i*i),l:r,alpha:t.a}},reverse:function(t){var e=t.h*cr,r=t.c;return gr({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:function(t,e,r){var n=e-t;return t+r*(180<n||n<-180?n-360*Math.round(n/360):n)}(t.h,e.h,r),c:nr(t.c,e.c,r),l:nr(t.l,e.l,r),alpha:nr(t.alpha,e.alpha,r)}}},_r=Object.freeze({__proto__:null,lab:yr,hcl:vr}),br=function(t,e,r,n,i){this.type=t,this.operator=e,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(var o=0,a=i;o<a.length;o+=1){var s=a[o],u=s[1];this.labels.push(s[0]),this.outputs.push(u)}};function xr(t,e,r,n){var i=n-r,o=t-r;return 0==i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}br.interpolationFactor=function(t,e,r,n){var i=0;if("exponential"===t.name)i=xr(e,t.base,r,n);else if("linear"===t.name)i=xr(e,1,r,n);else if("cubic-bezier"===t.name){var o=t.controlPoints;i=new er(o[0],o[1],o[2],o[3]).solve(xr(e,1,r,n))}return i},br.parse=function(t,e){var r=t[0],n=t[1],i=t[2],o=t.slice(3);if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){var a=n[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:a}}else{if("cubic-bezier"!==n[0])return e.error("Unknown interpolation type "+String(n[0]),1,0);var s=n.slice(1);if(4!==s.length||s.some(function(t){return"number"!=typeof t||t<0||1<t}))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,$t)))return null;var u=[],c=null;"interpolate-hcl"===r||"interpolate-lab"===r?c=Yt:e.expectedType&&"value"!==e.expectedType.kind&&(c=e.expectedType);for(var l=0;l<o.length;l+=2){var h=o[l],p=o[l+1],f=l+3,d=l+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(u.length&&u[u.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);var m=e.parse(p,d,c);if(!m)return null;c=c||m.type,u.push([h,m])}return"number"===c.kind||"color"===c.kind||"array"===c.kind&&"number"===c.itemType.kind&&"number"==typeof c.N?new br(c,r,n,i,u):e.error("Type "+re(c)+" is not interpolatable.")},br.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;if(n>=e[i-1])return r[i-1].evaluate(t);var o=Qe(e,n),a=br.interpolationFactor(this.interpolation,n,e[o],e[o+1]),s=r[o].evaluate(t),u=r[o+1].evaluate(t);return"interpolate"===this.operator?ir[this.type.kind.toLowerCase()](s,u,a):"interpolate-hcl"===this.operator?vr.reverse(vr.interpolate(vr.forward(s),vr.forward(u),a)):yr.reverse(yr.interpolate(yr.forward(s),yr.forward(u),a))},br.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},br.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},br.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e};var wr=function(t,e){this.type=t,this.args=e};wr.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,n=e.expectedType;n&&"value"!==n.kind&&(r=n);for(var i=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=e.parse(a[o],1+i.length,r,void 0,{typeAnnotation:"omit"});if(!s)return null;r=r||s.type,i.push(s)}var u=n&&i.some(function(t){return ie(n,t.type)});return new wr(u?Kt:r,i)},wr.prototype.evaluate=function(t){for(var e,r=null,n=0,i=0,o=this.args;i<o.length&&(n++,(r=o[i].evaluate(t))&&r instanceof le&&!r.available&&(e=e||r.name,r=null,n===this.args.length&&(r=e)),null===r);i+=1);return r},wr.prototype.eachChild=function(t){this.args.forEach(t)},wr.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},wr.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Sr=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};Sr.prototype.evaluate=function(t){return this.result.evaluate(t)},Sr.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1)t(r[e][1]);t(this.result)},Sr.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],n=1;n<t.length-1;n+=2){var i=t[n];if("string"!=typeof i)return e.error("Expected string, but found "+typeof i+" instead.",n);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);var o=e.parse(t[n+1],n+1);if(!o)return null;r.push([i,o])}var a=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return a?new Sr(r,a):null},Sr.prototype.outputDefined=function(){return this.result.outputDefined()},Sr.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var n=r[e];t.push(n[0],n[1].serialize())}return t.push(this.result.serialize()),t};function Er(t,e,r){this.type=t,this.index=e,this.input=r}Er.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,$t),n=e.parse(t[2],2,ee(e.expectedType||Kt));return r&&n?new Er(n.type.itemType,r,n):null},Er.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new ge("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new ge("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new ge("Array index must be an integer, but found "+e+" instead.");return r[e]},Er.prototype.eachChild=function(t){t(this.index),t(this.input)},Er.prototype.outputDefined=function(){return!1},Er.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};function Cr(t,e){this.type=Xt,this.needle=t,this.haystack=e}Cr.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r,n=e.parse(t[1],1,Kt),i=e.parse(t[2],2,Kt);return n&&i?"boolean"!==(r=n.type).kind&&"string"!==r.kind&&"number"!==r.kind&&"null"!==r.kind&&"value"!==r.kind?e.error("Expected first argument to be of type boolean, string, number or null, but found "+re(n.type)+" instead"):new Cr(n,i):null},Cr.prototype.evaluate=function(t){var e,r=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(null==r||!n)return!1;if("boolean"!=typeof r&&"string"!=typeof r&&"number"!=typeof r)throw new ge("Expected first argument to be of type boolean, string or number, but found "+re(fe(r))+" instead.");if(e=n,!Array.isArray(e)&&"string"!=typeof e)throw new ge("Expected second argument to be of type array or string, but found "+re(fe(n))+" instead.");return 0<=n.indexOf(r)},Cr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},Cr.prototype.outputDefined=function(){return!0},Cr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};function Mr(t,e,r,n,i,o){this.inputType=t,this.type=e,this.input=r,this.cases=n,this.outputs=i,this.otherwise=o}Mr.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var r,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var i={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],u=t[a+1];Array.isArray(s)||(s=[s]);var c=e.concat(a);if(0===s.length)return c.error("Expected at least one branch label.");for(var l=0,h=s;l<h.length;l+=1){var p=h[l];if("number"!=typeof p&&"string"!=typeof p)return c.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return c.error("Numeric branch labels must be integer values.");if(r){if(c.checkSubtype(r,fe(p)))return null}else r=fe(p);if(void 0!==i[String(p)])return c.error("Branch labels must be unique.");i[String(p)]=o.length}var f=e.parse(u,a,n);if(!f)return null;n=n||f.type,o.push(f)}var d=e.parse(t[1],1,Kt);if(!d)return null;var m=e.parse(t[t.length-1],t.length-1,n);return m?"value"!==d.type.kind&&e.concat(1).checkSubtype(r,d.type)?null:new Mr(r,n,d,i,o,m):null},Mr.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(fe(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},Mr.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},Mr.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},Mr.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],n={},i=0,o=Object.keys(this.cases).sort();i<o.length;i+=1){var a=o[i];void 0===(h=n[this.cases[a]])?(n[this.cases[a]]=r.length,r.push([this.cases[a],[a]])):r[h][1].push(a)}for(var s=function(t){return"number"===e.inputType.kind?Number(t):t},u=0,c=r;u<c.length;u+=1){var l=c[u],h=l[0],p=l[1];t.push(1===p.length?s(p[0]):p.map(s)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};function Tr(t,e,r){this.type=t,this.branches=e,this.otherwise=r}function Pr(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Or(t,e,r,n){return 0===n.compare(e,r)}function Ar(s,u,c){var l="=="!==s&&"!="!==s;return a.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var r=t[0],n=e.parse(t[1],1,Kt);if(!n)return null;if(!Pr(r,n.type))return e.concat(1).error('"'+r+"\" comparisons are not supported for type '"+re(n.type)+"'.");var i=e.parse(t[2],2,Kt);if(!i)return null;if(!Pr(r,i.type))return e.concat(2).error('"'+r+"\" comparisons are not supported for type '"+re(i.type)+"'.");if(n.type.kind!==i.type.kind&&"value"!==n.type.kind&&"value"!==i.type.kind)return e.error("Cannot compare types '"+re(n.type)+"' and '"+re(i.type)+"'.");l&&("value"===n.type.kind&&"value"!==i.type.kind?n=new ye(i.type,[n]):"value"!==n.type.kind&&"value"===i.type.kind&&(i=new ye(n.type,[i])));var o=null;if(4===t.length){if("string"!==n.type.kind&&"string"!==i.type.kind&&"value"!==n.type.kind&&"value"!==i.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(o=e.parse(t[3],3,Jt)))return null}return new a(n,i,o)},a.prototype.evaluate=function(t){var e=this.lhs.evaluate(t),r=this.rhs.evaluate(t);if(l&&this.hasUntypedArgument){var n=fe(e),i=fe(r);if(n.kind!==i.kind||"string"!==n.kind&&"number"!==n.kind)throw new ge('Expected arguments for "'+s+'" to be (string, string) or (number, number), but found ('+n.kind+", "+i.kind+") instead.")}if(this.collator&&!l&&this.hasUntypedArgument){var o=fe(e),a=fe(r);if("string"!==o.kind||"string"!==a.kind)return u(t,e,r)}return this.collator?c(t,e,r,this.collator.evaluate(t)):u(t,e,r)},a.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},a.prototype.outputDefined=function(){return!0},a.prototype.serialize=function(){var e=[s];return this.eachChild(function(t){e.push(t.serialize())}),e},a;function a(t,e,r){this.type=Xt,this.lhs=t,this.rhs=e,this.collator=r,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}}Tr.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var n=[],i=1;i<t.length-1;i+=2){var o=e.parse(t[i],i,Xt);if(!o)return null;var a=e.parse(t[i+1],i+1,r);if(!a)return null;n.push([o,a]),r=r||a.type}var s=e.parse(t[t.length-1],t.length-1,r);return s?new Tr(r,n,s):null},Tr.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[1];if(n[0].evaluate(t))return i.evaluate(t)}return this.otherwise.evaluate(t)},Tr.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[1];t(n[0]),t(i)}t(this.otherwise)},Tr.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Tr.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};function Ir(t,e,r,n,i){this.type=Wt,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=n,this.maxFractionDigits=i}var Lr=Ar("==",function(t,e,r){return e===r},Or),Rr=Ar("!=",function(t,e,r){return e!==r},function(t,e,r,n){return!Or(0,e,r,n)}),Nr=Ar("<",function(t,e,r){return e<r},function(t,e,r,n){return n.compare(e,r)<0}),kr=Ar(">",function(t,e,r){return r<e},function(t,e,r,n){return 0<n.compare(e,r)}),Dr=Ar("<=",function(t,e,r){return e<=r},function(t,e,r,n){return n.compare(e,r)<=0}),jr=Ar(">=",function(t,e,r){return r<=e},function(t,e,r,n){return 0<=n.compare(e,r)});Ir.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,$t);if(!r)return null;var n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");var i=null;if(n.locale&&!(i=e.parse(n.locale,1,Wt)))return null;var o=null;if(n.currency&&!(o=e.parse(n.currency,1,Wt)))return null;var a=null;if(n["min-fraction-digits"]&&!(a=e.parse(n["min-fraction-digits"],1,$t)))return null;var s=null;return n["max-fraction-digits"]&&!(s=e.parse(n["max-fraction-digits"],1,$t))?null:new Ir(r,i,o,a,s)},Ir.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Ir.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Ir.prototype.outputDefined=function(){return!1},Ir.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};function zr(t){this.type=$t,this.input=t}zr.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error("Expected argument of type string or array, but found "+re(r.type)+" instead."):new zr(r):null},zr.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ge("Expected value to be of type string or array, but found "+re(fe(e))+" instead.")},zr.prototype.eachChild=function(t){t(this.input)},zr.prototype.outputDefined=function(){return!1},zr.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Fr={"==":Lr,"!=":Rr,">":kr,"<":Nr,">=":jr,"<=":Dr,array:ye,at:Er,boolean:ye,case:Tr,coalesce:wr,collator:Me,format:_e,image:be,in:Cr,interpolate:br,"interpolate-hcl":br,"interpolate-lab":br,length:zr,let:Sr,literal:me,match:Mr,number:ye,"number-format":Ir,object:ye,step:tr,string:ye,"to-boolean":xe,"to-color":xe,"to-number":xe,"to-string":xe,var:Ke,within:We};function Br(t,e){var r=e[0],n=e[1],i=e[2],o=e[3];r=r.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);var a=o?o.evaluate(t):1,s=he(r,n,i,a);if(s)throw new ge(s);return new ae(r/255*a,n/255*a,i/255*a,a)}function Ur(t,e){return t in e}function Vr(t,e){var r=e[t];return void 0===r?null:r}function Gr(t){return{type:t}}function qr(t){return{result:"success",value:t}}function Hr(t){return{result:"error",value:t}}function $r(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Wr(t){return!!t.expression&&-1<t.expression.parameters.indexOf("zoom")}function Xr(t){return!!t.expression&&t.expression.interpolated}function Yr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Zr(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Kr(t){return t}function Jr(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function Qr(t,e,r,n,i){return Jr(typeof r===i?n[r]:void 0,t.default,e.default)}function tn(t,e,r){if("number"!==Yr(r))return Jr(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];var i=Qe(t.stops.map(function(t){return t[0]}),r);return t.stops[i][1]}function en(t,e,r){var n=void 0!==t.base?t.base:1;if("number"!==Yr(r))return Jr(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];var o,a,s,u,c,l=Qe(t.stops.map(function(t){return t[0]}),r),h=(o=r,a=n,s=t.stops[l][0],u=t.stops[l+1][0]-s,c=o-s,0==u?0:1===a?c/u:(Math.pow(a,c)-1)/(Math.pow(a,u)-1)),p=t.stops[l][1],f=t.stops[l+1][1],d=ir[e.type]||Kr;if(t.colorSpace&&"rgb"!==t.colorSpace){var m=_r[t.colorSpace];d=function(t,e){return m.reverse(m.interpolate(m.forward(t),m.forward(e),h))}}return"function"==typeof p.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=p.evaluate.apply(void 0,t),n=f.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==n)return d(r,n,h)}}:d(p,f,h)}function rn(t,e,r){return"color"===e.type?r=ae.parse(r):"formatted"===e.type?r=ce.fromString(r.toString()):"resolvedImage"===e.type?r=le.fromString(r.toString()):Yr(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),Jr(r,t.default,e.default)}Ce.register(Fr,{error:[{kind:"error"},[Wt],function(t,e){throw new ge(e[0].evaluate(t))}],typeof:[Wt,[Kt],function(t,e){return re(fe(e[0].evaluate(t)))}],"to-rgba":[ee($t,4),[Yt],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Yt,[$t,$t,$t],Br],rgba:[Yt,[$t,$t,$t,$t],Br],has:{type:Xt,overloads:[[[Wt],function(t,e){return Ur(e[0].evaluate(t),t.properties())}],[[Wt,Zt],function(t,e){var r=e[1];return Ur(e[0].evaluate(t),r.evaluate(t))}]]},get:{type:Kt,overloads:[[[Wt],function(t,e){return Vr(e[0].evaluate(t),t.properties())}],[[Wt,Zt],function(t,e){var r=e[1];return Vr(e[0].evaluate(t),r.evaluate(t))}]]},"feature-state":[Kt,[Wt],function(t,e){return Vr(e[0].evaluate(t),t.featureState||{})}],properties:[Zt,[],function(t){return t.properties()}],"geometry-type":[Wt,[],function(t){return t.geometryType()}],id:[Kt,[],function(t){return t.id()}],zoom:[$t,[],function(t){return t.globals.zoom}],"heatmap-density":[$t,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[$t,[],function(t){return t.globals.lineProgress||0}],accumulated:[Kt,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[$t,Gr($t),function(t,e){for(var r=0,n=0,i=e;n<i.length;n+=1)r+=i[n].evaluate(t);return r}],"*":[$t,Gr($t),function(t,e){for(var r=1,n=0,i=e;n<i.length;n+=1)r*=i[n].evaluate(t);return r}],"-":{type:$t,overloads:[[[$t,$t],function(t,e){var r=e[1];return e[0].evaluate(t)-r.evaluate(t)}],[[$t],function(t,e){return-e[0].evaluate(t)}]]},"/":[$t,[$t,$t],function(t,e){var r=e[1];return e[0].evaluate(t)/r.evaluate(t)}],"%":[$t,[$t,$t],function(t,e){var r=e[1];return e[0].evaluate(t)%r.evaluate(t)}],ln2:[$t,[],function(){return Math.LN2}],pi:[$t,[],function(){return Math.PI}],e:[$t,[],function(){return Math.E}],"^":[$t,[$t,$t],function(t,e){var r=e[1];return Math.pow(e[0].evaluate(t),r.evaluate(t))}],sqrt:[$t,[$t],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[$t,[$t],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[$t,[$t],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[$t,[$t],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[$t,[$t],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[$t,[$t],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[$t,[$t],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[$t,[$t],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[$t,[$t],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[$t,[$t],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[$t,Gr($t),function(e,t){return Math.min.apply(Math,t.map(function(t){return t.evaluate(e)}))}],max:[$t,Gr($t),function(e,t){return Math.max.apply(Math,t.map(function(t){return t.evaluate(e)}))}],abs:[$t,[$t],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[$t,[$t],function(t,e){var r=e[0].evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[$t,[$t],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[$t,[$t],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[Xt,[Wt,Kt],function(t,e){var r=e[0],n=e[1];return t.properties()[r.value]===n.value}],"filter-id-==":[Xt,[Kt],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[Xt,[Wt],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[Xt,[Wt,Kt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i<o}],"filter-id-<":[Xt,[Kt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<i}],"filter->":[Xt,[Wt,Kt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&o<i}],"filter-id->":[Xt,[Kt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&i<n}],"filter-<=":[Xt,[Wt,Kt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[Xt,[Kt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<=i}],"filter->=":[Xt,[Wt,Kt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&o<=i}],"filter-id->=":[Xt,[Kt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&i<=n}],"filter-has":[Xt,[Kt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[Xt,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[Xt,[ee(Wt)],function(t,e){return 0<=e[0].value.indexOf(t.geometryType())}],"filter-id-in":[Xt,[ee(Kt)],function(t,e){return 0<=e[0].value.indexOf(t.id())}],"filter-in-small":[Xt,[Wt,ee(Kt)],function(t,e){var r=e[0];return 0<=e[1].value.indexOf(t.properties()[r.value])}],"filter-in-large":[Xt,[Wt,ee(Kt)],function(t,e){var r=e[0],n=e[1];return function(t,e,r,n){for(;r<=n;){var i=r+n>>1;if(e[i]===t)return!0;e[i]>t?n=i-1:r=1+i}return!1}(t.properties()[r.value],n.value,0,n.value.length-1)}],all:{type:Xt,overloads:[[[Xt,Xt],function(t,e){var r=e[1];return e[0].evaluate(t)&&r.evaluate(t)}],[Gr(Xt),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(!n[r].evaluate(t))return!1;return!0}]]},any:{type:Xt,overloads:[[[Xt,Xt],function(t,e){var r=e[1];return e[0].evaluate(t)||r.evaluate(t)}],[Gr(Xt),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(n[r].evaluate(t))return!0;return!1}]]},"!":[Xt,[Xt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[Xt,[Wt],function(t,e){var r=t.globals&&t.globals.isSupportedScript;return!r||r(e[0].evaluate(t))}],upcase:[Wt,[Wt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Wt,[Wt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Wt,Gr(Kt),function(e,t){return t.map(function(t){return de(t.evaluate(e))}).join("")}],"resolved-locale":[Wt,[Jt],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var nn=function(t,e){var r;this.expression=t,this._warningHistory={},this._evaluator=new Se,this._defaultValue=e?"color"===(r=e).type&&Zr(r.default)?new ae(0,0,0,0):"color"===r.type?ae.parse(r.default)||null:void 0===r.default?null:r.default:null,this._enumValues=e&&"enum"===e.type?e.values:null};function on(t){return Array.isArray(t)&&0<t.length&&"string"==typeof t[0]&&t[0]in Fr}function an(t,e){var r,n,i=new Je(Fr,[],e?(n={color:Yt,string:Wt,number:$t,enum:Wt,boolean:Xt,formatted:Qt,resolvedImage:te},"array"===(r=e).type?ee(n[r.value]||Kt,r.length):n[r.type]):void 0),o=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return o?qr(new nn(o,e)):Hr(i.errors)}nn.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)},nn.prototype.evaluate=function(t,e,r,n,i,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null;try{var a=this.expression.evaluate(this._evaluator);if(null==a||"number"==typeof a&&a!=a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new ge("Expected value to be one of "+Object.keys(this._enumValues).map(function(t){return JSON.stringify(t)}).join(", ")+", but found "+JSON.stringify(a)+" instead.");return a}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var sn=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Ye(e.expression)};sn.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,o)},sn.prototype.evaluate=function(t,e,r,n,i,o){return this._styleExpression.evaluate(t,e,r,n,i,o)};var un=function(t,e,r,n){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Ye(e.expression),this.interpolationType=n};function cn(t,e){if("error"===(t=an(t,e)).result)return t;var r=t.value.expression,n=Xe(r);if(!n&&!$r(e))return Hr([new Gt("","data expressions not supported")]);var i=Ze(r,["zoom"]);if(!i&&!Wr(e))return Hr([new Gt("","zoom expressions not supported")]);var o=function r(t){var n=null;if(t instanceof Sr)n=r(t.result);else if(t instanceof wr)for(var e=0,i=t.args;e<i.length&&!(n=r(i[e]));e+=1);else(t instanceof tr||t instanceof br)&&t.input instanceof Ce&&"zoom"===t.input.name&&(n=t);return n instanceof Gt||t.eachChild(function(t){var e=r(t);e instanceof Gt?n=e:!n&&e?n=new Gt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&e&&n!==e&&(n=new Gt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}(r);return o||i?o instanceof Gt?Hr([o]):o instanceof br&&!Xr(e)?Hr([new Gt("",'"interpolate" expressions cannot be used with this property')]):qr(o?new un(n?"camera":"composite",t.value,o.labels,o instanceof br?o.interpolation:void 0):new sn(n?"constant":"source",t.value)):Hr([new Gt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}un.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,o)},un.prototype.evaluate=function(t,e,r,n,i,o){return this._styleExpression.evaluate(t,e,r,n,i,o)},un.prototype.interpolationFactor=function(t,e,r){return this.interpolationType?br.interpolationFactor(this.interpolationType,t,e,r):0};function ln(t,e){this._parameters=t,this._specification=e,zt(this,function t(n,i){var o,a,s,e="color"===i.type,r=n.stops&&"object"==typeof n.stops[0][0],u=r||!(r||void 0!==n.property),c=n.type||(Xr(i)?"exponential":"interval");if(e&&((n=zt({},n)).stops&&(n.stops=n.stops.map(function(t){return[t[0],ae.parse(t[1])]})),n.default=ae.parse(n.default?n.default:i.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!_r[n.colorSpace])throw new Error("Unknown color space: "+n.colorSpace);if("exponential"===c)o=en;else if("interval"===c)o=tn;else if("categorical"===c){o=Qr,a=Object.create(null);for(var l=0,h=n.stops;l<h.length;l+=1){var p=h[l];a[p[0]]=p[1]}s=typeof n.stops[0][0]}else{if("identity"!==c)throw new Error('Unknown function type "'+c+'"');o=rn}if(r){for(var f={},d=[],m=0;m<n.stops.length;m++){var g=n.stops[m],y=g[0].zoom;void 0===f[y]&&(f[y]={zoom:y,type:n.type,property:n.property,default:n.default,stops:[]},d.push(y)),f[y].stops.push([g[0].value,g[1]])}for(var v=[],_=0,b=d;_<b.length;_+=1){var x=b[_];v.push([f[x].zoom,t(f[x],i)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:br.interpolationFactor.bind(void 0,w),zoomStops:v.map(function(t){return t[0]}),evaluate:function(t,e){var r=t.zoom;return en({stops:v,base:n.base},i,r).evaluate(r,e)}}}if(u){var S="exponential"===c?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:br.interpolationFactor.bind(void 0,S),zoomStops:n.stops.map(function(t){return t[0]}),evaluate:function(t){return o(n,i,t.zoom,a,s)}}}return{kind:"source",evaluate:function(t,e){var r=e&&e.properties?e.properties[n.property]:void 0;return void 0===r?Jr(n.default,i.default):o(n,i,r,a,s)}}}(this._parameters,this._specification))}function hn(t){var e=t.key,r=t.value,n=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],u=Yr(r);if("object"!==u)return[new Dt(e,r,"object expected, "+u+" found")];for(var c in r){var l=c.split(".")[0],h=n[l]||n["*"],p=void 0;if(i[l])p=i[l];else if(n[l])p=Dn;else if(i["*"])p=i["*"];else{if(!n["*"]){s.push(new Dt(e,r[c],'unknown property "'+c+'"'));continue}p=Dn}s=s.concat(p({key:(e?e+".":e)+c,value:r[c],valueSpec:h,style:o,styleSpec:a,object:r,objectKey:c},r))}for(var f in n)i[f]||n[f].required&&void 0===n[f].default&&void 0===r[f]&&s.push(new Dt(e,r,'missing required property "'+f+'"'));return s}function pn(t){var e=t.value,r=t.valueSpec,n=t.style,i=t.styleSpec,o=t.key,a=t.arrayElementValidator||Dn;if("array"!==Yr(e))return[new Dt(o,e,"array expected, "+Yr(e)+" found")];if(r.length&&e.length!==r.length)return[new Dt(o,e,"array length "+r.length+" expected, length "+e.length+" found")];if(r["min-length"]&&e.length<r["min-length"])return[new Dt(o,e,"array length at least "+r["min-length"]+" expected, length "+e.length+" found")];var s={type:r.value,values:r.values};i.$version<7&&(s.function=r.function),"object"===Yr(r.value)&&(s=r.value);for(var u=[],c=0;c<e.length;c++)u=u.concat(a({array:e,arrayIndex:c,value:e[c],valueSpec:s,style:n,styleSpec:i,key:o+"["+c+"]"}));return u}function fn(t){var e=t.key,r=t.value,n=t.valueSpec,i=Yr(r);return"number"===i&&r!=r&&(i="NaN"),"number"!==i?[new Dt(e,r,"number expected, "+i+" found")]:"minimum"in n&&r<n.minimum?[new Dt(e,r,r+" is less than the minimum value "+n.minimum)]:"maximum"in n&&r>n.maximum?[new Dt(e,r,r+" is greater than the maximum value "+n.maximum)]:[]}function dn(t){var a,s,i,u=t.valueSpec,c=Ft(t.value.type),l={},e="categorical"!==c&&void 0===t.value.property,r=!e,o="array"===Yr(t.value.stops)&&"array"===Yr(t.value.stops[0])&&"object"===Yr(t.value.stops[0][0]),n=hn({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===c)return[new Dt(t.key,t.value,'identity function may not have a "stops" property')];var e=[],r=t.value;return e=e.concat(pn({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Yr(r)&&0===r.length&&e.push(new Dt(t.key,r,"array must have at least one stop")),e},default:function(t){return Dn({key:t.key,value:t.value,valueSpec:u,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===c&&e&&n.push(new Dt(t.key,t.value,'missing required property "property"')),"identity"===c||t.value.stops||n.push(new Dt(t.key,t.value,'missing required property "stops"')),"exponential"===c&&t.valueSpec.expression&&!Xr(t.valueSpec)&&n.push(new Dt(t.key,t.value,"exponential functions not supported")),8<=t.styleSpec.$version&&(r&&!$r(t.valueSpec)?n.push(new Dt(t.key,t.value,"property functions not supported")):e&&!Wr(t.valueSpec)&&n.push(new Dt(t.key,t.value,"zoom functions not supported"))),"categorical"!==c&&!o||void 0!==t.value.property||n.push(new Dt(t.key,t.value,'"property" property is required')),n;function h(t){var e=[],r=t.value,n=t.key;if("array"!==Yr(r))return[new Dt(n,r,"array expected, "+Yr(r)+" found")];if(2!==r.length)return[new Dt(n,r,"array length 2 expected, length "+r.length+" found")];if(o){if("object"!==Yr(r[0]))return[new Dt(n,r,"object expected, "+Yr(r[0])+" found")];if(void 0===r[0].zoom)return[new Dt(n,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new Dt(n,r,"object stop key must have value")];if(i&&i>Ft(r[0].zoom))return[new Dt(n,r[0].zoom,"stop zoom values must appear in ascending order")];Ft(r[0].zoom)!==i&&(i=Ft(r[0].zoom),s=void 0,l={}),e=e.concat(hn({key:n+"[0]",value:r[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:fn,value:p}}))}else e=e.concat(p({key:n+"[0]",value:r[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},r));return on(Bt(r[1]))?e.concat([new Dt(n+"[1]",r[1],"expressions are not allowed in function stops.")]):e.concat(Dn({key:n+"[1]",value:r[1],valueSpec:u,style:t.style,styleSpec:t.styleSpec}))}function p(t,e){var r=Yr(t.value),n=Ft(t.value),i=null!==t.value?t.value:e;if(a){if(r!==a)return[new Dt(t.key,i,r+" stop domain type must match previous stop domain type "+a)]}else a=r;if("number"!==r&&"string"!==r&&"boolean"!==r)return[new Dt(t.key,i,"stop domain value must be a number, string, or boolean")];if("number"===r||"categorical"===c)return"categorical"!==c||"number"!==r||isFinite(n)&&Math.floor(n)===n?"categorical"!==c&&"number"===r&&void 0!==s&&n<s?[new Dt(t.key,i,"stop domain values must appear in ascending order")]:(s=n,"categorical"===c&&n in l?[new Dt(t.key,i,"stop domain values must be unique")]:(l[n]=!0,[])):[new Dt(t.key,i,"integer expected, found "+n)];var o="number expected, "+r+" found";return $r(u)&&void 0===c&&(o+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Dt(t.key,i,o)]}}function mn(e){var t=("property"===e.expressionContext?cn:an)(Bt(e.value),e.valueSpec);if("error"===t.result)return t.value.map(function(t){return new Dt(""+e.key+t.key,e.value,t.message)});var r=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!r.outputDefined())return[new Dt(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Ye(r))return[new Dt(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!Ye(r))return[new Dt(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Ze(r,["zoom","feature-state"]))return[new Dt(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Xe(r))return[new Dt(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function gn(t){var e=t.key,r=t.value,n=t.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(Ft(r))&&i.push(new Dt(e,r,"expected one of ["+n.values.join(", ")+"], "+JSON.stringify(r)+" found")):-1===Object.keys(n.values).indexOf(Ft(r))&&i.push(new Dt(e,r,"expected one of ["+Object.keys(n.values).join(", ")+"], "+JSON.stringify(r)+" found")),i}function yn(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return 2<=t.length&&"$id"!==t[1]&&"$type"!==t[1];case"in":return 3<=t.length&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var n=r[e];if(!yn(n)&&"boolean"!=typeof n)return!1}return!0;default:return!0}}ln.deserialize=function(t){return new ln(t._parameters,t._specification)};var vn={type:"boolean",default:!(ln.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}}),transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _n(t){if(null==t)return{filter:function(){return!0},needGeometry:!1};yn(t)||(t=xn(t));var n=an(t,vn);if("error"===n.result)throw new Error(n.value.map(function(t){return t.key+": "+t.message}).join(", "));return{filter:function(t,e,r){return n.value.evaluate(t,e,{},r)},needGeometry:Array.isArray(t)&&0!==t.length&&"within"===t[0]}}function bn(t,e){return t<e?-1:e<t?1:0}function xn(t){if(!t)return!0;var e,r=t[0];return t.length<=1?"any"!==r:"=="===r?wn(t[1],t[2],"=="):"!="===r?Cn(wn(t[1],t[2],"==")):"<"===r||">"===r||"<="===r||">="===r?wn(t[1],t[2],r):"any"===r?(e=t.slice(1),["any"].concat(e.map(xn))):"all"===r?["all"].concat(t.slice(1).map(xn)):"none"===r?["all"].concat(t.slice(1).map(xn).map(Cn)):"in"===r?Sn(t[1],t.slice(2)):"!in"===r?Cn(Sn(t[1],t.slice(2))):"has"===r?En(t[1]):"!has"!==r||Cn(En(t[1]))}function wn(t,e,r){switch(t){case"$type":return["filter-type-"+r,e];case"$id":return["filter-id-"+r,e];default:return["filter-"+r,t,e]}}function Sn(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return 200<e.length&&!e.some(function(t){return typeof t!=typeof e[0]})?["filter-in-large",t,["literal",e.sort(bn)]]:["filter-in-small",t,["literal",e]]}}function En(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Cn(t){return["!",t]}function Mn(t){return yn(Bt(t.value))?mn(zt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var r=e.value,n=e.key;if("array"!==Yr(r))return[new Dt(n,r,"array expected, "+Yr(r)+" found")];var i,o=e.styleSpec,a=[];if(r.length<1)return[new Dt(n,r,"filter array must have at least 1 element")];switch(a=a.concat(gn({key:n+"[0]",value:r[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),Ft(r[0])){case"<":case"<=":case">":case">=":2<=r.length&&"$type"===Ft(r[1])&&a.push(new Dt(n,r,'"$type" cannot be use with operator "'+r[0]+'"'));case"==":case"!=":3!==r.length&&a.push(new Dt(n,r,'filter array for operator "'+r[0]+'" must have 3 elements'));case"in":case"!in":2<=r.length&&"string"!==(i=Yr(r[1]))&&a.push(new Dt(n+"[1]",r[1],"string expected, "+i+" found"));for(var s=2;s<r.length;s++)i=Yr(r[s]),"$type"===Ft(r[1])?a=a.concat(gn({key:n+"["+s+"]",value:r[s],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new Dt(n+"["+s+"]",r[s],"string, number, or boolean expected, "+i+" found"));break;case"any":case"all":case"none":for(var u=1;u<r.length;u++)a=a.concat(t({key:n+"["+u+"]",value:r[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Yr(r[1]),2!==r.length?a.push(new Dt(n,r,'filter array for "'+r[0]+'" operator must have 2 elements')):"string"!==i&&a.push(new Dt(n+"[1]",r[1],"string expected, "+i+" found"))}return a}(t)}function Tn(t,e){var r=t.key,n=t.style,i=t.styleSpec,o=t.value,a=t.objectKey,s=i[e+"_"+t.layerType];if(!s)return[];var u=a.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return Dn({key:r,value:o,valueSpec:i.transition,style:n,styleSpec:i});var c,l=t.valueSpec||s[a];if(!l)return[new Dt(r,o,'unknown property "'+a+'"')];if("string"===Yr(o)&&$r(l)&&!l.tokens&&(c=/^{([^}]+)}$/.exec(o)))return[new Dt(r,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(c[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&n&&!n.glyphs&&h.push(new Dt(r,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Zr(Bt(o))&&"identity"===Ft(o.type)&&h.push(new Dt(r,o,'"text-font" does not support identity functions'))),h.concat(Dn({key:t.key,value:o,valueSpec:l,style:n,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:a}))}function Pn(t){return Tn(t,"paint")}function On(t){return Tn(t,"layout")}function An(t){var e=[],r=t.value,n=t.key,i=t.style,o=t.styleSpec;r.type||r.ref||e.push(new Dt(n,r,'either "type" or "ref" is required'));var a,s=Ft(r.type),u=Ft(r.ref);if(r.id)for(var c=Ft(r.id),l=0;l<t.arrayIndex;l++){var h=i.layers[l];Ft(h.id)===c&&e.push(new Dt(n,r.id,'duplicate layer id "'+r.id+'", previously used at line '+h.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(t){t in r&&e.push(new Dt(n,r[t],'"'+t+'" is prohibited for ref layers'))}),i.layers.forEach(function(t){Ft(t.id)===u&&(a=t)}),a?a.ref?e.push(new Dt(n,r.ref,"ref cannot reference another ref layer")):s=Ft(a.type):e.push(new Dt(n,r.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(r.source){var p=i.sources&&i.sources[r.source],f=p&&Ft(p.type);p?"vector"===f&&"raster"===s?e.push(new Dt(n,r.source,'layer "'+r.id+'" requires a raster source')):"raster"===f&&"raster"!==s?e.push(new Dt(n,r.source,'layer "'+r.id+'" requires a vector source')):"vector"!==f||r["source-layer"]?"raster-dem"===f&&"hillshade"!==s?e.push(new Dt(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!r.paint||!r.paint["line-gradient"]||"geojson"===f&&p.lineMetrics||e.push(new Dt(n,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new Dt(n,r,'layer "'+r.id+'" must specify a "source-layer"')):e.push(new Dt(n,r.source,'source "'+r.source+'" not found'))}else e.push(new Dt(n,r,'missing required property "source"'));return e=e.concat(hn({key:n,value:r,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Dn({key:n+".type",value:r.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"})},filter:Mn,layout:function(t){return hn({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return On(zt({layerType:s},t))}}})},paint:function(t){return hn({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Pn(zt({layerType:s},t))}}})}}}))}function In(t){var e=t.value,r=t.key,n=Yr(e);return"string"!==n?[new Dt(r,e,"string expected, "+n+" found")]:[]}var Ln={promoteId:function(t){var e=t.key,r=t.value;if("string"===Yr(r))return In({key:e,value:r});var n=[];for(var i in r)n.push.apply(n,In({key:e+"."+i,value:r[i]}));return n}};function Rn(t){var e=t.value,r=t.key,n=t.styleSpec,i=t.style;if(!e.type)return[new Dt(r,e,'"type" is required')];var o,a=Ft(e.type);switch(a){case"vector":case"raster":case"raster-dem":return hn({key:r,value:e,valueSpec:n["source_"+a.replace("-","_")],style:t.style,styleSpec:n,objectElementValidators:Ln});case"geojson":if(o=hn({key:r,value:e,valueSpec:n.source_geojson,style:i,styleSpec:n,objectElementValidators:Ln}),e.cluster)for(var s in e.clusterProperties){var u=e.clusterProperties[s],c=u[0],l="string"==typeof c?[c,["accumulated"],["get",s]]:c;o.push.apply(o,mn({key:r+"."+s+".map",value:u[1],expressionContext:"cluster-map"})),o.push.apply(o,mn({key:r+"."+s+".reduce",value:l,expressionContext:"cluster-reduce"}))}return o;case"video":return hn({key:r,value:e,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return hn({key:r,value:e,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new Dt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return gn({key:r+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:n})}}function Nn(t){var e=t.value,r=t.styleSpec,n=r.light,i=t.style,o=[],a=Yr(e);if(void 0===e)return o;if("object"!==a)return o.concat([new Dt("light",e,"object expected, "+a+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);o=o.concat(u&&n[u[1]]&&n[u[1]].transition?Dn({key:s,value:e[s],valueSpec:r.transition,style:i,styleSpec:r}):n[s]?Dn({key:s,value:e[s],valueSpec:n[s],style:i,styleSpec:r}):[new Dt(s,e[s],'unknown property "'+s+'"')])}return o}var kn={"*":function(){return[]},array:pn,boolean:function(t){var e=t.value,r=t.key,n=Yr(e);return"boolean"!==n?[new Dt(r,e,"boolean expected, "+n+" found")]:[]},number:fn,color:function(t){var e=t.key,r=t.value,n=Yr(r);return"string"!==n?[new Dt(e,r,"color expected, "+n+" found")]:null===oe(r)?[new Dt(e,r,'color expected, "'+r+'" found')]:[]},constants:jt,enum:gn,filter:Mn,function:dn,layer:An,object:hn,source:Rn,light:Nn,string:In,formatted:function(t){return 0===In(t).length?[]:mn(t)},resolvedImage:function(t){return 0===In(t).length?[]:mn(t)}};function Dn(t){var e=t.value,r=t.valueSpec,n=t.styleSpec;return r.expression&&Zr(Ft(e))?dn(t):r.expression&&on(Bt(e))?mn(t):r.type&&kn[r.type]?kn[r.type](t):hn(zt({},t,{valueSpec:r.type?n[r.type]:r}))}function jn(t){var e=t.value,r=t.key,n=In(t);return n.length||(-1===e.indexOf("{fontstack}")&&n.push(new Dt(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new Dt(r,e,'"glyphs" url must include a "{range}" token'))),n}function zn(t,e){void 0===e&&(e=kt);var r=[];return r=r.concat(Dn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:jn,"*":function(){return[]}}})),t.constants&&(r=r.concat(jt({key:"constants",value:t.constants,style:t,styleSpec:e}))),Fn(r)}function Fn(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function Bn(r){return function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return Fn(r.apply(this,t))}}zn.source=Bn(Rn),zn.light=Bn(Nn),zn.layer=Bn(An),zn.filter=Bn(Mn),zn.paintProperty=Bn(Pn),zn.layoutProperty=Bn(On);var Un=zn,Vn=Un.light,Gn=Un.paintProperty,qn=Un.layoutProperty;function Hn(t,e){var r=!1;if(e&&e.length)for(var n=0,i=e;n<i.length;n+=1)t.fire(new Rt(new Error(i[n].message))),r=!0;return r}var $n=Xn,Wn=3;function Xn(t,e,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(r=i[2]);for(var o=0;o<this.d*this.d;o++){var a=i[Wn+o],s=i[Wn+o+1];n.push(a===s?null:i.subarray(a,s))}var u=i[Wn+n.length+1];this.keys=i.subarray(i[Wn+n.length],u),this.bboxes=i.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var c=0;c<this.d*this.d;c++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var l=r/e*t;this.min=-l,this.max=t+l}Xn.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},Xn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Xn.prototype._insertCell=function(t,e,r,n,i,o){this.cells[i].push(o)},Xn.prototype.query=function(t,e,r,n,i){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=r&&a<=n&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,r,n,this._queryCell,s,{},i),s},Xn.prototype._queryCell=function(t,e,r,n,i,o,a,s){var u=this.cells[i];if(null!==u)for(var c=this.keys,l=this.bboxes,h=0;h<u.length;h++){var p=u[h];if(void 0===a[p]){var f=4*p;(s?s(l[0+f],l[1+f],l[2+f],l[3+f]):t<=l[2+f]&&e<=l[3+f]&&r>=l[0+f]&&n>=l[1+f])?(a[p]=!0,o.push(c[p])):a[p]=!1}}},Xn.prototype._forEachCell=function(t,e,r,n,i,o,a,s){for(var u=this._convertToCellCoord(t),c=this._convertToCellCoord(e),l=this._convertToCellCoord(r),h=this._convertToCellCoord(n),p=u;p<=l;p++)for(var f=c;f<=h;f++){var d=this.d*f+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(f),this._convertFromCellCoord(p+1),this._convertFromCellCoord(f+1)))&&i.call(this,t,e,r,n,d,o,a,s))return}},Xn.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Xn.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Xn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Wn+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(e+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];i[Wn+a]=o,i.set(s,o),o+=s.length}return i[Wn+t.length]=o,i.set(this.keys,o),i[Wn+t.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var Yn=self.ImageData,Zn=self.ImageBitmap,Kn={};function Jn(t,e,r){void 0===r&&(r={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Kn[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}for(var Qn in Jn("Object",Object),$n.serialize=function(t,e){var r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},$n.deserialize=function(t){return new $n(t.buffer)},Jn("Grid",$n),Jn("Color",ae),Jn("Error",Error),Jn("ResolvedImage",le),Jn("StylePropertyFunction",ln),Jn("StyleExpression",nn,{omit:["_evaluator"]}),Jn("ZoomDependentExpression",un),Jn("ZoomConstantExpression",sn),Jn("CompoundExpression",Ce,{omit:["_evaluate"]}),Fr)Fr[Qn]._classRegistryKey||Jn("Expression_"+Qn,Fr[Qn]);function ti(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function ei(t){return Zn&&t instanceof Zn}function ri(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(ti(t)||ei(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var r=t;return e&&e.push(r.buffer),r}if(t instanceof Yn)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var n=[],i=0,o=t;i<o.length;i+=1)n.push(ri(o[i],e));return n}if("object"!=typeof t)throw new Error("can't serialize object of type "+typeof t);var a=t.constructor,s=a._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var u=a.serialize?a.serialize(t,e):{};if(!a.serialize){for(var c in t)if(t.hasOwnProperty(c)&&!(0<=Kn[s].omit.indexOf(c))){var l=t[c];u[c]=0<=Kn[s].shallow.indexOf(c)?l:ri(l,e)}t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}function ni(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||ti(t)||ei(t)||ArrayBuffer.isView(t)||t instanceof Yn)return t;if(Array.isArray(t))return t.map(ni);if("object"!=typeof t)throw new Error("can't deserialize object of type "+typeof t);var e=t.$name||"Object",r=Kn[e].klass;if(!r)throw new Error("can't deserialize unregistered class "+e);if(r.deserialize)return r.deserialize(t);for(var n=Object.create(r.prototype),i=0,o=Object.keys(t);i<o.length;i+=1){var a=o[i];if("$name"!==a){var s=t[a];n[a]=0<=Kn[e].shallow.indexOf(a)?s:ni(s)}}return n}function ii(){this.first=!0}ii.prototype.update=function(t,e){var r=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=r,!0))};var oi={"Latin-1 Supplement":function(t){return 128<=t&&t<=255},Arabic:function(t){return 1536<=t&&t<=1791},"Arabic Supplement":function(t){return 1872<=t&&t<=1919},"Arabic Extended-A":function(t){return 2208<=t&&t<=2303},"Hangul Jamo":function(t){return 4352<=t&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return 5120<=t&&t<=5759},Khmer:function(t){return 6016<=t&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return 6320<=t&&t<=6399},"General Punctuation":function(t){return 8192<=t&&t<=8303},"Letterlike Symbols":function(t){return 8448<=t&&t<=8527},"Number Forms":function(t){return 8528<=t&&t<=8591},"Miscellaneous Technical":function(t){return 8960<=t&&t<=9215},"Control Pictures":function(t){return 9216<=t&&t<=9279},"Optical Character Recognition":function(t){return 9280<=t&&t<=9311},"Enclosed Alphanumerics":function(t){return 9312<=t&&t<=9471},"Geometric Shapes":function(t){return 9632<=t&&t<=9727},"Miscellaneous Symbols":function(t){return 9728<=t&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return 11008<=t&&t<=11263},"CJK Radicals Supplement":function(t){return 11904<=t&&t<=12031},"Kangxi Radicals":function(t){return 12032<=t&&t<=12255},"Ideographic Description Characters":function(t){return 12272<=t&&t<=12287},"CJK Symbols and Punctuation":function(t){return 12288<=t&&t<=12351},Hiragana:function(t){return 12352<=t&&t<=12447},Katakana:function(t){return 12448<=t&&t<=12543},Bopomofo:function(t){return 12544<=t&&t<=12591},"Hangul Compatibility Jamo":function(t){return 12592<=t&&t<=12687},Kanbun:function(t){return 12688<=t&&t<=12703},"Bopomofo Extended":function(t){return 12704<=t&&t<=12735},"CJK Strokes":function(t){return 12736<=t&&t<=12783},"Katakana Phonetic Extensions":function(t){return 12784<=t&&t<=12799},"Enclosed CJK Letters and Months":function(t){return 12800<=t&&t<=13055},"CJK Compatibility":function(t){return 13056<=t&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return 13312<=t&&t<=19903},"Yijing Hexagram Symbols":function(t){return 19904<=t&&t<=19967},"CJK Unified Ideographs":function(t){return 19968<=t&&t<=40959},"Yi Syllables":function(t){return 40960<=t&&t<=42127},"Yi Radicals":function(t){return 42128<=t&&t<=42191},"Hangul Jamo Extended-A":function(t){return 43360<=t&&t<=43391},"Hangul Syllables":function(t){return 44032<=t&&t<=55215},"Hangul Jamo Extended-B":function(t){return 55216<=t&&t<=55295},"Private Use Area":function(t){return 57344<=t&&t<=63743},"CJK Compatibility Ideographs":function(t){return 63744<=t&&t<=64255},"Arabic Presentation Forms-A":function(t){return 64336<=t&&t<=65023},"Vertical Forms":function(t){return 65040<=t&&t<=65055},"CJK Compatibility Forms":function(t){return 65072<=t&&t<=65103},"Small Form Variants":function(t){return 65104<=t&&t<=65135},"Arabic Presentation Forms-B":function(t){return 65136<=t&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return 65280<=t&&t<=65519}};function ai(t){for(var e=0,r=t;e<r.length;e+=1)if(si(r[e].charCodeAt(0)))return!0;return!1}function si(t){return!(746!==t&&747!==t&&(t<4352||!(oi["Bopomofo Extended"](t)||oi.Bopomofo(t)||oi["CJK Compatibility Forms"](t)&&!(65097<=t&&t<=65103)||oi["CJK Compatibility Ideographs"](t)||oi["CJK Compatibility"](t)||oi["CJK Radicals Supplement"](t)||oi["CJK Strokes"](t)||!(!oi["CJK Symbols and Punctuation"](t)||12296<=t&&t<=12305||12308<=t&&t<=12319||12336===t)||oi["CJK Unified Ideographs Extension A"](t)||oi["CJK Unified Ideographs"](t)||oi["Enclosed CJK Letters and Months"](t)||oi["Hangul Compatibility Jamo"](t)||oi["Hangul Jamo Extended-A"](t)||oi["Hangul Jamo Extended-B"](t)||oi["Hangul Jamo"](t)||oi["Hangul Syllables"](t)||oi.Hiragana(t)||oi["Ideographic Description Characters"](t)||oi.Kanbun(t)||oi["Kangxi Radicals"](t)||oi["Katakana Phonetic Extensions"](t)||oi.Katakana(t)&&12540!==t||!(!oi["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||65306<=t&&t<=65310||65339===t||65341===t||65343===t||65371<=t&&t<=65503||65507===t||65512<=t&&t<=65519)||!(!oi["Small Form Variants"](t)||65112<=t&&t<=65118||65123<=t&&t<=65126)||oi["Unified Canadian Aboriginal Syllabics"](t)||oi["Unified Canadian Aboriginal Syllabics Extended"](t)||oi["Vertical Forms"](t)||oi["Yijing Hexagram Symbols"](t)||oi["Yi Syllables"](t)||oi["Yi Radicals"](t))))}function ui(t){return!(si(t)||(e=t,oi["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||oi["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||oi["Letterlike Symbols"](e)||oi["Number Forms"](e)||oi["Miscellaneous Technical"](e)&&(8960<=e&&e<=8967||8972<=e&&e<=8991||8996<=e&&e<=9e3||9003===e||9085<=e&&e<=9114||9150<=e&&e<=9165||9167===e||9169<=e&&e<=9179||9186<=e&&e<=9215)||oi["Control Pictures"](e)&&9251!==e||oi["Optical Character Recognition"](e)||oi["Enclosed Alphanumerics"](e)||oi["Geometric Shapes"](e)||oi["Miscellaneous Symbols"](e)&&!(9754<=e&&e<=9759)||oi["Miscellaneous Symbols and Arrows"](e)&&(11026<=e&&e<=11055||11088<=e&&e<=11097||11192<=e&&e<=11243)||oi["CJK Symbols and Punctuation"](e)||oi.Katakana(e)||oi["Private Use Area"](e)||oi["CJK Compatibility Forms"](e)||oi["Small Form Variants"](e)||oi["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||9984<=e&&e<=10087||10102<=e&&e<=10131||65532===e||65533===e));var e}function ci(t){return 1424<=t&&t<=2303||oi["Arabic Presentation Forms-A"](t)||oi["Arabic Presentation Forms-B"](t)}function li(t){for(var e=0,r=t;e<r.length;e+=1)if(ci(r[e].charCodeAt(0)))return!0;return!1}function hi(t){pi&&pi(t)}var pi=null,fi="unavailable",di=null;function mi(){_i.fire(new At("pluginStateChange",{pluginStatus:fi,pluginURL:di}))}function gi(){return fi}function yi(){if("deferred"!==fi||!di)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");fi="loading",mi(),di&&St({url:di},function(t){t?hi(t):(fi="loaded",mi())})}function vi(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ii,this.transition={})}var _i=new It,bi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===fi||null!=bi.applyArabicShaping},isLoading:function(){return"loading"===fi},setState:function(t){fi=t.pluginStatus,di=t.pluginURL},isParsed:function(){return null!=bi.applyArabicShaping&&null!=bi.processBidirectionalText&&null!=bi.processStyledBidirectionalText},getPluginURL:function(){return di}};vi.prototype.isSupportedScript=function(t){return function(t,e){for(var r=0,n=t;r<n.length;r+=1)if(i=n[r].charCodeAt(0),!e&&ci(i)||2304<=i&&i<=3583||3840<=i&&i<=4255||oi.Khmer(i))return!1;var i;return!0}(t,bi.isLoaded())},vi.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},vi.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),r=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*e}};function xi(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Zr(t))return new ln(t,e);if(on(t)){var r=cn(t,e);if("error"===r.result)throw new Error(r.value.map(function(t){return t.key+": "+t.message}).join(", "));return r.value}var n=t;return"string"==typeof t&&"color"===e.type&&(n=ae.parse(t)),{kind:"constant",evaluate:function(){return n}}}(void 0===e?t.specification.default:e,t.specification)}xi.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},xi.prototype.possiblyEvaluate=function(t,e,r){return this.property.possiblyEvaluate(this,t,e,r)};function wi(t){this.property=t,this.value=new xi(t,void 0)}wi.prototype.transitioned=function(t,e){return new Ei(this.property,this.value,e,f({},t.transition,this.transition),t.now)},wi.prototype.untransitioned=function(){return new Ei(this.property,this.value,null,{},0)};function Si(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}Si.prototype.getValue=function(t){return v(this._values[t].value.value)},Si.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new wi(this._values[t].property)),this._values[t].value=new xi(this._values[t].property,null===e?void 0:v(e))},Si.prototype.getTransition=function(t){return v(this._values[t].transition)},Si.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new wi(this._values[t].property)),this._values[t].transition=v(e)||void 0},Si.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e],i=this.getValue(n);void 0!==i&&(t[n]=i);var o=this.getTransition(n);void 0!==o&&(t[n+"-transition"]=o)}return t},Si.prototype.transitioned=function(t,e){for(var r=new Ci(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var o=i[n];r._values[o]=this._values[o].transitioned(t,e._values[o])}return r},Si.prototype.untransitioned=function(){for(var t=new Ci(this._properties),e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e];t._values[n]=this._values[n].untransitioned()}return t};var Ei=function(t,e,r,n,i){this.property=t,this.value=e,this.begin=i+n.delay||0,this.end=this.begin+n.duration||0,t.specification.transition&&(n.delay||n.duration)&&(this.prior=r)};Ei.prototype.possiblyEvaluate=function(t,e,r){var n=t.now||0,i=this.value.possiblyEvaluate(t,e,r),o=this.prior;if(o){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return o.possiblyEvaluate(t,e,r);var a=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,r),i,function(){if(a<=0)return 0;if(1<=a)return 1;var t=a*a,e=t*a;return 4*(a<.5?e:3*(a-t)+e-.75)}())}return i};var Ci=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Ci.prototype.possiblyEvaluate=function(t,e){for(var r=new Pi(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var o=i[n];r._values[o]=this._values[o].possiblyEvaluate(t,e)}return r},Ci.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};function Mi(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}Mi.prototype.getValue=function(t){return v(this._values[t].value)},Mi.prototype.setValue=function(t,e){this._values[t]=new xi(this._values[t].property,null===e?void 0:v(e))},Mi.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e],i=this.getValue(n);void 0!==i&&(t[n]=i)}return t},Mi.prototype.possiblyEvaluate=function(t,e){for(var r=new Pi(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var o=i[n];r._values[o]=this._values[o].possiblyEvaluate(t,e)}return r};function Ti(t,e,r){this.property=t,this.value=e,this.parameters=r}Ti.prototype.isConstant=function(){return"constant"===this.value.kind},Ti.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},Ti.prototype.evaluate=function(t,e,r,n){return this.property.evaluate(this.value,this.parameters,t,e,r,n)};var Pi=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Pi.prototype.get=function(t){return this._values[t]};function Oi(t){this.specification=t}Oi.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},Oi.prototype.interpolate=function(t,e,r){var n=ir[this.specification.type];return n?n(t,e,r):t};function Ai(t,e){this.specification=t,this.overrides=e}Ai.prototype.possiblyEvaluate=function(t,e,r,n){return new Ti(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},r,n)}:t.expression,e)},Ai.prototype.interpolate=function(t,e,r){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Ti(this,{kind:"constant",value:void 0},t.parameters);var n=ir[this.specification.type];return n?new Ti(this,{kind:"constant",value:n(t.value.value,e.value.value,r)},t.parameters):t},Ai.prototype.evaluate=function(t,e,r,n,i,o){return"constant"===t.kind?t.value:t.evaluate(e,r,n,i,o)};function Ii(t){this.specification=t}var Li,Ri=((Li=Ai)&&(Ni.__proto__=Li),((Ni.prototype=Object.create(Li&&Li.prototype)).constructor=Ni).prototype.possiblyEvaluate=function(t,e,r,n){if(void 0===t.value)return new Ti(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},r,n),o="resolvedImage"===t.property.specification.type&&"string"!=typeof i?i.name:i,a=this._calculate(o,o,o,e);return new Ti(this,{kind:"constant",value:a},e)}if("camera"!==t.expression.kind)return new Ti(this,t.expression,e);var s=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new Ti(this,{kind:"constant",value:s},e)},Ni.prototype.evaluate=function(t,e,r,n,i,o){if("source"!==t.kind)return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},r,n),t.evaluate({zoom:Math.floor(e.zoom)},r,n),t.evaluate({zoom:Math.floor(e.zoom)+1},r,n),e):t.value;var a=t.evaluate(e,r,n,i,o);return this._calculate(a,a,a,e)},Ni.prototype._calculate=function(t,e,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},Ni.prototype.interpolate=function(t){return t},Ni);function Ni(){Li.apply(this,arguments)}Ii.prototype.possiblyEvaluate=function(t,e,r,n){if(void 0!==t.value){if("constant"!==t.expression.kind)return this._calculate(t.expression.evaluate(new vi(Math.floor(e.zoom-1),e)),t.expression.evaluate(new vi(Math.floor(e.zoom),e)),t.expression.evaluate(new vi(Math.floor(e.zoom+1),e)),e);var i=t.expression.evaluate(e,null,{},r,n);return this._calculate(i,i,i,e)}},Ii.prototype._calculate=function(t,e,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},Ii.prototype.interpolate=function(t){return t};function ki(t){this.specification=t}ki.prototype.possiblyEvaluate=function(t,e,r,n){return!!t.expression.evaluate(e,null,{},r,n)},ki.prototype.interpolate=function(){return!1};function Di(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var r=t[e];r.specification.overridable&&this.overridableProperties.push(e);var n=this.defaultPropertyValues[e]=new xi(r,void 0),i=this.defaultTransitionablePropertyValues[e]=new wi(r);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=n.possiblyEvaluate({})}}Jn("DataDrivenProperty",Ai),Jn("DataConstantProperty",Oi),Jn("CrossFadedDataDrivenProperty",Ri),Jn("CrossFadedProperty",Ii),Jn("ColorRampProperty",ki);function ji(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}function zi(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}var Fi,Bi=((Fi=It)&&(Vi.__proto__=Fi),((Vi.prototype=Object.create(Fi&&Fi.prototype)).constructor=Vi).prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},Vi.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},Vi.prototype.setLayoutProperty=function(t,e,r){void 0===r&&(r={}),null!=e&&this._validate(qn,"layers."+this.id+".layout."+t,t,e,r)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)},Vi.prototype.getPaintProperty=function(t){return m(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},Vi.prototype.setPaintProperty=function(t,e,r){if(void 0===r&&(r={}),null!=e&&this._validate(Gn,"layers."+this.id+".paint."+t,t,e,r))return!1;if(m(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var n=this._transitionablePaint._values[t],i="cross-faded-data-driven"===n.property.specification["property-type"],o=n.value.isDataDriven(),a=n.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var s=this._transitionablePaint._values[t].value;return s.isDataDriven()||o||i||this._handleOverridablePaintPropertyUpdate(t,a,s)},Vi.prototype._handleSpecialPaintPropertyUpdate=function(t){},Vi.prototype._handleOverridablePaintPropertyUpdate=function(t,e,r){return!1},Vi.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},Vi.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},Vi.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},Vi.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,e)},Vi.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),y(t,function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)})},Vi.prototype._validate=function(t,e,r,n,i){return void 0===i&&(i={}),(!i||!1!==i.validate)&&Hn(this,t.call(Un,{key:e,layerType:this.type,objectKey:r,value:n,styleSpec:kt,style:{glyphs:!0,sprite:!0}}))},Vi.prototype.is3D=function(){return!1},Vi.prototype.isTileClipped=function(){return!1},Vi.prototype.hasOffscreenPass=function(){return!1},Vi.prototype.resize=function(){},Vi.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof Ti&&$r(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},Vi),Ui={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};function Vi(t,e){if(Fi.call(this),this.id=t.id,this.type=t.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==t.type&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new Mi(e.layout)),e.paint)){for(var r in this._transitionablePaint=new Si(e.paint),t.paint)this.setPaintProperty(r,t.paint[r],{validate:!1});for(var n in t.layout)this.setLayoutProperty(n,t.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned()}}function Gi(t,i){void 0===i&&(i=1);var o=0,a=0;return{members:t.map(function(t){var e=Ui[t.type].BYTES_PER_ELEMENT,r=o=qi(o,Math.max(i,e)),n=t.components||1;return a=Math.max(a,e),o+=e*n,{name:t.name,type:t.type,components:n,offset:r}}),size:qi(o,Math.max(a,i)),alignment:i}}function qi(t,e){return Math.ceil(t/e)*e}zi.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},zi.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},zi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},zi.prototype.clear=function(){this.length=0},zi.prototype.resize=function(t){this.reserve(t),this.length=t},zi.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},zi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Hi,$i=((Hi=zi)&&(Wi.__proto__=Hi),((Wi.prototype=Object.create(Hi&&Hi.prototype)).constructor=Wi).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},Wi.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},Wi.prototype.emplace=function(t,e,r){var n=2*t;return this.int16[0+n]=e,this.int16[1+n]=r,t},Wi);function Wi(){Hi.apply(this,arguments)}$i.prototype.bytesPerElement=4,Jn("StructArrayLayout2i4",$i);var Xi,Yi=((Xi=zi)&&(Zi.__proto__=Xi),((Zi.prototype=Object.create(Xi&&Xi.prototype)).constructor=Zi).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},Zi.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},Zi.prototype.emplace=function(t,e,r,n,i){var o=4*t;return this.int16[0+o]=e,this.int16[1+o]=r,this.int16[2+o]=n,this.int16[3+o]=i,t},Zi);function Zi(){Xi.apply(this,arguments)}Yi.prototype.bytesPerElement=8,Jn("StructArrayLayout4i8",Yi);var Ki,Ji=((Ki=zi)&&(Qi.__proto__=Ki),((Qi.prototype=Object.create(Ki&&Ki.prototype)).constructor=Qi).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},Qi.prototype.emplaceBack=function(t,e,r,n,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o)},Qi.prototype.emplace=function(t,e,r,n,i,o,a){var s=6*t;return this.int16[0+s]=e,this.int16[1+s]=r,this.int16[2+s]=n,this.int16[3+s]=i,this.int16[4+s]=o,this.int16[5+s]=a,t},Qi);function Qi(){Ki.apply(this,arguments)}Ji.prototype.bytesPerElement=12,Jn("StructArrayLayout2i4i12",Ji);var to,eo=((to=zi)&&(ro.__proto__=to),((ro.prototype=Object.create(to&&to.prototype)).constructor=ro).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},ro.prototype.emplaceBack=function(t,e,r,n,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o)},ro.prototype.emplace=function(t,e,r,n,i,o,a){var s=4*t,u=8*t;return this.int16[0+s]=e,this.int16[1+s]=r,this.uint8[4+u]=n,this.uint8[5+u]=i,this.uint8[6+u]=o,this.uint8[7+u]=a,t},ro);function ro(){to.apply(this,arguments)}eo.prototype.bytesPerElement=8,Jn("StructArrayLayout2i4ub8",eo);var no,io=((no=zi)&&(oo.__proto__=no),((oo.prototype=Object.create(no&&no.prototype)).constructor=oo).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},oo.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,u,c){var l=this.length;return this.resize(l+1),this.emplace(l,t,e,r,n,i,o,a,s,u,c)},oo.prototype.emplace=function(t,e,r,n,i,o,a,s,u,c,l){var h=9*t,p=18*t;return this.uint16[0+h]=e,this.uint16[1+h]=r,this.uint16[2+h]=n,this.uint16[3+h]=i,this.uint16[4+h]=o,this.uint16[5+h]=a,this.uint16[6+h]=s,this.uint16[7+h]=u,this.uint8[16+p]=c,this.uint8[17+p]=l,t},oo);function oo(){no.apply(this,arguments)}io.prototype.bytesPerElement=18,Jn("StructArrayLayout8ui2ub18",io);var ao,so=((ao=zi)&&(uo.__proto__=ao),((uo.prototype=Object.create(ao&&ao.prototype)).constructor=uo).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},uo.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,u,c,l,h){var p=this.length;return this.resize(p+1),this.emplace(p,t,e,r,n,i,o,a,s,u,c,l,h)},uo.prototype.emplace=function(t,e,r,n,i,o,a,s,u,c,l,h,p){var f=12*t;return this.int16[0+f]=e,this.int16[1+f]=r,this.int16[2+f]=n,this.int16[3+f]=i,this.uint16[4+f]=o,this.uint16[5+f]=a,this.uint16[6+f]=s,this.uint16[7+f]=u,this.int16[8+f]=c,this.int16[9+f]=l,this.int16[10+f]=h,this.int16[11+f]=p,t},uo);function uo(){ao.apply(this,arguments)}so.prototype.bytesPerElement=24,Jn("StructArrayLayout4i4ui4i24",so);var co,lo=((co=zi)&&(ho.__proto__=co),((ho.prototype=Object.create(co&&co.prototype)).constructor=ho).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},ho.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},ho.prototype.emplace=function(t,e,r,n){var i=3*t;return this.float32[0+i]=e,this.float32[1+i]=r,this.float32[2+i]=n,t},ho);function ho(){co.apply(this,arguments)}lo.prototype.bytesPerElement=12,Jn("StructArrayLayout3f12",lo);var po,fo=((po=zi)&&(mo.__proto__=po),((mo.prototype=Object.create(po&&po.prototype)).constructor=mo).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},mo.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},mo.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},mo);function mo(){po.apply(this,arguments)}fo.prototype.bytesPerElement=4,Jn("StructArrayLayout1ul4",fo);var go,yo=((go=zi)&&(vo.__proto__=go),((vo.prototype=Object.create(go&&go.prototype)).constructor=vo).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},vo.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,u,c,l){var h=this.length;return this.resize(h+1),this.emplace(h,t,e,r,n,i,o,a,s,u,c,l)},vo.prototype.emplace=function(t,e,r,n,i,o,a,s,u,c,l,h){var p=12*t,f=6*t;return this.int16[0+p]=e,this.int16[1+p]=r,this.int16[2+p]=n,this.int16[3+p]=i,this.int16[4+p]=o,this.int16[5+p]=a,this.uint32[3+f]=s,this.uint16[8+p]=u,this.uint16[9+p]=c,this.int16[10+p]=l,this.int16[11+p]=h,t},vo);function vo(){go.apply(this,arguments)}yo.prototype.bytesPerElement=24,Jn("StructArrayLayout6i1ul2ui2i24",yo);var _o,bo=((_o=zi)&&(xo.__proto__=_o),((xo.prototype=Object.create(_o&&_o.prototype)).constructor=xo).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},xo.prototype.emplaceBack=function(t,e,r,n,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o)},xo.prototype.emplace=function(t,e,r,n,i,o,a){var s=6*t;return this.int16[0+s]=e,this.int16[1+s]=r,this.int16[2+s]=n,this.int16[3+s]=i,this.int16[4+s]=o,this.int16[5+s]=a,t},xo);function xo(){_o.apply(this,arguments)}bo.prototype.bytesPerElement=12,Jn("StructArrayLayout2i2i2i12",bo);var wo,So=((wo=zi)&&(Eo.__proto__=wo),((Eo.prototype=Object.create(wo&&wo.prototype)).constructor=Eo).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},Eo.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},Eo.prototype.emplace=function(t,e,r,n,i){var o=12*t,a=3*t;return this.uint8[0+o]=e,this.uint8[1+o]=r,this.float32[1+a]=n,this.float32[2+a]=i,t},Eo);function Eo(){wo.apply(this,arguments)}So.prototype.bytesPerElement=12,Jn("StructArrayLayout2ub2f12",So);var Co,Mo=((Co=zi)&&(To.__proto__=Co),((To.prototype=Object.create(Co&&Co.prototype)).constructor=To).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},To.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,u,c,l,h,p,f,d,m,g){var y=this.length;return this.resize(y+1),this.emplace(y,t,e,r,n,i,o,a,s,u,c,l,h,p,f,d,m,g)},To.prototype.emplace=function(t,e,r,n,i,o,a,s,u,c,l,h,p,f,d,m,g,y){var v=24*t,_=12*t,b=48*t;return this.int16[0+v]=e,this.int16[1+v]=r,this.uint16[2+v]=n,this.uint16[3+v]=i,this.uint32[2+_]=o,this.uint32[3+_]=a,this.uint32[4+_]=s,this.uint16[10+v]=u,this.uint16[11+v]=c,this.uint16[12+v]=l,this.float32[7+_]=h,this.float32[8+_]=p,this.uint8[36+b]=f,this.uint8[37+b]=d,this.uint8[38+b]=m,this.uint32[10+_]=g,this.int16[22+v]=y,t},To);function To(){Co.apply(this,arguments)}Mo.prototype.bytesPerElement=48,Jn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Mo);var Po,Oo=((Po=zi)&&(Ao.__proto__=Po),((Ao.prototype=Object.create(Po&&Po.prototype)).constructor=Ao).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},Ao.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,u,c,l,h,p,f,d,m,g,y,v,_,b,x,w,S,E,C){var M=this.length;return this.resize(M+1),this.emplace(M,t,e,r,n,i,o,a,s,u,c,l,h,p,f,d,m,g,y,v,_,b,x,w,S,E,C)},Ao.prototype.emplace=function(t,e,r,n,i,o,a,s,u,c,l,h,p,f,d,m,g,y,v,_,b,x,w,S,E,C,M){var T=30*t,P=15*t;return this.int16[0+T]=e,this.int16[1+T]=r,this.int16[2+T]=n,this.int16[3+T]=i,this.int16[4+T]=o,this.int16[5+T]=a,this.int16[6+T]=s,this.int16[7+T]=u,this.uint16[8+T]=c,this.uint16[9+T]=l,this.uint16[10+T]=h,this.uint16[11+T]=p,this.uint16[12+T]=f,this.uint16[13+T]=d,this.uint16[14+T]=m,this.uint16[15+T]=g,this.uint16[16+T]=y,this.uint16[17+T]=v,this.uint16[18+T]=_,this.uint16[19+T]=b,this.uint16[20+T]=x,this.uint16[21+T]=w,this.uint32[11+P]=S,this.float32[12+P]=E,this.float32[13+P]=C,this.float32[14+P]=M,t},Ao);function Ao(){Po.apply(this,arguments)}Oo.prototype.bytesPerElement=60,Jn("StructArrayLayout8i14ui1ul3f60",Oo);var Io,Lo=((Io=zi)&&(Ro.__proto__=Io),((Ro.prototype=Object.create(Io&&Io.prototype)).constructor=Ro).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},Ro.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},Ro.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},Ro);function Ro(){Io.apply(this,arguments)}Lo.prototype.bytesPerElement=4,Jn("StructArrayLayout1f4",Lo);var No,ko=((No=zi)&&(Do.__proto__=No),((Do.prototype=Object.create(No&&No.prototype)).constructor=Do).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},Do.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},Do.prototype.emplace=function(t,e,r,n){var i=3*t;return this.int16[0+i]=e,this.int16[1+i]=r,this.int16[2+i]=n,t},Do);function Do(){No.apply(this,arguments)}ko.prototype.bytesPerElement=6,Jn("StructArrayLayout3i6",ko);var jo,zo=((jo=zi)&&(Fo.__proto__=jo),((Fo.prototype=Object.create(jo&&jo.prototype)).constructor=Fo).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},Fo.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},Fo.prototype.emplace=function(t,e,r,n){var i=4*t;return this.uint32[2*t+0]=e,this.uint16[2+i]=r,this.uint16[3+i]=n,t},Fo);function Fo(){jo.apply(this,arguments)}zo.prototype.bytesPerElement=8,Jn("StructArrayLayout1ul2ui8",zo);var Bo,Uo=((Bo=zi)&&(Vo.__proto__=Bo),((Vo.prototype=Object.create(Bo&&Bo.prototype)).constructor=Vo).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},Vo.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},Vo.prototype.emplace=function(t,e,r,n){var i=3*t;return this.uint16[0+i]=e,this.uint16[1+i]=r,this.uint16[2+i]=n,t},Vo);function Vo(){Bo.apply(this,arguments)}Uo.prototype.bytesPerElement=6,Jn("StructArrayLayout3ui6",Uo);var Go,qo=((Go=zi)&&(Ho.__proto__=Go),((Ho.prototype=Object.create(Go&&Go.prototype)).constructor=Ho).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},Ho.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},Ho.prototype.emplace=function(t,e,r){var n=2*t;return this.uint16[0+n]=e,this.uint16[1+n]=r,t},Ho);function Ho(){Go.apply(this,arguments)}qo.prototype.bytesPerElement=4,Jn("StructArrayLayout2ui4",qo);var $o,Wo=(($o=zi)&&(Xo.__proto__=$o),((Xo.prototype=Object.create($o&&$o.prototype)).constructor=Xo).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},Xo.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},Xo.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},Xo);function Xo(){$o.apply(this,arguments)}Wo.prototype.bytesPerElement=2,Jn("StructArrayLayout1ui2",Wo);var Yo,Zo=((Yo=zi)&&(Ko.__proto__=Yo),((Ko.prototype=Object.create(Yo&&Yo.prototype)).constructor=Ko).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},Ko.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},Ko.prototype.emplace=function(t,e,r){var n=2*t;return this.float32[0+n]=e,this.float32[1+n]=r,t},Ko);function Ko(){Yo.apply(this,arguments)}Zo.prototype.bytesPerElement=8,Jn("StructArrayLayout2f8",Zo);var Jo,Qo=((Jo=zi)&&(ta.__proto__=Jo),((ta.prototype=Object.create(Jo&&Jo.prototype)).constructor=ta).prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},ta.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},ta.prototype.emplace=function(t,e,r,n,i){var o=4*t;return this.float32[0+o]=e,this.float32[1+o]=r,this.float32[2+o]=n,this.float32[3+o]=i,t},ta);function ta(){Jo.apply(this,arguments)}Qo.prototype.bytesPerElement=16,Jn("StructArrayLayout4f16",Qo);var ea=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.radius.get=function(){return this._structArray.int16[this._pos2+10]},r.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},r.anchorPoint.get=function(){return new ht(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,r),e}(ji);ea.prototype.size=24;var ra,na=((ra=yo)&&(ia.__proto__=ra),((ia.prototype=Object.create(ra&&ra.prototype)).constructor=ia).prototype.get=function(t){return new ea(this,t)},ia);function ia(){ra.apply(this,arguments)}Jn("CollisionBoxArray",na);var oa=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,r),e}(ji);oa.prototype.size=48;var aa,sa=((aa=Mo)&&(ua.__proto__=aa),((ua.prototype=Object.create(aa&&aa.prototype)).constructor=ua).prototype.get=function(t){return new oa(this,t)},ua);function ua(){aa.apply(this,arguments)}Jn("PlacedSymbolArray",sa);var ca=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+11]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+11]=t},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+12]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+14]},Object.defineProperties(e.prototype,r),e}(ji);ca.prototype.size=60;var la,ha=((la=Oo)&&(pa.__proto__=la),((pa.prototype=Object.create(la&&la.prototype)).constructor=pa).prototype.get=function(t){return new ca(this,t)},pa);function pa(){la.apply(this,arguments)}Jn("SymbolInstanceArray",ha);var fa,da=((fa=Lo)&&(ma.__proto__=fa),((ma.prototype=Object.create(fa&&fa.prototype)).constructor=ma).prototype.getoffsetX=function(t){return this.float32[1*t+0]},ma);function ma(){fa.apply(this,arguments)}Jn("GlyphOffsetArray",da);var ga,ya=((ga=ko)&&(va.__proto__=ga),((va.prototype=Object.create(ga&&ga.prototype)).constructor=va).prototype.getx=function(t){return this.int16[3*t+0]},va.prototype.gety=function(t){return this.int16[3*t+1]},va.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},va);function va(){ga.apply(this,arguments)}Jn("SymbolLineVertexArray",ya);var _a=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,r),e}(ji);_a.prototype.size=8;var ba,xa=((ba=zo)&&(wa.__proto__=ba),((wa.prototype=Object.create(ba&&ba.prototype)).constructor=wa).prototype.get=function(t){return new _a(this,t)},wa);function wa(){ba.apply(this,arguments)}Jn("FeatureIndexArray",xa);function Sa(t){void 0===t&&(t=[]),this.segments=t}var Ea=Gi([{name:"a_pos",components:2,type:"Int16"}],4).members;function Ca(t,e){return 256*(t=s(Math.floor(t),0,255))+s(Math.floor(e),0,255)}Sa.prototype.prepareSegment=function(t,e,r,n){var i=this.segments[this.segments.length-1];return Sa.MAX_VERTEX_ARRAY_LENGTH<t&&pt("Max vertices per segment is "+Sa.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!i||i.vertexLength+t>Sa.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i},Sa.prototype.get=function(){return this.segments},Sa.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var r=e[t];for(var n in r.vaos)r.vaos[n].destroy()}},Sa.simpleSegment=function(t,e,r,n){return new Sa([{vertexOffset:t,primitiveOffset:e,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])},Sa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Jn("SegmentVector",Sa);var Ma=Gi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint8"},{name:"a_pixel_ratio_to",components:1,type:"Uint8"}]),Ta=e(function(t){t.exports=function(t,e){var r,n,i,o,a,s,u,c;for(n=t.length-(r=3&t.length),i=e,a=3432918353,s=461845907,c=0;c<n;)u=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,i=27492+(65535&(o=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(u=0,r){case 3:u^=(255&t.charCodeAt(c+2))<<16;case 2:u^=(255&t.charCodeAt(c+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(c)))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}}),Pa=e(function(t){t.exports=function(t,e){for(var r,n=t.length,i=e^n,o=0;4<=n;)r=1540483477*(65535&(r=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:i^=(255&t.charCodeAt(o+2))<<16;case 2:i^=(255&t.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}}),Oa=Ta,Aa=Pa;Oa.murmur3=Ta,Oa.murmur2=Aa;function Ia(){this.ids=[],this.positions=[],this.indexed=!1}Ia.prototype.add=function(t,e,r,n){this.ids.push(Ra(t)),this.positions.push(e,r,n)},Ia.prototype.getPositions=function(t){for(var e=Ra(t),r=0,n=this.ids.length-1;r<n;){var i=r+n>>1;this.ids[i]>=e?n=i:r=1+i}for(var o=[];this.ids[r]===e;)o.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return o},Ia.serialize=function(t,e){var r=new Float64Array(t.ids),n=new Uint32Array(t.positions);return function t(e,r,n,i){if(!(i<=n)){for(var o=e[n+i>>1],a=n-1,s=i+1;;){for(;e[++a]<o;);for(;e[--s]>o;);if(s<=a)break;Na(e,a,s),Na(r,3*a,3*s),Na(r,3*a+1,3*s+1),Na(r,3*a+2,3*s+2)}t(e,r,n,s),t(e,r,s+1,i)}}(r,n,0,r.length-1),e&&e.push(r.buffer,n.buffer),{ids:r,positions:n}},Ia.deserialize=function(t){var e=new Ia;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e};var La=Math.pow(2,53)-1;function Ra(t){var e=+t;return!isNaN(e)&&e<=La?e:Oa(String(t))}function Na(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}Jn("FeaturePositionMap",Ia);function ka(t,e){this.gl=t.gl,this.location=e}var Da,ja,za,Fa,Ba,Ua,Va,Ga=((Va=ka)&&(ns.__proto__=Va),((ns.prototype=Object.create(Va&&Va.prototype)).constructor=ns).prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},ns),qa=((Ua=ka)&&(rs.__proto__=Ua),((rs.prototype=Object.create(Ua&&Ua.prototype)).constructor=rs).prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},rs),Ha=((Ba=ka)&&(es.__proto__=Ba),((es.prototype=Object.create(Ba&&Ba.prototype)).constructor=es).prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},es),$a=((Fa=ka)&&(ts.__proto__=Fa),((ts.prototype=Object.create(Fa&&Fa.prototype)).constructor=ts).prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},ts),Wa=((za=ka)&&(Qa.__proto__=za),((Qa.prototype=Object.create(za&&za.prototype)).constructor=Qa).prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},Qa),Xa=((ja=ka)&&(Ja.__proto__=ja),((Ja.prototype=Object.create(ja&&ja.prototype)).constructor=Ja).prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},Ja),Ya=new Float32Array(16),Za=((Da=ka)&&(Ka.__proto__=Da),((Ka.prototype=Object.create(Da&&Da.prototype)).constructor=Ka).prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},Ka);function Ka(t,e){Da.call(this,t,e),this.current=Ya}function Ja(t,e){ja.call(this,t,e),this.current=ae.transparent}function Qa(t,e){za.call(this,t,e),this.current=[0,0,0,0]}function ts(t,e){Fa.call(this,t,e),this.current=[0,0,0]}function es(t,e){Ba.call(this,t,e),this.current=[0,0]}function rs(t,e){Ua.call(this,t,e),this.current=0}function ns(t,e){Va.call(this,t,e),this.current=0}function is(t){return[Ca(255*t.r,255*t.g),Ca(255*t.b,255*t.a)]}function os(t,e,r){this.value=t,this.uniformNames=e.map(function(t){return"u_"+t}),this.type=r}os.prototype.setUniform=function(t,e,r){t.set(r.constantOr(this.value))},os.prototype.getBinding=function(t,e,r){return"color"===this.type?new Xa(t,e):new qa(t,e)};function as(t,e){this.uniformNames=e.map(function(t){return"u_"+t}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}as.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr},as.prototype.setUniform=function(t,e,r,n){var i="u_pattern_to"===n?this.patternTo:"u_pattern_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:null;i&&t.set(i)},as.prototype.getBinding=function(t,e,r){return"u_pattern"===r.substr(0,9)?new Wa(t,e):new qa(t,e)};function ss(t,e,r,n){this.expression=t,this.type=r,this.maxValue=0,this.paintVertexAttributes=e.map(function(t){return{name:"a_"+t,type:"Float32",components:"color"===r?2:1,offset:0}}),this.paintVertexArray=new n}ss.prototype.populatePaintArray=function(t,e,r,n,i){var o=this.paintVertexArray.length,a=this.expression.evaluate(new vi(0),e,{},n,[],i);this.paintVertexArray.resize(t),this._setPaintValue(o,t,a)},ss.prototype.updatePaintArray=function(t,e,r,n){var i=this.expression.evaluate({zoom:0},r,n);this._setPaintValue(t,e,i)},ss.prototype._setPaintValue=function(t,e,r){if("color"===this.type)for(var n=is(r),i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1]);else{for(var o=t;o<e;o++)this.paintVertexArray.emplace(o,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},ss.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ss.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};function us(t,e,r,n,i,o){this.expression=t,this.uniformNames=e.map(function(t){return"u_"+t+"_t"}),this.type=r,this.useIntegerZoom=n,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=e.map(function(t){return{name:"a_"+t,type:"Float32",components:"color"===r?4:2,offset:0}}),this.paintVertexArray=new o}us.prototype.populatePaintArray=function(t,e,r,n,i){var o=this.expression.evaluate(new vi(this.zoom),e,{},n,[],i),a=this.expression.evaluate(new vi(this.zoom+1),e,{},n,[],i),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,o,a)},us.prototype.updatePaintArray=function(t,e,r,n){var i=this.expression.evaluate({zoom:this.zoom},r,n),o=this.expression.evaluate({zoom:this.zoom+1},r,n);this._setPaintValue(t,e,i,o)},us.prototype._setPaintValue=function(t,e,r,n){if("color"===this.type)for(var i=is(r),o=is(n),a=t;a<e;a++)this.paintVertexArray.emplace(a,i[0],i[1],o[0],o[1]);else{for(var s=t;s<e;s++)this.paintVertexArray.emplace(s,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}},us.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},us.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},us.prototype.setUniform=function(t,e){var r=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,n=s(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);t.set(n)},us.prototype.getBinding=function(t,e,r){return new qa(t,e)};function cs(t,e,r,n,i,o){this.expression=t,this.type=e,this.useIntegerZoom=r,this.zoom=n,this.layerId=o,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i}cs.prototype.populatePaintArray=function(t,e,r){var n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(n,t,e.patterns&&e.patterns[this.layerId],r)},cs.prototype.updatePaintArray=function(t,e,r,n,i){this._setPaintValues(t,e,r.patterns&&r.patterns[this.layerId],i)},cs.prototype._setPaintValues=function(t,e,r,n){if(n&&r){var i=n[r.min],o=n[r.mid],a=n[r.max];if(i&&o&&a)for(var s=t;s<e;s++)this.zoomInPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],o.pixelRatio,i.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],o.pixelRatio,a.pixelRatio)}},cs.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ma.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ma.members,this.expression.isStateDependent))},cs.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};function ls(t,e,r,n){this.binders={},this.layoutAttributes=n,this._buffers=[];var i,o,a=[];for(var s in t.paint._values)if(r(s)){var u=t.paint.get(s);if(u instanceof Ti&&$r(u.property.specification)){var c=(i=s,o=t.type,{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(o+"-","").replace(/-/g,"_")]),l=u.value,h=u.property.specification.type,p=u.property.useIntegerZoom,f=u.property.specification["property-type"],d="cross-faded"===f||"cross-faded-data-driven"===f;if("constant"===l.kind)this.binders[s]=d?new as(l.value,c):new os(l.value,c,h),a.push("/u_"+s);else if("source"===l.kind||d){var m=ps(s,h,"source");this.binders[s]=d?new cs(l,h,p,e,m,t.id):new ss(l,c,h,m),a.push("/a_"+s)}else{var g=ps(s,h,"composite");this.binders[s]=new us(l,c,h,p,e,g),a.push("/z_"+s)}}}this.cacheKey=a.sort().join("")}ls.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof ss||e instanceof us?e.maxValue:0},ls.prototype.populatePaintArrays=function(t,e,r,n,i){for(var o in this.binders){var a=this.binders[o];(a instanceof ss||a instanceof us||a instanceof cs)&&a.populatePaintArray(t,e,r,n,i)}},ls.prototype.setConstantPatternPositions=function(t,e){for(var r in this.binders){var n=this.binders[r];n instanceof as&&n.setConstantPatternPositions(t,e)}},ls.prototype.updatePaintArrays=function(t,e,r,n,i){var o=!1;for(var a in t)for(var s=0,u=e.getPositions(a);s<u.length;s+=1){var c=u[s],l=r.feature(c.index);for(var h in this.binders){var p=this.binders[h];if((p instanceof ss||p instanceof us||p instanceof cs)&&!0===p.expression.isStateDependent){var f=n.paint.get(h);p.expression=f.value,p.updatePaintArray(c.start,c.end,l,t[a],i),o=!0}}}return o},ls.prototype.defines=function(){var t=[];for(var e in this.binders){var r=this.binders[e];(r instanceof os||r instanceof as)&&t.push.apply(t,r.uniformNames.map(function(t){return"#define HAS_UNIFORM_"+t}))}return t},ls.prototype.getPaintVertexBuffers=function(){return this._buffers},ls.prototype.getUniforms=function(t,e){var r=[];for(var n in this.binders){var i=this.binders[n];if(i instanceof os||i instanceof as||i instanceof us)for(var o=0,a=i.uniformNames;o<a.length;o+=1){var s=a[o];if(e[s]){var u=i.getBinding(t,e[s],s);r.push({name:s,property:n,binding:u})}}}return r},ls.prototype.setUniforms=function(t,e,r,n){for(var i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.name,u=a.property;this.binders[u].setUniform(a.binding,n,r.get(u),s)}},ls.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var r=this.binders[e];if(t&&r instanceof cs){var n=2===t.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;n&&this._buffers.push(n)}else(r instanceof ss||r instanceof us)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},ls.prototype.upload=function(t){for(var e in this.binders){var r=this.binders[e];(r instanceof ss||r instanceof us||r instanceof cs)&&r.upload(t)}this.updatePaintBuffers()},ls.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof ss||e instanceof us||e instanceof cs)&&e.destroy()}};function hs(t,e,r,n){void 0===n&&(n=function(){return!0}),this.programConfigurations={};for(var i=0,o=e;i<o.length;i+=1){var a=o[i];this.programConfigurations[a.id]=new ls(a,r,n,t)}this.needsUpload=!1,this._featureMap=new Ia,this._bufferOffset=0}function ps(t,e,r){var n={color:{source:Zo,composite:Qo},number:{source:Lo,composite:Zo}},i={"line-pattern":{source:io,composite:io},"fill-pattern":{source:io,composite:io},"fill-extrusion-pattern":{source:io,composite:io}}[t];return i&&i[r]||n[e][r]}hs.prototype.populatePaintArrays=function(t,e,r,n,i,o){for(var a in this.programConfigurations)this.programConfigurations[a].populatePaintArrays(t,e,n,i,o);void 0!==e.id&&this._featureMap.add(e.id,r,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},hs.prototype.updatePaintArrays=function(t,e,r,n){for(var i=0,o=r;i<o.length;i+=1){var a=o[i];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,this._featureMap,e,a,n)||this.needsUpload}},hs.prototype.get=function(t){return this.programConfigurations[t]},hs.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},hs.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},Jn("ConstantBinder",os),Jn("CrossFadedConstantBinder",as),Jn("SourceExpressionBinder",ss),Jn("CrossFadedCompositeBinder",cs),Jn("CompositeExpressionBinder",us),Jn("ProgramConfiguration",ls,{omit:["_buffers"]}),Jn("ProgramConfigurationSet",hs);var fs={min:-1*Math.pow(2,14),max:Math.pow(2,14)-1};function ds(t){for(var e=De/t.extent,r=t.loadGeometry(),n=0;n<r.length;n++)for(var i=r[n],o=0;o<i.length;o++){var a=i[o];a.x=Math.round(a.x*e),a.y=Math.round(a.y*e),(a.x<fs.min||a.x>fs.max||a.y<fs.min||a.y>fs.max)&&(pt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a.x=s(a.x,fs.min,fs.max),a.y=s(a.y,fs.min,fs.max))}return r}function ms(t,e,r,n,i){t.emplaceBack(2*e+(n+1)/2,2*r+(i+1)/2)}function gs(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new $i,this.indexArray=new Uo,this.segments=new Sa,this.programConfigurations=new hs(Ea,t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})}function ys(t,e){for(var r=0;r<t.length;r++)if(Es(e,t[r]))return!0;for(var n=0;n<e.length;n++)if(Es(t,e[n]))return!0;return!!bs(t,e)}function vs(t,e){if(1===t.length)return Ss(e,t[0]);for(var r=0;r<e.length;r++)for(var n=e[r],i=0;i<n.length;i++)if(Es(t,n[i]))return!0;for(var o=0;o<t.length;o++)if(Ss(e,t[o]))return!0;for(var a=0;a<e.length;a++)if(bs(t,e[a]))return!0;return!1}function _s(t,e,r){if(1<t.length){if(bs(t,e))return!0;for(var n=0;n<e.length;n++)if(xs(e[n],t,r))return!0}for(var i=0;i<t.length;i++)if(xs(t[i],e,r))return!0;return!1}function bs(t,e){if(0===t.length||0===e.length)return!1;for(var r=0;r<t.length-1;r++)for(var n=t[r],i=t[r+1],o=0;o<e.length-1;o++)if(a=n,s=i,u=e[o],c=e[o+1],b(a,u,c)!==b(s,u,c)&&b(a,s,u)!==b(a,s,c))return!0;var a,s,u,c;return!1}function xs(t,e,r){var n=r*r;if(1===e.length)return t.distSqr(e[0])<n;for(var i=1;i<e.length;i++)if(ws(t,e[i-1],e[i])<n)return!0;return!1}function ws(t,e,r){var n=e.distSqr(r);if(0===n)return t.distSqr(e);var i=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/n;return t.distSqr(i<0?e:1<i?r:r.sub(e)._mult(i)._add(e))}function Ss(t,e){for(var r,n,i,o=!1,a=0;a<t.length;a++)for(var s=0,u=(r=t[a]).length-1;s<r.length;u=s++)(n=r[s]).y>e.y!=(i=r[u]).y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(o=!o);return o}function Es(t,e){for(var r=!1,n=0,i=t.length-1;n<t.length;i=n++){var o=t[n],a=t[i];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(r=!r)}return r}function Cs(t,e,r){var n=r[0],i=r[2];if(t.x<n.x&&e.x<n.x||t.x>i.x&&e.x>i.x||t.y<n.y&&e.y<n.y||t.y>i.y&&e.y>i.y)return!1;var o=b(t,e,r[0]);return o!==b(t,e,r[1])||o!==b(t,e,r[2])||o!==b(t,e,r[3])}function Ms(t,e,r){var n=e.paint.get(t).value;return"constant"===n.kind?n.value:r.programConfigurations.get(e.id).getMaxValue(t)}function Ts(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Ps(t,e,r,n,i){if(!e[0]&&!e[1])return t;var o=ht.convert(e)._mult(i);"viewport"===r&&o._rotate(-n);for(var a=[],s=0;s<t.length;s++)a.push(t[s].sub(o));return a}gs.prototype.populate=function(t,e,r){var n=this.layers[0],i=[],o=null;"circle"===n.type&&(o=n.layout.get("circle-sort-key"));for(var a=0,s=t;a<s.length;a+=1){var u=s[a],c=u.feature,l=u.id,h=u.index,p=u.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,d={type:c.type,id:l,properties:c.properties,geometry:f?ds(c):[]};if(this.layers[0]._featureFilter.filter(new vi(this.zoom),d,r)){f||(d.geometry=ds(c));var m=o?o.evaluate(d,{},r):void 0;i.push({id:l,properties:c.properties,type:c.type,sourceLayerIndex:p,index:h,geometry:d.geometry,patterns:{},sortKey:m})}}o&&i.sort(function(t,e){return t.sortKey-e.sortKey});for(var g=0,y=i;g<y.length;g+=1){var v=y[g],_=v.geometry,b=v.index,x=v.sourceLayerIndex,w=t[b].feature;this.addFeature(v,_,b,r),e.featureIndex.insert(w,_,b,x,this.index)}},gs.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},gs.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},gs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},gs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ea),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},gs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},gs.prototype.addFeature=function(t,e,r,n){for(var i=0,o=e;i<o.length;i+=1)for(var a=0,s=o[i];a<s.length;a+=1){var u=s[a],c=u.x,l=u.y;if(!(c<0||De<=c||l<0||De<=l)){var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),p=h.vertexLength;ms(this.layoutVertexArray,c,l,-1,-1),ms(this.layoutVertexArray,c,l,1,-1),ms(this.layoutVertexArray,c,l,1,1),ms(this.layoutVertexArray,c,l,-1,1),this.indexArray.emplaceBack(p,p+1,p+2),this.indexArray.emplaceBack(p,p+3,p+2),h.vertexLength+=4,h.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{},n)},Jn("CircleBucket",gs,{omit:["layers"]});var Os,As,Is=new Di({"circle-sort-key":new Ai(kt.layout_circle["circle-sort-key"])}),Ls={paint:new Di({"circle-radius":new Ai(kt.paint_circle["circle-radius"]),"circle-color":new Ai(kt.paint_circle["circle-color"]),"circle-blur":new Ai(kt.paint_circle["circle-blur"]),"circle-opacity":new Ai(kt.paint_circle["circle-opacity"]),"circle-translate":new Oi(kt.paint_circle["circle-translate"]),"circle-translate-anchor":new Oi(kt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Oi(kt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Oi(kt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ai(kt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ai(kt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ai(kt.paint_circle["circle-stroke-opacity"])}),layout:Is},Rs="undefined"!=typeof Float32Array?Float32Array:Array;function Ns(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,r=arguments.length;r--;)e+=t[r]*t[r];return Math.sqrt(e)}),Os=new Rs(3),Rs!=Float32Array&&(Os[0]=0,Os[1]=0,Os[2]=0),As=new Rs(4),Rs!=Float32Array&&(As[0]=0,As[1]=0,As[2]=0,As[3]=0);var ks,Ds,js=(Ds=new Rs(2),Rs!=Float32Array&&(Ds[0]=0,Ds[1]=0),(ks=Bi)&&(zs.__proto__=ks),((zs.prototype=Object.create(ks&&ks.prototype)).constructor=zs).prototype.createBucket=function(t){return new gs(t)},zs.prototype.queryRadius=function(t){var e=t;return Ms("circle-radius",this,e)+Ms("circle-stroke-width",this,e)+Ts(this.paint.get("circle-translate"))},zs.prototype.queryIntersectsFeature=function(t,e,r,n,i,o,a,s){for(var u=Ps(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),c=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),l="map"===this.paint.get("circle-pitch-alignment"),h=l?u:function(t,e){return u.map(function(t){return Fs(t,e)})}(0,s),p=l?c*a:c,f=0,d=n;f<d.length;f+=1)for(var m=0,g=d[f];m<g.length;m+=1){var y=g[m],v=l?y:Fs(y,s),_=p,b=Ns([],[y.x,y.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?_*=b[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(_*=o.cameraToCenterDistance/b[3]),S=_,Es(x=h,w=v)||xs(w,x,S))return!0}var x,w,S;return!1},zs);function zs(t){ks.call(this,t,Ls)}function Fs(t,e){var r=Ns([],[t.x,t.y,0,1],e);return new ht(r[0]/r[3],r[1]/r[3])}var Bs,Us=((Bs=gs)&&(Vs.__proto__=Bs),(Vs.prototype=Object.create(Bs&&Bs.prototype)).constructor=Vs);function Vs(){Bs.apply(this,arguments)}function Gs(t,e,r,n){var i=e.width,o=e.height;if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==i*o*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(i*o*r);return t.width=i,t.height=o,t.data=n,t}function qs(t,e,r){var n=e.width,i=e.height;if(n!==t.width||i!==t.height){var o=Gs({},{width:n,height:i},r);Hs(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,i)},r),t.width=n,t.height=i,t.data=o.data}}function Hs(t,e,r,n,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,u=0;u<i.height;u++)for(var c=((r.y+u)*t.width+r.x)*o,l=((n.y+u)*e.width+n.x)*o,h=0;h<i.width*o;h++)s[l+h]=a[c+h];return e}Jn("HeatmapBucket",Us,{omit:["layers"]});var $s=function(t,e){Gs(this,t,1,e)};$s.prototype.resize=function(t){qs(this,t,1)},$s.prototype.clone=function(){return new $s({width:this.width,height:this.height},new Uint8Array(this.data))},$s.copy=function(t,e,r,n,i){Hs(t,e,r,n,i,1)};function Ws(t,e){Gs(this,t,4,e)}Ws.prototype.resize=function(t){qs(this,t,4)},Ws.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Ws.prototype.clone=function(){return new Ws({width:this.width,height:this.height},new Uint8Array(this.data))},Ws.copy=function(t,e,r,n,i){Hs(t,e,r,n,i,4)},Jn("AlphaImage",$s),Jn("RGBAImage",Ws);var Xs={paint:new Di({"heatmap-radius":new Ai(kt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ai(kt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Oi(kt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ki(kt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Oi(kt.paint_heatmap["heatmap-opacity"])})};function Ys(t,e){for(var r=new Uint8Array(1024),n={},i=0,o=0;i<256;i++,o+=4){n[e]=i/255;var a=t.evaluate(n);r[o+0]=Math.floor(255*a.r/a.a),r[o+1]=Math.floor(255*a.g/a.a),r[o+2]=Math.floor(255*a.b/a.a),r[o+3]=Math.floor(255*a.a)}return new Ws({width:256,height:1},r)}var Zs,Ks,Js=((Ks=Bi)&&(ou.__proto__=Ks),((ou.prototype=Object.create(Ks&&Ks.prototype)).constructor=ou).prototype.createBucket=function(t){return new Us(t)},ou.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},ou.prototype._updateColorRamp=function(){this.colorRamp=Ys(this._transitionablePaint._values["heatmap-color"].value.expression,"heatmapDensity"),this.colorRampTexture=null},ou.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},ou.prototype.queryRadius=function(){return 0},ou.prototype.queryIntersectsFeature=function(){return!1},ou.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},ou),Qs={paint:new Di({"hillshade-illumination-direction":new Oi(kt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Oi(kt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Oi(kt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Oi(kt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Oi(kt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Oi(kt.paint_hillshade["hillshade-accent-color"])})},tu=((Zs=Bi)&&(iu.__proto__=Zs),((iu.prototype=Object.create(Zs&&Zs.prototype)).constructor=iu).prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},iu),eu=Gi([{name:"a_pos",components:2,type:"Int16"}],4).members,ru=au,nu=au;function iu(t){Zs.call(this,t,Qs)}function ou(t){Ks.call(this,t,Xs),this._updateColorRamp()}function au(t,e,r){r=r||2;var n,i,o,a,s,u,c,l=e&&e.length,h=l?e[0]*r:t.length,p=su(t,0,h,r,!0),f=[];if(!p||p.next===p.prev)return f;if(l&&(p=function(t,e,r,n){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=su(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),s.push(yu(a));for(s.sort(du),i=0;i<s.length;i++)mu(s[i],r),r=uu(r,r.next);return r}(t,e,p,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var d=r;d<h;d+=r)(s=t[d])<n&&(n=s),(u=t[d+1])<i&&(i=u),o<s&&(o=s),a<u&&(a=u);c=0!==(c=Math.max(o-n,a-i))?1/c:0}return cu(p,f,r,n,i,c),f}function su(t,e,r,n,i){var o,a;if(i===0<Ou(t,e,r,n))for(o=e;o<r;o+=n)a=Mu(o,t[o],t[o+1],a);else for(o=r-n;e<=o;o-=n)a=Mu(o,t[o],t[o+1],a);return a&&bu(a,a.next)&&(Tu(a),a=a.next),a}function uu(t,e){if(!t)return t;e=e||t;var r,n=t;do{if(r=!1,n.steiner||!bu(n,n.next)&&0!==_u(n.prev,n,n.next))n=n.next;else{if(Tu(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function cu(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){for(var i=t;null===i.z&&(i.z=gu(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,(i=i.next)!==t;);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,u,c=1;do{for(r=t,o=t=null,a=0;r;){for(a++,n=r,e=s=0;e<c&&(s++,n=n.nextZ);e++);for(u=c;0<s||0<u&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(r=(i=r).nextZ,s--):(n=(i=n).nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(1<a)}(i)}(t,n,i,o);for(var s,u,c=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?hu(t,n,i,o):lu(t))e.push(s.i/r),e.push(t.i/r),e.push(u.i/r),Tu(t),t=u.next,c=u.next;else if((t=u)===c){a?1===a?cu(t=pu(uu(t),e,r),e,r,n,i,o,2):2===a&&fu(t,e,r,n,i,o):cu(uu(t),e,r,n,i,o,1);break}}}function lu(t){var e=t.prev,r=t,n=t.next;if(0<=_u(e,r,n))return!1;for(var i=t.next.next;i!==t.prev;){if(vu(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&0<=_u(i.prev,i,i.next))return!1;i=i.next}return!0}function hu(t,e,r,n){var i=t.prev,o=t,a=t.next;if(0<=_u(i,o,a))return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,c=gu(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,r,n),l=gu(s,u,e,r,n),h=t.prevZ,p=t.nextZ;h&&h.z>=c&&p&&p.z<=l;){if(h!==t.prev&&h!==t.next&&vu(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&0<=_u(h.prev,h,h.next))return!1;if(h=h.prevZ,p!==t.prev&&p!==t.next&&vu(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=_u(p.prev,p,p.next))return!1;p=p.nextZ}for(;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&vu(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&0<=_u(h.prev,h,h.next))return!1;h=h.prevZ}for(;p&&p.z<=l;){if(p!==t.prev&&p!==t.next&&vu(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=_u(p.prev,p,p.next))return!1;p=p.nextZ}return!0}function pu(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!bu(i,o)&&xu(i,n,n.next,o)&&Eu(i,o)&&Eu(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),Tu(n),Tu(n.next),n=t=o),n=n.next}while(n!==t);return uu(n)}function fu(t,e,r,n,i,o){var a,s,u=t;do{for(var c=u.next.next;c!==u.prev;){if(u.i!==c.i&&(s=c,(a=u).next.i!==s.i&&a.prev.i!==s.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&xu(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(a,s)&&(Eu(a,s)&&Eu(s,a)&&function(t,e){for(var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),(r=r.next)!==t;);return n}(a,s)&&(_u(a.prev,a,s.prev)||_u(a,s.prev,s))||bu(a,s)&&0<_u(a.prev,a,a.next)&&0<_u(s.prev,s,s.next)))){var l=Cu(u,c);return u=uu(u,u.next),l=uu(l,l.next),cu(u,e,r,n,i,o),void cu(l,e,r,n,i,o)}c=c.next}u=u.next}while(u!==t)}function du(t,e){return t.x-e.x}function mu(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&a<s){if((a=s)===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r;var u,c,l,h=r,p=r.x,f=r.y,d=1/0;for(n=r;i>=n.x&&n.x>=p&&i!==n.x&&vu(o<f?i:a,o,p,f,o<f?a:i,o,n.x,n.y)&&(u=Math.abs(o-n.y)/(i-n.x),Eu(n,t)&&(u<d||u===d&&(n.x>r.x||n.x===r.x&&(l=n,_u((c=r).prev,c,l.prev)<0&&_u(l.next,c,c.next)<0)))&&(r=n,d=u)),(n=n.next)!==h;);return r}(t,e)){var r=Cu(e,t);uu(e,e.next),uu(r,r.next)}}function gu(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function yu(t){for(var e=t,r=t;(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),(e=e.next)!==t;);return r}function vu(t,e,r,n,i,o,a,s){return 0<=(i-a)*(e-s)-(t-a)*(o-s)&&0<=(t-a)*(n-s)-(r-a)*(e-s)&&0<=(r-a)*(o-s)-(i-a)*(n-s)}function _u(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function bu(t,e){return t.x===e.x&&t.y===e.y}function xu(t,e,r,n){var i=Su(_u(t,e,r)),o=Su(_u(t,e,n)),a=Su(_u(r,n,t)),s=Su(_u(r,n,e));return i!==o&&a!==s||!(0!==i||!wu(t,r,e))||!(0!==o||!wu(t,n,e))||!(0!==a||!wu(r,t,n))||!(0!==s||!wu(r,e,n))}function wu(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Su(t){return 0<t?1:t<0?-1:0}function Eu(t,e){return _u(t.prev,t,t.next)<0?0<=_u(t,e,t.next)&&0<=_u(t,t.prev,e):_u(t,e,t.prev)<0||_u(t,t.next,e)<0}function Cu(t,e){var r=new Pu(t.i,t.x,t.y),n=new Pu(e.i,e.x,e.y),i=t.next,o=e.prev;return(t.next=e).prev=t,(r.next=i).prev=r,(n.next=r).prev=n,(o.next=n).prev=o,n}function Mu(t,e,r,n){var i=new Pu(t,e,r);return n?(i.next=n.next,(i.prev=n).next.prev=i,n.next=i):(i.prev=i).next=i,i}function Tu(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Pu(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ou(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function Au(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function Iu(t,e){return t<e?-1:e<t?1:0}function Lu(t,e){var r,n,i,o,a,s=t.length;if(s<=1)return[t];for(var u,c,l=[],h=0;h<s;h++){var p=x(t[h]);0!==p&&(t[h].area=Math.abs(p),void 0===c&&(c=p<0),c===p<0?(u&&l.push(u),u=[t[h]]):u.push(t[h]))}if(u&&l.push(u),1<e)for(var f=0;f<l.length;f++)l[f].length<=e||(r=l[f],n=e,i=1,o=l[f].length-1,a=Ru,function t(e,r,n,i,o){for(;n<i;){if(600<i-n){var a=i-n+1,s=r-n+1,u=Math.log(a),c=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*c*(a-c)/a)*(s-a/2<0?-1:1);t(e,r,Math.max(n,Math.floor(r-s*c/a+l)),Math.min(i,Math.floor(r+(a-s)*c/a+l)),o)}var h=e[r],p=n,f=i;for(Au(e,n,r),0<o(e[i],h)&&Au(e,n,i);p<f;){for(Au(e,p,f),p++,f--;o(e[p],h)<0;)p++;for(;0<o(e[f],h);)f--}0===o(e[n],h)?Au(e,n,f):Au(e,++f,i),f<=r&&(n=f+1),r<=f&&(i=f-1)}}(r,n,i||0,o||r.length-1,a||Iu),l[f]=l[f].slice(0,e));return l}function Ru(t,e){return e.area-t.area}function Nu(t,e,r){for(var n=r.patternDependencies,i=!1,o=0,a=e;o<a.length;o+=1){var s=a[o].paint.get(t+"-pattern");s.isConstant()||(i=!0);var u=s.constantOr(null);u&&(i=!0,n[u.to]=!0,n[u.from]=!0)}return i}function ku(t,e,r,n,i){for(var o=i.patternDependencies,a=0,s=e;a<s.length;a+=1){var u=s[a],c=u.paint.get(t+"-pattern").value;if("constant"!==c.kind){var l=c.evaluate({zoom:n-1},r,{},i.availableImages),h=c.evaluate({zoom:n},r,{},i.availableImages),p=c.evaluate({zoom:n+1},r,{},i.availableImages);h=h&&h.name?h.name:h,p=p&&p.name?p.name:p,o[l=l&&l.name?l.name:l]=!0,o[h]=!0,o[p]=!0,r.patterns[u.id]={min:l,mid:h,max:p}}}return r}au.deviation=function(t,e,r,n){var i=e&&e.length,o=Math.abs(Ou(t,0,i?e[0]*r:t.length,r));if(i)for(var a=0,s=e.length;a<s;a++)o-=Math.abs(Ou(t,e[a]*r,a<s-1?e[a+1]*r:t.length,r));var u=0;for(a=0;a<n.length;a+=3){var c=n[a]*r,l=n[a+1]*r,h=n[a+2]*r;u+=Math.abs((t[c]-t[h])*(t[1+l]-t[1+c])-(t[c]-t[l])*(t[1+h]-t[1+c]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},au.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);0<i&&r.holes.push(n+=t[i-1].length)}return r},ru.default=nu;function Du(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new $i,this.indexArray=new Uo,this.indexArray2=new qo,this.programConfigurations=new hs(eu,t.layers,t.zoom),this.segments=new Sa,this.segments2=new Sa,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})}Du.prototype.populate=function(t,e,r){this.hasPattern=Nu("fill",this.layers,e);for(var n=this.layers[0].layout.get("fill-sort-key"),i=[],o=0,a=t;o<a.length;o+=1){var s=a[o],u=s.feature,c=s.id,l=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,f={type:u.type,id:c,properties:u.properties,geometry:p?ds(u):[]};if(this.layers[0]._featureFilter.filter(new vi(this.zoom),f,r)){p||(f.geometry=ds(u));var d=n?n.evaluate(f,{},r,e.availableImages):void 0;i.push({id:c,properties:u.properties,type:u.type,sourceLayerIndex:h,index:l,geometry:f.geometry,patterns:{},sortKey:d})}}n&&i.sort(function(t,e){return t.sortKey-e.sortKey});for(var m=0,g=i;m<g.length;m+=1){var y=g[m],v=y.geometry,_=y.index,b=y.sourceLayerIndex;if(this.hasPattern){var x=ku("fill",this.layers,y,this.zoom,e);this.patternFeatures.push(x)}else this.addFeature(y,v,_,r,{});e.featureIndex.insert(t[_].feature,v,_,b,this.index)}},Du.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Du.prototype.addFeatures=function(t,e,r){for(var n=0,i=this.patternFeatures;n<i.length;n+=1){var o=i[n];this.addFeature(o,o.geometry,o.index,e,r)}},Du.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Du.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Du.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,eu),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Du.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Du.prototype.addFeature=function(t,e,r,n,i){for(var o=0,a=Lu(e,500);o<a.length;o+=1){for(var s=a[o],u=0,c=0,l=s;c<l.length;c+=1)u+=l[c].length;for(var h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray),p=h.vertexLength,f=[],d=[],m=0,g=s;m<g.length;m+=1){var y=g[m];if(0!==y.length){y!==s[0]&&d.push(f.length/2);var v=this.segments2.prepareSegment(y.length,this.layoutVertexArray,this.indexArray2),_=v.vertexLength;this.layoutVertexArray.emplaceBack(y[0].x,y[0].y),this.indexArray2.emplaceBack(_+y.length-1,_),f.push(y[0].x),f.push(y[0].y);for(var b=1;b<y.length;b++)this.layoutVertexArray.emplaceBack(y[b].x,y[b].y),this.indexArray2.emplaceBack(_+b-1,_+b),f.push(y[b].x),f.push(y[b].y);v.vertexLength+=y.length,v.primitiveLength+=y.length}}for(var x=ru(f,d),w=0;w<x.length;w+=3)this.indexArray.emplaceBack(p+x[w],p+x[w+1],p+x[w+2]);h.vertexLength+=u,h.primitiveLength+=x.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i,n)},Jn("FillBucket",Du,{omit:["layers","patternFeatures"]});var ju,zu=new Di({"fill-sort-key":new Ai(kt.layout_fill["fill-sort-key"])}),Fu={paint:new Di({"fill-antialias":new Oi(kt.paint_fill["fill-antialias"]),"fill-opacity":new Ai(kt.paint_fill["fill-opacity"]),"fill-color":new Ai(kt.paint_fill["fill-color"]),"fill-outline-color":new Ai(kt.paint_fill["fill-outline-color"]),"fill-translate":new Oi(kt.paint_fill["fill-translate"]),"fill-translate-anchor":new Oi(kt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ri(kt.paint_fill["fill-pattern"])}),layout:zu},Bu=((ju=Bi)&&(Gu.__proto__=ju),((Gu.prototype=Object.create(ju&&ju.prototype)).constructor=Gu).prototype.recalculate=function(t,e){ju.prototype.recalculate.call(this,t,e);var r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},Gu.prototype.createBucket=function(t){return new Du(t)},Gu.prototype.queryRadius=function(){return Ts(this.paint.get("fill-translate"))},Gu.prototype.queryIntersectsFeature=function(t,e,r,n,i,o,a){return vs(Ps(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),n)},Gu.prototype.isTileClipped=function(){return!0},Gu),Uu=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Vu=qu;function Gu(t){ju.call(this,t,Fu)}function qu(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(Hu,this,e)}function Hu(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function $u(t){for(var e,r,n=0,i=0,o=t.length,a=o-1;i<o;a=i++)n+=((r=t[a]).x-(e=t[i]).x)*(e.y+r.y);return n}qu.types=["Unknown","Point","LineString","Polygon"],qu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,i=0,o=0,a=0,s=[];t.pos<r;){if(i<=0){var u=t.readVarint();n=7&u,i=u>>3}if(i--,1===n||2===n)o+=t.readSVarint(),a+=t.readSVarint(),1===n&&(e&&s.push(e),e=[]),e.push(new ht(o,a));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&s.push(e),s},qu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,c=-1/0;t.pos<e;){if(n<=0){var l=t.readVarint();r=7&l,n=l>>3}if(n--,1===r||2===r)(i+=t.readSVarint())<a&&(a=i),s<i&&(s=i),(o+=t.readSVarint())<u&&(u=o),c<o&&(c=o);else if(7!==r)throw new Error("unknown command "+r)}return[a,u,s,c]},qu.prototype.toGeoJSON=function(t,e,r){var n,i,o=this.extent*Math.pow(2,r),a=this.extent*t,s=this.extent*e,u=this.loadGeometry(),c=qu.types[this.type];function l(t){for(var e=0;e<t.length;e++){var r=t[e];t[e]=[360*(r.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<u.length;n++)h[n]=u[n][0];l(u=h);break;case 2:for(n=0;n<u.length;n++)l(u[n]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var r,n,i=[],o=0;o<e;o++){var a=$u(t[o]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(r&&i.push(r),r=[t[o]]):r.push(t[o]))}return r&&i.push(r),i}(u),n=0;n<u.length;n++)for(i=0;i<u[n].length;i++)l(u[n][i])}1===u.length?u=u[0]:c="Multi"+c;var p={type:"Feature",geometry:{type:c,coordinates:u},properties:this.properties};return"id"in this&&(p.id=this.id),p};var Wu=Xu;function Xu(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Yu,this,e),this.length=this._features.length}function Yu(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var n=t.readVarint()>>3;e=1==n?t.readString():2==n?t.readFloat():3==n?t.readDouble():4==n?t.readVarint64():5==n?t.readVarint():6==n?t.readSVarint():7==n?t.readBoolean():null}return e}(r))}function Zu(t,e,r){if(3===t){var n=new Wu(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}Xu.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Vu(this._pbf,e,this.extent,this._keys,this._values)};var Ku={VectorTile:function(t,e){this.layers=t.readFields(Zu,{},e)},VectorTileFeature:Vu,VectorTileLayer:Wu},Ju=Ku.VectorTileFeature.types,Qu=Math.pow(2,13);function tc(t,e,r,n,i,o,a,s){t.emplaceBack(e,r,2*Math.floor(n*Qu)+a,i*Qu*2,o*Qu*2,Math.round(s))}function ec(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ji,this.indexArray=new Uo,this.programConfigurations=new hs(Uu,t.layers,t.zoom),this.segments=new Sa,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})}ec.prototype.populate=function(t,e,r){this.features=[],this.hasPattern=Nu("fill-extrusion",this.layers,e);for(var n=0,i=t;n<i.length;n+=1){var o=i[n],a=o.feature,s=o.id,u=o.index,c=o.sourceLayerIndex,l=this.layers[0]._featureFilter.needGeometry,h={type:a.type,id:s,properties:a.properties,geometry:l?ds(a):[]};if(this.layers[0]._featureFilter.filter(new vi(this.zoom),h,r)){var p={id:s,sourceLayerIndex:c,index:u,geometry:l?h.geometry:ds(a),properties:a.properties,type:a.type,patterns:{}};void 0!==a.id&&(p.id=a.id),this.hasPattern?this.features.push(ku("fill-extrusion",this.layers,p,this.zoom,e)):this.addFeature(p,p.geometry,u,r,{}),e.featureIndex.insert(a,p.geometry,u,c,this.index,!0)}}},ec.prototype.addFeatures=function(t,e,r){for(var n=0,i=this.features;n<i.length;n+=1){var o=i[n];this.addFeature(o,o.geometry,o.index,e,r)}},ec.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},ec.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ec.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ec.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Uu),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ec.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ec.prototype.addFeature=function(t,e,r,n,i){for(var o=0,a=Lu(e,500);o<a.length;o+=1){for(var s=a[o],u=0,c=0,l=s;c<l.length;c+=1)u+=l[c].length;for(var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),p=0,f=s;p<f.length;p+=1){var d=f[p];if(0!==d.length&&!((N=d).every(function(t){return t.x<0})||N.every(function(t){return t.x>De})||N.every(function(t){return t.y<0})||N.every(function(t){return t.y>De})))for(var m=0,g=0;g<d.length;g++){var y=d[g];if(1<=g){var v=d[g-1];if(R=v,!((L=y).x===R.x&&(L.x<0||L.x>De)||L.y===R.y&&(L.y<0||L.y>De))){h.vertexLength+4>Sa.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var _=y.sub(v)._perp()._unit(),b=v.dist(y);32768<m+b&&(m=0),tc(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,0,m),tc(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,1,m),tc(this.layoutVertexArray,v.x,v.y,_.x,_.y,0,0,m+=b),tc(this.layoutVertexArray,v.x,v.y,_.x,_.y,0,1,m);var x=h.vertexLength;this.indexArray.emplaceBack(x,x+2,x+1),this.indexArray.emplaceBack(x+1,x+2,x+3),h.vertexLength+=4,h.primitiveLength+=2}}}}if(h.vertexLength+u>Sa.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray)),"Polygon"===Ju[t.type]){for(var w=[],S=[],E=h.vertexLength,C=0,M=s;C<M.length;C+=1){var T=M[C];if(0!==T.length){T!==s[0]&&S.push(w.length/2);for(var P=0;P<T.length;P++){var O=T[P];tc(this.layoutVertexArray,O.x,O.y,0,0,1,1,0),w.push(O.x),w.push(O.y)}}}for(var A=ru(w,S),I=0;I<A.length;I+=3)this.indexArray.emplaceBack(E+A[I],E+A[I+2],E+A[I+1]);h.primitiveLength+=A.length/3,h.vertexLength+=u}}var L,R,N;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i,n)},Jn("FillExtrusionBucket",ec,{omit:["layers","features"]});var rc,nc={paint:new Di({"fill-extrusion-opacity":new Oi(kt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ai(kt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Oi(kt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Oi(kt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ri(kt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ai(kt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ai(kt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Oi(kt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},ic=((rc=Bi)&&(oc.__proto__=rc),((oc.prototype=Object.create(rc&&rc.prototype)).constructor=oc).prototype.createBucket=function(t){return new ec(t)},oc.prototype.queryRadius=function(){return Ts(this.paint.get("fill-extrusion-translate"))},oc.prototype.is3D=function(){return!0},oc.prototype.queryIntersectsFeature=function(t,e,r,n,i,o,a,s){var u=Ps(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,a),c=this.paint.get("fill-extrusion-height").evaluate(e,r),l=this.paint.get("fill-extrusion-base").evaluate(e,r),h=function(t,e){for(var r=[],n=0,i=u;n<i.length;n+=1){var o=i[n],a=[o.x,o.y,0,1];Ns(a,a,e),r.push(new ht(a[0]/a[3],a[1]/a[3]))}return r}(0,s),p=function(t,e,r,n){for(var i=[],o=[],a=n[8]*e,s=n[9]*e,u=n[10]*e,c=n[11]*e,l=n[8]*r,h=n[9]*r,p=n[10]*r,f=n[11]*r,d=0,m=t;d<m.length;d+=1){for(var g=[],y=[],v=0,_=m[d];v<_.length;v+=1){var b=_[v],x=b.x,w=b.y,S=n[0]*x+n[4]*w+n[12],E=n[1]*x+n[5]*w+n[13],C=n[2]*x+n[6]*w+n[14],M=n[3]*x+n[7]*w+n[15],T=C+u,P=M+c,O=S+l,A=E+h,I=C+p,L=M+f,R=new ht((S+a)/P,(E+s)/P);R.z=T/P,g.push(R);var N=new ht(O/L,A/L);N.z=I/L,y.push(N)}i.push(g),o.push(y)}return[i,o]}(n,l,c,s);return function(t,e,r){var n=1/0;vs(r,e)&&(n=sc(r,e[0]));for(var i=0;i<e.length;i++)for(var o=e[i],a=t[i],s=0;s<o.length-1;s++){var u=o[s],c=[u,o[s+1],a[s+1],a[s],u];ys(r,c)&&(n=Math.min(n,sc(r,c)))}return n!==1/0&&n}(p[0],p[1],h)},oc);function oc(t){rc.call(this,t,nc)}function ac(t,e){return t.x*e.x+t.y*e.y}function sc(t,e){if(1===t.length){for(var r,n,i=0,o=e[i++];!r||o.equals(r);)if(!(r=e[i++]))return 1/0;for(;!n||o.equals(n)||r.equals(n);)if(!(n=e[i++]))return 1/0;var a=t[0],s=r.sub(o),u=n.sub(o),c=a.sub(o),l=ac(s,s),h=ac(s,u),p=ac(u,u),f=ac(c,s),d=ac(c,u),m=l*p-h*h,g=(p*f-h*d)/m,y=(l*d-h*f)/m;return o.z*(1-g-y)+r.z*g+n.z*y}for(var v=1/0,_=0,b=e;_<b.length;_+=1)v=Math.min(v,b[_].z);return v}function uc(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new eo,this.indexArray=new Uo,this.programConfigurations=new hs(cc,t.layers,t.zoom),this.segments=new Sa,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})}var cc=Gi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,lc=Ku.VectorTileFeature.types,hc=Math.cos(Math.PI/180*37.5),pc=Math.pow(2,14)/.5;uc.prototype.populate=function(t,e,r){this.hasPattern=Nu("line",this.layers,e);for(var n=this.layers[0].layout.get("line-sort-key"),i=[],o=0,a=t;o<a.length;o+=1){var s=a[o],u=s.feature,c=s.id,l=s.index,h=s.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,f={type:u.type,id:c,properties:u.properties,geometry:p?ds(u):[]};if(this.layers[0]._featureFilter.filter(new vi(this.zoom),f,r)){p||(f.geometry=ds(u));var d=n?n.evaluate(f,{},r):void 0;i.push({id:c,properties:u.properties,type:u.type,sourceLayerIndex:h,index:l,geometry:f.geometry,patterns:{},sortKey:d})}}n&&i.sort(function(t,e){return t.sortKey-e.sortKey});for(var m=0,g=i;m<g.length;m+=1){var y=g[m],v=y.geometry,_=y.index,b=y.sourceLayerIndex;if(this.hasPattern){var x=ku("line",this.layers,y,this.zoom,e);this.patternFeatures.push(x)}else this.addFeature(y,v,_,r,{});e.featureIndex.insert(t[_].feature,v,_,b,this.index)}},uc.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},uc.prototype.addFeatures=function(t,e,r){for(var n=0,i=this.patternFeatures;n<i.length;n+=1){var o=i[n];this.addFeature(o,o.geometry,o.index,e,r)}},uc.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},uc.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},uc.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},uc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},uc.prototype.addFeature=function(t,e,r,n,i){for(var o=this.layers[0].layout,a=o.get("line-join").evaluate(t,{}),s=o.get("line-cap"),u=o.get("line-miter-limit"),c=o.get("line-round-limit"),l=0,h=e;l<h.length;l+=1)this.addLine(h[l],t,a,s,u,c,r,n,i)},uc.prototype.addLine=function(t,e,r,n,i,o,a,s,u){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end")){this.clipStart=+e.properties.mapbox_clip_start,this.clipEnd=+e.properties.mapbox_clip_end;for(var c=0;c<t.length-1;c++)this.totalDistance+=t[c].dist(t[c+1]);this.updateScaledDistance()}for(var l="Polygon"===lc[e.type],h=t.length;2<=h&&t[h-1].equals(t[h-2]);)h--;for(var p=0;p<h-1&&t[p].equals(t[p+1]);)p++;if(!(h<(l?3:2))){"bevel"===r&&(i=1.05);var f,d=this.overscaling<=16?15*De/(512*this.overscaling):0,m=this.segments.prepareSegment(10*h,this.layoutVertexArray,this.indexArray),g=void 0,y=void 0,v=void 0,_=void 0;this.e1=this.e2=-1,l&&(_=t[p].sub(f=t[h-2])._unit()._perp());for(var b=p;b<h;b++)if(!(y=b===h-1?l?t[p+1]:void 0:t[b+1])||!t[b].equals(y)){_&&(v=_),f&&(g=f),f=t[b],_=y?y.sub(f)._unit()._perp():v;var x=(v=v||_).add(_);0===x.x&&0===x.y||x._unit();var w=v.x*_.x+v.y*_.y,S=x.x*_.x+x.y*_.y,E=0!=S?1/S:1/0,C=2*Math.sqrt(2-2*S),M=S<hc&&g&&y,T=0<v.x*_.y-v.y*_.x;if(M&&p<b){var P=f.dist(g);if(2*d<P){var O=f.sub(f.sub(g)._mult(d/P)._round());this.updateDistance(g,O),this.addCurrentVertex(O,v,0,0,m),g=O}}var A=g&&y,I=A?r:l?"butt":n;if(A&&"round"===I&&(E<o?I="miter":E<=2&&(I="fakeround")),"miter"===I&&i<E&&(I="bevel"),"bevel"===I&&(2<E&&(I="flipbevel"),E<i&&(I="miter")),g&&this.updateDistance(g,f),"miter"===I)x._mult(E),this.addCurrentVertex(f,x,0,0,m);else if("flipbevel"===I){if(100<E)x=_.mult(-1);else{var L=E*v.add(_).mag()/v.sub(_).mag();x._perp()._mult(L*(T?-1:1))}this.addCurrentVertex(f,x,0,0,m),this.addCurrentVertex(f,x.mult(-1),0,0,m)}else if("bevel"===I||"fakeround"===I){var R=-Math.sqrt(E*E-1),N=T?R:0,k=T?0:R;if(g&&this.addCurrentVertex(f,v,N,k,m),"fakeround"===I)for(var D=Math.round(180*C/Math.PI/20),j=1;j<D;j++){var z=j/D;if(.5!==z){var F=z-.5;z+=z*F*(z-1)*((1.0904+w*(w*(3.55645-1.43519*w)-3.2452))*F*F+(.848013+w*(.215638*w-1.06021)))}var B=_.sub(v)._mult(z)._add(v)._unit()._mult(T?-1:1);this.addHalfVertex(f,B.x,B.y,!1,T,0,m)}y&&this.addCurrentVertex(f,_,-N,-k,m)}else if("butt"===I)this.addCurrentVertex(f,x,0,0,m);else if("square"===I){var U=g?1:-1;this.addCurrentVertex(f,x,U,U,m)}else"round"===I&&(g&&(this.addCurrentVertex(f,v,0,0,m),this.addCurrentVertex(f,v,1,1,m,!0)),y&&(this.addCurrentVertex(f,_,-1,-1,m,!0),this.addCurrentVertex(f,_,0,0,m)));if(M&&b<h-1){var V=f.dist(y);if(2*d<V){var G=f.add(y.sub(f)._mult(d/V)._round());this.updateDistance(f,G),this.addCurrentVertex(G,_,0,0,m),f=G}}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,u,s)}},uc.prototype.addCurrentVertex=function(t,e,r,n,i,o){void 0===o&&(o=!1);var a=e.y*n-e.x,s=-e.y-e.x*n;this.addHalfVertex(t,e.x+e.y*r,e.y-e.x*r,o,!1,r,i),this.addHalfVertex(t,a,s,o,!0,-n,i),this.distance>pc/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,r,n,i,o))},uc.prototype.addHalfVertex=function(t,e,r,n,i,o,a){var s=.5*this.scaledDistance;this.layoutVertexArray.emplaceBack((t.x<<1)+(n?1:0),(t.y<<1)+(i?1:0),Math.round(63*e)+128,Math.round(63*r)+128,1+(0===o?0:o<0?-1:1)|(63&s)<<2,s>>6);var u=a.vertexLength++;0<=this.e1&&0<=this.e2&&(this.indexArray.emplaceBack(this.e1,this.e2,u),a.primitiveLength++),i?this.e2=u:this.e1=u},uc.prototype.updateScaledDistance=function(){this.scaledDistance=0<this.totalDistance?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(pc-1):this.distance},uc.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance()},Jn("LineBucket",uc,{omit:["layers","patternFeatures"]});var fc,dc=new Di({"line-cap":new Oi(kt.layout_line["line-cap"]),"line-join":new Ai(kt.layout_line["line-join"]),"line-miter-limit":new Oi(kt.layout_line["line-miter-limit"]),"line-round-limit":new Oi(kt.layout_line["line-round-limit"]),"line-sort-key":new Ai(kt.layout_line["line-sort-key"])}),mc={paint:new Di({"line-opacity":new Ai(kt.paint_line["line-opacity"]),"line-color":new Ai(kt.paint_line["line-color"]),"line-translate":new Oi(kt.paint_line["line-translate"]),"line-translate-anchor":new Oi(kt.paint_line["line-translate-anchor"]),"line-width":new Ai(kt.paint_line["line-width"]),"line-gap-width":new Ai(kt.paint_line["line-gap-width"]),"line-offset":new Ai(kt.paint_line["line-offset"]),"line-blur":new Ai(kt.paint_line["line-blur"]),"line-dasharray":new Ii(kt.paint_line["line-dasharray"]),"line-pattern":new Ri(kt.paint_line["line-pattern"]),"line-gradient":new ki(kt.paint_line["line-gradient"])}),layout:dc},gc=((fc=Ai)&&(yc.__proto__=fc),((yc.prototype=Object.create(fc&&fc.prototype)).constructor=yc).prototype.possiblyEvaluate=function(t,e){return e=new vi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),fc.prototype.possiblyEvaluate.call(this,t,e)},yc.prototype.evaluate=function(t,e,r,n){return e=f({},e,{zoom:Math.floor(e.zoom)}),fc.prototype.evaluate.call(this,t,e,r,n)},new yc(mc.paint.properties["line-width"].specification));function yc(){fc.apply(this,arguments)}gc.useIntegerZoom=!0;var vc,_c=((vc=Bi)&&(bc.__proto__=vc),((bc.prototype=Object.create(vc&&vc.prototype)).constructor=bc).prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&this._updateGradient()},bc.prototype._updateGradient=function(){this.gradient=Ys(this._transitionablePaint._values["line-gradient"].value.expression,"lineProgress"),this.gradientTexture=null},bc.prototype.recalculate=function(t,e){vc.prototype.recalculate.call(this,t,e),this.paint._values["line-floorwidth"]=gc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)},bc.prototype.createBucket=function(t){return new uc(t)},bc.prototype.queryRadius=function(t){var e=t,r=xc(Ms("line-width",this,e),Ms("line-gap-width",this,e)),n=Ms("line-offset",this,e);return r/2+Math.abs(n)+Ts(this.paint.get("line-translate"))},bc.prototype.queryIntersectsFeature=function(t,e,r,n,i,o,a){var s=Ps(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,a),u=a/2*xc(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),c=this.paint.get("line-offset").evaluate(e,r);return c&&(n=function(t,e){for(var r=[],n=new ht(0,0),i=0;i<t.length;i++){for(var o=t[i],a=[],s=0;s<o.length;s++){var u=o[s],c=o[s+1],l=0===s?n:u.sub(o[s-1])._unit()._perp(),h=s===o.length-1?n:c.sub(u)._unit()._perp(),p=l._add(h)._unit();p._mult(1/(p.x*h.x+p.y*h.y)),a.push(p._mult(e)._add(u))}r.push(a)}return r}(n,c*a)),function(t,e,r){for(var n=0;n<e.length;n++){var i=e[n];if(3<=t.length)for(var o=0;o<i.length;o++)if(Es(t,i[o]))return!0;if(_s(t,i,r))return!0}return!1}(s,n,u)},bc.prototype.isTileClipped=function(){return!0},bc);function bc(t){vc.call(this,t,mc)}function xc(t,e){return 0<e?e+2*t:t}var wc=Gi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sc=Gi([{name:"a_projected_pos",components:3,type:"Float32"}],4),Ec=(Gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Gi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Cc=(Gi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Mc=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function Tc(t,i,o){return t.sections.forEach(function(t){var e,r,n;t.text=(e=t.text,r=o,"uppercase"===(n=i.layout.get("text-transform").evaluate(r,{}))?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),bi.applyArabicShaping&&(e=bi.applyArabicShaping(e)),e)}),t}Gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"}]),Gi([{type:"Float32",name:"offsetX"}]),Gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);function Pc(t,e,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,c=u>>1,l=-7,h=r?i-1:0,p=r?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-l)-1,f>>=-l,l+=s;0<l;o=256*o+t[e+h],h+=p,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;0<l;a=256*a+t[e+h],h+=p,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),o-=c}return(f?-1:1)*a*Math.pow(2,o-n)}function Oc(t,e,r,n,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,h=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,d=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),2<=(e+=1<=a+h?p/u:p*Math.pow(2,1-h))*u&&(a++,u/=2),l<=a+h?(s=0,a=l):1<=a+h?(s=(e*u-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));8<=i;t[r+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,c+=i;0<c;t[r+f]=255&a,f+=d,a/=256,c-=8);t[r+f-d]|=128*m}var Ac={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},Ic=24,Lc=Rc;function Rc(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Rc.Varint=0,Rc.Fixed64=1,Rc.Bytes=2,Rc.Fixed32=5;var Nc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function kc(t){return t.type===Rc.Bytes?t.readVarint()+t.pos:t.pos+1}function Dc(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function jc(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;t<=i;i--)r.buf[i+n]=r.buf[i]}function zc(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Fc(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function Bc(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Uc(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Vc(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Gc(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function qc(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function Hc(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function $c(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function Wc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Xc(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function Yc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Rc.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,t(i,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Wc(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Yc(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Wc(this.buf,this.pos)+4294967296*Wc(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=Wc(this.buf,this.pos)+4294967296*Yc(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Pc(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Pc(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,o=r.buf;if(n=(112&(i=o[r.pos++]))>>4,i<128)return Dc(t,n,e);if(n|=(127&(i=o[r.pos++]))<<3,i<128)return Dc(t,n,e);if(n|=(127&(i=o[r.pos++]))<<10,i<128)return Dc(t,n,e);if(n|=(127&(i=o[r.pos++]))<<17,i<128)return Dc(t,n,e);if(n|=(127&(i=o[r.pos++]))<<24,i<128)return Dc(t,n,e);if(n|=(1&(i=o[r.pos++]))<<31,i<128)return Dc(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t,e,r,n=this.readVarint()+this.pos,h=this.pos;return 12<=(this.pos=n)-h&&Nc?(t=this.buf,e=h,r=n,Nc.decode(t.subarray(e,r))):function(t,e,r){for(var n="",i=h;i<r;){var o,a,s,u=t[i],c=null,l=239<u?4:223<u?3:191<u?2:1;if(r<i+l)break;1===l?u<128&&(c=u):2===l?128==(192&(o=t[i+1]))&&(c=(31&u)<<6|63&o)<=127&&(c=null):3===l?(a=t[i+2],128==(192&(o=t[i+1]))&&128==(192&a)&&((c=(15&u)<<12|(63&o)<<6|63&a)<=2047||55296<=c&&c<=57343)&&(c=null)):4===l&&(a=t[i+2],s=t[i+3],128==(192&(o=t[i+1]))&&128==(192&a)&&128==(192&s)&&((c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||1114112<=c)&&(c=null)),null===c?(c=65533,l=1):65535<c&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),i+=l}return n}(this.buf,0,n)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Rc.Bytes)return t.push(this.readVarint(e));var r=kc(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Rc.Bytes)return t.push(this.readSVarint());var e=kc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Rc.Bytes)return t.push(this.readBoolean());var e=kc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Rc.Bytes)return t.push(this.readFloat());var e=kc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Rc.Bytes)return t.push(this.readDouble());var e=kc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Rc.Bytes)return t.push(this.readFixed32());var e=kc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Rc.Bytes)return t.push(this.readSFixed32());var e=kc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Rc.Bytes)return t.push(this.readFixed64());var e=kc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Rc.Bytes)return t.push(this.readSFixed64());var e=kc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Rc.Varint)for(;127<this.buf[this.pos++];);else if(e===Rc.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Rc.Fixed32)this.pos+=4;else{if(e!==Rc.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Xc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Xc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Xc(this.buf,-1&t,this.pos),Xc(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Xc(this.buf,-1&t,this.pos),Xc(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(c){268435455<(c=+c||0)||c<0?function(t,e){var r,n,i,o,a,s,u;if(0<=c?(r=c%4294967296|0,n=c/4294967296|0):(n=~(-c/4294967296),4294967295^(r=~(-c%4294967296))?r=r+1|0:n=n+1|(r=0)),0x10000000000000000<=c||c<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),s=r,(u=e).buf[u.pos++]=127&s|128,s>>>=7,u.buf[u.pos++]=127&s|128,s>>>=7,u.buf[u.pos++]=127&s|128,s>>>=7,u.buf[u.pos++]=127&s|128,u.buf[u.pos]=127&(s>>>=7),a=(7&(i=n))<<4,(o=e).buf[o.pos++]|=a|((i>>>=3)?128:0),i&&(o.buf[o.pos++]=127&i|((i>>>=7)?128:0),i&&(o.buf[o.pos++]=127&i|((i>>>=7)?128:0),i&&(o.buf[o.pos++]=127&i|((i>>>=7)?128:0),i&&(o.buf[o.pos++]=127&i|((i>>>=7)?128:0),i&&(o.buf[o.pos++]=127&i)))))}(0,this):(this.realloc(4),this.buf[this.pos++]=127&c|(127<c?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(127<c?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(127<c?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,o=0;o<e.length;o++){if(55295<(n=e.charCodeAt(o))&&n<57344){if(!i){56319<n||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;128<=r&&jc(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Oc(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Oc(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;128<=n&&jc(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,Rc.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,zc,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Fc,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Vc,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Bc,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Uc,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Gc,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,qc,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Hc,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,$c,e)},writeBytesField:function(t,e){this.writeTag(t,Rc.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Rc.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Rc.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Rc.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Rc.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Rc.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Rc.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Rc.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Rc.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Rc.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Zc=3;function Kc(t,e,r){1===t&&r.readMessage(Jc,e)}function Jc(t,e,r){if(3===t){var n=r.readMessage(Qc,{}),i=n.width,o=n.height,a=n.left,s=n.top,u=n.advance;e.push({id:n.id,bitmap:new $s({width:i+2*Zc,height:o+2*Zc},n.bitmap),metrics:{width:i,height:o,left:a,top:s,advance:u}})}}function Qc(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint())}var tl=Zc;function el(t){for(var e=0,r=0,n=0,i=t;n<i.length;n+=1){var o=i[n];e+=o.w*o.h,r=Math.max(r,o.w)}t.sort(function(t,e){return e.h-t.h});for(var a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],s=0,u=0,c=0,l=t;c<l.length;c+=1)for(var h=l[c],p=a.length-1;0<=p;p--){var f=a[p];if(!(h.w>f.w||h.h>f.h)){if(h.x=f.x,h.y=f.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===f.w&&h.h===f.h){var d=a.pop();p<a.length&&(a[p]=d)}else h.h===f.h?(f.x+=h.w,f.w-=h.w):(h.w===f.w||a.push({x:f.x+h.w,y:f.y,w:f.w-h.w,h:h.h}),f.y+=h.h,f.h-=h.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}function rl(t,e){var r=e.pixelRatio,n=e.version,i=e.stretchX,o=e.stretchY,a=e.content;this.paddedRect=t,this.pixelRatio=r,this.stretchX=i,this.stretchY=o,this.content=a,this.version=n}var nl=1,il={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};il.tl.get=function(){return[this.paddedRect.x+nl,this.paddedRect.y+nl]},il.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-nl,this.paddedRect.y+this.paddedRect.h-nl]},il.tlbr.get=function(){return this.tl.concat(this.br)},il.displaySize.get=function(){return[(this.paddedRect.w-2*nl)/this.pixelRatio,(this.paddedRect.h-2*nl)/this.pixelRatio]},Object.defineProperties(rl.prototype,il);function ol(t,e){var r={},n={};this.haveRenderCallbacks=[];var i=[];this.addImages(t,r,i),this.addImages(e,n,i);var o=el(i),a=new Ws({width:o.w||1,height:o.h||1});for(var s in t){var u=t[s],c=r[s].paddedRect;Ws.copy(u.data,a,{x:0,y:0},{x:c.x+nl,y:c.y+nl},u.data)}for(var l in e){var h=e[l],p=n[l].paddedRect,f=p.x+nl,d=p.y+nl,m=h.data.width,g=h.data.height;Ws.copy(h.data,a,{x:0,y:0},{x:f,y:d},h.data),Ws.copy(h.data,a,{x:0,y:g-1},{x:f,y:d-1},{width:m,height:1}),Ws.copy(h.data,a,{x:0,y:0},{x:f,y:d+g},{width:m,height:1}),Ws.copy(h.data,a,{x:m-1,y:0},{x:f-1,y:d},{width:1,height:g}),Ws.copy(h.data,a,{x:0,y:0},{x:f+m,y:d},{width:1,height:g})}this.image=a,this.iconPositions=r,this.patternPositions=n}ol.prototype.addImages=function(t,e,r){for(var n in t){var i=t[n],o={x:0,y:0,w:i.data.width+2*nl,h:i.data.height+2*nl};r.push(o),e[n]=new rl(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(n)}},ol.prototype.patchUpdatedImages=function(t,e){for(var r in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[r],t.getImage(r),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r),e)},ol.prototype.patchUpdatedImage=function(t,e,r){if(t&&e&&t.version!==e.version){t.version=e.version;var n=t.tl;r.update(e.data,void 0,{x:n[0],y:n[1]})}},Jn("ImagePosition",rl),Jn("ImageAtlas",ol);function al(){this.scale=1,this.fontStack="",this.imageName=null}var sl={horizontal:1,vertical:2,horizontalOnly:3},ul=-17;al.forText=function(t,e){var r=new al;return r.scale=t||1,r.fontStack=e,r},al.forImage=function(t){var e=new al;return e.imageName=t,e};function cl(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}function ll(t,e,r,n,i,o,a,s,Y,u,c,l,h,p,f,d){var m,g=cl.fromFeature(t,i);l===sl.vertical&&g.verticalizePunctuation();var y=bi.processBidirectionalText,v=bi.processStyledBidirectionalText;if(y&&1===g.sections.length){m=[];for(var _=0,b=y(g.toString(),gl(g,u,o,e,n,p,f));_<b.length;_+=1){var x=b[_],w=new cl;w.text=x,w.sections=g.sections;for(var S=0;S<x.length;S++)w.sectionIndex.push(0);m.push(w)}}else if(v){m=[];for(var E=0,C=v(g.text,g.sectionIndex,gl(g,u,o,e,n,p,f));E<C.length;E+=1){var M=C[E],T=new cl;T.text=M[0],T.sectionIndex=M[1],T.sections=g.sections,m.push(T)}}else m=function(t,e){for(var r=[],n=t.text,i=0,o=0,a=e;o<a.length;o+=1){var s=a[o];r.push(t.substring(i,s)),i=s}return i<n.length&&r.push(t.substring(i,n.length)),r}(g,gl(g,u,o,e,n,p,f));var P=[],O={positionedLines:P,text:g.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:l,iconsInText:!1,verticalizable:!1};return function(t,e,r,n,i,o,a,s,u,c,l,h){for(var p=0,f=ul,d=0,m=0,g="right"===Y?1:"left"===Y?0:.5,y=0,v=0,_=i;v<_.length;v+=1){var b=_[v];b.trim();var x=b.getMaxScale(),w=(x-1)*Ic,S={positionedGlyphs:[],lineOffset:0},E=(t.positionedLines[y]=S).positionedGlyphs,C=0;if(b.length()){for(var M=0;M<b.length();M++){var T=b.getSection(M),P=b.getSectionIndex(M),O=b.getCharCode(M),A=0,I=null,L=null,R=null,N=Ic,k=!(u===sl.horizontal||!l&&!si(O)||l&&(hl[O]||(q=O,oi.Arabic(q)||oi["Arabic Supplement"](q)||oi["Arabic Extended-A"](q)||oi["Arabic Presentation Forms-A"](q)||oi["Arabic Presentation Forms-B"](q))));if(T.imageName){var D=n[T.imageName];if(!D)continue;R=T.imageName,t.iconsInText=t.iconsInText||!0,L=D.paddedRect;var j=D.displaySize;T.scale=T.scale*Ic/h,A=w+(Ic-j[1]*T.scale),N=(I={width:j[0],height:j[1],left:nl,top:-tl,advance:k?j[1]:j[0]}).advance;var z=k?j[0]*T.scale-Ic*x:j[1]*T.scale-Ic*x;0<z&&C<z&&(C=z)}else{var F=r[T.fontStack],B=F&&F[O];if(B&&B.rect)L=B.rect,I=B.metrics;else{var U=e[T.fontStack],V=U&&U[O];if(!V)continue;I=V.metrics}A=(x-T.scale)*Ic}k?(t.verticalizable=!0,E.push({glyph:O,imageName:R,x:p,y:f+A,vertical:k,scale:T.scale,fontStack:T.fontStack,sectionIndex:P,metrics:I,rect:L}),p+=N*T.scale+c):(E.push({glyph:O,imageName:R,x:p,y:f+A,vertical:k,scale:T.scale,fontStack:T.fontStack,sectionIndex:P,metrics:I,rect:L}),p+=I.advance*T.scale+c)}0!==E.length&&(d=Math.max(p-c,d),vl(E,0,E.length-1,g,C)),p=0;var G=o*x+C;S.lineOffset=Math.max(C,w),f+=G,m=Math.max(G,m),++y}else f+=o,++y}var q,H=f-ul,$=yl(a),W=$.horizontalAlign,X=$.verticalAlign;(function(t,e,r,n,i,o,a,s,u){var c,l=(e-r)*i;c=o!==a?-s*n-ul:(-n*u+.5)*a;for(var h=0,p=t;h<p.length;h+=1)for(var f=0,d=p[h].positionedGlyphs;f<d.length;f+=1){var m=d[f];m.x+=l,m.y+=c}})(t.positionedLines,g,W,X,d,m,o,H,i.length),t.top+=-X*H,t.bottom=t.top+H,t.left+=-W*d,t.right=t.left+d}(O,e,r,n,m,a,s,0,l,u,h,d),!function(){for(var t=0,e=P;t<e.length;t+=1)if(0!==e[t].positionedGlyphs.length)return!1;return!0}()&&O}cl.fromFeature=function(t,e){for(var r=new cl,n=0;n<t.sections.length;n++){var i=t.sections[n];i.image?r.addImageSection(i):r.addTextSection(i,e)}return r},cl.prototype.length=function(){return this.text.length},cl.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},cl.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},cl.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},cl.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",r=0;r<t.length;r++){var n=t.charCodeAt(r+1)||null,i=t.charCodeAt(r-1)||null;e+=n&&ui(n)&&!Ac[t[r+1]]||i&&ui(i)&&!Ac[t[r-1]]||!Ac[t[r]]?t[r]:Ac[t[r]]}return e}(this.text)},cl.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&hl[this.text.charCodeAt(e)];e++)t++;for(var r=this.text.length,n=this.text.length-1;0<=n&&t<=n&&hl[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)},cl.prototype.substring=function(t,e){var r=new cl;return r.text=this.text.substring(t,e),r.sectionIndex=this.sectionIndex.slice(t,e),r.sections=this.sections,r},cl.prototype.toString=function(){return this.text},cl.prototype.getMaxScale=function(){var r=this;return this.sectionIndex.reduce(function(t,e){return Math.max(t,r.sections[e].scale)},0)},cl.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(al.forText(t.scale,t.fontStack||e));for(var r=this.sections.length-1,n=0;n<t.text.length;++n)this.sectionIndex.push(r)},cl.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(0!==e.length){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(al.forImage(e)),this.sectionIndex.push(this.sections.length-1)):pt("Reached maximum number of images 6401")}else pt("Can't add FormattedSection with an empty image.")},cl.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?63743<=this.imageSectionID?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var hl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},pl={};function fl(t,e,r,n,i,o){if(e.imageName){var a=n[e.imageName];return a?a.displaySize[0]*e.scale*Ic/o+i:0}var s=r[e.fontStack],u=s&&s[t];return u?u.metrics.advance*e.scale+i:0}function dl(t,e,r,n){var i=Math.pow(t-e,2);return n?t<e?i/2:2*i:i+Math.abs(r)*r}function ml(t,e,r,n,i,o){for(var a=null,s=dl(e,r,i,o),u=0,c=n;u<c.length;u+=1){var l=c[u],h=dl(e-l.x,r,i,o)+l.badness;h<=s&&(a=l,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function gl(t,e,r,n,i,o,a){if("point"!==o)return[];if(!t)return[];for(var s,u=[],c=function(t,e,r,n,i,o){for(var a=0,s=0;s<t.length();s++){var u=t.getSection(s);a+=fl(t.getCharCode(s),u,n,i,e,o)}return a/Math.max(1,Math.ceil(a/r))}(t,e,r,n,i,a),l=0<=t.text.indexOf("​"),h=0,p=0;p<t.length();p++){var f=t.getSection(p),d=t.getCharCode(p);if(hl[d]||(h+=fl(d,f,n,i,e,a)),p<t.length()-1){var m=!((s=d)<11904||!(oi["Bopomofo Extended"](s)||oi.Bopomofo(s)||oi["CJK Compatibility Forms"](s)||oi["CJK Compatibility Ideographs"](s)||oi["CJK Compatibility"](s)||oi["CJK Radicals Supplement"](s)||oi["CJK Strokes"](s)||oi["CJK Symbols and Punctuation"](s)||oi["CJK Unified Ideographs Extension A"](s)||oi["CJK Unified Ideographs"](s)||oi["Enclosed CJK Letters and Months"](s)||oi["Halfwidth and Fullwidth Forms"](s)||oi.Hiragana(s)||oi["Ideographic Description Characters"](s)||oi["Kangxi Radicals"](s)||oi["Katakana Phonetic Extensions"](s)||oi.Katakana(s)||oi["Vertical Forms"](s)||oi["Yi Radicals"](s)||oi["Yi Syllables"](s)));(pl[d]||m||f.imageName)&&u.push(ml(p+1,h,c,u,(g=d,y=t.getCharCode(p+1),v=void 0,v=0,10===g&&(v-=1e4),m&&l&&(v+=150),40!==g&&65288!==g||(v+=50),41!==y&&65289!==y||(v+=50),v),!1))}}var g,y,v;return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(ml(t.length(),h,c,u,0,!0))}function yl(t){var e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function vl(t,e,r,n,i){if(n||i)for(var o=t[r],a=(t[r].x+o.metrics.advance*o.scale)*n,s=e;s<=r;s++)t[s].x-=a,t[s].y+=i}function _l(t,e,r,n,i,o){var a,s=t.image;if(s.content){var u=s.content,c=s.pixelRatio||1;a=[u[0]/c,u[1]/c,s.displaySize[0]-u[2]/c,s.displaySize[1]-u[3]/c]}var l,h,p,f,d=e.left*o,m=e.right*o;h="width"===r||"both"===r?(f=i[0]+d-n[3],i[0]+m+n[1]):(f=i[0]+(d+m-s.displaySize[0])/2)+s.displaySize[0];var g=e.top*o,y=e.bottom*o;return p="height"===r||"both"===r?(l=i[1]+g-n[0],i[1]+y+n[2]):(l=i[1]+(g+y-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:l,right:h,bottom:p,left:f,collisionPadding:a}}pl[10]=!0,pl[32]=!0,pl[38]=!0,pl[40]=!0,pl[41]=!0,pl[43]=!0,pl[45]=!0,pl[47]=!0,pl[173]=!0,pl[183]=!0,pl[8203]=!0,pl[8208]=!0,pl[8211]=!0,pl[8231]=!0;var bl,xl=((bl=ht)&&(wl.__proto__=bl),((wl.prototype=Object.create(bl&&bl.prototype)).constructor=wl).prototype.clone=function(){return new wl(this.x,this.y,this.angle,this.segment)},wl);function wl(t,e,r,n){bl.call(this,t,e),this.angle=r,void 0!==n&&(this.segment=n)}Jn("Anchor",xl);var Sl=128;function El(t,e){var r=e.expression;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new vi(t+1))};if("source"===r.kind)return{kind:"source"};for(var n=r.zoomStops,i=r.interpolationType,o=0;o<n.length&&n[o]<=t;)o++;for(var a=o=Math.max(0,o-1);a<n.length&&n[a]<t+1;)a++;a=Math.min(n.length-1,a);var s=n[o],u=n[a];return"composite"===r.kind?{kind:"composite",minZoom:s,maxZoom:u,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:u,minSize:r.evaluate(new vi(s)),maxSize:r.evaluate(new vi(u)),interpolationType:i}}function Cl(t,e,r){var n=e.uSize,i=r.lowerSize;return"source"===t.kind?i/Sl:"composite"===t.kind?nr(i/Sl,r.upperSize/Sl,e.uSizeT):n}function Ml(t,e){var r=0,n=0;if("constant"===t.kind)n=t.layoutSize;else if("source"!==t.kind){var i=t.interpolationType,o=i?s(br.interpolationFactor(i,e,t.minZoom,t.maxZoom),0,1):0;"camera"===t.kind?n=nr(t.minSize,t.maxSize,o):r=o}return{uSizeT:r,uSize:n}}var Tl=Object.freeze({__proto__:null,getSizeData:El,evaluateSizeForFeature:Cl,evaluateSizeForZoom:Ml,SIZE_PACK_FACTOR:Sl});function Pl(t,e,r,n,i){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;-r/2<s;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var u=[],c=0;s<r/2;){var l=t[a],h=t[a+1];if(!h)return!1;var p=t[a-1].angleTo(l)-l.angleTo(h);for(p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:p}),c+=p;s-u[0].distance>n;)c-=u.shift().angleDelta;if(i<c)return!1;a++,s+=l.dist(h)}return!0}function Ol(t){for(var e=0,r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function Al(t,e,r){return t?.6*e*r:0}function Il(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Ll(t,e,r,n,i,o){for(var a=Al(r,i,o),s=Il(r,n)*o,u=0,c=Ol(t)/2,l=0;l<t.length-1;l++){var h=t[l],p=t[l+1],f=h.dist(p);if(c<u+f){var d=(c-u)/f,m=nr(h.x,p.x,d),g=nr(h.y,p.y,d),y=new xl(m,g,p.angleTo(h),l);return y._round(),!a||Pl(t,y,s,a,e)?y:void 0}u+=f}}var Rl=nl;function Nl(E,C,M,t){function e(t,e){return t+e[1]-e[0]}var r=[],T=E.image,P=T.pixelRatio,n=T.paddedRect.w-2*Rl,i=T.paddedRect.h-2*Rl,O=E.right-E.left,A=E.bottom-E.top,o=T.stretchX||[[0,n]],a=T.stretchY||[[0,i]],I=o.reduce(e,0),L=a.reduce(e,0),s=n-I,u=i-L,R=0,N=I,k=0,D=L,j=0,z=s,F=0,B=u;if(T.content&&t){var c=T.content;R=kl(o,0,c[0]),k=kl(a,0,c[1]),N=kl(o,c[0],c[2]),D=kl(a,c[1],c[3]),j=c[0]-R,F=c[1]-k,z=c[2]-c[0]-N,B=c[3]-c[1]-D}function l(t,e,r,n){var i=jl(t.stretch-R,N,O,E.left),o=zl(t.fixed-j,z,t.stretch,I),a=jl(e.stretch-k,D,A,E.top),s=zl(e.fixed-F,B,e.stretch,L),u=jl(r.stretch-R,N,O,E.left),c=zl(r.fixed-j,z,r.stretch,I),l=jl(n.stretch-k,D,A,E.top),h=zl(n.fixed-F,B,n.stretch,L),p=new ht(i,a),f=new ht(u,a),d=new ht(u,l),m=new ht(i,l),g=new ht(o/P,s/P),y=new ht(c/P,h/P),v=C*Math.PI/180;if(v){var _=Math.sin(v),b=Math.cos(v),x=[b,-_,_,b];p._matMult(x),f._matMult(x),m._matMult(x),d._matMult(x)}var w=t.stretch+t.fixed,S=e.stretch+e.fixed;return{tl:p,tr:f,bl:m,br:d,tex:{x:T.paddedRect.x+Rl+w,y:T.paddedRect.y+Rl+S,w:r.stretch+r.fixed-w,h:n.stretch+n.fixed-S},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:g,pixelOffsetBR:y,minFontScaleX:z/P/O,minFontScaleY:B/P/A,isSDF:M}}if(t&&(T.stretchX||T.stretchY))for(var h=Dl(o,s,I),p=Dl(a,u,L),f=0;f<h.length-1;f++)for(var d=h[f],m=h[f+1],g=0;g<p.length-1;g++)r.push(l(d,p[g],m,p[g+1]));else r.push(l({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:1+n},{fixed:0,stretch:1+i}));return r}function kl(t,e,r){for(var n=0,i=0,o=t;i<o.length;i+=1){var a=o[i];n+=Math.max(e,Math.min(r,a[1]))-Math.max(e,Math.min(r,a[0]))}return n}function Dl(t,e,r){for(var n=[{fixed:-Rl,stretch:0}],i=0,o=t;i<o.length;i+=1){var a=o[i],s=a[0],u=a[1],c=n[n.length-1];n.push({fixed:s-c.stretch,stretch:c.stretch}),n.push({fixed:s-c.stretch,stretch:c.stretch+(u-s)})}return n.push({fixed:e+Rl,stretch:r}),n}function jl(t,e,r,n){return t/e*r+n}function zl(t,e,r,n){return t-e*r/n}function Fl(t,e,r,n,i,o,a,s,u,c,l,h){var p=a.top*s-u,f=a.bottom*s+u,d=a.left*s-u,m=a.right*s+u,g=a.collisionPadding;if(g&&(d-=g[0]*s,p-=g[1]*s,m+=g[2]*s,f+=g[3]*s),this.boxStartIndex=t.length,c){var y=f-p,v=m-d;0<y&&(y=Math.max(10*s,y),this._addLineCollisionCircles(t,e,r,r.segment,v,y,n,i,o,l))}else{if(h){var _=new ht(d,p),b=new ht(m,p),x=new ht(d,f),w=new ht(m,f),S=h*Math.PI/180;_._rotate(S),b._rotate(S),x._rotate(S),w._rotate(S),d=Math.min(_.x,b.x,x.x,w.x),m=Math.max(_.x,b.x,x.x,w.x),p=Math.min(_.y,b.y,x.y,w.y),f=Math.max(_.y,b.y,x.y,w.y)}t.emplaceBack(r.x,r.y,d,p,m,f,n,i,o,0,0)}this.boxEndIndex=t.length}Fl.prototype._addLineCollisionCircles=function(t,e,r,n,i,o,a,s,u,c){var l=o/2,h=Math.floor(i/l)||1,p=1+.4*Math.log(c)/Math.LN2,f=Math.floor(h*p/2),d=-o/2,m=r,g=n+1,y=d,v=-i/2,_=v-i/4;do{if(--g<0){if(v<y)return;g=0;break}y-=e[g].dist(m),m=e[g]}while(_<y);for(var b=e[g].dist(e[g+1]),x=-f;x<h+f;x++){var w=x*l,S=v+w;if(w<0&&(S+=w),i<w&&(S+=w-i),!(S<y)){for(;y+b<S;){if(y+=b,++g+1>=e.length)return;b=e[g].dist(e[g+1])}var E=S-y,C=e[g],M=e[g+1].sub(C)._unit()._mult(E)._add(C)._round(),T=Math.abs(S-d)<l?0:.8*(S-d);t.emplaceBack(M.x,M.y,-o/2,-o/2,o/2,o/2,a,s,u,o/2,T)}}};var Bl=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=Ul),this.data=t,this.length=this.data.length,this.compare=e,0<this.length)for(var r=(this.length>>1)-1;0<=r;r--)this._down(r)};function Ul(t,e){return t<e?-1:e<t?1:0}function Vl(t,e,r){void 0===e&&(e=1),void 0===r&&(r=!1);for(var n=1/0,i=1/0,o=-1/0,a=-1/0,s=t[0],u=0;u<s.length;u++){var c=s[u];(!u||c.x<n)&&(n=c.x),(!u||c.y<i)&&(i=c.y),(!u||c.x>o)&&(o=c.x),(!u||c.y>a)&&(a=c.y)}var l=Math.min(o-n,a-i),h=l/2,p=new Bl([],Gl);if(0===l)return new ht(n,i);for(var f=n;f<o;f+=l)for(var d=i;d<a;d+=l)p.push(new ql(f+h,d+h,h,t));for(var m=function(t){for(var e=0,r=0,n=0,i=t[0],o=0,a=i.length,s=a-1;o<a;s=o++){var u=i[o],c=i[s],l=u.x*c.y-c.x*u.y;r+=(u.x+c.x)*l,n+=(u.y+c.y)*l,e+=3*l}return new ql(r/e,n/e,0,t)}(t),g=p.length;p.length;){var y=p.pop();(y.d>m.d||!m.d)&&(m=y,r&&console.log("found best %d after %d probes",Math.round(1e4*y.d)/1e4,g)),y.max-m.d<=e||(p.push(new ql(y.p.x-(h=y.h/2),y.p.y-h,h,t)),p.push(new ql(y.p.x+h,y.p.y-h,h,t)),p.push(new ql(y.p.x-h,y.p.y+h,h,t)),p.push(new ql(y.p.x+h,y.p.y+h,h,t)),g+=4)}return r&&(console.log("num probes: "+g),console.log("best distance: "+m.d)),m.p}function Gl(t,e){return e.max-t.max}function ql(t,e,r,n){this.p=new ht(t,e),this.h=r,this.d=function(t,e){for(var r=!1,n=1/0,i=0;i<e.length;i++)for(var o=e[i],a=0,s=o.length,u=s-1;a<s;u=a++){var c=o[a],l=o[u];c.y>t.y!=l.y>t.y&&t.x<(l.x-c.x)*(t.y-c.y)/(l.y-c.y)+c.x&&(r=!r),n=Math.min(n,ws(t,c,l))}return(r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}Bl.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},Bl.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,0<this.length&&(this.data[0]=e,this._down(0)),t}},Bl.prototype.peek=function(){return this.data[0]},Bl.prototype._up=function(t){for(var e=this.data,r=this.compare,n=e[t];0<t;){var i=t-1>>1,o=e[i];if(0<=r(n,o))break;e[t]=o,t=i}e[t]=n},Bl.prototype._down=function(t){for(var e=this.data,r=this.compare,n=this.length>>1,i=e[t];t<n;){var o=1+(t<<1),a=e[o],s=o+1;if(s<this.length&&r(e[s],a)<0&&(a=e[o=s]),0<=r(a,i))break;e[t]=a,t=o}e[t]=i};var Hl=Number.POSITIVE_INFINITY;function $l(t,e){return e[1]!==Hl?function(t,e,r){var n=0,i=0;switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":i=r-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-r}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}return[n,i]}(t,e[0],e[1]):function(t,e){var r=0,n=0;e<0&&(e=0);var i=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":n=i-7;break;case"bottom-right":case"bottom-left":n=7-i;break;case"bottom":n=7-e;break;case"top":n=e-7}switch(t){case"top-right":case"bottom-right":r=-i;break;case"top-left":case"bottom-left":r=i;break;case"left":r=e;break;case"right":r=-e}return[r,n]}(t,e[0])}function Wl(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}var Xl=255,Yl=Xl*Sl;function Zl(t,e,r,n,i,o,a,s,u,c,l,h,p,f,d){var m=function(t,e,r,n,i,o,a,s){for(var u=n.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,c=[],l=0,h=e.positionedLines;l<h.length;l+=1)for(var p=h[l],f=0,d=p.positionedGlyphs;f<d.length;f+=1){var m=d[f];if(m.rect){var g=m.rect||{},y=tl+1,v=!0,_=1,b=0,x=(i||s)&&m.vertical,w=m.metrics.advance*m.scale/2;if(s&&e.verticalizable&&(b=p.lineOffset/2-(m.imageName?-(Ic-m.metrics.width*m.scale)/2:(m.scale-1)*Ic)),m.imageName){var S=a[m.imageName];v=S.sdf,y=nl/(_=S.pixelRatio)}var E=i?[m.x+w,m.y]:[0,0],C=i?[0,0]:[m.x+w+r[0],m.y+r[1]-b],M=[0,0];x&&(M=C,C=[0,0]);var T=(m.metrics.left-y)*m.scale-w+C[0],P=(-m.metrics.top-y)*m.scale+C[1],O=T+g.w*m.scale/_,A=P+g.h*m.scale/_,I=new ht(T,P),L=new ht(O,P),R=new ht(T,A),N=new ht(O,A);if(x){var k=new ht(-w,w-ul),D=-Math.PI/2,j=Ic/2-w,z=new ht(5-ul-j,-(m.imageName?j:0)),F=new(Function.prototype.bind.apply(ht,[null].concat(M)));I._rotateAround(D,k)._add(z)._add(F),L._rotateAround(D,k)._add(z)._add(F),R._rotateAround(D,k)._add(z)._add(F),N._rotateAround(D,k)._add(z)._add(F)}if(u){var B=Math.sin(u),U=Math.cos(u),V=[U,-B,B,U];I._matMult(V),L._matMult(V),R._matMult(V),N._matMult(V)}var G=new ht(0,0),q=new ht(0,0);c.push({tl:I,tr:L,bl:R,br:N,tex:g,writingMode:e.writingMode,glyphOffset:E,sectionIndex:m.sectionIndex,isSDF:v,pixelOffsetTL:G,pixelOffsetBR:q,minFontScaleX:0,minFontScaleY:0})}}return c}(0,r,s,i,o,a,n,t.allowVerticalPlacement),g=t.textSizeData,y=null;"source"===g.kind?(y=[Sl*i.layout.get("text-size").evaluate(a,{})])[0]>Yl&&pt(t.layerIds[0]+': Value for "text-size" is >= '+Xl+'. Reduce your "text-size".'):"composite"===g.kind&&((y=[Sl*f.compositeTextSizes[0].evaluate(a,{},d),Sl*f.compositeTextSizes[1].evaluate(a,{},d)])[0]>Yl||y[1]>Yl)&&pt(t.layerIds[0]+': Value for "text-size" is >= '+Xl+'. Reduce your "text-size".'),t.addSymbols(t.text,m,y,s,o,a,c,e,u.lineStartIndex,u.lineLength,p,d);for(var v=0,_=l;v<_.length;v+=1)h[_[v]]=t.text.placedSymbolArray.length-1;return 4*m.length}function Kl(t){for(var e in t)return t[e];return null}function Jl(t,e,r,n){var i=t.compareText;if(e in i){for(var o=i[e],a=o.length-1;0<=a;a--)if(n.dist(o[a])<r)return!0}else i[e]=[];return i[e].push(n),!1}var Ql=Ku.VectorTileFeature.types,th=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function eh(t,e,r,n,i,o,a,s,u,c,l,h,p){var f=s?Math.min(Yl,Math.round(s[0])):0,d=s?Math.min(Yl,Math.round(s[1])):0;t.emplaceBack(e,r,Math.round(32*n),Math.round(32*i),o,a,(f<<1)+(u?1:0),d,16*c,16*l,256*h,256*p)}function rh(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}function nh(t){for(var e=0,r=t.sections;e<r.length;e+=1)if(li(r[e].text))return!0;return!1}function ih(t){this.layoutVertexArray=new so,this.indexArray=new Uo,this.programConfigurations=t,this.segments=new Sa,this.dynamicLayoutVertexArray=new lo,this.opacityVertexArray=new fo,this.placedSymbolArray=new sa}ih.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},ih.prototype.upload=function(t,e,r,n){this.isEmpty()||(r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,wc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Sc.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,th,!0),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(t))},ih.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Jn("SymbolBuffers",ih);function oh(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new Sa,this.collisionVertexArray=new So}oh.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ec.members,!0)},oh.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Jn("CollisionBuffers",oh);function ah(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[];var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=El(this.zoom,e["text-size"]),this.iconSizeData=El(this.zoom,e["icon-size"]);var r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&(r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement")),"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map(function(t){return sl[t]})),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id}),this.sourceID=t.sourceID}ah.prototype.createArrays=function(){this.text=new ih(new hs(wc.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new ih(new hs(wc.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new da,this.lineVertexArray=new ya,this.symbolInstances=new ha},ah.prototype.calculateGlyphDependencies=function(t,e,r,n,i){for(var o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(r||n)&&i){var a=Ac[t.charAt(o)];a&&(e[a.charCodeAt(0)]=!0)}},ah.prototype.populate=function(t,e,r){var n=this.layers[0],i=n.layout,o=i.get("text-font"),a=i.get("text-field"),s=i.get("icon-image"),u=("constant"!==a.value.kind||a.value.value instanceof ce&&!a.value.value.isEmpty()||0<a.value.value.toString().length)&&("constant"!==o.value.kind||0<o.value.value.length),c="constant"!==s.value.kind||!!s.value.value||0<Object.keys(s.parameters).length,l=i.get("symbol-sort-key");if(this.features=[],u||c){for(var h=e.iconDependencies,p=e.glyphDependencies,f=e.availableImages,d=new vi(this.zoom),m=0,g=t;m<g.length;m+=1){var y=g[m],v=y.feature,_=y.id,b=y.index,x=y.sourceLayerIndex,w=n._featureFilter.needGeometry,S={type:v.type,id:_,properties:v.properties,geometry:w?ds(v):[]};if(n._featureFilter.filter(d,S,r)){w||(S.geometry=ds(v));var E=void 0;if(u){var C=n.getValueAndResolveTokens("text-field",S,r,f),M=ce.factory(C);nh(M)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===gi()||this.hasRTLText&&bi.isParsed())&&(E=Tc(M,n,S))}var T=void 0;if(c){var P=n.getValueAndResolveTokens("icon-image",S,r,f);T=P instanceof le?P:le.fromString(P)}if(E||T){var O=this.sortFeaturesByKey?l.evaluate(S,{},r):void 0,A={id:_,text:E,icon:T,index:b,sourceLayerIndex:x,geometry:ds(v),properties:v.properties,type:Ql[v.type],sortKey:O};if(this.features.push(A),T&&(h[T.name]=!0),E){var I=o.evaluate(S,{},r).join(","),L="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&0<=this.writingModes.indexOf(sl.vertical);for(var R=0,N=E.sections;R<N.length;R+=1){var k=N[R];if(k.image)h[k.image.name]=!0;else{var D=ai(E.toString()),j=k.fontStack||I,z=p[j]=p[j]||{};this.calculateGlyphDependencies(k.text,z,L,this.allowVerticalPlacement,D)}}}}}}"line"===i.get("symbol-placement")&&(this.features=function(e){var i={},o={},a=[],r=0;function t(t){a.push(e[t]),r++}function n(t,e,r){var n=o[t];return delete o[t],o[e]=n,a[n].geometry[0].pop(),a[n].geometry[0]=a[n].geometry[0].concat(r[0]),n}function s(t,e,r){var n=i[e];return delete i[e],i[t]=n,a[n].geometry[0].shift(),a[n].geometry[0]=r[0].concat(a[n].geometry[0]),n}function u(t,e,r){var n=r?e[0][e[0].length-1]:e[0][0];return t+":"+n.x+":"+n.y}for(var c=0;c<e.length;c++){var l=e[c],h=l.geometry,p=l.text?l.text.toString():null;if(p){var f=u(p,h),d=u(p,h,!0);if(f in o&&d in i&&o[f]!==i[d]){var m=s(f,d,h),g=n(f,d,a[m].geometry);delete i[f],delete o[d],o[u(p,a[g].geometry,!0)]=g,a[m].geometry=null}else f in o?n(f,d,h):d in i?s(f,d,h):(t(c),i[f]=r-1,o[d]=r-1)}else t(c)}return a.filter(function(t){return t.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(t,e){return t.sortKey-e.sortKey})}},ah.prototype.update=function(t,e,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,r),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,r))},ah.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},ah.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},ah.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t),this.textCollisionCircle.upload(t),this.iconCollisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},ah.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy(),this.textCollisionCircle.destroy(),this.iconCollisionCircle.destroy()},ah.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},ah.prototype.addToLineVertexArray=function(t,e){var r=this.lineVertexArray.length;if(void 0!==t.segment){for(var n=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:n},a<e.length-1&&(n+=e[a+1].dist(e[a]));for(var s=t.segment||0;0<=s;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},0<s&&(i+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var c=o[u];this.lineVertexArray.emplaceBack(c.x,c.y,c.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},ah.prototype.addSymbols=function(t,e,r,n,i,o,a,s,u,c,l,h){for(var p=t.indexArray,f=t.layoutVertexArray,d=t.segments.prepareSegment(4*e.length,f,p,o.sortKey),m=this.glyphOffsetArray.length,g=d.vertexLength,y=this.allowVerticalPlacement&&a===sl.vertical?Math.PI/2:0,v=o.text&&o.text.sections,_=0;_<e.length;_++){var b=e[_],x=b.tl,w=b.tr,S=b.bl,E=b.br,C=b.tex,M=b.pixelOffsetTL,T=b.pixelOffsetBR,P=b.minFontScaleX,O=b.minFontScaleY,A=b.glyphOffset,I=b.isSDF,L=b.sectionIndex,R=d.vertexLength,N=A[1];eh(f,s.x,s.y,x.x,N+x.y,C.x,C.y,r,I,M.x,M.y,P,O),eh(f,s.x,s.y,w.x,N+w.y,C.x+C.w,C.y,r,I,T.x,M.y,P,O),eh(f,s.x,s.y,S.x,N+S.y,C.x,C.y+C.h,r,I,M.x,T.y,P,O),eh(f,s.x,s.y,E.x,N+E.y,C.x+C.w,C.y+C.h,r,I,T.x,T.y,P,O),rh(t.dynamicLayoutVertexArray,s,y),p.emplaceBack(R,R+1,R+2),p.emplaceBack(R+1,R+2,R+3),d.vertexLength+=4,d.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(A[0]),_!==e.length-1&&L===e[_+1].sectionIndex||t.programConfigurations.populatePaintArrays(f.length,o,o.index,{},h,v&&v[L])}t.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,g,u,c,s.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],a,0,!1,0,l)},ah.prototype._addCollisionDebugVertex=function(t,e,r,n,i,o){return e.emplaceBack(0,0),t.emplaceBack(r.x,r.y,n,i,Math.round(o.x),Math.round(o.y))},ah.prototype.addCollisionDebugVertices=function(t,e,r,n,i,o,a,s){var u=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),c=u.vertexLength,l=i.layoutVertexArray,h=i.collisionVertexArray,p=a.anchorX,f=a.anchorY;if(this._addCollisionDebugVertex(l,h,o,p,f,new ht(t,e)),this._addCollisionDebugVertex(l,h,o,p,f,new ht(r,e)),this._addCollisionDebugVertex(l,h,o,p,f,new ht(r,n)),this._addCollisionDebugVertex(l,h,o,p,f,new ht(t,n)),u.vertexLength+=4,s){var d=i.indexArray;d.emplaceBack(c,c+1,c+2),d.emplaceBack(c,c+2,c+3),u.primitiveLength+=2}else{var m=i.indexArray;m.emplaceBack(c,c+1),m.emplaceBack(c+1,c+2),m.emplaceBack(c+2,c+3),m.emplaceBack(c+3,c),u.primitiveLength+=4}},ah.prototype.addDebugCollisionBoxes=function(t,e,r,n){for(var i=t;i<e;i++){var o=this.collisionBoxArray.get(i),a=0<o.radius;this.addCollisionDebugVertices(o.x1,o.y1,o.x2,o.y2,a?n?this.textCollisionCircle:this.iconCollisionCircle:n?this.textCollisionBox:this.iconCollisionBox,o.anchorPoint,r,a)}},ah.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new oh(bo,Cc.members,qo),this.iconCollisionBox=new oh(bo,Cc.members,qo),this.textCollisionCircle=new oh(bo,Mc.members,Uo),this.iconCollisionCircle=new oh(bo,Mc.members,Uo);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},ah.prototype._deserializeCollisionBoxesForSymbol=function(t,e,r,n,i,o,a,s,u){for(var c={},l=e;l<r;l++){var h=t.get(l);if(0===h.radius){c.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},c.textFeatureIndex=h.featureIndex;break}c.textCircles||(c.textCircles=[],c.textFeatureIndex=h.featureIndex),c.textCircles.push(h.anchorPointX,h.anchorPointY,h.radius,h.signedDistanceFromAnchor,1)}for(var p=n;p<i;p++){var f=t.get(p);if(0===f.radius){c.verticalTextBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},c.verticalTextFeatureIndex=f.featureIndex;break}}for(var d=o;d<a;d++){var m=t.get(d);if(0===m.radius){c.iconBox={x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,anchorPointX:m.anchorPointX,anchorPointY:m.anchorPointY},c.iconFeatureIndex=m.featureIndex;break}}for(var g=s;g<u;g++){var y=t.get(g);if(0===y.radius){c.verticalIconBox={x1:y.x1,y1:y.y1,x2:y.x2,y2:y.y2,anchorPointX:y.anchorPointX,anchorPointY:y.anchorPointY},c.verticalIconFeatureIndex=y.featureIndex;break}}return c},ah.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},ah.prototype.hasTextData=function(){return 0<this.text.segments.get().length},ah.prototype.hasIconData=function(){return 0<this.icon.segments.get().length},ah.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox&&this.textCollisionCircle&&this.iconCollisionCircle},ah.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&0<this.textCollisionBox.segments.get().length},ah.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&0<this.iconCollisionBox.segments.get().length},ah.prototype.hasTextCollisionCircleData=function(){return this.hasDebugData()&&0<this.textCollisionCircle.segments.get().length},ah.prototype.hasIconCollisionCircleData=function(){return this.hasDebugData()&&0<this.iconCollisionCircle.segments.get().length},ah.prototype.addIndicesForPlacedSymbol=function(t,e){for(var r=t.placedSymbolArray.get(e),n=r.vertexStartIndex+4*r.numGlyphs,i=r.vertexStartIndex;i<n;i+=4)t.indexArray.emplaceBack(i,i+1,i+2),t.indexArray.emplaceBack(i+1,i+2,i+3)},ah.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),r=Math.cos(t),n=[],i=[],o=[],a=0;a<this.symbolInstances.length;++a){o.push(a);var s=this.symbolInstances.get(a);n.push(0|Math.round(e*s.anchorX+r*s.anchorY)),i.push(s.featureIndex)}return o.sort(function(t,e){return n[t]-n[e]||i[e]-i[t]}),o},ah.prototype.addToSortKeyRanges=function(t,e){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===e?r.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})},ah.prototype.sortFeatures=function(t){var n=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(1<this.text.segments.get().length||1<this.icon.segments.get().length)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var e=0,r=this.symbolInstanceIndexes;e<r.length;e+=1){var i=this.symbolInstances.get(r[e]);this.featureSortOrder.push(i.featureIndex),[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach(function(t,e,r){0<=t&&r.indexOf(t)===e&&n.addIndicesForPlacedSymbol(n.text,t)}),0<=i.verticalPlacedTextSymbolIndex&&this.addIndicesForPlacedSymbol(this.text,i.verticalPlacedTextSymbolIndex),0<=i.placedIconSymbolIndex&&this.addIndicesForPlacedSymbol(this.icon,i.placedIconSymbolIndex),0<=i.verticalPlacedIconSymbolIndex&&this.addIndicesForPlacedSymbol(this.icon,i.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Jn("SymbolBucket",ah,{omit:["layers","collisionBoxArray","features","compareText"]}),ah.MAX_GLYPHS=65535,ah.addDynamicAttributes=rh;function sh(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ht,this.defaultValue=t}var uh=new Di({"symbol-placement":new Oi(kt.layout_symbol["symbol-placement"]),"symbol-spacing":new Oi(kt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Oi(kt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ai(kt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Oi(kt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Oi(kt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Oi(kt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Oi(kt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Oi(kt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ai(kt.layout_symbol["icon-size"]),"icon-text-fit":new Oi(kt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Oi(kt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ai(kt.layout_symbol["icon-image"]),"icon-rotate":new Ai(kt.layout_symbol["icon-rotate"]),"icon-padding":new Oi(kt.layout_symbol["icon-padding"]),"icon-keep-upright":new Oi(kt.layout_symbol["icon-keep-upright"]),"icon-offset":new Ai(kt.layout_symbol["icon-offset"]),"icon-anchor":new Ai(kt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Oi(kt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Oi(kt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Oi(kt.layout_symbol["text-rotation-alignment"]),"text-field":new Ai(kt.layout_symbol["text-field"]),"text-font":new Ai(kt.layout_symbol["text-font"]),"text-size":new Ai(kt.layout_symbol["text-size"]),"text-max-width":new Ai(kt.layout_symbol["text-max-width"]),"text-line-height":new Oi(kt.layout_symbol["text-line-height"]),"text-letter-spacing":new Ai(kt.layout_symbol["text-letter-spacing"]),"text-justify":new Ai(kt.layout_symbol["text-justify"]),"text-radial-offset":new Ai(kt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Oi(kt.layout_symbol["text-variable-anchor"]),"text-anchor":new Ai(kt.layout_symbol["text-anchor"]),"text-max-angle":new Oi(kt.layout_symbol["text-max-angle"]),"text-writing-mode":new Oi(kt.layout_symbol["text-writing-mode"]),"text-rotate":new Ai(kt.layout_symbol["text-rotate"]),"text-padding":new Oi(kt.layout_symbol["text-padding"]),"text-keep-upright":new Oi(kt.layout_symbol["text-keep-upright"]),"text-transform":new Ai(kt.layout_symbol["text-transform"]),"text-offset":new Ai(kt.layout_symbol["text-offset"]),"text-allow-overlap":new Oi(kt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Oi(kt.layout_symbol["text-ignore-placement"]),"text-optional":new Oi(kt.layout_symbol["text-optional"])}),ch={paint:new Di({"icon-opacity":new Ai(kt.paint_symbol["icon-opacity"]),"icon-color":new Ai(kt.paint_symbol["icon-color"]),"icon-halo-color":new Ai(kt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ai(kt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ai(kt.paint_symbol["icon-halo-blur"]),"icon-translate":new Oi(kt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Oi(kt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ai(kt.paint_symbol["text-opacity"]),"text-color":new Ai(kt.paint_symbol["text-color"],{runtimeType:Yt,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Ai(kt.paint_symbol["text-halo-color"]),"text-halo-width":new Ai(kt.paint_symbol["text-halo-width"]),"text-halo-blur":new Ai(kt.paint_symbol["text-halo-blur"]),"text-translate":new Oi(kt.paint_symbol["text-translate"]),"text-translate-anchor":new Oi(kt.paint_symbol["text-translate-anchor"])}),layout:uh};sh.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},sh.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},sh.prototype.outputDefined=function(){return!1},sh.prototype.serialize=function(){return null},Jn("FormatSectionOverride",sh,{omit:["defaultValue"]});function lh(t,e,r,n){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(e,n)}var hh,ph,fh,dh,mh=((dh=Bi)&&(Ah.__proto__=dh),((Ah.prototype=Object.create(dh&&dh.prototype)).constructor=Ah).prototype.recalculate=function(t,e){if(dh.prototype.recalculate.call(this,t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var r=this.layout.get("text-writing-mode");if(r){for(var n=[],i=0,o=r;i<o.length;i+=1){var a=o[i];n.indexOf(a)<0&&n.push(a)}this.layout._values["text-writing-mode"]=n}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},Ah.prototype.getValueAndResolveTokens=function(t,e,r,n){var i,o=this.layout.get(t).evaluate(e,{},r,n),a=this._unevaluatedLayout._values[t];return a.isDataDriven()||on(a.value)||!o?o:(i=e.properties,o.replace(/{([^{}]+)}/g,function(t,e){return e in i?String(i[e]):""}))},Ah.prototype.createBucket=function(t){return new ah(t)},Ah.prototype.queryRadius=function(){return 0},Ah.prototype.queryIntersectsFeature=function(){return!1},Ah.prototype._setPaintOverrides=function(){for(var t=0,e=ch.paint.overridableProperties;t<e.length;t+=1){var r=e[t];if(Ah.hasPaintOverride(this.layout,r)){var n,i=this.paint.get(r),o=new sh(i),a=new nn(o,i.property.specification);n="constant"===i.value.kind||"source"===i.value.kind?new sn("source",a):new un("composite",a,i.value.zoomStops,i.value._interpolationType),this.paint._values[r]=new Ti(i.property,n,i.parameters)}}},Ah.prototype._handleOverridablePaintPropertyUpdate=function(t,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven())&&Ah.hasPaintOverride(this.layout,t)},Ah.hasPaintOverride=function(t,e){function r(t){for(var e=0,r=t;e<r.length;e+=1)if(i.overrides&&i.overrides.hasOverride(r[e]))return void(o=!0)}var n=t.get("text-field"),i=ch.paint.properties[e],o=!1;if("constant"===n.value.kind&&n.value.value instanceof ce)r(n.value.value.sections);else if("source"===n.value.kind){var a=function(t){o||(t instanceof me&&fe(t.value)===Qt?r(t.value.sections):t instanceof _e?r(t.sections):t.eachChild(a))},s=n.value;s._styleExpression&&a(s._styleExpression.expression)}return o},Ah),gh={paint:new Di({"background-color":new Oi(kt.paint_background["background-color"]),"background-pattern":new Ii(kt.paint_background["background-pattern"]),"background-opacity":new Oi(kt.paint_background["background-opacity"])})},yh=((fh=Bi)&&(Oh.__proto__=fh),(Oh.prototype=Object.create(fh&&fh.prototype)).constructor=Oh),vh={paint:new Di({"raster-opacity":new Oi(kt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Oi(kt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Oi(kt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Oi(kt.paint_raster["raster-brightness-max"]),"raster-saturation":new Oi(kt.paint_raster["raster-saturation"]),"raster-contrast":new Oi(kt.paint_raster["raster-contrast"]),"raster-resampling":new Oi(kt.paint_raster["raster-resampling"]),"raster-fade-duration":new Oi(kt.paint_raster["raster-fade-duration"])})},_h=((ph=Bi)&&(Ph.__proto__=ph),(Ph.prototype=Object.create(ph&&ph.prototype)).constructor=Ph),bh=((hh=Bi)&&(Th.__proto__=hh),((Th.prototype=Object.create(hh&&hh.prototype)).constructor=Th).prototype.is3D=function(){return"3d"===this.implementation.renderingMode},Th.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},Th.prototype.recalculate=function(){},Th.prototype.updateTransitions=function(){},Th.prototype.hasTransition=function(){},Th.prototype.serialize=function(){},Th.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},Th.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},Th),xh={circle:js,heatmap:Js,hillshade:tu,fill:Bu,"fill-extrusion":ic,line:_c,symbol:mh,background:yh,raster:_h},wh=self.HTMLImageElement,Sh=self.HTMLCanvasElement,Eh=self.HTMLVideoElement,Ch=self.ImageData,Mh=self.ImageBitmap;function Th(t){hh.call(this,t,{}),this.implementation=t}function Ph(t){ph.call(this,t,vh)}function Oh(t){fh.call(this,t,gh)}function Ah(t){dh.call(this,t,ch)}lh.prototype.update=function(t,e,r){var n=t.width,i=t.height,o=!(this.size&&this.size[0]===n&&this.size[1]===i||r),a=this.context,s=a.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[n,i],t instanceof wh||t instanceof Sh||t instanceof Eh||t instanceof Ch||Mh&&t instanceof Mh?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,n,i,0,this.format,s.UNSIGNED_BYTE,t.data);else{var u=r||{x:0,y:0},c=u.x,l=u.y;t instanceof wh||t instanceof Sh||t instanceof Eh||t instanceof Ch||Mh&&t instanceof Mh?s.texSubImage2D(s.TEXTURE_2D,0,c,l,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,c,l,n,i,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},lh.prototype.bind=function(t,e,r){var n=this.context.gl;n.bindTexture(n.TEXTURE_2D,this.texture),r!==n.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=n.LINEAR),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,r||t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e)},lh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},lh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};function Ih(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})}Ih.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Ih.prototype.remove=function(){delete this._channel,this._callback=function(){}};function Lh(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},d(["receive","process"],this),this.invoker=new Ih(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=w()?t:self}function Rh(t,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}Lh.prototype.send=function(t,e,r,n,i){var o=this;void 0===i&&(i=!1);var a=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[a]=r);var s=C(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:t,hasCallback:!!r,targetMapId:n,mustQueue:i,sourceMapId:this.mapId,data:ri(e,s)},s),{cancel:function(){r&&delete o.callbacks[a],o.target.postMessage({id:a,type:"<cancel>",targetMapId:n,sourceMapId:o.mapId})}}},Lh.prototype.receive=function(t){var e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[r];var n=this.cancelCallbacks[r];delete this.cancelCallbacks[r],n&&n()}else w()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)},Lh.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},Lh.prototype.processTask=function(r,t){var n=this;if("<response>"===t.type){var e=this.callbacks[r];delete this.callbacks[r],e&&(t.error?e(ni(t.error)):e(null,ni(t.data)))}else{var i=!1,o=C(this.globalScope)?void 0:[],a=t.hasCallback?function(t,e){i=!0,delete n.cancelCallbacks[r],n.target.postMessage({id:r,type:"<response>",sourceMapId:n.mapId,error:t?ri(t):null,data:ri(e,o)},o)}:function(t){i=!0},s=null,u=ni(t.data);if(this.parent[t.type])s=this.parent[t.type](t.sourceMapId,u,a);else if(this.parent.getWorkerSource){var c=t.type.split(".");s=this.parent.getWorkerSource(t.sourceMapId,c[0],u.source)[c[1]](u,a)}else a(new Error("Could not find function "+t.type));!i&&s&&s.cancel&&(this.cancelCallbacks[r]=s.cancel)}},Lh.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};function Nh(t,e,r){this.z=t,this.x=e,this.y=r,this.key=jh(0,t,t,e,r)}Nh.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Nh.prototype.url=function(t,e){var r,n,i,o,a,s=(n=this.y,i=this.z,o=Rh(256*(r=this.x),256*(n=Math.pow(2,i)-n-1),i),a=Rh(256*(r+1),256*(n+1),i),o[0]+","+o[1]+","+a[0]+","+a[1]),u=function(t,e,r){for(var n,i="",o=t;0<o;o--)i+=(e&(n=1<<o-1)?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)},Nh.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new ht((t.x*e-this.x)*De,(t.y*e-this.y)*De)},Nh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};function kh(t,e){this.wrap=t,this.canonical=e,this.key=jh(t,e.z,e.z,e.x,e.y)}function Dh(t,e,r,n,i){this.overscaledZ=t,this.wrap=e,this.canonical=new Nh(r,+n,+i),this.key=jh(e,t,r,n,i)}function jh(t,e,r,n,i){(t*=2)<0&&(t=-1*t-1);var o=1<<r;return(o*o*t+o*i+n).toString(36)+r.toString(36)+e.toString(36)}Dh.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Dh.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Dh(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Dh(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Dh.prototype.calculateScaledKey=function(t,e){var r=this.canonical.z-t;return t>this.canonical.z?jh(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):jh(this.wrap*+e,t,t,this.canonical.x>>r,this.canonical.y>>r)},Dh.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Dh.prototype.children=function(t){if(this.overscaledZ>=t)return[new Dh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new Dh(e,this.wrap,e,r,n),new Dh(e,this.wrap,e,1+r,n),new Dh(e,this.wrap,e,r,1+n),new Dh(e,this.wrap,e,1+r,1+n)]},Dh.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Dh.prototype.wrapped=function(){return new Dh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Dh.prototype.unwrapTo=function(t){return new Dh(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Dh.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Dh.prototype.toUnwrapped=function(){return new kh(this.wrap,this.canonical)},Dh.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Dh.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new ke(t.x-this.wrap,t.y))},Jn("CanonicalTileID",Nh),Jn("OverscaledTileID",Dh,{omit:["posMatrix"]});function zh(t,e,r){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return pt('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var n=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=r||"mapbox";for(var i=0;i<n;i++)this.data[this._idx(-1,i)]=this.data[this._idx(0,i)],this.data[this._idx(n,i)]=this.data[this._idx(n-1,i)],this.data[this._idx(i,-1)]=this.data[this._idx(i,0)],this.data[this._idx(i,n)]=this.data[this._idx(i,n-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(n,-1)]=this.data[this._idx(n-1,0)],this.data[this._idx(-1,n)]=this.data[this._idx(0,n-1)],this.data[this._idx(n,n)]=this.data[this._idx(n-1,n-1)]}zh.prototype.get=function(t,e){var r=new Uint8Array(this.data.buffer),n=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(r[n],r[1+n],r[2+n])},zh.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},zh.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},zh.prototype._unpackMapbox=function(t,e,r){return(256*t*256+256*e+r)/10-1e4},zh.prototype._unpackTerrarium=function(t,e,r){return 256*t+e+r/256-32768},zh.prototype.getPixels=function(){return new Ws({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},zh.prototype.backfillBorder=function(t,e,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var n=e*this.dim,i=e*this.dim+this.dim,o=r*this.dim,a=r*this.dim+this.dim;switch(e){case-1:n=i-1;break;case 1:i=n+1}switch(r){case-1:o=a-1;break;case 1:a=o+1}for(var s=-e*this.dim,u=-r*this.dim,c=o;c<a;c++)for(var l=n;l<i;l++)this.data[this._idx(l,c)]=t.data[this._idx(l+s,c+u)]},Jn("DEMData",zh);function Fh(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}}Fh.prototype.encode=function(t){return this._stringToNumber[t]},Fh.prototype.decode=function(t){return this._numberToString[t]};function Bh(t,e,r,n,i){this.type="Feature",(this._vectorTileFeature=t)._z=e,t._x=r,t._y=n,this.properties=t.properties,this.id=i}var Uh={geometry:{configurable:!0}};Uh.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Uh.geometry.set=function(t){this._geometry=t},Bh.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Bh.prototype,Uh);function Vh(){this.state={},this.stateChanges={},this.deletedStates={}}Vh.prototype.updateState=function(t,e,r){var n=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},f(this.stateChanges[t][n],r),null===this.deletedStates[t])for(var i in this.deletedStates[t]={},this.state[t])i!==n&&(this.deletedStates[t][i]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][n])for(var o in this.deletedStates[t][n]={},this.state[t][n])r[o]||(this.deletedStates[t][n][o]=null);else for(var a in r)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][a]&&delete this.deletedStates[t][n][a]},Vh.prototype.removeFeatureState=function(t,e,r){if(null!==this.deletedStates[t]){var n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},r&&void 0!==e)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][r]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][n])for(r in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][r]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null}},Vh.prototype.getState=function(t,e){var r=String(e),n=f({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var i=this.deletedStates[t][e];if(null===i)return{};for(var o in i)delete n[o]}return n},Vh.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},Vh.prototype.coalesceChanges=function(t,e){var r={};for(var n in this.stateChanges){this.state[n]=this.state[n]||{};var i={};for(var o in this.stateChanges[n])this.state[n][o]||(this.state[n][o]={}),f(this.state[n][o],this.stateChanges[n][o]),i[o]=this.state[n][o];r[n]=i}for(var a in this.deletedStates){this.state[a]=this.state[a]||{};var s={};if(null===this.deletedStates[a])for(var u in this.state[a])s[u]={},this.state[a][u]={};else for(var c in this.deletedStates[a]){if(null===this.deletedStates[a][c])this.state[a][c]={};else for(var l=0,h=Object.keys(this.deletedStates[a][c]);l<h.length;l+=1)delete this.state[a][c][h[l]];s[c]=this.state[a][c]}r[a]=r[a]||{},f(r[a],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(var p in t)t[p].setFeatureState(r,e)};function Gh(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new $n(De,16,0),this.grid3D=new $n(De,16,0),this.featureIndexArray=new xa,this.promoteId=e}function qh(t,n,i,o,a){return g(t,function(t,e){var r=n instanceof Pi?n.get(e):null;return r&&r.evaluate?r.evaluate(i,o,a):r})}function Hh(t){for(var e=1/0,r=1/0,n=-1/0,i=-1/0,o=0,a=t;o<a.length;o+=1){var s=a[o];e=Math.min(e,s.x),r=Math.min(r,s.y),n=Math.max(n,s.x),i=Math.max(i,s.y)}return{minX:e,minY:r,maxX:n,maxY:i}}function $h(t,e){return e-t}Gh.prototype.insert=function(t,e,r,n,i,o){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i);for(var s=o?this.grid3D:this.grid,u=0;u<e.length;u++){for(var c=e[u],l=[1/0,1/0,-1/0,-1/0],h=0;h<c.length;h++){var p=c[h];l[0]=Math.min(l[0],p.x),l[1]=Math.min(l[1],p.y),l[2]=Math.max(l[2],p.x),l[3]=Math.max(l[3],p.y)}l[0]<De&&l[1]<De&&0<=l[2]&&0<=l[3]&&s.insert(a,l[0],l[1],l[2],l[3])}},Gh.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Ku.VectorTile(new Lc(this.rawTileData)).layers,this.sourceLayerCoder=new Fh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Gh.prototype.query=function(i,o,a,s){var u=this;this.loadVTLayers();for(var c=i.params||{},l=De/i.tileSize/i.scale,h=_n(c.filter),p=i.queryGeometry,f=i.queryPadding*l,t=Hh(p),d=this.grid.query(t.minX-f,t.minY-f,t.maxX+f,t.maxY+f),e=Hh(i.cameraQueryGeometry),r=0,n=this.grid3D.query(e.minX-f,e.minY-f,e.maxX+f,e.maxY+f,function(t,e,r,n){return function(t,e,r,n,i){for(var o=0,a=t;o<a.length;o+=1){var s=a[o];if(e<=s.x&&r<=s.y&&n>=s.x&&i>=s.y)return!0}var u=[new ht(e,r),new ht(e,i),new ht(n,i),new ht(n,r)];if(2<t.length)for(var c=0,l=u;c<l.length;c+=1)if(Es(t,l[c]))return!0;for(var h=0;h<t.length-1;h++)if(Cs(t[h],t[h+1],u))return!0;return!1}(i.cameraQueryGeometry,t-f,e-f,r+f,n+f)});r<n.length;r+=1)d.push(n[r]);d.sort($h);for(var m,g={},y=function(t){var e=d[t];if(e!==m){m=e;var r=u.featureIndexArray.get(e),n=null;u.loadMatchingFeature(g,r.bucketIndex,r.sourceLayerIndex,r.featureIndex,h,c.layers,c.availableImages,o,a,s,function(t,e,r){return n=n||ds(t),e.queryIntersectsFeature(p,t,r,n,u.z,i.transform,l,i.pixelPosMatrix)})}},v=0;v<d.length;v++)y(v);return g},Gh.prototype.loadMatchingFeature=function(t,e,r,n,i,o,a,s,u,c,l){var h=this.bucketLayerIDs[e];if(!o||function(t,e){for(var r=0;r<t.length;r++)if(0<=e.indexOf(t[r]))return!0;return!1}(o,h)){var p=this.sourceLayerCoder.decode(r),f=this.vtLayers[p].feature(n);if(i.filter(new vi(this.tileID.overscaledZ),f))for(var d=this.getId(f,p),m=0;m<h.length;m++){var g=h[m];if(!(o&&o.indexOf(g)<0)){var y=s[g];if(y){var v={};void 0!==d&&c&&(v=c.getState(y.sourceLayer||"_geojsonTileLayer",d));var _=u[g];_.paint=qh(_.paint,y.paint,f,v,a),_.layout=qh(_.layout,y.layout,f,v,a);var b=!l||l(f,y,v);if(b){var x=new Bh(f,this.z,this.x,this.y,d);x.layer=_;var w=t[g];void 0===w&&(w=t[g]=[]),w.push({featureIndex:n,feature:x,intersectionZ:b})}}}}}},Gh.prototype.lookupSymbolFeatures=function(t,e,r,n,i,o,a,s){var u={};this.loadVTLayers();for(var c=_n(i),l=0,h=t;l<h.length;l+=1)this.loadMatchingFeature(u,r,n,h[l],c,o,a,s,e);return u},Gh.prototype.hasLayer=function(t){for(var e=0,r=this.bucketLayerIDs;e<r.length;e+=1)for(var n=0,i=r[e];n<i.length;n+=1)if(t===i[n])return!0;return!1},Gh.prototype.getId=function(t,e){var r=t.id;return this.promoteId&&"boolean"==typeof(r=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]])&&(r=Number(r)),r},Jn("FeatureIndex",Gh,{omit:["rawTileData","sourceLayerCoder"]});function Wh(t,e){this.tileID=t,this.uid=l(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}Wh.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<N.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},Wh.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},Wh.prototype.loadVectorData=function(t,e,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var n in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,i){var o={};if(!i)return o;for(var e=function(){var t=s[a],r=t.layerIds.map(function(t){return i.getLayer(t)}).filter(Boolean);if(0!==r.length){t.layers=r,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map(function(e){return r.filter(function(t){return t.id===e})[0]}));for(var e=0,n=r;e<n.length;e+=1)o[n[e].id]=t}},a=0,s=t;a<s.length;a+=1)e();return o}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[n];if(i instanceof ah){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var o in this.buckets){var a=this.buckets[o];if(a instanceof ah&&a.hasRTLText){this.hasRTLText=!0,bi.isLoading()||bi.isLoaded()||"deferred"!==gi()||yi();break}}for(var s in this.queryPadding=0,this.buckets){var u=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(s).queryRadius(u))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new na},Wh.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Wh.prototype.getBucket=function(t){return this.buckets[t.id]},Wh.prototype.upload=function(t){for(var e in this.buckets){var r=this.buckets[e];r.uploadPending()&&r.upload(t)}var n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new lh(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new lh(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)},Wh.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Wh.prototype.queryRenderedFeatures=function(t,e,r,n,i,o,a,s,u,c){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:n,cameraQueryGeometry:i,scale:o,tileSize:this.tileSize,pixelPosMatrix:c,transform:s,params:a,queryPadding:this.queryPadding*u},t,e,r):{}},Wh.prototype.querySourceFeatures=function(t,e){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var n=r.loadVTLayers(),i=e?e.sourceLayer:"",o=n._geojsonTileLayer||n[i];if(o)for(var a=_n(e&&e.filter),s=this.tileID.canonical,u=s.z,c=s.x,l=s.y,h={z:u,x:c,y:l},p=0;p<o.length;p++){var f=o.feature(p);if(a.filter(new vi(this.tileID.overscaledZ),f)){var d=r.getId(f,i),m=new Bh(f,u,c,l,d);m.tile=h,t.push(m)}}}},Wh.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},Wh.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Wh.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var r=S(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var n=Date.now(),i=!1;if(this.expirationTime>n)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{var o=this.expirationTime-e;o?this.expirationTime=n+Math.max(o,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Wh.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},Wh.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var r=this.latestFeatureIndex.loadVTLayers();for(var n in this.buckets)if(e.style.hasLayer(n)){var i=this.buckets[n],o=i.layers[0].sourceLayer||"_geojsonTileLayer",a=r[o],s=t[o];a&&s&&0!==Object.keys(s).length&&(i.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{}),e&&e.style&&(this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(n).queryRadius(i))))}}},Wh.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},Wh.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<N.now()},Wh.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Wh.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=N.now()+t},Wh.prototype.setDependencies=function(t,e){for(var r={},n=0,i=e;n<i.length;n+=1)r[i[n]]=!0;this.dependencies[t]=r},Wh.prototype.hasDependency=function(t,e){for(var r=0,n=t;r<n.length;r+=1){var i=this.dependencies[n[r]];if(i)for(var o=0,a=e;o<a.length;o+=1)if(i[a[o]])return!0}return!1};function Xh(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Yh.mark(this._marks.start)}var Yh=self.performance;Xh.prototype.finish=function(){Yh.mark(this._marks.end);var t=Yh.getEntriesByName(this._marks.measure);return 0===t.length&&(Yh.measure(this._marks.measure,this._marks.start,this._marks.end),t=Yh.getEntriesByName(this._marks.measure),Yh.clearMarks(this._marks.start),Yh.clearMarks(this._marks.end),Yh.clearMeasures(this._marks.measure)),t},t.Actor=Lh,t.AlphaImage=$s,t.CanonicalTileID=Nh,t.CollisionBoxArray=na,t.Color=ae,t.DEMData=zh,t.DataConstantProperty=Oi,t.DictionaryCoder=Fh,t.EXTENT=De,t.ErrorEvent=Rt,t.EvaluationParameters=vi,t.Event=At,t.Evented=It,t.FeatureIndex=Gh,t.FillBucket=Du,t.FillExtrusionBucket=ec,t.ImageAtlas=ol,t.ImagePosition=rl,t.LineBucket=uc,t.LngLat=Pe,t.LngLatBounds=Te,t.MercatorCoordinate=ke,t.ONE_EM=Ic,t.OverscaledTileID=Dh,t.Point=ht,t.Point$1=ht,t.Properties=Di,t.Protobuf=Lc,t.RGBAImage=Ws,t.RequestManager=B,t.RequestPerformance=Xh,t.ResourceType=yt,t.SegmentVector=Sa,t.SourceFeatureState=Vh,t.StructArrayLayout1ui2=Wo,t.StructArrayLayout2i4=$i,t.StructArrayLayout3ui6=Uo,t.StructArrayLayout4i8=Yi,t.SymbolBucket=ah,t.Texture=lh,t.Tile=Wh,t.Transitionable=Si,t.Uniform1f=qa,t.Uniform1i=Ga,t.Uniform2f=Ha,t.Uniform3f=$a,t.Uniform4f=Wa,t.UniformColor=Xa,t.UniformMatrix4f=Za,t.UnwrappedTileID=kh,t.ValidationError=Dt,t.WritingMode=sl,t.ZoomHistory=ii,t.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},t.addDynamicAttributes=rh,t.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);var i=t.length,o=new Array(t.length),a=null;t.forEach(function(t,r){e(t,function(t,e){t&&(a=t),o[r]=e,0==--i&&n(a,o)})})},t.bezier=i,t.bindAll=d,t.browser=N,t.cacheEntryPossiblyAdded=function(t){++mt>st&&(t.getActor().send("enforceCacheSizeLimit",at),mt=0)},t.clamp=s,t.clearTileCache=function(t){var e=self.caches.delete(ot);t&&e.catch(t).then(function(){return t()})},t.clone=function(t){var e=new Rs(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=v,t.clone$2=function(t){var e=new Rs(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.config=k,t.create=function(){var t=new Rs(16);return Rs!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=function(){var t=new Rs(9);return Rs!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},t.create$2=function(){var t=new Rs(4);return Rs!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=an,t.createLayout=Gi,t.createStyleLayer=function(t){return"custom"===t.type?new bh(t):new xh[t.type](t)},t.cross=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2];return t[0]=i*u-o*s,t[1]=o*a-n*u,t[2]=n*s-i*a,t},t.deepEqual=function t(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(var n=0;n<e.length;n++)if(!t(e[n],r[n]))return!1;return!0}if("object"!=typeof e||null===e||null===r)return e===r;if("object"!=typeof r)return!1;if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var i in e)if(!t(e[i],r[i]))return!1;return!0},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=a,t.emitValidationErrors=Hn,t.endsWith=m,t.enforceCacheSizeLimit=function(n){lt(),Z&&Z.then(function(r){r.keys().then(function(t){for(var e=0;e<t.length-n;e++)r.delete(t[e])})})},t.evaluateSizeForFeature=Cl,t.evaluateSizeForZoom=Ml,t.evaluateVariableOffset=$l,t.evented=_i,t.extend=f,t.featureFilter=_n,t.filterObject=y,t.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=yl,t.getAnchorJustification=Wl,t.getArrayBuffer=St,t.getImage=Tt,t.getJSON=function(t,e){return wt(f(t,{type:"json"}),e)},t.getRTLTextPluginStatus=gi,t.getReferrer=bt,t.getVideo=function(t,e){var r,n,i=self.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(var o=0;o<t.length;o++){var a=self.document.createElement("source");r=t[o],n=void 0,(n=self.document.createElement("a")).href=r,n.protocol===self.document.location.protocol&&n.host===self.document.location.host||(i.crossOrigin="Anonymous"),a.src=t[o],i.appendChild(a)}return{cancel:function(){}}},t.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],g=e[14],y=e[15],v=r*s-n*a,_=r*u-i*a,b=r*c-o*a,x=n*u-i*s,w=n*c-o*s,S=i*c-o*u,E=l*m-h*d,C=l*g-p*d,M=l*y-f*d,T=h*g-p*m,P=h*y-f*m,O=p*y-f*g,A=v*O-_*P+b*T+x*M-w*C+S*E;return A?(t[0]=(s*O-u*P+c*T)*(A=1/A),t[1]=(i*P-n*O-o*T)*A,t[2]=(m*S-g*w+y*x)*A,t[3]=(p*w-h*S-f*x)*A,t[4]=(u*M-a*O-c*C)*A,t[5]=(r*O-i*M+o*C)*A,t[6]=(g*b-d*S-y*_)*A,t[7]=(l*S-p*b+f*_)*A,t[8]=(a*P-s*M+c*E)*A,t[9]=(n*M-r*P-o*E)*A,t[10]=(d*w-m*b+y*v)*A,t[11]=(h*b-l*w-f*v)*A,t[12]=(s*C-a*T-u*E)*A,t[13]=(r*T-n*C+i*E)*A,t[14]=(m*_-d*x-g*v)*A,t[15]=(l*x-h*_+p*v)*A,t):null},t.isChar=oi,t.isMapboxURL=V,t.keysDifference=function(t,e){var r=[];for(var n in t)n in e||r.push(n);return r},t.makeRequest=wt,t.mapObject=g,t.mercatorXfromLng=Ie,t.mercatorYfromLat=Le,t.mercatorZfromAltitude=Re,t.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],p=e[9],f=e[10],d=e[11],m=e[12],g=e[13],y=e[14],v=e[15],_=r[0],b=r[1],x=r[2],w=r[3];return t[0]=_*n+b*s+x*h+w*m,t[1]=_*i+b*u+x*p+w*g,t[2]=_*o+b*c+x*f+w*y,t[3]=_*a+b*l+x*d+w*v,t[4]=(_=r[4])*n+(b=r[5])*s+(x=r[6])*h+(w=r[7])*m,t[5]=_*i+b*u+x*p+w*g,t[6]=_*o+b*c+x*f+w*y,t[7]=_*a+b*l+x*d+w*v,t[8]=(_=r[8])*n+(b=r[9])*s+(x=r[10])*h+(w=r[11])*m,t[9]=_*i+b*u+x*p+w*g,t[10]=_*o+b*c+x*f+w*y,t[11]=_*a+b*l+x*d+w*v,t[12]=(_=r[12])*n+(b=r[13])*s+(x=r[14])*h+(w=r[15])*m,t[13]=_*i+b*u+x*p+w*g,t[14]=_*o+b*c+x*f+w*y,t[15]=_*a+b*l+x*d+w*v,t},t.mvt=Ku,t.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return 0<o&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},t.number=nr,t.offscreenCanvasSupported=gt,t.ortho=function(t,e,r,n,i,o,a){var s=1/(e-r),u=1/(n-i),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(a+o)*c,t[15]=1,t},t.parseGlyphPBF=function(t){return new Lc(t).readFields(Kc,[])},t.pbf=Lc,t.performSymbolLayout=function(R,N,k,D,j,t,z){R.createArrays(),R.tilePixelRatio=De/(512*R.overscaling),R.compareText={},R.iconsNeedLinear=!1;var F=R.layers[0].layout,e=R.layers[0]._unevaluatedLayout._values,B={};if("composite"===R.textSizeData.kind){var r=R.textSizeData,n=r.maxZoom;B.compositeTextSizes=[e["text-size"].possiblyEvaluate(new vi(r.minZoom),z),e["text-size"].possiblyEvaluate(new vi(n),z)]}if("composite"===R.iconSizeData.kind){var i=R.iconSizeData,o=i.maxZoom;B.compositeIconSizes=[e["icon-size"].possiblyEvaluate(new vi(i.minZoom),z),e["icon-size"].possiblyEvaluate(new vi(o),z)]}B.layoutTextSize=e["text-size"].possiblyEvaluate(new vi(R.zoom+1),z),B.layoutIconSize=e["icon-size"].possiblyEvaluate(new vi(R.zoom+1),z),B.textMaxSize=e["text-size"].possiblyEvaluate(new vi(18));for(var U=F.get("text-line-height")*Ic,V="map"===F.get("text-rotation-alignment")&&"point"!==F.get("symbol-placement"),G=F.get("text-keep-upright"),q=F.get("text-size"),a=function(){var t=$[H],e=F.get("text-font").evaluate(t,{},z).join(","),r=q.evaluate(t,{},z),n=B.layoutTextSize.evaluate(t,{},z),i=B.layoutIconSize.evaluate(t,{},z),o={horizontal:{},vertical:void 0},a=t.text,s=[0,0];if(a){var u=a.toString(),c=F.get("text-letter-spacing").evaluate(t,{},z)*Ic,l=function(){for(var t=0,e=u;t<e.length;t+=1)if(r=e[t].charCodeAt(0),oi.Arabic(r)||oi["Arabic Supplement"](r)||oi["Arabic Extended-A"](r)||oi["Arabic Presentation Forms-A"](r)||oi["Arabic Presentation Forms-B"](r))return!1;var r;return!0}()?c:0,h=F.get("text-anchor").evaluate(t,{},z),p=F.get("text-variable-anchor");if(!p){var f=F.get("text-radial-offset").evaluate(t,{},z);s=f?$l(h,[f*Ic,Hl]):F.get("text-offset").evaluate(t,{},z).map(function(t){return t*Ic})}var d=V?"center":F.get("text-justify").evaluate(t,{},z),m=F.get("symbol-placement"),g="point"===m?F.get("text-max-width").evaluate(t,{},z)*Ic:0,y=function(){R.allowVerticalPlacement&&ai(u)&&(o.vertical=ll(a,N,k,j,e,g,U,h,"left",l,s,sl.vertical,!0,m,n,r))};if(!V&&p){for(var v="auto"===d?p.map(function(t){return Wl(t)}):[d],_=!1,b=0;b<v.length;b++){var x=v[b];if(!o.horizontal[x])if(_)o.horizontal[x]=o.horizontal[0];else{var w=ll(a,N,k,j,e,g,U,"center",x,l,s,sl.horizontal,!1,m,n,r);w&&(_=1===(o.horizontal[x]=w).positionedLines.length)}}y()}else{"auto"===d&&(d=Wl(h));var S=ll(a,N,k,j,e,g,U,h,d,l,s,sl.horizontal,!1,m,n,r);S&&(o.horizontal[d]=S),y(),ai(u)&&V&&G&&(o.vertical=ll(a,N,k,j,e,g,U,h,d,l,s,sl.vertical,!1,m,n,r))}}var E,C,M,T,P,O=void 0,A=!1;if(t.icon&&t.icon.name){var I=D[t.icon.name];I&&(E=j[t.icon.name],C=F.get("icon-offset").evaluate(t,{},z),M=yl(F.get("icon-anchor").evaluate(t,{},z)),T=C[0]-E.displaySize[0]*M.horizontalAlign,P=C[1]-E.displaySize[1]*M.verticalAlign,O={image:E,top:P,bottom:P+E.displaySize[1],left:T,right:T+E.displaySize[0]},A=I.sdf,void 0===R.sdfIcons?R.sdfIcons=I.sdf:R.sdfIcons!==I.sdf&&pt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),I.pixelRatio!==R.pixelRatio?R.iconsNeedLinear=!0:0!==F.get("icon-rotate").constantOr(1)&&(R.iconsNeedLinear=!0))}var L=Kl(o.horizontal)||o.vertical;R.iconsInText=!!L&&L.iconsInText,(L||O)&&function(r,n,i,o,a,s,t,e,u,c,l){var h=s.textMaxSize.evaluate(n,{});void 0===h&&(h=t);var p,f=r.layers[0].layout,d=f.get("icon-offset").evaluate(n,{},l),m=Kl(i.horizontal),g=t/24,y=r.tilePixelRatio*g,v=r.tilePixelRatio*h/24,_=r.tilePixelRatio*e,b=r.tilePixelRatio*f.get("symbol-spacing"),x=f.get("text-padding")*r.tilePixelRatio,w=f.get("icon-padding")*r.tilePixelRatio,S=f.get("text-max-angle")/180*Math.PI,E="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),C="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),M=f.get("symbol-placement"),T=b/2,P=f.get("icon-text-fit");o&&"none"!==P&&(r.allowVerticalPlacement&&i.vertical&&(p=_l(o,i.vertical,P,f.get("icon-text-fit-padding"),d,g)),m&&(o=_l(o,m,P,f.get("icon-text-fit-padding"),d,g)));function O(t,e){e.x<0||e.x>=De||e.y<0||e.y>=De||function(t,e,r,n,i,o,a,s,u,c,l,h,p,f,d,m,g,y,v,_,b,x,w,S){var E,C,M,T,P,O=t.addToLineVertexArray(e,r),A=0,I=0,L=0,R=0,N=-1,k=-1,D={},j=Oa(""),z=0,F=0;if(F=void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(z=(E=s.layout.get("text-offset").evaluate(b,{},S).map(function(t){return t*Ic}))[0],E[1]):(z=s.layout.get("text-radial-offset").evaluate(b,{},S)*Ic,Hl),t.allowVerticalPlacement&&n.vertical){var B=s.layout.get("text-rotate").evaluate(b,{},S)+90;T=new Fl(u,r,e,c,l,h,n.vertical,p,f,d,t.overscaling,B),a&&(P=new Fl(u,r,e,c,l,h,a,g,y,d,t.overscaling,B))}if(i){var U=s.layout.get("icon-rotate").evaluate(b,{}),V="none"!==s.layout.get("icon-text-fit"),G=Nl(i,U,w,V),q=a?Nl(a,U,w,V):void 0;M=new Fl(u,r,e,c,l,h,i,g,y,!1,t.overscaling,U),A=4*G.length;var H=t.iconSizeData,$=null;"source"===H.kind?($=[Sl*s.layout.get("icon-size").evaluate(b,{})])[0]>Yl&&pt(t.layerIds[0]+': Value for "icon-size" is >= '+Xl+'. Reduce your "icon-size".'):"composite"===H.kind&&(($=[Sl*x.compositeIconSizes[0].evaluate(b,{},S),Sl*x.compositeIconSizes[1].evaluate(b,{},S)])[0]>Yl||$[1]>Yl)&&pt(t.layerIds[0]+': Value for "icon-size" is >= '+Xl+'. Reduce your "icon-size".'),t.addSymbols(t.icon,G,$,_,v,b,!1,e,O.lineStartIndex,O.lineLength,-1,S),N=t.icon.placedSymbolArray.length-1,q&&(I=4*q.length,t.addSymbols(t.icon,q,$,_,v,b,sl.vertical,e,O.lineStartIndex,O.lineLength,-1,S),k=t.icon.placedSymbolArray.length-1)}for(var W in n.horizontal){var X=n.horizontal[W];if(!C){j=Oa(X.text);var Y=s.layout.get("text-rotate").evaluate(b,{},S);C=new Fl(u,r,e,c,l,h,X,p,f,d,t.overscaling,Y)}var Z=1===X.positionedLines.length;if(L+=Zl(t,e,X,o,s,d,b,m,O,n.vertical?sl.horizontal:sl.horizontalOnly,Z?Object.keys(n.horizontal):[W],D,N,x,S),Z)break}n.vertical&&(R+=Zl(t,e,n.vertical,o,s,d,b,m,O,sl.vertical,["vertical"],D,k,x,S));var K=C?C.boxStartIndex:t.collisionBoxArray.length,J=C?C.boxEndIndex:t.collisionBoxArray.length,Q=T?T.boxStartIndex:t.collisionBoxArray.length,tt=T?T.boxEndIndex:t.collisionBoxArray.length,et=M?M.boxStartIndex:t.collisionBoxArray.length,rt=M?M.boxEndIndex:t.collisionBoxArray.length,nt=P?P.boxStartIndex:t.collisionBoxArray.length,it=P?P.boxEndIndex:t.collisionBoxArray.length;t.glyphOffsetArray.length>=ah.MAX_GLYPHS&&pt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,b.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,0<=D.right?D.right:-1,0<=D.center?D.center:-1,0<=D.left?D.left:-1,D.vertical||-1,N,k,j,K,J,Q,tt,et,rt,nt,it,c,L,R,A,I,0,p,z,F)}(r,e,t,i,o,a,p,r.layers[0],r.collisionBoxArray,n.index,n.sourceLayerIndex,r.index,y,x,E,u,_,w,C,d,n,s,c,l)}var A,I,L,R,N,k,D,j,z,F,B,U,V;if("line"===M)for(var G=0,q=function(t,e,r,n,i){for(var o=[],a=0;a<t.length;a++)for(var s=t[a],u=void 0,c=0;c<s.length-1;c++){var l=s[c],h=s[c+1];l.x<0&&h.x<0||(l.x<0?l=new ht(0,l.y+(0-l.x)/(h.x-l.x)*(h.y-l.y))._round():h.x<0&&(h=new ht(0,l.y+(0-l.x)/(h.x-l.x)*(h.y-l.y))._round()),l.y<0&&h.y<0||(l.y<0?l=new ht(l.x+(0-l.y)/(h.y-l.y)*(h.x-l.x),0)._round():h.y<0&&(h=new ht(l.x+(0-l.y)/(h.y-l.y)*(h.x-l.x),0)._round()),l.x>=n&&h.x>=n||(l.x>=n?l=new ht(n,l.y+(n-l.x)/(h.x-l.x)*(h.y-l.y))._round():h.x>=n&&(h=new ht(n,l.y+(n-l.x)/(h.x-l.x)*(h.y-l.y))._round()),l.y>=i&&h.y>=i||(l.y>=i?l=new ht(l.x+(i-l.y)/(h.y-l.y)*(h.x-l.x),i)._round():h.y>=i&&(h=new ht(l.x+(i-l.y)/(h.y-l.y)*(h.x-l.x),i)._round()),u&&l.equals(u[u.length-1])||o.push(u=[l]),u.push(h)))))}return o}(n.geometry,0,0,De,De);G<q.length;G+=1)for(var H=q[G],$=0,W=(A=H,I=b,L=S,R=i.vertical||m,N=o,k=24,D=v,j=r.overscaling,z=De,void 0,F=Al(R,k,D),B=Il(R,N),U=B*D,V=0===A[0].x||A[0].x===z||0===A[0].y||A[0].y===z,I-U<I/4&&(I=U+I/4),function t(e,r,n,i,o,a,s,u,c){for(var l=a/2,h=Ol(e),p=0,f=r-n,d=[],m=0;m<e.length-1;m++){for(var g=e[m],y=e[m+1],v=g.dist(y),_=y.angleTo(g);f+n<p+v;){var b=((f+=n)-p)/v,x=nr(g.x,y.x,b),w=nr(g.y,y.y,b);if(0<=x&&x<c&&0<=w&&w<c&&0<=f-l&&f+l<=h){var S=new xl(x,w,_,m);S._round(),i&&!Pl(e,S,a,i,o)||d.push(S)}}p+=v}return u||d.length||s||(d=t(e,p/2,n,i,o,a,s,!0,c)),d}(A,V?I/2*j%I:(B/2+2*k)*D*j%I,I,F,L,U,V,!1,z));$<W.length;$+=1){var X=W[$];m&&Jl(r,m.text,T,X)||O(H,X)}else if("line-center"===M)for(var Y=0,Z=n.geometry;Y<Z.length;Y+=1){var K=Z[Y];if(1<K.length){var J=Ll(K,S,i.vertical||m,o,24,v);J&&O(K,J)}}else if("Polygon"===n.type)for(var Q=0,tt=Lu(n.geometry,0);Q<tt.length;Q+=1){var et=tt[Q],rt=Vl(et,16);O(et[0],new xl(rt.x,rt.y,0))}else if("LineString"===n.type)for(var nt=0,it=n.geometry;nt<it.length;nt+=1){var ot=it[nt];O(ot,new xl(ot[0].x,ot[0].y,0))}else if("Point"===n.type)for(var at=0,st=n.geometry;at<st.length;at+=1)for(var ut=0,ct=st[at];ut<ct.length;ut+=1){var lt=ct[ut];O([lt],new xl(lt.x,lt.y,0))}}(R,t,o,O,D,B,n,i,s,A,z)},H=0,$=R.features;H<$.length;H+=1)a();t&&R.generateCollisionDebugBuffers()},t.perspective=function(t,e,r,n,i){var o,a=1/Math.tan(e/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+n)*(o=1/(n-i)),t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n),t},t.pick=function(t,e){for(var r={},n=0;n<e.length;n++){var i=e[n];i in t&&(r[i]=t[i])}return r},t.plugin=bi,t.polygonIntersectsPolygon=ys,t.postMapLoadEvent=it,t.postTurnstileEvent=rt,t.potpack=el,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=Jn,t.registerForPluginStateChange=function(t){return t({pluginStatus:fi,pluginURL:di}),_i.on("pluginStateChange",t),t},t.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=n*-s+o*u,t[3]=i*-s+a*u,t},t.rotateX=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+c*n,t[5]=a*i+l*n,t[6]=s*i+h*n,t[7]=u*i+p*n,t[8]=c*i-o*n,t[9]=l*i-a*n,t[10]=h*i-s*n,t[11]=p*i-u*n,t},t.rotateZ=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],c=e[4],l=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+c*n,t[1]=a*i+l*n,t[2]=s*i+h*n,t[3]=u*i+p*n,t[4]=c*i-o*n,t[5]=l*i-a*n,t[6]=h*i-s*n,t[7]=p*i-u*n,t},t.scale=function(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},t.scale$2=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},t.setCacheLimits=function(t,e){at=t,st=e},t.setRTLTextPlugin=function(t,e,r){if(void 0===r&&(r=!1),"deferred"===fi||"loading"===fi||"loaded"===fi)throw new Error("setRTLTextPlugin cannot be called multiple times.");di=N.resolveURL(t),fi="deferred",pi=e,mi(),r||yi()},t.sphericalToCartesian=function(t){var e=t[0],r=t[1],n=t[2];return r+=90,r*=Math.PI/180,n*=Math.PI/180,{x:e*Math.cos(r)*Math.sin(n),y:e*Math.sin(r)*Math.sin(n),z:e*Math.cos(n)}},t.sqrLen=function(t){var e=t[0],r=t[1];return e*e+r*r},t.styleSpec=kt,t.sub=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},t.symbolSize=Tl,t.transformMat3=function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t},t.transformMat4=Ns,t.translate=function(t,e,r){var n,i,o,a,s,u,c,l,h,p,f,d,m=r[0],g=r[1],y=r[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=n=e[0],t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=l,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=n*m+s*g+h*y+e[12],t[13]=i*m+u*g+p*y+e[13],t[14]=o*m+c*g+f*y+e[14],t[15]=a*m+l*g+d*y+e[15]),t},t.triggerPluginCompletionEvent=hi,t.uniqueId=l,t.validateCustomStyleLayer=function(t){var e=[],r=t.id;return void 0===r&&e.push({message:"layers."+r+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+r+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=Vn,t.validateStyle=Un,t.values=function(t){var e=[];for(var r in t)e.push(t[r]);return e},t.vectorTile=Ku,t.version="1.9.1",t.warnOnce=pt,t.webpSupported=D,t.window=self,t.wrap=u}),t(0,function(A){function u(t){var e=typeof t;if("number"==e||"boolean"==e||"string"==e||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var r="[",n=0,i=t;n<i.length;n+=1)r+=u(i[n])+",";return r+"]"}for(var o=Object.keys(t).sort(),a="{",s=0;s<o.length;s++)a+=JSON.stringify(o[s])+":"+u(t[o[s]])+",";return a+"}"}function v(t){for(var e="",r=0,n=A.refProperties;r<n.length;r+=1)e+="/"+u(t[n[r]]);return e}function r(t){this.keyCache={},t&&this.replace(t)}r.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},r.prototype.update=function(t,e){for(var r=this,n=0,i=t;n<i.length;n+=1){var o=i[n];this._layerConfigs[o.id]=o;var a=this._layers[o.id]=A.createStyleLayer(o);a._featureFilter=A.featureFilter(a.filter),this.keyCache[o.id]&&delete this.keyCache[o.id]}for(var s=0,u=e;s<u.length;s+=1){var c=u[s];delete this.keyCache[c],delete this._layerConfigs[c],delete this._layers[c]}this.familiesBySource={};for(var l=0,h=function(t,e){for(var r={},n=0;n<t.length;n++){var i=e&&e[t[n].id]||v(t[n]);e&&(e[t[n].id]=i);var o=r[i];(o=o||(r[i]=[])).push(t[n])}var a=[];for(var s in r)a.push(r[s]);return a}(A.values(this._layerConfigs),this.keyCache);l<h.length;l+=1){var p=h[l].map(function(t){return r._layers[t.id]}),f=p[0];if("none"!==f.visibility){var d=f.source||"",m=this.familiesBySource[d];m=m||(this.familiesBySource[d]={});var g=f.sourceLayer||"_geojsonTileLayer",y=m[g];(y=y||(m[g]=[])).push(p)}}};function I(t){var e={},r=[];for(var n in t){var i=t[n],o=e[n]={};for(var a in i){var s=i[+a];if(s&&0!==s.bitmap.width&&0!==s.bitmap.height){var u={x:0,y:0,w:s.bitmap.width+2,h:s.bitmap.height+2};r.push(u),o[a]={rect:u,metrics:s.metrics}}}}var c=A.potpack(r),l=new A.AlphaImage({width:c.w||1,height:c.h||1});for(var h in t){var p=t[h];for(var f in p){var d=p[+f];if(d&&0!==d.bitmap.width&&0!==d.bitmap.height){var m=e[h][f].rect;A.AlphaImage.copy(d.bitmap,l,{x:0,y:0},{x:m.x+1,y:m.y+1},d.bitmap)}}}this.image=l,this.positions=e}A.register("GlyphAtlas",I);function e(t){this.tileID=new A.OverscaledTileID(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId}function L(t,e,r){for(var n=new A.EvaluationParameters(e),i=0,o=t;i<o.length;i+=1)o[i].recalculate(n,r)}function i(t,i){var e=A.getArrayBuffer(t.request,function(t,e,r,n){t?i(t):e&&i(null,{vectorTile:new A.vectorTile.VectorTile(new A.pbf(e)),rawData:e,cacheControl:r,expires:n})});return function(){e.cancel(),i()}}e.prototype.parse=function(t,e,i,r,o){var n=this;this.status="parsing",this.data=t,this.collisionBoxArray=new A.CollisionBoxArray;var a=new A.DictionaryCoder(Object.keys(t.layers).sort()),s=new A.FeatureIndex(this.tileID,this.promoteId);s.bucketLayerIDs=[];var u,c,l,h,p={},f={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:i},d=e.familiesBySource[this.source];for(var m in d){var g=t.layers[m];if(g){1===g.version&&A.warnOnce('Vector tile source "'+this.source+'" layer "'+m+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var y=a.encode(m),v=[],_=0;_<g.length;_++){var b=g.feature(_),x=s.getId(b,m);v.push({feature:b,id:x,index:_,sourceLayerIndex:y})}for(var w=0,S=d[m];w<S.length;w+=1){var E=S[w],C=E[0];C.minzoom&&this.zoom<Math.floor(C.minzoom)||C.maxzoom&&this.zoom>=C.maxzoom||"none"!==C.visibility&&(L(E,this.zoom,i),(p[C.id]=C.createBucket({index:s.bucketLayerIDs.length,layers:E,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:y,sourceID:this.source})).populate(v,f,this.tileID.canonical),s.bucketLayerIDs.push(E.map(function(t){return t.id})))}}}var M=A.mapObject(f.glyphDependencies,function(t){return Object.keys(t).map(Number)});Object.keys(M).length?r.send("getGlyphs",{uid:this.uid,stacks:M},function(t,e){u||(u=t,c=e,O.call(n))}):c={};var T=Object.keys(f.iconDependencies);T.length?r.send("getImages",{icons:T,source:this.source,tileID:this.tileID,type:"icons"},function(t,e){u||(u=t,l=e,O.call(n))}):l={};var P=Object.keys(f.patternDependencies);function O(){if(u)return o(u);if(c&&l&&h){var t=new I(c),e=new A.ImageAtlas(l,h);for(var r in p){var n=p[r];n instanceof A.SymbolBucket?(L(n.layers,this.zoom,i),A.performSymbolLayout(n,c,t.positions,l,e.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):n.hasPattern&&(n instanceof A.LineBucket||n instanceof A.FillBucket||n instanceof A.FillExtrusionBucket)&&(L(n.layers,this.zoom,i),n.addFeatures(f,this.tileID.canonical,e.patternPositions))}this.status="done",o(null,{buckets:A.values(p).filter(function(t){return!t.isEmpty()}),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,imageAtlas:e,glyphMap:this.returnDependencies?c:null,iconMap:this.returnDependencies?l:null,glyphPositions:this.returnDependencies?t.positions:null})}}P.length?r.send("getImages",{icons:P,source:this.source,tileID:this.tileID,type:"patterns"},function(t,e){u||(u=t,h=e,O.call(n))}):h={},O.call(this)};function n(t,e,r,n){this.actor=t,this.layerIndex=e,this.availableImages=r,this.loadVectorData=n||i,this.loading={},this.loaded={}}n.prototype.loadTile=function(t,a){var s=this,u=t.uid;this.loading||(this.loading={});var c=!!(t&&t.request&&t.request.collectResourceTiming)&&new A.RequestPerformance(t.request),l=this.loading[u]=new e(t);l.abort=this.loadVectorData(t,function(t,e){if(delete s.loading[u],t||!e)return l.status="done",s.loaded[u]=l,a(t);var r=e.rawData,n={};e.expires&&(n.expires=e.expires),e.cacheControl&&(n.cacheControl=e.cacheControl);var i={};if(c){var o=c.finish();o&&(i.resourceTiming=JSON.parse(JSON.stringify(o)))}l.vectorTile=e.vectorTile,l.parse(e.vectorTile,s.layerIndex,s.availableImages,s.actor,function(t,e){if(t||!e)return a(t);a(null,A.extend({rawTileData:r.slice(0)},e,n,i))}),s.loaded=s.loaded||{},s.loaded[u]=l})},n.prototype.reloadTile=function(t,n){var i=this,e=this.loaded,r=t.uid,o=this;if(e&&e[r]){var a=e[r];a.showCollisionBoxes=t.showCollisionBoxes;var s=function(t,e){var r=a.reloadCallback;r&&(delete a.reloadCallback,a.parse(a.vectorTile,o.layerIndex,i.availableImages,o.actor,r)),n(t,e)};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},n.prototype.abortTile=function(t,e){var r=this.loading,n=t.uid;r&&r[n]&&r[n].abort&&(r[n].abort(),delete r[n]),e()},n.prototype.removeTile=function(t,e){var r=this.loaded,n=t.uid;r&&r[n]&&delete r[n],e()};function o(){this.loaded={}}var s=A.window.ImageBitmap;o.prototype.loadTile=function(t,e){var r=t.uid,n=t.encoding,i=t.rawImageData,o=s&&i instanceof s?this.getImageData(i):i,a=new A.DEMData(r,o,n);this.loaded=this.loaded||{},e(null,this.loaded[r]=a)},o.prototype.getImageData=function(t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);var e=this.offscreenCanvasContext.getImageData(-1,-1,t.width+2,t.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new A.RGBAImage({width:e.width,height:e.height},e.data)},o.prototype.removeTile=function(t){var e=this.loaded,r=t.uid;e&&e[r]&&delete e[r]};var c={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function a(t){var e=0;if(t&&0<t.length){e+=Math.abs(l(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs(l(t[r]))}return e}function l(t){var e,r,n,i,o,a,s=0,u=t.length;if(2<u){for(a=0;a<u;a++)o=a===u-2?(n=u-2,i=u-1,0):a===u-1?(n=u-1,i=0,1):(i=(n=a)+1,a+2),e=t[n],r=t[i],s+=(h(t[o][0])-h(e[0]))*Math.sin(h(r[1]));s=s*c.RADIUS*c.RADIUS/2}return s}function h(t){return t*Math.PI/180}var p={geometry:function t(e){var r,n=0;switch(e.type){case"Polygon":return a(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)n+=a(e.coordinates[r]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<e.geometries.length;r++)n+=t(e.geometries[r]);return n}},ring:l};function f(e,r){return function(t){return e(t,r)}}function d(t,e){t[0]=m(t[0],e=!!e);for(var r=1;r<t.length;r++)t[r]=m(t[r],!e);return t}function m(t,e){return r=t,0<=p.ring(r)===e?t:t.reverse();var r}function g(t){this._feature=t,this.extent=A.EXTENT,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}var y=A.vectorTile.VectorTileFeature.prototype.toGeoJSON;g.prototype.loadGeometry=function(){if(1===this._feature.type){for(var t=[],e=0,r=this._feature.geometry;e<r.length;e+=1){var n=r[e];t.push([new A.Point$1(n[0],n[1])])}return t}for(var i=[],o=0,a=this._feature.geometry;o<a.length;o+=1){for(var s=[],u=0,c=a[o];u<c.length;u+=1){var l=c[u];s.push(new A.Point$1(l[0],l[1]))}i.push(s)}return i},g.prototype.toGeoJSON=function(t,e,r){return y.call(this,t,e,r)};var _=function(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=A.EXTENT,this.length=t.length,this._features=t};_.prototype.feature=function(t){return new g(this._features[t])};var t=A.vectorTile.VectorTileFeature,b=x;function x(t,e){this.options=e||{},this.features=t,this.length=t.length}function w(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}x.prototype.feature=function(t){return new w(this.features[t],this.options.extent)},w.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var r=t[e],n=[],i=0;i<r.length;i++)n.push(new A.Point$1(r[i][0],r[i][1]));this.geometry.push(n)}return this.geometry},w.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,r=-1/0,n=1/0,i=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var u=a[s];e=Math.min(e,u.x),r=Math.max(r,u.x),n=Math.min(n,u.y),i=Math.max(i,u.y)}return[e,n,r,i]},w.prototype.toGeoJSON=t.prototype.toGeoJSON;var S=C,E=b;function C(t){var e=new A.pbf;return function(t,e){for(var r in t.layers)e.writeMessage(3,M,t.layers[r])}(t,e),e.finish()}function M(t,e){var r;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<t.length;r++)n.feature=t.feature(r),e.writeMessage(2,T,n);var i=n.keys;for(r=0;r<i.length;r++)e.writeStringField(3,i[r]);var o=n.values;for(r=0;r<o.length;r++)e.writeMessage(4,k,o[r])}function T(t,e){var r=t.feature;void 0!==r.id&&e.writeVarintField(1,r.id),e.writeMessage(2,P,t),e.writeVarintField(3,r.type),e.writeMessage(4,N,r)}function P(t,e){var r=t.feature,n=t.keys,i=t.values,o=t.keycache,a=t.valuecache;for(var s in r.properties){var u=o[s];void 0===u&&(n.push(s),o[s]=u=n.length-1),e.writeVarint(u);var c=r.properties[s],l=typeof c;"string"!=l&&"boolean"!=l&&"number"!=l&&(c=JSON.stringify(c));var h=l+":"+c,p=a[h];void 0===p&&(i.push(c),a[h]=p=i.length-1),e.writeVarint(p)}}function O(t,e){return(e<<3)+(7&t)}function R(t){return t<<1^t>>31}function N(t,e){for(var r=t.loadGeometry(),n=t.type,i=0,o=0,a=r.length,s=0;s<a;s++){var u=r[s],c=1;1===n&&(c=u.length),e.writeVarint(O(1,c));for(var l=3===n?u.length-1:u.length,h=0;h<l;h++){1===h&&1!==n&&e.writeVarint(O(2,l-1));var p=u[h].x-i,f=u[h].y-o;e.writeVarint(R(p)),e.writeVarint(R(f)),i+=p,o+=f}3===n&&e.writeVarint(O(7,1))}}function k(t,e){var r=typeof t;"string"==r?e.writeStringField(1,t):"boolean"==r?e.writeBooleanField(7,t):"number"==r&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function D(t,e,r,n){j(t,r,n),j(e,2*r,2*n),j(e,2*r+1,2*n+1)}function j(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function z(t,e,r,n){var i=t-r,o=e-n;return i*i+o*o}S.fromVectorTileJs=C,S.fromGeojsonVt=function(t,e){e=e||{};var r={};for(var n in t)r[n]=new b(t[n].features,e),r[n].name=n,r[n].version=e.version,r[n].extent=e.extent;return C({layers:r})},S.GeoJSONWrapper=E;function F(t){return t[0]}function B(t){return t[1]}function U(t,e,r,n,i){void 0===e&&(e=F),void 0===r&&(r=B),void 0===n&&(n=64),void 0===i&&(i=Float64Array),this.nodeSize=n;for(var o=(this.points=t).length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length),u=0;u<t.length;u++)s[2*(a[u]=u)]=e(t[u]),s[2*u+1]=r(t[u]);!function t(e,r,n,i,o,a){if(!(o-i<=n)){var s=i+o>>1;!function t(e,r,n,i,o,a){for(;i<o;){if(600<o-i){var s=o-i+1,u=n-i+1,c=Math.log(s),l=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*l*(s-l)/s)*(u-s/2<0?-1:1);t(e,r,n,Math.max(i,Math.floor(n-u*l/s+h)),Math.min(o,Math.floor(n+(s-u)*l/s+h)),a)}var p=r[2*n+a],f=i,d=o;for(D(e,r,i,n),r[2*o+a]>p&&D(e,r,i,o);f<d;){for(D(e,r,f,d),f++,d--;r[2*f+a]<p;)f++;for(;r[2*d+a]>p;)d--}r[2*i+a]===p?D(e,r,i,d):D(e,r,++d,o),d<=n&&(i=d+1),n<=d&&(o=d-1)}}(e,r,s,i,o,a%2),t(e,r,n,i,s-1,a+1),t(e,r,n,1+s,o,a+1)}}(a,s,n,0,a.length-1,0)}U.prototype.range=function(t,e,r,n){return function(t,e,r,n,i,o,a){for(var s,u,c=[0,t.length-1,0],l=[];c.length;){var h=c.pop(),p=c.pop(),f=c.pop();if(p-f<=a)for(var d=f;d<=p;d++)u=e[2*d+1],(s=e[2*d])>=r&&s<=i&&n<=u&&u<=o&&l.push(t[d]);else{var m=Math.floor((f+p)/2);u=e[2*m+1],(s=e[2*m])>=r&&s<=i&&n<=u&&u<=o&&l.push(t[m]);var g=(h+1)%2;(0===h?r<=s:n<=u)&&(c.push(f),c.push(m-1),c.push(g)),(0===h?s<=i:u<=o)&&(c.push(m+1),c.push(p),c.push(g))}}return l}(this.ids,this.coords,t,e,r,n,this.nodeSize)};function V(t){this.options=X(Object.create(G),t),this.trees=new Array(this.options.maxZoom+1)}var G={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!(U.prototype.within=function(t,e,r){return function(t,e,r,n,i,o){for(var a=[0,t.length-1,0],s=[],u=i*i;a.length;){var c=a.pop(),l=a.pop(),h=a.pop();if(l-h<=o)for(var p=h;p<=l;p++)z(e[2*p],e[2*p+1],r,n)<=u&&s.push(t[p]);else{var f=Math.floor((h+l)/2),d=e[2*f],m=e[2*f+1];z(d,m,r,n)<=u&&s.push(t[f]);var g=(c+1)%2;(0===c?r-i<=d:n-i<=m)&&(a.push(h),a.push(f-1),a.push(g)),(0===c?d<=r+i:m<=n+i)&&(a.push(f+1),a.push(l),a.push(g))}}return s}(this.ids,this.coords,t,e,r,this.nodeSize)}),generateId:!1,reduce:null,map:function(t){return t}};function q(t){return{type:"Feature",id:t.id,properties:H(t),geometry:{type:"Point",coordinates:[(n=t.x,360*(n-.5)),(e=t.y,r=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(r))/Math.PI-90)]}};var e,r,n}function H(t){var e=t.numPoints,r=1e4<=e?Math.round(e/1e3)+"k":1e3<=e?Math.round(e/100)/10+"k":e;return X(X({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:r})}function $(t){return t/360+.5}function W(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:1<r?1:r}function X(t,e){for(var r in e)t[r]=e[r];return t}function Y(t){return t.x}function Z(t){return t.y}function K(t,e,r,n,i,o){var a=i-r,s=o-n;if(0!==a||0!==s){var u=((t-r)*a+(e-n)*s)/(a*a+s*s);1<u?(r=i,n=o):0<u&&(r+=a*u,n+=s*u)}return(a=t-r)*a+(s=e-n)*s}function J(t,e,r,n){var i={id:void 0===t?null:t,type:e,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)Q(t,e);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<e.length;n++)Q(t,e[n]);else if("MultiPolygon"===r)for(n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)Q(t,e[n][i])}(i),i}function Q(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function tt(t,e,r,n){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],u=e.id;if(r.promoteId?u=e.properties[r.promoteId]:r.generateId&&(u=n||0),"Point"===o)et(i,s);else if("MultiPoint"===o)for(var c=0;c<i.length;c++)et(i[c],s);else if("LineString"===o)rt(i,s,a,!1);else if("MultiLineString"===o){if(r.lineMetrics){for(c=0;c<i.length;c++)rt(i[c],s=[],a,!1),t.push(J(u,"LineString",s,e.properties));return}nt(i,s,a,!1)}else if("Polygon"===o)nt(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"!==o)throw new Error("Input data is not a valid GeoJSON object.");for(c=0;c<e.geometry.geometries.length;c++)tt(t,{id:u,geometry:e.geometry.geometries[c],properties:e.properties},r,n);return}for(c=0;c<i.length;c++){var l=[];nt(i[c],l,a,!0),s.push(l)}}t.push(J(u,o,s,e.properties))}}function et(t,e){e.push(it(t[0])),e.push(ot(t[1])),e.push(0)}function rt(t,e,r,n){for(var i,o,a=0,s=0;s<t.length;s++){var u=it(t[s][0]),c=ot(t[s][1]);e.push(u),e.push(c),e.push(0),0<s&&(a+=n?(i*c-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(c-o,2))),i=u,o=c}var l=e.length-3;e[2]=1,function t(e,r,n,i){for(var o,a=i,s=n-r>>1,u=n-r,c=e[r],l=e[r+1],h=e[n],p=e[n+1],f=r+3;f<n;f+=3){var d=K(e[f],e[f+1],c,l,h,p);if(a<d)o=f,a=d;else if(d===a){var m=Math.abs(f-s);m<u&&(o=f,u=m)}}i<a&&(3<o-r&&t(e,r,o,i),e[o+2]=a,3<n-o&&t(e,o,n,i))}(e,0,l,r),e[2+l]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function nt(t,e,r,n){for(var i=0;i<t.length;i++){var o=[];rt(t[i],o,r,n),e.push(o)}}function it(t){return t/360+.5}function ot(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:1<r?1:r}function at(t,e,r,n,i,o,a,s){if(n/=e,o>=(r/=e)&&a<n)return t;if(a<r||n<=o)return null;for(var u=[],c=0;c<t.length;c++){var l=t[c],h=l.geometry,p=l.type,f=0===i?l.minX:l.minY,d=0===i?l.maxX:l.maxY;if(r<=f&&d<n)u.push(l);else if(!(d<r||n<=f)){var m=[];if("Point"===p||"MultiPoint"===p)st(h,m,r,n,i);else if("LineString"===p)ut(h,m,r,n,i,!1,s.lineMetrics);else if("MultiLineString"===p)lt(h,m,r,n,i,!1);else if("Polygon"===p)lt(h,m,r,n,i,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var y=[];lt(h[g],y,r,n,i,!0),y.length&&m.push(y)}if(m.length){if(s.lineMetrics&&"LineString"===p){for(g=0;g<m.length;g++)u.push(J(l.id,p,m[g],l.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),u.push(J(l.id,p,m,l.tags))}}}return u.length?u:null}function st(t,e,r,n,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];r<=a&&a<=n&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function ut(t,e,r,n,i,o,a){for(var s,u,c=ct(t),l=0===i?pt:ft,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],m=t[p+2],g=t[p+3],y=t[p+4],v=0===i?f:d,_=0===i?g:y,b=!1;a&&(s=Math.sqrt(Math.pow(f-g,2)+Math.pow(d-y,2))),v<r?r<_&&(u=l(c,f,d,g,y,r),a&&(c.start=h+s*u)):n<v?_<n&&(u=l(c,f,d,g,y,n),a&&(c.start=h+s*u)):ht(c,f,d,m),_<r&&r<=v&&(u=l(c,f,d,g,y,r),b=!0),n<_&&v<=n&&(u=l(c,f,d,g,y,n),b=!0),!o&&b&&(a&&(c.end=h+s*u),e.push(c),c=ct(t)),a&&(h+=s)}var x=t.length-3;f=t[x],d=t[x+1],m=t[x+2],(v=0===i?f:d)>=r&&v<=n&&ht(c,f,d,m),x=c.length-3,o&&3<=x&&(c[x]!==c[0]||c[x+1]!==c[1])&&ht(c,c[0],c[1],c[2]),c.length&&e.push(c)}function ct(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function lt(t,e,r,n,i,o){for(var a=0;a<t.length;a++)ut(t[a],e,r,n,i,o,!1)}function ht(t,e,r,n){t.push(e),t.push(r),t.push(n)}function pt(t,e,r,n,i,o){var a=(o-e)/(n-e);return t.push(o),t.push(r+(i-r)*a),t.push(1),a}function ft(t,e,r,n,i,o){var a=(o-r)/(i-r);return t.push(e+(n-e)*a),t.push(o),t.push(1),a}function dt(t,e){for(var r=[],n=0;n<t.length;n++){var i,o=t[n],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=mt(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(mt(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],c=0;c<o.geometry[s].length;c++)u.push(mt(o.geometry[s][c],e));i.push(u)}r.push(J(o.id,a,i,o.tags))}return r}function mt(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var n=0;n<t.length;n+=3)r.push(t[n]+e,t[n+1],t[n+2]);return r}function gt(t,e){if(t.transformed)return t;var r,n,i,o=1<<t.z,a=t.x,s=t.y;for(r=0;r<t.features.length;r++){var u=t.features[r],c=u.geometry,l=u.type;if(u.geometry=[],1===l)for(n=0;n<c.length;n+=2)u.geometry.push(yt(c[n],c[n+1],e,o,a,s));else for(n=0;n<c.length;n++){var h=[];for(i=0;i<c[n].length;i+=2)h.push(yt(c[n][i],c[n][i+1],e,o,a,s));u.geometry.push(h)}}return t.transformed=!0,t}function yt(t,e,r,n,i,o){return[Math.round(r*(t*n-i)),Math.round(r*(e*n-o))]}function vt(t,e,r,n,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,_t(a,t[s],o,i);var u=t[s].minX,c=t[s].minY,l=t[s].maxX,h=t[s].maxY;u<a.minX&&(a.minX=u),c<a.minY&&(a.minY=c),l>a.maxX&&(a.maxX=l),h>a.maxY&&(a.maxY=h)}return a}function _t(t,e,r,n){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)bt(a,i,t,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)bt(a,i[s],t,r,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var c=i[u];for(s=0;s<c.length;s++)bt(a,c[s],t,r,!0,0===s)}if(a.length){var l=e.tags||null;if("LineString"===o&&n.lineMetrics){for(var h in l={},e.tags)l[h]=e.tags[h];l.mapbox_clip_start=i.start/i.size,l.mapbox_clip_end=i.end/i.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:l};null!==e.id&&(p.id=e.id),t.features.push(p)}}function bt(t,e,r,n,i,o){var a=n*n;if(0<n&&e.size<(i?a:n))r.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===n||e[u+2]>a)&&(r.numSimplified++,s.push(e[u]),s.push(e[u+1])),r.numPoints++;i&&function(t,e){for(var r=0,n=0,i=t.length,o=i-2;n<i;o=n,n+=2)r+=(t[n]-t[o])*(t[n+1]+t[o+1]);if(0<r===e)for(n=0,i=t.length;n<i/2;n+=2){var a=t[n],s=t[n+1];t[n]=t[i-2-n],t[n+1]=t[i-1-n],t[i-2-n]=a,t[i-1-n]=s}}(s,o),t.push(s)}}function xt(t,e){var r=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||24<e.maxZoom)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var n,i,o,a,s,u,c=function(t,e){var r=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)tt(r,t.features[n],e,n);else tt(r,"Feature"===t.type?t:{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=c,o=(i=e).buffer/i.extent,s=at(a=n,1,-1-o,o,0,-1,2,i),u=at(n,1,1-o,2+o,0,-1,2,i),(s||u)&&(a=at(n,1,-o,1+o,0,-1,2,i)||[],s&&(a=dt(s,1).concat(a)),u&&(a=a.concat(dt(u,-1)))),c=a).length&&this.splitTile(c,0,0,0),r&&(c.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function wt(t,e,r){return 32*((1<<t)*r+e)+t}function St(t,e){var r=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return e(null,null);var i=new _(n.features),o=S(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:i,rawData:o.buffer})}V.prototype.load=function(t){var e=this.options,r=e.log,n=e.minZoom,i=e.maxZoom,o=e.nodeSize;r&&console.time("total time");var a,s,u,c,l="prepare "+t.length+" points";r&&console.time(l),this.points=t;for(var h=[],p=0;p<t.length;p++)t[p].geometry&&h.push((a=t[p],s=p,void 0,u=a.geometry.coordinates,c=u[1],{x:$(u[0]),y:W(c),zoom:1/0,index:s,parentId:-1}));this.trees[i+1]=new U(h,Y,Z,o,Float32Array),r&&console.timeEnd(l);for(var f=i;n<=f;f--){var d=+Date.now();h=this._cluster(h,f),this.trees[f]=new U(h,Y,Z,o,Float32Array),r&&console.log("z%d: %d clusters in %dms",f,h.length,+Date.now()-d)}return r&&console.timeEnd("total time"),this},V.prototype.getClusters=function(t,e){var r=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(360<=t[2]-t[0])r=-180,i=180;else if(i<r){var a=this.getClusters([r,n,180,o],e),s=this.getClusters([-180,n,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],c=[],l=0,h=u.range($(r),W(o),$(i),W(n));l<h.length;l+=1){var p=u.points[h[l]];c.push(p.numPoints?q(p):this.points[p.index])}return c},V.prototype.getChildren=function(t){var e=this._getOriginId(t),r=this._getOriginZoom(t),n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);var o=i.points[e];if(!o)throw new Error(n);for(var a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=[],u=0,c=i.within(o.x,o.y,a);u<c.length;u+=1){var l=i.points[c[u]];l.parentId===t&&s.push(l.numPoints?q(l):this.points[l.index])}if(0===s.length)throw new Error(n);return s},V.prototype.getLeaves=function(t,e,r){var n=[];return this._appendLeaves(n,t,e=e||10,r=r||0,0),n},V.prototype.getTile=function(t,e,r){var n=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.radius/o.extent,s=(r-a)/i,u=(r+1+a)/i,c={features:[]};return this._addTileFeatures(n.range((e-a)/i,s,(e+1+a)/i,u),n.points,e,r,i,c),0===e&&this._addTileFeatures(n.range(1-a/i,s,1,u),n.points,i,r,i,c),e===i-1&&this._addTileFeatures(n.range(0,s,a/i,u),n.points,-1,r,i,c),c.features.length?c:null},V.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var r=this.getChildren(t);if(e++,1!==r.length)break;t=r[0].properties.cluster_id}return e},V.prototype._appendLeaves=function(t,e,r,n,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=n?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,r,n,i):i<n?i++:t.push(s),t.length===r)break}return i},V.prototype._addTileFeatures=function(t,e,r,n,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=e[s[a]],c=u.numPoints,l={type:1,geometry:[[Math.round(this.options.extent*(u.x*i-r)),Math.round(this.options.extent*(u.y*i-n))]],tags:c?H(u):this.points[u.index].properties},h=void 0;c?h=u.id:this.options.generateId?h=u.index:this.points[u.index].id&&(h=this.points[u.index].id),void 0!==h&&(l.id=h),o.features.push(l)}},V.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},V.prototype._cluster=function(t,e){for(var r=[],n=this.options,i=n.reduce,o=n.radius/(n.extent*Math.pow(2,e)),a=0;a<t.length;a++){var s=t[a];if(!(s.zoom<=e)){s.zoom=e;for(var u=this.trees[e+1],c=u.within(s.x,s.y,o),l=s.numPoints||1,h=s.x*l,p=s.y*l,f=i&&1<l?this._map(s,!0):null,d=(a<<5)+(e+1)+this.points.length,m=0,g=c;m<g.length;m+=1){var y=u.points[g[m]];if(!(y.zoom<=e)){y.zoom=e;var v=y.numPoints||1;h+=y.x*v,p+=y.y*v,l+=v,y.parentId=d,i&&i(f=f||this._map(s,!0),this._map(y))}}1===l?r.push(s):(s.parentId=d,r.push({x:h/l,y:p/l,zoom:1/0,id:d,parentId:-1,numPoints:l,properties:f}))}}return r},V.prototype._getOriginId=function(t){return t-this.points.length>>5},V.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},xt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!(V.prototype._map=function(t,e){if(t.numPoints)return e?X({},t.properties):t.properties;var r=this.points[t.index].properties,n=this.options.map(r);return e&&n===r?X({},n):n}),promoteId:null,generateId:!1,debug:0},xt.prototype.splitTile=function(t,e,r,n,i,o,a){for(var s=[t,e,r,n],u=this.options,c=u.debug;s.length;){n=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var l=1<<e,h=wt(e,r,n),p=this.tiles[h];if(!p&&(1<c&&console.time("creation"),p=this.tiles[h]=vt(t,e,r,n,u),this.tileCoords.push({z:e,x:r,y:n}),c)){1<c&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,i){if(e===u.maxZoom||e===i)continue;var d=1<<i-e;if(r!==Math.floor(o/d)||n!==Math.floor(a/d))continue}else if(e===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==t.length){1<c&&console.time("clipping");var m,g,y,v,_,b,x=.5*u.buffer/u.extent,w=.5-x,S=.5+x,E=1+x;m=g=y=v=null,_=at(t,l,r-x,r+S,0,p.minX,p.maxX,u),b=at(t,l,r+w,r+E,0,p.minX,p.maxX,u),t=null,_&&(m=at(_,l,n-x,n+S,1,p.minY,p.maxY,u),g=at(_,l,n+w,n+E,1,p.minY,p.maxY,u),_=null),b&&(y=at(b,l,n-x,n+S,1,p.minY,p.maxY,u),v=at(b,l,n+w,n+E,1,p.minY,p.maxY,u),b=null),1<c&&console.timeEnd("clipping"),s.push(m||[],e+1,2*r,2*n),s.push(g||[],e+1,2*r,2*n+1),s.push(y||[],e+1,2*r+1,2*n),s.push(v||[],e+1,2*r+1,2*n+1)}}},xt.prototype.getTile=function(t,e,r){var n=this.options,i=n.extent,o=n.debug;if(t<0||24<t)return null;var a=1<<t,s=wt(t,e=(e%a+a)%a,r);if(this.tiles[s])return gt(this.tiles[s],i);1<o&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var u,c=t,l=e,h=r;!u&&0<c;)c--,l=Math.floor(l/2),h=Math.floor(h/2),u=this.tiles[wt(c,l,h)];return u&&u.source?(1<o&&console.log("found parent tile z%d-%d-%d",c,l,h),1<o&&console.time("drilling down"),this.splitTile(u.source,c,l,h,t,e,r),1<o&&console.timeEnd("drilling down"),this.tiles[s]?gt(this.tiles[s],i):null):null};function Et(t){var r=this;this.self=t,this.actor=new A.Actor(t,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:n,geojson:Mt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(r.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');r.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(t){if(A.plugin.isParsed())throw new Error("RTL text plugin already registered.");A.plugin.applyArabicShaping=t.applyArabicShaping,A.plugin.processBidirectionalText=t.processBidirectionalText,A.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}}var Ct,Mt=((Ct=n)&&(Tt.__proto__=Ct),((Tt.prototype=Object.create(Ct&&Ct.prototype)).constructor=Tt).prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},Tt.prototype._loadData=function(){var i=this;if(this._pendingCallback&&this._pendingLoadDataParams){var o=this._pendingCallback,a=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var s=!!(a&&a.request&&a.request.collectResourceTiming)&&new A.RequestPerformance(a.request);this.loadGeoJSON(a,function(t,e){if(t||!e)return o(t);if("object"!=typeof e)return o(new Error("Input data given to '"+a.source+"' is not a valid GeoJSON object."));!function t(e,r){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(f(t,r)),e;case"GeometryCollection":return e.geometries=e.geometries.map(f(t,r)),e;case"Feature":return e.geometry=t(e.geometry,r),e;case"Polygon":case"MultiPolygon":return i=r,"Polygon"===(n=e).type?n.coordinates=d(n.coordinates,i):"MultiPolygon"===n.type&&(n.coordinates=n.coordinates.map(f(d,i))),n;default:return e}var n,i}(e,!0);try{i._geoJSONIndex=a.cluster?new V(function(t){var e=t.superclusterOptions,r=t.clusterProperties;if(!r||!e)return e;for(var o={},a={},s={accumulated:null,zoom:0},u={properties:null},c=Object.keys(r),n=0,i=c;n<i.length;n+=1){var l=i[n],h=r[l],p=h[0],f=A.createExpression(h[1]),d=A.createExpression("string"==typeof p?[p,["accumulated"],["get",l]]:p);o[l]=f.value,a[l]=d.value}return e.map=function(t){u.properties=t;for(var e={},r=0,n=c;r<n.length;r+=1){var i=n[r];e[i]=o[i].evaluate(s,u)}return e},e.reduce=function(t,e){u.properties=e;for(var r=0,n=c;r<n.length;r+=1){var i=n[r];s.accumulated=t[i],t[i]=a[i].evaluate(s,u)}},e}(a)).load(e.features):new xt(e,a.geojsonVtOptions)}catch(t){return o(t)}i.loaded={};var r={};if(s){var n=s.finish();n&&(r.resourceTiming={},r.resourceTiming[a.source]=JSON.parse(JSON.stringify(n)))}o(null,r)})}},Tt.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},Tt.prototype.reloadTile=function(t,e){var r=this.loaded;return r&&r[t.uid]?Ct.prototype.reloadTile.call(this,t,e):this.loadTile(t,e)},Tt.prototype.loadGeoJSON=function(e,r){if(e.request)A.getJSON(e.request,r);else{if("string"!=typeof e.data)return r(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."));try{return r(null,JSON.parse(e.data))}catch(t){return r(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."))}}},Tt.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},Tt.prototype.getClusterExpansionZoom=function(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}},Tt.prototype.getClusterChildren=function(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}},Tt.prototype.getClusterLeaves=function(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}},Tt);function Tt(t,e,r,n){Ct.call(this,t,e,r,St),n&&(this.loadGeoJSON=n)}return Et.prototype.setReferrer=function(t,e){this.referrer=e},Et.prototype.setImages=function(t,e,r){this.availableImages[t]=e,r()},Et.prototype.setLayers=function(t,e,r){this.getLayerIndex(t).replace(e),r()},Et.prototype.updateLayers=function(t,e,r){this.getLayerIndex(t).update(e.layers,e.removedIds),r()},Et.prototype.loadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).loadTile(e,r)},Et.prototype.loadDEMTile=function(t,e,r){this.getDEMWorkerSource(t,e.source).loadTile(e,r)},Et.prototype.reloadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).reloadTile(e,r)},Et.prototype.abortTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).abortTile(e,r)},Et.prototype.removeTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).removeTile(e,r)},Et.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},Et.prototype.removeSource=function(t,e,r){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var n=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==n.removeSource?n.removeSource(e,r):r()}},Et.prototype.loadWorkerSource=function(t,e,r){try{this.self.importScripts(e.url),r()}catch(t){r(t.toString())}},Et.prototype.syncRTLPluginState=function(t,e,r){try{A.plugin.setState(e);var n=A.plugin.getPluginURL();if(A.plugin.isLoaded()&&!A.plugin.isParsed()&&null!=n){this.self.importScripts(n);var i=A.plugin.isParsed();r(i?void 0:new Error("RTL Text Plugin failed to import scripts from "+n),i)}}catch(t){r(t.toString())}},Et.prototype.getAvailableImages=function(t){var e=this.availableImages[t];return e=e||[]},Et.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e=e||(this.layerIndexes[t]=new r)},Et.prototype.getWorkerSource=function(n,t,e){var i=this;return this.workerSources[n]||(this.workerSources[n]={}),this.workerSources[n][t]||(this.workerSources[n][t]={}),this.workerSources[n][t][e]||(this.workerSources[n][t][e]=new this.workerSourceTypes[t]({send:function(t,e,r){i.actor.send(t,e,r,n)}},this.getLayerIndex(n),this.getAvailableImages(n))),this.workerSources[n][t][e]},Et.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new o),this.demWorkerSources[t][e]},Et.prototype.enforceCacheSizeLimit=function(t,e){A.enforceCacheSizeLimit(e)},"undefined"!=typeof WorkerGlobalScope&&void 0!==A.window&&A.window instanceof WorkerGlobalScope&&(A.window.worker=new Et(A.window)),Et}),t(0,function(vt){var r=vt.createCommonjsModule(function(t){function o(t){return!!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,r=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(r);try{e=new Worker(n),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(n),t}()&&"Uint8ClampedArray"in window&&ArrayBuffer.isView&&(i=t&&t.failIfMajorPerformanceCaveat,void 0===a[i]&&(a[i]=(e=i,r=document.createElement("canvas"),(n=Object.create(o.webGLContextAttributes)).failIfMajorPerformanceCaveat=e,r.probablySupportsContext?r.probablySupportsContext("webgl",n)||r.probablySupportsContext("experimental-webgl",n):r.supportsContext?r.supportsContext("webgl",n)||r.supportsContext("experimental-webgl",n):r.getContext("webgl",n)||r.getContext("experimental-webgl",n))),a[i]));var e,r,n,i}t.exports?t.exports=o:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=o);var a={};o.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),_={create:function(t,e,r){var n=vt.window.document.createElement(t);return void 0!==e&&(n.className=e),r&&r.appendChild(n),n},createNS:function(t,e){return vt.window.document.createElementNS(t,e)}},n=vt.window.document.documentElement.style;function t(t){if(!n)return t[0];for(var e=0;e<t.length;e++)if(t[e]in n)return t[e];return t[0]}var e,i=t(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);_.disableDrag=function(){n&&i&&(e=n[i],n[i]="none")},_.enableDrag=function(){n&&i&&(n[i]=e)};var o=t(["transform","WebkitTransform"]),a=!(_.setTransform=function(t,e){t.style[o]=e});try{var s=Object.defineProperty({},"passive",{get:function(){a=!0}});vt.window.addEventListener("test",s,s),vt.window.removeEventListener("test",s,s)}catch(vt){a=!1}_.addEventListener=function(t,e,r,n){void 0===n&&(n={}),t.addEventListener(e,r,"passive"in n&&a?n:n.capture)},_.removeEventListener=function(t,e,r,n){void 0===n&&(n={}),t.removeEventListener(e,r,"passive"in n&&a?n:n.capture)};var u=function(t){t.preventDefault(),t.stopPropagation(),vt.window.removeEventListener("click",u,!0)};_.suppressClick=function(){vt.window.addEventListener("click",u,!0),vt.window.setTimeout(function(){vt.window.removeEventListener("click",u,!0)},0)},_.mousePos=function(t,e){var r=t.getBoundingClientRect(),n=vt.window.TouchEvent&&e instanceof vt.window.TouchEvent?e.touches[0]:e;return new vt.Point(n.clientX-r.left-t.clientLeft,n.clientY-r.top-t.clientTop)},_.touchPos=function(t,e){for(var r=t.getBoundingClientRect(),n=[],i="touchend"===e.type?e.changedTouches:e.touches,o=0;o<i.length;o++)n.push(new vt.Point(i[o].clientX-r.left-t.clientLeft,i[o].clientY-r.top-t.clientTop));return n},_.mouseButton=function(t){return void 0!==vt.window.InstallTrigger&&2===t.button&&t.ctrlKey&&0<=vt.window.navigator.platform.toUpperCase().indexOf("MAC")?0:t.button},_.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var c,l=((c=vt.Evented)&&(d.__proto__=c),((d.prototype=Object.create(c&&c.prototype)).constructor=d).prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t)){for(var e=0,r=this.requestors;e<r.length;e+=1){var n=r[e];this._notify(n.ids,n.callback)}this.requestors=[]}},d.prototype.getImage=function(t){return this.images[t]},d.prototype.addImage=function(t,e){this._validate(t,e)&&(this.images[t]=e)},d.prototype._validate=function(t,e){var r=!0;return this._validateStretch(e.stretchX,e.data&&e.data.width)||(this.fire(new vt.ErrorEvent(new Error('Image "'+t+'" has invalid "stretchX" value'))),r=!1),this._validateStretch(e.stretchY,e.data&&e.data.height)||(this.fire(new vt.ErrorEvent(new Error('Image "'+t+'" has invalid "stretchY" value'))),r=!1),this._validateContent(e.content,e)||(this.fire(new vt.ErrorEvent(new Error('Image "'+t+'" has invalid "content" value'))),r=!1),r},d.prototype._validateStretch=function(t,e){if(!t)return!0;for(var r=0,n=0,i=t;n<i.length;n+=1){var o=i[n];if(o[0]<r||o[1]<o[0]||e<o[1])return!1;r=o[1]}return!0},d.prototype._validateContent=function(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))},d.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0},d.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(t,e){var r=!0;if(!this.isLoaded())for(var n=0,i=t;n<i.length;n+=1)this.images[i[n]]||(r=!1);this.isLoaded()||r?this._notify(t,e):this.requestors.push({ids:t,callback:e})},d.prototype._notify=function(t,e){for(var r={},n=0,i=t;n<i.length;n+=1){var o=i[n];this.images[o]||this.fire(new vt.Event("styleimagemissing",{id:o}));var a=this.images[o];a?r[o]={data:a.data.clone(),pixelRatio:a.pixelRatio,sdf:a.sdf,version:a.version,stretchX:a.stretchX,stretchY:a.stretchY,content:a.content,hasRenderCallback:Boolean(a.userImage&&a.userImage.render)}:vt.warnOnce('Image "'+o+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}e(null,r)},d.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},d.prototype.getPattern=function(t){var e=this.patterns[t],r=this.getImage(t);if(!r)return null;if(e&&e.position.version===r.version)return e.position;if(e)e.position.version=r.version;else{var n={w:r.data.width+2,h:r.data.height+2,x:0,y:0},i=new vt.ImagePosition(n,r);this.patterns[t]={bin:n,position:i}}return this._updatePatternAtlas(),this.patterns[t].position},d.prototype.bind=function(t){var e=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new vt.Texture(t,this.atlasImage,e.RGBA),this.atlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var t=[];for(var e in this.patterns)t.push(this.patterns[e].bin);var r=vt.potpack(t),n=r.w,i=r.h,o=this.atlasImage;for(var a in o.resize({width:n||1,height:i||1}),this.patterns){var s=this.patterns[a].bin,u=s.x+1,c=s.y+1,l=this.images[a].data,h=l.width,p=l.height;vt.RGBAImage.copy(l,o,{x:0,y:0},{x:u,y:c},{width:h,height:p}),vt.RGBAImage.copy(l,o,{x:0,y:p-1},{x:u,y:c-1},{width:h,height:1}),vt.RGBAImage.copy(l,o,{x:0,y:0},{x:u,y:c+p},{width:h,height:1}),vt.RGBAImage.copy(l,o,{x:h-1,y:0},{x:u-1,y:c},{width:1,height:p}),vt.RGBAImage.copy(l,o,{x:0,y:0},{x:u+h,y:c},{width:1,height:p})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(t){for(var e=0,r=t;e<r.length;e+=1){var n=r[e];if(!this.callbackDispatchedThisFrame[n]){this.callbackDispatchedThisFrame[n]=!0;var i=this.images[n];a=void 0,(a=(o=i).userImage)&&a.render&&a.render()&&(o.data.replace(new Uint8Array(a.data.buffer)),1)&&this.updateImage(n,i)}}var o,a},d),h=m,p=m,f=1e20;function d(){c.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new vt.RGBAImage({width:1,height:1}),this.dirty=!0}function m(t,e,r,n,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=n||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=r||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(0<=navigator.userAgent.indexOf("Gecko/")?1.2:1))}function g(t,e,r,n,i,o,a){for(var s=0;s<e;s++){for(var u=0;u<r;u++)n[u]=t[u*e+s];for(y(n,i,o,a,r),u=0;u<r;u++)t[u*e+s]=i[u]}for(u=0;u<r;u++){for(s=0;s<e;s++)n[s]=t[u*e+s];for(y(n,i,o,a,e),s=0;s<e;s++)t[u*e+s]=Math.sqrt(i[s])}}function y(t,e,r,n,i){n[r[0]=0]=-f,n[1]=+f;for(var o=1,a=0;o<i;o++){for(var s=(t[o]+o*o-(t[r[a]]+r[a]*r[a]))/(2*o-2*r[a]);s<=n[a];)s=(t[o]+o*o-(t[r[--a]]+r[a]*r[a]))/(2*o-2*r[a]);r[++a]=o,n[a]=s,n[a+1]=+f}for(a=o=0;o<i;o++){for(;n[a+1]<o;)a++;e[o]=(o-r[a])*(o-r[a])+t[r[a]]}}m.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),r=new Uint8ClampedArray(this.size*this.size),n=0;n<this.size*this.size;n++){var i=e.data[4*n+3]/255;this.gridOuter[n]=1==i?0:0==i?f:Math.pow(Math.max(0,.5-i),2),this.gridInner[n]=1==i?f:0==i?0:Math.pow(Math.max(0,i-.5),2)}for(g(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),g(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),n=0;n<this.size*this.size;n++)r[n]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[n]-this.gridInner[n])/this.radius+this.cutoff))));return r},h.default=p;function v(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}}v.prototype.setURL=function(t){this.url=t},v.prototype.getGlyphs=function(t,c){var u=this,e=[];for(var r in t)for(var n=0,i=t[r];n<i.length;n+=1)e.push({stack:r,id:i[n]});vt.asyncAll(e,function(t,r){var n=t.stack,i=t.id,o=u.entries[n],e=(o=o||(u.entries[n]={glyphs:{},requests:{}})).glyphs[i];if(void 0===e){if(e=u._tinySDF(o,n,i))return o.glyphs[i]=e,void r(null,{stack:n,id:i,glyph:e});var a=Math.floor(i/256);if(65535<256*a)r(new Error("glyphs > 65535 not supported"));else{var s=o.requests[a];s||(s=o.requests[a]=[],v.loadGlyphRange(n,a,u.url,u.requestManager,function(t,e){if(e)for(var r in e)u._doesCharSupportLocalGlyph(+r)||(o.glyphs[+r]=e[+r]);for(var n=0,i=s;n<i.length;n+=1)(0,i[n])(t,e);delete o.requests[a]})),s.push(function(t,e){t?r(t):e&&r(null,{stack:n,id:i,glyph:e[i]||null})})}}else r(null,{stack:n,id:i,glyph:e})},function(t,e){if(t)c(t);else if(e){for(var r={},n=0,i=e;n<i.length;n+=1){var o=i[n],a=o.stack,s=o.id,u=o.glyph;(r[a]||(r[a]={}))[s]=u&&{id:u.id,bitmap:u.bitmap.clone(),metrics:u.metrics}}c(null,r)}})},v.prototype._doesCharSupportLocalGlyph=function(t){return!!this.localIdeographFontFamily&&(vt.isChar["CJK Unified Ideographs"](t)||vt.isChar["Hangul Syllables"](t)||vt.isChar.Hiragana(t)||vt.isChar.Katakana(t))},v.prototype._tinySDF=function(t,e,r){var n=this.localIdeographFontFamily;if(n&&this._doesCharSupportLocalGlyph(r)){var i=t.tinySDF;if(!i){var o="400";/bold/i.test(e)?o="900":/medium/i.test(e)?o="500":/light/i.test(e)&&(o="200"),i=t.tinySDF=new v.TinySDF(24,3,8,.25,n,o)}return{id:r,bitmap:new vt.AlphaImage({width:30,height:30},i.draw(String.fromCharCode(r))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},v.loadGlyphRange=function(t,e,r,n,a){var i=256*e,o=255+i,s=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",i+"-"+o),vt.ResourceType.Glyphs);vt.getArrayBuffer(s,function(t,e){if(t)a(t);else if(e){for(var r={},n=0,i=vt.parseGlyphPBF(e);n<i.length;n+=1){var o=i[n];r[o.id]=o}a(null,r)}})},v.TinySDF=h;function b(){this.specification=vt.styleSpec.light.position}b.prototype.possiblyEvaluate=function(t,e){return vt.sphericalToCartesian(t.expression.evaluate(e))},b.prototype.interpolate=function(t,e,r){return{x:vt.number(t.x,e.x,r),y:vt.number(t.y,e.y,r),z:vt.number(t.z,e.z,r)}};function x(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}var w,S=new vt.Properties({anchor:new vt.DataConstantProperty(vt.styleSpec.light.anchor),position:new b,color:new vt.DataConstantProperty(vt.styleSpec.light.color),intensity:new vt.DataConstantProperty(vt.styleSpec.light.intensity)}),E=((w=vt.Evented)&&(C.__proto__=w),((C.prototype=Object.create(w&&w.prototype)).constructor=C).prototype.getLight=function(){return this._transitionable.serialize()},C.prototype.setLight=function(t,e){if(void 0===e&&(e={}),!this._validate(vt.validateLight,t,e))for(var r in t){var n=t[r];vt.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-"-transition".length),n):this._transitionable.setValue(r,n)}},C.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},C.prototype.hasTransition=function(){return this._transitioning.hasTransition()},C.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},C.prototype._validate=function(t,e,r){return(!r||!1!==r.validate)&&vt.emitValidationErrors(this,t.call(vt.validateStyle,vt.extend({value:e,style:{glyphs:!0,sprite:!0},styleSpec:vt.styleSpec})))},C);function C(t){w.call(this),this._transitionable=new vt.Transitionable(S),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}x.prototype.getDash=function(t,e){var r=t.join(",")+String(e);return this.dashEntry[r]||(this.dashEntry[r]=this.addDash(t,e)),this.dashEntry[r]},x.prototype.getDashRanges=function(t,e,r){var n=[],i=t.length%2==1?-t[t.length-1]*r:0,o=t[0]*r,a=!0;n.push({left:i,right:o,isDash:a,zeroLength:0===t[0]});for(var s=t[0],u=1;u<t.length;u++){var c=t[u];n.push({left:i=s*r,right:o=(s+=c)*r,isDash:a=!a,zeroLength:0===c})}return n},x.prototype.addRoundDash=function(t,e,r){for(var n=e/2,i=-r;i<=r;i++)for(var o=this.width*(this.nextRow+r+i),a=0,s=t[a],u=0;u<this.width;u++){1<u/s.right&&(s=t[++a]);var c=Math.abs(u-s.left),l=Math.abs(u-s.right),h=Math.min(c,l),p=void 0,f=i/r*(1+n);if(s.isDash){var d=n-Math.abs(f);p=Math.sqrt(h*h+d*d)}else p=n-Math.sqrt(h*h+f*f);this.data[o+u]=Math.max(0,Math.min(255,p+128))}},x.prototype.addRegularDash=function(t){for(var e=t.length-1;0<=e;--e){var r=t[e],n=t[e+1];r.zeroLength?t.splice(e,1):n&&n.isDash===r.isDash&&(n.left=r.left,t.splice(e,1))}var i=t[0],o=t[t.length-1];i.isDash===o.isDash&&(i.left=o.left-this.width,o.right=i.right+this.width);for(var a=this.width*this.nextRow,s=0,u=t[s],c=0;c<this.width;c++){1<c/u.right&&(u=t[++s]);var l=Math.abs(c-u.left),h=Math.abs(c-u.right),p=Math.min(l,h);this.data[a+c]=Math.max(0,Math.min(255,(u.isDash?p:-p)+128))}},x.prototype.addDash=function(t,e){var r=e?7:0,n=2*r+1;if(this.nextRow+n>this.height)return vt.warnOnce("LineAtlas out of space"),null;for(var i=0,o=0;o<t.length;o++)i+=t[o];if(0!==i){var a=this.width/i,s=this.getDashRanges(t,this.width,a);e?this.addRoundDash(s,a,r):this.addRegularDash(s)}var u={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:i};return this.nextRow+=n,this.dirty=!0,u},x.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))};function M(t,e){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=vt.uniqueId();for(var r=this.workerPool.acquire(this.id),n=0;n<r.length;n++){var i=new M.Actor(r[n],e,this.id);i.name="Worker "+n,this.actors.push(i)}}function T(n,i,o){function t(t,e){if(t)return o(t);if(e){var r=vt.pick(vt.extend(e,n),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);e.vector_layers&&(r.vectorLayers=e.vector_layers,r.vectorLayerIds=r.vectorLayers.map(function(t){return t.id})),r.tiles=i.canonicalizeTileset(r,n.url),o(null,r)}}return n.url?vt.getJSON(i.transformRequest(i.normalizeSourceURL(n.url),vt.ResourceType.Source),t):vt.browser.frame(function(){return t(null,n)})}M.prototype.broadcast=function(r,n,t){vt.asyncAll(this.actors,function(t,e){t.send(r,n,e)},t=t||function(){})},M.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},M.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},M.Actor=vt.Actor;function P(t,e,r){this.bounds=vt.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=r||24}P.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},P.prototype.contains=function(t){var e=Math.pow(2,t.z),r=Math.floor(vt.mercatorXfromLng(this.bounds.getWest())*e),n=Math.floor(vt.mercatorYfromLat(this.bounds.getNorth())*e),i=Math.ceil(vt.mercatorXfromLng(this.bounds.getEast())*e),o=Math.ceil(vt.mercatorYfromLat(this.bounds.getSouth())*e);return t.x>=r&&t.x<i&&t.y>=n&&t.y<o};var O,A,I,L,R,N,k,D=((k=vt.Evented)&&(K.__proto__=k),((K.prototype=Object.create(k&&k.prototype)).constructor=K).prototype.load=function(){var r=this;this._loaded=!1,this.fire(new vt.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,function(t,e){r._tileJSONRequest=null,r._loaded=!0,t?r.fire(new vt.ErrorEvent(t)):e&&(vt.extend(r,e),e.bounds&&(r.tileBounds=new P(e.bounds,r.minzoom,r.maxzoom)),vt.postTurnstileEvent(e.tiles,r.map._requestManager._customAccessToken),vt.postMapLoadEvent(e.tiles,r.map._getMapId(),r.map._requestManager._skuToken,r.map._requestManager._customAccessToken),r.fire(new vt.Event("data",{dataType:"source",sourceDataType:"metadata"})),r.fire(new vt.Event("data",{dataType:"source",sourceDataType:"content"})))})},K.prototype.loaded=function(){return this._loaded},K.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},K.prototype.onAdd=function(t){this.map=t,this.load()},K.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},K.prototype.serialize=function(){return vt.extend({},this._options)},K.prototype.loadTile=function(r,n){var t=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),e={request:this.map._requestManager.transformRequest(t,vt.ResourceType.Tile),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:vt.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function i(t,e){return delete r.request,r.aborted?n(null):t&&404!==t.status?n(t):(e&&e.resourceTiming&&(r.resourceTiming=e.resourceTiming),this.map._refreshExpiredTiles&&e&&r.setExpiryData(e),r.loadVectorData(e,this.map.painter),vt.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}e.request.collectResourceTiming=this._collectResourceTiming,r.actor&&"expired"!==r.state?"loading"===r.state?r.reloadCallback=n:r.request=r.actor.send("reloadTile",e,i.bind(this)):(r.actor=this.dispatcher.getActor(),r.request=r.actor.send("loadTile",e,i.bind(this)))},K.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)},K.prototype.unloadTile=function(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)},K.prototype.hasTransition=function(){return!1},K),j=((N=vt.Evented)&&(Z.__proto__=N),((Z.prototype=Object.create(N&&N.prototype)).constructor=Z).prototype.load=function(){var r=this;this._loaded=!1,this.fire(new vt.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,function(t,e){r._tileJSONRequest=null,r._loaded=!0,t?r.fire(new vt.ErrorEvent(t)):e&&(vt.extend(r,e),e.bounds&&(r.tileBounds=new P(e.bounds,r.minzoom,r.maxzoom)),vt.postTurnstileEvent(e.tiles),vt.postMapLoadEvent(e.tiles,r.map._getMapId(),r.map._requestManager._skuToken),r.fire(new vt.Event("data",{dataType:"source",sourceDataType:"metadata"})),r.fire(new vt.Event("data",{dataType:"source",sourceDataType:"content"})))})},Z.prototype.loaded=function(){return this._loaded},Z.prototype.onAdd=function(t){this.map=t,this.load()},Z.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},Z.prototype.serialize=function(){return vt.extend({},this._options)},Z.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},Z.prototype.loadTile=function(i,o){var a=this,t=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);i.request=vt.getImage(this.map._requestManager.transformRequest(t,vt.ResourceType.Tile),function(t,e){if(delete i.request,i.aborted)i.state="unloaded",o(null);else if(t)i.state="errored",o(t);else if(e){a.map._refreshExpiredTiles&&i.setExpiryData(e),delete e.cacheControl,delete e.expires;var r=a.map.painter.context,n=r.gl;i.texture=a.map.painter.getTileTexture(e.width),i.texture?i.texture.update(e,{useMipmap:!0}):(i.texture=new vt.Texture(r,e,n.RGBA,{useMipmap:!0}),i.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE,n.LINEAR_MIPMAP_NEAREST),r.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax)),i.state="loaded",vt.cacheEntryPossiblyAdded(a.dispatcher),o(null)}})},Z.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},Z.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},Z.prototype.hasTransition=function(){return!1},Z),z=((R=j)&&(Y.__proto__=R),((Y.prototype=Object.create(R&&R.prototype)).constructor=Y).prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},Y.prototype.loadTile=function(i,o){var t=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);i.request=vt.getImage(this.map._requestManager.transformRequest(t,vt.ResourceType.Tile),function(t,e){if(delete i.request,i.aborted)i.state="unloaded",o(null);else if(t)i.state="errored",o(t);else if(e){this.map._refreshExpiredTiles&&i.setExpiryData(e),delete e.cacheControl,delete e.expires;var r=vt.window.ImageBitmap&&e instanceof vt.window.ImageBitmap&&vt.offscreenCanvasSupported()?e:vt.browser.getImageData(e,1),n={uid:i.uid,coord:i.tileID,source:this.id,rawImageData:r,encoding:this.encoding};i.actor&&"expired"!==i.state||(i.actor=this.dispatcher.getActor(),i.actor.send("loadDEMTile",n,function(t,e){t&&(i.state="errored",o(t)),e&&(i.dem=e,i.needsHillshadePrepare=!0,i.state="loaded",o(null))}.bind(this)))}}.bind(this)),i.neighboringTiles=this._getNeighboringTiles(i.tileID)},Y.prototype._getNeighboringTiles=function(t){var e=t.canonical,r=Math.pow(2,e.z),n=(e.x-1+r)%r,i=0===e.x?t.wrap-1:t.wrap,o=(e.x+1+r)%r,a=e.x+1===r?t.wrap+1:t.wrap,s={};return s[new vt.OverscaledTileID(t.overscaledZ,i,e.z,n,e.y).key]={backfilled:!1},s[new vt.OverscaledTileID(t.overscaledZ,a,e.z,o,e.y).key]={backfilled:!1},0<e.y&&(s[new vt.OverscaledTileID(t.overscaledZ,i,e.z,n,e.y-1).key]={backfilled:!1},s[new vt.OverscaledTileID(t.overscaledZ,t.wrap,e.z,e.x,e.y-1).key]={backfilled:!1},s[new vt.OverscaledTileID(t.overscaledZ,a,e.z,o,e.y-1).key]={backfilled:!1}),e.y+1<r&&(s[new vt.OverscaledTileID(t.overscaledZ,i,e.z,n,e.y+1).key]={backfilled:!1},s[new vt.OverscaledTileID(t.overscaledZ,t.wrap,e.z,e.x,e.y+1).key]={backfilled:!1},s[new vt.OverscaledTileID(t.overscaledZ,a,e.z,o,e.y+1).key]={backfilled:!1}),s},Y.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})},Y),F=((L=vt.Evented)&&(X.__proto__=L),((X.prototype=Object.create(L&&L.prototype)).constructor=X).prototype.load=function(){var r=this;this.fire(new vt.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(t){if(t)r.fire(new vt.ErrorEvent(t));else{var e={dataType:"source",sourceDataType:"metadata"};r._collectResourceTiming&&r._resourceTiming&&0<r._resourceTiming.length&&(e.resourceTiming=r._resourceTiming,r._resourceTiming=[]),r.fire(new vt.Event("data",e))}})},X.prototype.onAdd=function(t){this.map=t,this.load()},X.prototype.setData=function(t){var r=this;return this._data=t,this.fire(new vt.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(t){if(t)r.fire(new vt.ErrorEvent(t));else{var e={dataType:"source",sourceDataType:"content"};r._collectResourceTiming&&r._resourceTiming&&0<r._resourceTiming.length&&(e.resourceTiming=r._resourceTiming,r._resourceTiming=[]),r.fire(new vt.Event("data",e))}}),this},X.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},X.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this},X.prototype.getClusterLeaves=function(t,e,r,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:r},n),this},X.prototype._updateWorkerData=function(r){var n=this;this._loaded=!1;var i=vt.extend({},this.workerOptions),t=this._data;"string"==typeof t?(i.request=this.map._requestManager.transformRequest(vt.browser.resolveURL(t),vt.ResourceType.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(t),this.actor.send(this.type+".loadData",i,function(t,e){n._removed||e&&e.abandoned||(n._loaded=!0,e&&e.resourceTiming&&e.resourceTiming[n.id]&&(n._resourceTiming=e.resourceTiming[n.id].slice(0)),n.actor.send(n.type+".coalesce",{source:i.source},null),r(t))})},X.prototype.loaded=function(){return this._loaded},X.prototype.loadTile=function(r,n){var i=this,o=r.actor?"reloadTile":"loadTile";r.actor=this.actor,r.request=this.actor.send(o,{type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:vt.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(t,e){return delete r.request,r.unloadVectorData(),r.aborted?n(null):t?n(t):(r.loadVectorData(e,i.map.painter,"reloadTile"==o),n(null))})},X.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0},X.prototype.unloadTile=function(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})},X.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},X.prototype.serialize=function(){return vt.extend({},this._options,{type:this.type,data:this._data})},X.prototype.hasTransition=function(){return!1},X),B=vt.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),U=((I=vt.Evented)&&(W.__proto__=I),((W.prototype=Object.create(I&&I.prototype)).constructor=W).prototype.load=function(r,n){var i=this;this._loaded=!1,this.fire(new vt.Event("dataloading",{dataType:"source"})),this.url=this.options.url,vt.getImage(this.map._requestManager.transformRequest(this.url,vt.ResourceType.Image),function(t,e){i._loaded=!0,t?i.fire(new vt.ErrorEvent(t)):e&&(i.image=e,r&&(i.coordinates=r),n&&n(),i._finishLoading())})},W.prototype.loaded=function(){return this._loaded},W.prototype.updateImage=function(t){var e=this;return this.image&&t.url&&(this.options.url=t.url,this.load(t.coordinates,function(){e.texture=null})),this},W.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new vt.Event("data",{dataType:"source",sourceDataType:"metadata"})))},W.prototype.onAdd=function(t){this.map=t,this.load()},W.prototype.setCoordinates=function(t){var e=this,l=(this.coordinates=t).map(vt.MercatorCoordinate.fromLngLat);this.tileID=function(){for(var t=1/0,e=1/0,r=-1/0,n=-1/0,i=0,o=l;i<o.length;i+=1){var a=o[i];t=Math.min(t,a.x),e=Math.min(e,a.y),r=Math.max(r,a.x),n=Math.max(n,a.y)}var s=Math.max(r-t,n-e),u=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),c=Math.pow(2,u);return new vt.CanonicalTileID(u,Math.floor((t+r)/2*c),Math.floor((e+n)/2*c))}(),this.minzoom=this.maxzoom=this.tileID.z;var r=l.map(function(t){return e.tileID.getTilePoint(t)._round()});return this._boundsArray=new vt.StructArrayLayout4i8,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,vt.EXTENT,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,vt.EXTENT),this._boundsArray.emplaceBack(r[2].x,r[2].y,vt.EXTENT,vt.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new vt.Event("data",{dataType:"source",sourceDataType:"content"})),this},W.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var t=this.map.painter.context,e=t.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,B.members)),this.boundsSegments||(this.boundsSegments=vt.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new vt.Texture(t,this.image,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[r];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},W.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t).buckets={}:t.state="errored",e(null)},W.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},W.prototype.hasTransition=function(){return!1},W),V=((A=U)&&($.__proto__=A),(($.prototype=Object.create(A&&A.prototype)).constructor=$).prototype.load=function(){var r=this;this._loaded=!1;var t=this.options;this.urls=[];for(var e=0,n=t.urls;e<n.length;e+=1)this.urls.push(this.map._requestManager.transformRequest(n[e],vt.ResourceType.Source).url);vt.getVideo(this.urls,function(t,e){r._loaded=!0,t?r.fire(new vt.ErrorEvent(t)):e&&(r.video=e,r.video.loop=!0,r.video.addEventListener("playing",function(){r.map.triggerRepaint()}),r.map&&r.video.play(),r._finishLoading())})},$.prototype.pause=function(){this.video&&this.video.pause()},$.prototype.play=function(){this.video&&this.video.play()},$.prototype.seek=function(t){if(this.video){var e=this.video.seekable;t<e.start(0)||t>e.end(0)?this.fire(new vt.ErrorEvent(new vt.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+e.start(0)+" and "+e.end(0)+"-second mark."))):this.video.currentTime=t}},$.prototype.getVideo=function(){return this.video},$.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},$.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var t=this.map.painter.context,e=t.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,B.members)),this.boundsSegments||(this.boundsSegments=vt.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new vt.Texture(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[r];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},$.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},$.prototype.hasTransition=function(){return this.video&&!this.video.paused},$),G=((O=U)&&(H.__proto__=O),((H.prototype=Object.create(O&&O.prototype)).constructor=H).prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof vt.window.HTMLCanvasElement?this.options.canvas:vt.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new vt.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},H.prototype.getCanvas=function(){return this.canvas},H.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},H.prototype.onRemove=function(){this.pause()},H.prototype.prepare=function(){var t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var e=this.map.painter.context,r=e.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,B.members)),this.boundsSegments||(this.boundsSegments=vt.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new vt.Texture(e,this.canvas,r.RGBA,{premultiply:!0}),this.tiles){var i=this.tiles[n];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},H.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},H.prototype.hasTransition=function(){return this._playing},H.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var r=e[t];if(isNaN(r)||r<=0)return!0}return!1},H),q={vector:D,raster:j,"raster-dem":z,geojson:F,video:V,image:U,canvas:G};function H(t,e,r,n){O.call(this,t,e,r,n),e.coordinates?Array.isArray(e.coordinates)&&4===e.coordinates.length&&!e.coordinates.some(function(t){return!Array.isArray(t)||2!==t.length||t.some(function(t){return"number"!=typeof t})})||this.fire(new vt.ErrorEvent(new vt.ValidationError("sources."+t,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new vt.ErrorEvent(new vt.ValidationError("sources."+t,null,'missing required property "coordinates"'))),e.animate&&"boolean"!=typeof e.animate&&this.fire(new vt.ErrorEvent(new vt.ValidationError("sources."+t,null,'optional "animate" property must be a boolean value'))),e.canvas?"string"==typeof e.canvas||e.canvas instanceof vt.window.HTMLCanvasElement||this.fire(new vt.ErrorEvent(new vt.ValidationError("sources."+t,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new vt.ErrorEvent(new vt.ValidationError("sources."+t,null,'missing required property "canvas"'))),this.options=e,this.animate=void 0===e.animate||e.animate}function $(t,e,r,n){A.call(this,t,e,r,n),this.roundZoom=!0,this.type="video",this.options=e}function W(t,e,r,n){I.call(this),this.id=t,this.dispatcher=r,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=e}function X(t,e,r,n){L.call(this),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(n),this._data=e.data,this._options=vt.extend({},e),this._collectResourceTiming=e.collectResourceTiming,this._resourceTiming=[],void 0!==e.maxzoom&&(this.maxzoom=e.maxzoom),e.type&&(this.type=e.type),e.attribution&&(this.attribution=e.attribution),this.promoteId=e.promoteId;var i=vt.EXTENT/this.tileSize;this.workerOptions=vt.extend({source:this.id,cluster:e.cluster||!1,geojsonVtOptions:{buffer:(void 0!==e.buffer?e.buffer:128)*i,tolerance:(void 0!==e.tolerance?e.tolerance:.375)*i,extent:vt.EXTENT,maxZoom:this.maxzoom,lineMetrics:e.lineMetrics||!1,generateId:e.generateId||!1},superclusterOptions:{maxZoom:void 0!==e.clusterMaxZoom?Math.min(e.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:vt.EXTENT,radius:(e.clusterRadius||50)*i,log:!1,generateId:e.generateId||!1},clusterProperties:e.clusterProperties},e.workerOptions)}function Y(t,e,r,n){R.call(this,t,e,r,n),this.type="raster-dem",this.maxzoom=22,this._options=vt.extend({type:"raster-dem"},e),this.encoding=e.encoding||"mapbox"}function Z(t,e,r,n){N.call(this),this.id=t,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=vt.extend({type:"raster"},e),vt.extend(this,vt.pick(e,["url","scheme","tileSize"]))}function K(t,e,r,n){if(k.call(this),this.id=t,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,vt.extend(this,vt.pick(e,["url","scheme","tileSize","promoteId"])),this._options=vt.extend({type:"vector"},e),this._collectResourceTiming=e.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n)}function J(n,t,e,r,i,o){var a,s,u,c=function(t,e,r){if(t)for(var n=0,i=t;n<i.length;n+=1){var o=e[i[n]];if(o&&o.source===r&&"fill-extrusion"===o.type)return!0}else for(var a in e){var s=e[a];if(s.source===r&&"fill-extrusion"===s.type)return!0}return!1}(i&&i.layers,t,n.id),l=o.maxPitchScaleFactor(),h=n.tilesIn(r,l,c);h.sort(Q);for(var m=[],p=0,f=h;p<f.length;p+=1){var d=f[p];m.push({wrappedTileID:d.tileID.wrapped().key,queryResults:d.tile.queryRenderedFeatures(t,e,n._state,d.queryGeometry,d.cameraQueryGeometry,d.scale,i,o,l,(a=n.transform,s=d.tileID,void 0,u=vt.identity([]),vt.translate(u,u,[1,1,0]),vt.scale(u,u,[.5*a.width,.5*a.height,1]),vt.multiply(u,u,a.calculatePosMatrix(s.toUnwrapped()))))})}var g=function(){for(var t={},e={},r=0,n=m;r<n.length;r+=1){var i=n[r],o=i.queryResults,a=i.wrappedTileID,s=e[a]=e[a]||{};for(var u in o)for(var c=o[u],l=s[u]=s[u]||{},h=t[u]=t[u]||[],p=0,f=c;p<f.length;p+=1){var d=f[p];l[d.featureIndex]||(l[d.featureIndex]=!0,h.push(d))}}return t}();for(var y in g)g[y].forEach(function(t){var e=t.feature,r=n.getFeatureState(e.layer["source-layer"],e.id);e.source=e.layer.source,e.layer["source-layer"]&&(e.sourceLayer=e.layer["source-layer"]),e.state=r});return g}function Q(t,e){var r=t.tileID,n=e.tileID;return r.overscaledZ-n.overscaledZ||r.canonical.y-n.canonical.y||r.wrap-n.wrap||r.canonical.x-n.canonical.x}function tt(t,e){this.max=t,this.onRemove=e,this.reset()}tt.prototype.reset=function(){for(var t in this.data)for(var e=0,r=this.data[t];e<r.length;e+=1){var n=r[e];n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value)}return this.data={},this.order=[],this},tt.prototype.add=function(t,e,r){var n=this,i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);var o={value:e,timeout:void 0};if(void 0!==r&&(o.timeout=setTimeout(function(){n.remove(t,o)},r)),this.data[i].push(o),this.order.push(i),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},tt.prototype.has=function(t){return t.wrapped().key in this.data},tt.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},tt.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},tt.prototype.getByKey=function(t){var e=this.data[t];return e?e[0].value:null},tt.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},tt.prototype.remove=function(t,e){if(!this.has(t))return this;var r=t.wrapped().key,n=void 0===e?0:this.data[r].indexOf(e),i=this.data[r][n];return this.data[r].splice(n,1),i.timeout&&clearTimeout(i.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(i.value),this.order.splice(this.order.indexOf(r),1),this},tt.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this},tt.prototype.filter=function(t){var e=[];for(var r in this.data)for(var n=0,i=this.data[r];n<i.length;n+=1){var o=i[n];t(o.value)||e.push(o)}for(var a=0,s=e;a<s.length;a+=1){var u=s[a];this.remove(u.value.tileID,u)}};function et(t,e,r){var n=(this.context=t).gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}et.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},et.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},et.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};function rt(t,e,r,n){this.length=e.length,this.attributes=r,this.itemSize=e.bytesPerElement,this.dynamicDraw=n;var i=(this.context=t).gl;this.buffer=i.createBuffer(),t.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}var nt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};rt.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},rt.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},rt.prototype.enableAttributes=function(t,e){for(var r=0;r<this.attributes.length;r++){var n=e.attributes[this.attributes[r].name];void 0!==n&&t.enableVertexAttribArray(n)}},rt.prototype.setVertexAttribPointers=function(t,e,r){for(var n=0;n<this.attributes.length;n++){var i=this.attributes[n],o=e.attributes[i.name];void 0!==o&&t.vertexAttribPointer(o,i.components,t[nt[i.type]],!1,this.itemSize,i.offset+this.itemSize*(r||0))}},rt.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};function it(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}it.prototype.get=function(){return this.current},it.prototype.set=function(t){},it.prototype.getDefault=function(){return this.default},it.prototype.setDefault=function(){this.set(this.default)};function ot(t,e,r,n){this.context=t,this.width=e,this.height=r;var i=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new _e(t,i),n&&(this.depthAttachment=new be(t,i))}var at,st,ut,ct,lt,ht,pt,ft,dt,mt,gt,yt,_t,bt,xt,wt,St,Et,Ct,Mt,Tt,Pt,Ot,At,It,Lt,Rt,Nt,kt,Dt,jt,zt,Ft,Bt,Ut=((Bt=it)&&(tr.__proto__=Bt),((tr.prototype=Object.create(Bt&&Bt.prototype)).constructor=tr).prototype.getDefault=function(){return vt.Color.transparent},tr.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a&&!this.dirty||(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},tr),Vt=((Ft=it)&&(Qe.__proto__=Ft),((Qe.prototype=Object.create(Ft&&Ft.prototype)).constructor=Qe).prototype.getDefault=function(){return 1},Qe.prototype.set=function(t){t===this.current&&!this.dirty||(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},Qe),Gt=((zt=it)&&(Je.__proto__=zt),((Je.prototype=Object.create(zt&&zt.prototype)).constructor=Je).prototype.getDefault=function(){return 0},Je.prototype.set=function(t){t===this.current&&!this.dirty||(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},Je),qt=((jt=it)&&(Ke.__proto__=jt),((Ke.prototype=Object.create(jt&&jt.prototype)).constructor=Ke).prototype.getDefault=function(){return[!0,!0,!0,!0]},Ke.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&!this.dirty||(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},Ke),Ht=((Dt=it)&&(Ze.__proto__=Dt),((Ze.prototype=Object.create(Dt&&Dt.prototype)).constructor=Ze).prototype.getDefault=function(){return!0},Ze.prototype.set=function(t){t===this.current&&!this.dirty||(this.gl.depthMask(t),this.current=t,this.dirty=!1)},Ze),$t=((kt=it)&&(Ye.__proto__=kt),((Ye.prototype=Object.create(kt&&kt.prototype)).constructor=Ye).prototype.getDefault=function(){return 255},Ye.prototype.set=function(t){t===this.current&&!this.dirty||(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},Ye),Wt=((Nt=it)&&(Xe.__proto__=Nt),((Xe.prototype=Object.create(Nt&&Nt.prototype)).constructor=Xe).prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},Xe.prototype.set=function(t){var e=this.current;t.func===e.func&&t.ref===e.ref&&t.mask===e.mask&&!this.dirty||(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},Xe),Xt=((Rt=it)&&(We.__proto__=Rt),((We.prototype=Object.create(Rt&&Rt.prototype)).constructor=We).prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},We.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&!this.dirty||(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},We),Yt=((Lt=it)&&($e.__proto__=Lt),(($e.prototype=Object.create(Lt&&Lt.prototype)).constructor=$e).prototype.getDefault=function(){return!1},$e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},$e),Zt=((It=it)&&(He.__proto__=It),((He.prototype=Object.create(It&&It.prototype)).constructor=He).prototype.getDefault=function(){return[0,1]},He.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&!this.dirty||(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},He),Kt=((At=it)&&(qe.__proto__=At),((qe.prototype=Object.create(At&&At.prototype)).constructor=qe).prototype.getDefault=function(){return!1},qe.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},qe),Jt=((Ot=it)&&(Ge.__proto__=Ot),((Ge.prototype=Object.create(Ot&&Ot.prototype)).constructor=Ge).prototype.getDefault=function(){return this.gl.LESS},Ge.prototype.set=function(t){t===this.current&&!this.dirty||(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},Ge),Qt=((Pt=it)&&(Ve.__proto__=Pt),((Ve.prototype=Object.create(Pt&&Pt.prototype)).constructor=Ve).prototype.getDefault=function(){return!1},Ve.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},Ve),te=((Tt=it)&&(Ue.__proto__=Tt),((Ue.prototype=Object.create(Tt&&Tt.prototype)).constructor=Ue).prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},Ue.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&!this.dirty||(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},Ue),ee=((Mt=it)&&(Be.__proto__=Mt),((Be.prototype=Object.create(Mt&&Mt.prototype)).constructor=Be).prototype.getDefault=function(){return vt.Color.transparent},Be.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a&&!this.dirty||(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},Be),re=((Ct=it)&&(Fe.__proto__=Ct),((Fe.prototype=Object.create(Ct&&Ct.prototype)).constructor=Fe).prototype.getDefault=function(){return this.gl.FUNC_ADD},Fe.prototype.set=function(t){t===this.current&&!this.dirty||(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},Fe),ne=((Et=it)&&(ze.__proto__=Et),((ze.prototype=Object.create(Et&&Et.prototype)).constructor=ze).prototype.getDefault=function(){return!1},ze.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},ze),ie=((St=it)&&(je.__proto__=St),((je.prototype=Object.create(St&&St.prototype)).constructor=je).prototype.getDefault=function(){return this.gl.BACK},je.prototype.set=function(t){t===this.current&&!this.dirty||(this.gl.cullFace(t),this.current=t,this.dirty=!1)},je),oe=((wt=it)&&(De.__proto__=wt),((De.prototype=Object.create(wt&&wt.prototype)).constructor=De).prototype.getDefault=function(){return this.gl.CCW},De.prototype.set=function(t){t===this.current&&!this.dirty||(this.gl.frontFace(t),this.current=t,this.dirty=!1)},De),ae=((xt=it)&&(ke.__proto__=xt),((ke.prototype=Object.create(xt&&xt.prototype)).constructor=ke).prototype.getDefault=function(){return null},ke.prototype.set=function(t){t===this.current&&!this.dirty||(this.gl.useProgram(t),this.current=t,this.dirty=!1)},ke),se=((bt=it)&&(Ne.__proto__=bt),((Ne.prototype=Object.create(bt&&bt.prototype)).constructor=Ne).prototype.getDefault=function(){return this.gl.TEXTURE0},Ne.prototype.set=function(t){t===this.current&&!this.dirty||(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},Ne),ue=((_t=it)&&(Re.__proto__=_t),((Re.prototype=Object.create(_t&&_t.prototype)).constructor=Re).prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},Re.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&!this.dirty||(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},Re),ce=((yt=it)&&(Le.__proto__=yt),((Le.prototype=Object.create(yt&&yt.prototype)).constructor=Le).prototype.getDefault=function(){return null},Le.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},Le),le=((gt=it)&&(Ie.__proto__=gt),((Ie.prototype=Object.create(gt&&gt.prototype)).constructor=Ie).prototype.getDefault=function(){return null},Ie.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},Ie),he=((mt=it)&&(Ae.__proto__=mt),((Ae.prototype=Object.create(mt&&mt.prototype)).constructor=Ae).prototype.getDefault=function(){return null},Ae.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},Ae),pe=((dt=it)&&(Oe.__proto__=dt),((Oe.prototype=Object.create(dt&&dt.prototype)).constructor=Oe).prototype.getDefault=function(){return null},Oe.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},Oe),fe=((ft=it)&&(Pe.__proto__=ft),((Pe.prototype=Object.create(ft&&ft.prototype)).constructor=Pe).prototype.getDefault=function(){return null},Pe.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},Pe),de=((pt=it)&&(Te.__proto__=pt),((Te.prototype=Object.create(pt&&pt.prototype)).constructor=Te).prototype.getDefault=function(){return null},Te.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},Te),me=((ht=it)&&(Me.__proto__=ht),((Me.prototype=Object.create(ht&&ht.prototype)).constructor=Me).prototype.getDefault=function(){return 4},Me.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},Me),ge=((lt=it)&&(Ce.__proto__=lt),((Ce.prototype=Object.create(lt&&lt.prototype)).constructor=Ce).prototype.getDefault=function(){return!1},Ce.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},Ce),ye=((ct=it)&&(Ee.__proto__=ct),((Ee.prototype=Object.create(ct&&ct.prototype)).constructor=Ee).prototype.getDefault=function(){return!1},Ee.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},Ee),ve=((ut=it)&&(Se.__proto__=ut),((Se.prototype=Object.create(ut&&ut.prototype)).constructor=Se).prototype.getDefault=function(){return null},Se),_e=((st=ve)&&(we.__proto__=st),((we.prototype=Object.create(st&&st.prototype)).constructor=we).prototype.setDirty=function(){this.dirty=!0},we.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},we),be=((at=ve)&&(xe.__proto__=at),((xe.prototype=Object.create(at&&at.prototype)).constructor=xe).prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},xe);function xe(){at.apply(this,arguments)}function we(){st.apply(this,arguments)}function Se(t,e){ut.call(this,t),this.context=t,this.parent=e}function Ee(){ct.apply(this,arguments)}function Ce(){lt.apply(this,arguments)}function Me(){ht.apply(this,arguments)}function Te(t){pt.call(this,t),this.vao=t.extVertexArrayObject}function Pe(){ft.apply(this,arguments)}function Oe(){dt.apply(this,arguments)}function Ae(){mt.apply(this,arguments)}function Ie(){gt.apply(this,arguments)}function Le(){yt.apply(this,arguments)}function Re(){_t.apply(this,arguments)}function Ne(){bt.apply(this,arguments)}function ke(){xt.apply(this,arguments)}function De(){wt.apply(this,arguments)}function je(){St.apply(this,arguments)}function ze(){Et.apply(this,arguments)}function Fe(){Ct.apply(this,arguments)}function Be(){Mt.apply(this,arguments)}function Ue(){Tt.apply(this,arguments)}function Ve(){Pt.apply(this,arguments)}function Ge(){Ot.apply(this,arguments)}function qe(){At.apply(this,arguments)}function He(){It.apply(this,arguments)}function $e(){Lt.apply(this,arguments)}function We(){Rt.apply(this,arguments)}function Xe(){Nt.apply(this,arguments)}function Ye(){kt.apply(this,arguments)}function Ze(){Dt.apply(this,arguments)}function Ke(){jt.apply(this,arguments)}function Je(){zt.apply(this,arguments)}function Qe(){Ft.apply(this,arguments)}function tr(){Bt.apply(this,arguments)}ot.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){var r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}t.deleteFramebuffer(this.framebuffer)};var er=function(t,e,r){this.func=t,this.mask=e,this.range=r};er.ReadOnly=!1,er.ReadWrite=!0,er.disabled=new er(519,er.ReadOnly,[0,1]);var rr=function(t,e,r,n,i,o){this.test=t,this.ref=e,this.mask=r,this.fail=n,this.depthFail=i,this.pass=o};rr.disabled=new rr({func:519,mask:0},0,0,7680,7680,7680);var nr=function(t,e,r){this.blendFunction=t,this.blendColor=e,this.mask=r};nr.Replace=[1,0],nr.disabled=new nr(nr.Replace,vt.Color.transparent,[!1,!1,!1,!1]),nr.unblended=new nr(nr.Replace,vt.Color.transparent,[!0,!0,!0,!0]),nr.alphaBlended=new nr([1,771],vt.Color.transparent,[!0,!0,!0,!0]);var ir=function(t,e,r){this.enable=t,this.mode=e,this.frontFace=r};ir.disabled=new ir(!1,1029,2305),ir.backCCW=new ir(!0,1029,2305);function or(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ut(this),this.clearDepth=new Vt(this),this.clearStencil=new Gt(this),this.colorMask=new qt(this),this.depthMask=new Ht(this),this.stencilMask=new $t(this),this.stencilFunc=new Wt(this),this.stencilOp=new Xt(this),this.stencilTest=new Yt(this),this.depthRange=new Zt(this),this.depthTest=new Kt(this),this.depthFunc=new Jt(this),this.blend=new Qt(this),this.blendFunc=new te(this),this.blendColor=new ee(this),this.blendEquation=new re(this),this.cullFace=new ne(this),this.cullFaceSide=new ie(this),this.frontFace=new oe(this),this.program=new ae(this),this.activeTexture=new se(this),this.viewport=new ue(this),this.bindFramebuffer=new ce(this),this.bindRenderbuffer=new le(this),this.bindTexture=new he(this),this.bindVertexBuffer=new pe(this),this.bindElementBuffer=new fe(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new de(this),this.pixelStoreUnpack=new me(this),this.pixelStoreUnpackPremultiplyAlpha=new ge(this),this.pixelStoreUnpackFlipY=new ye(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query")}or.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},or.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},or.prototype.createIndexBuffer=function(t,e){return new et(this,t,e)},or.prototype.createVertexBuffer=function(t,e,r){return new rt(this,t,e,r)},or.prototype.createRenderbuffer=function(t,e,r){var n=this.gl,i=n.createRenderbuffer();return this.bindRenderbuffer.set(i),n.renderbufferStorage(n.RENDERBUFFER,t,e,r),this.bindRenderbuffer.set(null),i},or.prototype.createFramebuffer=function(t,e,r){return new ot(this,t,e,r)},or.prototype.clear=function(t){var e=t.color,r=t.depth,n=this.gl,i=0;e&&(i|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==r&&(i|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),n.clear(i)},or.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},or.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},or.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},or.prototype.setColorMode=function(t){vt.deepEqual(t.blendFunction,nr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)},or.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var ar,sr=((ar=vt.Evented)&&(ur.__proto__=ar),((ur.prototype=Object.create(ar&&ar.prototype)).constructor=ur).prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},ur.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},ur.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},ur.prototype.getSource=function(){return this._source},ur.prototype.pause=function(){this._paused=!0},ur.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},ur.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},ur.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,function(){})},ur.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,function(){})},ur.prototype.serialize=function(){return this._source.serialize()},ur.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var r=this._tiles[e];r.upload(t),r.prepare(this.map.style.imageManager)}},ur.prototype.getIds=function(){return vt.values(this._tiles).map(function(t){return t.tileID}).sort(cr).map(function(t){return t.key})},ur.prototype.getRenderableIds=function(t){var a=this,e=[];for(var r in this._tiles)this._isIdRenderable(r,t)&&e.push(this._tiles[r]);return t?e.sort(function(t,e){var r=t.tileID,n=e.tileID,i=new vt.Point(r.canonical.x,r.canonical.y)._rotate(a.transform.angle),o=new vt.Point(n.canonical.x,n.canonical.y)._rotate(a.transform.angle);return r.overscaledZ-n.overscaledZ||o.y-i.y||o.x-i.x}).map(function(t){return t.tileID.key}):e.map(function(t){return t.tileID}).sort(cr).map(function(t){return t.key})},ur.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},ur.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},ur.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},ur.prototype._reloadTile=function(t,e){var r=this._tiles[t];r&&("loading"!==r.state&&(r.state=e),this._loadTile(r,this._tileLoaded.bind(this,r,t,e)))},ur.prototype._tileLoaded=function(t,e,r,n){if(n)return t.state="errored",void(404!==n.status?this._source.fire(new vt.ErrorEvent(n,{tile:t})):this.update(this.transform));t.timeAdded=vt.browser.now(),"expired"===r&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new vt.Event("data",{dataType:"source",tile:t,coord:t.tileID}))},ur.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),r=0;r<e.length;r++){var n=e[r];if(t.neighboringTiles&&t.neighboringTiles[n]){var i=this.getTileByID(n);o(t,i),o(i,t)}}function o(t,e){t.needsHillshadePrepare=!0;var r=e.tileID.canonical.x-t.tileID.canonical.x,n=e.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===r&&0==n||1<Math.abs(n)||(1<Math.abs(r)&&(1===Math.abs(r+i)?r+=i:1===Math.abs(r-i)&&(r-=i)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,r,n),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},ur.prototype.getTile=function(t){return this.getTileByID(t.key)},ur.prototype.getTileByID=function(t){return this._tiles[t]},ur.prototype._retainLoadedChildren=function(t,e,r,n){for(var i in this._tiles){var o=this._tiles[i];if(!(n[i]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>r)){for(var a=o.tileID;o&&o.tileID.overscaledZ>e+1;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);(o=this._tiles[s.key])&&o.hasData()&&(a=s)}for(var u=a;u.overscaledZ>e;)if(t[(u=u.scaledTo(u.overscaledZ-1)).key]){n[a.key]=a;break}}}},ur.prototype.findLoadedParent=function(t,e){if(t.key in this._loadedParentTiles){var r=this._loadedParentTiles[t.key];return r&&r.tileID.overscaledZ>=e?r:null}for(var n=t.overscaledZ-1;e<=n;n--){var i=t.scaledTo(n),o=this._getLoadedTile(i);if(o)return o}},ur.prototype._getLoadedTile=function(t){var e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)},ur.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/this._source.tileSize)+1,r=Math.ceil(t.height/this._source.tileSize)+1,n=Math.floor(e*r*5),i="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(i)},ur.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var r={};for(var n in this._tiles){var i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),r[i.tileID.key]=i}for(var o in this._tiles=r,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var a in this._tiles)this._setTileReloadTimer(a,this._tiles[a])}},ur.prototype.update=function(t){var e=this;if(this.transform=t,this._sourceLoaded&&!this._paused){var r;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?r=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(t){return new vt.OverscaledTileID(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)}):(r=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(r=r.filter(function(t){return e._source.hasTile(t)}))):r=[];var n=t.coveringZoomLevel(this._source),i=Math.max(n-ur.maxOverzooming,this._source.minzoom),o=Math.max(n+ur.maxUnderzooming,this._source.minzoom),a=this._updateRetainedTiles(r,n);if(lr(this._source.type)){for(var s={},u={},c=0,l=Object.keys(a);c<l.length;c+=1){var h=l[c],p=a[h],f=this._tiles[h];if(f&&!(f.fadeEndTime&&f.fadeEndTime<=vt.browser.now())){var d=this.findLoadedParent(p,i);d&&(this._addTile(d.tileID),s[d.tileID.key]=d.tileID),u[h]=p}}for(var m in this._retainLoadedChildren(u,n,o,a),s)a[m]||(this._coveredTiles[m]=!0,a[m]=s[m])}for(var g in a)this._tiles[g].clearFadeHold();for(var y=0,v=vt.keysDifference(this._tiles,a);y<v.length;y+=1){var _=v[y],b=this._tiles[_];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(_)}this._updateLoadedParentTileCache()}},ur.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},ur.prototype._updateRetainedTiles=function(t,e){for(var r={},n={},i=Math.max(e-ur.maxOverzooming,this._source.minzoom),o=Math.max(e+ur.maxUnderzooming,this._source.minzoom),a={},s=0,u=t;s<u.length;s+=1){var c=u[s],l=this._addTile(c);r[c.key]=c,l.hasData()||e<this._source.maxzoom&&(a[c.key]=c)}this._retainLoadedChildren(a,e,o,r);for(var h=0,p=t;h<p.length;h+=1){var f=p[h],d=this._tiles[f.key];if(!d.hasData()){if(e+1>this._source.maxzoom){var m=f.children(this._source.maxzoom)[0],g=this.getTile(m);if(g&&g.hasData()){r[m.key]=m;continue}}else{var y=f.children(this._source.maxzoom);if(r[y[0].key]&&r[y[1].key]&&r[y[2].key]&&r[y[3].key])continue}for(var v=d.wasRequested(),_=f.overscaledZ-1;i<=_;--_){var b=f.scaledTo(_);if(n[b.key])break;if(n[b.key]=!0,!(d=this.getTile(b))&&v&&(d=this._addTile(b)),d&&(r[b.key]=b,v=d.wasRequested(),d.hasData()))break}}}return r},ur.prototype._updateLoadedParentTileCache=function(){for(var t in this._loadedParentTiles={},this._tiles){for(var e=[],r=void 0,n=this._tiles[t].tileID;0<n.overscaledZ;){if(n.key in this._loadedParentTiles){r=this._loadedParentTiles[n.key];break}e.push(n.key);var i=n.scaledTo(n.overscaledZ-1);if(r=this._getLoadedTile(i))break;n=i}for(var o=0,a=e;o<a.length;o+=1)this._loadedParentTiles[a[o]]=r}},ur.prototype._addTile=function(t){var e=this._tiles[t.key];if(e)return e;(e=this._cache.getAndRemove(t))&&(this._setTileReloadTimer(t.key,e),e.tileID=t,this._state.initializeTileState(e,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e)));var r=Boolean(e);return r||(e=new vt.Tile(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))),e?(e.uses++,this._tiles[t.key]=e,r||this._source.fire(new vt.Event("dataloading",{tile:e,coord:e.tileID,dataType:"source"})),e):null},ur.prototype._setTileReloadTimer=function(t,e){var r=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout(function(){r._reloadTile(t,"expired"),delete r._timers[t]},n))},ur.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),0<e.uses||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},ur.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},ur.prototype.tilesIn=function(t,u,e){var c=this,l=[],h=this.transform;if(!h)return l;for(var r=e?h.getCameraQueryGeometry(t):t,p=t.map(function(t){return h.pointCoordinate(t)}),f=r.map(function(t){return h.pointCoordinate(t)}),d=this.getIds(),m=1/0,g=1/0,y=-1/0,v=-1/0,n=0,i=f;n<i.length;n+=1){var o=i[n];m=Math.min(m,o.x),g=Math.min(g,o.y),y=Math.max(y,o.x),v=Math.max(v,o.y)}for(var a=function(t){var e=c._tiles[d[t]];if(!e.holdingForFade()){var r=e.tileID,n=Math.pow(2,h.zoom-e.tileID.overscaledZ),i=u*e.queryPadding*vt.EXTENT/e.tileSize/n,o=[r.getTilePoint(new vt.MercatorCoordinate(m,g)),r.getTilePoint(new vt.MercatorCoordinate(y,v))];if(o[0].x-i<vt.EXTENT&&o[0].y-i<vt.EXTENT&&0<=o[1].x+i&&0<=o[1].y+i){var a=p.map(function(t){return r.getTilePoint(t)}),s=f.map(function(t){return r.getTilePoint(t)});l.push({tile:e,tileID:r,queryGeometry:a,cameraQueryGeometry:s,scale:n})}}},s=0;s<d.length;s++)a(s);return l},ur.prototype.getVisibleCoordinates=function(t){for(var e=this,r=this.getRenderableIds(t).map(function(t){return e._tiles[t].tileID}),n=0,i=r;n<i.length;n+=1){var o=i[n];o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped())}return r},ur.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(lr(this._source.type))for(var t in this._tiles){var e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=vt.browser.now())return!0}return!1},ur.prototype.setFeatureState=function(t,e,r){this._state.updateState(t=t||"_geojsonTileLayer",e,r)},ur.prototype.removeFeatureState=function(t,e,r){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,r)},ur.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},ur.prototype.setDependencies=function(t,e,r){var n=this._tiles[t];n&&n.setDependencies(e,r)},ur.prototype.reloadTilesForDependencies=function(e,r){for(var t in this._tiles)this._tiles[t].hasDependency(e,r)&&this._reloadTile(t,"reloading");this._cache.filter(function(t){return!t.hasDependency(e,r)})},ur);function ur(t,e,r){var n=this;ar.call(this),this.id=t,this.dispatcher=r,this.on("data",function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(n._sourceLoaded=!0),n._sourceLoaded&&!n._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(n.reload(),n.transform&&n.update(n.transform))}),this.on("error",function(){n._sourceErrored=!0}),this._source=function(t,e,r,n){var i=new q[e.type](t,e,r,n);if(i.id!==t)throw new Error("Expected Source id to be "+t+" instead of "+i.id);return vt.bindAll(["load","abort","unload","serialize","prepare"],i),i}(t,e,r,this),this._tiles={},this._cache=new tt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new vt.SourceFeatureState}function cr(t,e){var r=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function lr(t){return"raster"===t||"image"===t||"video"===t}function hr(){return new vt.window.Worker(Bo.workerUrl)}sr.maxOverzooming=10,sr.maxUnderzooming=3;function pr(){this.active={}}pr.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<pr.workerCount;)this.workers.push(new hr);return this.active[t]=!0,this.workers.slice()},pr.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)};var fr,dr=Math.floor(vt.browser.hardwareConcurrency/2);function mr(t,e){var r={};for(var n in t)"ref"!==n&&(r[n]=t[n]);return vt.refProperties.forEach(function(t){t in e&&(r[t]=e[t])}),r}function gr(t){t=t.slice();for(var e=Object.create(null),r=0;r<t.length;r++)e[t[r].id]=t[r];for(var n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=mr(t[n],e[t[n].ref]));return t}pr.workerCount=Math.max(Math.min(dr,6),1);var yr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function vr(t,e,r){r.push({command:yr.addSource,args:[t,e[t]]})}function _r(t,e,r){e.push({command:yr.removeSource,args:[t]}),r[t]=!0}function br(t,e,r){var n;for(n in t[r])if(t[r].hasOwnProperty(n)&&"data"!==n&&!vt.deepEqual(t[r][n],e[r][n]))return!1;for(n in e[r])if(e[r].hasOwnProperty(n)&&"data"!==n&&!vt.deepEqual(t[r][n],e[r][n]))return!1;return!0}function xr(t,e,r,n,i,o){var a;for(a in e=e||{},t=t||{})t.hasOwnProperty(a)&&(vt.deepEqual(t[a],e[a])||r.push({command:o,args:[n,a,e[a],i]}));for(a in e)e.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(vt.deepEqual(t[a],e[a])||r.push({command:o,args:[n,a,e[a],i]}))}function wr(t){return t.id}function Sr(t,e){return t[e.id]=e,t}function Er(t,e,r){var n=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(e/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)n.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}function Cr(t,e,r,n,i){var o=vt.create();return e?(vt.scale(o,o,[1/i,1/i,1]),r||vt.rotateZ(o,o,n.angle)):vt.multiply(o,n.labelPlaneMatrix,t),o}function Mr(t,e,r,n,i){if(e){var o=vt.clone(t);return vt.scale(o,o,[i,i,1]),r||vt.rotateZ(o,o,-n.angle),o}return n.glCoordMatrix}function Tr(t,e){var r=[t.x,t.y,0,1];Dr(r,r,e);var n=r[3];return{point:new vt.Point(r[0]/n,r[1]/n),signedDistanceFromCamera:n}}function Pr(t,e,r,n,i,o,a,s){var u,c,l,h,p=n?t.textSizeData:t.iconSizeData,f=vt.evaluateSizeForZoom(p,r.transform.zoom),d=[256/r.width*2+1,256/r.height*2+1],m=n?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;m.clear();for(var g=t.lineVertexArray,y=n?t.text.placedSymbolArray:t.icon.placedSymbolArray,v=r.transform.width/r.transform.height,_=!1,b=0;b<y.length;b++){var x=y.get(b);if(x.hidden||x.writingMode===vt.WritingMode.vertical&&!_)kr(x.numGlyphs,m);else{_=!1;var w=[x.anchorX,x.anchorY,0,1];if(vt.transformMat4(w,w,e),c=d,void 0,l=(u=w)[0]/u[3],h=u[1]/u[3],l>=-c[0]&&l<=c[0]&&h>=-c[1]&&h<=c[1]){var S=.5+w[3]/r.transform.cameraToCenterDistance*.5,E=vt.evaluateSizeForFeature(p,f,x),C=a?E*S:E/S,M=new vt.Point(x.anchorX,x.anchorY),T=Tr(M,i).point,P={},O=Ir(x,C,!1,s,e,i,o,t.glyphOffsetArray,g,m,T,M,P,v);_=O.useVertical,(O.notEnoughRoom||_||O.needsFlipping&&Ir(x,C,!0,s,e,i,o,t.glyphOffsetArray,g,m,T,M,P,v).notEnoughRoom)&&kr(x.numGlyphs,m)}else kr(x.numGlyphs,m)}}n?t.text.dynamicLayoutVertexBuffer.updateData(m):t.icon.dynamicLayoutVertexBuffer.updateData(m)}function Or(t,e,r,n,i,o,a,s,u,c,l,h){var p=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,d=s.lineStartIndex+s.lineLength,m=e.getoffsetX(s.glyphStartIndex),g=e.getoffsetX(p-1),y=Rr(t*m,r,n,i,o,a,s.segment,f,d,u,c,l,h);if(!y)return null;var v=Rr(t*g,r,n,i,o,a,s.segment,f,d,u,c,l,h);return v?{first:y,last:v}:null}function Ar(t,e,r,n){return t===vt.WritingMode.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*n?{useVertical:!0}:(t===vt.WritingMode.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function Ir(t,e,r,n,i,o,a,s,u,c,l,h,p,f){var d,m=e/24,g=t.lineOffsetX*m,y=t.lineOffsetY*m;if(1<t.numGlyphs){var v=t.glyphStartIndex+t.numGlyphs,_=t.lineStartIndex,b=t.lineStartIndex+t.lineLength,x=Or(m,s,g,y,r,l,h,t,u,o,p,!1);if(!x)return{notEnoughRoom:!0};var w=Tr(x.first.point,a).point,S=Tr(x.last.point,a).point;if(n&&!r){var E=Ar(t.writingMode,w,S,f);if(E)return E}d=[x.first];for(var C=t.glyphStartIndex+1;C<v-1;C++)d.push(Rr(m*s.getoffsetX(C),g,y,r,l,h,t.segment,_,b,u,o,p,!1));d.push(x.last)}else{if(n&&!r){var M=Tr(h,i).point,T=t.lineStartIndex+t.segment+1,P=new vt.Point(u.getx(T),u.gety(T)),O=Tr(P,i),A=0<O.signedDistanceFromCamera?O.point:Lr(h,P,M,1,i),I=Ar(t.writingMode,M,A,f);if(I)return I}var L=Rr(m*s.getoffsetX(t.glyphStartIndex),g,y,r,l,h,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,u,o,p,!1);if(!L)return{notEnoughRoom:!0};d=[L]}for(var R=0,N=d;R<N.length;R+=1){var k=N[R];vt.addDynamicAttributes(c,k.point,k.angle)}return{}}function Lr(t,e,r,n,i){var o=Tr(t.add(t.sub(e)._unit()),i).point,a=r.sub(o);return r.add(a._mult(n/a.mag()))}function Rr(t,e,r,n,i,o,a,s,u,c,l,h,p){var f=n?t-e:t+e,d=0<f?1:-1,m=0;n&&(d*=-1,m=Math.PI),d<0&&(m+=Math.PI);for(var g=0<d?s+a:s+a+1,y=g,v=i,_=i,b=0,x=0,w=Math.abs(f);b+x<=w;){if((g+=d)<s||u<=g)return null;if(_=v,void 0===(v=h[g])){var S=new vt.Point(c.getx(g),c.gety(g)),E=Tr(S,l);if(0<E.signedDistanceFromCamera)v=h[g]=E.point;else{var C=g-d;v=Lr(0===b?o:new vt.Point(c.getx(C),c.gety(C)),S,_,w-b+1,l)}}b+=x,x=_.dist(v)}var M=(w-b)/x,T=v.sub(_),P=T.mult(M)._add(_);return P._add(T._unit()._perp()._mult(r*d)),{point:P,angle:m+Math.atan2(v.y-_.y,v.x-_.x),tileDistance:p?{prevTileDistance:g-d===y?0:c.gettileUnitDistanceFromAnchor(g-d),lastSegmentViewportDistance:w-b}:null}}Er.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Er.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},Er.prototype.insertCircle=function(t,e,r,n){this._forEachCell(e-n,r-n,e+n,r+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(r),this.circles.push(n)},Er.prototype._insertBoxCell=function(t,e,r,n,i,o){this.boxCells[i].push(o)},Er.prototype._insertCircleCell=function(t,e,r,n,i,o){this.circleCells[i].push(o)},Er.prototype._query=function(t,e,r,n,i,o){if(r<0||t>this.width||n<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=r&&this.height<=n){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var u=0;u<this.circleKeys.length;u++){var c=this.circles[3*u],l=this.circles[3*u+1],h=this.circles[3*u+2];a.push({key:this.circleKeys[u],x1:c-h,y1:l-h,x2:c+h,y2:l+h})}return o?a.filter(o):a}return this._forEachCell(t,e,r,n,this._queryCell,a,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?0<a.length:a},Er.prototype._queryCircle=function(t,e,r,n,i){var o=t-r,a=t+r,s=e-r,u=e+r;if(a<0||o>this.width||u<0||s>this.height)return!n&&[];var c=[];return this._forEachCell(o,s,a,u,this._queryCellCircle,c,{hitTest:n,circle:{x:t,y:e,radius:r},seenUids:{box:{},circle:{}}},i),n?0<c.length:c},Er.prototype.query=function(t,e,r,n,i){return this._query(t,e,r,n,!1,i)},Er.prototype.hitTest=function(t,e,r,n,i){return this._query(t,e,r,n,!0,i)},Er.prototype.hitTestCircle=function(t,e,r,n){return this._queryCircle(t,e,r,!0,n)},Er.prototype._queryCell=function(t,e,r,n,i,o,a,s){var u=a.seenUids,c=this.boxCells[i];if(null!==c)for(var l=this.bboxes,h=0,p=c;h<p.length;h+=1){var f=p[h];if(!u.box[f]){u.box[f]=!0;var d=4*f;if(t<=l[2+d]&&e<=l[3+d]&&r>=l[0+d]&&n>=l[1+d]&&(!s||s(this.boxKeys[f]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:l[d],y1:l[1+d],x2:l[2+d],y2:l[3+d]})}}}var m=this.circleCells[i];if(null!==m)for(var g=this.circles,y=0,v=m;y<v.length;y+=1){var _=v[y];if(!u.circle[_]){u.circle[_]=!0;var b=3*_;if(this._circleAndRectCollide(g[b],g[1+b],g[2+b],t,e,r,n)&&(!s||s(this.circleKeys[_]))){if(a.hitTest)return o.push(!0),!0;var x=g[b],w=g[1+b],S=g[2+b];o.push({key:this.circleKeys[_],x1:x-S,y1:w-S,x2:x+S,y2:w+S})}}}},Er.prototype._queryCellCircle=function(t,e,r,n,i,o,a,s){var u=a.circle,c=a.seenUids,l=this.boxCells[i];if(null!==l)for(var h=this.bboxes,p=0,f=l;p<f.length;p+=1){var d=f[p];if(!c.box[d]){c.box[d]=!0;var m=4*d;if(this._circleAndRectCollide(u.x,u.y,u.radius,h[0+m],h[1+m],h[2+m],h[3+m])&&(!s||s(this.boxKeys[d])))return o.push(!0),!0}}var g=this.circleCells[i];if(null!==g)for(var y=this.circles,v=0,_=g;v<_.length;v+=1){var b=_[v];if(!c.circle[b]){c.circle[b]=!0;var x=3*b;if(this._circlesCollide(y[x],y[1+x],y[2+x],u.x,u.y,u.radius)&&(!s||s(this.circleKeys[b])))return o.push(!0),!0}}},Er.prototype._forEachCell=function(t,e,r,n,i,o,a,s){for(var u=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),l=this._convertToXCellCoord(r),h=this._convertToYCellCoord(n),p=u;p<=l;p++)for(var f=c;f<=h;f++)if(i.call(this,t,e,r,n,this.xCellCount*f+p,o,a,s))return},Er.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Er.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Er.prototype._circlesCollide=function(t,e,r,n,i,o){var a=n-t,s=i-e,u=r+o;return a*a+s*s<u*u},Er.prototype._circleAndRectCollide=function(t,e,r,n,i,o,a){var s=(o-n)/2,u=Math.abs(t-(n+s));if(s+r<u)return!1;var c=(a-i)/2,l=Math.abs(e-(i+c));if(c+r<l)return!1;if(u<=s||l<=c)return!0;var h=u-s,p=l-c;return h*h+p*p<=r*r};var Nr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function kr(t,e){for(var r=0;r<t;r++){var n=e.length;e.resize(n+4),e.float32.set(Nr,3*n)}}function Dr(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t[3]=r[3]*n+r[7]*i+r[15],t}function jr(t,e,r){void 0===e&&(e=new Er(t.width+200,t.height+200,25)),void 0===r&&(r=new Er(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=r,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200}function zr(t,e,r){t[e+4]=r?1:0}function Fr(t,e,r){return e*(vt.EXTENT/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}jr.prototype.placeCollisionBox=function(t,e,r,n,i){var o=this.projectAndGetPerspectiveRatio(n,t.anchorPointX,t.anchorPointY),a=r*o.perspectiveRatio,s=t.x1*a+o.point.x,u=t.y1*a+o.point.y,c=t.x2*a+o.point.x,l=t.y2*a+o.point.y;return!this.isInsideGrid(s,u,c,l)||!e&&this.grid.hitTest(s,u,c,l,i)?{box:[],offscreen:!1}:{box:[s,u,c,l],offscreen:this.isOffscreen(s,u,c,l)}},jr.prototype.approximateTileDistance=function(t,e,r,n,i){var o=t.lastSegmentViewportDistance*r;return t.prevTileDistance+o+((i?1:n/this.pitchfactor)-1)*o*Math.abs(Math.sin(e))},jr.prototype.placeCollisionCircles=function(t,e,r,n,i,o,a,s,u,c,l,h,p){var f=[],d=this.projectAnchor(u,i.anchorX,i.anchorY),m=s/24,g=i.lineOffsetX*s,y=i.lineOffsetY*s,v=new vt.Point(i.anchorX,i.anchorY),_=Or(m,a,g,y,!1,Tr(v,c).point,v,i,o,c,{},!0),b=!1,x=!1,w=!0,S=d.perspectiveRatio*n,E=1/(n*r),C=0,M=0;_&&(C=this.approximateTileDistance(_.first.tileDistance,_.first.angle,E,d.cameraDistance,h),M=this.approximateTileDistance(_.last.tileDistance,_.last.angle,E,d.cameraDistance,h));for(var T=0;T<t.length;T+=5){var P=t[T],O=t[T+1],A=t[T+2],I=t[T+3];if(!_||I<-C||M<I)zr(t,T,!1);else{var L=this.projectPoint(u,P,O),R=A*S;if(0<f.length){var N=L.x-f[f.length-4],k=L.y-f[f.length-3];if(N*N+k*k<R*R*2&&T+8<t.length){var D=t[T+8];if(-C<D&&D<M){zr(t,T,!1);continue}}}f.push(L.x,L.y,R,T/5),zr(t,T,!0);var j=L.x-R,z=L.y-R,F=L.x+R,B=L.y+R;if(w=w&&this.isOffscreen(j,z,F,B),x=x||this.isInsideGrid(j,z,F,B),!e&&this.grid.hitTestCircle(L.x,L.y,R,p)){if(!l)return{circles:[],offscreen:!1};b=!0}}}return{circles:b||!x?[]:f,offscreen:w}},jr.prototype.queryRenderedSymbols=function(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var e=[],r=1/0,n=1/0,i=-1/0,o=-1/0,a=0,s=t;a<s.length;a+=1){var u=s[a],c=new vt.Point(u.x+100,u.y+100);r=Math.min(r,c.x),n=Math.min(n,c.y),i=Math.max(i,c.x),o=Math.max(o,c.y),e.push(c)}for(var l={},h={},p=0,f=this.grid.query(r,n,i,o).concat(this.ignoredGrid.query(r,n,i,o));p<f.length;p+=1){var d=f[p],m=d.key;if(void 0===l[m.bucketInstanceId]&&(l[m.bucketInstanceId]={}),!l[m.bucketInstanceId][m.featureIndex]){var g=[new vt.Point(d.x1,d.y1),new vt.Point(d.x2,d.y1),new vt.Point(d.x2,d.y2),new vt.Point(d.x1,d.y2)];vt.polygonIntersectsPolygon(e,g)&&(l[m.bucketInstanceId][m.featureIndex]=!0,void 0===h[m.bucketInstanceId]&&(h[m.bucketInstanceId]=[]),h[m.bucketInstanceId].push(m.featureIndex))}}return h},jr.prototype.insertCollisionBox=function(t,e,r,n,i){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:i},t[0],t[1],t[2],t[3])},jr.prototype.insertCollisionCircles=function(t,e,r,n,i){for(var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:n,collisionGroupID:i},s=0;s<t.length;s+=4)o.insertCircle(a,t[s],t[s+1],t[s+2])},jr.prototype.projectAnchor=function(t,e,r){var n=[e,r,0,1];return Dr(n,n,t),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5,cameraDistance:n[3]}},jr.prototype.projectPoint=function(t,e,r){var n=[e,r,0,1];return Dr(n,n,t),new vt.Point((n[0]/n[3]+1)/2*this.transform.width+100,(-n[1]/n[3]+1)/2*this.transform.height+100)},jr.prototype.projectAndGetPerspectiveRatio=function(t,e,r){var n=[e,r,0,1];return Dr(n,n,t),{point:new vt.Point((n[0]/n[3]+1)/2*this.transform.width+100,(-n[1]/n[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5}},jr.prototype.isOffscreen=function(t,e,r,n){return r<100||t>=this.screenRightBoundary||n<100||e>this.screenBottomBoundary},jr.prototype.isInsideGrid=function(t,e,r,n){return 0<=r&&t<this.gridRightBoundary&&0<=n&&e<this.gridBottomBoundary};function Br(t,e,r,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&r?1:0,this.placed=r}Br.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};function Ur(t,e,r,n,i){this.text=new Br(t?t.text:null,e,r,i),this.icon=new Br(t?t.icon:null,e,n,i)}Ur.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};function Vr(t,e,r){this.text=t,this.icon=e,this.skipFade=r}function Gr(t,e,r,n,i){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=r,this.bucketIndex=n,this.tileID=i}function qr(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}function Hr(t,e,r,n,i){var o=vt.getAnchorAlignment(t),a=-(o.horizontalAlign-.5)*e,s=-(o.verticalAlign-.5)*r,u=vt.evaluateVariableOffset(t,n);return new vt.Point(a+u[0]*i,s+u[1]*i)}function $r(t,e,r,n,i,o){var a=t.x1,s=t.x2,u=t.y1,c=t.y2,l=t.anchorPointX,h=t.anchorPointY,p=new vt.Point(e,r);return n&&p._rotate(i?o:-o),{x1:a+p.x,y1:u+p.y,x2:s+p.x,y2:c+p.y,anchorPointX:l,anchorPointY:h}}qr.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};function Wr(t,e,r,n){this.transform=t.clone(),this.collisionIndex=new jr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new qr(r),(this.prevPlacement=n)&&(n.prevPlacement=void 0),this.placedOrientations={}}function Xr(t,e,r,n,i){t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0)}Wr.prototype.getBucketParts=function(t,e,r,n){var i=r.getBucket(e),o=r.latestFeatureIndex;if(i&&o&&e.id===i.layerIds[0]){var a=r.collisionBoxArray,s=i.layers[0].layout,u=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),c=r.tileSize/vt.EXTENT,l=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),h=Cr(l,"map"===s.get("text-pitch-alignment"),"map"===s.get("text-rotation-alignment"),this.transform,Fr(r,1,this.transform.zoom));this.retainedQueryData[i.bucketInstanceId]=new Gr(i.bucketInstanceId,o,i.sourceLayerIndex,i.index,r.tileID);var p={bucket:i,layout:s,posMatrix:l,textLabelPlaneMatrix:h,scale:u,textPixelRatio:c,holdingForFade:r.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:vt.evaluateSizeForZoom(i.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(i.sourceID)};if(n)for(var f=0,d=i.sortKeyRanges;f<d.length;f+=1){var m=d[f];t.push({sortKey:m.sortKey,symbolInstanceStart:m.symbolInstanceStart,symbolInstanceEnd:m.symbolInstanceEnd,parameters:p})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:i.symbolInstances.length,parameters:p})}},Wr.prototype.attemptAnchorPlacement=function(t,e,r,n,i,o,a,s,u,c,l,h,p,f,d){var m,g=[h.textOffset0,h.textOffset1],y=Hr(t,r,n,g,i),v=this.collisionIndex.placeCollisionBox($r(e,y.x,y.y,o,a,this.transform.angle),l,s,u,c.predicate);if(!d||0!==this.collisionIndex.placeCollisionBox($r(d,y.x,y.y,o,a,this.transform.angle),l,s,u,c.predicate).box.length)return 0<v.box.length?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(m=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:g,width:r,height:n,anchor:t,textBoxScale:i,prevAnchor:m},this.markUsedJustification(p,t,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[h.crossTileID]=f),{shift:y,placedGlyphBoxes:v}):void 0},Wr.prototype.placeLayerBucketPart=function(t,O,A){var I=this,e=t.parameters,L=e.bucket,R=e.layout,N=e.posMatrix,k=e.textLabelPlaneMatrix,D=e.scale,j=e.textPixelRatio,z=e.holdingForFade,r=e.collisionBoxArray,F=e.partiallyEvaluatedTextSize,B=e.collisionGroup,U=R.get("text-optional"),V=R.get("icon-optional"),G=R.get("text-allow-overlap"),q=R.get("icon-allow-overlap"),H="map"===R.get("text-rotation-alignment"),$="map"===R.get("text-pitch-alignment"),W="none"!==R.get("icon-text-fit"),n="viewport-y"===R.get("symbol-z-order"),X=G&&(q||!L.hasIconData()||V),Y=q&&(G||!L.hasTextData()||U);!L.collisionArrays&&r&&L.deserializeCollisionBoxes(r);function i(h,i){if(!O[h.crossTileID])if(z)I.placements[h.crossTileID]=new Vr(!1,!1,!1);else{var t,p=!1,e=!1,r=!0,f=null,o={box:null,offscreen:null},a={box:null,offscreen:null},n=null,s=null,u=0,c=0,l=0;i.textFeatureIndex&&(u=i.textFeatureIndex),i.verticalTextFeatureIndex&&(c=i.verticalTextFeatureIndex);var d=i.textBox;if(d){var m=function(t){var e=vt.WritingMode.horizontal;if(L.allowVerticalPlacement&&!t&&I.prevPlacement){var r=I.prevPlacement.placedOrientations[h.crossTileID];r&&(I.placedOrientations[h.crossTileID]=r,I.markUsedOrientation(L,e=r,h))}return e},g=function(t,e){if(L.allowVerticalPlacement&&0<h.numVerticalGlyphVertices&&i.verticalTextBox)for(var r=0,n=L.writingModes;r<n.length&&(n[r]===vt.WritingMode.vertical?(o=e(),a=o):o=t(),!(o&&o.box&&o.box.length));r+=1);else o=t()};if(R.get("text-variable-anchor")){var y=R.get("text-variable-anchor");if(I.prevPlacement&&I.prevPlacement.variableOffsets[h.crossTileID]){var v=I.prevPlacement.variableOffsets[h.crossTileID];0<y.indexOf(v.anchor)&&(y=y.filter(function(t){return t!==v.anchor})).unshift(v.anchor)}var _=function(t,e,r){for(var n=t.x2-t.x1,i=t.y2-t.y1,o=h.textBoxScale,a=W&&!q?e:null,s={box:[],offscreen:!1},u=G?2*y.length:y.length,c=0;c<u;++c){var l=I.attemptAnchorPlacement(y[c%y.length],t,n,i,o,H,$,j,N,B,c>=y.length,h,L,r,a);if(l&&(s=l.placedGlyphBoxes)&&s.box&&s.box.length){p=!0,f=l.shift;break}}return s};g(function(){return _(d,i.iconBox,vt.WritingMode.horizontal)},function(){var t=i.verticalTextBox;return L.allowVerticalPlacement&&!(o&&o.box&&o.box.length)&&0<h.numVerticalGlyphVertices&&t?_(t,i.verticalIconBox,vt.WritingMode.vertical):{box:null,offscreen:null}}),o&&(p=o.box,r=o.offscreen);var b=m(o&&o.box);if(!p&&I.prevPlacement){var x=I.prevPlacement.variableOffsets[h.crossTileID];x&&(I.variableOffsets[h.crossTileID]=x,I.markUsedJustification(L,x.anchor,h,b))}}else{var w=function(t,e){var r=I.collisionIndex.placeCollisionBox(t,G,j,N,B.predicate);return r&&r.box&&r.box.length&&(I.markUsedOrientation(L,e,h),I.placedOrientations[h.crossTileID]=e),r};g(function(){return w(d,vt.WritingMode.horizontal)},function(){var t=i.verticalTextBox;return L.allowVerticalPlacement&&0<h.numVerticalGlyphVertices&&t?w(t,vt.WritingMode.vertical):{box:null,offscreen:null}}),m(o&&o.box&&o.box.length)}}p=(t=o)&&t.box&&0<t.box.length,r=t&&t.offscreen;var S=i.textCircles;if(S){var E=L.text.placedSymbolArray.get(h.centerJustifiedTextSymbolIndex),C=vt.evaluateSizeForFeature(L.textSizeData,F,E);n=I.collisionIndex.placeCollisionCircles(S,G,D,j,E,L.lineVertexArray,L.glyphOffsetArray,C,N,k,A,$,B.predicate),p=G||0<n.circles.length,r=r&&n.offscreen}if(i.iconFeatureIndex&&(l=i.iconFeatureIndex),i.iconBox){var M=function(t){var e=W&&f?$r(t,f.x,f.y,H,$,I.transform.angle):t;return I.collisionIndex.placeCollisionBox(e,q,j,N,B.predicate)};e=a&&a.box&&a.box.length&&i.verticalIconBox?0<(s=M(i.verticalIconBox)).box.length:0<(s=M(i.iconBox)).box.length,r=r&&s.offscreen}var T=U||0===h.numHorizontalGlyphVertices&&0===h.numVerticalGlyphVertices,P=V||0===h.numIconVertices;T||P?P?T||(e=e&&p):p=e&&p:e=p=e&&p,p&&t&&t.box&&I.collisionIndex.insertCollisionBox(t.box,R.get("text-ignore-placement"),L.bucketInstanceId,a&&a.box&&c?c:u,B.ID),e&&s&&I.collisionIndex.insertCollisionBox(s.box,R.get("icon-ignore-placement"),L.bucketInstanceId,l,B.ID),p&&n&&I.collisionIndex.insertCollisionCircles(n.circles,R.get("text-ignore-placement"),L.bucketInstanceId,u,B.ID),I.placements[h.crossTileID]=new Vr(p||X,e||Y,r||L.justReloaded),O[h.crossTileID]=!0}}if(n)for(var o=L.getSortedSymbolIndexes(this.transform.angle),a=o.length-1;0<=a;--a){var s=o[a];i(L.symbolInstances.get(s),L.collisionArrays[s])}else for(var u=t.symbolInstanceStart;u<t.symbolInstanceEnd;u++)i(L.symbolInstances.get(u),L.collisionArrays[u]);L.justReloaded=!1},Wr.prototype.markUsedJustification=function(t,e,r,n){var i;i=n===vt.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[vt.getAnchorJustification(e)];for(var o=0,a=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];o<a.length;o+=1){var s=a[o];0<=s&&(t.text.placedSymbolArray.get(s).crossTileID=0<=i&&s!==i?0:r.crossTileID)}},Wr.prototype.markUsedOrientation=function(t,e,r){for(var n=e===vt.WritingMode.horizontal||e===vt.WritingMode.horizontalOnly?e:0,i=e===vt.WritingMode.vertical?e:0,o=0,a=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];o<a.length;o+=1)t.text.placedSymbolArray.get(a[o]).placedOrientation=n;r.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=i)},Wr.prototype.commit=function(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;var e=this.prevPlacement,r=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;var n=e?e.symbolFadeChange(t):1,i=e?e.opacities:{},o=e?e.variableOffsets:{},a=e?e.placedOrientations:{};for(var s in this.placements){var u=this.placements[s],c=i[s];r=c?(this.opacities[s]=new Ur(c,n,u.text,u.icon),r||u.text!==c.text.placed||u.icon!==c.icon.placed):(this.opacities[s]=new Ur(null,n,u.text,u.icon,u.skipFade),r||u.text||u.icon)}for(var l in i){var h=i[l];if(!this.opacities[l]){var p=new Ur(h,n,!1,!1);p.isHidden()||(this.opacities[l]=p,r=r||h.text.placed||h.icon.placed)}}for(var f in o)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=o[f]);for(var d in a)this.placedOrientations[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.placedOrientations[d]=a[d]);r?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},Wr.prototype.updateLayerOpacities=function(t,e){for(var r={},n=0,i=e;n<i.length;n+=1){var o=i[n],a=o.getBucket(t);a&&o.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,r,o.collisionBoxArray)}},Wr.prototype.updateBucketOpacities=function(E,C,t){var M=this;E.hasTextData()&&E.text.opacityVertexArray.clear(),E.hasIconData()&&E.icon.opacityVertexArray.clear(),E.hasIconCollisionBoxData()&&E.iconCollisionBox.collisionVertexArray.clear(),E.hasTextCollisionBoxData()&&E.textCollisionBox.collisionVertexArray.clear(),E.hasIconCollisionCircleData()&&E.iconCollisionCircle.collisionVertexArray.clear(),E.hasTextCollisionCircleData()&&E.textCollisionCircle.collisionVertexArray.clear();var e=E.layers[0].layout,T=new Ur(null,0,!1,!1,!0),r=e.get("text-allow-overlap"),n=e.get("icon-allow-overlap"),P=e.get("text-variable-anchor"),O="map"===e.get("text-rotation-alignment"),A="map"===e.get("text-pitch-alignment"),I="none"!==e.get("icon-text-fit"),L=new Ur(null,0,r&&(n||!E.hasIconData()||e.get("icon-optional")),n&&(r||!E.hasTextData()||e.get("text-optional")),!0);!E.collisionArrays&&t&&(E.hasIconCollisionBoxData()||E.hasIconCollisionCircleData()||E.hasTextCollisionBoxData()||E.hasTextCollisionCircleData())&&E.deserializeCollisionBoxes(t);for(var R=function(t,e,r){for(var n=0;n<e/4;n++)t.opacityVertexArray.emplaceBack(r)},i=function(t){var e=E.symbolInstances.get(t),r=e.numHorizontalGlyphVertices,n=e.numVerticalGlyphVertices,i=e.crossTileID,o=C[i],a=M.opacities[i];o?a=T:a||(M.opacities[i]=a=L),C[i]=!0;var s=0<e.numIconVertices,u=M.placedOrientations[e.crossTileID],c=u===vt.WritingMode.vertical,l=u===vt.WritingMode.horizontal||u===vt.WritingMode.horizontalOnly;if(0<r||0<n){var h=rn(a.text);R(E.text,r,c?on:h),R(E.text,n,l?on:h);var p=a.text.isHidden();[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach(function(t){0<=t&&(E.text.placedSymbolArray.get(t).hidden=p||c?1:0)}),0<=e.verticalPlacedTextSymbolIndex&&(E.text.placedSymbolArray.get(e.verticalPlacedTextSymbolIndex).hidden=p||l?1:0);var f=M.variableOffsets[e.crossTileID];f&&M.markUsedJustification(E,f.anchor,e,u);var d=M.placedOrientations[e.crossTileID];d&&(M.markUsedJustification(E,"left",e,d),M.markUsedOrientation(E,d,e))}if(s){var m=rn(a.icon),g=!(I&&e.verticalPlacedIconSymbolIndex&&c);0<=e.placedIconSymbolIndex&&(R(E.icon,e.numIconVertices,g?m:on),E.icon.placedSymbolArray.get(e.placedIconSymbolIndex).hidden=a.icon.isHidden()),0<=e.verticalPlacedIconSymbolIndex&&(R(E.icon,e.numVerticalIconVertices,g?on:m),E.icon.placedSymbolArray.get(e.verticalPlacedIconSymbolIndex).hidden=a.icon.isHidden())}if(E.hasIconCollisionBoxData()||E.hasIconCollisionCircleData()||E.hasTextCollisionBoxData()||E.hasTextCollisionCircleData()){var y=E.collisionArrays[t];if(y){var v=new vt.Point(0,0);if(y.textBox||y.verticalTextBox){var _=!0;if(P){var b=M.variableOffsets[i];b?(v=Hr(b.anchor,b.width,b.height,b.textOffset,b.textBoxScale),O&&v._rotate(A?M.transform.angle:-M.transform.angle)):_=!1}y.textBox&&Xr(E.textCollisionBox.collisionVertexArray,a.text.placed,!_||c,v.x,v.y),y.verticalTextBox&&Xr(E.textCollisionBox.collisionVertexArray,a.text.placed,!_||l,v.x,v.y)}var x=Boolean(!l&&y.verticalIconBox);y.iconBox&&Xr(E.iconCollisionBox.collisionVertexArray,a.icon.placed,x,I?v.x:0,I?v.y:0),y.verticalIconBox&&Xr(E.iconCollisionBox.collisionVertexArray,a.icon.placed,!x,I?v.x:0,I?v.y:0);var w=y.textCircles;if(w&&E.hasTextCollisionCircleData())for(var S=0;S<w.length;S+=5)Xr(E.textCollisionCircle.collisionVertexArray,a.text.placed,o||0===w[S+4])}}},o=0;o<E.symbolInstances.length;o++)i(o);E.sortFeatures(this.transform.angle),this.retainedQueryData[E.bucketInstanceId]&&(this.retainedQueryData[E.bucketInstanceId].featureSortOrder=E.featureSortOrder),E.hasTextData()&&E.text.opacityVertexBuffer&&E.text.opacityVertexBuffer.updateData(E.text.opacityVertexArray),E.hasIconData()&&E.icon.opacityVertexBuffer&&E.icon.opacityVertexBuffer.updateData(E.icon.opacityVertexArray),E.hasIconCollisionBoxData()&&E.iconCollisionBox.collisionVertexBuffer&&E.iconCollisionBox.collisionVertexBuffer.updateData(E.iconCollisionBox.collisionVertexArray),E.hasTextCollisionBoxData()&&E.textCollisionBox.collisionVertexBuffer&&E.textCollisionBox.collisionVertexBuffer.updateData(E.textCollisionBox.collisionVertexArray),E.hasIconCollisionCircleData()&&E.iconCollisionCircle.collisionVertexBuffer&&E.iconCollisionCircle.collisionVertexBuffer.updateData(E.iconCollisionCircle.collisionVertexArray),E.hasTextCollisionCircleData()&&E.textCollisionCircle.collisionVertexBuffer&&E.textCollisionCircle.collisionVertexBuffer.updateData(E.textCollisionCircle.collisionVertexArray)},Wr.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Wr.prototype.zoomAdjustment=function(t){return Math.max(0,(this.transform.zoom-t)/1.5)},Wr.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},Wr.prototype.stillRecent=function(t,e){var r=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*r>t},Wr.prototype.setStale=function(){this.stale=!0};var Yr=Math.pow(2,25),Zr=Math.pow(2,24),Kr=Math.pow(2,17),Jr=Math.pow(2,16),Qr=Math.pow(2,9),tn=Math.pow(2,8),en=Math.pow(2,1);function rn(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,r=Math.floor(127*t.opacity);return r*Yr+e*Zr+r*Kr+e*Jr+r*Qr+e*tn+r*en+e}function nn(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}var on=0;nn.prototype.continuePlacement=function(t,e,r,n,i){for(var o=this._bucketParts;this._currentTileIndex<t.length;)if(e.getBucketParts(o,n,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(function(t,e){return t.sortKey-e.sortKey}));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,r),this._currentPartIndex++,i())return!0;return!1};function an(t,e,r,n,i,o,a){this.placement=new Wr(t,i,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1}an.prototype.isDone=function(){return this._done},an.prototype.continuePlacement=function(t,e,r){for(var n=this,i=vt.browser.now(),o=function(){var t=vt.browser.now()-i;return!n._forceFullPlacement&&2<t};0<=this._currentPlacementIndex;){var a=e[t[this._currentPlacementIndex]],s=this.placement.collisionIndex.transform.zoom;if("symbol"===a.type&&(!a.minzoom||a.minzoom<=s)&&(!a.maxzoom||a.maxzoom>s)){if(this._inProgressLayer||(this._inProgressLayer=new nn(a)),this._inProgressLayer.continuePlacement(r[a.source],this.placement,this._showCollisionBoxes,a,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},an.prototype.commit=function(t){return this.placement.commit(t),this.placement};function sn(t,e,r){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=r;for(var n=0;n<e.length;n++){var i=e.get(n),o=i.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,t)})}}var un=512/vt.EXTENT/2;sn.prototype.getScaledCoordinates=function(t,e){var r=un/Math.pow(2,e.canonical.z-this.tileID.canonical.z);return{x:Math.floor((e.canonical.x*vt.EXTENT+t.anchorX)*r),y:Math.floor((e.canonical.y*vt.EXTENT+t.anchorY)*r)}},sn.prototype.findMatches=function(t,e,r){for(var n=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),i=0;i<t.length;i++){var o=t.get(i);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a)for(var s=this.getScaledCoordinates(o,e),u=0,c=a;u<c.length;u+=1){var l=c[u];if(Math.abs(l.coord.x-s.x)<=n&&Math.abs(l.coord.y-s.y)<=n&&!r[l.crossTileID]){r[l.crossTileID]=!0,o.crossTileID=l.crossTileID;break}}}}};function cn(){this.maxCrossTileID=0}cn.prototype.generate=function(){return++this.maxCrossTileID};function ln(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}ln.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var r in this.indexes){var n=this.indexes[r],i={};for(var o in n){var a=n[o];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+e),i[a.tileID.key]=a}this.indexes[r]=i}this.lng=t},ln.prototype.addBucket=function(t,e,r){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var n=0;n<e.symbolInstances.length;n++)e.symbolInstances.get(n).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var i=this.usedCrossTileIDs[t.overscaledZ];for(var o in this.indexes){var a=this.indexes[o];if(Number(o)>t.overscaledZ)for(var s in a){var u=a[s];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,i)}else{var c=a[t.scaledTo(Number(o)).key];c&&c.findMatches(e.symbolInstances,t,i)}}for(var l=0;l<e.symbolInstances.length;l++){var h=e.symbolInstances.get(l);h.crossTileID||(h.crossTileID=r.generate(),i[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new sn(t,e.symbolInstances,e.bucketInstanceId),!0},ln.prototype.removeBucketCrossTileIDs=function(t,e){for(var r in e.indexedSymbolInstances)for(var n=0,i=e.indexedSymbolInstances[r];n<i.length;n+=1)delete this.usedCrossTileIDs[t][i[n].crossTileID]},ln.prototype.removeStaleBuckets=function(t){var e=!1;for(var r in this.indexes){var n=this.indexes[r];for(var i in n)t[n[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,n[i]),delete n[i],e=!0)}return e};function hn(){this.layerIndexes={},this.crossTileIDs=new cn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}hn.prototype.addLayer=function(t,e,r){var n=this.layerIndexes[t.id];void 0===n&&(n=this.layerIndexes[t.id]=new ln);var i=!1,o={};n.handleWrapJump(r);for(var a=0,s=e;a<s.length;a+=1){var u=s[a],c=u.getBucket(t);c&&t.id===c.layerIds[0]&&(c.bucketInstanceId||(c.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(u.tileID,c,this.crossTileIDs)&&(i=!0),o[c.bucketInstanceId]=!0)}return n.removeStaleBuckets(o)&&(i=!0),i},hn.prototype.pruneUnusedLayers=function(t){var e={};for(var r in t.forEach(function(t){e[t]=!0}),this.layerIndexes)e[r]||delete this.layerIndexes[r]};function pn(t,e){return vt.emitValidationErrors(t,e&&e.filter(function(t){return"source.canvas"!==t.identifier}))}var fn,dn=vt.pick(yr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),mn=vt.pick(yr,["setCenter","setZoom","setBearing","setPitch"]),gn=function(){var t={},e=vt.styleSpec.$version;for(var r in vt.styleSpec.$root){var n,i=vt.styleSpec.$root[r];i.required&&null!=(n="version"===r?e:"array"===i.type?[]:{})&&(t[r]=n)}return t}(),yn=((fn=vt.Evented)&&(vn.__proto__=fn),((vn.prototype=Object.create(fn&&fn.prototype)).constructor=vn).prototype.loadURL=function(t,e){var r=this;void 0===e&&(e={}),this.fire(new vt.Event("dataloading",{dataType:"style"}));var n="boolean"==typeof e.validate?e.validate:!vt.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,e.accessToken);var i=this.map._requestManager.transformRequest(t,vt.ResourceType.Style);this._request=vt.getJSON(i,function(t,e){r._request=null,t?r.fire(new vt.ErrorEvent(t)):e&&r._load(e,n)})},vn.prototype.loadJSON=function(t,e){var r=this;void 0===e&&(e={}),this.fire(new vt.Event("dataloading",{dataType:"style"})),this._request=vt.browser.frame(function(){r._request=null,r._load(t,!1!==e.validate)})},vn.prototype.loadEmpty=function(){this.fire(new vt.Event("dataloading",{dataType:"style"})),this._load(gn,!1)},vn.prototype._load=function(t,e){if(!e||!pn(this,vt.validateStyle(t))){for(var r in this._loaded=!0,(this.stylesheet=t).sources)this.addSource(r,t.sources[r],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);var n=gr(this.stylesheet.layers);this._order=n.map(function(t){return t.id}),this._layers={},this._serializedLayers={};for(var i=0,o=n;i<o.length;i+=1){var a=o[i];(a=vt.createStyleLayer(a)).setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=a,this._serializedLayers[a.id]=a.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new E(this.stylesheet.light),this.fire(new vt.Event("data",{dataType:"style"})),this.fire(new vt.Event("style.load"))}},vn.prototype._loadSprite=function(t){var e,r,d,m,g,y,n,i,o,a=this;function s(){if(y)d(y);else if(m&&g){var t=vt.browser.getImageData(g),e={};for(var r in m){var n=m[r],i=n.width,o=n.height,a=n.x,s=n.y,u=n.sdf,c=n.pixelRatio,l=n.stretchX,h=n.stretchY,p=n.content,f=new vt.RGBAImage({width:i,height:o});vt.RGBAImage.copy(t,f,{x:a,y:s},{x:0,y:0},{width:i,height:o}),e[r]={data:f,pixelRatio:c,sdf:u,stretchX:l,stretchY:h,content:p}}d(null,e)}}this._spriteRequest=(e=t,r=this.map._requestManager,d=function(t,e){if(a._spriteRequest=null,t)a.fire(new vt.ErrorEvent(t));else if(e)for(var r in e)a.imageManager.addImage(r,e[r]);a.imageManager.setLoaded(!0),a._availableImages=a.imageManager.listImages(),a.dispatcher.broadcast("setImages",a._availableImages),a.fire(new vt.Event("data",{dataType:"style"}))},n=1<vt.browser.devicePixelRatio?"@2x":"",i=vt.getJSON(r.transformRequest(r.normalizeSpriteURL(e,n,".json"),vt.ResourceType.SpriteJSON),function(t,e){i=null,y||(y=t,m=e,s())}),o=vt.getImage(r.transformRequest(r.normalizeSpriteURL(e,n,".png"),vt.ResourceType.SpriteImage),function(t,e){o=null,y||(y=t,g=e,s())}),{cancel:function(){i&&(i.cancel(),i=null),o&&(o.cancel(),o=null)}})},vn.prototype._validateLayer=function(t){var e=this.sourceCaches[t.source];if(e){var r=t.sourceLayer;if(r){var n=e.getSource();("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(r))&&this.fire(new vt.ErrorEvent(new Error('Source layer "'+r+'" does not exist on source "'+n.id+'" as specified by style layer "'+t.id+'"')))}}},vn.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},vn.prototype._serializeLayers=function(t){for(var e=[],r=0,n=t;r<n.length;r+=1){var i=this._layers[n[r]];"custom"!==i.type&&e.push(i.serialize())}return e},vn.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},vn.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},vn.prototype.update=function(t){if(this._loaded){var e=this._changed;if(this._changed){var r=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);for(var i in(r.length||n.length)&&this._updateWorkerLayers(r,n),this._updatedSources){var o=this._updatedSources[i];"reload"===o?this._reloadSource(i):"clear"===o&&this._clearSource(i)}for(var a in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[a].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}for(var s in this.sourceCaches)this.sourceCaches[s].used=!1;for(var u=0,c=this._order;u<c.length;u+=1){var l=this._layers[c[u]];l.recalculate(t,this._availableImages),!l.isHidden(t.zoom)&&l.source&&(this.sourceCaches[l.source].used=!0)}this.light.recalculate(t),this.z=t.zoom,e&&this.fire(new vt.Event("data",{dataType:"style"}))}},vn.prototype._updateTilesForChangedImages=function(){var t=Object.keys(this._changedImages);if(t.length){for(var e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}},vn.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},vn.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},vn.prototype.setState=function(t){var e=this;if(this._checkLoaded(),pn(this,vt.validateStyle(t)))return!1;(t=vt.clone$1(t)).layers=gr(t.layers);var r=function(t,e){if(!t)return[{command:yr.setStyle,args:[e]}];var r=[];try{if(!vt.deepEqual(t.version,e.version))return[{command:yr.setStyle,args:[e]}];vt.deepEqual(t.center,e.center)||r.push({command:yr.setCenter,args:[e.center]}),vt.deepEqual(t.zoom,e.zoom)||r.push({command:yr.setZoom,args:[e.zoom]}),vt.deepEqual(t.bearing,e.bearing)||r.push({command:yr.setBearing,args:[e.bearing]}),vt.deepEqual(t.pitch,e.pitch)||r.push({command:yr.setPitch,args:[e.pitch]}),vt.deepEqual(t.sprite,e.sprite)||r.push({command:yr.setSprite,args:[e.sprite]}),vt.deepEqual(t.glyphs,e.glyphs)||r.push({command:yr.setGlyphs,args:[e.glyphs]}),vt.deepEqual(t.transition,e.transition)||r.push({command:yr.setTransition,args:[e.transition]}),vt.deepEqual(t.light,e.light)||r.push({command:yr.setLight,args:[e.light]});var n={},i=[];!function(t,e,r,n){var i,o,a,s;for(i in e=e||{},t=t||{})t.hasOwnProperty(i)&&(e.hasOwnProperty(i)||_r(i,r,n));for(i in e)e.hasOwnProperty(i)&&(t.hasOwnProperty(i)?vt.deepEqual(t[i],e[i])||("geojson"===t[i].type&&"geojson"===e[i].type&&br(t,e,i)?r.push({command:yr.setGeoJSONSourceData,args:[i,e[i].data]}):(a=e,_r(o=i,s=r,n),vr(o,a,s))):vr(i,e,r))}(t.sources,e.sources,i,n);var o=[];t.layers&&t.layers.forEach(function(t){n[t.source]?r.push({command:yr.removeLayer,args:[t.id]}):o.push(t)}),r=r.concat(i),function(t,e,r){e=e||[];var n,i,o,a,s,u,c,l=(t=t||[]).map(wr),h=e.map(wr),p=t.reduce(Sr,{}),f=e.reduce(Sr,{}),d=l.slice(),m=Object.create(null);for(i=n=0;n<l.length;n++)f.hasOwnProperty(o=l[n])?i++:(r.push({command:yr.removeLayer,args:[o]}),d.splice(d.indexOf(o,i),1));for(i=n=0;n<h.length;n++)d[d.length-1-n]!==(o=h[h.length-1-n])&&(p.hasOwnProperty(o)?(r.push({command:yr.removeLayer,args:[o]}),d.splice(d.lastIndexOf(o,d.length-i),1)):i++,r.push({command:yr.addLayer,args:[f[o],u=d[d.length-n]]}),d.splice(d.length-n,0,o),m[o]=!0);for(n=0;n<h.length;n++)if(a=p[o=h[n]],s=f[o],!m[o]&&!vt.deepEqual(a,s))if(vt.deepEqual(a.source,s.source)&&vt.deepEqual(a["source-layer"],s["source-layer"])&&vt.deepEqual(a.type,s.type)){for(c in xr(a.layout,s.layout,r,o,null,yr.setLayoutProperty),xr(a.paint,s.paint,r,o,null,yr.setPaintProperty),vt.deepEqual(a.filter,s.filter)||r.push({command:yr.setFilter,args:[o,s.filter]}),vt.deepEqual(a.minzoom,s.minzoom)&&vt.deepEqual(a.maxzoom,s.maxzoom)||r.push({command:yr.setLayerZoomRange,args:[o,s.minzoom,s.maxzoom]}),a)a.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?xr(a[c],s[c],r,o,c.slice(6),yr.setPaintProperty):vt.deepEqual(a[c],s[c])||r.push({command:yr.setLayerProperty,args:[o,c,s[c]]}));for(c in s)s.hasOwnProperty(c)&&!a.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?xr(a[c],s[c],r,o,c.slice(6),yr.setPaintProperty):vt.deepEqual(a[c],s[c])||r.push({command:yr.setLayerProperty,args:[o,c,s[c]]}))}else r.push({command:yr.removeLayer,args:[o]}),u=d[d.lastIndexOf(o)+1],r.push({command:yr.addLayer,args:[s,u]})}(o,e.layers,r)}catch(t){console.warn("Unable to compute style diff:",t),r=[{command:yr.setStyle,args:[e]}]}return r}(this.serialize(),t).filter(function(t){return!(t.command in mn)});if(0===r.length)return!1;var n=r.filter(function(t){return!(t.command in dn)});if(0<n.length)throw new Error("Unimplemented: "+n.map(function(t){return t.command}).join(", ")+".");return r.forEach(function(t){"setTransition"!==t.command&&e[t.command].apply(e,t.args)}),this.stylesheet=t,!0},vn.prototype.addImage=function(t,e){if(this.getImage(t))return this.fire(new vt.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,e),this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.fire(new vt.Event("data",{dataType:"style"}))},vn.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},vn.prototype.getImage=function(t){return this.imageManager.getImage(t)},vn.prototype.removeImage=function(t){if(!this.getImage(t))return this.fire(new vt.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.fire(new vt.Event("data",{dataType:"style"}))},vn.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},vn.prototype.addSource=function(t,e,r){var n=this;if(void 0===r&&(r={}),this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error("There is already a source with this ID");if(!e.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(e).join(", ")+".");if(!(0<=["vector","raster","geojson","video","image"].indexOf(e.type)&&this._validate(vt.validateStyle.source,"sources."+t,e,null,r))){this.map&&this.map._collectResourceTiming&&(e.collectResourceTiming=!0);var i=this.sourceCaches[t]=new sr(t,e,this.dispatcher);i.style=this,i.setEventedParent(this,function(){return{isSourceLoaded:n.loaded(),source:i.serialize(),sourceId:t}}),i.onAdd(this.map),this._changed=!0}},vn.prototype.removeSource=function(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");for(var e in this._layers)if(this._layers[e].source===t)return this.fire(new vt.ErrorEvent(new Error('Source "'+t+'" cannot be removed while layer "'+e+'" is using it.')));var r=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],r.fire(new vt.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.clearTiles(),r.onRemove&&r.onRemove(this.map),this._changed=!0},vn.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},vn.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},vn.prototype.addLayer=function(t,e,r){void 0===r&&(r={}),this._checkLoaded();var n=t.id;if(this.getLayer(n))this.fire(new vt.ErrorEvent(new Error('Layer with id "'+n+'" already exists on this map')));else{var i;if("custom"===t.type){if(pn(this,vt.validateCustomStyleLayer(t)))return;i=vt.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(n,t.source),t=vt.clone$1(t),t=vt.extend(t,{source:n})),this._validate(vt.validateStyle.layer,"layers."+n,t,{arrayIndex:-1},r))return;i=vt.createStyleLayer(t),this._validateLayer(i),i.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[i.id]=i.serialize()}var o=e?this._order.indexOf(e):this._order.length;if(e&&-1===o)this.fire(new vt.ErrorEvent(new Error('Layer with id "'+e+'" does not exist on this map.')));else{if(this._order.splice(o,0,n),this._layerOrderChanged=!0,this._layers[n]=i,this._removedLayers[n]&&i.source&&"custom"!==i.type){var a=this._removedLayers[n];delete this._removedLayers[n],a.type!==i.type?this._updatedSources[i.source]="clear":(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause())}this._updateLayer(i),i.onAdd&&i.onAdd(this.map)}}},vn.prototype.moveLayer=function(t,e){if(this._checkLoaded(),this._changed=!0,this._layers[t]){if(t!==e){var r=this._order.indexOf(t);this._order.splice(r,1);var n=e?this._order.indexOf(e):this._order.length;e&&-1===n?this.fire(new vt.ErrorEvent(new Error('Layer with id "'+e+'" does not exist on this map.'))):(this._order.splice(n,0,t),this._layerOrderChanged=!0)}}else this.fire(new vt.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be moved.")))},vn.prototype.removeLayer=function(t){this._checkLoaded();var e=this._layers[t];if(e){e.setEventedParent(null);var r=this._order.indexOf(t);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=e,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],e.onRemove&&e.onRemove(this.map)}else this.fire(new vt.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be removed.")))},vn.prototype.getLayer=function(t){return this._layers[t]},vn.prototype.hasLayer=function(t){return t in this._layers},vn.prototype.setLayerZoomRange=function(t,e,r){this._checkLoaded();var n=this.getLayer(t);n?n.minzoom===e&&n.maxzoom===r||(null!=e&&(n.minzoom=e),null!=r&&(n.maxzoom=r),this._updateLayer(n)):this.fire(new vt.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot have zoom extent.")))},vn.prototype.setFilter=function(t,e,r){void 0===r&&(r={}),this._checkLoaded();var n=this.getLayer(t);if(n){if(!vt.deepEqual(n.filter,e))return null==e?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(vt.validateStyle.filter,"layers."+n.id+".filter",e,null,r)||(n.filter=vt.clone$1(e),this._updateLayer(n)))}else this.fire(new vt.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be filtered.")))},vn.prototype.getFilter=function(t){return vt.clone$1(this.getLayer(t).filter)},vn.prototype.setLayoutProperty=function(t,e,r,n){void 0===n&&(n={}),this._checkLoaded();var i=this.getLayer(t);i?vt.deepEqual(i.getLayoutProperty(e),r)||(i.setLayoutProperty(e,r,n),this._updateLayer(i)):this.fire(new vt.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")))},vn.prototype.getLayoutProperty=function(t,e){var r=this.getLayer(t);if(r)return r.getLayoutProperty(e);this.fire(new vt.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style.")))},vn.prototype.setPaintProperty=function(t,e,r,n){void 0===n&&(n={}),this._checkLoaded();var i=this.getLayer(t);i?vt.deepEqual(i.getPaintProperty(e),r)||(i.setPaintProperty(e,r,n)&&this._updateLayer(i),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new vt.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")))},vn.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},vn.prototype.setFeatureState=function(t,e){this._checkLoaded();var r=t.source,n=t.sourceLayer,i=this.sourceCaches[r];if(void 0!==i){var o=i.getSource().type;"geojson"===o&&n?this.fire(new vt.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==o||n?(void 0===t.id&&this.fire(new vt.ErrorEvent(new Error("The feature id parameter must be provided."))),i.setFeatureState(n,t.id,e)):this.fire(new vt.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new vt.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},vn.prototype.removeFeatureState=function(t,e){this._checkLoaded();var r=t.source,n=this.sourceCaches[r];if(void 0!==n){var i=n.getSource().type,o="vector"===i?t.sourceLayer:void 0;"vector"!==i||o?e&&"string"!=typeof t.id&&"number"!=typeof t.id?this.fire(new vt.ErrorEvent(new Error("A feature id is requred to remove its specific state property."))):n.removeFeatureState(o,t.id,e):this.fire(new vt.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new vt.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},vn.prototype.getFeatureState=function(t){this._checkLoaded();var e=t.source,r=t.sourceLayer,n=this.sourceCaches[e];if(void 0!==n){if("vector"!==n.getSource().type||r)return void 0===t.id&&this.fire(new vt.ErrorEvent(new Error("The feature id parameter must be provided."))),n.getFeatureState(r,t.id);this.fire(new vt.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new vt.ErrorEvent(new Error("The source '"+e+"' does not exist in the map's style.")))},vn.prototype.getTransition=function(){return vt.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},vn.prototype.serialize=function(){return vt.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:vt.mapObject(this.sourceCaches,function(t){return t.serialize()}),layers:this._serializeLayers(this._order)},function(t){return void 0!==t})},vn.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},vn.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,r=function(t){return"fill-extrusion"===e._layers[t].type},n={},i=[],o=this._order.length-1;0<=o;o--){var a=this._order[o];if(r(a)){n[a]=o;for(var s=0,u=t;s<u.length;s+=1){var c=u[s][a];if(c)for(var l=0,h=c;l<h.length;l+=1)i.push(h[l])}}}i.sort(function(t,e){return e.intersectionZ-t.intersectionZ});for(var p=[],f=this._order.length-1;0<=f;f--){var d=this._order[f];if(r(d))for(var m=i.length-1;0<=m;m--){var g=i[m].feature;if(n[g.layer.id]<f)break;p.push(g),i.pop()}else for(var y=0,v=t;y<v.length;y+=1){var _=v[y][d];if(_)for(var b=0,x=_;b<x.length;b+=1)p.push(x[b].feature)}}return p},vn.prototype.queryRenderedFeatures=function(t,e,r){e&&e.filter&&this._validate(vt.validateStyle.filter,"queryRenderedFeatures.filter",e.filter,null,e);var n={};if(e&&e.layers){if(!Array.isArray(e.layers))return this.fire(new vt.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var i=0,o=e.layers;i<o.length;i+=1){var a=o[i],s=this._layers[a];if(!s)return this.fire(new vt.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be queried for features."))),[];n[s.source]=!0}}var u=[];for(var c in e.availableImages=this._availableImages,this.sourceCaches)e.layers&&!n[c]||u.push(J(this.sourceCaches[c],this._layers,this._serializedLayers,t,e,r));return this.placement&&u.push(function(s,u,i,t,c,e,r){for(var l={},h=e.queryRenderedSymbols(t),n=[],o=0,a=Object.keys(h).map(Number);o<a.length;o+=1)n.push(r[a[o]]);n.sort(Q);for(var p=function(){var i=d[f],t=i.featureIndex.lookupSymbolFeatures(h[i.bucketInstanceId],u,i.bucketIndex,i.sourceLayerIndex,c.filter,c.layers,c.availableImages,s);for(var e in t){var r=l[e]=l[e]||[],n=t[e];n.sort(function(t,e){var r=i.featureSortOrder;if(r){var n=r.indexOf(t.featureIndex);return r.indexOf(e.featureIndex)-n}return e.featureIndex-t.featureIndex});for(var o=0,a=n;o<a.length;o+=1)r.push(a[o])}},f=0,d=n;f<d.length;f+=1)p();function m(n){l[n].forEach(function(t){var e=t.feature,r=i[s[n].source].getFeatureState(e.layer["source-layer"],e.id);e.source=e.layer.source,e.layer["source-layer"]&&(e.sourceLayer=e.layer["source-layer"]),e.state=r})}for(var g in l)m(g);return l}(this._layers,this._serializedLayers,this.sourceCaches,t,e,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(u)},vn.prototype.querySourceFeatures=function(t,e){e&&e.filter&&this._validate(vt.validateStyle.filter,"querySourceFeatures.filter",e.filter,null,e);var r=this.sourceCaches[t];return r?function(e,t){for(var r=e.getRenderableIds().map(function(t){return e.getTileByID(t)}),n=[],i={},o=0;o<r.length;o++){var a=r[o],s=a.tileID.canonical.key;i[s]||(i[s]=!0,a.querySourceFeatures(n,t))}return n}(r,e):[]},vn.prototype.addSourceType=function(t,e,r){return vn.getSourceType(t)?r(new Error('A source type called "'+t+'" already exists.')):(vn.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},r):r(null,null))},vn.prototype.getLight=function(){return this.light.getLight()},vn.prototype.setLight=function(t,e){void 0===e&&(e={}),this._checkLoaded();var r=this.light.getLight(),n=!1;for(var i in t)if(!vt.deepEqual(t[i],r[i])){n=!0;break}if(n){var o={now:vt.browser.now(),transition:vt.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,e),this.light.updateTransitions(o)}},vn.prototype._validate=function(t,e,r,n,i){return void 0===i&&(i={}),(!i||!1!==i.validate)&&pn(this,t.call(vt.validateStyle,vt.extend({key:e,style:this.serialize(),value:r,styleSpec:vt.styleSpec},n)))},vn.prototype._remove=function(){for(var t in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),vt.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[t].setEventedParent(null);for(var e in this.sourceCaches)this.sourceCaches[e].clearTiles(),this.sourceCaches[e].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},vn.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},vn.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},vn.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},vn.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},vn.prototype._updatePlacement=function(t,e,r,n,i){void 0===i&&(i=!1);for(var o=!1,a=!1,s={},u=0,c=this._order;u<c.length;u+=1){var l=this._layers[c[u]];if("symbol"===l.type){if(!s[l.source]){var h=this.sourceCaches[l.source];s[l.source]=h.getRenderableIds(!0).map(function(t){return h.getTileByID(t)}).sort(function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)})}var p=this.crossTileSymbolIndex.addLayer(l,s[l.source],t.center.lng);o=o||p}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((i=i||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(vt.browser.now(),t.zoom))&&(this.pauseablePlacement=new an(t,this._order,i,e,r,n,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,s),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(vt.browser.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(var f=0,d=this._order;f<d.length;f+=1){var m=this._layers[d[f]];"symbol"===m.type&&this.placement.updateLayerOpacities(m,s[m.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(vt.browser.now())},vn.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},vn.prototype.getImages=function(t,e,r){this.imageManager.getImages(e.icons,r),this._updateTilesForChangedImages();var n=this.sourceCaches[e.source];n&&n.setDependencies(e.tileID.key,e.type,e.icons)},vn.prototype.getGlyphs=function(t,e,r){this.glyphManager.getGlyphs(e.stacks,r)},vn.prototype.getResource=function(t,e,r){return vt.makeRequest(e,r)},vn);function vn(t,e){var o=this;void 0===e&&(e={}),fn.call(this),this.map=t,this.dispatcher=new M(fr=fr||new pr,this),this.imageManager=new l,this.imageManager.setEventedParent(this),this.glyphManager=new v(t._requestManager,e.localIdeographFontFamily),this.lineAtlas=new x(256,512),this.crossTileSymbolIndex=new hn,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new vt.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",vt.getReferrer());var n=this;this._rtlTextPluginCallback=vn.registerForPluginStateChange(function(t){n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},function(t,e){if(vt.triggerPluginCompletionEvent(t),e&&e.every(function(t){return t}))for(var r in n.sourceCaches)n.sourceCaches[r].reload()})}),this.on("data",function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var r=e.getSource();if(r&&r.vectorLayerIds)for(var n in o._layers){var i=o._layers[n];i.source===r.id&&o._validateLayer(i)}}}})}yn.getSourceType=function(t){return q[t]},yn.setSourceType=function(t,e){q[t]=e},yn.registerForPluginStateChange=vt.registerForPluginStateChange;var _n=vt.createLayout([{name:"a_pos",type:"Int16",components:2}]),bn=$n("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),xn=$n("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),wn=$n("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Sn=$n("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),En=$n("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Cn=$n("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),Mn=$n("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Tn=$n("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Pn=$n("uniform float u_overscale_factor;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {float alpha=0.5;vec4 color=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {color=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {color*=.2;}float extrude_scale_length=length(v_extrude_scale);float extrude_length=length(v_extrude)*extrude_scale_length;float stroke_width=15.0*extrude_scale_length/u_overscale_factor;float radius=v_radius*extrude_scale_length;float distance_to_edge=abs(extrude_length-radius);float opacity_t=smoothstep(-stroke_width,0.0,-distance_to_edge);gl_FragColor=opacity_t*color;}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);highp float padding_factor=1.2;gl_Position.xy+=a_extrude*u_extrude_scale*padding_factor*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;v_radius=abs(a_extrude.y);v_extrude=a_extrude*padding_factor;v_extrude_scale=u_extrude_scale*u_camera_to_center_distance*collision_perspective_ratio;}"),On=$n("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),An=$n("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),In=$n("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Ln=$n("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Rn=$n("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),Nn=$n("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),kn=$n("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),Dn=$n("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform float u_maxzoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggeration=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/ pow(2.0,(u_zoom-u_maxzoom)*exaggeration+19.2562-u_zoom);gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),jn=$n("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),zn=$n("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),Fn=$n("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,vec2(v_lineprogress,0.5));gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define MAX_LINE_DISTANCE 32767.0\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_lineprogress=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0/MAX_LINE_DISTANCE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),Bn=$n("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),Un=$n("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),Vn=$n("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Gn=$n("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),qn=$n("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),Hn=$n("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function $n(t,e){var r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,s={};return{fragmentSource:t=t.replace(r,function(t,e,r,n,i){return s[i]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nvarying "+r+" "+n+" "+i+";\n#else\nuniform "+r+" "+n+" u_"+i+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+i+"\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n"}),vertexSource:e=e.replace(r,function(t,e,r,n,i){var o="float"===n?"vec2":"vec4",a=i.match(/color/)?"color":o;return s[i]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+r+" "+o+" a_"+i+";\nvarying "+r+" "+n+" "+i+";\n#else\nuniform "+r+" "+n+" u_"+i+";\n#endif\n":"vec4"==a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = a_"+i+";\n#else\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+r+" "+o+" a_"+i+";\n#else\nuniform "+r+" "+n+" u_"+i+";\n#endif\n":"vec4"==a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+r+" "+n+" "+i+" = a_"+i+";\n#else\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+r+" "+n+" "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n"})}}function Wn(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}var Xn=Object.freeze({__proto__:null,prelude:bn,background:xn,backgroundPattern:wn,circle:Sn,clippingMask:En,heatmap:Cn,heatmapTexture:Mn,collisionBox:Tn,collisionCircle:Pn,debug:On,fill:An,fillOutline:In,fillOutlinePattern:Ln,fillPattern:Rn,fillExtrusion:Nn,fillExtrusionPattern:kn,hillshadePrepare:Dn,hillshade:jn,line:zn,lineGradient:Fn,linePattern:Bn,lineSDF:Un,raster:Vn,symbolIcon:Gn,symbolSDF:qn,symbolTextAndIcon:Hn});Wn.prototype.bind=function(t,e,r,n,i,o,a,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==n.length,c=0;!u&&c<n.length;c++)this.boundPaintVertexBuffers[c]!==n[c]&&(u=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===r&&!u&&this.boundIndexBuffer===i&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===a&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind()):this.freshBind(e,r,n,i,o,a,s)},Wn.prototype.freshBind=function(t,e,r,n,i,o,a){var s,u=t.numAttributes,c=this.context,l=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=n,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=c.currentNumAttributes||0;for(var h=u;h<s;h++)l.disableVertexAttribArray(h)}e.enableAttributes(l,t);for(var p=0,f=r;p<f.length;p+=1)f[p].enableAttributes(l,t);o&&o.enableAttributes(l,t),a&&a.enableAttributes(l,t),e.bind(),e.setVertexAttribPointers(l,t,i);for(var d=0,m=r;d<m.length;d+=1){var g=m[d];g.bind(),g.setVertexAttribPointers(l,t,i)}o&&(o.bind(),o.setVertexAttribPointers(l,t,i)),n&&n.bind(),a&&(a.bind(),a.setVertexAttribPointers(l,t,i)),c.currentNumAttributes=u},Wn.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};function Yn(t,e,r,n,i){var o=t.gl;this.program=o.createProgram();var a=r?r.defines():[];i&&a.push("#define OVERDRAW_INSPECTOR;");var s=a.concat(bn.fragmentSource,e.fragmentSource).join("\n"),u=a.concat(bn.vertexSource,e.vertexSource).join("\n"),c=o.createShader(o.FRAGMENT_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(c,s),o.compileShader(c),o.attachShader(this.program,c);var l=o.createShader(o.VERTEX_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(l,u),o.compileShader(l),o.attachShader(this.program,l);for(var h=r?r.layoutAttributes:[],p=0;p<h.length;p++)o.bindAttribLocation(this.program,p,h[p].name);o.linkProgram(this.program),this.numAttributes=o.getProgramParameter(this.program,o.ACTIVE_ATTRIBUTES),this.attributes={};for(var f={},d=0;d<this.numAttributes;d++){var m=o.getActiveAttrib(this.program,d);m&&(this.attributes[m.name]=o.getAttribLocation(this.program,m.name))}for(var g=o.getProgramParameter(this.program,o.ACTIVE_UNIFORMS),y=0;y<g;y++){var v=o.getActiveUniform(this.program,y);v&&(f[v.name]=o.getUniformLocation(this.program,v.name))}this.fixedUniforms=n(t,f),this.binderUniforms=r?r.getUniforms(t,f):[]}}}function Zn(t,e,r){var n=1/Fr(r,1,e.transform.tileZoom),i=Math.pow(2,r.tileID.overscaledZ),o=r.tileSize*Math.pow(2,e.transform.tileZoom)/i,a=o*(r.tileID.canonical.x+r.tileID.wrap*i),s=o*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[n,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[a>>16,s>>16],u_pixel_coord_lower:[65535&a,65535&s]}}Yn.prototype.draw=function(t,e,r,n,i,o,a,s,u,c,l,h,p,f,d,m){var g,y=t.gl;if(!this.failedToCreate){for(var v in t.program.set(this.program),t.setDepthMode(r),t.setStencilMode(n),t.setColorMode(i),t.setCullFace(o),this.fixedUniforms)this.fixedUniforms[v].set(a[v]);f&&f.setUniforms(t,this.binderUniforms,h,{zoom:p});for(var _=((g={})[y.LINES]=2,g[y.TRIANGLES]=3,g[y.LINE_STRIP]=1,g)[e],b=0,x=l.get();b<x.length;b+=1){var w=x[b],S=w.vaos||(w.vaos={});(S[s]||(S[s]=new Wn)).bind(t,this,u,f?f.getPaintVertexBuffers():[],c,w.vertexOffset,d,m),y.drawElements(e,w.primitiveLength*_,y.UNSIGNED_SHORT,w.primitiveOffset*_*2)}}};function Kn(t,e,r,n){var i=e.style.light,o=i.properties.get("position"),a=[o.x,o.y,o.z],s=vt.create$1();"viewport"===i.properties.get("anchor")&&vt.fromRotation(s,-e.transform.angle),vt.transformMat3(a,a,s);var u=i.properties.get("color");return{u_matrix:t,u_lightpos:a,u_lightintensity:i.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_vertical_gradient:+r,u_opacity:n}}function Jn(t){return{u_matrix:t}}function Qn(t,e,r,n){return vt.extend(Jn(t),Zn(r,e,n))}function ti(t,e,r,n){var i,o,a=t.transform;if("map"===n.paint.get("circle-pitch-alignment")){var s=Fr(r,1,a.zoom);i=!0,o=[s,s]}else i=!1,o=a.pixelsToGLUnits;return{u_camera_to_center_distance:a.cameraToCenterDistance,u_scale_with_map:+("map"===n.paint.get("circle-pitch-scale")),u_matrix:t.translatePosMatrix(e.posMatrix,r,n.paint.get("circle-translate"),n.paint.get("circle-translate-anchor")),u_pitch_with_map:+i,u_device_pixel_ratio:vt.browser.devicePixelRatio,u_extrude_scale:o}}function ei(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_camera_to_center_distance:new vt.Uniform1f(t,e.u_camera_to_center_distance),u_pixels_to_tile_units:new vt.Uniform1f(t,e.u_pixels_to_tile_units),u_extrude_scale:new vt.Uniform2f(t,e.u_extrude_scale),u_overscale_factor:new vt.Uniform1f(t,e.u_overscale_factor)}}function ri(t){return{u_matrix:t}}function ni(t,e,r){var n=t.transform;return{u_matrix:ci(t,e,r),u_ratio:1/Fr(e,1,n.zoom),u_device_pixel_ratio:vt.browser.devicePixelRatio,u_units_to_pixels:[1/n.pixelsToGLUnits[0],1/n.pixelsToGLUnits[1]]}}var ii=function(t,e,r){var n=Fr(r,1,e.zoom),i=Math.pow(2,e.zoom-r.tileID.overscaledZ),o=r.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:n,u_extrude_scale:[e.pixelsToGLUnits[0]/(n*i),e.pixelsToGLUnits[1]/(n*i)],u_overscale_factor:o}},oi=function(t,e,r){return void 0===r&&(r=1),{u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:r}},ai=function(t,e,r){var n=r.paint.get("hillshade-shadow-color"),i=r.paint.get("hillshade-highlight-color"),o=r.paint.get("hillshade-accent-color"),a=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);var s,u,c,l=!t.options.moving;return{u_matrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),l),u_image:0,u_latrange:(s=e.tileID,u=Math.pow(2,s.canonical.z),c=s.canonical.y,[new vt.MercatorCoordinate(0,c/u).toLngLat().lat,new vt.MercatorCoordinate(0,(c+1)/u).toLngLat().lat]),u_light:[r.paint.get("hillshade-exaggeration"),a],u_shadow:n,u_highlight:i,u_accent:o}},si=function(t,e,r){var n=e.stride,i=vt.create();return vt.ortho(i,0,vt.EXTENT,-vt.EXTENT,0,0,1),vt.translate(i,i,[0,-vt.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[n,n],u_zoom:t.overscaledZ,u_maxzoom:r,u_unpack:e.getUnpackVector()}};function ui(t,e){return 1/Fr(t,1,e.tileZoom)}function ci(t,e,r){return t.translatePosMatrix(e.tileID.posMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}function li(t,e,r,n,i){return{u_matrix:t,u_tl_parent:e,u_scale_parent:r,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(a=i.paint.get("raster-saturation"),0<a?1-1/(1.001-a):-a),u_contrast_factor:(o=i.paint.get("raster-contrast"),0<o?1/(1-o):1+o),u_spin_weights:function(t){t*=Math.PI/180;var e=Math.sin(t),r=Math.cos(t);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}(i.paint.get("raster-hue-rotate"))};var o,a}function hi(t,e,r,n,i,o,a,s,u,c){var l=i.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:l.cameraToCenterDistance,u_pitch:l.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:l.width/l.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+u,u_pitch_with_map:+n,u_texsize:c,u_texture:0}}function pi(t,e,r,n,i,o,a,s,u,c,l){var h=i.transform;return vt.extend(hi(t,e,r,n,i,o,a,s,u,c),{u_gamma_scale:n?Math.cos(h._pitch)*h.cameraToCenterDistance:1,u_device_pixel_ratio:vt.browser.devicePixelRatio,u_is_halo:+l})}var fi={fillExtrusion:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_lightpos:new vt.Uniform3f(t,e.u_lightpos),u_lightintensity:new vt.Uniform1f(t,e.u_lightintensity),u_lightcolor:new vt.Uniform3f(t,e.u_lightcolor),u_vertical_gradient:new vt.Uniform1f(t,e.u_vertical_gradient),u_opacity:new vt.Uniform1f(t,e.u_opacity)}},fillExtrusionPattern:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_lightpos:new vt.Uniform3f(t,e.u_lightpos),u_lightintensity:new vt.Uniform1f(t,e.u_lightintensity),u_lightcolor:new vt.Uniform3f(t,e.u_lightcolor),u_vertical_gradient:new vt.Uniform1f(t,e.u_vertical_gradient),u_height_factor:new vt.Uniform1f(t,e.u_height_factor),u_image:new vt.Uniform1i(t,e.u_image),u_texsize:new vt.Uniform2f(t,e.u_texsize),u_pixel_coord_upper:new vt.Uniform2f(t,e.u_pixel_coord_upper),u_pixel_coord_lower:new vt.Uniform2f(t,e.u_pixel_coord_lower),u_scale:new vt.Uniform3f(t,e.u_scale),u_fade:new vt.Uniform1f(t,e.u_fade),u_opacity:new vt.Uniform1f(t,e.u_opacity)}},fill:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix)}},fillPattern:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_image:new vt.Uniform1i(t,e.u_image),u_texsize:new vt.Uniform2f(t,e.u_texsize),u_pixel_coord_upper:new vt.Uniform2f(t,e.u_pixel_coord_upper),u_pixel_coord_lower:new vt.Uniform2f(t,e.u_pixel_coord_lower),u_scale:new vt.Uniform3f(t,e.u_scale),u_fade:new vt.Uniform1f(t,e.u_fade)}},fillOutline:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_world:new vt.Uniform2f(t,e.u_world)}},fillOutlinePattern:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_world:new vt.Uniform2f(t,e.u_world),u_image:new vt.Uniform1i(t,e.u_image),u_texsize:new vt.Uniform2f(t,e.u_texsize),u_pixel_coord_upper:new vt.Uniform2f(t,e.u_pixel_coord_upper),u_pixel_coord_lower:new vt.Uniform2f(t,e.u_pixel_coord_lower),u_scale:new vt.Uniform3f(t,e.u_scale),u_fade:new vt.Uniform1f(t,e.u_fade)}},circle:function(t,e){return{u_camera_to_center_distance:new vt.Uniform1f(t,e.u_camera_to_center_distance),u_scale_with_map:new vt.Uniform1i(t,e.u_scale_with_map),u_pitch_with_map:new vt.Uniform1i(t,e.u_pitch_with_map),u_extrude_scale:new vt.Uniform2f(t,e.u_extrude_scale),u_device_pixel_ratio:new vt.Uniform1f(t,e.u_device_pixel_ratio),u_matrix:new vt.UniformMatrix4f(t,e.u_matrix)}},collisionBox:ei,collisionCircle:ei,debug:function(t,e){return{u_color:new vt.UniformColor(t,e.u_color),u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_overlay:new vt.Uniform1i(t,e.u_overlay),u_overlay_scale:new vt.Uniform1f(t,e.u_overlay_scale)}},clippingMask:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix)}},heatmap:function(t,e){return{u_extrude_scale:new vt.Uniform1f(t,e.u_extrude_scale),u_intensity:new vt.Uniform1f(t,e.u_intensity),u_matrix:new vt.UniformMatrix4f(t,e.u_matrix)}},heatmapTexture:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_world:new vt.Uniform2f(t,e.u_world),u_image:new vt.Uniform1i(t,e.u_image),u_color_ramp:new vt.Uniform1i(t,e.u_color_ramp),u_opacity:new vt.Uniform1f(t,e.u_opacity)}},hillshade:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_image:new vt.Uniform1i(t,e.u_image),u_latrange:new vt.Uniform2f(t,e.u_latrange),u_light:new vt.Uniform2f(t,e.u_light),u_shadow:new vt.UniformColor(t,e.u_shadow),u_highlight:new vt.UniformColor(t,e.u_highlight),u_accent:new vt.UniformColor(t,e.u_accent)}},hillshadePrepare:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_image:new vt.Uniform1i(t,e.u_image),u_dimension:new vt.Uniform2f(t,e.u_dimension),u_zoom:new vt.Uniform1f(t,e.u_zoom),u_maxzoom:new vt.Uniform1f(t,e.u_maxzoom),u_unpack:new vt.Uniform4f(t,e.u_unpack)}},line:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_ratio:new vt.Uniform1f(t,e.u_ratio),u_device_pixel_ratio:new vt.Uniform1f(t,e.u_device_pixel_ratio),u_units_to_pixels:new vt.Uniform2f(t,e.u_units_to_pixels)}},lineGradient:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_ratio:new vt.Uniform1f(t,e.u_ratio),u_device_pixel_ratio:new vt.Uniform1f(t,e.u_device_pixel_ratio),u_units_to_pixels:new vt.Uniform2f(t,e.u_units_to_pixels),u_image:new vt.Uniform1i(t,e.u_image)}},linePattern:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_texsize:new vt.Uniform2f(t,e.u_texsize),u_ratio:new vt.Uniform1f(t,e.u_ratio),u_device_pixel_ratio:new vt.Uniform1f(t,e.u_device_pixel_ratio),u_image:new vt.Uniform1i(t,e.u_image),u_units_to_pixels:new vt.Uniform2f(t,e.u_units_to_pixels),u_scale:new vt.Uniform3f(t,e.u_scale),u_fade:new vt.Uniform1f(t,e.u_fade)}},lineSDF:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_ratio:new vt.Uniform1f(t,e.u_ratio),u_device_pixel_ratio:new vt.Uniform1f(t,e.u_device_pixel_ratio),u_units_to_pixels:new vt.Uniform2f(t,e.u_units_to_pixels),u_patternscale_a:new vt.Uniform2f(t,e.u_patternscale_a),u_patternscale_b:new vt.Uniform2f(t,e.u_patternscale_b),u_sdfgamma:new vt.Uniform1f(t,e.u_sdfgamma),u_image:new vt.Uniform1i(t,e.u_image),u_tex_y_a:new vt.Uniform1f(t,e.u_tex_y_a),u_tex_y_b:new vt.Uniform1f(t,e.u_tex_y_b),u_mix:new vt.Uniform1f(t,e.u_mix)}},raster:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_tl_parent:new vt.Uniform2f(t,e.u_tl_parent),u_scale_parent:new vt.Uniform1f(t,e.u_scale_parent),u_buffer_scale:new vt.Uniform1f(t,e.u_buffer_scale),u_fade_t:new vt.Uniform1f(t,e.u_fade_t),u_opacity:new vt.Uniform1f(t,e.u_opacity),u_image0:new vt.Uniform1i(t,e.u_image0),u_image1:new vt.Uniform1i(t,e.u_image1),u_brightness_low:new vt.Uniform1f(t,e.u_brightness_low),u_brightness_high:new vt.Uniform1f(t,e.u_brightness_high),u_saturation_factor:new vt.Uniform1f(t,e.u_saturation_factor),u_contrast_factor:new vt.Uniform1f(t,e.u_contrast_factor),u_spin_weights:new vt.Uniform3f(t,e.u_spin_weights)}},symbolIcon:function(t,e){return{u_is_size_zoom_constant:new vt.Uniform1i(t,e.u_is_size_zoom_constant),u_is_size_feature_constant:new vt.Uniform1i(t,e.u_is_size_feature_constant),u_size_t:new vt.Uniform1f(t,e.u_size_t),u_size:new vt.Uniform1f(t,e.u_size),u_camera_to_center_distance:new vt.Uniform1f(t,e.u_camera_to_center_distance),u_pitch:new vt.Uniform1f(t,e.u_pitch),u_rotate_symbol:new vt.Uniform1i(t,e.u_rotate_symbol),u_aspect_ratio:new vt.Uniform1f(t,e.u_aspect_ratio),u_fade_change:new vt.Uniform1f(t,e.u_fade_change),u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_label_plane_matrix:new vt.UniformMatrix4f(t,e.u_label_plane_matrix),u_coord_matrix:new vt.UniformMatrix4f(t,e.u_coord_matrix),u_is_text:new vt.Uniform1i(t,e.u_is_text),u_pitch_with_map:new vt.Uniform1i(t,e.u_pitch_with_map),u_texsize:new vt.Uniform2f(t,e.u_texsize),u_texture:new vt.Uniform1i(t,e.u_texture)}},symbolSDF:function(t,e){return{u_is_size_zoom_constant:new vt.Uniform1i(t,e.u_is_size_zoom_constant),u_is_size_feature_constant:new vt.Uniform1i(t,e.u_is_size_feature_constant),u_size_t:new vt.Uniform1f(t,e.u_size_t),u_size:new vt.Uniform1f(t,e.u_size),u_camera_to_center_distance:new vt.Uniform1f(t,e.u_camera_to_center_distance),u_pitch:new vt.Uniform1f(t,e.u_pitch),u_rotate_symbol:new vt.Uniform1i(t,e.u_rotate_symbol),u_aspect_ratio:new vt.Uniform1f(t,e.u_aspect_ratio),u_fade_change:new vt.Uniform1f(t,e.u_fade_change),u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_label_plane_matrix:new vt.UniformMatrix4f(t,e.u_label_plane_matrix),u_coord_matrix:new vt.UniformMatrix4f(t,e.u_coord_matrix),u_is_text:new vt.Uniform1i(t,e.u_is_text),u_pitch_with_map:new vt.Uniform1i(t,e.u_pitch_with_map),u_texsize:new vt.Uniform2f(t,e.u_texsize),u_texture:new vt.Uniform1i(t,e.u_texture),u_gamma_scale:new vt.Uniform1f(t,e.u_gamma_scale),u_device_pixel_ratio:new vt.Uniform1f(t,e.u_device_pixel_ratio),u_is_halo:new vt.Uniform1i(t,e.u_is_halo)}},symbolTextAndIcon:function(t,e){return{u_is_size_zoom_constant:new vt.Uniform1i(t,e.u_is_size_zoom_constant),u_is_size_feature_constant:new vt.Uniform1i(t,e.u_is_size_feature_constant),u_size_t:new vt.Uniform1f(t,e.u_size_t),u_size:new vt.Uniform1f(t,e.u_size),u_camera_to_center_distance:new vt.Uniform1f(t,e.u_camera_to_center_distance),u_pitch:new vt.Uniform1f(t,e.u_pitch),u_rotate_symbol:new vt.Uniform1i(t,e.u_rotate_symbol),u_aspect_ratio:new vt.Uniform1f(t,e.u_aspect_ratio),u_fade_change:new vt.Uniform1f(t,e.u_fade_change),u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_label_plane_matrix:new vt.UniformMatrix4f(t,e.u_label_plane_matrix),u_coord_matrix:new vt.UniformMatrix4f(t,e.u_coord_matrix),u_is_text:new vt.Uniform1i(t,e.u_is_text),u_pitch_with_map:new vt.Uniform1i(t,e.u_pitch_with_map),u_texsize:new vt.Uniform2f(t,e.u_texsize),u_texsize_icon:new vt.Uniform2f(t,e.u_texsize_icon),u_texture:new vt.Uniform1i(t,e.u_texture),u_texture_icon:new vt.Uniform1i(t,e.u_texture_icon),u_gamma_scale:new vt.Uniform1f(t,e.u_gamma_scale),u_device_pixel_ratio:new vt.Uniform1f(t,e.u_device_pixel_ratio),u_is_halo:new vt.Uniform1i(t,e.u_is_halo)}},background:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_opacity:new vt.Uniform1f(t,e.u_opacity),u_color:new vt.UniformColor(t,e.u_color)}},backgroundPattern:function(t,e){return{u_matrix:new vt.UniformMatrix4f(t,e.u_matrix),u_opacity:new vt.Uniform1f(t,e.u_opacity),u_image:new vt.Uniform1i(t,e.u_image),u_pattern_tl_a:new vt.Uniform2f(t,e.u_pattern_tl_a),u_pattern_br_a:new vt.Uniform2f(t,e.u_pattern_br_a),u_pattern_tl_b:new vt.Uniform2f(t,e.u_pattern_tl_b),u_pattern_br_b:new vt.Uniform2f(t,e.u_pattern_br_b),u_texsize:new vt.Uniform2f(t,e.u_texsize),u_mix:new vt.Uniform1f(t,e.u_mix),u_pattern_size_a:new vt.Uniform2f(t,e.u_pattern_size_a),u_pattern_size_b:new vt.Uniform2f(t,e.u_pattern_size_b),u_scale_a:new vt.Uniform1f(t,e.u_scale_a),u_scale_b:new vt.Uniform1f(t,e.u_scale_b),u_pixel_coord_upper:new vt.Uniform2f(t,e.u_pixel_coord_upper),u_pixel_coord_lower:new vt.Uniform2f(t,e.u_pixel_coord_lower),u_tile_units_to_pixels:new vt.Uniform1f(t,e.u_tile_units_to_pixels)}}};function di(t,e,r,n,i,o,a,s){for(var u=t.context,c=u.gl,l=t.useProgram(i?"collisionCircle":"collisionBox"),h=0;h<n.length;h++){var p=n[h],f=e.getTile(p),d=f.getBucket(r);if(d){var m=i?s?d.textCollisionCircle:d.iconCollisionCircle:s?d.textCollisionBox:d.iconCollisionBox;if(m){var g=p.posMatrix;0===o[0]&&0===o[1]||(g=t.translatePosMatrix(p.posMatrix,f,o,a)),l.draw(u,i?c.TRIANGLES:c.LINES,er.disabled,rr.disabled,t.colorModeForRenderPass(),ir.disabled,ii(g,t.transform,f),r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,null,t.transform.zoom,null,null,m.collisionVertexBuffer)}}}}function mi(t,e,r,n,i,o,a){di(t,e,r,n,!1,i,o,a),di(t,e,r,n,!0,i,o,a)}var gi=vt.identity(new Float32Array(16));function yi(t,e,r,n,i,o,a,s,u,c,l){var h,p,f,d,m,g,y,v,_,b,x=t.text.placedSymbolArray,w=t.text.dynamicLayoutVertexArray,S=t.icon.dynamicLayoutVertexArray,E={};w.clear();for(var C=0;C<x.length;C++){var M=x.get(C),T=M.hidden||!M.crossTileID||t.allowVerticalPlacement&&!M.placedOrientation?null:n[M.crossTileID];if(T){var P=new vt.Point(M.anchorX,M.anchorY),O=Tr(P,r?s:a),A=.5+o.cameraToCenterDistance/O.signedDistanceFromCamera*.5,I=i.evaluateSizeForFeature(t.textSizeData,c,M)*A/vt.ONE_EM;r&&(I*=t.tilePixelRatio/u);for(var L=(h=T.anchor,p=T.width,f=T.height,d=T.textOffset,m=T.textBoxScale,g=I,void 0,y=vt.getAnchorAlignment(h),v=-(y.horizontalAlign-.5)*p,_=-(y.verticalAlign-.5)*f,b=vt.evaluateVariableOffset(h,d),new vt.Point((v/m+b[0])*g,(_/m+b[1])*g)),R=r?Tr(P.add(L),a).point:O.point.add(e?L.rotate(-o.angle):L),N=t.allowVerticalPlacement&&M.placedOrientation===vt.WritingMode.vertical?Math.PI/2:0,k=0;k<M.numGlyphs;k++)vt.addDynamicAttributes(w,R,N);l&&0<=M.associatedIconIndex&&(E[M.associatedIconIndex]={shiftedAnchor:R,angle:N})}else kr(M.numGlyphs,w)}if(l){S.clear();for(var D=t.icon.placedSymbolArray,j=0;j<D.length;j++){var z=D.get(j);if(z.hidden)kr(z.numGlyphs,S);else{var F=E[j];if(F)for(var B=0;B<z.numGlyphs;B++)vt.addDynamicAttributes(S,F.shiftedAnchor,F.angle);else kr(z.numGlyphs,S)}}t.icon.dynamicLayoutVertexBuffer.updateData(S)}t.text.dynamicLayoutVertexBuffer.updateData(w)}function vi(t,e,r,n,i,o,a,s,u,c,l,h){for(var p=t.context,f=p.gl,d=t.transform,m="map"===s,g="map"===u,y=m&&"point"!==r.layout.get("symbol-placement"),v=m&&!g&&!y,_=void 0!==r.layout.get("symbol-sort-key").constantOr(1),b=t.depthModeForSublayer(0,er.ReadOnly),x=r.layout.get("text-variable-anchor"),w=[],S=0,E=n;S<E.length;S+=1){var C=E[S],M=e.getTile(C),T=M.getBucket(r);if(T){var P=i?T.text:T.icon;if(P&&P.segments.get().length){var O=P.programConfigurations.get(r.id),A=i||T.sdfIcons,I=i?T.textSizeData:T.iconSizeData,L=g||0!==d.pitch,R=t.useProgram((ht=A,pt=i,T.iconsInText&&pt?"symbolTextAndIcon":ht?"symbolSDF":"symbolIcon"),O),N=vt.evaluateSizeForZoom(I,d.zoom),k=void 0,D=[0,0],j=void 0,z=void 0,F=null,B=void 0;if(i)j=M.glyphAtlasTexture,z=f.LINEAR,k=M.glyphAtlasTexture.size,T.iconsInText&&(D=M.imageAtlasTexture.size,F=M.imageAtlasTexture,B=L||t.options.rotating||t.options.zooming||"composite"===I.kind||"camera"===I.kind?f.LINEAR:f.NEAREST);else{var U=1!==r.layout.get("icon-size").constantOr(0)||T.iconsNeedLinear;j=M.imageAtlasTexture,z=A||t.options.rotating||t.options.zooming||U||L?f.LINEAR:f.NEAREST,k=M.imageAtlasTexture.size}var V=Fr(M,1,t.transform.zoom),G=Cr(C.posMatrix,g,m,t.transform,V),q=Mr(C.posMatrix,g,m,t.transform,V),H=x&&T.hasTextData(),$="none"!==r.layout.get("icon-text-fit")&&H&&T.hasIconData();y&&Pr(T,C.posMatrix,t,i,G,q,g,c);var W=t.translatePosMatrix(C.posMatrix,M,o,a),X=y||i&&x||$?gi:G,Y=t.translatePosMatrix(q,M,o,a,!0),Z=A&&0!==r.paint.get(i?"text-halo-width":"icon-halo-width").constantOr(1),K={program:R,buffers:P,uniformValues:A?T.iconsInText?(et=I.kind,rt=N,nt=v,it=g,ot=t,at=W,st=X,ut=Y,ct=k,lt=D,vt.extend(pi(et,rt,nt,it,ot,at,st,ut,!0,ct,!0),{u_texsize_icon:lt,u_texture_icon:1})):pi(I.kind,N,v,g,t,W,X,Y,i,k,!0):hi(I.kind,N,v,g,t,W,X,Y,i,k),atlasTexture:j,atlasTextureIcon:F,atlasInterpolation:z,atlasInterpolationIcon:B,isSDF:A,hasHalo:Z};if(_)for(var J=0,Q=P.segments.get();J<Q.length;J+=1){var tt=Q[J];w.push({segments:new vt.SegmentVector([tt]),sortKey:tt.sortKey,state:K})}else w.push({segments:P.segments,sortKey:0,state:K})}}}var et,rt,nt,it,ot,at,st,ut,ct,lt,ht,pt;_&&w.sort(function(t,e){return t.sortKey-e.sortKey});for(var ft=0,dt=w;ft<dt.length;ft+=1){var mt=dt[ft],gt=mt.state;if(p.activeTexture.set(f.TEXTURE0),gt.atlasTexture.bind(gt.atlasInterpolation,f.CLAMP_TO_EDGE),gt.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),gt.atlasTextureIcon&&gt.atlasTextureIcon.bind(gt.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),gt.isSDF){var yt=gt.uniformValues;gt.hasHalo&&(yt.u_is_halo=1,_i(gt.buffers,mt.segments,r,t,gt.program,b,l,h,yt)),yt.u_is_halo=0}_i(gt.buffers,mt.segments,r,t,gt.program,b,l,h,gt.uniformValues)}}function _i(t,e,r,n,i,o,a,s,u){var c=n.context;i.draw(c,c.gl.TRIANGLES,o,a,s,ir.disabled,u,r.id,t.layoutVertexBuffer,t.indexBuffer,e,r.paint,n.transform.zoom,t.programConfigurations.get(r.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function bi(t,e,r,n,i,o,a){var s,u,c,l,h,p,f,d,m,g,y=t.context.gl,v=r.paint.get("fill-pattern"),_=v&&v.constantOr(1),b=r.getCrossfadeParameters();s=a?(u=_&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",y.LINES):(u=_?"fillPattern":"fill",y.TRIANGLES);for(var x=0,w=n;x<w.length;x+=1){var S=w[x],E=e.getTile(S);if(!_||E.patternsLoaded()){var C=E.getBucket(r);if(C){var M=C.programConfigurations.get(r.id),T=t.useProgram(u,M);_&&(t.context.activeTexture.set(y.TEXTURE0),E.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),M.updatePaintBuffers(b));var P=v.constantOr(null);if(P&&E.imageAtlas){var O=E.imageAtlas,A=O.patternPositions[P.to.toString()],I=O.patternPositions[P.from.toString()];A&&I&&M.setConstantPatternPositions(A,I)}var L=t.translatePosMatrix(S.posMatrix,E,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(a){l=C.indexBuffer2,h=C.segments2;var R=[y.drawingBufferWidth,y.drawingBufferHeight];c="fillOutlinePattern"===u&&_?(p=L,f=t,d=b,m=E,g=R,vt.extend(Qn(p,f,d,m),{u_world:g})):{u_matrix:L,u_world:R}}else l=C.indexBuffer,h=C.segments,c=_?Qn(L,t,b,E):Jn(L);T.draw(t.context,s,i,t.stencilModeForClipping(S),o,ir.disabled,c,r.id,C.layoutVertexBuffer,l,h,r.paint,t.transform.zoom,M)}}}}function xi(t,e,r,n,i,o,a){for(var s=t.context,u=s.gl,c=r.paint.get("fill-extrusion-pattern"),l=c.constantOr(1),h=r.getCrossfadeParameters(),p=r.paint.get("fill-extrusion-opacity"),f=0,d=n;f<d.length;f+=1){var m=d[f],g=e.getTile(m),y=g.getBucket(r);if(y){var v=y.programConfigurations.get(r.id),_=t.useProgram(l?"fillExtrusionPattern":"fillExtrusion",v);l&&(t.context.activeTexture.set(u.TEXTURE0),g.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),v.updatePaintBuffers(h));var b=c.constantOr(null);if(b&&g.imageAtlas){var x=g.imageAtlas,w=x.patternPositions[b.to.toString()],S=x.patternPositions[b.from.toString()];w&&S&&v.setConstantPatternPositions(w,S)}var E=t.translatePosMatrix(m.posMatrix,g,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),C=r.paint.get("fill-extrusion-vertical-gradient"),M=l?(T=E,P=t,O=C,A=p,I=m,L=h,R=g,vt.extend(Kn(T,P,O,A),Zn(L,P,R),{u_height_factor:-Math.pow(2,I.overscaledZ)/R.tileSize/8})):Kn(E,t,C,p);_.draw(s,s.gl.TRIANGLES,i,o,a,ir.backCCW,M,r.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,r.paint,t.transform.zoom,v)}}var T,P,O,A,I,L,R}function wi(t,e,r,n,i,o){var a=t.context,s=a.gl,u=e.fbo;if(u){var c=t.useProgram("hillshade");a.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,u.colorAttachment.get());var l=ai(t,e,r);c.draw(a,s.TRIANGLES,n,i,o,ir.disabled,l,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}function Si(t,e,r,n,i,o,a){var s=t.context,u=s.gl,c=e.dem;if(c&&c.data){var l=c.dim,h=c.stride,p=c.getPixels();if(s.activeTexture.set(u.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||t.getTileTexture(h),e.demTexture){var f=e.demTexture;f.update(p,{premultiply:!1}),f.bind(u.NEAREST,u.CLAMP_TO_EDGE)}else e.demTexture=new vt.Texture(s,p,u.RGBA,{premultiply:!1}),e.demTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE);s.activeTexture.set(u.TEXTURE0);var d=e.fbo;if(!d){var m=new vt.Texture(s,{width:l,height:l,data:null},u.RGBA);m.bind(u.LINEAR,u.CLAMP_TO_EDGE),(d=e.fbo=s.createFramebuffer(l,l,!0)).colorAttachment.set(m.texture)}s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,l,l]),t.useProgram("hillshadePrepare").draw(s,u.TRIANGLES,i,o,a,ir.disabled,si(e.tileID,c,n),r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Ei(t,e,r,n,i){var o=n.paint.get("raster-fade-duration");if(0<o){var a=vt.browser.now(),s=(a-t.timeAdded)/o,u=e?(a-e.timeAdded)/o:-1,c=r.getSource(),l=i.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!e||Math.abs(e.tileID.overscaledZ-l)>Math.abs(t.tileID.overscaledZ-l),p=h&&t.refreshedUponExpiration?1:vt.clamp(h?s:1-u,0,1);return t.refreshedUponExpiration&&1<=s&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}var Ci=new vt.Color(1,0,0,1),Mi=new vt.Color(0,1,0,1),Ti=new vt.Color(0,0,1,1),Pi=new vt.Color(1,0,1,1),Oi=new vt.Color(0,1,1,1);function Ai(t,e,r,n){Li(t,0,e+r/2,t.transform.width,r,n)}function Ii(t,e,r,n){Li(t,e-r/2,0,r,t.transform.height,n)}function Li(t,e,r,n,i,o){var a=t.context,s=a.gl;s.enable(s.SCISSOR_TEST),s.scissor(e*vt.browser.devicePixelRatio,r*vt.browser.devicePixelRatio,n*vt.browser.devicePixelRatio,i*vt.browser.devicePixelRatio),a.clear({color:o}),s.disable(s.SCISSOR_TEST)}function Ri(t,e,r){var n=t.context,i=n.gl,o=r.posMatrix,a=t.useProgram("debug"),s=er.disabled,u=rr.disabled,c=t.colorModeForRenderPass();n.activeTexture.set(i.TEXTURE0),t.emptyTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE),a.draw(n,i.LINE_STRIP,s,u,c,ir.disabled,oi(o,vt.Color.red),"$debug",t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments);var l=e.getTileByID(r.key).latestRawTileData,h=Math.floor((l&&l.byteLength||0)/1024),p=e.getTile(r).tileSize,f=512/Math.min(p,512)*(r.overscaledZ/t.transform.zoom)*.5,d=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(d+=" => "+r.overscaledZ),function(t,e){t.initDebugOverlayCanvas();var r=t.debugOverlayCanvas,n=t.context.gl,i=t.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,r.width,r.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(e,5,5),i.strokeText(e,5,5),t.debugOverlayTexture.update(r),t.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(t,d+" "+h+"kb"),a.draw(n,i.TRIANGLES,s,u,nr.alphaBlended,ir.disabled,oi(o,vt.Color.transparent,f),"$debug",t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments)}function Ni(t,e){this.context=new or(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=sr.maxUnderzooming+sr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new hn,this.gpuTimers={}}var ki={symbol:function(t,e,r,n,i){if("translucent"===t.renderPass){var o=rr.disabled,a=t.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(t,e,r,n,i,o,a){for(var s=e.transform,u="map"===i,c="map"===o,l=0,h=t;l<h.length;l+=1){var p=h[l],f=n.getTile(p),d=f.getBucket(r);if(d&&d.text&&d.text.segments.get().length){var m=vt.evaluateSizeForZoom(d.textSizeData,s.zoom),g=Fr(f,1,e.transform.zoom),y=Cr(p.posMatrix,c,u,e.transform,g),v="none"!==r.layout.get("icon-text-fit")&&d.hasIconData();if(m){var _=Math.pow(2,s.zoom-f.tileID.overscaledZ);yi(d,u,c,a,vt.symbolSize,s,y,p.posMatrix,_,m,v)}}}}(n,t,r,e,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),i),0!==r.paint.get("icon-opacity").constantOr(1)&&vi(t,e,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),o,a),0!==r.paint.get("text-opacity").constantOr(1)&&vi(t,e,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),o,a),e.map.showCollisionBoxes&&(mi(t,e,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),mi(t,e,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))}},circle:function(t,e,r,n){if("translucent"===t.renderPass){var i=r.paint.get("circle-opacity"),o=r.paint.get("circle-stroke-width"),a=r.paint.get("circle-stroke-opacity"),s=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0!==i.constantOr(1)||0!==o.constantOr(1)&&0!==a.constantOr(1)){for(var u=t.context,c=u.gl,l=t.depthModeForSublayer(0,er.ReadOnly),h=rr.disabled,p=t.colorModeForRenderPass(),f=[],d=0;d<n.length;d++){var m=n[d],g=e.getTile(m),y=g.getBucket(r);if(y){var v=y.programConfigurations.get(r.id),_={programConfiguration:v,program:t.useProgram("circle",v),layoutVertexBuffer:y.layoutVertexBuffer,indexBuffer:y.indexBuffer,uniformValues:ti(t,m,g,r)};if(s)for(var b=0,x=y.segments.get();b<x.length;b+=1){var w=x[b];f.push({segments:new vt.SegmentVector([w]),sortKey:w.sortKey,state:_})}else f.push({segments:y.segments,sortKey:0,state:_})}}s&&f.sort(function(t,e){return t.sortKey-e.sortKey});for(var S=0,E=f;S<E.length;S+=1){var C=E[S],M=C.state;M.program.draw(u,c.TRIANGLES,l,h,p,ir.disabled,M.uniformValues,r.id,M.layoutVertexBuffer,M.indexBuffer,C.segments,r.paint,t.transform.zoom,M.programConfiguration)}}}},heatmap:function(t,e,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){var i=t.context,o=i.gl,a=rr.disabled,s=new nr([o.ONE,o.ONE],vt.Color.transparent,[!0,!0,!0,!0]);!function(t,e,r){var n=t.gl;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var i=r.heatmapFbo;if(i)n.bindTexture(n.TEXTURE_2D,i.colorAttachment.get()),t.bindFramebuffer.set(i.framebuffer);else{var o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),i=r.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function t(e,r,n,i){var o=e.gl;o.texImage2D(o.TEXTURE_2D,0,o.RGBA,r.width/4,r.height/4,0,o.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:o.UNSIGNED_BYTE,null),i.colorAttachment.set(n),e.extTextureHalfFloat&&o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,i.colorAttachment.setDirty(),t(e,r,n,i))}(t,e,o,i)}}(i,t,r),i.clear({color:vt.Color.transparent});for(var u=0;u<n.length;u++){var c=n[u];if(!e.hasRenderableParent(c)){var l=e.getTile(c),h=l.getBucket(r);if(h){var p=h.programConfigurations.get(r.id);t.useProgram("heatmap",p).draw(i,o.TRIANGLES,er.disabled,a,s,ir.disabled,(f=c.posMatrix,d=l,m=t.transform.zoom,g=r.paint.get("heatmap-intensity"),{u_matrix:f,u_extrude_scale:Fr(d,1,m),u_intensity:g}),r.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,r.paint,t.transform.zoom,p)}}}i.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,e){var r=t.context,n=r.gl,i=e.heatmapFbo;if(i){r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,i.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1);var o=e.colorRampTexture;(o=o||(e.colorRampTexture=new vt.Texture(r,e.colorRamp,n.RGBA))).bind(n.LINEAR,n.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(r,n.TRIANGLES,er.disabled,rr.disabled,t.colorModeForRenderPass(),ir.disabled,function(t,e){var r=vt.create();vt.ortho(r,0,t.width,t.height,0,0,1);var n=t.context.gl;return{u_matrix:r,u_world:[n.drawingBufferWidth,n.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:e.paint.get("heatmap-opacity")}}(t,e),e.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,e.paint,t.transform.zoom)}}(t,r));var f,d,m,g},line:function(t,e,r,n){if("translucent"===t.renderPass){var i=r.paint.get("line-opacity"),o=r.paint.get("line-width");if(0!==i.constantOr(1)&&0!==o.constantOr(1)){var a=t.depthModeForSublayer(0,er.ReadOnly),s=t.colorModeForRenderPass(),u=r.paint.get("line-dasharray"),c=r.paint.get("line-pattern"),l=c.constantOr(1),h=r.paint.get("line-gradient"),p=r.getCrossfadeParameters(),f=l?"linePattern":u?"lineSDF":h?"lineGradient":"line",d=t.context,m=d.gl,g=!0;if(h){d.activeTexture.set(m.TEXTURE0);var y=r.gradientTexture;if(!r.gradient)return;(y=y||(r.gradientTexture=new vt.Texture(d,r.gradient,m.RGBA))).bind(m.LINEAR,m.CLAMP_TO_EDGE)}for(var v=0,_=n;v<_.length;v+=1){var b=_[v],x=e.getTile(b);if(!l||x.patternsLoaded()){var w=x.getBucket(r);if(w){var S=w.programConfigurations.get(r.id),E=t.context.program.get(),C=t.useProgram(f,S),M=g||C.program!==E,T=c.constantOr(null);if(T&&x.imageAtlas){var P=x.imageAtlas,O=P.patternPositions[T.to.toString()],A=P.patternPositions[T.from.toString()];O&&A&&S.setConstantPatternPositions(O,A)}var I=l?(X=x,Y=r,Z=p,void 0,K=(W=t).transform,J=ui(X,K),{u_matrix:ci(W,X,Y),u_texsize:X.imageAtlasTexture.size,u_ratio:1/Fr(X,1,K.zoom),u_device_pixel_ratio:vt.browser.devicePixelRatio,u_image:0,u_scale:[J,Z.fromScale,Z.toScale],u_fade:Z.t,u_units_to_pixels:[1/K.pixelsToGLUnits[0],1/K.pixelsToGLUnits[1]]}):u?(D=x,j=r,z=u,F=p,B=void 0,B=(k=t).lineAtlas,U=ui(D,k.transform),V="round"===j.layout.get("line-cap"),G=B.getDash(z.from,V),q=B.getDash(z.to,V),H=G.width*F.fromScale,$=q.width*F.toScale,vt.extend(ni(k,D,j),{u_patternscale_a:[U/H,-G.height/2],u_patternscale_b:[U/$,-q.height/2],u_sdfgamma:B.width/(256*Math.min(H,$)*vt.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:q.y,u_mix:F.t})):h?(L=t,R=x,N=r,vt.extend(ni(L,R,N),{u_image:0})):ni(t,x,r);l?(d.activeTexture.set(m.TEXTURE0),x.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),S.updatePaintBuffers(p)):u&&(M||t.lineAtlas.dirty)&&(d.activeTexture.set(m.TEXTURE0),t.lineAtlas.bind(d)),C.draw(d,m.TRIANGLES,a,t.stencilModeForClipping(b),s,ir.disabled,I,r.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,r.paint,t.transform.zoom,S),g=!1}}}}}var L,R,N,k,D,j,z,F,B,U,V,G,q,H,$,W,X,Y,Z,K,J},fill:function(t,e,r,n){var i=r.paint.get("fill-color"),o=r.paint.get("fill-opacity");if(0!==o.constantOr(1)){var a=t.colorModeForRenderPass(),s=r.paint.get("fill-pattern"),u=t.opaquePassEnabledForLayer()&&!s.constantOr(1)&&1===i.constantOr(vt.Color.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(t.renderPass===u){var c=t.depthModeForSublayer(1,"opaque"===t.renderPass?er.ReadWrite:er.ReadOnly);bi(t,e,r,n,c,a,!1)}if("translucent"===t.renderPass&&r.paint.get("fill-antialias")){var l=t.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,er.ReadOnly);bi(t,e,r,n,l,a,!0)}}},"fill-extrusion":function(t,e,r,n){var i=r.paint.get("fill-extrusion-opacity");if(0!==i&&"translucent"===t.renderPass){var o=new er(t.context.gl.LEQUAL,er.ReadWrite,t.depthRangeFor3D);if(1!==i||r.paint.get("fill-extrusion-pattern").constantOr(1))xi(t,e,r,n,o,rr.disabled,nr.disabled),xi(t,e,r,n,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var a=t.colorModeForRenderPass();xi(t,e,r,n,o,rr.disabled,a)}}},hillshade:function(t,e,r,n){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var i=t.context,o=e.getSource().maxzoom,a=t.depthModeForSublayer(0,er.ReadOnly),s=t.colorModeForRenderPass(),u="translucent"===t.renderPass?t.stencilConfigForOverlap(n):[{},n],c=u[0],l=0,h=u[1];l<h.length;l+=1){var p=h[l],f=e.getTile(p);f.needsHillshadePrepare&&"offscreen"===t.renderPass?Si(t,f,r,o,a,rr.disabled,s):"translucent"===t.renderPass&&wi(t,f,r,a,c[p.overscaledZ],s)}i.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,r,n){if("translucent"===t.renderPass&&0!==r.paint.get("raster-opacity")&&n.length)for(var i=t.context,o=i.gl,a=e.getSource(),s=t.useProgram("raster"),u=t.colorModeForRenderPass(),c=a instanceof U?[{},n]:t.stencilConfigForOverlap(n),l=c[0],h=c[1],p=h[h.length-1].overscaledZ,f=!t.options.moving,d=0,m=h;d<m.length;d+=1){var g=m[d],y=t.depthModeForSublayer(g.overscaledZ-p,1===r.paint.get("raster-opacity")?er.ReadWrite:er.ReadOnly,o.LESS),v=e.getTile(g),_=t.transform.calculatePosMatrix(g.toUnwrapped(),f);v.registerFadeDuration(r.paint.get("raster-fade-duration"));var b=e.findLoadedParent(g,0),x=Ei(v,b,e,r,t.transform),w=void 0,S=void 0,E="nearest"===r.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;i.activeTexture.set(o.TEXTURE0),v.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(o.TEXTURE1),b?(b.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,b.tileID.overscaledZ-v.tileID.overscaledZ),S=[v.tileID.canonical.x*w%1,v.tileID.canonical.y*w%1]):v.texture.bind(E,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);var C=li(_,S||[0,0],w||1,x,r);a instanceof U?s.draw(i,o.TRIANGLES,y,rr.disabled,u,ir.disabled,C,r.id,a.boundsBuffer,t.quadTriangleIndexBuffer,a.boundsSegments):s.draw(i,o.TRIANGLES,y,l[g.overscaledZ],u,ir.disabled,C,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,r){var n,i,o,a,s,u,c,l,h,p,f,d,m,g,y,v,_,b,x,w=r.paint.get("background-color"),S=r.paint.get("background-opacity");if(0!==S){var E=t.context,C=E.gl,M=t.transform,T=M.tileSize,P=r.paint.get("background-pattern");if(!t.isPatternMissing(P)){var O=!P&&1===w.a&&1===S&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===O){var A=rr.disabled,I=t.depthModeForSublayer(0,"opaque"==O?er.ReadWrite:er.ReadOnly),L=t.colorModeForRenderPass(),R=t.useProgram(P?"backgroundPattern":"background"),N=M.coveringTiles({tileSize:T});P&&(E.activeTexture.set(C.TEXTURE0),t.imageManager.bind(t.context));for(var k=r.getCrossfadeParameters(),D=0,j=N;D<j.length;D+=1){var z=j[D],F=t.transform.calculatePosMatrix(z.toUnwrapped()),B=P?(n=F,i=S,o=t,a=P,s={tileID:z,tileSize:T},u=k,x=b=_=v=y=g=m=d=f=p=h=l=c=void 0,vt.extend((c=a,l=u,p=s,f=(h=o).imageManager.getPattern(c.from.toString()),d=h.imageManager.getPattern(c.to.toString()),m=h.imageManager.getPixelSize(),g=m.width,y=m.height,v=Math.pow(2,p.tileID.overscaledZ),_=p.tileSize*Math.pow(2,h.transform.tileZoom)/v,b=_*(p.tileID.canonical.x+p.tileID.wrap*v),x=_*p.tileID.canonical.y,{u_image:0,u_pattern_tl_a:f.tl,u_pattern_br_a:f.br,u_pattern_tl_b:d.tl,u_pattern_br_b:d.br,u_texsize:[g,y],u_mix:l.t,u_pattern_size_a:f.displaySize,u_pattern_size_b:d.displaySize,u_scale_a:l.fromScale,u_scale_b:l.toScale,u_tile_units_to_pixels:1/Fr(p,1,h.transform.tileZoom),u_pixel_coord_upper:[b>>16,x>>16],u_pixel_coord_lower:[65535&b,65535&x]}),{u_matrix:n,u_opacity:i})):{u_matrix:F,u_opacity:S,u_color:w};R.draw(E,C.TRIANGLES,I,A,L,ir.disabled,B,r.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,r){for(var n=0;n<r.length;n++)Ri(t,e,r[n])},custom:function(t,e,r){var n=t.context,i=r.implementation;if("offscreen"===t.renderPass){var o=i.prerender;o&&(t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),o.call(i,n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),n.setStencilMode(rr.disabled);var a="3d"===i.renderingMode?new er(t.context.gl.LEQUAL,er.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,er.ReadOnly);n.setDepthMode(a),i.render(n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState(),n.bindFramebuffer.set(null)}}};Ni.prototype.resize=function(t,e){if(this.width=t*vt.browser.devicePixelRatio,this.height=e*vt.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var r=0,n=this.style._order;r<n.length;r+=1)this.style._layers[n[r]].resize()},Ni.prototype.setup=function(){var t=this.context,e=new vt.StructArrayLayout2i4;e.emplaceBack(0,0),e.emplaceBack(vt.EXTENT,0),e.emplaceBack(0,vt.EXTENT),e.emplaceBack(vt.EXTENT,vt.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(e,_n.members),this.tileExtentSegments=vt.SegmentVector.simpleSegment(0,0,4,2);var r=new vt.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(vt.EXTENT,0),r.emplaceBack(0,vt.EXTENT),r.emplaceBack(vt.EXTENT,vt.EXTENT),this.debugBuffer=t.createVertexBuffer(r,_n.members),this.debugSegments=vt.SegmentVector.simpleSegment(0,0,4,5);var n=new vt.StructArrayLayout4i8;n.emplaceBack(0,0,0,0),n.emplaceBack(vt.EXTENT,0,vt.EXTENT,0),n.emplaceBack(0,vt.EXTENT,0,vt.EXTENT),n.emplaceBack(vt.EXTENT,vt.EXTENT,vt.EXTENT,vt.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(n,B.members),this.rasterBoundsSegments=vt.SegmentVector.simpleSegment(0,0,4,2);var i=new vt.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(1,0),i.emplaceBack(0,1),i.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(i,_n.members),this.viewportSegments=vt.SegmentVector.simpleSegment(0,0,4,2);var o=new vt.StructArrayLayout1ui2;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(o);var a=new vt.StructArrayLayout3ui6;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new vt.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);var s=this.context.gl;this.stencilClearMode=new rr({func:s.ALWAYS,mask:0},0,255,s.ZERO,s.ZERO,s.ZERO)},Ni.prototype.clearStencil=function(){var t=this.context,e=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var r=vt.create();vt.ortho(r,0,this.width,this.height,0,0,1),vt.scale(r,r,[e.drawingBufferWidth,e.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,e.TRIANGLES,er.disabled,this.stencilClearMode,nr.disabled,ir.disabled,ri(r),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ni.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var r=this.context,n=r.gl;256<this.nextStencilID+e.length&&this.clearStencil(),r.setColorMode(nr.disabled),r.setDepthMode(er.disabled);var i=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var o=0,a=e;o<a.length;o+=1){var s=a[o],u=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;i.draw(r,n.TRIANGLES,er.disabled,new rr({func:n.ALWAYS,mask:0},u,255,n.KEEP,n.KEEP,n.REPLACE),nr.disabled,ir.disabled,ri(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ni.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,256<this.nextStencilID+1&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new rr({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},Ni.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new rr({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},Ni.prototype.stencilConfigForOverlap=function(t){var e,r=this.context.gl,n=t.sort(function(t,e){return e.overscaledZ-t.overscaledZ}),i=n[n.length-1].overscaledZ,o=n[0].overscaledZ-i+1;if(1<o){this.currentStencilSource=void 0,256<this.nextStencilID+o&&this.clearStencil();for(var a={},s=0;s<o;s++)a[s+i]=new rr({func:r.GEQUAL,mask:255},s+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=o,[a,n]}return[(e={},e[i]=rr.disabled,e),n]},Ni.prototype.colorModeForRenderPass=function(){var t=this.context.gl;return this._showOverdrawInspector?new nr([t.CONSTANT_COLOR,t.ONE],new vt.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?nr.unblended:nr.alphaBlended},Ni.prototype.depthModeForSublayer=function(t,e,r){if(!this.opaquePassEnabledForLayer())return er.disabled;var n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new er(r||this.context.gl.LEQUAL,e,[n,n])},Ni.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ni.prototype.render=function(t,e){var r=this;this.style=t,this.options=e,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(vt.browser.now()),this.imageManager.beginFrame();var n=this.style._order,i=this.style.sourceCaches;for(var o in i){var a=i[o];a.used&&a.prepare(this.context)}var s,u,c={},l={},h={};for(var p in i){var f=i[p];c[p]=f.getVisibleCoordinates(),l[p]=c[p].slice().reverse(),h[p]=f.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var d=0;d<n.length;d++)if(this.style._layers[n[d]].is3D()){this.opaquePassCutoff=d;break}this.renderPass="offscreen";for(var m=0,g=n;m<g.length;m+=1){var y=this.style._layers[g[m]];if(y.hasOffscreenPass()&&!y.isHidden(this.transform.zoom)){var v=l[y.source];"custom"!==y.type&&!v.length||this.renderLayer(this,i[y.source],y,v)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:e.showOverdrawInspector?vt.Color.black:vt.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=e.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=n.length-1;0<=this.currentLayer;this.currentLayer--){var _=this.style._layers[n[this.currentLayer]],b=i[_.source],x=c[_.source];this._renderTileClippingMasks(_,x),this.renderLayer(this,b,_,x)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){var w=this.style._layers[n[this.currentLayer]],S=i[w.source],E=("symbol"===w.type?h:l)[w.source];this._renderTileClippingMasks(w,c[w.source]),this.renderLayer(this,S,w,E)}this.options.showTileBoundaries&&(vt.values(this.style._layers).forEach(function(t){t.source&&!t.isHidden(r.transform.zoom)&&(t.source!==(u&&u.id)&&(u=r.style.sourceCaches[t.source]),(!s||s.getSource().maxzoom<u.getSource().maxzoom)&&(s=u))}),s&&ki.debug(this,s,s.getVisibleCoordinates())),this.options.showPadding&&function(t){var e=t.transform.padding;Ai(t,t.transform.height-(e.top||0),3,Ci),Ai(t,e.bottom||0,3,Mi),Ii(t,e.left||0,3,Ti),Ii(t,t.transform.width-(e.right||0),3,Pi);var r,n,i,o,a=t.transform.centerPoint;r=t,n=a.x,i=t.transform.height-a.y,Li(r,n-1,i-10,2,20,o=Oi),Li(r,n-10,i-1,20,2,o)}(this),this.context.setDefault()},Ni.prototype.renderLayer=function(t,e,r,n){r.isHidden(this.transform.zoom)||"background"!==r.type&&"custom"!==r.type&&!n.length||(this.id=r.id,this.gpuTimingStart(r),ki[r.type](t,e,r,n,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ni.prototype.gpuTimingStart=function(t){if(this.options.gpuTiming){var e=this.context.extTimerQuery,r=this.gpuTimers[t.id];(r=r||(this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()})).calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,r.query)}},Ni.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}},Ni.prototype.collectGpuTimers=function(){var t=this.gpuTimers;return this.gpuTimers={},t},Ni.prototype.queryGpuTimers=function(t){var e={};for(var r in t){var n=t[r],i=this.context.extTimerQuery,o=i.getQueryObjectEXT(n.query,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(n.query),e[r]=o}return e},Ni.prototype.translatePosMatrix=function(t,e,r,n,i){if(!r[0]&&!r[1])return t;var o=i?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(o){var a=Math.sin(o),s=Math.cos(o);r=[r[0]*s-r[1]*a,r[0]*a+r[1]*s]}var u=[i?r[0]:Fr(e,r[0],this.transform.zoom),i?r[1]:Fr(e,r[1],this.transform.zoom),0],c=new Float32Array(16);return vt.translate(c,t,u),c},Ni.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},Ni.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&0<e.length?e.pop():null},Ni.prototype.isPatternMissing=function(t){if(!t)return!1;var e=this.imageManager.getPattern(t.from.toString()),r=this.imageManager.getPattern(t.to.toString());return!e||!r},Ni.prototype.useProgram=function(t,e){this.cache=this.cache||{};var r=""+t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[r]||(this.cache[r]=new Yn(this.context,Xn[t],e,fi[t],this._showOverdrawInspector)),this.cache[r]},Ni.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ni.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)},Ni.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=vt.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new vt.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ni.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};function Di(t,e){this.points=t,this.planes=e}Di.fromInvProjectionMatrix=function(e,r,t){var n=Math.pow(2,t),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(t){return vt.transformMat4([],t,e)}).map(function(t){return vt.scale$1([],t,1/t[3]/r*n)}),i=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(t){var e=vt.sub([],o[t[0]],o[t[1]]),r=vt.sub([],o[t[2]],o[t[1]]),n=vt.normalize([],vt.cross([],e,r)),i=-vt.dot(n,o[t[1]]);return n.concat(i)});return new Di(o,i)};function ji(t,e){this.min=t,this.max=e,this.center=vt.scale$2([],vt.add([],this.min,this.max),.5)}ji.prototype.quadrant=function(t){for(var e=[t%2==0,t<2],r=vt.clone$2(this.min),n=vt.clone$2(this.max),i=0;i<e.length;i++)r[i]=e[i]?this.min[i]:this.center[i],n[i]=e[i]?this.center[i]:this.max[i];return n[2]=this.max[2],new ji(r,n)},ji.prototype.distanceX=function(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]},ji.prototype.distanceY=function(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]},ji.prototype.intersects=function(t){for(var e=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],r=!0,n=0;n<t.planes.length;n++){for(var i=t.planes[n],o=0,a=0;a<e.length;a++)o+=0<=vt.dot$1(i,e[a]);if(0===o)return 0;o!==e.length&&(r=!1)}if(r)return 2;for(var s=0;s<3;s++){for(var u=Number.MAX_VALUE,c=-Number.MAX_VALUE,l=0;l<t.points.length;l++){var h=t.points[l][s]-this.min[s];u=Math.min(u,h),c=Math.max(c,h)}if(c<0||u>this.max[s]-this.min[s])return 0}return 1};function zi(t,e,r,n){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(r)||r<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=r,this.right=n}zi.prototype.interpolate=function(t,e,r){return null!=e.top&&null!=t.top&&(this.top=vt.number(t.top,e.top,r)),null!=e.bottom&&null!=t.bottom&&(this.bottom=vt.number(t.bottom,e.bottom,r)),null!=e.left&&null!=t.left&&(this.left=vt.number(t.left,e.left,r)),null!=e.right&&null!=t.right&&(this.right=vt.number(t.right,e.right,r)),this},zi.prototype.getCenter=function(t,e){var r=vt.clamp((this.left+t-this.right)/2,0,t),n=vt.clamp((this.top+e-this.bottom)/2,0,e);return new vt.Point(r,n)},zi.prototype.equals=function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right},zi.prototype.clone=function(){return new zi(this.top,this.bottom,this.left,this.right)},zi.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};function Fi(t,e,r,n,i){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===i||i,this._minZoom=t||0,this._maxZoom=e||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setMaxBounds(),this.width=0,this.height=0,this._center=new vt.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new zi,this._posMatrixCache={},this._alignedPosMatrixCache={}}var Bi={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Fi.prototype.clone=function(){var t=new Fi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t},Bi.minZoom.get=function(){return this._minZoom},Bi.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},Bi.maxZoom.get=function(){return this._maxZoom},Bi.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},Bi.minPitch.get=function(){return this._minPitch},Bi.minPitch.set=function(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))},Bi.maxPitch.get=function(){return this._maxPitch},Bi.maxPitch.set=function(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))},Bi.renderWorldCopies.get=function(){return this._renderWorldCopies},Bi.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},Bi.worldSize.get=function(){return this.tileSize*this.scale},Bi.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Bi.size.get=function(){return new vt.Point(this.width,this.height)},Bi.bearing.get=function(){return-this.angle/Math.PI*180},Bi.bearing.set=function(t){var e=-vt.wrap(t,-180,180)*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=vt.create$2(),vt.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Bi.pitch.get=function(){return this._pitch/Math.PI*180},Bi.pitch.set=function(t){var e=vt.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())},Bi.fov.get=function(){return this._fov/Math.PI*180},Bi.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},Bi.zoom.get=function(){return this._zoom},Bi.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},Bi.center.get=function(){return this._center},Bi.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},Bi.padding.get=function(){return this._edgeInsets.toJSON()},Bi.padding.set=function(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())},Bi.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Fi.prototype.isPaddingEqual=function(t){return this._edgeInsets.equals(t)},Fi.prototype.interpolatePadding=function(t,e,r){this._unmodified=!1,this._edgeInsets.interpolate(t,e,r),this._constrain(),this._calcMatrices()},Fi.prototype.coveringZoomLevel=function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)},Fi.prototype.getVisibleUnwrappedCoordinates=function(t){var e=[new vt.UnwrappedTileID(0,t)];if(this._renderWorldCopies)for(var r=this.pointCoordinate(new vt.Point(0,0)),n=this.pointCoordinate(new vt.Point(this.width,0)),i=this.pointCoordinate(new vt.Point(this.width,this.height)),o=this.pointCoordinate(new vt.Point(0,this.height)),a=Math.floor(Math.min(r.x,n.x,i.x,o.x)),s=Math.floor(Math.max(r.x,n.x,i.x,o.x)),u=a-1;u<=s+1;u++)0!==u&&e.push(new vt.UnwrappedTileID(u,t));return e},Fi.prototype.coveringTiles=function(t){var e=this.coveringZoomLevel(t),r=e;if(void 0!==t.minzoom&&e<t.minzoom)return[];void 0!==t.maxzoom&&e>t.maxzoom&&(e=t.maxzoom);var n=vt.MercatorCoordinate.fromLngLat(this.center),i=Math.pow(2,e),o=[i*n.x,i*n.y,0],a=Di.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e),s=t.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(s=e);function u(t){return{aabb:new ji([t*i,0,0],[(t+1)*i,i,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}}var c=[],l=[],h=e,p=t.reparseOverscaled?r:e;if(this._renderWorldCopies)for(var f=1;f<=3;f++)c.push(u(-f)),c.push(u(f));for(c.push(u(0));0<c.length;){var d=c.pop(),m=d.x,g=d.y,y=d.fullyVisible;if(!y){var v=d.aabb.intersects(a);if(0===v)continue;y=2===v}var _=d.aabb.distanceX(o),b=d.aabb.distanceY(o),x=Math.max(Math.abs(_),Math.abs(b));if(d.zoom===h||x>3+(1<<h-d.zoom)-2&&d.zoom>=s)l.push({tileID:new vt.OverscaledTileID(d.zoom===h?p:d.zoom,d.wrap,d.zoom,m,g),distanceSq:vt.sqrLen([o[0]-.5-m,o[1]-.5-g])});else for(var w=0;w<4;w++){var S=(m<<1)+w%2,E=(g<<1)+(w>>1);c.push({aabb:d.aabb.quadrant(w),zoom:d.zoom+1,x:S,y:E,wrap:d.wrap,fullyVisible:y})}}return l.sort(function(t,e){return t.distanceSq-e.distanceSq}).map(function(t){return t.tileID})},Fi.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},Bi.unmodified.get=function(){return this._unmodified},Fi.prototype.zoomScale=function(t){return Math.pow(2,t)},Fi.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},Fi.prototype.project=function(t){var e=vt.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new vt.Point(vt.mercatorXfromLng(t.lng)*this.worldSize,vt.mercatorYfromLat(e)*this.worldSize)},Fi.prototype.unproject=function(t){return new vt.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()},Bi.point.get=function(){return this.project(this.center)},Fi.prototype.setLocationAtPoint=function(t,e){var r=this.pointCoordinate(e),n=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(t),o=new vt.MercatorCoordinate(i.x-(r.x-n.x),i.y-(r.y-n.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())},Fi.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},Fi.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Fi.prototype.locationCoordinate=function(t){return vt.MercatorCoordinate.fromLngLat(t)},Fi.prototype.coordinateLocation=function(t){return t.toLngLat()},Fi.prototype.pointCoordinate=function(t){var e=[t.x,t.y,0,1],r=[t.x,t.y,1,1];vt.transformMat4(e,e,this.pixelMatrixInverse),vt.transformMat4(r,r,this.pixelMatrixInverse);var n=e[3],i=r[3],o=e[1]/n,a=r[1]/i,s=e[2]/n,u=r[2]/i,c=s==u?0:(0-s)/(u-s);return new vt.MercatorCoordinate(vt.number(e[0]/n,r[0]/i,c)/this.worldSize,vt.number(o,a,c)/this.worldSize)},Fi.prototype.coordinatePoint=function(t){var e=[t.x*this.worldSize,t.y*this.worldSize,0,1];return vt.transformMat4(e,e,this.pixelMatrix),new vt.Point(e[0]/e[3],e[1]/e[3])},Fi.prototype.getBounds=function(){return(new vt.LngLatBounds).extend(this.pointLocation(new vt.Point(0,0))).extend(this.pointLocation(new vt.Point(this.width,0))).extend(this.pointLocation(new vt.Point(this.width,this.height))).extend(this.pointLocation(new vt.Point(0,this.height)))},Fi.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new vt.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Fi.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Fi.prototype.calculatePosMatrix=function(t,e){void 0===e&&(e=!1);var r=t.key,n=e?this._alignedPosMatrixCache:this._posMatrixCache;if(n[r])return n[r];var i=t.canonical,o=this.worldSize/this.zoomScale(i.z),a=i.x+Math.pow(2,i.z)*t.wrap,s=vt.identity(new Float64Array(16));return vt.translate(s,s,[a*o,i.y*o,0]),vt.scale(s,s,[o/vt.EXTENT,o/vt.EXTENT,1]),vt.multiply(s,e?this.alignedProjMatrix:this.projMatrix,s),n[r]=new Float32Array(s),n[r]},Fi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Fi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,e,r,n,i=-90,o=90,a=-180,s=180,u=this.size,c=this._unmodified;if(this.latRange){var l=this.latRange;i=vt.mercatorYfromLat(l[1])*this.worldSize,t=(o=vt.mercatorYfromLat(l[0])*this.worldSize)-i<u.y?u.y/(o-i):0}if(this.lngRange){var h=this.lngRange;a=vt.mercatorXfromLng(h[0])*this.worldSize,e=(s=vt.mercatorXfromLng(h[1])*this.worldSize)-a<u.x?u.x/(s-a):0}var p=this.point,f=Math.max(e||0,t||0);if(f)return this.center=this.unproject(new vt.Point(e?(s+a)/2:p.x,t?(o+i)/2:p.y)),this.zoom+=this.scaleZoom(f),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var d=p.y,m=u.y/2;d-m<i&&(n=i+m),o<d+m&&(n=o-m)}if(this.lngRange){var g=p.x,y=u.x/2;g-y<a&&(r=a+y),s<g+y&&(r=s-y)}void 0===r&&void 0===n||(this.center=this.unproject(new vt.Point(void 0!==r?r:p.x,void 0!==n?n:p.y))),this._unmodified=c,this._constraining=!1}},Fi.prototype._calcMatrices=function(){if(this.height){var t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var e=Math.PI/2+this._pitch,r=this._fov*(.5+t.y/this.height),n=Math.sin(r)*this.cameraToCenterDistance/Math.sin(vt.clamp(Math.PI-e-r,.01,Math.PI-.01)),i=this.point,o=i.x,a=i.y,s=1.01*(Math.cos(Math.PI/2-this._pitch)*n+this.cameraToCenterDistance),u=this.height/50,c=new Float64Array(16);vt.perspective(c,this._fov,this.width/this.height,u,s),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,vt.scale(c,c,[1,-1,1]),vt.translate(c,c,[0,0,-this.cameraToCenterDistance]),vt.rotateX(c,c,this._pitch),vt.rotateZ(c,c,this.angle),vt.translate(c,c,[-o,-a,0]),this.mercatorMatrix=vt.scale([],c,[this.worldSize,this.worldSize,this.worldSize]),vt.scale(c,c,[1,1,vt.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=vt.invert([],this.projMatrix);var l=this.width%2/2,h=this.height%2/2,p=Math.cos(this.angle),f=Math.sin(this.angle),d=o-Math.round(o)+p*l+f*h,m=a-Math.round(a)+p*h+f*l,g=new Float64Array(c);if(vt.translate(g,g,[.5<d?d-1:d,.5<m?m-1:m,0]),this.alignedProjMatrix=g,c=vt.create(),vt.scale(c,c,[this.width/2,-this.height/2,1]),vt.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=vt.create(),vt.scale(c,c,[1,-1,1]),vt.translate(c,c,[-1,-1,0]),vt.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=vt.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=vt.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Fi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new vt.Point(0,0)),e=[t.x*this.worldSize,t.y*this.worldSize,0,1];return vt.transformMat4(e,e,this.pixelMatrix)[3]/this.cameraToCenterDistance},Fi.prototype.getCameraPoint=function(){var t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new vt.Point(0,t))},Fi.prototype.getCameraQueryGeometry=function(t){var e=this.getCameraPoint();if(1===t.length)return[t[0],e];for(var r=e.x,n=e.y,i=e.x,o=e.y,a=0,s=t;a<s.length;a+=1){var u=s[a];r=Math.min(r,u.x),n=Math.min(n,u.y),i=Math.max(i,u.x),o=Math.max(o,u.y)}return[new vt.Point(r,n),new vt.Point(i,n),new vt.Point(i,o),new vt.Point(r,o),new vt.Point(r,n)]},Object.defineProperties(Fi.prototype,Bi);function Ui(t){var e,r,n,i;this._hashName=t&&encodeURIComponent(t),vt.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(e=this._updateHashUnthrottled.bind(this),r=!1,n=null,i=function(){n=null,r&&(e(),n=setTimeout(i,300),r=!1)},function(){return r=!0,n||i(),n})}Ui.prototype.addTo=function(t){return this._map=t,vt.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ui.prototype.remove=function(){return vt.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ui.prototype.getHashString=function(t){var e=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),o=Math.round(e.lng*i)/i,a=Math.round(e.lat*i)/i,s=this._map.getBearing(),u=this._map.getPitch(),c="";if(c+=t?"/"+o+"/"+a+"/"+r:r+"/"+a+"/"+o,(s||u)&&(c+="/"+Math.round(10*s)/10),u&&(c+="/"+Math.round(u)),this._hashName){var l=this._hashName,h=!1,p=vt.window.location.hash.slice(1).split("&").map(function(t){var e=t.split("=")[0];return e===l?(h=!0,e+"="+c):t}).filter(function(t){return t});return h||p.push(l+"="+c),"#"+p.join("&")}return"#"+c},Ui.prototype._getCurrentHash=function(){var e,r=this,t=vt.window.location.hash.replace("#","");return this._hashName?(t.split("&").map(function(t){return t.split("=")}).forEach(function(t){t[0]===r._hashName&&(e=t)}),(e&&e[1]||"").split("/")):t.split("/")},Ui.prototype._onHashChange=function(){var t=this._getCurrentHash();if(3<=t.length&&!t.some(function(t){return isNaN(t)})){var e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},Ui.prototype._updateHashUnthrottled=function(){var t=this.getHashString();try{vt.window.history.replaceState(vt.window.history.state,"",t)}catch(t){}};function Vi(t){this._map=t,this._el=t.getCanvasContainer(),this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,vt.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this)}var Gi=function(a){function t(t,e,r,n){void 0===n&&(n={});var i=_.mousePos(e.getCanvasContainer(),r),o=e.unproject(i);a.call(this,t,vt.extend({point:i,lngLat:o,originalEvent:r},n)),this._defaultPrevented=!1,this.target=e}a&&(t.__proto__=a);var e={defaultPrevented:{configurable:!0}};return((t.prototype=Object.create(a&&a.prototype)).constructor=t).prototype.preventDefault=function(){this._defaultPrevented=!0},e.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(t.prototype,e),t}(vt.Event),qi=function(s){function t(t,e,r){var n=_.touchPos(e.getCanvasContainer(),r),i=n.map(function(t){return e.unproject(t)}),o=n.reduce(function(t,e,r,n){return t.add(e.div(n.length))},new vt.Point(0,0)),a=e.unproject(o);s.call(this,t,{points:n,point:o,lngLats:i,lngLat:a,originalEvent:r}),this._defaultPrevented=!1}s&&(t.__proto__=s);var e={defaultPrevented:{configurable:!0}};return((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.preventDefault=function(){this._defaultPrevented=!0},e.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(t.prototype,e),t}(vt.Event),Hi=function(n){function t(t,e,r){n.call(this,t,{originalEvent:r}),this._defaultPrevented=!1}n&&(t.__proto__=n);var e={defaultPrevented:{configurable:!0}};return((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.preventDefault=function(){this._defaultPrevented=!0},e.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(t.prototype,e),t}(vt.Event);Vi.prototype.setZoomRate=function(t){this._defaultZoomRate=t},Vi.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t},Vi.prototype.isEnabled=function(){return!!this._enabled},Vi.prototype.isActive=function(){return!!this._active},Vi.prototype.isZooming=function(){return!!this._zooming},Vi.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},Vi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Vi.prototype.onWheel=function(t){if(this.isEnabled()){var e=t.deltaMode===vt.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,r=vt.browser.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==e&&e%4.000244140625==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":400<n?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this.isActive()||this._start(t)),t.preventDefault()}},Vi.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(t)},Vi.prototype._start=function(t){if(this._delta){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0,this._map.fire(new vt.Event("movestart",{originalEvent:t})),this._map.fire(new vt.Event("zoomstart",{originalEvent:t}))),this._finishTimeout&&clearTimeout(this._finishTimeout);var e=_.mousePos(this._el,t);this._around=vt.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(e)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame))}},Vi.prototype._onScrollFrame=function(){var t=this;if(this._frameId=null,this.isActive()){var e=this._map.transform;if(0!==this._delta){var r="wheel"===this._type&&4.000244140625<Math.abs(this._delta)?this._wheelZoomRate:this._defaultZoomRate,n=2/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&0!==n&&(n=1/n);var i="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(i*n))),"wheel"===this._type&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var o="number"==typeof this._targetZoom?this._targetZoom:e.zoom,a=this._startZoom,s=this._easing,u=!1;if("wheel"===this._type&&a&&s){var c=Math.min((vt.browser.now()-this._lastWheelEventTime)/200,1),l=s(c);e.zoom=vt.number(a,o,l),c<1?this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame)):u=!0}else e.zoom=o,u=!0;e.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire(new vt.Event("move",{originalEvent:this._lastWheelEvent})),this._map.fire(new vt.Event("zoom",{originalEvent:this._lastWheelEvent})),u&&(this._active=!1,this._finishTimeout=setTimeout(function(){t._zooming=!1,t._map.fire(new vt.Event("zoomend",{originalEvent:t._lastWheelEvent})),t._map.fire(new vt.Event("moveend",{originalEvent:t._lastWheelEvent})),delete t._targetZoom},200))}},Vi.prototype._smoothOutEasing=function(t){var e=vt.ease;if(this._prevEase){var r=this._prevEase,n=(vt.browser.now()-r.start)/r.duration,i=r.easing(.01+n)-r.easing(n),o=.27/Math.sqrt(i*i+1e-4)*.01,a=Math.sqrt(.0729-o*o);e=vt.bezier(o,a,.25,1)}return this._prevEase={start:vt.browser.now(),duration:t,easing:e},e};function $i(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1,vt.bindAll(["_onMouseMove","_onMouseUp","_onKeyDown"],this)}$i.prototype.isEnabled=function(){return!!this._enabled},$i.prototype.isActive=function(){return!!this._active},$i.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},$i.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},$i.prototype.onMouseDown=function(t){this.isEnabled()&&t.shiftKey&&0===t.button&&(vt.window.document.addEventListener("mousemove",this._onMouseMove,!1),vt.window.document.addEventListener("keydown",this._onKeyDown,!1),vt.window.document.addEventListener("mouseup",this._onMouseUp,!1),_.disableDrag(),this._startPos=this._lastPos=_.mousePos(this._el,t),this._active=!0)},$i.prototype._onMouseMove=function(t){var e=_.mousePos(this._el,t);if(!(this._lastPos.equals(e)||!this._box&&e.dist(this._startPos)<this._clickTolerance)){var r=this._startPos;this._lastPos=e,this._box||(this._box=_.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var n=Math.min(r.x,e.x),i=Math.max(r.x,e.x),o=Math.min(r.y,e.y),a=Math.max(r.y,e.y);_.setTransform(this._box,"translate("+n+"px,"+o+"px)"),this._box.style.width=i-n+"px",this._box.style.height=a-o+"px"}},$i.prototype._onMouseUp=function(t){if(0===t.button){var e=this._startPos,r=_.mousePos(this._el,t);this._finish(),_.suppressClick(),e.x===r.x&&e.y===r.y?this._fireEvent("boxzoomcancel",t):this._map.fitScreenCoordinates(e,r,this._map.getBearing(),{linear:!0}).fire(new vt.Event("boxzoomend",{originalEvent:t}))}},$i.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},$i.prototype._finish=function(){this._active=!1,vt.window.document.removeEventListener("mousemove",this._onMouseMove,!1),vt.window.document.removeEventListener("keydown",this._onKeyDown,!1),vt.window.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(_.remove(this._box),this._box=null),_.enableDrag(),delete this._startPos,delete this._lastPos},$i.prototype._fireEvent=function(t,e){return this._map.fire(new vt.Event(t,{originalEvent:e}))};function Wi(t,e){this._map=t,this._el=e.element||t.getCanvasContainer(),this._state="disabled",this._button=e.button||"right",this._bearingSnap=e.bearingSnap||0,this._pitchWithRotate=!1!==e.pitchWithRotate,this._clickTolerance=e.clickTolerance||1,vt.bindAll(["onMouseDown","_onMouseMove","_onMouseUp","_onBlur","_onDragFrame"],this)}var Xi=vt.bezier(0,0,.25,1);Wi.prototype.isEnabled=function(){return"disabled"!==this._state},Wi.prototype.isActive=function(){return"active"===this._state},Wi.prototype.enable=function(){this.isEnabled()||(this._state="enabled")},Wi.prototype.disable=function(){if(this.isEnabled())switch(this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend"),this._pitchWithRotate&&this._fireEvent("pitchend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},Wi.prototype.onMouseDown=function(t){if("enabled"===this._state){var e="touchstart"===t.type;if(e)this._startTime=Date.now();else if("right"===this._button){if(this._eventButton=_.mouseButton(t),t.altKey||t.metaKey)return;if(this._eventButton!==(t.ctrlKey?0:2))return}else{if(t.ctrlKey||0!==_.mouseButton(t))return;this._eventButton=0}_.disableDrag(),e?(vt.window.document.addEventListener("touchmove",this._onMouseMove,{capture:!0}),vt.window.document.addEventListener("touchend",this._onMouseUp)):(vt.window.document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),vt.window.document.addEventListener("mouseup",this._onMouseUp)),vt.window.addEventListener("blur",this._onBlur),this._state="pending",this._inertia=[[vt.browser.now(),this._map.getBearing()]],this._startPos=this._prevPos=this._lastPos=_.mousePos(this._el,t),this._center=this._map.transform.centerPoint,t.preventDefault()}},Wi.prototype._onMouseMove=function(t){var e=_.mousePos(this._el,t);this._lastPos.equals(e)||"pending"===this._state&&e.dist(this._startPos)<this._clickTolerance||(this._lastMoveEvent=t,this._lastPos=e,"pending"===this._state&&(this._state="active",this._fireEvent("rotatestart",t),this._fireEvent("movestart",t),this._pitchWithRotate&&this._fireEvent("pitchstart",t)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},Wi.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t){var e=this._map.transform,r=this._prevPos,n=this._lastPos,i=e.bearing-.8*(r.x-n.x),o=e.pitch- -.5*(r.y-n.y),a=this._inertia,s=a[a.length-1];this._drainInertiaBuffer(),a.push([vt.browser.now(),this._map._normalizeBearing(i,s[1])]);var u=e.bearing;if(e.bearing=i,this._pitchWithRotate){var c=e.pitch;e.pitch=o,e.pitch!==c&&this._fireEvent("pitch",t)}e.bearing!==u&&this._fireEvent("rotate",t),this._fireEvent("move",t),delete this._lastMoveEvent,this._prevPos=this._lastPos}},Wi.prototype._onMouseUp=function(t){var e="touchend"===t.type;if(e&&this._startPos===this._lastPos&&Date.now()-this._startTime<300&&this._el.click(),e||_.mouseButton(t)===this._eventButton)switch(this._state){case"active":this._state="enabled",_.suppressClick(),this._unbind(),this._deactivate(),this._inertialRotate(t);break;case"pending":this._state="enabled",this._unbind()}},Wi.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend",t),this._pitchWithRotate&&this._fireEvent("pitchend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind()}},Wi.prototype._unbind=function(){vt.window.document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),vt.window.document.removeEventListener("mouseup",this._onMouseUp),vt.window.document.removeEventListener("touchmove",this._onMouseMove,{capture:!0}),vt.window.document.removeEventListener("touchend",this._onMouseUp),vt.window.removeEventListener("blur",this._onBlur),_.enableDrag()},Wi.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._prevPos,delete this._lastPos},Wi.prototype._inertialRotate=function(t){var e=this;this._fireEvent("rotateend",t),this._drainInertiaBuffer();function r(){Math.abs(i)<e._bearingSnap?n.resetNorth({noMoveStart:!0},{originalEvent:t}):e._fireEvent("moveend",t),e._pitchWithRotate&&e._fireEvent("pitchend",t)}var n=this._map,i=n.getBearing(),o=this._inertia;if(o.length<2)r();else{var a=o[0],s=o[o.length-1],u=n._normalizeBearing(i,o[o.length-2][1]),c=s[1]-a[1],l=c<0?-1:1,h=(s[0]-a[0])/1e3;if(0!=c&&0!=h){var p=Math.abs(.25/h*c);180<p&&(p=180);var f=p/180;u+=l*p*(f/2),Math.abs(n._normalizeBearing(u,0))<this._bearingSnap&&(u=n._normalizeBearing(0,u)),n.rotateTo(u,{duration:1e3*f,easing:Xi,noMoveStart:!0},{originalEvent:t})}else r()}},Wi.prototype._fireEvent=function(t,e){return this._map.fire(new vt.Event(t,e?{originalEvent:e}:{}))},Wi.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=vt.browser.now();0<t.length&&160<e-t[0][0];)t.shift()};function Yi(t,e){this._map=t,this._el=t.getCanvasContainer(),this._state="disabled",this._clickTolerance=e.clickTolerance||1,this._inertiaOptions=Zi,vt.bindAll(["_onMove","_onMouseUp","_onTouchEnd","_onBlur","_onDragFrame"],this)}var Zi={linearity:.3,easing:vt.bezier(0,0,.3,1),maxSpeed:1400,deceleration:2500};Yi.prototype.isEnabled=function(){return"disabled"!==this._state},Yi.prototype.isActive=function(){return"active"===this._state},Yi.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-drag-pan"),this._state="enabled",this._inertiaOptions=vt.extend(Zi,t))},Yi.prototype.disable=function(){if(this.isEnabled())switch(this._el.classList.remove("mapboxgl-touch-drag-pan"),this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("dragend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},Yi.prototype.onMouseDown=function(t){"enabled"===this._state&&(t.ctrlKey||0!==_.mouseButton(t)||(_.addEventListener(vt.window.document,"mousemove",this._onMove,{capture:!0}),_.addEventListener(vt.window.document,"mouseup",this._onMouseUp),this._start(t)))},Yi.prototype.onTouchStart=function(t){this.isEnabled()&&(t.touches&&1<t.touches.length&&("pending"===this._state||"active"===this._state)||(_.addEventListener(vt.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),_.addEventListener(vt.window.document,"touchend",this._onTouchEnd),this._start(t)))},Yi.prototype._start=function(t){vt.window.addEventListener("blur",this._onBlur),this._state="pending",this._startPos=this._mouseDownPos=this._prevPos=this._lastPos=_.mousePos(this._el,t),this._startTouch=this._lastTouch=vt.window.TouchEvent&&t instanceof vt.window.TouchEvent?_.touchPos(this._el,t):null,this._inertia=[[vt.browser.now(),this._startPos]]},Yi.prototype._touchesMatch=function(t,r){return!(!t||!r||t.length!==r.length)&&t.every(function(t,e){return r[e]===t})},Yi.prototype._onMove=function(t){t.preventDefault();var e=vt.window.TouchEvent&&t instanceof vt.window.TouchEvent?_.touchPos(this._el,t):null,r=_.mousePos(this._el,t);(e?this._touchesMatch(this._lastTouch,e):this._lastPos.equals(r))||"pending"===this._state&&r.dist(this._mouseDownPos)<this._clickTolerance||(this._lastMoveEvent=t,this._lastPos=r,this._lastTouch=e,this._drainInertiaBuffer(),this._inertia.push([vt.browser.now(),this._lastPos]),"pending"===this._state&&(this._state="active",this._shouldStart=!0),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},Yi.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t)if(this._map.touchZoomRotate.isActive())this._abort(t);else if(this._shouldStart&&(this._fireEvent("dragstart",t),this._fireEvent("movestart",t),this._shouldStart=!1),this.isActive()){var e=this._map.transform;e.setLocationAtPoint(e.pointLocation(this._prevPos),this._lastPos),this._fireEvent("drag",t),this._fireEvent("move",t),this._prevPos=this._lastPos,delete this._lastMoveEvent}},Yi.prototype._onMouseUp=function(t){if(0===_.mouseButton(t))switch(this._state){case"active":this._state="enabled",_.suppressClick(),this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind()}},Yi.prototype._onTouchEnd=function(t){if(t.touches&&0!==t.touches.length)switch(this._state){case"pending":case"active":break;case"enabled":this.onTouchStart(t)}else switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind();break;case"enabled":this._unbind()}},Yi.prototype._abort=function(t){switch(this._state){case"active":this._state="enabled",this._shouldStart||(this._fireEvent("dragend",t),this._fireEvent("moveend",t)),this._unbind(),this._deactivate(),vt.window.TouchEvent&&t instanceof vt.window.TouchEvent&&1<t.touches.length&&_.addEventListener(vt.window.document,"touchend",this._onTouchEnd);break;case"pending":this._state="enabled",this._unbind();break;case"enabled":this._unbind()}},Yi.prototype._onBlur=function(t){this._abort(t)},Yi.prototype._unbind=function(){_.removeEventListener(vt.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),_.removeEventListener(vt.window.document,"touchend",this._onTouchEnd),_.removeEventListener(vt.window.document,"mousemove",this._onMove,{capture:!0}),_.removeEventListener(vt.window.document,"mouseup",this._onMouseUp),_.removeEventListener(vt.window,"blur",this._onBlur)},Yi.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._prevPos,delete this._mouseDownPos,delete this._lastPos,delete this._startTouch,delete this._lastTouch,delete this._shouldStart},Yi.prototype._inertialPan=function(t){this._fireEvent("dragend",t),this._drainInertiaBuffer();var e=this._inertia;if(e.length<2)this._fireEvent("moveend",t);else{var r=e[e.length-1],n=e[0],i=r[1].sub(n[1]),o=(r[0]-n[0])/1e3;if(0==o||r[1].equals(n[1]))this._fireEvent("moveend",t);else{var a=this._inertiaOptions,s=a.linearity,u=a.easing,c=a.maxSpeed,l=a.deceleration,h=i.mult(s/o),p=h.mag();c<p&&(p=c,h._unit()._mult(p));var f=p/(l*s),d=h.mult(-f/2);this._map.panBy(d,{duration:1e3*f,easing:u,noMoveStart:!0},{originalEvent:t})}}},Yi.prototype._fireEvent=function(t,e){return this._map.fire(new vt.Event(t,e?{originalEvent:e}:{}))},Yi.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=vt.browser.now();0<t.length&&160<e-t[0][0];)t.shift()};function Ki(t){this._map=t,this._el=t.getCanvasContainer(),vt.bindAll(["_onKeyDown"],this)}function Ji(t){return t*(2-t)}Ki.prototype.isEnabled=function(){return!!this._enabled},Ki.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},Ki.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},Ki.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,r=0,n=0,i=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),i=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),i=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?n=-1:(o=1,t.preventDefault());break;default:return}var a=this._map,s=a.getZoom(),u={duration:300,delayEndEvents:500,easing:Ji,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:a.getBearing()+15*r,pitch:a.getPitch()+10*n,offset:[100*-i,100*-o],center:a.getCenter()};a.easeTo(u,{originalEvent:t})}};function Qi(t){this._map=t,vt.bindAll(["_onDblClick","_onZoomEnd"],this)}Qi.prototype.isEnabled=function(){return!!this._enabled},Qi.prototype.isActive=function(){return!!this._active},Qi.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Qi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Qi.prototype.onTouchStart=function(t){var e=this;if(this.isEnabled()&&!(1<t.points.length))if(this._tapped){var r=this._tappedPoint;if(r&&r.dist(t.points[0])<=30){t.originalEvent.preventDefault();var n=function(){e._tapped&&e._zoom(t),e._map.off("touchcancel",i),e._resetTapped()},i=function(){e._map.off("touchend",n),e._resetTapped()};this._map.once("touchend",n),this._map.once("touchcancel",i)}else this._resetTapped()}else this._tappedPoint=t.points[0],this._tapped=setTimeout(function(){e._tapped=null,e._tappedPoint=null},300)},Qi.prototype._resetTapped=function(){clearTimeout(this._tapped),this._tapped=null,this._tappedPoint=null},Qi.prototype.onDblClick=function(t){this.isEnabled()&&(t.originalEvent.preventDefault(),this._zoom(t))},Qi.prototype._zoom=function(t){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},Qi.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd)};function to(t){this._map=t,this._el=t.getCanvasContainer(),vt.bindAll(["_onMove","_onEnd","_onTouchFrame"],this)}var eo=vt.bezier(0,0,.15,1);to.prototype.isEnabled=function(){return!!this._enabled},to.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-zoom-rotate"),this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)},to.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("mapboxgl-touch-zoom-rotate"),this._enabled=!1)},to.prototype.disableRotation=function(){this._rotationDisabled=!0},to.prototype.enableRotation=function(){this._rotationDisabled=!1},to.prototype.isActive=function(){return this.isEnabled()&&!!this._gestureIntent},to.prototype.onStart=function(t){if(this.isEnabled()&&2===t.touches.length){var e=_.mousePos(this._el,t.touches[0]),r=_.mousePos(this._el,t.touches[1]),n=e.add(r).div(2);this._startVec=e.sub(r),this._startAround=this._map.transform.pointLocation(n),this._gestureIntent=void 0,this._inertia=[],_.addEventListener(vt.window.document,"touchmove",this._onMove,{passive:!1}),_.addEventListener(vt.window.document,"touchend",this._onEnd)}},to.prototype._getTouchEventData=function(t){var e=_.mousePos(this._el,t.touches[0]),r=_.mousePos(this._el,t.touches[1]),n=e.sub(r);return{vec:n,center:e.add(r).div(2),scale:n.mag()/this._startVec.mag(),bearing:this._rotationDisabled?0:180*n.angleWith(this._startVec)/Math.PI}},to.prototype._onMove=function(t){if(2===t.touches.length){var e=this._getTouchEventData(t),r=e.vec,n=e.scale,i=e.bearing;if(!this._gestureIntent){var o=this._rotationDisabled&&1!==n||.15<Math.abs(1-n);10<Math.abs(i)?this._gestureIntent="rotate":o&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._map.fire(new vt.Event(this._gestureIntent+"start",{originalEvent:t})),this._map.fire(new vt.Event("movestart",{originalEvent:t})),this._startVec=r)}this._lastTouchEvent=t,this._frameId||(this._frameId=this._map._requestRenderFrame(this._onTouchFrame)),t.preventDefault()}},to.prototype._onTouchFrame=function(){this._frameId=null;var t=this._gestureIntent;if(t){var e=this._map.transform;this._startScale||(this._startScale=e.scale,this._startBearing=e.bearing);var r=this._getTouchEventData(this._lastTouchEvent),n=r.center,i=r.bearing,o=r.scale,a=e.pointLocation(n),s=e.locationPoint(a);"rotate"===t&&(e.bearing=this._startBearing+i),e.zoom=e.scaleZoom(this._startScale*o),e.setLocationAtPoint(this._startAround,s),this._map.fire(new vt.Event(t,{originalEvent:this._lastTouchEvent})),this._map.fire(new vt.Event("move",{originalEvent:this._lastTouchEvent})),this._drainInertiaBuffer(),this._inertia.push([vt.browser.now(),o,n])}},to.prototype._onEnd=function(t){_.removeEventListener(vt.window.document,"touchmove",this._onMove,{passive:!1}),_.removeEventListener(vt.window.document,"touchend",this._onEnd);var e=this._gestureIntent,r=this._startScale;if(this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._gestureIntent,delete this._startScale,delete this._startBearing,delete this._lastTouchEvent,e){this._map.fire(new vt.Event(e+"end",{originalEvent:t})),this._drainInertiaBuffer();var n=this._inertia,i=this._map;if(n.length<2)i.snapToNorth({},{originalEvent:t});else{var o=n[n.length-1],a=n[0],s=i.transform.scaleZoom(r*o[1]),u=i.transform.scaleZoom(r*a[1]),c=(o[0]-a[0])/1e3,l=o[2];if(0!=c&&s!==u){var h=.15*(s-u)/c;2.5<Math.abs(h)&&(h=0<h?2.5:-2.5);var p=1e3*Math.abs(h/(12*.15));i.easeTo({zoom:s+h*p/2e3,duration:p,easing:eo,around:this._aroundCenter?i.getCenter():i.unproject(l),noMoveStart:!0},{originalEvent:t})}else i.snapToNorth({},{originalEvent:t})}}},to.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=vt.browser.now();2<t.length&&160<e-t[0][0];)t.shift()};function ro(t){void 0===t&&(t={}),this.options=t,vt.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)}var no,io={scrollZoom:Vi,boxZoom:$i,dragRotate:Wi,dragPan:Yi,keyboard:Ki,doubleClickZoom:Qi,touchZoomRotate:to},oo=((no=vt.Evented)&&(ao.__proto__=no),((ao.prototype=Object.create(no&&no.prototype)).constructor=ao).prototype.getCenter=function(){return new vt.LngLat(this.transform.center.lng,this.transform.center.lat)},ao.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},ao.prototype.panBy=function(t,e,r){return t=vt.Point.convert(t).mult(-1),this.panTo(this.transform.center,vt.extend({offset:t},e),r)},ao.prototype.panTo=function(t,e,r){return this.easeTo(vt.extend({center:t},e),r)},ao.prototype.getZoom=function(){return this.transform.zoom},ao.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},ao.prototype.zoomTo=function(t,e,r){return this.easeTo(vt.extend({zoom:t},e),r)},ao.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},ao.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},ao.prototype.getBearing=function(){return this.transform.bearing},ao.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},ao.prototype.getPadding=function(){return this.transform.padding},ao.prototype.setPadding=function(t,e){return this.jumpTo({padding:t},e),this},ao.prototype.rotateTo=function(t,e,r){return this.easeTo(vt.extend({bearing:t},e),r)},ao.prototype.resetNorth=function(t,e){return this.rotateTo(0,vt.extend({duration:1e3},t),e),this},ao.prototype.resetNorthPitch=function(t,e){return this.easeTo(vt.extend({bearing:0,pitch:0,duration:1e3},t),e),this},ao.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},ao.prototype.getPitch=function(){return this.transform.pitch},ao.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},ao.prototype.cameraForBounds=function(t,e){return t=vt.LngLatBounds.convert(t),this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),0,e)},ao.prototype._cameraForBoxAndBearing=function(t,e,r,n){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=vt.extend({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){var o=n.padding;n.padding={top:o,bottom:o,right:o,left:o}}n.padding=vt.extend(i,n.padding);var a=this.transform,s=a.padding,u=a.project(vt.LngLat.convert(t)),c=a.project(vt.LngLat.convert(e)),l=u.rotate(-r*Math.PI/180),h=c.rotate(-r*Math.PI/180),p=new vt.Point(Math.max(l.x,h.x),Math.max(l.y,h.y)),f=new vt.Point(Math.min(l.x,h.x),Math.min(l.y,h.y)),d=p.sub(f),m=(a.width-(s.left+s.right+n.padding.left+n.padding.right))/d.x,g=(a.height-(s.top+s.bottom+n.padding.top+n.padding.bottom))/d.y;if(!(g<0||m<0)){var y=Math.min(a.scaleZoom(a.scale*Math.min(m,g)),n.maxZoom),v=vt.Point.convert(n.offset),_=new vt.Point(v.x+(n.padding.left-n.padding.right)/2,v.y+(n.padding.top-n.padding.bottom)/2).mult(a.scale/a.zoomScale(y));return{center:a.unproject(u.add(c).div(2).sub(_)),zoom:y,bearing:r}}vt.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},ao.prototype.fitBounds=function(t,e,r){return this._fitInternal(this.cameraForBounds(t,e),e,r)},ao.prototype.fitScreenCoordinates=function(t,e,r,n,i){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(vt.Point.convert(t)),this.transform.pointLocation(vt.Point.convert(e)),r,n),n,i)},ao.prototype._fitInternal=function(t,e,r){return t?(delete(e=vt.extend(t,e)).padding,e.linear?this.easeTo(e,r):this.flyTo(e,r)):this},ao.prototype.jumpTo=function(t,e){this.stop();var r=this.transform,n=!1,i=!1,o=!1;return"zoom"in t&&r.zoom!==+t.zoom&&(n=!0,r.zoom=+t.zoom),void 0!==t.center&&(r.center=vt.LngLat.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(i=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(o=!0,r.pitch=+t.pitch),null==t.padding||r.isPaddingEqual(t.padding)||(r.padding=t.padding),this.fire(new vt.Event("movestart",e)).fire(new vt.Event("move",e)),n&&this.fire(new vt.Event("zoomstart",e)).fire(new vt.Event("zoom",e)).fire(new vt.Event("zoomend",e)),i&&this.fire(new vt.Event("rotatestart",e)).fire(new vt.Event("rotate",e)).fire(new vt.Event("rotateend",e)),o&&this.fire(new vt.Event("pitchstart",e)).fire(new vt.Event("pitch",e)).fire(new vt.Event("pitchend",e)),this.fire(new vt.Event("moveend",e))},ao.prototype.easeTo=function(t,o){var a=this;this.stop(),(!1===(t=vt.extend({offset:[0,0],duration:500,easing:vt.ease},t)).animate||!t.essential&&vt.browser.prefersReducedMotion)&&(t.duration=0);var s=this.transform,u=this.getZoom(),c=this.getBearing(),l=this.getPitch(),h=this.getPadding(),p="zoom"in t?+t.zoom:u,f="bearing"in t?this._normalizeBearing(t.bearing,c):c,d="pitch"in t?+t.pitch:l,m="padding"in t?t.padding:s.padding,g=vt.Point.convert(t.offset),y=s.centerPoint.add(g),e=s.pointLocation(y),r=vt.LngLat.convert(t.center||e);this._normalizeCenter(r);var v,_,b=s.project(e),x=s.project(r).sub(b),w=s.zoomScale(p-u);return t.around&&(v=vt.LngLat.convert(t.around),_=s.locationPoint(v)),this._zooming=p!==u,this._rotating=c!==f,this._pitching=d!==l,this._padding=!s.isPaddingEqual(m),this._prepareEase(o,t.noMoveStart),clearTimeout(this._easeEndTimeoutID),this._ease(function(t){if(a._zooming&&(s.zoom=vt.number(u,p,t)),a._rotating&&(s.bearing=vt.number(c,f,t)),a._pitching&&(s.pitch=vt.number(l,d,t)),a._padding&&(s.interpolatePadding(h,m,t),y=s.centerPoint.add(g)),v)s.setLocationAtPoint(v,_);else{var e=s.zoomScale(s.zoom-u),r=u<p?Math.min(2,w):Math.max(.5,w),n=Math.pow(r,1-t),i=s.unproject(b.add(x.mult(t*n)).mult(e));s.setLocationAtPoint(s.renderWorldCopies?i.wrap():i,y)}a._fireMoveEvents(o)},function(){t.delayEndEvents?a._easeEndTimeoutID=setTimeout(function(){return a._afterEase(o)},t.delayEndEvents):a._afterEase(o)},t),this},ao.prototype._prepareEase=function(t,e){this._moving=!0,e||this.fire(new vt.Event("movestart",t)),this._zooming&&this.fire(new vt.Event("zoomstart",t)),this._rotating&&this.fire(new vt.Event("rotatestart",t)),this._pitching&&this.fire(new vt.Event("pitchstart",t))},ao.prototype._fireMoveEvents=function(t){this.fire(new vt.Event("move",t)),this._zooming&&this.fire(new vt.Event("zoom",t)),this._rotating&&this.fire(new vt.Event("rotate",t)),this._pitching&&this.fire(new vt.Event("pitch",t))},ao.prototype._afterEase=function(t){var e=this._zooming,r=this._rotating,n=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,e&&this.fire(new vt.Event("zoomend",t)),r&&this.fire(new vt.Event("rotateend",t)),n&&this.fire(new vt.Event("pitchend",t)),this.fire(new vt.Event("moveend",t))},ao.prototype.flyTo=function(t,i){var o=this;if(!t.essential&&vt.browser.prefersReducedMotion){var e=vt.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(e,i)}this.stop(),t=vt.extend({offset:[0,0],speed:1.2,curve:1.42,easing:vt.ease},t);var a=this.transform,s=this.getZoom(),u=this.getBearing(),c=this.getPitch(),l=this.getPadding(),h="zoom"in t?vt.clamp(+t.zoom,a.minZoom,a.maxZoom):s,p="bearing"in t?this._normalizeBearing(t.bearing,u):u,f="pitch"in t?+t.pitch:c,d="padding"in t?t.padding:a.padding,r=a.zoomScale(h-s),m=vt.Point.convert(t.offset),g=a.centerPoint.add(m),n=a.pointLocation(g),y=vt.LngLat.convert(t.center||n);this._normalizeCenter(y);var v=a.project(n),_=a.project(y).sub(v),b=t.curve,x=Math.max(a.width,a.height),w=x/r,S=_.mag();if("minZoom"in t){var E=vt.clamp(Math.min(t.minZoom,s,h),a.minZoom,a.maxZoom),C=x/a.zoomScale(E-s);b=Math.sqrt(C/S*2)}var M=b*b;function T(t){var e=(w*w-x*x+(t?-1:1)*M*M*S*S)/(2*(t?w:x)*M*S);return Math.log(Math.sqrt(e*e+1)-e)}function P(t){return(Math.exp(t)-Math.exp(-t))/2}function O(t){return(Math.exp(t)+Math.exp(-t))/2}var A=T(0),I=function(t){return O(A)/O(A+b*t)},L=function(t){return x*((O(A)*(P(e=A+b*t)/O(e))-P(A))/M)/S;var e},R=(T(1)-A)/b;if(Math.abs(S)<1e-6||!isFinite(R)){if(Math.abs(x-w)<1e-6)return this.easeTo(t,i);var N=w<x?-1:1;R=Math.abs(Math.log(w/x))/b,L=function(){return 0},I=function(t){return Math.exp(N*b*t)}}return t.duration="duration"in t?+t.duration:1e3*R/("screenSpeed"in t?+t.screenSpeed/b:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=u!==p,this._pitching=f!==c,this._padding=!a.isPaddingEqual(d),this._prepareEase(i,!1),this._ease(function(t){var e=t*R,r=1/I(e);a.zoom=1===t?h:s+a.scaleZoom(r),o._rotating&&(a.bearing=vt.number(u,p,t)),o._pitching&&(a.pitch=vt.number(c,f,t)),o._padding&&(a.interpolatePadding(l,d,t),g=a.centerPoint.add(m));var n=1===t?y:a.unproject(v.add(_.mult(L(e))).mult(r));a.setLocationAtPoint(a.renderWorldCopies?n.wrap():n,g),o._fireMoveEvents(i)},function(){return o._afterEase(i)},t),this},ao.prototype.isEasing=function(){return!!this._easeFrameId},ao.prototype.stop=function(){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var t=this._onEaseEnd;delete this._onEaseEnd,t.call(this)}return this},ao.prototype._ease=function(t,e,r){!1===r.animate||0===r.duration?(t(1),e()):(this._easeStart=vt.browser.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},ao.prototype._renderFrameCallback=function(){var t=Math.min((vt.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},ao.prototype._normalizeBearing=function(t,e){t=vt.wrap(t,-180,180);var r=Math.abs(t-e);return Math.abs(t-360-e)<r&&(t-=360),Math.abs(t+360-e)<r&&(t+=360),t},ao.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var r=t.lng-e.center.lng;t.lng+=180<r?-360:r<-180?360:0}},ao);function ao(t,e){no.call(this),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=e.bearingSnap,vt.bindAll(["_renderFrameCallback"],this)}ro.prototype.getDefaultPosition=function(){return"bottom-right"},ro.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=_.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._innerContainer=_.create("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ro.prototype.onRemove=function(){_.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ro.prototype._updateEditLink=function(){var t=this._editLink;t=t||(this._editLink=this._container.querySelector(".mapbox-improve-map"));var n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||vt.config.ACCESS_TOKEN}];if(t){var e=n.reduce(function(t,e,r){return e.value&&(t+=e.key+"="+e.value+(r<n.length-1?"&":"")),t},"?");t.href=vt.config.FEEDBACK_URL+"/"+e+(this._map._hash?this._map._hash.getHashString(!0):""),t.rel="noopener nofollow"}},ro.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},ro.prototype._updateAttributions=function(){if(this._map.style){var n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(function(t){return"string"!=typeof t?"":t})):"string"==typeof this.options.customAttribution&&n.push(this.options.customAttribution)),this._map.style.stylesheet){var t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}var e=this._map.style.sourceCaches;for(var r in e){var i=e[r];if(i.used){var o=i.getSource();o.attribution&&n.indexOf(o.attribution)<0&&n.push(o.attribution)}}n.sort(function(t,e){return t.length-e.length});var a=(n=n.filter(function(t,e){for(var r=e+1;r<n.length;r++)if(0<=n[r].indexOf(t))return!1;return!0})).join(" | ");a!==this._attribHTML&&(this._attribHTML=a,n.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ro.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact")};function so(){vt.bindAll(["_updateLogo"],this),vt.bindAll(["_updateCompact"],this)}so.prototype.onAdd=function(t){this._map=t,this._container=_.create("div","mapboxgl-ctrl");var e=_.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},so.prototype.onRemove=function(){_.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},so.prototype.getDefaultPosition=function(){return"bottom-left"},so.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},so.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},so.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};function uo(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}uo.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},uo.prototype.remove=function(t){for(var e=this._currentlyRunning,r=0,n=e?this._queue.concat(e):this._queue;r<n.length;r+=1){var i=n[r];if(i.id===t)return void(i.cancelled=!0)}},uo.prototype.run=function(){var t=this._currentlyRunning=this._queue;this._queue=[];for(var e=0,r=t;e<r.length;e+=1){var n=r[e];if(!n.cancelled&&(n.callback(),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},uo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var co={"FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},lo=vt.window.HTMLImageElement,ho=vt.window.HTMLElement,po=vt.window.ImageBitmap,fo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,clickTolerance:3,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},mo=function(c){function t(t){var e=this;if(null!=(t=vt.extend({},fo,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&60<t.maxPitch)throw new Error("maxPitch must be less than or equal to 60");var r=new Fi(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies);if(c.call(this,r,t),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._renderTaskQueue=new uo,this._controls=[],this._mapId=vt.uniqueId(),this._locale=vt.extend({},co,t.locale),this._requestManager=new vt.RequestManager(t.transformRequest,t.accessToken),"string"==typeof t.container){if(this._container=vt.window.document.getElementById(t.container),!this._container)throw new Error("Container '"+t.container+"' not found.")}else{if(!(t.container instanceof ho))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),vt.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return e._update(!1)}),this.on("moveend",function(){return e._update(!1)}),this.on("zoom",function(){return e._update(!0)}),void 0!==vt.window&&(vt.window.addEventListener("online",this._onWindowOnline,!1),vt.window.addEventListener("resize",this._onWindowResize,!1)),function(r,n){var i=r.getCanvasContainer(),o=null,a=!1,s=null;for(var t in io)r[t]=new io[t](r,n),n.interactive&&n[t]&&r[t].enable(n[t]);_.addEventListener(i,"mouseout",function(t){r.fire(new Gi("mouseout",r,t))}),_.addEventListener(i,"mousedown",function(t){a=!0,s=_.mousePos(i,t);var e=new Gi("mousedown",r,t);r.fire(e),e.defaultPrevented||(n.interactive&&!r.doubleClickZoom.isActive()&&r.stop(),r.boxZoom.onMouseDown(t),r.boxZoom.isActive()||r.dragPan.isActive()||r.dragRotate.onMouseDown(t),r.boxZoom.isActive()||r.dragRotate.isActive()||r.dragPan.onMouseDown(t))}),_.addEventListener(i,"mouseup",function(t){var e=r.dragRotate.isActive();o&&!e&&r.fire(new Gi("contextmenu",r,o)),o=null,a=!1,r.fire(new Gi("mouseup",r,t))}),_.addEventListener(i,"mousemove",function(t){if(!r.dragPan.isActive()&&!r.dragRotate.isActive()){for(var e=t.target;e&&e!==i;)e=e.parentNode;e===i&&r.fire(new Gi("mousemove",r,t))}}),_.addEventListener(i,"mouseover",function(t){for(var e=t.target;e&&e!==i;)e=e.parentNode;e===i&&r.fire(new Gi("mouseover",r,t))}),_.addEventListener(i,"touchstart",function(t){var e=new qi("touchstart",r,t);r.fire(e),e.defaultPrevented||(n.interactive&&r.stop(),r.boxZoom.isActive()||r.dragRotate.isActive()||r.dragPan.onTouchStart(t),r.touchZoomRotate.onStart(t),r.doubleClickZoom.onTouchStart(e))},{passive:!1}),_.addEventListener(i,"touchmove",function(t){r.fire(new qi("touchmove",r,t))},{passive:!1}),_.addEventListener(i,"touchend",function(t){r.fire(new qi("touchend",r,t))}),_.addEventListener(i,"touchcancel",function(t){r.fire(new qi("touchcancel",r,t))}),_.addEventListener(i,"click",function(t){var e=_.mousePos(i,t);(!s||e.equals(s)||e.dist(s)<n.clickTolerance)&&r.fire(new Gi("click",r,t))}),_.addEventListener(i,"dblclick",function(t){var e=new Gi("dblclick",r,t);r.fire(e),e.defaultPrevented||r.doubleClickZoom.onDblClick(e)}),_.addEventListener(i,"contextmenu",function(t){var e=r.dragRotate.isActive();a||e?a&&(o=t):r.fire(new Gi("contextmenu",r,t)),(r.dragRotate.isEnabled()||r.listens("contextmenu"))&&t.preventDefault()}),_.addEventListener(i,"wheel",function(t){n.interactive&&r.stop();var e=new Hi("wheel",r,t);r.fire(e),e.defaultPrevented||r.scrollZoom.onWheel(t)},{passive:!1})}(this,t),this._hash=t.hash&&new Ui("string"==typeof t.hash&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,vt.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new ro({customAttribution:t.customAttribution})),this.addControl(new so,t.logoPosition),this.on("style.load",function(){e.transform.unmodified&&e.jumpTo(e.style.stylesheet)}),this.on("data",function(t){e._update("style"===t.dataType),e.fire(new vt.Event(t.dataType+"data",t))}),this.on("dataloading",function(t){e.fire(new vt.Event(t.dataType+"dataloading",t))})}c&&(t.__proto__=c);var e={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return((t.prototype=Object.create(c&&c.prototype)).constructor=t).prototype._getMapId=function(){return this._mapId},t.prototype.addControl=function(t,e){if(void 0===e&&t.getDefaultPosition&&(e=t.getDefaultPosition()),void 0===e&&(e="top-right"),!t||!t.onAdd)return this.fire(new vt.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var r=t.onAdd(this);this._controls.push(t);var n=this._controlPositions[e];return-1!==e.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this},t.prototype.removeControl=function(t){if(!t||!t.onRemove)return this.fire(new vt.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var e=this._controls.indexOf(t);return-1<e&&this._controls.splice(e,1),t.onRemove(this),this},t.prototype.resize=function(t){var e=this._containerDimensions(),r=e[0],n=e[1];return this._resizeCanvas(r,n),this.transform.resize(r,n),this.painter.resize(r,n),this.fire(new vt.Event("movestart",t)).fire(new vt.Event("move",t)).fire(new vt.Event("resize",t)).fire(new vt.Event("moveend",t)),this},t.prototype.getBounds=function(){return this.transform.getBounds()},t.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},t.prototype.setMaxBounds=function(t){return this.transform.setMaxBounds(vt.LngLatBounds.convert(t)),this._update()},t.prototype.setMinZoom=function(t){if(-2<=(t=null==t?-2:t)&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},t.prototype.getMinZoom=function(){return this.transform.minZoom},t.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},t.prototype.getMaxZoom=function(){return this.transform.maxZoom},t.prototype.setMinPitch=function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(0<=t&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},t.prototype.getMinPitch=function(){return this.transform.minPitch},t.prototype.setMaxPitch=function(t){if(60<(t=null==t?60:t))throw new Error("maxPitch must be less than or equal to 60");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")},t.prototype.getMaxPitch=function(){return this.transform.maxPitch},t.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},t.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},t.prototype.project=function(t){return this.transform.locationPoint(vt.LngLat.convert(t))},t.prototype.unproject=function(t){return this.transform.pointLocation(vt.Point.convert(t))},t.prototype.isMoving=function(){return this._moving||this.dragPan.isActive()||this.dragRotate.isActive()||this.scrollZoom.isActive()},t.prototype.isZooming=function(){return this._zooming||this.scrollZoom.isZooming()},t.prototype.isRotating=function(){return this._rotating||this.dragRotate.isActive()},t.prototype._createDelegatedListener=function(r,n,i){var t,o=this;if("mouseenter"===r||"mouseover"===r){var a=!1;return{layer:n,listener:i,delegates:{mousemove:function(t){var e=o.getLayer(n)?o.queryRenderedFeatures(t.point,{layers:[n]}):[];e.length?a||(a=!0,i.call(o,new Gi(r,o,t.originalEvent,{features:e}))):a=!1},mouseout:function(){a=!1}}}}if("mouseleave"!==r&&"mouseout"!==r)return{layer:n,listener:i,delegates:(t={},t[r]=function(t){var e=o.getLayer(n)?o.queryRenderedFeatures(t.point,{layers:[n]}):[];e.length&&(t.features=e,i.call(o,t),delete t.features)},t)};var e=!1;return{layer:n,listener:i,delegates:{mousemove:function(t){(o.getLayer(n)?o.queryRenderedFeatures(t.point,{layers:[n]}):[]).length?e=!0:e&&(e=!1,i.call(o,new Gi(r,o,t.originalEvent)))},mouseout:function(t){e&&(e=!1,i.call(o,new Gi(r,o,t.originalEvent)))}}}},t.prototype.on=function(t,e,r){if(void 0===r)return c.prototype.on.call(this,t,e);var n=this._createDelegatedListener(t,e,r);for(var i in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(n),n.delegates)this.on(i,n.delegates[i]);return this},t.prototype.once=function(t,e,r){if(void 0===r)return c.prototype.once.call(this,t,e);var n=this._createDelegatedListener(t,e,r);for(var i in n.delegates)this.once(i,n.delegates[i]);return this},t.prototype.off=function(o,a,s){var u=this;return void 0===s?c.prototype.off.call(this,o,a):(this._delegatedListeners&&this._delegatedListeners[o]&&function(t){for(var e=t[o],r=0;r<e.length;r++){var n=e[r];if(n.layer===a&&n.listener===s){for(var i in n.delegates)u.off(i,n.delegates[i]);return e.splice(r,1)}}}(this._delegatedListeners),this)},t.prototype.queryRenderedFeatures=function(t,e){if(!this.style)return[];var r;if(void 0!==e||void 0===t||t instanceof vt.Point||Array.isArray(t)||(e=t,t=void 0),e=e||{},(t=t||[[0,0],[this.transform.width,this.transform.height]])instanceof vt.Point||"number"==typeof t[0])r=[vt.Point.convert(t)];else{var n=vt.Point.convert(t[0]),i=vt.Point.convert(t[1]);r=[n,new vt.Point(i.x,n.y),i,new vt.Point(n.x,i.y),n]}return this.style.queryRenderedFeatures(r,e,this.transform)},t.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},t.prototype.setStyle=function(t,e){return!1!==(e=vt.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},e)).diff&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&t?(this._diffStyle(t,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(t,e))},t.prototype._getUIString=function(t){var e=this._locale[t];if(null==e)throw new Error("Missing UI string '"+t+"'");return e},t.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new yn(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)):delete this.style,this},t.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new yn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},t.prototype._diffStyle=function(t,r){var n=this;if("string"==typeof t){var e=this._requestManager.normalizeStyleURL(t),i=this._requestManager.transformRequest(e,vt.ResourceType.Style);vt.getJSON(i,function(t,e){t?n.fire(new vt.ErrorEvent(t)):e&&n._updateDiff(e,r)})}else"object"==typeof t&&this._updateDiff(t,r)},t.prototype._updateDiff=function(e,r){try{this.style.setState(e)&&this._update(!0)}catch(t){vt.warnOnce("Unable to perform style diff: "+(t.message||t.error||t)+".  Rebuilding the style from scratch."),this._updateStyle(e,r)}},t.prototype.getStyle=function(){if(this.style)return this.style.serialize()},t.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():vt.warnOnce("There is no style added to the map.")},t.prototype.addSource=function(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)},t.prototype.isSourceLoaded=function(t){var e=this.style&&this.style.sourceCaches[t];if(void 0!==e)return e.loaded();this.fire(new vt.ErrorEvent(new Error("There is no source with ID '"+t+"'")))},t.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var r=t[e]._tiles;for(var n in r){var i=r[n];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0},t.prototype.addSourceType=function(t,e,r){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,r)},t.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},t.prototype.getSource=function(t){return this.style.getSource(t)},t.prototype.addImage=function(t,e,r){void 0===r&&(r={});var n=r.pixelRatio;void 0===n&&(n=1);var i=r.sdf;void 0===i&&(i=!1);var o=r.stretchX,a=r.stretchY,s=r.content;if(this._lazyInitEmptyStyle(),e instanceof lo||po&&e instanceof po){var u=vt.browser.getImageData(e);this.style.addImage(t,{data:new vt.RGBAImage({width:u.width,height:u.height},u.data),pixelRatio:n,stretchX:o,stretchY:a,content:s,sdf:i,version:0})}else{if(void 0===e.width||void 0===e.height)return this.fire(new vt.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=e;this.style.addImage(t,{data:new vt.RGBAImage({width:e.width,height:e.height},new Uint8Array(e.data)),pixelRatio:n,stretchX:o,stretchY:a,content:s,sdf:i,version:0,userImage:c}),c.onAdd&&c.onAdd(this,t)}},t.prototype.updateImage=function(t,e){var r=this.style.getImage(t);if(!r)return this.fire(new vt.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var n=e instanceof lo||po&&e instanceof po?vt.browser.getImageData(e):e,i=n.width,o=n.height,a=n.data;return void 0===i||void 0===o?this.fire(new vt.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):i!==r.data.width||o!==r.data.height?this.fire(new vt.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(r.data.replace(a,!(e instanceof lo||po&&e instanceof po)),void this.style.updateImage(t,r))},t.prototype.hasImage=function(t){return t?!!this.style.getImage(t):(this.fire(new vt.ErrorEvent(new Error("Missing required image id"))),!1)},t.prototype.removeImage=function(t){this.style.removeImage(t)},t.prototype.loadImage=function(t,e){vt.getImage(this._requestManager.transformRequest(t,vt.ResourceType.Image),e)},t.prototype.listImages=function(){return this.style.listImages()},t.prototype.addLayer=function(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)},t.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},t.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},t.prototype.getLayer=function(t){return this.style.getLayer(t)},t.prototype.setLayerZoomRange=function(t,e,r){return this.style.setLayerZoomRange(t,e,r),this._update(!0)},t.prototype.setFilter=function(t,e,r){return void 0===r&&(r={}),this.style.setFilter(t,e,r),this._update(!0)},t.prototype.getFilter=function(t){return this.style.getFilter(t)},t.prototype.setPaintProperty=function(t,e,r,n){return void 0===n&&(n={}),this.style.setPaintProperty(t,e,r,n),this._update(!0)},t.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},t.prototype.setLayoutProperty=function(t,e,r,n){return void 0===n&&(n={}),this.style.setLayoutProperty(t,e,r,n),this._update(!0)},t.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},t.prototype.setLight=function(t,e){return void 0===e&&(e={}),this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)},t.prototype.getLight=function(){return this.style.getLight()},t.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},t.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},t.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},t.prototype.getContainer=function(){return this._container},t.prototype.getCanvasContainer=function(){return this._canvasContainer},t.prototype.getCanvas=function(){return this._canvas},t.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},t.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==vt.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&vt.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},t.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=_.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=_.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=_.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var r=this._containerDimensions();this._resizeCanvas(r[0],r[1]);var n=this._controlContainer=_.create("div","mapboxgl-control-container",t),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){i[t]=_.create("div","mapboxgl-ctrl-"+t,n)})},t.prototype._resizeCanvas=function(t,e){var r=vt.browser.devicePixelRatio||1;this._canvas.width=r*t,this._canvas.height=r*e,this._canvas.style.width=t+"px",this._canvas.style.height=e+"px"},t.prototype._setupPainter=function(){var t=vt.extend({},r.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);e?(this.painter=new Ni(e,this.transform),vt.webpSupported.testSupport(e)):this.fire(new vt.ErrorEvent(new Error("Failed to initialize WebGL")))},t.prototype._contextLost=function(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new vt.Event("webglcontextlost",{originalEvent:t}))},t.prototype._contextRestored=function(t){this._setupPainter(),this.resize(),this._update(),this.fire(new vt.Event("webglcontextrestored",{originalEvent:t}))},t.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},t.prototype._update=function(t){return this.style&&(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint()),this},t.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},t.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},t.prototype._render=function(){var e,r=this,t=0,n=this.painter.context.extTimerQuery;this.listens("gpu-timing-frame")&&(e=n.createQueryEXT(),n.beginQueryEXT(n.TIME_ELAPSED_EXT,e),t=vt.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run();var i=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var o=this.transform.zoom,a=vt.browser.now();this.style.zoomHistory.update(o,a);var s=new vt.EvaluationParameters(o,{now:a,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),u=s.crossFadingFactor();1===u&&u===this._crossFadingFactor||(i=!0,this._crossFadingFactor=u),this.style.update(s)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new vt.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new vt.Event("load"))),this.style&&(this.style.hasTransitions()||i)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var c=vt.browser.now()-t;n.endQueryEXT(n.TIME_ELAPSED_EXT,e),setTimeout(function(){var t=n.getQueryObjectEXT(e,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(e),r.fire(new vt.Event("gpu-timing-frame",{cpuTime:c,gpuTime:t}))},50)}if(this.listens("gpu-timing-layer")){var l=this.painter.collectGpuTimers();setTimeout(function(){var t=r.painter.queryGpuTimers(l);r.fire(new vt.Event("gpu-timing-layer",{layerTimes:t}))},50)}return this._sourcesDirty||this._styleDirty||this._placementDirty||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&(this._fullyLoaded||(this._fullyLoaded=!0),this.fire(new vt.Event("idle"))),this},t.prototype.remove=function(){this._hash&&this._hash.remove();for(var t=0,e=this._controls;t<e.length;t+=1)e[t].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.setStyle(null),void 0!==vt.window&&(vt.window.removeEventListener("resize",this._onWindowResize,!1),vt.window.removeEventListener("online",this._onWindowOnline,!1));var r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),go(this._canvasContainer),go(this._controlContainer),go(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this.fire(new vt.Event("remove"))},t.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=vt.browser.frame(function(t){e._frame=null,e._render()}))},t.prototype._onWindowOnline=function(){this._update()},t.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update()},e.showTileBoundaries.get=function(){return!!this._showTileBoundaries},e.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},e.showPadding.get=function(){return!!this._showPadding},e.showPadding.set=function(t){this._showPadding!==t&&(this._showPadding=t,this._update())},e.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},e.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&((this._showCollisionBoxes=t)?this.style._generateCollisionBoxes():this._update())},e.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},e.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},e.repaint.get=function(){return!!this._repaint},e.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},e.vertices.get=function(){return!!this._vertices},e.vertices.set=function(t){this._vertices=t,this._update()},t.prototype._setCacheLimits=function(t,e){vt.setCacheLimits(t,e)},e.version.get=function(){return vt.version},Object.defineProperties(t.prototype,e),t}(oo);function go(t){t.parentNode&&t.parentNode.removeChild(t)}function yo(t){var e=this;this.options=vt.extend({},vo,t),this._container=_.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this.options.showZoom&&(vt.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(t){return e._map.zoomIn({},{originalEvent:t})}),_.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(t){return e._map.zoomOut({},{originalEvent:t})}),_.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(vt.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(t){e.options.visualizePitch?e._map.resetNorthPitch({},{originalEvent:t}):e._map.resetNorth({},{originalEvent:t})}),this._compassIcon=_.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}var vo={showCompass:!0,showZoom:!0,visualizePitch:!1};function _o(t,e,r){if(t=new vt.LngLat(t.lng,t.lat),e){var n=new vt.LngLat(t.lng-360,t.lat),i=new vt.LngLat(t.lng+360,t.lat),o=r.locationPoint(t).distSqr(e);r.locationPoint(n).distSqr(e)<o?t=n:r.locationPoint(i).distSqr(e)<o&&(t=i)}for(;180<Math.abs(t.lng-r.center.lng);){var a=r.locationPoint(t);if(0<=a.x&&0<=a.y&&a.x<=r.width&&a.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360}return t}yo.prototype._updateZoomButtons=function(){var t=this._map.getZoom();this._zoomInButton.disabled=t===this._map.getMaxZoom(),this._zoomOutButton.disabled=t===this._map.getMinZoom()},yo.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=t},yo.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Wi(t,{button:"left",element:this._compass,clickTolerance:t.dragRotate._clickTolerance}),_.addEventListener(this._compass,"mousedown",this._handler.onMouseDown),_.addEventListener(this._compass,"touchstart",this._handler.onMouseDown,{passive:!1}),this._handler.enable()),this._container},yo.prototype.onRemove=function(){_.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),_.removeEventListener(this._compass,"mousedown",this._handler.onMouseDown),_.removeEventListener(this._compass,"touchstart",this._handler.onMouseDown,{passive:!1}),this._handler.disable(),delete this._handler),delete this._map},yo.prototype._createButton=function(t,e){var r=_.create("button",t,this._container);return r.type="button",r.addEventListener("click",e),r},yo.prototype._setButtonTitle=function(t,e){var r=this._map._getUIString("NavigationControl."+e);t.title=r,t.setAttribute("aria-label",r)};var bo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function xo(t,e,r){var n=t.classList;for(var i in bo)n.remove("mapboxgl-"+r+"-anchor-"+i);n.add("mapboxgl-"+r+"-anchor-"+e)}function wo(t){this.options=vt.extend({},Io,t),vt.bindAll(["_onMove","setUnit"],this)}var So,Eo,Co,Mo=((Co=vt.Evented)&&(Ro.__proto__=Co),((Ro.prototype=Object.create(Co&&Co.prototype)).constructor=Ro).prototype.addTo=function(t){return this.remove(),(this._map=t).getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},Ro.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),_.remove(this._element),this._popup&&this._popup.remove(),this},Ro.prototype.getLngLat=function(){return this._lngLat},Ro.prototype.setLngLat=function(t){return this._lngLat=vt.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},Ro.prototype.getElement=function(){return this._element},Ro.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},Ro.prototype._onKeyPress=function(t){var e=t.code,r=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==r&&13!==r||this.togglePopup()},Ro.prototype._onMapClick=function(t){var e=t.originalEvent.target,r=this._element;this._popup&&(e===r||r.contains(e))&&this.togglePopup()},Ro.prototype.getPopup=function(){return this._popup},Ro.prototype.togglePopup=function(){var t=this._popup;return t&&(t.isOpen()?t.remove():t.addTo(this._map)),this},Ro.prototype._update=function(t){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=_o(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(e="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r="rotateX("+this._map.getPitch()+"deg)"),t&&"moveend"!==t.type||(this._pos=this._pos.round()),_.setTransform(this._element,bo[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+r+" "+e)}},Ro.prototype.getOffset=function(){return this._offset},Ro.prototype.setOffset=function(t){return this._offset=vt.Point.convert(t),this._update(),this},Ro.prototype._onMove=function(t){this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new vt.Event("dragstart"))),this.fire(new vt.Event("drag"))},Ro.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new vt.Event("dragend")),this._state="inactive"},Ro.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},Ro.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},Ro.prototype.isDraggable=function(){return this._draggable},Ro.prototype.setRotation=function(t){return this._rotation=t||0,this._update(),this},Ro.prototype.getRotation=function(){return this._rotation},Ro.prototype.setRotationAlignment=function(t){return this._rotationAlignment=t||"auto",this._update(),this},Ro.prototype.getRotationAlignment=function(){return this._rotationAlignment},Ro.prototype.setPitchAlignment=function(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this},Ro.prototype.getPitchAlignment=function(){return this._pitchAlignment},Ro),To={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Po=0,Oo=!1,Ao=((Eo=vt.Evented)&&(Lo.__proto__=Eo),((Lo.prototype=Object.create(Eo&&Eo.prototype)).constructor=Lo).prototype.onAdd=function(t){var e;return this._map=t,this._container=_.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),e=this._setupUI,void 0!==So?e(So):void 0!==vt.window.navigator.permissions?vt.window.navigator.permissions.query({name:"geolocation"}).then(function(t){e(So="denied"!==t.state)}):e(So=!!vt.window.navigator.geolocation),this._container},Lo.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(vt.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),_.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Po=0,Oo=!1},Lo.prototype._isOutOfMapMaxBounds=function(t){var e=this._map.getMaxBounds(),r=t.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())},Lo.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},Lo.prototype._onSuccess=function(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new vt.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new vt.Event("geolocate",t)),this._finish()}},Lo.prototype._updateCamera=function(t){var e=new vt.LngLat(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,n=this._map.getBearing(),i=vt.extend({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(e.toBounds(r),i,{geolocateSource:!0})},Lo.prototype._updateMarker=function(t){if(t){var e=new vt.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},Lo.prototype._updateCircleRadius=function(){var t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),r=this._map.unproject([1,t]),n=e.distanceTo(r),i=Math.ceil(2*this._accuracy/n);this._circleElement.style.width=i+"px",this._circleElement.style.height=i+"px"},Lo.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},Lo.prototype._onError=function(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&Oo)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new vt.Event("error",t)),this._finish()}},Lo.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},Lo.prototype._setupUI=function(t){var e=this;if(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=_.create("button","mapboxgl-ctrl-geolocate",this._container),_.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),!(this._geolocateButton.type="button")===t){vt.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{var n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=_.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Mo(this._dotElement),this._circleElement=_.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Mo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(t){t.geolocateSource||"ACTIVE_LOCK"!==e._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(e._watchState="BACKGROUND",e._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),e._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),e.fire(new vt.Event("trackuserlocationend")))})},Lo.prototype.trigger=function(){if(!this._setup)return vt.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new vt.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Po--,Oo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new vt.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new vt.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Oo=1<++Po?(t={maximumAge:6e5,timeout:0},!0):(t=this.options.positionOptions,!1),this._geolocationWatchID=vt.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else vt.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},Lo.prototype._clearWatch=function(){vt.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},Lo),Io={maxWidth:100,unit:"metric"};function Lo(t){Eo.call(this),this.options=vt.extend({},To,t),vt.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}function Ro(t,e){var r=this;if(Co.call(this),(t instanceof vt.window.HTMLElement||e)&&(t=vt.extend({element:t},e)),vt.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._draggable=t&&t.draggable||!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=vt.Point.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=_.create("div"),this._element.setAttribute("aria-label","Map marker");var n=_.createNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height","41px"),n.setAttributeNS(null,"width","27px"),n.setAttributeNS(null,"viewBox","0 0 27 41");var i=_.createNS("http://www.w3.org/2000/svg","g");i.setAttributeNS(null,"stroke","none"),i.setAttributeNS(null,"stroke-width","1"),i.setAttributeNS(null,"fill","none"),i.setAttributeNS(null,"fill-rule","evenodd");var o=_.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"fill-rule","nonzero");var a=_.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"transform","translate(3.0, 29.0)"),a.setAttributeNS(null,"fill","#000000");for(var s=0,u=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];s<u.length;s+=1){var c=u[s],l=_.createNS("http://www.w3.org/2000/svg","ellipse");l.setAttributeNS(null,"opacity","0.04"),l.setAttributeNS(null,"cx","10.5"),l.setAttributeNS(null,"cy","5.80029008"),l.setAttributeNS(null,"rx",c.rx),l.setAttributeNS(null,"ry",c.ry),a.appendChild(l)}var h=_.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"fill",this._color);var p=_.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),h.appendChild(p);var f=_.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"opacity","0.25"),f.setAttributeNS(null,"fill","#000000");var d=_.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),f.appendChild(d);var m=_.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(6.0, 7.0)"),m.setAttributeNS(null,"fill","#FFFFFF");var g=_.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(8.0, 8.0)");var y=_.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#000000"),y.setAttributeNS(null,"opacity","0.25"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962");var v=_.createNS("http://www.w3.org/2000/svg","circle");v.setAttributeNS(null,"fill","#FFFFFF"),v.setAttributeNS(null,"cx","5.5"),v.setAttributeNS(null,"cy","5.5"),v.setAttributeNS(null,"r","5.4999962"),g.appendChild(y),g.appendChild(v),o.appendChild(a),o.appendChild(h),o.appendChild(f),o.appendChild(m),o.appendChild(g),n.appendChild(o),this._element.appendChild(n),this._offset=vt.Point.convert(t&&t.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(t){t.preventDefault()}),this._element.addEventListener("mousedown",function(t){t.preventDefault()}),this._element.addEventListener("focus",function(){var t=r._map.getContainer();t.scrollTop=0,t.scrollLeft=0}),xo(this._element,this._anchor,"marker"),this._popup=null}function No(t,e,r){var n=r&&r.maxWidth||100,i=t._container.clientHeight/2,o=t.unproject([0,i]),a=t.unproject([n,i]),s=o.distanceTo(a);if(r&&"imperial"===r.unit){var u=3.2808*s;5280<u?ko(e,n,u/5280,t._getUIString("ScaleControl.Miles")):ko(e,n,u,t._getUIString("ScaleControl.Feet"))}else r&&"nautical"===r.unit?ko(e,n,s/1852,t._getUIString("ScaleControl.NauticalMiles")):1e3<=s?ko(e,n,s/1e3,t._getUIString("ScaleControl.Kilometers")):ko(e,n,s,t._getUIString("ScaleControl.Meters"))}function ko(t,e,r,n){var i,o,a,s,u,c=(i=r,(o=Math.pow(10,(""+Math.floor(i)).length-1))*(a=10<=(a=i/o)?10:5<=a?5:3<=a?3:2<=a?2:1<=a?1:(s=a,u=Math.pow(10,Math.ceil(-Math.log(s)/Math.LN10)),Math.round(s*u)/u)));t.style.width=e*(c/r)+"px",t.innerHTML=c+"&nbsp;"+n}wo.prototype.getDefaultPosition=function(){return"bottom-left"},wo.prototype._onMove=function(){No(this._map,this._container,this.options)},wo.prototype.onAdd=function(t){return this._map=t,this._container=_.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},wo.prototype.onRemove=function(){_.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},wo.prototype.setUnit=function(t){this.options.unit=t,No(this._map,this._container,this.options)};function Do(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof vt.window.HTMLElement?this._container=t.container:vt.warnOnce("Full screen control 'container' must be a DOM element.")),vt.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in vt.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in vt.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in vt.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in vt.window.document&&(this._fullscreenchange="MSFullscreenChange")}Do.prototype.onAdd=function(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=_.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",vt.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Do.prototype.onRemove=function(){_.remove(this._controlContainer),this._map=null,vt.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Do.prototype._checkFullscreenSupport=function(){return!!(vt.window.document.fullscreenEnabled||vt.window.document.mozFullScreenEnabled||vt.window.document.msFullscreenEnabled||vt.window.document.webkitFullscreenEnabled)},Do.prototype._setupUI=function(){var t=this._fullscreenButton=_.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);_.create("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden",!0),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),vt.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Do.prototype._updateTitle=function(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},Do.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Do.prototype._isFullscreen=function(){return this._fullscreen},Do.prototype._changeIcon=function(){(vt.window.document.fullscreenElement||vt.window.document.mozFullScreenElement||vt.window.document.webkitFullscreenElement||vt.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Do.prototype._onClickFullscreen=function(){this._isFullscreen()?vt.window.document.exitFullscreen?vt.window.document.exitFullscreen():vt.window.document.mozCancelFullScreen?vt.window.document.mozCancelFullScreen():vt.window.document.msExitFullscreen?vt.window.document.msExitFullscreen():vt.window.document.webkitCancelFullScreen&&vt.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var jo,zo={closeButton:!0,closeOnClick:!0,className:"",maxWidth:"240px"},Fo=((jo=vt.Evented)&&(Uo.__proto__=jo),((Uo.prototype=Object.create(jo&&jo.prototype)).constructor=Uo).prototype.addTo=function(t){var e=this;return this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._trackPointer?(this._map.on("mousemove",function(t){e._update(t.point)}),this._map.on("mouseup",function(t){e._update(t.point)}),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new vt.Event("open")),this},Uo.prototype.isOpen=function(){return!!this._map},Uo.prototype.remove=function(){return this._content&&_.remove(this._content),this._container&&(_.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove"),delete this._map),this.fire(new vt.Event("close")),this},Uo.prototype.getLngLat=function(){return this._lngLat},Uo.prototype.setLngLat=function(t){return this._lngLat=vt.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove"),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},Uo.prototype.trackPointer=function(){var e=this;return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",function(t){e._update(t.point)}),this._map.on("drag",function(t){e._update(t.point)}),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},Uo.prototype.getElement=function(){return this._container},Uo.prototype.setText=function(t){return this.setDOMContent(vt.window.document.createTextNode(t))},Uo.prototype.setHTML=function(t){var e,r=vt.window.document.createDocumentFragment(),n=vt.window.document.createElement("body");for(n.innerHTML=t;e=n.firstChild;)r.appendChild(e);return this.setDOMContent(r)},Uo.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},Uo.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},Uo.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},Uo.prototype.addClassName=function(t){this._container&&this._container.classList.add(t)},Uo.prototype.removeClassName=function(t){this._container&&this._container.classList.remove(t)},Uo.prototype.toggleClassName=function(t){if(this._container)return this._container.classList.toggle(t)},Uo.prototype._createContent=function(){this._content&&_.remove(this._content),this._content=_.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=_.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},Uo.prototype._update=function(t){var e=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=_.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=_.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(t){return e._container.classList.add(t)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=_o(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||t)){var r=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat),n=this.options.anchor,i=function t(e){if(e){if("number"==typeof e){var r=Math.round(Math.sqrt(.5*Math.pow(e,2)));return{center:new vt.Point(0,0),top:new vt.Point(0,e),"top-left":new vt.Point(r,r),"top-right":new vt.Point(-r,r),bottom:new vt.Point(0,-e),"bottom-left":new vt.Point(r,-r),"bottom-right":new vt.Point(-r,-r),left:new vt.Point(e,0),right:new vt.Point(-e,0)}}if(e instanceof vt.Point||Array.isArray(e)){var n=vt.Point.convert(e);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:vt.Point.convert(e.center||[0,0]),top:vt.Point.convert(e.top||[0,0]),"top-left":vt.Point.convert(e["top-left"]||[0,0]),"top-right":vt.Point.convert(e["top-right"]||[0,0]),bottom:vt.Point.convert(e.bottom||[0,0]),"bottom-left":vt.Point.convert(e["bottom-left"]||[0,0]),"bottom-right":vt.Point.convert(e["bottom-right"]||[0,0]),left:vt.Point.convert(e.left||[0,0]),right:vt.Point.convert(e.right||[0,0])}}return t(new vt.Point(0,0))}(this.options.offset);if(!n){var o,a=this._container.offsetWidth,s=this._container.offsetHeight;o=r.y+i.bottom.y<s?["top"]:r.y>this._map.transform.height-s?["bottom"]:[],r.x<a/2?o.push("left"):r.x>this._map.transform.width-a/2&&o.push("right"),n=0===o.length?"bottom":o.join("-")}var u=r.add(i[n]).round();_.setTransform(this._container,bo[n]+" translate("+u.x+"px,"+u.y+"px)"),xo(this._container,n,"popup")}},Uo.prototype._onClose=function(){this.remove()},Uo),Bo={version:vt.version,supported:r,setRTLTextPlugin:vt.setRTLTextPlugin,getRTLTextPluginStatus:vt.getRTLTextPluginStatus,Map:mo,NavigationControl:yo,GeolocateControl:Ao,AttributionControl:ro,ScaleControl:wo,FullscreenControl:Do,Popup:Fo,Marker:Mo,Style:yn,LngLat:vt.LngLat,LngLatBounds:vt.LngLatBounds,Point:vt.Point,MercatorCoordinate:vt.MercatorCoordinate,Evented:vt.Evented,config:vt.config,get accessToken(){return vt.config.ACCESS_TOKEN},set accessToken(t){vt.config.ACCESS_TOKEN=t},get baseApiUrl(){return vt.config.API_URL},set baseApiUrl(t){vt.config.API_URL=t},get workerCount(){return pr.workerCount},set workerCount(t){pr.workerCount=t},get maxParallelImageRequests(){return vt.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){vt.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage:function(t){vt.clearTileCache(t)},workerUrl:""};function Uo(t){jo.call(this),this.options=vt.extend(Object.create(zo),t),vt.bindAll(["_update","_onClose","remove"],this)}return Bo}),a},"object"==typeof r&&void 0!==e?e.exports=i():"function"==typeof define&&define.amd?define(i):(n=n||self).mapboxgl=i()},{}],6:[function(h,e,r){(function(a){!function(t){if("object"==typeof r&&void 0!==e)e.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:void 0!==a?a:"undefined"!=typeof self?self:this).Mapillary=t()}}(function(){var n;return function o(a,s,u){function c(r,t){if(!s[r]){if(!a[r]){var e="function"==typeof h&&h;if(!t&&e)return e(r,!0);if(l)return l(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=s[r]={exports:{}};a[r][0].call(i.exports,function(t){var e=a[r][1][t];return c(e||t)},i,i.exports,o,a,s,u)}return s[r].exports}for(var l="function"==typeof h&&h,t=0;t<u.length;t++)c(u[t]);return c}({1:[function(t,e,r){"use strict";var b=t("tinyqueue");function n(t,e,r){var n,i,o,a;e=e||1;for(var s=0;s<t[0].length;s++){var u=t[0][s];(!s||u[0]<n)&&(n=u[0]),(!s||u[1]<i)&&(i=u[1]),(!s||u[0]>o)&&(o=u[0]),(!s||u[1]>a)&&(a=u[1])}var c=o-n,l=a-i,h=Math.min(c,l),p=h/2,f=new b(null,x);if(0===h)return[n,i];for(var d=n;d<o;d+=h)for(var m=i;m<a;m+=h)f.push(new w(d+p,m+p,p,t));var g=function(t){for(var e=0,r=0,n=0,i=t[0],o=0,a=i.length,s=a-1;o<a;s=o++){var u=i[o],c=i[s],l=u[0]*c[1]-c[0]*u[1];r+=(u[0]+c[0])*l,n+=(u[1]+c[1])*l,e+=3*l}return 0===e?new w(i[0][0],i[0][1],0,t):new w(r/e,n/e,0,t)}(t),y=new w(n+c/2,i+l/2,0,t);y.d>g.d&&(g=y);for(var v=f.length;f.length;){var _=f.pop();_.d>g.d&&(g=_,r&&console.log("found best %d after %d probes",Math.round(1e4*_.d)/1e4,v)),_.max-g.d<=e||(p=_.h/2,f.push(new w(_.x-p,_.y-p,p,t)),f.push(new w(_.x+p,_.y-p,p,t)),f.push(new w(_.x-p,_.y+p,p,t)),f.push(new w(_.x+p,_.y+p,p,t)),v+=4)}return r&&(console.log("num probes: "+v),console.log("best distance: "+g.d)),[g.x,g.y]}function x(t,e){return e.max-t.max}function w(t,e,r,n){this.x=t,this.y=e,this.h=r,this.d=function(t,e,r){for(var n=!1,i=1/0,o=0;o<r.length;o++)for(var a=r[o],s=0,u=a.length,c=u-1;s<u;c=s++){var l=a[s],h=a[c];l[1]>e!=h[1]>e&&t<(h[0]-l[0])*(e-l[1])/(h[1]-l[1])+l[0]&&(n=!n),i=Math.min(i,p(t,e,l,h))}return(n?1:-1)*Math.sqrt(i)}(t,e,n),this.max=this.d+this.h*Math.SQRT2}function p(t,e,r,n){var i=r[0],o=r[1],a=n[0]-i,s=n[1]-o;if(0!==a||0!==s){var u=((t-i)*a+(e-o)*s)/(a*a+s*s);1<u?(i=n[0],o=n[1]):0<u&&(i+=a*u,o+=s*u)}return(a=t-i)*a+(s=e-o)*s}e.exports=n,e.exports.default=n},{tinyqueue:243}],2:[function(t,e,r){function n(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}(e.exports=n).prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){var r,n,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(r=0))return r;if((n=1)<i)return n;for(;r<n;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;o<t?r=i:n=i,i=.5*(n-r)+r}return i},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},{}],3:[function(t,e,r){"use strict";r.byteLength=function(t){return 3*t.length/4-h(t)},r.toByteArray=function(t){var e,r,n,i,o,a=t.length;i=h(t),o=new l(3*a/4-i),r=0<i?a-4:a;var s=0;for(e=0;e<r;e+=4)n=c[t.charCodeAt(e)]<<18|c[t.charCodeAt(e+1)]<<12|c[t.charCodeAt(e+2)]<<6|c[t.charCodeAt(e+3)],o[s++]=n>>16&255,o[s++]=n>>8&255,o[s++]=255&n;2===i?(n=c[t.charCodeAt(e)]<<2|c[t.charCodeAt(e+1)]>>4,o[s++]=255&n):1===i&&(n=c[t.charCodeAt(e)]<<10|c[t.charCodeAt(e+1)]<<4|c[t.charCodeAt(e+2)]>>2,o[s++]=n>>8&255,o[s++]=255&n);return o},r.fromByteArray=function(t){for(var e,r=t.length,n=r%3,i="",o=[],a=0,s=r-n;a<s;a+=16383)o.push(p(t,a,s<a+16383?s:a+16383));1==n?(e=t[r-1],i+=u[e>>2],i+=u[e<<4&63],i+="=="):2==n&&(e=(t[r-2]<<8)+t[r-1],i+=u[e>>10],i+=u[e>>4&63],i+=u[e<<2&63],i+="=");return o.push(i),o.join("")};for(var u=[],c=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,o=n.length;i<o;++i)u[i]=n[i],c[n.charCodeAt(i)]=i;function h(t){var e=t.length;if(0<e%4)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function p(t,e,r){for(var n,i,o=[],a=e;a<r;a+=3)n=(t[a]<<16)+(t[a+1]<<8)+t[a+2],o.push(u[(i=n)>>18&63]+u[i>>12&63]+u[i>>6&63]+u[63&i]);return o.join("")}c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},{}],4:[function(t,e,r){},{}],5:[function(t,e,r){var l,h,p;e.exports=(h=String.prototype.split,p=/()??/.exec("")[1]===l,function(t,e,r){if("[object RegExp]"!==Object.prototype.toString.call(e))return h.call(t,e,r);var n,i,o,a,s=[],u=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":""),c=0;for(e=new RegExp(e.source,u+"g"),t+="",p||(n=new RegExp("^"+e.source+"$(?!\\s)",u)),r=r===l?-1>>>0:r>>>0;(i=e.exec(t))&&!(c<(o=i.index+i[0].length)&&(s.push(t.slice(c,i.index)),!p&&1<i.length&&i[0].replace(n,function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===l&&(i[t]=l)}),1<i.length&&i.index<t.length&&Array.prototype.push.apply(s,i.slice(1)),a=i[0].length,c=o,s.length>=r));)e.lastIndex===i.index&&e.lastIndex++;return c===t.length?!a&&e.test("")||s.push(""):s.push(t.slice(c)),s.length>r?s.slice(0,r):s})},{}],6:[function(t,e,r){var n,i,o=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(t){n=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var c,l=[],h=!1,p=-1;function f(){h&&c&&(h=!1,c.length?l=c.concat(l):p=-1,l.length&&d())}function d(){if(!h){var t=u(f);h=!0;for(var e=l.length;e;){for(c=l,l=[];++p<e;)c&&c[p].run();p=-1,e=l.length}c=null,h=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function g(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];l.push(new m(t,e)),1!==l.length||h||u(d)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],7:[function(t,e,r){"use strict";var n=t("base64-js"),o=t("ieee754");r.Buffer=h,r.SlowBuffer=function(t){+t!=t&&(t=0);return h.alloc(+t)},r.INSPECT_MAX_BYTES=50;var i=2147483647;function a(t){if(i<t)throw new RangeError("Invalid typed array length");var e=new Uint8Array(t);return e.__proto__=h.prototype,e}function h(t,e,r){if("number"!=typeof t)return s(t,e,r);if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return c(t)}function s(t,e,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return D(t)?function(t,e,r){if(e<0||t.byteLength<e)throw new RangeError("'offset' is out of bounds");if(t.byteLength<e+(r||0))throw new RangeError("'length' is out of bounds");var n;n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r);return n.__proto__=h.prototype,n}(t,e,r):"string"==typeof t?function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!h.isEncoding(e))throw new TypeError('"encoding" must be a valid string encoding');var r=0|f(t,e),n=a(r),i=n.write(t,e);i!==r&&(n=n.slice(0,i));return n}(t,e):function(t){if(h.isBuffer(t)){var e=0|p(t.length),r=a(e);return 0===r.length||t.copy(r,0,0,e),r}if(t){if(j(t)||"length"in t)return"number"!=typeof t.length||z(t.length)?a(0):l(t);if("Buffer"===t.type&&Array.isArray(t.data))return l(t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function c(t){return u(t),a(t<0?0:0|p(t))}function l(t){for(var e=t.length<0?0:0|p(t.length),r=a(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function p(t){if(i<=t)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|t}function f(t,e){if(h.isBuffer(t))return t.length;if(j(t)||D(t))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return R(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return N(t).length;default:if(n)return R(t).length;e=(""+e).toLowerCase(),n=!0}}function d(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function m(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),z(r=+r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=h.from(e,n)),h.isBuffer(e))return 0===e.length?-1:g(t,e,r,n,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):g(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function g(t,e,r,n,i){var o,a=1,s=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s/=a=2,u/=2,r/=2}function c(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){var l=-1;for(o=r;o<s;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(s<r+u&&(r=s-u),o=r;0<=o;o--){for(var h=!0,p=0;p<u;p++)if(c(t,o+p)!==c(e,p)){h=!1;break}if(h)return o}return-1}function y(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?i<(n=Number(n))&&(n=i):n=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");o/2<n&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(e.substr(2*a,2),16);if(z(s))return a;t[r+a]=s}return a}function v(t,e,r,n){return k(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function _(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function b(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,a,s,u,c=t[i],l=null,h=239<c?4:223<c?3:191<c?2:1;if(i+h<=r)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[i+1]))&&127<(u=(31&c)<<6|63&o)&&(l=u);break;case 3:o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&2047<(u=(15&c)<<12|(63&o)<<6|63&a)&&(u<55296||57343<u)&&(l=u);break;case 4:o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&65535<(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)&&u<1114112&&(l=u)}null===l?(l=65533,h=1):65535<l&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=h}return function(t){var e=t.length;if(e<=x)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=x));return r}(n)}r.kMaxLength=i,(h.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),h.poolSize=8192,h.from=function(t,e,r){return s(t,e,r)},h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,h.alloc=function(t,e,r){return function(t,e,r){return u(t),t<=0?a(t):void 0!==e?"string"==typeof r?a(t).fill(e,r):a(t).fill(e):a(t)}(t,e,r)},h.allocUnsafe=function(t){return c(t)},h.allocUnsafeSlow=function(t){return c(t)},h.isBuffer=function(t){return null!=t&&!0===t._isBuffer},h.compare=function(t,e){if(!h.isBuffer(t)||!h.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},h.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return h.alloc(0);var r;if(void 0===e)for(r=e=0;r<t.length;++r)e+=t[r].length;var n=h.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var o=t[r];if(!h.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},h.byteLength=f,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)d(this,e,e+1);return this},h.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)d(this,e,e+3),d(this,e+1,e+2);return this},h.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)d(this,e,e+7),d(this,e+1,e+6),d(this,e+2,e+5),d(this,e+3,e+4);return this},h.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?b(this,0,t):function(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t=t||"utf8";;)switch(t){case"hex":return E(this,e,r);case"utf8":case"utf-8":return b(this,e,r);case"ascii":return w(this,e,r);case"latin1":case"binary":return S(this,e,r);case"base64":return _(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},h.prototype.equals=function(t){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===h.compare(this,t)},h.prototype.inspect=function(){var t="",e=r.INSPECT_MAX_BYTES;return 0<this.length&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},h.prototype.compare=function(t,e,r,n,i){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(i<=n&&r<=e)return 0;if(i<=n)return-1;if(r<=e)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(e>>>=0),s=Math.min(o,a),u=this.slice(n,i),c=t.slice(e,r),l=0;l<s;++l)if(u[l]!==c[l]){o=u[l],a=c[l];break}return o<a?-1:a<o?1:0},h.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},h.prototype.indexOf=function(t,e,r){return m(this,t,e,r,!0)},h.prototype.lastIndexOf=function(t,e,r){return m(this,t,e,r,!1)},h.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||i<r)&&(r=i),0<t.length&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var o,a,s,u,c,l,h,p,f,d=!1;;)switch(n){case"hex":return y(this,t,e,r);case"utf8":case"utf-8":return p=e,f=r,k(R(t,(h=this).length-p),h,p,f);case"ascii":return v(this,t,e,r);case"latin1":case"binary":return v(this,t,e,r);case"base64":return u=this,c=e,l=r,k(N(t),u,c,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return a=e,s=r,k(function(t,e){for(var r,n,i,o=[],a=0;a<t.length&&!((e-=2)<0);++a)r=t.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,(o=this).length-a),o,a,s);default:if(d)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),d=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var x=4096;function w(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function S(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function E(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||n<r)&&(r=n);for(var i="",o=e;o<r;++o)i+=L(t[o]);return i}function C(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function M(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(r<t+e)throw new RangeError("Trying to access beyond buffer length")}function T(t,e,r,n,i,o){if(!h.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<e||e<o)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function P(t,e,r,n){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function O(t,e,r,n,i){return e=+e,r>>>=0,i||P(t,0,r,4),o.write(t,e,r,n,23,4),r+4}function A(t,e,r,n,i){return e=+e,r>>>=0,i||P(t,0,r,8),o.write(t,e,r,n,52,8),r+8}h.prototype.slice=function(t,e){var r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),e<t&&(e=t);var n=this.subarray(t,e);return n.__proto__=h.prototype,n},h.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||M(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},h.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||M(t,e,this.length);for(var n=this[t+--e],i=1;0<e&&(i*=256);)n+=this[t+--e]*i;return n},h.prototype.readUInt8=function(t,e){return t>>>=0,e||M(t,1,this.length),this[t]},h.prototype.readUInt16LE=function(t,e){return t>>>=0,e||M(t,2,this.length),this[t]|this[t+1]<<8},h.prototype.readUInt16BE=function(t,e){return t>>>=0,e||M(t,2,this.length),this[t]<<8|this[t+1]},h.prototype.readUInt32LE=function(t,e){return t>>>=0,e||M(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},h.prototype.readUInt32BE=function(t,e){return t>>>=0,e||M(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},h.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||M(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return(i*=128)<=n&&(n-=Math.pow(2,8*e)),n},h.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||M(t,e,this.length);for(var n=e,i=1,o=this[t+--n];0<n&&(i*=256);)o+=this[t+--n]*i;return(i*=128)<=o&&(o-=Math.pow(2,8*e)),o},h.prototype.readInt8=function(t,e){return t>>>=0,e||M(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},h.prototype.readInt16LE=function(t,e){t>>>=0,e||M(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},h.prototype.readInt16BE=function(t,e){t>>>=0,e||M(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},h.prototype.readInt32LE=function(t,e){return t>>>=0,e||M(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},h.prototype.readInt32BE=function(t,e){return t>>>=0,e||M(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},h.prototype.readFloatLE=function(t,e){return t>>>=0,e||M(t,4,this.length),o.read(this,t,!0,23,4)},h.prototype.readFloatBE=function(t,e){return t>>>=0,e||M(t,4,this.length),o.read(this,t,!1,23,4)},h.prototype.readDoubleLE=function(t,e){return t>>>=0,e||M(t,8,this.length),o.read(this,t,!0,52,8)},h.prototype.readDoubleBE=function(t,e){return t>>>=0,e||M(t,8,this.length),o.read(this,t,!1,52,8)},h.prototype.writeUIntLE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||T(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},h.prototype.writeUIntBE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||T(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;0<=--i&&(o*=256);)this[e+i]=t/o&255;return e+r},h.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,1,255,0),this[e]=255&t,e+1},h.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},h.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},h.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},h.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},h.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);T(this,t,e,r,i-1,-i)}var o=0,a=1,s=0;for(this[e]=255&t;++o<r&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},h.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);T(this,t,e,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[e+o]=255&t;0<=--o&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},h.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},h.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},h.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},h.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},h.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||T(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},h.prototype.writeFloatLE=function(t,e,r){return O(this,t,e,!0,r)},h.prototype.writeFloatBE=function(t,e,r){return O(this,t,e,!1,r)},h.prototype.writeDoubleLE=function(t,e,r){return A(this,t,e,!0,r)},h.prototype.writeDoubleBE=function(t,e,r){return A(this,t,e,!1,r)},h.prototype.copy=function(t,e,r,n){if(r=r||0,n||0===n||(n=this.length),e>=t.length&&(e=t.length),e=e||0,0<n&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,o=n-r;if(this===t&&r<e&&e<n)for(i=o-1;0<=i;--i)t[i+e]=this[i+r];else if(o<1e3)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},h.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!h.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(t=t||0))for(o=e;o<r;++o)this[o]=t;else{var a=h.isBuffer(t)?t:new h(t,n),s=a.length;for(o=0;o<r-e;++o)this[o+e]=a[o%s]}return this};var I=/[^+/0-9A-Za-z-_]/g;function L(t){return t<16?"0"+t.toString(16):t.toString(16)}function R(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],a=0;a<n;++a){if(55295<(r=t.charCodeAt(a))&&r<57344){if(!i){if(56319<r){-1<(e-=3)&&o.push(239,191,189);continue}if(a+1===n){-1<(e-=3)&&o.push(239,191,189);continue}i=r;continue}if(r<56320){-1<(e-=3)&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(e-=3)&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function N(t){return n.toByteArray(function(t){if((t=t.trim().replace(I,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function k(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function D(t){return t instanceof ArrayBuffer||null!=t&&null!=t.constructor&&"ArrayBuffer"===t.constructor.name&&"number"==typeof t.byteLength}function j(t){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(t)}function z(t){return t!=t}},{"base64-js":3,ieee754:17}],8:[function(t,e,r){"use strict";function n(t,e,r){r=r||2;var n,i,o,a,s,u,c,l=e&&e.length,h=l?e[0]*r:t.length,p=m(t,0,h,r,!0),f=[];if(!p)return f;if(l&&(p=function(t,e,r,n){var i,o,a,s,u,c=[];for(i=0,o=e.length;i<o;i++)a=e[i]*n,s=i<o-1?e[i+1]*n:t.length,(u=m(t,a,s,n,!1))===u.next&&(u.steiner=!0),c.push(x(u));for(c.sort(v),i=0;i<c.length;i++)_(c[i],r),r=g(r,r.next);return r}(t,e,p,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var d=r;d<h;d+=r)(s=t[d])<n&&(n=s),(u=t[d+1])<i&&(i=u),o<s&&(o=s),a<u&&(a=u);c=0!==(c=Math.max(o-n,a-i))?1/c:0}return y(p,f,r,n,i,c),f}function m(t,e,r,n,i){var o,a;if(i===0<T(t,e,r,n))for(o=e;o<r;o+=n)a=u(o,t[o],t[o+1],a);else for(o=r-n;e<=o;o-=n)a=u(o,t[o],t[o+1],a);return a&&s(a,a.next)&&(M(a),a=a.next),a}function g(t,e){if(!t)return t;e=e||t;var r,n=t;do{if(r=!1,n.steiner||!s(n,n.next)&&0!==S(n.prev,n,n.next))n=n.next;else{if(M(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function y(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){var i=t;for(;null===i.z&&(i.z=b(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==t;);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,u,c=1;do{for(r=t,o=t=null,a=0;r;){for(a++,n=r,e=s=0;e<c&&(s++,n=n.nextZ);e++);for(u=c;0<s||0<u&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(r=(i=r).nextZ,s--):(n=(i=n).nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(1<a)}(i)}(t,n,i,o);for(var s,u,c=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?h(t,n,i,o):l(t))e.push(s.i/r),e.push(t.i/r),e.push(u.i/r),M(t),t=u.next,c=u.next;else if((t=u)===c){a?1===a?y(t=p(t,e,r),e,r,n,i,o,2):2===a&&f(t,e,r,n,i,o):y(g(t),e,r,n,i,o,1);break}}}function l(t){var e=t.prev,r=t,n=t.next;if(0<=S(e,r,n))return!1;for(var i=t.next.next;i!==t.prev;){if(w(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&0<=S(i.prev,i,i.next))return!1;i=i.next}return!0}function h(t,e,r,n){var i=t.prev,o=t,a=t.next;if(0<=S(i,o,a))return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=b(s,u,e,r,n),p=b(c,l,e,r,n),f=t.prevZ,d=t.nextZ;f&&f.z>=h&&d&&d.z<=p;){if(f!==t.prev&&f!==t.next&&w(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&0<=S(f.prev,f,f.next))return!1;if(f=f.prevZ,d!==t.prev&&d!==t.next&&w(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&0<=S(d.prev,d,d.next))return!1;d=d.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&w(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&0<=S(f.prev,f,f.next))return!1;f=f.prevZ}for(;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&w(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&0<=S(d.prev,d,d.next))return!1;d=d.nextZ}return!0}function p(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!s(i,o)&&d(i,n,n.next,o)&&E(i,o)&&E(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),M(n),M(n.next),n=t=o),n=n.next}while(n!==t);return n}function f(t,e,r,n,i,o){var a,s,u=t;do{for(var c=u.next.next;c!==u.prev;){if(u.i!==c.i&&(s=c,(a=u).next.i!==s.i&&a.prev.i!==s.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&d(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(a,s)&&E(a,s)&&E(s,a)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;for(;r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next,r!==t;);return n}(a,s))){var l=C(u,c);return u=g(u,u.next),l=g(l,l.next),y(u,e,r,n,i,o),void y(l,e,r,n,i,o)}c=c.next}u=u.next}while(u!==t)}function v(t,e){return t.x-e.x}function _(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&a<s){if((a=s)===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r.prev;var u,c=r,l=r.x,h=r.y,p=1/0;n=r.next;for(;n!==c;)i>=n.x&&n.x>=l&&i!==n.x&&w(o<h?i:a,o,l,h,o<h?a:i,o,n.x,n.y)&&((u=Math.abs(o-n.y)/(i-n.x))<p||u===p&&n.x>r.x)&&E(n,t)&&(r=n,p=u),n=n.next;return r}(t,e)){var r=C(e,t);g(r,r.next)}}function b(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function x(t){for(var e=t,r=t;e.x<r.x&&(r=e),(e=e.next)!==t;);return r}function w(t,e,r,n,i,o,a,s){return 0<=(i-a)*(e-s)-(t-a)*(o-s)&&0<=(t-a)*(n-s)-(r-a)*(e-s)&&0<=(r-a)*(o-s)-(i-a)*(n-s)}function S(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function s(t,e){return t.x===e.x&&t.y===e.y}function d(t,e,r,n){return!!(s(t,e)&&s(r,n)||s(t,n)&&s(r,e))||0<S(t,e,r)!=0<S(t,e,n)&&0<S(r,n,t)!=0<S(r,n,e)}function E(t,e){return S(t.prev,t,t.next)<0?0<=S(t,e,t.next)&&0<=S(t,t.prev,e):S(t,e,t.prev)<0||S(t,t.next,e)<0}function C(t,e){var r=new a(t.i,t.x,t.y),n=new a(e.i,e.x,e.y),i=t.next,o=e.prev;return(t.next=e).prev=t,(r.next=i).prev=r,(n.next=r).prev=n,(o.next=n).prev=o,n}function u(t,e,r,n){var i=new a(t,e,r);return n?(i.next=n.next,(i.prev=n).next.prev=i,n.next=i):(i.prev=i).next=i,i}function M(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function a(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function T(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}e.exports=n,(e.exports.default=n).deviation=function(t,e,r,n){var i=e&&e.length,o=i?e[0]*r:t.length,a=Math.abs(T(t,0,o,r));if(i)for(var s=0,u=e.length;s<u;s++){var c=e[s]*r,l=s<u-1?e[s+1]*r:t.length;a-=Math.abs(T(t,c,l,r))}var h=0;for(s=0;s<n.length;s+=3){var p=n[s]*r,f=n[s+1]*r,d=n[s+2]*r;h+=Math.abs((t[p]-t[d])*(t[1+f]-t[1+p])-(t[p]-t[f])*(t[1+d]-t[1+p]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},n.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);0<i&&(n+=t[i-1].length,r.holes.push(n))}return r}},{}],9:[function(t,e,r){"use strict";t("individual/one-version")("ev-store","7");var n="__EV_STORE_KEY@7";e.exports=function(t){var e=t[n];e=e||(t[n]={});return e}},{"individual/one-version":19}],10:[function(t,e,r){"use strict";var a=t("./request"),n=t("./buildQueryObject");Array.isArray;function s(t,e){var r;for(r in e)t[r]=e[r];return t}function i(t,e){this._jsongUrl=t,"number"==typeof e&&(e={timeout:e});this._config=s({timeout:15e3,headers:{}},e||{})}i.prototype={constructor:i,buildQueryObject:n,get:function(t){var e=s(this.buildQueryObject(this._jsongUrl,"GET",{paths:t,method:"get"}),this._config);return a("GET",e,this)},set:function(t){var e=s(this.buildQueryObject(this._jsongUrl,"POST",{jsonGraph:t,method:"set"}),this._config);e.headers["Content-Type"]="application/x-www-form-urlencoded";return a("POST",e,this)},call:function(t,e,r,n){e=e||[],r=r||[],n=n||[];var i=[];i.push("method=call"),i.push("callPath="+encodeURIComponent(JSON.stringify(t))),i.push("arguments="+encodeURIComponent(JSON.stringify(e))),i.push("pathSuffixes="+encodeURIComponent(JSON.stringify(r))),i.push("paths="+encodeURIComponent(JSON.stringify(n)));var o=s(this.buildQueryObject(this._jsongUrl,"POST",i.join("&")),this._config);o.headers["Content-Type"]="application/x-www-form-urlencoded";return a("POST",o,this)}},(i.XMLHttpSource=i).default=i,e.exports=i},{"./buildQueryObject":11,"./request":14}],11:[function(t,e,r){"use strict";e.exports=function(t,e,r){var n=[],i={url:t},o=-1!==t.indexOf("?")?"&":"?";return"string"==typeof r?n.push(r):Object.keys(r).forEach(function(t){var e="object"==typeof r[t]?JSON.stringify(r[t]):r[t];n.push(t+"="+encodeURIComponent(e))}),"GET"===e?i.url+=o+n.join("&"):i.data=n.join("&"),i}},{}],12:[function(t,r,e){(function(e){"use strict";r.exports=function(){var t=new e.XMLHttpRequest;if("withCredentials"in t)return t;if(e.XDomainRequest)return new XDomainRequest;throw new Error("CORS is not supported by your browser")}}).call(this,void 0!==a?a:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(t,e,r){(function(n){"use strict";e.exports=function(){var t,e,r;if(n.XMLHttpRequest)return new n.XMLHttpRequest;try{for(e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=0;r<3;r++)try{if(t=e[r],new n.ActiveXObject(t))break}catch(t){}return new n.ActiveXObject(t)}catch(t){throw new Error("XMLHttpRequest is not supported by your browser")}}}).call(this,void 0!==a?a:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(t,e,r){"use strict";function o(){}var l=t("./getXMLHttpRequest"),h=t("./getCORSRequest"),p=Object.prototype.hasOwnProperty;function n(){}function f(t,e,r){r=r||new Error(e),t.onError(r)}n.create=function(i){var t=new n;return t.subscribe=function(t,e,r){var n;return"function"==typeof(n=i("function"==typeof t?{onNext:t,onError:e||o,onCompleted:r||o}:t))?{dispose:n}:n},t},e.exports=function(s,u,c){return n.create(function(e){var r,n,t,i,o,a={method:s||"GET",crossDomain:!1,async:!0,headers:{},responseType:"json"};for(o in u)p.call(u,o)&&(a[o]=u[o]);a.crossDomain||a.headers["X-Requested-With"]||(a.headers["X-Requested-With"]="XMLHttpRequest"),null!=c.onBeforeRequest&&c.onBeforeRequest(a);try{r=a.crossDomain?h():l()}catch(t){e.onError(t)}try{for(i in a.user?r.open(a.method,a.url,a.async,a.user,a.password):r.open(a.method,a.url,a.async),r.timeout=a.timeout,r.withCredentials=!1!==a.withCredentials,t=a.headers)p.call(t,i)&&r.setRequestHeader(i,t[i]);if(a.responseType)try{r.responseType=a.responseType}catch(t){if("json"!==a.responseType)throw t}r.onreadystatechange=function(t){4===r.readyState&&(n||(n=!0,function(e,t){var r,n;if(t&&e){n=t.responseType,r="response"in t?t.response:t.responseText;var i=1223===t.status?204:t.status;if(200<=i&&i<=399){try{"json"!==n&&(r=JSON.parse(r||"")),"string"==typeof r&&(r=JSON.parse(r||""))}catch(t){f(e,"invalid json",t)}return e.onNext(r),e.onCompleted()}f(e,401===i||403===i||407===i?r:410===i?r:408===i||504===i?r:r||"Response code "+i)}}(e,r)))},r.ontimeout=function(t){n||(n=!0,function(t,e,r,n){f(t,r||e.statusText||"request error",n)}(e,r,"timeout error",t))},r.send(a.data)}catch(t){e.onError(t)}return function(){n||4===r.readyState||(n=!0,r.abort())}})}},{"./getCORSRequest":12,"./getXMLHttpRequest":13}],15:[function(h,e,r){(function(n){!function(t){"object"==typeof r&&void 0!==e?e.exports=t():("undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:this).falcor=t()}(function(){return function o(a,s,u){function c(r,t){if(!s[r]){if(!a[r]){var e="function"==typeof h&&h;if(!t&&e)return e(r,!0);if(l)return l(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=s[r]={exports:{}};a[r][0].call(i.exports,function(t){var e=a[r][1][t];return c(e||t)},i,i.exports,o,a,s,u)}return s[r].exports}for(var l="function"==typeof h&&h,t=0;t<u.length;t++)c(u[t]);return c}({1:[function(t,e,r){var n=t(32),i=t(130);n.atom=i.atom,n.ref=i.ref,n.error=i.error,n.pathValue=i.pathValue,n.HttpDataSource=t(125),e.exports=n},{125:125,130:130,32:32}],2:[function(t,e,r){function i(t){var e=t||{};this._root=e._root||new n(e),this._path=e.path||e._path||[],this._scheduler=e.scheduler||e._scheduler||new d,this._source=e.source||e._source,this._request=e.request||e._request||new s(this,this._scheduler),this._ID=P++,"number"==typeof e.maxSize?this._maxSize=e.maxSize:this._maxSize=e._maxSize||i.prototype._maxSize,"number"==typeof e.collectRatio?this._collectRatio=e.collectRatio:this._collectRatio=e._collectRatio||i.prototype._collectRatio,(e.boxed||e.hasOwnProperty("_boxed"))&&(this._boxed=e.boxed||e._boxed),(e.materialized||e.hasOwnProperty("_materialized"))&&(this._materialized=e.materialized||e._materialized),"boolean"==typeof e.treatErrorsAsValues?this._treatErrorsAsValues=e.treatErrorsAsValues:e.hasOwnProperty("_treatErrorsAsValues")&&(this._treatErrorsAsValues=e._treatErrorsAsValues),e.cache&&this.setCache(e.cache)}function o(){}var n=t(4),a=t(3),s=t(55),u=t(64),c=t(65),l=t(61),h=t(63),p=t(73),f=t(75),d=t(74),m=t(81),g=t(84),y=t(49),v=t(134),_=t(88),b=t(100),x=t(96),w=t(102),S=t(98),E=t(99),C=t(77),M=t(76),T=t(130),P=0,O=t(116),A=t(14),I=t(19),L={pathValue:!0,pathSyntax:!0,json:!0,jsonGraph:!0},R=t(72);(e.exports=i).ref=T.ref,i.atom=T.atom,i.error=T.error,i.pathValue=T.pathValue,(i.prototype.constructor=i).prototype._materialized=!1,i.prototype._boxed=!1,i.prototype._progressive=!1,i.prototype._treatErrorsAsValues=!1,i.prototype._maxSize=Math.pow(2,53)-1,i.prototype._collectRatio=.75,i.prototype.get=t(71),i.prototype._getWithPaths=t(70),i.prototype.set=function(){var e=O(arguments,L,"set");return!0!==e?new u(function(t){t.onError(e)}):this._set.apply(this,arguments)},i.prototype.preload=function(){var e=O(arguments,R,"preload");if(!0!==e)return new u(function(t){t.onError(e)});var t=Array.prototype.slice.call(arguments),r=this;return new u(function(e){return r.get.apply(r,t).subscribe(function(){},function(t){e.onError(t)},function(){e.onCompleted()})})},i.prototype._set=function(){var t,e=-1,r=arguments.length,n=arguments[r-1];for(x(n)?r-=1:n=void 0,t=new Array(r);++e<r;)t[e]=arguments[e];return c.create(this,t,n)},i.prototype.call=function(){var t,e=-1,r=arguments.length;for(t=new Array(r);++e<r;){var n=arguments[e],i=typeof(t[e]=n);if(1<e&&!Array.isArray(n)||0===e&&!Array.isArray(n)&&"string"!=i||1===e&&!Array.isArray(n)&&!w(n))return new u(function(t){t.onError(new Error("Invalid argument"))})}return l.create(this,t)},i.prototype.invalidate=function(){var t,e=-1,r=arguments.length,n=arguments[r-1];for(t=new Array(r);++e<r;)if(t[e]=v.fromPath(arguments[e]),"object"!=typeof t[e])throw new Error("Invalid argument");h.create(this,t,n).subscribe(o,function(t){throw t})},i.prototype.deref=t(5),i.prototype.getValue=t(16),i.prototype.setValue=t(79),i.prototype._getValueSync=t(24),i.prototype._setValueSync=t(80),i.prototype._derefSync=t(6),i.prototype.setCache=function(t){var e=this._root.cache;if(t!==e){var r=this._root,n=this._path;this._path=[],this._root.cache={},void 0!==e&&y(r,r.expired,_(e),0),E(t)?M(this,[t]):S(t)?C(this,[t]):b(t)&&C(this,[{json:t}]),this._path=n}else void 0===e&&(this._root.cache={});return this},i.prototype.getCache=function(){var t=g(arguments);if(0===t.length)return A(this._root.cache);var e=[{}],r=this._path;return I.getWithPathsAsJSONGraph(this,t,e),this._path=r,e[0].jsonGraph},i.prototype.getVersion=function(t){var e=t&&v.fromPath(t)||[];if(!1===Array.isArray(e))throw new Error("Model#getVersion must be called with an Array path.");return this._path.length&&(e=this._path.concat(e)),this._getVersion(this,e)},i.prototype._syncCheck=function(t){if(Boolean(this._source)&&this._root.syncRefCount<=0&&!1===this._root.unsafeMode)throw new Error("Model#"+t+" may only be called within the context of a request selector.");return!0},i.prototype._clone=function(t){var e=new i(this);for(var r in t){var n=t[r];"delete"===n?delete e[r]:e[r]=n}return e.setCache=void 0,e},i.prototype.batch=function(t){var e=t;"number"==typeof e?e=new f(Math.round(Math.abs(e))):e&&e.schedule||(e=new p);var r=this._clone();return r._request=new s(r,e),r},i.prototype.unbatch=function(){var t=this._clone();return t._request=new s(t,new d),t},i.prototype.treatErrorsAsValues=function(){return this._clone({_treatErrorsAsValues:!0})},i.prototype.asDataSource=function(){return new a(this)},i.prototype._materialize=function(){return this._clone({_materialized:!0})},i.prototype._dematerialize=function(){return this._clone({_materialized:"delete"})},i.prototype.boxValues=function(){return this._clone({_boxed:!0})},i.prototype.unboxValues=function(){return this._clone({_boxed:"delete"})},i.prototype.withoutDataSource=function(){return this._clone({_source:"delete"})},i.prototype.toJSON=function(){return{$type:"ref",value:this._path}},i.prototype.getPath=function(){return m(this._path)},i.prototype._getBoundValue=t(13),i.prototype._getVersion=t(18),i.prototype._getValueSync=t(17),i.prototype._getPathValuesAsPathMap=I.getWithPathsAsPathMap,i.prototype._getPathValuesAsJSONG=I.getWithPathsAsJSONGraph,i.prototype._setPathValuesAsJSON=t(78),i.prototype._setPathValuesAsJSONG=t(78),i.prototype._setPathValuesAsPathMap=t(78),i.prototype._setPathValuesAsValues=t(78),i.prototype._setPathMapsAsJSON=t(77),i.prototype._setPathMapsAsJSONG=t(77),i.prototype._setPathMapsAsPathMap=t(77),i.prototype._setPathMapsAsValues=t(77),i.prototype._setJSONGsAsJSON=t(76),i.prototype._setJSONGsAsJSONG=t(76),i.prototype._setJSONGsAsPathMap=t(76),i.prototype._setJSONGsAsValues=t(76),i.prototype._setCache=t(77),i.prototype._invalidatePathValuesAsJSON=t(48),i.prototype._invalidatePathMapsAsJSON=t(47)},{100:100,102:102,116:116,13:13,130:130,134:134,14:14,16:16,17:17,18:18,19:19,24:24,3:3,4:4,47:47,48:48,49:49,5:5,55:55,6:6,61:61,63:63,64:64,65:65,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,84:84,88:88,96:96,98:98,99:99}],3:[function(t,e,r){function n(t){this._model=t._materialize().treatErrorsAsValues()}n.prototype.get=function(t){return this._model.get.apply(this._model,t)._toJSONG()},n.prototype.set=function(t){return this._model.set(t)._toJSONG()},n.prototype.call=function(t,e,r,n){var i=[t,e,r].concat(n);return this._model.call.apply(this._model,i)._toJSONG()},e.exports=n},{}],4:[function(t,e,r){function n(t){var e=t||{};this.syncRefCount=0,this.expired=e.expired||[],this.unsafeMode=e.unsafeMode||!1,this.collectionScheduler=e.collectionScheduler||new a,this.cache={},i(e.comparator)&&(this.comparator=e.comparator),i(e.errorSelector)&&(this.errorSelector=e.errorSelector),i(e.onChange)&&(this.onChange=e.onChange)}var i=t(96),o=t(91),a=t(74);n.prototype.errorSelector=function(t,e){return e},n.prototype.comparator=function(t,e){return o(t,"value")&&o(e,"value")?t.value===e.value&&t.$type===e.$type&&t.$expires===e.$expires:t===e},e.exports=n},{74:74,91:91,96:96}],5:[function(t,e,r){function s(t,e){var r,n=!1;try{++t._root.syncRefCount,r=t._derefSync(e)}catch(t){r=t,n=!0}finally{--t._root.syncRefCount}return n?u.Observable.throw(r):u.Observable.return(r)}var u=t(159),c=t(134);e.exports=function(t){for(var n=this,e=-1,i=arguments.length-1,o=new Array(i),a=c.fromPath(t);++e<i;)o[e]=c.fromPath(arguments[e+1]);if(0==i)throw new Error("Model#deref requires at least one value path.");return u.Observable.defer(function(){return s(n,a)}).flatMap(function(t){if(Boolean(t)){if(0<i){var e=u.Observable.of(t);return t.get.apply(t,o).catch(u.Observable.empty()).concat(e).last().flatMap(function(){return s(n,a)}).filter(function(t){return t})}return u.Observable.return(t)}if(0<i){var r=o.map(function(t){return a.concat(t)});return n.get.apply(n,r).concat(u.Observable.defer(function(){return s(n,a)})).last().filter(function(t){return t})}return u.Observable.empty()})}},{134:134,159:159}],6:[function(t,e,r){var o=t(134),a=t(13),s=t(8),u=t(118);e.exports=function(t){var e=o.fromPath(t);if(!Array.isArray(e))throw new Error("Model#derefSync must be called with an Array path.");var r=a(this,this._path.concat(e),!1),n=r.path,i=r.value;if(r.found&&void 0!==i&&(i.$type!==u||void 0!==i.value)){if(i.$type)throw new s;return this._clone({_path:n})}}},{118:118,13:13,134:134,8:8}],7:[function(t,e,r){function n(){this.message=n.message,this.stack=(new Error).stack}(n.prototype=new Error).name="BoundJSONGraphModelError",n.message="It is not legal to use the JSON Graph format from a bound Model. JSON Graph format can only be used from a root model.",e.exports=n},{}],8:[function(t,e,r){function n(t,e){this.message=i,this.stack=(new Error).stack,this.boundPath=t,this.shortedPath=e}var i="The boundPath of the model is not valid since a value or error was found before the path end.";(n.prototype=new Error).name="InvalidModelError",n.message=i,e.exports=n},{}],9:[function(t,e,r){function n(t){this.message="An exception was thrown when making a request.",this.stack=(new Error).stack,this.innerError=t}var i="InvalidSourceError";(n.prototype=new Error).name=i,n.is=function(t){return t&&t.name===i},e.exports=n},{}],10:[function(t,e,r){function n(){this.message="The allowed number of retries have been exceeded.",this.stack=(new Error).stack}var i="MaxRetryExceededError";(n.prototype=new Error).name=i,n.is=function(t){return t&&t.name===i},e.exports=n},{}],11:[function(t,e,r){var g=t(26).create,y=t(22),v=t(27),_=t(120),b=t(33),x=t(29).promote;e.exports=function(t,e,r,n,i,o,a){for(var s,u=r,c=i,l=n,h=0;;){if(!(s=0===h&&l[b]?(h=c.length,l[b]):u[c[h++]])){u=void 0;break}var p=s.$type,f=p&&s.value||s;if(h<c.length){if(p){u=s;break}u=s}else{if(u=s,p&&v(s))break;if(l[b]||g(l,s),p!==_)break;a?y(t,s,o,null,null,null,c,c.length,a):x(t,s),h=0,c=f,l=s,u=e}}if(h<c.length&&void 0!==u){for(var d=[],m=0;m<h;m++)d[m]=c[m];c=d}return[u,c]}},{120:120,22:22,26:26,27:27,29:29,33:33}],12:[function(t,e,r){var m=t(15),g=t(8),y=t(7);e.exports=function(f,d){return function(t,e,r){var n,i,o,a=r[0],s={values:r,optimizedPaths:[]},u=t._root.cache,c=t._path,l=u,h=c.length,p=[];if(h){if(d)return{criticalError:new y};if((l=m(t,c)).$type)return{criticalError:new g(c,c)};for(n=[],i=0;i<h;++i)n[i]=c[i]}else n=[],h=0;for(i=0,o=e.length;i<o;i++)f(t,u,l,e[i],0,a,s,p,n,h,d);return s}}},{15:15,7:7,8:8}],13:[function(t,e,r){var l=t(17),h=t(8);e.exports=function(t,e,r){var n,i,o,a,s,u=e,c=e;for(n=t._boxed,r=t._materialized,i=t._treatErrorsAsValues,t._boxed=!0,t._materialized=void 0===r||r,t._treatErrorsAsValues=!0,o=l(t,u.concat(null),!0),t._boxed=n,t._materialized=r,t._treatErrorsAsValues=i,u=o.optimizedPath,a=o.shorted,s=o.found,o=o.value;u.length&&null===u[u.length-1];)u.pop();if(s&&a)throw new h(c,u);return{path:u,value:o,shorted:a,found:s}}},{17:17,8:8}],14:[function(t,e,r){function u(a,s){Object.keys(a).filter(function(t){return!l(t)&&a[t]}).forEach(function(t){var e=a[t],r=s[t];if(r=r||(s[t]={}),e.$type){var n,i=e.value&&"object"==typeof e.value,o=!a[c];return n=i||o?function(t){var e,r,n,i={},o=Object.keys(t);for(r=0,n=o.length;r<n;r++)e=o[r],l(e)||(i[e]=t[e]);return i}(e):e.value,void(s[t]=n)}u(e,r,t)})}var c=t(37),l=t(97);e.exports=function(t){var e={};return u(t,e),e}},{37:37,97:97}],15:[function(t,e,r){e.exports=function(t,e){for(var r=t._root.cache,n=-1,i=e.length;++n<i&&r&&!r.$type;)r=r[e[n]];return r}},{}],16:[function(t,e,r){var i=t(64),a=t(134);e.exports=function(t){for(var o=a.fromPath(t),e=0,r=o.length;++e<r;)if("object"==typeof o[e])return new i(function(t){t.onError(new Error("Paths must be simple paths"))});var n=this;return new i(function(i){return n.get(o).subscribe(function(t){for(var e=t.json,r=-1,n=o.length;e&&++r<n;)e=e[o[r]];i.onNext(e)},function(t){i.onError(t)},function(){i.onCompleted()})})}},{134:134,64:64}],17:[function(t,e,r){var _=t(11),b=t(25),x=t(27),w=t(29).promote,S=t(120),E=t(118),C=t(119);e.exports=function(t,e,r){for(var n,i,o,a,s,u=t._root.cache,c=e.length,l=[],h=!1,p=!1,f=0,d=u,m=u,g=u,y=!0,v=!1;d&&f<c;){if(null!==(n=e[f++])&&(d=m[n],l[l.length]=n),!d){y=!(h=!(g=void 0));break}if((o=d.$type)===E&&void 0===d.value){g=void 0,y=!1,h=f<c;break}if(f<c){if(o===S){if(x(d)){y=!(v=!(g=void 0));break}if(!(s=(a=_(t,u,u,d,d.value))[0])){d=g=void 0,y=!1;break}o=s.$type,d=s,l=a[1].slice(0)}if(o)break}else g=d;m=d}if(f<c&&!v){for(i=f;i<c;++i)if(null!==e[f]){p=!0;break}for(g=p?void(h=!0):d,i=f;i<c;++i)null!==e[i]&&(l[l.length]=e[i])}if(g&&o&&(x(g)?g=void 0:w(t,g)),g&&o===C&&!t._treatErrorsAsValues)throw{path:f===c?e:e.slice(0,f),value:g.value};return{value:g=g&&t._boxed?Boolean(o)&&!r?b(g):g:!g&&t._materialized?{$type:E}:g&&g.value,shorted:h,optimizedPath:l,found:y}}},{11:11,118:118,119:119,120:120,25:25,27:27,29:29}],18:[function(t,e,r){var i=t(46);e.exports=function(t,e){var r=t._getValueSync({_boxed:!0,_root:t._root,_treatErrorsAsValues:t._treatErrorsAsValues},e,!0).value,n=r&&r[i];return null==n?-1:n}},{46:46}],19:[function(t,e,r){var n=t(12),i=t(31),o=n(i,!1),a=n(i,!0);e.exports={getValueSync:t(17),getBoundValue:t(13),getWithPathsAsPathMap:o,getWithPathsAsJSONGraph:a}},{12:12,13:13,17:17,31:31}],20:[function(t,e,r){var n=t(29),a=t(25),s=n.promote;e.exports=function(t,e,r,n,i){var o=e.value;i.errors||(i.errors=[]),t._boxed&&(o=a(e)),i.errors.push({path:n.slice(0,r+1),value:o}),s(t,e)}},{25:25,29:29}],21:[function(t,e,r){var s=t(30).fastCopy;e.exports=function(t,e,r,n,i,o,a){n.requestedMissingPaths||(n.requestedMissingPaths=[],n.optimizedMissingPaths=[]),function(t,e,r,n,i,o,a){a.requestedMissingPaths.push(n.slice(0,r).concat(e)),a.optimizedMissingPaths.push(i.slice(0,o).concat(e))}(0,r<e.length?s(e,r):[],r,i,o,a,n)}},{30:30}],22:[function(t,e,r){var n=t(29),x=t(25),w=n.promote,S=t(120),E=t(118),C=t(119),M=t(37);e.exports=function(t,e,r,n,i,o,a,s,u,c){if(r){var l,h,p,f,d,m,g,y,v=!1;if(e&&w(t,e),e&&void 0!==e.value||(v=t._materialized),v)y={$type:E};else if(t._boxed)y=x(e);else if(e.$type===S||e.$type===C)y=u?x(e):e.value;else if(u){var _=e.value&&"object"==typeof e.value,b=!e[M];y=_||b?x(e):e.value}else y=e.value;if(i&&(i.hasValue=!0),u){for((d=r.jsonGraph)||(d=r.jsonGraph={},r.paths=[]),l=0,h=s-1;l<h;l++)d[f=a[l]]||(d[f]={}),d=d[f];d[f=a[l]]=v?{$type:E}:y,o&&r.paths.push(o.slice(0,n))}else if(0===n)r.json=y;else{for(d=(d=r.json)||(r.json={}),l=0;l<n-1;l++)d[p=o[l]]||(d[p]={}),d=(m=d)[g=p];null!==(p=o[l])?d[p]=y:m[g]=y}}}},{118:118,119:119,120:120,25:25,29:29,37:37}],23:[function(t,e,r){var f=t(27),n=t(26),i=t(29),d=n.remove,m=i.splice,g=t(119),y=t(20),v=t(22),_=t(21),b=t(28),x=t(35);e.exports=function(t,e,r,n,i,o,a,s,u,c,l){var h=e&&e.$type,p=e&&void 0===e.value;return e&&h?void(f(e)?(e[x]||(m(t,e),d(e)),_(t,r,n,o,a,s,u)):h===g?(l&&(a[n]=null),c||t._treatErrorsAsValues?v(t,e,i,n,o,a,s,u,c,l):y(t,e,n,a,o)):(l&&(a[n]=null),(!p||p&&t._materialized)&&v(t,e,i,n,o,a,s,u,c,l))):void(b(t)?v(t,e,i,n,o,a,s,u,c,l):_(t,r,n,o,a,s,u))}},{119:119,20:20,21:21,22:22,26:26,27:27,28:28,29:29,35:35}],24:[function(t,e,r){var n=t(134);e.exports=function(t){var e=n.fromPath(t);if(!1===Array.isArray(e))throw new Error("Model#getValueSync must be called with an Array path.");return this._path.length&&(e=this._path.concat(e)),this._syncCheck("getValueSync")&&this._getValueSync(this,e).value}},{134:134}],25:[function(t,e,r){var a=t(40);e.exports=function(t){var e,r,n,i=Object.keys(t);for(e={},r=0,n=i.length;r<n;r++){var o=i[r];o[0]!==a&&(e[o]=t[o])}return e}},{40:40}],26:[function(t,e,r){var i=t(43),o=t(33),a=t(42),s=t(44);e.exports={create:function(t,e){var r=e[s]||0;e[i+r]=t,e[s]=r+1,t[a]=r,t[o]=e},remove:function(t){var e=t[o];if(e){for(var r=t[a],n=e[s];r<n;)e[i+r]=e[i+r+1],++r;e[s]=n-1,t[o]=void 0,t[a]=void 0}}}},{33:33,42:42,43:43,44:44}],27:[function(t,e,r){var n=t(106);e.exports=function(t){var e=void 0===t.$expires?-1:t.$expires;return-1!==e&&1!==e&&(0===e||e<n())}},{106:106}],28:[function(t,e,r){e.exports=function(t){return t._materialized&&!t._source}},{}],29:[function(t,e,r){var a=t(34),o=t(45),s=t(38),u=t(41),c=t(35);e.exports={promote:function(t,e){var r=t._root,n=r[a];if(n!==e){var i=e[u],o=e[s];o&&(o[u]=i),i&&(i[s]=o),e[u]=void 0,((r[a]=e)[s]=n)[u]=e}},splice:function(t,e){var r=t._root,n=e[u],i=e[s];i&&(i[u]=n),n&&(n[s]=i),e[u]=void 0,e===r[a]&&(r[a]=void 0),e===r[o]&&(r[o]=void 0),e[c]=!0,r.expired.push(e)}}},{34:34,35:35,38:38,41:41,45:45}],30:[function(t,e,r){e.exports={fastCat:function(t,e){var r,n,i,o=[];for(r=0,n=t.length;r<n;r++)o[r]=t[r];for(i=0,n=e.length;i<n;i++)o[r++]=e[i];return o},fastCatSkipNulls:function(t,e){var r,n,i,o=[];for(r=0,n=t.length;r<n;r++)o[r]=t[r];for(i=0,n=e.length;i<n;i++)null!==e[i]&&(o[r++]=e[i]);return o},fastCopy:function(t,e){var r,n,i,o=[];for(n=0,i=e||0,r=t.length;i<r;n++,i++)o[n]=t[i];return o}}},{}],31:[function(t,e,r){var P=t(11),O=t(23),A=t(27),I=t(143).iterateKeySet,L=t(120),R=t(29).promote;e.exports=function t(e,r,n,i,o,a,s,u,c,l,h,p){var f=p,d=c;if(!n||n&&n.$type||o===i.length)O(e,n,i,o,a,s,u,d,l,h,f);else{var m,g,y=o+1,v=!1,_=m=i[o];if("object"==typeof m&&(_=I(m,v={})),void 0!==_||!v.done){var b=l+1;do{var x;f=!1,null===_?x=n:(x=n[_],d[l]=_,u[o]=_);var w=d,S=b;if(x){var E=x.$type,C=E&&x.value||x;if(y<i.length&&E&&E===L&&!A(x)){h&&O(e,x,i,y,a,s,null,d,S,h,f),R(e,x);var M=P(e,r,r,x,C,a,h);f=!0,x=M[0];var T=M[1];for(w=[],S=T.length,g=0;g<S;++g)w[g]=T[g]}}t(e,r,x,i,y,a,s,u,w,S,h,f),v&&!v.done&&(_=I(m,v))}while(v&&!v.done)}}}},{11:11,120:120,143:143,23:23,27:27,29:29}],32:[function(t,e,r){"use strict";function n(t){return new n.Model(t)}n.Promise="function"==typeof Promise?Promise:t(151),(e.exports=n).Model=t(2)},{151:151,2:2}],33:[function(t,e,r){e.exports=t(40)+"context"},{40:40}],34:[function(t,e,r){e.exports=t(40)+"head"},{40:40}],35:[function(t,e,r){e.exports=t(40)+"invalidated"},{40:40}],36:[function(t,e,r){e.exports=t(40)+"key"},{40:40}],37:[function(t,e,r){e.exports="$modelCreated"},{}],38:[function(t,e,r){e.exports=t(40)+"next"},{40:40}],39:[function(t,e,r){e.exports=t(40)+"parent"},{40:40}],40:[function(t,e,r){e.exports=String.fromCharCode(30)},{}],41:[function(t,e,r){e.exports=t(40)+"prev"},{40:40}],42:[function(t,e,r){e.exports=t(40)+"ref-index"},{40:40}],43:[function(t,e,r){e.exports=t(40)+"ref"},{40:40}],44:[function(t,e,r){e.exports=t(40)+"refs-length"},{40:40}],45:[function(t,e,r){e.exports=t(40)+"tail"},{40:40}],46:[function(t,e,r){e.exports=t(40)+"version"},{40:40}],47:[function(t,e,r){function y(t,e,r,n,i,o,a,s,u,c){if(!R(t)&&!t.$type)for(var l in t)if(l[0]!==_&&"$"!==l[0]&&O(t,l)){var h=t[l],p=A(h)&&!h.$type,f=g(r,n,i,l,h,p,!1,o,a,s,u,c),d=f[0],m=f[1];d&&(p?y(h,e+1,r,m,d,o,a,s,u,c):j(d,m,l,s)&&D(m,P(d),s,o))}}function d(t,e,r,n,i,o,a,s){if(I(r))return N(r,i,o),[void 0,e];T(o,r);var u=r,c=r.value,l=e;if(null!=(r=r[x]))l=r[b]||e;else{var h=0,p=c.length-1;l=r=e;do{var f=g(e,l,r,c[h],t,h<p,!0,n,i,o,a,s);if(r=f[0],R(r))return f;l=f[1]}while(h++<p);if(u[x]!==r){var d=r[E]||0;r[E]=d+1,(r[v+d]=u)[x]=r,u[S]=d}}return[r,l]}function g(t,e,r,n,i,o,a,s,u,c,l,h){for(var p=r.$type;p===C;){var f=d(i,t,r,s,u,c,l,h);if(r=f[0],R(r))return f;e=f[1],p=r&&r.$type}if(void 0!==p)return[r,e];if(null==n){if(o)throw new Error("`null` is not allowed in branch key positions.");r&&(n=r[m])}else r=(e=r)[n];return[r,e]}var m=t(36),v=t(43),_=t(40),b=t(39),x=t(33),w=t(46),S=t(42),E=t(44),C=t(120),M=t(13),T=t(50),P=t(88),O=t(91),A=t(100),I=t(95),L=t(96),R=t(102),N=t(86),k=t(92),D=t(115),j=t(109);e.exports=function(t,e){for(var r=t._root,n=r,i=r.expired,o=k(),a=r._comparator,s=r._errorSelector,u=t._path,c=r.cache,l=u.length?M(t,u).value:c,h=l[b]||c,p=c[w],f=-1,d=e.length;++f<d;){y(e[f].json,0,c,h,l,o,i,n,a,s)}var m=c[w],g=r.onChange;L(g)&&p!==m&&g()}},{100:100,102:102,109:109,115:115,120:120,13:13,33:33,36:36,39:39,40:40,42:42,43:43,44:44,46:46,50:50,86:86,88:88,91:91,92:92,95:95,96:96}],48:[function(t,e,r){function m(t,e,r,n,i,o,a,s){var u={},c=e<t.length-1,l=t[e],h=O(l,u);do{var p=g(r,n,i,h,c,!1,o,a,s),f=p[0],d=p[1];f&&(c?m(t,e+1,r,d,f,o,a,s):L(f,d,h,s)&&I(d,E(f),s,o)),h=O(l,u)}while(!u.done)}function h(t,e,r,n,i){if(C(e))return P(e,n,i),[void 0,t];S(i,e);var o=e,a=e.value,s=t;if(null!=(e=e[d]))s=e[y]||t;else{var u=0,c=a.length-1;s=e=t;do{var l=g(t,s,e,a[u],u<c,!0,r,n,i);if(e=l[0],T(e))return l;s=l[1]}while(u++<c);if(o[d]!==e){var h=e[b]||0;e[b]=h+1,(e[f+h]=o)[d]=e,o[_]=h}}return[e,s]}function g(t,e,r,n,i,o,a,s,u){for(var c=r.$type;c===x;){var l=h(t,r,a,s,u);if(r=l[0],T(r))return l;e=l[1],c=r.$type}if(void 0!==c)return[r,e];if(null==n){if(i)throw new Error("`null` is not allowed in branch key positions.");r&&(n=r[p])}else r=(e=r)[n];return[r,e]}var p=t(36),f=t(43),y=t(39),d=t(33),v=t(46),_=t(42),b=t(44),x=t(120),w=t(13),S=t(50),E=t(88),C=t(95),M=t(96),T=t(102),P=t(86),O=t(143).iterateKeySet,A=t(92),I=t(115),L=t(109);e.exports=function(t,e){for(var r=t._root,n=r,i=r.expired,o=A(),a=t._path,s=r.cache,u=a.length?w(t,a).value:s,c=u[y]||s,l=s[v],h=-1,p=e.length;++h<p;){m(e[h],0,s,c,u,o,i,n)}var f=s[v],d=r.onChange;M(d)&&l!==f&&d()}},{102:102,109:109,115:115,120:120,13:13,143:143,33:33,36:36,39:39,42:42,43:43,44:44,46:46,50:50,86:86,88:88,92:92,95:95,96:96}],49:[function(t,e,r){var d=t(36),m=t(39),g=t(34),y=t(45),v=t(38),_=t(41),b=t(108),x=t(115);e.exports=function(t,e,r,n,i,o){var a=r,s=i;"number"!=typeof s&&(s=.75);var u,c,l,h="number"==typeof o,p=n*s;for(c=e.pop();c;)a-=l=c.$size||0,!0==h?x(c,l,t,o):(u=c[m])&&b(c,u,c[d],t),c=e.pop();if(n<=a){var f=t[y];for(c=f;p<=a&&c;)f=f[_],a-=l=c.$size||0,!0==h&&x(c,l,t,o),c=f;t[y]=t[_]=c,null==c?t[g]=t[v]=void 0:c[v]=void 0}}},{108:108,115:115,34:34,36:36,38:38,39:39,41:41,45:45}],50:[function(t,e,r){var a=t(121),s=t(34),u=t(45),c=t(38),l=t(41),h=t(100);e.exports=function(t,e){if(h(e)&&e.$expires!==a){var r=t[s],n=t[u],i=e[c],o=e[l];e!==r&&(null!=i&&"object"==typeof i&&(i[l]=o),null!=o&&"object"==typeof o&&(o[c]=i),null!=(i=r)&&"object"==typeof r&&(r[l]=e),t[s]=t[c]=r=e,r[c]=i,r[l]=void 0),null!=n&&e!==n||(t[u]=t[l]=n=o||e)}return e}},{100:100,121:121,34:34,38:38,41:41,45:45}],51:[function(t,e,r){var a=t(34),s=t(45),u=t(38),c=t(41);e.exports=function(t,e){var r=t[a],n=t[s],i=e[u],o=e[c];null!=i&&"object"==typeof i&&(i[c]=o),null!=o&&"object"==typeof o&&(o[u]=i),e===r&&(t[a]=t[u]=i),e===n&&(t[s]=t[c]=o),e[u]=e[c]=void 0,r=n=i=o=void 0}},{34:34,38:38,41:41,45:45}],52:[function(t,e,r){function c(t,e){var r=!1;return function(){r||t._disposed||(r=!0,t._callbacks[e]=null,t._optimizedPaths[e]=[],t._requestedPaths[e]=[],0!=--t._count||t.sent||(t._disposable.dispose(),t.requestQueue.removeRequest(t)))}}function n(t,e){this.sent=!1,this.scheduled=!1,this.requestQueue=e,this.id=++i,this.type=o,this._scheduler=t,this._pathMap={},this._optimizedPaths=[],this._requestedPaths=[],this._callbacks=[],this._count=0,this._disposable=null,this._collapsed=null,this._disposed=!1}var l=t(59),u=t(60),i=0,o=t(57).GetRequest,h=t(76),p=t(78),f=t(119),d=[];n.prototype={batch:function(t,e,r){var o=this,n=o._optimizedPaths,a=o._requestedPaths,s=o._callbacks,i=n.length;return n[i]=e,a[i]=t,s[i]=r,++o._count,o.scheduled||(o.scheduled=!0,o._disposable=o._scheduler.schedule(function(){u(o,n,function(t,e){if(o.requestQueue.removeRequest(o),o._disposed=!0,o._count){o._merge(a,t,e);for(var r=0,n=s.length;r<n;++r){var i=s[r];i&&i(t,e)}}})})),c(o,i)},add:function(t,e,r){var n,i,o=l(t,e,this._pathMap),a=!1,s=!1;if((n=o?(i=o[2],o[1]):(i=t,e)).length<e.length){a=!0;var u=this._callbacks.length;this._callbacks[u]=r,this._requestedPaths[u]=o[0],this._optimizedPaths[u]=[],++this._count,s=c(this,u)}return[a,i,n,s]},_merge:function(t,e,r){var n=this.requestQueue.model,i=n._root,o=i.errorSelector,a=i.comparator,s=n._path;n._path=d;var u=function(t){for(var e=[],r=-1,n=0,i=t.length;n<i;++n)for(var o=t[n],a=0,s=o.length;a<s;++a)e[++r]=o[a];return e}(t);if(e){var c=e;c instanceof Error&&(c={message:c.message}),c.$type||(c={$type:f,value:c});var l=u.map(function(t){return{path:t,value:c}});p(n,l,null,o,a)}else h(n,[{paths:u,jsonGraph:r.jsonGraph}],null,o,a);n._path=s}},e.exports=n},{119:119,57:57,59:59,60:60,76:76,78:78}],53:[function(t,e,r){function n(){this.length=0,this.pending=!1,this.pathmaps=[],a.call(this,this._subscribe)}var i=t(159),o=i.Observer,a=i.Observable,s=i.Disposable,u=i.SerialDisposable,c=i.CompositeDisposable,l=t(9),f=t(143).iterateKeySet;n.create=function(t,e,r){var n=new this;return n.queue=t,n.model=e,n.index=r,n},((n.prototype=Object.create(a.prototype)).constructor=n).prototype.insertPath=function(t,e,r,n,i){var o=n||0,a=i||t.length-1,s=r||this.pathmaps[a+1]||(this.pathmaps[a+1]=Object.create(null));if(null==s)return!1;var u,c,l=t[o],h={};u=f(l,h);do{if(c=s[u],o<a){if(null==c){if(e)return!1;c=s[u]=Object.create(null)}if(!1===this.insertPath(t,e,c,o+1,a))return!1}else s[u]=(c||0)+1,this.length+=1;h.done||(u=f(l,h))}while(!h.done);return!0},n.prototype.removePath=function(t,e,r,n){var i=r||0,o=n||t.length-1,a=e||this.pathmaps[o+1];if(null==a)return!0;var s,u,c=0,l=t[i],h={};s=f(l,h);do{if(null!=(u=a[s])){if(i<o){c+=this.removePath(t,u,i+1,o);var p=void 0;for(p in u)break;void 0===p&&delete a[s]}else 0===(u=a[s]=(u||1)-1)&&delete a[s],c+=1,this.length-=1;h.done||(s=f(l,h))}}while(!h.done);return c},n.prototype.getSourceObserver=function(e){var r=this;return o.create(function(t){t.jsonGraph=t.jsonGraph||t.jsong||t.values||t.value,t.index=r.index,e.onNext(t)},function(t){e.onError(t)},function(){e.onCompleted()})},n.prototype._subscribe=function(t){var e=this,r=this.queue,n=!(e.pending=!0),i=new u,o=s.create(function(){n||(n=!0,r&&r._remove(e))}),a=new c(i,o);try{i.setDisposable(this.model._source[this.method](this.getSourceArgs()).subscribe(this.getSourceObserver(t)))}catch(t){throw new l(t)}return a},e.exports=n},{143:143,159:159,9:9}],54:[function(t,e,r){function n(t,e){this.total=0,this.model=t,this.requests=[],this.scheduler=e}var i=t(58),g=t(40),y=t(90),v=t(100),o=t(143);n.prototype.set=function(t){return t.paths=o.collapse(t.paths),i.create(this.model,t)},n.prototype._remove=function(t){var e=this.requests,r=e.indexOf(t);-1!==r&&e.splice(r,1)},n.prototype.distributePaths=function(t,e,r){var n,i,o=this.model,a=-1,s=t.length,u=-1,c=e.length,l=[];t:for(;++a<s;){var h=t[a];for(u=-1;++u<c;)if((i=e[u]).insertPath(h,i.pending)){l[u]=i;continue t}n||(n=r.create(this,o,this.total++),e[u]=n,l[c++]=n),n.insertPath(h,!1)}var p=[],f=-1;for(u=-1;++u<c;)null!=(i=l[u])&&(p[++f]=i);return p},n.prototype.mergeJSONGraphs=function(t,e){var r=0,n=[],i=[],o=[],a=t.index,s=e.index;t.index=Math.max(a,s),n[-1]=t.jsonGraph||{},i[-1]=e.jsonGraph||{};t:for(;-1<r;){for(var u=n[r-1],c=i[r-1],l=o[r-1]||(o[r-1]=Object.keys(c));0<l.length;){var h=l.pop();if(h[0]!==g)if(u.hasOwnProperty(h)){var p=u[h],f=y(p),d=c[h],m=y(d);if(v(p)&&v(d)&&!f&&!m){n[r]=p,i[r]=d,r+=1;continue t}a<s&&(u[h]=d)}else u[h]=c[h]}r-=1}return t},e.exports=n},{100:100,143:143,40:40,58:58,90:90}],55:[function(t,e,r){function n(t,e){this.model=t,this.scheduler=e,this.requests=this._requests=[]}var i=t(54),o=t(56);n.prototype.get=o.prototype.get,n.prototype.removeRequest=o.prototype.removeRequest,n.prototype.set=i.prototype.set,n.prototype.call=i.prototype.call,e.exports=n},{54:54,56:56}],56:[function(t,e,r){function n(t,e){this.model=t,this.scheduler=e,this.requests=this._requests=[]}var m=t(57),g=t(52);n.prototype={setScheduler:function(t){this.scheduler=t},get:function(t,e,r){function n(){p||0===--u&&r()}var i,o,a,s=[],u=0,c=this._requests,l=e,h=t,p=!1;for(i=0,o=c.length;i<o;++i)if((a=c[i]).type===m.GetRequest){if(a.sent){var f=a.add(h,l,n);f[0]&&(h=f[1],l=f[2],s[s.length]=f[3],++u)}else a.batch(h,l,n),l=[],h=[],++u;if(!l.length)break}if(l.length){a=new g(this.scheduler,this),c[c.length]=a,++u;var d=a.batch(h,l,n);s[s.length]=d}return function(){if(!p&&0!==u){p=!0;for(var t=s.length,e=0;e<t;++e)s[e]()}}},removeRequest:function(t){for(var e=this._requests,r=e.length;0<=--r;)if(e[r].id===t.id){e.splice(r,1);break}}},e.exports=n},{52:52,57:57}],57:[function(t,e,r){e.exports={GetRequest:"GET"}},{}],58:[function(t,e,r){function n(){c.call(this)}var u=t(159).Observer,c=t(53),l=t(83),h=t(76),p=t(78),f=new Array(0);n.create=function(t,e){var r=new n;return r.model=t,r.jsonGraphEnvelope=e,r},((n.prototype=Object.create(c.prototype)).constructor=n).prototype.method="set",n.prototype.insertPath=function(){return!1},n.prototype.removePath=function(){return 0},n.prototype.getSourceArgs=function(){return this.jsonGraphEnvelope},n.prototype.getSourceObserver=function(r){var n=this.model,i=n._path,o=this.jsonGraphEnvelope.paths,t=n._root,a=t.errorSelector,s=t.comparator;return c.prototype.getSourceObserver.call(this,u.create(function(t){n._path=f;var e=h(n,[{paths:o,jsonGraph:t.jsonGraph}],null,a,s);t.paths=e[1],n._path=i,r.onNext(t)},function(e){n._path=f,p(n,l(o,function(t){return{path:t,value:e}}),null,a,s),n._path=i,r.onError(e)},function(){r.onCompleted()}))},e.exports=n},{159:159,53:53,76:76,78:78,83:83}],59:[function(t,e,r){var f=t(143).hasIntersection,d=t(84);e.exports=function(t,e,r){for(var n=[],i=[],o=[],a=-1,s=-1,u=!1,c=0,l=e.length;c<l;++c){var h=e[c],p=r[h.length];p&&f(p,h,0)?(!u&&0<c&&(i=d(t,0,c),n=d(e,0,c)),o[++a]=t[c],u=!0):u&&(n[++s]=h,i[s]=t[c])}return u?[o,n,i]:null}},{143:143,84:84}],60:[function(t,e,r){var n=t(143),v=n.toTree,_=n.toPaths;e.exports=function(t,e,r){if(0!==t._count){t.sent=!0,t.scheduled=!1;for(var n=t._pathMap,i=0,o=Object.keys(e).length;i<o;++i)for(var a=e[i],s=0,u=a.length;s<u;++s){var c=a[s],l=c.length;if(n[l]){var h=n[l];h[h.length]=c}else n[l]=[c]}for(var p=Object.keys(n),f=0,d=p.length;f<d;++f){var m=p[f];n[m]=v(n[m])}var g,y=t._collasped=_(n);t.requestQueue.model._source.get(y).subscribe(function(t){g=t},function(t){r(t,g)},function(){r(null,g)})}else t.requestQueue.removeRequest(t)}},{143:143}],61:[function(t,e,r){function n(t){v.call(this,t||i)}function g(t){return y.Observable.defer(function(){return t})}function i(i){function p(t){return l.concat(t)}var t,e=this.args,o=this.model,a=x.fromPath(e[0]),s=e[1]||[],u=(e[2]||[]).map(x.fromPath),f=(e[3]||[]).map(x.fromPath),d=o._clone({_path:[]}),c=d.withoutDataSource(),r=o._path,n=r.concat(a),l=n.slice(0,-1),h=g(o.withoutDataSource().get(a)).map(function(t){for(var e=t.json,r=-1,n=a.length;e&&++r<n;)e=e[a[r]];return{model:d._derefSync(l).boxValues(),localFn:e}}).flatMap(function(t){function l(t,e){var r=e.path;return t.push.apply(t,u.map(function(t){return r.concat(t)})),t}function h(t){return t.path}var e=t&&t.localFn;if("function"!=typeof e)return v.empty();var r=t.model,n=r._path,i=e.apply(r,s).reduce(function(t,e){if(Boolean(e.invalidated))t.invalidations.push(t.localThisPath.concat(e.path));else{var r=e.path,n=e.value;Boolean(n)&&"object"==typeof n&&n.$type===w?t.references.push({path:p(r),value:e.value}):t.values.push({path:p(r),value:e.value})}return t},{values:[],references:[],invalidations:[],localThisPath:n}).flatMap(function(e){var t=e.values.concat(e.references);return 0<t.length?g(c.set.apply(c,t)._toJSONG()).map(function(t){return{results:e,envelope:t}}):v.return({results:e,envelope:{jsonGraph:{},paths:[]}})}).flatMap(function(t){var e=t.envelope,r=t.results,n=r.values,i=r.references,o=r.invalidations,a=n.map(h).map(p),s=i.reduce(l,[]),u=f.map(p),c=s.concat(u);return(0<c.length?g(d.get.apply(d,a.concat(c))._toJSONG()):v.return(e)).doAction(function(t){t.invalidated=o})});return v.return(i)}).defaultIfEmpty((t=o._source)&&"object"==typeof t?y.Observable.defer(function(){var e;try{e=t.call(n,s,u,f)}catch(t){e=v.throw(new b(t))}return e}).map(function(t){var e=t.invalidated;return e&&e.length&&d.invalidate.apply(d,e),t}):v.empty()).mergeAll().flatMap(function(t){return g(c.set(t)).reduce(function(t){return t},null).map(function(){return{invalidated:t.invalidated,paths:t.paths.map(function(t){return t.slice(r.length)})}})}),m=new _;return m.add(h.subscribe(function(t){var e=t.paths,r=t.invalidated,n=o.get.apply(o,e);"AsJSONG"===i.outputFormat&&(n=g(n._toJSONG()).doAction(function(t){t.invalidated=r})),m.add(n.subscribe(i))},function(t){i.onError(t)})),m}var y=t(159)&&t(158),v=y.Observable,_=y.CompositeDisposable,o=t(64),b=t(9),x=t(134),w=t(120);n.create=o.create,((n.prototype=Object.create(v.prototype)).constructor=n).prototype.invokeSourceRequest=function(t){return this},n.prototype.ensureCollect=function(t){return this},n.prototype.initialize=function(){return this},e.exports=n},{120:120,134:134,158:158,159:159,64:64,9:9}],62:[function(t,e,r){function n(t){i.call(this,t)}var i=t(159).Observable,o=t(64),p=t(134),a=t(88),s=t(49),f=t(81),u=t(46),d=Array.isArray,m=t(101),g=t(98),y=t(99);n.create=o.create,((n.prototype=Object.create(i.prototype)).constructor=n).prototype.subscribeCount=0,n.prototype.subscribeLimit=10,n.prototype.initialize=function(){for(var t,e,r=this.model,n=this.outputFormat||"AsPathMap",i=this.isProgressive,o=[{}],a=[],s=this.args,u=-1,c=s.length;++u<c;){var l,h=s[u];d(h)||"string"==typeof h?(h=p.fromPath(h),l="PathValues"):m(h)?(h.path=p.fromPath(h.path),l="PathValues"):y(h)?l="JSONGs":g(h)&&(l="PathMaps"),e!==l&&(t={inputType:e=l,arguments:[]},a.push(t),t.values=o),t.arguments.push(h)}return this.boundPath=f(r._path),this.groups=a,this.outputFormat=n,this.isProgressive=i,this.isCompleted=!1,this.isMaster=null==r._source,this.values=o,this},n.prototype.invokeSourceRequest=function(t){return this},n.prototype.ensureCollect=function(r){var e=this.finally(function(){var t=r._root,e=t.cache;t.collectionScheduler.schedule(function(){s(t,t.expired,a(e),r._maxSize,r._collectRatio,e[u])})});return new this.constructor(function(t){return e.subscribe(t)})},e.exports=n},{101:101,134:134,159:159,46:46,49:49,64:64,81:81,88:88,98:98,99:99}],63:[function(t,e,r){function n(t){o.call(this,t||i)}function i(t){for(var e=this.model,r=this.method,n=this.groups,i=-1,o=n.length;++i<o;){var a=n[i],s=a.inputType,u=a.arguments;if(0<u.length)(0,e["_"+r+s+"AsJSON"])(e,u)}return t.onCompleted(),c.empty}var c=t(159).Disposable,o=t(62);n.create=o.create,(n.prototype=Object.create(o.prototype)).method="invalidate",n.prototype.constructor=n,e.exports=n},{159:159,62:62}],64:[function(t,e,r){function n(t){this._subscribe=t}function i(t){var e=this.model,r=new this.type;return r.model=e,r.args=this.args,r.outputFormat=t.outputFormat||"AsPathMap",r.isProgressive=t.isProgressive||!1,r.subscribeCount=0,r.subscribeLimit=t.retryLimit||10,r.initialize().invokeSourceRequest(e).ensureCollect(e).subscribe(t)}var o=t(32),a=(t(159)&&t(158)).Observable,s=t(84),u=t(105),c={outputFormat:{value:"AsJSONG"}},l={isProgressive:{value:!0}};n.create=function(t,e){var r=new n(i);return r.args=e,r.type=this,r.model=t,r},((n.prototype=Object.create(a.prototype)).constructor=n).prototype._mixin=function(){var e=this,r=s(arguments);return new e.constructor(function(t){return e.subscribe(r.reduce(function(t,e){return Object.create(t,e)},t))})},n.prototype._toJSONG=function(){return this._mixin(c)},n.prototype.progressively=function(){return this._mixin(l)},n.prototype.subscribe=function(t,e,r){var n=t;n&&"object"==typeof n||(n={onNext:t||u,onError:e||u,onCompleted:r||u});var i=this._subscribe(n);switch(typeof i){case"function":return{dispose:i};case"object":return i||{dispose:u};default:return{dispose:u}}},n.prototype.then=function(t,e){var i=this;return new o.Promise(function(t,e){var r,n=!1;i.toArray().subscribe(function(t){r=t.length<=1?t[0]:t},function(t){n=!0,e(t)},function(){!1===n&&t(r)})}).then(t,e)},e.exports=n},{105:105,158:158,159:159,32:32,84:84}],65:[function(t,e,r){function n(t){s.call(this,t||i)}function i(t){return this.isCompleted?g.call(this,t):function(t){if(this.subscribeCount++>this.subscribeLimit)return t.onError("Loop kill switch thrown."),_.empty;for(var e=[],r=[],n=this.model,i=this.isMaster,o=n._root,a=this.outputFormat,s=o.errorSelector,u=this.method,c=this.groups,l=-1,h=c.length;++l<h;){var p=c[l],f=p.inputType,d=p.arguments;if(0<d.length){var m=(0,n["_"+u+f+a])(n,d,null,s);r.push.apply(r,m[1]),"PathValues"===f?e.push.apply(e,d.map(y)):"JSONGs"===f?e.push.apply(e,b(d,v)):e.push.apply(e,m[0])}}return this.requestedPaths=e,i?(this.isCompleted=!0,g.call(this,t)):void t.onError({method:u,optimizedPaths:r,invokeSourceRequest:!0})}.call(this,t)}function g(t){var e=new a(this.model,this.requestedPaths);return"AsJSONG"===this.outputFormat&&(e=e._toJSONG()),this.isProgressive&&(e=e.progressively()),e.subscribe(t)}function y(t){return t.path}function v(t){return t.paths}var o=t(159),u=o.Observable,_=o.Disposable,a=t(67),s=t(62),c=t(9),b=t(82),l=new Array(0);n.create=s.create,(n.prototype=Object.create(s.prototype)).method="set",(n.prototype.constructor=n).prototype.invokeSourceRequest=function(o){var a=this,s=this.catch(function(t){var e;if(t&&!0===t.invokeSourceRequest){var r={},n=o._path,i=t.optimizedPaths;o._path=l,o._getPathValuesAsJSONG(o._materialize().withoutDataSource(),i,[r]),o._path=n,e=o._request.set(r).do(function(t){a.isCompleted=i.length===t.paths.length},function(){a.isCompleted=!0}).materialize().flatMap(function(t){if("C"===t.kind)return u.empty();if("E"===t.kind){var e=t.exception;if(c.is(e))return u.throw(t.exception)}return s})}else e=u.throw(t);return e});return new this.constructor(function(t){return s.subscribe(t)})},e.exports=n},{159:159,62:62,67:67,82:82,9:9}],66:[function(t,e,r){function n(t){this.disposed=!1,this.currentDisposable=t}n.prototype={dispose:function(){if(!this.disposed&&this.currentDisposable){this.disposed=!0;var t=this.currentDisposable;t.dispose?t.dispose():t()}}},e.exports=n},{}],67:[function(t,e,r){var n=t(64),a=t(68),s=t(69),u={dispose:function(){}},i=t(159).Observable,o=e.exports=function(t,e,r,n){this.model=t,this.currentRemainingPaths=e,this.isJSONGraph=r||!1,this.isProgressive=n||!1};o.prototype=Object.create(i.prototype),o.prototype.subscribe=n.prototype.subscribe,o.prototype.then=n.prototype.then,o.prototype._toJSONG=function(){return new o(this.model,this.currentRemainingPaths,!0,this.isProgressive)},o.prototype.progressively=function(){return new o(this.model,this.currentRemainingPaths,this.isJSONGraph,!0)},o.prototype._subscribe=function(t){var e=[{}],r=[],n=t.isJSONG=this.isJSONGraph,i=this.isProgressive,o=a(this.model,this.currentRemainingPaths,t,i,n,e,r);return o?s(this,this.model,o,t,e,r,1):u}},{159:159,64:64,68:68,69:69}],68:[function(t,e,r){var n=t(19),m=n.getWithPathsAsJSONGraph,g=n.getWithPathsAsPathMap;e.exports=function(t,e,r,n,i,o,a){var s;if((s=i?m(t,e,o):g(t,e,o)).criticalError)return r.onError(s.criticalError),null;var u=s.hasValue,c=!s.requestedMissingPaths||!t._source,l=o[0].json||o[0].jsonGraph;if(s.errors)for(var h=s.errors,p=a.length,f=0,d=h.length;f<d;++f,++p)a[p]=h[f];if(u&&n||l&&c)try{++t._root.syncRefCount,r.onNext(o[0])}catch(t){throw t}finally{--t._root.syncRefCount}return c?(a.length?r.onError(a):r.onCompleted(),null):s}},{19:19}],69:[function(t,e,r){var y=t(68),v=t(10),_=t(30).fastCat,b=t(49),x=t(88),w=t(66),S=t(46);e.exports=function i(o,a,t,s,u,c,l){if(10===l)throw new v;var e=a._request,h=t.requestedMissingPaths,r=t.optimizedMissingPaths,p=new w,n=[],f=a._path;if(f.length)for(var d=0,m=h.length;d<m;++d)n[d]=_(f,h[d]);else n=h;var g=e.get(n,r,function(){var t=y(a,h,s,o.isProgressive,o.isJSONGraph,u,c);if(t)p.currentDisposable=i(o,a,t,s,u,c,l+1);else{var e=a._root,r=e.cache,n=r[S];b(e,e.expired,x(r),a._maxSize,a._collectRatio,n)}});return p.currentDisposable=g,p}},{10:10,30:30,46:46,49:49,66:66,68:68,88:88}],70:[function(t,e,r){var n=t(67);e.exports=function(t){return new n(this,t)}},{67:67}],71:[function(t,e,r){var n=t(134),i=t(64),o=t(72),a=t(116),s=t(67);e.exports=function(){var e=a(arguments,o,"get");if(!0!==e)return new i(function(t){t.onError(e)});var t=n.fromPathsOrPathValues(arguments);return new s(this,t)}},{116:116,134:134,64:64,67:67,72:72}],72:[function(t,e,r){e.exports={path:!0,pathSyntax:!0}},{}],73:[function(t,e,r){function n(){}var i=t(123),o=t(159).Disposable;n.prototype.schedule=function(t){return i(t),o.empty},n.prototype.scheduleWithState=function(t,e){var r=this;return i(function(){e(r,t)}),o.empty},e.exports=n},{123:123,159:159}],74:[function(t,e,r){function n(){}var i=t(159).Disposable;n.prototype.schedule=function(t){return t(),i.empty},n.prototype.scheduleWithState=function(t,e){return e(this,t),i.empty},e.exports=n},{159:159}],75:[function(t,e,r){function n(t){this.delay=t}var i=t(159).Disposable;n.prototype.schedule=function(t){var e=setTimeout(t,this.delay);return i.create(function(){void 0!==e&&(clearTimeout(e),e=void 0)})},n.prototype.scheduleWithState=function(t,e){var r=this,n=setTimeout(function(){e(r,t)},this.delay);return i.create(function(){void 0!==n&&(clearTimeout(n),n=void 0)})},e.exports=n},{159:159}],76:[function(t,e,r){function C(t,e,r,n,i,o,a,s,u,c,l,h,p,f,d,m,g){for(var y={},v=e<t.length-1,_=t[e],b=R(_,y),x=h.index;;){l.depth=e;var w=M(r,n,i,o,a,s,b,v,!1,l,h,p,f,d,m,g);l[e]=b,l.index=e,h[h.index++]=b;var S=w[0],E=w[1];if(S&&(v?C(t,e+1,r,E,S,o,w[3],w[2],u,c,l,h,p,f,d,m,g):(P(d,S),u.push(l.slice(0,l.index+1)),c.push(h.slice(0,h.index)))),b=R(_,y),y.done)break;h.index=x}}function v(t,e,r,n,i,o,a,s,u,c,l){var h=e.value;if(o.splice(0,o.length),o.push.apply(o,h),O(e))return o.index=h.length,L(e,s,u),[void 0,t,n,r];P(u,e);var p=0,f=e,d=h.length-1,m=e=t,g=n=r;do{var y=M(t,m,e,r,g,n,h[p],p<d,!0,i,o,a,s,u,c,l);if(e=y[0],I(e))return o.index=p,y;m=y[1],n=y[2],g=y[3]}while(p++<d);if(o.index=p,f[x]!==e){var v=e[S]||0;e[S]=v+1,(e[b+v]=f)[x]=e,f[w]=v}return[e,m,n,g]}function M(t,e,r,n,i,o,a,s,u,c,l,h,p,f,d,m){for(var g=r.$type;g===T;){var y=v(t,r,n,o,c,l,h,p,f,d,m);if(r=y[0],I(r))return y;e=y[1],o=y[2],i=y[3],g=r.$type}if(void 0!==g)return[r,e,o,i];if(null==a){if(s)throw new Error("`null` is not allowed in branch key positions.");r&&(a=r[_])}else i=o,r=(e=r)[a],o=i&&i[a];return[r=k(e,r,o,a,c,l,h,p,f,d,m),e,o,i]}var _=t(36),b=t(43),x=t(33),E=t(46),w=t(42),S=t(44),T=t(120),P=t(50),O=t(94),A=t(96),I=t(102),L=t(86),R=t(143).iterateKeySet,N=t(92),k=t(103);e.exports=function(t,e,r,n,i){for(var o=t._root,a=o,s=o.expired,u=N(),c=o.cache,l=c[E],h=[],p=[],f=[],d=[],m=-1,g=e.length;++m<g;)for(var y=e[m],v=y.paths,_=y.jsonGraph,b=-1,x=v.length;++b<x;){C(v[b],p.index=0,c,c,c,_,_,_,f,d,h,p,u,s,a,i,n)}var w=c[E],S=o.onChange;return A(S)&&l!==w&&S(),[f,d]}},{102:102,103:103,120:120,143:143,33:33,36:36,42:42,43:43,44:44,46:46,50:50,86:86,92:92,94:94,96:96}],77:[function(t,e,r){function E(t,e,r,n,i,o,a,s,u,c,l,h,p,f){var d=function(t){if(R(t)&&!t.$type){var e=[],r=0;for(var n in A(t)&&(e[r++]="length"),t)n[0]!==M&&"$"!==n[0]&&L(t,n)&&(e[r++]=n);return e}}(t);if(d&&d.length)for(var m=0,g=d.length,y=u.index;;){var v=d[m],_=t[v],b=R(_)&&!_.$type;s.depth=e;var x=C(r,n,i,v,_,b,!1,s,u,c,l,h,p,f);s[e]=v,s.index=e,u[u.index++]=v;var w=x[0],S=x[1];if(w&&(b?E(_,e+1,r,S,w,o,a,s,u,c,l,h,p,f):(I(h,w),o.push(s.slice(0,s.index+1)),a.push(u.slice(0,u.index)))),++m>=g)break;u.index=y}}function g(t,e,r,n,i,o,a,s,u,c){var l=r.value;if(i.splice(0,i.length),i.push.apply(i,l),S(r))return i.index=l.length,D(r,a,s),[void 0,e];I(s,r);var h=r,p=e;if(null!=(r=r[_]))p=r[T]||e,i.index=l.length;else{var f=0,d=l.length-1;p=r=e;do{var m=C(e,p,r,l[f],t,f<d,!0,n,i,o,a,s,u,c);if(r=m[0],k(r))return i.index=f,m;p=m[1]}while(f++<d);if(i.index=f,h[_]!==r){var g=r[x]||0;r[x]=g+1,(r[v+g]=h)[_]=r,h[b]=g}}return[r,p]}function C(t,e,r,n,i,o,a,s,u,c,l,h,p,f){for(var d=r.$type;d===w;){var m=g(i,t,r,s,u,c,l,h,p,f);if(r=m[0],k(r))return m;e=m[1],d=r&&r.$type}if(void 0!==d)return[r,e];if(null==n){if(o)throw new Error("`null` is not allowed in branch key positions.");r&&(n=r[y])}else r=(e=r)[n];return[r=z(e,r,n,i,o,a,s,u,c,l,h,p,f),e]}var y=t(36),v=t(43),M=t(40),T=t(39),_=t(33),P=t(46),b=t(42),x=t(44),w=t(120),O=t(13),A=Array.isArray,I=t(50),L=t(91),R=t(100),S=t(95),N=t(96),k=t(102),D=t(86),j=t(92),z=t(104);e.exports=function(t,e,r,n,i){for(var o=t._root,a=o,s=o.expired,u=j(),c=t._path,l=o.cache,h=c.length?O(t,c).value:l,p=h[T]||l,f=l[P],d=[],m=[],g=[],y=c.length,v=-1,_=e.length;++v<_;){var b=e[v],x=c.slice(0);x.index=y,E(b.json,0,l,p,h,m,g,d,x,u,s,a,i,n)}var w=l[P],S=o.onChange;return N(S)&&f!==w&&S(),[m,g]}},{100:100,102:102,104:104,120:120,13:13,33:33,36:36,39:39,40:40,42:42,43:43,44:44,46:46,50:50,86:86,91:91,92:92,95:95,96:96}],78:[function(t,e,r){function M(t,e,r,n,i,o,a,s,u,c,l,h,p,f,d){for(var m={},g=r<e.length-1,y=e[r],v=R(y,m),_=c.index;;){u.depth=r;var b=S(n,i,o,v,t,g,!1,u,c,l,h,p,f,d);u[r]=v,u.index=r,c[c.index++]=v;var x=b[0],w=b[1];if(x&&(g?M(t,e,r+1,n,w,x,a,s,u,c,l,h,p,f,d):(E(p,x),a.push(u.slice(0,u.index+1)),s.push(c.slice(0,c.index)))),v=R(y,m),m.done)break;c.index=_}}function g(t,e,r,n,i,o,a,s,u,c){var l=r.value;if(i.splice(0,i.length),i.push.apply(i,l),C(r))return i.index=l.length,L(r,a,s),[void 0,e];E(s,r);var h=r,p=e;if(null!=(r=r[_]))p=r[T]||e,i.index=l.length;else{var f=0,d=l.length-1;p=r=e;do{var m=S(e,p,r,l[f],t,f<d,!0,n,i,o,a,s,u,c);if(r=m[0],I(r))return i.index=f,m;p=m[1]}while(f++<d);if(i.index=f,h[_]!==r){var g=r[x]||0;r[x]=g+1,(r[v+g]=h)[_]=r,h[b]=g}}return[r,p]}function S(t,e,r,n,i,o,a,s,u,c,l,h,p,f){for(var d=r.$type;d===w;){var m=g(i,t,r,s,u,c,l,h,p,f);if(r=m[0],I(r))return m;e=m[1],d=r.$type}if(void 0!==d)return[r,e];if(null==n){if(o)throw new Error("`null` is not allowed in branch key positions.");r&&(n=r[y])}else r=(e=r)[n];return[r=k(e,r,n,i,o,a,s,u,c,l,h,p,f),e]}var y=t(36),v=t(43),T=t(39),_=t(33),P=t(46),b=t(42),x=t(44),w=t(120),O=t(13),E=t(50),C=t(95),A=t(96),I=t(102),L=t(86),R=t(143).iterateKeySet,N=t(92),k=t(104);e.exports=function(t,e,r,n,i){for(var o=t._root,a=o,s=o.expired,u=N(),c=t._path,l=o.cache,h=c.length?O(t,c).value:l,p=h[T]||l,f=l[P],d=[],m=[],g=[],y=c.length,v=-1,_=e.length;++v<_;){var b=e[v],x=b.path,w=b.value,S=c.slice(0);S.index=y,M(w,x,0,l,p,h,m,g,d,S,u,s,a,i,n)}var E=l[P],C=o.onChange;return A(C)&&f!==E&&C(),[m,g]}},{102:102,104:104,120:120,13:13,143:143,33:33,36:36,39:39,42:42,43:43,44:44,46:46,50:50,86:86,92:92,95:95,96:96}],79:[function(t,e,r){var s=t(130),u=t(64),c=t(101);e.exports=function(t,e){for(var r=c(t)?t:s.pathValue(t,e),n=0,o=r.path,i=o.length;++n<i;)if("object"==typeof o[n])return new u(function(t){t.onError(new Error("Paths must be simple paths"))});var a=this;return new u(function(i){return a._set(r).subscribe(function(t){for(var e=t.json,r=-1,n=o.length;e&&++r<n;)e=e[o[r]];i.onNext(e)},function(t){i.onError(t)},function(){i.onCompleted()})})}},{101:101,130:130,64:64}],80:[function(t,e,r){var u=t(134),c=t(101),l=t(78);e.exports=function(t,e,r,n){var i=u.fromPath(t),o=e,a=r,s=n;if(o=c(i)?(s=a,a=o,i):{path:i,value:o},!1===c(o))throw new Error("Model#setValueSync must be called with an Array path.");return"function"!=typeof a&&(a=this._root._errorSelector),"function"!=typeof s&&(s=this._root._comparator),this._syncCheck("setValueSync")?(l(this,[o]),this._getValueSync(this,o.path).value):void 0}},{101:101,134:134,78:78}],81:[function(t,e,r){e.exports=function(t){if(!t)return t;for(var e=-1,r=t.length,n=[];++e<r;)n[e]=t[e];return n}},{}],82:[function(t,e,r){e.exports=function(t,e){for(var r=-1,n=-1,i=t.length,o=[];++n<i;)for(var a=e(t[n],n,t),s=-1,u=a.length;++s<u;)o[++r]=a[s];return o}},{}],83:[function(t,e,r){e.exports=function(t,e){for(var r=-1,n=t.length,i=new Array(n);++r<n;)i[r]=e(t[r],r,t);return i}},{}],84:[function(t,e,r){e.exports=function(t,e,r){var n=e||0,i=-1,o=t.length-n;o<0&&(o=0),0<r&&r<o&&(o=r);for(var a=new Array(o);++i<o;)a[i]=t[i+n];return a}},{}],85:[function(t,e,r){var i=t(40),o=t(91),a=Array.isArray,s=t(100);e.exports=function(t){var e=t;if(s(e)){e=a(t)?[]:{};var r=t;for(var n in r)n[0]!==i&&o(r,n)&&(e[n]=r[n])}return e}},{100:100,40:40,91:91}],86:[function(t,e,r){var n=t(51),i=t(35);e.exports=function(t,e,r){return t[i]||(t[i]=!0,e.push(t),n(r,t)),t}},{35:35,51:51}],87:[function(t,e,r){var n=t(100);e.exports=function(t){return n(t)&&t.$expires||void 0}},{100:100}],88:[function(t,e,r){var n=t(100);e.exports=function(t){return n(t)&&t.$size||0}},{100:100}],89:[function(t,e,r){var n=t(100);e.exports=function(t){return n(t)&&t.$timestamp||void 0}},{100:100}],90:[function(t,e,r){var n=t(100);e.exports=function(t,e){var r=n(t)&&t.$type||void 0;return e&&r?"branch":r}},{100:100}],91:[function(t,e,r){var n=t(100),i=Object.prototype.hasOwnProperty;e.exports=function(t,e){return n(t)&&i.call(t,e)}},{100:100}],92:[function(t,e,r){var n=1;e.exports=function(){return n++}},{}],93:[function(t,e,r){var i=t(36),o=t(39),a=t(46);e.exports=function(t,e,r,n){return t[i]=r,t[o]=e,t[a]=n,e[r]=t}},{36:36,39:39,46:46}],94:[function(t,e,r){var n=t(106),i=t(122),o=t(121);e.exports=function(t){var e=t.$expires;return null!=e&&e!==o&&e!==i&&e<n()}},{106:106,121:121,122:122}],95:[function(t,e,r){var n=t(106),i=t(122),o=t(121);e.exports=function(t){var e=t.$expires;return null!=e&&e!==o&&(e===i||e<n())}},{106:106,121:121,122:122}],96:[function(t,e,r){e.exports=function(t){return Boolean(t)&&"function"==typeof t}},{}],97:[function(t,e,r){var n=t(40);e.exports=function(t){return"$size"===t||t&&t.charAt(0)===n}},{40:40}],98:[function(t,e,r){var n=t(100);e.exports=function(t){return n(t)&&"json"in t}},{100:100}],99:[function(t,e,r){var n=Array.isArray,i=t(100);e.exports=function(t){return i(t)&&n(t.paths)&&(i(t.jsonGraph)||i(t.jsong)||i(t.json)||i(t.values)||i(t.value))}},{100:100}],100:[function(t,e,r){e.exports=function(t){return null!==t&&"object"==typeof t}},{}],101:[function(t,e,r){var n=Array.isArray,i=t(100);e.exports=function(t){return i(t)&&(n(t.path)||"string"==typeof t.path)}},{100:100}],102:[function(t,e,r){e.exports=function(t){return null==t||"object"!=typeof t}},{}],103:[function(t,e,r){var _=t(36),b=t(39),x=t(120),w=t(119),S=t(88),E=t(89),C=t(100),M=t(95),T=t(96),P=t(50),O=t(117),A=t(93),I=t(86),L=t(110),R=t(115),N=t(107);e.exports=function(t,e,r,n,i,o,a,s,u,c,l){var h,p,f,d,m,g,y;if(e===r){if(null===r)return e=O(r,void 0,r),t=R(t,-e.$size,u,a),e=A(e,t,n),P(u,e),e;if(void 0===r)return r;if((d=C(e))&&null==(p=e.$type))return null==e[b]&&(e[_]=n,e[b]=t),e}else(d=C(e))&&(p=e.$type);if(p!==x){if((m=C(r))&&(f=r.$type),d&&!p&&(null==r||m&&!f))return e}else{if(null==r)return M(e)?void I(e,s,u):e;if((m=C(r))&&(f=r.$type)===x)if(e===r){if(null!=e[b])return e}else if(g=e.$timestamp,y=r.$timestamp,!M(e)&&!M(r)&&y<g)return}if(p&&m&&!f)return A(L(e,r,t,n,u),t,n);if(f||!m){if(f===w&&T(l)&&(r=l(N(i,n),r)),f&&e===r)null==e[b]&&(e=O(e,p,e.value),t=R(t,-e.$size,u,a),e=A(e,t,n,a));else{var v=!0;!p&&d||(v=E(r)<E(e)==0,(p||f)&&T(c)&&(v=!c(e,r,o.slice(0,o.index)))),v&&(r=O(r,f,f?r.value:r),h=S(e)-S(r),e=L(e,r,t,n,u),t=R(t,h,u,a),e=A(e,t,n,a))}M(e)?I(e,s,u):P(u,e)}else null==e&&(e=A(r,t,n));return e}},{100:100,107:107,110:110,115:115,117:117,119:119,120:120,36:36,39:39,50:50,86:86,88:88,89:89,93:93,95:95,96:96}],104:[function(t,e,r){var v=t(120),_=t(119),b=t(90),x=t(88),w=t(89),S=t(95),E=t(102),C=t(96),M=t(117),T=t(86),P=t(93),O=t(110),A=t(115),I=t(114),L=t(107);e.exports=function(t,e,r,n,i,o,a,s,u,c,l,h,p){var f=b(e,o);if(i||o)f&&S(e)&&(f="expired",T(e,c,l)),(f&&f!==v||E(e))&&(e=O(e,{},t,r,l),e=P(e,t,r,u),e=I(e,u));else{var d=n,m=b(d),g=w(d)<w(e)==0;if((f||m)&&C(h)&&(g=!h(e,d,s.slice(0,s.index))),g){m===_&&C(p)&&(d=p(L(a,r),d)),d=M(d,m,m?d.value:d);var y=x(e)-x(d);e=O(e,d,t,r,l),t=A(t,y,l,u),e=P(e,t,r,u)}}return e}},{102:102,107:107,110:110,114:114,115:115,117:117,119:119,120:120,86:86,88:88,89:89,90:90,93:93,95:95,96:96}],105:[function(t,e,r){e.exports=function(){}},{}],106:[function(t,e,r){e.exports=Date.now},{}],107:[function(t,e,r){e.exports=function(t,e){var r=t.slice(0,t.depth);return r[r.length]=e,r}},{}],108:[function(t,e,r){var o=t(120),a=t(39),s=t(51),u=t(100),c=t(112),l=t(113);e.exports=function(t,e,r,n){if(u(t)){var i=t.$type;return Boolean(i)&&(i===o&&l(t),s(n,t)),c(t),e[r]=t[a]=void 0,!0}return!1}},{100:100,112:112,113:113,120:120,39:39,51:51}],109:[function(t,e,r){var a=t(91),s=t(40),u=t(108);e.exports=function t(e,r,n,i){if(u(e,r,n,i)){if(null==e.$type)for(var o in e)o[0]!==s&&"$"!==o[0]&&a(e,o)&&t(e[o],e,o,i);return!0}return!1}},{108:108,40:40,91:91}],110:[function(t,e,r){var o=t(100),a=t(111),s=t(109);e.exports=function(t,e,r,n,i){return t===e?t:(o(t)&&(a(t,e),s(t,r,n,i)),r[n]=e)}},{100:100,109:109,111:111}],111:[function(t,e,r){var a=t(43),s=t(33),u=t(44);e.exports=function(t,e){for(var r=t[u]||0,n=e[u]||0,i=-1;++i<r;){var o=t[a+i];void 0!==o&&((o[s]=e)[a+(n+i)]=o,t[a+i]=void 0)}return e[u]=r+n,t[u]=void 0,e}},{33:33,43:43,44:44}],112:[function(t,e,r){var i=t(43),o=t(33),a=t(42),s=t(44);e.exports=function(t){for(var e=-1,r=t[s]||0;++e<r;){var n=t[i+e];null!=n&&(n[o]=n[a]=t[i+e]=void 0)}return t[s]=void 0,t}},{33:33,42:42,43:43,44:44}],113:[function(t,e,r){var i=t(43),o=t(33),a=t(42),s=t(44);e.exports=function(t){var e=t[o];if(e){for(var r=(t[a]||0)-1,n=(e[s]||0)-1;++r<=n;)e[i+r]=e[i+(r+1)];e[s]=n,t[a]=t[o]=e=void 0}return t}},{33:33,42:42,43:43,44:44}],114:[function(t,e,r){var s=t(43),u=t(39),c=t(46),l=t(44);e.exports=function(t,e){var r=[t],n=0;do{var i=r[n--];if(i&&i[c]!==e){i[c]=e,r[n++]=i[u];for(var o=-1,a=i[l]||0;++o<a;)r[n++]=i[s+o]}}while(-1<n);return t}},{39:39,43:43,44:44,46:46}],115:[function(t,e,r){var a=t(36),s=t(46),u=t(39),c=t(108),l=t(114);e.exports=function(t,e,r,n){var i=t;do{var o=i[u];(i.$size=(i.$size||0)-e)<=0&&null!=o?c(i,o,i[a],r):i[s]!==n&&l(i,n),i=o}while(i);return t}},{108:108,114:114,36:36,39:39,46:46}],116:[function(t,e,r){var s=Array.isArray,u=t(101),c=t(99),l=t(98),h=t(134);e.exports=function(t,e,r){for(var n=0,i=t.length;n<i;++n){var o=t[n],a=!1;if(s(o)&&e.path?a=!0:"string"==typeof o&&e.pathSyntax?a=!0:u(o)&&e.pathValue?(o.path=h.fromPath(o.path),a=!0):c(o)&&e.jsonGraph?a=!0:l(o)&&e.json?a=!0:"function"==typeof o&&n+1===i&&e.selector&&(a=!0),!a)return new Error("Unrecognized argument "+typeof o+" ["+String(o)+"] to Model#"+r)}return!0}},{101:101,134:134,98:98,99:99}],117:[function(t,e,r){var s=t(130).atom,u=t(106),c=t(122),l=t(37),h=t(85),p=Array.isArray,f=t(88),d=t(87);e.exports=function(t,e,r){var n=0,i=t,o=e;if(o?(i=h(i),n=f(i),i.$type=o):(o=(i=s(r)).$type,i[l]=!0),null==r)n=51;else if(null==n||n<=0)switch(typeof r){case"object":n=p(r)?50+r.length:51;break;case"string":n=50+r.length;break;default:n=51}var a=d(i);return"number"==typeof a&&a<c&&(i.$expires=u()+-1*a),i.$size=n,i}},{106:106,122:122,130:130,37:37,85:85,87:87,88:88}],118:[function(t,e,r){e.exports="atom"},{}],119:[function(t,e,r){e.exports="error"},{}],120:[function(t,e,r){e.exports="ref"},{}],121:[function(t,e,r){e.exports=1},{}],122:[function(t,e,r){e.exports=0},{}],123:[function(t,e,r){"use strict";function n(t){var e;(e=a.length?a.pop():new i).task=t,o(e)}function i(){this.task=null}var o=t(124),a=[],s=[],u=o.makeRequestCallFromTimer(function(){if(s.length)throw s.shift()});e.exports=n,i.prototype.call=function(){try{this.task.call()}catch(t){n.onerror?n.onerror(t):(s.push(t),u())}finally{this.task=null,a[a.length]=this}}},{124:124}],124:[function(t,h,e){(function(t){"use strict";function e(t){u.length||(i(),!0),u[u.length]=t}function r(){for(;c<u.length;){var t=c;if(c+=1,u[t].call(),1024<c){for(var e=0,r=u.length-c;e<r;e++)u[e]=u[e+c];u.length-=c,c=0}}u.length=0,c=0,!1}function n(n){return function(){function t(){clearTimeout(e),clearInterval(r),n()}var e=setTimeout(t,0),r=setInterval(t,50)}}h.exports=e;var i,o,a,s,u=[],c=0,l=t.MutationObserver||t.WebKitMutationObserver;i="function"==typeof l?(o=1,a=new l(r),s=document.createTextNode(""),a.observe(s,{characterData:!0}),function(){o=-o,s.data=o}):n(r),e.requestFlush=i,e.makeRequestCallFromTimer=n}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],125:[function(t,e,r){"use strict";function a(t,e){var r;for(r in e)t[r]=e[r];return t}function n(t,e){this._jsongUrl=t,"number"==typeof e&&(e={timeout:e});this._config=a({timeout:15e3,headers:{}},e||{})}var s=t(129),i=t(126);Array.isArray,n.prototype={constructor:n,buildQueryObject:i,get:function(t){var e=a(this.buildQueryObject(this._jsongUrl,"GET",{paths:t,method:"get"}),this._config);return s("GET",e,this)},set:function(t){var e=a(this.buildQueryObject(this._jsongUrl,"POST",{jsonGraph:t,method:"set"}),this._config);e.headers["Content-Type"]="application/x-www-form-urlencoded";return s("POST",e,this)},call:function(t,e,r,n){e=e||[],r=r||[],n=n||[];var i=[];i.push("method=call"),i.push("callPath="+encodeURIComponent(JSON.stringify(t))),i.push("arguments="+encodeURIComponent(JSON.stringify(e))),i.push("pathSuffixes="+encodeURIComponent(JSON.stringify(r))),i.push("paths="+encodeURIComponent(JSON.stringify(n)));var o=a(this.buildQueryObject(this._jsongUrl,"POST",i.join("&")),this._config);o.headers["Content-Type"]="application/x-www-form-urlencoded";return s("POST",o,this)}},(n.XMLHttpSource=n).default=n,e.exports=n},{126:126,129:129}],126:[function(t,e,r){"use strict";e.exports=function(t,e,r){var n=[],i={url:t},o=-1!==t.indexOf("?")?"&":"?";return"string"==typeof r?n.push(r):Object.keys(r).forEach(function(t){var e="object"==typeof r[t]?JSON.stringify(r[t]):r[t];n.push(t+"="+encodeURIComponent(e))}),"GET"===e?i.url+=o+n.join("&"):i.data=n.join("&"),i}},{}],127:[function(t,r,e){(function(e){"use strict";r.exports=function(){var t=new e.XMLHttpRequest;if("withCredentials"in t)return t;if(e.XDomainRequest)return new XDomainRequest;throw new Error("CORS is not supported by your browser")}}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],128:[function(t,e,r){(function(n){"use strict";e.exports=function(){var t,e,r;if(n.XMLHttpRequest)return new n.XMLHttpRequest;try{for(e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=0;r<3;r++)try{if(t=e[r],new n.ActiveXObject(t))break}catch(t){}return new n.ActiveXObject(t)}catch(t){throw new Error("XMLHttpRequest is not supported by your browser")}}}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],129:[function(t,e,r){"use strict";function n(){}function l(t,e,r){r=r||new Error(e),t.onError(r)}function o(){}var h=t(128),p=t(127),f=Object.prototype.hasOwnProperty;n.create=function(i){var t=new n;return t.subscribe=function(t,e,r){var n;return"function"==typeof(n=i("function"==typeof t?{onNext:t,onError:e||o,onCompleted:r||o}:t))?{dispose:n}:n},t},e.exports=function(s,u,c){return n.create(function(e){var r,n,t,i,o,a={method:s||"GET",crossDomain:!1,async:!0,headers:{},responseType:"json"};for(o in u)f.call(u,o)&&(a[o]=u[o]);a.crossDomain||a.headers["X-Requested-With"]||(a.headers["X-Requested-With"]="XMLHttpRequest"),null!=c.onBeforeRequest&&c.onBeforeRequest(a);try{r=a.crossDomain?p():h()}catch(t){e.onError(t)}try{for(i in a.user?r.open(a.method,a.url,a.async,a.user,a.password):r.open(a.method,a.url,a.async),r.timeout=a.timeout,r.withCredentials=!1!==a.withCredentials,t=a.headers)f.call(t,i)&&r.setRequestHeader(i,t[i]);if(a.responseType)try{r.responseType=a.responseType}catch(t){if("json"!==a.responseType)throw t}r.onreadystatechange=function(t){4===r.readyState&&(n||(n=!0,function(e,t){var r,n;if(t&&e){n=t.responseType,r="response"in t?t.response:t.responseText;var i=1223===t.status?204:t.status;if(200<=i&&i<=399){try{"json"!==n&&(r=JSON.parse(r||"")),"string"==typeof r&&(r=JSON.parse(r||""))}catch(t){l(e,"invalid json",t)}return e.onNext(r),e.onCompleted()}l(e,401===i||403===i||407===i?r:410===i?r:408===i||504===i?r:r||"Response code "+i)}}(e,r)))},r.ontimeout=function(t){n||(n=!0,function(t,e,r,n){l(t,r||e.statusText||"request error",n)}(e,r,"timeout error",t))},r.send(a.data)}catch(t){e.onError(t)}return function(){n||4===r.readyState||(n=!0,r.abort())}})}},{127:127,128:128}],130:[function(t,e,r){function n(t,e,r){var n=Object.create(null);if(null==r)return{$type:t,value:e};for(var i in r)n[i]=r[i];return n.$type=t,n.value=e,n}var i=t(134);e.exports={ref:function(t,e){return n("ref",i.fromPath(t),e)},atom:function(t,e){return n("atom",t,e)},undefined:function(){return n("atom")},error:function(t,e){return n("error",t,e)},pathValue:function(t,e){return{path:i.fromPath(t),value:e}},pathInvalidation:function(t){return{path:i.fromPath(t),invalidated:!0}}}},{134:134}],131:[function(t,e,r){e.exports={integers:"integers",ranges:"ranges",keys:"keys"}},{}],132:[function(t,e,r){e.exports={token:"token",dotSeparator:".",commaSeparator:",",openingBracket:"[",closingBracket:"]",openingBrace:"{",closingBrace:"}",escape:"\\",space:" ",colon:":",quote:"quote",unknown:"unknown"}},{}],133:[function(t,e,r){e.exports={indexer:{nested:"Indexers cannot be nested.",needQuotes:"unquoted indexers must be numeric.",empty:"cannot have empty indexers.",leadingDot:"Indexers cannot have leading dots.",leadingComma:"Indexers cannot have leading comma.",requiresComma:"Indexers require commas between indexer args.",routedTokens:"Only one token can be used per indexer when specifying routed tokens."},range:{precedingNaN:"ranges must be preceded by numbers.",suceedingNaN:"ranges must be suceeded by numbers."},routed:{invalid:"Invalid routed token.  only integers|ranges|keys are supported."},quote:{empty:"cannot have empty quoted keys.",illegalEscape:"Invalid escape character.  Only quotes are escapable."},unexpectedToken:"Unexpected token.",invalidIdentifier:"Invalid Identifier.",invalidPath:"Please provide a valid path.",throwError:function(t,e,r){if(r)throw t+" -- "+e.parseString+" with next token: "+r;throw t+" -- "+e.parseString}}},{}],134:[function(t,e,r){function o(t,e){return i(new n(t,e))}var n=t(140),i=t(135),a=t(131);(e.exports=o).fromPathsOrPathValues=function(t,e){if(!t)return[];for(var r=[],n=0,i=t.length;n<i;n++)"string"==typeof t[n]?r[n]=o(t[n],e):"string"==typeof t[n].path?r[n]={path:o(t[n].path,e),value:t[n].value}:r[n]=t[n];return r},o.fromPath=function(t,e){return t?"string"==typeof t?o(t,e):t:[]},o.RoutedTokens=a},{131:131,135:135,140:140}],135:[function(t,e,r){var o=t(132),a=t(133),s=t(136);e.exports=function(t){for(var e=t.next(),r={},n=[];!e.done;){switch(e.type){case o.token:var i=+e.token[0];isNaN(i)||a.throwError(a.invalidIdentifier,t),n[n.length]=e.token;break;case o.dotSeparator:0===n.length&&a.throwError(a.unexpectedToken,t);break;case o.space:break;case o.openingBracket:s(t,e,r,n);break;default:a.throwError(a.unexpectedToken,t)}e=t.next()}return 0===n.length&&a.throwError(a.invalidPath,t),n}},{132:132,133:133,136:136}],136:[function(t,e,r){var c=t(132),l=t(133),h=l.indexer,p=t(138),f=t(137),d=t(139);e.exports=function(t,e,r,n){var i=t.next(),o=!1,a=1,s=!1;for(r.indexer=[];!i.done;){switch(i.type){case c.token:case c.quote:r.indexer.length===a&&l.throwError(h.requiresComma,t)}switch(i.type){case c.openingBrace:s=!0,d(t,i,r,n);break;case c.token:var u=+i.token;isNaN(u)&&l.throwError(h.needQuotes,t),r.indexer[r.indexer.length]=u;break;case c.dotSeparator:r.indexer.length||l.throwError(h.leadingDot,t),p(t,i,r,n);break;case c.space:break;case c.closingBracket:o=!0;break;case c.quote:f(t,i,r,n);break;case c.openingBracket:l.throwError(h.nested,t);break;case c.commaSeparator:++a;break;default:l.throwError(l.unexpectedToken,t)}if(o)break;i=t.next()}0===r.indexer.length&&l.throwError(h.empty,t),1<r.indexer.length&&s&&l.throwError(h.routedTokens,t),1===r.indexer.length&&(r.indexer=r.indexer[0]),n[n.length]=r.indexer,r.indexer=void 0}},{132:132,133:133,137:137,138:138,139:139}],137:[function(t,e,r){var c=t(132),l=t(133),h=l.quote;e.exports=function(t,e,r,n){for(var i=t.next(),o="",a=e.token,s=!1,u=!1;!i.done;){switch(i.type){case c.token:case c.space:case c.dotSeparator:case c.commaSeparator:case c.openingBracket:case c.closingBracket:case c.openingBrace:case c.closingBrace:s&&l.throwError(h.illegalEscape,t),o+=i.token;break;case c.quote:s?(o+=i.token,s=!1):i.token!==a?o+=i.token:u=!0;break;case c.escape:s=!0;break;default:l.throwError(l.unexpectedToken,t)}if(u)break;i=t.next()}0===o.length&&l.throwError(h.empty,t),r.indexer[r.indexer.length]=o}},{132:132,133:133}],138:[function(t,e,r){var h=t(140),p=t(132),f=t(133);e.exports=function(t,e,r,n){var i,o=t.peek(),a=1,s=!1,u=!0,c=r.indexer.length-1,l=h.toNumber(r.indexer[c]);for(isNaN(l)&&f.throwError(f.range.precedingNaN,t);!s&&!o.done;){switch(o.type){case p.dotSeparator:3===a&&f.throwError(f.unexpectedToken,t),3===++a&&(u=!1);break;case p.token:i=h.toNumber(t.next().token),isNaN(i)&&f.throwError(f.range.suceedingNaN,t),s=!0;break;default:s=!0}if(s)break;t.next(),o=t.peek()}r.indexer[c]={from:l,to:u?i:i-1}}},{132:132,133:133,140:140}],139:[function(t,e,r){var c=t(132),l=t(131),h=t(133),p=h.routed;e.exports=function(t,e,r,n){var i=t.next(),o=!1,a="";switch(i.token){case l.integers:case l.ranges:case l.keys:break;default:h.throwError(p.invalid,t)}var s=t.next();if(s.type===c.colon&&(o=!0,(s=t.next()).type!==c.token&&h.throwError(p.invalid,t),a=s.token,s=t.next()),s.type===c.closingBrace){var u={type:i.token,named:o,name:a};r.indexer[r.indexer.length]=u}else h.throwError(p.invalid,t)}},{131:131,132:132,133:133}],140:[function(t,e,r){function c(t,e,r){return{token:t,done:r,type:e}}function n(t,e,r){var n,i=!1,o="",a=r?"\\{}'\"[]., :":"\\'\"[]., ";do{if(n=e+1>=t.length)break;var s=t[e+1];if(void 0===s||-1!==a.indexOf(s)){if(o.length)break;var u;switch(++e,s){case".":u=l.dotSeparator;break;case",":u=l.commaSeparator;break;case"[":u=l.openingBracket;break;case"]":u=l.closingBracket;break;case"{":u=l.openingBrace;break;case"}":u=l.closingBrace;break;case" ":u=l.space;break;case'"':case"'":u=l.quote;break;case"\\":u=l.escape;break;case":":u=l.colon;break;default:u=l.unknown}i=c(s,u,!1);break}o+=s,++e}while(!n);return!i&&o.length&&(i=c(o,l.token,!1)),{token:i=i||{done:!0},idx:e}}var l=t(132),i=e.exports=function(t,e){this._string=t,this._idx=-1,this._extended=e,this.parseString=""};i.prototype={next:function(){var t=this._nextToken?this._nextToken:n(this._string,this._idx,this._extended);return this._idx=t.idx,this._nextToken=!1,this.parseString+=t.token.token,t.token},peek:function(){var t=this._nextToken?this._nextToken:n(this._string,this._idx,this._extended);return(this._nextToken=t).token}},i.toNumber=function(t){return isNaN(+t)?NaN:+t}},{132:132}],141:[function(t,e,r){var n=t(147),i=t(148);e.exports=function(t){var e=t.reduce(function(t,e){var r=e.length;return t[r]||(t[r]=[]),t[r].push(e),t},{});return Object.keys(e).forEach(function(t){e[t]=i(e[t])}),n(e)}},{147:147,148:148}],142:[function(t,e,r){var h=t(144);e.exports=function t(e,r,n){for(var i=e,o=!0;o&&n<r.length;++n){var a=r[n];if(a&&"object"==typeof a){var s={},u=h(a,s),c=n+1;do{var l=i[u];o=(o=void 0!==l)&&t(l,r,c),u=h(a,s)}while(o&&!s.done);break}o=void 0!==(i=i[a])}return o}},{144:144}],143:[function(t,e,r){e.exports={iterateKeySet:t(144),toTree:t(148),toTreeWithUnion:t(149),pathsComplementFromTree:t(146),pathsComplementFromLengthTree:t(145),hasIntersection:t(142),toPaths:t(147),collapse:t(141)}},{141:141,142:142,144:144,145:145,146:146,147:147,148:148,149:149}],144:[function(t,e,r){function o(t,e){var r=e.from=t.from||0,n=e.to=t.to||"number"==typeof t.length&&e.from+t.length-1||0;e.rangeOffset=e.from,e.loaded=!0,n<r&&(e.empty=!0)}var a=Array.isArray;e.exports=function(t,e){if(void 0===e.isArray&&function(t,e){e.done=!1;var r=e.isObject=!(!t||"object"!=typeof t);e.isArray=r&&a(t),e.arrayOffset=0}(t,e),e.isArray){var r;do{e.loaded&&e.rangeOffset>e.to&&(++e.arrayOffset,e.loaded=!1);var n=e.arrayOffset;if(t.length<=n){e.done=!0;break}var i=t[e.arrayOffset];if("object"==typeof i){if(e.loaded||o(i,e),e.empty)continue;r=e.rangeOffset++}else++e.arrayOffset,r=i}while(void 0===r);return r}return e.isObject?(e.loaded||o(t,e),e.rangeOffset>e.to?void(e.done=!0):e.rangeOffset++):(e.done=!0,t)}},{}],145:[function(t,e,r){var s=t(142);e.exports=function(t,e){for(var r=[],n=-1,i=0,o=t.length;i<o;++i){var a=t[i];s(e[a.length],a,0)||(r[++n]=a)}return r}},{142:142}],146:[function(t,e,r){var a=t(142);e.exports=function(t,e){for(var r=[],n=-1,i=0,o=t.length;i<o;++i)a(e,t[i],0)||(r[++n]=t[i]);return r}},{142:142}],147:[function(t,e,r){function E(t,e,r){var n,i,o,a,s,u,c,l,h,p,f,d,m,g,y=M(String(e)),v=Object.create(null),_=[],b=-1,x=0,w=[],S=0;if(a=[],s=-1,e<r-1){for(u=C(t,a);++s<u;)i=v[o=(i=E(t[n=a[s]],e+1,r)).code]?v[o]:v[_[x++]=o]={keys:[],sets:i.sets},y=M(y+n+o),T(n)&&i.keys.push(parseInt(n,10))||i.keys.push(n);for(;++b<x;)if(0<(u=(a=(i=v[n=_[b]]).keys).length))for(l=-1,h=(c=i.sets).length,m=a[0];++l<h;){for(f=-1,d=(p=c[l]).length,(g=new Array(d+1))[0]=1<u&&a||m;++f<d;)g[f+1]=p[f];w[S++]=g}}else for(u=C(t,a),w[S++]=1<u?[a]:a;++s<u;)y=M(y+a[s]);return{code:y,sets:w}}function c(t){for(var e=-1,r=t.length;++e<r;){var n=t[e];o(n)&&(t[e]=i(n))}return t}function i(t){for(var e=-1,r=t.length-1,n=0<r;++e<=r;){var i=t[e];if(!T(i)){n=!1;break}t[e]=parseInt(i,10)}if(!0===n){t.sort(s);var o=t[0],a=t[r];if(a-o<=r)return{from:o,to:a}}return t}function s(t,e){return t-e}function C(t,e,r){var n=0;for(var i in t)e[n++]=i;return 1<n&&e.sort(r),n}function M(t){for(var e=5381,r=-1,n=t.length;++r<n;)e=(e<<5)+e+t.charCodeAt(r);return String(e)}function T(t){return!o(t)&&0<=t-parseFloat(t)+1}var o=Array.isArray,l="object";e.exports=function(t){var e,r,n=[],i=0;for(var o in t)if(T(o)&&(null!==(r=e=t[o])&&typeof r===l))for(var a=E(e,0,parseInt(o,10)).sets,s=-1,u=a.length;++s<u;)n[i++]=c(a[s]);return n}},{}],148:[function(t,e,r){var c=t(144);Array.isArray,e.exports=function(t){return t.reduce(function(t,e){return function t(e,r,n){var i,o=r[n],a={},s=n+1;i=c(o,a);do{var u=e[i];u||(s===r.length?e[i]=null:u=e[i]={}),s<r.length&&t(u,r,s),a.done||(i=c(o,a))}while(!a.done)}(t,e,0),t},{})}},{144:144}],149:[function(t,e,r){},{}],150:[function(t,e,r){function n(){l=!1,s.length?c=s.concat(c):h=-1,c.length&&i()}function i(){if(!l){var t=setTimeout(n);l=!0;for(var e=c.length;e;){for(s=c,c=[];++h<e;)s&&s[h].run();h=-1,e=c.length}s=null,l=!1,clearTimeout(t)}}function o(t,e){this.fun=t,this.array=e}function a(){}var s,u=e.exports={},c=[],l=!1,h=-1;u.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new o(t,e)),1!==c.length||l||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=a,u.addListener=a,u.once=a,u.off=a,u.removeListener=a,u.removeAllListeners=a,u.emit=a,u.binding=function(t){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(t){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],151:[function(t,e,r){"use strict";e.exports=t(156)},{156:156}],152:[function(t,e,r){"use strict";function a(){}function s(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._37=0,this._12=null,this._59=[],t!==a&&l(t,this)}function u(r,n){for(;3===r._37;)r=r._12;return 0===r._37?void r._59.push(n):void h(function(){var t=1===r._37?n.onFulfilled:n.onRejected;if(null!==t){var e=function(t,e){try{return t(e)}catch(t){return p=t,f}}(t,r._12);e===f?o(n.promise,p):i(n.promise,e)}else 1===r._37?i(n.promise,r._12):o(n.promise,r._12)})}function i(t,e){if(e===t)return o(t,new TypeError("A promise cannot be resolved with itself."));if(e&&("object"==typeof e||"function"==typeof e)){var r=function(t){try{return t.then}catch(t){return p=t,f}}(e);if(r===f)return o(t,p);if(r===t.then&&e instanceof s)return t._37=3,t._12=e,void n(t);if("function"==typeof r)return void l(r.bind(e),t)}t._37=1,t._12=e,n(t)}function o(t,e){t._37=2,t._12=e,n(t)}function n(t){for(var e=0;e<t._59.length;e++)u(t,t._59[e]);t._59=null}function c(t,e,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=r}function l(t,e){var r=!1,n=function(t,e,r){try{t(e,r)}catch(t){return p=t,f}}(t,function(t){r||(r=!0,i(e,t))},function(t){r||(r=!0,o(e,t))});r||n!==f||(r=!0,o(e,p))}var h=t(124),p=null,f={};(e.exports=s)._99=a,s.prototype.then=function(t,e){if(this.constructor!==s)return function(n,i,o){return new n.constructor(function(t,e){var r=new s(a);r.then(t,e),u(n,new c(i,o,r))})}(this,t,e);var r=new s(a);return u(this,new c(t,e,r)),r}},{124:124}],153:[function(t,e,r){"use strict";var n=t(152);(e.exports=n).prototype.done=function(t,e){(arguments.length?this.then.apply(this,arguments):this).then(null,function(t){setTimeout(function(){throw t},0)})}},{152:152}],154:[function(t,e,r){"use strict";function n(t){var e=new u(u._99);return e._37=1,e._12=t,e}var u=t(152);e.exports=u;var i=n(!0),o=n(!1),a=n(null),s=n(void 0),c=n(0),l=n("");u.resolve=function(t){if(t instanceof u)return t;if(null===t)return a;if(void 0===t)return s;if(!0===t)return i;if(!1===t)return o;if(0===t)return c;if(""===t)return l;if("object"==typeof t||"function"==typeof t)try{var e=t.then;if("function"==typeof e)return new u(e.bind(t))}catch(r){return new u(function(t,e){e(r)})}return n(t)},u.all=function(t){var s=Array.prototype.slice.call(t);return new u(function(n,i){function o(e,t){if(t&&("object"==typeof t||"function"==typeof t)){if(t instanceof u&&t.then===u.prototype.then){for(;3===t._37;)t=t._12;return 1===t._37?o(e,t._12):(2===t._37&&i(t._12),void t.then(function(t){o(e,t)},i))}var r=t.then;if("function"==typeof r)return void new u(r.bind(t)).then(function(t){o(e,t)},i)}s[e]=t,0==--a&&n(s)}if(0===s.length)return n([]);for(var a=s.length,t=0;t<s.length;t++)o(t,s[t])})},u.reject=function(r){return new u(function(t,e){e(r)})},u.race=function(t){return new u(function(e,r){t.forEach(function(t){u.resolve(t).then(e,r)})})},u.prototype.catch=function(t){return this.then(null,t)}},{152:152}],155:[function(t,e,r){"use strict";var n=t(152);(e.exports=n).prototype.finally=function(e){return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})})}},{152:152}],156:[function(t,e,r){"use strict";e.exports=t(152),t(153),t(155),t(154),t(157)},{152:152,153:153,154:154,155:155,157:157}],157:[function(t,e,r){"use strict";var a=t(152),i=t(123);(e.exports=a).denodeify=function(o,t){return t=t||1/0,function(){var e=this,i=Array.prototype.slice.call(arguments,0,0<t?t:0);return new a(function(r,n){i.push(function(t,e){t?n(t):r(e)});var t=o.apply(e,i);!t||"object"!=typeof t&&"function"!=typeof t||"function"!=typeof t.then||r(t)})}},a.nodeify=function(r){return function(){var t=Array.prototype.slice.call(arguments),e="function"==typeof t[t.length-1]?t.pop():null,n=this;try{return r.apply(this,arguments).nodeify(e,n)}catch(r){if(null==e)return new a(function(t,e){e(r)});i(function(){e.call(n,r)})}}},a.prototype.nodeify=function(e,r){return"function"!=typeof e?this:void this.then(function(t){i(function(){e.call(r,null,t)})},function(t){i(function(){e.call(r,t)})})}},{123:123,152:152}],158:[function(s,u,c){(function(a){(function(t){var e={boolean:!1,function:!0,object:!0,number:!1,string:!1,undefined:!1},r=e[typeof window]&&window||this,n=e[typeof c]&&c&&!c.nodeType&&c,i=e[typeof u]&&u&&!u.nodeType&&u,o=(i&&i.exports,e[typeof a]&&a);!o||o.global!==o&&o.window!==o||(r=o),"object"==typeof u&&u&&u.exports===n?u.exports=t(r,u.exports,s(159)):r.Rx=t(r,{},r.Rx)}).call(this,function(s,t,e,u){function r(){try{return f.apply(this,arguments)}catch(t){return k.e=t,k}}function n(t){if(!E(t))throw new TypeError("fn must be a function");return f=t,r}function i(t,s,u){return new y(function(n){var i=!1,o=null,a=[];return t.subscribe(function(t){var e,r;try{r=s(t)}catch(t){return void n.onError(t)}if(e=0,i)try{e=u(r,o)}catch(t){return void n.onError(t)}else i=!0,o=r;0<e&&(o=r,a=[]),0<=e&&a.push(t)},function(t){n.onError(t)},function(){n.onNext(a),n.onCompleted()})},t)}function o(t){if(0===t.length)throw new L;return t[0]}function a(t,n,i,o){if(n<0)throw new N;return new y(function(e){var r=n;return t.subscribe(function(t){0==r--&&(e.onNext(t),e.onCompleted())},function(t){e.onError(t)},function(){i?(e.onNext(o),e.onCompleted()):e.onError(new N)})},t)}function c(t,i,o){return new y(function(e){var r=o,n=!1;return t.subscribe(function(t){n?e.onError(new Error("Sequence contains more than one element")):(r=t,n=!0)},function(t){e.onError(t)},function(){n||i?(e.onNext(r),e.onCompleted()):e.onError(new L)})},t)}function l(t,r,n){return new y(function(e){return t.subscribe(function(t){e.onNext(t),e.onCompleted()},function(t){e.onError(t)},function(){r?(e.onNext(n),e.onCompleted()):e.onError(new L)})},t)}function h(t,i,o){return new y(function(e){var r=o,n=!1;return t.subscribe(function(t){r=t,n=!0},function(t){e.onError(t)},function(){n||i?(e.onNext(r),e.onCompleted()):e.onError(new L)})},t)}function p(i,t,e,o){var a=I(t,e,3);return new y(function(r){var n=0;return i.subscribe(function(t){var e;try{e=a(t,n,i)}catch(t){return void r.onError(t)}e?(r.onNext(o?n:t),r.onCompleted()):n++},function(t){r.onError(t)},function(){r.onNext(o?-1:u),r.onCompleted()})},i)}var f,d=e.Observable,m=d.prototype,g=e.CompositeDisposable,y=e.AnonymousObservable,v=e.Disposable.empty,_=(e.internals.isEqual,e.helpers),b=_.not,x=_.defaultComparer,w=_.identity,S=_.defaultSubComparer,E=_.isFunction,C=_.isPromise,M=_.isArrayLike,T=_.isIterable,P=e.internals.inherits,O=d.fromPromise,A=d.from,I=e.internals.bindCallback,L=e.EmptyError,R=e.ObservableBase,N=e.ArgumentOutOfRangeError,k={e:{}};m.aggregate=function(){var o,a,s=!1,t=this;return o=2===arguments.length?(s=!0,a=arguments[0],arguments[1]):arguments[0],new y(function(e){var r,n,i;return t.subscribe(function(t){i=i||!0;try{r?n=o(n,t):(n=s?o(a,t):t,r=!0)}catch(t){return e.onError(t)}},function(t){e.onError(t)},function(){i&&e.onNext(n),!i&&s&&e.onNext(a),i||s||e.onError(new L),e.onCompleted()})},t)};var D,j=(P(z,D=R),z.prototype.subscribeCore=function(t){return this.source.subscribe(new F(t,this))},F.prototype.onNext=function(t){this.isStopped||(this.hasValue||(this.hasValue=!0),this.hasAccumulation?this.result=n(this.acc)(this.result,t):(this.result=this.hasSeed?n(this.acc)(this.seed,t):t,this.hasAccumulation=!0),this.result===k&&this.o.onError(this.result.e))},F.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},F.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.hasValue&&this.o.onNext(this.result),!this.hasValue&&this.hasSeed&&this.o.onNext(this.seed),this.hasValue||this.hasSeed||this.o.onError(new L),this.o.onCompleted())},F.prototype.dispose=function(){this.isStopped=!0},F.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.o.onError(t),!0)},z);function z(t,e,r,n){this.source=t,this.acc=e,this.hasSeed=r,this.seed=n,D.call(this)}function F(t,e){this.o=t,this.acc=e.acc,this.hasSeed=e.hasSeed,this.seed=e.seed,this.hasAccumulation=!1,this.result=null,this.hasValue=!1,this.isStopped=!1}return m.reduce=function(t){var e=!1;if(2===arguments.length){e=!0;var r=arguments[1]}return new j(this,t,e,r)},m.some=function(t,e){var r=this;return t?r.filter(t,e).some():new y(function(e){return r.subscribe(function(){e.onNext(!0),e.onCompleted()},function(t){e.onError(t)},function(){e.onNext(!1),e.onCompleted()})},r)},m.any=function(){return this.some.apply(this,arguments)},m.isEmpty=function(){return this.any().map(b)},m.every=function(e,t){return this.filter(function(t){return!e(t)},t).some().map(b)},m.all=function(){return this.every.apply(this,arguments)},m.includes=function(i,t){var o=this;return new y(function(e){var r=0,n=+t||0;return Math.abs(n)===1/0&&(n=0),n<0?(e.onNext(!1),e.onCompleted(),v):o.subscribe(function(t){r++>=n&&function(t,e){return 0===t&&0===e||t===e||isNaN(t)&&isNaN(e)}(t,i)&&(e.onNext(!0),e.onCompleted())},function(t){e.onError(t)},function(){e.onNext(!1),e.onCompleted()})},this)},m.contains=function(t,e){m.includes(t,e)},m.count=function(t,e){return t?this.filter(t,e).count():this.reduce(function(t){return t+1},0)},m.indexOf=function(i,t){var o=this;return new y(function(e){var r=0,n=+t||0;return Math.abs(n)===1/0&&(n=0),n<0?(e.onNext(-1),e.onCompleted(),v):o.subscribe(function(t){n<=r&&t===i&&(e.onNext(r),e.onCompleted()),r++},function(t){e.onError(t)},function(){e.onNext(-1),e.onCompleted()})},o)},m.sum=function(t,e){return t&&E(t)?this.map(t,e).sum():this.reduce(function(t,e){return t+e},0)},m.minBy=function(t,r){return r=r||S,i(this,t,function(t,e){return-1*r(t,e)})},m.min=function(t){return this.minBy(w,t).map(function(t){return o(t)})},m.maxBy=function(t,e){return i(this,t,e=e||S)},m.max=function(t){return this.maxBy(w,t).map(function(t){return o(t)})},m.average=function(t,e){return t&&E(t)?this.map(t,e).average():this.reduce(function(t,e){return{sum:t.sum+e,count:t.count+1}},{sum:0,count:0}).map(function(t){if(0===t.count)throw new L;return t.sum/t.count})},m.sequenceEqual=function(r,u){var c=this;return u=u||x,new y(function(n){var i=!1,o=!1,a=[],s=[],t=c.subscribe(function(t){var e,r;if(0<s.length){r=s.shift();try{e=u(r,t)}catch(t){return void n.onError(t)}e||(n.onNext(!1),n.onCompleted())}else o?(n.onNext(!1),n.onCompleted()):a.push(t)},function(t){n.onError(t)},function(){i=!0,0===a.length&&(0<s.length?(n.onNext(!1),n.onCompleted()):o&&(n.onNext(!0),n.onCompleted()))});(M(r)||T(r))&&(r=A(r)),C(r)&&(r=O(r));var e=r.subscribe(function(t){var e;if(0<a.length){var r=a.shift();try{e=u(r,t)}catch(t){return void n.onError(t)}e||(n.onNext(!1),n.onCompleted())}else i?(n.onNext(!1),n.onCompleted()):s.push(t)},function(t){n.onError(t)},function(){o=!0,0===s.length&&(0<a.length?(n.onNext(!1),n.onCompleted()):i&&(n.onNext(!0),n.onCompleted()))});return new g(t,e)},c)},m.elementAt=function(t){return a(this,t,!1)},m.elementAtOrDefault=function(t,e){return a(this,t,!0,e)},m.single=function(t,e){return t&&E(t)?this.where(t,e).single():c(this,!1)},m.singleOrDefault=function(t,e,r){return t&&E(t)?this.filter(t,r).singleOrDefault(null,e):c(this,!0,e)},m.first=function(t,e){return t?this.where(t,e).first():l(this,!1)},m.firstOrDefault=function(t,e,r){return t?this.where(t).firstOrDefault(null,e):l(this,!0,e)},m.last=function(t,e){return t?this.where(t,e).last():h(this,!1)},m.lastOrDefault=function(t,e,r){return t?this.where(t,r).lastOrDefault(null,e):h(this,!0,e)},m.find=function(t,e){return p(this,t,e,!1)},m.findIndex=function(t,e){return p(this,t,e,!0)},m.toSet=function(){if(void 0===s.Set)throw new TypeError;var t=this;return new y(function(e){var r=new s.Set;return t.subscribe(function(t){r.add(t)},function(t){e.onError(t)},function(){e.onNext(r),e.onCompleted()})},t)},m.toMap=function(o,a){if(void 0===s.Map)throw new TypeError;var t=this;return new y(function(n){var i=new s.Map;return t.subscribe(function(t){var e;try{e=o(t)}catch(t){return void n.onError(t)}var r=t;if(a)try{r=a(t)}catch(t){return void n.onError(t)}i.set(e,r)},function(t){n.onError(t)},function(){n.onNext(i),n.onCompleted()})},t)},e})}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{159:159}],159:[function(t,Bi,Ui){(function(zi,Fi){(function(u){function i(t){for(var e=[],r=0,n=t.length;r<n;r++)e.push(t[r]);return e}function o(t,e){if(X&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(K)){for(var r=[],n=e;n;n=n.source)n.stack&&r.unshift(n.stack);r.unshift(t.stack);var i=r.join("\n"+K+"\n");t.stack=function(t){for(var e=t.split("\n"),r=[],n=0,i=e.length;n<i;n++){var o=e[n];c(o)||(-1!==(a=o).indexOf("(module.js:")||-1!==a.indexOf("(node.js:"))||!o||r.push(o)}var a;return r.join("\n")}(i)}}function c(t){var e=a(t);if(!e)return!1;var r=e[0],n=e[1];return r===Y&&Z<=n&&n<=ji}function t(){if(X)try{throw new Error}catch(t){var e=t.stack.split("\n"),r=a(0<e[0].indexOf("@")?e[1]:e[2]);if(!r)return;return Y=r[0],r[1]}}function a(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var r=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(r)return[r[1],Number(r[2])];var n=/.*@(.+):(\d+)$/.exec(t);return n?[n[1],Number(n[2])]:void 0}function r(t){var e=[];if(!Ot(t))return e;Pt.nonEnumArgs&&t.length&&At(t)&&(t=Rt.call(t));var r=Pt.enumPrototypes&&"function"==typeof t,n=Pt.enumErrorProps&&(t===St||t instanceof Error);for(var i in t)r&&"prototype"==i||n&&("message"==i||"name"==i)||e.push(i);if(Pt.nonEnumShadows&&t!==Et){var o=t.constructor,a=-1,s=lt;if(t===(o&&o.prototype))var u=t===Ct?_t:t===St?mt:bt.call(t),c=Tt[u];for(;++a<s;)i=ct[a],c&&c[i]||!xt.call(t,i)||e.push(i)}return e}function g(t,e){return function(t,e,r){for(var n=-1,i=r(t),o=i.length;++n<o;){var a=i[n];if(!1===e(t[a],a,t))break}return t}(t,e,r)}function y(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function p(t,e){for(var r=new Array(t),n=0;n<t;n++)r[n]=e();return r}function e(){try{return It.apply(this,arguments)}catch(t){return jt.e=t,jt}}function h(t){if(!W(t))throw new TypeError("fn must be a function");return It=t,e}function l(t){throw t}function n(t,e){this.id=t,this.value=e}function f(t,e){this.scheduler=t,this.disposable=e,this.isDisposed=!1}function d(t,e){e.isDisposed||(e.isDisposed=!0,e.disposable.dispose())}function m(t){this._s=s}function v(t){this._s=s,this._l=s.length,this._i=0}function _(t){this._a=t}function b(t){this._a=t,this._l=function(t){var e=+t.length;return isNaN(e)?0:0!==e&&function(t){return"number"==typeof t&&R.isFinite(t)}(e)?(e=function(t){var e=+t;return 0==e?e:isNaN(e)?e:e<0?-1:1}(e)*Math.floor(Math.abs(e)))<=0?0:jr<e?jr:e:e}(t),this._i=0}function x(t,e){this.observer=t,this.parent=e}function w(t,e){return ne(t)||(t=pe),new Hr(e,t)}function S(t,e){this.observer=t,this.parent=e}function E(t,e){this.observer=t,this.parent=e}function C(){return!1}function C(){return!1}function M(){return[]}function C(){return!1}function T(){return[]}function P(t,e){this.observer=t,this.accumulator=e.accumulator,this.hasSeed=e.hasSeed,this.seed=e.seed,this.hasAccumulation=!1,this.accumulation=null,this.hasValue=!1,this.isStopped=!1}function O(n,t,e){var i=ut(t,e,3);return n.map(function(t,e){var r=i(t,e,n);return $(r)&&(r=Cr(r)),(st(r)||at(r))&&(r=qr(r)),r}).concatAll()}function A(t){this.comparer=t,this.set=[]}function I(n,t,e){var i=ut(t,e,3);return n.map(function(t,e){var r=i(t,e,n);return $(r)&&(r=Cr(r)),(st(r)||at(r))&&(r=qr(r)),r}).mergeAll()}var L={boolean:!1,function:!0,object:!0,number:!1,string:!1,undefined:!1},R=L[typeof window]&&window||this,N=L[typeof Ui]&&Ui&&!Ui.nodeType&&Ui,k=L[typeof Bi]&&Bi&&!Bi.nodeType&&Bi,D=k&&k.exports===N&&N,j=L[typeof Fi]&&Fi;!j||j.global!==j&&j.window!==j||(R=j);var z,F={internals:{},config:{Promise:R.Promise},helpers:{}},B=F.helpers.noop=function(){},U=(F.helpers.notDefined=function(t){return void 0===t},F.helpers.identity=function(t){return t}),V=(F.helpers.pluck=function(e){return function(t){return t[e]}},F.helpers.just=function(t){return function(){return t}},F.helpers.defaultNow=Date.now),G=F.helpers.defaultComparer=function(t,e){return Lt(t,e)},q=F.helpers.defaultSubComparer=function(t,e){return e<t?1:t<e?-1:0},H=(F.helpers.defaultKeySerializer=function(t){return t.toString()},F.helpers.defaultError=function(t){throw t}),$=F.helpers.isPromise=function(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then},W=(F.helpers.asArray=function(){return Array.prototype.slice.call(arguments)},F.helpers.not=function(t){return!t},F.helpers.isFunction=((z=function(t){return"function"==typeof t||!1})(/x/)&&(z=function(t){return"function"==typeof t&&"[object Function]"==bt.call(t)}),z)),X=F.config.longStackSupport=!1;try{throw new Error}catch(t){X=!!t.stack}var Y,Z=t(),K="From previous event:";(F.EmptyError=function(){this.message="Sequence contains no elements.",Error.call(this)}).prototype=Error.prototype;var J=F.ObjectDisposedError=function(){this.message="Object has been disposed",Error.call(this)};J.prototype=Error.prototype;var Q=F.ArgumentOutOfRangeError=function(){this.message="Argument out of range",Error.call(this)};Q.prototype=Error.prototype;var tt=F.NotSupportedError=function(t){this.message=t||"This operation is not supported",Error.call(this)};tt.prototype=Error.prototype;var et=F.NotImplementedError=function(t){this.message=t||"This operation is not implemented",Error.call(this)};et.prototype=Error.prototype;var rt=F.helpers.notImplemented=function(){throw new et},nt=F.helpers.notSupported=function(){throw new tt},it="function"==typeof Symbol&&Symbol.iterator||"_es6shim_iterator_";R.Set&&"function"==typeof(new R.Set)["@@iterator"]&&(it="@@iterator");var ot=F.doneEnumerator={done:!0,value:u},at=F.helpers.isIterable=function(t){return t[it]!==u},st=F.helpers.isArrayLike=function(t){return t&&t.length!==u};F.helpers.iterator=it;var ut=F.internals.bindCallback=function(n,i,t){if(void 0===i)return n;switch(t){case 0:return function(){return n.call(i)};case 1:return function(t){return n.call(i,t)};case 2:return function(t,e){return n.call(i,t,e)};case 3:return function(t,e,r){return n.call(i,t,e,r)}}return function(){return n.apply(i,arguments)}},ct=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],lt=ct.length,ht="[object Arguments]",pt="[object Array]",ft="[object Boolean]",dt="[object Date]",mt="[object Error]",gt="[object Number]",yt="[object Object]",vt="[object RegExp]",_t="[object String]",bt=Object.prototype.toString,xt=Object.prototype.hasOwnProperty,wt=bt.call(arguments)==ht,St=Error.prototype,Et=Object.prototype,Ct=String.prototype,Mt=Et.propertyIsEnumerable;try{!(bt.call(document)==yt&&!({toString:0}+""))}catch(t){!0}var Tt={};Tt[pt]=Tt[dt]=Tt[gt]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Tt[ft]=Tt[_t]={constructor:!0,toString:!0,valueOf:!0},Tt[mt]=Tt["[object Function]"]=Tt[vt]={constructor:!0,toString:!0},Tt[yt]={constructor:!0};var Pt={};!function(){function t(){this.x=1}var e=[];for(var r in t.prototype={valueOf:1,y:1},new t)e.push(r);for(r in arguments);Pt.enumErrorProps=Mt.call(St,"message")||Mt.call(St,"name"),Pt.enumPrototypes=Mt.call(t,"prototype"),Pt.nonEnumArgs=0!=r,Pt.nonEnumShadows=!/valueOf/.test(e)}(1);var Ot=F.internals.isObject=function(t){var e=typeof t;return t&&("function"==e||"object"==e)||!1},At=function(t){return!(!t||"object"!=typeof t)&&bt.call(t)==ht};wt||(At=function(t){return!(!t||"object"!=typeof t)&&xt.call(t,"callee")});var It,Lt=F.internals.isEqual=function(t,e){return function n(i,t,o,a){if(i===t)return 0!==i||1/i==1/t;var e=typeof i,r=typeof t;if(i==i&&(null==i||null==t||"function"!=e&&"object"!=e&&"function"!=r&&"object"!=r))return!1;var s=bt.call(i),u=bt.call(t);if(s==ht&&(s=yt),u==ht&&(u=yt),s!=u)return!1;switch(s){case ft:case dt:return+i==+t;case gt:return i!=+i?t!=+t:0==i?1/i==1/t:i==+t;case vt:case _t:return i==String(t)}var c=s==pt;if(!c){if(s!=yt||!Pt.nodeClass&&(y(i)||y(t)))return!1;var l=!Pt.argsObject&&At(i)?Object:i.constructor,h=!Pt.argsObject&&At(t)?Object:t.constructor;if(!(l==h||xt.call(i,"constructor")&&xt.call(t,"constructor")||W(l)&&l instanceof l&&W(h)&&h instanceof h)&&"constructor"in i&&"constructor"in t)return!1}a=a||[];for(var p=(o=o||[]).length;p--;)if(o[p]==i)return a[p]==t;var f=0,d=!0;if(o.push(i),a.push(t),c){if(p=i.length,f=t.length,d=f==p)for(;f--;){var m=t[f];if(!(d=n(i[f],m,o,a)))break}}else g(t,function(t,e,r){return xt.call(r,e)?(f++,d=xt.call(i,e)&&n(i[e],t,o,a)):void 0}),d&&g(i,function(t,e,r){return xt.call(r,e)?d=-1<--f:void 0});return o.pop(),a.pop(),d}(t,e,[],[])},Rt=Array.prototype.slice,Nt=this.inherits=F.internals.inherits=function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r},kt=F.internals.addProperties=function(t){for(var e=[],r=1,n=arguments.length;r<n;r++)e.push(arguments[r]);for(var i=0,o=e.length;i<o;i++){var a=e[i];for(var s in a)t[s]=a[s]}},Dt=F.internals.addRef=function(e,r){return new wi(function(t){return new Bt(r.getDisposable(),e.subscribe(t))})},jt={e:{}};n.prototype.compareTo=function(t){var e=this.value.compareTo(t.value);return 0===e&&(e=this.id-t.id),e};var zt=F.internals.PriorityQueue=function(t){this.items=new Array(t),this.length=0},Ft=zt.prototype;Ft.isHigherPriority=function(t,e){return this.items[t].compareTo(this.items[e])<0},Ft.percolate=function(t){if(!(t>=this.length||t<0)){var e=t-1>>1;if(!(e<0||e===t)&&this.isHigherPriority(t,e)){var r=this.items[t];this.items[t]=this.items[e],this.items[e]=r,this.percolate(e)}}},Ft.heapify=function(t){if(+t||(t=0),!(t>=this.length||t<0)){var e=2*t+1,r=2*t+2,n=t;if(e<this.length&&this.isHigherPriority(e,n)&&(n=e),r<this.length&&this.isHigherPriority(r,n)&&(n=r),n!==t){var i=this.items[t];this.items[t]=this.items[n],this.items[n]=i,this.heapify(n)}}},Ft.peek=function(){return this.items[0].value},Ft.removeAt=function(t){this.items[t]=this.items[--this.length],this.items[this.length]=u,this.heapify()},Ft.dequeue=function(){var t=this.peek();return this.removeAt(0),t},Ft.enqueue=function(t){var e=this.length++;this.items[e]=new n(zt.count++,t),this.percolate(e)},Ft.remove=function(t){for(var e=0;e<this.length;e++)if(this.items[e].value===t)return this.removeAt(e),!0;return!1},zt.count=0;var Bt=F.CompositeDisposable=function(){var t,e,r=[];if(Array.isArray(arguments[0]))e=(r=arguments[0]).length;else for(e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];for(t=0;t<e;t++)if(!Ht(r[t]))throw new TypeError("Not a disposable");this.disposables=r,this.isDisposed=!1,this.length=r.length},Ut=Bt.prototype;Ut.add=function(t){this.isDisposed?t.dispose():(this.disposables.push(t),this.length++)},Ut.remove=function(t){var e=!1;if(!this.isDisposed){var r=this.disposables.indexOf(t);-1!==r&&(e=!0,this.disposables.splice(r,1),this.length--,t.dispose())}return e},Ut.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;for(var t=this.disposables.length,e=new Array(t),r=0;r<t;r++)e[r]=this.disposables[r];for(this.disposables=[],r=this.length=0;r<t;r++)e[r].dispose()}};var Vt=F.Disposable=function(t){this.isDisposed=!1,this.action=t||B};Vt.prototype.dispose=function(){this.isDisposed||(this.action(),this.isDisposed=!0)};var Gt=Vt.create=function(t){return new Vt(t)},qt=Vt.empty={dispose:B},Ht=Vt.isDisposable=function(t){return t&&W(t.dispose)},$t=Vt.checkDisposed=function(t){if(t.isDisposed)throw new J},Wt=F.SingleAssignmentDisposable=function(){this.isDisposed=!1,this.current=null};Wt.prototype.getDisposable=function(){return this.current},Wt.prototype.setDisposable=function(t){if(this.current)throw new Error("Disposable has already been assigned");var e=this.isDisposed;e||(this.current=t),e&&t&&t.dispose()},Wt.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var t=this.current;this.current=null}t&&t.dispose()};var Xt=F.SerialDisposable=function(){this.isDisposed=!1,this.current=null};Xt.prototype.getDisposable=function(){return this.current},Xt.prototype.setDisposable=function(t){var e=this.isDisposed;if(!e){var r=this.current;this.current=t}r&&r.dispose(),e&&t&&t.dispose()},Xt.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var t=this.current;this.current=null}t&&t.dispose()};var Yt=F.RefCountDisposable=(Zt.prototype.dispose=function(){this.disposable.isDisposed||this.isInnerDisposed||(this.isInnerDisposed=!0,this.disposable.count--,0===this.disposable.count&&this.disposable.isPrimaryDisposed&&(this.disposable.isDisposed=!0,this.disposable.underlyingDisposable.dispose()))},Kt.prototype.dispose=function(){this.isDisposed||this.isPrimaryDisposed||(this.isPrimaryDisposed=!0,0===this.count&&(this.isDisposed=!0,this.underlyingDisposable.dispose()))},Kt.prototype.getDisposable=function(){return this.isDisposed?qt:new Zt(this)},Kt);function Zt(t){this.disposable=t,this.disposable.count++,this.isInnerDisposed=!1}function Kt(t){this.underlyingDisposable=t,this.isDisposed=!1,this.isPrimaryDisposed=!1,this.count=0}f.prototype.dispose=function(){this.scheduler.scheduleWithState(this,d)};var Jt=F.internals.ScheduledItem=function(t,e,r,n,i){this.scheduler=t,this.state=e,this.action=r,this.dueTime=n,this.comparer=i||q,this.disposable=new Wt};Jt.prototype.invoke=function(){this.disposable.setDisposable(this.invokeCore())},Jt.prototype.compareTo=function(t){return this.comparer(this.dueTime,t.dueTime)},Jt.prototype.isCancelled=function(){return this.disposable.isDisposed},Jt.prototype.invokeCore=function(){return this.action(this.scheduler,this.state)};var Qt,te,ee=F.Scheduler=function(){function e(t,e,r,n){this.now=t,this._schedule=e,this._scheduleRelative=r,this._scheduleAbsolute=n}function r(t,e){return e(),qt}e.isScheduler=function(t){return t instanceof e};var t=e.prototype;return t.schedule=function(t){return this._schedule(t,r)},t.scheduleWithState=function(t,e){return this._schedule(t,e)},t.scheduleWithRelative=function(t,e){return this._scheduleRelative(e,t,r)},t.scheduleWithRelativeAndState=function(t,e,r){return this._scheduleRelative(t,e,r)},t.scheduleWithAbsolute=function(t,e){return this._scheduleAbsolute(e,t,r)},t.scheduleWithAbsoluteAndState=function(t,e,r){return this._scheduleAbsolute(t,e,r)},e.now=V,e.normalize=function(t){return t<0&&(t=0),t},e}(),re=ee.normalize,ne=ee.isScheduler;function ie(e,t){var r=t[0],n=t[1],a=new Bt;return function o(t){n(t,function(t){var r=!1,n=!1,i=e.scheduleWithState(t,function(t,e){return r?a.remove(i):n=!0,o(e),qt});n||(a.add(i),r=!0)})}(r),a}function oe(a,t,s){var e=t[0],r=t[1],u=new Bt;return function o(t){r(t,function(t,e){var r=!1,n=!1,i=a[s](t,e,function(t,e){return r?u.remove(i):n=!0,o(e),qt});n||(u.add(i),r=!0)})}(e),u}function ae(e,r){e(function(t){r(e,t)})}(te=ee.prototype).scheduleRecursive=function(t){return this.scheduleRecursiveWithState(t,ae)},te.scheduleRecursiveWithState=function(t,e){return this.scheduleWithState([t,e],ie)},te.scheduleRecursiveWithRelative=function(t,e){return this.scheduleRecursiveWithRelativeAndState(e,t,ae)},te.scheduleRecursiveWithRelativeAndState=function(t,e,r){return this._scheduleRelative([t,r],e,function(t,e){return oe(t,e,"scheduleWithRelativeAndState")})},te.scheduleRecursiveWithAbsolute=function(t,e){return this.scheduleRecursiveWithAbsoluteAndState(e,t,ae)},te.scheduleRecursiveWithAbsoluteAndState=function(t,e,r){return this._scheduleAbsolute([t,r],e,function(t,e){return oe(t,e,"scheduleWithAbsoluteAndState")})},ee.prototype,ee.prototype.schedulePeriodic=function(t,e){return this.schedulePeriodicWithState(null,t,e)},ee.prototype.schedulePeriodicWithState=function(t,e,r){if(void 0===R.setInterval)throw new tt;e=re(e);var n=t,i=R.setInterval(function(){n=r(n)},e);return Gt(function(){R.clearInterval(i)})},(Qt=ee.prototype).catchError=Qt.catch=function(t){return new _e(this,t)};var se,ue,ce,le,he=(F.internals.SchedulePeriodicRecursive=(ye.prototype.start=function(){var t=new Wt;return(this._cancel=t).setDisposable(this._scheduler.scheduleRecursiveWithRelativeAndState(0,this._period,function(t,e){e(0,this._period);try{this._state=this._action(this._state)}catch(t){throw this._cancel.dispose(),t}}.bind(this))),t},ye),ee.immediate=new ee(V,function(t,e){return e(this,t)},nt,nt)),pe=ee.currentThread=((le=new ee(V,function(t,e){var r=new Jt(this,t,e,this.now());if(ce)ce.enqueue(r);else{(ce=new zt(4)).enqueue(r);var n=h(ge)();if(ce=null,n===jt)return l(n.e)}return r.disposable},nt,nt)).scheduleRequired=function(){return!ce},le),fe=function(){var t,e=B;if(R.setTimeout)t=R.setTimeout,e=R.clearTimeout;else{if(!R.WScript)throw new tt;t=function(t,e){R.WScript.Sleep(e),t()}}return{setTimeout:t,clearTimeout:e}}(),de=fe.setTimeout,me=fe.clearTimeout;function ge(){for(;0<ce.length;){var t=ce.dequeue();t.isCancelled()||t.invoke()}}function ye(t,e,r,n){this._scheduler=t,this._state=e,this._period=r,this._action=n}!function(){function n(t){if(a)de(function(){n(t)},0);else{var e=o[t];if(e){a=!0;var r=h(e)();if(ue(t),a=!1,r===jt)return l(r.e)}}}function t(t){"string"==typeof t.data&&t.data.substring(0,s.length)===s&&n(t.data.substring(s.length))}var i=1,o={},a=!1;ue=function(t){delete o[t]};var e=RegExp("^"+String(bt).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),r="function"==typeof(r=j&&D&&j.setImmediate)&&!e.test(r)&&r;if(W(r))se=function(t){var e=i++;return o[e]=t,r(function(){n(e)}),e};else if(void 0!==zi&&"[object process]"==={}.toString.call(zi))se=function(t){var e=i++;return o[e]=t,zi.nextTick(function(){n(e)}),e};else if(function(){if(!R.postMessage||R.importScripts)return!1;var t=!1,e=R.onmessage;return R.onmessage=function(){t=!0},R.postMessage("","*"),R.onmessage=e,t}()){var s="ms.rx.schedule"+Math.random();R.addEventListener?R.addEventListener("message",t,!1):R.attachEvent?R.attachEvent("onmessage",t):R.onmessage=t,se=function(t){var e=i++;return o[e]=t,R.postMessage(s+currentId,"*"),e}}else if(R.MessageChannel){var u=new R.MessageChannel;u.port1.onmessage=function(t){n(t.data)},se=function(t){var e=i++;return o[e]=t,u.port2.postMessage(e),e}}else se="document"in R&&"onreadystatechange"in R.document.createElement("script")?function(t){var e=R.document.createElement("script"),r=i++;return o[r]=t,e.onreadystatechange=function(){n(r),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},R.document.documentElement.appendChild(e),r}:function(t){var e=i++;return o[e]=t,de(function(){n(e)},0),e}}();var ve,_e=(ee.timeout=ee.default=new ee(V,function(t,e){var r=this,n=new Wt,i=se(function(){n.isDisposed||n.setDisposable(e(r,t))});return new Bt(n,Gt(function(){ue(i)}))},function(t,e,r){var n=this,i=ee.normalize(e),o=new Wt;if(0===i)return n.scheduleWithState(t,r);var a=de(function(){o.isDisposed||o.setDisposable(r(n,t))},i);return new Bt(o,Gt(function(){me(a)}))},function(t,e,r){return this.scheduleWithRelativeAndState(t,e-this.now(),r)}),Nt(ze,ve=ee),ze.prototype._clone=function(t){return new ze(t,this._handler)},ze.prototype._wrap=function(r){var n=this;return function(t,e){try{return r(n._getRecursiveWrapper(t),e)}catch(t){if(!n._handler(t))throw t;return qt}}},ze.prototype._getRecursiveWrapper=function(t){if(this._recursiveOriginal!==t){this._recursiveOriginal=t;var e=this._clone(t);e._recursiveOriginal=t,e._recursiveWrapper=e,this._recursiveWrapper=e}return this._recursiveWrapper},ze.prototype.schedulePeriodicWithState=function(t,e,r){var n=this,i=!1,o=new Wt;return o.setDisposable(this._scheduler.schedulePeriodicWithState(t,e,function(t){if(i)return null;try{return r(t)}catch(t){if(i=!0,!n._handler(t))throw t;return o.dispose(),null}})),o},ze),be=F.Notification=(Ne.prototype.accept=function(t,e,r){return t&&"object"==typeof t?this._acceptObservable(t):this._accept(t,e,r)},Ne.prototype.toObservable=function(t){var e=this;return ne(t)||(t=he),new wi(function(r){return t.scheduleWithState(e,function(t,e){e._acceptObservable(r),"N"===e.kind&&r.onCompleted()})})},Ne),xe=be.createOnNext=function(t){return new be("N",t,null,Ie,Le,Re)},we=be.createOnError=function(t){return new be("E",null,t,Pe,Oe,Ae)},Se=be.createOnCompleted=function(){return new be("C",null,null,Ce,Me,Te)},Ee=F.Observer=function(){};function Ce(t,e,r){return r()}function Me(t){return t.onCompleted()}function Te(){return"OnCompleted()"}function Pe(t,e){return e(this.exception)}function Oe(t){return t.onError(this.exception)}function Ae(){return"OnError("+this.exception+")"}function Ie(t){return t(this.value)}function Le(t){return t.onNext(this.value)}function Re(){return"OnNext("+this.value+")"}function Ne(t,e,r,n,i,o){this.kind=t,this.value=e,this.exception=r,this._accept=n,this._acceptObservable=i,this.toString=o}function ke(t,e){return this._scheduler.scheduleWithState(t,this._wrap(e))}function De(t,e,r){return this._scheduler.scheduleWithRelativeAndState(t,e,this._wrap(r))}function je(t,e,r){return this._scheduler.scheduleWithAbsoluteAndState(t,e,this._wrap(r))}function ze(t,e){this._scheduler=t,this._handler=e,this._recursiveOriginal=null,this._recursiveWrapper=null,ve.call(this,this._scheduler.now.bind(this._scheduler),ke,De,je)}Ee.prototype.toNotifier=function(){var e=this;return function(t){return t.accept(e)}},Ee.prototype.asObserver=function(){return new Xe(this.onNext.bind(this),this.onError.bind(this),this.onCompleted.bind(this))},Ee.prototype.checked=function(){return new Ye(this)};var Fe=Ee.create=function(t,e,r){return new Xe(t=t||B,e=e||H,r=r||B)};Ee.fromNotifier=function(e,r){return new Xe(function(t){return e.call(r,xe(t))},function(t){return e.call(r,we(t))},function(){return e.call(r,Se())})},Ee.prototype.notifyOn=function(t){return new Ke(t,this)},Ee.prototype.makeSafe=function(t){return new AnonymousSafeObserver(this._onNext,this._onError,this._onCompleted,t)};var Be,Ue,Ve,Ge,qe,He,$e,We=F.internals.AbstractObserver=(Nt(hr,$e=Ee),hr.prototype.next=rt,hr.prototype.error=rt,hr.prototype.completed=rt,hr.prototype.onNext=function(t){this.isStopped||this.next(t)},hr.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.error(t))},hr.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.completed())},hr.prototype.dispose=function(){this.isStopped=!0},hr.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.error(t),!0)},hr),Xe=F.AnonymousObserver=(Nt(lr,He=We),lr.prototype.next=function(t){this._onNext(t)},lr.prototype.error=function(t){this._onError(t)},lr.prototype.completed=function(){this._onCompleted()},lr),Ye=function(e){function t(t){e.call(this),this._observer=t,this._state=0}Nt(t,e);var r=t.prototype;return r.onNext=function(t){this.checkAccess();var e=h(this._observer.onNext).call(this._observer,t);this._state=0,e===jt&&l(e.e)},r.onError=function(t){this.checkAccess();var e=h(this._observer.onError).call(this._observer,t);this._state=2,e===jt&&l(e.e)},r.onCompleted=function(){this.checkAccess();var t=h(this._observer.onCompleted).call(this._observer);this._state=2,t===jt&&l(t.e)},r.checkAccess=function(){if(1===this._state)throw new Error("Re-entrancy detected");if(2===this._state)throw new Error("Observer completed");0===this._state&&(this._state=1)},t}(Ee),Ze=F.internals.ScheduledObserver=(Nt(cr,qe=We),cr.prototype.next=function(t){var e=this;this.queue.push(function(){e.observer.onNext(t)})},cr.prototype.error=function(t){var e=this;this.queue.push(function(){e.observer.onError(t)})},cr.prototype.completed=function(){var t=this;this.queue.push(function(){t.observer.onCompleted()})},cr.prototype.ensureActive=function(){var t=!1,r=this;!this.hasFaulted&&0<this.queue.length&&(t=!this.isAcquired,this.isAcquired=!0),t&&this.disposable.setDisposable(this.scheduler.scheduleRecursive(function(t){var e;if(0<r.queue.length){e=r.queue.shift();try{e()}catch(t){throw r.queue=[],r.hasFaulted=!0,t}t()}else r.isAcquired=!1}))},cr.prototype.dispose=function(){qe.prototype.dispose.call(this),this.disposable.dispose()},cr),Ke=(Nt(ur,Ge=Ze),ur.prototype.next=function(t){Ge.prototype.next.call(this,t),this.ensureActive()},ur.prototype.error=function(t){Ge.prototype.error.call(this,t),this.ensureActive()},ur.prototype.completed=function(){Ge.prototype.completed.call(this),this.ensureActive()},ur.prototype.dispose=function(){Ge.prototype.dispose.call(this),this._cancel&&this._cancel.dispose(),this._cancel=null},ur),Je=F.Observable=((Be=sr.prototype).subscribe=Be.forEach=function(t,e,r){return this._subscribe("object"==typeof t?t:Fe(t,e,r))},Be.subscribeOnNext=function(e,r){return this._subscribe(Fe(void 0!==r?function(t){e.call(r,t)}:e))},Be.subscribeOnError=function(e,r){return this._subscribe(Fe(null,void 0!==r?function(t){e.call(r,t)}:e))},Be.subscribeOnCompleted=function(t,e){return this._subscribe(Fe(null,null,void 0!==e?function(){t.call(e)}:t))},sr),Qe=F.ObservableBase=(Nt(ar,Ve=Je),ar.prototype.subscribeCore=rt,ar),tr=F.internals.Enumerable=function(){},er=(Nt(rr,Ue=Qe),rr.prototype.subscribeCore=function(o){var a,s=new Xt,t=he.scheduleRecursiveWithState(this.sources[it](),function(t,e){if(!a){var r=h(t.next).call(t);if(r===jt)return o.onError(r.e);if(r.done)return o.onCompleted();var n=r.value;$(n)&&(n=Cr(n));var i=new Wt;s.setDisposable(i),i.setDisposable(n.subscribe(new nr(o,e,t)))}});return new Bt(s,t,Gt(function(){a=!0}))},nr.prototype.onNext=function(t){this.isStopped||this.o.onNext(t)},nr.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},nr.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.s(this.e))},nr.prototype.dispose=function(){this.isStopped=!0},nr.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.o.onError(t),!0)},rr);function rr(t){this.sources=t,Ue.call(this)}function nr(t,e,r){this.o=t,this.s=e,this.e=r,this.isStopped=!1}function ir(t,e){var r=e[0],n=e[1],i=h(n.subscribeCore).call(n,r);return i!==jt||r.fail(jt.e)?void r.setDisposable(function(t){return t&&W(t.dispose)?t:W(t)?Gt(t):qt}(i)):l(jt.e)}function or(t){var e=new Si(t),r=[e,this];return pe.scheduleRequired()?pe.scheduleWithState(r,ir):ir(0,r),e}function ar(){Ve.call(this,or)}function sr(r){if(F.config.longStackSupport&&X){try{throw new Error}catch(t){this.stack=t.stack.substring(t.stack.indexOf("\n")+1)}var n=this;this._subscribe=function(t){var e=t.onError.bind(t);return t.onError=function(t){o(t,n),e(t)},r.call(n,t)}}else this._subscribe=r}function ur(t,e,r){Ge.call(this,t,e),this._cancel=r}function cr(t,e){qe.call(this),this.scheduler=t,this.observer=e,this.isAcquired=!1,this.hasFaulted=!1,this.queue=[],this.disposable=new Xt}function lr(t,e,r){He.call(this),this._onNext=t,this._onError=e,this._onCompleted=r}function hr(){this.isStopped=!1,$e.call(this)}tr.prototype.concat=function(){return new er(this)};var pr,fr=(Nt(dr,pr=Qe),dr.prototype.subscribeCore=function(o){var a,s=this.sources[it](),u=new Xt,t=he.scheduleRecursiveWithState(null,function(t,e){if(!a){var r=h(s.next).call(s);if(r===jt)return o.onError(r.e);if(r.done)return null!==t?o.onError(t):o.onCompleted();var n=r.value;$(n)&&(n=Cr(n));var i=new Wt;u.setDisposable(i),i.setDisposable(n.subscribe(function(t){o.onNext(t)},e,function(){o.onCompleted()}))}});return new Bt(u,t,Gt(function(){a=!0}))},dr);function dr(t){this.sources=t,pr.call(this)}tr.prototype.catchError=function(){return new fr(this)},tr.prototype.catchErrorWhen=function(r){var n=this;return new wi(function(o){var a,s=new Oi,u=new Oi,t=r(s).subscribe(u),c=n[it](),l=new Xt,e=he.scheduleRecursive(function(e){if(!a){var t=h(c.next).call(c);if(t===jt)return o.onError(t.e);if(t.done)return void o.onCompleted();var r=t.value;$(r)&&(r=Cr(r));var n=new Wt,i=new Wt;l.setDisposable(new Bt(i,n)),n.setDisposable(r.subscribe(function(t){o.onNext(t)},function(t){i.setDisposable(u.subscribe(e,function(t){o.onError(t)},function(){o.onCompleted()})),s.onNext(t)},function(){o.onCompleted()}))}});return new Bt(t,l,e,Gt(function(){a=!0}))})};var mr=(Nt(xr,tr),xr.prototype[it]=function(){return new wr(this)},wr.prototype.next=function(){return 0===this.l?ot:(0<this.l&&this.l--,{done:!1,value:this.v})},xr),gr=tr.repeat=function(t,e){return new mr(t,e)},yr=(Nt(_r,tr),_r.prototype[it]=function(){return new br(this)},br.prototype.next=function(){return++this.i<this.l?{done:!1,value:this.fn?this.fn(this.s[this.i],this.i,this.s):this.s[this.i]}:ot},_r),vr=tr.of=function(t,e,r){return new yr(t,e,r)};function _r(t,e,r){this.s=t,this.fn=e?ut(e,r,3):null}function br(t){this.i=-1,this.s=t.s,this.l=this.s.length,this.fn=t.fn}function xr(t,e){this.v=t,this.c=null==e?-1:e}function wr(t){this.v=t.v,this.l=t.c}Be.observeOn=function(e){var r=this;return new wi(function(t){return r.subscribe(new Ke(e,t))},r)},Be.subscribeOn=function(n){var i=this;return new wi(function(t){var e=new Wt,r=new Xt;return r.setDisposable(e),e.setDisposable(n.schedule(function(){r.setDisposable(new f(n,i.subscribe(t)))})),r},i)};var Sr,Er=(Nt(Mr,Sr=Qe),Mr.prototype.subscribeCore=function(e){return this.p.then(function(t){e.onNext(t),e.onCompleted()},function(t){e.onError(t)}),qt},Mr),Cr=Je.fromPromise=function(t){return new Er(t)};function Mr(t){this.p=t,Sr.call(this)}Be.toPromise=function(t){if(!(t=t||F.config.Promise))throw new tt("Promise type not provided nor in Rx.config.Promise");var i=this;return new t(function(t,e){var r,n=!1;i.subscribe(function(t){r=t,n=!0},e,function(){n&&t(r)})})};var Tr,Pr=(Nt(Or,Tr=Qe),Or.prototype.subscribeCore=function(t){return this.source.subscribe(new Ar(t))},Ar.prototype.onNext=function(t){this.isStopped||this.a.push(t)},Ar.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},Ar.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onNext(this.a),this.o.onCompleted())},Ar.prototype.dispose=function(){this.isStopped=!0},Ar.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.o.onError(t),!0)},Or);function Or(t){this.source=t,Tr.call(this)}function Ar(t){this.o=t,this.a=[],this.isStopped=!1}Be.toArray=function(){return new Pr(this)},Je.create=Je.createWithDisposable=function(t,e){return new wi(t,e)};var Ir,Lr,Rr=(Je.defer=function(r){return new wi(function(t){var e;try{e=r()}catch(e){return dn(e).subscribe(t)}return $(e)&&(e=Cr(e)),e.subscribe(t)})},Nt(Br,Lr=Qe),Br.prototype.subscribeCore=function(t){return new Ur(t,this).run()},Ur.prototype.run=function(){return this.parent.scheduler.scheduleWithState(this.observer,Vr)},Br),Nr=Je.empty=function(t){return ne(t)||(t=he),new Rr(t)},kr=(Nt(Fr,Ir=Qe),Fr.prototype.subscribeCore=function(t){return new Dr(t,this).run()},Fr),Dr=(zr.prototype.run=function(){var i=function(t){var e=t[it];if(!e&&"string"==typeof t)return new m(t)[it]();if(!e&&t.length!==u)return new _(t)[it]();if(!e)throw new TypeError("Object is not iterable");return t[it]()}(Object(this.parent.iterable)),o=this.observer,a=this.parent.mapper;return this.parent.scheduler.scheduleRecursiveWithState(0,function(t,e){try{var r=i.next()}catch(t){return o.onError(t)}if(r.done)return o.onCompleted();var n=r.value;if(a)try{n=a(n,t)}catch(t){return o.onError(t)}o.onNext(n),e(t+1)})},zr),jr=Math.pow(2,53)-1;function zr(t,e){this.observer=t,this.parent=e}function Fr(t,e,r){this.iterable=t,this.mapper=e,this.scheduler=r,Ir.call(this)}function Br(t){this.scheduler=t,Lr.call(this)}function Ur(t,e){this.observer=t,this.parent=e}function Vr(t,e){e.onCompleted()}m.prototype[it]=function(){return new v(this._s)},v.prototype[it]=function(){return this},v.prototype.next=function(){return this._i<this._l?{done:!1,value:this._s.charAt(this._i++)}:ot},_.prototype[it]=function(){return new b(this._a)},b.prototype[it]=function(){return this},b.prototype.next=function(){return this._i<this._l?{done:!1,value:this._a[this._i++]}:ot};var Gr,qr=Je.from=function(t,e,r,n){if(null==t)throw new Error("iterable cannot be null.");if(e&&!W(e))throw new Error("mapFn when provided must be a function");if(e)var i=ut(e,r,2);return ne(n)||(n=pe),new kr(t,i,n)},Hr=(Nt($r,Gr=Qe),$r.prototype.subscribeCore=function(t){return new x(t,this).run()},$r);function $r(t,e){this.args=t,this.scheduler=e,Gr.call(this)}x.prototype.run=function(){var r=this.observer,n=this.parent.args,i=n.length;return this.parent.scheduler.scheduleRecursiveWithState(0,function(t,e){t<i?(r.onNext(n[t]),e(t+1)):r.onCompleted()})};var Wr=Je.fromArray=function(t,e){return ne(e)||(e=pe),new Hr(t,e)};Je.generate=function(t,a,s,u,e){return ne(e)||(e=pe),new wi(function(i){var o=!0;return e.scheduleRecursiveWithState(t,function(t,e){var r,n;try{o?o=!1:t=s(t),(r=a(t))&&(n=u(t))}catch(t){return i.onError(t)}r?(i.onNext(n),e(t)):i.onCompleted()})})};var Xr,Yr=(Nt(Kr,Xr=Qe),Kr.prototype.subscribeCore=function(t){return qt},Kr),Zr=Je.never=function(){return new Yr};function Kr(){Xr.call(this)}Je.of=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return new Hr(e,pe)},Je.ofWithScheduler=function(t){for(var e=arguments.length,r=new Array(e-1),n=1;n<e;n++)r[n-1]=arguments[n];return new Hr(r,t)};var Jr,Qr=(Nt(tn,Jr=Qe),tn.prototype.subscribeCore=function(t){return new S(t,this).run()},tn);function tn(t,e){this.obj=t,this.keys=Object.keys(t),this.scheduler=e,Jr.call(this)}S.prototype.run=function(){var n=this.observer,i=this.parent.obj,o=this.parent.keys,a=o.length;return this.parent.scheduler.scheduleRecursiveWithState(0,function(t,e){if(t<a){var r=o[t];n.onNext([r,i[r]]),e(t+1)}else n.onCompleted()})},Je.pairs=function(t,e){return new Qr(t,e=e||pe)};var en,rn=(Nt(an,en=Qe),an.prototype.subscribeCore=function(t){return new nn(t,this).run()},an),nn=(on.prototype.run=function(){var r=this.parent.start,n=this.parent.rangeCount,i=this.observer;return this.parent.scheduler.scheduleRecursiveWithState(0,function(t,e){t<n?(i.onNext(r+t),e(t+1)):i.onCompleted()})},on);function on(t,e){this.observer=t,this.parent=e}function an(t,e,r){this.start=t,this.rangeCount=e,this.scheduler=r,en.call(this)}Je.range=function(t,e,r){return ne(r)||(r=pe),new rn(t,e,r)};var sn,un=(Nt(cn,sn=Qe),cn.prototype.subscribeCore=function(t){return new E(t,this).run()},cn);function cn(t,e,r){this.value=t,this.repeatCount=null==e?-1:e,this.scheduler=r,sn.call(this)}E.prototype.run=function(){var r=this.observer,n=this.parent.value;return this.parent.scheduler.scheduleRecursiveWithState(this.parent.repeatCount,function(t,e){return(-1===t||0<t)&&(r.onNext(n),0<t&&t--),0===t?r.onCompleted():void e(t)})},Je.repeat=function(t,e,r){return ne(r)||(r=pe),new un(t,e,r)};var ln,hn,pn=(Nt(vn,hn=Qe),vn.prototype.subscribeCore=function(t){return new _n(t,this).run()},_n.prototype.run=function(){return this.parent.scheduler.scheduleWithState([this.parent.value,this.observer],bn)},vn),fn=(Je.return=Je.just=Je.returnValue=function(t,e){return ne(e)||(e=he),new pn(t,e)},Nt(mn,ln=Qe),mn.prototype.subscribeCore=function(t){return new gn(t,this).run()},gn.prototype.run=function(){return this.p.scheduler.scheduleWithState([this.p.error,this.o],yn)},mn),dn=Je.throw=Je.throwError=Je.throwException=function(t,e){return ne(e)||(e=he),new fn(t,e)};function mn(t,e){this.error=t,this.scheduler=e,ln.call(this)}function gn(t,e){this.o=t,this.p=e}function yn(t,e){var r=e[0];e[1].onError(r)}function vn(t,e){this.value=t,this.scheduler=e,hn.call(this)}function _n(t,e){this.observer=t,this.parent=e}function bn(t,e){var r=e[0],n=e[1];n.onNext(r),n.onCompleted()}Je.using=function(i,o){return new wi(function(t){var e,r,n=qt;try{(e=i())&&(n=e),r=o(e)}catch(e){return new Bt(dn(e).subscribe(t),n)}return new Bt(r.subscribe(t),n)})},Be.amb=function(a){var s=this;return new wi(function(e){function r(){i||(i="L",o.dispose())}function n(){i||(i="R",t.dispose())}var i,t=new Wt,o=new Wt;return $(a)&&(a=Cr(a)),t.setDisposable(s.subscribe(function(t){r(),"L"===i&&e.onNext(t)},function(t){r(),"L"===i&&e.onError(t)},function(){r(),"L"===i&&e.onCompleted()})),o.setDisposable(a.subscribe(function(t){n(),"R"===i&&e.onNext(t)},function(t){n(),"R"===i&&e.onError(t)},function(){n(),"R"===i&&e.onCompleted()})),new Bt(t,o)})},Je.amb=function(){var t,e,r=Zr(),n=[];if(Array.isArray(arguments[0]))n=arguments[0];else for(var i=0,o=arguments.length;i<o;i++)n.push(arguments[i]);for(i=0,o=n.length;i<o;i++)t=r,e=n[i],r=t.amb(e);return r},Be.catch=Be.catchError=Be.catchException=function(t){return"function"==typeof t?function(e,o){return new wi(function(n){var t=new Wt,i=new Xt;return i.setDisposable(t),t.setDisposable(e.subscribe(function(t){n.onNext(t)},function(t){try{var e=o(t)}catch(t){return n.onError(t)}$(e)&&(e=Cr(e));var r=new Wt;i.setDisposable(r),r.setDisposable(e.subscribe(n))},function(t){n.onCompleted(t)})),i},e)}(this,t):xn([this,t])};var xn=Je.catchError=Je.catch=Je.catchException=function(){var t=[];if(Array.isArray(arguments[0]))t=arguments[0];else for(var e=0,r=arguments.length;e<r;e++)t.push(arguments[e]);return vr(t).catchError()};Be.combineLatest=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return Array.isArray(e[0])?e[0].unshift(this):e.unshift(this),wn.apply(this,e)};var wn=Je.combineLatest=function(){for(var t=arguments.length,l=new Array(t),e=0;e<t;e++)l[e]=arguments[e];var h=l.pop();return Array.isArray(l[0])&&(l=l[0]),new wi(function(n){function i(r){if(o[r]=!0,a=a||o.every(U)){try{var t=h.apply(null,u)}catch(t){return n.onError(t)}n.onNext(t)}else s.filter(function(t,e){return e!==r}).every(U)&&n.onCompleted()}function t(){return!1}for(var e=l.length,o=p(e,t),a=!1,s=p(e,t),u=new Array(e),c=new Array(e),r=0;r<e;r++)!function(e){var t=l[e],r=new Wt;$(t)&&(t=Cr(t)),r.setDisposable(t.subscribe(function(t){u[e]=t,i(e)},function(t){n.onError(t)},function(){s[e]=!0,s.every(U)&&n.onCompleted()})),c[e]=r}(r);return new Bt(c)},this)};Be.concat=function(){for(var t=[],e=0,r=arguments.length;e<r;e++)t.push(arguments[e]);return t.unshift(this),Cn.apply(null,t)};var Sn,En=(Nt(Mn,Sn=Qe),Mn.prototype.subscribeCore=function(t){return new Tn(this.sources,t).run()},Tn.prototype.run=function(){var i,o=new Xt,a=this.sources,s=a.length,u=this.o,t=he.scheduleRecursiveWithState(0,function(t,e){if(!i){if(t===s)return u.onCompleted();var r=a[t];$(r)&&(r=Cr(r));var n=new Wt;o.setDisposable(n),n.setDisposable(r.subscribe(function(t){u.onNext(t)},function(t){u.onError(t)},function(){e(t+1)}))}});return new Bt(o,t,Gt(function(){i=!0}))},Mn),Cn=Je.concat=function(){var t;if(Array.isArray(arguments[0]))t=arguments[0];else{t=new Array(arguments.length);for(var e=0,r=arguments.length;e<r;e++)t[e]=arguments[e]}return new En(t)};function Mn(t){this.sources=t,Sn.call(this)}function Tn(t,e){this.sources=t,this.o=e}Be.concatAll=Be.concatObservable=function(){return this.merge(1)};var Pn,On=(Nt(Rn,Pn=Qe),Rn.prototype.subscribeCore=function(t){var e=new Bt;return e.add(this.source.subscribe(new An(t,this.maxConcurrent,e))),e},Rn),An=(In.prototype.handleSubscribe=function(t){var e=new Wt;this.g.add(e),$(t)&&(t=Cr(t)),e.setDisposable(t.subscribe(new Ln(this,e)))},In.prototype.onNext=function(t){this.isStopped||(this.activeCount<this.max?(this.activeCount++,this.handleSubscribe(t)):this.q.push(t))},In.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},In.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.done=!0,0===this.activeCount&&this.o.onCompleted())},In.prototype.dispose=function(){this.isStopped=!0},In.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.o.onError(t),!0)},Ln.prototype.onNext=function(t){this.isStopped||this.parent.o.onNext(t)},Ln.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.parent.o.onError(t))},Ln.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=!0;var t=this.parent;t.g.remove(this.sad),0<t.q.length?t.handleSubscribe(t.q.shift()):(t.activeCount--,t.done&&0===t.activeCount&&t.o.onCompleted())}},Ln.prototype.dispose=function(){this.isStopped=!0},Ln.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.parent.o.onError(t),!0)},In);function In(t,e,r){this.o=t,this.max=e,this.g=r,this.done=!1,this.q=[],this.activeCount=0,this.isStopped=!1}function Ln(t,e){this.parent=t,this.sad=e,this.isStopped=!1}function Rn(t,e){this.source=t,this.maxConcurrent=e,Pn.call(this)}Be.merge=function(t){return"number"!=typeof t?Nn(this,t):new On(this,t)};var Nn=Je.merge=function(){var t,e,r=[],n=arguments.length;if(arguments[0])if(ne(arguments[0]))for(t=arguments[0],e=1;e<n;e++)r.push(arguments[e]);else for(t=he,e=0;e<n;e++)r.push(arguments[e]);else for(t=he,e=1;e<n;e++)r.push(arguments[e]);return Array.isArray(r[0])&&(r=r[0]),w(t,r).mergeAll()},kn=F.CompositeError=function(t){this.name="NotImplementedError",this.innerErrors=t,this.message="This contains multiple errors. Check the innerErrors",Error.call(this)};kn.prototype=Error.prototype,Je.mergeDelayError=function(){var t;if(Array.isArray(arguments[0]))t=arguments[0];else{var e=arguments.length;t=new Array(e);for(var r=0;r<e;r++)t[r]=arguments[r]}var s=w(null,t);return new wi(function(r){function n(){0===a.length?r.onCompleted():1===a.length?r.onError(a[0]):r.onError(new kn(a))}var i=new Bt,t=new Wt,o=!1,a=[];return i.add(t),t.setDisposable(s.subscribe(function(t){var e=new Wt;i.add(e),$(t)&&(t=Cr(t)),e.setDisposable(t.subscribe(function(t){r.onNext(t)},function(t){a.push(t),i.remove(e),o&&1===i.length&&n()},function(){i.remove(e),o&&1===i.length&&n()}))},function(t){a.push(t),o=!0,1===i.length&&n()},function(){o=!0,1===i.length&&n()})),i})};var Dn,jn=(Nt(zn,Dn=Qe),zn.prototype.subscribeCore=function(t){var e=new Bt,r=new Wt;return e.add(r),r.setDisposable(this.source.subscribe(new Fn(t,e))),e},Fn.prototype.onNext=function(t){if(!this.isStopped){var e=new Wt;this.g.add(e),$(t)&&(t=Cr(t)),e.setDisposable(t.subscribe(new Bn(this,this.g,e)))}},Fn.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},Fn.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.done=!0,1===this.g.length&&this.o.onCompleted())},Fn.prototype.dispose=function(){this.isStopped=!0},Fn.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.o.onError(t),!0)},Bn.prototype.onNext=function(t){this.isStopped||this.parent.o.onNext(t)},Bn.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.parent.o.onError(t))},Bn.prototype.onCompleted=function(){if(!this.isStopped){var t=this.parent;this.isStopped=!0,t.g.remove(this.sad),t.done&&1===t.g.length&&t.o.onCompleted()}},Bn.prototype.dispose=function(){this.isStopped=!0},Bn.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.parent.o.onError(t),!0)},zn);function zn(t){this.source=t,Dn.call(this)}function Fn(t,e){this.o=t,this.g=e,this.isStopped=!1,this.done=!1}function Bn(t,e,r){this.parent=t,this.g=e,this.sad=r,this.isStopped=!1}Be.mergeAll=Be.mergeObservable=function(){return new jn(this)},Be.onErrorResumeNext=function(t){if(!t)throw new Error("Second observable is required");return Un([this,t])};var Un=Je.onErrorResumeNext=function(){var a=[];if(Array.isArray(arguments[0]))a=arguments[0];else for(var t=0,e=arguments.length;t<e;t++)a.push(arguments[t]);return new wi(function(n){var i=0,o=new Xt,t=he.scheduleRecursive(function(t){var e,r;i<a.length?(e=a[i++],$(e)&&(e=Cr(e)),r=new Wt,o.setDisposable(r),r.setDisposable(e.subscribe(n.onNext.bind(n),t,t))):n.onCompleted()});return new Bt(o,t)})};Be.skipUntil=function(i){var o=this;return new wi(function(e){var r=!1,t=new Bt(o.subscribe(function(t){r&&e.onNext(t)},function(t){e.onError(t)},function(){r&&e.onCompleted()}));$(i)&&(i=Cr(i));var n=new Wt;return t.add(n),n.setDisposable(i.subscribe(function(){r=!0,n.dispose()},function(t){e.onError(t)},function(){n.dispose()})),t},o)};var Vn,Gn=(Nt(qn,Vn=Qe),qn.prototype.subscribeCore=function(t){var e=new Xt,r=this.source.subscribe(new Hn(t,e));return new Bt(r,e)},Hn.prototype.onNext=function(t){if(!this.isStopped){var e=new Wt,r=++this.latest;this.hasLatest=!0,this.inner.setDisposable(e),$(t)&&(t=Cr(t)),e.setDisposable(t.subscribe(new $n(this,r)))}},Hn.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},Hn.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.stopped=!0,this.hasLatest||this.o.onCompleted())},Hn.prototype.dispose=function(){this.isStopped=!0},Hn.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.o.onError(t),!0)},$n.prototype.onNext=function(t){this.isStopped||this.parent.latest===this.id&&this.parent.o.onNext(t)},$n.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.parent.latest===this.id&&this.parent.o.onError(t))},$n.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.parent.latest===this.id&&(this.parent.hasLatest=!1,this.parent.isStopped&&this.parent.o.onCompleted()))},$n.prototype.dispose=function(){this.isStopped=!0},$n.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.parent.o.onError(t),!0)},qn);function qn(t){this.source=t,Vn.call(this)}function Hn(t,e){this.o=t,this.inner=e,this.stopped=!1,this.latest=0,this.hasLatest=!1,this.isStopped=!1}function $n(t,e){this.parent=t,this.id=e,this.isStopped=!1}Be.switch=Be.switchLatest=function(){return new Gn(this)};var Wn,Xn=(Nt(Yn,Wn=Qe),Yn.prototype.subscribeCore=function(t){return new Bt(this.source.subscribe(t),this.other.subscribe(new Zn(t)))},Zn.prototype.onNext=function(t){this.isStopped||this.o.onCompleted()},Zn.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},Zn.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0)},Zn.prototype.dispose=function(){this.isStopped=!0},Zn.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.o.onError(t),!0)},Yn);function Yn(t,e){this.source=t,this.other=$(e)?Cr(e):e,Wn.call(this)}function Zn(t){this.o=t,this.isStopped=!1}Be.takeUntil=function(t){return new Xn(this,t)},Be.withLatestFrom=function(){for(var t=arguments.length,u=new Array(t),e=0;e<t;e++)u[e]=arguments[e];var c=u.pop(),l=this;return Array.isArray(u[0])&&(u=u[0]),new wi(function(n){for(var t=u.length,i=p(t,C),o=!1,a=new Array(t),s=new Array(t+1),e=0;e<t;e++)!function(e){var t=u[e],r=new Wt;$(t)&&(t=Cr(t)),r.setDisposable(t.subscribe(function(t){a[e]=t,i[e]=!0,o=i.every(U)},function(t){n.onError(t)},B)),s[e]=r}(e);var r=new Wt;return r.setDisposable(l.subscribe(function(t){var e=[t].concat(a);if(o){var r=h(c).apply(null,e);return r===jt?n.onError(r.e):void n.onNext(r)}},function(t){n.onError(t)},function(){n.onCompleted()})),s[t]=r,new Bt(s)},this)},Be.zip=function(){if(Array.isArray(arguments[0]))return function(a,s){var t=this;return new wi(function(n){var i=0,o=a.length;return t.subscribe(function(t){if(i<o){var e=a[i++],r=h(s)(t,e);if(r===jt)return n.onError(r.e);n.onNext(r)}else n.onCompleted()},function(t){n.onError(t)},function(){n.onCompleted()})},t)}.apply(this,arguments);for(var t=arguments.length,s=new Array(t),e=0;e<t;e++)s[e]=arguments[e];var u=this,c=s.pop();return s.unshift(u),new wi(function(i){for(var t=s.length,o=p(t,M),a=p(t,C),r=new Array(t),e=0;e<t;e++)!function(n){var t=s[n],e=new Wt;$(t)&&(t=Cr(t)),e.setDisposable(t.subscribe(function(t){if(o[n].push(t),o.every(function(t){return 0<t.length})){var e=o.map(function(t){return t.shift()}),r=h(c).apply(u,e);if(r===jt)return i.onError(r.e);i.onNext(r)}else a.filter(function(t,e){return e!==n}).every(U)&&i.onCompleted()},function(t){i.onError(t)},function(){a[n]=!0,a.every(U)&&i.onCompleted()})),r[n]=e}(e);return new Bt(r)},u)},Je.zip=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e.shift();return n.zip.apply(n,e)},Je.zipArray=function(){var a;if(Array.isArray(arguments[0]))a=arguments[0];else{var t=arguments.length;a=new Array(t);for(var e=0;e<t;e++)a[e]=arguments[e]}return new wi(function(n){for(var t=a.length,i=p(t,T),o=p(t,C),e=new Array(t),r=0;r<t;r++)!function(r){e[r]=new Wt,e[r].setDisposable(a[r].subscribe(function(t){if(i[r].push(t),i.every(function(t){return 0<t.length})){var e=i.map(function(t){return t.shift()});n.onNext(e)}else if(o.filter(function(t,e){return e!==r}).every(U))return n.onCompleted()},function(t){n.onError(t)},function(){o[r]=!0,o.every(U)&&n.onCompleted()}))}(r);return new Bt(e)})},Be.asObservable=function(){var e=this;return new wi(function(t){return e.subscribe(t)},e)},Be.bufferWithCount=function(t,e){return"number"!=typeof e&&(e=t),this.windowWithCount(t,e).selectMany(function(t){return t.toArray()}).where(function(t){return 0<t.length})},Be.dematerialize=function(){var t=this;return new wi(function(e){return t.subscribe(function(t){return t.accept(e)},function(t){e.onError(t)},function(){e.onCompleted()})},this)},Be.distinctUntilChanged=function(a,s){var t=this;return s=s||G,new wi(function(n){var i,o=!1;return t.subscribe(function(t){var e=t;if(a&&(e=h(a)(t))===jt)return n.onError(e.e);if(o){var r=h(s)(i,e);if(r===jt)return n.onError(r.e)}o&&r||(o=!0,i=e,n.onNext(t))},function(t){n.onError(t)},function(){n.onCompleted()})},this)};var Kn,Jn=(Nt(Qn,Kn=Qe),Qn.prototype.subscribeCore=function(t){return this.source.subscribe(new ti(t,this.t))},ti.prototype.onNext=function(t){if(!this.isStopped){var e=h(this.t.onNext).call(this.t,t);e===jt&&this.o.onError(e.e),this.o.onNext(t)}},ti.prototype.onError=function(t){if(!this.isStopped){this.isStopped=!0;var e=h(this.t.onError).call(this.t,t);if(e===jt)return this.o.onError(e.e);this.o.onError(t)}},ti.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=!0;var t=h(this.t.onCompleted).call(this.t);if(t===jt)return this.o.onError(t.e);this.o.onCompleted()}},ti.prototype.dispose=function(){this.isStopped=!0},ti.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.o.onError(t),!0)},Qn);function Qn(t,e,r,n){this.source=t,this.t=!e||W(e)?Fe(e||B,r||B,n||B):e,Kn.call(this)}function ti(t,e){this.o=t,this.t=e,this.isStopped=!1}Be.do=Be.tap=Be.doAction=function(t,e,r){return new Jn(this,t,e,r)},Be.doOnNext=Be.tapOnNext=function(e,r){return this.tap(void 0!==r?function(t){e.call(r,t)}:e)},Be.doOnError=Be.tapOnError=function(e,r){return this.tap(B,void 0!==r?function(t){e.call(r,t)}:e)},Be.doOnCompleted=Be.tapOnCompleted=function(t,e){return this.tap(B,null,void 0!==e?function(){t.call(e)}:t)},Be.finally=Be.ensure=function(r){var n=this;return new wi(function(t){var e;try{e=n.subscribe(t)}catch(t){throw r(),t}return Gt(function(){try{e.dispose()}catch(t){throw t}finally{r()}})},this)},Be.finallyAction=function(t){return this.ensure(t)};var ei,ri=(Nt(ni,ei=Qe),ni.prototype.subscribeCore=function(t){return this.source.subscribe(new ii(t))},ii.prototype.onNext=B,ii.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},ii.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},ii.prototype.dispose=function(){this.isStopped=!0},ii.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.observer.onError(t),!0)},ni);function ni(t){this.source=t,ei.call(this)}function ii(t){this.o=t,this.isStopped=!1}Be.ignoreElements=function(){return new ri(this)},Be.materialize=function(){var t=this;return new wi(function(e){return t.subscribe(function(t){e.onNext(xe(t))},function(t){e.onNext(we(t)),e.onCompleted()},function(){e.onNext(Se()),e.onCompleted()})},t)},Be.repeat=function(t){return gr(this,t).concat()},Be.retry=function(t){return gr(this,t).catchError()},Be.retryWhen=function(t){return gr(this).catchErrorWhen(t)};var oi,ai=(Nt(si,oi=Qe),si.prototype.subscribeCore=function(t){return this.source.subscribe(new P(t,this))},si);function si(t,e,r,n){this.source=t,this.accumulator=e,this.hasSeed=r,this.seed=n,oi.call(this)}P.prototype.onNext=function(t){if(!this.isStopped){this.hasValue||(this.hasValue=!0);try{this.hasAccumulation?this.accumulation=this.accumulator(this.accumulation,t):(this.accumulation=this.hasSeed?this.accumulator(this.seed,t):t,this.hasAccumulation=!0)}catch(t){return this.observer.onError(t)}this.observer.onNext(this.accumulation)}},P.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.observer.onError(t))},P.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,!this.hasValue&&this.hasSeed&&this.observer.onNext(this.seed),this.observer.onCompleted())},P.prototype.dispose=function(){this.isStopped=!0},P.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.observer.onError(t),!0)},Be.scan=function(){var t,e,r=!1;return e=2===arguments.length?(r=!0,t=arguments[0],arguments[1]):arguments[0],new ai(this,e,r,t)},Be.skipLast=function(n){if(n<0)throw new Q;var t=this;return new wi(function(e){var r=[];return t.subscribe(function(t){r.push(t),r.length>n&&e.onNext(r.shift())},function(t){e.onError(t)},function(){e.onCompleted()})},t)},Be.startWith=function(){var t,e=0;arguments.length&&ne(arguments[0])?(t=arguments[0],e=1):t=he;for(var r=[],n=e,i=arguments.length;n<i;n++)r.push(arguments[n]);return vr([Wr(r,t),this]).concat()},Be.takeLast=function(n){if(n<0)throw new Q;var t=this;return new wi(function(e){var r=[];return t.subscribe(function(t){r.push(t),r.length>n&&r.shift()},function(t){e.onError(t)},function(){for(;0<r.length;)e.onNext(r.shift());e.onCompleted()})},t)},Be.takeLastBuffer=function(n){var t=this;return new wi(function(e){var r=[];return t.subscribe(function(t){r.push(t),r.length>n&&r.shift()},function(t){e.onError(t)},function(){e.onNext(r),e.onCompleted()})},t)},Be.windowWithCount=function(s,u){var n=this;if(+s||(s=0),Math.abs(s)===1/0&&(s=0),s<=0)throw new Q;if(null==u&&(u=s),+u||(u=0),Math.abs(u)===1/0&&(u=0),u<=0)throw new Q;return new wi(function(e){function i(){var t=new Oi;a.push(t),e.onNext(Dt(t,r))}var t=new Wt,r=new Yt(t),o=0,a=[];return i(),t.setDisposable(n.subscribe(function(t){for(var e=0,r=a.length;e<r;e++)a[e].onNext(t);var n=o-s+1;0<=n&&n%u==0&&a.shift().onCompleted(),++o%u==0&&i()},function(t){for(;0<a.length;)a.shift().onError(t);e.onError(t)},function(){for(;0<a.length;)a.shift().onCompleted();e.onCompleted()})),r},n)},Be.selectConcat=Be.concatMap=function(e,i,t){return W(e)&&W(i)?this.concatMap(function(r,n){var t=e(r,n);return $(t)&&(t=Cr(t)),(st(t)||at(t))&&(t=qr(t)),t.map(function(t,e){return i(r,t,n,e)})}):W(e)?O(this,e,t):O(this,function(){return e})},Be.concatMapObserver=Be.selectConcatObserver=function(t,e,r,n){var i=this,o=ut(t,n,2),a=ut(e,n,1),s=ut(r,n,0);return new wi(function(r){var n=0;return i.subscribe(function(t){var e;try{e=o(t,n++)}catch(t){return void r.onError(t)}$(e)&&(e=Cr(e)),r.onNext(e)},function(t){var e;try{e=a(t)}catch(t){return void r.onError(t)}$(e)&&(e=Cr(e)),r.onNext(e),r.onCompleted()},function(){var t;try{t=s()}catch(t){return void r.onError(t)}$(t)&&(t=Cr(t)),r.onNext(t),r.onCompleted()})},this).concatAll()},Be.defaultIfEmpty=function(t){var n=this;return t===u&&(t=null),new wi(function(e){var r=!1;return n.subscribe(function(t){r=!0,e.onNext(t)},function(t){e.onError(t)},function(){r||e.onNext(t),e.onCompleted()})},n)},A.prototype.push=function(t){var e=-1===function(t,e,r){for(var n=0,i=t.length;n<i;n++)if(r(t[n],e))return n;return-1}(this.set,t,this.comparer);return e&&this.set.push(t),e},Be.distinct=function(i,t){var e=this;return t=t||G,new wi(function(r){var n=new A(t);return e.subscribe(function(t){var e=t;if(i)try{e=i(t)}catch(t){return void r.onError(t)}n.push(e)&&r.onNext(t)},function(t){r.onError(t)},function(){r.onCompleted()})},this)};var ui,ci=(Nt(li,ui=Qe),li.prototype.internalMap=function(t,e){return new li(this.source,function(n,i){return function(t,e,r){return n.call(this,i.selector(t,e,r),e,r)}}(t,this),e)},li.prototype.subscribeCore=function(t){return this.source.subscribe(new hi(t,this.selector,this))},hi.prototype.onNext=function(t){if(!this.isStopped){var e=h(this.selector)(t,this.i++,this.source);return e===jt?this.o.onError(e.e):void this.o.onNext(e)}},hi.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},hi.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},hi.prototype.dispose=function(){this.isStopped=!0},hi.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.o.onError(t),!0)},li);function li(t,e,r){this.source=t,this.selector=ut(e,r,3),ui.call(this)}function hi(t,e,r){this.o=t,this.selector=e,this.source=r,this.i=0,this.isStopped=!1}Be.map=Be.select=function(t,e){var r="function"==typeof t?t:function(){return t};return this instanceof ci?this.internalMap(r,e):new ci(this,r,e)},Be.pluck=function(){var i=arguments,o=arguments.length;if(0===o)throw new Error("List of properties cannot be empty.");return this.map(function(t){for(var e=t,r=0;r<o;r++){var n=e[i[r]];if(void 0===n)return u;e=n}return e})},Be.flatMapObserver=Be.selectManyObserver=function(i,o,e,a){var t=this;return new wi(function(r){var n=0;return t.subscribe(function(t){var e;try{e=i.call(a,t,n++)}catch(t){return void r.onError(t)}$(e)&&(e=Cr(e)),r.onNext(e)},function(t){var e;try{e=o.call(a,t)}catch(t){return void r.onError(t)}$(e)&&(e=Cr(e)),r.onNext(e),r.onCompleted()},function(){var t;try{t=e.call(a)}catch(t){return void r.onError(t)}$(t)&&(t=Cr(t)),r.onNext(t),r.onCompleted()})},t).mergeAll()},Be.selectMany=Be.flatMap=function(e,i,t){return W(e)&&W(i)?this.flatMap(function(r,n){var t=e(r,n);return $(t)&&(t=Cr(t)),(st(t)||at(t))&&(t=qr(t)),t.map(function(t,e){return i(r,t,n,e)})},t):W(e)?I(this,e,t):I(this,function(){return e})},Be.selectSwitch=Be.flatMapLatest=Be.switchMap=function(t,e){return this.select(t,e).switchLatest()};var pi,fi=(Nt(di,pi=Qe),di.prototype.subscribeCore=function(t){return this.source.subscribe(new mi(t,this.skipCount))},mi.prototype.onNext=function(t){this.isStopped||(this.r<=0?this.o.onNext(t):this.r--)},mi.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},mi.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},mi.prototype.dispose=function(){this.isStopped=!0},mi.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.o.onError(t),!0)},di);function di(t,e){this.source=t,this.skipCount=e,pi.call(this)}function mi(t,e){this.c=e,this.r=e,this.o=t,this.isStopped=!1}Be.skip=function(t){if(t<0)throw new Q;return new fi(this,t)},Be.skipWhile=function(t,e){var i=this,o=ut(t,e,3);return new wi(function(e){var r=0,n=!1;return i.subscribe(function(t){if(!n)try{n=!o(t,r++,i)}catch(t){return void e.onError(t)}n&&e.onNext(t)},function(t){e.onError(t)},function(){e.onCompleted()})},i)},Be.take=function(t,e){if(t<0)throw new Q;if(0===t)return Nr(e);var n=this;return new wi(function(e){var r=t;return n.subscribe(function(t){0<r--&&(e.onNext(t),r<=0&&e.onCompleted())},function(t){e.onError(t)},function(){e.onCompleted()})},n)},Be.takeWhile=function(t,e){var i=this,o=ut(t,e,3);return new wi(function(e){var r=0,n=!0;return i.subscribe(function(t){if(n){try{n=o(t,r++,i)}catch(t){return void e.onError(t)}n?e.onNext(t):e.onCompleted()}},function(t){e.onError(t)},function(){e.onCompleted()})},i)};var gi,yi=(Nt(vi,gi=Qe),vi.prototype.subscribeCore=function(t){return this.source.subscribe(new _i(t,this.predicate,this))},vi.prototype.internalFilter=function(t,e){return new vi(this.source,function(n,i){return function(t,e,r){return i.predicate(t,e,r)&&n.call(this,t,e,r)}}(t,this),e)},_i.prototype.onNext=function(t){if(!this.isStopped){var e=h(this.predicate)(t,this.i++,this.source);return e===jt?this.o.onError(e.e):void(e&&this.o.onNext(t))}},_i.prototype.onError=function(t){this.isStopped||(this.isStopped=!0,this.o.onError(t))},_i.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.o.onCompleted())},_i.prototype.dispose=function(){this.isStopped=!0},_i.prototype.fail=function(t){return!this.isStopped&&(this.isStopped=!0,this.o.onError(t),!0)},vi);function vi(t,e,r){this.source=t,this.predicate=ut(e,r,3),gi.call(this)}function _i(t,e,r){this.o=t,this.predicate=e,this.source=r,this.i=0,this.isStopped=!1}Be.filter=Be.where=function(t,e){return this instanceof yi?this.internalFilter(t,e):new yi(this,t,e)},Be.transduce=function(t){var n=this;return new wi(function(e){var r=t(function(t){return{"@@transducer/init":function(){return t},"@@transducer/step":function(t,e){return t.onNext(e)},"@@transducer/result":function(t){return t.onCompleted()}}}(e));return n.subscribe(function(t){try{r["@@transducer/step"](e,t)}catch(t){e.onError(t)}},function(t){e.onError(t)},function(){r["@@transducer/result"](e)})},n)};function bi(t,e){this.subject=t,this.observer=e}var xi,wi=F.AnonymousObservable=(Nt(Ci,xi=Je),Ci),Si=function(e){function t(t){e.call(this),this.observer=t,this.m=new Wt}Nt(t,e);var r=t.prototype;return r.next=function(t){var e=h(this.observer.onNext).call(this.observer,t);e===jt&&(this.dispose(),l(e.e))},r.error=function(t){var e=h(this.observer.onError).call(this.observer,t);this.dispose(),e===jt&&l(e.e)},r.completed=function(){var t=h(this.observer.onCompleted).call(this.observer);this.dispose(),t===jt&&l(t.e)},r.setDisposable=function(t){this.m.setDisposable(t)},r.getDisposable=function(){return this.m.getDisposable()},r.dispose=function(){e.prototype.dispose.call(this),this.m.dispose()},t}(We);function Ei(t,e){var r=e[0],n=h(e[1])(r);return n!==jt||r.fail(jt.e)?void r.setDisposable(function(t){return t&&W(t.dispose)?t:W(t)?Gt(t):qt}(n)):l(jt.e)}function Ci(n,t){this.source=t,xi.call(this,function(t){var e=new Si(t),r=[e,n];return pe.scheduleRequired()?pe.scheduleWithState(r,Ei):Ei(0,r),e})}bi.prototype.dispose=function(){if(!this.subject.isDisposed&&null!==this.observer){var t=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(t,1),this.observer=null}};var Mi,Ti,Pi,Oi=F.Subject=(Nt(Di,Pi=Je),kt(Di.prototype,Ee.prototype,{hasObservers:function(){return 0<this.observers.length},onCompleted:function(){if($t(this),!this.isStopped){this.isStopped=!0;for(var t=0,e=i(this.observers),r=e.length;t<r;t++)e[t].onCompleted();this.observers.length=0}},onError:function(t){if($t(this),!this.isStopped){this.isStopped=!0,this.error=t,this.hasError=!0;for(var e=0,r=i(this.observers),n=r.length;e<n;e++)r[e].onError(t);this.observers.length=0}},onNext:function(t){if($t(this),!this.isStopped)for(var e=0,r=i(this.observers),n=r.length;e<n;e++)r[e].onNext(t)},dispose:function(){this.isDisposed=!0,this.observers=null}}),Di.create=function(t,e){return new Ai(t,e)},Di),Ai=(F.AsyncSubject=(Nt(Ni,Ti=Je),kt(Ni.prototype,Ee,{hasObservers:function(){return $t(this),0<this.observers.length},onCompleted:function(){var t;if($t(this),!this.isStopped){this.isStopped=!0;var e=i(this.observers),r=e.length;if(this.hasValue)for(t=0;t<r;t++){var n=e[t];n.onNext(this.value),n.onCompleted()}else for(t=0;t<r;t++)e[t].onCompleted();this.observers.length=0}},onError:function(t){if($t(this),!this.isStopped){this.isStopped=!0,this.hasError=!0,this.error=t;for(var e=0,r=i(this.observers),n=r.length;e<n;e++)r[e].onError(t);this.observers.length=0}},onNext:function(t){$t(this),this.isStopped||(this.value=t,this.hasValue=!0)},dispose:function(){this.isDisposed=!0,this.observers=null,this.exception=null,this.value=null}}),Ni),F.AnonymousSubject=(Nt(Li,Mi=Je),kt(Li.prototype,Ee.prototype,{onCompleted:function(){this.observer.onCompleted()},onError:function(t){this.observer.onError(t)},onNext:function(t){this.observer.onNext(t)}}),Li));function Ii(t){return this.observable.subscribe(t)}function Li(t,e){this.observer=t,this.observable=e,Mi.call(this,Ii)}function Ri(t){return $t(this),this.isStopped?(this.hasError?t.onError(this.error):(this.hasValue&&t.onNext(this.value),t.onCompleted()),qt):(this.observers.push(t),new bi(this,t))}function Ni(){Ti.call(this,Ri),this.isDisposed=!1,this.isStopped=!1,this.hasValue=!1,this.observers=[],this.hasError=!1}function ki(t){return $t(this),this.isStopped?(this.hasError?t.onError(this.error):t.onCompleted(),qt):(this.observers.push(t),new bi(this,t))}function Di(){Pi.call(this,ki),this.isDisposed=!1,this.isStopped=!1,this.observers=[],this.hasError=!1}N&&k?D?(k.exports=F).Rx=F:N.Rx=F:R.Rx=F;var ji=t()}).call(this)}).call(this,t(150),void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{150:150}]},{},[1])(1)})}).call(this,void 0!==a?a:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],16:[function(i,o,t){(function(t){var e,r=void 0!==t?t:"undefined"!=typeof window?window:{},n=i("min-document");e="undefined"!=typeof document?document:(e=r["__GLOBAL_DOCUMENT_CACHE@4"])||(r["__GLOBAL_DOCUMENT_CACHE@4"]=n),o.exports=e}).call(this,void 0!==a?a:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"min-document":4}],17:[function(t,e,r){r.read=function(t,e,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,c=u>>1,l=-7,h=r?i-1:0,p=r?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-l)-1,f>>=-l,l+=s;0<l;o=256*o+t[e+h],h+=p,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;0<l;a=256*a+t[e+h],h+=p,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),o-=c}return(f?-1:1)*a*Math.pow(2,o-n)},r.write=function(t,e,r,n,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,h=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,d=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),2<=(e+=1<=a+h?p/u:p*Math.pow(2,1-h))*u&&(a++,u/=2),l<=a+h?(s=0,a=l):1<=a+h?(s=(e*u-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));8<=i;t[r+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,c+=i;0<c;t[r+f]=255&a,f+=d,a/=256,c-=8);t[r+f-d]|=128*m}},{}],18:[function(t,e,r){(function(t){"use strict";var r="undefined"!=typeof window?window:void 0!==t?t:{};e.exports=function(t,e){if(t in r)return r[t];return r[t]=e}}).call(this,void 0!==a?a:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(t,e,r){"use strict";var o=t("./index.js");e.exports=function(t,e,r){var n="__INDIVIDUAL_ONE_VERSION_"+t,i=o(n+"_ENFORCE_SINGLETON",e);if(i===e)return o(n,r);throw new Error("Can only have one copy of "+t+".\nYou already have version "+i+" installed.\nThis means you cannot install version "+e)}},{"./index.js":18}],20:[function(t,e,r){"use strict";e.exports=function(t){return"object"==typeof t&&null!==t}},{}],21:[function(t,e,r){"use strict";var g={base32:"0123456789bcdefghjkmnpqrstuvwxyz",encode:function(t,e,r){if(void 0===r){for(var n=1;n<=12;n++){var i=g.encode(t,e,n),o=g.decode(i);if(o.lat==t&&o.lon==e)return i}r=12}if(t=Number(t),e=Number(e),r=Number(r),isNaN(t)||isNaN(e)||isNaN(r))throw new Error("Invalid geohash");for(var a=0,s=0,u=!0,c="",l=-90,h=90,p=-180,f=180;c.length<r;){if(u){var d=(p+f)/2;d<=e?(a=2*a+1,p=d):(a*=2,f=d)}else{var m=(l+h)/2;m<=t?(a=2*a+1,l=m):(a*=2,h=m)}u=!u,5==++s&&(c+=g.base32.charAt(a),a=s=0)}return c},decode:function(t){var e=g.bounds(t),r=e.sw.lat,n=e.sw.lon,i=e.ne.lat,o=e.ne.lon,a=(r+i)/2,s=(n+o)/2;return a=a.toFixed(Math.floor(2-Math.log(i-r)/Math.LN10)),s=s.toFixed(Math.floor(2-Math.log(o-n)/Math.LN10)),{lat:Number(a),lon:Number(s)}},bounds:function(t){if(0===t.length)throw new Error("Invalid geohash");t=t.toLowerCase();for(var e=!0,r=-90,n=90,i=-180,o=180,a=0;a<t.length;a++){var s=t.charAt(a),u=g.base32.indexOf(s);if(-1==u)throw new Error("Invalid geohash");for(var c=4;0<=c;c--){var l=u>>c&1;if(e){var h=(i+o)/2;1==l?i=h:o=h}else{var p=(r+n)/2;1==l?r=p:n=p}e=!e}}return{sw:{lat:r,lon:i},ne:{lat:n,lon:o}}},adjacent:function(t,e){if(t=t.toLowerCase(),e=e.toLowerCase(),0===t.length)throw new Error("Invalid geohash");if(-1=="nsew".indexOf(e))throw new Error("Invalid direction");var r=t.slice(-1),n=t.slice(0,-1),i=t.length%2;return-1!={n:["prxz","bcfguvyz"],s:["028b","0145hjnp"],e:["bcfguvyz","prxz"],w:["0145hjnp","028b"]}[e][i].indexOf(r)&&""!==n&&(n=g.adjacent(n,e)),n+g.base32.charAt({n:["p0r21436x8zb9dcf5h7kjnmqesgutwvy","bc01fg45238967deuvhjyznpkmstqrwx"],s:["14365h7k9dcfesgujnmqp0r2twvyx8zb","238967debc01fg45kmstqrwxuvhjyznp"],e:["bc01fg45238967deuvhjyznpkmstqrwx","p0r21436x8zb9dcf5h7kjnmqesgutwvy"],w:["238967debc01fg45kmstqrwxuvhjyznp","14365h7k9dcfesgujnmqp0r2twvyx8zb"]}[e][i].indexOf(r))},neighbours:function(t){return{n:g.adjacent(t,"n"),ne:g.adjacent(g.adjacent(t,"n"),"e"),e:g.adjacent(t,"e"),se:g.adjacent(g.adjacent(t,"s"),"e"),s:g.adjacent(t,"s"),sw:g.adjacent(g.adjacent(t,"s"),"w"),w:g.adjacent(t,"w"),nw:g.adjacent(g.adjacent(t,"n"),"w")}}};void 0!==e&&e.exports&&(e.exports=g)},{}],22:[function(t,e,r){var n;n=this,function(t){"use strict";function r(t,e){return e<t?1:t<e?-1:0}var m=function(t,e){void 0===t&&(t=r),void 0===e&&(e=!1),this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!e},e={size:{configurable:!0}};m.prototype.rotateLeft=function(t){var e=t.right;e&&(t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.left=t),t.parent=e},m.prototype.rotateRight=function(t){var e=t.left;e&&(t.left=e.right,e.right&&(e.right.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.right=t),t.parent=e},m.prototype._splay=function(t){for(var e=this;t.parent;){var r=t.parent;r.parent?r.left===t&&r.parent.left===r?(e.rotateRight(r.parent),e.rotateRight(r)):r.right===t&&r.parent.right===r?(e.rotateLeft(r.parent),e.rotateLeft(r)):r.left===t&&r.parent.right===r?(e.rotateRight(r),e.rotateLeft(r)):(e.rotateLeft(r),e.rotateRight(r)):r.left===t?e.rotateRight(r):e.rotateLeft(r)}},m.prototype.splay=function(t){for(var e,r,n,i,o;t.parent;)(r=(e=t.parent).parent)&&r.parent?((n=r.parent).left===r?n.left=t:n.right=t,t.parent=n):(t.parent=null,this._root=t),i=t.left,o=t.right,t===e.left?(r&&(r.left===e?(e.right?(r.left=e.right,r.left.parent=r):r.left=null,(e.right=r).parent=e):(i?(r.right=i).parent=r:r.right=null,(t.left=r).parent=t)),o?(e.left=o).parent=e:e.left=null,(t.right=e).parent=t):(r&&(r.right===e?(e.left?(r.right=e.left,r.right.parent=r):r.right=null,(e.left=r).parent=e):(o?(r.left=o).parent=r:r.left=null,(t.right=r).parent=t)),i?(e.right=i).parent=e:e.right=null,(t.left=e).parent=t)},m.prototype.replace=function(t,e){t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.parent=t.parent)},m.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},m.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},m.prototype.insert=function(t,e){var r=this._root,n=null,i=this._compare;if(this._noDuplicates)for(;r;){if(0===i((n=r).key,t))return;r=i(r.key,t)<0?r.right:r.left}else for(;r;)r=i((n=r).key,t)<0?r.right:r.left;return r={key:t,data:e,left:null,right:null,parent:n},n?i(n.key,r.key)<0?n.right=r:n.left=r:this._root=r,this.splay(r),this._size++,r},m.prototype.find=function(t){for(var e=this._root,r=this._compare;e;){var n=r(e.key,t);if(n<0)e=e.right;else{if(!(0<n))return e;e=e.left}}return null},m.prototype.contains=function(t){for(var e=this._root,r=this._compare;e;){var n=r(t,e.key);if(0===n)return!0;e=n<0?e.left:e.right}return!1},m.prototype.remove=function(t){var e=this.find(t);if(!e)return!1;if(this.splay(e),e.left)if(e.right){var r=this.minNode(e.right);r.parent!==e&&(this.replace(r,r.right),r.right=e.right,r.right.parent=r),this.replace(e,r),r.left=e.left,r.left.parent=r}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0},m.prototype.removeNode=function(t){if(!t)return!1;if(this.splay(t),t.left)if(t.right){var e=this.minNode(t.right);e.parent!==t&&(this.replace(e,e.right),e.right=t.right,e.right.parent=e),this.replace(t,e),e.left=t.left,e.left.parent=e}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0},m.prototype.erase=function(t){var e=this.find(t);if(e){this.splay(e);var r=e.left,n=e.right,i=null;r&&(r.parent=null,i=this.maxNode(r),this.splay(i),this._root=i),n&&(r?i.right=n:this._root=n,n.parent=i),this._size--}},m.prototype.pop=function(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key)}return e},m.prototype.next=function(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)e=(t=e).parent;return e},m.prototype.prev=function(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)e=(t=e).parent;return e},m.prototype.forEach=function(t){for(var e=this._root,r=[],n=!1,i=0;!n;)e?(r.push(e),e=e.left):0<r.length?(t(e=r.pop(),i++),e=e.right):n=!0;return this},m.prototype.range=function(t,e,r,n){for(var i=[],o=this._compare,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(0<o((a=i.pop()).key,e))break;if(0<=o(a.key,t)&&r.call(n,a))return this;a=a.right}return this},m.prototype.keys=function(){for(var t=this._root,e=[],r=[],n=!1;!n;)t?(e.push(t),t=t.left):0<e.length?(t=e.pop(),r.push(t.key),t=t.right):n=!0;return r},m.prototype.values=function(){for(var t=this._root,e=[],r=[],n=!1;!n;)t?(e.push(t),t=t.left):0<e.length?(t=e.pop(),r.push(t.data),t=t.right):n=!0;return r},m.prototype.at=function(t){for(var e=this._root,r=[],n=!1,i=0;!n;)if(e)r.push(e),e=e.left;else if(0<r.length){if(e=r.pop(),i===t)return e;i++,e=e.right}else n=!0;return null},m.prototype.load=function(t,e,r){if(void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===r&&(r=!1),0!==this._size)throw new Error("bulk-load: tree is not empty");var n=t.length;return r&&function t(e,r,n,i,o){if(i<=n)return;var a=e[n+i>>1];var s=n-1;var u=i+1;for(;;){for(;o(e[++s],a)<0;);for(;0<o(e[--u],a););if(u<=s)break;var c=e[s];e[s]=e[u],e[u]=c,c=r[s],r[s]=r[u],r[u]=c}t(e,r,n,u,o);t(e,r,u+1,i,o)}(t,e,0,n-1,this._compare),this._root=function t(e,r,n,i,o){var a=o-i;if(0<a){var s=i+Math.floor(a/2),u=r[s],c=n[s],l={key:u,data:c,parent:e};return l.left=t(l,r,n,i,s),l.right=t(l,r,n,s+1,o),l}return null}(null,t,e,0,n),this._size=n,this},m.prototype.min=function(){var t=this.minNode(this._root);return t?t.key:null},m.prototype.max=function(){var t=this.maxNode(this._root);return t?t.key:null},m.prototype.isEmpty=function(){return null===this._root},e.size.get=function(){return this._size},m.createTree=function(t,e,r,n,i){return new m(r,i).load(t,e,n)},Object.defineProperties(m.prototype,e);var o=0,u=1,c=2,l=3,g=0,s=1,y=2,h=3;function v(t,e,r){null===e?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===e.isSubject?(t.inOut=!e.inOut,t.otherInOut=e.otherInOut):(t.inOut=!e.otherInOut,t.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(t.prevInResult=!n(e,r)||e.isVertical()?e.prevInResult:e)),t.inResult=n(t,r)}function n(t,e){switch(t.type){case o:switch(e){case g:return!t.otherInOut;case s:return t.otherInOut;case y:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case h:return!0}break;case c:return e===g||e===s;case l:return e===y;case u:return!1}return!1}var d=function(t,e,r,n,i){this.left=e,this.point=t,this.otherEvent=r,this.isSubject=n,this.type=i||o,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.inResult=!1,this.resultInOut=!1,this.isExteriorRing=!0};function p(t,e){return t[0]===e[0]&&t[1]===e[1]}function i(t,e,r){return(t[0]-r[0])*(e[1]-r[1])-(e[0]-r[0])*(t[1]-r[1])}function _(t,e){var r=t.point,n=e.point;return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]!==n[1]?r[1]>n[1]?1:-1:function(t,e,r){return t.left===e.left?0===i(r,t.otherEvent.point,e.otherEvent.point)?!t.isSubject&&e.isSubject?1:-1:t.isBelow(e.otherEvent.point)?-1:1:t.left?1:-1}(t,e,r)}function f(t,e,r){var n=new d(e,!1,t,t.isSubject),i=new d(e,!0,t.otherEvent,t.isSubject);return p(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),n.contourId=i.contourId=t.contourId,0<_(i,t.otherEvent)&&(t.otherEvent.left=!0,i.left=!1),t.otherEvent.otherEvent=i,t.otherEvent=n,r.push(i),r.push(n),r}function b(t,e){return t[0]*e[1]-t[1]*e[0]}function x(t,e){return t[0]*e[0]+t[1]*e[1]}function w(t,e,r){var n=function(t,e,r,n,i){var o=[e[0]-t[0],e[1]-t[1]],a=[n[0]-r[0],n[1]-r[1]];function s(t,e,r){return[t[0]+e*r[0],t[1]+e*r[1]]}var u=[r[0]-t[0],r[1]-t[1]],c=b(o,a),l=c*c,h=x(o,o);if(0<l){var p=b(u,a)/c;if(p<0||1<p)return null;var f=b(u,o)/c;return f<0||1<f?null:0==p||1==p?i?null:[s(t,p,o)]:0==f||1==f?i?null:[s(r,f,a)]:[s(t,p,o)]}if(0<(l=(c=b(u,o))*c))return null;var d=x(o,u)/h,m=d+x(o,a)/h,g=Math.min(d,m),y=Math.max(d,m);return g<=1&&0<=y?1===g?i?null:[s(t,0<g?g:0,o)]:0===y?i?null:[s(t,y<1?y:1,o)]:i&&0===g&&1===y?null:[s(t,0<g?g:0,o),s(t,y<1?y:1,o)]:null}(t.point,t.otherEvent.point,e.point,e.otherEvent.point),i=n?n.length:0;if(0===i)return 0;if(1===i&&(p(t.point,e.point)||p(t.otherEvent.point,e.otherEvent.point)))return 0;if(2===i&&t.isSubject===e.isSubject)return 0;if(1===i)return p(t.point,n[0])||p(t.otherEvent.point,n[0])||f(t,n[0],r),p(e.point,n[0])||p(e.otherEvent.point,n[0])||f(e,n[0],r),1;var o=[],a=!1,s=!1;return p(t.point,e.point)?a=!0:1===_(t,e)?o.push(e,t):o.push(t,e),p(t.otherEvent.point,e.otherEvent.point)?s=!0:1===_(t.otherEvent,e.otherEvent)?o.push(e.otherEvent,t.otherEvent):o.push(t.otherEvent,e.otherEvent),a&&s||a?(e.type=u,t.type=e.inOut===t.inOut?c:l,a&&!s&&f(o[1].otherEvent,o[0].point,r),2):(s?f(o[0],o[1].point,r):o[0]!==o[3].otherEvent?(f(o[0],o[1].point,r),f(o[1],o[2].point,r)):(f(o[0],o[1].point,r),f(o[3].otherEvent,o[2].point,r)),3)}function S(t,e){if(t===e)return 0;if(0!==i(t.point,t.otherEvent.point,e.point)||0!==i(t.point,t.otherEvent.point,e.otherEvent.point))return p(t.point,e.point)?t.isBelow(e.otherEvent.point)?-1:1:t.point[0]===e.point[0]?t.point[1]<e.point[1]?-1:1:1===_(t,e)?e.isAbove(t.point)?-1:1:t.isBelow(e.point)?-1:1;if(t.isSubject!==e.isSubject)return t.isSubject?-1:1;var r=t.point,n=e.point;return r[0]===n[0]&&r[1]===n[1]?(r=t.otherEvent.point,n=e.otherEvent.point,r[0]===n[0]&&r[1]===n[1]?0:t.contourId>e.contourId?1:-1):1===_(t,e)?1:-1}function E(t,e,r,n){var i,o,a=t+1,s=e.length;for(i=e[t].point,a<s&&(o=e[a].point);a<s&&o[0]===i[0]&&o[1]===i[1];){if(!r[a])return a;o=e[++a].point}for(a=t-1;r[a]&&n<=a;)a--;return a}function C(t,e){var r,n,i,o=function(t){var e,r,n,i,o=[];for(r=0,n=t.length;r<n;r++)((e=t[r]).left&&e.inResult||!e.left&&e.otherEvent.inResult)&&o.push(e);for(var a=!1;!a;)for(a=!0,r=0,n=o.length;r<n;r++)r+1<n&&1===_(o[r],o[r+1])&&(i=o[r],o[r]=o[r+1],o[r+1]=i,a=!1);for(r=0,n=o.length;r<n;r++)(e=o[r]).pos=r;for(r=0,n=o.length;r<n;r++)(e=o[r]).left||(i=e.pos,e.pos=e.otherEvent.pos,e.otherEvent.pos=i);return o}(t),a={},s=[];for(r=0,n=o.length;r<n;r++)if(!a[r]){var u=[[]];o[r].isExteriorRing?e===y&&!o[r].isSubject&&1<s.length?s[s.length-1].push(u[0]):s.push(u):e!==y||o[r].isSubject||0!==s.length?0===s.length?s.push([[u]]):s[s.length-1].push(u[0]):s.push(u);var c=s.length-1,l=r,h=o[r].point;for(u[0].push(h);r<=l;)i=o[l],a[l]=!0,i.left?(i.resultInOut=!1,i.contourId=c):(i.otherEvent.resultInOut=!0,i.otherEvent.contourId=c),a[l=i.pos]=!0,u[0].push(o[l].point),l=E(l,o,a,r);i=o[l=-1===l?r:l],a[l]=a[i.pos]=!0,i.otherEvent.resultInOut=!0,i.otherEvent.contourId=c}return s}d.prototype.isBelow=function(t){var e=this.point,r=this.otherEvent.point;return this.left?0<(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1]):0<(r[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(r[1]-t[1])},d.prototype.isAbove=function(t){return!this.isBelow(t)},d.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},d.prototype.clone=function(){var t=new d(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.inResult=this.inResult,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t};var M=T,a=T;function T(t,e){if(!(this instanceof T))return new T(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||P,0<this.length)for(var r=(this.length>>1)-1;0<=r;r--)this._down(r)}function P(t,e){return t<e?-1:e<t?1:0}T.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,r=this.compare,n=e[t];0<t;){var i=t-1>>1,o=e[i];if(0<=r(n,o))break;e[t]=o,t=i}e[t]=n},_down:function(t){for(var e=this.data,r=this.compare,n=this.length>>1,i=e[t];t<n;){var o=1+(t<<1),a=o+1,s=e[o];if(a<this.length&&r(e[a],s)<0&&(s=e[o=a]),0<=r(s,i))break;e[t]=s,t=o}e[t]=i}},M.default=a;var O=Math.max,A=Math.min,I=0;function L(t,e,r,n,i,o){var a,s,u,c,l,h;for(a=0,s=t.length-1;a<s;a++)if(u=t[a],c=t[a+1],l=new d(u,!1,void 0,e),h=new d(c,!1,l,e),l.otherEvent=h,u[0]!==c[0]||u[1]!==c[1]){l.contourId=h.contourId=r,o||(l.isExteriorRing=!1,h.isExteriorRing=!1),0<_(l,h)?h.left=!0:l.left=!0;var p=u[0],f=u[1];i[0]=A(i[0],p),i[1]=A(i[1],f),i[2]=O(i[2],p),i[3]=O(i[3],f),n.push(l),n.push(h)}}var R=[];function N(t,e,r){"number"==typeof t[0][0][0]&&(t=[t]),"number"==typeof e[0][0][0]&&(e=[e]);var n=function(t,e,r){var n=null;return t.length*e.length==0&&(r===g?n=R:r===y?n=t:r!==s&&r!==h||(n=0===t.length?e:t)),n}(t,e,r);if(n)return n===R?null:n;var i=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],a=function(t,e,r,n,i){var o,a,s,u,c,l,h=new M(null,_);for(s=0,u=t.length;s<u;s++)for(c=0,l=(o=t[s]).length;c<l;c++)(a=0===c)&&I++,L(o[c],!0,I,h,r,a);for(s=0,u=e.length;s<u;s++)for(c=0,l=(o=e[s]).length;c<l;c++)a=0===c,i===y&&(a=!1),a&&I++,L(o[c],!1,I,h,n,a);return h}(t,e,i,o,r);return(n=function(t,e,r,n,i){var o=null;return(r[0]>n[2]||n[0]>r[2]||r[1]>n[3]||n[1]>r[3])&&(i===g?o=R:i===y?o=t:i!==s&&i!==h||(o=t.concat(e))),o}(t,e,i,o,r))?n===R?null:n:C(function(t,e,r,n,i,o){for(var a,s,u,c=new m(S),l=[],h=Math.min(n[2],i[2]);0!==t.length;){var p=t.pop();if(l.push(p),o===g&&p.point[0]>h||o===y&&p.point[0]>n[2])break;if(p.left){s=a=c.insert(p),a=a!==(u=c.minNode())?c.prev(a):null,s=c.next(s);var f=a?a.key:null;if(v(p,f,o),s&&2===w(p,s.key,t)&&(v(p,f,o),v(p,s.key,o)),a&&2===w(a.key,p,t)){var d=a;v(f,(d=d!==u?c.prev(d):null)?d.key:null,o),v(p,f,o)}}else p=p.otherEvent,s=a=c.find(p),a&&s&&(a=a!==u?c.prev(a):null,s=c.next(s),c.remove(p),s&&a&&w(a.key,s.key,t))}return l}(a,0,0,i,o,r),r)}var k={UNION:s,DIFFERENCE:y,INTERSECTION:g,XOR:h};t.union=function(t,e){return N(t,e,s)},t.diff=function(t,e){return N(t,e,y)},t.xor=function(t,e){return N(t,e,h)},t.intersection=function(t,e){return N(t,e,g)},t.operations=k,Object.defineProperty(t,"__esModule",{value:!0})}("object"==typeof r&&void 0!==e?r:n.martinez={})},{}],23:[function(t,e,r){"use strict";var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=n},{"./lib/deflate":24,"./lib/inflate":25,"./lib/utils/common":26,"./lib/zlib/constants":29}],24:[function(t,e,r){"use strict";var a=t("./zlib/deflate"),s=t("./utils/common"),u=t("./utils/strings"),i=t("./zlib/messages"),o=t("./zlib/zstream"),c=Object.prototype.toString,l=0,h=-1,p=0,f=8;function d(t){if(!(this instanceof d))return new d(t);this.options=s.assign({level:h,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var r=a.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==l)throw new Error(i[r]);if(e.header&&a.deflateSetHeader(this.strm,e.header),e.dictionary){var n;if(n="string"==typeof e.dictionary?u.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(r=a.deflateSetDictionary(this.strm,n))!==l)throw new Error(i[r]);this._dict_set=!0}}function n(t,e){var r=new d(e);if(r.push(t,!0),r.err)throw r.msg||i[r.err];return r.result}d.prototype.push=function(t,e){var r,n,i=this.strm,o=this.options.chunkSize;if(this.ended)return!1;n=e===~~e?e:!0===e?4:0,"string"==typeof t?i.input=u.string2buf(t):"[object ArrayBuffer]"===c.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new s.Buf8(o),i.next_out=0,i.avail_out=o),1!==(r=a.deflate(i,n))&&r!==l)return this.onEnd(r),!(this.ended=!0);0!==i.avail_out&&(0!==i.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(u.buf2binstring(s.shrinkBuf(i.output,i.next_out))):this.onData(s.shrinkBuf(i.output,i.next_out)))}while((0<i.avail_in||0===i.avail_out)&&1!==r);return 4===n?(r=a.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===l):2!==n||(this.onEnd(l),!(i.avail_out=0))},d.prototype.onData=function(t){this.chunks.push(t)},d.prototype.onEnd=function(t){t===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Deflate=d,r.deflate=n,r.deflateRaw=function(t,e){return(e=e||{}).raw=!0,n(t,e)},r.gzip=function(t,e){return(e=e||{}).gzip=!0,n(t,e)}},{"./utils/common":26,"./utils/strings":27,"./zlib/deflate":31,"./zlib/messages":36,"./zlib/zstream":38}],25:[function(t,e,r){"use strict";var h=t("./zlib/inflate"),p=t("./utils/common"),f=t("./utils/strings"),d=t("./zlib/constants"),n=t("./zlib/messages"),i=t("./zlib/zstream"),o=t("./zlib/gzheader"),m=Object.prototype.toString;function a(t){if(!(this instanceof a))return new a(t);this.options=p.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;var r=h.inflateInit2(this.strm,e.windowBits);if(r!==d.Z_OK)throw new Error(n[r]);if(this.header=new o,h.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=f.string2buf(e.dictionary):"[object ArrayBuffer]"===m.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=h.inflateSetDictionary(this.strm,e.dictionary))!==d.Z_OK))throw new Error(n[r])}function s(t,e){var r=new a(e);if(r.push(t,!0),r.err)throw r.msg||n[r.err];return r.result}a.prototype.push=function(t,e){var r,n,i,o,a,s=this.strm,u=this.options.chunkSize,c=this.options.dictionary,l=!1;if(this.ended)return!1;n=e===~~e?e:!0===e?d.Z_FINISH:d.Z_NO_FLUSH,"string"==typeof t?s.input=f.binstring2buf(t):"[object ArrayBuffer]"===m.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new p.Buf8(u),s.next_out=0,s.avail_out=u),(r=h.inflate(s,d.Z_NO_FLUSH))===d.Z_NEED_DICT&&c&&(r=h.inflateSetDictionary(this.strm,c)),r===d.Z_BUF_ERROR&&!0===l&&(r=d.Z_OK,l=!1),r!==d.Z_STREAM_END&&r!==d.Z_OK)return this.onEnd(r),!(this.ended=!0);s.next_out&&(0!==s.avail_out&&r!==d.Z_STREAM_END&&(0!==s.avail_in||n!==d.Z_FINISH&&n!==d.Z_SYNC_FLUSH)||("string"===this.options.to?(i=f.utf8border(s.output,s.next_out),o=s.next_out-i,a=f.buf2string(s.output,i),s.next_out=o,s.avail_out=u-o,o&&p.arraySet(s.output,s.output,i,o,0),this.onData(a)):this.onData(p.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(l=!0)}while((0<s.avail_in||0===s.avail_out)&&r!==d.Z_STREAM_END);return r===d.Z_STREAM_END&&(n=d.Z_FINISH),n===d.Z_FINISH?(r=h.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===d.Z_OK):n!==d.Z_SYNC_FLUSH||(this.onEnd(d.Z_OK),!(s.avail_out=0))},a.prototype.onData=function(t){this.chunks.push(t)},a.prototype.onEnd=function(t){t===d.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=p.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Inflate=a,r.inflate=s,r.inflateRaw=function(t,e){return(e=e||{}).raw=!0,s(t,e)},r.ungzip=s},{"./utils/common":26,"./utils/strings":27,"./zlib/constants":29,"./zlib/gzheader":32,"./zlib/inflate":34,"./zlib/messages":36,"./zlib/zstream":38}],26:[function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(t){for(var e,r,n=Array.prototype.slice.call(arguments,1);n.length;){var i=n.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var o in i)e=i,r=o,Object.prototype.hasOwnProperty.call(e,r)&&(t[o]=i[o])}}return t},r.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var i={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),i);else for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){var e,r,n,i,o,a;for(e=n=0,r=t.length;e<r;e++)n+=t[e].length;for(a=new Uint8Array(n),e=i=0,r=t.length;e<r;e++)o=t[e],a.set(o,i),i+=o.length;return a}},o={arraySet:function(t,e,r,n,i){for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){return[].concat.apply([],t)}};r.setTyped=function(t){t?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(n)},{}],27:[function(t,e,r){"use strict";var u=t("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var c=new u.Buf8(256),n=0;n<256;n++)c[n]=252<=n?6:248<=n?5:240<=n?4:224<=n?3:192<=n?2:1;function l(t,e){if(e<65534&&(t.subarray&&o||!t.subarray&&i))return String.fromCharCode.apply(null,u.shrinkBuf(t,e));for(var r="",n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r}c[254]=c[254]=1,r.string2buf=function(t){var e,r,n,i,o,a=t.length,s=0;for(i=0;i<a;i++)55296==(64512&(r=t.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=t.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),s+=r<128?1:r<2048?2:r<65536?3:4;for(e=new u.Buf8(s),i=o=0;o<s;i++)55296==(64512&(r=t.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=t.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?e[o++]=r:(r<2048?e[o++]=192|r>>>6:(r<65536?e[o++]=224|r>>>12:(e[o++]=240|r>>>18,e[o++]=128|r>>>12&63),e[o++]=128|r>>>6&63),e[o++]=128|63&r);return e},r.buf2binstring=function(t){return l(t,t.length)},r.binstring2buf=function(t){for(var e=new u.Buf8(t.length),r=0,n=e.length;r<n;r++)e[r]=t.charCodeAt(r);return e},r.buf2string=function(t,e){var r,n,i,o,a=e||t.length,s=new Array(2*a);for(r=n=0;r<a;)if((i=t[r++])<128)s[n++]=i;else if(4<(o=c[i]))s[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;1<o&&r<a;)i=i<<6|63&t[r++],o--;1<o?s[n++]=65533:i<65536?s[n++]=i:(i-=65536,s[n++]=55296|i>>10&1023,s[n++]=56320|1023&i)}return l(s,n)},r.utf8border=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;0<=r&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+c[t[r]]>e?r:e}},{"./common":26}],28:[function(t,e,r){"use strict";e.exports=function(t,e,r,n){for(var i=65535&t|0,o=t>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;o=o+(i=i+e[n++]|0)|0,--a;);i%=65521,o%=65521}return i|o<<16|0}},{}],29:[function(t,e,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],30:[function(t,e,r){"use strict";var s=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();e.exports=function(t,e,r,n){var i=s,o=n+r;t^=-1;for(var a=n;a<o;a++)t=t>>>8^i[255&(t^e[a])];return-1^t}},{}],31:[function(t,e,r){"use strict";var u,p=t("../utils/common"),c=t("./trees"),f=t("./adler32"),d=t("./crc32"),n=t("./messages"),l=0,h=4,m=0,g=-2,y=-1,v=4,i=2,_=8,b=9,o=286,a=30,s=19,x=2*o+1,w=15,S=3,E=258,C=E+S+1,M=42,T=113,P=1,O=2,A=3,I=4;function L(t,e){return t.msg=n[e],e}function R(t){return(t<<1)-(4<t?9:0)}function N(t){for(var e=t.length;0<=--e;)t[e]=0}function k(t){var e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(p.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function D(t,e){c._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,k(t.strm)}function j(t,e){t.pending_buf[t.pending++]=e}function z(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function F(t,e){var r,n,i=t.max_chain_length,o=t.strstart,a=t.prev_length,s=t.nice_match,u=t.strstart>t.w_size-C?t.strstart-(t.w_size-C):0,c=t.window,l=t.w_mask,h=t.prev,p=t.strstart+E,f=c[o+a-1],d=c[o+a];t.prev_length>=t.good_match&&(i>>=2),s>t.lookahead&&(s=t.lookahead);do{if(c[(r=e)+a]===d&&c[r+a-1]===f&&c[r]===c[o]&&c[++r]===c[o+1]){o+=2,r++;do{}while(c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&o<p);if(n=E-(p-o),o=p-E,a<n){if(t.match_start=e,s<=(a=n))break;f=c[o+a-1],d=c[o+a]}}}while((e=h[e&l])>u&&0!=--i);return a<=t.lookahead?a:t.lookahead}function B(t){var e,r,n,i,o,a,s,u,c,l,h=t.w_size;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=h+(h-C)){for(p.arraySet(t.window,t.window,h,h,0),t.match_start-=h,t.strstart-=h,t.block_start-=h,e=r=t.hash_size;n=t.head[--e],t.head[e]=h<=n?n-h:0,--r;);for(e=r=h;n=t.prev[--e],t.prev[e]=h<=n?n-h:0,--r;);i+=h}if(0===t.strm.avail_in)break;if(a=t.strm,s=t.window,u=t.strstart+t.lookahead,c=i,l=void 0,l=a.avail_in,c<l&&(l=c),r=0===l?0:(a.avail_in-=l,p.arraySet(s,a.input,a.next_in,l,u),1===a.state.wrap?a.adler=f(a.adler,s,l,u):2===a.state.wrap&&(a.adler=d(a.adler,s,l,u)),a.next_in+=l,a.total_in+=l,l),t.lookahead+=r,t.lookahead+t.insert>=S)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+S-1])&t.hash_mask,t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<S)););}while(t.lookahead<C&&0!==t.strm.avail_in)}function U(t,e){for(var r,n;;){if(t.lookahead<C){if(B(t),t.lookahead<C&&e===l)return P;if(0===t.lookahead)break}if(r=0,t.lookahead>=S&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-C&&(t.match_length=F(t,r)),t.match_length>=S)if(n=c._tr_tally(t,t.strstart-t.match_start,t.match_length-S),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=S){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=c._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(D(t,!1),0===t.strm.avail_out))return P}return t.insert=t.strstart<S-1?t.strstart:S-1,e===h?(D(t,!0),0===t.strm.avail_out?A:I):t.last_lit&&(D(t,!1),0===t.strm.avail_out)?P:O}function V(t,e){for(var r,n,i;;){if(t.lookahead<C){if(B(t),t.lookahead<C&&e===l)return P;if(0===t.lookahead)break}if(r=0,t.lookahead>=S&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=S-1,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-C&&(t.match_length=F(t,r),t.match_length<=5&&(1===t.strategy||t.match_length===S&&4096<t.strstart-t.match_start)&&(t.match_length=S-1)),t.prev_length>=S&&t.match_length<=t.prev_length){for(i=t.strstart+t.lookahead-S,n=c._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-S),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=S-1,t.strstart++,n&&(D(t,!1),0===t.strm.avail_out))return P}else if(t.match_available){if((n=c._tr_tally(t,0,t.window[t.strstart-1]))&&D(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return P}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=c._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<S-1?t.strstart:S-1,e===h?(D(t,!0),0===t.strm.avail_out?A:I):t.last_lit&&(D(t,!1),0===t.strm.avail_out)?P:O}function G(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}function q(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new p.Buf16(2*x),this.dyn_dtree=new p.Buf16(2*(2*a+1)),this.bl_tree=new p.Buf16(2*(2*s+1)),N(this.dyn_ltree),N(this.dyn_dtree),N(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new p.Buf16(w+1),this.heap=new p.Buf16(2*o+1),N(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new p.Buf16(2*o+1),N(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function H(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=i,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?M:T,t.adler=2===e.wrap?0:1,e.last_flush=l,c._tr_init(e),m):L(t,g)}function $(t){var e=H(t);return e===m&&function(t){t.window_size=2*t.w_size,N(t.head),t.max_lazy_match=u[t.level].max_lazy,t.good_match=u[t.level].good_length,t.nice_match=u[t.level].nice_length,t.max_chain_length=u[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=S-1,t.match_available=0,t.ins_h=0}(t.state),e}function W(t,e,r,n,i,o){if(!t)return g;var a=1;if(e===y&&(e=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),i<1||b<i||r!==_||n<8||15<n||e<0||9<e||o<0||v<o)return L(t,g);8===n&&(n=9);var s=new q;return(t.state=s).strm=t,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+S-1)/S),s.window=new p.Buf8(2*s.w_size),s.head=new p.Buf16(s.hash_size),s.prev=new p.Buf16(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new p.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=e,s.strategy=o,s.method=r,$(t)}u=[new G(0,0,0,0,function(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(B(t),0===t.lookahead&&e===l)return P;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+r;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,D(t,!1),0===t.strm.avail_out))return P;if(t.strstart-t.block_start>=t.w_size-C&&(D(t,!1),0===t.strm.avail_out))return P}return t.insert=0,e===h?(D(t,!0),0===t.strm.avail_out?A:I):(t.strstart>t.block_start&&(D(t,!1),t.strm.avail_out),P)}),new G(4,4,8,4,U),new G(4,5,16,8,U),new G(4,6,32,32,U),new G(4,4,16,16,V),new G(8,16,32,32,V),new G(8,16,128,128,V),new G(8,32,128,256,V),new G(32,128,258,1024,V),new G(32,258,258,4096,V)],r.deflateInit=function(t,e){return W(t,e,_,15,8,0)},r.deflateInit2=W,r.deflateReset=$,r.deflateResetKeep=H,r.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?g:(t.state.gzhead=e,m):g},r.deflate=function(t,e){var r,n,i,o;if(!t||!t.state||5<e||e<0)return t?L(t,g):g;if(n=t.state,!t.output||!t.input&&0!==t.avail_in||666===n.status&&e!==h)return L(t,0===t.avail_out?-5:g);if(n.strm=t,r=n.last_flush,n.last_flush=e,n.status===M)if(2===n.wrap)t.adler=0,j(n,31),j(n,139),j(n,8),n.gzhead?(j(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),j(n,255&n.gzhead.time),j(n,n.gzhead.time>>8&255),j(n,n.gzhead.time>>16&255),j(n,n.gzhead.time>>24&255),j(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),j(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(j(n,255&n.gzhead.extra.length),j(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=d(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(j(n,0),j(n,0),j(n,0),j(n,0),j(n,0),j(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),j(n,3),n.status=T);else{var a=_+(n.w_bits-8<<4)<<8;a|=(2<=n.strategy||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(a|=32),a+=31-a%31,n.status=T,z(n,a),0!==n.strstart&&(z(n,t.adler>>>16),z(n,65535&t.adler)),t.adler=1}if(69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(t.adler=d(t.adler,n.pending_buf,n.pending-i,i)),k(t),i=n.pending,n.pending!==n.pending_buf_size));)j(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(t.adler=d(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(t.adler=d(t.adler,n.pending_buf,n.pending-i,i)),k(t),i=n.pending,n.pending===n.pending_buf_size)){o=1;break}o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,j(n,o)}while(0!==o);n.gzhead.hcrc&&n.pending>i&&(t.adler=d(t.adler,n.pending_buf,n.pending-i,i)),0===o&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(t.adler=d(t.adler,n.pending_buf,n.pending-i,i)),k(t),i=n.pending,n.pending===n.pending_buf_size)){o=1;break}o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,j(n,o)}while(0!==o);n.gzhead.hcrc&&n.pending>i&&(t.adler=d(t.adler,n.pending_buf,n.pending-i,i)),0===o&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&k(t),n.pending+2<=n.pending_buf_size&&(j(n,255&t.adler),j(n,t.adler>>8&255),t.adler=0,n.status=T)):n.status=T),0!==n.pending){if(k(t),0===t.avail_out)return n.last_flush=-1,m}else if(0===t.avail_in&&R(e)<=R(r)&&e!==h)return L(t,-5);if(666===n.status&&0!==t.avail_in)return L(t,-5);if(0!==t.avail_in||0!==n.lookahead||e!==l&&666!==n.status){var s=2===n.strategy?function(t,e){for(var r;;){if(0===t.lookahead&&(B(t),0===t.lookahead)){if(e===l)return P;break}if(t.match_length=0,r=c._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(D(t,!1),0===t.strm.avail_out))return P}return t.insert=0,e===h?(D(t,!0),0===t.strm.avail_out?A:I):t.last_lit&&(D(t,!1),0===t.strm.avail_out)?P:O}(n,e):3===n.strategy?function(t,e){for(var r,n,i,o,a=t.window;;){if(t.lookahead<=E){if(B(t),t.lookahead<=E&&e===l)return P;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=S&&0<t.strstart&&(n=a[i=t.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){o=t.strstart+E;do{}while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<o);t.match_length=E-(o-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=S?(r=c._tr_tally(t,1,t.match_length-S),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=c._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(D(t,!1),0===t.strm.avail_out))return P}return t.insert=0,e===h?(D(t,!0),0===t.strm.avail_out?A:I):t.last_lit&&(D(t,!1),0===t.strm.avail_out)?P:O}(n,e):u[n.level].func(n,e);if(s!==A&&s!==I||(n.status=666),s===P||s===A)return 0===t.avail_out&&(n.last_flush=-1),m;if(s===O&&(1===e?c._tr_align(n):5!==e&&(c._tr_stored_block(n,0,0,!1),3===e&&(N(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),k(t),0===t.avail_out))return n.last_flush=-1,m}return e!==h?m:n.wrap<=0?1:(2===n.wrap?(j(n,255&t.adler),j(n,t.adler>>8&255),j(n,t.adler>>16&255),j(n,t.adler>>24&255),j(n,255&t.total_in),j(n,t.total_in>>8&255),j(n,t.total_in>>16&255),j(n,t.total_in>>24&255)):(z(n,t.adler>>>16),z(n,65535&t.adler)),k(t),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending?m:1)},r.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==M&&69!==e&&73!==e&&91!==e&&103!==e&&e!==T&&666!==e?L(t,g):(t.state=null,e===T?L(t,-3):m):g},r.deflateSetDictionary=function(t,e){var r,n,i,o,a,s,u,c,l=e.length;if(!t||!t.state)return g;if(2===(o=(r=t.state).wrap)||1===o&&r.status!==M||r.lookahead)return g;for(1===o&&(t.adler=f(t.adler,e,l,0)),r.wrap=0,l>=r.w_size&&(0===o&&(N(r.head),r.strstart=0,r.block_start=0,r.insert=0),c=new p.Buf8(r.w_size),p.arraySet(c,e,l-r.w_size,r.w_size,0),e=c,l=r.w_size),a=t.avail_in,s=t.next_in,u=t.input,t.avail_in=l,t.next_in=0,t.input=e,B(r);r.lookahead>=S;){for(n=r.strstart,i=r.lookahead-(S-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+S-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++,--i;);r.strstart=n,r.lookahead=S-1,B(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=S-1,r.match_available=0,t.next_in=s,t.input=u,t.avail_in=a,r.wrap=o,m},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":26,"./adler32":28,"./crc32":30,"./messages":36,"./trees":37}],32:[function(t,e,r){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],33:[function(t,e,r){"use strict";e.exports=function(t,e){var r,n,i,o,a,s,u,c,l,h,p,f,d,m,g,y,v,_,b,x,w,S,E,C,M;r=t.state,n=t.next_in,C=t.input,i=n+(t.avail_in-5),o=t.next_out,M=t.output,a=o-(e-t.avail_out),s=o+(t.avail_out-257),u=r.dmax,c=r.wsize,l=r.whave,h=r.wnext,p=r.window,f=r.hold,d=r.bits,m=r.lencode,g=r.distcode,y=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;t:do{d<15&&(f+=C[n++]<<d,d+=8,f+=C[n++]<<d,d+=8),_=m[f&y];e:for(;;){if(f>>>=b=_>>>24,d-=b,0===(b=_>>>16&255))M[o++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=m[(65535&_)+(f&(1<<b)-1)];continue e}if(32&b){r.mode=12;break t}t.msg="invalid literal/length code",r.mode=30;break t}x=65535&_,(b&=15)&&(d<b&&(f+=C[n++]<<d,d+=8),x+=f&(1<<b)-1,f>>>=b,d-=b),d<15&&(f+=C[n++]<<d,d+=8,f+=C[n++]<<d,d+=8),_=g[f&v];r:for(;;){if(f>>>=b=_>>>24,d-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=g[(65535&_)+(f&(1<<b)-1)];continue r}t.msg="invalid distance code",r.mode=30;break t}if(w=65535&_,d<(b&=15)&&(f+=C[n++]<<d,(d+=8)<b&&(f+=C[n++]<<d,d+=8)),u<(w+=f&(1<<b)-1)){t.msg="invalid distance too far back",r.mode=30;break t}if(f>>>=b,d-=b,(b=o-a)<w){if(l<(b=w-b)&&r.sane){t.msg="invalid distance too far back",r.mode=30;break t}if(E=p,(S=0)===h){if(S+=c-b,b<x){for(x-=b;M[o++]=p[S++],--b;);S=o-w,E=M}}else if(h<b){if(S+=c+h-b,(b-=h)<x){for(x-=b;M[o++]=p[S++],--b;);if(S=0,h<x){for(x-=b=h;M[o++]=p[S++],--b;);S=o-w,E=M}}}else if(S+=h-b,b<x){for(x-=b;M[o++]=p[S++],--b;);S=o-w,E=M}for(;2<x;)M[o++]=E[S++],M[o++]=E[S++],M[o++]=E[S++],x-=3;x&&(M[o++]=E[S++],1<x&&(M[o++]=E[S++]))}else{for(S=o-w;M[o++]=M[S++],M[o++]=M[S++],M[o++]=M[S++],2<(x-=3););x&&(M[o++]=M[S++],1<x&&(M[o++]=M[S++]))}break}}break}}while(n<i&&o<s);n-=x=d>>3,f&=(1<<(d-=x<<3))-1,t.next_in=n,t.next_out=o,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=o<s?s-o+257:257-(o-s),r.hold=f,r.bits=d}},{}],34:[function(t,e,r){"use strict";var O=t("../utils/common"),A=t("./adler32"),I=t("./crc32"),L=t("./inffast"),R=t("./inftrees"),N=1,k=2,D=0,j=-2,z=1,n=852,i=592;function F(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function o(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new O.Buf16(320),this.work=new O.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=z,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new O.Buf32(n),e.distcode=e.distdyn=new O.Buf32(i),e.sane=1,e.back=-1,D):j}function s(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,a(t)):j}function u(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?j:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,s(t))):j}function c(t,e){var r,n;return t?(n=new o,(t.state=n).window=null,(r=u(t,e))!==D&&(t.state=null),r):j}var l,h,p=!0;function B(t){if(p){var e;for(l=new O.Buf32(512),h=new O.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(R(N,t.lens,0,288,l,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;R(k,t.lens,0,32,h,0,t.work,{bits:5}),p=!1}t.lencode=l,t.lenbits=9,t.distcode=h,t.distbits=5}function U(t,e,r,n){var i,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new O.Buf8(o.wsize)),n>=o.wsize?(O.arraySet(o.window,e,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(n<(i=o.wsize-o.wnext)&&(i=n),O.arraySet(o.window,e,r-n,i,o.wnext),(n-=i)?(O.arraySet(o.window,e,r-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}r.inflateReset=s,r.inflateReset2=u,r.inflateResetKeep=a,r.inflateInit=function(t){return c(t,15)},r.inflateInit2=c,r.inflate=function(t,e){var r,n,i,o,a,s,u,c,l,h,p,f,d,m,g,y,v,_,b,x,w,S,E,C,M=0,T=new O.Buf8(4),P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return j;12===(r=t.state).mode&&(r.mode=13),a=t.next_out,i=t.output,u=t.avail_out,o=t.next_in,n=t.input,s=t.avail_in,c=r.hold,l=r.bits,h=s,p=u,S=D;t:for(;;)switch(r.mode){case z:if(0===r.wrap){r.mode=13;break}for(;l<16;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}if(2&r.wrap&&35615===c){T[r.check=0]=255&c,T[1]=c>>>8&255,r.check=I(r.check,T,2,0),l=c=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&c)<<8)+(c>>8))%31){t.msg="incorrect header check",r.mode=30;break}if(8!=(15&c)){t.msg="unknown compression method",r.mode=30;break}if(l-=4,w=8+(15&(c>>>=4)),0===r.wbits)r.wbits=w;else if(w>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<w,t.adler=r.check=1,r.mode=512&c?10:12,l=c=0;break;case 2:for(;l<16;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}if(r.flags=c,8!=(255&r.flags)){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=c>>8&1),512&r.flags&&(T[0]=255&c,T[1]=c>>>8&255,r.check=I(r.check,T,2,0)),l=c=0,r.mode=3;case 3:for(;l<32;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}r.head&&(r.head.time=c),512&r.flags&&(T[0]=255&c,T[1]=c>>>8&255,T[2]=c>>>16&255,T[3]=c>>>24&255,r.check=I(r.check,T,4,0)),l=c=0,r.mode=4;case 4:for(;l<16;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}r.head&&(r.head.xflags=255&c,r.head.os=c>>8),512&r.flags&&(T[0]=255&c,T[1]=c>>>8&255,r.check=I(r.check,T,2,0)),l=c=0,r.mode=5;case 5:if(1024&r.flags){for(;l<16;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}r.length=c,r.head&&(r.head.extra_len=c),512&r.flags&&(T[0]=255&c,T[1]=c>>>8&255,r.check=I(r.check,T,2,0)),l=c=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(s<(f=r.length)&&(f=s),f&&(r.head&&(w=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),O.arraySet(r.head.extra,n,o,f,w)),512&r.flags&&(r.check=I(r.check,n,f,o)),s-=f,o+=f,r.length-=f),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===s)break t;for(f=0;w=n[o+f++],r.head&&w&&r.length<65536&&(r.head.name+=String.fromCharCode(w)),w&&f<s;);if(512&r.flags&&(r.check=I(r.check,n,f,o)),s-=f,o+=f,w)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===s)break t;for(f=0;w=n[o+f++],r.head&&w&&r.length<65536&&(r.head.comment+=String.fromCharCode(w)),w&&f<s;);if(512&r.flags&&(r.check=I(r.check,n,f,o)),s-=f,o+=f,w)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;l<16;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}if(c!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}l=c=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=12;break;case 10:for(;l<32;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}t.adler=r.check=F(c),l=c=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=a,t.avail_out=u,t.next_in=o,t.avail_in=s,r.hold=c,r.bits=l,2;t.adler=r.check=1,r.mode=12;case 12:if(5===e||6===e)break t;case 13:if(r.last){c>>>=7&l,l-=7&l,r.mode=27;break}for(;l<3;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}switch(r.last=1&c,l-=1,3&(c>>>=1)){case 0:r.mode=14;break;case 1:if(B(r),r.mode=20,6!==e)break;c>>>=2,l-=2;break t;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}c>>>=2,l-=2;break;case 14:for(c>>>=7&l,l-=7&l;l<32;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}if((65535&c)!=(c>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&c,l=c=0,r.mode=15,6===e)break t;case 15:r.mode=16;case 16:if(f=r.length){if(s<f&&(f=s),u<f&&(f=u),0===f)break t;O.arraySet(i,n,o,f,a),s-=f,o+=f,u-=f,a+=f,r.length-=f;break}r.mode=12;break;case 17:for(;l<14;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}if(r.nlen=257+(31&c),c>>>=5,l-=5,r.ndist=1+(31&c),c>>>=5,l-=5,r.ncode=4+(15&c),c>>>=4,l-=4,286<r.nlen||30<r.ndist){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;l<3;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}r.lens[P[r.have++]]=7&c,c>>>=3,l-=3}for(;r.have<19;)r.lens[P[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,E={bits:r.lenbits},S=R(0,r.lens,0,19,r.lencode,0,r.work,E),r.lenbits=E.bits,S){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;y=(M=r.lencode[c&(1<<r.lenbits)-1])>>>16&255,v=65535&M,!((g=M>>>24)<=l);){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}if(v<16)c>>>=g,l-=g,r.lens[r.have++]=v;else{if(16===v){for(C=g+2;l<C;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}if(c>>>=g,l-=g,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}w=r.lens[r.have-1],f=3+(3&c),c>>>=2,l-=2}else if(17===v){for(C=g+3;l<C;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}l-=g,w=0,f=3+(7&(c>>>=g)),c>>>=3,l-=3}else{for(C=g+7;l<C;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}l-=g,w=0,f=11+(127&(c>>>=g)),c>>>=7,l-=7}if(r.have+f>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;f--;)r.lens[r.have++]=w}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,E={bits:r.lenbits},S=R(N,r.lens,0,r.nlen,r.lencode,0,r.work,E),r.lenbits=E.bits,S){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,E={bits:r.distbits},S=R(k,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,E),r.distbits=E.bits,S){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===e)break t;case 20:r.mode=21;case 21:if(6<=s&&258<=u){t.next_out=a,t.avail_out=u,t.next_in=o,t.avail_in=s,r.hold=c,r.bits=l,L(t,p),a=t.next_out,i=t.output,u=t.avail_out,o=t.next_in,n=t.input,s=t.avail_in,c=r.hold,l=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;y=(M=r.lencode[c&(1<<r.lenbits)-1])>>>16&255,v=65535&M,!((g=M>>>24)<=l);){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}if(y&&0==(240&y)){for(_=g,b=y,x=v;y=(M=r.lencode[x+((c&(1<<_+b)-1)>>_)])>>>16&255,v=65535&M,!(_+(g=M>>>24)<=l);){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}c>>>=_,l-=_,r.back+=_}if(c>>>=g,l-=g,r.back+=g,r.length=v,0===y){r.mode=26;break}if(32&y){r.back=-1,r.mode=12;break}if(64&y){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&y,r.mode=22;case 22:if(r.extra){for(C=r.extra;l<C;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;y=(M=r.distcode[c&(1<<r.distbits)-1])>>>16&255,v=65535&M,!((g=M>>>24)<=l);){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}if(0==(240&y)){for(_=g,b=y,x=v;y=(M=r.distcode[x+((c&(1<<_+b)-1)>>_)])>>>16&255,v=65535&M,!(_+(g=M>>>24)<=l);){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}c>>>=_,l-=_,r.back+=_}if(c>>>=g,l-=g,r.back+=g,64&y){t.msg="invalid distance code",r.mode=30;break}r.offset=v,r.extra=15&y,r.mode=24;case 24:if(r.extra){for(C=r.extra;l<C;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===u)break t;if(f=p-u,r.offset>f){if((f=r.offset-f)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}d=f>r.wnext?(f-=r.wnext,r.wsize-f):r.wnext-f,f>r.length&&(f=r.length),m=r.window}else m=i,d=a-r.offset,f=r.length;for(u<f&&(f=u),u-=f,r.length-=f;i[a++]=m[d++],--f;);0===r.length&&(r.mode=21);break;case 26:if(0===u)break t;i[a++]=r.length,u--,r.mode=21;break;case 27:if(r.wrap){for(;l<32;){if(0===s)break t;s--,c|=n[o++]<<l,l+=8}if(p-=u,t.total_out+=p,r.total+=p,p&&(t.adler=r.check=r.flags?I(r.check,i,p,a-p):A(r.check,i,p,a-p)),p=u,(r.flags?c:F(c))!==r.check){t.msg="incorrect data check",r.mode=30;break}l=c=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;l<32;){if(0===s)break t;s--,c+=n[o++]<<l,l+=8}if(c!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}l=c=0}r.mode=29;case 29:S=1;break t;case 30:S=-3;break t;case 31:return-4;case 32:default:return j}return t.next_out=a,t.avail_out=u,t.next_in=o,t.avail_in=s,r.hold=c,r.bits=l,(r.wsize||p!==t.avail_out&&r.mode<30&&(r.mode<27||4!==e))&&U(t,t.output,t.next_out,p-t.avail_out)?(r.mode=31,-4):(h-=t.avail_in,p-=t.avail_out,t.total_in+=h,t.total_out+=p,r.total+=p,r.wrap&&p&&(t.adler=r.check=r.flags?I(r.check,i,p,t.next_out-p):A(r.check,i,p,t.next_out-p)),t.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==h&&0===p||4===e)&&S===D&&(S=-5),S)},r.inflateEnd=function(t){if(!t||!t.state)return j;var e=t.state;return e.window&&(e.window=null),t.state=null,D},r.inflateGetHeader=function(t,e){var r;return t&&t.state?0==(2&(r=t.state).wrap)?j:((r.head=e).done=!1,D):j},r.inflateSetDictionary=function(t,e){var r,n=e.length;return t&&t.state?0!==(r=t.state).wrap&&11!==r.mode?j:11===r.mode&&A(1,e,n,0)!==r.check?-3:U(t,e,n,n)?(r.mode=31,-4):(r.havedict=1,D):j},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":26,"./adler32":28,"./crc32":30,"./inffast":33,"./inftrees":35}],35:[function(t,e,r){"use strict";var N=t("../utils/common"),k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],D=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],z=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,r,n,i,o,a,s){var u,c,l,h,p,f,d,m,g,y=s.bits,v=0,_=0,b=0,x=0,w=0,S=0,E=0,C=0,M=0,T=0,P=null,O=0,A=new N.Buf16(16),I=new N.Buf16(16),L=null,R=0;for(v=0;v<=15;v++)A[v]=0;for(_=0;_<n;_++)A[e[r+_]]++;for(w=y,x=15;1<=x&&0===A[x];x--);if(x<w&&(w=x),0===x)return i[o++]=20971520,i[o++]=20971520,s.bits=1,0;for(b=1;b<x&&0===A[b];b++);for(w<b&&(w=b),v=C=1;v<=15;v++)if(C<<=1,(C-=A[v])<0)return-1;if(0<C&&(0===t||1!==x))return-1;for(I[1]=0,v=1;v<15;v++)I[v+1]=I[v]+A[v];for(_=0;_<n;_++)0!==e[r+_]&&(a[I[e[r+_]]++]=_);if(f=0===t?(P=L=a,19):1===t?(P=k,O-=257,L=D,R-=257,256):(P=j,L=z,-1),v=b,p=o,E=_=T=0,l=-1,h=(M=1<<(S=w))-1,1===t&&852<M||2===t&&592<M)return 1;for(;;){for(d=v-E,g=a[_]<f?(m=0,a[_]):a[_]>f?(m=L[R+a[_]],P[O+a[_]]):(m=96,0),u=1<<v-E,b=c=1<<S;i[p+(T>>E)+(c-=u)]=d<<24|m<<16|g|0,0!==c;);for(u=1<<v-1;T&u;)u>>=1;if(0!==u?(T&=u-1,T+=u):T=0,_++,0==--A[v]){if(v===x)break;v=e[r+a[_]]}if(w<v&&(T&h)!==l){for(0===E&&(E=w),p+=b,C=1<<(S=v-E);S+E<x&&!((C-=A[S+E])<=0);)S++,C<<=1;if(M+=1<<S,1===t&&852<M||2===t&&592<M)return 1;i[l=T&h]=w<<24|S<<16|p-o|0}}return 0!==T&&(i[p+T]=v-E<<24|64<<16|0),s.bits=w,0}},{"../utils/common":26}],36:[function(t,e,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],37:[function(t,e,r){"use strict";var i=t("../utils/common"),s=0,u=1;function n(t){for(var e=t.length;0<=--e;)t[e]=0}var o=0,a=29,c=256,l=c+1+a,h=30,p=19,g=2*l+1,y=15,f=16,d=7,m=256,v=16,_=17,b=18,x=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],w=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=new Array(2*(l+2));n(C);var M=new Array(2*h);n(M);var T=new Array(512);n(T);var P=new Array(256);n(P);var O=new Array(a);n(O);var A,I,L,R=new Array(h);function N(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}function k(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function D(t){return t<256?T[t]:T[256+(t>>>7)]}function j(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function z(t,e,r){t.bi_valid>f-r?(t.bi_buf|=e<<t.bi_valid&65535,j(t,t.bi_buf),t.bi_buf=e>>f-t.bi_valid,t.bi_valid+=r-f):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function F(t,e,r){z(t,r[2*e],r[2*e+1])}function B(t,e){for(var r=0;r|=1&t,t>>>=1,r<<=1,0<--e;);return r>>>1}function U(t,e,r){var n,i,o=new Array(y+1),a=0;for(n=1;n<=y;n++)o[n]=a=a+r[n-1]<<1;for(i=0;i<=e;i++){var s=t[2*i+1];0!==s&&(t[2*i]=B(o[s]++,s))}}function V(t){var e;for(e=0;e<l;e++)t.dyn_ltree[2*e]=0;for(e=0;e<h;e++)t.dyn_dtree[2*e]=0;for(e=0;e<p;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*m]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function G(t){8<t.bi_valid?j(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function q(t,e,r,n){var i=2*e,o=2*r;return t[i]<t[o]||t[i]===t[o]&&n[e]<=n[r]}function H(t,e,r){for(var n=t.heap[r],i=r<<1;i<=t.heap_len&&(i<t.heap_len&&q(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!q(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n}function $(t,e,r){var n,i,o,a,s=0;if(0!==t.last_lit)for(;n=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],i=t.pending_buf[t.l_buf+s],s++,0===n?F(t,i,e):(F(t,(o=P[i])+c+1,e),0!==(a=x[o])&&z(t,i-=O[o],a),F(t,o=D(--n),r),0!==(a=w[o])&&z(t,n-=R[o],a)),s<t.last_lit;);F(t,m,e)}function W(t,e){var r,n,i,o=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,u=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=g,r=0;r<u;r++)0!==o[2*r]?(t.heap[++t.heap_len]=c=r,t.depth[r]=0):o[2*r+1]=0;for(;t.heap_len<2;)o[2*(i=t.heap[++t.heap_len]=c<2?++c:0)]=1,t.depth[i]=0,t.opt_len--,s&&(t.static_len-=a[2*i+1]);for(e.max_code=c,r=t.heap_len>>1;1<=r;r--)H(t,o,r);for(i=u;r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],H(t,o,1),n=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=n,o[2*i]=o[2*r]+o[2*n],t.depth[i]=(t.depth[r]>=t.depth[n]?t.depth[r]:t.depth[n])+1,o[2*r+1]=o[2*n+1]=i,t.heap[1]=i++,H(t,o,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var r,n,i,o,a,s,u=e.dyn_tree,c=e.max_code,l=e.stat_desc.static_tree,h=e.stat_desc.has_stree,p=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,d=e.stat_desc.max_length,m=0;for(o=0;o<=y;o++)t.bl_count[o]=0;for(u[2*t.heap[t.heap_max]+1]=0,r=t.heap_max+1;r<g;r++)d<(o=u[2*u[2*(n=t.heap[r])+1]+1]+1)&&(o=d,m++),u[2*n+1]=o,c<n||(t.bl_count[o]++,a=0,f<=n&&(a=p[n-f]),s=u[2*n],t.opt_len+=s*(o+a),h&&(t.static_len+=s*(l[2*n+1]+a)));if(0!==m){do{for(o=d-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[d]--,m-=2}while(0<m);for(o=d;0!==o;o--)for(n=t.bl_count[o];0!==n;)c<(i=t.heap[--r])||(u[2*i+1]!==o&&(t.opt_len+=(o-u[2*i+1])*u[2*i],u[2*i+1]=o),n--)}}(t,e),U(o,c,t.bl_count)}function X(t,e,r){var n,i,o=-1,a=e[1],s=0,u=7,c=4;for(0===a&&(u=138,c=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=e[2*(n+1)+1],++s<u&&i===a||(s<c?t.bl_tree[2*i]+=s:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[2*v]++):s<=10?t.bl_tree[2*_]++:t.bl_tree[2*b]++,o=i,c=(s=0)===a?(u=138,3):i===a?(u=6,3):(u=7,4))}function Y(t,e,r){var n,i,o=-1,a=e[1],s=0,u=7,c=4;for(0===a&&(u=138,c=3),n=0;n<=r;n++)if(i=a,a=e[2*(n+1)+1],!(++s<u&&i===a)){if(s<c)for(;F(t,i,t.bl_tree),0!=--s;);else 0!==i?(i!==o&&(F(t,i,t.bl_tree),s--),F(t,v,t.bl_tree),z(t,s-3,2)):s<=10?(F(t,_,t.bl_tree),z(t,s-3,3)):(F(t,b,t.bl_tree),z(t,s-11,7));o=i,c=(s=0)===a?(u=138,3):i===a?(u=6,3):(u=7,4)}}n(R);var Z=!1;function K(t,e,r,n){z(t,(o<<1)+(n?1:0),3),function(t,e,r,n){G(t),n&&(j(t,r),j(t,~r)),i.arraySet(t.pending_buf,t.window,e,r,t.pending),t.pending+=r}(t,e,r,!0)}r._tr_init=function(t){Z||(function(){var t,e,r,n,i,o=new Array(y+1);for(n=r=0;n<a-1;n++)for(O[n]=r,t=0;t<1<<x[n];t++)P[r++]=n;for(P[r-1]=n,n=i=0;n<16;n++)for(R[n]=i,t=0;t<1<<w[n];t++)T[i++]=n;for(i>>=7;n<h;n++)for(R[n]=i<<7,t=0;t<1<<w[n]-7;t++)T[256+i++]=n;for(e=0;e<=y;e++)o[e]=0;for(t=0;t<=143;)C[2*t+1]=8,t++,o[8]++;for(;t<=255;)C[2*t+1]=9,t++,o[9]++;for(;t<=279;)C[2*t+1]=7,t++,o[7]++;for(;t<=287;)C[2*t+1]=8,t++,o[8]++;for(U(C,l+1,o),t=0;t<h;t++)M[2*t+1]=5,M[2*t]=B(t,5);A=new N(C,x,c+1,l,y),I=new N(M,w,0,h,y),L=new N(new Array(0),S,0,p,d)}(),Z=!0),t.l_desc=new k(t.dyn_ltree,A),t.d_desc=new k(t.dyn_dtree,I),t.bl_desc=new k(t.bl_tree,L),t.bi_buf=0,t.bi_valid=0,V(t)},r._tr_stored_block=K,r._tr_flush_block=function(t,e,r,n){var i,o,a=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return s;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return u;for(e=32;e<c;e++)if(0!==t.dyn_ltree[2*e])return u;return s}(t)),W(t,t.l_desc),W(t,t.d_desc),a=function(t){var e;for(X(t,t.dyn_ltree,t.l_desc.max_code),X(t,t.dyn_dtree,t.d_desc.max_code),W(t,t.bl_desc),e=p-1;3<=e&&0===t.bl_tree[2*E[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),i=t.opt_len+3+7>>>3,(o=t.static_len+3+7>>>3)<=i&&(i=o)):i=o=r+5,r+4<=i&&-1!==e?K(t,e,r,n):4===t.strategy||o===i?(z(t,2+(n?1:0),3),$(t,C,M)):(z(t,4+(n?1:0),3),function(t,e,r,n){var i;for(z(t,e-257,5),z(t,r-1,5),z(t,n-4,4),i=0;i<n;i++)z(t,t.bl_tree[2*E[i]+1],3);Y(t,t.dyn_ltree,e-1),Y(t,t.dyn_dtree,r-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),$(t,t.dyn_ltree,t.dyn_dtree)),V(t),n&&G(t)},r._tr_tally=function(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(P[r]+c+1)]++,t.dyn_dtree[2*D(e)]++),t.last_lit===t.lit_bufsize-1},r._tr_align=function(t){z(t,2,3),F(t,m,C),function(t){16===t.bi_valid?(j(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":26}],38:[function(t,e,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],39:[function(t,e,c){(function(i){function o(t,e){for(var r=0,n=t.length-1;0<=n;n--){var i=t[n];"."===i?t.splice(n,1):".."===i?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r--;)t.unshift("..");return t}function a(t){return e.exec(t).slice(1)}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;function s(t,e){if(t.filter)return t.filter(e);for(var r=[],n=0;n<t.length;n++)e(t[n],n,t)&&r.push(t[n]);return r}c.resolve=function(){for(var t="",e=!1,r=arguments.length-1;-1<=r&&!e;r--){var n=0<=r?arguments[r]:i.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");n&&(t=n+"/"+t,e="/"===n.charAt(0))}return(e?"/":"")+(t=o(s(t.split("/"),function(t){return!!t}),!e).join("/"))||"."},c.normalize=function(t){var e=c.isAbsolute(t),r="/"===n(t,-1);return(t=o(s(t.split("/"),function(t){return!!t}),!e).join("/"))||e||(t="."),t&&r&&(t+="/"),(e?"/":"")+t},c.isAbsolute=function(t){return"/"===t.charAt(0)},c.join=function(){var t=Array.prototype.slice.call(arguments,0);return c.normalize(s(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},c.relative=function(t,e){function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var r=t.length-1;0<=r&&""===t[r];r--);return r<e?[]:t.slice(e,r-e+1)}t=c.resolve(t).substr(1),e=c.resolve(e).substr(1);for(var n=r(t.split("/")),i=r(e.split("/")),o=Math.min(n.length,i.length),a=o,s=0;s<o;s++)if(n[s]!==i[s]){a=s;break}var u=[];for(s=a;s<n.length;s++)u.push("..");return(u=u.concat(i.slice(a))).join("/")},c.sep="/",c.delimiter=":",c.dirname=function(t){var e=a(t),r=e[0],n=e[1];return r||n?r+(n=n&&n.substr(0,n.length-1)):"."},c.basename=function(t,e){var r=a(t)[2];return e&&r.substr(-1*e.length)===e&&(r=r.substr(0,r.length-e.length)),r},c.extname=function(t){return a(t)[3]};var n="b"==="ab".substr(-1)?function(t,e,r){return t.substr(e,r)}:function(t,e,r){return e<0&&(e=t.length+e),t.substr(e,r)}}).call(this,t("_process"))},{_process:6}],40:[function(t,e,r){"use strict";e.exports=i;var n=t("ieee754");function i(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o=4294967296,a=1/o;function s(t){return t.type===i.Bytes?t.readVarint()+t.pos:t.pos+1}function u(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function c(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;t<=i;i--)r.buf[i+n]=r.buf[i]}function l(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function h(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function p(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function f(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function d(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function m(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function g(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function y(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function v(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function _(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function b(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function x(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}i.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,t(i,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=_(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=x(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=_(this.buf,this.pos)+_(this.buf,this.pos+4)*o;return this.pos+=8,t},readSFixed64:function(){var t=_(this.buf,this.pos)+x(this.buf,this.pos+4)*o;return this.pos+=8,t},readFloat:function(){var t=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,o=r.buf;if(i=o[r.pos++],n=(112&i)>>4,i<128)return u(t,n,e);if(i=o[r.pos++],n|=(127&i)<<3,i<128)return u(t,n,e);if(i=o[r.pos++],n|=(127&i)<<10,i<128)return u(t,n,e);if(i=o[r.pos++],n|=(127&i)<<17,i<128)return u(t,n,e);if(i=o[r.pos++],n|=(127&i)<<24,i<128)return u(t,n,e);if(i=o[r.pos++],n|=(1&i)<<31,i<128)return u(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,r){var n="",i=e;for(;i<r;){var o,a,s,u=t[i],c=null,l=239<u?4:223<u?3:191<u?2:1;if(r<i+l)break;1===l?u<128&&(c=u):2===l?128==(192&(o=t[i+1]))&&(c=(31&u)<<6|63&o)<=127&&(c=null):3===l?(o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&((c=(15&u)<<12|(63&o)<<6|63&a)<=2047||55296<=c&&c<=57343)&&(c=null)):4===l&&(o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||1114112<=c)&&(c=null)),null===c?(c=65533,l=1):65535<c&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),i+=l}return n}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var r=s(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=s(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===i.Varint)for(;127<this.buf[this.pos++];);else if(e===i.Bytes)this.pos=this.readVarint()+this.pos;else if(e===i.Fixed32)this.pos+=4;else{if(e!==i.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),b(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*a),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),b(this.buf,-1&t,this.pos),b(this.buf,Math.floor(t*a),this.pos+4),this.pos+=8},writeVarint:function(t){268435455<(t=+t||0)||t<0?function(t,e){var r,n;0<=t?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:n=n+1|(r=0));if(0x10000000000000000<=t||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;if(e.buf[e.pos++]|=r|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,o=0;o<e.length;o++){if(55295<(n=e.charCodeAt(o))&&n<57344){if(!i){56319<n||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;128<=r&&c(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),n.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),n.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;128<=n&&c(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,i.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){this.writeMessage(t,l,e)},writePackedSVarint:function(t,e){this.writeMessage(t,h,e)},writePackedBoolean:function(t,e){this.writeMessage(t,d,e)},writePackedFloat:function(t,e){this.writeMessage(t,p,e)},writePackedDouble:function(t,e){this.writeMessage(t,f,e)},writePackedFixed32:function(t,e){this.writeMessage(t,m,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,g,e)},writePackedFixed64:function(t,e){this.writeMessage(t,y,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,v,e)},writeBytesField:function(t,e){this.writeTag(t,i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},{ieee754:17}],41:[function(t,e,r){var n,i;n=this,i=function(){"use strict";function g(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function o(t,e){return t<e?-1:e<t?1:0}return function(t,e,r,n,i){!function t(e,r,n,i,o){for(;n<i;){if(600<i-n){var a=i-n+1,s=r-n+1,u=Math.log(a),c=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*c*(a-c)/a)*(s-a/2<0?-1:1),h=Math.max(n,Math.floor(r-s*c/a+l)),p=Math.min(i,Math.floor(r+(a-s)*c/a+l));t(e,r,h,p,o)}var f=e[r],d=n,m=i;for(g(e,n,r),0<o(e[i],f)&&g(e,n,i);d<m;){for(g(e,d,m),d++,m--;o(e[d],f)<0;)d++;for(;0<o(e[m],f);)m--}0===o(e[n],f)?g(e,n,m):g(e,++m,i),m<=r&&(n=m+1),r<=m&&(i=m-1)}}(t,e,r||0,n||t.length-1,i||o)}},"object"==typeof r&&void 0!==e?e.exports=i():n.quickselect=i()},{}],42:[function(t,e,r){"use strict";e.exports=n,e.exports.default=n;var s=t("quickselect");function n(t,e){if(!(this instanceof n))return new n(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function l(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function f(t,e){y(t,0,t.children.length,e,t)}function y(t,e,r,n,i){(i=i||m(null)).minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=e;a<r;a++)o=t.children[a],h(i,t.leaf?n(o):o);return i}function h(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function o(t,e){return t.minX-e.minX}function a(t,e){return t.minY-e.minY}function v(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function p(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function c(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function m(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,e,r,n,i){for(var o,a=[e,r];a.length;)(r=a.pop())-(e=a.pop())<=n||(o=e+Math.ceil((r-e)/n/2)*n,s(t,o,e,r,i),a.push(e,o,o,r))}n.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],n=this.toBBox;if(!c(t,e))return r;for(var i,o,a,s,u=[];e;){for(i=0,o=e.children.length;i<o;i++)a=e.children[i],c(t,s=e.leaf?n(a):a)&&(e.leaf?r.push(a):d(t,s)?this._all(a,r):u.push(a));e=u.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!c(t,e))return!1;for(var n,i,o,a,s=[];e;){for(n=0,i=e.children.length;n<i;n++)if(o=e.children[n],c(t,a=e.leaf?r(o):o)){if(e.leaf||d(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=m([]),this},remove:function(t,e){if(!t)return this;for(var r,n,i,o,a=this.data,s=this.toBBox(t),u=[],c=[];a||u.length;){if(a||(a=u.pop(),n=u[u.length-1],r=c.pop(),o=!0),a.leaf&&-1!==(i=l(t,a.children,e)))return a.children.splice(i,1),u.push(a),this._condense(u),this;o||a.leaf||!d(a,s)?n?(r++,a=n.children[r],o=!1):a=null:(u.push(a),c.push(r),r=0,a=(n=a).children[0])}return this},toBBox:function(t){return t},compareMinX:o,compareMinY:a,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,n){var i,o=r-e+1,a=this._maxEntries;if(o<=a)return f(i=m(t.slice(e,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),(i=m([])).leaf=!1,i.height=n;var s,u,c,l,h=Math.ceil(o/a),p=h*Math.ceil(Math.sqrt(a));for(g(t,e,r,p,this.compareMinX),s=e;s<=r;s+=p)for(g(t,s,c=Math.min(s+p-1,r),h,this.compareMinY),u=s;u<=c;u+=h)l=Math.min(u+h-1,c),i.children.push(this._build(t,u,l,n-1));return f(i,this.toBBox),i},_chooseSubtree:function(t,e,r,n){for(var i,o,a,s,u,c,l,h,p,f;n.push(e),!e.leaf&&n.length-1!==r;){for(l=h=1/0,i=0,o=e.children.length;i<o;i++)u=v(a=e.children[i]),p=t,f=a,(c=(Math.max(f.maxX,p.maxX)-Math.min(f.minX,p.minX))*(Math.max(f.maxY,p.maxY)-Math.min(f.minY,p.minY))-u)<h?(h=c,l=u<l?u:l,s=a):c===h&&u<l&&(l=u,s=a);e=s||e.children[0]}return e},_insert:function(t,e,r){var n=this.toBBox,i=r?t:n(t),o=[],a=this._chooseSubtree(i,this.data,e,o);for(a.children.push(t),h(a,i);0<=e&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n),a=m(r.children.splice(o,r.children.length-o));a.height=r.height,a.leaf=r.leaf,f(r,this.toBBox),f(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(r,a)},_splitRoot:function(t,e){this.data=m([t,e]),this.data.height=t.height+1,this.data.leaf=!1,f(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var n,i,o,a,s,u,c,l,h,p,f,d,m,g;for(u=c=1/0,n=e;n<=r-e;n++)i=y(t,0,n,this.toBBox),o=y(t,n,r,this.toBBox),h=i,p=o,void 0,f=Math.max(h.minX,p.minX),d=Math.max(h.minY,p.minY),m=Math.min(h.maxX,p.maxX),g=Math.min(h.maxY,p.maxY),a=Math.max(0,m-f)*Math.max(0,g-d),s=v(i)+v(o),a<u?(u=a,l=n,c=s<c?s:c):a===u&&s<c&&(c=s,l=n);return l},_chooseSplitAxis:function(t,e,r){var n=t.leaf?this.compareMinX:o,i=t.leaf?this.compareMinY:a;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)},_allDistMargin:function(t,e,r,n){t.children.sort(n);var i,o,a=this.toBBox,s=y(t,0,e,a),u=y(t,r-e,r,a),c=p(s)+p(u);for(i=e;i<r-e;i++)o=t.children[i],h(s,t.leaf?a(o):o),c+=p(s);for(i=r-e-1;e<=i;i--)o=t.children[i],h(u,t.leaf?a(o):o),c+=p(u);return c},_adjustParentBBoxes:function(t,e,r){for(var n=r;0<=n;n--)h(e[n],t)},_condense:function(t){for(var e,r=t.length-1;0<=r;r--)0===t[r].children.length?0<r?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():f(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},{quickselect:41}],43:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./internal/Observable");r.Observable=n.Observable;var i=t("./internal/observable/ConnectableObservable");r.ConnectableObservable=i.ConnectableObservable;var o=t("./internal/operators/groupBy");r.GroupedObservable=o.GroupedObservable;var a=t("./internal/symbol/observable");r.observable=a.observable;var s=t("./internal/Subject");r.Subject=s.Subject;var u=t("./internal/BehaviorSubject");r.BehaviorSubject=u.BehaviorSubject;var c=t("./internal/ReplaySubject");r.ReplaySubject=c.ReplaySubject;var l=t("./internal/AsyncSubject");r.AsyncSubject=l.AsyncSubject;var h=t("./internal/scheduler/asap");r.asapScheduler=h.asap;var p=t("./internal/scheduler/async");r.asyncScheduler=p.async;var f=t("./internal/scheduler/queue");r.queueScheduler=f.queue;var d=t("./internal/scheduler/animationFrame");r.animationFrameScheduler=d.animationFrame;var m=t("./internal/scheduler/VirtualTimeScheduler");r.VirtualTimeScheduler=m.VirtualTimeScheduler,r.VirtualAction=m.VirtualAction;var g=t("./internal/Scheduler");r.Scheduler=g.Scheduler;var y=t("./internal/Subscription");r.Subscription=y.Subscription;var v=t("./internal/Subscriber");r.Subscriber=v.Subscriber;var _=t("./internal/Notification");r.Notification=_.Notification;var b=t("./internal/util/pipe");r.pipe=b.pipe;var x=t("./internal/util/noop");r.noop=x.noop;var w=t("./internal/util/identity");r.identity=w.identity;var S=t("./internal/util/isObservable");r.isObservable=S.isObservable;var E=t("./internal/util/ArgumentOutOfRangeError");r.ArgumentOutOfRangeError=E.ArgumentOutOfRangeError;var C=t("./internal/util/EmptyError");r.EmptyError=C.EmptyError;var M=t("./internal/util/ObjectUnsubscribedError");r.ObjectUnsubscribedError=M.ObjectUnsubscribedError;var T=t("./internal/util/UnsubscriptionError");r.UnsubscriptionError=T.UnsubscriptionError;var P=t("./internal/util/TimeoutError");r.TimeoutError=P.TimeoutError;var O=t("./internal/observable/bindCallback");r.bindCallback=O.bindCallback;var A=t("./internal/observable/bindNodeCallback");r.bindNodeCallback=A.bindNodeCallback;var I=t("./internal/observable/combineLatest");r.combineLatest=I.combineLatest;var L=t("./internal/observable/concat");r.concat=L.concat;var R=t("./internal/observable/defer");r.defer=R.defer;var N=t("./internal/observable/empty");r.empty=N.empty;var k=t("./internal/observable/forkJoin");r.forkJoin=k.forkJoin;var D=t("./internal/observable/from");r.from=D.from;var j=t("./internal/observable/fromEvent");r.fromEvent=j.fromEvent;var z=t("./internal/observable/fromEventPattern");r.fromEventPattern=z.fromEventPattern;var F=t("./internal/observable/generate");r.generate=F.generate;var B=t("./internal/observable/iif");r.iif=B.iif;var U=t("./internal/observable/interval");r.interval=U.interval;var V=t("./internal/observable/merge");r.merge=V.merge;var G=t("./internal/observable/never");r.never=G.never;var q=t("./internal/observable/of");r.of=q.of;var H=t("./internal/observable/onErrorResumeNext");r.onErrorResumeNext=H.onErrorResumeNext;var $=t("./internal/observable/pairs");r.pairs=$.pairs;var W=t("./internal/observable/race");r.race=W.race;var X=t("./internal/observable/range");r.range=X.range;var Y=t("./internal/observable/throwError");r.throwError=Y.throwError;var Z=t("./internal/observable/timer");r.timer=Z.timer;var K=t("./internal/observable/using");r.using=K.using;var J=t("./internal/observable/zip");r.zip=J.zip;var Q=t("./internal/observable/empty");r.EMPTY=Q.EMPTY;var tt=t("./internal/observable/never");r.NEVER=tt.NEVER;var et=t("./internal/config");r.config=et.config},{"./internal/AsyncSubject":44,"./internal/BehaviorSubject":45,"./internal/Notification":47,"./internal/Observable":48,"./internal/ReplaySubject":51,"./internal/Scheduler":52,"./internal/Subject":53,"./internal/Subscriber":55,"./internal/Subscription":56,"./internal/config":57,"./internal/observable/ConnectableObservable":58,"./internal/observable/bindCallback":60,"./internal/observable/bindNodeCallback":61,"./internal/observable/combineLatest":62,"./internal/observable/concat":63,"./internal/observable/defer":64,"./internal/observable/empty":65,"./internal/observable/forkJoin":66,"./internal/observable/from":67,"./internal/observable/fromEvent":69,"./internal/observable/fromEventPattern":70,"./internal/observable/generate":74,"./internal/observable/iif":75,"./internal/observable/interval":76,"./internal/observable/merge":77,"./internal/observable/never":78,"./internal/observable/of":79,"./internal/observable/onErrorResumeNext":80,"./internal/observable/pairs":81,"./internal/observable/race":82,"./internal/observable/range":83,"./internal/observable/throwError":85,"./internal/observable/timer":86,"./internal/observable/using":87,"./internal/observable/zip":88,"./internal/operators/groupBy":124,"./internal/scheduler/VirtualTimeScheduler":201,"./internal/scheduler/animationFrame":202,"./internal/scheduler/asap":203,"./internal/scheduler/async":204,"./internal/scheduler/queue":205,"./internal/symbol/observable":207,"./internal/util/ArgumentOutOfRangeError":209,"./internal/util/EmptyError":210,"./internal/util/ObjectUnsubscribedError":212,"./internal/util/TimeoutError":213,"./internal/util/UnsubscriptionError":214,"./internal/util/identity":218,"./internal/util/isObservable":227,"./internal/util/noop":230,"./internal/util/pipe":232}],44:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./Subject"),s=t("./Subscription"),u=(o=a.Subject,i(c,o),c.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),s.Subscription.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),s.Subscription.EMPTY):o.prototype._subscribe.call(this,t)},c.prototype.next=function(t){this.hasCompleted||(this.value=t,this.hasNext=!0)},c.prototype.error=function(t){this.hasCompleted||o.prototype.error.call(this,t)},c.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&o.prototype.next.call(this,this.value),o.prototype.complete.call(this)},c);function c(){var t=null!==o&&o.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}r.AsyncSubject=u},{"./Subject":53,"./Subscription":56}],45:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./Subject"),s=t("./util/ObjectUnsubscribedError"),u=(o=a.Subject,i(c,o),Object.defineProperty(c.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),c.prototype._subscribe=function(t){var e=o.prototype._subscribe.call(this,t);return e&&!e.closed&&t.next(this._value),e},c.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new s.ObjectUnsubscribedError;return this._value},c.prototype.next=function(t){o.prototype.next.call(this,this._value=t)},c);function c(t){var e=o.call(this)||this;return e._value=t,e}r.BehaviorSubject=u},{"./Subject":53,"./util/ObjectUnsubscribedError":212}],46:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./Subscriber"),s=(o=a.Subscriber,i(u,o),u.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},u.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},u.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},u);function u(t,e,r){var n=o.call(this)||this;return n.parent=t,n.outerValue=e,n.outerIndex=r,n.index=0,n}r.InnerSubscriber=s},{"./Subscriber":55}],47:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./observable/empty"),i=t("./observable/of"),o=t("./observable/throwError"),a=(s.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},s.prototype.do=function(t,e,r){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return r&&r()}},s.prototype.accept=function(t,e,r){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,r)},s.prototype.toObservable=function(){switch(this.kind){case"N":return i.of(this.value);case"E":return o.throwError(this.error);case"C":return n.empty()}throw new Error("unexpected notification kind value")},s.createNext=function(t){return void 0!==t?new s("N",t):s.undefinedValueNotification},s.createError=function(t){return new s("E",void 0,t)},s.createComplete=function(){return s.completeNotification},s.completeNotification=new s("C"),s.undefinedValueNotification=new s("N",void 0),s);function s(t,e,r){this.kind=t,this.value=e,this.error=r,this.hasValue="N"===t}r.Notification=a},{"./observable/empty":65,"./observable/of":79,"./observable/throwError":85}],48:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./util/canReportError"),o=t("./util/toSubscriber"),i=t("../internal/symbol/observable"),a=t("./util/pipe"),s=t("./config"),u=(c.prototype.lift=function(t){var e=new c;return e.source=this,e.operator=t,e},c.prototype.subscribe=function(t,e,r){var n=this.operator,i=o.toSubscriber(t,e,r);if(n?n.call(i,this.source):i.add(this.source||s.config.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),s.config.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},c.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){s.config.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),n.canReportError(e)?e.error(t):console.warn(t)}},c.prototype.forEach=function(n,t){var i=this;return new(t=l(t))(function(t,e){var r;r=i.subscribe(function(t){try{n(t)}catch(t){e(t),r&&r.unsubscribe()}},e,t)})},c.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},c.prototype[i.observable]=function(){return this},c.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:a.pipeFromArray(t)(this)},c.prototype.toPromise=function(t){var n=this;return new(t=l(t))(function(t,e){var r;n.subscribe(function(t){return r=t},function(t){return e(t)},function(){return t(r)})})},c.create=function(t){return new c(t)},c);function c(t){this._isScalar=!1,t&&(this._subscribe=t)}function l(t){if(!(t=t||(s.config.Promise||Promise)))throw new Error("no Promise impl found");return t}r.Observable=u},{"../internal/symbol/observable":207,"./config":57,"./util/canReportError":215,"./util/pipe":232,"./util/toSubscriber":239}],49:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./config"),i=t("./util/hostReportError");r.empty={closed:!0,next:function(t){},error:function(t){if(n.config.useDeprecatedSynchronousErrorHandling)throw t;i.hostReportError(t)},complete:function(){}}},{"./config":57,"./util/hostReportError":217}],50:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./Subscriber"),s=(o=a.Subscriber,i(u,o),u.prototype.notifyNext=function(t,e,r,n,i){this.destination.next(e)},u.prototype.notifyError=function(t,e){this.destination.error(t)},u.prototype.notifyComplete=function(t){this.destination.complete()},u);function u(){return null!==o&&o.apply(this,arguments)||this}r.OuterSubscriber=s},{"./Subscriber":55}],51:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./Subject"),s=t("./scheduler/queue"),u=t("./Subscription"),c=t("./operators/observeOn"),l=t("./util/ObjectUnsubscribedError"),h=t("./SubjectSubscription"),p=(o=a.Subject,i(f,o),f.prototype.nextInfiniteTimeWindow=function(t){var e=this._events;e.push(t),e.length>this._bufferSize&&e.shift(),o.prototype.next.call(this,t)},f.prototype.nextTimeWindow=function(t){this._events.push(new d(this._getNow(),t)),this._trimBufferThenGetEvents(),o.prototype.next.call(this,t)},f.prototype._subscribe=function(t){var e,r=this._infiniteTimeWindow,n=r?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=n.length;if(this.closed)throw new l.ObjectUnsubscribedError;if(e=this.isStopped||this.hasError?u.Subscription.EMPTY:(this.observers.push(t),new h.SubjectSubscription(this,t)),i&&t.add(t=new c.ObserveOnSubscriber(t,i)),r)for(var a=0;a<o&&!t.closed;a++)t.next(n[a]);else for(a=0;a<o&&!t.closed;a++)t.next(n[a].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e},f.prototype._getNow=function(){return(this.scheduler||s.queue).now()},f.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,r=this._windowTime,n=this._events,i=n.length,o=0;o<i&&!(t-n[o].time<r);)o++;return e<i&&(o=Math.max(o,i-e)),0<o&&n.splice(0,o),n},f);function f(t,e,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===e&&(e=Number.POSITIVE_INFINITY);var n=o.call(this)||this;return n.scheduler=r,n._events=[],n._infiniteTimeWindow=!1,n._bufferSize=t<1?1:t,n._windowTime=e<1?1:e,e===Number.POSITIVE_INFINITY?(n._infiniteTimeWindow=!0,n.next=n.nextInfiniteTimeWindow):n.next=n.nextTimeWindow,n}r.ReplaySubject=p;var d=function(t,e){this.time=t,this.value=e}},{"./Subject":53,"./SubjectSubscription":54,"./Subscription":56,"./operators/observeOn":139,"./scheduler/queue":205,"./util/ObjectUnsubscribedError":212}],52:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(i.prototype.schedule=function(t,e,r){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(r,e)},i.now=function(){return Date.now()},i);function i(t,e){void 0===e&&(e=i.now),this.SchedulerAction=t,this.now=e}r.Scheduler=n},{}],53:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./Observable"),s=t("./Subscriber"),u=t("./Subscription"),c=t("./util/ObjectUnsubscribedError"),l=t("./SubjectSubscription"),h=t("../internal/symbol/rxSubscriber"),p=(o=s.Subscriber,i(f,o),f);function f(t){var e=o.call(this,t)||this;return e.destination=t,e}r.SubjectSubscriber=p;var d,m=(d=a.Observable,i(g,d),g.prototype[h.rxSubscriber]=function(){return new p(this)},g.prototype.lift=function(t){var e=new v(this,this);return e.operator=t,e},g.prototype.next=function(t){if(this.closed)throw new c.ObjectUnsubscribedError;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),i=0;i<r;i++)n[i].next(t)},g.prototype.error=function(t){if(this.closed)throw new c.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),i=0;i<r;i++)n[i].error(t);this.observers.length=0},g.prototype.complete=function(){if(this.closed)throw new c.ObjectUnsubscribedError;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;n<e;n++)r[n].complete();this.observers.length=0},g.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},g.prototype._trySubscribe=function(t){if(this.closed)throw new c.ObjectUnsubscribedError;return d.prototype._trySubscribe.call(this,t)},g.prototype._subscribe=function(t){if(this.closed)throw new c.ObjectUnsubscribedError;return this.hasError?(t.error(this.thrownError),u.Subscription.EMPTY):this.isStopped?(t.complete(),u.Subscription.EMPTY):(this.observers.push(t),new l.SubjectSubscription(this,t))},g.prototype.asObservable=function(){var t=new a.Observable;return t.source=this,t},g.create=function(t,e){return new v(t,e)},g);function g(){var t=d.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}r.Subject=m;var y,v=(i(_,y=m),_.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},_.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},_.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},_.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):u.Subscription.EMPTY},_);function _(t,e){var r=y.call(this)||this;return r.destination=t,r.source=e,r}r.AnonymousSubject=v},{"../internal/symbol/rxSubscriber":208,"./Observable":48,"./SubjectSubscription":54,"./Subscriber":55,"./Subscription":56,"./util/ObjectUnsubscribedError":212}],54:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./Subscription"),s=(o=a.Subscription,i(u,o),u.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},u);function u(t,e){var r=o.call(this)||this;return r.subject=t,r.subscriber=e,r.closed=!1,r}r.SubjectSubscription=s},{"./Subscription":56}],55:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,s=t("./util/isFunction"),u=t("./Observer"),a=t("./Subscription"),c=t("../internal/symbol/rxSubscriber"),l=t("./config"),h=t("./util/hostReportError"),p=(o=a.Subscription,i(f,o),f.prototype[c.rxSubscriber]=function(){return this},f.create=function(t,e,r){var n=new f(t,e,r);return n.syncErrorThrowable=!1,n},f.prototype.next=function(t){this.isStopped||this._next(t)},f.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},f.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},f.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,o.prototype.unsubscribe.call(this))},f.prototype._next=function(t){this.destination.next(t)},f.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},f.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},f.prototype._unsubscribeAndRecycle=function(){var t=this._parent,e=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this._parentSubscription=null,this},f);function f(t,e,r){var n=o.call(this)||this;switch(n.syncErrorValue=null,n.syncErrorThrown=!1,n.syncErrorThrowable=!1,n.isStopped=!1,n._parentSubscription=null,arguments.length){case 0:n.destination=u.empty;break;case 1:if(!t){n.destination=u.empty;break}if("object"==typeof t){t instanceof f?(n.syncErrorThrowable=t.syncErrorThrowable,(n.destination=t).add(n)):(n.syncErrorThrowable=!0,n.destination=new m(n,t));break}default:n.syncErrorThrowable=!0,n.destination=new m(n,t,e,r)}return n}r.Subscriber=p;var d,m=(i(g,d=p),g.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;l.config.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},g.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=l.config.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?this.__tryOrSetError(e,this._error,t):this.__tryOrUnsub(this._error,t),this.unsubscribe();else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):h.hostReportError(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;h.hostReportError(t)}}},g.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};l.config.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,r):this.__tryOrUnsub(r),this.unsubscribe()}else this.unsubscribe()}},g.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),l.config.useDeprecatedSynchronousErrorHandling)throw t;h.hostReportError(t)}},g.prototype.__tryOrSetError=function(t,e,r){if(!l.config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return l.config.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0):(h.hostReportError(e),!0)}return!1},g.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},g);function g(t,e,r,n){var i,o=d.call(this)||this;o._parentSubscriber=t;var a=o;return s.isFunction(e)?i=e:e&&(i=e.next,r=e.error,n=e.complete,e!==u.empty&&(a=Object.create(e),s.isFunction(a.unsubscribe)&&o.add(a.unsubscribe.bind(a)),a.unsubscribe=o.unsubscribe.bind(o))),o._context=a,o._next=i,o._error=r,o._complete=n,o}r.SafeSubscriber=m},{"../internal/symbol/rxSubscriber":208,"./Observer":49,"./Subscription":56,"./config":57,"./util/hostReportError":217,"./util/isFunction":222}],56:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,l=t("./util/isArray"),h=t("./util/isObject"),p=t("./util/isFunction"),f=t("./util/tryCatch"),d=t("./util/errorObject"),m=t("./util/UnsubscriptionError"),i=(o.prototype.unsubscribe=function(){var t,e=!1;if(!this.closed){var r=this._parent,n=this._parents,i=this._unsubscribe,o=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var a=-1,s=n?n.length:0;r;)r.remove(this),r=++a<s&&n[a]||null;if(p.isFunction(i)&&f.tryCatch(i).call(this)===d.errorObject&&(e=!0,t=t||(d.errorObject.e instanceof m.UnsubscriptionError?g(d.errorObject.e.errors):[d.errorObject.e])),l.isArray(o))for(a=-1,s=o.length;++a<s;){var u=o[a];if(h.isObject(u)&&f.tryCatch(u.unsubscribe).call(u)===d.errorObject){e=!0,t=t||[];var c=d.errorObject.e;c instanceof m.UnsubscriptionError?t=t.concat(g(c.errors)):t.push(c)}}if(e)throw new m.UnsubscriptionError(t)}},o.prototype.add=function(t){if(!t||t===o.EMPTY)return o.EMPTY;if(t===this)return this;var e=t;switch(typeof t){case"function":e=new o(t);case"object":if(e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if("function"!=typeof e._addParent){var r=e;(e=new o)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(e),e._addParent(this),e},o.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},o.prototype._addParent=function(t){var e=this._parent,r=this._parents;e&&e!==t?r?-1===r.indexOf(t)&&r.push(t):this._parents=[t]:this._parent=t},o.EMPTY=((n=new o).closed=!0,n),o);function o(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}function g(t){return t.reduce(function(t,e){return t.concat(e instanceof m.UnsubscriptionError?e.errors:e)},[])}r.Subscription=i},{"./util/UnsubscriptionError":214,"./util/errorObject":216,"./util/isArray":219,"./util/isFunction":222,"./util/isObject":226,"./util/tryCatch":240}],57:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=!1;r.config={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){var e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else n&&console.log("RxJS: Back to a better error behavior. Thank you. <3");n=t},get useDeprecatedSynchronousErrorHandling(){return n}}},{}],58:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../Subject"),s=t("../Observable"),u=t("../Subscriber"),c=t("../Subscription"),l=t("../operators/refCount"),h=(o=s.Observable,i(p,o),p.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},p.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},p.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new c.Subscription).add(this.source.subscribe(new m(this.getSubject(),this))),t.closed?(this._connection=null,t=c.Subscription.EMPTY):this._connection=t),t},p.prototype.refCount=function(){return l.refCount()(this)},p);function p(t,e){var r=o.call(this)||this;return r.source=t,r.subjectFactory=e,r._refCount=0,r._isComplete=!1,r}var f=(r.ConnectableObservable=h).prototype;r.connectableObservableDescriptor={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:f._subscribe},_isComplete:{value:f._isComplete,writable:!0},getSubject:{value:f.getSubject},connect:{value:f.connect},refCount:{value:f.refCount}};var d,m=(d=a.SubjectSubscriber,i(g,d),g.prototype._error=function(t){this._unsubscribe(),d.prototype._error.call(this,t)},g.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),d.prototype._complete.call(this)},g.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},g);function g(t,e){var r=d.call(this,t)||this;return r.connectable=e,r}y.prototype.call=function(t,e){var r=this.connectable;r._refCount++;var n=new _(t,r),i=e.subscribe(n);return n.closed||(n.connection=r.connect()),i};function y(t){this.connectable=t}var v,_=(v=u.Subscriber,i(b,v),b.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,1<e)this.connection=null;else{var r=this.connection,n=t._connection;this.connection=null,!n||r&&n!==r||n.unsubscribe()}}else this.connection=null},b);function b(t,e){var r=v.call(this,t)||this;return r.connectable=e,r}},{"../Observable":48,"../Subject":53,"../Subscriber":55,"../Subscription":56,"../operators/refCount":150}],59:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../Observable"),s=t("../scheduler/asap"),u=t("../util/isNumeric"),c=(o=a.Observable,i(l,o),l.create=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=s.asap),new l(t,e,r)},l.dispatch=function(t){var e=t.source,r=t.subscriber;return this.add(e.subscribe(r))},l.prototype._subscribe=function(t){var e=this.delayTime,r=this.source;return this.scheduler.schedule(l.dispatch,e,{source:r,subscriber:t})},l);function l(t,e,r){void 0===e&&(e=0),void 0===r&&(r=s.asap);var n=o.call(this)||this;return n.source=t,n.delayTime=e,n.scheduler=r,(!u.isNumeric(e)||e<0)&&(n.delayTime=0),r&&"function"==typeof r.schedule||(n.scheduler=s.asap),n}r.SubscribeOnObservable=c},{"../Observable":48,"../scheduler/asap":203,"../util/isNumeric":225}],60:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var u=t("../Observable"),c=t("../AsyncSubject"),i=t("../operators/map"),l=t("../util/canReportError"),o=t("../util/isArray"),h=t("../util/isScheduler");function p(t){var n=this,e=t.args,r=t.subscriber,i=t.params,o=i.callbackFunc,a=i.context,s=i.scheduler,u=i.subject;if(!u){u=i.subject=new c.AsyncSubject;try{o.apply(a,e.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t.length<=1?t[0]:t;n.add(s.schedule(f,0,{value:r,subject:u}))}]))}catch(t){u.error(t)}}this.add(u.subscribe(r))}function f(t){var e=t.value,r=t.subject;r.next(e),r.complete()}r.bindCallback=function r(a,n,s){if(n){if(!h.isScheduler(n))return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r(a,s).apply(void 0,t).pipe(i.map(function(t){return o.isArray(t)?n.apply(void 0,t):n(t)}))};s=n}return function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var n,i=this,o={context:i,subject:n,callbackFunc:a,scheduler:s};return new u.Observable(function(t){if(s){var e={args:r,subscriber:t,params:o};return s.schedule(p,0,e)}if(!n){n=new c.AsyncSubject;try{a.apply(i,r.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];n.next(t.length<=1?t[0]:t),n.complete()}]))}catch(t){l.canReportError(n)?n.error(t):console.warn(t)}}return n.subscribe(t)})}}},{"../AsyncSubject":44,"../Observable":48,"../operators/map":128,"../util/canReportError":215,"../util/isArray":219,"../util/isScheduler":229}],61:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t("../Observable"),c=t("../AsyncSubject"),i=t("../operators/map"),u=t("../util/canReportError"),l=t("../util/isScheduler"),h=t("../util/isArray");function p(t){var i=this,e=t.params,r=t.subscriber,n=t.context,o=e.callbackFunc,a=e.args,s=e.scheduler,u=e.subject;if(!u){u=e.subject=new c.AsyncSubject;try{o.apply(n,a.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t.shift();if(r)i.add(s.schedule(d,0,{err:r,subject:u}));else{var n=t.length<=1?t[0]:t;i.add(s.schedule(f,0,{value:n,subject:u}))}}]))}catch(t){this.add(s.schedule(d,0,{err:t,subject:u}))}}this.add(u.subscribe(r))}function f(t){var e=t.value,r=t.subject;r.next(e),r.complete()}function d(t){var e=t.err;t.subject.error(e)}r.bindNodeCallback=function r(o,n,a){if(n){if(!l.isScheduler(n))return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r(o,a).apply(void 0,t).pipe(i.map(function(t){return h.isArray(t)?n.apply(void 0,t):n(t)}))};a=n}return function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var i={subject:void 0,args:r,callbackFunc:o,scheduler:a,context:this};return new s.Observable(function(t){var e=i.context,n=i.subject;if(a)return a.schedule(p,0,{params:i,subscriber:t,context:e});if(!n){n=i.subject=new c.AsyncSubject;try{o.apply(e,r.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t.shift();r?n.error(r):(n.next(t.length<=1?t[0]:t),n.complete())}]))}catch(t){u.canReportError(n)?n.error(t):console.warn(t)}}return n.subscribe(t)})}}},{"../AsyncSubject":44,"../Observable":48,"../operators/map":128,"../util/canReportError":215,"../util/isArray":219,"../util/isScheduler":229}],62:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../util/isScheduler"),a=t("../util/isArray"),s=t("../OuterSubscriber"),u=t("../util/subscribeToResult"),c=t("./fromArray"),l={};r.combineLatest=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=null,n=null;return o.isScheduler(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&a.isArray(t[0])&&(t=t[0]),c.fromArray(t,n).lift(new h(r))};var h=(p.prototype.call=function(t,e){return e.subscribe(new d(t,this.resultSelector))},p);function p(t){this.resultSelector=t}r.CombineLatestOperator=h;var f,d=(f=s.OuterSubscriber,i(m,f),m.prototype._next=function(t){this.values.push(l),this.observables.push(t)},m.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var r=0;r<e;r++){var n=t[r];this.add(u.subscribeToResult(this,n,n,r))}}},m.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},m.prototype.notifyNext=function(t,e,r,n,i){var o=this.values,a=o[r],s=this.toRespond?a===l?--this.toRespond:this.toRespond:0;o[r]=e,0===s&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))},m.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},m);function m(t,e){var r=f.call(this,t)||this;return r.resultSelector=e,r.active=0,r.values=[],r.observables=[],r}r.CombineLatestSubscriber=d},{"../OuterSubscriber":50,"../util/isArray":219,"../util/isScheduler":229,"../util/subscribeToResult":238,"./fromArray":68}],63:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../util/isScheduler"),i=t("./of"),o=t("./from"),a=t("../operators/concatAll");r.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 1===t.length||2===t.length&&n.isScheduler(t[1])?o.from(t[0]):a.concatAll()(i.of.apply(void 0,t))}},{"../operators/concatAll":100,"../util/isScheduler":229,"./from":67,"./of":79}],64:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Observable"),i=t("./from"),o=t("./empty");r.defer=function(r){return new n.Observable(function(t){var e;try{e=r()}catch(e){return void t.error(e)}return(e?i.from(e):o.empty()).subscribe(t)})}},{"../Observable":48,"./empty":65,"./from":67}],65:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Observable");function i(e){return new n.Observable(function(t){return e.schedule(function(){return t.complete()})})}r.EMPTY=new n.Observable(function(t){return t.complete()}),r.empty=function(t){return t?i(t):r.EMPTY},r.emptyScheduled=i},{"../Observable":48}],66:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Observable"),a=t("../util/isArray"),s=t("./empty"),u=t("../util/subscribeToResult"),c=t("../OuterSubscriber"),l=t("../operators/map");r.forkJoin=function t(){for(var e,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return"function"==typeof r[r.length-1]&&(e=r.pop()),1===r.length&&a.isArray(r[0])&&(r=r[0]),0===r.length?s.EMPTY:e?t(r).pipe(l.map(function(t){return e.apply(void 0,t)})):new o.Observable(function(t){return new p(t,r)})};var h,p=(h=c.OuterSubscriber,i(f,h),f.prototype.notifyNext=function(t,e,r,n,i){this.values[r]=e,i._hasValue||(i._hasValue=!0,this.haveValues++)},f.prototype.notifyComplete=function(t){var e=this.destination,r=this.haveValues,n=this.values,i=n.length;t._hasValue?(this.completed++,this.completed===i&&(r===i&&e.next(n),e.complete())):e.complete()},f);function f(t,e){var r=h.call(this,t)||this;r.sources=e,r.completed=0,r.haveValues=0;var n=e.length;r.values=new Array(n);for(var i=0;i<n;i++){var o=e[i],a=u.subscribeToResult(r,o,null,i);a&&r.add(a)}return r}},{"../Observable":48,"../OuterSubscriber":50,"../operators/map":128,"../util/isArray":219,"../util/subscribeToResult":238,"./empty":65}],67:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Observable"),i=t("../util/isPromise"),o=t("../util/isArrayLike"),a=t("../util/isInteropObservable"),s=t("../util/isIterable"),u=t("./fromArray"),c=t("./fromPromise"),l=t("./fromIterable"),h=t("./fromObservable"),p=t("../util/subscribeTo");r.from=function(t,e){if(!e)return t instanceof n.Observable?t:new n.Observable(p.subscribeTo(t));if(null!=t){if(a.isInteropObservable(t))return h.fromObservable(t,e);if(i.isPromise(t))return c.fromPromise(t,e);if(o.isArrayLike(t))return u.fromArray(t,e);if(s.isIterable(t)||"string"==typeof t)return l.fromIterable(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}},{"../Observable":48,"../util/isArrayLike":220,"../util/isInteropObservable":223,"../util/isIterable":224,"../util/isPromise":228,"../util/subscribeTo":233,"./fromArray":68,"./fromIterable":71,"./fromObservable":72,"./fromPromise":73}],68:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Observable"),a=t("../Subscription"),s=t("../util/subscribeToArray");r.fromArray=function(n,i){return i?new o.Observable(function(t){var e=new a.Subscription,r=0;return e.add(i.schedule(function(){r!==n.length?(t.next(n[r++]),t.closed||e.add(this.schedule())):t.complete()})),e}):new o.Observable(s.subscribeToArray(n))}},{"../Observable":48,"../Subscription":56,"../util/subscribeToArray":234}],69:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Observable"),a=t("../util/isArray"),s=t("../util/isFunction"),u=t("../operators/map");Object.prototype.toString;r.fromEvent=function t(r,n,i,e){return s.isFunction(i)&&(e=i,i=void 0),e?t(r,n,i).pipe(u.map(function(t){return a.isArray(t)?e.apply(void 0,t):e(t)})):new o.Observable(function(e){!function t(e,r,n,i,o){var a,s,u,c;if((c=e)&&"function"==typeof c.addEventListener&&"function"==typeof c.removeEventListener){var l=e;e.addEventListener(r,n,o),a=function(){return l.removeEventListener(r,n,o)}}else if((u=e)&&"function"==typeof u.on&&"function"==typeof u.off){var h=e;e.on(r,n),a=function(){return h.off(r,n)}}else if((s=e)&&"function"==typeof s.addListener&&"function"==typeof s.removeListener){var p=e;e.addListener(r,n),a=function(){return p.removeListener(r,n)}}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var f=0,d=e.length;f<d;f++)t(e[f],r,n,i,o)}i.add(a)}(r,n,function(t){1<arguments.length?e.next(Array.prototype.slice.call(arguments)):e.next(t)},e,i)})}},{"../Observable":48,"../operators/map":128,"../util/isArray":219,"../util/isFunction":222}],70:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Observable"),a=t("../util/isArray"),s=t("../util/isFunction"),u=t("../operators/map");r.fromEventPattern=function t(n,i,e){return e?t(n,i).pipe(u.map(function(t){return a.isArray(t)?e.apply(void 0,t):e(t)})):new o.Observable(function(r){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r.next(1===t.length?t[0]:t)}var e;try{e=n(t)}catch(t){return void r.error(t)}if(s.isFunction(i))return function(){return i(t,e)}})}},{"../Observable":48,"../operators/map":128,"../util/isArray":219,"../util/isFunction":222}],71:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Observable"),o=t("../Subscription"),a=t("../symbol/iterator"),i=t("../util/subscribeToIterable");r.fromIterable=function(e,r){if(!e)throw new Error("Iterable cannot be null");return r?new n.Observable(function(n){var i,t=new o.Subscription;return t.add(function(){i&&"function"==typeof i.return&&i.return()}),t.add(r.schedule(function(){i=e[a.iterator](),t.add(r.schedule(function(){if(!n.closed){var t,e;try{var r=i.next();t=r.value,e=r.done}catch(t){return void n.error(t)}e?n.complete():(n.next(t),this.schedule())}}))})),t}):new n.Observable(i.subscribeToIterable(e))}},{"../Observable":48,"../Subscription":56,"../symbol/iterator":206,"../util/subscribeToIterable":235}],72:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Observable"),a=t("../Subscription"),s=t("../symbol/observable"),u=t("../util/subscribeToObservable");r.fromObservable=function(n,i){return i?new o.Observable(function(e){var r=new a.Subscription;return r.add(i.schedule(function(){var t=n[s.observable]();r.add(t.subscribe({next:function(t){r.add(i.schedule(function(){return e.next(t)}))},error:function(t){r.add(i.schedule(function(){return e.error(t)}))},complete:function(){r.add(i.schedule(function(){return e.complete()}))}}))})),r}):new o.Observable(u.subscribeToObservable(n))}},{"../Observable":48,"../Subscription":56,"../symbol/observable":207,"../util/subscribeToObservable":236}],73:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("../Observable"),o=t("../Subscription"),a=t("../util/subscribeToPromise");r.fromPromise=function(t,n){return n?new i.Observable(function(e){var r=new o.Subscription;return r.add(n.schedule(function(){return t.then(function(t){r.add(n.schedule(function(){e.next(t),r.add(n.schedule(function(){return e.complete()}))}))},function(t){r.add(n.schedule(function(){return e.error(t)}))})})),r}):new i.Observable(a.subscribeToPromise(t))}},{"../Observable":48,"../Subscription":56,"../util/subscribeToPromise":237}],74:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Observable"),c=t("../util/identity"),l=t("../util/isScheduler");function h(t){var e=t.subscriber,r=t.condition;if(!e.closed){if(t.needIterate)try{t.state=t.iterate(t.state)}catch(t){return void e.error(t)}else t.needIterate=!0;if(r){var n=void 0;try{n=r(t.state)}catch(t){return void e.error(t)}if(!n)return void e.complete();if(e.closed)return}var i;try{i=t.resultSelector(t.state)}catch(t){return void e.error(t)}if(!e.closed&&(e.next(i),!e.closed))return this.schedule(t)}}r.generate=function(t,i,o,e,a){var s,u;if(1==arguments.length){var r=t;u=r.initialState,i=r.condition,o=r.iterate,s=r.resultSelector||c.identity,a=r.scheduler}else void 0===e||l.isScheduler(e)?(u=t,s=c.identity,a=e):(u=t,s=e);return new n.Observable(function(t){var e=u;if(a)return a.schedule(h,0,{subscriber:t,iterate:o,condition:i,resultSelector:s,state:e});for(;;){if(i){var r=void 0;try{r=i(e)}catch(e){return void t.error(e)}if(!r){t.complete();break}}var n=void 0;try{n=s(e)}catch(e){return void t.error(e)}if(t.next(n),t.closed)break;try{e=o(e)}catch(e){return void t.error(e)}}})}},{"../Observable":48,"../util/identity":218,"../util/isScheduler":229}],75:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./defer"),i=t("./empty");r.iif=function(t,e,r){return void 0===e&&(e=i.EMPTY),void 0===r&&(r=i.EMPTY),n.defer(function(){return t()?e:r})}},{"./defer":64,"./empty":65}],76:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Observable"),i=t("../scheduler/async"),o=t("../util/isNumeric");function a(t){var e=t.subscriber,r=t.counter,n=t.period;e.next(r),this.schedule({subscriber:e,counter:r+1,period:n},n)}r.interval=function(e,r){return void 0===e&&(e=0),void 0===r&&(r=i.async),(!o.isNumeric(e)||e<0)&&(e=0),r&&"function"==typeof r.schedule||(r=i.async),new n.Observable(function(t){return t.add(r.schedule(a,e,{subscriber:t,counter:0,period:e})),t})}},{"../Observable":48,"../scheduler/async":204,"../util/isNumeric":225}],77:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Observable"),a=t("../util/isScheduler"),s=t("../operators/mergeAll"),u=t("./fromArray");r.merge=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Number.POSITIVE_INFINITY,n=null,i=t[t.length-1];return a.isScheduler(i)?(n=t.pop(),1<t.length&&"number"==typeof t[t.length-1]&&(r=t.pop())):"number"==typeof i&&(r=t.pop()),null===n&&1===t.length&&t[0]instanceof o.Observable?t[0]:s.mergeAll(r)(u.fromArray(t,n))}},{"../Observable":48,"../operators/mergeAll":133,"../util/isScheduler":229,"./fromArray":68}],78:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Observable"),i=t("../util/noop");r.NEVER=new n.Observable(i.noop),r.never=function(){return r.NEVER}},{"../Observable":48,"../util/noop":230}],79:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../util/isScheduler"),i=t("./fromArray"),o=t("./empty"),a=t("./scalar");r.of=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[t.length-1];switch(n.isScheduler(r)?t.pop():r=void 0,t.length){case 0:return o.empty(r);case 1:return r?i.fromArray(t,r):a.scalar(t[0]);default:return i.fromArray(t,r)}}},{"../util/isScheduler":229,"./empty":65,"./fromArray":68,"./scalar":84}],80:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Observable"),a=t("./from"),s=t("../util/isArray"),u=t("./empty");r.onErrorResumeNext=function r(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)return u.EMPTY;var n=t[0],i=t.slice(1);return 1===t.length&&s.isArray(n)?r.apply(void 0,n):new o.Observable(function(e){function t(){return e.add(r.apply(void 0,i).subscribe(e))}return a.from(n).subscribe({next:function(t){e.next(t)},error:t,complete:t})})}},{"../Observable":48,"../util/isArray":219,"./empty":65,"./from":67}],81:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Observable"),a=t("../Subscription");function s(t){var e=t.keys,r=t.index,n=t.subscriber,i=t.subscription,o=t.obj;if(!n.closed)if(r<e.length){var a=e[r];n.next([a,o[a]]),i.add(this.schedule({keys:e,index:r+1,subscriber:n,subscription:i,obj:o}))}else n.complete()}r.pairs=function(i,n){return n?new o.Observable(function(t){var e=Object.keys(i),r=new a.Subscription;return r.add(n.schedule(s,0,{keys:e,index:0,subscriber:t,subscription:r,obj:i})),r}):new o.Observable(function(t){for(var e=Object.keys(i),r=0;r<e.length&&!t.closed;r++){var n=e[r];i.hasOwnProperty(n)&&t.next([n,i[n]])}t.complete()})},r.dispatch=s},{"../Observable":48,"../Subscription":56}],82:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../util/isArray"),a=t("./fromArray"),s=t("../OuterSubscriber"),u=t("../util/subscribeToResult");r.race=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){if(!o.isArray(t[0]))return t[0];t=t[0]}return a.fromArray(t,void 0).lift(new c)};var c=(l.prototype.call=function(t,e){return e.subscribe(new p(t))},l);function l(){}r.RaceOperator=c;var h,p=(h=s.OuterSubscriber,i(f,h),f.prototype._next=function(t){this.observables.push(t)},f.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{for(var r=0;r<e&&!this.hasFirst;r++){var n=t[r],i=u.subscribeToResult(this,n,n,r);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},f.prototype.notifyNext=function(t,e,r,n,i){if(!this.hasFirst){this.hasFirst=!0;for(var o=0;o<this.subscriptions.length;o++)if(o!==r){var a=this.subscriptions[o];a.unsubscribe(),this.remove(a)}this.subscriptions=null}this.destination.next(e)},f);function f(t){var e=h.call(this,t)||this;return e.hasFirst=!1,e.observables=[],e.subscriptions=[],e}r.RaceSubscriber=p},{"../OuterSubscriber":50,"../util/isArray":219,"../util/subscribeToResult":238,"./fromArray":68}],83:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=t("../Observable");function s(t){var e=t.start,r=t.index,n=t.count,i=t.subscriber;n<=r?i.complete():(i.next(e),i.closed||(t.index=r+1,t.start=e+1,this.schedule(t)))}r.range=function(n,i,o){return void 0===n&&(n=0),void 0===i&&(i=0),new a.Observable(function(t){var e=0,r=n;if(o)return o.schedule(s,0,{index:e,count:i,start:n,subscriber:t});for(;;){if(e++>=i){t.complete();break}if(t.next(r++),t.closed)break}})},r.dispatch=s},{"../Observable":48}],84:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Observable");r.scalar=function(e){var t=new n.Observable(function(t){t.next(e),t.complete()});return t._isScalar=!0,t.value=e,t}},{"../Observable":48}],85:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Observable");function i(t){var e=t.error;t.subscriber.error(e)}r.throwError=function(e,r){return r?new n.Observable(function(t){return r.schedule(i,0,{error:e,subscriber:t})}):new n.Observable(function(t){return t.error(e)})}},{"../Observable":48}],86:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Observable"),a=t("../scheduler/async"),s=t("../util/isNumeric"),u=t("../util/isScheduler");function c(t){var e=t.index,r=t.period,n=t.subscriber;if(n.next(e),!n.closed){if(-1===r)return n.complete();t.index=e+1,this.schedule(t,r)}}r.timer=function(r,t,n){void 0===r&&(r=0);var i=-1;return s.isNumeric(t)?i=Number(t)<1?1:Number(t):u.isScheduler(t)&&(n=t),u.isScheduler(n)||(n=a.async),new o.Observable(function(t){var e=s.isNumeric(r)?r:+r-n.now();return n.schedule(c,e,{index:0,period:i,subscriber:t})})}},{"../Observable":48,"../scheduler/async":204,"../util/isNumeric":225,"../util/isScheduler":229}],87:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Observable"),a=t("./from"),s=t("./empty");r.using=function(i,o){return new n.Observable(function(t){var e,r;try{e=i()}catch(e){return void t.error(e)}try{r=o(e)}catch(e){return void t.error(e)}var n=(r?a.from(r):s.EMPTY).subscribe(t);return function(){n.unsubscribe(),e&&e.unsubscribe()}})}},{"../Observable":48,"./empty":65,"./from":67}],88:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("./fromArray"),a=t("../util/isArray"),s=t("../Subscriber"),u=t("../OuterSubscriber"),c=t("../util/subscribeToResult"),l=t("../../internal/symbol/iterator");r.zip=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[t.length-1];return"function"==typeof r&&t.pop(),o.fromArray(t,void 0).lift(new h(r))};var h=(p.prototype.call=function(t,e){return e.subscribe(new d(t,this.resultSelector))},p);function p(t){this.resultSelector=t}r.ZipOperator=h;var f,d=(f=s.Subscriber,i(m,f),m.prototype._next=function(t){var e=this.iterators;a.isArray(t)?e.push(new v(t)):"function"==typeof t[l.iterator]?e.push(new g(t[l.iterator]())):e.push(new x(this.destination,this,t))},m.prototype._complete=function(){var t=this.iterators,e=t.length;if(this.unsubscribe(),0!==e){this.active=e;for(var r=0;r<e;r++){var n=t[r];n.stillUnsubscribed?this.destination.add(n.subscribe(n,r)):this.active--}}else this.destination.complete()},m.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},m.prototype.checkIterators=function(){for(var t=this.iterators,e=t.length,r=this.destination,n=0;n<e;n++)if("function"==typeof(a=t[n]).hasValue&&!a.hasValue())return;var i=!1,o=[];for(n=0;n<e;n++){var a,s=(a=t[n]).next();if(a.hasCompleted()&&(i=!0),s.done)return void r.complete();o.push(s.value)}this.resultSelector?this._tryresultSelector(o):r.next(o),i&&r.complete()},m.prototype._tryresultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},m);function m(t,e,r){void 0===r&&(r=Object.create(null));var n=f.call(this,t)||this;return n.iterators=[],n.active=0,n.resultSelector="function"==typeof e?e:null,n.values=r,n}r.ZipSubscriber=d;var g=(y.prototype.hasValue=function(){return!0},y.prototype.next=function(){var t=this.nextResult;return this.nextResult=this.iterator.next(),t},y.prototype.hasCompleted=function(){var t=this.nextResult;return t&&t.done},y);function y(t){this.iterator=t,this.nextResult=t.next()}var v=(_.prototype[l.iterator]=function(){return this},_.prototype.next=function(t){var e=this.index++,r=this.array;return e<this.length?{value:r[e],done:!1}:{value:null,done:!0}},_.prototype.hasValue=function(){return this.array.length>this.index},_.prototype.hasCompleted=function(){return this.array.length===this.index},_);function _(t){this.array=t,this.index=0,this.length=0,this.length=t.length}var b,x=(b=u.OuterSubscriber,i(w,b),w.prototype[l.iterator]=function(){return this},w.prototype.next=function(){var t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}},w.prototype.hasValue=function(){return 0<this.buffer.length},w.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},w.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},w.prototype.notifyNext=function(t,e,r,n,i){this.buffer.push(e),this.parent.checkIterators()},w.prototype.subscribe=function(t,e){return c.subscribeToResult(this,this.observable,this,e)},w);function w(t,e,r){var n=b.call(this,t)||this;return n.parent=e,n.observable=r,n.stillUnsubscribed=!0,n.buffer=[],n.isComplete=!1,n}},{"../../internal/symbol/iterator":206,"../OuterSubscriber":50,"../Subscriber":55,"../util/isArray":219,"../util/subscribeToResult":238,"./fromArray":68}],89:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../util/tryCatch"),a=t("../util/errorObject"),s=t("../OuterSubscriber"),u=t("../util/subscribeToResult");r.audit=function(e){return function(t){return t.lift(new c(e))}};var c=(l.prototype.call=function(t,e){return e.subscribe(new p(t,this.durationSelector))},l);function l(t){this.durationSelector=t}var h,p=(h=s.OuterSubscriber,i(f,h),f.prototype._next=function(t){if(this.value=t,this.hasValue=!0,!this.throttled){var e=o.tryCatch(this.durationSelector)(t);if(e===a.errorObject)this.destination.error(a.errorObject.e);else{var r=u.subscribeToResult(this,e);!r||r.closed?this.clearThrottle():this.add(this.throttled=r)}}},f.prototype.clearThrottle=function(){var t=this.value,e=this.hasValue,r=this.throttled;r&&(this.remove(r),this.throttled=null,r.unsubscribe()),e&&(this.value=null,this.hasValue=!1,this.destination.next(t))},f.prototype.notifyNext=function(t,e,r,n){this.clearThrottle()},f.prototype.notifyComplete=function(){this.clearThrottle()},f);function f(t,e){var r=h.call(this,t)||this;return r.durationSelector=e,r.hasValue=!1,r}},{"../OuterSubscriber":50,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],90:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../scheduler/async"),i=t("./audit"),o=t("../observable/timer");r.auditTime=function(t,e){return void 0===e&&(e=n.async),i.audit(function(){return o.timer(t,e)})}},{"../observable/timer":86,"../scheduler/async":204,"./audit":89}],91:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../OuterSubscriber"),a=t("../util/subscribeToResult");r.buffer=function(e){return function(t){return t.lift(new s(e))}};var s=(u.prototype.call=function(t,e){return e.subscribe(new l(t,this.closingNotifier))},u);function u(t){this.closingNotifier=t}var c,l=(c=o.OuterSubscriber,i(h,c),h.prototype._next=function(t){this.buffer.push(t)},h.prototype.notifyNext=function(t,e,r,n,i){var o=this.buffer;this.buffer=[],this.destination.next(o)},h);function h(t,e){var r=c.call(this,t)||this;return r.buffer=[],r.add(a.subscribeToResult(r,e)),r}},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],92:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.bufferCount=function(e,r){return void 0===r&&(r=null),function(t){return t.lift(new a(e,r))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new this.subscriberClass(t,this.bufferSize,this.startBufferEvery))},s);function s(t,e){this.bufferSize=t,this.startBufferEvery=e,this.subscriberClass=e&&t!==e?p:c}var u,c=(u=o.Subscriber,i(l,u),l.prototype._next=function(t){var e=this.buffer;e.push(t),e.length==this.bufferSize&&(this.destination.next(e),this.buffer=[])},l.prototype._complete=function(){var t=this.buffer;0<t.length&&this.destination.next(t),u.prototype._complete.call(this)},l);function l(t,e){var r=u.call(this,t)||this;return r.bufferSize=e,r.buffer=[],r}var h,p=(h=o.Subscriber,i(f,h),f.prototype._next=function(t){var e=this.bufferSize,r=this.startBufferEvery,n=this.buffers,i=this.count;this.count++,i%r==0&&n.push([]);for(var o=n.length;o--;){var a=n[o];a.push(t),a.length===e&&(n.splice(o,1),this.destination.next(a))}},f.prototype._complete=function(){for(var t=this.buffers,e=this.destination;0<t.length;){var r=t.shift();0<r.length&&e.next(r)}h.prototype._complete.call(this)},f);function f(t,e,r){var n=h.call(this,t)||this;return n.bufferSize=e,n.startBufferEvery=r,n.buffers=[],n.count=0,n}},{"../Subscriber":55}],93:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../scheduler/async"),a=t("../Subscriber"),s=t("../util/isScheduler");r.bufferTime=function(e){var t=arguments.length,r=o.async;s.isScheduler(arguments[arguments.length-1])&&(r=arguments[arguments.length-1],t--);var n=null;2<=t&&(n=arguments[1]);var i=Number.POSITIVE_INFINITY;return 3<=t&&(i=arguments[2]),function(t){return t.lift(new u(e,n,i,r))}};var u=(c.prototype.call=function(t,e){return e.subscribe(new p(t,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},c);function c(t,e,r,n){this.bufferTimeSpan=t,this.bufferCreationInterval=e,this.maxBufferSize=r,this.scheduler=n}var l,h=function(){this.buffer=[]},p=(l=a.Subscriber,i(f,l),f.prototype._next=function(t){for(var e,r=this.contexts,n=r.length,i=0;i<n;i++){var o=r[i],a=o.buffer;a.push(t),a.length==this.maxBufferSize&&(e=o)}e&&this.onBufferFull(e)},f.prototype._error=function(t){this.contexts.length=0,l.prototype._error.call(this,t)},f.prototype._complete=function(){for(var t=this.contexts,e=this.destination;0<t.length;){var r=t.shift();e.next(r.buffer)}l.prototype._complete.call(this)},f.prototype._unsubscribe=function(){this.contexts=null},f.prototype.onBufferFull=function(t){this.closeContext(t);var e=t.closeAction;if(e.unsubscribe(),this.remove(e),!this.closed&&this.timespanOnly){t=this.openContext();var r=this.bufferTimeSpan,n={subscriber:this,context:t,bufferTimeSpan:r};this.add(t.closeAction=this.scheduler.schedule(d,r,n))}},f.prototype.openContext=function(){var t=new h;return this.contexts.push(t),t},f.prototype.closeContext=function(t){this.destination.next(t.buffer);var e=this.contexts;0<=(e?e.indexOf(t):-1)&&e.splice(e.indexOf(t),1)},f);function f(t,e,r,n,i){var o=l.call(this,t)||this;o.bufferTimeSpan=e,o.bufferCreationInterval=r,o.maxBufferSize=n,o.scheduler=i,o.contexts=[];var a=o.openContext();if(o.timespanOnly=null==r||r<0,o.timespanOnly){var s={subscriber:o,context:a,bufferTimeSpan:e};o.add(a.closeAction=i.schedule(d,e,s))}else{var u={subscriber:o,context:a},c={bufferTimeSpan:e,bufferCreationInterval:r,subscriber:o,scheduler:i};o.add(a.closeAction=i.schedule(g,e,u)),o.add(i.schedule(m,r,c))}return o}function d(t){var e=t.subscriber,r=t.context;r&&e.closeContext(r),e.closed||(t.context=e.openContext(),t.context.closeAction=this.schedule(t,t.bufferTimeSpan))}function m(t){var e=t.bufferCreationInterval,r=t.bufferTimeSpan,n=t.subscriber,i=t.scheduler,o=n.openContext();n.closed||(n.add(o.closeAction=i.schedule(g,r,{subscriber:n,context:o})),this.schedule(t,e))}function g(t){var e=t.subscriber,r=t.context;e.closeContext(r)}},{"../Subscriber":55,"../scheduler/async":204,"../util/isScheduler":229}],94:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscription"),a=t("../util/subscribeToResult"),s=t("../OuterSubscriber");r.bufferToggle=function(e,r){return function(t){return t.lift(new u(e,r))}};var u=(c.prototype.call=function(t,e){return e.subscribe(new h(t,this.openings,this.closingSelector))},c);function c(t,e){this.openings=t,this.closingSelector=e}var l,h=(l=s.OuterSubscriber,i(p,l),p.prototype._next=function(t){for(var e=this.contexts,r=e.length,n=0;n<r;n++)e[n].buffer.push(t)},p.prototype._error=function(t){for(var e=this.contexts;0<e.length;){var r=e.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,l.prototype._error.call(this,t)},p.prototype._complete=function(){for(var t=this.contexts;0<t.length;){var e=t.shift();this.destination.next(e.buffer),e.subscription.unsubscribe(),e.buffer=null,e.subscription=null}this.contexts=null,l.prototype._complete.call(this)},p.prototype.notifyNext=function(t,e,r,n,i){t?this.closeBuffer(t):this.openBuffer(e)},p.prototype.notifyComplete=function(t){this.closeBuffer(t.context)},p.prototype.openBuffer=function(t){try{var e=this.closingSelector.call(this,t);e&&this.trySubscribe(e)}catch(t){this._error(t)}},p.prototype.closeBuffer=function(t){var e=this.contexts;if(e&&t){var r=t.buffer,n=t.subscription;this.destination.next(r),e.splice(e.indexOf(t),1),this.remove(n),n.unsubscribe()}},p.prototype.trySubscribe=function(t){var e=this.contexts,r=new o.Subscription,n={buffer:[],subscription:r};e.push(n);var i=a.subscribeToResult(this,t,n);!i||i.closed?this.closeBuffer(n):(i.context=n,this.add(i),r.add(i))},p);function p(t,e,r){var n=l.call(this,t)||this;return n.openings=e,n.closingSelector=r,n.contexts=[],n.add(a.subscribeToResult(n,e)),n}},{"../OuterSubscriber":50,"../Subscription":56,"../util/subscribeToResult":238}],95:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscription"),a=t("../util/tryCatch"),s=t("../util/errorObject"),u=t("../OuterSubscriber"),c=t("../util/subscribeToResult");r.bufferWhen=function(e){return function(t){return t.lift(new l(e))}};var l=(h.prototype.call=function(t,e){return e.subscribe(new f(t,this.closingSelector))},h);function h(t){this.closingSelector=t}var p,f=(p=u.OuterSubscriber,i(d,p),d.prototype._next=function(t){this.buffer.push(t)},d.prototype._complete=function(){var t=this.buffer;t&&this.destination.next(t),p.prototype._complete.call(this)},d.prototype._unsubscribe=function(){this.buffer=null,this.subscribing=!1},d.prototype.notifyNext=function(t,e,r,n,i){this.openBuffer()},d.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},d.prototype.openBuffer=function(){var t=this.closingSubscription;t&&(this.remove(t),t.unsubscribe());var e=this.buffer;this.buffer&&this.destination.next(e),this.buffer=[];var r=a.tryCatch(this.closingSelector)();r===s.errorObject?this.error(s.errorObject.e):(t=new o.Subscription,this.closingSubscription=t,this.add(t),this.subscribing=!0,t.add(c.subscribeToResult(this,r)),this.subscribing=!1)},d);function d(t,e){var r=p.call(this,t)||this;return r.closingSelector=e,r.subscribing=!1,r.openBuffer(),r}},{"../OuterSubscriber":50,"../Subscription":56,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],96:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../OuterSubscriber"),a=t("../InnerSubscriber"),s=t("../util/subscribeToResult");r.catchError=function(n){return function(t){var e=new u(n),r=t.lift(e);return e.caught=r}};var u=(c.prototype.call=function(t,e){return e.subscribe(new h(t,this.selector,this.caught))},c);function c(t){this.selector=t}var l,h=(l=o.OuterSubscriber,i(p,l),p.prototype.error=function(t){if(!this.isStopped){var e=void 0;try{e=this.selector(t,this.caught)}catch(t){return void l.prototype.error.call(this,t)}this._unsubscribeAndRecycle();var r=new a.InnerSubscriber(this,void 0,void 0);this.add(r),s.subscribeToResult(this,e,void 0,void 0,r)}},p);function p(t,e,r){var n=l.call(this,t)||this;return n.selector=e,n.caught=r,n}},{"../InnerSubscriber":46,"../OuterSubscriber":50,"../util/subscribeToResult":238}],97:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../observable/combineLatest");r.combineAll=function(e){return function(t){return t.lift(new n.CombineLatestOperator(e))}}},{"../observable/combineLatest":62}],98:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../util/isArray"),i=t("../observable/combineLatest"),o=t("../observable/from");r.combineLatest=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=null;return"function"==typeof e[e.length-1]&&(r=e.pop()),1===e.length&&n.isArray(e[0])&&(e=e[0].slice()),function(t){return t.lift.call(o.from([t].concat(e)),new i.CombineLatestOperator(r))}}},{"../observable/combineLatest":62,"../observable/from":67,"../util/isArray":219}],99:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../observable/concat");r.concat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(n.concat.apply(void 0,[t].concat(e)))}}},{"../observable/concat":63}],100:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./mergeAll");r.concatAll=function(){return n.mergeAll(1)}},{"./mergeAll":133}],101:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./mergeMap");r.concatMap=function(t,e){return n.mergeMap(t,e,1)}},{"./mergeMap":134}],102:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./concatMap");r.concatMapTo=function(t,e){return n.concatMap(function(){return t},e)}},{"./concatMap":101}],103:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.count=function(e){return function(t){return t.lift(new a(e,t))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t,this.predicate,this.source))},s);function s(t,e){this.predicate=t,this.source=e}var u,c=(u=o.Subscriber,i(l,u),l.prototype._next=function(t){this.predicate?this._tryPredicate(t):this.count++},l.prototype._tryPredicate=function(t){var e;try{e=this.predicate(t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e&&this.count++},l.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},l);function l(t,e,r){var n=u.call(this,t)||this;return n.predicate=e,n.source=r,n.count=0,n.index=0,n}},{"../Subscriber":55}],104:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../OuterSubscriber"),a=t("../util/subscribeToResult");r.debounce=function(e){return function(t){return t.lift(new s(e))}};var s=(u.prototype.call=function(t,e){return e.subscribe(new l(t,this.durationSelector))},u);function u(t){this.durationSelector=t}var c,l=(c=o.OuterSubscriber,i(h,c),h.prototype._next=function(t){try{var e=this.durationSelector.call(this,t);e&&this._tryNext(t,e)}catch(t){this.destination.error(t)}},h.prototype._complete=function(){this.emitValue(),this.destination.complete()},h.prototype._tryNext=function(t,e){var r=this.durationSubscription;this.value=t,this.hasValue=!0,r&&(r.unsubscribe(),this.remove(r)),(r=a.subscribeToResult(this,e))&&!r.closed&&this.add(this.durationSubscription=r)},h.prototype.notifyNext=function(t,e,r,n,i){this.emitValue()},h.prototype.notifyComplete=function(){this.emitValue()},h.prototype.emitValue=function(){if(this.hasValue){var t=this.value,e=this.durationSubscription;e&&(this.durationSubscription=null,e.unsubscribe(),this.remove(e)),this.value=null,this.hasValue=!1,c.prototype._next.call(this,t)}},h);function h(t,e){var r=c.call(this,t)||this;return r.durationSelector=e,r.hasValue=!1,r.durationSubscription=null,r}},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],105:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../scheduler/async");r.debounceTime=function(e,r){return void 0===r&&(r=a.async),function(t){return t.lift(new s(e,r))}};var s=(u.prototype.call=function(t,e){return e.subscribe(new l(t,this.dueTime,this.scheduler))},u);function u(t,e){this.dueTime=t,this.scheduler=e}var c,l=(c=o.Subscriber,i(h,c),h.prototype._next=function(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(p,this.dueTime,this))},h.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},h.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var t=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}},h.prototype.clearDebounce=function(){var t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)},h);function h(t,e,r){var n=c.call(this,t)||this;return n.dueTime=e,n.scheduler=r,n.debouncedSubscription=null,n.lastValue=null,n.hasValue=!1,n}function p(t){t.debouncedNext()}},{"../Subscriber":55,"../scheduler/async":204}],106:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.defaultIfEmpty=function(e){return void 0===e&&(e=null),function(t){return t.lift(new a(e))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t,this.defaultValue))},s);function s(t){this.defaultValue=t}var u,c=(u=o.Subscriber,i(l,u),l.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},l.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},l);function l(t,e){var r=u.call(this,t)||this;return r.defaultValue=e,r.isEmpty=!0,r}},{"../Subscriber":55}],107:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../scheduler/async"),a=t("../util/isDate"),s=t("../Subscriber"),u=t("../Notification");r.delay=function(t,e){void 0===e&&(e=o.async);var r=a.isDate(t)?+t-e.now():Math.abs(t);return function(t){return t.lift(new c(r,e))}};var c=(l.prototype.call=function(t,e){return e.subscribe(new p(t,this.delay,this.scheduler))},l);function l(t,e){this.delay=t,this.scheduler=e}var h,p=(h=s.Subscriber,i(f,h),f.dispatch=function(t){for(var e=t.source,r=e.queue,n=t.scheduler,i=t.destination;0<r.length&&r[0].time-n.now()<=0;)r.shift().notification.observe(i);if(0<r.length){var o=Math.max(0,r[0].time-n.now());this.schedule(t,o)}else this.unsubscribe(),e.active=!1},f.prototype._schedule=function(t){this.active=!0,this.destination.add(t.schedule(f.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))},f.prototype.scheduleNotification=function(t){if(!0!==this.errored){var e=this.scheduler,r=new d(e.now()+this.delay,t);this.queue.push(r),!1===this.active&&this._schedule(e)}},f.prototype._next=function(t){this.scheduleNotification(u.Notification.createNext(t))},f.prototype._error=function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()},f.prototype._complete=function(){this.scheduleNotification(u.Notification.createComplete()),this.unsubscribe()},f);function f(t,e,r){var n=h.call(this,t)||this;return n.delay=e,n.scheduler=r,n.queue=[],n.active=!1,n.errored=!1,n}var d=function(t,e){this.time=t,this.notification=e}},{"../Notification":47,"../Subscriber":55,"../scheduler/async":204,"../util/isDate":221}],108:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../Observable"),s=t("../OuterSubscriber"),u=t("../util/subscribeToResult");r.delayWhen=function(e,r){return r?function(t){return new m(t,r).lift(new c(e))}:function(t){return t.lift(new c(e))}};var c=(l.prototype.call=function(t,e){return e.subscribe(new p(t,this.delayDurationSelector))},l);function l(t){this.delayDurationSelector=t}var h,p=(h=s.OuterSubscriber,i(f,h),f.prototype.notifyNext=function(t,e,r,n,i){this.destination.next(t),this.removeSubscription(i),this.tryComplete()},f.prototype.notifyError=function(t,e){this._error(t)},f.prototype.notifyComplete=function(t){var e=this.removeSubscription(t);e&&this.destination.next(e),this.tryComplete()},f.prototype._next=function(t){var e=this.index++;try{var r=this.delayDurationSelector(t,e);r&&this.tryDelay(r,t)}catch(t){this.destination.error(t)}},f.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},f.prototype.removeSubscription=function(t){t.unsubscribe();var e=this.delayNotifierSubscriptions.indexOf(t);return-1!==e&&this.delayNotifierSubscriptions.splice(e,1),t.outerValue},f.prototype.tryDelay=function(t,e){var r=u.subscribeToResult(this,t,e);r&&!r.closed&&(this.destination.add(r),this.delayNotifierSubscriptions.push(r))},f.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},f);function f(t,e){var r=h.call(this,t)||this;return r.delayDurationSelector=e,r.completed=!1,r.delayNotifierSubscriptions=[],r.index=0,r}var d,m=(d=a.Observable,i(g,d),g.prototype._subscribe=function(t){this.subscriptionDelay.subscribe(new v(t,this.source))},g);function g(t,e){var r=d.call(this)||this;return r.source=t,r.subscriptionDelay=e,r}var y,v=(y=o.Subscriber,i(_,y),_.prototype._next=function(t){this.subscribeToSource()},_.prototype._error=function(t){this.unsubscribe(),this.parent.error(t)},_.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},_.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},_);function _(t,e){var r=y.call(this)||this;return r.parent=t,r.source=e,r.sourceSubscribed=!1,r}},{"../Observable":48,"../OuterSubscriber":50,"../Subscriber":55,"../util/subscribeToResult":238}],109:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.dematerialize=function(){return function(t){return t.lift(new a)}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t))},s);function s(){}var u,c=(u=o.Subscriber,i(l,u),l.prototype._next=function(t){t.observe(this.destination)},l);function l(t){return u.call(this,t)||this}},{"../Subscriber":55}],110:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../OuterSubscriber"),a=t("../util/subscribeToResult");r.distinct=function(e,r){return function(t){return t.lift(new s(e,r))}};var s=(u.prototype.call=function(t,e){return e.subscribe(new l(t,this.keySelector,this.flushes))},u);function u(t,e){this.keySelector=t,this.flushes=e}var c,l=(c=o.OuterSubscriber,i(h,c),h.prototype.notifyNext=function(t,e,r,n,i){this.values.clear()},h.prototype.notifyError=function(t,e){this._error(t)},h.prototype._next=function(t){this.keySelector?this._useKeySelector(t):this._finalizeNext(t,t)},h.prototype._useKeySelector=function(t){var e,r=this.destination;try{e=this.keySelector(t)}catch(t){return void r.error(t)}this._finalizeNext(e,t)},h.prototype._finalizeNext=function(t,e){var r=this.values;r.has(t)||(r.add(t),this.destination.next(e))},h);function h(t,e,r){var n=c.call(this,t)||this;return n.keySelector=e,n.values=new Set,r&&n.add(a.subscribeToResult(n,r)),n}r.DistinctSubscriber=l},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],111:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../util/tryCatch"),s=t("../util/errorObject");r.distinctUntilChanged=function(e,r){return function(t){return t.lift(new u(e,r))}};var u=(c.prototype.call=function(t,e){return e.subscribe(new h(t,this.compare,this.keySelector))},c);function c(t,e){this.compare=t,this.keySelector=e}var l,h=(l=o.Subscriber,i(p,l),p.prototype.compare=function(t,e){return t===e},p.prototype._next=function(t){var e=t;if(this.keySelector&&(e=a.tryCatch(this.keySelector)(t))===s.errorObject)return this.destination.error(s.errorObject.e);var r=!1;if(this.hasKey){if((r=a.tryCatch(this.compare)(this.key,e))===s.errorObject)return this.destination.error(s.errorObject.e)}else this.hasKey=!0;!1===Boolean(r)&&(this.key=e,this.destination.next(t))},p);function p(t,e,r){var n=l.call(this,t)||this;return n.keySelector=r,n.hasKey=!1,"function"==typeof e&&(n.compare=e),n}},{"../Subscriber":55,"../util/errorObject":216,"../util/tryCatch":240}],112:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("./distinctUntilChanged");r.distinctUntilKeyChanged=function(r,n){return i.distinctUntilChanged(function(t,e){return n?n(t[r],e[r]):t[r]===e[r]})}},{"./distinctUntilChanged":111}],113:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("../util/ArgumentOutOfRangeError"),o=t("./filter"),a=t("./throwIfEmpty"),s=t("./defaultIfEmpty"),u=t("./take");r.elementAt=function(r,e){if(r<0)throw new i.ArgumentOutOfRangeError;var n=2<=arguments.length;return function(t){return t.pipe(o.filter(function(t,e){return e===r}),u.take(1),n?s.defaultIfEmpty(e):a.throwIfEmpty(function(){return new i.ArgumentOutOfRangeError}))}}},{"../util/ArgumentOutOfRangeError":209,"./defaultIfEmpty":106,"./filter":119,"./take":171,"./throwIfEmpty":178}],114:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("../observable/fromArray"),o=t("../observable/scalar"),a=t("../observable/empty"),s=t("../observable/concat"),u=t("../util/isScheduler");r.endWith=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(t){var e=n[n.length-1];u.isScheduler(e)?n.pop():e=null;var r=n.length;return 1!==r||e?0<r?s.concat(t,i.fromArray(n,e)):s.concat(t,a.empty(e)):s.concat(t,o.scalar(n[0]))}}},{"../observable/concat":63,"../observable/empty":65,"../observable/fromArray":68,"../observable/scalar":84,"../util/isScheduler":229}],115:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.every=function(e,r){return function(t){return t.lift(new a(e,r,t))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t,this.predicate,this.thisArg,this.source))},s);function s(t,e,r){this.predicate=t,this.thisArg=e,this.source=r}var u,c=(u=o.Subscriber,i(l,u),l.prototype.notifyComplete=function(t){this.destination.next(t),this.destination.complete()},l.prototype._next=function(t){var e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e||this.notifyComplete(!1)},l.prototype._complete=function(){this.notifyComplete(!0)},l);function l(t,e,r,n){var i=u.call(this,t)||this;return i.predicate=e,i.thisArg=r,i.source=n,i.index=0,i.thisArg=r||i,i}},{"../Subscriber":55}],116:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../OuterSubscriber"),a=t("../util/subscribeToResult");r.exhaust=function(){return function(t){return t.lift(new s)}};var s=(u.prototype.call=function(t,e){return e.subscribe(new l(t))},u);function u(){}var c,l=(c=o.OuterSubscriber,i(h,c),h.prototype._next=function(t){this.hasSubscription||(this.hasSubscription=!0,this.add(a.subscribeToResult(this,t)))},h.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},h.prototype.notifyComplete=function(t){this.remove(t),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},h);function h(t){var e=c.call(this,t)||this;return e.hasCompleted=!1,e.hasSubscription=!1,e}},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],117:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../OuterSubscriber"),a=t("../InnerSubscriber"),s=t("../util/subscribeToResult"),u=t("./map"),c=t("../observable/from");r.exhaustMap=function e(i,o){return o?function(t){return t.pipe(e(function(r,n){return c.from(i(r,n)).pipe(u.map(function(t,e){return o(r,t,n,e)}))}))}:function(t){return t.lift(new l(i))}};var l=(h.prototype.call=function(t,e){return e.subscribe(new f(t,this.project))},h);function h(t){this.project=t}var p,f=(p=o.OuterSubscriber,i(d,p),d.prototype._next=function(t){this.hasSubscription||this.tryNext(t)},d.prototype.tryNext=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this.hasSubscription=!0,this._innerSub(e,t,r)},d.prototype._innerSub=function(t,e,r){var n=new a.InnerSubscriber(this,void 0,void 0);this.destination.add(n),s.subscribeToResult(this,t,e,r,n)},d.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},d.prototype.notifyNext=function(t,e,r,n,i){this.destination.next(e)},d.prototype.notifyError=function(t){this.destination.error(t)},d.prototype.notifyComplete=function(t){this.destination.remove(t),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},d);function d(t,e){var r=p.call(this,t)||this;return r.project=e,r.hasSubscription=!1,r.hasCompleted=!1,r.index=0,r}},{"../InnerSubscriber":46,"../OuterSubscriber":50,"../observable/from":67,"../util/subscribeToResult":238,"./map":128}],118:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../util/tryCatch"),a=t("../util/errorObject"),s=t("../OuterSubscriber"),u=t("../util/subscribeToResult");r.expand=function(e,r,n){return void 0===r&&(r=Number.POSITIVE_INFINITY),void 0===n&&(n=void 0),r=(r||0)<1?Number.POSITIVE_INFINITY:r,function(t){return t.lift(new c(e,r,n))}};var c=(l.prototype.call=function(t,e){return e.subscribe(new p(t,this.project,this.concurrent,this.scheduler))},l);function l(t,e,r){this.project=t,this.concurrent=e,this.scheduler=r}r.ExpandOperator=c;var h,p=(h=s.OuterSubscriber,i(f,h),f.dispatch=function(t){var e=t.subscriber,r=t.result,n=t.value,i=t.index;e.subscribeToProjection(r,n,i)},f.prototype._next=function(t){var e=this.destination;if(e.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){e.next(t);var n=o.tryCatch(this.project)(t,r);if(n===a.errorObject)e.error(a.errorObject.e);else if(this.scheduler){var i={subscriber:this,result:n,value:t,index:r};this.destination.add(this.scheduler.schedule(f.dispatch,0,i))}else this.subscribeToProjection(n,t,r)}else this.buffer.push(t)}},f.prototype.subscribeToProjection=function(t,e,r){this.active++,this.destination.add(u.subscribeToResult(this,t,e,r))},f.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},f.prototype.notifyNext=function(t,e,r,n,i){this._next(e)},f.prototype.notifyComplete=function(t){var e=this.buffer;this.destination.remove(t),this.active--,e&&0<e.length&&this._next(e.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},f);function f(t,e,r,n){var i=h.call(this,t)||this;return i.project=e,i.concurrent=r,i.scheduler=n,i.index=0,i.active=0,i.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(i.buffer=[]),i}r.ExpandSubscriber=p},{"../OuterSubscriber":50,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],119:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.filter=function(e,r){return function(t){return t.lift(new a(e,r))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t,this.predicate,this.thisArg))},s);function s(t,e){this.predicate=t,this.thisArg=e}var u,c=(u=o.Subscriber,i(l,u),l.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},l);function l(t,e,r){var n=u.call(this,t)||this;return n.predicate=e,n.thisArg=r,n.count=0,n}},{"../Subscriber":55}],120:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../Subscription");r.finalize=function(e){return function(t){return t.lift(new s(e))}};var s=(u.prototype.call=function(t,e){return e.subscribe(new l(t,this.callback))},u);function u(t){this.callback=t}var c,l=(c=o.Subscriber,i(h,c),h);function h(t,e){var r=c.call(this,t)||this;return r.add(new a.Subscription(e)),r}},{"../Subscriber":55,"../Subscription":56}],121:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.find=function(e,r){if("function"!=typeof e)throw new TypeError("predicate is not a function");return function(t){return t.lift(new a(e,t,!1,r))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t,this.predicate,this.source,this.yieldIndex,this.thisArg))},s);function s(t,e,r,n){this.predicate=t,this.source=e,this.yieldIndex=r,this.thisArg=n}r.FindValueOperator=a;var u,c=(u=o.Subscriber,i(l,u),l.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete(),this.unsubscribe()},l.prototype._next=function(t){var e=this.predicate,r=this.thisArg,n=this.index++;try{e.call(r||this,t,n,this.source)&&this.notifyComplete(this.yieldIndex?n:t)}catch(t){this.destination.error(t)}},l.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},l);function l(t,e,r,n,i){var o=u.call(this,t)||this;return o.predicate=e,o.source=r,o.yieldIndex=n,o.thisArg=i,o.index=0,o}r.FindValueSubscriber=c},{"../Subscriber":55}],122:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../operators/find");r.findIndex=function(e,r){return function(t){return t.lift(new n.FindValueOperator(e,t,!0,r))}}},{"../operators/find":121}],123:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("../util/EmptyError"),o=t("./filter"),a=t("./take"),s=t("./defaultIfEmpty"),u=t("./throwIfEmpty"),c=t("../util/identity");r.first=function(n,t){var e=2<=arguments.length;return function(r){return r.pipe(n?o.filter(function(t,e){return n(t,e,r)}):c.identity,a.take(1),e?s.defaultIfEmpty(t):u.throwIfEmpty(function(){return new i.EmptyError}))}}},{"../util/EmptyError":210,"../util/identity":218,"./defaultIfEmpty":106,"./filter":119,"./take":171,"./throwIfEmpty":178}],124:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../Subscription"),s=t("../Observable"),u=t("../Subject");r.groupBy=function(e,r,n,i){return function(t){return t.lift(new c(e,r,n,i))}};var c=(l.prototype.call=function(t,e){return e.subscribe(new p(t,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},l);function l(t,e,r,n){this.keySelector=t,this.elementSelector=e,this.durationSelector=r,this.subjectSelector=n}var h,p=(h=o.Subscriber,i(f,h),f.prototype._next=function(t){var e;try{e=this.keySelector(t)}catch(t){return void this.error(t)}this._group(t,e)},f.prototype._group=function(t,e){var r,n=this.groups,i=(n=n||(this.groups=new Map)).get(e);if(this.elementSelector)try{r=this.elementSelector(t)}catch(t){this.error(t)}else r=t;if(!i){i=this.subjectSelector?this.subjectSelector():new u.Subject,n.set(e,i);var o=new v(e,i,this);if(this.destination.next(o),this.durationSelector){var a=void 0;try{a=this.durationSelector(new v(e,i))}catch(t){return void this.error(t)}this.add(a.subscribe(new m(e,i,this)))}}i.closed||i.next(r)},f.prototype._error=function(r){var t=this.groups;t&&(t.forEach(function(t,e){t.error(r)}),t.clear()),this.destination.error(r)},f.prototype._complete=function(){var t=this.groups;t&&(t.forEach(function(t,e){t.complete()}),t.clear()),this.destination.complete()},f.prototype.removeGroup=function(t){this.groups.delete(t)},f.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&h.prototype.unsubscribe.call(this))},f);function f(t,e,r,n,i){var o=h.call(this,t)||this;return o.keySelector=e,o.elementSelector=r,o.durationSelector=n,o.subjectSelector=i,o.groups=null,o.attemptedToUnsubscribe=!1,o.count=0,o}var d,m=(d=o.Subscriber,i(g,d),g.prototype._next=function(t){this.complete()},g.prototype._unsubscribe=function(){var t=this.parent,e=this.key;this.key=this.parent=null,t&&t.removeGroup(e)},g);function g(t,e,r){var n=d.call(this,e)||this;return n.key=t,n.group=e,n.parent=r,n}var y,v=(y=s.Observable,i(_,y),_.prototype._subscribe=function(t){var e=new a.Subscription,r=this.refCountSubscription,n=this.groupSubject;return r&&!r.closed&&e.add(new x(r)),e.add(n.subscribe(t)),e},_);function _(t,e,r){var n=y.call(this)||this;return n.key=t,n.groupSubject=e,n.refCountSubscription=r,n}r.GroupedObservable=v;var b,x=(b=a.Subscription,i(w,b),w.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(b.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},w);function w(t){var e=b.call(this)||this;return(e.parent=t).count++,e}},{"../Observable":48,"../Subject":53,"../Subscriber":55,"../Subscription":56}],125:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.ignoreElements=function(){return function(t){return t.lift(new a)}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t))},s);function s(){}var u,c=(u=o.Subscriber,i(l,u),l.prototype._next=function(t){},l);function l(){return null!==u&&u.apply(this,arguments)||this}},{"../Subscriber":55}],126:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.isEmpty=function(){return function(t){return t.lift(new a)}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t))},s);function s(){}var u,c=(u=o.Subscriber,i(l,u),l.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete()},l.prototype._next=function(t){this.notifyComplete(!1)},l.prototype._complete=function(){this.notifyComplete(!0)},l);function l(t){return u.call(this,t)||this}},{"../Subscriber":55}],127:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("../util/EmptyError"),o=t("./filter"),a=t("./takeLast"),s=t("./throwIfEmpty"),u=t("./defaultIfEmpty"),c=t("../util/identity");r.last=function(n,t){var e=2<=arguments.length;return function(r){return r.pipe(n?o.filter(function(t,e){return n(t,e,r)}):c.identity,a.takeLast(1),e?u.defaultIfEmpty(t):s.throwIfEmpty(function(){return new i.EmptyError}))}}},{"../util/EmptyError":210,"../util/identity":218,"./defaultIfEmpty":106,"./filter":119,"./takeLast":172,"./throwIfEmpty":178}],128:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.map=function(e,r){return function(t){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return t.lift(new a(e,r))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t,this.project,this.thisArg))},s);function s(t,e){this.project=t,this.thisArg=e}r.MapOperator=a;var u,c=(u=o.Subscriber,i(l,u),l.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},l);function l(t,e,r){var n=u.call(this,t)||this;return n.project=e,n.count=0,n.thisArg=r||n,n}},{"../Subscriber":55}],129:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.mapTo=function(e){return function(t){return t.lift(new a(e))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t,this.value))},s);function s(t){this.value=t}var u,c=(u=o.Subscriber,i(l,u),l.prototype._next=function(t){this.destination.next(this.value)},l);function l(t,e){var r=u.call(this,t)||this;return r.value=e,r}},{"../Subscriber":55}],130:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../Notification");r.materialize=function(){return function(t){return t.lift(new s)}};var s=(u.prototype.call=function(t,e){return e.subscribe(new l(t))},u);function u(){}var c,l=(c=o.Subscriber,i(h,c),h.prototype._next=function(t){this.destination.next(a.Notification.createNext(t))},h.prototype._error=function(t){var e=this.destination;e.next(a.Notification.createError(t)),e.complete()},h.prototype._complete=function(){var t=this.destination;t.next(a.Notification.createComplete()),t.complete()},h);function h(t){return c.call(this,t)||this}},{"../Notification":47,"../Subscriber":55}],131:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./reduce");r.max=function(r){var t="function"==typeof r?function(t,e){return 0<r(t,e)?t:e}:function(t,e){return e<t?t:e};return n.reduce(t)}},{"./reduce":149}],132:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../observable/merge");r.merge=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(n.merge.apply(void 0,[t].concat(e)))}}},{"../observable/merge":77}],133:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./mergeMap"),i=t("../util/identity");r.mergeAll=function(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),n.mergeMap(i.identity,t)}},{"../util/identity":218,"./mergeMap":134}],134:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../util/subscribeToResult"),a=t("../OuterSubscriber"),s=t("../InnerSubscriber"),u=t("./map"),c=t("../observable/from");r.mergeMap=function e(i,o,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),"function"==typeof o?function(t){return t.pipe(e(function(r,n){return c.from(i(r,n)).pipe(u.map(function(t,e){return o(r,t,n,e)}))},r))}:("number"==typeof o&&(r=o),function(t){return t.lift(new l(i,r))})};var l=(h.prototype.call=function(t,e){return e.subscribe(new f(t,this.project,this.concurrent))},h);function h(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}r.MergeMapOperator=l;var p,f=(p=a.OuterSubscriber,i(d,p),d.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},d.prototype._tryNext=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e,t,r)},d.prototype._innerSub=function(t,e,r){var n=new s.InnerSubscriber(this,void 0,void 0);this.destination.add(n),o.subscribeToResult(this,t,e,r,n)},d.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},d.prototype.notifyNext=function(t,e,r,n,i){this.destination.next(e)},d.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,0<e.length?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},d);function d(t,e,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var n=p.call(this,t)||this;return n.project=e,n.concurrent=r,n.hasCompleted=!1,n.buffer=[],n.active=0,n.index=0,n}r.MergeMapSubscriber=f},{"../InnerSubscriber":46,"../OuterSubscriber":50,"../observable/from":67,"../util/subscribeToResult":238,"./map":128}],135:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./mergeMap");r.mergeMapTo=function(t,e,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),"function"==typeof e?n.mergeMap(function(){return t},e,r):("number"==typeof e&&(r=e),n.mergeMap(function(){return t},r))}},{"./mergeMap":134}],136:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../util/tryCatch"),a=t("../util/errorObject"),s=t("../util/subscribeToResult"),u=t("../OuterSubscriber"),c=t("../InnerSubscriber");r.mergeScan=function(e,r,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(t){return t.lift(new l(e,r,n))}};var l=(h.prototype.call=function(t,e){return e.subscribe(new f(t,this.accumulator,this.seed,this.concurrent))},h);function h(t,e,r){this.accumulator=t,this.seed=e,this.concurrent=r}r.MergeScanOperator=l;var p,f=(p=u.OuterSubscriber,i(d,p),d.prototype._next=function(t){if(this.active<this.concurrent){var e=this.index++,r=o.tryCatch(this.accumulator)(this.acc,t),n=this.destination;r===a.errorObject?n.error(a.errorObject.e):(this.active++,this._innerSub(r,t,e))}else this.buffer.push(t)},d.prototype._innerSub=function(t,e,r){var n=new c.InnerSubscriber(this,void 0,void 0);this.destination.add(n),s.subscribeToResult(this,t,e,r,n)},d.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},d.prototype.notifyNext=function(t,e,r,n,i){var o=this.destination;this.acc=e,this.hasValue=!0,o.next(e)},d.prototype.notifyComplete=function(t){var e=this.buffer;this.destination.remove(t),this.active--,0<e.length?this._next(e.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},d);function d(t,e,r,n){var i=p.call(this,t)||this;return i.accumulator=e,i.acc=r,i.concurrent=n,i.hasValue=!1,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}r.MergeScanSubscriber=f},{"../InnerSubscriber":46,"../OuterSubscriber":50,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],137:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./reduce");r.min=function(r){var t="function"==typeof r?function(t,e){return r(t,e)<0?t:e}:function(t,e){return t<e?t:e};return n.reduce(t)}},{"./reduce":149}],138:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("../observable/ConnectableObservable");r.multicast=function(n,i){return function(t){var e;if(e="function"==typeof n?n:function(){return n},"function"==typeof i)return t.lift(new a(e,i));var r=Object.create(t,o.connectableObservableDescriptor);return r.source=t,r.subjectFactory=e,r}};var a=(n.prototype.call=function(t,e){var r=this.selector,n=this.subjectFactory(),i=r(n).subscribe(t);return i.add(e.subscribe(n)),i},n);function n(t,e){this.subjectFactory=t,this.selector=e}r.MulticastOperator=a},{"../observable/ConnectableObservable":58}],139:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../Notification");r.observeOn=function(e,r){return void 0===r&&(r=0),function(t){return t.lift(new s(e,r))}};var s=(u.prototype.call=function(t,e){return e.subscribe(new l(t,this.scheduler,this.delay))},u);function u(t,e){void 0===e&&(e=0),this.scheduler=t,this.delay=e}r.ObserveOnOperator=s;var c,l=(c=o.Subscriber,i(h,c),h.dispatch=function(t){var e=t.notification,r=t.destination;e.observe(r),this.unsubscribe()},h.prototype.scheduleMessage=function(t){this.destination.add(this.scheduler.schedule(h.dispatch,this.delay,new p(t,this.destination)))},h.prototype._next=function(t){this.scheduleMessage(a.Notification.createNext(t))},h.prototype._error=function(t){this.scheduleMessage(a.Notification.createError(t)),this.unsubscribe()},h.prototype._complete=function(){this.scheduleMessage(a.Notification.createComplete()),this.unsubscribe()},h);function h(t,e,r){void 0===r&&(r=0);var n=c.call(this,t)||this;return n.scheduler=e,n.delay=r,n}r.ObserveOnSubscriber=l;var p=function(t,e){this.notification=t,this.destination=e};r.ObserveOnMessage=p},{"../Notification":47,"../Subscriber":55}],140:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../observable/from"),a=t("../util/isArray"),s=t("../OuterSubscriber"),u=t("../InnerSubscriber"),c=t("../util/subscribeToResult");r.onErrorResumeNext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===e.length&&a.isArray(e[0])&&(e=e[0]),function(t){return t.lift(new l(e))}},r.onErrorResumeNextStatic=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r;return 1===t.length&&a.isArray(t[0])&&(t=t[0]),r=t.shift(),o.from(r,null).lift(new l(t))};var l=(h.prototype.call=function(t,e){return e.subscribe(new f(t,this.nextSources))},h);function h(t){this.nextSources=t}var p,f=(p=s.OuterSubscriber,i(d,p),d.prototype.notifyError=function(t,e){this.subscribeToNextSource()},d.prototype.notifyComplete=function(t){this.subscribeToNextSource()},d.prototype._error=function(t){this.subscribeToNextSource(),this.unsubscribe()},d.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},d.prototype.subscribeToNextSource=function(){var t=this.nextSources.shift();if(t){var e=new u.InnerSubscriber(this,void 0,void 0);this.destination.add(e),c.subscribeToResult(this,t,void 0,void 0,e)}else this.destination.complete()},d);function d(t,e){var r=p.call(this,t)||this;return r.destination=t,r.nextSources=e,r}},{"../InnerSubscriber":46,"../OuterSubscriber":50,"../observable/from":67,"../util/isArray":219,"../util/subscribeToResult":238}],141:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.pairwise=function(){return function(t){return t.lift(new a)}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t))},s);function s(){}var u,c=(u=o.Subscriber,i(l,u),l.prototype._next=function(t){this.hasPrev?this.destination.next([this.prev,t]):this.hasPrev=!0,this.prev=t},l);function l(t){var e=u.call(this,t)||this;return e.hasPrev=!1,e}},{"../Subscriber":55}],142:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../util/not"),i=t("./filter");r.partition=function(e,r){return function(t){return[i.filter(e,r)(t),i.filter(n.not(e,r))(t)]}}},{"../util/not":231,"./filter":119}],143:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./map");r.pluck=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.length;if(0===r)throw new Error("list of properties cannot be empty.");return function(t){return n.map(function(i,o){return function(t){for(var e=t,r=0;r<o;r++){var n=e[i[r]];if(void 0===n)return;e=n}return e}}(e,r))(t)}}},{"./map":128}],144:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Subject"),i=t("./multicast");r.publish=function(t){return t?i.multicast(function(){return new n.Subject},t):i.multicast(new n.Subject)}},{"../Subject":53,"./multicast":138}],145:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../BehaviorSubject"),i=t("./multicast");r.publishBehavior=function(e){return function(t){return i.multicast(new n.BehaviorSubject(e))(t)}}},{"../BehaviorSubject":45,"./multicast":138}],146:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../AsyncSubject"),i=t("./multicast");r.publishLast=function(){return function(t){return i.multicast(new n.AsyncSubject)(t)}}},{"../AsyncSubject":44,"./multicast":138}],147:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=t("../ReplaySubject"),s=t("./multicast");r.publishReplay=function(t,e,r,n){r&&"function"!=typeof r&&(n=r);var i="function"==typeof r?r:void 0,o=new a.ReplaySubject(t,e,n);return function(t){return s.multicast(function(){return o},i)(t)}}},{"../ReplaySubject":51,"./multicast":138}],148:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../util/isArray"),i=t("../observable/race");r.race=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return 1===e.length&&n.isArray(e[0])&&(e=e[0]),t.lift.call(i.race.apply(void 0,[t].concat(e)))}}},{"../observable/race":82,"../util/isArray":219}],149:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("./scan"),o=t("./takeLast"),a=t("./defaultIfEmpty"),s=t("../util/pipe");r.reduce=function(n,e){return 2<=arguments.length?function(t){return s.pipe(i.scan(n,e),o.takeLast(1),a.defaultIfEmpty(e))(t)}:function(t){return s.pipe(i.scan(function(t,e,r){return n(t,e,r+1)}),o.takeLast(1))(t)}}},{"../util/pipe":232,"./defaultIfEmpty":106,"./scan":157,"./takeLast":172}],150:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.refCount=function(){return function(t){return t.lift(new a(t))}};var a=(s.prototype.call=function(t,e){var r=this.connectable;r._refCount++;var n=new c(t,r),i=e.subscribe(n);return n.closed||(n.connection=r.connect()),i},s);function s(t){this.connectable=t}var u,c=(u=o.Subscriber,i(l,u),l.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,1<e)this.connection=null;else{var r=this.connection,n=t._connection;this.connection=null,!n||r&&n!==r||n.unsubscribe()}}else this.connection=null},l);function l(t,e){var r=u.call(this,t)||this;return r.connectable=e,r}},{"../Subscriber":55}],151:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../observable/empty");r.repeat=function(e){return void 0===e&&(e=-1),function(t){return 0===e?a.empty():e<0?t.lift(new s(-1,t)):t.lift(new s(e-1,t))}};var s=(u.prototype.call=function(t,e){return e.subscribe(new l(t,this.count,this.source))},u);function u(t,e){this.count=t,this.source=e}var c,l=(c=o.Subscriber,i(h,c),h.prototype.complete=function(){if(!this.isStopped){var t=this.source,e=this.count;if(0===e)return c.prototype.complete.call(this);-1<e&&(this.count=e-1),t.subscribe(this._unsubscribeAndRecycle())}},h);function h(t,e,r){var n=c.call(this,t)||this;return n.count=e,n.source=r,n}},{"../Subscriber":55,"../observable/empty":65}],152:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subject"),a=t("../util/tryCatch"),s=t("../util/errorObject"),u=t("../OuterSubscriber"),c=t("../util/subscribeToResult");r.repeatWhen=function(e){return function(t){return t.lift(new l(e))}};var l=(h.prototype.call=function(t,e){return e.subscribe(new f(t,this.notifier,e))},h);function h(t){this.notifier=t}var p,f=(p=u.OuterSubscriber,i(d,p),d.prototype.notifyNext=function(t,e,r,n,i){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},d.prototype.notifyComplete=function(t){if(!1===this.sourceIsBeingSubscribedTo)return p.prototype.complete.call(this)},d.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return p.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next()}},d.prototype._unsubscribe=function(){var t=this.notifications,e=this.retriesSubscription;t&&(t.unsubscribe(),this.notifications=null),e&&(e.unsubscribe(),this.retriesSubscription=null),this.retries=null},d.prototype._unsubscribeAndRecycle=function(){var t=this._unsubscribe;return this._unsubscribe=null,p.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=t,this},d.prototype.subscribeToRetries=function(){this.notifications=new o.Subject;var t=a.tryCatch(this.notifier)(this.notifications);if(t===s.errorObject)return p.prototype.complete.call(this);this.retries=t,this.retriesSubscription=c.subscribeToResult(this,t)},d);function d(t,e,r){var n=p.call(this,t)||this;return n.notifier=e,n.source=r,n.sourceIsBeingSubscribedTo=!0,n}},{"../OuterSubscriber":50,"../Subject":53,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],153:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.retry=function(e){return void 0===e&&(e=-1),function(t){return t.lift(new a(e,t))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t,this.count,this.source))},s);function s(t,e){this.count=t,this.source=e}var u,c=(u=o.Subscriber,i(l,u),l.prototype.error=function(t){if(!this.isStopped){var e=this.source,r=this.count;if(0===r)return u.prototype.error.call(this,t);-1<r&&(this.count=r-1),e.subscribe(this._unsubscribeAndRecycle())}},l);function l(t,e,r){var n=u.call(this,t)||this;return n.count=e,n.source=r,n}},{"../Subscriber":55}],154:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subject"),a=t("../util/tryCatch"),s=t("../util/errorObject"),u=t("../OuterSubscriber"),c=t("../util/subscribeToResult");r.retryWhen=function(e){return function(t){return t.lift(new l(e,t))}};var l=(h.prototype.call=function(t,e){return e.subscribe(new f(t,this.notifier,this.source))},h);function h(t,e){this.notifier=t,this.source=e}var p,f=(p=u.OuterSubscriber,i(d,p),d.prototype.error=function(t){if(!this.isStopped){var e=this.errors,r=this.retries,n=this.retriesSubscription;if(r)this.errors=null,this.retriesSubscription=null;else{if(e=new o.Subject,(r=a.tryCatch(this.notifier)(e))===s.errorObject)return p.prototype.error.call(this,s.errorObject.e);n=c.subscribeToResult(this,r)}this._unsubscribeAndRecycle(),this.errors=e,this.retries=r,this.retriesSubscription=n,e.next(t)}},d.prototype._unsubscribe=function(){var t=this.errors,e=this.retriesSubscription;t&&(t.unsubscribe(),this.errors=null),e&&(e.unsubscribe(),this.retriesSubscription=null),this.retries=null},d.prototype.notifyNext=function(t,e,r,n,i){var o=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=o,this.source.subscribe(this)},d);function d(t,e,r){var n=p.call(this,t)||this;return n.notifier=e,n.source=r,n}},{"../OuterSubscriber":50,"../Subject":53,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],155:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../OuterSubscriber"),a=t("../util/subscribeToResult");r.sample=function(e){return function(t){return t.lift(new s(e))}};var s=(u.prototype.call=function(t,e){var r=new l(t),n=e.subscribe(r);return n.add(a.subscribeToResult(r,this.notifier)),n},u);function u(t){this.notifier=t}var c,l=(c=o.OuterSubscriber,i(h,c),h.prototype._next=function(t){this.value=t,this.hasValue=!0},h.prototype.notifyNext=function(t,e,r,n,i){this.emitValue()},h.prototype.notifyComplete=function(){this.emitValue()},h.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},h);function h(){var t=null!==c&&c.apply(this,arguments)||this;return t.hasValue=!1,t}},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],156:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../scheduler/async");r.sampleTime=function(e,r){return void 0===r&&(r=a.async),function(t){return t.lift(new s(e,r))}};var s=(u.prototype.call=function(t,e){return e.subscribe(new l(t,this.period,this.scheduler))},u);function u(t,e){this.period=t,this.scheduler=e}var c,l=(c=o.Subscriber,i(h,c),h.prototype._next=function(t){this.lastValue=t,this.hasValue=!0},h.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},h);function h(t,e,r){var n=c.call(this,t)||this;return n.period=e,n.scheduler=r,n.hasValue=!1,n.add(r.schedule(p,e,{subscriber:n,period:e})),n}function p(t){var e=t.subscriber,r=t.period;e.notifyNext(),this.schedule(t,r)}},{"../Subscriber":55,"../scheduler/async":204}],157:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.scan=function(e,r){var n=!1;return 2<=arguments.length&&(n=!0),function(t){return t.lift(new a(e,r,n))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t,this.accumulator,this.seed,this.hasSeed))},s);function s(t,e,r){void 0===r&&(r=!1),this.accumulator=t,this.seed=e,this.hasSeed=r}var u,c=(u=o.Subscriber,i(l,u),Object.defineProperty(l.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),l.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},l.prototype._tryNext=function(t){var e,r=this.index++;try{e=this.accumulator(this.seed,t,r)}catch(t){this.destination.error(t)}this.seed=e,this.destination.next(e)},l);function l(t,e,r,n){var i=u.call(this,t)||this;return i.accumulator=e,i._seed=r,i.hasSeed=n,i.index=0,i}},{"../Subscriber":55}],158:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../util/tryCatch"),s=t("../util/errorObject");r.sequenceEqual=function(e,r){return function(t){return t.lift(new u(e,r))}};var u=(c.prototype.call=function(t,e){return e.subscribe(new h(t,this.compareTo,this.comparor))},c);function c(t,e){this.compareTo=t,this.comparor=e}r.SequenceEqualOperator=u;var l,h=(l=o.Subscriber,i(p,l),p.prototype._next=function(t){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(t),this.checkValues())},p.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},p.prototype.checkValues=function(){for(var t=this._a,e=this._b,r=this.comparor;0<t.length&&0<e.length;){var n=t.shift(),i=e.shift(),o=!1;r?(o=a.tryCatch(r)(n,i))===s.errorObject&&this.destination.error(s.errorObject.e):o=n===i,o||this.emit(!1)}},p.prototype.emit=function(t){var e=this.destination;e.next(t),e.complete()},p.prototype.nextB=function(t){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(t),this.checkValues())},p.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},p);function p(t,e,r){var n=l.call(this,t)||this;return n.compareTo=e,n.comparor=r,n._a=[],n._b=[],n._oneComplete=!1,n.destination.add(e.subscribe(new d(t,n))),n}r.SequenceEqualSubscriber=h;var f,d=(f=o.Subscriber,i(m,f),m.prototype._next=function(t){this.parent.nextB(t)},m.prototype._error=function(t){this.parent.error(t),this.unsubscribe()},m.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},m);function m(t,e){var r=f.call(this,t)||this;return r.parent=e,r}},{"../Subscriber":55,"../util/errorObject":216,"../util/tryCatch":240}],159:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./multicast"),i=t("./refCount"),o=t("../Subject");function a(){return new o.Subject}r.share=function(){return function(t){return i.refCount()(n.multicast(a)(t))}}},{"../Subject":53,"./multicast":138,"./refCount":150}],160:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var l=t("../ReplaySubject");r.shareReplay=function(e,r,n){return void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===r&&(r=Number.POSITIVE_INFINITY),function(t){return t.lift(function(r,n,i){var o,a,s=0,u=!1,c=!1;return function(t){s++,o&&!u||(u=!1,o=new l.ReplaySubject(r,n,i),a=t.subscribe({next:function(t){o.next(t)},error:function(t){u=!0,o.error(t)},complete:function(){c=!0,o.complete()}}));var e=o.subscribe(this);return function(){s--,e.unsubscribe(),a&&0===s&&c&&a.unsubscribe()}}}(e,r,n))}}},{"../ReplaySubject":51}],161:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../util/EmptyError");r.single=function(e){return function(t){return t.lift(new s(e,t))}};var s=(u.prototype.call=function(t,e){return e.subscribe(new l(t,this.predicate,this.source))},u);function u(t,e){this.predicate=t,this.source=e}var c,l=(c=o.Subscriber,i(h,c),h.prototype.applySingleValue=function(t){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=t)},h.prototype._next=function(t){var e=this.index++;this.predicate?this.tryNext(t,e):this.applySingleValue(t)},h.prototype.tryNext=function(t,e){try{this.predicate(t,e,this.source)&&this.applySingleValue(t)}catch(t){this.destination.error(t)}},h.prototype._complete=function(){var t=this.destination;0<this.index?(t.next(this.seenValue?this.singleValue:void 0),t.complete()):t.error(new a.EmptyError)},h);function h(t,e,r){var n=c.call(this,t)||this;return n.predicate=e,n.source=r,n.seenValue=!1,n.index=0,n}},{"../Subscriber":55,"../util/EmptyError":210}],162:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.skip=function(e){return function(t){return t.lift(new a(e))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t,this.total))},s);function s(t){this.total=t}var u,c=(u=o.Subscriber,i(l,u),l.prototype._next=function(t){++this.count>this.total&&this.destination.next(t)},l);function l(t,e){var r=u.call(this,t)||this;return r.total=e,r.count=0,r}},{"../Subscriber":55}],163:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../util/ArgumentOutOfRangeError");r.skipLast=function(e){return function(t){return t.lift(new s(e))}};var s=(u.prototype.call=function(t,e){return 0===this._skipCount?e.subscribe(new o.Subscriber(t)):e.subscribe(new l(t,this._skipCount))},u);function u(t){if(this._skipCount=t,this._skipCount<0)throw new a.ArgumentOutOfRangeError}var c,l=(c=o.Subscriber,i(h,c),h.prototype._next=function(t){var e=this._skipCount,r=this._count++;if(r<e)this._ring[r]=t;else{var n=r%e,i=this._ring,o=i[n];i[n]=t,this.destination.next(o)}},h);function h(t,e){var r=c.call(this,t)||this;return r._skipCount=e,r._count=0,r._ring=new Array(e),r}},{"../Subscriber":55,"../util/ArgumentOutOfRangeError":209}],164:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../OuterSubscriber"),a=t("../InnerSubscriber"),s=t("../util/subscribeToResult");r.skipUntil=function(e){return function(t){return t.lift(new u(e))}};var u=(c.prototype.call=function(t,e){return e.subscribe(new h(t,this.notifier))},c);function c(t){this.notifier=t}var l,h=(l=o.OuterSubscriber,i(p,l),p.prototype._next=function(t){this.hasValue&&l.prototype._next.call(this,t)},p.prototype.notifyNext=function(t,e,r,n,i){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},p.prototype.notifyComplete=function(){},p);function p(t,e){var r=l.call(this,t)||this;r.hasValue=!1;var n=new a.InnerSubscriber(r,void 0,void 0);return r.add(n),r.innerSubscription=n,s.subscribeToResult(r,e,void 0,void 0,n),r}},{"../InnerSubscriber":46,"../OuterSubscriber":50,"../util/subscribeToResult":238}],165:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.skipWhile=function(e){return function(t){return t.lift(new a(e))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t,this.predicate))},s);function s(t){this.predicate=t}var u,c=(u=o.Subscriber,i(l,u),l.prototype._next=function(t){var e=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||e.next(t)},l.prototype.tryCallPredicate=function(t){try{var e=this.predicate(t,this.index++);this.skipping=Boolean(e)}catch(t){this.destination.error(t)}},l);function l(t,e){var r=u.call(this,t)||this;return r.predicate=e,r.skipping=!0,r.index=0,r}},{"../Subscriber":55}],166:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("../observable/fromArray"),o=t("../observable/scalar"),a=t("../observable/empty"),s=t("../observable/concat"),u=t("../util/isScheduler");r.startWith=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(t){var e=n[n.length-1];u.isScheduler(e)?n.pop():e=null;var r=n.length;return 1!==r||e?0<r?s.concat(i.fromArray(n,e),t):s.concat(a.empty(e),t):s.concat(o.scalar(n[0]),t)}}},{"../observable/concat":63,"../observable/empty":65,"../observable/fromArray":68,"../observable/scalar":84,"../util/isScheduler":229}],167:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../observable/SubscribeOnObservable");r.subscribeOn=function(e,r){return void 0===r&&(r=0),function(t){return t.lift(new i(e,r))}};var i=(o.prototype.call=function(t,e){return new n.SubscribeOnObservable(e,this.delay,this.scheduler).subscribe(t)},o);function o(t,e){this.scheduler=t,this.delay=e}},{"../observable/SubscribeOnObservable":59}],168:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./switchMap"),i=t("../util/identity");r.switchAll=function(){return n.switchMap(i.identity)}},{"../util/identity":218,"./switchMap":169}],169:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../OuterSubscriber"),a=t("../InnerSubscriber"),s=t("../util/subscribeToResult"),u=t("./map"),c=t("../observable/from");r.switchMap=function e(i,o){return"function"==typeof o?function(t){return t.pipe(e(function(r,n){return c.from(i(r,n)).pipe(u.map(function(t,e){return o(r,t,n,e)}))}))}:function(t){return t.lift(new l(i))}};var l=(h.prototype.call=function(t,e){return e.subscribe(new f(t,this.project))},h);function h(t){this.project=t}var p,f=(p=o.OuterSubscriber,i(d,p),d.prototype._next=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this._innerSub(e,t,r)},d.prototype._innerSub=function(t,e,r){var n=this.innerSubscription;n&&n.unsubscribe();var i=new a.InnerSubscriber(this,void 0,void 0);this.destination.add(i),this.innerSubscription=s.subscribeToResult(this,t,e,r,i)},d.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||p.prototype._complete.call(this),this.unsubscribe()},d.prototype._unsubscribe=function(){this.innerSubscription=null},d.prototype.notifyComplete=function(t){this.destination.remove(t),this.innerSubscription=null,this.isStopped&&p.prototype._complete.call(this)},d.prototype.notifyNext=function(t,e,r,n,i){this.destination.next(e)},d);function d(t,e){var r=p.call(this,t)||this;return r.project=e,r.index=0,r}},{"../InnerSubscriber":46,"../OuterSubscriber":50,"../observable/from":67,"../util/subscribeToResult":238,"./map":128}],170:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./switchMap");r.switchMapTo=function(t,e){return e?n.switchMap(function(){return t},e):n.switchMap(function(){return t})}},{"./switchMap":169}],171:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../util/ArgumentOutOfRangeError"),s=t("../observable/empty");r.take=function(e){return function(t){return 0===e?s.empty():t.lift(new u(e))}};var u=(c.prototype.call=function(t,e){return e.subscribe(new h(t,this.total))},c);function c(t){if(this.total=t,this.total<0)throw new a.ArgumentOutOfRangeError}var l,h=(l=o.Subscriber,i(p,l),p.prototype._next=function(t){var e=this.total,r=++this.count;r<=e&&(this.destination.next(t),r===e&&(this.destination.complete(),this.unsubscribe()))},p);function p(t,e){var r=l.call(this,t)||this;return r.total=e,r.count=0,r}},{"../Subscriber":55,"../observable/empty":65,"../util/ArgumentOutOfRangeError":209}],172:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../util/ArgumentOutOfRangeError"),s=t("../observable/empty");r.takeLast=function(e){return function(t){return 0===e?s.empty():t.lift(new u(e))}};var u=(c.prototype.call=function(t,e){return e.subscribe(new h(t,this.total))},c);function c(t){if(this.total=t,this.total<0)throw new a.ArgumentOutOfRangeError}var l,h=(l=o.Subscriber,i(p,l),p.prototype._next=function(t){var e=this.ring,r=this.total,n=this.count++;e.length<r?e.push(t):e[n%r]=t},p.prototype._complete=function(){var t=this.destination,e=this.count;if(0<e)for(var r=this.count>=this.total?this.total:this.count,n=this.ring,i=0;i<r;i++){var o=e++%r;t.next(n[o])}t.complete()},p);function p(t,e){var r=l.call(this,t)||this;return r.total=e,r.ring=new Array,r.count=0,r}},{"../Subscriber":55,"../observable/empty":65,"../util/ArgumentOutOfRangeError":209}],173:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../OuterSubscriber"),a=t("../util/subscribeToResult");r.takeUntil=function(e){return function(t){return t.lift(new s(e))}};var s=(u.prototype.call=function(t,e){var r=new l(t),n=a.subscribeToResult(r,this.notifier);return n&&!r.seenValue?(r.add(n),e.subscribe(r)):r},u);function u(t){this.notifier=t}var c,l=(c=o.OuterSubscriber,i(h,c),h.prototype.notifyNext=function(t,e,r,n,i){this.seenValue=!0,this.complete()},h.prototype.notifyComplete=function(){},h);function h(t){var e=c.call(this,t)||this;return e.seenValue=!1,e}},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],174:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.takeWhile=function(e){return function(t){return t.lift(new a(e))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t,this.predicate))},s);function s(t){this.predicate=t}var u,c=(u=o.Subscriber,i(l,u),l.prototype._next=function(t){var e,r=this.destination;try{e=this.predicate(t,this.index++)}catch(t){return void r.error(t)}this.nextOrComplete(t,e)},l.prototype.nextOrComplete=function(t,e){var r=this.destination;Boolean(e)?r.next(t):r.complete()},l);function l(t,e){var r=u.call(this,t)||this;return r.predicate=e,r.index=0,r}},{"../Subscriber":55}],175:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../util/noop"),s=t("../util/isFunction");r.tap=function(e,r,n){return function(t){return t.lift(new u(e,r,n))}};var u=(c.prototype.call=function(t,e){return e.subscribe(new h(t,this.nextOrObserver,this.error,this.complete))},c);function c(t,e,r){this.nextOrObserver=t,this.error=e,this.complete=r}var l,h=(l=o.Subscriber,i(p,l),p.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},p.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},p.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},p);function p(t,e,r,n){var i=l.call(this,t)||this;return i._tapNext=a.noop,i._tapError=a.noop,i._tapComplete=a.noop,i._tapError=r||a.noop,i._tapComplete=n||a.noop,s.isFunction(e)?(i._context=i)._tapNext=e:e&&(i._context=e,i._tapNext=e.next||a.noop,i._tapError=e.error||a.noop,i._tapComplete=e.complete||a.noop),i}},{"../Subscriber":55,"../util/isFunction":222,"../util/noop":230}],176:[function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(n,"__esModule",{value:!0});var o=t("../OuterSubscriber"),a=t("../util/subscribeToResult");n.defaultThrottleConfig={leading:!0,trailing:!1},n.throttle=function(e,r){return void 0===r&&(r=n.defaultThrottleConfig),function(t){return t.lift(new s(e,r.leading,r.trailing))}};var s=(u.prototype.call=function(t,e){return e.subscribe(new l(t,this.durationSelector,this.leading,this.trailing))},u);function u(t,e,r){this.durationSelector=t,this.leading=e,this.trailing=r}var c,l=(c=o.OuterSubscriber,r(h,c),h.prototype._next=function(t){this._hasValue=!0,this._sendValue=t,this._throttled||(this._leading?this.send():this.throttle(t))},h.prototype.send=function(){var t=this._hasValue,e=this._sendValue;t&&(this.destination.next(e),this.throttle(e)),this._hasValue=!1,this._sendValue=null},h.prototype.throttle=function(t){var e=this.tryDurationSelector(t);e&&this.add(this._throttled=a.subscribeToResult(this,e))},h.prototype.tryDurationSelector=function(t){try{return this.durationSelector(t)}catch(t){return this.destination.error(t),null}},h.prototype.throttlingDone=function(){var t=this._throttled,e=this._trailing;t&&t.unsubscribe(),this._throttled=null,e&&this.send()},h.prototype.notifyNext=function(t,e,r,n,i){this.throttlingDone()},h.prototype.notifyComplete=function(){this.throttlingDone()},h);function h(t,e,r,n){var i=c.call(this,t)||this;return i.destination=t,i.durationSelector=e,i._leading=r,i._trailing=n,i._hasValue=!1,i}},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],177:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),a=t("../scheduler/async"),s=t("./throttle");r.throttleTime=function(e,r,n){return void 0===r&&(r=a.async),void 0===n&&(n=s.defaultThrottleConfig),function(t){return t.lift(new u(e,r,n.leading,n.trailing))}};var u=(c.prototype.call=function(t,e){return e.subscribe(new h(t,this.duration,this.scheduler,this.leading,this.trailing))},c);function c(t,e,r,n){this.duration=t,this.scheduler=e,this.leading=r,this.trailing=n}var l,h=(l=o.Subscriber,i(p,l),p.prototype._next=function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(f,this.duration,{subscriber:this})),this.leading&&this.destination.next(t))},p.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},p.prototype.clearThrottle=function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)},p);function p(t,e,r,n,i){var o=l.call(this,t)||this;return o.duration=e,o.scheduler=r,o.leading=n,o.trailing=i,o._hasTrailingValue=!1,o._trailingValue=null,o}function f(t){t.subscriber.clearThrottle()}},{"../Subscriber":55,"../scheduler/async":204,"./throttle":176}],178:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./tap"),i=t("../util/EmptyError");function o(){return new i.EmptyError}r.throwIfEmpty=function(t){return void 0===t&&(t=o),n.tap({hasValue:!1,next:function(){this.hasValue=!0},complete:function(){if(!this.hasValue)throw t()}})}},{"../util/EmptyError":210,"./tap":175}],179:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("../scheduler/async"),o=t("./scan"),a=t("../observable/defer"),s=t("./map");r.timeInterval=function(n){return void 0===n&&(n=i.async),function(t){return a.defer(function(){return t.pipe(o.scan(function(t,e){var r=t.current;return{value:e,current:n.now(),last:r}},{current:n.now(),value:void 0,last:void 0}),s.map(function(t){var e=t.current,r=t.last,n=t.value;return new u(n,e-r)}))})}};var u=function(t,e){this.value=t,this.interval=e};r.TimeInterval=u},{"../observable/defer":64,"../scheduler/async":204,"./map":128,"./scan":157}],180:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../scheduler/async"),i=t("../util/TimeoutError"),o=t("./timeoutWith"),a=t("../observable/throwError");r.timeout=function(t,e){return void 0===e&&(e=n.async),o.timeoutWith(t,a.throwError(new i.TimeoutError),e)}},{"../observable/throwError":85,"../scheduler/async":204,"../util/TimeoutError":213,"./timeoutWith":181}],181:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a=t("../scheduler/async"),s=t("../util/isDate"),o=t("../OuterSubscriber"),u=t("../util/subscribeToResult");r.timeoutWith=function(n,i,o){return void 0===o&&(o=a.async),function(t){var e=s.isDate(n),r=e?+n-o.now():Math.abs(n);return t.lift(new c(r,e,i,o))}};var c=(l.prototype.call=function(t,e){return e.subscribe(new p(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},l);function l(t,e,r,n){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=r,this.scheduler=n}var h,p=(h=o.OuterSubscriber,i(f,h),f.dispatchTimeout=function(t){var e=t.withObservable;t._unsubscribeAndRecycle(),t.add(u.subscribeToResult(t,e))},f.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(f.dispatchTimeout,this.waitFor,this))},f.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),h.prototype._next.call(this,t)},f.prototype._unsubscribe=function(){this.action=null,this.scheduler=null,this.withObservable=null},f);function f(t,e,r,n,i){var o=h.call(this,t)||this;return o.absoluteTimeout=e,o.waitFor=r,o.withObservable=n,o.scheduler=i,o.action=null,o.scheduleTimeout(),o}},{"../OuterSubscriber":50,"../scheduler/async":204,"../util/isDate":221,"../util/subscribeToResult":238}],182:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../scheduler/async"),i=t("./map");r.timestamp=function(e){return void 0===e&&(e=n.async),i.map(function(t){return new o(t,e.now())})};var o=function(t,e){this.value=t,this.timestamp=e};r.Timestamp=o},{"../scheduler/async":204,"./map":128}],183:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./reduce");function i(t,e,r){return 0===r?[e]:(t.push(e),t)}r.toArray=function(){return n.reduce(i,[])}},{"./reduce":149}],184:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subject"),a=t("../OuterSubscriber"),s=t("../util/subscribeToResult");r.window=function(e){return function(t){return t.lift(new u(e))}};var u=(c.prototype.call=function(t,e){var r=new h(t),n=e.subscribe(r);return n.closed||r.add(s.subscribeToResult(r,this.windowBoundaries)),n},c);function c(t){this.windowBoundaries=t}var l,h=(l=a.OuterSubscriber,i(p,l),p.prototype.notifyNext=function(t,e,r,n,i){this.openWindow()},p.prototype.notifyError=function(t,e){this._error(t)},p.prototype.notifyComplete=function(t){this._complete()},p.prototype._next=function(t){this.window.next(t)},p.prototype._error=function(t){this.window.error(t),this.destination.error(t)},p.prototype._complete=function(){this.window.complete(),this.destination.complete()},p.prototype._unsubscribe=function(){this.window=null},p.prototype.openWindow=function(){var t=this.window;t&&t.complete();var e=this.destination,r=this.window=new o.Subject;e.next(r)},p);function p(t){var e=l.call(this,t)||this;return e.window=new o.Subject,t.next(e.window),e}},{"../OuterSubscriber":50,"../Subject":53,"../util/subscribeToResult":238}],185:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber"),c=t("../Subject");r.windowCount=function(e,r){return void 0===r&&(r=0),function(t){return t.lift(new a(e,r))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new l(t,this.windowSize,this.startWindowEvery))},s);function s(t,e){this.windowSize=t,this.startWindowEvery=e}var u,l=(u=o.Subscriber,i(h,u),h.prototype._next=function(t){for(var e=0<this.startWindowEvery?this.startWindowEvery:this.windowSize,r=this.destination,n=this.windowSize,i=this.windows,o=i.length,a=0;a<o&&!this.closed;a++)i[a].next(t);var s=this.count-n+1;if(0<=s&&s%e==0&&!this.closed&&i.shift().complete(),++this.count%e==0&&!this.closed){var u=new c.Subject;i.push(u),r.next(u)}},h.prototype._error=function(t){var e=this.windows;if(e)for(;0<e.length&&!this.closed;)e.shift().error(t);this.destination.error(t)},h.prototype._complete=function(){var t=this.windows;if(t)for(;0<t.length&&!this.closed;)t.shift().complete();this.destination.complete()},h.prototype._unsubscribe=function(){this.count=0,this.windows=null},h);function h(t,e,r){var n=u.call(this,t)||this;return n.destination=t,n.windowSize=e,n.startWindowEvery=r,n.windows=[new c.Subject],n.count=0,t.next(n.windows[0]),n}},{"../Subject":53,"../Subscriber":55}],186:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subject"),a=t("../scheduler/async"),s=t("../Subscriber"),u=t("../util/isNumeric"),c=t("../util/isScheduler");r.windowTime=function(e){var r=a.async,n=null,i=Number.POSITIVE_INFINITY;return c.isScheduler(arguments[3])&&(r=arguments[3]),c.isScheduler(arguments[2])?r=arguments[2]:u.isNumeric(arguments[2])&&(i=arguments[2]),c.isScheduler(arguments[1])?r=arguments[1]:u.isNumeric(arguments[1])&&(n=arguments[1]),function(t){return t.lift(new l(e,n,i,r))}};var l=(h.prototype.call=function(t,e){return e.subscribe(new g(t,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},h);function h(t,e,r,n){this.windowTimeSpan=t,this.windowCreationInterval=e,this.maxWindowSize=r,this.scheduler=n}var p,f=(p=o.Subject,i(d,p),d.prototype.next=function(t){this._numberOfNextedValues++,p.prototype.next.call(this,t)},Object.defineProperty(d.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),d);function d(){var t=null!==p&&p.apply(this,arguments)||this;return t._numberOfNextedValues=0,t}var m,g=(m=s.Subscriber,i(y,m),y.prototype._next=function(t){for(var e=this.windows,r=e.length,n=0;n<r;n++){var i=e[n];i.closed||(i.next(t),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},y.prototype._error=function(t){for(var e=this.windows;0<e.length;)e.shift().error(t);this.destination.error(t)},y.prototype._complete=function(){for(var t=this.windows;0<t.length;){var e=t.shift();e.closed||e.complete()}this.destination.complete()},y.prototype.openWindow=function(){var t=new f;return this.windows.push(t),this.destination.next(t),t},y.prototype.closeWindow=function(t){t.complete();var e=this.windows;e.splice(e.indexOf(t),1)},y);function y(t,e,r,n,i){var o=m.call(this,t)||this;o.destination=t,o.windowTimeSpan=e,o.windowCreationInterval=r,o.maxWindowSize=n,o.scheduler=i,o.windows=[];var a=o.openWindow();if(null!==r&&0<=r){var s={subscriber:o,window:a,context:null},u={windowTimeSpan:e,windowCreationInterval:r,subscriber:o,scheduler:i};o.add(i.schedule(b,e,s)),o.add(i.schedule(_,r,u))}else{var c={subscriber:o,window:a,windowTimeSpan:e};o.add(i.schedule(v,e,c))}return o}function v(t){var e=t.subscriber,r=t.windowTimeSpan,n=t.window;n&&e.closeWindow(n),t.window=e.openWindow(),this.schedule(t,r)}function _(t){var e=t.windowTimeSpan,r=t.subscriber,n=t.scheduler,i=t.windowCreationInterval,o=r.openWindow(),a={action:this,subscription:null},s={subscriber:r,window:o,context:a};a.subscription=n.schedule(b,e,s),this.add(a.subscription),this.schedule(t,i)}function b(t){var e=t.subscriber,r=t.window,n=t.context;n&&n.action&&n.subscription&&n.action.remove(n.subscription),e.closeWindow(r)}},{"../Subject":53,"../Subscriber":55,"../scheduler/async":204,"../util/isNumeric":225,"../util/isScheduler":229}],187:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var h=t("../Subject"),p=t("../Subscription"),f=t("../util/tryCatch"),d=t("../util/errorObject"),o=t("../OuterSubscriber"),m=t("../util/subscribeToResult");r.windowToggle=function(e,r){return function(t){return t.lift(new a(e,r))}};var a=(s.prototype.call=function(t,e){return e.subscribe(new c(t,this.openings,this.closingSelector))},s);function s(t,e){this.openings=t,this.closingSelector=e}var u,c=(u=o.OuterSubscriber,i(l,u),l.prototype._next=function(t){var e=this.contexts;if(e)for(var r=e.length,n=0;n<r;n++)e[n].window.next(t)},l.prototype._error=function(t){var e=this.contexts;if(this.contexts=null,e)for(var r=e.length,n=-1;++n<r;){var i=e[n];i.window.error(t),i.subscription.unsubscribe()}u.prototype._error.call(this,t)},l.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var e=t.length,r=-1;++r<e;){var n=t[r];n.window.complete(),n.subscription.unsubscribe()}u.prototype._complete.call(this)},l.prototype._unsubscribe=function(){var t=this.contexts;if(this.contexts=null,t)for(var e=t.length,r=-1;++r<e;){var n=t[r];n.window.unsubscribe(),n.subscription.unsubscribe()}},l.prototype.notifyNext=function(t,e,r,n,i){if(t===this.openings){var o=this.closingSelector,a=f.tryCatch(o)(e);if(a===d.errorObject)return this.error(d.errorObject.e);var s=new h.Subject,u=new p.Subscription,c={window:s,subscription:u};this.contexts.push(c);var l=m.subscribeToResult(this,a,c);l.closed?this.closeWindow(this.contexts.length-1):(l.context=c,u.add(l)),this.destination.next(s)}else this.closeWindow(this.contexts.indexOf(t))},l.prototype.notifyError=function(t){this.error(t)},l.prototype.notifyComplete=function(t){t!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(t.context))},l.prototype.closeWindow=function(t){if(-1!==t){var e=this.contexts,r=e[t],n=r.window,i=r.subscription;e.splice(t,1),n.complete(),i.unsubscribe()}},l);function l(t,e,r){var n=u.call(this,t)||this;return n.openings=e,n.closingSelector=r,n.contexts=[],n.add(n.openSubscription=m.subscribeToResult(n,e,e)),n}},{"../OuterSubscriber":50,"../Subject":53,"../Subscription":56,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],188:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subject"),a=t("../util/tryCatch"),s=t("../util/errorObject"),u=t("../OuterSubscriber"),c=t("../util/subscribeToResult");r.windowWhen=function(e){return function(t){return t.lift(new l(e))}};var l=(h.prototype.call=function(t,e){return e.subscribe(new f(t,this.closingSelector))},h);function h(t){this.closingSelector=t}var p,f=(p=u.OuterSubscriber,i(d,p),d.prototype.notifyNext=function(t,e,r,n,i){this.openWindow(i)},d.prototype.notifyError=function(t,e){this._error(t)},d.prototype.notifyComplete=function(t){this.openWindow(t)},d.prototype._next=function(t){this.window.next(t)},d.prototype._error=function(t){this.window.error(t),this.destination.error(t),this.unsubscribeClosingNotification()},d.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},d.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},d.prototype.openWindow=function(t){void 0===t&&(t=null),t&&(this.remove(t),t.unsubscribe());var e=this.window;e&&e.complete();var r=this.window=new o.Subject;this.destination.next(r);var n=a.tryCatch(this.closingSelector)();if(n===s.errorObject){var i=s.errorObject.e;this.destination.error(i),this.window.error(i)}else this.add(this.closingNotification=c.subscribeToResult(this,n))},d);function d(t,e){var r=p.call(this,t)||this;return r.destination=t,r.closingSelector=e,r.openWindow(),r}},{"../OuterSubscriber":50,"../Subject":53,"../util/errorObject":216,"../util/subscribeToResult":238,"../util/tryCatch":240}],189:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o=t("../OuterSubscriber"),s=t("../util/subscribeToResult");r.withLatestFrom=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(t){var e;"function"==typeof n[n.length-1]&&(e=n.pop());var r=n;return t.lift(new a(r,e))}};var a=(u.prototype.call=function(t,e){return e.subscribe(new l(t,this.observables,this.project))},u);function u(t,e){this.observables=t,this.project=e}var c,l=(c=o.OuterSubscriber,i(h,c),h.prototype.notifyNext=function(t,e,r,n,i){this.values[r]=e;var o=this.toRespond;if(0<o.length){var a=o.indexOf(r);-1!==a&&o.splice(a,1)}},h.prototype.notifyComplete=function(){},h.prototype._next=function(t){if(0===this.toRespond.length){var e=[t].concat(this.values);this.project?this._tryProject(e):this.destination.next(e)}},h.prototype._tryProject=function(t){var e;try{e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},h);function h(t,e,r){var n=c.call(this,t)||this;n.observables=e,n.project=r,n.toRespond=[];var i=e.length;n.values=new Array(i);for(var o=0;o<i;o++)n.toRespond.push(o);for(o=0;o<i;o++){var a=e[o];n.add(s.subscribeToResult(n,a,a,o))}return n}},{"../OuterSubscriber":50,"../util/subscribeToResult":238}],190:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../observable/zip");r.zip=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(n.zip.apply(void 0,[t].concat(e)))}}},{"../observable/zip":88}],191:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../observable/zip");r.zipAll=function(e){return function(t){return t.lift(new n.ZipOperator(e))}}},{"../observable/zip":88}],192:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../Subscription"),s=(o=a.Subscription,i(u,o),u.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},u);function u(t,e){return o.call(this)||this}r.Action=s},{"../Subscription":56}],193:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./AsyncAction"),s=(o=a.AsyncAction,i(u,o),u.prototype.requestAsyncId=function(t,e,r){return void 0===r&&(r=0),null!==r&&0<r?o.prototype.requestAsyncId.call(this,t,e,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame(function(){return t.flush(null)})))},u.prototype.recycleAsyncId=function(t,e,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return o.prototype.recycleAsyncId.call(this,t,e,r);0===t.actions.length&&(cancelAnimationFrame(e),t.scheduled=void 0)},u);function u(t,e){var r=o.call(this,t,e)||this;return r.scheduler=t,r.work=e,r}r.AnimationFrameAction=s},{"./AsyncAction":197}],194:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./AsyncScheduler"),s=(o=a.AsyncScheduler,i(u,o),u.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,r=this.actions,n=-1,i=r.length;t=t||r.shift();do{if(e=t.execute(t.state,t.delay))break}while(++n<i&&(t=r.shift()));if(this.active=!1,e){for(;++n<i&&(t=r.shift());)t.unsubscribe();throw e}},u);function u(){return null!==o&&o.apply(this,arguments)||this}r.AnimationFrameScheduler=s},{"./AsyncScheduler":198}],195:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../util/Immediate"),s=t("./AsyncAction"),u=(o=s.AsyncAction,i(c,o),c.prototype.requestAsyncId=function(t,e,r){return void 0===r&&(r=0),null!==r&&0<r?o.prototype.requestAsyncId.call(this,t,e,r):(t.actions.push(this),t.scheduled||(t.scheduled=a.Immediate.setImmediate(t.flush.bind(t,null))))},c.prototype.recycleAsyncId=function(t,e,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return o.prototype.recycleAsyncId.call(this,t,e,r);0===t.actions.length&&(a.Immediate.clearImmediate(e),t.scheduled=void 0)},c);function c(t,e){var r=o.call(this,t,e)||this;return r.scheduler=t,r.work=e,r}r.AsapAction=u},{"../util/Immediate":211,"./AsyncAction":197}],196:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./AsyncScheduler"),s=(o=a.AsyncScheduler,i(u,o),u.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,r=this.actions,n=-1,i=r.length;t=t||r.shift();do{if(e=t.execute(t.state,t.delay))break}while(++n<i&&(t=r.shift()));if(this.active=!1,e){for(;++n<i&&(t=r.shift());)t.unsubscribe();throw e}},u);function u(){return null!==o&&o.apply(this,arguments)||this}r.AsapScheduler=s},{"./AsyncScheduler":198}],197:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./Action"),s=(o=a.Action,i(u,o),u.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var r=this.id,n=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(n,r,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this},u.prototype.requestAsyncId=function(t,e,r){return void 0===r&&(r=0),setInterval(t.flush.bind(t,this),r)},u.prototype.recycleAsyncId=function(t,e,r){if(void 0===r&&(r=0),null!==r&&this.delay===r&&!1===this.pending)return e;clearInterval(e)},u.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(t,e);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},u.prototype._execute=function(t,e){var r=!1,n=void 0;try{this.work(t)}catch(t){r=!0,n=!!t&&t||new Error(t)}if(r)return this.unsubscribe(),n},u.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,r=e.actions,n=r.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&r.splice(n,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},u);function u(t,e){var r=o.call(this,t,e)||this;return r.scheduler=t,r.work=e,r.pending=!1,r}r.AsyncAction=s},{"./Action":192}],198:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../Scheduler"),s=(o=a.Scheduler,i(u,o),u.prototype.schedule=function(t,e,r){return void 0===e&&(e=0),u.delegate&&u.delegate!==this?u.delegate.schedule(t,e,r):o.prototype.schedule.call(this,t,e,r)},u.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var r;this.active=!0;do{if(r=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,r){for(;t=e.shift();)t.unsubscribe();throw r}}},u);function u(t,e){void 0===e&&(e=a.Scheduler.now);var r=o.call(this,t,function(){return u.delegate&&u.delegate!==r?u.delegate.now():e()})||this;return r.actions=[],r.active=!1,r.scheduled=void 0,r}r.AsyncScheduler=s},{"../Scheduler":52}],199:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./AsyncAction"),s=(o=a.AsyncAction,i(u,o),u.prototype.schedule=function(t,e){return void 0===e&&(e=0),0<e?o.prototype.schedule.call(this,t,e):(this.delay=e,this.state=t,this.scheduler.flush(this),this)},u.prototype.execute=function(t,e){return 0<e||this.closed?o.prototype.execute.call(this,t,e):this._execute(t,e)},u.prototype.requestAsyncId=function(t,e,r){return void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay?o.prototype.requestAsyncId.call(this,t,e,r):t.flush(this)},u);function u(t,e){var r=o.call(this,t,e)||this;return r.scheduler=t,r.work=e,r}r.QueueAction=s},{"./AsyncAction":197}],200:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./AsyncScheduler"),s=(o=a.AsyncScheduler,i(u,o),u);function u(){return null!==o&&o.apply(this,arguments)||this}r.QueueScheduler=s},{"./AsyncScheduler":198}],201:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./AsyncAction"),s=t("./AsyncScheduler"),u=(o=s.AsyncScheduler,i(c,o),c.prototype.flush=function(){for(var t,e,r=this.actions,n=this.maxFrames;(e=r.shift())&&(this.frame=e.delay)<=n&&!(t=e.execute(e.state,e.delay)););if(t){for(;e=r.shift();)e.unsubscribe();throw t}},c.frameTimeFactor=10,c);function c(t,e){void 0===t&&(t=h),void 0===e&&(e=Number.POSITIVE_INFINITY);var r=o.call(this,t,function(){return r.frame})||this;return r.maxFrames=e,r.frame=0,r.index=-1,r}r.VirtualTimeScheduler=u;var l,h=(l=a.AsyncAction,i(p,l),p.prototype.schedule=function(t,e){if(void 0===e&&(e=0),!this.id)return l.prototype.schedule.call(this,t,e);this.active=!1;var r=new p(this.scheduler,this.work);return this.add(r),r.schedule(t,e)},p.prototype.requestAsyncId=function(t,e,r){void 0===r&&(r=0),this.delay=t.frame+r;var n=t.actions;return n.push(this),n.sort(p.sortActions),!0},p.prototype.recycleAsyncId=function(t,e,r){void 0===r&&(r=0)},p.prototype._execute=function(t,e){if(!0===this.active)return l.prototype._execute.call(this,t,e)},p.sortActions=function(t,e){return t.delay===e.delay?t.index===e.index?0:t.index>e.index?1:-1:t.delay>e.delay?1:-1},p);function p(t,e,r){void 0===r&&(r=t.index+=1);var n=l.call(this,t,e)||this;return n.scheduler=t,n.work=e,n.index=r,n.active=!0,n.index=t.index=r,n}r.VirtualAction=h},{"./AsyncAction":197,"./AsyncScheduler":198}],202:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./AnimationFrameAction"),i=t("./AnimationFrameScheduler");r.animationFrame=new i.AnimationFrameScheduler(n.AnimationFrameAction)},{"./AnimationFrameAction":193,"./AnimationFrameScheduler":194}],203:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./AsapAction"),i=t("./AsapScheduler");r.asap=new i.AsapScheduler(n.AsapAction)},{"./AsapAction":195,"./AsapScheduler":196}],204:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./AsyncAction"),i=t("./AsyncScheduler");r.async=new i.AsyncScheduler(n.AsyncAction)},{"./AsyncAction":197,"./AsyncScheduler":198}],205:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./QueueAction"),i=t("./QueueScheduler");r.queue=new i.QueueScheduler(n.QueueAction)},{"./QueueAction":199,"./QueueScheduler":200}],206:[function(t,e,r){"use strict";function n(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}Object.defineProperty(r,"__esModule",{value:!0}),r.getSymbolIterator=n,r.iterator=n(),r.$$iterator=r.iterator},{}],207:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.observable="function"==typeof Symbol&&Symbol.observable||"@@observable"},{}],208:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.rxSubscriber="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),r.$$rxSubscriber=r.rxSubscriber},{}],209:[function(t,e,r){"use strict";function n(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}Object.defineProperty(r,"__esModule",{value:!0}),n.prototype=Object.create(Error.prototype),r.ArgumentOutOfRangeError=n},{}],210:[function(t,e,r){"use strict";function n(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}Object.defineProperty(r,"__esModule",{value:!0}),n.prototype=Object.create(Error.prototype),r.EmptyError=n},{}],211:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=1,i={};r.Immediate={setImmediate:function(t){var e=n++;return i[e]=t,Promise.resolve().then(function(){return function(t){var e=i[t];e&&e()}(e)}),e},clearImmediate:function(t){delete i[t]}}},{}],212:[function(t,e,r){"use strict";function n(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}Object.defineProperty(r,"__esModule",{value:!0}),n.prototype=Object.create(Error.prototype),r.ObjectUnsubscribedError=n},{}],213:[function(t,e,r){"use strict";function n(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}Object.defineProperty(r,"__esModule",{value:!0}),n.prototype=Object.create(Error.prototype),r.TimeoutError=n},{}],214:[function(t,e,r){"use strict";function n(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}Object.defineProperty(r,"__esModule",{value:!0}),n.prototype=Object.create(Error.prototype),r.UnsubscriptionError=n},{}],215:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("../Subscriber");r.canReportError=function(t){for(;t;){var e=t,r=e.closed,n=e.destination,i=e.isStopped;if(r||i)return!1;t=n&&n instanceof o.Subscriber?n:null}return!0}},{"../Subscriber":55}],216:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.errorObject={e:{}}},{}],217:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.hostReportError=function(t){setTimeout(function(){throw t})}},{}],218:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.identity=function(t){return t}},{}],219:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isArray=Array.isArray||function(t){return t&&"number"==typeof t.length}},{}],220:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isArrayLike=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t}},{}],221:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isDate=function(t){return t instanceof Date&&!isNaN(+t)}},{}],222:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isFunction=function(t){return"function"==typeof t}},{}],223:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../symbol/observable");r.isInteropObservable=function(t){return t&&"function"==typeof t[n.observable]}},{"../symbol/observable":207}],224:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../symbol/iterator");r.isIterable=function(t){return t&&"function"==typeof t[n.iterator]}},{"../symbol/iterator":206}],225:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./isArray");r.isNumeric=function(t){return!n.isArray(t)&&0<=t-parseFloat(t)+1}},{"./isArray":219}],226:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isObject=function(t){return null!=t&&"object"==typeof t}},{}],227:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Observable");r.isObservable=function(t){return!!t&&(t instanceof n.Observable||"function"==typeof t.lift&&"function"==typeof t.subscribe)}},{"../Observable":48}],228:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isPromise=function(t){return t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}},{}],229:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isScheduler=function(t){return t&&"function"==typeof t.schedule}},{}],230:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.noop=function(){}},{}],231:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.not=function(t,e){function r(){return!r.pred.apply(r.thisArg,arguments)}return r.pred=t,r.thisArg=e,r}},{}],232:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./noop");function i(e){return e?1===e.length?e[0]:function(t){return e.reduce(function(t,e){return e(t)},t)}:n.noop}r.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return i(t)},r.pipeFromArray=i},{"./noop":230}],233:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Observable"),i=t("./subscribeToArray"),o=t("./subscribeToPromise"),a=t("./subscribeToIterable"),s=t("./subscribeToObservable"),u=t("./isArrayLike"),c=t("./isPromise"),l=t("./isObject"),h=t("../symbol/iterator"),p=t("../symbol/observable");r.subscribeTo=function(e){if(e instanceof n.Observable)return function(t){return e._isScalar?(t.next(e.value),void t.complete()):e.subscribe(t)};if(e&&"function"==typeof e[p.observable])return s.subscribeToObservable(e);if(u.isArrayLike(e))return i.subscribeToArray(e);if(c.isPromise(e))return o.subscribeToPromise(e);if(e&&"function"==typeof e[h.iterator])return a.subscribeToIterable(e);var t=l.isObject(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},{"../Observable":48,"../symbol/iterator":206,"../symbol/observable":207,"./isArrayLike":220,"./isObject":226,"./isPromise":228,"./subscribeToArray":234,"./subscribeToIterable":235,"./subscribeToObservable":236,"./subscribeToPromise":237}],234:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.subscribeToArray=function(n){return function(t){for(var e=0,r=n.length;e<r&&!t.closed;e++)t.next(n[e]);t.closed||t.complete()}}},{}],235:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("../symbol/iterator");r.subscribeToIterable=function(n){return function(t){for(var e=n[i.iterator]();;){var r=e.next();if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof e.return&&t.add(function(){e.return&&e.return()}),t}}},{"../symbol/iterator":206}],236:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../symbol/observable");r.subscribeToObservable=function(r){return function(t){var e=r[n.observable]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)}}},{"../symbol/observable":207}],237:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./hostReportError");r.subscribeToPromise=function(t){return function(e){return t.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,n.hostReportError),e}}},{"./hostReportError":217}],238:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("../InnerSubscriber"),a=t("./subscribeTo");r.subscribeToResult=function(t,e,r,n,i){if(void 0===i&&(i=new o.InnerSubscriber(t,r,n)),!i.closed)return a.subscribeTo(e)(i)}},{"../InnerSubscriber":46,"./subscribeTo":233}],239:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Subscriber"),i=t("../symbol/rxSubscriber"),o=t("../Observer");r.toSubscriber=function(t,e,r){if(t){if(t instanceof n.Subscriber)return t;if(t[i.rxSubscriber])return t[i.rxSubscriber]()}return t||e||r?new n.Subscriber(t,e,r):new n.Subscriber(o.empty)}},{"../Observer":49,"../Subscriber":55,"../symbol/rxSubscriber":208}],240:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=t("./errorObject");function o(){try{return n.apply(this,arguments)}catch(t){return i.errorObject.e=t,i.errorObject}}r.tryCatch=function(t){return n=t,o}},{"./errorObject":216}],241:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../internal/operators/audit");r.audit=n.audit;var i=t("../internal/operators/auditTime");r.auditTime=i.auditTime;var o=t("../internal/operators/buffer");r.buffer=o.buffer;var a=t("../internal/operators/bufferCount");r.bufferCount=a.bufferCount;var s=t("../internal/operators/bufferTime");r.bufferTime=s.bufferTime;var u=t("../internal/operators/bufferToggle");r.bufferToggle=u.bufferToggle;var c=t("../internal/operators/bufferWhen");r.bufferWhen=c.bufferWhen;var l=t("../internal/operators/catchError");r.catchError=l.catchError;var h=t("../internal/operators/combineAll");r.combineAll=h.combineAll;var p=t("../internal/operators/combineLatest");r.combineLatest=p.combineLatest;var f=t("../internal/operators/concat");r.concat=f.concat;var d=t("../internal/operators/concatAll");r.concatAll=d.concatAll;var m=t("../internal/operators/concatMap");r.concatMap=m.concatMap;var g=t("../internal/operators/concatMapTo");r.concatMapTo=g.concatMapTo;var y=t("../internal/operators/count");r.count=y.count;var v=t("../internal/operators/debounce");r.debounce=v.debounce;var _=t("../internal/operators/debounceTime");r.debounceTime=_.debounceTime;var b=t("../internal/operators/defaultIfEmpty");r.defaultIfEmpty=b.defaultIfEmpty;var x=t("../internal/operators/delay");r.delay=x.delay;var w=t("../internal/operators/delayWhen");r.delayWhen=w.delayWhen;var S=t("../internal/operators/dematerialize");r.dematerialize=S.dematerialize;var E=t("../internal/operators/distinct");r.distinct=E.distinct;var C=t("../internal/operators/distinctUntilChanged");r.distinctUntilChanged=C.distinctUntilChanged;var M=t("../internal/operators/distinctUntilKeyChanged");r.distinctUntilKeyChanged=M.distinctUntilKeyChanged;var T=t("../internal/operators/elementAt");r.elementAt=T.elementAt;var P=t("../internal/operators/endWith");r.endWith=P.endWith;var O=t("../internal/operators/every");r.every=O.every;var A=t("../internal/operators/exhaust");r.exhaust=A.exhaust;var I=t("../internal/operators/exhaustMap");r.exhaustMap=I.exhaustMap;var L=t("../internal/operators/expand");r.expand=L.expand;var R=t("../internal/operators/filter");r.filter=R.filter;var N=t("../internal/operators/finalize");r.finalize=N.finalize;var k=t("../internal/operators/find");r.find=k.find;var D=t("../internal/operators/findIndex");r.findIndex=D.findIndex;var j=t("../internal/operators/first");r.first=j.first;var z=t("../internal/operators/groupBy");r.groupBy=z.groupBy;var F=t("../internal/operators/ignoreElements");r.ignoreElements=F.ignoreElements;var B=t("../internal/operators/isEmpty");r.isEmpty=B.isEmpty;var U=t("../internal/operators/last");r.last=U.last;var V=t("../internal/operators/map");r.map=V.map;var G=t("../internal/operators/mapTo");r.mapTo=G.mapTo;var q=t("../internal/operators/materialize");r.materialize=q.materialize;var H=t("../internal/operators/max");r.max=H.max;var $=t("../internal/operators/merge");r.merge=$.merge;var W=t("../internal/operators/mergeAll");r.mergeAll=W.mergeAll;var X=t("../internal/operators/mergeMap");r.mergeMap=X.mergeMap;var Y=t("../internal/operators/mergeMap");r.flatMap=Y.mergeMap;var Z=t("../internal/operators/mergeMapTo");r.mergeMapTo=Z.mergeMapTo;var K=t("../internal/operators/mergeScan");r.mergeScan=K.mergeScan;var J=t("../internal/operators/min");r.min=J.min;var Q=t("../internal/operators/multicast");r.multicast=Q.multicast;var tt=t("../internal/operators/observeOn");r.observeOn=tt.observeOn;var et=t("../internal/operators/onErrorResumeNext");r.onErrorResumeNext=et.onErrorResumeNext;var rt=t("../internal/operators/pairwise");r.pairwise=rt.pairwise;var nt=t("../internal/operators/partition");r.partition=nt.partition;var it=t("../internal/operators/pluck");r.pluck=it.pluck;var ot=t("../internal/operators/publish");r.publish=ot.publish;var at=t("../internal/operators/publishBehavior");r.publishBehavior=at.publishBehavior;var st=t("../internal/operators/publishLast");r.publishLast=st.publishLast;var ut=t("../internal/operators/publishReplay");r.publishReplay=ut.publishReplay;var ct=t("../internal/operators/race");r.race=ct.race;var lt=t("../internal/operators/reduce");r.reduce=lt.reduce;var ht=t("../internal/operators/repeat");r.repeat=ht.repeat;var pt=t("../internal/operators/repeatWhen");r.repeatWhen=pt.repeatWhen;var ft=t("../internal/operators/retry");r.retry=ft.retry;var dt=t("../internal/operators/retryWhen");r.retryWhen=dt.retryWhen;var mt=t("../internal/operators/refCount");r.refCount=mt.refCount;var gt=t("../internal/operators/sample");r.sample=gt.sample;var yt=t("../internal/operators/sampleTime");r.sampleTime=yt.sampleTime;var vt=t("../internal/operators/scan");r.scan=vt.scan;var _t=t("../internal/operators/sequenceEqual");r.sequenceEqual=_t.sequenceEqual;var bt=t("../internal/operators/share");r.share=bt.share;var xt=t("../internal/operators/shareReplay");r.shareReplay=xt.shareReplay;var wt=t("../internal/operators/single");r.single=wt.single;var St=t("../internal/operators/skip");r.skip=St.skip;var Et=t("../internal/operators/skipLast");r.skipLast=Et.skipLast;var Ct=t("../internal/operators/skipUntil");r.skipUntil=Ct.skipUntil;var Mt=t("../internal/operators/skipWhile");r.skipWhile=Mt.skipWhile;var Tt=t("../internal/operators/startWith");r.startWith=Tt.startWith;var Pt=t("../internal/operators/subscribeOn");r.subscribeOn=Pt.subscribeOn;var Ot=t("../internal/operators/switchAll");r.switchAll=Ot.switchAll;var At=t("../internal/operators/switchMap");r.switchMap=At.switchMap;var It=t("../internal/operators/switchMapTo");r.switchMapTo=It.switchMapTo;var Lt=t("../internal/operators/take");r.take=Lt.take;var Rt=t("../internal/operators/takeLast");r.takeLast=Rt.takeLast;var Nt=t("../internal/operators/takeUntil");r.takeUntil=Nt.takeUntil;var kt=t("../internal/operators/takeWhile");r.takeWhile=kt.takeWhile;var Dt=t("../internal/operators/tap");r.tap=Dt.tap;var jt=t("../internal/operators/throttle");r.throttle=jt.throttle;var zt=t("../internal/operators/throttleTime");r.throttleTime=zt.throttleTime;var Ft=t("../internal/operators/throwIfEmpty");r.throwIfEmpty=Ft.throwIfEmpty;var Bt=t("../internal/operators/timeInterval");r.timeInterval=Bt.timeInterval;var Ut=t("../internal/operators/timeout");r.timeout=Ut.timeout;var Vt=t("../internal/operators/timeoutWith");r.timeoutWith=Vt.timeoutWith;var Gt=t("../internal/operators/timestamp");r.timestamp=Gt.timestamp;var qt=t("../internal/operators/toArray");r.toArray=qt.toArray;var Ht=t("../internal/operators/window");r.window=Ht.window;var $t=t("../internal/operators/windowCount");r.windowCount=$t.windowCount;var Wt=t("../internal/operators/windowTime");r.windowTime=Wt.windowTime;var Xt=t("../internal/operators/windowToggle");r.windowToggle=Xt.windowToggle;var Yt=t("../internal/operators/windowWhen");r.windowWhen=Yt.windowWhen;var Zt=t("../internal/operators/withLatestFrom");r.withLatestFrom=Zt.withLatestFrom;var Kt=t("../internal/operators/zip");r.zip=Kt.zip;var Jt=t("../internal/operators/zipAll");r.zipAll=Jt.zipAll},{"../internal/operators/audit":89,"../internal/operators/auditTime":90,"../internal/operators/buffer":91,"../internal/operators/bufferCount":92,"../internal/operators/bufferTime":93,"../internal/operators/bufferToggle":94,"../internal/operators/bufferWhen":95,"../internal/operators/catchError":96,"../internal/operators/combineAll":97,"../internal/operators/combineLatest":98,"../internal/operators/concat":99,"../internal/operators/concatAll":100,"../internal/operators/concatMap":101,"../internal/operators/concatMapTo":102,"../internal/operators/count":103,"../internal/operators/debounce":104,"../internal/operators/debounceTime":105,"../internal/operators/defaultIfEmpty":106,"../internal/operators/delay":107,"../internal/operators/delayWhen":108,"../internal/operators/dematerialize":109,"../internal/operators/distinct":110,"../internal/operators/distinctUntilChanged":111,"../internal/operators/distinctUntilKeyChanged":112,"../internal/operators/elementAt":113,"../internal/operators/endWith":114,"../internal/operators/every":115,"../internal/operators/exhaust":116,"../internal/operators/exhaustMap":117,"../internal/operators/expand":118,"../internal/operators/filter":119,"../internal/operators/finalize":120,"../internal/operators/find":121,"../internal/operators/findIndex":122,"../internal/operators/first":123,"../internal/operators/groupBy":124,"../internal/operators/ignoreElements":125,"../internal/operators/isEmpty":126,"../internal/operators/last":127,"../internal/operators/map":128,"../internal/operators/mapTo":129,"../internal/operators/materialize":130,"../internal/operators/max":131,"../internal/operators/merge":132,"../internal/operators/mergeAll":133,"../internal/operators/mergeMap":134,"../internal/operators/mergeMapTo":135,"../internal/operators/mergeScan":136,"../internal/operators/min":137,"../internal/operators/multicast":138,"../internal/operators/observeOn":139,"../internal/operators/onErrorResumeNext":140,"../internal/operators/pairwise":141,"../internal/operators/partition":142,"../internal/operators/pluck":143,"../internal/operators/publish":144,"../internal/operators/publishBehavior":145,"../internal/operators/publishLast":146,"../internal/operators/publishReplay":147,"../internal/operators/race":148,"../internal/operators/reduce":149,"../internal/operators/refCount":150,"../internal/operators/repeat":151,"../internal/operators/repeatWhen":152,"../internal/operators/retry":153,"../internal/operators/retryWhen":154,"../internal/operators/sample":155,"../internal/operators/sampleTime":156,"../internal/operators/scan":157,"../internal/operators/sequenceEqual":158,"../internal/operators/share":159,"../internal/operators/shareReplay":160,"../internal/operators/single":161,"../internal/operators/skip":162,"../internal/operators/skipLast":163,"../internal/operators/skipUntil":164,"../internal/operators/skipWhile":165,"../internal/operators/startWith":166,"../internal/operators/subscribeOn":167,"../internal/operators/switchAll":168,"../internal/operators/switchMap":169,"../internal/operators/switchMapTo":170,"../internal/operators/take":171,"../internal/operators/takeLast":172,"../internal/operators/takeUntil":173,"../internal/operators/takeWhile":174,"../internal/operators/tap":175,"../internal/operators/throttle":176,"../internal/operators/throttleTime":177,"../internal/operators/throwIfEmpty":178,"../internal/operators/timeInterval":179,"../internal/operators/timeout":180,"../internal/operators/timeoutWith":181,"../internal/operators/timestamp":182,"../internal/operators/toArray":183,"../internal/operators/window":184,"../internal/operators/windowCount":185,"../internal/operators/windowTime":186,"../internal/operators/windowToggle":187,"../internal/operators/windowWhen":188,"../internal/operators/withLatestFrom":189,"../internal/operators/zip":190,"../internal/operators/zipAll":191}],242:[function(t,e,r){var n;n=this,function(t){function e(){}function H(t,e){this.x=t||0,this.y=e||0}function wt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function s(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._w=void 0!==n?n:1}function St(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}function g(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function p(t,e,r,n,i,o,a,s,u,c){Object.defineProperty(this,"id",{value:qo++}),this.uuid=po.generateUUID(),this.name="",this.image=void 0!==t?t:p.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:p.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:1001,this.wrapT=void 0!==n?n:1001,this.magFilter=void 0!==i?i:1006,this.minFilter=void 0!==o?o:1008,this.anisotropy=void 0!==u?u:1,this.format=void 0!==a?a:1023,this.type=void 0!==s?s:1009,this.offset=new H(0,0),this.repeat=new H(1,1),this.center=new H(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new g,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:3e3,this.version=0,this.onUpdate=null}function Et(t,e,r,n){this.x=t||0,this.y=e||0,this.z=r||0,this.w=void 0!==n?n:1}function T(t,e,r){this.width=t,this.height=e,this.scissor=new Et(0,0,t,e),this.scissorTest=!1,this.viewport=new Et(0,0,t,e),void 0===(r=r||{}).minFilter&&(r.minFilter=1006),this.texture=new p(void 0,void 0,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.generateMipmaps=void 0===r.generateMipmaps||r.generateMipmaps,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function n(t,e,r){T.call(this,t,e,r),this.activeMipMapLevel=this.activeCubeFace=0}function Ct(t,e,r,n,i,o,a,s,u,c,l,h){p.call(this,null,o,a,s,u,c,n,i,l,h),this.image={data:t,width:e,height:r},this.magFilter=void 0!==u?u:1003,this.minFilter=void 0!==c?c:1003,this.flipY=this.generateMipmaps=!1,this.unpackAlignment=1}function r(t,e){this.min=void 0!==t?t:new St(1/0,1/0,1/0),this.max=void 0!==e?e:new St(-1/0,-1/0,-1/0)}function a(t,e){this.center=void 0!==t?t:new St,this.radius=void 0!==e?e:0}function y(t,e){this.normal=void 0!==t?t:new St(1,0,0),this.constant=void 0!==e?e:0}function Mt(t,e,r,n,i,o){this.planes=[void 0!==t?t:new y,void 0!==e?e:new y,void 0!==r?r:new y,void 0!==n?n:new y,void 0!==i?i:new y,void 0!==o?o:new y]}function w(t,e,r){return void 0===e&&void 0===r?this.set(t):this.setRGB(t,e,r)}function Tt(){function r(t,e){!1!==i&&(o(t,e),n.requestAnimationFrame(r))}var n=null,i=!1,o=null;return{start:function(){!0!==i&&null!==o&&(n.requestAnimationFrame(r),i=!0)},stop:function(){i=!1},setAnimationLoop:function(t){o=t},setContext:function(t){n=t}}}function Pt(a){var s=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),s.get(t)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var e=s.get(t);e&&(a.deleteBuffer(e.buffer),s.delete(t))},update:function(t,e){t.isInterleavedBufferAttribute&&(t=t.data);var r=s.get(t);if(void 0===r)s.set(t,function(t,e){var r=t.array,n=t.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW,i=a.createBuffer();return a.bindBuffer(e,i),a.bufferData(e,r,n),t.onUploadCallback(),e=a.FLOAT,r instanceof Float32Array?e=a.FLOAT:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?e=a.UNSIGNED_SHORT:r instanceof Int16Array?e=a.SHORT:r instanceof Uint32Array?e=a.UNSIGNED_INT:r instanceof Int32Array?e=a.INT:r instanceof Int8Array?e=a.BYTE:r instanceof Uint8Array&&(e=a.UNSIGNED_BYTE),{buffer:i,type:e,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,e));else if(r.version<t.version){var n=t,i=n.array,o=n.updateRange;a.bindBuffer(e,r.buffer),!1===n.dynamic?a.bufferData(e,i,a.STATIC_DRAW):-1===o.count?a.bufferSubData(e,0,i):0===o.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(a.bufferSubData(e,o.offset*i.BYTES_PER_ELEMENT,i.subarray(o.offset,o.offset+o.count)),o.count=-1),r.version=t.version}}}}function i(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._order=n||i.DefaultOrder}function o(){this.mask=1}function l(){Object.defineProperty(this,"id",{value:wa++}),this.uuid=po.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=l.DefaultUp.clone();var t=new St,e=new i,r=new s,n=new St(1,1,1);e.onChange(function(){r.setFromEuler(e,!1)}),r.onChange(function(){e.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new wt},normalMatrix:{value:new g}}),this.matrix=new wt,this.matrixWorld=new wt,this.matrixAutoUpdate=l.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new o,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function u(){l.call(this),this.type="Camera",this.matrixWorldInverse=new wt,this.projectionMatrix=new wt}function f(t,e,r,n,i,o){u.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=r,this.bottom=n,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function S(t,e,r,n,i,o){this.a=t,this.b=e,this.c=r,this.normal=n&&n.isVector3?n:new St,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new w,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}function E(){Object.defineProperty(this,"id",{value:Aa+=2}),this.uuid=po.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function v(t,e,r){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function c(t,e,r){v.call(this,new Int8Array(t),e,r)}function h(t,e,r){v.call(this,new Uint8Array(t),e,r)}function d(t,e,r){v.call(this,new Uint8ClampedArray(t),e,r)}function m(t,e,r){v.call(this,new Int16Array(t),e,r)}function _(t,e,r){v.call(this,new Uint16Array(t),e,r)}function b(t,e,r){v.call(this,new Int32Array(t),e,r)}function x(t,e,r){v.call(this,new Uint32Array(t),e,r)}function O(t,e,r){v.call(this,new Float32Array(t),e,r)}function C(t,e,r){v.call(this,new Float64Array(t),e,r)}function M(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function P(t){if(0===t.length)return-1/0;for(var e=t[0],r=1,n=t.length;r<n;++r)t[r]>e&&(e=t[r]);return e}function A(){Object.defineProperty(this,"id",{value:Ua+=2}),this.uuid=po.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.drawRange={start:0,count:1/0},this.userData={}}function I(t,e,r,n,i,o){E.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new L(t,e,r,n,i,o)),this.mergeVertices()}function L(t,e,r,n,i,o){function a(t,e,r,n,i,o,a,s,u,c,l){var h=o/u,p=a/c,f=o/2,d=a/2,m=s/2;a=u+1;var g,y,v=c+1,_=o=0,b=new St;for(y=0;y<v;y++){var x=y*p-d;for(g=0;g<a;g++)b[t]=(g*h-f)*n,b[e]=x*i,b[r]=m,E.push(b.x,b.y,b.z),b[t]=0,b[e]=0,b[r]=0<s?1:-1,C.push(b.x,b.y,b.z),M.push(g/u),M.push(1-y/c),o+=1}for(y=0;y<c;y++)for(g=0;g<u;g++)t=T+g+a*(y+1),e=T+(g+1)+a*(y+1),r=T+(g+1)+a*y,S.push(T+g+a*y,t,r),S.push(t,e,r),_+=6;w.addGroup(P,_,l),P+=_,T+=o}A.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};var w=this;t=t||1,e=e||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1,o=Math.floor(o)||1;var S=[],E=[],C=[],M=[],T=0,P=0;a("z","y","x",-1,-1,r,e,t,o,i,0),a("z","y","x",1,-1,r,e,-t,o,i,1),a("x","z","y",1,1,t,r,e,n,o,2),a("x","z","y",1,-1,t,r,-e,n,o,3),a("x","y","z",1,-1,t,e,r,n,i,4),a("x","y","z",-1,-1,t,e,-r,n,i,5),this.setIndex(S),this.addAttribute("position",new O(E,3)),this.addAttribute("normal",new O(C,3)),this.addAttribute("uv",new O(M,2))}function R(t,e,r,n){E.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new N(t,e,r,n)),this.mergeVertices()}function N(t,e,r,n){A.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n};var i=(t=t||1)/2,o=(e=e||1)/2,a=(r=Math.floor(r)||1)+1,s=(n=Math.floor(n)||1)+1,u=t/r,c=e/n,l=[],h=[],p=[],f=[];for(t=0;t<s;t++){var d=t*c-o;for(e=0;e<a;e++)h.push(e*u-i,-d,0),p.push(0,0,1),f.push(e/r),f.push(1-t/n)}for(t=0;t<n;t++)for(e=0;e<r;e++)i=e+a*(t+1),o=e+1+a*(t+1),s=e+1+a*t,l.push(e+a*t,i,s),l.push(i,o,s);this.setIndex(l),this.addAttribute("position",new O(h,3)),this.addAttribute("normal",new O(p,3)),this.addAttribute("uv",new O(f,2))}function k(){Object.defineProperty(this,"id",{value:Ts++}),this.uuid=po.generateUUID(),this.name="",this.type="Material",this.lights=this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null,this.depthFunc=3,this.depthWrite=this.depthTest=!0,this.clippingPlanes=null,this.clipShadows=this.clipIntersection=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function D(t){k.call(this),this.type="MeshBasicMaterial",this.color=new w(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.lights=this.morphTargets=this.skinning=!1,this.setValues(t)}function j(t){k.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function z(t,e){this.origin=void 0!==t?t:new St,this.direction=void 0!==e?e:new St}function F(t,e,r){this.a=void 0!==t?t:new St,this.b=void 0!==e?e:new St,this.c=void 0!==r?r:new St}function B(t,e){l.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new A,this.material=void 0!==e?e:new D({color:16777215*Math.random()}),this.drawMode=0,this.updateMorphTargets()}function Ot(i,r,o,n){function a(t,e){r.buffers.color.setClear(t.r,t.g,t.b,e,n)}var s,u,c,l=new w(0),h=0;return{getClearColor:function(){return l},setClearColor:function(t,e){l.set(t),a(l,h=void 0!==e?e:1)},getClearAlpha:function(){return h},setClearAlpha:function(t){a(l,h=t)},render:function(t,e,r,n){null===(e=e.background)?a(l,h):e&&e.isColor&&(a(e,1),n=!0),(i.autoClear||n)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),e&&e.isCubeTexture?(void 0===c&&((c=new B(new L(1,1,1),new j({uniforms:na.cube.uniforms,vertexShader:na.cube.vertexShader,fragmentShader:na.cube.fragmentShader,side:1,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),c.geometry.removeAttribute("uv"),c.onBeforeRender=function(t,e,r){this.matrixWorld.copyPosition(r.matrixWorld)},o.update(c)),c.material.uniforms.tCube.value=e,t.push(c,c.geometry,c.material,0,null)):e&&e.isTexture&&(void 0===s&&(s=new f(-1,1,1,-1,0,1),u=new B(new N(2,2),new D({depthTest:!1,depthWrite:!1,fog:!1})),o.update(u)),u.material.map=e,i.renderBufferDirect(s,null,u.geometry,u.material,u,null))}}}function At(i,o,a,s){var u;this.setMode=function(t){u=t},this.render=function(t,e){i.drawArrays(u,t,e),a.update(e,u)},this.renderInstances=function(t,e,r){if(s.isWebGL2)var n=i;else if(null===(n=o.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");n[s.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](u,e,r,t.maxInstancedCount),a.update(r,u,t.maxInstancedCount)}}function It(e,r,t){function n(t){if("highp"===t){if(0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision)return"highp";t="mediump"}return"mediump"===t&&0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision?"mediump":"lowp"}var i,o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,a=void 0!==t.precision?t.precision:"highp",s=n(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s),t=!0===t.logarithmicDepthBuffer,s=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);var u=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_TEXTURE_SIZE),l=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),h=e.getParameter(e.MAX_VERTEX_ATTRIBS),p=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),f=e.getParameter(e.MAX_VARYING_VECTORS),d=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),m=0<u,g=o||!!r.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==i)return i;var t=r.get("EXT_texture_filter_anisotropic");return i=null!==t?e.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:a,logarithmicDepthBuffer:t,maxTextures:s,maxVertexTextures:u,maxTextureSize:c,maxCubemapSize:l,maxAttributes:h,maxVertexUniforms:p,maxVaryings:f,maxFragmentUniforms:d,vertexTextures:m,floatFragmentTextures:g,floatVertexTextures:m&&g}}function Lt(){function u(){m.value!==l&&(m.value=l,m.needsUpdate=0<h),a.numPlanes=h,a.numIntersection=0}function c(t,e,r,n){var i=null!==t?t.length:0,o=null;if(0!==i){if(o=m.value,!0!==n||null===o)for(n=r+4*i,e=e.matrixWorldInverse,d.getNormalMatrix(e),(null===o||o.length<n)&&(o=new Float32Array(n)),n=0;n!==i;++n,r+=4)s.copy(t[n]).applyMatrix4(e,d),s.normal.toArray(o,r),o[r+3]=s.constant;m.value=o,m.needsUpdate=!0}return a.numPlanes=i,o}var a=this,l=null,h=0,p=!1,f=!1,s=new y,d=new g,m={value:null,needsUpdate:!1};this.uniform=m,this.numIntersection=this.numPlanes=0,this.init=function(t,e,r){var n=0!==t.length||e||0!==h||p;return p=e,l=c(t,r,0),h=t.length,n},this.beginShadows=function(){f=!0,c(null)},this.endShadows=function(){f=!1,u()},this.setState=function(t,e,r,n,i,o){if(!p||null===t||0===t.length||f&&!r)f?c(null):u();else{var a=4*(r=f?0:h),s=i.clippingState||null;for(m.value=s,s=c(t,n,a,o),t=0;t!==a;++t)s[t]=l[t];i.clippingState=s,this.numIntersection=e?this.numPlanes:0,this.numPlanes+=r}}}function Rt(r){var n={};return{get:function(t){if(void 0!==n[t])return n[t];switch(t){case"WEBGL_depth_texture":var e=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":e=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":e=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":e=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:e=r.getExtension(t)}return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),n[t]=e}}}function Nt(u,c,n){function i(t){var e=t.target;for(var r in null!==(t=o[e.id]).index&&c.remove(t.index),t.attributes)c.remove(t.attributes[r]);e.removeEventListener("dispose",i),delete o[e.id],(r=l[t.id])&&(c.remove(r),delete l[t.id]),n.memory.geometries--}var o={},l={};return{get:function(t,e){var r=o[e.id];return r||(e.addEventListener("dispose",i),e.isBufferGeometry?r=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new A).setFromObject(t)),r=e._bufferGeometry),o[e.id]=r,n.memory.geometries++,r)},update:function(t){var e=t.index,r=t.attributes;for(var n in null!==e&&c.update(e,u.ELEMENT_ARRAY_BUFFER),r)c.update(r[n],u.ARRAY_BUFFER);for(n in t=t.morphAttributes){r=0;for(var i=(e=t[n]).length;r<i;r++)c.update(e[r],u.ARRAY_BUFFER)}},getWireframeAttribute:function(t){var e=l[t.id];if(e)return e;e=[];var r=t.index,n=t.attributes;if(null!==r){n=0;for(var i=(r=r.array).length;n<i;n+=3){var o=r[n+0],a=r[n+1],s=r[n+2];e.push(o,a,a,s,s,o)}}else for(r=n.position.array,n=0,i=r.length/3-1;n<i;n+=3)o=n+0,a=n+1,s=n+2,e.push(o,a,a,s,s,o);return e=new(65535<P(e)?x:_)(e,1),c.update(e,u.ELEMENT_ARRAY_BUFFER),l[t.id]=e}}}function kt(i,o,a,s){var u,c,l;this.setMode=function(t){u=t},this.setIndex=function(t){c=t.type,l=t.bytesPerElement},this.render=function(t,e){i.drawElements(u,e,c,t*l),a.update(e,u)},this.renderInstances=function(t,e,r){if(s.isWebGL2)var n=i;else if(null===(n=o.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");n[s.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](u,r,c,e*l,t.maxInstancedCount),a.update(r,u,t.maxInstancedCount)}}function Dt(n){var i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function(t,e,r){switch(r=r||1,i.calls++,e){case n.TRIANGLES:i.triangles+=t/3*r;break;case n.TRIANGLE_STRIP:case n.TRIANGLE_FAN:i.triangles+=r*(t-2);break;case n.LINES:i.lines+=t/2*r;break;case n.LINE_STRIP:i.lines+=r*(t-1);break;case n.LINE_LOOP:i.lines+=r*t;break;case n.POINTS:i.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",e)}}}}function U(t,e){return Math.abs(e[1])-Math.abs(t[1])}function jt(c){var l={},h=new Float32Array(8);return{update:function(t,e,r,n){var i=t.morphTargetInfluences,o=i.length;if(void 0===(t=l[e.id])){t=[];for(var a=0;a<o;a++)t[a]=[a,0];l[e.id]=t}var s=r.morphTargets&&e.morphAttributes.position;for(r=r.morphNormals&&e.morphAttributes.normal,a=0;a<o;a++){var u=t[a];0!==u[1]&&(s&&e.removeAttribute("morphTarget"+a),r&&e.removeAttribute("morphNormal"+a))}for(a=0;a<o;a++)(u=t[a])[0]=a,u[1]=i[a];for(t.sort(U),a=0;a<8;a++)(u=t[a])&&(i=u[0],o=u[1])?(s&&e.addAttribute("morphTarget"+a,s[i]),r&&e.addAttribute("morphNormal"+a,r[i]),h[a]=o):h[a]=0;n.getUniforms().setValue(c,"morphTargetInfluences",h)}}}function zt(i,o){var a={};return{update:function(t){var e=o.render.frame,r=t.geometry,n=i.get(t,r);return a[n.id]!==e&&(r.isGeometry&&n.updateFromObject(t),i.update(n),a[n.id]=e),n},dispose:function(){a={}}}}function V(t,e,r,n,i,o,a,s,u,c){p.call(this,t=void 0!==t?t:[],void 0!==e?e:301,r,n,i,o,a,s,u,c),this.flipY=!1}function G(t,e,r){var n=t[0];if(n<=0||0<n)return t;var i=e*r,o=Rs[i];if(void 0===o&&(o=new Float32Array(i),Rs[i]=o),0!==e)for(n.toArray(o,0),n=1,i=0;n!==e;++n)i+=r,t[n].toArray(o,i);return o}function q(t,e){if(t.length!==e.length)return!1;for(var r=0,n=t.length;r<n;r++)if(t[r]!==e[r])return!1;return!0}function $(t,e){for(var r=0,n=e.length;r<n;r++)t[r]=e[r]}function W(t,e){var r=Ns[e];void 0===r&&(r=new Int32Array(e),Ns[e]=r);for(var n=0;n!==e;++n)r[n]=t.allocTextureUnit();return r}function X(t,e){var r=this.cache;r[0]!==e&&(t.uniform1f(this.addr,e),r[0]=e)}function Y(t,e){var r=this.cache;r[0]!==e&&(t.uniform1i(this.addr,e),r[0]=e)}function Z(t,e){var r=this.cache;void 0!==e.x?r[0]===e.x&&r[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),r[0]=e.x,r[1]=e.y):q(r,e)||(t.uniform2fv(this.addr,e),$(r,e))}function K(t,e){var r=this.cache;void 0!==e.x?r[0]===e.x&&r[1]===e.y&&r[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),r[0]=e.x,r[1]=e.y,r[2]=e.z):void 0!==e.r?r[0]===e.r&&r[1]===e.g&&r[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),r[0]=e.r,r[1]=e.g,r[2]=e.b):q(r,e)||(t.uniform3fv(this.addr,e),$(r,e))}function J(t,e){var r=this.cache;void 0!==e.x?r[0]===e.x&&r[1]===e.y&&r[2]===e.z&&r[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=e.w):q(r,e)||(t.uniform4fv(this.addr,e),$(r,e))}function Q(t,e){var r=this.cache,n=e.elements;void 0===n?q(r,e)||(t.uniformMatrix2fv(this.addr,!1,e),$(r,e)):q(r,n)||(js.set(n),t.uniformMatrix2fv(this.addr,!1,js),$(r,n))}function tt(t,e){var r=this.cache,n=e.elements;void 0===n?q(r,e)||(t.uniformMatrix3fv(this.addr,!1,e),$(r,e)):q(r,n)||(Ds.set(n),t.uniformMatrix3fv(this.addr,!1,Ds),$(r,n))}function et(t,e){var r=this.cache,n=e.elements;void 0===n?q(r,e)||(t.uniformMatrix4fv(this.addr,!1,e),$(r,e)):q(r,n)||(ks.set(n),t.uniformMatrix4fv(this.addr,!1,ks),$(r,n))}function rt(t,e,r){var n=this.cache,i=r.allocTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.setTexture2D(e||Is,i)}function nt(t,e,r){var n=this.cache,i=r.allocTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.setTextureCube(e||Ls,i)}function it(t,e){var r=this.cache;q(r,e)||(t.uniform2iv(this.addr,e),$(r,e))}function ot(t,e){var r=this.cache;q(r,e)||(t.uniform3iv(this.addr,e),$(r,e))}function at(t,e){var r=this.cache;q(r,e)||(t.uniform4iv(this.addr,e),$(r,e))}function st(t,e){var r=this.cache;q(r,e)||(t.uniform1fv(this.addr,e),$(r,e))}function ut(t,e){var r=this.cache;q(r,e)||(t.uniform1iv(this.addr,e),$(r,e))}function ct(t,e){q(this.cache,e=G(e,this.size,2))||(t.uniform2fv(this.addr,e),this.updateCache(e))}function lt(t,e){q(this.cache,e=G(e,this.size,3))||(t.uniform3fv(this.addr,e),this.updateCache(e))}function ht(t,e){q(this.cache,e=G(e,this.size,4))||(t.uniform4fv(this.addr,e),this.updateCache(e))}function pt(t,e){q(this.cache,e=G(e,this.size,4))||(t.uniformMatrix2fv(this.addr,!1,e),this.updateCache(e))}function ft(t,e){q(this.cache,e=G(e,this.size,9))||(t.uniformMatrix3fv(this.addr,!1,e),this.updateCache(e))}function dt(t,e){q(this.cache,e=G(e,this.size,16))||(t.uniformMatrix4fv(this.addr,!1,e),this.updateCache(e))}function mt(t,e,r){var n=this.cache,i=e.length,o=W(r,i);for(!1===q(n,o)&&(t.uniform1iv(this.addr,o),$(n,o)),t=0;t!==i;++t)r.setTexture2D(e[t]||Is,o[t])}function gt(t,e,r){var n=this.cache,i=e.length,o=W(r,i);for(!1===q(n,o)&&(t.uniform1iv(this.addr,o),$(n,o)),t=0;t!==i;++t)r.setTextureCube(e[t]||Ls,o[t])}function yt(t,e,r){this.id=t,this.addr=r,this.cache=[],this.setValue=function(t){switch(t){case 5126:return X;case 35664:return Z;case 35665:return K;case 35666:return J;case 35674:return Q;case 35675:return tt;case 35676:return et;case 35678:case 36198:return rt;case 35680:return nt;case 5124:case 35670:return Y;case 35667:case 35671:return it;case 35668:case 35672:return ot;case 35669:case 35673:return at}}(e.type)}function vt(t,e,r){this.id=t,this.addr=r,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return st;case 35664:return ct;case 35665:return lt;case 35666:return ht;case 35674:return pt;case 35675:return ft;case 35676:return dt;case 35678:return mt;case 35680:return gt;case 5124:case 35670:return ut;case 35667:case 35671:return it;case 35668:case 35672:return ot;case 35669:case 35673:return at}}(e.type)}function _t(t){this.id=t,this.seq=[],this.map={}}function Ft(t,e,r){this.seq=[],this.map={},this.renderer=r,r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(var n=0;n<r;++n){var i=t.getActiveUniform(e,n),o=t.getUniformLocation(e,i.name),a=this,s=i.name,u=s.length;for(zs.lastIndex=0;;){var c=zs.exec(s),l=zs.lastIndex,h=c[1],p=c[3];if("]"===c[2]&&(h|=0),void 0===p||"["===p&&l+2===u){s=a,i=void 0===p?new yt(h,i,o):new vt(h,i,o),s.seq.push(i),s.map[i.id]=i;break}void 0===(p=a.map[h])&&(p=new _t(h),h=a,a=p,h.seq.push(a),h.map[a.id]=a),a=p}}}function bt(t,e,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),!1===t.getShaderParameter(n,t.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(n),function(t){t=t.split("\n");for(var e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(r)),n}function xt(t){switch(t){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+t)}}function Bt(t,e){return"vec4 "+t+"( vec4 value ) { return "+(e=xt(e))[0]+"ToLinear"+e[1]+"; }"}function Ut(t){return""!==t}function Vt(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function Gt(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}function qt(t){return t.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(t,e){if(void 0===(t=Xo[e]))throw Error("Can not resolve #include <"+e+">");return qt(t)})}function Ht(t){return t.replace(/#pragma unroll_loop[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(t,e,r,n){for(t="",e=parseInt(e);e<parseInt(r);e++)t+=n.replace(/\[ i \]/g,"[ "+e+" ]");return t})}function $t(t,e,r,n,i,o,a){var s=t.context,u=n.defines,c=i.vertexShader,l=i.fragmentShader,h="SHADOWMAP_TYPE_BASIC";1===o.shadowMapType?h="SHADOWMAP_TYPE_PCF":2===o.shadowMapType&&(h="SHADOWMAP_TYPE_PCF_SOFT");var p="ENVMAP_TYPE_CUBE",f="ENVMAP_MODE_REFLECTION",d="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(n.envMap.mapping){case 301:case 302:p="ENVMAP_TYPE_CUBE";break;case 306:case 307:p="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:p="ENVMAP_TYPE_EQUIREC";break;case 305:p="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case 302:case 304:f="ENVMAP_MODE_REFRACTION"}switch(n.combine){case 0:d="ENVMAP_BLENDING_MULTIPLY";break;case 1:d="ENVMAP_BLENDING_MIX";break;case 2:d="ENVMAP_BLENDING_ADD"}}var m,g,y=0<t.gammaFactor?t.gammaFactor:1,v=a.isWebGL2?"":function(t,e,r){return[(t=t||{}).derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap&&!e.objectSpaceNormalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ut).join("\n")}(n.extensions,o,e),_=function(t){var e,r=[];for(e in t){var n=t[e];!1!==n&&r.push("#define "+e+" "+n)}return r.join("\n")}(u),b=s.createProgram();return n.isRawShaderMaterial?(0<(u=[_].filter(Ut).join("\n")).length&&(u+="\n"),0<(e=[v,_].filter(Ut).join("\n")).length&&(e+="\n")):(u=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,_,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+y,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+f:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+h:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||e.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ut).join("\n"),e=[v,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,_,o.alphaTest?"#define ALPHATEST "+o.alphaTest+(o.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+y,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+p:"",o.envMap?"#define "+f:"",o.envMap?"#define "+d:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+h:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||e.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&(a.isWebGL2||e.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==o.toneMapping?"#define TONE_MAPPING":"",0!==o.toneMapping?Xo.tonemapping_pars_fragment:"",0!==o.toneMapping?function(t,e){switch(e){case 1:e="Linear";break;case 2:e="Reinhard";break;case 3:e="Uncharted2";break;case 4:e="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.envMapEncoding||o.emissiveMapEncoding?Xo.encodings_pars_fragment:"",o.mapEncoding?Bt("mapTexelToLinear",o.mapEncoding):"",o.envMapEncoding?Bt("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?Bt("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?function(t,e){return"vec4 "+t+"( vec4 value ) { return LinearTo"+(e=xt(e))[0]+e[1]+"; }"}("linearToOutputTexel",o.outputEncoding):"",o.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Ut).join("\n")),c=Gt(c=Vt(c=qt(c),o),o),l=Gt(l=Vt(l=qt(l),o),o),c=Ht(c),l=Ht(l),a.isWebGL2&&!n.isRawShaderMaterial&&(a=!1,h=/^\s*#version\s+300\s+es\s*\n/,n.isShaderMaterial&&null!==c.match(h)&&null!==l.match(h)&&(a=!0,c=c.replace(h,""),l=l.replace(h,"")),u="#version 300 es\n\n#define attribute in\n#define varying out\n#define texture2D texture\n"+u,e=["#version 300 es\n\n#define varying in",a?"":"out highp vec4 pc_fragColor;",a?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+e),l=e+l,c=bt(s,s.VERTEX_SHADER,u+c),l=bt(s,s.FRAGMENT_SHADER,l),s.attachShader(b,c),s.attachShader(b,l),void 0!==n.index0AttributeName?s.bindAttribLocation(b,0,n.index0AttributeName):!0===o.morphTargets&&s.bindAttribLocation(b,0,"position"),s.linkProgram(b),o=s.getProgramInfoLog(b).trim(),a=s.getShaderInfoLog(c).trim(),h=s.getShaderInfoLog(l).trim(),f=p=!0,!1===s.getProgramParameter(b,s.LINK_STATUS)?(p=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(b,s.VALIDATE_STATUS),"gl.getProgramInfoLog",o,a,h)):""!==o?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",o):""!==a&&""!==h||(f=!1),f&&(this.diagnostics={runnable:p,material:n,programLog:o,vertexShader:{log:a,prefix:u},fragmentShader:{log:h,prefix:e}}),s.deleteShader(c),s.deleteShader(l),this.getUniforms=function(){return void 0===m&&(m=new Ft(s,b,t)),m},this.getAttributes=function(){if(void 0===g){for(var t={},e=s.getProgramParameter(b,s.ACTIVE_ATTRIBUTES),r=0;r<e;r++){var n=s.getActiveAttrib(b,r).name;t[n]=s.getAttribLocation(b,n)}g=t}return g},this.destroy=function(){s.deleteProgram(b),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=i.name,this.id=lu++,this.code=r,this.usedTimes=1,this.program=b,this.vertexShader=c,this.fragmentShader=l,this}function Wt(h,u,p){function f(t,e){if(t)t.isTexture?r=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=t.texture.encoding);else var r=3e3;return 3e3===r&&e&&(r=3007),r}var c=[],d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},i="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap objectSpaceNormalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking dithering".split(" ");this.getParameters=function(t,e,r,n,i,o,a){var s=d[t.type];if(a.isSkinnedMesh){var u=a.skeleton.bones;if(p.floatVertexTextures)u=1024;else{var c=Math.min(Math.floor((p.maxVertexUniforms-20)/4),u.length);u=c<u.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+u.length+" bones. This GPU supports "+c+"."),0):c}}else u=0;c=p.precision,null===t.precision||(c=p.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",c,"instead.");var l=h.getRenderTarget();return{shaderID:s,precision:c,supportsVertexTextures:p.vertexTextures,outputEncoding:f(l?l.texture:null,h.gammaOutput),map:!!t.map,mapEncoding:f(t.map,h.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:f(t.envMap,h.gammaInput),envMapCubeUV:!!t.envMap&&(306===t.envMap.mapping||307===t.envMap.mapping),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:f(t.emissiveMap,h.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:1===t.normalMapType,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!n,useFog:t.fog,fogExp:n&&n.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:p.logarithmicDepthBuffer,skinning:t.skinning&&0<u,maxBones:u,useVertexTexture:p.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:h.maxMorphTargets,maxMorphNormals:h.maxMorphNormals,numDirLights:e.directional.length,numPointLights:e.point.length,numSpotLights:e.spot.length,numRectAreaLights:e.rectArea.length,numHemiLights:e.hemi.length,numClippingPlanes:i,numClipIntersection:o,dithering:t.dithering,shadowMapEnabled:h.shadowMap.enabled&&a.receiveShadow&&0<r.length,shadowMapType:h.shadowMap.type,toneMapping:h.toneMapping,physicallyCorrectLights:h.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:2===t.side,flipSided:1===t.side,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,e){var r=[];if(e.shaderID?r.push(e.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var n in t.defines)r.push(n),r.push(t.defines[n]);for(n=0;n<i.length;n++)r.push(e[i[n]]);return r.push(t.onBeforeCompile.toString()),r.push(h.gammaOutput),r.join()},this.acquireProgram=function(t,e,r,n){for(var i,o=0,a=c.length;o<a;o++){var s=c[o];if(s.code===n){++(i=s).usedTimes;break}}return void 0===i&&(i=new $t(h,u,n,t,e,r,p),c.push(i)),i},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=c.indexOf(t);c[e]=c[c.length-1],c.pop(),t.destroy()}},this.programs=c}function Xt(){var n=new WeakMap;return{get:function(t){var e=n.get(t);return void 0===e&&(e={},n.set(t,e)),e},remove:function(t){n.delete(t)},update:function(t,e,r){n.get(t)[e]=r},dispose:function(){n=new WeakMap}}}function Yt(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program&&e.program&&t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Zt(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Kt(){var a=[],s=0,u=[],c=[];return{opaque:u,transparent:c,init:function(){s=0,u.length=0,c.length=0},push:function(t,e,r,n,i){var o=a[s];void 0===o?(o={id:t.id,object:t,geometry:e,material:r,program:r.program,renderOrder:t.renderOrder,z:n,group:i},a[s]=o):(o.id=t.id,o.object=t,o.geometry=e,o.material=r,o.program=r.program,o.renderOrder=t.renderOrder,o.z=n,o.group=i),(!0===r.transparent?c:u).push(o),s++},sort:function(){1<u.length&&u.sort(Yt),1<c.length&&c.sort(Zt)}}}function Jt(){var r={};return{get:function(t,e){return t=t.id+","+e.id,void 0===(e=r[t])&&(e=new Kt,r[t]=e),e},dispose:function(){r={}}}}function Qt(){var r={};return{get:function(t){if(void 0!==r[t.id])return r[t.id];switch(t.type){case"DirectionalLight":var e={direction:new St,color:new w,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new H};break;case"SpotLight":e={position:new St,direction:new St,color:new w,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new H};break;case"PointLight":e={position:new St,color:new w,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new H,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":e={direction:new St,skyColor:new w,groundColor:new w};break;case"RectAreaLight":e={color:new w,position:new St,halfWidth:new St,halfHeight:new St}}return r[t.id]=e}}}function te(){var _=new Qt,b={id:hu++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},x=new St,w=new wt,S=new wt;return{setup:function(t,e,r){var n=0,i=0,o=0,a=0,s=0,u=0,c=0,l=0;r=r.matrixWorldInverse;for(var h=0,p=t.length;h<p;h++){var f=t[h],d=f.color,m=f.intensity,g=f.distance,y=f.shadow&&f.shadow.map?f.shadow.map.texture:null;if(f.isAmbientLight)n+=d.r*m,i+=d.g*m,o+=d.b*m;else if(f.isDirectionalLight){var v=_.get(f);v.color.copy(f.color).multiplyScalar(f.intensity),v.direction.setFromMatrixPosition(f.matrixWorld),x.setFromMatrixPosition(f.target.matrixWorld),v.direction.sub(x),v.direction.transformDirection(r),(v.shadow=f.castShadow)&&(d=f.shadow,v.shadowBias=d.bias,v.shadowRadius=d.radius,v.shadowMapSize=d.mapSize),b.directionalShadowMap[a]=y,b.directionalShadowMatrix[a]=f.shadow.matrix,b.directional[a]=v,a++}else f.isSpotLight?((v=_.get(f)).position.setFromMatrixPosition(f.matrixWorld),v.position.applyMatrix4(r),v.color.copy(d).multiplyScalar(m),v.distance=g,v.direction.setFromMatrixPosition(f.matrixWorld),x.setFromMatrixPosition(f.target.matrixWorld),v.direction.sub(x),v.direction.transformDirection(r),v.coneCos=Math.cos(f.angle),v.penumbraCos=Math.cos(f.angle*(1-f.penumbra)),v.decay=0===f.distance?0:f.decay,(v.shadow=f.castShadow)&&(d=f.shadow,v.shadowBias=d.bias,v.shadowRadius=d.radius,v.shadowMapSize=d.mapSize),b.spotShadowMap[u]=y,b.spotShadowMatrix[u]=f.shadow.matrix,b.spot[u]=v,u++):f.isRectAreaLight?((v=_.get(f)).color.copy(d).multiplyScalar(m),v.position.setFromMatrixPosition(f.matrixWorld),v.position.applyMatrix4(r),S.identity(),w.copy(f.matrixWorld),w.premultiply(r),S.extractRotation(w),v.halfWidth.set(.5*f.width,0,0),v.halfHeight.set(0,.5*f.height,0),v.halfWidth.applyMatrix4(S),v.halfHeight.applyMatrix4(S),b.rectArea[c]=v,c++):f.isPointLight?((v=_.get(f)).position.setFromMatrixPosition(f.matrixWorld),v.position.applyMatrix4(r),v.color.copy(f.color).multiplyScalar(f.intensity),v.distance=f.distance,v.decay=0===f.distance?0:f.decay,(v.shadow=f.castShadow)&&(d=f.shadow,v.shadowBias=d.bias,v.shadowRadius=d.radius,v.shadowMapSize=d.mapSize,v.shadowCameraNear=d.camera.near,v.shadowCameraFar=d.camera.far),b.pointShadowMap[s]=y,b.pointShadowMatrix[s]=f.shadow.matrix,b.point[s]=v,s++):f.isHemisphereLight&&((v=_.get(f)).direction.setFromMatrixPosition(f.matrixWorld),v.direction.transformDirection(r),v.direction.normalize(),v.skyColor.copy(f.color).multiplyScalar(m),v.groundColor.copy(f.groundColor).multiplyScalar(m),b.hemi[l]=v,l++)}b.ambient[0]=n,b.ambient[1]=i,b.ambient[2]=o,b.directional.length=a,b.spot.length=u,b.rectArea.length=c,b.point.length=s,b.hemi.length=l,b.hash.stateID=b.id,b.hash.directionalLength=a,b.hash.pointLength=s,b.hash.spotLength=u,b.hash.rectAreaLength=c,b.hash.hemiLength=l,b.hash.shadowsLength=e.length},state:b}}function ee(){var e=new te,r=[],n=[];return{init:function(){r.length=0,n.length=0},state:{lightsArray:r,shadowsArray:n,lights:e},setupLights:function(t){e.setup(r,n,t)},pushLight:function(t){r.push(t)},pushShadow:function(t){n.push(t)}}}function re(){var n={};return{get:function(t,e){if(void 0===n[t.id]){var r=new ee;n[t.id]={},n[t.id][e.id]=r}else void 0===n[t.id][e.id]?(r=new ee,n[t.id][e.id]=r):r=n[t.id][e.id];return r},dispose:function(){n={}}}}function ne(t){k.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.setValues(t)}function ie(t){k.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new St,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.lights=this.fog=!1,this.setValues(t)}function oe(p,h,t){function f(t,e,r,n,i,o){var a=t.geometry,s=c,u=t.customDepthMaterial;return r&&(s=l,u=t.customDistanceMaterial),s=u||(u=!1,e.morphTargets&&(a&&a.isBufferGeometry?u=a.morphAttributes&&a.morphAttributes.position&&0<a.morphAttributes.position.length:a&&a.isGeometry&&(u=a.morphTargets&&0<a.morphTargets.length)),t.isSkinnedMesh&&!1===e.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t),a=0,u&&(a|=1),(t=t.isSkinnedMesh&&e.skinning)&&(a|=2),s[a]),p.localClippingEnabled&&!0===e.clipShadows&&0!==e.clippingPlanes.length&&(a=s.uuid,u=e.uuid,void 0===(t=x[a])&&(t={},x[a]=t),void 0===(a=t[u])&&(a=s.clone(),t[u]=a),s=a),s.visible=e.visible,s.wireframe=e.wireframe,s.side=null!=e.shadowSide?e.shadowSide:w[e.side],s.clipShadows=e.clipShadows,s.clippingPlanes=e.clippingPlanes,s.clipIntersection=e.clipIntersection,s.wireframeLinewidth=e.wireframeLinewidth,s.linewidth=e.linewidth,r&&s.isMeshDistanceMaterial&&(s.referencePosition.copy(n),s.nearDistance=i,s.farDistance=o),s}function d(t,e,r,n){if(!1!==t.visible){if(t.layers.test(e.layers)&&(t.isMesh||t.isLine||t.isPoints)&&t.castShadow&&(!t.frustumCulled||m.intersectsObject(t))){t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld);var i=h.update(t),o=t.material;if(Array.isArray(o))for(var a=i.groups,s=0,u=a.length;s<u;s++){var c=a[s],l=o[c.materialIndex];l&&l.visible&&(l=f(t,l,n,b,r.near,r.far),p.renderBufferDirect(r,null,i,l,t,c))}else o.visible&&(l=f(t,o,n,b,r.near,r.far),p.renderBufferDirect(r,null,i,l,t,null))}for(i=0,o=(t=t.children).length;i<o;i++)d(t[i],e,r,n)}}var m=new Mt,g=new wt,y=new H,v=new H(t,t),_=new St,b=new St,c=Array(4),l=Array(4),x={},w={0:1,1:0,2:2},S=[new St(1,0,0),new St(-1,0,0),new St(0,0,1),new St(0,0,-1),new St(0,1,0),new St(0,-1,0)],E=[new St(0,1,0),new St(0,1,0),new St(0,1,0),new St(0,1,0),new St(0,0,1),new St(0,0,-1)],C=[new Et,new Et,new Et,new Et,new Et,new Et];for(t=0;4!==t;++t){var e=0!=(1&t),r=0!=(2&t),n=new ne({depthPacking:3201,morphTargets:e,skinning:r});c[t]=n,e=new ie({morphTargets:e,skinning:r}),l[t]=e}var M=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,e,r){if(!1!==M.enabled&&(!1!==M.autoUpdate||!1!==M.needsUpdate)&&0!==t.length){var n=p.state;n.disable(p.context.BLEND),n.buffers.color.setClear(1,1,1,1),n.buffers.depth.setTest(!0),n.setScissorTest(!1);for(var i,o=0,a=t.length;o<a;o++){var s=t[o];i=s.shadow;var u=s&&s.isPointLight;if(void 0===i)console.warn("THREE.WebGLShadowMap:",s,"has no shadow.");else{var c=i.camera;if(y.copy(i.mapSize),y.min(v),u){var l=y.x,h=y.y;C[0].set(2*l,h,l,h),C[1].set(0,h,l,h),C[2].set(3*l,h,l,h),C[3].set(l,h,l,h),C[4].set(3*l,0,l,h),C[5].set(l,0,l,h),y.x*=4,y.y*=2}for(null===i.map&&(i.map=new T(y.x,y.y,{minFilter:1003,magFilter:1003,format:1023}),i.map.texture.name=s.name+".shadowMap",c.updateProjectionMatrix()),i.isSpotLightShadow&&i.update(s),l=i.map,h=i.matrix,b.setFromMatrixPosition(s.matrixWorld),c.position.copy(b),u?(i=6,h.makeTranslation(-b.x,-b.y,-b.z)):(i=1,_.setFromMatrixPosition(s.target.matrixWorld),c.lookAt(_),c.updateMatrixWorld(),h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(c.projectionMatrix),h.multiply(c.matrixWorldInverse)),p.setRenderTarget(l),p.clear(),s=0;s<i;s++)u&&(_.copy(c.position),_.add(S[s]),c.up.copy(E[s]),c.lookAt(_),c.updateMatrixWorld(),n.viewport(C[s])),g.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),m.setFromMatrix(g),d(e,r,c,u)}}M.needsUpdate=!1}}}function ae(l,r,u,n){function t(t,e,r){var n=new Uint8Array(4),i=l.createTexture();for(l.bindTexture(t,i),l.texParameteri(t,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(t,l.TEXTURE_MAG_FILTER,l.NEAREST),t=0;t<r;t++)l.texImage2D(e+t,0,l.RGBA,1,1,0,l.RGBA,l.UNSIGNED_BYTE,n);return i}function e(t,e){y[t]=1,0===v[t]&&(l.enableVertexAttribArray(t),v[t]=1),_[t]!==e&&((n.isWebGL2?l:r.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](t,e),_[t]=e)}function h(t){!0!==b[t]&&(l.enable(t),b[t]=!0)}function p(t){!1!==b[t]&&(l.disable(t),b[t]=!1)}function i(t,e,r,n,i,o,a,s){if(0!==t?h(l.BLEND):p(l.BLEND),5!==t){if(t!==S||s!==A)switch(t){case 2:s?(l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(l.ONE,l.ONE,l.ONE,l.ONE)):(l.blendEquation(l.FUNC_ADD),l.blendFunc(l.SRC_ALPHA,l.ONE));break;case 3:s?(l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(l.ZERO,l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ONE_MINUS_SRC_ALPHA)):(l.blendEquation(l.FUNC_ADD),l.blendFunc(l.ZERO,l.ONE_MINUS_SRC_COLOR));break;case 4:s?(l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(l.ZERO,l.SRC_COLOR,l.ZERO,l.SRC_ALPHA)):(l.blendEquation(l.FUNC_ADD),l.blendFunc(l.ZERO,l.SRC_COLOR));break;default:s?(l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(l.ONE,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA)):(l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA))}O=P=T=M=C=E=null}else i=i||e,o=o||r,a=a||n,e===E&&i===T||(l.blendEquationSeparate(u.convert(e),u.convert(i)),E=e,T=i),r===C&&n===M&&o===P&&a===O||(l.blendFuncSeparate(u.convert(r),u.convert(n),u.convert(o),u.convert(a)),C=r,M=n,P=o,O=a);S=t,A=s}function o(t){I!==t&&(t?l.frontFace(l.CW):l.frontFace(l.CCW),I=t)}function a(t){0!==t?(h(l.CULL_FACE),t!==L&&(1===t?l.cullFace(l.BACK):2===t?l.cullFace(l.FRONT):l.cullFace(l.FRONT_AND_BACK))):p(l.CULL_FACE),L=t}function s(t,e,r){t?(h(l.POLYGON_OFFSET_FILL),N===e&&k===r||(l.polygonOffset(e,r),N=e,k=r)):p(l.POLYGON_OFFSET_FILL)}function c(t){void 0===t&&(t=l.TEXTURE0+D-1),z!==t&&(l.activeTexture(t),z=t)}var f=new function(){var e=!1,o=new Et,r=null,a=new Et(0,0,0,0);return{setMask:function(t){r===t||e||(l.colorMask(t,t,t,t),r=t)},setLocked:function(t){e=t},setClear:function(t,e,r,n,i){!0===i&&(t*=n,e*=n,r*=n),o.set(t,e,r,n),!1===a.equals(o)&&(l.clearColor(t,e,r,n),a.copy(o))},reset:function(){e=!1,r=null,a.set(-1,0,0,0)}}},d=new function(){var e=!1,r=null,n=null,i=null;return{setTest:function(t){t?h(l.DEPTH_TEST):p(l.DEPTH_TEST)},setMask:function(t){r===t||e||(l.depthMask(t),r=t)},setFunc:function(t){if(n!==t){if(t)switch(t){case 0:l.depthFunc(l.NEVER);break;case 1:l.depthFunc(l.ALWAYS);break;case 2:l.depthFunc(l.LESS);break;case 3:l.depthFunc(l.LEQUAL);break;case 4:l.depthFunc(l.EQUAL);break;case 5:l.depthFunc(l.GEQUAL);break;case 6:l.depthFunc(l.GREATER);break;case 7:l.depthFunc(l.NOTEQUAL);break;default:l.depthFunc(l.LEQUAL)}else l.depthFunc(l.LEQUAL);n=t}},setLocked:function(t){e=t},setClear:function(t){i!==t&&(l.clearDepth(t),i=t)},reset:function(){e=!1,i=n=r=null}}},m=new function(){var e=!1,r=null,n=null,i=null,o=null,a=null,s=null,u=null,c=null;return{setTest:function(t){t?h(l.STENCIL_TEST):p(l.STENCIL_TEST)},setMask:function(t){r===t||e||(l.stencilMask(t),r=t)},setFunc:function(t,e,r){n===t&&i===e&&o===r||(l.stencilFunc(t,e,r),n=t,i=e,o=r)},setOp:function(t,e,r){a===t&&s===e&&u===r||(l.stencilOp(t,e,r),a=t,s=e,u=r)},setLocked:function(t){e=t},setClear:function(t){c!==t&&(l.clearStencil(t),c=t)},reset:function(){e=!1,c=u=s=a=o=i=n=r=null}}},g=l.getParameter(l.MAX_VERTEX_ATTRIBS),y=new Uint8Array(g),v=new Uint8Array(g),_=new Uint8Array(g),b={},x=null,w=null,S=null,E=null,C=null,M=null,T=null,P=null,O=null,A=!1,I=null,L=null,R=null,N=null,k=null,D=l.getParameter(l.MAX_COMBINED_TEXTURE_IMAGE_UNITS),j=!1;g=0,-1!==(g=l.getParameter(l.VERSION)).indexOf("WebGL")?(g=parseFloat(/^WebGL ([0-9])/.exec(g)[1]),j=1<=g):-1!==g.indexOf("OpenGL ES")&&(g=parseFloat(/^OpenGL ES ([0-9])/.exec(g)[1]),j=2<=g);var z=null,F={},B=new Et,U=new Et,V={};return V[l.TEXTURE_2D]=t(l.TEXTURE_2D,l.TEXTURE_2D,1),V[l.TEXTURE_CUBE_MAP]=t(l.TEXTURE_CUBE_MAP,l.TEXTURE_CUBE_MAP_POSITIVE_X,6),f.setClear(0,0,0,1),d.setClear(1),m.setClear(0),h(l.DEPTH_TEST),d.setFunc(3),o(!1),a(1),h(l.CULL_FACE),h(l.BLEND),i(1),{buffers:{color:f,depth:d,stencil:m},initAttributes:function(){for(var t=0,e=y.length;t<e;t++)y[t]=0},enableAttribute:function(t){e(t,0)},enableAttributeAndDivisor:e,disableUnusedAttributes:function(){for(var t=0,e=v.length;t!==e;++t)v[t]!==y[t]&&(l.disableVertexAttribArray(t),v[t]=0)},enable:h,disable:p,getCompressedTextureFormats:function(){if(null===x&&(x=[],r.get("WEBGL_compressed_texture_pvrtc")||r.get("WEBGL_compressed_texture_s3tc")||r.get("WEBGL_compressed_texture_etc1")||r.get("WEBGL_compressed_texture_astc")))for(var t=l.getParameter(l.COMPRESSED_TEXTURE_FORMATS),e=0;e<t.length;e++)x.push(t[e]);return x},useProgram:function(t){return w!==t&&(l.useProgram(t),w=t,!0)},setBlending:i,setMaterial:function(t,e){2===t.side?p(l.CULL_FACE):h(l.CULL_FACE);var r=1===t.side;e&&(r=!r),o(r),1===t.blending&&!1===t.transparent?i(0):i(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),d.setFunc(t.depthFunc),d.setTest(t.depthTest),d.setMask(t.depthWrite),f.setMask(t.colorWrite),s(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:o,setCullFace:a,setLineWidth:function(t){t!==R&&(j&&l.lineWidth(t),R=t)},setPolygonOffset:s,setScissorTest:function(t){t?h(l.SCISSOR_TEST):p(l.SCISSOR_TEST)},activeTexture:c,bindTexture:function(t,e){null===z&&c();var r=F[z];void 0===r&&(r={type:void 0,texture:void 0},F[z]=r),r.type===t&&r.texture===e||(l.bindTexture(t,e||V[t]),r.type=t,r.texture=e)},compressedTexImage2D:function(){try{l.compressedTexImage2D.apply(l,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{l.texImage2D.apply(l,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===B.equals(t)&&(l.scissor(t.x,t.y,t.z,t.w),B.copy(t))},viewport:function(t){!1===U.equals(t)&&(l.viewport(t.x,t.y,t.z,t.w),U.copy(t))},reset:function(){for(var t=0;t<v.length;t++)1===v[t]&&(l.disableVertexAttribArray(t),v[t]=0);b={},z=x=null,F={},L=I=S=w=null,f.reset(),d.reset(),m.reset()}}}function se(m,n,g,y,v,_,b){function x(t,e){if(t.width>e||t.height>e){if("data"in t)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+t.width+"x"+t.height+").");e/=Math.max(t.width,t.height);var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return r.width=Math.floor(t.width*e),r.height=Math.floor(t.height*e),r.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,r.width,r.height),console.warn("THREE.WebGLRenderer: image is too big ("+t.width+"x"+t.height+"). Resized to "+r.width+"x"+r.height),r}return t}function w(t){return po.isPowerOfTwo(t.width)&&po.isPowerOfTwo(t.height)}function S(t,e){return t.generateMipmaps&&e&&1003!==t.minFilter&&1006!==t.minFilter}function E(t,e,r,n){m.generateMipmap(t),y.get(e).__maxMipLevel=Math.log(Math.max(r,n))*Math.LOG2E}function C(t,e){if(!v.isWebGL2)return t;if(t===m.RGB){if(e===m.FLOAT)return m.RGB32F;if(e===m.HALF_FLOAT)return m.RGB16F;if(e===m.UNSIGNED_BYTE)return m.RGB8}if(t===m.RGBA){if(e===m.FLOAT)return m.RGBA32F;if(e===m.HALF_FLOAT)return m.RGBA16F;if(e===m.UNSIGNED_BYTE)return m.RGBA8}return t}function i(t){return 1003===t||1004===t||1005===t?m.NEAREST:m.LINEAR}function M(t){(t=t.target).removeEventListener("dispose",M);t:{var e=y.get(t);if(t.image&&e.__image__webglTextureCube)m.deleteTexture(e.__image__webglTextureCube);else{if(void 0===e.__webglInit)break t;m.deleteTexture(e.__webglTexture)}y.remove(t)}t.isVideoTexture&&delete p[t.id],b.memory.textures--}function a(t){(t=t.target).removeEventListener("dispose",a);var e=y.get(t),r=y.get(t.texture);if(t){if(void 0!==r.__webglTexture&&m.deleteTexture(r.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(r=0;r<6;r++)m.deleteFramebuffer(e.__webglFramebuffer[r]),e.__webglDepthbuffer&&m.deleteRenderbuffer(e.__webglDepthbuffer[r]);else m.deleteFramebuffer(e.__webglFramebuffer),e.__webglDepthbuffer&&m.deleteRenderbuffer(e.__webglDepthbuffer);y.remove(t.texture),y.remove(t)}b.memory.textures--}function s(t,e){var r=y.get(t);if(t.isVideoTexture){var n=t.id,i=b.render.frame;p[n]!==i&&(p[n]=i,t.update())}if(0<t.version&&r.__version!==t.version)if(void 0===(n=t.image))console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete){void 0===r.__webglInit&&(r.__webglInit=!0,t.addEventListener("dispose",M),r.__webglTexture=m.createTexture(),b.memory.textures++),g.activeTexture(m.TEXTURE0+e),g.bindTexture(m.TEXTURE_2D,r.__webglTexture),m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,t.flipY),m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),m.pixelStorei(m.UNPACK_ALIGNMENT,t.unpackAlignment),e=x(t.image,v.maxTextureSize),!v.isWebGL2&&(1001!==t.wrapS||1001!==t.wrapT||1003!==t.minFilter&&1006!==t.minFilter)&&!1===w(e)&&(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap)&&(void 0===h&&(h=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),h.width=po.floorPowerOfTwo(e.width),h.height=po.floorPowerOfTwo(e.height),h.getContext("2d").drawImage(e,0,0,h.width,h.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+h.width+"x"+h.height),e=h),n=w(e),i=_.convert(t.format);var o=_.convert(t.type),a=C(i,o);T(m.TEXTURE_2D,t,n);var s=t.mipmaps;if(t.isDepthTexture){if(a=m.DEPTH_COMPONENT,1015===t.type){if(!v.isWebGL2)throw Error("Float Depth Texture only supported in WebGL2.0");a=m.DEPTH_COMPONENT32F}else v.isWebGL2&&(a=m.DEPTH_COMPONENT16);1026===t.format&&a===m.DEPTH_COMPONENT&&1012!==t.type&&1014!==t.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),t.type=1012,o=_.convert(t.type)),1027===t.format&&(a=m.DEPTH_STENCIL,1020!==t.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),t.type=1020,o=_.convert(t.type))),g.texImage2D(m.TEXTURE_2D,0,a,e.width,e.height,0,i,o,null)}else if(t.isDataTexture)if(0<s.length&&n){for(var u=0,c=s.length;u<c;u++){var l=s[u];g.texImage2D(m.TEXTURE_2D,u,a,l.width,l.height,0,i,o,l.data)}t.generateMipmaps=!1,r.__maxMipLevel=s.length-1}else g.texImage2D(m.TEXTURE_2D,0,a,e.width,e.height,0,i,o,e.data),r.__maxMipLevel=0;else if(t.isCompressedTexture){for(u=0,c=s.length;u<c;u++)l=s[u],1023!==t.format&&1022!==t.format?-1<g.getCompressedTextureFormats().indexOf(i)?g.compressedTexImage2D(m.TEXTURE_2D,u,a,l.width,l.height,0,l.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):g.texImage2D(m.TEXTURE_2D,u,a,l.width,l.height,0,i,o,l.data);r.__maxMipLevel=s.length-1}else if(0<s.length&&n){for(u=0,c=s.length;u<c;u++)l=s[u],g.texImage2D(m.TEXTURE_2D,u,a,i,o,l);t.generateMipmaps=!1,r.__maxMipLevel=s.length-1}else g.texImage2D(m.TEXTURE_2D,0,a,i,o,e),r.__maxMipLevel=0;return S(t,n)&&E(m.TEXTURE_2D,t,e.width,e.height),r.__version=t.version,void(t.onUpdate&&t.onUpdate(t))}console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}g.activeTexture(m.TEXTURE0+e),g.bindTexture(m.TEXTURE_2D,r.__webglTexture)}function T(t,e,r){r?(m.texParameteri(t,m.TEXTURE_WRAP_S,_.convert(e.wrapS)),m.texParameteri(t,m.TEXTURE_WRAP_T,_.convert(e.wrapT)),m.texParameteri(t,m.TEXTURE_MAG_FILTER,_.convert(e.magFilter)),m.texParameteri(t,m.TEXTURE_MIN_FILTER,_.convert(e.minFilter))):(m.texParameteri(t,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(t,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),1001===e.wrapS&&1001===e.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),m.texParameteri(t,m.TEXTURE_MAG_FILTER,i(e.magFilter)),m.texParameteri(t,m.TEXTURE_MIN_FILTER,i(e.minFilter)),1003!==e.minFilter&&1006!==e.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!(r=n.get("EXT_texture_filter_anisotropic"))||1015===e.type&&null===n.get("OES_texture_float_linear")||1016===e.type&&null===(v.isWebGL2||n.get("OES_texture_half_float_linear"))||!(1<e.anisotropy||y.get(e).__currentAnisotropy)||(m.texParameterf(t,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,v.getMaxAnisotropy())),y.get(e).__currentAnisotropy=e.anisotropy)}function u(t,e,r,n){var i=_.convert(e.texture.format),o=_.convert(e.texture.type),a=C(i,o);g.texImage2D(n,0,a,e.width,e.height,0,i,o,null),m.bindFramebuffer(m.FRAMEBUFFER,t),m.framebufferTexture2D(m.FRAMEBUFFER,r,n,y.get(e.texture).__webglTexture,0),m.bindFramebuffer(m.FRAMEBUFFER,null)}function c(t,e){m.bindRenderbuffer(m.RENDERBUFFER,t),e.depthBuffer&&!e.stencilBuffer?(m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_COMPONENT16,e.width,e.height),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_STENCIL,e.width,e.height),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,t)):m.renderbufferStorage(m.RENDERBUFFER,m.RGBA4,e.width,e.height),m.bindRenderbuffer(m.RENDERBUFFER,null)}var h,p={};this.setTexture2D=s,this.setTextureCube=function(t,e){var r=y.get(t);if(6===t.image.length)if(0<t.version&&r.__version!==t.version){r.__image__webglTextureCube||(t.addEventListener("dispose",M),r.__image__webglTextureCube=m.createTexture(),b.memory.textures++),g.activeTexture(m.TEXTURE0+e),g.bindTexture(m.TEXTURE_CUBE_MAP,r.__image__webglTextureCube),m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,t.flipY),e=t&&t.isCompressedTexture;for(var n=t.image[0]&&t.image[0].isDataTexture,i=[],o=0;o<6;o++)i[o]=e||n?n?t.image[o].image:t.image[o]:x(t.image[o],v.maxCubemapSize);var a=i[0],s=w(a),u=_.convert(t.format),c=_.convert(t.type),l=C(u,c);for(T(m.TEXTURE_CUBE_MAP,t,s),o=0;o<6;o++)if(e)for(var h,p=i[o].mipmaps,f=0,d=p.length;f<d;f++)h=p[f],1023!==t.format&&1022!==t.format?-1<g.getCompressedTextureFormats().indexOf(u)?g.compressedTexImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+o,f,l,h.width,h.height,0,h.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+o,f,l,h.width,h.height,0,u,c,h.data);else n?g.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,i[o].width,i[o].height,0,u,c,i[o].data):g.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,u,c,i[o]);r.__maxMipLevel=e?p.length-1:0,S(t,s)&&E(m.TEXTURE_CUBE_MAP,t,a.width,a.height),r.__version=t.version,t.onUpdate&&t.onUpdate(t)}else g.activeTexture(m.TEXTURE0+e),g.bindTexture(m.TEXTURE_CUBE_MAP,r.__image__webglTextureCube)},this.setTextureCubeDynamic=function(t,e){g.activeTexture(m.TEXTURE0+e),g.bindTexture(m.TEXTURE_CUBE_MAP,y.get(t).__webglTexture)},this.setupRenderTarget=function(t){var e=y.get(t),r=y.get(t.texture);t.addEventListener("dispose",a),r.__webglTexture=m.createTexture(),b.memory.textures++;var n=!0===t.isWebGLRenderTargetCube,i=w(t);if(n){e.__webglFramebuffer=[];for(var o=0;o<6;o++)e.__webglFramebuffer[o]=m.createFramebuffer()}else e.__webglFramebuffer=m.createFramebuffer();if(n){for(g.bindTexture(m.TEXTURE_CUBE_MAP,r.__webglTexture),T(m.TEXTURE_CUBE_MAP,t.texture,i),o=0;o<6;o++)u(e.__webglFramebuffer[o],t,m.COLOR_ATTACHMENT0,m.TEXTURE_CUBE_MAP_POSITIVE_X+o);S(t.texture,i)&&E(m.TEXTURE_CUBE_MAP,t.texture,t.width,t.height),g.bindTexture(m.TEXTURE_CUBE_MAP,null)}else g.bindTexture(m.TEXTURE_2D,r.__webglTexture),T(m.TEXTURE_2D,t.texture,i),u(e.__webglFramebuffer,t,m.COLOR_ATTACHMENT0,m.TEXTURE_2D),S(t.texture,i)&&E(m.TEXTURE_2D,t.texture,t.width,t.height),g.bindTexture(m.TEXTURE_2D,null);if(t.depthBuffer){if(e=y.get(t),r=!0===t.isWebGLRenderTargetCube,t.depthTexture){if(r)throw Error("target.depthTexture not supported in Cube render targets");if(t&&t.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported");if(m.bindFramebuffer(m.FRAMEBUFFER,e.__webglFramebuffer),!t.depthTexture||!t.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(y.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),s(t.depthTexture,0),e=y.get(t.depthTexture).__webglTexture,1026===t.depthTexture.format)m.framebufferTexture2D(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.TEXTURE_2D,e,0);else{if(1027!==t.depthTexture.format)throw Error("Unknown depthTexture format");m.framebufferTexture2D(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.TEXTURE_2D,e,0)}}else if(r)for(e.__webglDepthbuffer=[],r=0;r<6;r++)m.bindFramebuffer(m.FRAMEBUFFER,e.__webglFramebuffer[r]),e.__webglDepthbuffer[r]=m.createRenderbuffer(),c(e.__webglDepthbuffer[r],t);else m.bindFramebuffer(m.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=m.createRenderbuffer(),c(e.__webglDepthbuffer,t);m.bindFramebuffer(m.FRAMEBUFFER,null)}},this.updateRenderTargetMipmap=function(t){var e=t.texture,r=w(t);if(S(e,r)){r=t.isWebGLRenderTargetCube?m.TEXTURE_CUBE_MAP:m.TEXTURE_2D;var n=y.get(e).__webglTexture;g.bindTexture(r,n),E(r,e,t.width,t.height),g.bindTexture(r,null)}}}function ue(r,n,i){return{convert:function(t){if(1e3===t)return r.REPEAT;if(1001===t)return r.CLAMP_TO_EDGE;if(1002===t)return r.MIRRORED_REPEAT;if(1003===t)return r.NEAREST;if(1004===t)return r.NEAREST_MIPMAP_NEAREST;if(1005===t)return r.NEAREST_MIPMAP_LINEAR;if(1006===t)return r.LINEAR;if(1007===t)return r.LINEAR_MIPMAP_NEAREST;if(1008===t)return r.LINEAR_MIPMAP_LINEAR;if(1009===t)return r.UNSIGNED_BYTE;if(1017===t)return r.UNSIGNED_SHORT_4_4_4_4;if(1018===t)return r.UNSIGNED_SHORT_5_5_5_1;if(1019===t)return r.UNSIGNED_SHORT_5_6_5;if(1010===t)return r.BYTE;if(1011===t)return r.SHORT;if(1012===t)return r.UNSIGNED_SHORT;if(1013===t)return r.INT;if(1014===t)return r.UNSIGNED_INT;if(1015===t)return r.FLOAT;if(1016===t){if(i.isWebGL2)return r.HALF_FLOAT;var e=n.get("OES_texture_half_float");if(null!==e)return e.HALF_FLOAT_OES}if(1021===t)return r.ALPHA;if(1022===t)return r.RGB;if(1023===t)return r.RGBA;if(1024===t)return r.LUMINANCE;if(1025===t)return r.LUMINANCE_ALPHA;if(1026===t)return r.DEPTH_COMPONENT;if(1027===t)return r.DEPTH_STENCIL;if(100===t)return r.FUNC_ADD;if(101===t)return r.FUNC_SUBTRACT;if(102===t)return r.FUNC_REVERSE_SUBTRACT;if(200===t)return r.ZERO;if(201===t)return r.ONE;if(202===t)return r.SRC_COLOR;if(203===t)return r.ONE_MINUS_SRC_COLOR;if(204===t)return r.SRC_ALPHA;if(205===t)return r.ONE_MINUS_SRC_ALPHA;if(206===t)return r.DST_ALPHA;if(207===t)return r.ONE_MINUS_DST_ALPHA;if(208===t)return r.DST_COLOR;if(209===t)return r.ONE_MINUS_DST_COLOR;if(210===t)return r.SRC_ALPHA_SATURATE;if((33776===t||33777===t||33778===t||33779===t)&&null!==(e=n.get("WEBGL_compressed_texture_s3tc"))){if(33776===t)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===t)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===t)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===t)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((35840===t||35841===t||35842===t||35843===t)&&null!==(e=n.get("WEBGL_compressed_texture_pvrtc"))){if(35840===t)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===t)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===t)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===t)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t&&null!==(e=n.get("WEBGL_compressed_texture_etc1")))return e.COMPRESSED_RGB_ETC1_WEBGL;if((37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t)&&null!==(e=n.get("WEBGL_compressed_texture_astc")))return t;if(103===t||104===t){if(i.isWebGL2){if(103===t)return r.MIN;if(104===t)return r.MAX}if(null!==(e=n.get("EXT_blend_minmax"))){if(103===t)return e.MIN_EXT;if(104===t)return e.MAX_EXT}}if(1020===t){if(i.isWebGL2)return r.UNSIGNED_INT_24_8;if(null!==(e=n.get("WEBGL_depth_texture")))return e.UNSIGNED_INT_24_8_WEBGL}return 0}}}function ce(){l.call(this),this.type="Group"}function le(t,e,r,n){u.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function he(t){le.call(this),this.cameras=t||[]}function pe(r){function n(){return null!==c&&!0===c.isPresenting}function t(){if(n()){var t=c.getEyeParameters("left"),e=t.renderWidth;t=t.renderHeight,o=r.getPixelRatio(),i=r.getSize(),r.setDrawingBufferSize(2*e,t,1),a.start()}else u.enabled&&(r.setDrawingBufferSize(i.width,i.height,o),a.stop())}var u=this,c=null,l=null,h=null,p=[],f=new wt,d=new wt;"undefined"!=typeof window&&"VRFrameData"in window&&(l=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",t,!1));var m=new wt,g=new s,y=new St,v=new le;v.bounds=new Et(0,0,.5,1),v.layers.enable(1);var _=new le;_.bounds=new Et(.5,0,.5,1),_.layers.enable(2);var b=new he([v,_]);b.layers.enable(1),b.layers.enable(2);var i,o,x=[];this.enabled=!1,this.userHeight=1.6,this.getController=function(t){var e=p[t];return void 0===e&&((e=new ce).matrixAutoUpdate=!1,e.visible=!1,p[t]=e),e},this.getDevice=function(){return c},this.setDevice=function(t){void 0!==t&&(c=t),a.setContext(t)},this.setPoseTarget=function(t){void 0!==t&&(h=t)},this.getCamera=function(t){if(null===c)return t.position.set(0,u.userHeight,0),t;c.depthNear=t.near,c.depthFar=t.far,c.getFrameData(l);var e=c.stageParameters;e?f.fromArray(e.sittingToStandingTransform):f.makeTranslation(0,u.userHeight,0),e=l.pose;var r=null!==h?h:t;if(r.matrix.copy(f),r.matrix.decompose(r.position,r.quaternion,r.scale),null!==e.orientation&&(g.fromArray(e.orientation),r.quaternion.multiply(g)),null!==e.position&&(g.setFromRotationMatrix(f),y.fromArray(e.position),y.applyQuaternion(g),r.position.add(y)),r.updateMatrixWorld(),!1===c.isPresenting)return t;v.near=t.near,_.near=t.near,v.far=t.far,_.far=t.far,b.matrixWorld.copy(t.matrixWorld),b.matrixWorldInverse.copy(t.matrixWorldInverse),v.matrixWorldInverse.fromArray(l.leftViewMatrix),_.matrixWorldInverse.fromArray(l.rightViewMatrix),d.getInverse(f),v.matrixWorldInverse.multiply(d),_.matrixWorldInverse.multiply(d),null!==(t=r.parent)&&(m.getInverse(t.matrixWorld),v.matrixWorldInverse.multiply(m),_.matrixWorldInverse.multiply(m)),v.matrixWorld.getInverse(v.matrixWorldInverse),_.matrixWorld.getInverse(_.matrixWorldInverse),v.projectionMatrix.fromArray(l.leftProjectionMatrix),_.projectionMatrix.fromArray(l.rightProjectionMatrix),b.projectionMatrix.copy(v.projectionMatrix),(t=c.getLayers()).length&&(null!==(t=t[0]).leftBounds&&4===t.leftBounds.length&&v.bounds.fromArray(t.leftBounds),null!==t.rightBounds&&4===t.rightBounds.length&&_.bounds.fromArray(t.rightBounds));t:for(t=0;t<p.length;t++){e=p[t];e:{r=t;for(var n=navigator.getGamepads&&navigator.getGamepads(),i=0,o=0,a=n.length;i<a;i++){var s=n[i];if(s&&("Daydream Controller"===s.id||"Gear VR Controller"===s.id||"Oculus Go Controller"===s.id||"OpenVR Gamepad"===s.id||s.id.startsWith("Oculus Touch")||s.id.startsWith("Spatial Controller"))){if(o===r){r=s;break e}o++}}r=void 0}if(void 0!==r&&void 0!==r.pose){if(null===r.pose)break t;!1===(n=r.pose).hasPosition&&e.position.set(.2,-.6,-.05),null!==n.position&&e.position.fromArray(n.position),null!==n.orientation&&e.quaternion.fromArray(n.orientation),e.matrix.compose(e.position,e.quaternion,e.scale),e.matrix.premultiply(f),e.matrix.decompose(e.position,e.quaternion,e.scale),e.matrixWorldNeedsUpdate=!0,e.visible=!0,n="Daydream Controller"===r.id?0:1,x[t]!==r.buttons[n].pressed&&(x[t]=r.buttons[n].pressed,!0===x[t]?e.dispatchEvent({type:"selectstart"}):(e.dispatchEvent({type:"selectend"}),e.dispatchEvent({type:"select"})))}else e.visible=!1}return b},this.getStandingMatrix=function(){return f},this.isPresenting=n;var a=new Tt;this.setAnimationLoop=function(t){a.setAnimationLoop(t)},this.submitFrame=function(){n()&&c.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",t)}}function fe(r){function i(){return null!==c&&null!==l}function n(t){var e=p[f.indexOf(t.inputSource)];e&&e.dispatchEvent({type:t.type})}function o(){r.setFramebuffer(null),g.stop()}function a(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}var s=r.context,e=null,c=null,l=null,h=null,p=[],f=[],t=new le;t.layers.enable(1),t.viewport=new Et;var u=new le;u.layers.enable(2),u.viewport=new Et;var d=new he([t,u]);d.layers.enable(1),d.layers.enable(2),this.enabled=!1,this.getController=function(t){var e=p[t];return void 0===e&&((e=new ce).matrixAutoUpdate=!1,e.visible=!1,p[t]=e),e},this.getDevice=function(){return e},this.setDevice=function(t){void 0!==t&&(e=t),t instanceof XRDevice&&s.setCompatibleXRDevice(t)},this.setSession=function(t,e){null!==(c=t)&&(c.addEventListener("select",n),c.addEventListener("selectstart",n),c.addEventListener("selectend",n),c.addEventListener("end",o),c.baseLayer=new XRWebGLLayer(c,s),c.requestFrameOfReference(e.frameOfReferenceType).then(function(t){l=t,r.setFramebuffer(c.baseLayer.framebuffer),g.setContext(c),g.start()}),f=c.getInputSources(),c.addEventListener("inputsourceschange",function(){f=c.getInputSources(),console.log(f)}))},this.getCamera=function(t){if(i()){var e=t.parent,r=d.cameras;a(d,e);for(var n=0;n<r.length;n++)a(r[n],e);for(t.matrixWorld.copy(d.matrixWorld),n=0,e=(t=t.children).length;n<e;n++)t[n].updateMatrixWorld(!0);return d}return t},this.isPresenting=i;var m=null,g=new Tt;g.setAnimationLoop(function(t,e){if(null!==(h=e.getDevicePose(l)))for(var r=c.baseLayer,n=e.views,i=0;i<n.length;i++){var o=n[i],a=r.getViewport(o),s=h.getViewMatrix(o),u=d.cameras[i];u.matrix.fromArray(s).getInverse(u.matrix),u.projectionMatrix.fromArray(o.projectionMatrix),u.viewport.set(a.x,a.y,a.width,a.height),0===i&&(d.matrix.copy(u.matrix),d.projectionMatrix.copy(u.projectionMatrix))}for(i=0;i<p.length;i++)r=p[i],(n=f[i])&&null!==(n=e.getInputPose(n,l))?(r.matrix.elements=n.pointerMatrix,r.matrix.decompose(r.position,r.rotation,r.scale),r.visible=!0):r.visible=!1;m&&m(t)}),this.setAnimationLoop=function(t){m=t},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new THREE.Matrix4},this.submitFrame=function(){}}function de(t){var w;function e(){C=new Rt(dt),(M=new It(dt,C,t)).isWebGL2||(C.get("WEBGL_depth_texture"),C.get("OES_texture_float"),C.get("OES_texture_half_float"),C.get("OES_texture_half_float_linear"),C.get("OES_standard_derivatives"),C.get("OES_element_index_uint"),C.get("ANGLE_instanced_arrays")),C.get("OES_texture_float_linear"),U=new ue(dt,C,M),(T=new ae(dt,C,U,M)).scissor(Q.copy(at).multiplyScalar(it)),T.viewport(J.copy(ot).multiplyScalar(it)),P=new Dt(dt),O=new Xt,A=new se(dt,C,T,O,M,U,P),I=new Pt(dt),L=new Nt(dt,I,P),R=new zt(L,P),z=new jt(dt),N=new Wt(V,C,M),k=new Jt,D=new re,j=new Ot(V,T,R,v),F=new At(dt,C,P,M),B=new kt(dt,C,P,M),P.programs=N.programs,V.context=dt,V.capabilities=M,V.extensions=C,V.properties=O,V.renderLists=k,V.state=T,V.info=P}function r(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),G=!0}function n(){console.log("THREE.WebGLRenderer: Context Restored."),G=!1,e()}function l(t){(t=t.target).removeEventListener("dispose",l),h(t),O.remove(t)}function h(t){var e=O.get(t).program;(t.program=void 0)!==e&&N.releaseProgram(e)}function a(t,e,r,n){for(var i=0,o=t.length;i<o;i++){var a=t[i],s=a.object,u=a.geometry,c=void 0===n?a.material:n;if(a=a.group,r.isArrayCamera)for(var l=(K=r).cameras,h=0,p=l.length;h<p;h++){var f=l[h];if(s.layers.test(f.layers)){if("viewport"in f)T.viewport(J.copy(f.viewport));else{var d=f.bounds;T.viewport(J.set(d.x*rt,d.y*nt,d.z*rt,d.w*nt).multiplyScalar(it))}m(s,e,f,u,c,a)}}else K=null,m(s,e,r,u,c,a)}}function m(t,e,r,n,i,o){if(t.onBeforeRender(V,e,r,n,i,o),E=D.get(e,K||r),t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){T.setMaterial(i);var a=S(r,e.fog,i,t);X=w=null,Y=!1,function(t,e){t.render(function(t){V.renderBufferImmediate(t,e)})}(t,a)}else V.renderBufferDirect(r,e.fog,n,i,t,o);t.onAfterRender(V,e,r,n,i,o),E=D.get(e,K||r)}function f(t,e,r){var n=O.get(t),i=E.state.lights,o=n.lightsHash,a=i.state.hash;r=N.getParameters(t,i.state,E.state.shadowsArray,e,ct.numPlanes,ct.numIntersection,r);var s=N.getProgramCode(t,r),u=n.program,c=!0;if(void 0===u)t.addEventListener("dispose",l);else if(u.code!==s)h(t);else{if(o.stateID!==a.stateID||o.directionalLength!==a.directionalLength||o.pointLength!==a.pointLength||o.spotLength!==a.spotLength||o.rectAreaLength!==a.rectAreaLength||o.hemiLength!==a.hemiLength||o.shadowsLength!==a.shadowsLength)o.stateID=a.stateID,o.directionalLength=a.directionalLength,o.pointLength=a.pointLength,o.spotLength=a.spotLength,o.rectAreaLength=a.rectAreaLength,o.hemiLength=a.hemiLength,o.shadowsLength=a.shadowsLength;else if(void 0!==r.shaderID)return;c=!1}if(c&&(r.shaderID?(s=na[r.shaderID],n.shader={name:t.type,uniforms:Yo.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}):n.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader},t.onBeforeCompile(n.shader,V),s=N.getProgramCode(t,r),u=N.acquireProgram(t,n.shader,r,s),n.program=u,t.program=u),r=u.getAttributes(),t.morphTargets)for(s=t.numSupportedMorphTargets=0;s<V.maxMorphTargets;s++)0<=r["morphTarget"+s]&&t.numSupportedMorphTargets++;if(t.morphNormals)for(s=t.numSupportedMorphNormals=0;s<V.maxMorphNormals;s++)0<=r["morphNormal"+s]&&t.numSupportedMorphNormals++;r=n.shader.uniforms,(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(n.numClippingPlanes=ct.numPlanes,n.numIntersection=ct.numIntersection,r.clippingPlanes=ct.uniform),n.fog=e,void 0===o&&(n.lightsHash=o={}),o.stateID=a.stateID,o.directionalLength=a.directionalLength,o.pointLength=a.pointLength,o.spotLength=a.spotLength,o.rectAreaLength=a.rectAreaLength,o.hemiLength=a.hemiLength,o.shadowsLength=a.shadowsLength,t.lights&&(r.ambientLightColor.value=i.state.ambient,r.directionalLights.value=i.state.directional,r.spotLights.value=i.state.spot,r.rectAreaLights.value=i.state.rectArea,r.pointLights.value=i.state.point,r.hemisphereLights.value=i.state.hemi,r.directionalShadowMap.value=i.state.directionalShadowMap,r.directionalShadowMatrix.value=i.state.directionalShadowMatrix,r.spotShadowMap.value=i.state.spotShadowMap,r.spotShadowMatrix.value=i.state.spotShadowMatrix,r.pointShadowMap.value=i.state.pointShadowMap,r.pointShadowMatrix.value=i.state.pointShadowMatrix),t=n.program.getUniforms(),t=Ft.seqWithValue(t.seq,r),n.uniformsList=t}function S(t,e,r,n){et=0;var i=O.get(r),o=i.lightsHash,a=E.state.lights.state.hash;lt&&(ht||t!==Z)&&ct.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,t,i,t===Z&&r.id===W),!1===r.needsUpdate&&(void 0===i.program?r.needsUpdate=!0:r.fog&&i.fog!==e?r.needsUpdate=!0:(!r.lights||o.stateID===a.stateID&&o.directionalLength===a.directionalLength&&o.pointLength===a.pointLength&&o.spotLength===a.spotLength&&o.rectAreaLength===a.rectAreaLength&&o.hemiLength===a.hemiLength&&o.shadowsLength===a.shadowsLength)&&(void 0===i.numClippingPlanes||i.numClippingPlanes===ct.numPlanes&&i.numIntersection===ct.numIntersection)||(r.needsUpdate=!0)),r.needsUpdate&&(f(r,e,n),r.needsUpdate=!1);var s=!1,u=!1,c=!1;a=(o=i.program).getUniforms();var l=i.shader.uniforms;if(T.useProgram(o.program)&&(c=u=s=!0),r.id!==W&&(W=r.id,u=!0),!s&&t===Z||(a.setValue(dt,"projectionMatrix",t.projectionMatrix),M.logarithmicDepthBuffer&&a.setValue(dt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),Z!==(K||t)&&(Z=K||t,c=u=!0),!(r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshStandardMaterial||r.envMap)||void 0!==(s=a.map.cameraPosition)&&s.setValue(dt,ft.setFromMatrixPosition(t.matrixWorld)),(r.isMeshPhongMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&a.setValue(dt,"viewMatrix",t.matrixWorldInverse)),r.skinning&&(a.setOptional(dt,n,"bindMatrix"),a.setOptional(dt,n,"bindMatrixInverse"),t=n.skeleton))if(s=t.bones,M.floatVertexTextures){if(void 0===t.boneTexture){s=Math.sqrt(4*s.length),s=po.ceilPowerOfTwo(s),s=Math.max(s,4);var h=new Float32Array(s*s*4);h.set(t.boneMatrices);var p=new Ct(h,s,s,1023,1015);p.needsUpdate=!0,t.boneMatrices=h,t.boneTexture=p,t.boneTextureSize=s}a.setValue(dt,"boneTexture",t.boneTexture),a.setValue(dt,"boneTextureSize",t.boneTextureSize)}else a.setOptional(dt,t,"boneMatrices");return u&&(a.setValue(dt,"toneMappingExposure",V.toneMappingExposure),a.setValue(dt,"toneMappingWhitePoint",V.toneMappingWhitePoint),r.lights&&(u=c,l.ambientLightColor.needsUpdate=u,l.directionalLights.needsUpdate=u,l.pointLights.needsUpdate=u,l.spotLights.needsUpdate=u,l.rectAreaLights.needsUpdate=u,l.hemisphereLights.needsUpdate=u),e&&r.fog&&(l.fogColor.value=e.color,e.isFog?(l.fogNear.value=e.near,l.fogFar.value=e.far):e.isFogExp2&&(l.fogDensity.value=e.density)),r.isMeshBasicMaterial?d(l,r):r.isMeshLambertMaterial?(d(l,r),r.emissiveMap&&(l.emissiveMap.value=r.emissiveMap)):r.isMeshPhongMaterial?(d(l,r),r.isMeshToonMaterial?(g(l,r),r.gradientMap&&(l.gradientMap.value=r.gradientMap)):g(l,r)):r.isMeshStandardMaterial?(d(l,r),r.isMeshPhysicalMaterial?(y(l,r),l.reflectivity.value=r.reflectivity,l.clearCoat.value=r.clearCoat,l.clearCoatRoughness.value=r.clearCoatRoughness):y(l,r)):r.isMeshDepthMaterial?(d(l,r),r.displacementMap&&(l.displacementMap.value=r.displacementMap,l.displacementScale.value=r.displacementScale,l.displacementBias.value=r.displacementBias)):r.isMeshDistanceMaterial?(d(l,r),r.displacementMap&&(l.displacementMap.value=r.displacementMap,l.displacementScale.value=r.displacementScale,l.displacementBias.value=r.displacementBias),l.referencePosition.value.copy(r.referencePosition),l.nearDistance.value=r.nearDistance,l.farDistance.value=r.farDistance):r.isMeshNormalMaterial?(d(l,r),r.bumpMap&&(l.bumpMap.value=r.bumpMap,l.bumpScale.value=r.bumpScale,1===r.side&&(l.bumpScale.value*=-1)),r.normalMap&&(l.normalMap.value=r.normalMap,l.normalScale.value.copy(r.normalScale),1===r.side&&l.normalScale.value.negate()),r.displacementMap&&(l.displacementMap.value=r.displacementMap,l.displacementScale.value=r.displacementScale,l.displacementBias.value=r.displacementBias)):r.isLineBasicMaterial?(l.diffuse.value=r.color,l.opacity.value=r.opacity,r.isLineDashedMaterial&&(l.dashSize.value=r.dashSize,l.totalSize.value=r.dashSize+r.gapSize,l.scale.value=r.scale)):r.isPointsMaterial?(l.diffuse.value=r.color,l.opacity.value=r.opacity,l.size.value=r.size*it,l.scale.value=.5*nt,l.map.value=r.map,null!==r.map&&(!0===r.map.matrixAutoUpdate&&r.map.updateMatrix(),l.uvTransform.value.copy(r.map.matrix))):r.isSpriteMaterial?(l.diffuse.value=r.color,l.opacity.value=r.opacity,l.rotation.value=r.rotation,l.map.value=r.map,null!==r.map&&(!0===r.map.matrixAutoUpdate&&r.map.updateMatrix(),l.uvTransform.value.copy(r.map.matrix))):r.isShadowMaterial&&(l.color.value=r.color,l.opacity.value=r.opacity),void 0!==l.ltc_1&&(l.ltc_1.value=ra.LTC_1),void 0!==l.ltc_2&&(l.ltc_2.value=ra.LTC_2),Ft.upload(dt,i.uniformsList,l,V)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Ft.upload(dt,i.uniformsList,l,V),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&a.setValue(dt,"center",n.center),a.setValue(dt,"modelViewMatrix",n.modelViewMatrix),a.setValue(dt,"normalMatrix",n.normalMatrix),a.setValue(dt,"modelMatrix",n.matrixWorld),o}function d(t,e){if(t.opacity.value=e.opacity,e.color&&(t.diffuse.value=e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap),e.envMap&&(t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap&&e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio,t.maxMipLevel.value=O.get(e.envMap).__maxMipLevel),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity),e.map)var r=e.map;else e.specularMap?r=e.specularMap:e.displacementMap?r=e.displacementMap:e.normalMap?r=e.normalMap:e.bumpMap?r=e.bumpMap:e.roughnessMap?r=e.roughnessMap:e.metalnessMap?r=e.metalnessMap:e.alphaMap?r=e.alphaMap:e.emissiveMap&&(r=e.emissiveMap);void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}function g(t,e){t.specular.value=e.specular,t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function y(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}console.log("THREE.WebGLRenderer","95");var i=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),o=void 0!==t.context?t.context:null,s=void 0!==t.alpha&&t.alpha,u=void 0===t.depth||t.depth,c=void 0===t.stencil||t.stencil,p=void 0!==t.antialias&&t.antialias,v=void 0===t.premultipliedAlpha||t.premultipliedAlpha,_=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,b=void 0!==t.powerPreference?t.powerPreference:"default",x=null,E=null;this.domElement=i,this.context=null,this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1,this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var C,M,T,P,O,A,I,L,R,N,k,D,j,z,F,B,U,V=this,G=!1,q=null,H=null,$=null,W=-1,X=w=null,Y=!1,Z=null,K=null,J=new Et,Q=new Et,tt=null,et=0,rt=i.width,nt=i.height,it=1,ot=new Et(0,0,rt,nt),at=new Et(0,0,rt,nt),st=!1,ut=new Mt,ct=new Lt,lt=!1,ht=!1,pt=new wt,ft=new St;try{s={alpha:s,depth:u,stencil:c,antialias:p,premultipliedAlpha:v,preserveDrawingBuffer:_,powerPreference:b},i.addEventListener("webglcontextlost",r,!1),i.addEventListener("webglcontextrestored",n,!1);var dt=o||i.getContext("webgl",s)||i.getContext("experimental-webgl",s);if(null===dt){if(null!==i.getContext("webgl"))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}void 0===dt.getShaderPrecisionFormat&&(dt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){console.error("THREE.WebGLRenderer: "+t.message)}e();var mt="xr"in navigator?new fe(V):new pe(V);this.vr=mt;var gt=new oe(V,R,M.maxTextureSize);this.shadowMap=gt,this.getContext=function(){return dt},this.getContextAttributes=function(){return dt.getContextAttributes()},this.forceContextLoss=function(){var t=C.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=C.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return it},this.setPixelRatio=function(t){void 0!==t&&(it=t,this.setSize(rt,nt,!1))},this.getSize=function(){return{width:rt,height:nt}},this.setSize=function(t,e,r){mt.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(rt=t,nt=e,i.width=t*it,i.height=e*it,!1!==r&&(i.style.width=t+"px",i.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(){return{width:rt*it,height:nt*it}},this.setDrawingBufferSize=function(t,e,r){rt=t,nt=e,it=r,i.width=t*r,i.height=e*r,this.setViewport(0,0,t,e)},this.getCurrentViewport=function(){return J},this.setViewport=function(t,e,r,n){ot.set(t,nt-e-n,r,n),T.viewport(J.copy(ot).multiplyScalar(it))},this.setScissor=function(t,e,r,n){at.set(t,nt-e-n,r,n),T.scissor(Q.copy(at).multiplyScalar(it))},this.setScissorTest=function(t){T.setScissorTest(st=t)},this.getClearColor=function(){return j.getClearColor()},this.setClearColor=function(){j.setClearColor.apply(j,arguments)},this.getClearAlpha=function(){return j.getClearAlpha()},this.setClearAlpha=function(){j.setClearAlpha.apply(j,arguments)},this.clear=function(t,e,r){var n=0;void 0!==t&&!t||(n|=dt.COLOR_BUFFER_BIT),void 0!==e&&!e||(n|=dt.DEPTH_BUFFER_BIT),void 0!==r&&!r||(n|=dt.STENCIL_BUFFER_BIT),dt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(t,e,r,n){this.setRenderTarget(t),this.clear(e,r,n)},this.dispose=function(){i.removeEventListener("webglcontextlost",r,!1),i.removeEventListener("webglcontextrestored",n,!1),k.dispose(),D.dispose(),O.dispose(),R.dispose(),mt.dispose(),xt.stop()},this.renderBufferImmediate=function(t,e){T.initAttributes();var r=O.get(t);t.hasPositions&&!r.position&&(r.position=dt.createBuffer()),t.hasNormals&&!r.normal&&(r.normal=dt.createBuffer()),t.hasUvs&&!r.uv&&(r.uv=dt.createBuffer()),t.hasColors&&!r.color&&(r.color=dt.createBuffer()),e=e.getAttributes(),t.hasPositions&&(dt.bindBuffer(dt.ARRAY_BUFFER,r.position),dt.bufferData(dt.ARRAY_BUFFER,t.positionArray,dt.DYNAMIC_DRAW),T.enableAttribute(e.position),dt.vertexAttribPointer(e.position,3,dt.FLOAT,!1,0,0)),t.hasNormals&&(dt.bindBuffer(dt.ARRAY_BUFFER,r.normal),dt.bufferData(dt.ARRAY_BUFFER,t.normalArray,dt.DYNAMIC_DRAW),T.enableAttribute(e.normal),dt.vertexAttribPointer(e.normal,3,dt.FLOAT,!1,0,0)),t.hasUvs&&(dt.bindBuffer(dt.ARRAY_BUFFER,r.uv),dt.bufferData(dt.ARRAY_BUFFER,t.uvArray,dt.DYNAMIC_DRAW),T.enableAttribute(e.uv),dt.vertexAttribPointer(e.uv,2,dt.FLOAT,!1,0,0)),t.hasColors&&(dt.bindBuffer(dt.ARRAY_BUFFER,r.color),dt.bufferData(dt.ARRAY_BUFFER,t.colorArray,dt.DYNAMIC_DRAW),T.enableAttribute(e.color),dt.vertexAttribPointer(e.color,3,dt.FLOAT,!1,0,0)),T.disableUnusedAttributes(),dt.drawArrays(dt.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,r,n,i,o){var a=i.isMesh&&i.normalMatrix.determinant()<0;T.setMaterial(n,a);var s=S(t,e,n,i),u=!1;w===r.id&&X===s.id&&Y===(!0===n.wireframe)||(w=r.id,X=s.id,Y=!0===n.wireframe,u=!0),i.morphTargetInfluences&&(z.update(i,r,n,s),u=!0),a=r.index;var c=r.attributes.position;if(e=1,!0===n.wireframe&&(a=L.getWireframeAttribute(r),e=2),t=F,null!==a){var l=I.get(a);(t=B).setIndex(l)}if(u){if(r&&r.isInstancedBufferGeometry&!M.isWebGL2&&null===C.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{T.initAttributes(),u=r.attributes,s=s.getAttributes();var h=n.defaultAttributeValues;for(x in s){var p=s[x];if(0<=p){var f=u[x];if(void 0!==f){var d=f.normalized,m=f.itemSize,g=I.get(f);if(void 0!==g){var y=g.buffer,v=g.type;if(g=g.bytesPerElement,f.isInterleavedBufferAttribute){var _=f.data,b=_.stride;f=f.offset,_&&_.isInstancedInterleavedBuffer?(T.enableAttributeAndDivisor(p,_.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=_.meshPerAttribute*_.count)):T.enableAttribute(p),dt.bindBuffer(dt.ARRAY_BUFFER,y),dt.vertexAttribPointer(p,m,v,d,b*g,f*g)}else f.isInstancedBufferAttribute?(T.enableAttributeAndDivisor(p,f.meshPerAttribute),void 0===r.maxInstancedCount&&(r.maxInstancedCount=f.meshPerAttribute*f.count)):T.enableAttribute(p),dt.bindBuffer(dt.ARRAY_BUFFER,y),dt.vertexAttribPointer(p,m,v,d,0,0)}}else if(void 0!==h&&void 0!==(d=h[x]))switch(d.length){case 2:dt.vertexAttrib2fv(p,d);break;case 3:dt.vertexAttrib3fv(p,d);break;case 4:dt.vertexAttrib4fv(p,d);break;default:dt.vertexAttrib1fv(p,d)}}}T.disableUnusedAttributes()}null!==a&&dt.bindBuffer(dt.ELEMENT_ARRAY_BUFFER,l.buffer)}l=1/0,null!==a?l=a.count:void 0!==c&&(l=c.count),a=r.drawRange.start*e,c=null!==o?o.start*e:0;var x=Math.max(a,c);if(0!==(o=Math.max(0,Math.min(l,a+r.drawRange.count*e,c+(null!==o?o.count*e:1/0))-1-x+1))){if(i.isMesh)if(!0===n.wireframe)T.setLineWidth(n.wireframeLinewidth*(null===H?it:1)),t.setMode(dt.LINES);else switch(i.drawMode){case 0:t.setMode(dt.TRIANGLES);break;case 1:t.setMode(dt.TRIANGLE_STRIP);break;case 2:t.setMode(dt.TRIANGLE_FAN)}else i.isLine?(void 0===(n=n.linewidth)&&(n=1),T.setLineWidth(n*(null===H?it:1)),i.isLineSegments?t.setMode(dt.LINES):i.isLineLoop?t.setMode(dt.LINE_LOOP):t.setMode(dt.LINE_STRIP)):i.isPoints?t.setMode(dt.POINTS):i.isSprite&&t.setMode(dt.TRIANGLES);r&&r.isInstancedBufferGeometry?0<r.maxInstancedCount&&t.renderInstances(r,x,o):t.render(x,o)}},this.compile=function(r,t){(E=D.get(r,t)).init(),r.traverse(function(t){t.isLight&&(E.pushLight(t),t.castShadow&&E.pushShadow(t))}),E.setupLights(t),r.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var e=0;e<t.material.length;e++)f(t.material[e],r.fog,t);else f(t.material,r.fog,t)})};var yt,vt,_t,bt=null,xt=new Tt;xt.setAnimationLoop(function(t){mt.isPresenting()||bt&&bt(t)}),"undefined"!=typeof window&&xt.setContext(window),this.setAnimationLoop=function(t){bt=t,mt.setAnimationLoop(t),xt.start()},this.render=function(t,e,r,n){if(e&&e.isCamera){if(!G){X=w=null,Y=!1,W=-1,!(Z=null)===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),mt.enabled&&(e=mt.getCamera(e)),(E=D.get(t,e)).init(),t.onBeforeRender(V,t,e,r),pt.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),ut.setFromMatrix(pt),ht=this.localClippingEnabled,lt=ct.init(this.clippingPlanes,ht,e),(x=k.get(t,e)).init(),function t(e,r,n){if(!1!==e.visible){if(e.layers.test(r.layers))if(e.isLight)E.pushLight(e),e.castShadow&&E.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||ut.intersectsSprite(e)){n&&ft.setFromMatrixPosition(e.matrixWorld).applyMatrix4(pt);var i=R.update(e),o=e.material;x.push(e,i,o,ft.z,null)}}else if(e.isImmediateRenderObject)n&&ft.setFromMatrixPosition(e.matrixWorld).applyMatrix4(pt),x.push(e,null,e.material,ft.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||ut.intersectsObject(e)))if(n&&ft.setFromMatrixPosition(e.matrixWorld).applyMatrix4(pt),i=R.update(e),o=e.material,Array.isArray(o))for(var a=i.groups,s=0,u=a.length;s<u;s++){var c=a[s],l=o[c.materialIndex];l&&l.visible&&x.push(e,i,l,ft.z,c)}else o.visible&&x.push(e,i,o,ft.z,null);for(s=0,u=(e=e.children).length;s<u;s++)t(e[s],r,n)}}(t,e,V.sortObjects),!0===V.sortObjects&&x.sort(),lt&&ct.beginShadows(),gt.render(E.state.shadowsArray,t,e),E.setupLights(e),lt&&ct.endShadows(),this.info.autoReset&&this.info.reset(),void 0===r&&(r=null),this.setRenderTarget(r),j.render(x,t,e,n),n=x.opaque;var i=x.transparent;if(t.overrideMaterial){var o=t.overrideMaterial;n.length&&a(n,t,e,o),i.length&&a(i,t,e,o)}else n.length&&a(n,t,e),i.length&&a(i,t,e);r&&A.updateRenderTargetMipmap(r),T.buffers.depth.setTest(!0),T.buffers.depth.setMask(!0),T.buffers.color.setMask(!0),T.setPolygonOffset(!1),t.onAfterRender(V,t,e),mt.enabled&&mt.submitFrame(),E=x=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function(){var t=et;return t>=M.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+t+" texture units while this GPU supports only "+M.maxTextures),et+=1,t},this.setTexture2D=(yt=!1,function(t,e){t&&t.isWebGLRenderTarget&&(yt||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),yt=!0),t=t.texture),A.setTexture2D(t,e)}),this.setTexture=(vt=!1,function(t,e){vt||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),vt=!0),A.setTexture2D(t,e)}),this.setTextureCube=(_t=!1,function(t,e){t&&t.isWebGLRenderTargetCube&&(_t||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),_t=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?A.setTextureCube(t,e):A.setTextureCubeDynamic(t,e)}),this.setFramebuffer=function(t){q=t},this.getRenderTarget=function(){return H},this.setRenderTarget=function(t){(H=t)&&void 0===O.get(t).__webglFramebuffer&&A.setupRenderTarget(t);var e=q,r=!1;tt=t?(e=O.get(t).__webglFramebuffer,t.isWebGLRenderTargetCube&&(e=e[t.activeCubeFace],r=!0),J.copy(t.viewport),Q.copy(t.scissor),t.scissorTest):(J.copy(ot).multiplyScalar(it),Q.copy(at).multiplyScalar(it),st),$!==e&&(dt.bindFramebuffer(dt.FRAMEBUFFER,e),$=e),T.viewport(J),T.scissor(Q),T.setScissorTest(tt),r&&(r=O.get(t.texture),dt.framebufferTexture2D(dt.FRAMEBUFFER,dt.COLOR_ATTACHMENT0,dt.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,r.__webglTexture,t.activeMipMapLevel))},this.readRenderTargetPixels=function(t,e,r,n,i,o){if(t&&t.isWebGLRenderTarget){var a=O.get(t).__webglFramebuffer;if(a){var s=!1;a!==$&&(dt.bindFramebuffer(dt.FRAMEBUFFER,a),s=!0);try{var u=t.texture,c=u.format,l=u.type;1023!==c&&U.convert(c)!==dt.getParameter(dt.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===l||U.convert(l)===dt.getParameter(dt.IMPLEMENTATION_COLOR_READ_TYPE)||1015===l&&(M.isWebGL2||C.get("OES_texture_float")||C.get("WEBGL_color_buffer_float"))||1016===l&&(M.isWebGL2?C.get("EXT_color_buffer_float"):C.get("EXT_color_buffer_half_float"))?dt.checkFramebufferStatus(dt.FRAMEBUFFER)===dt.FRAMEBUFFER_COMPLETE?0<=e&&e<=t.width-n&&0<=r&&r<=t.height-i&&dt.readPixels(e,r,n,i,U.convert(c),U.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{s&&dt.bindFramebuffer(dt.FRAMEBUFFER,$)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,r){var n=e.image.width,i=e.image.height,o=U.convert(e.format);this.setTexture2D(e,0),dt.copyTexImage2D(dt.TEXTURE_2D,r||0,o,t.x,t.y,n,i,0)},this.copyTextureToTexture=function(t,e,r,n){var i=e.image.width,o=e.image.height,a=U.convert(r.format),s=U.convert(r.type);this.setTexture2D(r,0),e.isDataTexture?dt.texSubImage2D(dt.TEXTURE_2D,n||0,t.x,t.y,i,o,a,s,e.image.data):dt.texSubImage2D(dt.TEXTURE_2D,n||0,t.x,t.y,a,s,e.image)}}function me(t,e){this.name="",this.color=new w(t),this.density=void 0!==e?e:25e-5}function ge(t,e,r){this.name="",this.color=new w(t),this.near=void 0!==e?e:1,this.far=void 0!==r?r:1e3}function ye(){l.call(this),this.type="Scene",this.overrideMaterial=this.fog=this.background=null,this.autoUpdate=!0}function ve(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function _e(t,e,r,n){this.data=t,this.itemSize=e,this.offset=r,this.normalized=!0===n}function be(t){k.call(this),this.type="SpriteMaterial",this.color=new w(16777215),this.map=null,this.rotation=0,this.lights=!1,this.transparent=!0,this.setValues(t)}function xe(t){if(l.call(this),this.type="Sprite",void 0===Fs){Fs=new A;var e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);e=new ve(e,5),Fs.setIndex([0,1,2,0,2,3]),Fs.addAttribute("position",new _e(e,3,0,!1)),Fs.addAttribute("uv",new _e(e,2,3,!1))}this.geometry=Fs,this.material=void 0!==t?t:new be,this.center=new H(.5,.5)}function we(){l.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Se(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else for(console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[],t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new wt)}function Ee(){l.call(this),this.type="Bone"}function Ce(t,e){B.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new wt,this.bindMatrixInverse=new wt,t=new Se(t=this.initBones()),this.bind(t,this.matrixWorld),this.normalizeSkinWeights()}function Me(t){k.call(this),this.type="LineBasicMaterial",this.color=new w(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.lights=!1,this.setValues(t)}function Te(t,e,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),l.call(this),this.type="Line",this.geometry=void 0!==t?t:new A,this.material=void 0!==e?e:new Me({color:16777215*Math.random()})}function Pe(t,e){Te.call(this,t,e),this.type="LineSegments"}function Oe(t,e){Te.call(this,t,e),this.type="LineLoop"}function Ae(t){k.call(this),this.type="PointsMaterial",this.color=new w(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=this.morphTargets=!1,this.setValues(t)}function Ie(t,e){l.call(this),this.type="Points",this.geometry=void 0!==t?t:new A,this.material=void 0!==e?e:new Ae({color:16777215*Math.random()})}function Le(t,e,r,n,i,o,a,s,u){p.call(this,t,e,r,n,i,o,a,s,u),this.generateMipmaps=!1}function Re(t,e,r,n,i,o,a,s,u,c,l,h){p.call(this,null,o,a,s,u,c,n,i,l,h),this.image={width:e,height:r},this.mipmaps=t,this.generateMipmaps=this.flipY=!1}function Ne(t,e,r,n,i,o,a,s,u){p.call(this,t,e,r,n,i,o,a,s,u),this.needsUpdate=!0}function ke(t,e,r,n,i,o,a,s,u,c){if(1026!==(c=void 0!==c?c:1026)&&1027!==c)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&1026===c&&(r=1012),void 0===r&&1027===c&&(r=1020),p.call(this,null,n,i,o,a,s,c,r,u),this.image={width:t,height:e},this.magFilter=void 0!==a?a:1003,this.minFilter=void 0!==s?s:1003,this.generateMipmaps=this.flipY=!1}function De(t){A.call(this),this.type="WireframeGeometry";var e,r,n,i=[],o=[0,0],a={},s=["a","b","c"];if(t&&t.isGeometry){var u=t.faces,c=0;for(r=u.length;c<r;c++){var l=u[c];for(e=0;e<3;e++){var h=l[s[e]],p=l[s[(e+1)%3]];o[0]=Math.min(h,p),o[1]=Math.max(h,p),void 0===a[h=o[0]+","+o[1]]&&(a[h]={index1:o[0],index2:o[1]})}}for(h in a)c=a[h],s=t.vertices[c.index1],i.push(s.x,s.y,s.z),s=t.vertices[c.index2],i.push(s.x,s.y,s.z)}else if(t&&t.isBufferGeometry)if(s=new St,null!==t.index){u=t.attributes.position,l=t.index;var f=t.groups;for(0===f.length&&(f=[{start:0,count:l.count,materialIndex:0}]),t=0,n=f.length;t<n;++t)for(e=(c=f[t]).start,r=c.count,r=(c=e)+r;c<r;c+=3)for(e=0;e<3;e++)h=l.getX(c+e),p=l.getX(c+(e+1)%3),o[0]=Math.min(h,p),o[1]=Math.max(h,p),void 0===a[h=o[0]+","+o[1]]&&(a[h]={index1:o[0],index2:o[1]});for(h in a)c=a[h],s.fromBufferAttribute(u,c.index1),i.push(s.x,s.y,s.z),s.fromBufferAttribute(u,c.index2),i.push(s.x,s.y,s.z)}else for(c=0,r=(u=t.attributes.position).count/3;c<r;c++)for(e=0;e<3;e++)a=3*c+e,s.fromBufferAttribute(u,a),i.push(s.x,s.y,s.z),a=3*c+(e+1)%3,s.fromBufferAttribute(u,a),i.push(s.x,s.y,s.z);this.addAttribute("position",new O(i,3))}function je(t,e,r){E.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:r},this.fromBufferGeometry(new ze(t,e,r)),this.mergeVertices()}function ze(t,e,r){A.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:r};var n,i,o=[],a=[],s=[],u=[],c=new St,l=new St,h=new St,p=new St,f=new St;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var d=e+1;for(n=0;n<=r;n++){var m=n/r;for(i=0;i<=e;i++){var g=i/e;t(g,m,l),a.push(l.x,l.y,l.z),0<=g-1e-5?(t(g-1e-5,m,h),p.subVectors(l,h)):(t(1e-5+g,m,h),p.subVectors(h,l)),0<=m-1e-5?(t(g,m-1e-5,h),f.subVectors(l,h)):(t(g,1e-5+m,h),f.subVectors(h,l)),c.crossVectors(p,f).normalize(),s.push(c.x,c.y,c.z),u.push(g,m)}}for(n=0;n<r;n++)for(i=0;i<e;i++)t=n*d+i+1,c=(n+1)*d+i+1,l=(n+1)*d+i,o.push(n*d+i,t,l),o.push(t,c,l);this.setIndex(o),this.addAttribute("position",new O(a,3)),this.addAttribute("normal",new O(s,3)),this.addAttribute("uv",new O(u,2))}function Fe(t,e,r,n){E.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},this.fromBufferGeometry(new Be(t,e,r,n)),this.mergeVertices()}function Be(r,m,t,e){function g(t){h.push(t.x,t.y,t.z)}function y(t,e){t*=3,e.x=r[t+0],e.y=r[t+1],e.z=r[t+2]}function l(t,e,r,n){n<0&&1===t.x&&(p[e]=t.x-1),0===r.x&&0===r.z&&(p[e]=n/2/Math.PI+.5)}A.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:r,indices:m,radius:t,detail:e},t=t||1;var h=[],p=[];!function(t){for(var e=new St,r=new St,n=new St,i=0;i<m.length;i+=3){y(m[i+0],e),y(m[i+1],r),y(m[i+2],n);var o,a,s=e,u=r,c=n,l=Math.pow(2,t),h=[];for(a=0;a<=l;a++){h[a]=[];var p=s.clone().lerp(c,a/l),f=u.clone().lerp(c,a/l),d=l-a;for(o=0;o<=d;o++)h[a][o]=0===o&&a===l?p:p.clone().lerp(f,o/d)}for(a=0;a<l;a++)for(o=0;o<2*(l-a)-1;o++)s=Math.floor(o/2),0==o%2?(g(h[a][s+1]),g(h[a+1][s]),g(h[a][s])):(g(h[a][s+1]),g(h[a+1][s+1]),g(h[a+1][s]))}}(e=e||0),function(t){for(var e=new St,r=0;r<h.length;r+=3)e.x=h[r+0],e.y=h[r+1],e.z=h[r+2],e.normalize().multiplyScalar(t),h[r+0]=e.x,h[r+1]=e.y,h[r+2]=e.z}(t),function(){for(var t=new St,e=0;e<h.length;e+=3)t.x=h[e+0],t.y=h[e+1],t.z=h[e+2],p.push(Math.atan2(t.z,-t.x)/2/Math.PI+.5,1-(Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5));t=new St,e=new St;for(var r=new St,n=new St,i=new H,o=new H,a=new H,s=0,u=0;s<h.length;s+=9,u+=6){t.set(h[s+0],h[s+1],h[s+2]),e.set(h[s+3],h[s+4],h[s+5]),r.set(h[s+6],h[s+7],h[s+8]),i.set(p[u+0],p[u+1]),o.set(p[u+2],p[u+3]),a.set(p[u+4],p[u+5]),n.copy(t).add(e).add(r).divideScalar(3);var c=Math.atan2(n.z,-n.x);l(i,u+0,t,c),l(o,u+2,e,c),l(a,u+4,r,c)}for(t=0;t<p.length;t+=6)e=p[t+0],r=p[t+2],n=p[t+4],i=Math.min(e,r,n),.9<Math.max(e,r,n)&&i<.1&&(e<.2&&(p[t+0]+=1),r<.2&&(p[t+2]+=1),n<.2&&(p[t+4]+=1))}(),this.addAttribute("position",new O(h,3)),this.addAttribute("normal",new O(h.slice(),3)),this.addAttribute("uv",new O(p,2)),0===e?this.computeVertexNormals():this.normalizeNormals()}function Ue(t,e){E.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ve(t,e)),this.mergeVertices()}function Ve(t,e){Be.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Ge(t,e){E.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new qe(t,e)),this.mergeVertices()}function qe(t,e){Be.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function He(t,e){E.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new $e(t,e)),this.mergeVertices()}function $e(t,e){var r=(1+Math.sqrt(5))/2;Be.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function We(t,e){E.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Xe(t,e)),this.mergeVertices()}function Xe(t,e){var r=(1+Math.sqrt(5))/2,n=1/r;Be.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Ye(t,e,r,n,i,o){E.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed."),t=new Ze(t,e,r,n,i),this.tangents=t.tangents,this.normals=t.normals,this.binormals=t.binormals,this.fromBufferGeometry(t),this.mergeVertices()}function Ze(i,o,a,s,t){function e(t){p=i.getPointAt(t/o,p);var e=u.normals[t];for(t=u.binormals[t],c=0;c<=s;c++){var r=c/s*Math.PI*2,n=Math.sin(r);r=-Math.cos(r),h.x=r*e.x+n*t.x,h.y=r*e.y+n*t.y,h.z=r*e.z+n*t.z,h.normalize(),d.push(h.x,h.y,h.z),l.x=p.x+a*h.x,l.y=p.y+a*h.y,l.z=p.z+a*h.z,f.push(l.x,l.y,l.z)}}A.call(this),this.type="TubeBufferGeometry",this.parameters={path:i,tubularSegments:o,radius:a,radialSegments:s,closed:t},o=o||64,a=a||1,s=s||8,t=t||!1;var u=i.computeFrenetFrames(o,t);this.tangents=u.tangents,this.normals=u.normals,this.binormals=u.binormals;var n,c,l=new St,h=new St,r=new H,p=new St,f=[],d=[],m=[],g=[];for(n=0;n<o;n++)e(n);for(e(!1===t?o:0),n=0;n<=o;n++)for(c=0;c<=s;c++)r.x=n/o,r.y=c/s,m.push(r.x,r.y);!function(){for(c=1;c<=o;c++)for(n=1;n<=s;n++){var t=(s+1)*c+(n-1),e=(s+1)*c+n,r=(s+1)*(c-1)+n;g.push((s+1)*(c-1)+(n-1),t,r),g.push(t,e,r)}}(),this.setIndex(g),this.addAttribute("position",new O(f,3)),this.addAttribute("normal",new O(d,3)),this.addAttribute("uv",new O(m,2))}function Ke(t,e,r,n,i,o,a){E.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Je(t,e,r,n,i,o)),this.mergeVertices()}function Je(t,e,r,n,i,o){function a(t,e,r,n,i){var o=Math.sin(t);e=r/e*t,r=Math.cos(e),i.x=n*(2+r)*.5*Math.cos(t),i.y=n*(2+r)*o*.5,i.z=n*Math.sin(e)*.5}A.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:o},t=t||1,e=e||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,o=o||3;var s,u=[],c=[],l=[],h=[],p=new St,f=new St,d=new St,m=new St,g=new St,y=new St,v=new St;for(s=0;s<=r;++s){var _=s/r*i*Math.PI*2;for(a(_,i,o,t,d),a(_+.01,i,o,t,m),y.subVectors(m,d),v.addVectors(m,d),g.crossVectors(y,v),v.crossVectors(g,y),g.normalize(),v.normalize(),_=0;_<=n;++_){var b=_/n*Math.PI*2,x=-e*Math.cos(b);b=e*Math.sin(b),p.x=d.x+(x*v.x+b*g.x),p.y=d.y+(x*v.y+b*g.y),p.z=d.z+(x*v.z+b*g.z),c.push(p.x,p.y,p.z),f.subVectors(p,d).normalize(),l.push(f.x,f.y,f.z),h.push(s/r),h.push(_/n)}}for(_=1;_<=r;_++)for(s=1;s<=n;s++)t=(n+1)*_+(s-1),e=(n+1)*_+s,i=(n+1)*(_-1)+s,u.push((n+1)*(_-1)+(s-1),t,i),u.push(t,e,i);this.setIndex(u),this.addAttribute("position",new O(c,3)),this.addAttribute("normal",new O(l,3)),this.addAttribute("uv",new O(h,2))}function Qe(t,e,r,n,i){E.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new tr(t,e,r,n,i)),this.mergeVertices()}function tr(t,e,r,n,i){A.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},t=t||1,e=e||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var o,a,s=[],u=[],c=[],l=[],h=new St,p=new St,f=new St;for(o=0;o<=r;o++)for(a=0;a<=n;a++){var d=a/n*i,m=o/r*Math.PI*2;p.x=(t+e*Math.cos(m))*Math.cos(d),p.y=(t+e*Math.cos(m))*Math.sin(d),p.z=e*Math.sin(m),u.push(p.x,p.y,p.z),h.x=t*Math.cos(d),h.y=t*Math.sin(d),f.subVectors(p,h).normalize(),c.push(f.x,f.y,f.z),l.push(a/n),l.push(o/r)}for(o=1;o<=r;o++)for(a=1;a<=n;a++)t=(n+1)*(o-1)+a-1,e=(n+1)*(o-1)+a,i=(n+1)*o+a,s.push((n+1)*o+a-1,t,i),s.push(t,e,i);this.setIndex(s),this.addAttribute("position",new O(u,3)),this.addAttribute("normal",new O(c,3)),this.addAttribute("uv",new O(l,2))}function er(t,e,r,n,i){for(var o,a=0,s=e,u=r-n;s<r;s+=n)a+=(t[u]-t[s])*(t[s+1]+t[u+1]),u=s;if(i===0<a)for(i=e;i<r;i+=n)o=fr(i,t[i],t[i+1],o);else for(i=r-n;e<=i;i-=n)o=fr(i,t[i],t[i+1],o);return o&&cr(o,o.next)&&(dr(o),o=o.next),o}function rr(t,e){if(!t)return t;e=e||t;do{var r=!1;if(t.steiner||!cr(t,t.next)&&0!==ur(t.prev,t,t.next))t=t.next;else{if(dr(t),(t=e=t.prev)===t.next)break;r=!0}}while(r||t!==e);return e}function nr(t,e){return t.x-e.x}function ir(t,e){var r=e,n=t.x,i=t.y,o=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var a=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&o<a){if((o=a)===n){if(i===r.y)return r;if(i===r.next.y)return r.next}var s=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!s)return null;if(n===o)return s.prev;a=(e=s).x;var u=s.y,c=1/0;for(r=s.next;r!==e;){if(n>=r.x&&r.x>=a&&n!==r.x&&sr(i<u?n:o,i,a,u,i<u?o:n,i,r.x,r.y)){var l=Math.abs(i-r.y)/(n-r.x);(l<c||l===c&&r.x>s.x)&&hr(r,t)&&(s=r,c=l)}r=r.next}return s}function or(t,e,r,n,i){return 1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1)|(1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ar(t){for(var e=t,r=t;e.x<r.x&&(r=e),(e=e.next)!==t;);return r}function sr(t,e,r,n,i,o,a,s){return 0<=(i-a)*(e-s)-(t-a)*(o-s)&&0<=(t-a)*(n-s)-(r-a)*(e-s)&&0<=(r-a)*(o-s)-(i-a)*(n-s)}function ur(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function cr(t,e){return t.x===e.x&&t.y===e.y}function lr(t,e,r,n){return!!(cr(t,e)&&cr(r,n)||cr(t,n)&&cr(r,e))||0<ur(t,e,r)!=0<ur(t,e,n)&&0<ur(r,n,t)!=0<ur(r,n,e)}function hr(t,e){return ur(t.prev,t,t.next)<0?0<=ur(t,e,t.next)&&0<=ur(t,t.prev,e):ur(t,e,t.prev)<0||ur(t,t.next,e)<0}function pr(t,e){var r=new mr(t.i,t.x,t.y),n=new mr(e.i,e.x,e.y),i=t.next,o=e.prev;return(t.next=e).prev=t,(r.next=i).prev=r,(n.next=r).prev=n,(o.next=n).prev=o,n}function fr(t,e,r,n){return t=new mr(t,e,r),n?(t.next=n.next,(t.prev=n).next.prev=t,n.next=t):(t.prev=t).next=t,t}function dr(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function mr(t,e,r){this.i=t,this.x=e,this.y=r,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function gr(t){var e=t.length;2<e&&t[e-1].equals(t[0])&&t.pop()}function yr(t,e){for(var r=0;r<e.length;r++)t.push(e[r].x),t.push(e[r].y)}function vr(t,e){E.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new _r(t,e)),this.mergeVertices()}function _r(t,U){function e(t){function e(t,e,r){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(r).add(t)}function r(t,e,r){var n=t.x-e.x,i=t.y-e.y,o=r.x-t.x,a=r.y-t.y,s=n*n+i*i;if(Math.abs(n*a-i*o)>Number.EPSILON){var u=Math.sqrt(s),c=Math.sqrt(o*o+a*a);if(s=e.x-i/u,e=e.y+n/u,(i=(o=s+n*(a=((r.x-a/c-s)*a-(r.y+o/c-e)*o)/(n*a-i*o))-t.x)*o+(n=e+i*a-t.y)*n)<=2)return new H(o,n);i=Math.sqrt(i/2)}else t=!1,n>Number.EPSILON?o>Number.EPSILON&&(t=!0):n<-Number.EPSILON?o<-Number.EPSILON&&(t=!0):Math.sign(i)===Math.sign(a)&&(t=!0),i=t?(o=-i,Math.sqrt(s)):(o=n,n=i,Math.sqrt(s/2));return new H(o/i,n/i)}function n(t,e){for(N=t.length;0<=--N;){var r=N,n=N-1;n<0&&(n=t.length-1);var i,o=p+2*m;for(i=0;i<o;i++){var a=L*i,s=L*(i+1),u=e+n+a,c=e+n+s;s=e+r+s,l(e+r+a),l(u),l(s),l(u),l(c),l(s),a=G.length/3,h((a=y.generateSideWallUV(V,G,a-6,a-3,a-2,a-1))[0]),h(a[1]),h(a[3]),h(a[1]),h(a[2]),h(a[3])}}}function i(t,e,r){a.push(t),a.push(e),a.push(r)}function o(t,e,r){l(t),l(e),l(r),t=G.length/3,h((t=y.generateTopUV(V,G,t-3,t-2,t-1))[0]),h(t[1]),h(t[2])}function l(t){G.push(a[3*t]),G.push(a[3*t+1]),G.push(a[3*t+2])}function h(t){q.push(t.x),q.push(t.y)}var a=[],s=void 0!==U.curveSegments?U.curveSegments:12,p=void 0!==U.steps?U.steps:1,u=void 0!==U.depth?U.depth:100,c=void 0===U.bevelEnabled||U.bevelEnabled,f=void 0!==U.bevelThickness?U.bevelThickness:6,d=void 0!==U.bevelSize?U.bevelSize:f-2,m=void 0!==U.bevelSegments?U.bevelSegments:3,g=U.extrudePath,y=void 0!==U.UVGenerator?U.UVGenerator:mu;void 0!==U.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=U.amount);var v,_=!1;if(g){var b=g.getSpacedPoints(p);c=!(_=!0);var x=g.computeFrenetFrames(p,!1),w=new St,S=new St,E=new St}c||(d=f=m=0),t=(s=t.extractPoints(s)).shape;var C=s.holes;if(!du.isClockWise(t)){t=t.reverse();var M=0;for(v=C.length;M<v;M++){var T=C[M];du.isClockWise(T)&&(C[M]=T.reverse())}}var P=du.triangulateShape(t,C),O=t;for(M=0,v=C.length;M<v;M++)T=C[M],t=t.concat(T);var A,I,L=t.length,R=P.length;s=[];var N=0,k=O.length,D=k-1;for(A=N+1;N<k;N++,D++,A++)D===k&&(D=0),A===k&&(A=0),s[N]=r(O[N],O[D],O[A]);g=[];var j=s.concat();for(M=0,v=C.length;M<v;M++){T=C[M];var z=[];for(N=0,D=(k=T.length)-1,A=N+1;N<k;N++,D++,A++)D===k&&(D=0),A===k&&(A=0),z[N]=r(T[N],T[D],T[A]);g.push(z),j=j.concat(z)}for(D=0;D<m;D++){k=D/m;var F=f*Math.cos(k*Math.PI/2);for(A=d*Math.sin(k*Math.PI/2),N=0,k=O.length;N<k;N++){var B=e(O[N],s[N],A);i(B.x,B.y,-F)}for(M=0,v=C.length;M<v;M++)for(T=C[M],z=g[M],N=0,k=T.length;N<k;N++)i((B=e(T[N],z[N],A)).x,B.y,-F)}for(A=d,N=0;N<L;N++)B=c?e(t[N],j[N],A):t[N],_?(S.copy(x.normals[0]).multiplyScalar(B.x),w.copy(x.binormals[0]).multiplyScalar(B.y),E.copy(b[0]).add(S).add(w),i(E.x,E.y,E.z)):i(B.x,B.y,0);for(k=1;k<=p;k++)for(N=0;N<L;N++)B=c?e(t[N],j[N],A):t[N],_?(S.copy(x.normals[k]).multiplyScalar(B.x),w.copy(x.binormals[k]).multiplyScalar(B.y),E.copy(b[k]).add(S).add(w),i(E.x,E.y,E.z)):i(B.x,B.y,u/p*k);for(D=m-1;0<=D;D--){for(k=D/m,F=f*Math.cos(k*Math.PI/2),A=d*Math.sin(k*Math.PI/2),N=0,k=O.length;N<k;N++)i((B=e(O[N],s[N],A)).x,B.y,u+F);for(M=0,v=C.length;M<v;M++)for(T=C[M],z=g[M],N=0,k=T.length;N<k;N++)B=e(T[N],z[N],A),_?i(B.x,B.y+b[p-1].y,b[p-1].x+F):i(B.x,B.y,u+F)}!function(){var t=G.length/3;if(c){var e=0*L;for(N=0;N<R;N++)o((I=P[N])[2]+e,I[1]+e,I[0]+e);for(e=L*(p+2*m),N=0;N<R;N++)o((I=P[N])[0]+e,I[1]+e,I[2]+e)}else{for(N=0;N<R;N++)o((I=P[N])[2],I[1],I[0]);for(N=0;N<R;N++)o((I=P[N])[0]+L*p,I[1]+L*p,I[2]+L*p)}V.addGroup(t,G.length/3-t,0)}(),function(){var t=G.length/3,e=0;for(n(O,e),e+=O.length,M=0,v=C.length;M<v;M++)n(T=C[M],e),e+=T.length;V.addGroup(t,G.length/3-t,1)}()}A.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:U},t=Array.isArray(t)?t:[t];for(var V=this,G=[],q=[],r=0,n=t.length;r<n;r++)e(t[r]);this.addAttribute("position",new O(G,3)),this.addAttribute("uv",new O(q,2)),this.computeVertexNormals()}function br(t,e,r){if(r.shapes=[],Array.isArray(t))for(var n=0,i=t.length;n<i;n++)r.shapes.push(t[n].uuid);else r.shapes.push(t.uuid);return void 0!==e.extrudePath&&(r.options.extrudePath=e.extrudePath.toJSON()),r}function xr(t,e){E.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new wr(t,e)),this.mergeVertices()}function wr(t,e){var r=(e=e||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new E;t=r.generateShapes(t,e.size),e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),_r.call(this,t,e),this.type="TextBufferGeometry"}function Sr(t,e,r,n,i,o,a){E.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Er(t,e,r,n,i,o,a)),this.mergeVertices()}function Er(t,e,r,n,i,o,a){A.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},t=t||1,e=Math.max(3,Math.floor(e)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI;var s,u,c=(o=void 0!==o?o:0)+(a=void 0!==a?a:Math.PI),l=0,h=[],p=new St,f=new St,d=[],m=[],g=[],y=[];for(u=0;u<=r;u++){var v=[],_=u/r;for(s=0;s<=e;s++){var b=s/e;p.x=-t*Math.cos(n+b*i)*Math.sin(o+_*a),p.y=t*Math.cos(o+_*a),p.z=t*Math.sin(n+b*i)*Math.sin(o+_*a),m.push(p.x,p.y,p.z),f.set(p.x,p.y,p.z).normalize(),g.push(f.x,f.y,f.z),y.push(b,1-_),v.push(l++)}h.push(v)}for(u=0;u<r;u++)for(s=0;s<e;s++)t=h[u][s+1],n=h[u][s],i=h[u+1][s],a=h[u+1][s+1],(0!==u||0<o)&&d.push(t,n,a),(u!==r-1||c<Math.PI)&&d.push(n,i,a);this.setIndex(d),this.addAttribute("position",new O(m,3)),this.addAttribute("normal",new O(g,3)),this.addAttribute("uv",new O(y,2))}function Cr(t,e,r,n,i,o){E.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new Mr(t,e,r,n,i,o)),this.mergeVertices()}function Mr(t,e,r,n,i,o){A.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},t=t||.5,e=e||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var a,s,u=[],c=[],l=[],h=[],p=t,f=(e-t)/(n=void 0!==n?Math.max(1,n):1),d=new St,m=new H;for(a=0;a<=n;a++){for(s=0;s<=r;s++)t=i+s/r*o,d.x=p*Math.cos(t),d.y=p*Math.sin(t),c.push(d.x,d.y,d.z),l.push(0,0,1),m.x=(d.x/e+1)/2,m.y=(d.y/e+1)/2,h.push(m.x,m.y);p+=f}for(a=0;a<n;a++)for(e=a*(r+1),s=0;s<r;s++)i=(t=s+e)+r+1,o=t+r+2,p=t+1,u.push(t,i,p),u.push(i,o,p);this.setIndex(u),this.addAttribute("position",new O(c,3)),this.addAttribute("normal",new O(l,3)),this.addAttribute("uv",new O(h,2))}function Tr(t,e,r,n){E.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},this.fromBufferGeometry(new Pr(t,e,r,n)),this.mergeVertices()}function Pr(t,e,r,n){A.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},e=Math.floor(e)||12,r=r||0,n=n||2*Math.PI,n=po.clamp(n,0,2*Math.PI);var i,o=[],a=[],s=[],u=1/e,c=new St,l=new H;for(i=0;i<=e;i++){var h=r+i*u*n,p=Math.sin(h),f=Math.cos(h);for(h=0;h<=t.length-1;h++)c.x=t[h].x*p,c.y=t[h].y,c.z=t[h].x*f,a.push(c.x,c.y,c.z),l.x=i/e,l.y=h/(t.length-1),s.push(l.x,l.y)}for(i=0;i<e;i++)for(h=0;h<t.length-1;h++)u=(r=h+i*t.length)+t.length,c=r+t.length+1,l=r+1,o.push(r,u,l),o.push(u,c,l);if(this.setIndex(o),this.addAttribute("position",new O(a,3)),this.addAttribute("uv",new O(s,2)),this.computeVertexNormals(),n===2*Math.PI)for(n=this.attributes.normal.array,o=new St,a=new St,s=new St,r=e*t.length*3,h=i=0;i<t.length;i++,h+=3)o.x=n[h+0],o.y=n[h+1],o.z=n[h+2],a.x=n[r+h+0],a.y=n[r+h+1],a.z=n[r+h+2],s.addVectors(o,a).normalize(),n[h+0]=n[r+h+0]=s.x,n[h+1]=n[r+h+1]=s.y,n[h+2]=n[r+h+2]=s.z}function Or(t,e){E.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Ar(t,e)),this.mergeVertices()}function Ar(t,s){function e(t){var e,r=c.length/3,n=(t=t.extractPoints(s)).shape,i=t.holes;if(!1===du.isClockWise(n))for(n=n.reverse(),t=0,e=i.length;t<e;t++){var o=i[t];!0===du.isClockWise(o)&&(i[t]=o.reverse())}var a=du.triangulateShape(n,i);for(t=0,e=i.length;t<e;t++)o=i[t],n=n.concat(o);for(t=0,e=n.length;t<e;t++)o=n[t],c.push(o.x,o.y,0),l.push(0,0,1),h.push(o.x,o.y);for(t=0,e=a.length;t<e;t++)n=a[t],u.push(n[0]+r,n[1]+r,n[2]+r),p+=3}A.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:s},s=s||12;var u=[],c=[],l=[],h=[],r=0,p=0;if(!1===Array.isArray(t))e(t);else for(var n=0;n<t.length;n++)e(t[n]),this.addGroup(r,p,n),r+=p,p=0;this.setIndex(u),this.addAttribute("position",new O(c,3)),this.addAttribute("normal",new O(l,3)),this.addAttribute("uv",new O(h,2))}function Ir(t,e){if(e.shapes=[],Array.isArray(t))for(var r=0,n=t.length;r<n;r++)e.shapes.push(t[r].uuid);else e.shapes.push(t.uuid);return e}function Lr(t,e){A.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e};var r=[];e=Math.cos(po.DEG2RAD*(void 0!==e?e:1));var n=[0,0],i={},o=["a","b","c"];if(t.isBufferGeometry){var a=new E;a.fromBufferGeometry(t)}else a=t.clone();a.mergeVertices(),a.computeFaceNormals(),t=a.vertices;for(var s=0,u=(a=a.faces).length;s<u;s++)for(var c=a[s],l=0;l<3;l++){var h=c[o[l]],p=c[o[(l+1)%3]];n[0]=Math.min(h,p),n[1]=Math.max(h,p),void 0===i[h=n[0]+","+n[1]]?i[h]={index1:n[0],index2:n[1],face1:s,face2:void 0}:i[h].face2=s}for(h in i)(void 0===(n=i[h]).face2||a[n.face1].normal.dot(a[n.face2].normal)<=e)&&(o=t[n.index1],r.push(o.x,o.y,o.z),o=t[n.index2],r.push(o.x,o.y,o.z));this.addAttribute("position",new O(r,3))}function Rr(t,e,r,n,i,o,a,s){E.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new Nr(t,e,r,n,i,o,a,s)),this.mergeVertices()}function Nr(p,f,d,m,g,t,y,v){function e(t){var e,r=new H,n=new St,i=0,o=!0===t?p:f,a=!0===t?1:-1,s=E;for(e=1;e<=m;e++)x.push(0,M*a,0),w.push(0,a,0),S.push(.5,.5),E++;var u=E;for(e=0;e<=m;e++){var c=e/m*v+y,l=Math.cos(c);c=Math.sin(c),n.x=o*c,n.y=M*a,n.z=o*l,x.push(n.x,n.y,n.z),w.push(0,a,0),r.x=.5*l+.5,r.y=.5*c*a+.5,S.push(r.x,r.y),E++}for(e=0;e<m;e++)r=s+e,n=u+e,!0===t?b.push(n,n+1,r):b.push(n+1,n,r),i+=3;_.addGroup(T,i,!0===t?1:2),T+=i}A.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:p,radiusBottom:f,height:d,radialSegments:m,heightSegments:g,openEnded:t,thetaStart:y,thetaLength:v};var _=this;p=void 0!==p?p:1,f=void 0!==f?f:1,d=d||1,m=Math.floor(m)||8,g=Math.floor(g)||1,t=void 0!==t&&t,y=void 0!==y?y:0,v=void 0!==v?v:2*Math.PI;var b=[],x=[],w=[],S=[],E=0,C=[],M=d/2,T=0;!function(){var t,e,r=new St,n=new St,i=0,o=(f-p)/d;for(e=0;e<=g;e++){var a=[],s=e/g,u=s*(f-p)+p;for(t=0;t<=m;t++){var c=t/m,l=c*v+y,h=Math.sin(l);l=Math.cos(l),n.x=u*h,n.y=-s*d+M,n.z=u*l,x.push(n.x,n.y,n.z),r.set(h,o,l).normalize(),w.push(r.x,r.y,r.z),S.push(c,1-s),a.push(E++)}C.push(a)}for(t=0;t<m;t++)for(e=0;e<g;e++)r=C[e+1][t],n=C[e+1][t+1],o=C[e][t+1],b.push(C[e][t],r,o),b.push(r,n,o),i+=6;_.addGroup(T,i,0),T+=i}(),!1===t&&(0<p&&e(!0),0<f&&e(!1)),this.setIndex(b),this.addAttribute("position",new O(x,3)),this.addAttribute("normal",new O(w,3)),this.addAttribute("uv",new O(S,2))}function kr(t,e,r,n,i,o,a){Rr.call(this,0,t,e,r,n,i,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function Dr(t,e,r,n,i,o,a){Nr.call(this,0,t,e,r,n,i,o,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function jr(t,e,r,n){E.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new zr(t,e,r,n)),this.mergeVertices()}function zr(t,e,r,n){A.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},t=t||1,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,o=[],a=[],s=[],u=[],c=new St,l=new H;a.push(0,0,0),s.push(0,0,1),u.push(.5,.5);var h=0;for(i=3;h<=e;h++,i+=3){var p=r+h/e*n;c.x=t*Math.cos(p),c.y=t*Math.sin(p),a.push(c.x,c.y,c.z),s.push(0,0,1),l.x=(a[i]/t+1)/2,l.y=(a[i+1]/t+1)/2,u.push(l.x,l.y)}for(i=1;i<=e;i++)o.push(i,i+1,0);this.setIndex(o),this.addAttribute("position",new O(a,3)),this.addAttribute("normal",new O(s,3)),this.addAttribute("uv",new O(u,2))}function Fr(t){k.call(this),this.type="ShadowMaterial",this.color=new w(0),this.transparent=!0,this.setValues(t)}function Br(t){j.call(this,t),this.type="RawShaderMaterial"}function Ur(t){k.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new w(16777215),this.metalness=this.roughness=.5,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new w(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new H(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function Vr(t){Ur.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoatRoughness=this.clearCoat=0,this.setValues(t)}function Gr(t){k.call(this),this.type="MeshPhongMaterial",this.color=new w(16777215),this.specular=new w(1118481),this.shininess=30,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new w(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new H(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function qr(t){Gr.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function Hr(t){k.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new H(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.lights=this.fog=!1,this.setValues(t)}function $r(t){k.call(this),this.type="MeshLambertMaterial",this.color=new w(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new w(0),this.emissiveIntensity=1,this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)}function Wr(t){Me.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}function Xr(t,e,r){var n=this,i=!1,o=0,a=0,s=void 0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.itemStart=function(t){a++,!1===i&&void 0!==n.onStart&&n.onStart(t,o,a),i=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(i=!1,void 0!==n.onLoad)&&n.onLoad()},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this}}function Yr(t){this.manager=void 0!==t?t:_u}function Zr(t){this.manager=void 0!==t?t:_u,this._parser=null}function Kr(t){this.manager=void 0!==t?t:_u,this._parser=null}function Jr(t){this.manager=void 0!==t?t:_u}function Qr(t){this.manager=void 0!==t?t:_u}function tn(t){this.manager=void 0!==t?t:_u}function en(){this.type="Curve",this.arcLengthDivisions=200}function rn(t,e,r,n,i,o,a,s){en.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function nn(t,e,r,n,i,o){rn.call(this,t,e,r,r,n,i,o),this.type="ArcCurve"}function on(){var s=0,u=0,c=0,l=0;return{initCatmullRom:function(t,e,r,n,i){c=-3*(s=e)+3*r-2*(u=t=i*(r-t))-(n=i*(n-e)),l=2*e-2*r+t+n},initNonuniformCatmullRom:function(t,e,r,n,i,o,a){c=-3*(s=e)+3*r-2*(u=t=((e-t)/i-(r-t)/(i+o)+(r-e)/o)*o)-(n=((r-e)/o-(n-e)/(o+a)+(n-r)/a)*o),l=2*e-2*r+t+n},calc:function(t){var e=t*t;return s+u*t+c*e+l*e*t}}}function an(t,e,r,n){en.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=r||"centripetal",this.tension=n||.5}function sn(t,e,r,n,i){var o=t*t;return(2*r-2*n+(e=.5*(n-e))+(i=.5*(i-r)))*t*o+(-3*r+3*n-2*e-i)*o+e*t+r}function un(t,e,r,n){var i=1-t;return i*i*e+2*(1-t)*t*r+t*t*n}function cn(t,e,r,n,i){var o=1-t,a=1-t;return o*o*o*e+3*a*a*t*r+3*(1-t)*t*t*n+t*t*t*i}function ln(t,e,r,n){en.call(this),this.type="CubicBezierCurve",this.v0=t||new H,this.v1=e||new H,this.v2=r||new H,this.v3=n||new H}function hn(t,e,r,n){en.call(this),this.type="CubicBezierCurve3",this.v0=t||new St,this.v1=e||new St,this.v2=r||new St,this.v3=n||new St}function pn(t,e){en.call(this),this.type="LineCurve",this.v1=t||new H,this.v2=e||new H}function fn(t,e){en.call(this),this.type="LineCurve3",this.v1=t||new St,this.v2=e||new St}function dn(t,e,r){en.call(this),this.type="QuadraticBezierCurve",this.v0=t||new H,this.v1=e||new H,this.v2=r||new H}function mn(t,e,r){en.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new St,this.v1=e||new St,this.v2=r||new St}function gn(t){en.call(this),this.type="SplineCurve",this.points=t||[]}function yn(){en.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function vn(t){yn.call(this),this.type="Path",this.currentPoint=new H,t&&this.setFromPoints(t)}function _n(t){vn.call(this,t),this.uuid=po.generateUUID(),this.type="Shape",this.holes=[]}function bn(t,e){l.call(this),this.type="Light",this.color=new w(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function xn(t,e,r){bn.call(this,t,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(l.DefaultUp),this.updateMatrix(),this.groundColor=new w(e)}function wn(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new H(512,512),this.map=null,this.matrix=new wt}function Sn(){wn.call(this,new le(50,1,.5,500))}function En(t,e,r,n,i,o){bn.call(this,t,e),this.type="SpotLight",this.position.copy(l.DefaultUp),this.updateMatrix(),this.target=new l,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new Sn}function Cn(t,e,r,n){bn.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new wn(new le(90,1,.5,500))}function Mn(){wn.call(this,new f(-5,5,5,-5,.5,500))}function Tn(t,e){bn.call(this,t,e),this.type="DirectionalLight",this.position.copy(l.DefaultUp),this.updateMatrix(),this.target=new l,this.shadow=new Mn}function Pn(t,e){bn.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function On(t,e,r,n){bn.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function An(t,e,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(r),this.sampleValues=e,this.valueSize=r}function In(t,e,r,n){An.call(this,t,e,r,n),this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function Ln(t,e,r,n){An.call(this,t,e,r,n)}function Rn(t,e,r,n){An.call(this,t,e,r,n)}function Nn(t,e,r,n){if(void 0===t)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Mu.convertArray(e,this.TimeBufferType),this.values=Mu.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function kn(t,e,r){Nn.call(this,t,e,r)}function Dn(t,e,r,n){Nn.call(this,t,e,r,n)}function jn(t,e,r,n){Nn.call(this,t,e,r,n)}function zn(t,e,r,n){An.call(this,t,e,r,n)}function Fn(t,e,r,n){Nn.call(this,t,e,r,n)}function Bn(t,e,r,n){Nn.call(this,t,e,r,n)}function Un(t,e,r,n){Nn.call(this,t,e,r,n)}function Vn(t,e,r){this.name=t,this.tracks=r,this.duration=void 0!==e?e:-1,this.uuid=po.generateUUID(),this.duration<0&&this.resetDuration()}function Gn(t){if(void 0===t.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return jn;case"vector":case"vector2":case"vector3":case"vector4":return Un;case"color":return Dn;case"quaternion":return Fn;case"bool":case"boolean":return kn;case"string":return Bn}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var r=[],n=[];Mu.flattenJSON(t.keys,r,n,"value"),t.times=r,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}function qn(t){this.manager=void 0!==t?t:_u,this.textures={}}function Hn(t){this.manager=void 0!==t?t:_u}function $n(){}function Wn(t){"boolean"==typeof t&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:_u,this.withCredentials=!1}function Xn(t){this.manager=void 0!==t?t:_u,this.texturePath=""}function Yn(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==t?t:_u,this.options=void 0}function Zn(){this.type="ShapePath",this.color=new w,this.subPaths=[],this.currentPath=null}function Kn(t){this.type="Font",this.data=t}function Jn(t){this.manager=void 0!==t?t:_u}function Qn(t){this.manager=void 0!==t?t:_u}function ti(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new le,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new le,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function ei(t,e,r){l.call(this),this.type="CubeCamera";var i=new le(90,1,t,e);i.up.set(0,-1,0),i.lookAt(new St(1,0,0)),this.add(i);var o=new le(90,1,t,e);o.up.set(0,-1,0),o.lookAt(new St(-1,0,0)),this.add(o);var a=new le(90,1,t,e);a.up.set(0,0,1),a.lookAt(new St(0,1,0)),this.add(a);var s=new le(90,1,t,e);s.up.set(0,0,-1),s.lookAt(new St(0,-1,0)),this.add(s);var u=new le(90,1,t,e);u.up.set(0,-1,0),u.lookAt(new St(0,0,1)),this.add(u);var c=new le(90,1,t,e);c.up.set(0,-1,0),c.lookAt(new St(0,0,-1)),this.add(c),this.renderTarget=new n(r,r,{format:1022,magFilter:1006,minFilter:1006}),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var r=this.renderTarget,n=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,r.activeCubeFace=0,t.render(e,i,r),r.activeCubeFace=1,t.render(e,o,r),r.activeCubeFace=2,t.render(e,a,r),r.activeCubeFace=3,t.render(e,s,r),r.activeCubeFace=4,t.render(e,u,r),r.texture.generateMipmaps=n,r.activeCubeFace=5,t.render(e,c,r),t.setRenderTarget(null)},this.clear=function(t,e,r,n){for(var i=this.renderTarget,o=0;o<6;o++)i.activeCubeFace=o,t.setRenderTarget(i),t.clear(e,r,n);t.setRenderTarget(null)}}function ri(){l.call(this),this.type="AudioListener",this.context=Rc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function ni(t){l.call(this),this.type="Audio",this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.offset=this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function ii(t){ni.call(this,t),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function oi(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function ai(t,e,r){switch(this.binding=t,this.valueSize=r,t=Float64Array,e){case"quaternion":e=this._slerp;break;case"string":case"bool":t=Array,e=this._select;break;default:e=this._lerp}this.buffer=new t(4*r),this._mixBufferRegion=e,this.referenceCount=this.useCount=this.cumulativeWeight=0}function si(t,e,r){r=r||ui.parseTrackName(e),this._targetGroup=t,this._bindings=t.subscribe_(e,r)}function ui(t,e,r){this.path=e,this.parsedPath=r||ui.parseTrackName(e),this.node=ui.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function ci(){this.uuid=po.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,r=arguments.length;e!==r;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function li(t,e,r){this._mixer=t,this._clip=e,this._localRoot=r||null,e=(t=e.tracks).length,r=Array(e);for(var n={endingStart:2400,endingEnd:2400},i=0;i!==e;++i){var o=t[i].createInterpolant(null);(r[i]=o).settings=n}this._interpolantSettings=n,this._interpolants=r,this._propertyBindings=Array(e),this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function hi(t){this._root=t,this._initMemoryManager(),this.time=this._accuIndex=0,this.timeScale=1}function pi(t,e){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=e),this.value=t}function fi(){A.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function di(t,e,r){ve.call(this,t,e),this.meshPerAttribute=r||1}function mi(t,e,r){v.call(this,t,e),this.meshPerAttribute=r||1}function gi(t,e,r,n){this.ray=new z(t,e),this.near=r||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function yi(t,e){return t.distance-e.distance}function vi(t,e,r,n){if(!1!==t.visible&&(t.raycast(e,r),!0===n)){n=0;for(var i=(t=t.children).length;n<i;n++)vi(t[n],e,r,!0)}}function _i(t){this.autoStart=void 0===t||t,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1}function bi(t,e,r){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==r?r:0,this}function xi(t,e,r){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==r?r:0,this}function wi(t,e){this.min=void 0!==t?t:new H(1/0,1/0),this.max=void 0!==e?e:new H(-1/0,-1/0)}function Si(t,e){this.start=void 0!==t?t:new St,this.end=void 0!==e?e:new St}function Ei(t){l.call(this),this.material=t,this.render=function(){}}function Ci(t,e,r,n){this.object=t,this.size=void 0!==e?e:1,t=void 0!==r?r:16711680,n=void 0!==n?n:1,e=0,(r=this.object.geometry)&&r.isGeometry?e=3*r.faces.length:r&&r.isBufferGeometry&&(e=r.attributes.normal.count),r=new A,e=new O(6*e,3),r.addAttribute("position",e),Pe.call(this,r,new Me({color:t,linewidth:n})),this.matrixAutoUpdate=!1,this.update()}function Mi(t,e){l.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e,t=new A,e=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var r=0,n=1;r<32;r++,n++){var i=r/32*Math.PI*2,o=n/32*Math.PI*2;e.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}t.addAttribute("position",new O(e,3)),e=new Me({fog:!1}),this.cone=new Pe(t,e),this.add(this.cone),this.update()}function Ti(t){for(var e=function t(e){var r=[];e&&e.isBone&&r.push(e);for(var n=0;n<e.children.length;n++)r.push.apply(r,t(e.children[n]));return r}(t),r=new A,n=[],i=[],o=new w(0,0,1),a=new w(0,1,0),s=0;s<e.length;s++){var u=e[s];u.parent&&u.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}r.addAttribute("position",new O(n,3)),r.addAttribute("color",new O(i,3)),n=new Me({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0}),Pe.call(this,r,n),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function Pi(t,e,r){this.light=t,this.light.updateMatrixWorld(),this.color=r,t=new Er(e,4,2),e=new D({wireframe:!0,fog:!1}),B.call(this,t,e),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Oi(t,e){l.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e,t=new Me({fog:!1}),(e=new A).addAttribute("position",new v(new Float32Array(15),3)),this.line=new Te(e,t),this.add(this.line),this.update()}function Ai(t,e,r){l.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,(t=new qe(e)).rotateY(.5*Math.PI),this.material=new D({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2),e=t.getAttribute("position"),e=new Float32Array(3*e.count),t.addAttribute("color",new v(e,3)),this.add(new B(t,this.material)),this.update()}function Ii(t,e,r,n){t=t||10,e=e||10,r=new w(void 0!==r?r:4473924),n=new w(void 0!==n?n:8947848);var i=e/2,o=t/e,a=t/2;t=[];for(var s=[],u=0,c=0,l=-a;u<=e;u++,l+=o){t.push(-a,0,l,a,0,l),t.push(l,0,-a,l,0,a);var h=u===i?r:n;h.toArray(s,c),c+=3,h.toArray(s,c),c+=3,h.toArray(s,c),c+=3,h.toArray(s,c),c+=3}(e=new A).addAttribute("position",new O(t,3)),e.addAttribute("color",new O(s,3)),r=new Me({vertexColors:2}),Pe.call(this,e,r)}function Li(t,e,r,n,i,o){t=t||10,e=e||16,r=r||8,n=n||64,i=new w(void 0!==i?i:4473924),o=new w(void 0!==o?o:8947848);var a,s=[],u=[];for(a=0;a<=e;a++){var c=a/e*2*Math.PI,l=Math.sin(c)*t;c=Math.cos(c)*t,s.push(0,0,0),s.push(l,0,c);var h=1&a?i:o;u.push(h.r,h.g,h.b),u.push(h.r,h.g,h.b)}for(a=0;a<=r;a++){h=1&a?i:o;var p=t-t/r*a;for(e=0;e<n;e++)c=e/n*2*Math.PI,l=Math.sin(c)*p,c=Math.cos(c)*p,s.push(l,0,c),u.push(h.r,h.g,h.b),c=(e+1)/n*2*Math.PI,l=Math.sin(c)*p,c=Math.cos(c)*p,s.push(l,0,c),u.push(h.r,h.g,h.b)}(t=new A).addAttribute("position",new O(s,3)),t.addAttribute("color",new O(u,3)),s=new Me({vertexColors:2}),Pe.call(this,t,s)}function Ri(t,e,r,n){this.object=t,this.size=void 0!==e?e:1,t=void 0!==r?r:16776960,n=void 0!==n?n:1,e=0,(r=this.object.geometry)&&r.isGeometry?e=r.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead."),r=new A,e=new O(6*e,3),r.addAttribute("position",e),Pe.call(this,r,new Me({color:t,linewidth:n})),this.matrixAutoUpdate=!1,this.update()}function Ni(t,e,r){l.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===e&&(e=1),(t=new A).addAttribute("position",new O([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3)),e=new Me({fog:!1}),this.lightPlane=new Te(t,e),this.add(this.lightPlane),(t=new A).addAttribute("position",new O([0,0,0,0,0,1],3)),this.targetLine=new Te(t,e),this.add(this.targetLine),this.update()}function ki(t){function e(t,e,r){n(t,r),n(e,r)}function n(t,e){o.push(0,0,0),a.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(o.length/3-1)}var r=new A,i=new Me({color:16777215,vertexColors:1}),o=[],a=[],s={},u=new w(16755200),c=new w(16711680),l=new w(43775),h=new w(16777215),p=new w(3355443);e("n1","n2",u),e("n2","n4",u),e("n4","n3",u),e("n3","n1",u),e("f1","f2",u),e("f2","f4",u),e("f4","f3",u),e("f3","f1",u),e("n1","f1",u),e("n2","f2",u),e("n3","f3",u),e("n4","f4",u),e("p","n1",c),e("p","n2",c),e("p","n3",c),e("p","n4",c),e("u1","u2",l),e("u2","u3",l),e("u3","u1",l),e("c","t",h),e("p","c",p),e("cn1","cn2",p),e("cn3","cn4",p),e("cf1","cf2",p),e("cf3","cf4",p),r.addAttribute("position",new O(o,3)),r.addAttribute("color",new O(a,3)),Pe.call(this,r,i),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}function Di(t,e){this.object=t,void 0===e&&(e=16776960),t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var r=new Float32Array(24),n=new A;n.setIndex(new v(t,1)),n.addAttribute("position",new v(r,3)),Pe.call(this,n,new Me({color:e})),this.matrixAutoUpdate=!1,this.update()}function ji(t,e){this.type="Box3Helper",this.box=t,t=void 0!==e?e:16776960,e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var r=new A;r.setIndex(new v(e,1)),r.addAttribute("position",new O([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Pe.call(this,r,new Me({color:t})),this.geometry.computeBoundingSphere()}function zi(t,e,r){this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e,t=void 0!==r?r:16776960,(e=new A).addAttribute("position",new O([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),e.computeBoundingSphere(),Te.call(this,e,new Me({color:t})),(e=new A).addAttribute("position",new O([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),e.computeBoundingSphere(),this.add(new B(e,new D({color:t,opacity:.2,transparent:!0,depthWrite:!1})))}function Fi(t,e,r,n,i,o){l.call(this),void 0===n&&(n=16776960),void 0===r&&(r=1),void 0===i&&(i=.2*r),void 0===o&&(o=.2*i),void 0===Pc&&((Pc=new A).addAttribute("position",new O([0,0,0,0,1,0],3)),(Oc=new Nr(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new Te(Pc,new Me({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new B(Oc,new D({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,i,o)}function Bi(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t];(t=new A).addAttribute("position",new O(e,3)),t.addAttribute("color",new O([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),e=new Me({vertexColors:2}),Pe.call(this,t,e)}function Ui(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),an.call(this,t),this.type="catmullrom",this.closed=!0}function Vi(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),an.call(this,t),this.type="catmullrom"}function Gi(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),an.call(this,t),this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:0<t?1:+t}),!1=="name"in Function.prototype&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}),Object.assign(e.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)},removeEventListener:function(t,e){void 0!==this._listeners&&(void 0!==(t=this._listeners[t])&&(-1!==(e=t.indexOf(e))&&t.splice(e,1)))},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var r=0,n=(e=e.slice(0)).length;r<n;r++)e[r].call(this,t)}}}});var qi,Hi,$i,Wi,Xi,Yi,Zi,Ki,Ji,Qi,to,eo,ro,no,io,oo,ao,so,uo,co,lo,ho,po={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var i=[],t=0;t<256;t++)i[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(i[255&t]+i[t>>8&255]+i[t>>16&255]+i[t>>24&255]+"-"+i[255&e]+i[e>>8&255]+"-"+i[e>>16&15|64]+i[e>>24&255]+"-"+i[63&r|128]+i[r>>8&255]+"-"+i[r>>16&255]+i[r>>24&255]+i[255&n]+i[n>>8&255]+i[n>>16&255]+i[n>>24&255]).toUpperCase()}}(),clamp:function(t,e,r){return Math.max(e,Math.min(r,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,r,n,i){return n+(t-e)*(i-n)/(r-e)},lerp:function(t,e,r){return(1-r)*t+r*e},smoothstep:function(t,e,r){return t<=e?0:r<=t?1:(t=(t-e)/(r-e))*t*(3-2*t)},smootherstep:function(t,e,r){return t<=e?0:r<=t?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*po.DEG2RAD},radToDeg:function(t){return t*po.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};Object.defineProperties(H.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(H.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.y=this.x=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,r=this.y;return t=t.elements,this.x=t[0]*e+t[3]*r+t[6],this.y=t[1]*e+t[4]*r+t[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:(qi=new H,Hi=new H,function(t,e){return qi.set(t,t),Hi.set(e,e),this.clamp(qi,Hi)}),clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x;return e*e+(t=this.y-t.y)*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var r=Math.cos(e);e=Math.sin(e);var n=this.x-t.x,i=this.y-t.y;return this.x=n*r-i*e+t.x,this.y=n*e+i*r+t.y,this}}),Object.assign(wt.prototype,{isMatrix4:!0,set:function(t,e,r,n,i,o,a,s,u,c,l,h,p,f,d,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=r,g[12]=n,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=u,g[6]=c,g[10]=l,g[14]=h,g[3]=p,g[7]=f,g[11]=d,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new wt).fromArray(this.elements)},copy:function(t){var e=this.elements;return t=t.elements,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this},copyPosition:function(t){var e=this.elements;return t=t.elements,e[12]=t[12],e[13]=t[13],e[14]=t[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:(to=new St,function(t){var e=this.elements,r=t.elements,n=1/to.setFromMatrixColumn(t,0).length(),i=1/to.setFromMatrixColumn(t,1).length();return t=1/to.setFromMatrixColumn(t,2).length(),e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=0,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=0,e[8]=r[8]*t,e[9]=r[9]*t,e[10]=r[10]*t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,n=t.y,i=t.z,o=Math.cos(r);r=Math.sin(r);var a=Math.cos(n);n=Math.sin(n);var s=Math.cos(i);if(i=Math.sin(i),"XYZ"===t.order){t=o*s;var u=o*i,c=r*s,l=r*i;e[0]=a*s,e[4]=-a*i,e[8]=n,e[1]=u+c*n,e[5]=t-l*n,e[9]=-r*a,e[2]=l-t*n,e[6]=c+u*n,e[10]=o*a}else"YXZ"===t.order?(t=a*s,u=a*i,c=n*s,l=n*i,e[0]=t+l*r,e[4]=c*r-u,e[8]=o*n,e[1]=o*i,e[5]=o*s,e[9]=-r,e[2]=u*r-c,e[6]=l+t*r,e[10]=o*a):"ZXY"===t.order?(t=a*s,u=a*i,c=n*s,l=n*i,e[0]=t-l*r,e[4]=-o*i,e[8]=c+u*r,e[1]=u+c*r,e[5]=o*s,e[9]=l-t*r,e[2]=-o*n,e[6]=r,e[10]=o*a):"ZYX"===t.order?(t=o*s,u=o*i,c=r*s,l=r*i,e[0]=a*s,e[4]=c*n-u,e[8]=t*n+l,e[1]=a*i,e[5]=l*n+t,e[9]=u*n-c,e[2]=-n,e[6]=r*a,e[10]=o*a):"YZX"===t.order?(t=o*a,u=o*n,c=r*a,l=r*n,e[0]=a*s,e[4]=l-t*i,e[8]=c*i+u,e[1]=i,e[5]=o*s,e[9]=-r*s,e[2]=-n*s,e[6]=u*i+c,e[10]=t-l*i):"XZY"===t.order&&(t=o*a,u=o*n,c=r*a,l=r*n,e[0]=a*s,e[4]=-i,e[8]=n*s,e[1]=t*i+l,e[5]=o*s,e[9]=u*i-c,e[2]=c*i-u,e[6]=r*s,e[10]=l*i+t);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:(Ji=new St(0,0,0),Qi=new St(1,1,1),function(t){return this.compose(Ji,t,Qi)}),lookAt:(Yi=new St,Zi=new St,Ki=new St,function(t,e,r){var n=this.elements;return Ki.subVectors(t,e),0===Ki.lengthSq()&&(Ki.z=1),Ki.normalize(),Yi.crossVectors(r,Ki),0===Yi.lengthSq()&&(1===Math.abs(r.z)?Ki.x+=1e-4:Ki.z+=1e-4,Ki.normalize(),Yi.crossVectors(r,Ki)),Yi.normalize(),Zi.crossVectors(Ki,Yi),n[0]=Yi.x,n[4]=Zi.x,n[8]=Ki.x,n[1]=Yi.y,n[5]=Zi.y,n[9]=Ki.y,n[2]=Yi.z,n[6]=Zi.z,n[10]=Ki.z,this}),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements;e=this.elements,t=r[0];var i=r[4],o=r[8],a=r[12],s=r[1],u=r[5],c=r[9],l=r[13],h=r[2],p=r[6],f=r[10],d=r[14],m=r[3],g=r[7],y=r[11];r=r[15];var v=n[0],_=n[4],b=n[8],x=n[12],w=n[1],S=n[5],E=n[9],C=n[13],M=n[2],T=n[6],P=n[10],O=n[14],A=n[3],I=n[7],L=n[11];return n=n[15],e[0]=t*v+i*w+o*M+a*A,e[4]=t*_+i*S+o*T+a*I,e[8]=t*b+i*E+o*P+a*L,e[12]=t*x+i*C+o*O+a*n,e[1]=s*v+u*w+c*M+l*A,e[5]=s*_+u*S+c*T+l*I,e[9]=s*b+u*E+c*P+l*L,e[13]=s*x+u*C+c*O+l*n,e[2]=h*v+p*w+f*M+d*A,e[6]=h*_+p*S+f*T+d*I,e[10]=h*b+p*E+f*P+d*L,e[14]=h*x+p*C+f*O+d*n,e[3]=m*v+g*w+y*M+r*A,e[7]=m*_+g*S+y*T+r*I,e[11]=m*b+g*E+y*P+r*L,e[15]=m*x+g*C+y*O+r*n,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:(Xi=new St,function(t){for(var e=0,r=t.count;e<r;e++)Xi.x=t.getX(e),Xi.y=t.getY(e),Xi.z=t.getZ(e),Xi.applyMatrix4(this),t.setXYZ(e,Xi.x,Xi.y,Xi.z);return t}),determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],o=t[1],a=t[5],s=t[9],u=t[13],c=t[2],l=t[6],h=t[10],p=t[14];return t[3]*(+i*s*l-n*u*l-i*a*h+r*u*h+n*a*p-r*s*p)+t[7]*(+e*s*p-e*u*h+i*o*h-n*o*p+n*u*c-i*s*c)+t[11]*(+e*u*l-e*a*p-i*o*l+r*o*p+i*a*c-r*u*c)+t[15]*(-n*a*c-e*s*l+e*a*h+n*o*l-r*o*h+r*s*c)},transpose:function(){var t=this.elements,e=t[1];return t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var r=this.elements,n=t.elements;t=n[0];var i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=n[6],l=n[7],h=n[8],p=n[9],f=n[10],d=n[11],m=n[12],g=n[13],y=n[14],v=p*y*l-g*f*l+g*c*d-u*y*d-p*c*(n=n[15])+u*f*n,_=m*f*l-h*y*l-m*c*d+s*y*d+h*c*n-s*f*n,b=h*g*l-m*p*l+m*u*d-s*g*d-h*u*n+s*p*n,x=m*p*c-h*g*c-m*u*f+s*g*f+h*u*y-s*p*y,w=t*v+i*_+o*b+a*x;if(0!=w)return e=1/w,r[0]=v*e,r[1]=(g*f*a-p*y*a-g*o*d+i*y*d+p*o*n-i*f*n)*e,r[2]=(u*y*a-g*c*a+g*o*l-i*y*l-u*o*n+i*c*n)*e,r[3]=(p*c*a-u*f*a-p*o*l+i*f*l+u*o*d-i*c*d)*e,r[4]=_*e,r[5]=(h*y*a-m*f*a+m*o*d-t*y*d-h*o*n+t*f*n)*e,r[6]=(m*c*a-s*y*a-m*o*l+t*y*l+s*o*n-t*c*n)*e,r[7]=(s*f*a-h*c*a+h*o*l-t*f*l-s*o*d+t*c*d)*e,r[8]=b*e,r[9]=(m*p*a-h*g*a-m*i*d+t*g*d+h*i*n-t*p*n)*e,r[10]=(s*g*a-m*u*a+m*i*l-t*g*l-s*i*n+t*u*n)*e,r[11]=(h*u*a-s*p*a-h*i*l+t*p*l+s*i*d-t*u*d)*e,r[12]=x*e,r[13]=(h*g*o-m*p*o+m*i*f-t*g*f-h*i*y+t*p*y)*e,r[14]=(m*u*o-s*g*o-m*i*c+t*g*c+s*i*y-t*u*y)*e,r[15]=(s*p*o-h*u*o+h*i*c-t*p*c-s*i*f+t*u*f)*e,this;if(!0===e)throw Error("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");return console.warn("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0"),this.identity()},scale:function(t){var e=this.elements,r=t.x,n=t.y;return t=t.z,e[0]*=r,e[4]*=n,e[8]*=t,e[1]*=r,e[5]*=n,e[9]*=t,e[2]*=r,e[6]*=n,e[10]*=t,e[3]*=r,e[7]*=n,e[11]*=t,this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t);return t=Math.sin(t),this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e);e=Math.sin(e);var n=1-r,i=t.x,o=t.y;t=t.z;var a=n*i,s=n*o;return this.set(a*i+r,a*o-e*t,a*t+e*o,0,a*o+e*t,s*o+r,s*t-e*i,0,a*t-e*o,s*t+e*i,n*t*t+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(t,e,r){return this.set(1,e,r,0,t,1,r,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,r){var n=this.elements,i=e._x,o=e._y,a=e._z,s=e._w,u=i+i,c=o+o,l=a+a;e=i*u;var h=i*c;i*=l;var p=o*c;o*=l,a*=l,u*=s,c*=s,s*=l,l=r.x;var f=r.y;return r=r.z,n[0]=(1-(p+a))*l,n[1]=(h+s)*l,n[2]=(i-c)*l,n[3]=0,n[4]=(h-s)*f,n[5]=(1-(e+a))*f,n[6]=(o+u)*f,n[7]=0,n[8]=(i+c)*r,n[9]=(o-u)*r,n[10]=(1-(e+p))*r,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this},decompose:($i=new St,Wi=new wt,function(t,e,r){var n=this.elements,i=$i.set(n[0],n[1],n[2]).length(),o=$i.set(n[4],n[5],n[6]).length(),a=$i.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),t.x=n[12],t.y=n[13],t.z=n[14],Wi.copy(this),t=1/i,n=1/o;var s=1/a;return Wi.elements[0]*=t,Wi.elements[1]*=t,Wi.elements[2]*=t,Wi.elements[4]*=n,Wi.elements[5]*=n,Wi.elements[6]*=n,Wi.elements[8]*=s,Wi.elements[9]*=s,Wi.elements[10]*=s,e.setFromRotationMatrix(Wi),r.x=i,r.y=o,r.z=a,this}),makePerspective:function(t,e,r,n,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements;return a[0]=2*i/(e-t),a[4]=0,a[8]=(e+t)/(e-t),a[12]=0,a[1]=0,a[5]=2*i/(r-n),a[9]=(r+n)/(r-n),a[13]=0,a[2]=0,a[6]=0,a[10]=-(o+i)/(o-i),a[14]=-2*o*i/(o-i),a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,r,n,i,o){var a=this.elements,s=1/(e-t),u=1/(r-n),c=1/(o-i);return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-(e+t)*s,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-(r+n)*u,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-(o+i)*c,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){var e=this.elements;t=t.elements;for(var r=0;r<16;r++)if(e[r]!==t[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}}),Object.assign(s,{slerp:function(t,e,r,n){return r.copy(t).slerp(e,n)},slerpFlat:function(t,e,r,n,i,o,a){var s=r[n+0],u=r[n+1],c=r[n+2];r=r[n+3],n=i[o+0];var l=i[o+1],h=i[o+2];if(r!==(i=i[o+3])||s!==n||u!==l||c!==h){o=1-a;var p=s*n+u*l+c*h+r*i,f=0<=p?1:-1,d=1-p*p;d>Number.EPSILON&&(d=Math.sqrt(d),p=Math.atan2(d,p*f),o=Math.sin(o*p)/d,a=Math.sin(a*p)/d),s=s*o+n*(f*=a),u=u*o+l*f,c=c*o+h*f,r=r*o+i*f,o===1-a&&(s*=a=1/Math.sqrt(s*s+u*u+c*c+r*r),u*=a,c*=a,r*=a)}t[e]=s,t[e+1]=u,t[e+2]=c,t[e+3]=r}}),Object.defineProperties(s.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(s.prototype,{set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=t._x,n=t._y,i=t._z;t=t.order;var o=Math.cos,a=Math.sin,s=o(r/2),u=o(n/2);return o=o(i/2),r=a(r/2),n=a(n/2),i=a(i/2),"XYZ"===t?(this._x=r*u*o+s*n*i,this._y=s*n*o-r*u*i,this._z=s*u*i+r*n*o,this._w=s*u*o-r*n*i):"YXZ"===t?(this._x=r*u*o+s*n*i,this._y=s*n*o-r*u*i,this._z=s*u*i-r*n*o,this._w=s*u*o+r*n*i):"ZXY"===t?(this._x=r*u*o-s*n*i,this._y=s*n*o+r*u*i,this._z=s*u*i+r*n*o,this._w=s*u*o-r*n*i):"ZYX"===t?(this._x=r*u*o-s*n*i,this._y=s*n*o+r*u*i,this._z=s*u*i-r*n*o,this._w=s*u*o+r*n*i):"YZX"===t?(this._x=r*u*o+s*n*i,this._y=s*n*o+r*u*i,this._z=s*u*i-r*n*o,this._w=s*u*o-r*n*i):"XZY"===t&&(this._x=r*u*o-s*n*i,this._y=s*n*o-r*u*i,this._z=s*u*i+r*n*o,this._w=s*u*o+r*n*i),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){e/=2;var r=Math.sin(e);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(e),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e=t.elements,r=e[0];t=e[4];var n=e[8],i=e[1],o=e[5],a=e[9],s=e[2],u=e[6],c=r+o+(e=e[10]);return 0<c?(r=.5/Math.sqrt(c+1),this._w=.25/r,this._x=(u-a)*r,this._y=(n-s)*r,this._z=(i-t)*r):o<r&&e<r?(r=2*Math.sqrt(1+r-o-e),this._w=(u-a)/r,this._x=.25*r,this._y=(t+i)/r,this._z=(n+s)/r):e<o?(r=2*Math.sqrt(1+o-r-e),this._w=(n-s)/r,this._x=(t+i)/r,this._y=.25*r,this._z=(a+u)/r):(r=2*Math.sqrt(1+e-r-o),this._w=(i-t)/r,this._x=(n+s)/r,this._y=(a+u)/r,this._z=.25*r),this.onChangeCallback(),this},setFromUnitVectors:(ro=new St,function(t,e){return void 0===ro&&(ro=new St),(eo=t.dot(e)+1)<1e-6?(eo=0,Math.abs(t.x)>Math.abs(t.z)?ro.set(-t.y,t.x,0):ro.set(0,-t.z,t.y)):ro.crossVectors(t,e),this._x=ro.x,this._y=ro.y,this._z=ro.z,this._w=eo,this.normalize()}),angleTo:function(t){return 2*Math.acos(Math.abs(po.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var r=this.angleTo(t);return 0===r||this.slerp(t,Math.min(1,e/r)),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._z=this._y=this._x=0,this._w=1):(t=1/t,this._x*=t,this._y*=t,this._z*=t,this._w*=t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var r=t._x,n=t._y,i=t._z;t=t._w;var o=e._x,a=e._y,s=e._z;return e=e._w,this._x=r*e+t*o+n*s-i*a,this._y=n*e+t*a+i*o-r*s,this._z=i*e+t*s+r*a-n*o,this._w=t*e-r*o-n*a-i*s,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,n=this._y,i=this._z,o=this._w,a=o*t._w+r*t._x+n*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),1<=a)return this._w=o,this._x=r,this._y=n,this._z=i,this;if((t=1-a*a)<=Number.EPSILON)return a=1-e,this._w=a*o+e*this._w,this._x=a*r+e*this._x,this._y=a*n+e*this._y,this._z=a*i+e*this._z,this.normalize();t=Math.sqrt(t);var s=Math.atan2(t,a);return a=Math.sin((1-e)*s)/t,e=Math.sin(e*s)/t,this._w=o*a+this._w*e,this._x=r*a+this._x*e,this._y=n*a+this._y*e,this._z=i*a+this._z*e,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(St.prototype,{isVector3:!0,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setScalar:function(t){return this.z=this.y=this.x=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:(lo=new s,function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(lo.setFromEuler(t))}),applyAxisAngle:(co=new s,function(t,e){return this.applyQuaternion(co.setFromAxisAngle(t,e))}),applyMatrix3:function(t){var e=this.x,r=this.y,n=this.z;return t=t.elements,this.x=t[0]*e+t[3]*r+t[6]*n,this.y=t[1]*e+t[4]*r+t[7]*n,this.z=t[2]*e+t[5]*r+t[8]*n,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=1/((t=t.elements)[3]*e+t[7]*r+t[11]*n+t[15]);return this.x=(t[0]*e+t[4]*r+t[8]*n+t[12])*i,this.y=(t[1]*e+t[5]*r+t[9]*n+t[13])*i,this.z=(t[2]*e+t[6]*r+t[10]*n+t[14])*i,this},applyQuaternion:function(t){var e=this.x,r=this.y,n=this.z,i=t.x,o=t.y,a=t.z,s=(t=t.w)*e+o*n-a*r,u=t*r+a*e-i*n,c=t*n+i*r-o*e;return e=-i*e-o*r-a*n,this.x=s*t+e*-i+u*-a-c*-o,this.y=u*t+e*-o+c*-i-s*-a,this.z=c*t+e*-a+s*-o-u*-i,this},project:(uo=new wt,function(t){return uo.multiplyMatrices(t.projectionMatrix,uo.getInverse(t.matrixWorld)),this.applyMatrix4(uo)}),unproject:(so=new wt,function(t){return so.multiplyMatrices(t.matrixWorld,so.getInverse(t.projectionMatrix)),this.applyMatrix4(so)}),transformDirection:function(t){var e=this.x,r=this.y,n=this.z;return t=t.elements,this.x=t[0]*e+t[4]*r+t[8]*n,this.y=t[1]*e+t[5]*r+t[9]*n,this.z=t[2]*e+t[6]*r+t[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:(oo=new St,ao=new St,function(t,e){return oo.set(t,t,t),ao.set(e,e,e),this.clamp(oo,ao)}),clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var r=t.x,n=t.y;t=t.z;var i=e.x,o=e.y;return e=e.z,this.x=n*e-t*o,this.y=t*i-r*e,this.z=r*o-n*i,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:(io=new St,function(t){return io.copy(this).projectOnVector(t),this.sub(io)}),reflect:(no=new St,function(t){return this.sub(no.copy(t).multiplyScalar(2*this.dot(t)))}),angleTo:function(t){return t=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq()),Math.acos(po.clamp(t,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r+(t=this.z-t.z)*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){return t=t.elements,this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length();return t=this.setFromMatrixColumn(t,2).length(),this.x=e,this.y=r,this.z=t,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(g.prototype,{isMatrix3:!0,set:function(t,e,r,n,i,o,a,s,u){var c=this.elements;return c[0]=t,c[1]=n,c[2]=a,c[3]=e,c[4]=i,c[5]=s,c[6]=r,c[7]=o,c[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements;return t=t.elements,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this},setFromMatrix4:function(t){return t=t.elements,this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:(ho=new St,function(t){for(var e=0,r=t.count;e<r;e++)ho.x=t.getX(e),ho.y=t.getY(e),ho.z=t.getZ(e),ho.applyMatrix3(this),t.setXYZ(e,ho.x,ho.y,ho.z);return t}),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements;e=this.elements,t=r[0];var i=r[3],o=r[6],a=r[1],s=r[4],u=r[7],c=r[2],l=r[5];r=r[8];var h=n[0],p=n[3],f=n[6],d=n[1],m=n[4],g=n[7],y=n[2],v=n[5];return n=n[8],e[0]=t*h+i*d+o*y,e[3]=t*p+i*m+o*v,e[6]=t*f+i*g+o*n,e[1]=a*h+s*d+u*y,e[4]=a*p+s*m+u*v,e[7]=a*f+s*g+u*n,e[2]=c*h+l*d+r*y,e[5]=c*p+l*m+r*v,e[8]=c*f+l*g+r*n,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7];return e*o*(t=t[8])-e*a*u-r*i*t+r*a*s+n*i*u-n*o*s},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=t.elements;t=this.elements;var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],u=r[5],c=r[6],l=r[7],h=(r=r[8])*s-u*l,p=u*c-r*a,f=l*a-s*c,d=n*h+i*p+o*f;if(0!=d)return e=1/d,t[0]=h*e,t[1]=(o*l-r*i)*e,t[2]=(u*i-o*s)*e,t[3]=p*e,t[4]=(r*n-o*c)*e,t[5]=(o*a-u*n)*e,t[6]=f*e,t[7]=(i*c-l*n)*e,t[8]=(s*n-i*a)*e,this;if(!0===e)throw Error("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");return console.warn("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0"),this.identity()},transpose:function(){var t=this.elements,e=t[1];return t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,r,n,i,o,a){var s=Math.cos(i);i=Math.sin(i),this.set(r*s,r*i,-r*(s*o+i*a)+o+t,-n*i,n*s,-n*(-i*o+s*a)+a+e,0,0,1)},scale:function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},rotate:function(t){var e=Math.cos(t);t=Math.sin(t);var r=this.elements,n=r[0],i=r[3],o=r[6],a=r[1],s=r[4],u=r[7];return r[0]=e*n+t*a,r[3]=e*i+t*s,r[6]=e*o+t*u,r[1]=-t*n+e*a,r[4]=-t*i+e*s,r[7]=-t*o+e*u,this},translate:function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},equals:function(t){var e=this.elements;t=t.elements;for(var r=0;r<9;r++)if(e[r]!==t[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}});var fo,mo,go,yo,vo,_o,bo,xo,wo,So,Eo,Co,Mo,To,Po,Oo,Ao,Io,Lo,Ro,No,ko,Do,jo,zo,Fo,Bo,Uo,Vo,Go={getDataURL:function(t){if(t instanceof HTMLCanvasElement)var e=t;else{"undefined"!=typeof OffscreenCanvas?e=new OffscreenCanvas(t.width,t.height):((e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=t.width,e.height=t.height);var r=e.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height)}return 2048<e.width||2048<e.height?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},qo=0;function Ho(t){var e,r=0;for(e=t.length-3;r<=e;r+=3){Eo.fromArray(t,r);var n=Mo.x*Math.abs(Eo.x)+Mo.y*Math.abs(Eo.y)+Mo.z*Math.abs(Eo.z),i=vo.dot(Eo),o=_o.dot(Eo),a=bo.dot(Eo);if(Math.max(-Math.max(i,o,a),Math.min(i,o,a))>n)return!1}return!0}function $o(t){var e=t.geometry;if(void 0!==e)if(e.isGeometry)for(e=e.vertices,Ao=0,Io=e.length;Ao<Io;Ao++)Lo.copy(e[Ao]),Lo.applyMatrix4(t.matrixWorld),Oo.expandByPoint(Lo);else if(e.isBufferGeometry&&void 0!==(e=e.attributes.position))for(Ao=0,Io=e.count;Ao<Io;Ao++)Lo.fromBufferAttribute(e,Ao).applyMatrix4(t.matrixWorld),Oo.expandByPoint(Lo)}p.DEFAULT_IMAGE=void 0,p.DEFAULT_MAPPING=300,p.prototype=Object.assign(Object.create(e.prototype),{constructor:p,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var n=this.image;if(void 0===n.uuid&&(n.uuid=po.generateUUID()),!e&&void 0===t.images[n.uuid]){if(Array.isArray(n))for(var i=[],o=0,a=n.length;o<a;o++)i.push(Go.getDataURL(n[o]));else i=Go.getDataURL(n);t.images[n.uuid]={uuid:n.uuid,url:i}}r.image=n.uuid}return e||(t.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300===this.mapping){if(t.applyMatrix3(this.matrix),t.x<0||1<t.x)switch(this.wrapS){case 1e3:t.x-=Math.floor(t.x);break;case 1001:t.x=t.x<0?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||1<t.y)switch(this.wrapT){case 1e3:t.y-=Math.floor(t.y);break;case 1001:t.y=t.y<0?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}}),Object.defineProperty(p.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Et.prototype,{isVector4:!0,set:function(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this},setScalar:function(t){return this.w=this.z=this.y=this.x=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=this.w;return t=t.elements,this.x=t[0]*e+t[4]*r+t[8]*n+t[12]*i,this.y=t[1]*e+t[5]*r+t[9]*n+t[13]*i,this.z=t[2]*e+t[6]*r+t[10]*n+t[14]*i,this.w=t[3]*e+t[7]*r+t[11]*n+t[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.z=this.y=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e=(t=t.elements)[0],r=t[4],n=t[8],i=t[1],o=t[5],a=t[9],s=t[2],u=t[6],c=t[10];return Math.abs(r-i)<.01&&Math.abs(n-s)<.01&&Math.abs(a-u)<.01?Math.abs(r+i)<.1&&Math.abs(n+s)<.1&&Math.abs(a+u)<.1&&Math.abs(e+o+c-3)<.1?this.set(1,0,0,0):(t=Math.PI,c=(c+1)/2,r=(r+i)/4,n=(n+s)/4,a=(a+u)/4,(o=(o+1)/2)<(e=(e+1)/2)&&c<e?r=e<.01?(u=0,s=.707106781):(s=r/(u=Math.sqrt(e)),n/u):c<o?r=o<.01?(s=0,u=.707106781):(u=r/(s=Math.sqrt(o)),a/s):c<.01?(s=u=.707106781,r=0):(u=n/(r=Math.sqrt(c)),s=a/r),this.set(u,s,r,t)):(t=Math.sqrt((u-a)*(u-a)+(n-s)*(n-s)+(i-r)*(i-r)),Math.abs(t)<.001&&(t=1),this.x=(u-a)/t,this.y=(n-s)/t,this.z=(i-r)/t,this.w=Math.acos((e+o+c-1)/2)),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return void 0===fo&&(fo=new Et,mo=new Et),fo.set(t,t,t,t),mo.set(e,e,e,e),this.clamp(fo,mo)},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),T.prototype=Object.assign(Object.create(e.prototype),{constructor:T,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),((n.prototype=Object.create(T.prototype)).constructor=n).prototype.isWebGLRenderTargetCube=!0,((Ct.prototype=Object.create(p.prototype)).constructor=Ct).prototype.isDataTexture=!0,Object.assign(r.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,u=t.length;s<u;s+=3){var c=t[s],l=t[s+1],h=t[s+2];c<e&&(e=c),l<r&&(r=l),h<n&&(n=h),i<c&&(i=c),o<l&&(o=l),a<h&&(a=h)}return this.min.set(e,r,n),this.max.set(i,o,a),this},setFromBufferAttribute:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,u=t.count;s<u;s++){var c=t.getX(s),l=t.getY(s),h=t.getZ(s);c<e&&(e=c),l<r&&(r=l),h<n&&(n=h),i<c&&(i=c),o<l&&(o=l),a<h&&(a=h)}return this.min.set(e,r,n),this.max.set(i,o,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:(Ro=new St,function(t,e){return e=Ro.copy(e).multiplyScalar(.5),this.min.copy(t).sub(e),this.max.copy(t).add(e),this}),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new St),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new St),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:(Lo=new St,function(t){return Oo=this,t.updateMatrixWorld(!0),t.traverse($o),this}),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new St),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:(Po=new St,function(t){return this.clampPoint(t.center,Po),Po.distanceToSquared(t.center)<=t.radius*t.radius}),intersectsPlane:function(t){if(0<t.normal.x)var e=t.normal.x*this.min.x,r=t.normal.x*this.max.x;else e=t.normal.x*this.max.x,r=t.normal.x*this.min.x;return 0<t.normal.y?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),0<t.normal.z?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=t.constant&&r>=t.constant},intersectsTriangle:(vo=new St,_o=new St,bo=new St,xo=new St,wo=new St,So=new St,Eo=new St,Co=new St,Mo=new St,To=new St,function(t){return!this.isEmpty()&&(this.getCenter(Co),Mo.subVectors(this.max,Co),vo.subVectors(t.a,Co),_o.subVectors(t.b,Co),bo.subVectors(t.c,Co),xo.subVectors(_o,vo),wo.subVectors(bo,_o),So.subVectors(vo,bo),!!Ho(t=[0,-xo.z,xo.y,0,-wo.z,wo.y,0,-So.z,So.y,xo.z,0,-xo.x,wo.z,0,-wo.x,So.z,0,-So.x,-xo.y,xo.x,0,-wo.y,wo.x,0,-So.y,So.x,0])&&!!Ho(t=[1,0,0,0,1,0,0,0,1])&&(To.crossVectors(xo,wo),Ho(t=[To.x,To.y,To.z])))}),clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new St),e.copy(t).clamp(this.min,this.max)},distanceToPoint:(yo=new St,function(t){return yo.copy(t).clamp(this.min,this.max).sub(t).length()}),getBoundingSphere:(go=new St,function(t){return void 0===t&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),t=new a),this.getCenter(t.center),t.radius=.5*this.getSize(go).length(),t}),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){if(this.isEmpty())return this;var e=(t=t.elements)[0]*this.min.x,r=t[1]*this.min.x,n=t[2]*this.min.x,i=t[0]*this.max.x,o=t[1]*this.max.x,a=t[2]*this.max.x,s=t[4]*this.min.y,u=t[5]*this.min.y,c=t[6]*this.min.y,l=t[4]*this.max.y,h=t[5]*this.max.y,p=t[6]*this.max.y,f=t[8]*this.min.z,d=t[9]*this.min.z,m=t[10]*this.min.z,g=t[8]*this.max.z,y=t[9]*this.max.z,v=t[10]*this.max.z;return this.min.x=Math.min(e,i)+Math.min(s,l)+Math.min(f,g)+t[12],this.min.y=Math.min(r,o)+Math.min(u,h)+Math.min(d,y)+t[13],this.min.z=Math.min(n,a)+Math.min(c,p)+Math.min(m,v)+t[14],this.max.x=Math.max(e,i)+Math.max(s,l)+Math.max(f,g)+t[12],this.max.y=Math.max(r,o)+Math.max(u,h)+Math.max(d,y)+t[13],this.max.z=Math.max(n,a)+Math.max(c,p)+Math.max(m,v)+t[14],this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(a.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:(No=new r,function(t,e){var r=this.center;void 0!==e?r.copy(e):No.setFromPoints(t).getCenter(r);for(var n=e=0,i=t.length;n<i;n++)e=Math.max(e,r.distanceToSquared(t[n]));return this.radius=Math.sqrt(e),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var r=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new St),e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new r),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius*=t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(y.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,r,n){return this.normal.set(t,e,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:(zo=new St,Fo=new St,function(t,e,r){return e=zo.subVectors(r,e).cross(Fo.subVectors(t,e)).normalize(),this.setFromNormalAndCoplanarPoint(e,t),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new St),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:(jo=new St,function(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new St);var r=t.delta(jo),n=this.normal.dot(r);if(0===n){if(0===this.distanceToPoint(t.start))return e.copy(t.start)}else if(!((n=-(t.start.dot(this.normal)+this.constant)/n)<0||1<n))return e.copy(r).multiplyScalar(n).add(t.start)}),intersectsLine:function(t){var e=this.distanceToPoint(t.start);return t=this.distanceToPoint(t.end),e<0&&0<t||t<0&&0<e},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new St),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:(ko=new St,Do=new g,function(t,e){return e=e||Do.getNormalMatrix(t),t=this.coplanarPoint(ko).applyMatrix4(t),e=this.normal.applyMatrix3(e).normalize(),this.constant=-t.dot(e),this}),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}),Object.assign(Mt.prototype,{set:function(t,e,r,n,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(r),a[3].copy(n),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,r=0;r<6;r++)e[r].copy(t.planes[r]);return this},setFromMatrix:function(t){var e=this.planes,r=t.elements;t=r[0];var n=r[1],i=r[2],o=r[3],a=r[4],s=r[5],u=r[6],c=r[7],l=r[8],h=r[9],p=r[10],f=r[11],d=r[12],m=r[13],g=r[14];return r=r[15],e[0].setComponents(o-t,c-a,f-l,r-d).normalize(),e[1].setComponents(o+t,c+a,f+l,r+d).normalize(),e[2].setComponents(o+n,c+s,f+h,r+m).normalize(),e[3].setComponents(o-n,c-s,f-h,r-m).normalize(),e[4].setComponents(o-i,c-u,f-p,r-g).normalize(),e[5].setComponents(o+i,c+u,f+p,r+g).normalize(),this},intersectsObject:(Vo=new a,function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Vo.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Vo)}),intersectsSprite:(Uo=new a,function(t){return Uo.center.set(0,0,0),Uo.radius=.7071067811865476,Uo.applyMatrix4(t.matrixWorld),this.intersectsSphere(Uo)}),intersectsSphere:function(t){var e=this.planes,r=t.center;t=-t.radius;for(var n=0;n<6;n++)if(e[n].distanceToPoint(r)<t)return!1;return!0},intersectsBox:(Bo=new St,function(t){for(var e=this.planes,r=0;r<6;r++){var n=e[r];if(Bo.x=0<n.normal.x?t.max.x:t.min.x,Bo.y=0<n.normal.y?t.max.y:t.min.y,Bo.z=0<n.normal.z?t.max.z:t.min.z,n.distanceToPoint(Bo)<0)return!1}return!0}),containsPoint:function(t){for(var e=this.planes,r=0;r<6;r++)if(e[r].distanceToPoint(t)<0)return!1;return!0}});var Wo,Xo={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tvec4 mvPosition;\n\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n"},Yo={merge:function(t){for(var e={},r=0;r<t.length;r++){var n,i=this.clone(t[r]);for(n in i)e[n]=i[n]}return e},clone:function(t){var e,r={};for(e in t)for(var n in r[e]={},t[e]){var i=t[e][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?r[e][n]=i.clone():Array.isArray(i)?r[e][n]=i.slice():r[e][n]=i}return r}},Zo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ko(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function Jo(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Qo(t,e,r){return r<0&&(r+=1),1<r&&--r,r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}Object.assign(w.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.b=this.g=this.r=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,r){return this.r=t,this.g=e,this.b=r,this},setHSL:function(t,e,r){return t=po.euclideanModulo(t,1),e=po.clamp(e,0,1),r=po.clamp(r,0,1),0===e?this.r=this.g=this.b=r:(r=2*r-(e=r<=.5?r*(1+e):r+e-r*e),this.r=Qo(r,e,t+1/3),this.g=Qo(r,e,t),this.b=Qo(r,e,t-1/3)),this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n=r[2];switch(r[1]){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n)){n=parseFloat(r[1])/360;var i=parseInt(r[2],10)/100,o=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(n,i,o)}}}else if(r=/^#([A-Fa-f0-9]+)$/.exec(e)){if(3===(n=(r=r[1]).length))return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,this;if(6===n)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,this}return e&&0<e.length&&(void 0!==(r=Zo[e])?this.setHex(r):console.warn("THREE.Color: Unknown color "+e)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){return void 0===e&&(e=2),e=0<e?1/e:1,this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=Jo(t.r),this.g=Jo(t.g),this.b=Jo(t.b),this},copyLinearToSRGB:function(t){return this.r=Ko(t.r),this.g=Ko(t.g),this.b=Ko(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,r=this.r,n=this.g,i=this.b,o=Math.max(r,n,i),a=Math.min(r,n,i),s=(a+o)/2;if(a===o)a=e=0;else{var u=o-a;switch(a=s<=.5?u/(o+a):u/(2-o-a),o){case r:e=(n-i)/u+(n<i?6:0);break;case n:e=(i-r)/u+2;break;case i:e=(r-n)/u+4}e/=6}return t.h=e,t.s=a,t.l=s,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:(Wo={},function(t,e,r){return this.getHSL(Wo),Wo.h+=t,Wo.s+=e,Wo.l+=r,this.setHSL(Wo.h,Wo.s,Wo.l),this}),add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}});var ta,ea,ra={common:{diffuse:{value:new w(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new g},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new H(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new w(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new w(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new g}},sprite:{diffuse:{value:new w(15658734)},opacity:{value:1},center:{value:new H(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new g}}},na={basic:{uniforms:Yo.merge([ra.common,ra.specularmap,ra.envmap,ra.aomap,ra.lightmap,ra.fog]),vertexShader:Xo.meshbasic_vert,fragmentShader:Xo.meshbasic_frag},lambert:{uniforms:Yo.merge([ra.common,ra.specularmap,ra.envmap,ra.aomap,ra.lightmap,ra.emissivemap,ra.fog,ra.lights,{emissive:{value:new w(0)}}]),vertexShader:Xo.meshlambert_vert,fragmentShader:Xo.meshlambert_frag},phong:{uniforms:Yo.merge([ra.common,ra.specularmap,ra.envmap,ra.aomap,ra.lightmap,ra.emissivemap,ra.bumpmap,ra.normalmap,ra.displacementmap,ra.gradientmap,ra.fog,ra.lights,{emissive:{value:new w(0)},specular:{value:new w(1118481)},shininess:{value:30}}]),vertexShader:Xo.meshphong_vert,fragmentShader:Xo.meshphong_frag},standard:{uniforms:Yo.merge([ra.common,ra.envmap,ra.aomap,ra.lightmap,ra.emissivemap,ra.bumpmap,ra.normalmap,ra.displacementmap,ra.roughnessmap,ra.metalnessmap,ra.fog,ra.lights,{emissive:{value:new w(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Xo.meshphysical_vert,fragmentShader:Xo.meshphysical_frag},points:{uniforms:Yo.merge([ra.points,ra.fog]),vertexShader:Xo.points_vert,fragmentShader:Xo.points_frag},dashed:{uniforms:Yo.merge([ra.common,ra.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Xo.linedashed_vert,fragmentShader:Xo.linedashed_frag},depth:{uniforms:Yo.merge([ra.common,ra.displacementmap]),vertexShader:Xo.depth_vert,fragmentShader:Xo.depth_frag},normal:{uniforms:Yo.merge([ra.common,ra.bumpmap,ra.normalmap,ra.displacementmap,{opacity:{value:1}}]),vertexShader:Xo.normal_vert,fragmentShader:Xo.normal_frag},sprite:{uniforms:Yo.merge([ra.sprite,ra.fog]),vertexShader:Xo.sprite_vert,fragmentShader:Xo.sprite_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Xo.cube_vert,fragmentShader:Xo.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Xo.equirect_vert,fragmentShader:Xo.equirect_frag},distanceRGBA:{uniforms:Yo.merge([ra.common,ra.displacementmap,{referencePosition:{value:new St},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Xo.distanceRGBA_vert,fragmentShader:Xo.distanceRGBA_frag},shadow:{uniforms:Yo.merge([ra.lights,ra.fog,{color:{value:new w(0)},opacity:{value:1}}]),vertexShader:Xo.shadow_vert,fragmentShader:Xo.shadow_frag}};na.physical={uniforms:Yo.merge([na.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Xo.meshphysical_vert,fragmentShader:Xo.meshphysical_frag},i.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),i.DefaultOrder="XYZ",Object.defineProperties(i.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(i.prototype,{isEuler:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var n=po.clamp,i=t.elements;t=i[0];var o=i[4],a=i[8],s=i[1],u=i[5],c=i[9],l=i[2],h=i[6];return i=i[10],"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-c,i),this._z=Math.atan2(-o,t)):(this._x=Math.atan2(h,u),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(a,i),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-l,t),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(-l,i),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(s,t))):"ZYX"===e?(this._y=Math.asin(-n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(h,i),this._z=Math.atan2(s,t)):(this._x=0,this._z=Math.atan2(-o,u))):"YZX"===e?(this._z=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-l,t)):(this._x=0,this._y=Math.atan2(a,i))):"XZY"===e?(this._z=Math.asin(-n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(h,u),this._y=Math.atan2(a,t)):(this._x=Math.atan2(-c,i),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==r&&this.onChangeCallback(),this},setFromQuaternion:(ea=new wt,function(t,e,r){return ea.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ea,e,r)}),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:(ta=new s,function(t){return ta.setFromEuler(this),this.setFromQuaternion(ta,t)}),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new St(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(o.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask=this.mask|1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!=(this.mask&t.mask)}});var ia,oa,aa,sa,ua,ca,la,ha,pa,fa,da,ma,ga,ya,va,_a,ba,xa,wa=0;l.DefaultUp=new St(0,1,0),l.DefaultMatrixAutoUpdate=!0,l.prototype=Object.assign(Object.create(e.prototype),{constructor:l,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:(ba=new s,function(t,e){return ba.setFromAxisAngle(t,e),this.quaternion.multiply(ba),this}),rotateOnWorldAxis:(_a=new s,function(t,e){return _a.setFromAxisAngle(t,e),this.quaternion.premultiply(_a),this}),rotateX:(va=new St(1,0,0),function(t){return this.rotateOnAxis(va,t)}),rotateY:(ya=new St(0,1,0),function(t){return this.rotateOnAxis(ya,t)}),rotateZ:(ga=new St(0,0,1),function(t){return this.rotateOnAxis(ga,t)}),translateOnAxis:(ma=new St,function(t,e){return ma.copy(t).applyQuaternion(this.quaternion),this.position.add(ma.multiplyScalar(e)),this}),translateX:(da=new St(1,0,0),function(t){return this.translateOnAxis(da,t)}),translateY:(fa=new St(0,1,0),function(t){return this.translateOnAxis(fa,t)}),translateZ:(pa=new St(0,0,1),function(t){return this.translateOnAxis(pa,t)}),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:(ha=new wt,function(t){return t.applyMatrix4(ha.getInverse(this.matrixWorld))}),lookAt:(ca=new wt,la=new St,function(t,e,r){t.isVector3?la.copy(t):la.set(t,e,r),this.isCamera?ca.lookAt(this.position,la,this.up):ca.lookAt(la,this.position,this.up),this.quaternion.setFromRotationMatrix(ca)}),add:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",t):t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this},remove:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}return-1!==(e=this.children.indexOf(t))&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(e,1)),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new St),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(sa=new St,ua=new St,function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new s),this.updateMatrixWorld(!0),this.matrixWorld.decompose(sa,t,ua),t}),getWorldScale:(oa=new St,aa=new s,function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new St),this.updateMatrixWorld(!0),this.matrixWorld.decompose(oa,aa,t),t}),getWorldDirection:(ia=new s,function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new St),this.getWorldQuaternion(ia),t.set(0,0,1).applyQuaternion(ia)}),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t=!(this.matrixWorldNeedsUpdate=!1));for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].updateMatrixWorld(t)},toJSON:function(r){function t(t,e){return void 0===t[e.uuid]&&(t[e.uuid]=e.toJSON(r)),e.uuid}function e(t){var e,r=[];for(e in t){var n=t[e];delete n.metadata,r.push(n)}return r}var n=void 0===r||"string"==typeof r,i={};n&&(r={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var o={};if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),!0===this.castShadow&&(o.castShadow=!0),!0===this.receiveShadow&&(o.receiveShadow=!0),!1===this.visible&&(o.visible=!1),!1===this.frustumCulled&&(o.frustumCulled=!1),0!==this.renderOrder&&(o.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(o.matrixAutoUpdate=!1),this.isMesh||this.isLine||this.isPoints){o.geometry=t(r.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes)if(a=a.shapes,Array.isArray(a))for(var s=0,u=a.length;s<u;s++)t(r.shapes,a[s]);else t(r.shapes,a)}if(void 0!==this.material)if(Array.isArray(this.material)){for(a=[],s=0,u=this.material.length;s<u;s++)a.push(t(r.materials,this.material[s]));o.material=a}else o.material=t(r.materials,this.material);if(0<this.children.length)for(o.children=[],s=0;s<this.children.length;s++)o.children.push(this.children[s].toJSON(r).object);if(n){n=e(r.geometries),s=e(r.materials),u=e(r.textures);var c=e(r.images);a=e(r.shapes),0<n.length&&(i.geometries=n),0<s.length&&(i.materials=s),0<u.length&&(i.textures=u),0<c.length&&(i.images=c),0<a.length&&(i.shapes=a)}return i.object=o,i},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(e=0;e<t.children.length;e++)this.add(t.children[e].clone());return this}}),u.prototype=Object.assign(Object.create(l.prototype),{constructor:u,isCamera:!0,copy:function(t,e){return l.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},getWorldDirection:(xa=new s,function(t){return void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new St),this.getWorldQuaternion(xa),t.set(0,0,-1).applyQuaternion(xa)}),updateMatrixWorld:function(t){l.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),f.prototype=Object.assign(Object.create(u.prototype),{constructor:f,isOrthographicCamera:!0,copy:function(t,e){return u.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,r,n,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-t;if(r+=t,t=n+e,e=n-e,null!==this.view&&this.view.enabled){r=this.zoom/(this.view.width/this.view.fullWidth),e=this.zoom/(this.view.height/this.view.fullHeight);var o=(this.right-this.left)/this.view.width;n=(this.top-this.bottom)/this.view.height,r=(i+=this.view.offsetX/r*o)+this.view.width/r*o,e=(t-=this.view.offsetY/e*n)-this.view.height/e*n}this.projectionMatrix.makeOrthographic(i,r,t,e,this.near,this.far)},toJSON:function(t){return(t=l.prototype.toJSON.call(this,t)).object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Object.assign(S.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,r=t.vertexNormals.length;e<r;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,r=t.vertexColors.length;e<r;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var Sa,Ea,Ca,Ma,Ta,Pa,Oa,Aa=0;E.prototype=Object.assign(Object.create(e.prototype),{constructor:E,isGeometry:!0,applyMatrix:function(t){for(var e=(new g).getNormalMatrix(t),r=0,n=this.vertices.length;r<n;r++)this.vertices[r].applyMatrix4(t);for(r=0,n=this.faces.length;r<n;r++){(t=this.faces[r]).normal.applyMatrix3(e).normalize();for(var i=0,o=t.vertexNormals.length;i<o;i++)t.vertexNormals[i].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.normalsNeedUpdate=this.verticesNeedUpdate=!0,this},rotateX:(Oa=new wt,function(t){return Oa.makeRotationX(t),this.applyMatrix(Oa),this}),rotateY:(Pa=new wt,function(t){return Pa.makeRotationY(t),this.applyMatrix(Pa),this}),rotateZ:(Ta=new wt,function(t){return Ta.makeRotationZ(t),this.applyMatrix(Ta),this}),translate:(Ma=new wt,function(t,e,r){return Ma.makeTranslation(t,e,r),this.applyMatrix(Ma),this}),scale:(Ca=new wt,function(t,e,r){return Ca.makeScale(t,e,r),this.applyMatrix(Ca),this}),lookAt:(Ea=new l,function(t){Ea.lookAt(t),Ea.updateMatrix(),this.applyMatrix(Ea.matrix)}),fromBufferGeometry:function(t){function e(t,e,r,n){n=new S(t,e,r,void 0!==a?[l[t].clone(),l[e].clone(),l[r].clone()]:[],void 0!==s?[i.colors[t].clone(),i.colors[e].clone(),i.colors[r].clone()]:[],n),i.faces.push(n),void 0!==u&&i.faceVertexUvs[0].push([h[t].clone(),h[e].clone(),h[r].clone()]),void 0!==c&&i.faceVertexUvs[1].push([p[t].clone(),p[e].clone(),p[r].clone()])}var i=this,r=null!==t.index?t.index.array:void 0,n=t.attributes,o=n.position.array,a=void 0!==n.normal?n.normal.array:void 0,s=void 0!==n.color?n.color.array:void 0,u=void 0!==n.uv?n.uv.array:void 0,c=void 0!==n.uv2?n.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var l=[],h=[],p=[],f=n=0;n<o.length;n+=3,f+=2)i.vertices.push(new St(o[n],o[n+1],o[n+2])),void 0!==a&&l.push(new St(a[n],a[n+1],a[n+2])),void 0!==s&&i.colors.push(new w(s[n],s[n+1],s[n+2])),void 0!==u&&h.push(new H(u[f],u[f+1])),void 0!==c&&p.push(new H(c[f],c[f+1]));var d=t.groups;if(0<d.length)for(n=0;n<d.length;n++){var m=(o=d[n]).start;for(f=m,m+=o.count;f<m;f+=3)void 0!==r?e(r[f],r[f+1],r[f+2],o.materialIndex):e(f,f+1,f+2,o.materialIndex)}else if(void 0!==r)for(n=0;n<r.length;n+=3)e(r[n],r[n+1],r[n+2]);else for(n=0;n<o.length/3;n+=3)e(n,n+1,n+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:(Sa=new St,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Sa).negate(),this.translate(Sa.x,Sa.y,Sa.z),this}),normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius;e=0===e?1:1/e;var r=new wt;return r.set(e,0,0,-e*t.x,0,e,0,-e*t.y,0,0,e,-e*t.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var t=new St,e=new St,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],o=this.vertices[i.a],a=this.vertices[i.b];t.subVectors(this.vertices[i.c],a),e.subVectors(o,a),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e;void 0===t&&(t=!0);var r=Array(this.vertices.length),n=0;for(e=this.vertices.length;n<e;n++)r[n]=new St;if(t){var i=new St,o=new St;for(t=0,n=this.faces.length;t<n;t++){e=this.faces[t];var a=this.vertices[e.a],s=this.vertices[e.b],u=this.vertices[e.c];i.subVectors(u,s),o.subVectors(a,s),i.cross(o),r[e.a].add(i),r[e.b].add(i),r[e.c].add(i)}}else for(this.computeFaceNormals(),t=0,n=this.faces.length;t<n;t++)r[(e=this.faces[t]).a].add(e.normal),r[e.b].add(e.normal),r[e.c].add(e.normal);for(n=0,e=this.vertices.length;n<e;n++)r[n].normalize();for(t=0,n=this.faces.length;t<n;t++)3===(a=(e=this.faces[t]).vertexNormals).length?(a[0].copy(r[e.a]),a[1].copy(r[e.b]),a[2].copy(r[e.c])):(a[0]=r[e.a].clone(),a[1]=r[e.b].clone(),a[2]=r[e.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t;this.computeFaceNormals();var e=0;for(t=this.faces.length;e<t;e++){var r=this.faces[e],n=r.vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,r=0;for(e=this.faces.length;r<e;r++){var n=this.faces[r];n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]);var i=0;for(t=n.vertexNormals.length;i<t;i++)n.__originalVertexNormals[i]?n.__originalVertexNormals[i].copy(n.vertexNormals[i]):n.__originalVertexNormals[i]=n.vertexNormals[i].clone()}var o=new E;for(o.faces=this.faces,i=0,t=this.morphTargets.length;i<t;i++){if(!this.morphNormals[i]){this.morphNormals[i]={},this.morphNormals[i].faceNormals=[],this.morphNormals[i].vertexNormals=[],n=this.morphNormals[i].faceNormals;var a=this.morphNormals[i].vertexNormals;for(r=0,e=this.faces.length;r<e;r++){var s=new St,u={a:new St,b:new St,c:new St};n.push(s),a.push(u)}}for(a=this.morphNormals[i],o.vertices=this.morphTargets[i].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,e=this.faces.length;r<e;r++)n=this.faces[r],s=a.faceNormals[r],u=a.vertexNormals[r],s.copy(n.normal),u.a.copy(n.vertexNormals[0]),u.b.copy(n.vertexNormals[1]),u.c.copy(n.vertexNormals[2])}for(r=0,e=this.faces.length;r<e;r++)(n=this.faces[r]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new r),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new a),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,r){if(t&&t.isGeometry){var n,i=this.vertices.length,o=this.vertices,a=t.vertices,s=this.faces,u=t.faces,c=this.faceVertexUvs[0],l=t.faceVertexUvs[0],h=this.colors,p=t.colors;void 0===r&&(r=0),void 0!==e&&(n=(new g).getNormalMatrix(e)),t=0;for(var f=a.length;t<f;t++){var d=a[t].clone();void 0!==e&&d.applyMatrix4(e),o.push(d)}for(t=0,f=p.length;t<f;t++)h.push(p[t].clone());for(t=0,f=u.length;t<f;t++){var m=(a=u[t]).vertexNormals;for(p=a.vertexColors,(h=new S(a.a+i,a.b+i,a.c+i)).normal.copy(a.normal),void 0!==n&&h.normal.applyMatrix3(n).normalize(),e=0,o=m.length;e<o;e++)d=m[e].clone(),void 0!==n&&d.applyMatrix3(n).normalize(),h.vertexNormals.push(d);for(h.color.copy(a.color),e=0,o=p.length;e<o;e++)d=p[e],h.vertexColors.push(d.clone());h.materialIndex=a.materialIndex+r,s.push(h)}for(t=0,f=l.length;t<f;t++)if(n=[],void 0!==(r=l[t])){for(e=0,o=r.length;e<o;e++)n.push(r[e].clone());c.push(n)}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e={},r=[],n=[],i=Math.pow(10,4),o=0;for(t=this.vertices.length;o<t;o++){var a=this.vertices[o];void 0===e[a=Math.round(a.x*i)+"_"+Math.round(a.y*i)+"_"+Math.round(a.z*i)]?(e[a]=o,r.push(this.vertices[o]),n[o]=r.length-1):n[o]=n[e[a]]}for(e=[],o=0,t=this.faces.length;o<t;o++)for((i=this.faces[o]).a=n[i.a],i.b=n[i.b],i.c=n[i.c],i=[i.a,i.b,i.c],a=0;a<3;a++)if(i[a]===i[(a+1)%3]){e.push(o);break}for(o=e.length-1;0<=o;o--)for(i=e[o],this.faces.splice(i,1),n=0,t=this.faceVertexUvs.length;n<t;n++)this.faceVertexUvs[n].splice(i,1);return o=this.vertices.length-r.length,this.vertices=r,o},setFromPoints:function(t){this.vertices=[];for(var e=0,r=t.length;e<r;e++){var n=t[e];this.vertices.push(new St(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,r=0;r<e;r++)t[r]._id=r;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var n,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];for(o&&o.length===e&&(n=[]),a&&a.length===e&&(i=[]),r=0;r<e;r++){var s=t[r]._id;n&&n.push(o[s]),i&&i.push(a[s])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){function t(t,e,r){return r?t|1<<e:t&~(1<<e)}function e(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==c[e]||(c[e]=u.length/3,u.push(t.x,t.y,t.z)),c[e]}function r(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==h[e]||(h[e]=l.length,l.push(t.getHex())),h[e]}function n(t){var e=t.x.toString()+t.y.toString();return void 0!==f[e]||(f[e]=p.length/2,p.push(t.x,t.y)),f[e]}var i={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),void 0!==this.parameters){var o,a=this.parameters;for(o in a)void 0!==a[o]&&(i[o]=a[o]);return i}for(a=[],o=0;o<this.vertices.length;o++){var s=this.vertices[o];a.push(s.x,s.y,s.z)}s=[];var u=[],c={},l=[],h={},p=[],f={};for(o=0;o<this.faces.length;o++){var d=this.faces[o],m=void 0!==this.faceVertexUvs[0][o],g=0<d.normal.length(),y=0<d.vertexNormals.length,v=1!==d.color.r||1!==d.color.g||1!==d.color.b,_=0<d.vertexColors.length,b=0;b=t(b=t(b=t(b=t(b=t(b=t(b=t(b=t(b,0,0),1,!0),2,!1),3,m),4,g),5,y),6,v),7,_),s.push(b),s.push(d.a,d.b,d.c),s.push(d.materialIndex),m&&(m=this.faceVertexUvs[0][o],s.push(n(m[0]),n(m[1]),n(m[2]))),g&&s.push(e(d.normal)),y&&(g=d.vertexNormals,s.push(e(g[0]),e(g[1]),e(g[2]))),v&&s.push(r(d.color)),_&&(d=d.vertexColors,s.push(r(d[0]),r(d[1]),r(d[2])))}return i.data={},i.data.vertices=a,i.data.normals=u,0<l.length&&(i.data.colors=l),0<p.length&&(i.data.uvs=[p]),i.data.faces=s,i},clone:function(){return(new E).copy(this)},copy:function(t){var e,r,n;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.name=t.name;var i=t.vertices,o=0;for(e=i.length;o<e;o++)this.vertices.push(i[o].clone());for(o=0,e=(i=t.colors).length;o<e;o++)this.colors.push(i[o].clone());for(o=0,e=(i=t.faces).length;o<e;o++)this.faces.push(i[o].clone());for(o=0,e=t.faceVertexUvs.length;o<e;o++){var a=t.faceVertexUvs[o];for(void 0===this.faceVertexUvs[o]&&(this.faceVertexUvs[o]=[]),i=0,r=a.length;i<r;i++){var s=a[i],u=[],c=0;for(n=s.length;c<n;c++)u.push(s[c].clone());this.faceVertexUvs[o].push(u)}}for(o=0,e=(c=t.morphTargets).length;o<e;o++){if((n={}).name=c[o].name,void 0!==c[o].vertices)for(n.vertices=[],i=0,r=c[o].vertices.length;i<r;i++)n.vertices.push(c[o].vertices[i].clone());if(void 0!==c[o].normals)for(n.normals=[],i=0,r=c[o].normals.length;i<r;i++)n.normals.push(c[o].normals[i].clone());this.morphTargets.push(n)}for(o=0,e=(c=t.morphNormals).length;o<e;o++){if(n={},void 0!==c[o].vertexNormals)for(n.vertexNormals=[],i=0,r=c[o].vertexNormals.length;i<r;i++)a=c[o].vertexNormals[i],(s={}).a=a.a.clone(),s.b=a.b.clone(),s.c=a.c.clone(),n.vertexNormals.push(s);if(void 0!==c[o].faceNormals)for(n.faceNormals=[],i=0,r=c[o].faceNormals.length;i<r;i++)n.faceNormals.push(c[o].faceNormals[i].clone());this.morphNormals.push(n)}for(o=0,e=(i=t.skinWeights).length;o<e;o++)this.skinWeights.push(i[o].clone());for(o=0,e=(i=t.skinIndices).length;o<e;o++)this.skinIndices.push(i[o].clone());for(o=0,e=(i=t.lineDistances).length;o<e;o++)this.lineDistances.push(i[o]);return null!==(o=t.boundingBox)&&(this.boundingBox=o.clone()),null!==(o=t.boundingSphere)&&(this.boundingSphere=o.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(v.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(v.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==t?t.length/this.itemSize:0,this.array=t,this},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.itemSize,r*=e.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[t+n]=e.array[r+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new w),e[r++]=o.r,e[r++]=o.g,e[r++]=o.b}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new H),e[r++]=o.x,e[r++]=o.y}return this},copyVector3sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new St),e[r++]=o.x,e[r++]=o.y,e[r++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new Et),e[r++]=o.x,e[r++]=o.y,e[r++]=o.z,e[r++]=o.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this},setXYZ:function(t,e,r,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(c.prototype=Object.create(v.prototype)).constructor=c,(h.prototype=Object.create(v.prototype)).constructor=h,(d.prototype=Object.create(v.prototype)).constructor=d,(m.prototype=Object.create(v.prototype)).constructor=m,(_.prototype=Object.create(v.prototype)).constructor=_,(b.prototype=Object.create(v.prototype)).constructor=b,(x.prototype=Object.create(v.prototype)).constructor=x,(O.prototype=Object.create(v.prototype)).constructor=O,(C.prototype=Object.create(v.prototype)).constructor=C,Object.assign(M.prototype,{computeGroups:function(t){var e=[],r=void 0;t=t.faces;for(var n=0;n<t.length;n++){var i=t[n];if(i.materialIndex!==r){r=i.materialIndex,void 0!==o&&(o.count=3*n-o.start,e.push(o));var o={start:3*n,materialIndex:r}}}void 0!==o&&(o.count=3*n-o.start,e.push(o)),this.groups=e},fromGeometry:function(t){var e=t.faces,r=t.vertices,n=t.faceVertexUvs,i=n[0]&&0<n[0].length,o=n[1]&&0<n[1].length,a=t.morphTargets,s=a.length;if(0<s){for(var u=[],c=0;c<s;c++)u[c]=[];this.morphTargets.position=u}var l=t.morphNormals,h=l.length;if(0<h){var p=[];for(c=0;c<h;c++)p[c]=[];this.morphTargets.normal=p}var f=t.skinIndices,d=t.skinWeights,m=f.length===r.length,g=d.length===r.length;for(0<r.length&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),c=0;c<e.length;c++){var y=e[c];this.vertices.push(r[y.a],r[y.b],r[y.c]);var v=y.vertexNormals;for(3===v.length?this.normals.push(v[0],v[1],v[2]):(v=y.normal,this.normals.push(v,v,v)),3===(v=y.vertexColors).length?this.colors.push(v[0],v[1],v[2]):(v=y.color,this.colors.push(v,v,v)),!0===i&&(void 0!==(v=n[0][c])?this.uvs.push(v[0],v[1],v[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new H,new H,new H))),!0===o&&(void 0!==(v=n[1][c])?this.uvs2.push(v[0],v[1],v[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new H,new H,new H))),v=0;v<s;v++){var _=a[v].vertices;u[v].push(_[y.a],_[y.b],_[y.c])}for(v=0;v<h;v++)_=l[v].vertexNormals[c],p[v].push(_.a,_.b,_.c);m&&this.skinIndices.push(f[y.a],f[y.b],f[y.c]),g&&this.skinWeights.push(d[y.a],d[y.b],d[y.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var Ia,La,Ra,Na,ka,Da,ja,za,Fa,Ba,Ua=1;A.prototype=Object.assign(Object.create(e.prototype),{constructor:A,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(65535<P(t)?x:_)(t,1):this.index=t},addAttribute:function(t,e,r){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?("index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e)):this.attributes[t]=e,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(t,new v(e,r)))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,r){this.groups.push({start:t,count:e,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;return void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0),void 0!==(e=this.attributes.normal)&&((new g).getNormalMatrix(t).applyToBufferAttribute(e),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:(Ba=new wt,function(t){return Ba.makeRotationX(t),this.applyMatrix(Ba),this}),rotateY:(Fa=new wt,function(t){return Fa.makeRotationY(t),this.applyMatrix(Fa),this}),rotateZ:(za=new wt,function(t){return za.makeRotationZ(t),this.applyMatrix(za),this}),translate:(ja=new wt,function(t,e,r){return ja.makeTranslation(t,e,r),this.applyMatrix(ja),this}),scale:(Da=new wt,function(t,e,r){return Da.makeScale(t,e,r),this.applyMatrix(Da),this}),lookAt:(ka=new l,function(t){ka.lookAt(t),ka.updateMatrix(),this.applyMatrix(ka.matrix)}),center:(Na=new St,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Na).negate(),this.translate(Na.x,Na.y,Na.z),this}),setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){t=new O(3*e.vertices.length,3);var r=new O(3*e.colors.length,3);this.addAttribute("position",t.copyVector3sArray(e.vertices)),this.addAttribute("color",r.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length&&(t=new O(e.lineDistances.length,1),this.addAttribute("lineDistance",t.copyArray(e.lineDistances))),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];e.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new O(e,3)),this},updateFromObject:function(t){var e=t.geometry;if(t.isMesh){var r=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(r=void 0,e.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(e);r.verticesNeedUpdate=e.verticesNeedUpdate,r.normalsNeedUpdate=e.normalsNeedUpdate,r.colorsNeedUpdate=e.colorsNeedUpdate,r.uvsNeedUpdate=e.uvsNeedUpdate,r.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=r}return!0===e.verticesNeedUpdate&&(void 0!==(r=this.attributes.position)&&(r.copyVector3sArray(e.vertices),r.needsUpdate=!0),e.verticesNeedUpdate=!1),!0===e.normalsNeedUpdate&&(void 0!==(r=this.attributes.normal)&&(r.copyVector3sArray(e.normals),r.needsUpdate=!0),e.normalsNeedUpdate=!1),!0===e.colorsNeedUpdate&&(void 0!==(r=this.attributes.color)&&(r.copyColorsArray(e.colors),r.needsUpdate=!0),e.colorsNeedUpdate=!1),e.uvsNeedUpdate&&(void 0!==(r=this.attributes.uv)&&(r.copyVector2sArray(e.uvs),r.needsUpdate=!0),e.uvsNeedUpdate=!1),e.lineDistancesNeedUpdate&&(void 0!==(r=this.attributes.lineDistance)&&(r.copyArray(e.lineDistances),r.needsUpdate=!0),e.lineDistancesNeedUpdate=!1),e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new M).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);for(var r in this.addAttribute("position",new v(e,3).copyVector3sArray(t.vertices)),0<t.normals.length&&(e=new Float32Array(3*t.normals.length),this.addAttribute("normal",new v(e,3).copyVector3sArray(t.normals))),0<t.colors.length&&(e=new Float32Array(3*t.colors.length),this.addAttribute("color",new v(e,3).copyColorsArray(t.colors))),0<t.uvs.length&&(e=new Float32Array(2*t.uvs.length),this.addAttribute("uv",new v(e,2).copyVector2sArray(t.uvs))),0<t.uvs2.length&&(e=new Float32Array(2*t.uvs2.length),this.addAttribute("uv2",new v(e,2).copyVector2sArray(t.uvs2))),this.groups=t.groups,t.morphTargets){e=[];for(var n=t.morphTargets[r],i=0,o=n.length;i<o;i++){var a=n[i],s=new O(3*a.length,3);e.push(s.copyVector3sArray(a))}this.morphAttributes[r]=e}return 0<t.skinIndices.length&&(r=new O(4*t.skinIndices.length,4),this.addAttribute("skinIndex",r.copyVector4sArray(t.skinIndices))),0<t.skinWeights.length&&(r=new O(4*t.skinWeights.length,4),this.addAttribute("skinWeight",r.copyVector4sArray(t.skinWeights))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new r);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:(La=new r,Ra=new St,function(){null===this.boundingSphere&&(this.boundingSphere=new a);var t=this.attributes.position;if(t){var e=this.boundingSphere.center;La.setFromBufferAttribute(t),La.getCenter(e);for(var r=0,n=0,i=t.count;n<i;n++)Ra.x=t.getX(n),Ra.y=t.getY(n),Ra.z=t.getZ(n),r=Math.max(r,e.distanceToSquared(Ra));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,r=this.groups;if(e.position){var n=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new v(new Float32Array(n.length),3));else for(var i=e.normal.array,o=0,a=i.length;o<a;o++)i[o]=0;i=e.normal.array;var s=new St,u=new St,c=new St,l=new St,h=new St;if(t){t=t.array,0===r.length&&this.addGroup(0,t.length);for(var p=0,f=r.length;p<f;++p){a=(o=r[p]).start;var d=o.count;for(o=a,a+=d;o<a;o+=3){d=3*t[o+0];var m=3*t[o+1],g=3*t[o+2];s.fromArray(n,d),u.fromArray(n,m),c.fromArray(n,g),l.subVectors(c,u),h.subVectors(s,u),l.cross(h),i[d]+=l.x,i[d+1]+=l.y,i[d+2]+=l.z,i[m]+=l.x,i[1+m]+=l.y,i[2+m]+=l.z,i[g]+=l.x,i[1+g]+=l.y,i[2+g]+=l.z}}}else for(o=0,a=n.length;o<a;o+=9)s.fromArray(n,o),u.fromArray(n,o+3),c.fromArray(n,o+6),l.subVectors(c,u),h.subVectors(s,u),l.cross(h),i[o]=l.x,i[o+1]=l.y,i[o+2]=l.z,i[o+3]=l.x,i[o+4]=l.y,i[o+5]=l.z,i[o+6]=l.x,i[o+7]=l.y,i[o+8]=l.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r,n=this.attributes;for(r in n)if(void 0!==t.attributes[r]){var i=n[r].array,o=t.attributes[r],a=o.array,s=0;for(o=o.itemSize*e;s<a.length;s++,o++)i[o]=a[s]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:(Ia=new St,function(){for(var t=this.attributes.normal,e=0,r=t.count;e<r;e++)Ia.x=t.getX(e),Ia.y=t.getY(e),Ia.z=t.getZ(e),Ia.normalize(),t.setXYZ(e,Ia.x,Ia.y,Ia.z)}),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t,e=new A,r=this.index.array,n=this.attributes;for(t in n){var i=n[t],o=i.array,a=i.itemSize,s=new o.constructor(r.length*a),u=0;i=0;for(var c=r.length;i<c;i++)for(var l=r[i]*a,h=0;h<a;h++)s[u++]=o[l++];e.addAttribute(t,new v(s,a))}for(i=0,c=(r=this.groups).length;i<c;i++)n=r[i],e.addGroup(n.start,n.count,n.materialIndex);return e},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),0<Object.keys(this.userData).length&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};var r=this.index;for(i in null!==r&&(e=Array.prototype.slice.call(r.array),t.data.index={type:r.array.constructor.name,array:e}),r=this.attributes){var n=r[i];e=Array.prototype.slice.call(n.array),t.data.attributes[i]={itemSize:n.itemSize,type:n.array.constructor.name,array:e,normalized:n.normalized}}var i=this.groups;return 0<i.length&&(t.data.groups=JSON.parse(JSON.stringify(i))),null!==(i=this.boundingSphere)&&(t.data.boundingSphere={center:i.center.toArray(),radius:i.radius}),t},clone:function(){return(new A).copy(this)},copy:function(t){var e;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.name=t.name;var r=t.index;for(a in null!==r&&this.setIndex(r.clone()),r=t.attributes)this.addAttribute(a,r[a].clone());var n=t.morphAttributes;for(a in n){var i=[],o=n[a];for(r=0,e=o.length;r<e;r++)i.push(o[r].clone());this.morphAttributes[a]=i}var a=t.groups;for(r=0,e=a.length;r<e;r++)n=a[r],this.addGroup(n.start,n.count,n.materialIndex);return null!==(a=t.boundingBox)&&(this.boundingBox=a.clone()),null!==(a=t.boundingSphere)&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(I.prototype=Object.create(E.prototype)).constructor=I,(L.prototype=Object.create(A.prototype)).constructor=L,(R.prototype=Object.create(E.prototype)).constructor=R,(N.prototype=Object.create(A.prototype)).constructor=N;var Va,Ga,qa,Ha,$a,Wa,Xa,Ya,Za,Ka,Ja,Qa,ts,es,rs,ns,is,os,as,ss,us,cs,ls,hs,ps,fs,ds,ms,gs,ys,vs,_s,bs,xs,ws,Ss,Es,Cs,Ms,Ts=0;function Ps(t,e,r,n,i,o,a){return F.getBarycoord(t,e,r,n,Es),i.multiplyScalar(Es.x),o.multiplyScalar(Es.y),a.multiplyScalar(Es.z),i.add(o).add(a),i.clone()}function Os(t,e,r,n,i,o,a,s){return null===(1===e.side?n.intersectTriangle(a,o,i,!0,s):n.intersectTriangle(i,o,a,2!==e.side,s))?null:(Ms.copy(s),Ms.applyMatrix4(t.matrixWorld),(e=r.ray.origin.distanceTo(Ms))<r.near||e>r.far?null:{distance:e,point:Ms.clone(),object:t})}function As(t,e,r,n,i,o,a,s,u){return ms.fromBufferAttribute(i,a),gs.fromBufferAttribute(i,s),ys.fromBufferAttribute(i,u),(t=Os(t,e,r,n,ms,gs,ys,Cs))&&(o&&(xs.fromBufferAttribute(o,a),ws.fromBufferAttribute(o,s),Ss.fromBufferAttribute(o,u),t.uv=Ps(Cs,ms,gs,ys,xs,ws,Ss)),o=new S(a,s,u),F.getNormal(ms,gs,ys,o.normal),t.face=o),t}k.prototype=Object.assign(Object.create(e.prototype),{constructor:k,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var r=t[e];if(void 0===r)console.warn("THREE.Material: '"+e+"' parameter is undefined.");else if("shading"===e)console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;else{var n=this[e];void 0===n?console.warn("THREE."+this.type+": '"+e+"' is not a property of this material."):n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[e]="overdraw"===e?Number(r):r}}},toJSON:function(t){function e(t){var e,r=[];for(e in t){var n=t[e];delete n.metadata,r.push(n)}return r}var r=void 0===t||"string"==typeof t;r&&(t={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};return n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),0!==this.vertexColors&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,0!==this.rotation&&(n.rotation=this.rotation),1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),0<this.alphaTest&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),1<this.wireframeLinewidth&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),r&&(r=e(t.textures),t=e(t.images),0<r.length&&(n.textures=r),0<t.length&&(n.images=t)),n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,r=null;if(null!==e){var n=e.length;r=Array(n);for(var i=0;i!==n;++i)r[i]=e[i].clone()}return this.clippingPlanes=r,this.shadowSide=t.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),((D.prototype=Object.create(k.prototype)).constructor=D).prototype.isMeshBasicMaterial=!0,D.prototype.copy=function(t){return k.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},((j.prototype=Object.create(k.prototype)).constructor=j).prototype.isShaderMaterial=!0,j.prototype.copy=function(t){return k.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Yo.clone(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},j.prototype.toJSON=function(t){return(t=k.prototype.toJSON.call(this,t)).uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},Object.assign(z.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new St),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:(Ja=new St,function(t){return this.origin.copy(this.at(t,Ja)),this}),closestPointToPoint:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new St),e.subVectors(t,this.origin),(t=e.dot(this.direction))<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(t).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:(Ka=new St,function(t){var e=Ka.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Ka.copy(this.direction).multiplyScalar(e).add(this.origin),Ka.distanceToSquared(t))}),distanceSqToSegment:(Xa=new St,Ya=new St,Za=new St,function(t,e,r,n){Xa.copy(t).add(e).multiplyScalar(.5),Ya.copy(e).sub(t).normalize(),Za.copy(this.origin).sub(Xa);var i=.5*t.distanceTo(e),o=-this.direction.dot(Ya),a=Za.dot(this.direction),s=-Za.dot(Ya),u=Za.lengthSq(),c=Math.abs(1-o*o);if(0<c){e=o*a-s;var l=i*c;o=0<=(t=o*s-a)?-l<=e?e<=l?(t*=i=1/c)*(t+o*(e*=i)+2*a)+e*(o*t+e+2*s)+u:(e=i,-(t=Math.max(0,-(o*e+a)))*t+e*(e+2*s)+u):(e=-i,-(t=Math.max(0,-(o*e+a)))*t+e*(e+2*s)+u):e<=-l?-(t=Math.max(0,-(-o*i+a)))*t+(e=0<t?-i:Math.min(Math.max(-i,-s),i))*(e+2*s)+u:e<=l?(t=0,(e=Math.min(Math.max(-i,-s),i))*(e+2*s)+u):-(t=Math.max(0,-(o*i+a)))*t+(e=0<t?i:Math.min(Math.max(-i,-s),i))*(e+2*s)+u}else e=0<o?-i:i,o=-(t=Math.max(0,-(o*e+a)))*t+e*(e+2*s)+u;return r&&r.copy(this.direction).multiplyScalar(t).add(this.origin),n&&n.copy(Ya).multiplyScalar(e).add(Xa),o}),intersectSphere:(Wa=new St,function(t,e){Wa.subVectors(t.center,this.origin);var r=Wa.dot(this.direction),n=Wa.dot(Wa)-r*r;return(t=t.radius*t.radius)<n?null:(n=r-(t=Math.sqrt(t-n)),r+=t,n<0&&r<0?null:n<0?this.at(r,e):this.at(n,e))}),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);return 0===e?0===t.distanceToPoint(this.origin)?0:null:0<=(t=-(this.origin.dot(t.normal)+t.constant)/e)?t:null},intersectPlane:function(t,e){return null===(t=this.distanceToPlane(t))?null:this.at(t,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var r=1/this.direction.x,n=1/this.direction.y,i=1/this.direction.z,o=this.origin;if(0<=r){var a=(t.min.x-o.x)*r;r*=t.max.x-o.x}else a=(t.max.x-o.x)*r,r*=t.min.x-o.x;if(0<=n){var s=(t.min.y-o.y)*n;n*=t.max.y-o.y}else s=(t.max.y-o.y)*n,n*=t.min.y-o.y;return n<a||r<s?null:((a<s||a!=a)&&(a=s),(n<r||r!=r)&&(r=n),(t=0<=i?(s=(t.min.z-o.z)*i,(t.max.z-o.z)*i):(s=(t.max.z-o.z)*i,(t.min.z-o.z)*i))<a||r<s?null:((a<s||a!=a)&&(a=s),(t<r||r!=r)&&(r=t),r<0?null:this.at(0<=a?a:r,e)))},intersectsBox:($a=new St,function(t){return null!==this.intersectBox(t,$a)}),intersectTriangle:(Va=new St,Ga=new St,qa=new St,Ha=new St,function(t,e,r,n,i){if(Ga.subVectors(e,t),qa.subVectors(r,t),Ha.crossVectors(Ga,qa),0<(e=this.direction.dot(Ha))){if(n)return null;n=1}else{if(!(e<0))return null;n=-1,e=-e}return Va.subVectors(this.origin,t),(t=n*this.direction.dot(qa.crossVectors(Va,qa)))<0?null:(r=n*this.direction.dot(Ga.cross(Va)))<0||e<t+r?null:(t=-n*Va.dot(Ha))<0?null:this.at(t/e,i)}),applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(F,{getNormal:(ns=new St,function(t,e,r,n){return void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new St),n.subVectors(r,e),ns.subVectors(t,e),n.cross(ns),0<(t=n.lengthSq())?n.multiplyScalar(1/Math.sqrt(t)):n.set(0,0,0)}),getBarycoord:(ts=new St,es=new St,rs=new St,function(t,e,r,n,i){ts.subVectors(n,e),es.subVectors(r,e),rs.subVectors(t,e),t=ts.dot(ts),e=ts.dot(es),r=ts.dot(rs);var o=es.dot(es);n=es.dot(rs);var a=t*o-e*e;return void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new St),0===a?i.set(-2,-1,-1):(o=(o*r-e*n)*(a=1/a),t=(t*n-e*r)*a,i.set(1-o-t,t,o))}),containsPoint:(Qa=new St,function(t,e,r,n){return F.getBarycoord(t,e,r,n,Qa),0<=Qa.x&&0<=Qa.y&&Qa.x+Qa.y<=1})}),Object.assign(F.prototype,{set:function(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this},setFromPointsAndIndices:function(t,e,r,n){return this.a.copy(t[e]),this.b.copy(t[r]),this.c.copy(t[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:(ls=new St,hs=new St,function(){return ls.subVectors(this.c,this.b),hs.subVectors(this.a,this.b),.5*ls.cross(hs).length()}),getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new St),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return F.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new St),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return F.getBarycoord(t,this.a,this.b,this.c,e)},containsPoint:function(t){return F.containsPoint(t,this.a,this.b,this.c)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:(is=new St,os=new St,as=new St,ss=new St,us=new St,cs=new St,function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new St);var r=this.a,n=this.b,i=this.c;is.subVectors(n,r),os.subVectors(i,r),ss.subVectors(t,r);var o=is.dot(ss),a=os.dot(ss);if(o<=0&&a<=0)return e.copy(r);us.subVectors(t,n);var s=is.dot(us),u=os.dot(us);if(0<=s&&u<=s)return e.copy(n);var c=o*u-s*a;if(c<=0&&0<=o&&s<=0)return n=o/(o-s),e.copy(r).addScaledVector(is,n);cs.subVectors(t,i),t=is.dot(cs);var l=os.dot(cs);return 0<=l&&t<=l?e.copy(i):(o=t*a-o*l)<=0&&0<=a&&l<=0?(c=a/(a-l),e.copy(r).addScaledVector(os,c)):(a=s*l-t*u)<=0&&0<=u-s&&0<=t-l?(as.subVectors(i,n),c=(u-s)/(u-s+(t-l)),e.copy(n).addScaledVector(as,c)):(n=o*(i=1/(a+o+c)),c*=i,e.copy(r).addScaledVector(is,n).addScaledVector(os,c))}),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),B.prototype=Object.assign(Object.create(l.prototype),{constructor:B,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return l.prototype.copy.call(this,t),this.drawMode=t.drawMode,void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t=this.geometry;if(t.isBufferGeometry){t=t.morphAttributes;var e=Object.keys(t);if(0<e.length){var r=t[e[0]];if(void 0!==r)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=r.length;t<e;t++){var n=r[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}else if(void 0!==(r=t.morphTargets)&&0<r.length)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=r.length;t<e;t++)n=r[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t},raycast:(ps=new wt,fs=new z,ds=new a,ms=new St,gs=new St,ys=new St,vs=new St,_s=new St,bs=new St,xs=new H,ws=new H,Ss=new H,Es=new St,Cs=new St,Ms=new St,function(t,e){var r=this.geometry,n=this.material,i=this.matrixWorld;if(void 0!==n&&(null===r.boundingSphere&&r.computeBoundingSphere(),ds.copy(r.boundingSphere),ds.applyMatrix4(i),!1!==t.ray.intersectsSphere(ds)&&(ps.getInverse(i),fs.copy(t.ray).applyMatrix4(ps),null===r.boundingBox||!1!==fs.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var o,a=r.index,s=r.attributes.position,u=r.attributes.uv,c=r.groups;if(r=r.drawRange,null!==a)if(Array.isArray(n)){var l=0;for(o=c.length;l<o;l++){var h=c[l],p=n[h.materialIndex];i=Math.max(h.start,r.start);var f=Math.min(h.start+h.count,r.start+r.count);for(h=i;h<f;h+=3){i=a.getX(h);var d=a.getX(h+1),m=a.getX(h+2);(i=As(this,p,t,fs,s,u,i,d,m))&&(i.faceIndex=Math.floor(h/3),e.push(i))}}}else for(l=i=Math.max(0,r.start),o=f=Math.min(a.count,r.start+r.count);l<o;l+=3)i=a.getX(l),d=a.getX(l+1),m=a.getX(l+2),(i=As(this,n,t,fs,s,u,i,d,m))&&(i.faceIndex=Math.floor(l/3),e.push(i));else if(void 0!==s)if(Array.isArray(n))for(l=0,o=c.length;l<o;l++)for(p=n[(h=c[l]).materialIndex],i=Math.max(h.start,r.start),f=Math.min(h.start+h.count,r.start+r.count),h=i;h<f;h+=3)(i=As(this,p,t,fs,s,u,i=h,d=h+1,m=h+2))&&(i.faceIndex=Math.floor(h/3),e.push(i));else for(l=i=Math.max(0,r.start),o=f=Math.min(s.count,r.start+r.count);l<o;l+=3)(i=As(this,n,t,fs,s,u,i=l,d=l+1,m=l+2))&&(i.faceIndex=Math.floor(l/3),e.push(i))}else if(r.isGeometry)for(s=Array.isArray(n),u=r.vertices,c=r.faces,0<(i=r.faceVertexUvs[0]).length&&(a=i),h=0,f=c.length;h<f;h++)if(d=c[h],void 0!==(i=s?n[d.materialIndex]:n)){if(l=u[d.a],o=u[d.b],p=u[d.c],!0===i.morphTargets){m=r.morphTargets;var g=this.morphTargetInfluences;ms.set(0,0,0),gs.set(0,0,0),ys.set(0,0,0);for(var y=0,v=m.length;y<v;y++){var _=g[y];if(0!==_){var b=m[y].vertices;ms.addScaledVector(vs.subVectors(b[d.a],l),_),gs.addScaledVector(_s.subVectors(b[d.b],o),_),ys.addScaledVector(bs.subVectors(b[d.c],p),_)}}ms.add(l),gs.add(o),ys.add(p),l=ms,o=gs,p=ys}(i=Os(this,i,t,fs,l,o,p,Cs))&&(a&&a[h]&&(m=a[h],xs.copy(m[0]),ws.copy(m[1]),Ss.copy(m[2]),i.uv=Ps(Cs,l,o,p,xs,ws,Ss)),i.face=d,i.faceIndex=h,e.push(i))}}),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),((V.prototype=Object.create(p.prototype)).constructor=V).prototype.isCubeTexture=!0,Object.defineProperty(V.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var Is=new p,Ls=new V,Rs=[],Ns=[],ks=new Float32Array(16),Ds=new Float32Array(9),js=new Float32Array(4);vt.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),$(e,t)},_t.prototype.setValue=function(t,e,r){for(var n=this.seq,i=0,o=n.length;i!==o;++i){var a=n[i];a.setValue(t,e[a.id],r)}};var zs=/([\w\d_]+)(\])?(\[|\.)?/g;Ft.prototype.setValue=function(t,e,r){void 0!==(e=this.map[e])&&e.setValue(t,r,this.renderer)},Ft.prototype.setOptional=function(t,e,r){void 0!==(e=e[r])&&this.setValue(t,r,e)},Ft.upload=function(t,e,r,n){for(var i=0,o=e.length;i!==o;++i){var a=e[i],s=r[a.id];!1!==s.needsUpdate&&a.setValue(t,s.value,n)}},Ft.seqWithValue=function(t,e){for(var r=[],n=0,i=t.length;n!==i;++n){var o=t[n];o.id in e&&r.push(o)}return r};var Fs,Bs,Us,Vs,Gs,qs,Hs,$s,Ws,Xs,Ys,Zs,Ks,Js,Qs,tu,eu,ru,nu,iu,ou,au,su,uu,cu,lu=0,hu=0;function pu(t,e,r,n,i,o){Gs.subVectors(t,r).addScalar(.5).multiply(n),void 0!==i?(qs.x=o*Gs.x-i*Gs.y,qs.y=i*Gs.x+o*Gs.y):qs.copy(Gs),t.copy(e),t.x+=qs.x,t.y+=qs.y,t.applyMatrix4(Hs)}((ne.prototype=Object.create(k.prototype)).constructor=ne).prototype.isMeshDepthMaterial=!0,ne.prototype.copy=function(t){return k.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},((ie.prototype=Object.create(k.prototype)).constructor=ie).prototype.isMeshDistanceMaterial=!0,ie.prototype.copy=function(t){return k.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},ce.prototype=Object.assign(Object.create(l.prototype),{constructor:ce,isGroup:!0}),le.prototype=Object.assign(Object.create(u.prototype),{constructor:le,isPerspectiveCamera:!0,copy:function(t,e){return u.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){t=.5*this.getFilmHeight()/t,this.fov=2*po.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*po.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*po.RAD2DEG*Math.atan(Math.tan(.5*po.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,r,n,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*po.DEG2RAD*this.fov)/this.zoom,r=2*e,n=this.aspect*r,i=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*n/a,e-=o.offsetY*r/s,n*=o.width/a,r*=o.height/s}0!==(o=this.filmOffset)&&(i+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,e,e-r,t,this.far)},toJSON:function(t){return(t=l.prototype.toJSON.call(this,t)).object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),he.prototype=Object.assign(Object.create(le.prototype),{constructor:he,isArrayCamera:!0}),me.prototype.isFogExp2=!0,me.prototype.clone=function(){return new me(this.color,this.density)},me.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},ge.prototype.isFog=!0,ge.prototype.clone=function(){return new ge(this.color,this.near,this.far)},ge.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},ye.prototype=Object.assign(Object.create(l.prototype),{constructor:ye,copy:function(t,e){return l.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=l.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}),Object.defineProperty(ve.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(ve.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==t?t.length/this.stride:0,this.array=t,this},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,r){t*=this.stride,r*=e.stride;for(var n=0,i=this.stride;n<i;n++)this.array[t+n]=e.array[r+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}}),Object.defineProperties(_e.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(_e.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this},setXYZ:function(t,e,r,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=i,this}}),((be.prototype=Object.create(k.prototype)).constructor=be).prototype.isSpriteMaterial=!0,be.prototype.copy=function(t){return k.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this},xe.prototype=Object.assign(Object.create(l.prototype),{constructor:xe,isSprite:!0,raycast:(Bs=new St,Us=new St,Vs=new St,Gs=new H,qs=new H,Hs=new wt,$s=new St,Ws=new St,Xs=new St,function(t,e){Us.setFromMatrixScale(this.matrixWorld),Hs.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),Vs.setFromMatrixPosition(this.modelViewMatrix);var r=this.material.rotation;if(0!==r)var n=Math.cos(r),i=Math.sin(r);r=this.center,pu($s.set(-.5,-.5,0),Vs,r,Us,i,n),pu(Ws.set(.5,-.5,0),Vs,r,Us,i,n),pu(Xs.set(.5,.5,0),Vs,r,Us,i,n);var o=t.ray.intersectTriangle($s,Ws,Xs,!1,Bs);null===o&&(pu(Ws.set(-.5,.5,0),Vs,r,Us,i,n),null===(o=t.ray.intersectTriangle($s,Xs,Ws,!1,Bs)))||(i=t.ray.origin.distanceTo(Bs))<t.near||i>t.far||e.push({distance:i,point:Bs.clone(),face:null,object:this})}),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return l.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}}),we.prototype=Object.assign(Object.create(l.prototype),{constructor:we,copy:function(t){l.prototype.copy.call(this,t,!1);for(var e=0,r=(t=t.levels).length;e<r;e++){var n=t[e];this.addLevel(n.object.clone(),n.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var r=this.levels,n=0;n<r.length&&!(e<r[n].distance);n++);r.splice(n,0,{distance:e,object:t}),this.add(t)},getObjectForDistance:function(t){for(var e=this.levels,r=1,n=e.length;r<n&&!(t<e[r].distance);r++);return e[r-1].object},raycast:(Ks=new St,function(t,e){Ks.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(Ks);this.getObjectForDistance(r).raycast(t,e)}),update:(Ys=new St,Zs=new St,function(t){var e=this.levels;if(1<e.length){Ys.setFromMatrixPosition(t.matrixWorld),Zs.setFromMatrixPosition(this.matrixWorld),t=Ys.distanceTo(Zs),e[0].object.visible=!0;for(var r=1,n=e.length;r<n&&t>=e[r].distance;r++)e[r-1].object.visible=!1,e[r].object.visible=!0;for(;r<n;r++)e[r].object.visible=!1}}),toJSON:function(t){(t=l.prototype.toJSON.call(this,t)).object.levels=[];for(var e=this.levels,r=0,n=e.length;r<n;r++){var i=e[r];t.object.levels.push({object:i.object.uuid,distance:i.distance})}return t}}),Object.assign(Se.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var r=new wt;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},pose:function(){var t,e,r=0;for(e=this.bones.length;r<e;r++)(t=this.bones[r])&&t.matrixWorld.getInverse(this.boneInverses[r]);for(r=0,e=this.bones.length;r<e;r++)(t=this.bones[r])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:(Js=new wt,Qs=new wt,function(){for(var t=this.bones,e=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,o=t.length;i<o;i++)Js.multiplyMatrices(t[i]?t[i].matrixWorld:Qs,e[i]),Js.toArray(r,16*i);void 0!==n&&(n.needsUpdate=!0)}),clone:function(){return new Se(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,r=this.bones.length;e<r;e++){var n=this.bones[e];if(n.name===t)return n}}}),Ee.prototype=Object.assign(Object.create(l.prototype),{constructor:Ee,isBone:!0}),Ce.prototype=Object.assign(Object.create(B.prototype),{constructor:Ce,isSkinnedMesh:!0,initBones:function(){var t,e=[];if(this.geometry&&void 0!==this.geometry.bones){var r=0;for(t=this.geometry.bones.length;r<t;r++){var n=this.geometry.bones[r],i=new Ee;e.push(i),i.name=n.name,i.position.fromArray(n.pos),i.quaternion.fromArray(n.rotq),void 0!==n.scl&&i.scale.fromArray(n.scl)}for(r=0,t=this.geometry.bones.length;r<t;r++)-1!==(n=this.geometry.bones[r]).parent&&null!==n.parent&&void 0!==e[n.parent]?e[n.parent].add(e[r]):this.add(e[r])}return this.updateMatrixWorld(!0),e},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var t;if(this.geometry&&this.geometry.isGeometry)for(t=0;t<this.geometry.skinWeights.length;t++){var e=this.geometry.skinWeights[t],r=1/e.manhattanLength();1/0!==r?e.multiplyScalar(r):e.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){e=new Et;var n=this.geometry.attributes.skinWeight;for(t=0;t<n.count;t++)e.x=n.getX(t),e.y=n.getY(t),e.z=n.getZ(t),e.w=n.getW(t),1/0!==(r=1/e.manhattanLength())?e.multiplyScalar(r):e.set(1,0,0,0),n.setXYZW(t,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(t){B.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),((Me.prototype=Object.create(k.prototype)).constructor=Me).prototype.isLineBasicMaterial=!0,Me.prototype.copy=function(t){return k.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},Te.prototype=Object.assign(Object.create(l.prototype),{constructor:Te,isLine:!0,computeLineDistances:(nu=new St,iu=new St,function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,r=[0],n=1,i=e.count;n<i;n++)nu.fromBufferAttribute(e,n-1),iu.fromBufferAttribute(e,n),r[n]=r[n-1],r[n]+=nu.distanceTo(iu);t.addAttribute("lineDistance",new O(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry)for(e=t.vertices,(r=t.lineDistances)[0]=0,n=1,i=e.length;n<i;n++)r[n]=r[n-1],r[n]+=e[n-1].distanceTo(e[n]);return this}),raycast:(tu=new wt,eu=new z,ru=new a,function(t,e){var r=t.linePrecision;r*=r;var n=this.geometry,i=this.matrixWorld;if(null===n.boundingSphere&&n.computeBoundingSphere(),ru.copy(n.boundingSphere),ru.applyMatrix4(i),!1!==t.ray.intersectsSphere(ru)){tu.getInverse(i),eu.copy(t.ray).applyMatrix4(tu);var o=new St,a=new St;i=new St;var s=new St,u=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){var c=n.index,l=n.attributes.position.array;if(null!==c){n=0;for(var h=(c=c.array).length-1;n<h;n+=u){var p=c[n+1];o.fromArray(l,3*c[n]),a.fromArray(l,3*p),r<(p=eu.distanceSqToSegment(o,a,s,i))||(s.applyMatrix4(this.matrixWorld),(p=t.ray.origin.distanceTo(s))<t.near||p>t.far||e.push({distance:p,point:i.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this}))}}else for(n=0,h=l.length/3-1;n<h;n+=u)o.fromArray(l,3*n),a.fromArray(l,3*n+3),r<(p=eu.distanceSqToSegment(o,a,s,i))||(s.applyMatrix4(this.matrixWorld),(p=t.ray.origin.distanceTo(s))<t.near||p>t.far||e.push({distance:p,point:i.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this}))}else if(n.isGeometry)for(a=(o=n.vertices).length,n=0;n<a-1;n+=u)r<(p=eu.distanceSqToSegment(o[n],o[n+1],s,i))||(s.applyMatrix4(this.matrixWorld),(p=t.ray.origin.distanceTo(s))<t.near||p>t.far||e.push({distance:p,point:i.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this}))}}),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Pe.prototype=Object.assign(Object.create(Te.prototype),{constructor:Pe,isLineSegments:!0,computeLineDistances:(ou=new St,au=new St,function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,r=[],n=0,i=e.count;n<i;n+=2)ou.fromBufferAttribute(e,n),au.fromBufferAttribute(e,n+1),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+ou.distanceTo(au);t.addAttribute("lineDistance",new O(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry)for(e=t.vertices,r=t.lineDistances,n=0,i=e.length;n<i;n+=2)ou.copy(e[n]),au.copy(e[n+1]),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+ou.distanceTo(au);return this})}),Oe.prototype=Object.assign(Object.create(Te.prototype),{constructor:Oe,isLineLoop:!0}),((Ae.prototype=Object.create(k.prototype)).constructor=Ae).prototype.isPointsMaterial=!0,Ae.prototype.copy=function(t){return k.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this},Ie.prototype=Object.assign(Object.create(l.prototype),{constructor:Ie,isPoints:!0,raycast:(su=new wt,uu=new z,cu=new a,function(n,i){function t(t,e){var r=uu.distanceSqToPoint(t);r<s&&(uu.closestPointToPoint(t,u),u.applyMatrix4(a),(t=n.ray.origin.distanceTo(u))<n.near||t>n.far||i.push({distance:t,distanceToRay:Math.sqrt(r),point:u.clone(),index:e,face:null,object:o}))}var o=this,e=this.geometry,a=this.matrixWorld,r=n.params.Points.threshold;if(null===e.boundingSphere&&e.computeBoundingSphere(),cu.copy(e.boundingSphere),cu.applyMatrix4(a),cu.radius+=r,!1!==n.ray.intersectsSphere(cu)){su.getInverse(a),uu.copy(n.ray).applyMatrix4(su);var s=(r/=(this.scale.x+this.scale.y+this.scale.z)/3)*r;r=new St;var u=new St;if(e.isBufferGeometry){var c=e.index;if(e=e.attributes.position.array,null!==c){var l=c.array;c=0;for(var h=l.length;c<h;c++){var p=l[c];r.fromArray(e,3*p),t(r,p)}}else for(c=0,l=e.length/3;c<l;c++)r.fromArray(e,3*c),t(r,c)}else for(c=0,l=(r=e.vertices).length;c<l;c++)t(r[c],c)}}),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Le.prototype=Object.assign(Object.create(p.prototype),{constructor:Le,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),((Re.prototype=Object.create(p.prototype)).constructor=Re).prototype.isCompressedTexture=!0,((Ne.prototype=Object.create(p.prototype)).constructor=Ne).prototype.isCanvasTexture=!0,((ke.prototype=Object.create(p.prototype)).constructor=ke).prototype.isDepthTexture=!0,(De.prototype=Object.create(A.prototype)).constructor=De,(je.prototype=Object.create(E.prototype)).constructor=je,(ze.prototype=Object.create(A.prototype)).constructor=ze,(Fe.prototype=Object.create(E.prototype)).constructor=Fe,(Be.prototype=Object.create(A.prototype)).constructor=Be,(Ue.prototype=Object.create(E.prototype)).constructor=Ue,(Ve.prototype=Object.create(Be.prototype)).constructor=Ve,(Ge.prototype=Object.create(E.prototype)).constructor=Ge,(qe.prototype=Object.create(Be.prototype)).constructor=qe,(He.prototype=Object.create(E.prototype)).constructor=He,($e.prototype=Object.create(Be.prototype)).constructor=$e,(We.prototype=Object.create(E.prototype)).constructor=We,(Xe.prototype=Object.create(Be.prototype)).constructor=Xe,(Ye.prototype=Object.create(E.prototype)).constructor=Ye,(Ze.prototype=Object.create(A.prototype)).constructor=Ze,(Ke.prototype=Object.create(E.prototype)).constructor=Ke,(Je.prototype=Object.create(A.prototype)).constructor=Je,(Qe.prototype=Object.create(E.prototype)).constructor=Qe,(tr.prototype=Object.create(A.prototype)).constructor=tr;var fu=function(t,e,r){r=r||2;var n,i=e&&e.length,o=i?e[0]*r:t.length,a=er(t,0,o,r,!0),s=[];if(!a)return s;if(i){var u,c=r;i=[];var l=0;for(u=e.length;l<u;l++){var h=e[l]*c;(h=er(t,h,l<u-1?e[l+1]*c:t.length,c,!1))===h.next&&(h.steiner=!0),i.push(ar(h))}for(i.sort(nr),l=0;l<i.length;l++)(c=ir(e=i[l],c=a))&&rr(e=pr(c,e),e.next),a=rr(a,a.next)}if(t.length>80*r){var p=n=t[0],f=i=t[1];for(c=r;c<o;c+=r)(l=t[c])<p&&(p=l),(e=t[c+1])<f&&(f=e),n<l&&(n=l),i<e&&(i=e);n=0!==(n=Math.max(n-p,i-f))?1/n:0}return function t(e,r,n,i,o,a,s){if(e){if(!s&&a){for(var u=e,c=u;null===c.z&&(c.z=or(c.x,c.y,i,o,a)),c.prevZ=c.prev,(c=c.nextZ=c.next)!==u;);c.prevZ.nextZ=null,c.prevZ=null,u=c;var l,h,p,f,d=1;do{c=u;var m=u=null;for(h=0;c;){h++;var g=c;for(l=p=0;l<d&&(p++,g=g.nextZ);l++);for(f=d;0<p||0<f&&g;)0!==p&&(0===f||!g||c.z<=g.z)?(c=(l=c).nextZ,p--):(g=(l=g).nextZ,f--),m?m.nextZ=l:u=l,l.prevZ=m,m=l;c=g}m.nextZ=null,d*=2}while(1<h)}for(u=e;e.prev!==e.next;){if(c=e.prev,g=e.next,a)t:{f=i;var y=o,v=a;if(0<=ur(h=(m=e).prev,p=m,d=m.next))m=!1;else{var _=h.x>p.x?h.x>d.x?h.x:d.x:p.x>d.x?p.x:d.x,b=h.y>p.y?h.y>d.y?h.y:d.y:p.y>d.y?p.y:d.y;for(l=or(h.x<p.x?h.x<d.x?h.x:d.x:p.x<d.x?p.x:d.x,h.y<p.y?h.y<d.y?h.y:d.y:p.y<d.y?p.y:d.y,f,y,v),f=or(_,b,f,y,v),y=m.nextZ;y&&y.z<=f;){if(y!==m.prev&&y!==m.next&&sr(h.x,h.y,p.x,p.y,d.x,d.y,y.x,y.y)&&0<=ur(y.prev,y,y.next)){m=!1;break t}y=y.nextZ}for(y=m.prevZ;y&&y.z>=l;){if(y!==m.prev&&y!==m.next&&sr(h.x,h.y,p.x,p.y,d.x,d.y,y.x,y.y)&&0<=ur(y.prev,y,y.next)){m=!1;break t}y=y.prevZ}m=!0}}else t:if(m=e,h=m.prev,p=m,d=m.next,0<=ur(h,p,d))m=!1;else{for(l=m.next.next;l!==m.prev;){if(sr(h.x,h.y,p.x,p.y,d.x,d.y,l.x,l.y)&&0<=ur(l.prev,l,l.next)){m=!1;break t}l=l.next}m=!0}if(m)r.push(c.i/n),r.push(e.i/n),r.push(g.i/n),dr(e),u=e=g.next;else if((e=g)===u){if(s){if(1===s){for(s=r,u=n,c=e;!cr(g=c.prev,m=c.next.next)&&lr(g,c,c.next,m)&&hr(g,m)&&hr(m,g)&&(s.push(g.i/u),s.push(c.i/u),s.push(m.i/u),dr(c),dr(c.next),c=e=m),(c=c.next)!==e;);t(e=c,r,n,i,o,a,2)}else if(2===s)t:{s=e;do{for(u=s.next.next;u!==s.prev;){if(c=s.i!==u.i){if(g=u,m=(c=s).next.i!==g.i&&c.prev.i!==g.i){e:{m=c;do{if(m.i!==c.i&&m.next.i!==c.i&&m.i!==g.i&&m.next.i!==g.i&&lr(m,m.next,c,g)){m=!0;break e}m=m.next}while(m!==c);m=!1}m=!m}if(m=m&&hr(c,g)&&hr(g,c)){for(h=!1,p=((m=c).x+g.x)/2,g=(c.y+g.y)/2;m.y>g!=m.next.y>g&&m.next.y!==m.y&&p<(m.next.x-m.x)*(g-m.y)/(m.next.y-m.y)+m.x&&(h=!h),(m=m.next)!==c;);m=h}c=m}if(c){e=pr(s,u),s=rr(s,s.next),e=rr(e,e.next),t(s,r,n,i,o,a),t(e,r,n,i,o,a);break t}u=u.next}s=s.next}while(s!==e)}}else t(rr(e),r,n,i,o,a,1);break}}}}(a,s,r,p,f,n),s},du={area:function(t){for(var e=t.length,r=0,n=e-1,i=0;i<e;n=i++)r+=t[n].x*t[i].y-t[i].x*t[n].y;return.5*r},isClockWise:function(t){return du.area(t)<0},triangulateShape:function(t,e){var r=[],n=[],i=[];gr(t),yr(r,t);var o=t.length;for(e.forEach(gr),t=0;t<e.length;t++)n.push(o),o+=e[t].length,yr(r,e[t]);for(e=fu(r,n),t=0;t<e.length;t+=3)i.push(e.slice(t,t+3));return i}};((vr.prototype=Object.create(E.prototype)).constructor=vr).prototype.toJSON=function(){var t=E.prototype.toJSON.call(this);return br(this.parameters.shapes,this.parameters.options,t)},((_r.prototype=Object.create(A.prototype)).constructor=_r).prototype.toJSON=function(){var t=A.prototype.toJSON.call(this);return br(this.parameters.shapes,this.parameters.options,t)};var mu={generateTopUV:function(t,e,r,n,i){t=e[3*n],n=e[3*n+1];var o=e[3*i];return i=e[3*i+1],[new H(e[3*r],e[3*r+1]),new H(t,n),new H(o,i)]},generateSideWallUV:function(t,e,r,n,i,o){t=e[3*r];var a=e[3*r+1];r=e[3*r+2];var s=e[3*n],u=e[3*n+1];n=e[3*n+2];var c=e[3*i],l=e[3*i+1];i=e[3*i+2];var h=e[3*o],p=e[3*o+1];return e=e[3*o+2],Math.abs(a-u)<.01?[new H(t,1-r),new H(s,1-n),new H(c,1-i),new H(h,1-e)]:[new H(a,1-r),new H(u,1-n),new H(l,1-i),new H(p,1-e)]}};(xr.prototype=Object.create(E.prototype)).constructor=xr,(wr.prototype=Object.create(_r.prototype)).constructor=wr,(Sr.prototype=Object.create(E.prototype)).constructor=Sr,(Er.prototype=Object.create(A.prototype)).constructor=Er,(Cr.prototype=Object.create(E.prototype)).constructor=Cr,(Mr.prototype=Object.create(A.prototype)).constructor=Mr,(Tr.prototype=Object.create(E.prototype)).constructor=Tr,(Pr.prototype=Object.create(A.prototype)).constructor=Pr,((Or.prototype=Object.create(E.prototype)).constructor=Or).prototype.toJSON=function(){var t=E.prototype.toJSON.call(this);return Ir(this.parameters.shapes,t)},((Ar.prototype=Object.create(A.prototype)).constructor=Ar).prototype.toJSON=function(){var t=A.prototype.toJSON.call(this);return Ir(this.parameters.shapes,t)},(Lr.prototype=Object.create(A.prototype)).constructor=Lr,(Rr.prototype=Object.create(E.prototype)).constructor=Rr,(Nr.prototype=Object.create(A.prototype)).constructor=Nr,(kr.prototype=Object.create(Rr.prototype)).constructor=kr,(Dr.prototype=Object.create(Nr.prototype)).constructor=Dr,(jr.prototype=Object.create(E.prototype)).constructor=jr,(zr.prototype=Object.create(A.prototype)).constructor=zr;var gu=Object.freeze({WireframeGeometry:De,ParametricGeometry:je,ParametricBufferGeometry:ze,TetrahedronGeometry:Ue,TetrahedronBufferGeometry:Ve,OctahedronGeometry:Ge,OctahedronBufferGeometry:qe,IcosahedronGeometry:He,IcosahedronBufferGeometry:$e,DodecahedronGeometry:We,DodecahedronBufferGeometry:Xe,PolyhedronGeometry:Fe,PolyhedronBufferGeometry:Be,TubeGeometry:Ye,TubeBufferGeometry:Ze,TorusKnotGeometry:Ke,TorusKnotBufferGeometry:Je,TorusGeometry:Qe,TorusBufferGeometry:tr,TextGeometry:xr,TextBufferGeometry:wr,SphereGeometry:Sr,SphereBufferGeometry:Er,RingGeometry:Cr,RingBufferGeometry:Mr,PlaneGeometry:R,PlaneBufferGeometry:N,LatheGeometry:Tr,LatheBufferGeometry:Pr,ShapeGeometry:Or,ShapeBufferGeometry:Ar,ExtrudeGeometry:vr,ExtrudeBufferGeometry:_r,EdgesGeometry:Lr,ConeGeometry:kr,ConeBufferGeometry:Dr,CylinderGeometry:Rr,CylinderBufferGeometry:Nr,CircleGeometry:jr,CircleBufferGeometry:zr,BoxGeometry:I,BoxBufferGeometry:L});((Fr.prototype=Object.create(k.prototype)).constructor=Fr).prototype.isShadowMaterial=!0,Fr.prototype.copy=function(t){return k.prototype.copy.call(this,t),this.color.copy(t.color),this},((Br.prototype=Object.create(j.prototype)).constructor=Br).prototype.isRawShaderMaterial=!0,((Ur.prototype=Object.create(k.prototype)).constructor=Ur).prototype.isMeshStandardMaterial=!0,Ur.prototype.copy=function(t){return k.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((Vr.prototype=Object.create(Ur.prototype)).constructor=Vr).prototype.isMeshPhysicalMaterial=!0,Vr.prototype.copy=function(t){return Ur.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this},((Gr.prototype=Object.create(k.prototype)).constructor=Gr).prototype.isMeshPhongMaterial=!0,Gr.prototype.copy=function(t){return k.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((qr.prototype=Object.create(Gr.prototype)).constructor=qr).prototype.isMeshToonMaterial=!0,qr.prototype.copy=function(t){return Gr.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},((Hr.prototype=Object.create(k.prototype)).constructor=Hr).prototype.isMeshNormalMaterial=!0,Hr.prototype.copy=function(t){return k.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},(($r.prototype=Object.create(k.prototype)).constructor=$r).prototype.isMeshLambertMaterial=!0,$r.prototype.copy=function(t){return k.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((Wr.prototype=Object.create(Me.prototype)).constructor=Wr).prototype.isLineDashedMaterial=!0,Wr.prototype.copy=function(t){return Me.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var yu=Object.freeze({ShadowMaterial:Fr,SpriteMaterial:be,RawShaderMaterial:Br,ShaderMaterial:j,PointsMaterial:Ae,MeshPhysicalMaterial:Vr,MeshStandardMaterial:Ur,MeshPhongMaterial:Gr,MeshToonMaterial:qr,MeshNormalMaterial:Hr,MeshLambertMaterial:$r,MeshDepthMaterial:ne,MeshDistanceMaterial:ie,MeshBasicMaterial:D,LineDashedMaterial:Wr,LineBasicMaterial:Me,Material:k}),vu={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},_u=new Xr,bu={};Object.assign(Yr.prototype,{load:function(a,t,e,r){void 0===a&&(a=""),void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);var s=this,n=vu.get(a);if(void 0!==n)return s.manager.itemStart(a),setTimeout(function(){t&&t(n),s.manager.itemEnd(a)},0),n;if(void 0===bu[a]){var i=a.match(/^data:(.*?)(;base64)?,(.*)$/);if(i){e=i[1];var o=!!i[2];i=i[3],i=window.decodeURIComponent(i),o&&(i=window.atob(i));try{var u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":var c=new Uint8Array(i.length);for(o=0;o<i.length;o++)c[o]=i.charCodeAt(o);var l="blob"===u?new Blob([c.buffer],{type:e}):c.buffer;break;case"document":l=(new DOMParser).parseFromString(i,e);break;case"json":l=JSON.parse(i);break;default:l=i}window.setTimeout(function(){t&&t(l),s.manager.itemEnd(a)},0)}catch(t){window.setTimeout(function(){r&&r(t),s.manager.itemEnd(a),s.manager.itemError(a)},0)}}else{bu[a]=[],bu[a].push({onLoad:t,onProgress:e,onError:r});var h=new XMLHttpRequest;for(o in h.open("GET",a,!0),h.addEventListener("load",function(t){var e=this.response;vu.add(a,e);var r=bu[a];if(delete bu[a],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var n=0,i=r.length;n<i;n++){var o=r[n];o.onLoad&&o.onLoad(e)}s.manager.itemEnd(a)}else{for(n=0,i=r.length;n<i;n++)(o=r[n]).onError&&o.onError(t);s.manager.itemEnd(a),s.manager.itemError(a)}},!1),h.addEventListener("progress",function(t){for(var e=bu[a],r=0,n=e.length;r<n;r++){var i=e[r];i.onProgress&&i.onProgress(t)}},!1),h.addEventListener("error",function(t){var e=bu[a];delete bu[a];for(var r=0,n=e.length;r<n;r++){var i=e[r];i.onError&&i.onError(t)}s.manager.itemEnd(a),s.manager.itemError(a)},!1),void 0!==this.responseType&&(h.responseType=this.responseType),void 0!==this.withCredentials&&(h.withCredentials=this.withCredentials),h.overrideMimeType&&h.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)h.setRequestHeader(o,this.requestHeader[o]);h.send(null)}return s.manager.itemStart(a),h}bu[a].push({onLoad:t,onProgress:e,onError:r})},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),Object.assign(Zr.prototype,{load:function(t,i,r,n){function e(e){u.load(t[e],function(t){t=o._parser(t,!0),a[e]={width:t.width,height:t.height,format:t.format,mipmaps:t.mipmaps},6===(c+=1)&&(1===t.mipmapCount&&(s.minFilter=1006),s.format=t.format,s.needsUpdate=!0,i&&i(s))},r,n)}var o=this,a=[],s=new Re;s.image=a;var u=new Yr(this.manager);if(u.setPath(this.path),u.setResponseType("arraybuffer"),Array.isArray(t))for(var c=0,l=0,h=t.length;l<h;++l)e(l);else u.load(t,function(t){if((t=o._parser(t,!0)).isCubemap)for(var e=t.mipmaps.length/t.mipmapCount,r=0;r<e;r++){a[r]={mipmaps:[]};for(var n=0;n<t.mipmapCount;n++)a[r].mipmaps.push(t.mipmaps[r*t.mipmapCount+n]),a[r].format=t.format,a[r].width=t.width,a[r].height=t.height}else s.image.width=t.width,s.image.height=t.height,s.mipmaps=t.mipmaps;1===t.mipmapCount&&(s.minFilter=1006),s.format=t.format,s.needsUpdate=!0,i&&i(s)},r,n);return s},setPath:function(t){return this.path=t,this}}),Object.assign(Kr.prototype,{load:function(t,e,r,n){var i=this,o=new Ct,a=new Yr(this.manager);return a.setResponseType("arraybuffer"),a.load(t,function(t){(t=i._parser(t))&&(void 0!==t.image?o.image=t.image:void 0!==t.data&&(o.image.width=t.width,o.image.height=t.height,o.image.data=t.data),o.wrapS=void 0!==t.wrapS?t.wrapS:1001,o.wrapT=void 0!==t.wrapT?t.wrapT:1001,o.magFilter=void 0!==t.magFilter?t.magFilter:1006,o.minFilter=void 0!==t.minFilter?t.minFilter:1008,o.anisotropy=void 0!==t.anisotropy?t.anisotropy:1,void 0!==t.format&&(o.format=t.format),void 0!==t.type&&(o.type=t.type),void 0!==t.mipmaps&&(o.mipmaps=t.mipmaps),1===t.mipmapCount&&(o.minFilter=1006),o.needsUpdate=!0,e&&e(o,t))},r,n),o}}),Object.assign(Jr.prototype,{crossOrigin:"anonymous",load:function(e,t,r,n){function i(){u.removeEventListener("load",i,!1),u.removeEventListener("error",o,!1),vu.add(e,this),t&&t(this),a.manager.itemEnd(e)}function o(t){u.removeEventListener("load",i,!1),u.removeEventListener("error",o,!1),n&&n(t),a.manager.itemEnd(e),a.manager.itemError(e)}void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=this,s=vu.get(e);if(void 0!==s)return a.manager.itemStart(e),setTimeout(function(){t&&t(s),a.manager.itemEnd(e)},0),s;var u=document.createElementNS("http://www.w3.org/1999/xhtml","img");return u.addEventListener("load",i,!1),u.addEventListener("error",o,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(u.crossOrigin=this.crossOrigin),a.manager.itemStart(e),u.src=e,u},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Qr.prototype,{crossOrigin:"anonymous",load:function(t,r,e,n){function i(e){a.load(t[e],function(t){o.images[e]=t,6===++s&&(o.needsUpdate=!0,r&&r(o))},void 0,n)}var o=new V,a=new Jr(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var s=0;for(e=0;e<t.length;++e)i(e);return o},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(tn.prototype,{crossOrigin:"anonymous",load:function(e,r,t,n){var i=new p,o=new Jr(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(t){i.image=t,t=0<e.search(/\.(jpg|jpeg)$/)||0===e.search(/^data:image\/jpeg/),i.format=t?1022:1023,i.needsUpdate=!0,void 0!==r&&r(i)},t,n),i},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(en.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){return t=this.getUtoTmapping(t),this.getPoint(t,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPointAt(r/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,r=[],n=this.getPoint(0),i=0;for(r.push(0),e=1;e<=t;e++){var o=this.getPoint(e/t);i+=o.distanceTo(n),r.push(i),n=o}return this.cacheArcLengths=r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var r=this.getLengths(),n=r.length;e=e||t*r[n-1];for(var i,o=0,a=n-1;o<=a;)if((i=r[t=Math.floor(o+(a-o)/2)]-e)<0)o=t+1;else{if(!(0<i)){a=t;break}a=t-1}return r[t=a]===e?t/(n-1):(t+(e-(o=r[t]))/(r[t+1]-o))/(n-1)},getTangent:function(t){var e=t-1e-4;return e<0&&(e=0),1<(t+=1e-4)&&(t=1),e=this.getPoint(e),this.getPoint(t).clone().sub(e).normalize()},getTangentAt:function(t){return t=this.getUtoTmapping(t),this.getTangent(t)},computeFrenetFrames:function(t,e){var r,n=new St,i=[],o=[],a=[],s=new St,u=new wt;for(r=0;r<=t;r++){var c=r/t;i[r]=this.getTangentAt(c),i[r].normalize()}o[0]=new St,a[0]=new St,r=Number.MAX_VALUE,c=Math.abs(i[0].x);var l=Math.abs(i[0].y),h=Math.abs(i[0].z);for(c<=r&&(r=c,n.set(1,0,0)),l<=r&&(r=l,n.set(0,1,0)),h<=r&&n.set(0,0,1),s.crossVectors(i[0],n).normalize(),o[0].crossVectors(i[0],s),a[0].crossVectors(i[0],o[0]),r=1;r<=t;r++)o[r]=o[r-1].clone(),a[r]=a[r-1].clone(),s.crossVectors(i[r-1],i[r]),s.length()>Number.EPSILON&&(s.normalize(),n=Math.acos(po.clamp(i[r-1].dot(i[r]),-1,1)),o[r].applyMatrix4(u.makeRotationAxis(s,n))),a[r].crossVectors(i[r],o[r]);if(!0===e)for(n=Math.acos(po.clamp(o[0].dot(o[t]),-1,1)),n/=t,0<i[0].dot(s.crossVectors(o[0],o[t]))&&(n=-n),r=1;r<=t;r++)o[r].applyMatrix4(u.makeRotationAxis(i[r],n*r)),a[r].crossVectors(i[r],o[r]);return{tangents:i,normals:o,binormals:a}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),((rn.prototype=Object.create(en.prototype)).constructor=rn).prototype.isEllipseCurve=!0,rn.prototype.getPoint=function(t,e){e=e||new H;for(var r=2*Math.PI,n=this.aEndAngle-this.aStartAngle,i=Math.abs(n)<Number.EPSILON;n<0;)n+=r;for(;r<n;)n-=r;n<Number.EPSILON&&(n=i?0:r),!0!==this.aClockwise||i||(n=n===r?-r:n-r),r=this.aStartAngle+t*n,t=this.aX+this.xRadius*Math.cos(r);var o=this.aY+this.yRadius*Math.sin(r);return 0!==this.aRotation&&(r=Math.cos(this.aRotation),n=Math.sin(this.aRotation),t=(i=t-this.aX)*r-(o-=this.aY)*n+this.aX,o=i*n+o*r+this.aY),e.set(t,o)},rn.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},rn.prototype.toJSON=function(){var t=en.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},rn.prototype.fromJSON=function(t){return en.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},((nn.prototype=Object.create(rn.prototype)).constructor=nn).prototype.isArcCurve=!0;var xu=new St,wu=new on,Su=new on,Eu=new on;((an.prototype=Object.create(en.prototype)).constructor=an).prototype.isCatmullRomCurve3=!0,an.prototype.getPoint=function(t,e){e=e||new St;var r=this.points,n=r.length;t*=n-(this.closed?0:1);var i=Math.floor(t);if(t-=i,this.closed?i+=0<i?0:(Math.floor(Math.abs(i)/n)+1)*n:0===t&&i===n-1&&(i=n-2,t=1),this.closed||0<i)var o=r[(i-1)%n];else xu.subVectors(r[0],r[1]).add(r[0]),o=xu;var a=r[i%n],s=r[(i+1)%n];if(r=this.closed||i+2<n?r[(i+2)%n]:(xu.subVectors(r[n-1],r[n-2]).add(r[n-1]),xu),"centripetal"===this.curveType||"chordal"===this.curveType){var u="chordal"===this.curveType?.5:.25;n=Math.pow(o.distanceToSquared(a),u),(i=Math.pow(a.distanceToSquared(s),u))<1e-4&&(i=1),n<1e-4&&(n=i),(u=Math.pow(s.distanceToSquared(r),u))<1e-4&&(u=i),wu.initNonuniformCatmullRom(o.x,a.x,s.x,r.x,n,i,u),Su.initNonuniformCatmullRom(o.y,a.y,s.y,r.y,n,i,u),Eu.initNonuniformCatmullRom(o.z,a.z,s.z,r.z,n,i,u)}else"catmullrom"===this.curveType&&(wu.initCatmullRom(o.x,a.x,s.x,r.x,this.tension),Su.initCatmullRom(o.y,a.y,s.y,r.y,this.tension),Eu.initCatmullRom(o.z,a.z,s.z,r.z,this.tension));return e.set(wu.calc(t),Su.calc(t),Eu.calc(t)),e},an.prototype.copy=function(t){en.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++)this.points.push(t.points[e].clone());return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},an.prototype.toJSON=function(){var t=en.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++)t.points.push(this.points[e].toArray());return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},an.prototype.fromJSON=function(t){en.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new St).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},((ln.prototype=Object.create(en.prototype)).constructor=ln).prototype.isCubicBezierCurve=!0,ln.prototype.getPoint=function(t,e){e=e||new H;var r=this.v0,n=this.v1,i=this.v2,o=this.v3;return e.set(cn(t,r.x,n.x,i.x,o.x),cn(t,r.y,n.y,i.y,o.y)),e},ln.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},ln.prototype.toJSON=function(){var t=en.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},ln.prototype.fromJSON=function(t){return en.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},((hn.prototype=Object.create(en.prototype)).constructor=hn).prototype.isCubicBezierCurve3=!0,hn.prototype.getPoint=function(t,e){e=e||new St;var r=this.v0,n=this.v1,i=this.v2,o=this.v3;return e.set(cn(t,r.x,n.x,i.x,o.x),cn(t,r.y,n.y,i.y,o.y),cn(t,r.z,n.z,i.z,o.z)),e},hn.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},hn.prototype.toJSON=function(){var t=en.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},hn.prototype.fromJSON=function(t){return en.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},((pn.prototype=Object.create(en.prototype)).constructor=pn).prototype.isLineCurve=!0,pn.prototype.getPoint=function(t,e){return e=e||new H,1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e},pn.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},pn.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},pn.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},pn.prototype.toJSON=function(){var t=en.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},pn.prototype.fromJSON=function(t){return en.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},((fn.prototype=Object.create(en.prototype)).constructor=fn).prototype.isLineCurve3=!0,fn.prototype.getPoint=function(t,e){return e=e||new St,1===t?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(t).add(this.v1)),e},fn.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},fn.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},fn.prototype.toJSON=function(){var t=en.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},fn.prototype.fromJSON=function(t){return en.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},((dn.prototype=Object.create(en.prototype)).constructor=dn).prototype.isQuadraticBezierCurve=!0,dn.prototype.getPoint=function(t,e){e=e||new H;var r=this.v0,n=this.v1,i=this.v2;return e.set(un(t,r.x,n.x,i.x),un(t,r.y,n.y,i.y)),e},dn.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},dn.prototype.toJSON=function(){var t=en.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},dn.prototype.fromJSON=function(t){return en.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},((mn.prototype=Object.create(en.prototype)).constructor=mn).prototype.isQuadraticBezierCurve3=!0,mn.prototype.getPoint=function(t,e){e=e||new St;var r=this.v0,n=this.v1,i=this.v2;return e.set(un(t,r.x,n.x,i.x),un(t,r.y,n.y,i.y),un(t,r.z,n.z,i.z)),e},mn.prototype.copy=function(t){return en.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},mn.prototype.toJSON=function(){var t=en.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},mn.prototype.fromJSON=function(t){return en.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},((gn.prototype=Object.create(en.prototype)).constructor=gn).prototype.isSplineCurve=!0,gn.prototype.getPoint=function(t,e){e=e||new H;var r=this.points,n=(r.length-1)*t;n-=t=Math.floor(n);var i=r[0===t?t:t-1],o=r[t],a=r[t>r.length-2?r.length-1:t+1];return r=r[t>r.length-3?r.length-1:t+2],e.set(sn(n,i.x,o.x,a.x,r.x),sn(n,i.y,o.y,a.y,r.y)),e},gn.prototype.copy=function(t){en.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++)this.points.push(t.points[e].clone());return this},gn.prototype.toJSON=function(){var t=en.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++)t.points.push(this.points[e].toArray());return t},gn.prototype.fromJSON=function(t){en.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new H).fromArray(n))}return this};var Cu=Object.freeze({ArcCurve:nn,CatmullRomCurve3:an,CubicBezierCurve:ln,CubicBezierCurve3:hn,EllipseCurve:rn,LineCurve:pn,LineCurve3:fn,QuadraticBezierCurve:dn,QuadraticBezierCurve3:mn,SplineCurve:gn});yn.prototype=Object.assign(Object.create(en.prototype),{constructor:yn,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new pn(e,t))},getPoint:function(t){var e=t*this.getLength(),r=this.getCurveLengths();for(t=0;t<r.length;){if(r[t]>=e)return e=r[t]-e,r=(t=this.curves[t]).getLength(),t.getPointAt(0===r?0:1-e/r);t++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,r=0,n=this.curves.length;r<n;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,r=[],n=0,i=this.curves;n<i.length;n++){var o=i[n];o=o.getPoints(o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t);for(var a=0;a<o.length;a++){var s=o[a];e&&e.equals(s)||(r.push(s),e=s)}}return this.autoClose&&1<r.length&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(t){en.prototype.copy.call(this,t),this.curves=[];for(var e=0,r=t.curves.length;e<r;e++)this.curves.push(t.curves[e].clone());return this.autoClose=t.autoClose,this},toJSON:function(){var t=en.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,r=this.curves.length;e<r;e++)t.curves.push(this.curves[e].toJSON());return t},fromJSON:function(t){en.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var n=t.curves[e];this.curves.push((new Cu[n.type]).fromJSON(n))}return this}}),vn.prototype=Object.assign(Object.create(yn.prototype),{constructor:vn,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var r=new pn(this.currentPoint.clone(),new H(t,e));this.curves.push(r),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,r,n){t=new dn(this.currentPoint.clone(),new H(t,e),new H(r,n)),this.curves.push(t),this.currentPoint.set(r,n)},bezierCurveTo:function(t,e,r,n,i,o){t=new ln(this.currentPoint.clone(),new H(t,e),new H(r,n),new H(i,o)),this.curves.push(t),this.currentPoint.set(i,o)},splineThru:function(t){var e=[this.currentPoint.clone()].concat(t);e=new gn(e),this.curves.push(e),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,r,n,i,o){this.absarc(t+this.currentPoint.x,e+this.currentPoint.y,r,n,i,o)},absarc:function(t,e,r,n,i,o){this.absellipse(t,e,r,r,n,i,o)},ellipse:function(t,e,r,n,i,o,a,s){this.absellipse(t+this.currentPoint.x,e+this.currentPoint.y,r,n,i,o,a,s)},absellipse:function(t,e,r,n,i,o,a,s){t=new rn(t,e,r,n,i,o,a,s),0<this.curves.length&&((e=t.getPoint(0)).equals(this.currentPoint)||this.lineTo(e.x,e.y)),this.curves.push(t),t=t.getPoint(1),this.currentPoint.copy(t)},copy:function(t){return yn.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=yn.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return yn.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),_n.prototype=Object.assign(Object.create(vn.prototype),{constructor:_n,getPointsHoles:function(t){for(var e=[],r=0,n=this.holes.length;r<n;r++)e[r]=this.holes[r].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){vn.prototype.copy.call(this,t),this.holes=[];for(var e=0,r=t.holes.length;e<r;e++)this.holes.push(t.holes[e].clone());return this},toJSON:function(){var t=vn.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,r=this.holes.length;e<r;e++)t.holes.push(this.holes[e].toJSON());return t},fromJSON:function(t){vn.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var n=t.holes[e];this.holes.push((new vn).fromJSON(n))}return this}}),bn.prototype=Object.assign(Object.create(l.prototype),{constructor:bn,isLight:!0,copy:function(t){return l.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){return(t=l.prototype.toJSON.call(this,t)).object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),xn.prototype=Object.assign(Object.create(bn.prototype),{constructor:xn,isHemisphereLight:!0,copy:function(t){return bn.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(wn.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Sn.prototype=Object.assign(Object.create(wn.prototype),{constructor:Sn,isSpotLightShadow:!0,update:function(t){var e=this.camera,r=2*po.RAD2DEG*t.angle,n=this.mapSize.width/this.mapSize.height;t=t.distance||e.far,r===e.fov&&n===e.aspect&&t===e.far||(e.fov=r,e.aspect=n,e.far=t,e.updateProjectionMatrix())}}),En.prototype=Object.assign(Object.create(bn.prototype),{constructor:En,isSpotLight:!0,copy:function(t){return bn.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Cn.prototype=Object.assign(Object.create(bn.prototype),{constructor:Cn,isPointLight:!0,copy:function(t){return bn.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Mn.prototype=Object.assign(Object.create(wn.prototype),{constructor:Mn}),Tn.prototype=Object.assign(Object.create(bn.prototype),{constructor:Tn,isDirectionalLight:!0,copy:function(t){return bn.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Pn.prototype=Object.assign(Object.create(bn.prototype),{constructor:Pn,isAmbientLight:!0}),On.prototype=Object.assign(Object.create(bn.prototype),{constructor:On,isRectAreaLight:!0,copy:function(t){return bn.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){return(t=bn.prototype.toJSON.call(this,t)).object.width=this.width,t.object.height=this.height,t}});var Mu={arraySlice:function(t,e,r){return Mu.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==r?r:t.length)):t.slice(e,r)},convertArray:function(t,e,r){return!t||!r&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(r){for(var t=r.length,e=Array(t),n=0;n!==t;++n)e[n]=n;return e.sort(function(t,e){return r[t]-r[e]}),e},sortedArray:function(t,e,r){for(var n=t.length,i=new t.constructor(n),o=0,a=0;a!==n;++o)for(var s=r[o]*e,u=0;u!==e;++u)i[a++]=t[s+u];return i},flattenJSON:function(t,e,r,n){for(var i=1,o=t[0];void 0!==o&&void 0===o[n];)o=t[i++];if(void 0!==o){var a=o[n];if(void 0!==a)if(Array.isArray(a))for(;void 0!==(a=o[n])&&(e.push(o.time),r.push.apply(r,a)),void 0!==(o=t[i++]););else if(void 0!==a.toArray)for(;void 0!==(a=o[n])&&(e.push(o.time),a.toArray(r,r.length)),void 0!==(o=t[i++]););else for(;void 0!==(a=o[n])&&(e.push(o.time),r.push(a)),void 0!==(o=t[i++]););}}};Object.assign(An.prototype,{evaluate:function(t){var e=this.parameterPositions,r=this._cachedIndex,n=e[r],i=e[r-1];t:{e:{r:{n:if(!(t<n)){for(var o=r+2;;){if(void 0===n){if(t<i)break n;return this._cachedIndex=r=e.length,this.afterEnd_(r-1,t,i)}if(r===o)break;if(i=n,t<(n=e[++r]))break e}n=e.length;break r}if(i<=t)break t;for(t<(o=e[1])&&(r=2,i=o),o=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(r===o)break;if(n=i,(i=e[--r-1])<=t)break e}n=r,r=0}for(;r<n;)t<e[i=r+n>>>1]?n=i:r=i+1;if(n=e[r],void 0===(i=e[r-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return this._cachedIndex=r=e.length,this.afterEnd_(r-1,i,t)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){var e=this.resultBuffer,r=this.sampleValues,n=this.valueSize;t*=n;for(var i=0;i!==n;++i)e[i]=r[t+i];return e},interpolate_:function(){throw Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(An.prototype,{beforeStart_:An.prototype.copySampleValue_,afterEnd_:An.prototype.copySampleValue_}),In.prototype=Object.assign(Object.create(An.prototype),{constructor:In,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(t,e,r){var n=this.parameterPositions,i=t-2,o=t+1,a=n[i],s=n[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=t,a=2*e-r;break;case 2402:a=e+n[i=n.length-2]-n[i+1];break;default:i=t,a=r}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=t,s=2*r-e;break;case 2402:s=r+n[o=1]-n[0];break;default:o=t-1,s=e}t=.5*(r-e),n=this.valueSize,this._weightPrev=t/(e-a),this._weightNext=t/(s-r),this._offsetPrev=i*n,this._offsetNext=o*n},interpolate_:function(t,e,r,n){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(t*=a)-a,u=this._offsetPrev,c=this._offsetNext,l=this._weightPrev,h=this._weightNext,p=(r-e)/(n-e);for(e=-l*(n=(r=p*p)*p)+2*l*r-l*p,l=(1+l)*n+(-1.5-2*l)*r+(-.5+l)*p+1,p=(-1-h)*n+(1.5+h)*r+.5*p,h=h*n-h*r,r=0;r!==a;++r)i[r]=e*o[u+r]+l*o[s+r]+p*o[t+r]+h*o[c+r];return i}}),Ln.prototype=Object.assign(Object.create(An.prototype),{constructor:Ln,interpolate_:function(t,e,r,n){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(t*=a)-a;for(r=1-(e=(r-e)/(n-e)),n=0;n!==a;++n)i[n]=o[s+n]*r+o[t+n]*e;return i}}),Rn.prototype=Object.assign(Object.create(An.prototype),{constructor:Rn,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(Nn,{toJSON:function(t){var e=t.constructor;if(void 0!==e.toJSON)e=e.toJSON(t);else{e={name:t.name,times:Mu.convertArray(t.times,Array),values:Mu.convertArray(t.values,Array)};var r=t.getInterpolation();r!==t.DefaultInterpolation&&(e.interpolation=r)}return e.type=t.ValueTypeName,e}}),Object.assign(Nn.prototype,{constructor:Nn,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new Rn(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Ln(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new In(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){switch(t){case 2300:var e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0!==e)return this.createInterpolant=e,this;if(e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name,void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]*=t;return this},trim:function(t,e){for(var r=this.times,n=r.length,i=0,o=n-1;i!==n&&r[i]<t;)++i;for(;-1!==o&&r[o]>e;)--o;return++o,0===i&&o===n||(o<=i&&(i=(o=Math.max(o,1))-1),t=this.getValueSize(),this.times=Mu.arraySlice(r,i,o),this.values=Mu.arraySlice(this.values,i*t,o*t)),this},validate:function(){var t=!0,e=this.getValueSize();0!=e-Math.floor(e)&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var r=this.times;e=this.values;var n=r.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var i=null,o=0;o!==n;o++){var a=r[o];if("number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,a),t=!1;break}if(null!==i&&a<i){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,a,i),t=!1;break}i=a}if(void 0!==e&&Mu.isTypedArray(e))for(o=0,r=e.length;o!==r;++o)if(n=e[o],isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,n),t=!1;break}return t},optimize:function(){for(var t=this.times,e=this.values,r=this.getValueSize(),n=2302===this.getInterpolation(),i=1,o=t.length-1,a=1;a<o;++a){var s=!1,u=t[a];if(u!==t[a+1]&&(1!==a||u!==u[0]))if(n)s=!0;else{var c=a*r,l=c-r,h=c+r;for(u=0;u!==r;++u){var p=e[c+u];if(p!==e[l+u]||p!==e[h+u]){s=!0;break}}}if(s){if(a!==i)for(t[i]=t[a],s=a*r,c=i*r,u=0;u!==r;++u)e[c+u]=e[s+u];++i}}if(0<o){for(t[i]=t[o],s=o*r,c=i*r,u=0;u!==r;++u)e[c+u]=e[s+u];++i}return i!==t.length&&(this.times=Mu.arraySlice(t,0,i),this.values=Mu.arraySlice(e,0,i*r)),this}}),kn.prototype=Object.assign(Object.create(Nn.prototype),{constructor:kn,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Dn.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Dn,ValueTypeName:"color"}),jn.prototype=Object.assign(Object.create(Nn.prototype),{constructor:jn,ValueTypeName:"number"}),zn.prototype=Object.assign(Object.create(An.prototype),{constructor:zn,interpolate_:function(t,e,r,n){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize;for(e=(r-e)/(n-e),r=(t*=a)+a;t!==r;t+=4)s.slerpFlat(i,0,o,t-a,o,t,e);return i}}),Fn.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Fn,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new zn(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Bn.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Bn,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Un.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Un,ValueTypeName:"vector"}),Object.assign(Vn,{parse:function(t){for(var e=[],r=t.tracks,n=1/(t.fps||1),i=0,o=r.length;i!==o;++i)e.push(Gn(r[i]).scale(n));return new Vn(t.name,t.duration,e)},toJSON:function(t){var e=[],r=t.tracks;t={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid};for(var n=0,i=r.length;n!==i;++n)e.push(Nn.toJSON(r[n]));return t},CreateFromMorphTargetSequence:function(t,e,r,n){for(var i=e.length,o=[],a=0;a<i;a++){var s=[],u=[];s.push((a+i-1)%i,a,(a+1)%i),u.push(0,1,0);var c=Mu.getKeyframeOrder(s);s=Mu.sortedArray(s,1,c),u=Mu.sortedArray(u,1,c),n||0!==s[0]||(s.push(i),u.push(u[0])),o.push(new jn(".morphTargetInfluences["+e[a].name+"]",s,u).scale(1/r))}return new Vn(t,-1,o)},findByName:function(t,e){var r=t;for(Array.isArray(t)||(r=t.geometry&&t.geometry.animations||t.animations),t=0;t<r.length;t++)if(r[t].name===e)return r[t];return null},CreateClipsFromMorphTargetSequences:function(t,e,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],u=s.name.match(i);if(u&&1<u.length){var c=u[1];(u=n[c])||(n[c]=u=[]),u.push(s)}}for(c in t=[],n)t.push(Vn.CreateFromMorphTargetSequence(c,n[c],e,r));return t},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;function r(t,e,r,n,i){if(0!==r.length){var o=[],a=[];Mu.flattenJSON(r,o,a,n),0!==o.length&&i.push(new t(e,o,a))}}var n=[],i=t.name||"default",o=t.length||-1,a=t.fps||30;t=t.hierarchy||[];for(var s=0;s<t.length;s++){var u=t[s].keys;if(u&&0!==u.length)if(u[0].morphTargets){o={};for(var c=0;c<u.length;c++)if(u[c].morphTargets)for(var l=0;l<u[c].morphTargets.length;l++)o[u[c].morphTargets[l]]=-1;for(var h in o){var p=[],f=[];for(l=0;l!==u[c].morphTargets.length;++l){var d=u[c];p.push(d.time),f.push(d.morphTarget===h?1:0)}n.push(new jn(".morphTargetInfluence["+h+"]",p,f))}o=o.length*(a||1)}else r(Un,(c=".bones["+e[s].name+"]")+".position",u,"pos",n),r(Fn,c+".quaternion",u,"rot",n),r(Un,c+".scale",u,"scl",n)}return 0===n.length?null:new Vn(i,o,n)}}),Object.assign(Vn.prototype,{resetDuration:function(){for(var t=0,e=0,r=this.tracks.length;e!==r;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}}),Object.assign(qn.prototype,{load:function(t,e,r,n){var i=this;new Yr(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},setTextures:function(t){this.textures=t},parse:function(t){function e(t){return void 0===r[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),r[t]}var r=this.textures,n=new yu[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearCoat&&(n.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(n.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(n.uniforms=t.uniforms),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(n.vertexColors=t.vertexColors),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=e(t.map)),void 0!==t.alphaMap&&(n.alphaMap=e(t.alphaMap),n.transparent=!0),void 0!==t.bumpMap&&(n.bumpMap=e(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=e(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){var i=t.normalScale;!1===Array.isArray(i)&&(i=[i,i]),n.normalScale=(new H).fromArray(i)}return void 0!==t.displacementMap&&(n.displacementMap=e(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=e(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=e(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=e(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=e(t.specularMap)),void 0!==t.envMap&&(n.envMap=e(t.envMap)),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.lightMap&&(n.lightMap=e(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=e(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=e(t.gradientMap)),n}}),Object.assign(Hn.prototype,{load:function(t,e,r,n){var i=this;new Yr(i.manager).load(t,function(t){e(i.parse(JSON.parse(t)))},r,n)},parse:function(t){var e=new A,r=t.data.index;void 0!==r&&(r=new Iu[r.type](r.array),e.setIndex(new v(r,1)));var n=t.data.attributes;for(o in n){var i=n[o];r=new Iu[i.type](i.array),e.addAttribute(o,new v(r,i.itemSize,i.normalized))}var o=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==o)for(r=0,n=o.length;r!==n;++r)i=o[r],e.addGroup(i.start,i.count,i.materialIndex);return void 0!==(t=t.data.boundingSphere)&&(o=new St,void 0!==t.center&&o.fromArray(t.center),e.boundingSphere=new a(o,t.radius)),e}});var Tu,Pu,Ou,Au,Iu={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};$n.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,r=0,n=e.length;r<n;r+=2){var i=e[r+1];if(e[r].test(t))return i}return null}},Object.assign($n.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(t,e,r){for(var n=[],i=0;i<t.length;++i)n[i]=this.createMaterial(t[i],e,r);return n},createMaterial:(Tu={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},Pu=new w,Ou=new tn,Au=new qn,function(t,a,s){function e(t,e,r,n,i){t=a+t;var o=$n.Handlers.get(t);return t=null!==o?o.load(t):(Ou.setCrossOrigin(s),Ou.load(t)),void 0!==e&&(t.repeat.fromArray(e),1!==e[0]&&(t.wrapS=1e3),1!==e[1]&&(t.wrapT=1e3)),void 0!==r&&t.offset.fromArray(r),void 0!==n&&("repeat"===n[0]&&(t.wrapS=1e3),"mirror"===n[0]&&(t.wrapS=1002),"repeat"===n[1]&&(t.wrapT=1e3),"mirror"===n[1]&&(t.wrapT=1002)),void 0!==i&&(t.anisotropy=i),e=po.generateUUID(),u[e]=t,e}var r,u={},n={uuid:po.generateUUID(),type:"MeshLambertMaterial"};for(r in t){var i=t[r];switch(r){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":n.name=i;break;case"blending":n.blending=Tu[i];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",r,"is no longer supported.");break;case"colorDiffuse":n.color=Pu.fromArray(i).getHex();break;case"colorSpecular":n.specular=Pu.fromArray(i).getHex();break;case"colorEmissive":n.emissive=Pu.fromArray(i).getHex();break;case"specularCoef":n.shininess=i;break;case"shading":"basic"===i.toLowerCase()&&(n.type="MeshBasicMaterial"),"phong"===i.toLowerCase()&&(n.type="MeshPhongMaterial"),"standard"===i.toLowerCase()&&(n.type="MeshStandardMaterial");break;case"mapDiffuse":n.map=e(i,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":n.emissiveMap=e(i,t.mapEmissiveRepeat,t.mapEmissiveOffset,t.mapEmissiveWrap,t.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":n.lightMap=e(i,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":n.aoMap=e(i,t.mapAORepeat,t.mapAOOffset,t.mapAOWrap,t.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":n.bumpMap=e(i,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy);break;case"mapBumpScale":n.bumpScale=i;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":n.normalMap=e(i,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy);break;case"mapNormalFactor":n.normalScale=i;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":n.specularMap=e(i,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":n.metalnessMap=e(i,t.mapMetalnessRepeat,t.mapMetalnessOffset,t.mapMetalnessWrap,t.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":n.roughnessMap=e(i,t.mapRoughnessRepeat,t.mapRoughnessOffset,t.mapRoughnessWrap,t.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":n.alphaMap=e(i,t.mapAlphaRepeat,t.mapAlphaOffset,t.mapAlphaWrap,t.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":n.side=1;break;case"doubleSided":n.side=2;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),n.opacity=i;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":n[r]=i;break;case"vertexColors":!0===i&&(n.vertexColors=2),"face"===i&&(n.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",r,i)}}return"MeshBasicMaterial"===n.type&&delete n.emissive,"MeshPhongMaterial"!==n.type&&delete n.specular,n.opacity<1&&(n.transparent=!0),Au.setTextures(u),Au.parse(n)})});var Lu={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",r=0,n=t.length;r<n;r++)e+=String.fromCharCode(t[r]);return decodeURIComponent(escape(e))},extractUrlBase:function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};Object.assign(Wn.prototype,{crossOrigin:"anonymous",load:function(r,n,t,e){var i=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:Lu.extractUrlBase(r),a=new Yr(this.manager);a.setWithCredentials(this.withCredentials),a.load(r,function(t){var e=(t=JSON.parse(t)).metadata;void 0===e||(void 0===(e=e.type)||"object"!==e.toLowerCase())?(t=i.parse(t,o),n(t.geometry,t.materials)):console.error("THREE.JSONLoader: "+r+" should be loaded with THREE.ObjectLoader instead.")},t,e)},setCrossOrigin:function(t){return this.crossOrigin=t,this},setTexturePath:function(t){return this.texturePath=t,this},parse:function(t,e){void 0!==t.data&&(t=t.data),t.scale=void 0!==t.scale?1/t.scale:1;var r,n,i,o=new E,a=t,s=a.faces,u=a.vertices,c=a.normals,l=a.colors,h=a.scale,p=0;if(void 0!==a.uvs){for(r=0;r<a.uvs.length;r++)a.uvs[r].length&&p++;for(r=0;r<p;r++)o.faceVertexUvs[r]=[]}var f=0;for(i=u.length;f<i;)(r=new St).x=u[f++]*h,r.y=u[f++]*h,r.z=u[f++]*h,o.vertices.push(r);for(f=0,i=s.length;f<i;){var d=1&(u=s[f++]),m=2&u;r=8&u;var g=16&u,y=32&u;if(h=64&u,u&=128,d){(d=new S).a=s[f],d.b=s[f+1],d.c=s[f+3];var v=new S;if(v.a=s[f+1],v.b=s[f+2],v.c=s[f+3],f+=4,m&&(m=s[f++],d.materialIndex=m,v.materialIndex=m),m=o.faces.length,r)for(r=0;r<p;r++){var _=a.uvs[r];for(o.faceVertexUvs[r][m]=[],o.faceVertexUvs[r][m+1]=[],n=0;n<4;n++){var b=s[f++],x=_[2*b];x=new H(x,b=_[2*b+1]),2!==n&&o.faceVertexUvs[r][m].push(x),0!==n&&o.faceVertexUvs[r][m+1].push(x)}}if(g&&(g=3*s[f++],d.normal.set(c[g++],c[g++],c[g]),v.normal.copy(d.normal)),y)for(r=0;r<4;r++)g=3*s[f++],y=new St(c[g++],c[g++],c[g]),2!==r&&d.vertexNormals.push(y),0!==r&&v.vertexNormals.push(y);if(h&&(h=l[h=s[f++]],d.color.setHex(h),v.color.setHex(h)),u)for(r=0;r<4;r++)h=l[h=s[f++]],2!==r&&d.vertexColors.push(new w(h)),0!==r&&v.vertexColors.push(new w(h));o.faces.push(d),o.faces.push(v)}else{if((d=new S).a=s[f++],d.b=s[f++],d.c=s[f++],m&&(m=s[f++],d.materialIndex=m),m=o.faces.length,r)for(r=0;r<p;r++)for(_=a.uvs[r],o.faceVertexUvs[r][m]=[],n=0;n<3;n++)x=new H(x=_[2*(b=s[f++])],b=_[2*b+1]),o.faceVertexUvs[r][m].push(x);if(g&&(g=3*s[f++],d.normal.set(c[g++],c[g++],c[g])),y)for(r=0;r<3;r++)g=3*s[f++],y=new St(c[g++],c[g++],c[g]),d.vertexNormals.push(y);if(h&&(h=s[f++],d.color.setHex(l[h])),u)for(r=0;r<3;r++)h=s[f++],d.vertexColors.push(new w(l[h]));o.faces.push(d)}}if(f=void 0!==(a=t).influencesPerVertex?a.influencesPerVertex:2,a.skinWeights)for(i=0,s=a.skinWeights.length;i<s;i+=f)o.skinWeights.push(new Et(a.skinWeights[i],1<f?a.skinWeights[i+1]:0,2<f?a.skinWeights[i+2]:0,3<f?a.skinWeights[i+3]:0));if(a.skinIndices)for(i=0,s=a.skinIndices.length;i<s;i+=f)o.skinIndices.push(new Et(a.skinIndices[i],1<f?a.skinIndices[i+1]:0,2<f?a.skinIndices[i+2]:0,3<f?a.skinIndices[i+3]:0));if(o.bones=a.bones,o.bones&&0<o.bones.length&&(o.skinWeights.length!==o.skinIndices.length||o.skinIndices.length!==o.vertices.length)&&console.warn("When skinning, number of vertices ("+o.vertices.length+"), skinIndices ("+o.skinIndices.length+"), and skinWeights ("+o.skinWeights.length+") should match."),s=(i=t).scale,void 0!==i.morphTargets)for(a=0,f=i.morphTargets.length;a<f;a++)for(o.morphTargets[a]={},o.morphTargets[a].name=i.morphTargets[a].name,o.morphTargets[a].vertices=[],c=o.morphTargets[a].vertices,p=0,u=(l=i.morphTargets[a].vertices).length;p<u;p+=3)(h=new St).x=l[p]*s,h.y=l[p+1]*s,h.z=l[p+2]*s,c.push(h);if(void 0!==i.morphColors&&0<i.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),s=o.faces,i=i.morphColors[0].colors,a=0,f=s.length;a<f;a++)s[a].color.fromArray(i,3*a);for(a=[],f=[],void 0!==(i=t).animation&&f.push(i.animation),void 0!==i.animations&&(i.animations.length?f=f.concat(i.animations):f.push(i.animations)),i=0;i<f.length;i++)(s=Vn.parseAnimation(f[i],o.bones))&&a.push(s);return o.morphTargets&&(f=Vn.CreateClipsFromMorphTargetSequences(o.morphTargets,10),a=a.concat(f)),0<a.length&&(o.animations=a),o.computeFaceNormals(),o.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:o}:{geometry:o,materials:t=$n.prototype.initMaterials(t.materials,e,this.crossOrigin)}}}),Object.assign(Xn.prototype,{crossOrigin:"anonymous",load:function(r,n,t,i){""===this.texturePath&&(this.texturePath=r.substring(0,r.lastIndexOf("/")+1));var o=this;new Yr(o.manager).load(r,function(t){var e=null;try{e=JSON.parse(t)}catch(t){return void 0!==i&&i(t),void console.error("THREE:ObjectLoader: Can't parse "+r+".",t.message)}void 0===(t=e.metadata)||void 0===t.type||"geometry"===t.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+r+". Use THREE.JSONLoader instead."):o.parse(e,n)},t,i)},setTexturePath:function(t){return this.texturePath=t,this},setCrossOrigin:function(t){return this.crossOrigin=t,this},parse:function(t,e){var r=this.parseShape(t.shapes);r=this.parseGeometries(t.geometries,r);var n=this.parseImages(t.images,function(){void 0!==e&&e(i)});n=this.parseTextures(t.textures,n),n=this.parseMaterials(t.materials,n);var i=this.parseObject(t.object,r,n);return t.animations&&(i.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0===e||e(i),i},parseShape:function(t){var e={};if(void 0!==t)for(var r=0,n=t.length;r<n;r++){var i=(new _n).fromJSON(t[r]);e[i.uuid]=i}return e},parseGeometries:function(t,e){var r={};if(void 0!==t)for(var n=new Wn,i=new Hn,o=0,a=t.length;o<a;o++){var s=t[o];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":var u=new gu[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":u=new gu[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":u=new gu[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":u=new gu[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":u=new gu[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":u=new gu[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":u=new gu[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":u=new gu[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":u=new gu[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":u=new gu[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"LatheGeometry":case"LatheBufferGeometry":u=new gu[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":u=new gu[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":u=[];for(var c=0,l=s.shapes.length;c<l;c++){var h=e[s.shapes[c]];u.push(h)}u=new gu[s.type](u,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(u=[],c=0,l=s.shapes.length;c<l;c++)h=e[s.shapes[c]],u.push(h);void 0!==(c=s.options.extrudePath)&&(s.options.extrudePath=(new Cu[c.type]).fromJSON(c)),u=new gu[s.type](u,s.options);break;case"BufferGeometry":u=i.parse(s);break;case"Geometry":u=n.parse(s,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}u.uuid=s.uuid,void 0!==s.name&&(u.name=s.name),!0===u.isBufferGeometry&&void 0!==s.userData&&(u.userData=s.userData),r[s.uuid]=u}return r},parseMaterials:function(t,e){var r={};if(void 0!==t){var n=new qn;n.setTextures(e),e=0;for(var i=t.length;e<i;e++){var o=t[e];if("MultiMaterial"===o.type){for(var a=[],s=0;s<o.materials.length;s++)a.push(n.parse(o.materials[s]));r[o.uuid]=a}else r[o.uuid]=n.parse(o)}}return r},parseAnimations:function(t){for(var e=[],r=0;r<t.length;r++){var n=t[r],i=Vn.parse(n);void 0!==n.uuid&&(i.uuid=n.uuid),e.push(i)}return e},parseImages:function(t,e){function r(t){return n.manager.itemStart(t),o.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemEnd(t),n.manager.itemError(t)})}var n=this,i={};if(void 0!==t&&0<t.length){var o=new Jr(e=new Xr(e));o.setCrossOrigin(this.crossOrigin),e=0;for(var a=t.length;e<a;e++){var s=t[e],u=s.url;if(Array.isArray(u)){i[s.uuid]=[];for(var c=0,l=u.length;c<l;c++){var h=u[c];h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:n.texturePath+h,i[s.uuid].push(r(h))}}else h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(s.url)?s.url:n.texturePath+s.url,i[s.uuid]=r(h)}}return i},parseTextures:function(t,e){function r(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var n={};if(void 0!==t)for(var i=0,o=t.length;i<o;i++){var a=t[i];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===e[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var s=Array.isArray(e[a.image])?new V(e[a.image]):new p(e[a.image]);s.needsUpdate=!0,s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=r(a.mapping,Ru)),void 0!==a.offset&&s.offset.fromArray(a.offset),void 0!==a.repeat&&s.repeat.fromArray(a.repeat),void 0!==a.center&&s.center.fromArray(a.center),void 0!==a.rotation&&(s.rotation=a.rotation),void 0!==a.wrap&&(s.wrapS=r(a.wrap[0],Nu),s.wrapT=r(a.wrap[1],Nu)),void 0!==a.format&&(s.format=a.format),void 0!==a.minFilter&&(s.minFilter=r(a.minFilter,ku)),void 0!==a.magFilter&&(s.magFilter=r(a.magFilter,ku)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),void 0!==a.flipY&&(s.flipY=a.flipY),n[a.uuid]=s}return n},parseObject:function(t,e,o){function r(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function n(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];void 0===o[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),e.push(o[i])}return e}return void 0===o[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),o[t]}}switch(t.type){case"Scene":var i=new ye;void 0!==t.background&&Number.isInteger(t.background)&&(i.background=new w(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?i.fog=new ge(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(i.fog=new me(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":i=new le(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(i.focus=t.focus),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.filmGauge&&(i.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(i.filmOffset=t.filmOffset),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"OrthographicCamera":i=new f(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.view&&(i.view=Object.assign({},t.view));break;case"AmbientLight":i=new Pn(t.color,t.intensity);break;case"DirectionalLight":i=new Tn(t.color,t.intensity);break;case"PointLight":i=new Cn(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":i=new On(t.color,t.intensity,t.width,t.height);break;case"SpotLight":i=new En(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":i=new xn(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":i=r(t.geometry);var a=n(t.material);i=i.bones&&0<i.bones.length?new Ce(i,a):new B(i,a);break;case"LOD":i=new we;break;case"Line":i=new Te(r(t.geometry),n(t.material),t.mode);break;case"LineLoop":i=new Oe(r(t.geometry),n(t.material));break;case"LineSegments":i=new Pe(r(t.geometry),n(t.material));break;case"PointCloud":case"Points":i=new Ie(r(t.geometry),n(t.material));break;case"Sprite":i=new xe(n(t.material));break;case"Group":i=new ce;break;default:i=new l}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(i.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(i.matrixAutoUpdate=t.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.quaternion&&i.quaternion.fromArray(t.quaternion),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.castShadow&&(i.castShadow=t.castShadow),void 0!==t.receiveShadow&&(i.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(i.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(i.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&i.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(i.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.frustumCulled&&(i.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(i.renderOrder=t.renderOrder),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.layers&&(i.layers.mask=t.layers),void 0!==t.children){a=t.children;for(var s=0;s<a.length;s++)i.add(this.parseObject(a[s],e,o))}if("LOD"===t.type)for(t=t.levels,a=0;a<t.length;a++){s=t[a];var u=i.getObjectByProperty("uuid",s.object);void 0!==u&&i.addLevel(u,s.distance)}return i}});var Ru={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Nu={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},ku={NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008};Yn.prototype={constructor:Yn,setOptions:function(t){return this.options=t,this},load:function(e,r,t,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=vu.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){r&&r(o),i.manager.itemEnd(e)},0),o;fetch(e).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,i.options)}).then(function(t){vu.add(e,t),r&&r(t),i.manager.itemEnd(e)}).catch(function(t){n&&n(t),i.manager.itemEnd(e),i.manager.itemError(e)})},setCrossOrigin:function(){return this},setPath:function(t){return this.path=t,this}},Object.assign(Zn.prototype,{moveTo:function(t,e){this.currentPath=new vn,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,r,n){this.currentPath.quadraticCurveTo(t,e,r,n)},bezierCurveTo:function(t,e,r,n,i,o){this.currentPath.bezierCurveTo(t,e,r,n,i,o)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function r(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r],o=new _n;o.curves=i.curves,e.push(o)}return e}function n(t,e){for(var r=e.length,n=!1,i=r-1,o=0;o<r;i=o++){var a=e[i],s=e[o],u=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(a=e[o],u=-u,s=e[i],c=-c),!(t.y<a.y||t.y>s.y))if(t.y===a.y){if(t.x===a.x)return!0}else{if(0===(i=c*(t.x-a.x)-u*(t.y-a.y)))return!0;i<0||(n=!n)}}else if(t.y===a.y&&(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x))return!0}return n}var i=du.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return r(o);if(e=[],1===o.length){var a=o[0],s=new _n;return s.curves=a.curves,e.push(s),e}var u=!i(o[0].getPoints());u=t?!u:u,s=[];var c=[],l=[],h=0;c[h]=void 0,l[h]=[];for(var p=0,f=o.length;p<f;p++){var d=(a=o[p]).getPoints(),m=i(d);(m=t?!m:m)?(!u&&c[h]&&h++,c[h]={s:new _n,p:d},c[h].s.curves=a.curves,u&&h++,l[h]=[]):l[h].push({h:a,p:d[0]})}if(!c[0])return r(o);if(1<c.length){for(p=!1,t=[],i=0,o=c.length;i<o;i++)s[i]=[];for(i=0,o=c.length;i<o;i++)for(a=l[i],m=0;m<a.length;m++){for(u=a[m],h=!0,d=0;d<c.length;d++)n(u.p,c[d].p)&&(i!==d&&t.push({froms:i,tos:d,hole:m}),h?(h=!1,s[d].push(u)):p=!0);h&&s[i].push(u)}0<t.length&&(p||(l=s))}for(p=0,i=c.length;p<i;p++)for(s=c[p].s,e.push(s),o=0,a=(t=l[p]).length;o<a;o++)s.holes.push(t[o].h);return e}}),Object.assign(Kn.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);var r=[],n=e;e=this.data;var i=Array.from?Array.from(t):String(t).split("");n/=e.resolution;var o=(e.boundingBox.yMax-e.boundingBox.yMin+e.underlineThickness)*n;t=[];for(var a=0,s=0,u=0;u<i.length;u++){var c=i[u];if("\n"===c)a=0,s-=o;else{var l=n,h=a,p=s;if(c=e.glyphs[c]||e.glyphs["?"]){var f=new Zn;if(c.o)for(var d=c._cachedOutline||(c._cachedOutline=c.o.split(" ")),m=0,g=d.length;m<g;)switch(d[m++]){case"m":var y=d[m++]*l+h,v=d[m++]*l+p;f.moveTo(y,v);break;case"l":y=d[m++]*l+h,v=d[m++]*l+p,f.lineTo(y,v);break;case"q":var _=d[m++]*l+h,b=d[m++]*l+p,x=d[m++]*l+h,w=d[m++]*l+p;f.quadraticCurveTo(x,w,_,b);break;case"b":_=d[m++]*l+h,b=d[m++]*l+p,x=d[m++]*l+h,w=d[m++]*l+p,y=d[m++]*l+h,v=d[m++]*l+p,f.bezierCurveTo(x,w,y,v,_,b)}l={offsetX:c.ha*l,path:f}}else l=void 0;a+=l.offsetX,t.push(l.path)}}for(e=0,i=t.length;e<i;e++)Array.prototype.push.apply(r,t[e].toShapes());return r}}),Object.assign(Jn.prototype,{load:function(t,n,e,r){var i=this,o=new Yr(this.manager);o.setPath(this.path),o.load(t,function(e){try{var r=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(e.substring(65,e.length-2))}e=i.parse(r),n&&n(e)},e,r)},parse:function(t){return new Kn(t)},setPath:function(t){return this.path=t,this}});var Du,ju,zu,Fu,Bu,Uu,Vu,Gu,qu,Hu,$u,Wu,Xu,Yu,Zu,Ku,Ju,Qu,tc,ec,rc,nc,ic,oc,ac,sc,uc,cc,lc,hc,pc,fc,dc,mc,gc,yc,vc,_c,bc,xc,wc,Sc,Ec,Cc,Mc,Tc,Pc,Oc,Ac,Ic,Lc,Rc={getContext:function(){return void 0===Du&&(Du=new(window.AudioContext||window.webkitAudioContext)),Du},setContext:function(t){Du=t}};function Nc(t,e,r,n){if(Cc.set(e,r,n).unproject(Mc),void 0!==(t=Ec[t]))for(e=Sc.getAttribute("position"),r=0,n=t.length;r<n;r++)e.setXYZ(t[r],Cc.x,Cc.y,Cc.z)}Object.assign(Qn.prototype,{load:function(t,e,r,n){var i=new Yr(this.manager);i.setResponseType("arraybuffer"),i.load(t,function(t){t=t.slice(0),Rc.getContext().decodeAudioData(t,function(t){e(t)})},r,n)}}),Object.assign(ti.prototype,{update:(Hu=new wt,$u=new wt,function(t){if(ju!==this||zu!==t.focus||Fu!==t.fov||Bu!==t.aspect*this.aspect||Uu!==t.near||Vu!==t.far||Gu!==t.zoom||qu!==this.eyeSep){ju=this,zu=t.focus,Fu=t.fov,Bu=t.aspect*this.aspect,Uu=t.near,Vu=t.far,Gu=t.zoom;var e=t.projectionMatrix.clone(),r=(qu=this.eyeSep/2)*Uu/zu,n=Uu*Math.tan(po.DEG2RAD*Fu*.5)/Gu;$u.elements[12]=-qu,Hu.elements[12]=qu;var i=-n*Bu+r,o=n*Bu+r;e.elements[0]=2*Uu/(o-i),e.elements[8]=(o+i)/(o-i),this.cameraL.projectionMatrix.copy(e),i=-n*Bu-r,o=n*Bu-r,e.elements[0]=2*Uu/(o-i),e.elements[8]=(o+i)/(o-i),this.cameraR.projectionMatrix.copy(e)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply($u),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Hu)})}),(ei.prototype=Object.create(l.prototype)).constructor=ei,ri.prototype=Object.assign(Object.create(l.prototype),{constructor:ri,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:(Wu=new St,Xu=new s,Yu=new St,Zu=new St,function(t){l.prototype.updateMatrixWorld.call(this,t),t=this.context.listener;var e=this.up;this.matrixWorld.decompose(Wu,Xu,Yu),Zu.set(0,0,-1).applyQuaternion(Xu),t.positionX?(t.positionX.setValueAtTime(Wu.x,this.context.currentTime),t.positionY.setValueAtTime(Wu.y,this.context.currentTime),t.positionZ.setValueAtTime(Wu.z,this.context.currentTime),t.forwardX.setValueAtTime(Zu.x,this.context.currentTime),t.forwardY.setValueAtTime(Zu.y,this.context.currentTime),t.forwardZ.setValueAtTime(Zu.z,this.context.currentTime),t.upX.setValueAtTime(e.x,this.context.currentTime),t.upY.setValueAtTime(e.y,this.context.currentTime),t.upZ.setValueAtTime(e.z,this.context.currentTime)):(t.setPosition(Wu.x,Wu.y,Wu.z),t.setOrientation(Zu.x,Zu.y,Zu.z,e.x,e.y,e.z))})}),ni.prototype=Object.assign(Object.create(l.prototype),{constructor:ni,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else{if(!1!==this.hasPlaybackControl){var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),t.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,t.start(this.startTime,this.offset),this.isPlaying=!0,this.source=t,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t=t||[],!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}),ii.prototype=Object.assign(Object.create(ni.prototype),{constructor:ii,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=r,this},updateMatrixWorld:(Ku=new St,Ju=new s,Qu=new St,tc=new St,function(t){l.prototype.updateMatrixWorld.call(this,t),t=this.panner,this.matrixWorld.decompose(Ku,Ju,Qu),tc.set(0,0,1).applyQuaternion(Ju),t.setPosition(Ku.x,Ku.y,Ku.z),t.setOrientation(tc.x,tc.y,tc.z)})}),Object.assign(oi.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),r=0;r<e.length;r++)t+=e[r];return t/e.length}}),Object.assign(ai.prototype,{accumulate:function(t,e){var r=this.buffer,n=this.valueSize;t=t*n+n;var i=this.cumulativeWeight;if(0===i){for(i=0;i!==n;++i)r[t+i]=r[i];i=e}else i+=e,this._mixBufferRegion(r,t,0,e/i,n);this.cumulativeWeight=i},apply:function(t){var e=this.valueSize,r=this.buffer;t=t*e+e;var n=this.cumulativeWeight,i=this.binding;this.cumulativeWeight=0,n<1&&this._mixBufferRegion(r,t,3*e,1-n,e);for(var o=(n=e)+e;n!==o;++n)if(r[n]!==r[n+e]){i.setValue(r,t);break}},saveOriginalState:function(){var t=this.buffer,e=this.valueSize,r=3*e;this.binding.getValue(t,r);for(var n=e;n!==r;++n)t[n]=t[r+n%e];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(t,e,r,n,i){if(.5<=n)for(n=0;n!==i;++n)t[e+n]=t[r+n]},_slerp:function(t,e,r,n){s.slerpFlat(t,e,t,e,t,r,n)},_lerp:function(t,e,r,n,i){for(var o=1-n,a=0;a!==i;++a){var s=e+a;t[s]=t[s]*o+t[r+a]*n}}}),Object.assign(si.prototype,{getValue:function(t,e){this.bind();var r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(t,e)},setValue:function(t,e){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}}),Object.assign(ui,{Composite:si,create:function(t,e,r){return t&&t.isAnimationObjectGroup?new ui.Composite(t,e,r):new ui(t,e,r)},sanitizeNodeName:(ec=/[\[\]\.:\/]/g,function(t){return t.replace(/\s/g,"_").replace(ec,"")}),parseTrackName:function(){var t="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",e=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]");t=/(WCOD+)?/.source.replace("WCOD",t);var r=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),n=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),i=new RegExp("^"+e+t+r+n+"$"),o=["material","materials","bones"];return function(t){var e=i.exec(t);if(!e)throw Error("PropertyBinding: Cannot parse trackName: "+t);var r=(e={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]}).nodeName&&e.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var n=e.nodeName.substring(r+1);-1!==o.indexOf(n)&&(e.nodeName=e.nodeName.substring(0,r),e.objectName=n)}if(null===e.propertyName||0===e.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+t);return e}}(),findNode:function(t,n){if(!n||""===n||"root"===n||"."===n||-1===n||n===t.name||n===t.uuid)return t;if(t.skeleton){var e=t.skeleton.getBoneByName(n);if(void 0!==e)return e}if(t.children){var i=function(t){for(var e=0;e<t.length;e++){var r=t[e];if(r.name===n||r.uuid===n||(r=i(r.children)))return r}return null};if(t=i(t.children))return t}return null}}),Object.assign(ui.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)t[e++]=r[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,r=e.objectName,n=e.propertyName,i=e.propertyIndex;if(t||(this.node=t=ui.findNode(this.rootNode,e.nodeName)||this.rootNode),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var o=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);for(t=t.skeleton.bones,r=0;r<t.length;r++)if(t[r].name===o){o=r;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}if(void 0===(o=t[n]))console.error("THREE.PropertyBinding: Trying to update property for track: "+e.nodeName+"."+n+" but it wasn't found.",t);else{if(e=this.Versioning.None,void 0!==t.needsUpdate?(e=this.Versioning.NeedsUpdate,this.targetObject=t):void 0!==t.matrixWorldNeedsUpdate&&(e=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=t),r=this.BindingType.Direct,void 0!==i){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(r=0;r<this.node.geometry.morphAttributes.position.length;r++)if(t.geometry.morphAttributes.position[r].name===i){i=r;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(r=0;r<this.node.geometry.morphTargets.length;r++)if(t.geometry.morphTargets[r].name===i){i=r;break}}}r=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(r=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(r=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[r],this.setValue=this.SetterByBindingTypeAndVersioning[r][e]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(ui.prototype,{_getValue_unbound:ui.prototype.getValue,_setValue_unbound:ui.prototype.setValue}),Object.assign(ci.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,u=void 0,c=0,l=arguments.length;c!==l;++c){var h=arguments[c],p=h.uuid,f=n[p];if(void 0===f){f=e++,n[p]=f,t.push(h),p=0;for(var d=s;p!==d;++p)a[p].push(new ui(h,i[p],o[p]))}else if(f<r){u=t[f];var m=--r;for(t[n[(d=t[m]).uuid]=f]=d,t[n[p]=m]=h,p=0,d=s;p!==d;++p){var g=a[p],y=g[f];g[f]=g[m],void 0===y&&(y=new ui(h,i[p],o[p])),g[m]=y}}else t[f]!==u&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],u=s.uuid,c=r[u];if(void 0!==c&&e<=c){var l=e++,h=t[l];for(t[r[h.uuid]=c]=h,t[r[u]=l]=s,s=0,u=i;s!==u;++s){var p=(h=n[s])[c];h[c]=h[l],h[l]=p}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var u=arguments[a].uuid,c=n[u];if(void 0!==c)if(delete n[u],c<r){var l=t[u=--r],h=--e,p=t[h];for(t[n[l.uuid]=c]=l,t[n[p.uuid]=u]=p,t.pop(),l=0,p=o;l!==p;++l){var f=i[l],d=f[h];f[c]=f[u],f[u]=d,f.pop()}}else for(t[n[(p=t[h=--e]).uuid]=c]=p,t.pop(),l=0,p=o;l!==p;++l)(f=i[l])[c]=f[h],f.pop()}this.nCachedObjects_=r},subscribe_:function(t,e){var r=this._bindingsIndicesByPath,n=r[t],i=this._bindings;if(void 0!==n)return i[n];var o=this._paths,a=this._parsedPaths,s=this._objects,u=this.nCachedObjects_,c=Array(s.length);for(n=i.length,r[t]=n,o.push(t),a.push(e),i.push(c),r=u,n=s.length;r!==n;++r)c[r]=new ui(s[r],t,e);return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,r=e[t];if(void 0!==r){var n=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];o[e[t[a]]=r]=s,o.pop(),i[r]=i[a],i.pop(),n[r]=n[a],n.pop()}}}),Object.assign(li.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,r){if(t.fadeOut(e),this.fadeIn(e),r){r=this._clip.duration;var n=t._clip.duration,i=r/n;t.warp(1,n/r,e),this.warp(i,1,e)}return this},crossFadeTo:function(t,e,r){return t.crossFadeFrom(this,e,r)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,r){var n=this._mixer,i=n.time,o=this._timeScaleInterpolant,a=this.timeScale;return null===o&&(this._timeScaleInterpolant=o=n._lendControlInterpolant()),n=o.parameterPositions,o=o.sampleValues,n[0]=i,n[1]=i+r,o[0]=t/a,o[1]=e/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,r,n){if(this.enabled){var i=this._startTime;if(null!==i){if((e=(t-i)*r)<0||0===r)return;this._startTime=null,e*=r}if(e*=this._updateTimeScale(t),r=this._updateTime(e),0<(t=this._updateWeight(t))){e=this._interpolants,i=this._propertyBindings;for(var o=0,a=e.length;o!==a;++o)e[o].evaluate(r),i[o].accumulate(n,t)}}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(t)[0];e*=n,t>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r)e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e},_updateTime:function(t){var e=this.time+t,r=this._clip.duration,n=this.loop,i=this._loopCount,o=2202===n;if(0===t)return-1===i?e:o&&1==(1&i)?r-e:e;if(2200===n)t:{if(-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1)),r<=e)e=r;else{if(!(e<0))break t;e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}else{if(-1===i&&(0<=t?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r<=e||e<0){e-=r*(n=Math.floor(e/r)),i+=Math.abs(n);var a=this.repetitions-i;a<=0?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=0<t?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<t?1:-1})):(1==a?(t=t<0,this._setEndings(t,!t,o)):this._setEndings(!1,!1,o),this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n}))}if(o&&1==(1&i))return r-(this.time=e)}return this.time=e},_setEndings:function(t,e,r){var n=this._interpolantSettings;r?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=t?this.zeroSlopeAtStart?2401:2400:2402,n.endingEnd=e?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(t,e,r){var n=this._mixer,i=n.time,o=this._weightInterpolant;return null===o&&(this._weightInterpolant=o=n._lendControlInterpolant()),n=o.parameterPositions,o=o.sampleValues,n[0]=i,o[0]=e,n[1]=i+t,o[1]=r,this}}),hi.prototype=Object.assign(Object.create(e.prototype),{constructor:hi,_bindAction:function(t,e){var r=t._localRoot||this._root,n=t._clip.tracks,i=n.length,o=t._propertyBindings;t=t._interpolants;var a=r.uuid,s=this._bindingsByRootAndName,u=s[a];for(void 0===u&&(u={},s[a]=u),s=0;s!==i;++s){var c=n[s],l=c.name,h=u[l];if(void 0===h){if(void 0!==(h=o[s])){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,l));continue}++(h=new ai(ui.create(r,l,e&&e._propertyBindings[s].binding.parsedPath),c.ValueTypeName,c.getValueSize())).referenceCount,this._addInactiveBinding(h,a,l)}o[s]=h,t[s].resultBuffer=h.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,e)}for(r=0,n=(e=t._propertyBindings).length;r!==n;++r){var i=e[r];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){return null!==(t=t._cacheIndex)&&t<this._nActiveActions},_addInactiveAction:function(t,e,r){var n=this._actions,i=this._actionsByClip,o=i[e];void 0===o?(o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o):(e=o.knownActions,t._byClipCacheIndex=e.length,e.push(t)),t._cacheIndex=n.length,n.push(t),o.actionByRoot[r]=t},_removeInactiveAction:function(t){var e=this._actions,r=e[e.length-1],n=t._cacheIndex;e[r._cacheIndex=n]=r,e.pop(),t._cacheIndex=null,e=t._clip.uuid;var i=(n=(r=this._actionsByClip)[e]).knownActions,o=i[i.length-1],a=t._byClipCacheIndex;i[o._byClipCacheIndex=a]=o,i.pop(),t._byClipCacheIndex=null,delete n.actionByRoot[(t._localRoot||this._root).uuid],0===i.length&&delete r[e],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=0,r=(t=t._propertyBindings).length;e!==r;++e){var n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(t){var e=this._actions,r=t._cacheIndex,n=this._nActiveActions++,i=e[n];e[t._cacheIndex=n]=t,e[i._cacheIndex=r]=i},_takeBackAction:function(t){var e=this._actions,r=t._cacheIndex,n=--this._nActiveActions,i=e[n];e[t._cacheIndex=n]=t,e[i._cacheIndex=r]=i},_addInactiveBinding:function(t,e,r){var n=this._bindingsByRootAndName,i=n[e],o=this._bindings;void 0===i&&(i={},n[e]=i),(i[r]=t)._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,r=t.binding,n=r.rootNode.uuid;r=r.path;var i=this._bindingsByRootAndName,o=i[n],a=e[e.length-1];t=t._cacheIndex,e[a._cacheIndex=t]=a,e.pop(),delete o[r];t:{for(var s in o)break t;delete i[n]}},_lendBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,i=e[n];e[t._cacheIndex=n]=t,e[i._cacheIndex=r]=i},_takeBackBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,i=e[n];e[t._cacheIndex=n]=t,e[i._cacheIndex=r]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,r=t[e];return void 0===r&&(t[(r=new Ln(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e]=r),r},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,i=e[n];e[t.__cacheIndex=n]=t,e[i.__cacheIndex=r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var r=e||this._root,n=r.uuid;t=null!==(r="string"==typeof t?Vn.findByName(r,t):t)?r.uuid:t;var i=this._actionsByClip[t],o=null;if(void 0!==i){if(void 0!==(o=i.actionByRoot[n]))return o;o=i.knownActions[0],null===r&&(r=o._clip)}return null===r?null:(e=new li(this,r,e),this._bindAction(e,o),this._addInactiveAction(e,t,n),e)},existingAction:function(t,e){var r=e||this._root;return e=r.uuid,r="string"==typeof t?Vn.findByName(r,t):t,void 0!==(t=this._actionsByClip[r?r.uuid:t])&&t.actionByRoot[e]||null},stopAllAction:function(){for(var t=this._actions,e=this._nActiveActions,r=this._bindings,n=this._nActiveBindings,i=this._nActiveBindings=this._nActiveActions=0;i!==e;++i)t[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,r=this._nActiveActions,n=this.time+=t,i=Math.sign(t),o=this._accuIndex^=1,a=0;a!==r;++a)e[a]._update(n,t,i,o);for(t=this._bindings,e=this._nActiveBindings,a=0;a!==e;++a)t[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions;t=t.uuid;var r=this._actionsByClip,n=r[t];if(void 0!==n){for(var i=0,o=(n=n.knownActions).length;i!==o;++i){var a=n[i];this._deactivateAction(a);var s=a._cacheIndex,u=e[e.length-1];a._cacheIndex=null,a._byClipCacheIndex=null,e[u._cacheIndex=s]=u,e.pop(),this._removeInactiveBindingsForAction(a)}delete r[t]}},uncacheRoot:function(t){t=t.uuid;var e=this._actionsByClip;for(n in e){var r=e[n].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var n=this._bindingsByRootAndName[t];if(void 0!==n)for(var i in n)(t=n[i]).restoreOriginalState(),this._removeInactiveBinding(t)},uncacheAction:function(t,e){null!==(t=this.existingAction(t,e))&&(this._deactivateAction(t),this._removeInactiveAction(t))}}),pi.prototype.clone=function(){return new pi(void 0===this.value.clone?this.value:this.value.clone())},fi.prototype=Object.assign(Object.create(A.prototype),{constructor:fi,isInstancedBufferGeometry:!0,copy:function(t){return A.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),di.prototype=Object.assign(Object.create(ve.prototype),{constructor:di,isInstancedInterleavedBuffer:!0,copy:function(t){return ve.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),mi.prototype=Object.assign(Object.create(v.prototype),{constructor:mi,isInstancedBufferAttribute:!0,copy:function(t){return v.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(gi.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,r){return vi(t,this,r=r||[],e),r.sort(yi),r},intersectObjects:function(t,e,r){if(r=r||[],!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var n=0,i=t.length;n<i;n++)vi(t[n],this,r,e);return r.sort(yi),r}}),Object.assign(_i.prototype,{start:function(){this.oldTime=this.startTime=("undefined"==typeof performance?Date:performance).now(),this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.autoStart=this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}),Object.assign(bi.prototype,{set:function(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.radius=t.length(),0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(po.clamp(t.y/this.radius,-1,1))),this}}),Object.assign(xi.prototype,{set:function(t,e,r){return this.radius=t,this.theta=e,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}),Object.assign(wi.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:(nc=new H,function(t,e){return e=nc.copy(e).multiplyScalar(.5),this.min.copy(t).sub(e),this.max.copy(t).add(e),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new H),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new H),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new H),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new H),e.copy(t).clamp(this.min,this.max)},distanceToPoint:(rc=new H,function(t){return rc.copy(t).clamp(this.min,this.max).sub(t).length()}),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(Si.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new St),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new St),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new St),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:(ic=new St,oc=new St,function(t,e){return ic.subVectors(t,this.start),oc.subVectors(this.end,this.start),t=oc.dot(oc),t=oc.dot(ic)/t,e&&(t=po.clamp(t,0,1)),t}),closestPointToPoint:function(t,e,r){return t=this.closestPointToPointParameter(t,e),void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new St),this.delta(r).multiplyScalar(t).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),((Ei.prototype=Object.create(l.prototype)).constructor=Ei).prototype.isImmediateRenderObject=!0,((Ci.prototype=Object.create(Pe.prototype)).constructor=Ci).prototype.update=(ac=new St,sc=new St,uc=new g,function(){var t=["a","b","c"];this.object.updateMatrixWorld(!0),uc.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,r=this.geometry.attributes.position,n=this.object.geometry;if(n&&n.isGeometry)for(var i=n.vertices,o=n.faces,a=n=0,s=o.length;a<s;a++)for(var u=o[a],c=0,l=u.vertexNormals.length;c<l;c++){var h=u.vertexNormals[c];ac.copy(i[u[t[c]]]).applyMatrix4(e),sc.copy(h).applyMatrix3(uc).normalize().multiplyScalar(this.size).add(ac),r.setXYZ(n,ac.x,ac.y,ac.z),n+=1,r.setXYZ(n,sc.x,sc.y,sc.z),n+=1}else if(n&&n.isBufferGeometry)for(t=n.attributes.position,i=n.attributes.normal,c=n=0,l=t.count;c<l;c++)ac.set(t.getX(c),t.getY(c),t.getZ(c)).applyMatrix4(e),sc.set(i.getX(c),i.getY(c),i.getZ(c)),sc.applyMatrix3(uc).normalize().multiplyScalar(this.size).add(ac),r.setXYZ(n,ac.x,ac.y,ac.z),n+=1,r.setXYZ(n,sc.x,sc.y,sc.z),n+=1;r.needsUpdate=!0}),((Mi.prototype=Object.create(l.prototype)).constructor=Mi).prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Mi.prototype.update=(cc=new St,lc=new St,function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),cc.setFromMatrixPosition(this.light.matrixWorld),lc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(lc.sub(cc)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}),((Ti.prototype=Object.create(Pe.prototype)).constructor=Ti).prototype.updateMatrixWorld=(hc=new St,pc=new wt,fc=new wt,function(t){var e=this.bones,r=this.geometry,n=r.getAttribute("position");fc.getInverse(this.root.matrixWorld);for(var i=0,o=0;i<e.length;i++){var a=e[i];a.parent&&a.parent.isBone&&(pc.multiplyMatrices(fc,a.matrixWorld),hc.setFromMatrixPosition(pc),n.setXYZ(o,hc.x,hc.y,hc.z),pc.multiplyMatrices(fc,a.parent.matrixWorld),hc.setFromMatrixPosition(pc),n.setXYZ(o+1,hc.x,hc.y,hc.z),o+=2)}r.getAttribute("position").needsUpdate=!0,l.prototype.updateMatrixWorld.call(this,t)}),((Pi.prototype=Object.create(B.prototype)).constructor=Pi).prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Pi.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},((Oi.prototype=Object.create(l.prototype)).constructor=Oi).prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Oi.prototype.update=function(){var t=.5*this.light.width,e=.5*this.light.height,r=this.line.geometry.attributes.position,n=r.array;n[0]=t,n[1]=-e,n[2]=0,n[3]=t,n[4]=e,n[5]=0,n[6]=-t,n[7]=e,n[8]=0,n[9]=-t,n[10]=-e,n[11]=0,n[12]=t,n[13]=-e,n[14]=0,r.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},((Ai.prototype=Object.create(l.prototype)).constructor=Ai).prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Ai.prototype.update=(dc=new St,mc=new w,gc=new w,function(){var t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var e=t.geometry.getAttribute("color");mc.copy(this.light.color),gc.copy(this.light.groundColor);for(var r=0,n=e.count;r<n;r++){var i=r<n/2?mc:gc;e.setXYZ(r,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(dc.setFromMatrixPosition(this.light.matrixWorld).negate())}),(Ii.prototype=Object.create(Pe.prototype)).constructor=Ii,(Li.prototype=Object.create(Pe.prototype)).constructor=Li,((Ri.prototype=Object.create(Pe.prototype)).constructor=Ri).prototype.update=(yc=new St,vc=new St,_c=new g,function(){this.object.updateMatrixWorld(!0),_c.getNormalMatrix(this.object.matrixWorld);for(var t=this.object.matrixWorld,e=this.geometry.attributes.position,r=this.object.geometry,n=r.vertices,i=0,o=0,a=(r=r.faces).length;o<a;o++){var s=r[o],u=s.normal;yc.copy(n[s.a]).add(n[s.b]).add(n[s.c]).divideScalar(3).applyMatrix4(t),vc.copy(u).applyMatrix3(_c).normalize().multiplyScalar(this.size).add(yc),e.setXYZ(i,yc.x,yc.y,yc.z),i+=1,e.setXYZ(i,vc.x,vc.y,vc.z),i+=1}e.needsUpdate=!0}),((Ni.prototype=Object.create(l.prototype)).constructor=Ni).prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Ni.prototype.update=(bc=new St,xc=new St,wc=new St,function(){bc.setFromMatrixPosition(this.light.matrixWorld),xc.setFromMatrixPosition(this.light.target.matrixWorld),wc.subVectors(xc,bc),this.lightPlane.lookAt(wc),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(wc),this.targetLine.scale.z=wc.length()}),((ki.prototype=Object.create(Pe.prototype)).constructor=ki).prototype.update=(Cc=new St,Mc=new u,function(){Sc=this.geometry,Ec=this.pointMap,Mc.projectionMatrix.copy(this.camera.projectionMatrix),Nc("c",0,0,-1),Nc("t",0,0,1),Nc("n1",-1,-1,-1),Nc("n2",1,-1,-1),Nc("n3",-1,1,-1),Nc("n4",1,1,-1),Nc("f1",-1,-1,1),Nc("f2",1,-1,1),Nc("f3",-1,1,1),Nc("f4",1,1,1),Nc("u1",.7,1.1,-1),Nc("u2",-.7,1.1,-1),Nc("u3",0,2,-1),Nc("cf1",-1,0,1),Nc("cf2",1,0,1),Nc("cf3",0,-1,1),Nc("cf4",0,1,1),Nc("cn1",-1,0,-1),Nc("cn2",1,0,-1),Nc("cn3",0,-1,-1),Nc("cn4",0,1,-1),Sc.getAttribute("position").needsUpdate=!0}),((Di.prototype=Object.create(Pe.prototype)).constructor=Di).prototype.update=(Tc=new r,function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Tc.setFromObject(this.object),!Tc.isEmpty()){t=Tc.min;var e=Tc.max,r=this.geometry.attributes.position,n=r.array;n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=t.x,n[4]=e.y,n[5]=e.z,n[6]=t.x,n[7]=t.y,n[8]=e.z,n[9]=e.x,n[10]=t.y,n[11]=e.z,n[12]=e.x,n[13]=e.y,n[14]=t.z,n[15]=t.x,n[16]=e.y,n[17]=t.z,n[18]=t.x,n[19]=t.y,n[20]=t.z,n[21]=e.x,n[22]=t.y,n[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}),Di.prototype.setFromObject=function(t){return this.object=t,this.update(),this},((ji.prototype=Object.create(Pe.prototype)).constructor=ji).prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),l.prototype.updateMatrixWorld.call(this,t))},((zi.prototype=Object.create(Te.prototype)).constructor=zi).prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),l.prototype.updateMatrixWorld.call(this,t)},((Fi.prototype=Object.create(l.prototype)).constructor=Fi).prototype.setDirection=(Ic=new St,function(t){.99999<t.y?this.quaternion.set(0,0,0,1):t.y<-.99999?this.quaternion.set(1,0,0,0):(Ic.set(t.z,0,-t.x).normalize(),Ac=Math.acos(t.y),this.quaternion.setFromAxisAngle(Ic,Ac))}),Fi.prototype.setLength=function(t,e,r){void 0===e&&(e=.2*t),void 0===r&&(r=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(r,e,r),this.cone.position.y=t,this.cone.updateMatrix()},Fi.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)},(Bi.prototype=Object.create(Pe.prototype)).constructor=Bi,en.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(en.prototype),(t.prototype.constructor=t).prototype.getPoint=e,t},Object.assign(yn.prototype,{createPointsGeometry:function(t){return console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead."),t=this.getPoints(t),this.createGeometry(t)},createSpacedPointsGeometry:function(t){return console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead."),t=this.getSpacedPoints(t),this.createGeometry(t)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new E,r=0,n=t.length;r<n;r++){var i=t[r];e.vertices.push(new St(i.x,i.y,i.z||0))}return e}}),Object.assign(vn.prototype,{fromPoints:function(t){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),Ui.prototype=Object.create(an.prototype),Vi.prototype=Object.create(an.prototype),Gi.prototype=Object.create(an.prototype),Object.assign(Gi.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Ii.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Ti.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign($n.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Lu.extractUrlBase(t)}}),Object.assign(wi.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(r.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Si.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(po,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),po.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),po.ceilPowerOfTwo(t)}}),Object.assign(g.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(wt.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return void 0===Lc&&(Lc=new St),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),Lc.setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,r,n,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,r,i,o)}}),y.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},s.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(z.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(F.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(F,{barycoordFromPoint:function(t,e,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),F.getBarycoord(t,e,r,n,i)},normal:function(t,e,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),F.getNormal(t,e,r,n)}}),Object.assign(_n.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new vr(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Or(this,t)}}),Object.assign(H.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(St.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Et.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(E.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(l.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(l.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(we.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Se.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(en.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),le.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(bn.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(v.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(A.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addDrawCall:function(t,e,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(A.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(_r.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(pi.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(k.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new w}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}}}),Object.defineProperties(Gr.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(j.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(de.prototype,{animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(de.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(oe.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(T.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(pe.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}}}),ni.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new Qn).load(t,function(t){e.setBuffer(t)}),this},oi.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},ei.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},Go.crossOrigin=void 0,Go.loadTexture=function(t,e,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new tn;return i.setCrossOrigin(this.crossOrigin),t=i.load(t,r,void 0,n),e&&(t.mapping=e),t},Go.loadTextureCube=function(t,e,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new Qr;return i.setCrossOrigin(this.crossOrigin),t=i.load(t,r,void 0,n),e&&(t.mapping=e),t},Go.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Go.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},t.WebGLRenderTargetCube=n,t.WebGLRenderTarget=T,t.WebGLRenderer=de,t.ShaderLib=na,t.UniformsLib=ra,t.UniformsUtils=Yo,t.ShaderChunk=Xo,t.FogExp2=me,t.Fog=ge,t.Scene=ye,t.Sprite=xe,t.LOD=we,t.SkinnedMesh=Ce,t.Skeleton=Se,t.Bone=Ee,t.Mesh=B,t.LineSegments=Pe,t.LineLoop=Oe,t.Line=Te,t.Points=Ie,t.Group=ce,t.VideoTexture=Le,t.DataTexture=Ct,t.CompressedTexture=Re,t.CubeTexture=V,t.CanvasTexture=Ne,t.DepthTexture=ke,t.Texture=p,t.CompressedTextureLoader=Zr,t.DataTextureLoader=Kr,t.CubeTextureLoader=Qr,t.TextureLoader=tn,t.ObjectLoader=Xn,t.MaterialLoader=qn,t.BufferGeometryLoader=Hn,t.DefaultLoadingManager=_u,t.LoadingManager=Xr,t.JSONLoader=Wn,t.ImageLoader=Jr,t.ImageBitmapLoader=Yn,t.FontLoader=Jn,t.FileLoader=Yr,t.Loader=$n,t.LoaderUtils=Lu,t.Cache=vu,t.AudioLoader=Qn,t.SpotLightShadow=Sn,t.SpotLight=En,t.PointLight=Cn,t.RectAreaLight=On,t.HemisphereLight=xn,t.DirectionalLightShadow=Mn,t.DirectionalLight=Tn,t.AmbientLight=Pn,t.LightShadow=wn,t.Light=bn,t.StereoCamera=ti,t.PerspectiveCamera=le,t.OrthographicCamera=f,t.CubeCamera=ei,t.ArrayCamera=he,t.Camera=u,t.AudioListener=ri,t.PositionalAudio=ii,t.AudioContext=Rc,t.AudioAnalyser=oi,t.Audio=ni,t.VectorKeyframeTrack=Un,t.StringKeyframeTrack=Bn,t.QuaternionKeyframeTrack=Fn,t.NumberKeyframeTrack=jn,t.ColorKeyframeTrack=Dn,t.BooleanKeyframeTrack=kn,t.PropertyMixer=ai,t.PropertyBinding=ui,t.KeyframeTrack=Nn,t.AnimationUtils=Mu,t.AnimationObjectGroup=ci,t.AnimationMixer=hi,t.AnimationClip=Vn,t.Uniform=pi,t.InstancedBufferGeometry=fi,t.BufferGeometry=A,t.Geometry=E,t.InterleavedBufferAttribute=_e,t.InstancedInterleavedBuffer=di,t.InterleavedBuffer=ve,t.InstancedBufferAttribute=mi,t.Face3=S,t.Object3D=l,t.Raycaster=gi,t.Layers=o,t.EventDispatcher=e,t.Clock=_i,t.QuaternionLinearInterpolant=zn,t.LinearInterpolant=Ln,t.DiscreteInterpolant=Rn,t.CubicInterpolant=In,t.Interpolant=An,t.Triangle=F,t.Math=po,t.Spherical=bi,t.Cylindrical=xi,t.Plane=y,t.Frustum=Mt,t.Sphere=a,t.Ray=z,t.Matrix4=wt,t.Matrix3=g,t.Box3=r,t.Box2=wi,t.Line3=Si,t.Euler=i,t.Vector4=Et,t.Vector3=St,t.Vector2=H,t.Quaternion=s,t.Color=w,t.ImmediateRenderObject=Ei,t.VertexNormalsHelper=Ci,t.SpotLightHelper=Mi,t.SkeletonHelper=Ti,t.PointLightHelper=Pi,t.RectAreaLightHelper=Oi,t.HemisphereLightHelper=Ai,t.GridHelper=Ii,t.PolarGridHelper=Li,t.FaceNormalsHelper=Ri,t.DirectionalLightHelper=Ni,t.CameraHelper=ki,t.BoxHelper=Di,t.Box3Helper=ji,t.PlaneHelper=zi,t.ArrowHelper=Fi,t.AxesHelper=Bi,t.Shape=_n,t.Path=vn,t.ShapePath=Zn,t.Font=Kn,t.CurvePath=yn,t.Curve=en,t.ImageUtils=Go,t.ShapeUtils=du,t.WebGLUtils=ue,t.WireframeGeometry=De,t.ParametricGeometry=je,t.ParametricBufferGeometry=ze,t.TetrahedronGeometry=Ue,t.TetrahedronBufferGeometry=Ve,t.OctahedronGeometry=Ge,t.OctahedronBufferGeometry=qe,t.IcosahedronGeometry=He,t.IcosahedronBufferGeometry=$e,t.DodecahedronGeometry=We,t.DodecahedronBufferGeometry=Xe,t.PolyhedronGeometry=Fe,t.PolyhedronBufferGeometry=Be,t.TubeGeometry=Ye,t.TubeBufferGeometry=Ze,t.TorusKnotGeometry=Ke,t.TorusKnotBufferGeometry=Je,t.TorusGeometry=Qe,t.TorusBufferGeometry=tr,t.TextGeometry=xr,t.TextBufferGeometry=wr,t.SphereGeometry=Sr,t.SphereBufferGeometry=Er,t.RingGeometry=Cr,t.RingBufferGeometry=Mr,t.PlaneGeometry=R,t.PlaneBufferGeometry=N,t.LatheGeometry=Tr,t.LatheBufferGeometry=Pr,t.ShapeGeometry=Or,t.ShapeBufferGeometry=Ar,t.ExtrudeGeometry=vr,t.ExtrudeBufferGeometry=_r,t.EdgesGeometry=Lr,t.ConeGeometry=kr,t.ConeBufferGeometry=Dr,t.CylinderGeometry=Rr,t.CylinderBufferGeometry=Nr,t.CircleGeometry=jr,t.CircleBufferGeometry=zr,t.BoxGeometry=I,t.BoxBufferGeometry=L,t.ShadowMaterial=Fr,t.SpriteMaterial=be,t.RawShaderMaterial=Br,t.ShaderMaterial=j,t.PointsMaterial=Ae,t.MeshPhysicalMaterial=Vr,t.MeshStandardMaterial=Ur,t.MeshPhongMaterial=Gr,t.MeshToonMaterial=qr,t.MeshNormalMaterial=Hr,t.MeshLambertMaterial=$r,t.MeshDepthMaterial=ne,t.MeshDistanceMaterial=ie,t.MeshBasicMaterial=D,t.LineDashedMaterial=Wr,t.LineBasicMaterial=Me,t.Material=k,t.Float64BufferAttribute=C,t.Float32BufferAttribute=O,t.Uint32BufferAttribute=x,t.Int32BufferAttribute=b,t.Uint16BufferAttribute=_,t.Int16BufferAttribute=m,t.Uint8ClampedBufferAttribute=d,t.Uint8BufferAttribute=h,t.Int8BufferAttribute=c,t.BufferAttribute=v,t.ArcCurve=nn,t.CatmullRomCurve3=an,t.CubicBezierCurve=ln,t.CubicBezierCurve3=hn,t.EllipseCurve=rn,t.LineCurve=pn,t.LineCurve3=fn,t.QuadraticBezierCurve=dn,t.QuadraticBezierCurve3=mn,t.SplineCurve=gn,t.REVISION="95",t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},t.CullFaceNone=0,t.CullFaceBack=1,t.CullFaceFront=2,t.CullFaceFrontBack=3,t.FrontFaceDirectionCW=0,t.FrontFaceDirectionCCW=1,t.BasicShadowMap=0,t.PCFShadowMap=1,t.PCFSoftShadowMap=2,t.FrontSide=0,t.BackSide=1,t.DoubleSide=2,t.FlatShading=1,t.SmoothShading=2,t.NoColors=0,t.FaceColors=1,t.VertexColors=2,t.NoBlending=0,t.NormalBlending=1,t.AdditiveBlending=2,t.SubtractiveBlending=3,t.MultiplyBlending=4,t.CustomBlending=5,t.AddEquation=100,t.SubtractEquation=101,t.ReverseSubtractEquation=102,t.MinEquation=103,t.MaxEquation=104,t.ZeroFactor=200,t.OneFactor=201,t.SrcColorFactor=202,t.OneMinusSrcColorFactor=203,t.SrcAlphaFactor=204,t.OneMinusSrcAlphaFactor=205,t.DstAlphaFactor=206,t.OneMinusDstAlphaFactor=207,t.DstColorFactor=208,t.OneMinusDstColorFactor=209,t.SrcAlphaSaturateFactor=210,t.NeverDepth=0,t.AlwaysDepth=1,t.LessDepth=2,t.LessEqualDepth=3,t.EqualDepth=4,t.GreaterEqualDepth=5,t.GreaterDepth=6,t.NotEqualDepth=7,t.MultiplyOperation=0,t.MixOperation=1,t.AddOperation=2,t.NoToneMapping=0,t.LinearToneMapping=1,t.ReinhardToneMapping=2,t.Uncharted2ToneMapping=3,t.CineonToneMapping=4,t.UVMapping=300,t.CubeReflectionMapping=301,t.CubeRefractionMapping=302,t.EquirectangularReflectionMapping=303,t.EquirectangularRefractionMapping=304,t.SphericalReflectionMapping=305,t.CubeUVReflectionMapping=306,t.CubeUVRefractionMapping=307,t.RepeatWrapping=1e3,t.ClampToEdgeWrapping=1001,t.MirroredRepeatWrapping=1002,t.NearestFilter=1003,t.NearestMipMapNearestFilter=1004,t.NearestMipMapLinearFilter=1005,t.LinearFilter=1006,t.LinearMipMapNearestFilter=1007,t.LinearMipMapLinearFilter=1008,t.UnsignedByteType=1009,t.ByteType=1010,t.ShortType=1011,t.UnsignedShortType=1012,t.IntType=1013,t.UnsignedIntType=1014,t.FloatType=1015,t.HalfFloatType=1016,t.UnsignedShort4444Type=1017,t.UnsignedShort5551Type=1018,t.UnsignedShort565Type=1019,t.UnsignedInt248Type=1020,t.AlphaFormat=1021,t.RGBFormat=1022,t.RGBAFormat=1023,t.LuminanceFormat=1024,t.LuminanceAlphaFormat=1025,t.RGBEFormat=1023,t.DepthFormat=1026,t.DepthStencilFormat=1027,t.RGB_S3TC_DXT1_Format=33776,t.RGBA_S3TC_DXT1_Format=33777,t.RGBA_S3TC_DXT3_Format=33778,t.RGBA_S3TC_DXT5_Format=33779,t.RGB_PVRTC_4BPPV1_Format=35840,t.RGB_PVRTC_2BPPV1_Format=35841,t.RGBA_PVRTC_4BPPV1_Format=35842,t.RGBA_PVRTC_2BPPV1_Format=35843,t.RGB_ETC1_Format=36196,t.RGBA_ASTC_4x4_Format=37808,t.RGBA_ASTC_5x4_Format=37809,t.RGBA_ASTC_5x5_Format=37810,t.RGBA_ASTC_6x5_Format=37811,t.RGBA_ASTC_6x6_Format=37812,t.RGBA_ASTC_8x5_Format=37813,t.RGBA_ASTC_8x6_Format=37814,t.RGBA_ASTC_8x8_Format=37815,t.RGBA_ASTC_10x5_Format=37816,t.RGBA_ASTC_10x6_Format=37817,t.RGBA_ASTC_10x8_Format=37818,t.RGBA_ASTC_10x10_Format=37819,t.RGBA_ASTC_12x10_Format=37820,t.RGBA_ASTC_12x12_Format=37821,t.LoopOnce=2200,t.LoopRepeat=2201,t.LoopPingPong=2202,t.InterpolateDiscrete=2300,t.InterpolateLinear=2301,t.InterpolateSmooth=2302,t.ZeroCurvatureEnding=2400,t.ZeroSlopeEnding=2401,t.WrapAroundEnding=2402,t.TrianglesDrawMode=0,t.TriangleStripDrawMode=1,t.TriangleFanDrawMode=2,t.LinearEncoding=3e3,t.sRGBEncoding=3001,t.GammaEncoding=3007,t.RGBEEncoding=3002,t.LogLuvEncoding=3003,t.RGBM7Encoding=3004,t.RGBM16Encoding=3005,t.RGBDEncoding=3006,t.BasicDepthPacking=3200,t.RGBADepthPacking=3201,t.TangentSpaceNormalMap=0,t.ObjectSpaceNormalMap=1,t.CubeGeometry=I,t.Face4=function(t,e,r,n,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new S(t,e,r,i,o,a)},t.LineStrip=0,t.LinePieces=1,t.MeshFaceMaterial=function(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t},t.MultiMaterial=function(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,(t.materials=t).clone=function(){return t.slice()},t},t.PointCloud=function(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Ie(t,e)},t.Particle=function(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new xe(t)},t.ParticleSystem=function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Ie(t,e)},t.PointCloudMaterial=function(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Ae(t)},t.ParticleBasicMaterial=function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Ae(t)},t.ParticleSystemMaterial=function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Ae(t)},t.Vertex=function(t,e,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new St(t,e,r)},t.DynamicBufferAttribute=function(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new v(t,e).setDynamic(!0)},t.Int8Attribute=function(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new c(t,e)},t.Uint8Attribute=function(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new h(t,e)},t.Uint8ClampedAttribute=function(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new d(t,e)},t.Int16Attribute=function(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new m(t,e)},t.Uint16Attribute=function(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new _(t,e)},t.Int32Attribute=function(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new b(t,e)},t.Uint32Attribute=function(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new x(t,e)},t.Float32Attribute=function(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new O(t,e)},t.Float64Attribute=function(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new C(t,e)},t.ClosedSplineCurve3=Ui,t.SplineCurve3=Vi,t.Spline=Gi,t.AxisHelper=function(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Bi(t)},t.BoundingBoxHelper=function(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Di(t,e)},t.EdgesHelper=function(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Pe(new Lr(t.geometry),new Me({color:void 0!==e?e:16777215}))},t.WireframeHelper=function(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Pe(new De(t.geometry),new Me({color:void 0!==e?e:16777215}))},t.XHRLoader=function(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Yr(t)},t.BinaryTextureLoader=function(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Kr(t)},t.GeometryUtils={merge:function(t,e,r){if(console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh){e.matrixAutoUpdate&&e.updateMatrix();var n=e.matrix;e=e.geometry}t.merge(e,n,r)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}},t.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(t,e){console.warn("THREE.Projector: .projectVector() is now vector.project()."),t.project(e)},this.unprojectVector=function(t,e){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),t.unproject(e)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},t.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},t.SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}},t.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},Object.defineProperty(t,"__esModule",{value:!0})}("object"==typeof r&&void 0!==e?r:n.THREE={})},{}],243:[function(t,e,r){"use strict";function n(t,e){if(!(this instanceof n))return new n(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||i,0<this.length)for(var r=this.length>>1;0<=r;r--)this._down(r)}function i(t,e){return t<e?-1:e<t?1:0}(e.exports=n).prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,r=this.compare,n=e[t];0<t;){var i=t-1>>1,o=e[i];if(0<=r(n,o))break;e[t]=o,t=i}e[t]=n},_down:function(t){for(var e=this.data,r=this.compare,n=this.length,i=n>>1,o=e[t];t<i;){var a=1+(t<<1),s=a+1,u=e[a];if(s<n&&r(e[s],u)<0&&(u=e[a=s]),0<=r(u,o))break;e[t]=u,t=a}e[t]=o}}},{}],244:[function(t,e,r){var n=t("./vdom/create-element.js");e.exports=n},{"./vdom/create-element.js":250}],245:[function(t,e,r){var n=t("./vtree/diff.js");e.exports=n},{"./vtree/diff.js":270}],246:[function(t,e,r){var n=t("./virtual-hyperscript/index.js");e.exports=n},{"./virtual-hyperscript/index.js":257}],247:[function(t,e,r){var n=t("./diff.js"),i=t("./patch.js"),o=t("./h.js"),a=t("./create-element.js"),s=t("./vnode/vnode.js"),u=t("./vnode/vtext.js");e.exports={diff:n,patch:i,h:o,create:a,VNode:s,VText:u}},{"./create-element.js":244,"./diff.js":245,"./h.js":246,"./patch.js":248,"./vnode/vnode.js":266,"./vnode/vtext.js":268}],248:[function(t,e,r){var n=t("./vdom/patch.js");e.exports=n},{"./vdom/patch.js":253}],249:[function(t,e,r){var h=t("is-object"),s=t("../vnode/is-vhook.js");function o(t,e,r,n){if(n){var i=n[e];if(s(i))i.unhook&&i.unhook(t,e,r);else if("attributes"===e)for(var o in i)t.removeAttribute(o);else if("style"===e)for(var a in i)t.style[a]="";else t[e]="string"==typeof i?"":null}}function a(t,e,r,n,i){var o=r?r[n]:void 0;if("attributes"!==n)if(o&&h(o)&&p(o)!==p(i))t[n]=i;else{h(t[n])||(t[n]={});var a="style"===n?"":void 0;for(var s in i){var u=i[s];t[n][s]=void 0===u?a:u}}else for(var c in i){var l=i[c];void 0===l?t.removeAttribute(c):t.setAttribute(c,l)}}function p(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__?t.__proto__:t.constructor?t.constructor.prototype:void 0}e.exports=function(t,e,r){for(var n in e){var i=e[n];void 0===i?o(t,n,i,r):s(i)?(o(t,n,i,r),i.hook&&i.hook(t,n,r?r[n]:void 0)):h(i)?a(t,e,r,n,i):t[n]=i}}},{"../vnode/is-vhook.js":261,"is-object":20}],250:[function(t,e,r){var l=t("global/document"),h=t("./apply-properties"),p=t("../vnode/is-vnode.js"),f=t("../vnode/is-vtext.js"),d=t("../vnode/is-widget.js"),m=t("../vnode/handle-thunk.js");e.exports=function t(e,r){var n=r&&r.document||l;var i=r?r.warn:null;e=m(e).a;{if(d(e))return e.init();if(f(e))return n.createTextNode(e.text);if(!p(e))return i&&i("Item is not a valid virtual dom node",e),null}var o=null===e.namespace?n.createElement(e.tagName):n.createElementNS(e.namespace,e.tagName);var a=e.properties;h(o,a);var s=e.children;for(var u=0;u<s.length;u++){var c=t(s[u],r);c&&o.appendChild(c)}return o}},{"../vnode/handle-thunk.js":259,"../vnode/is-vnode.js":262,"../vnode/is-vtext.js":263,"../vnode/is-widget.js":264,"./apply-properties":249,"global/document":16}],251:[function(t,e,r){var h={};function p(t,e,r){if(0===t.length)return!1;for(var n,i,o=0,a=t.length-1;o<=a;){if(i=t[n=(a+o)/2>>0],o===a)return e<=i&&i<=r;if(i<e)o=1+n;else{if(!(r<i))return!0;a=n-1}}return!1}function i(t,e){return e<t?1:-1}e.exports=function(t,e,r,n){return r&&0!==r.length?(r.sort(i),function t(e,r,n,i,o){i=i||{};if(e){p(n,o,o)&&(i[o]=e);var a=r.children;if(a)for(var s=e.childNodes,u=0;u<r.children.length;u++){o+=1;var c=a[u]||h,l=o+(c.count||0);p(n,o,l)&&t(s[u],c,n,i,o),o=l}}return i}(t,e,r,n,0)):{}}},{}],252:[function(t,e,r){var a=t("./apply-properties"),n=t("../vnode/is-widget.js"),s=t("../vnode/vpatch.js"),u=t("./update-widget");function c(t,e){"function"==typeof e.destroy&&n(e)&&e.destroy(t)}e.exports=function(t,e,r){var n=t.type,i=t.vNode,o=t.patch;switch(n){case s.REMOVE:return function(t,e){var r=t.parentNode;r&&r.removeChild(t);return c(t,e),null}(e,i);case s.INSERT:return function(t,e,r){var n=r.render(e,r);t&&t.appendChild(n);return t}(e,o,r);case s.VTEXT:return function(t,e,r,n){var i;if(3===t.nodeType)t.replaceData(0,t.length,r.text),i=t;else{var o=t.parentNode;i=n.render(r,n),o&&i!==t&&o.replaceChild(i,t)}return i}(e,0,o,r);case s.WIDGET:return function(t,e,r,n){var i,o=u(e,r);i=o?r.update(e,t)||t:n.render(r,n);var a=t.parentNode;a&&i!==t&&a.replaceChild(i,t);o||c(t,e);return i}(e,i,o,r);case s.VNODE:return function(t,e,r,n){var i=t.parentNode,o=n.render(r,n);i&&o!==t&&i.replaceChild(o,t);return o}(e,0,o,r);case s.ORDER:return function(t,e){for(var r,n,i,o=t.childNodes,a={},s=0;s<e.removes.length;s++)n=e.removes[s],r=o[n.from],n.key&&(a[n.key]=r),t.removeChild(r);for(var u=o.length,c=0;c<e.inserts.length;c++)i=e.inserts[c],r=a[i.key],t.insertBefore(r,i.to>=u++?null:o[i.to])}(e,o),e;case s.PROPS:return a(e,o,i.properties),e;case s.THUNK:return function(t,e){t&&e&&t!==e&&t.parentNode&&t.parentNode.replaceChild(e,t);return e}(e,r.patch(e,o,r));default:return e}}},{"../vnode/is-widget.js":264,"../vnode/vpatch.js":267,"./apply-properties":249,"./update-widget":254}],253:[function(t,e,r){var u=t("global/document"),a=t("x-is-array"),i=t("./create-element"),c=t("./dom-index"),s=t("./patch-op");function o(t,e,r){var n=function(t){var e=[];for(var r in t)"a"!==r&&e.push(Number(r));return e}(e);if(0===n.length)return t;var i=c(t,e.a,n),o=t.ownerDocument;r.document||o===u||(r.document=o);for(var a=0;a<n.length;a++){var s=n[a];t=l(t,i[s],e[s],r)}return t}function l(t,e,r,n){if(!e)return t;var i;if(a(r))for(var o=0;o<r.length;o++)i=s(r[o],e,n),e===t&&(t=i);else i=s(r,e,n),e===t&&(t=i);return t}e.exports=function t(e,r,n){n=n||{};n.patch=n.patch&&n.patch!==t?n.patch:o;n.render=n.render||i;return n.patch(e,r,n)}},{"./create-element":250,"./dom-index":251,"./patch-op":252,"global/document":16,"x-is-array":289}],254:[function(t,e,r){var n=t("../vnode/is-widget.js");e.exports=function(t,e){if(n(t)&&n(e))return"name"in t&&"name"in e?t.id===e.id:t.init===e.init;return!1}},{"../vnode/is-widget.js":264}],255:[function(t,e,r){"use strict";var n=t("ev-store");function i(t){if(!(this instanceof i))return new i(t);this.value=t}(e.exports=i).prototype.hook=function(t,e){n(t)[e.substr(3)]=this.value},i.prototype.unhook=function(t,e){n(t)[e.substr(3)]=void 0}},{"ev-store":9}],256:[function(t,e,r){"use strict";function n(t){if(!(this instanceof n))return new n(t);this.value=t}(e.exports=n).prototype.hook=function(t,e){t[e]!==this.value&&(t[e]=this.value)}},{}],257:[function(t,e,r){"use strict";var u=t("x-is-array"),c=t("../vnode/vnode.js"),l=t("../vnode/vtext.js"),n=t("../vnode/is-vnode"),i=t("../vnode/is-vtext"),o=t("../vnode/is-widget"),h=t("../vnode/is-vhook"),a=t("../vnode/is-thunk"),p=t("./parse-tag.js"),f=t("./hooks/soft-set-hook.js"),d=t("./hooks/ev-hook.js");function m(t){return n(t)||i(t)||o(t)||a(t)}function g(t){var e=new Error;return e.type="virtual-hyperscript.unexpected.virtual-element",e.message="Unexpected virtual child passed to h().\nExpected a VNode / Vthunk / VWidget / string but:\ngot:\n"+s(t.foreignObject)+".\nThe parent vnode is:\n"+s(t.parentVnode),e.foreignObject=t.foreignObject,e.parentVnode=t.parentVnode,e}function s(e){try{return JSON.stringify(e,null,"    ")}catch(t){return String(e)}}e.exports=function(t,e,r){var n,i,o,a,s=[];!r&&function(t){return"string"==typeof t||u(t)||m(t)}(e)&&(r=e,i={});n=p(t,i=i||e||{}),i.hasOwnProperty("key")&&(o=i.key,i.key=void 0);i.hasOwnProperty("namespace")&&(a=i.namespace,i.namespace=void 0);"INPUT"!==n||a||!i.hasOwnProperty("value")||void 0===i.value||h(i.value)||(i.value=f(i.value));(function(t){for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];if(h(r))continue;"ev-"===e.substr(0,3)&&(t[e]=d(r))}})(i),null!=r&&function t(e,r,n,i){if("string"==typeof e)r.push(new l(e));else if("number"==typeof e)r.push(new l(String(e)));else if(m(e))r.push(e);else{if(!u(e)){if(null==e)return;throw g({foreignObject:e,parentVnode:{tagName:n,properties:i}})}for(var o=0;o<e.length;o++)t(e[o],r,n,i)}}(r,s,n,i);return new c(n,i,s,o,a)}},{"../vnode/is-thunk":260,"../vnode/is-vhook":261,"../vnode/is-vnode":262,"../vnode/is-vtext":263,"../vnode/is-widget":264,"../vnode/vnode.js":266,"../vnode/vtext.js":268,"./hooks/ev-hook.js":255,"./hooks/soft-set-hook.js":256,"./parse-tag.js":258,"x-is-array":289}],258:[function(t,e,r){"use strict";var c=t("browser-split"),l=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,h=/^\.|#/;e.exports=function(t,e){if(!t)return"DIV";var r,n,i,o,a=!e.hasOwnProperty("id"),s=c(t,l),u=null;h.test(s[1])&&(u="DIV");for(o=0;o<s.length;o++)(n=s[o])&&(i=n.charAt(0),u?"."===i?(r=r||[]).push(n.substring(1,n.length)):"#"===i&&a&&(e.id=n.substring(1,n.length)):u=n);r&&(e.className&&r.push(e.className),e.className=r.join(" "));return e.namespace?u:u.toUpperCase()}},{"browser-split":5}],259:[function(t,e,r){var n=t("./is-vnode"),i=t("./is-vtext"),o=t("./is-widget"),a=t("./is-thunk");function s(t,e){var r=t.vnode;if(r=r||(t.vnode=t.render(e)),!(n(r)||i(r)||o(r)))throw new Error("thunk did not return a valid node");return r}e.exports=function(t,e){var r=t,n=e;a(e)&&(n=s(e,t));a(t)&&(r=s(t,null));return{a:r,b:n}}},{"./is-thunk":260,"./is-vnode":262,"./is-vtext":263,"./is-widget":264}],260:[function(t,e,r){e.exports=function(t){return t&&"Thunk"===t.type}},{}],261:[function(t,e,r){e.exports=function(t){return t&&("function"==typeof t.hook&&!t.hasOwnProperty("hook")||"function"==typeof t.unhook&&!t.hasOwnProperty("unhook"))}},{}],262:[function(t,e,r){var n=t("./version");e.exports=function(t){return t&&"VirtualNode"===t.type&&t.version===n}},{"./version":265}],263:[function(t,e,r){var n=t("./version");e.exports=function(t){return t&&"VirtualText"===t.type&&t.version===n}},{"./version":265}],264:[function(t,e,r){e.exports=function(t){return t&&"Widget"===t.type}},{}],265:[function(t,e,r){e.exports="2"},{}],266:[function(t,e,r){var n=t("./version"),m=t("./is-vnode"),g=t("./is-widget"),y=t("./is-thunk"),v=t("./is-vhook");e.exports=i;var _={},b=[];function i(t,e,r,n,i){this.tagName=t,this.properties=e||_,this.children=r||b,this.key=null!=n?String(n):void 0,this.namespace="string"==typeof i?i:null;var o,a=r&&r.length||0,s=0,u=!1,c=!1,l=!1;for(var h in e)if(e.hasOwnProperty(h)){var p=e[h];v(p)&&p.unhook&&((o=o||{})[h]=p)}for(var f=0;f<a;f++){var d=r[f];m(d)?(s+=d.count||0,!u&&d.hasWidgets&&(u=!0),!c&&d.hasThunks&&(c=!0),l||!d.hooks&&!d.descendantHooks||(l=!0)):!u&&g(d)?"function"==typeof d.destroy&&(u=!0):!c&&y(d)&&(c=!0)}this.count=a+s,this.hasWidgets=u,this.hasThunks=c,this.hooks=o,this.descendantHooks=l}i.prototype.version=n,i.prototype.type="VirtualNode"},{"./is-thunk":260,"./is-vhook":261,"./is-vnode":262,"./is-widget":264,"./version":265}],267:[function(t,e,r){var n=t("./version");function i(t,e,r){this.type=Number(t),this.vNode=e,this.patch=r}i.NONE=0,i.VTEXT=1,i.VNODE=2,i.WIDGET=3,i.PROPS=4,i.ORDER=5,i.INSERT=6,i.REMOVE=7,i.THUNK=8,(e.exports=i).prototype.version=n,i.prototype.type="VirtualPatch"},{"./version":265}],268:[function(t,e,r){var n=t("./version");function i(t){this.text=String(t)}(e.exports=i).prototype.version=n,i.prototype.type="VirtualText"},{"./version":265}],269:[function(t,e,r){var c=t("is-object"),l=t("../vnode/is-vhook");function h(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__?t.__proto__:t.constructor?t.constructor.prototype:void 0}e.exports=function t(e,r){var n;for(var i in e){i in r||((n=n||{})[i]=void 0);var o=e[i],a=r[i];if(o!==a)if(c(o)&&c(a))if(h(a)!==h(o))(n=n||{})[i]=a;else if(l(a))(n=n||{})[i]=a;else{var s=t(o,a);s&&((n=n||{})[i]=s)}else(n=n||{})[i]=a}for(var u in r)u in e||((n=n||{})[u]=r[u]);return n}},{"../vnode/is-vhook":261,"is-object":20}],270:[function(t,e,r){var n=t("x-is-array"),d=t("../vnode/vpatch"),m=t("../vnode/is-vnode"),s=t("../vnode/is-vtext"),u=t("../vnode/is-widget"),c=t("../vnode/is-thunk"),a=t("../vnode/handle-thunk"),l=t("./diff-props");function h(t,e){var r={a:t};return g(t,e,r,0),r}function g(t,e,r,n){if(t!==e){var i=r[n],o=!1;if(c(t)||c(e))f(t,e,r,n);else if(null==e)u(t)||(p(t,r,n),i=r[n]),i=v(i,new d(d.REMOVE,t,e));else if(m(e))if(m(t))if(t.tagName===e.tagName&&t.namespace===e.namespace&&t.key===e.key){var a=l(t.properties,e.properties);a&&(i=v(i,new d(d.PROPS,t,a))),i=function(t,e,r,n,i){for(var o=t.children,a=function(t,e){var r=C(e),n=r.keys,i=r.free;if(i.length===e.length)return{children:e,moves:null};var o=C(t),a=o.keys;if(o.free.length===t.length)return{children:e,moves:null};for(var s=[],u=0,c=i.length,l=0,h=0;h<t.length;h++){var p,f=t[h];f.key?n.hasOwnProperty(f.key)?(p=n[f.key],s.push(e[p])):(p=h-l++,s.push(null)):u<c?(p=i[u++],s.push(e[p])):(p=h-l++,s.push(null))}for(var d=u>=i.length?e.length:i[u],m=0;m<e.length;m++){var g=e[m];g.key?a.hasOwnProperty(g.key)||s.push(g):d<=m&&s.push(g)}for(var y,v=s.slice(),_=0,b=[],x=[],w=0;w<e.length;){var S=e[w];for(y=v[_];null===y&&v.length;)b.push(E(v,_,null)),y=v[_];y&&y.key===S.key?(_++,w++):S.key?(y&&y.key&&n[y.key]!==w+1?(b.push(E(v,_,y.key)),(y=v[_])&&y.key===S.key?_++:x.push({key:S.key,to:w})):x.push({key:S.key,to:w}),w++):y&&y.key&&b.push(E(v,_,y.key))}for(;_<v.length;)y=v[_],b.push(E(v,_,y&&y.key));return b.length!==l||x.length?{children:s,moves:{removes:b,inserts:x}}:{children:s,moves:null}}(o,e.children),s=a.children,u=o.length,c=s.length,l=c<u?u:c,h=0;h<l;h++){var p=o[h],f=s[h];i+=1,p?g(p,f,r,i):f&&(n=v(n,new d(d.INSERT,null,f))),m(p)&&p.count&&(i+=p.count)}a.moves&&(n=v(n,new d(d.ORDER,t,a.moves)));return n}(t,e,r,i,n)}else i=v(i,new d(d.VNODE,t,e)),o=!0;else i=v(i,new d(d.VNODE,t,e)),o=!0;else s(e)?s(t)?t.text!==e.text&&(i=v(i,new d(d.VTEXT,t,e))):(i=v(i,new d(d.VTEXT,t,e)),o=!0):u(e)&&(u(t)||(o=!0),i=v(i,new d(d.WIDGET,t,e)));i&&(r[n]=i),o&&p(t,r,n)}}function p(t,e,r){!function t(e,r,n){if(m(e)){if(e.hooks&&(r[n]=v(r[n],new d(d.PROPS,e,y(e.hooks)))),e.descendantHooks||e.hasThunks)for(var i=e.children,o=i.length,a=0;a<o;a++){var s=i[a];t(s,r,n+=1),m(s)&&s.count&&(n+=s.count)}}else c(e)&&f(e,null,r,n)}(t,e,r),function t(e,r,n){if(u(e))"function"==typeof e.destroy&&(r[n]=v(r[n],new d(d.REMOVE,e,null)));else if(m(e)&&(e.hasWidgets||e.hasThunks))for(var i=e.children,o=i.length,a=0;a<o;a++){var s=i[a];t(s,r,n+=1),m(s)&&s.count&&(n+=s.count)}else c(e)&&f(e,null,r,n)}(t,e,r)}function f(t,e,r,n){var i=a(t,e),o=h(i.a,i.b);!function(t){for(var e in t)if("a"!==e)return!0;return!1}(o)||(r[n]=new d(d.THUNK,null,o))}function y(t){var e={};for(var r in t)e[r]=void 0;return e}function E(t,e,r){return t.splice(e,1),{from:e,key:r}}function C(t){for(var e={},r=[],n=t.length,i=0;i<n;i++){var o=t[i];o.key?e[o.key]=i:r.push(i)}return{keys:e,free:r}}function v(t,e){return t?(n(t)?t.push(e):t=[t,e],t):e}e.exports=h},{"../vnode/handle-thunk":259,"../vnode/is-thunk":260,"../vnode/is-vnode":262,"../vnode/is-vtext":263,"../vnode/is-widget":264,"../vnode/vpatch":267,"./diff-props":269,"x-is-array":289}],271:[function(e,r,t){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){r.exports=t(e)})(function(t){return t("./makePromise")({scheduler:new(t("./Scheduler"))(t("./env").asap)})})}()},{"./Scheduler":272,"./env":284,"./makePromise":286}],272:[function(t,e,r){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){e.exports=t()})(function(){function t(t){this._async=t,this._running=!1,(this._queue=this)._queueLen=0,this._afterQueue={},this._afterQueueLen=0;var e=this;this.drain=function(){e._drain()}}return t.prototype.enqueue=function(t){this._queue[this._queueLen++]=t,this.run()},t.prototype.afterQueue=function(t){this._afterQueue[this._afterQueueLen++]=t,this.run()},t.prototype.run=function(){this._running||(this._running=!0,this._async(this.drain))},t.prototype._drain=function(){for(var t=0;t<this._queueLen;++t)this._queue[t].run(),this._queue[t]=void 0;for(this._queueLen=0,this._running=!1,t=0;t<this._afterQueueLen;++t)this._afterQueue[t].run(),this._afterQueue[t]=void 0;this._afterQueueLen=0},t})}()},{}],273:[function(t,e,r){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){e.exports=t()})(function(){function e(t){Error.call(this),this.message=t,this.name=e.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return(e.prototype=Object.create(Error.prototype)).constructor=e})}()},{}],274:[function(t,e,r){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){e.exports=t()})(function(){return t.tryCatchResolve=e,t;function t(a,s){return arguments.length<2&&(s=e),function(t,e,r){var n=a._defer(),i=r.length,o=new Array(i);return u({f:t,thisArg:e,args:r,params:o,i:i-1,call:s},n._handler),n};function u(t,e){if(t.i<0)return s(t.f,t.thisArg,t.params,e);a._handler(t.args[t.i]).fold(r,t,void 0,e)}function r(t,e,r){t.params[t.i]=e,t.i-=1,u(t,r)}}function e(t,e,r,n){try{n.resolve(t.apply(e,r))}catch(t){n.reject(t)}}})}()},{}],275:[function(e,r,t){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){r.exports=t(e)})(function(t){var c=t("../state"),l=t("../apply");return function(f){var i=l(f),r=f.resolve,n=f.all,o=Array.prototype.reduce,a=Array.prototype.reduceRight,s=Array.prototype.slice;return f.any=function(t){for(var e,r,n=f._defer(),i=n._handler,o=t.length>>>0,a=o,s=[],u=0;u<o;++u)if(void 0!==(r=t[u])||u in t){if(0<(e=f._handler(r)).state()){i.become(e),f._visitRemaining(t,u,e);break}e.visit(i,c,l)}else--a;0===a&&i.reject(new RangeError("any(): array must not be empty"));return n;function c(t){s=null,this.resolve(t)}function l(t){this.resolved||(s.push(t),0==--a&&this.reject(s))}},f.some=function(t,e){var r,n,i,o=f._defer(),a=o._handler,s=[],u=[],c=t.length>>>0,l=0;for(i=0;i<c;++i)(void 0!==(n=t[i])||i in t)&&++l;e=Math.max(e,0),r=l-e+1,(l=Math.min(e,l))<e?a.reject(new RangeError("some(): array must contain at least "+e+" item(s), but had "+l)):0===l&&a.resolve(s);for(i=0;i<c;++i)(void 0!==(n=t[i])||i in t)&&f._handler(n).visit(a,h,p,a.notify);return o;function h(t){this.resolved||(s.push(t),0==--l&&(u=null,this.resolve(s)))}function p(t){this.resolved||(u.push(t),0==--r&&(s=null,this.reject(u)))}},f.settle=function(t){return n(t.map(e))},f.map=function(t,e){return f._traverse(e,t)},f.filter=function(t,e){var r=s.call(t);return f._traverse(e,r).then(function(t){return function(t,e){for(var r=e.length,n=new Array(r),i=0,o=0;i<r;++i)e[i]&&(n[o++]=f._handler(t[i]).value);return n.length=o,n}(r,t)})},f.reduce=function(t,e){return 2<arguments.length?o.call(t,u(e),arguments[2]):o.call(t,u(e))},f.reduceRight=function(t,e){return 2<arguments.length?a.call(t,u(e),arguments[2]):a.call(t,u(e))},f.prototype.spread=function(e){return this.then(n).then(function(t){return e.apply(this,t)})},f;function e(t){var e;return t instanceof f&&(e=t._handler.join()),e&&0===e.state()||!e?r(t).then(c.fulfilled,c.rejected):(e._unreport(),c.inspect(e))}function u(n){return function(t,e,r){return i(n,void 0,[t,e,r])}}}})}()},{"../apply":274,"../state":287}],276:[function(t,e,r){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){e.exports=t()})(function(){return function(t){var o=t.resolve,n=t.reject,e=t.prototype.catch;function r(t,e,r,n){var i=t.call(e);return function(t){return("object"==typeof t||"function"==typeof t)&&null!==t}(i)?function(t,e,r){return o(t).then(function(){return e(r)})}(i,r,n):r(n)}return t.prototype.done=function(t,e){this._handler.visit(this._handler.receiver,t,e)},t.prototype.catch=t.prototype.otherwise=function(t){return arguments.length<2?e.call(this,t):"function"!=typeof t?this.ensure(i):e.call(this,function(e,r){return function(t){return function(t,e){return function(t){return t===Error||null!=t&&t.prototype instanceof Error}(e)?t instanceof e:e(t)}(t,r)?e.call(this,t):n(t)}}(arguments[1],t))},t.prototype.finally=t.prototype.ensure=function(e){return"function"!=typeof e?this:this.then(function(t){return r(e,this,a,t)},function(t){return r(e,this,n,t)})},t.prototype.else=t.prototype.orElse=function(t){return this.then(void 0,function(){return t})},t.prototype.yield=function(t){return this.then(function(){return t})},t.prototype.tap=function(t){return this.then(t).yield(this)},t};function i(){throw new TypeError("catch predicate must be a function")}function a(t){return t}})}()},{}],277:[function(t,e,r){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){e.exports=t()})(function(){return function(i){return i.prototype.fold=function(n,t){var e=this._beget();return this._handler.fold(function(t,e,r){i._handler(t).fold(function(t,e,r){r.resolve(n.call(this,e,t))},e,this,r)},t,e._handler.receiver,e._handler),e},i}})}()},{}],278:[function(e,r,t){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){r.exports=t(e)})(function(t){var e=t("../state").inspect;return function(t){return t.prototype.inspect=function(){return e(t._handler(this))},t}})}()},{"../state":287}],279:[function(t,e,r){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){e.exports=t()})(function(){return function(t){var a=t.resolve;return t.iterate=function(e,t,r,n){return s(function(t){return[t,e(t)]},t,r,n)},t.unfold=s,t;function s(r,n,i,t){return a(t).then(function(e){return a(n(e)).then(function(t){return t?e:a(r(e)).spread(o)})});function o(t,e){return a(i(t)).then(function(){return s(r,n,i,e)})}}}})}()},{}],280:[function(t,e,r){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){e.exports=t()})(function(){return function(t){return t.prototype.progress=function(t){return this.then(void 0,void 0,t)},t}})}()},{}],281:[function(e,r,t){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){r.exports=t(e)})(function(t){var a=t("../env"),i=t("../TimeoutError");function s(t,e,r,n){return a.setTimer(function(){t(r,n,e)},e)}return function(t){function r(t,e,r){s(n,t,e,r)}function n(t,e){e.resolve(t)}function o(t,e,r){var n=void 0===t?new i("timed out after "+r+"ms"):t;e.reject(n)}return t.prototype.delay=function(t){var e=this._beget();return this._handler.fold(r,t,void 0,e._handler),e},t.prototype.timeout=function(t,e){var r=this._beget(),n=r._handler,i=s(o,t,e,r._handler);return this._handler.visit(n,function(t){a.clearTimer(i),this.resolve(t)},function(t){a.clearTimer(i),this.reject(t)},n.notify),r},t}})}()},{"../TimeoutError":273,"../env":284}],282:[function(e,r,t){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){r.exports=t(e)})(function(t){var h=t("../env").setTimer,p=t("../format");return function(t){var e,r=d,n=d;"undefined"!=typeof console&&(e=console,r=void 0!==e.error?function(t){e.error(t)}:function(t){e.log(t)},n=void 0!==e.info?function(t){e.info(t)}:function(t){e.log(t)}),t.onPotentiallyUnhandledRejection=function(t){c(s,t)},t.onPotentiallyUnhandledRejectionHandled=function(t){c(u,t)},t.onFatalRejection=function(t){c(f,t.value)};var i=[],o=[],a=null;function s(t){t.handled||(o.push(t),r("Potentially unhandled rejection ["+t.id+"] "+p.formatError(t.value)))}function u(t){var e=o.indexOf(t);0<=e&&(o.splice(e,1),n("Handled previous rejection ["+t.id+"] "+p.formatObject(t.value)))}function c(t,e){i.push(t,e),null===a&&(a=h(l,0))}function l(){for(a=null;0<i.length;)i.shift()(i.shift())}return t};function f(t){throw t}function d(){}})}()},{"../env":284,"../format":285}],283:[function(t,e,r){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){e.exports=t()})(function(){return function(t){return t.prototype.with=t.prototype.withThis=function(t){var e=this._beget(),r=e._handler;return r.receiver=t,this._handler.chain(r,t),e},t}})}()},{}],284:[function(e,r,t){(function(s){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){r.exports=t(e)})(function(t){var e,r="undefined"!=typeof setTimeout&&setTimeout,n=function(t,e){return setTimeout(t,e)},i=function(t){return clearTimeout(t)},o=function(t){return r(t,0)};if(void 0!==s&&"[object process]"===Object.prototype.toString.call(s))o=function(t){return s.nextTick(t)};else if(e="undefined"!=typeof MutationObserver&&MutationObserver||"undefined"!=typeof WebKitMutationObserver&&WebKitMutationObserver)o=function(t){var e,r=document.createTextNode("");new t(function(){var t=e;e=void 0,t()}).observe(r,{characterData:!0});var n=0;return function(t){e=t,r.data=n^=1}}(e);else if(!r){var a=t("vertx");n=function(t,e){return a.setTimer(e,t)},i=a.cancelTimer,o=a.runOnLoop||a.runOnContext}return{setTimer:n,clearTimer:i,asap:o}})}()}).call(this,e("_process"))},{_process:6}],285:[function(t,e,r){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){e.exports=t()})(function(){return{formatError:function(t){var e="object"==typeof t&&null!==t&&(t.stack||t.message)?t.stack||t.message:r(t);return t instanceof Error?e:e+" (WARNING: non-Error used)"},formatObject:r,tryStringify:n};function r(t){var e=String(t);return"[object Object]"===e&&"undefined"!=typeof JSON&&(e=n(t,e)),e}function n(t,e){try{return JSON.stringify(t)}catch(t){return e}}})}()},{}],286:[function(t,e,r){(function(F){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){e.exports=t()})(function(){return function(t){var r=t.scheduler,e=function(){{if(null!=F&&"function"==typeof F.emit)return function(t,e){return"unhandledRejection"===t?F.emit(t,e.value,e):F.emit(t,e)};if("undefined"!=typeof self&&function(){if("function"==typeof CustomEvent)try{return new CustomEvent("unhandledRejection")instanceof CustomEvent}catch(t){}return!1}())return function(n,i){return function(t,e){var r=new i(t,{detail:{reason:e.value,key:e},bubbles:!1,cancelable:!0});return!n.dispatchEvent(r)}}(self,CustomEvent);if("undefined"!=typeof self&&function(){if("undefined"!=typeof document&&"function"==typeof document.createEvent)try{return document.createEvent("CustomEvent").initCustomEvent("eventType",!1,!0,{}),!0}catch(t){}return!1}())return function(n,i){return function(t,e){var r=i.createEvent("CustomEvent");return r.initCustomEvent(t,!1,!0,{reason:e.value,key:e}),!n.dispatchEvent(r)}}(self,document)}return z}(),n=Object.create||function(t){function e(){}return e.prototype=t,new e};function l(t,e){this._handler=t===d?e:function(t){var e=new y;try{t(function(t){e.resolve(t)},r,function(t){e.notify(t)})}catch(t){r(t)}return e;function r(t){e.reject(t)}}(t)}function i(t){return I(t)?t:new l(d,new v(p(t)))}function o(t){return new l(d,new v(new w(t)))}function a(){return M}function s(n,i,o){for(var t,e="function"==typeof i?function(t,e,r){r.resolved||h(o,c,t,n(i,e,t),r)}:c,r=new y,a=o.length>>>0,s=new Array(a),u=0;u<o.length&&!r.resolved;++u)void 0!==(t=o[u])||u in o?h(o,e,u,t,r):--a;return 0===a&&r.become(new b(s)),new l(d,r);function c(t,e,r){s[t]=e,0==--a&&r.become(new b(s))}}function h(t,e,r,n,i){if(L(n)){var o=function(t){return I(t)?t._handler.join():f(t)}(n),a=o.state();0===a?o.fold(e,r,void 0,i):0<a?e(r,o.value,i):(i.become(o),u(t,r+1,o))}else e(r,n,i)}function u(t,e,r){for(var n=e;n<t.length;++n)c(p(t[n]),r)}function c(t,e){if(t!==e){var r=t.state();0===r?t.visit(t,void 0,t._unreport):r<0&&t._unreport()}}function p(t){return I(t)?t._handler.join():L(t)?f(t):new b(t)}function f(t){try{var e=t.then;return"function"==typeof e?new _(e,t):new b(t)}catch(t){return new w(t)}}function d(){}function m(){}l.resolve=i,l.reject=o,l.never=a,l._defer=function(){return new l(d,new y)},l._handler=p,l.prototype.then=function(t,e,r){var n=this._handler,i=n.join().state();if("function"!=typeof t&&0<i||"function"!=typeof e&&i<0)return new this.constructor(d,n);var o=this._beget(),a=o._handler;return n.chain(a,n.receiver,t,e,r),o},l.prototype.catch=function(t){return this.then(void 0,t)},l.prototype._beget=function(){return function(t,e){var r=new y(t.receiver,t.join().context);return new e(d,r)}(this._handler,this.constructor)},l.all=function(t){return s(j,null,t)},l.race=function(t){return"object"==typeof t&&null!==t?0===t.length?a():1===t.length?i(t[0]):function(t){var e,r,n,i=new y;for(e=0;e<t.length;++e)if(void 0!==(r=t[e])||e in t){if(0!==(n=p(r)).state()){i.become(n),u(t,e+1,n);break}n.visit(i,i.resolve,i.reject)}return new l(d,i)}(t):o(new TypeError("non-iterable passed to race()"))},l._traverse=function(t,e){return s(k,t,e)},l._visitRemaining=u,d.prototype.when=d.prototype.become=d.prototype.notify=d.prototype.fail=d.prototype._unreport=d.prototype._report=z,d.prototype._state=0,d.prototype.state=function(){return this._state},d.prototype.join=function(){for(var t=this;void 0!==t.handler;)t=t.handler;return t},d.prototype.chain=function(t,e,r,n,i){this.when({resolver:t,receiver:e,fulfilled:r,rejected:n,progress:i})},d.prototype.visit=function(t,e,r,n){this.chain(g,t,e,r,n)},d.prototype.fold=function(t,e,r,n){this.when(new A(t,e,r,n))},D(d,m),m.prototype.become=function(t){t.fail()};var g=new m;function y(t,e){l.createContext(this,e),this.consumers=void 0,this.receiver=t,this.handler=void 0,this.resolved=!1}function v(t){this.handler=t}function _(t,e){y.call(this),r.enqueue(new O(t,e,this))}function b(t){l.createContext(this),this.value=t}D(d,y),y.prototype._state=0,y.prototype.resolve=function(t){this.become(p(t))},y.prototype.reject=function(t){this.resolved||this.become(new w(t))},y.prototype.join=function(){if(!this.resolved)return this;for(var t=this;void 0!==t.handler;)if((t=t.handler)===this)return this.handler=new w(new TypeError("Promise cycle"));return t},y.prototype.run=function(){var t=this.consumers,e=this.handler;this.handler=this.handler.join(),this.consumers=void 0;for(var r=0;r<t.length;++r)e.when(t[r])},y.prototype.become=function(t){this.resolved||(this.resolved=!0,this.handler=t,void 0!==this.consumers&&r.enqueue(this),void 0!==this.context&&t._report(this.context))},y.prototype.when=function(t){this.resolved?r.enqueue(new T(t,this.handler)):void 0===this.consumers?this.consumers=[t]:this.consumers.push(t)},y.prototype.notify=function(t){this.resolved||r.enqueue(new P(t,this))},y.prototype.fail=function(t){var e=void 0===t?this.context:t;this.resolved&&this.handler.join().fail(e)},y.prototype._report=function(t){this.resolved&&this.handler.join()._report(t)},y.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},D(d,v),v.prototype.when=function(t){r.enqueue(new T(t,this))},v.prototype._report=function(t){this.join()._report(t)},v.prototype._unreport=function(){this.join()._unreport()},D(y,_),D(d,b),b.prototype._state=1,b.prototype.fold=function(t,e,r,n){!function(t,e,r,n,i){if("function"!=typeof t)return i.become(r);l.enterContext(r),function(t,e,r,n,i){try{t.call(n,e,r,i)}catch(t){i.become(new w(t))}}(t,e,r.value,n,i),l.exitContext()}(t,e,this,r,n)},b.prototype.when=function(t){R(t.fulfilled,this,t.receiver,t.resolver)};var x=0;function w(t){l.createContext(this),this.id=++x,this.value=t,this.handled=!1,this.reported=!1,this._report()}function S(t,e){this.rejection=t,this.context=e}function E(t){this.rejection=t}D(d,w),w.prototype._state=-1,w.prototype.fold=function(t,e,r,n){n.become(this)},w.prototype.when=function(t){"function"==typeof t.rejected&&this._unreport(),R(t.rejected,this,t.receiver,t.resolver)},w.prototype._report=function(t){r.afterQueue(new S(this,t))},w.prototype._unreport=function(){this.handled||(this.handled=!0,r.afterQueue(new E(this)))},w.prototype.fail=function(t){this.reported=!0,e("unhandledRejection",this),l.onFatalRejection(this,void 0===t?this.context:t)},S.prototype.run=function(){this.rejection.handled||this.rejection.reported||(this.rejection.reported=!0,e("unhandledRejection",this.rejection)||l.onPotentiallyUnhandledRejection(this.rejection,this.context))},E.prototype.run=function(){this.rejection.reported&&(e("rejectionHandled",this.rejection)||l.onPotentiallyUnhandledRejectionHandled(this.rejection))},l.createContext=l.enterContext=l.exitContext=l.onPotentiallyUnhandledRejection=l.onPotentiallyUnhandledRejectionHandled=l.onFatalRejection=z;var C=new d,M=new l(d,C);function T(t,e){this.continuation=t,this.handler=e}function P(t,e){this.handler=e,this.value=t}function O(t,e,r){this._then=t,this.thenable=e,this.resolver=r}function A(t,e,r,n){this.f=t,this.z=e,this.c=r,this.to=n,this.resolver=g,this.receiver=this}function I(t){return t instanceof l}function L(t){return("object"==typeof t||"function"==typeof t)&&null!==t}function R(t,e,r,n){if("function"!=typeof t)return n.become(e);l.enterContext(e),function(t,e,r,n){try{n.become(p(t.call(r,e)))}catch(t){n.become(new w(t))}}(t,e.value,r,n),l.exitContext()}function N(t,e,r,n,i){if("function"!=typeof t)return i.notify(e);l.enterContext(r),function(t,e,r,n){try{n.notify(t.call(r,e))}catch(t){n.notify(t)}}(t,e,n,i),l.exitContext()}function k(t,e,r){try{return t(e,r)}catch(t){return o(t)}}function D(t,e){e.prototype=n(t.prototype),e.prototype.constructor=e}function j(t,e){return e}function z(){}return T.prototype.run=function(){this.handler.join().when(this.continuation)},P.prototype.run=function(){var t=this.handler.consumers;if(void 0!==t)for(var e,r=0;r<t.length;++r)N((e=t[r]).progress,this.value,this.handler,e.receiver,e.resolver)},O.prototype.run=function(){var e=this.resolver;!function(t,e,r,n,i){try{t.call(e,r,n,i)}catch(t){n(t)}}(this._then,this.thenable,function(t){e.resolve(t)},function(t){e.reject(t)},function(t){e.notify(t)})},A.prototype.fulfilled=function(t){this.f.call(this.c,this.z,t,this.to)},A.prototype.rejected=function(t){this.to.reject(t)},A.prototype.progress=function(t){this.to.notify(t)},l}})}()}).call(this,t("_process"))},{_process:6}],287:[function(t,e,r){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){e.exports=t()})(function(){return{pending:t,fulfilled:n,rejected:r,inspect:function(t){var e=t.state();return 0===e?{state:"pending"}:0<e?n(t.value):r(t.value)}};function t(){return{state:"pending"}}function r(t){return{state:"rejected",reason:t}}function n(t){return{state:"fulfilled",value:t}}})}()},{}],288:[function(e,r,t){!function(){"use strict";(typeof n==="function"&&n.amd?n:function(t){r.exports=t(e)})(function(t){var e=t("./lib/decorators/timed"),r=t("./lib/decorators/array"),n=t("./lib/decorators/flow"),i=t("./lib/decorators/fold"),o=t("./lib/decorators/inspect"),a=t("./lib/decorators/iterate"),s=t("./lib/decorators/progress"),u=t("./lib/decorators/with"),c=t("./lib/decorators/unhandledRejection"),l=t("./lib/TimeoutError"),h=[r,n,i,a,s,o,u,e,c].reduce(function(t,e){return e(t)},t("./lib/Promise")),p=t("./lib/apply")(h);function f(t,e,r,n){var i=h.resolve(t);return arguments.length<2?i:i.then(e,r,n)}function d(n){return function(){for(var t=0,e=arguments.length,r=new Array(e);t<e;++t)r[t]=arguments[t];return p(n,this,r)}}function m(t){for(var e=0,r=arguments.length-1,n=new Array(r);e<r;++e)n[e]=arguments[e+1];return p(t,this,n)}function g(){var e=h._defer();function t(t){e._handler.resolve(t)}function r(t){e._handler.reject(t)}function n(t){e._handler.notify(t)}this.promise=e,this.resolve=t,this.reject=r,this.notify=n,this.resolver={resolve:t,reject:r,notify:n}}return f.promise=function(t){return new h(t)},f.resolve=h.resolve,f.reject=h.reject,f.lift=d,f.try=m,f.attempt=m,f.iterate=h.iterate,f.unfold=h.unfold,f.join=function(){return h.all(arguments)},f.all=function(t){return f(t,h.all)},f.settle=function(t){return f(t,h.settle)},f.any=d(h.any),f.some=d(h.some),f.race=d(h.race),f.map=function(t,e){return f(t,function(t){return h.map(t,e)})},f.filter=function(t,e){return f(t,function(t){return h.filter(t,e)})},f.reduce=d(h.reduce),f.reduceRight=d(h.reduceRight),f.isPromiseLike=function(t){return t&&"function"==typeof t.then},f.Promise=h,f.defer=function(){return new g},f.TimeoutError=l,f})}()},{"./lib/Promise":271,"./lib/TimeoutError":273,"./lib/apply":274,"./lib/decorators/array":275,"./lib/decorators/flow":276,"./lib/decorators/fold":277,"./lib/decorators/inspect":278,"./lib/decorators/iterate":279,"./lib/decorators/progress":280,"./lib/decorators/timed":281,"./lib/decorators/unhandledRejection":282,"./lib/decorators/with":283}],289:[function(t,e,r){var n=Array.isArray,i=Object.prototype.toString;e.exports=n||function(t){return"[object Array]"===i.call(t)}},{}],290:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./api/APIv3");r.APIv3=n.APIv3;var i=t("./api/ModelCreator");r.ModelCreator=i.ModelCreator},{"./api/APIv3":303,"./api/ModelCreator":304}],291:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./component/Component");r.Component=n.Component;var i=t("./component/ComponentService");r.ComponentService=i.ComponentService;var o=t("./component/utils/HandlerBase");r.HandlerBase=o.HandlerBase;var a=t("./component/utils/MeshFactory");r.MeshFactory=a.MeshFactory;var s=t("./component/utils/MeshScene");r.MeshScene=s.MeshScene;var u=t("./component/utils/MouseOperator");r.MouseOperator=u.MouseOperator;var c=t("./component/utils/ComponentSize");r.ComponentSize=c.ComponentSize;var l=t("./component/AttributionComponent");r.AttributionComponent=l.AttributionComponent;var h=t("./component/BackgroundComponent");r.BackgroundComponent=h.BackgroundComponent;var p=t("./component/BearingComponent");r.BearingComponent=p.BearingComponent;var f=t("./component/CacheComponent");r.CacheComponent=f.CacheComponent;var d=t("./component/CoverComponent");r.CoverComponent=d.CoverComponent;var m=t("./component/DebugComponent");r.DebugComponent=m.DebugComponent;var g=t("./component/direction/DirectionComponent");r.DirectionComponent=g.DirectionComponent;var y=t("./component/direction/DirectionDOMCalculator");r.DirectionDOMCalculator=y.DirectionDOMCalculator;var v=t("./component/direction/DirectionDOMRenderer");r.DirectionDOMRenderer=v.DirectionDOMRenderer;var _=t("./component/ImageComponent");r.ImageComponent=_.ImageComponent;var b=t("./component/keyboard/KeyboardComponent");r.KeyboardComponent=b.KeyboardComponent;var x=t("./component/keyboard/KeyPlayHandler");r.KeyPlayHandler=x.KeyPlayHandler;var w=t("./component/keyboard/KeyZoomHandler");r.KeyZoomHandler=w.KeyZoomHandler;var S=t("./component/keyboard/KeySequenceNavigationHandler");r.KeySequenceNavigationHandler=S.KeySequenceNavigationHandler;var E=t("./component/keyboard/KeySpatialNavigationHandler");r.KeySpatialNavigationHandler=E.KeySpatialNavigationHandler;var C=t("./component/LoadingComponent");r.LoadingComponent=C.LoadingComponent;var M=t("./component/marker/marker/Marker");r.Marker=M.Marker;var T=t("./component/marker/MarkerComponent");r.MarkerComponent=T.MarkerComponent;var P=t("./component/marker/MarkerScene");r.MarkerScene=P.MarkerScene;var O=t("./component/marker/MarkerSet");r.MarkerSet=O.MarkerSet;var A=t("./component/mouse/MouseComponent");r.MouseComponent=A.MouseComponent;var I=t("./component/mouse/BounceHandler");r.BounceHandler=I.BounceHandler;var L=t("./component/mouse/DragPanHandler");r.DragPanHandler=L.DragPanHandler;var R=t("./component/mouse/DoubleClickZoomHandler");r.DoubleClickZoomHandler=R.DoubleClickZoomHandler;var N=t("./component/mouse/EarthControlHandler");r.EarthControlHandler=N.EarthControlHandler;var k=t("./component/mouse/ScrollZoomHandler");r.ScrollZoomHandler=k.ScrollZoomHandler;var D=t("./component/mouse/TouchZoomHandler");r.TouchZoomHandler=D.TouchZoomHandler;var j=t("./component/mouse/ImageBoundary");r.ImageBoundary=j;var z=t("./component/popup/popup/Popup");r.Popup=z.Popup;var F=t("./component/popup/PopupComponent");r.PopupComponent=F.PopupComponent;var B=t("./component/NavigationComponent");r.NavigationComponent=B.NavigationComponent;var U=t("./component/RouteComponent");r.RouteComponent=U.RouteComponent;var V=t("./component/sequence/SequenceComponent");r.SequenceComponent=V.SequenceComponent;var G=t("./component/sequence/SequenceDOMRenderer");r.SequenceDOMRenderer=G.SequenceDOMRenderer;var q=t("./component/sequence/SequenceMode");r.SequenceMode=q.SequenceMode;var H=t("./component/spatialdata/SpatialDataCache");r.SpatialDataCache=H.SpatialDataCache;var $=t("./component/spatialdata/SpatialDataComponent");r.SpatialDataComponent=$.SpatialDataComponent;var W=t("./component/spatialdata/SpatialDataScene");r.SpatialDataScene=W.SpatialDataScene;var X=t("./component/imageplane/ImagePlaneComponent");r.ImagePlaneComponent=X.ImagePlaneComponent;var Y=t("./component/imageplane/ImagePlaneGLRenderer");r.ImagePlaneGLRenderer=Y.ImagePlaneGLRenderer;var Z=t("./component/shaders/Shaders");r.Shaders=Z.Shaders;var K=t("./component/marker/marker/SimpleMarker");r.SimpleMarker=K.SimpleMarker;var J=t("./component/marker/marker/CircleMarker");r.CircleMarker=J.CircleMarker;var Q=t("./component/slider/SliderComponent");r.SliderComponent=Q.SliderComponent;var tt=t("./component/slider/SliderDOMRenderer");r.SliderDOMRenderer=tt.SliderDOMRenderer;var et=t("./component/slider/SliderGLRenderer");r.SliderGLRenderer=et.SliderGLRenderer;var rt=t("./component/StatsComponent");r.StatsComponent=rt.StatsComponent;var nt=t("./component/tag/handlers/TagHandlerBase");r.TagHandlerBase=nt.TagHandlerBase;var it=t("./component/tag/handlers/CreateHandlerBase");r.CreateHandlerBase=it.CreateHandlerBase;var ot=t("./component/tag/handlers/CreatePointHandler");r.CreatePointHandler=ot.CreatePointHandler;var at=t("./component/tag/handlers/CreateVertexHandler");r.CreateVertexHandler=at.CreateVertexHandler;var st=t("./component/tag/handlers/CreatePointsHandler");r.CreatePointsHandler=st.CreatePointsHandler;var ut=t("./component/tag/handlers/CreatePolygonHandler");r.CreatePolygonHandler=ut.CreatePolygonHandler;var ct=t("./component/tag/handlers/CreateRectHandler");r.CreateRectHandler=ct.CreateRectHandler;var lt=t("./component/tag/handlers/CreateRectDragHandler");r.CreateRectDragHandler=lt.CreateRectDragHandler;var ht=t("./component/tag/handlers/EditVertexHandler");r.EditVertexHandler=ht.EditVertexHandler;var pt=t("./component/tag/tag/Tag");r.Tag=pt.Tag;var ft=t("./component/tag/tag/OutlineTag");r.OutlineTag=ft.OutlineTag;var dt=t("./component/tag/tag/ExtremePointTag");r.ExtremePointTag=dt.ExtremePointTag;var mt=t("./component/tag/tag/RenderTag");r.RenderTag=mt.RenderTag;var gt=t("./component/tag/tag/OutlineRenderTagBase");r.OutlineRenderTagBase=gt.OutlineRenderTagBase;var yt=t("./component/tag/tag/OutlineRenderTag");r.OutlineRenderTag=yt.OutlineRenderTag;var vt=t("./component/tag/tag/ExtremePointRenderTag");r.ExtremePointRenderTag=vt.ExtremePointRenderTag;var _t=t("./component/tag/tag/SpotTag");r.SpotTag=_t.SpotTag;var bt=t("./component/tag/tag/SpotRenderTag");r.SpotRenderTag=bt.SpotRenderTag;var xt=t("./component/tag/tag/TagDomain");r.TagDomain=xt.TagDomain;var wt=t("./component/tag/TagComponent");r.TagComponent=wt.TagComponent;var St=t("./component/tag/TagCreator");r.TagCreator=St.TagCreator;var Et=t("./component/tag/TagDOMRenderer");r.TagDOMRenderer=Et.TagDOMRenderer;var Ct=t("./component/tag/TagMode");r.TagMode=Ct.TagMode;var Mt=t("./component/tag/TagOperation");r.TagOperation=Mt.TagOperation;var Tt=t("./component/tag/TagScene");r.TagScene=Tt.TagScene;var Pt=t("./component/tag/TagSet");r.TagSet=Pt.TagSet;var Ot=t("./component/tag/geometry/Geometry");r.Geometry=Ot.Geometry;var At=t("./component/tag/geometry/VertexGeometry");r.VertexGeometry=At.VertexGeometry;var It=t("./component/tag/geometry/RectGeometry");r.RectGeometry=It.RectGeometry;var Lt=t("./component/tag/geometry/PointGeometry");r.PointGeometry=Lt.PointGeometry;var Rt=t("./component/tag/geometry/PointsGeometry");r.PointsGeometry=Rt.PointsGeometry;var Nt=t("./component/tag/geometry/PolygonGeometry");r.PolygonGeometry=Nt.PolygonGeometry;var kt=t("./component/tag/error/GeometryTagError");r.GeometryTagError=kt.GeometryTagError;var Dt=t("./component/zoom/ZoomComponent");r.ZoomComponent=Dt.ZoomComponent;var jt=t("./component/tag/tag/CreateTag");r.CreateTag=jt.CreateTag;var zt=t("./component/tag/tag/OutlineCreateTag");r.OutlineCreateTag=zt.OutlineCreateTag;var Ft=t("./component/tag/tag/ExtremePointCreateTag");r.ExtremePointCreateTag=Ft.ExtremePointCreateTag,function(t){for(var e in t)r.hasOwnProperty(e)||(r[e]=t[e])}(t("./component/interfaces/interfaces"))},{"./component/AttributionComponent":305,"./component/BackgroundComponent":306,"./component/BearingComponent":307,"./component/CacheComponent":308,"./component/Component":309,"./component/ComponentService":310,"./component/CoverComponent":311,"./component/DebugComponent":312,"./component/ImageComponent":313,"./component/LoadingComponent":314,"./component/NavigationComponent":315,"./component/RouteComponent":316,"./component/StatsComponent":317,"./component/direction/DirectionComponent":318,"./component/direction/DirectionDOMCalculator":319,"./component/direction/DirectionDOMRenderer":320,"./component/imageplane/ImagePlaneComponent":321,"./component/imageplane/ImagePlaneGLRenderer":322,"./component/interfaces/interfaces":325,"./component/keyboard/KeyPlayHandler":326,"./component/keyboard/KeySequenceNavigationHandler":327,"./component/keyboard/KeySpatialNavigationHandler":328,"./component/keyboard/KeyZoomHandler":329,"./component/keyboard/KeyboardComponent":330,"./component/marker/MarkerComponent":332,"./component/marker/MarkerScene":333,"./component/marker/MarkerSet":334,"./component/marker/marker/CircleMarker":335,"./component/marker/marker/Marker":336,"./component/marker/marker/SimpleMarker":337,"./component/mouse/BounceHandler":338,"./component/mouse/DoubleClickZoomHandler":339,"./component/mouse/DragPanHandler":340,"./component/mouse/EarthControlHandler":341,"./component/mouse/ImageBoundary":342,"./component/mouse/MouseComponent":343,"./component/mouse/ScrollZoomHandler":344,"./component/mouse/TouchZoomHandler":345,"./component/popup/PopupComponent":347,"./component/popup/popup/Popup":348,"./component/sequence/SequenceComponent":349,"./component/sequence/SequenceDOMRenderer":350,"./component/sequence/SequenceMode":351,"./component/shaders/Shaders":352,"./component/slider/SliderComponent":353,"./component/slider/SliderDOMRenderer":354,"./component/slider/SliderGLRenderer":355,"./component/spatialdata/SpatialDataCache":358,"./component/spatialdata/SpatialDataComponent":359,"./component/spatialdata/SpatialDataScene":360,"./component/tag/TagComponent":362,"./component/tag/TagCreator":363,"./component/tag/TagDOMRenderer":364,"./component/tag/TagMode":365,"./component/tag/TagOperation":366,"./component/tag/TagScene":367,"./component/tag/TagSet":368,"./component/tag/error/GeometryTagError":369,"./component/tag/geometry/Geometry":370,"./component/tag/geometry/PointGeometry":371,"./component/tag/geometry/PointsGeometry":372,"./component/tag/geometry/PolygonGeometry":373,"./component/tag/geometry/RectGeometry":374,"./component/tag/geometry/VertexGeometry":375,"./component/tag/handlers/CreateHandlerBase":376,"./component/tag/handlers/CreatePointHandler":377,"./component/tag/handlers/CreatePointsHandler":378,"./component/tag/handlers/CreatePolygonHandler":379,"./component/tag/handlers/CreateRectDragHandler":380,"./component/tag/handlers/CreateRectHandler":381,"./component/tag/handlers/CreateVertexHandler":382,"./component/tag/handlers/EditVertexHandler":383,"./component/tag/handlers/TagHandlerBase":384,"./component/tag/tag/CreateTag":385,"./component/tag/tag/ExtremePointCreateTag":386,"./component/tag/tag/ExtremePointRenderTag":387,"./component/tag/tag/ExtremePointTag":388,"./component/tag/tag/OutlineCreateTag":389,"./component/tag/tag/OutlineRenderTag":390,"./component/tag/tag/OutlineRenderTagBase":391,"./component/tag/tag/OutlineTag":392,"./component/tag/tag/RenderTag":393,"./component/tag/tag/SpotRenderTag":394,"./component/tag/tag/SpotTag":395,"./component/tag/tag/Tag":396,"./component/tag/tag/TagDomain":397,"./component/utils/ComponentSize":398,"./component/utils/HandlerBase":399,"./component/utils/MeshFactory":400,"./component/utils/MeshScene":401,"./component/utils/MouseOperator":402,"./component/zoom/ZoomComponent":403}],292:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./graph/edge/EdgeDirection");r.EdgeDirection=n.EdgeDirection;var i=t("./graph/edge/EdgeCalculatorSettings");r.EdgeCalculatorSettings=i.EdgeCalculatorSettings;var o=t("./graph/edge/EdgeCalculatorDirections");r.EdgeCalculatorDirections=o.EdgeCalculatorDirections;var a=t("./graph/edge/EdgeCalculatorCoefficients");r.EdgeCalculatorCoefficients=a.EdgeCalculatorCoefficients;var s=t("./graph/edge/EdgeCalculator");r.EdgeCalculator=s.EdgeCalculator},{"./graph/edge/EdgeCalculator":425,"./graph/edge/EdgeCalculatorCoefficients":426,"./graph/edge/EdgeCalculatorDirections":427,"./graph/edge/EdgeCalculatorSettings":428,"./graph/edge/EdgeDirection":429}],293:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./error/AbortMapillaryError");r.AbortMapillaryError=n.AbortMapillaryError;var i=t("./error/ArgumentMapillaryError");r.ArgumentMapillaryError=i.ArgumentMapillaryError;var o=t("./error/GraphMapillaryError");r.GraphMapillaryError=o.GraphMapillaryError;var a=t("./error/MapillaryError");r.MapillaryError=a.MapillaryError},{"./error/AbortMapillaryError":404,"./error/ArgumentMapillaryError":405,"./error/GraphMapillaryError":406,"./error/MapillaryError":407}],294:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./geo/Camera");r.Camera=n.Camera;var i=t("./geo/GeoCoords");r.GeoCoords=i.GeoCoords;var o=t("./geo/ViewportCoords");r.ViewportCoords=o.ViewportCoords;var a=t("./geo/Spatial");r.Spatial=a.Spatial;var s=t("./geo/Transform");r.Transform=s.Transform;var u=t("./geo/Geo");r.Geo=u;var c=t("./geo/Lines");r.Lines=c},{"./geo/Camera":408,"./geo/Geo":409,"./geo/GeoCoords":410,"./geo/Lines":411,"./geo/Spatial":412,"./geo/Transform":413,"./geo/ViewportCoords":414}],295:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./graph/FilterCreator");r.FilterCreator=n.FilterCreator;var i=t("./graph/Graph");r.Graph=i.Graph;var o=t("./graph/GraphCalculator");r.GraphCalculator=o.GraphCalculator;var a=t("./graph/GraphMode");r.GraphMode=a.GraphMode;var s=t("./graph/GraphService");r.GraphService=s.GraphService;var u=t("./graph/ImageLoadingService");r.ImageLoadingService=u.ImageLoadingService;var c=t("./graph/MeshReader");r.MeshReader=c.MeshReader;var l=t("./graph/Node");r.Node=l.Node;var h=t("./graph/NodeCache");r.NodeCache=h.NodeCache;var p=t("./graph/Sequence");r.Sequence=p.Sequence},{"./graph/FilterCreator":415,"./graph/Graph":416,"./graph/GraphCalculator":417,"./graph/GraphMode":418,"./graph/GraphService":419,"./graph/ImageLoadingService":420,"./graph/MeshReader":421,"./graph/Node":422,"./graph/NodeCache":423,"./graph/Sequence":424}],296:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(t){for(var e in t)r.hasOwnProperty(e)||(r[e]=t[e])}(t("./Support"));var n=t("./Edge");r.EdgeDirection=n.EdgeDirection;var i=t("./Error");r.AbortMapillaryError=i.AbortMapillaryError;var o=t("./Render");r.RenderMode=o.RenderMode;var a=t("./State");r.TransitionMode=a.TransitionMode;var s=t("./Viewer");r.Alignment=s.Alignment,r.ImageSize=s.ImageSize,r.Viewer=s.Viewer;var u=t("./Component");r.SliderMode=u.SliderMode,r.ComponentSize=u.ComponentSize;var c=t("./component/tag/Tag");r.TagComponent=c;var l=t("./component/marker/Marker");r.MarkerComponent=l;var h=t("./component/popup/Popup");r.PopupComponent=h;var p=t("./component/spatialdata/SpatialData");r.SpatialDataComponent=p},{"./Component":291,"./Edge":292,"./Error":293,"./Render":297,"./State":298,"./Support":299,"./Viewer":302,"./component/marker/Marker":331,"./component/popup/Popup":346,"./component/spatialdata/SpatialData":357,"./component/tag/Tag":361}],297:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./render/DOMRenderer");r.DOMRenderer=n.DOMRenderer;var i=t("./render/GLRenderer");r.GLRenderer=i.GLRenderer;var o=t("./render/GLRenderStage");r.GLRenderStage=o.GLRenderStage;var a=t("./render/RenderCamera");r.RenderCamera=a.RenderCamera;var s=t("./render/RenderMode");r.RenderMode=s.RenderMode;var u=t("./render/RenderService");r.RenderService=u.RenderService},{"./render/DOMRenderer":430,"./render/GLRenderStage":431,"./render/GLRenderer":432,"./render/RenderCamera":433,"./render/RenderMode":434,"./render/RenderService":435}],298:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./state/FrameGenerator");r.FrameGenerator=n.FrameGenerator;var i=t("./state/RotationDelta");r.RotationDelta=i.RotationDelta;var o=t("./state/State");r.State=o.State;var a=t("./state/states/StateBase");r.StateBase=a.StateBase;var s=t("./state/StateContext");r.StateContext=s.StateContext;var u=t("./state/StateService");r.StateService=u.StateService;var c=t("./state/TransitionMode");r.TransitionMode=c.TransitionMode;var l=t("./state/states/EarthState");r.EarthState=l.EarthState;var h=t("./state/states/InteractiveStateBase");r.InteractiveStateBase=h.InteractiveStateBase;var p=t("./state/states/InteractiveWaitingState");r.InteractiveWaitingState=p.InteractiveWaitingState;var f=t("./state/states/TraversingState");r.TraversingState=f.TraversingState;var d=t("./state/states/WaitingState");r.WaitingState=d.WaitingState},{"./state/FrameGenerator":436,"./state/RotationDelta":437,"./state/State":438,"./state/StateContext":439,"./state/StateService":440,"./state/TransitionMode":441,"./state/states/EarthState":442,"./state/states/InteractiveStateBase":443,"./state/states/InteractiveWaitingState":444,"./state/states/StateBase":445,"./state/states/TraversingState":446,"./state/states/WaitingState":447}],299:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./utils/Support");function i(){return n.isBrowser()&&n.isBlobSupported()&&n.isArraySupported()&&n.isFunctionSupported()&&n.isJSONSupported()&&n.isObjectSupported()}r.isSupported=function(){return i()&&n.isWebGLSupportedCached()},r.isFallbackSupported=i},{"./utils/Support":455}],300:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./tiles/ImageTileLoader");r.ImageTileLoader=n.ImageTileLoader;var i=t("./tiles/ImageTileStore");r.ImageTileStore=i.ImageTileStore;var o=t("./tiles/TextureProvider");r.TextureProvider=o.TextureProvider;var a=t("./tiles/RegionOfInterestCalculator");r.RegionOfInterestCalculator=a.RegionOfInterestCalculator},{"./tiles/ImageTileLoader":448,"./tiles/ImageTileStore":449,"./tiles/RegionOfInterestCalculator":450,"./tiles/TextureProvider":451}],301:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./utils/DOM");r.DOM=n.DOM;var i=t("./utils/EventEmitter");r.EventEmitter=i.EventEmitter;var o=t("./utils/Settings");r.Settings=o.Settings,function(t){for(var e in t)r.hasOwnProperty(e)||(r[e]=t[e])}(t("./utils/Support"));var a=t("./utils/Urls");r.Urls=a.Urls},{"./utils/DOM":452,"./utils/EventEmitter":453,"./utils/Settings":454,"./utils/Support":455,"./utils/Urls":456}],302:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./viewer/Alignment");r.Alignment=n.Alignment;var i=t("./viewer/CacheService");r.CacheService=i.CacheService;var o=t("./viewer/ComponentController");r.ComponentController=o.ComponentController;var a=t("./viewer/Container");r.Container=a.Container;var s=t("./viewer/Observer");r.Observer=s.Observer;var u=t("./viewer/ImageSize");r.ImageSize=u.ImageSize;var c=t("./viewer/KeyboardService");r.KeyboardService=c.KeyboardService;var l=t("./viewer/LoadingService");r.LoadingService=l.LoadingService;var h=t("./viewer/MouseService");r.MouseService=h.MouseService;var p=t("./viewer/Navigator");r.Navigator=p.Navigator;var f=t("./viewer/PlayService");r.PlayService=f.PlayService;var d=t("./viewer/Projection");r.Projection=d.Projection;var m=t("./viewer/SpriteService");r.SpriteService=m.SpriteService;var g=t("./viewer/TouchService");r.TouchService=g.TouchService;var y=t("./viewer/Viewer");r.Viewer=y.Viewer},{"./viewer/Alignment":457,"./viewer/CacheService":458,"./viewer/ComponentController":459,"./viewer/Container":460,"./viewer/ImageSize":461,"./viewer/KeyboardService":462,"./viewer/LoadingService":463,"./viewer/MouseService":464,"./viewer/Navigator":465,"./viewer/Observer":466,"./viewer/PlayService":468,"./viewer/Projection":469,"./viewer/SpriteService":470,"./viewer/TouchService":471,"./viewer/Viewer":472}],303:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t("rxjs/operators"),n=t("rxjs"),i=t("../API"),o=(a.prototype.imageByKeyFill$=function(e){return this._catchInvalidateGet$(this._wrapModelResponse$(this._model.get([this._pathImageByKey,e,this._propertiesKey.concat(this._propertiesFill).concat(this._propertiesSpatial),this._propertiesKey.concat(this._propertiesUser)])).pipe(s.map(function(t){if(!t)throw new Error("Images ("+e.join(", ")+") could not be found.");return t.json.imageByKey})),this._pathImageByKey,e)},a.prototype.imageByKeyFull$=function(e){return this._catchInvalidateGet$(this._wrapModelResponse$(this._model.get([this._pathImageByKey,e,this._propertiesKey.concat(this._propertiesCore).concat(this._propertiesFill).concat(this._propertiesSpatial),this._propertiesKey.concat(this._propertiesUser)])).pipe(s.map(function(t){if(!t)throw new Error("Images ("+e.join(", ")+") could not be found.");return t.json.imageByKey})),this._pathImageByKey,e)},a.prototype.imageCloseTo$=function(t,e){var r=e+":"+t;return this._catchInvalidateGet$(this._wrapModelResponse$(this._model.get([this._pathImageCloseTo,[r],this._propertiesKey.concat(this._propertiesCore).concat(this._propertiesFill).concat(this._propertiesSpatial),this._propertiesKey.concat(this._propertiesUser)])).pipe(s.map(function(t){return null!=t?t.json.imageCloseTo[r]:null})),this._pathImageCloseTo,[r])},a.prototype.imagesByH$=function(o){var a=this;return this._catchInvalidateGet$(this._wrapModelResponse$(this._model.get([this._pathImagesByH,o,{from:0,to:this._pageCount},this._propertiesKey.concat(this._propertiesCore)])).pipe(s.map(function(t){if(!t){t={json:{imagesByH:{}}};for(var e=0,r=o;e<r.length;e++){var n=r[e];t.json.imagesByH[n]={};for(var i=0;i<=a._pageCount;i++)t.json.imagesByH[n][i]=null}}return t.json.imagesByH})),this._pathImagesByH,o)},a.prototype.imageViewAdd$=function(t){return this._catchInvalidateCall$(this._wrapCallModelResponse$(this._model.call([this._pathImageViewAdd],[t])),this._pathImageViewAdd,t)},a.prototype.invalidateImageByKey=function(t){this._invalidateGet(this._pathImageByKey,t)},a.prototype.invalidateImagesByH=function(t){this._invalidateGet(this._pathImagesByH,t)},a.prototype.invalidateSequenceByKey=function(t){this._invalidateGet(this._pathSequenceByKey,t)},a.prototype.setToken=function(t){this._model.invalidate([]),this._model=null,this._model=this._modelCreator.createModel(this._clientId,t)},a.prototype.sequenceByKey$=function(i){return this._catchInvalidateGet$(this._wrapModelResponse$(this._model.get([this._pathSequenceByKey,i,this._propertiesKey.concat(this._propertiesSequence)])).pipe(s.map(function(t){t=t||{json:{sequenceByKey:{}}};for(var e=0,r=i;e<r.length;e++){var n=r[e];n in t.json.sequenceByKey||(console.warn("Sequence data missing ("+n+")"),t.json.sequenceByKey[n]={key:n,keys:[]})}return t.json.sequenceByKey})),this._pathSequenceByKey,i)},a.prototype.sequenceViewAdd$=function(t){return this._catchInvalidateCall$(this._wrapCallModelResponse$(this._model.call([this._pathSequenceViewAdd],[t])),this._pathSequenceViewAdd,t)},Object.defineProperty(a.prototype,"clientId",{get:function(){return this._clientId},enumerable:!0,configurable:!0}),a.prototype._catchInvalidateGet$=function(t,e,r){var n=this;return t.pipe(s.catchError(function(t){throw n._invalidateGet(e,r),t}))},a.prototype._catchInvalidateCall$=function(t,e,r){var n=this;return t.pipe(s.catchError(function(t){throw n._invalidateCall(e,r),t}))},a.prototype._invalidateGet=function(t,e){this._model.invalidate([t,e])},a.prototype._invalidateCall=function(t,e){this._model.invalidate([t],[e])},a.prototype._wrapModelResponse$=function(t){return n.Observable.create(function(e){t.then(function(t){e.next(t),e.complete()},function(t){e.error(t)})})},a.prototype._wrapCallModelResponse$=function(t){return this._wrapModelResponse$(t).pipe(s.map(function(t){}))},a);function a(t,e,r){this._clientId=t,this._modelCreator=null!=r?r:new i.ModelCreator,this._model=this._modelCreator.createModel(t,e),this._pageCount=999,this._pathImageByKey="imageByKey",this._pathImageCloseTo="imageCloseTo",this._pathImagesByH="imagesByH",this._pathImageViewAdd="imageViewAdd",this._pathSequenceByKey="sequenceByKey",this._pathSequenceViewAdd="sequenceViewAdd",this._propertiesCore=["cl","l","sequence_key"],this._propertiesFill=["captured_at","captured_with_camera_uuid","user","organization_key","private","project"],this._propertiesKey=["key"],this._propertiesSequence=["keys"],this._propertiesSpatial=["atomic_scale","cluster_key","c_rotation","ca","calt","camera_projection_type","cca","cfocal","ck1","ck2","gpano","height","merge_cc","merge_version","orientation","width"],this._propertiesUser=["username"]}r.APIv3=o,r.default=o},{"../API":290,rxjs:43,"rxjs/operators":241}],304:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("falcor"),i=t("falcor-http-datasource"),o=t("../Utils"),a=(s.prototype.createModel=function(t,e){var r={crossDomain:!0,withCredentials:!1};return null!=e&&(r.headers={Authorization:"Bearer "+e}),new n.Model({maxSize:16777216,source:new i.default(o.Urls.falcorModel(t),r)})},s);function s(){}r.ModelCreator=a,r.default=a},{"../Utils":301,falcor:15,"falcor-http-datasource":10}],305:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs"),s=t("rxjs/operators"),d=t("virtual-dom"),u=t("../Component"),m=t("../Utils"),c=(o=u.Component,i(l,o),l.prototype._activate=function(){var n=this;this._disposable=a.combineLatest(this._navigator.stateService.currentNode$,this._container.renderService.size$).pipe(s.map(function(t){var e=t[0],r=t[1];return{name:n._name,vnode:n._getAttributionNode(e.username,e.key,e.capturedAt,r.width)}})).subscribe(this._container.domRenderer.render$)},l.prototype._deactivate=function(){this._disposable.unsubscribe()},l.prototype._getDefaultConfiguration=function(){return{}},l.prototype._getAttributionNode=function(t,e,r,n){var i=n<=640,o=d.h("div.AttributionMapillaryLogo",[]),a=d.h("a.AttributionIconContainer",{href:m.Urls.explore,target:"_blank"},[o]),s=i?""+t:"image by "+t,u=d.h("div.AttributionUsername",{textContent:s},[]),c=new Date(r).toDateString().split(" "),l=(3<c.length?i?[c[3]]:[c[1],c[2]+",",c[3]]:c).join(" "),h=d.h("div.AttributionDate",{textContent:l},[]),p=d.h("a.AttributionImageContainer",{href:m.Urls.exporeImage(e),target:"_blank"},[u,h]),f=i?".AttributionCompact":"";return d.h("div.AttributionContainer"+f,{},[a,p])},l.componentName="attribution",l);function l(t,e,r){return o.call(this,t,e,r)||this}r.AttributionComponent=c,u.ComponentService.register(c),r.default=c},{"../Component":291,"../Utils":301,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],306:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("virtual-dom"),s=t("../Component"),u=(o=s.Component,i(c,o),c.prototype._activate=function(){this._container.domRenderer.render$.next({name:this._name,vnode:this._getBackgroundNode("The viewer can't display the given image.")})},c.prototype._deactivate=function(){},c.prototype._getDefaultConfiguration=function(){return{}},c.prototype._getBackgroundNode=function(t){return a.h("div.BackgroundWrapper",{},[a.h("p",{textContent:t},[])])},c.componentName="background",c);function c(t,e,r){return o.call(this,t,e,r)||this}r.BackgroundComponent=u,s.ComponentService.register(u),r.default=u},{"../Component":291,"virtual-dom":247}],307:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs/operators"),m=t("virtual-dom"),s=t("@mapbox/unitbezier"),u=t("rxjs"),c=t("../Component"),l=t("../Geo"),h=t("../geo/ViewportCoords"),y=t("./utils/ComponentSize"),p=(o=c.Component,i(f,o),f.prototype._activate=function(){var g=this,t=this._container.renderService.renderCamera$.pipe(a.map(function(t){var e=g._spatial.degToRad(t.perspective.fov),r=t.perspective.aspect===Number.POSITIVE_INFINITY?Math.PI:2*Math.atan(t.perspective.aspect*Math.tan(.5*e));return[g._spatial.azimuthalToBearing(t.rotation.phi),r]}),a.distinctUntilChanged(function(t,e){return Math.abs(e[0]-t[0])<g._distinctThreshold&&Math.abs(e[1]-t[1])<g._distinctThreshold})),e=u.combineLatest(this._navigator.stateService.currentState$.pipe(a.distinctUntilChanged(void 0,function(t){return t.state.currentNode.key})),this._navigator.panService.panNodes$).pipe(a.map(function(t){var e=t[0],r=t[1],n=e.state.currentNode,i=e.state.currentTransform;if(n.pano){var o=2*Math.PI*n.gpano.CroppedAreaImageWidthPixels/n.gpano.FullPanoWidthPixels;return[o/2,o/2]}for(var a=g._computeProjectedPoints(i),s=g._spatial.degToRad(g._computeHorizontalFov(a)),u=s/2,c=s/2,l=0,h=r;l<h.length;l++){var p=h[l],f=p[0],d=p[2],m=g._spatial.wrap(f.ca-n.ca,-180,180);m<0?u=g._spatial.degToRad(Math.abs(m))+d/2:c=g._spatial.degToRad(Math.abs(m))+d/2}return[u,c]}),a.distinctUntilChanged(function(t,e){var r=t[0],n=t[1],i=e[0],o=e[1];return Math.abs(i-r)<g._distinctThreshold&&Math.abs(o-n)<g._distinctThreshold})),r=u.combineLatest(this._navigator.stateService.currentState$.pipe(a.distinctUntilChanged(void 0,function(t){return t.state.currentNode.key})),this._container.renderService.bearing$).pipe(a.map(function(t){var e=t[0],r=t[1];return g._spatial.degToRad(e.state.currentNode.ca-r)})),n=new u.Subject,i=n.pipe(a.scan(function(t,e){return e(t)},{alpha:0,curr:[0,0,0],prev:[0,0,0]}),a.map(function(t){var e=g._unitBezier.solve(t.alpha),r=t.curr,n=t.prev;return[g._interpolate(n[0],r[0],e),g._interpolate(n[1],r[1],e)]}));this._fovSubscription=e.pipe(a.map(function(o){return function(t){var e=g._unitBezier.solve(t.alpha),r=t.curr,n=t.prev,i=[g._interpolate(n[0],r[0],e),g._interpolate(n[1],r[1],e)];return{alpha:0,curr:o.slice(),prev:i}}})).subscribe(n),this._fovAnimationSubscription=e.pipe(a.switchMap(function(){return g._container.renderService.renderCameraFrame$.pipe(a.skip(1),a.scan(function(t){return t+g._animationSpeed},0),a.takeWhile(function(t){return t<=1+g._animationSpeed}),a.map(function(t){return Math.min(t,1)}))}),a.map(function(e){return function(t){return{alpha:e,curr:t.curr.slice(),prev:t.prev.slice()}}})).subscribe(n);var o=u.combineLatest(r,i).pipe(a.map(function(t){var e=t[0],r=t[1];return[e,r[0],r[1]]}));this._renderSubscription=u.combineLatest(t,o,this._configuration$,this._container.renderService.size$).pipe(a.map(function(t){var e=t[0],r=e[0],n=e[1],i=t[1],o=i[0],a=i[1],s=i[2],u=t[2],c=t[3],l=g._createBackground(r),h=g._createFovIndicator(a,s,o),p=g._createNorth(r),f=g._createCircleSectorCompass(g._createCircleSector(Math.max(Math.PI/20,n),"#FFF")),d=u.size===y.default.Small||u.size===y.default.Automatic&&c.width<640?".BearingCompact":"";return{name:g._name,vnode:m.h("div.BearingIndicatorContainer"+d,{oncontextmenu:function(t){t.preventDefault()}},[l,h,p,f])}})).subscribe(this._container.domRenderer.render$)},f.prototype._deactivate=function(){this._renderSubscription.unsubscribe(),this._fovSubscription.unsubscribe(),this._fovAnimationSubscription.unsubscribe()},f.prototype._getDefaultConfiguration=function(){return{size:y.default.Automatic}},f.prototype._createFovIndicator=function(t,e,r){var n=this._createFovArc(t,e),i=m.h("g",{attributes:{transform:"translate(18,18)"},namespace:this._svgNamespace},[n]);return m.h("svg",{attributes:{viewBox:"0 0 36 36"},namespace:this._svgNamespace,style:{height:"36px",left:"2px",position:"absolute",top:"2px",transform:"rotateZ("+this._spatial.radToDeg(r)+"deg)",width:"36px"}},[i])},f.prototype._createFovArc=function(t,e){var r=16.75,n=t+e;if(n>2*Math.PI-Math.PI/90)return m.h("circle",{attributes:{cx:"0",cy:"0","fill-opacity":"0",r:""+r,stroke:"#FFF","stroke-width":"2.5"},namespace:this._svgNamespace},[]);var i=-Math.PI/2-t,o=i+n,a=r*Math.cos(i),s=r*Math.sin(i),u=r*Math.cos(o),c=r*Math.sin(o),l="M "+a+" "+s+" A "+r+" "+r+" 0 "+(n>=Math.PI?1:0)+" 1 "+u+" "+c;return m.h("path",{attributes:{d:l,"fill-opacity":"0",stroke:"#FFF","stroke-width":"2.5"},namespace:this._svgNamespace},[])},f.prototype._createCircleSectorCompass=function(t){var e=m.h("g",{attributes:{transform:"translate(1,1)"},namespace:this._svgNamespace},[t]);return m.h("svg",{attributes:{viewBox:"0 0 2 2"},namespace:this._svgNamespace,style:{height:"26px",left:"7px",position:"absolute",top:"7px",width:"26px"}},[e])},f.prototype._createCircleSector=function(t,e){if(t>2*Math.PI-Math.PI/90)return m.h("circle",{attributes:{cx:"0",cy:"0",fill:e,r:"1"},namespace:this._svgNamespace},[]);var r=-Math.PI/2-t/2,n=r+t,i=Math.cos(r),o=Math.sin(r),a=Math.cos(n),s=Math.sin(n),u="M 0 0 "+i+" "+o+" A 1 1 0 "+(t>=Math.PI?1:0)+" 1 "+a+" "+s;return m.h("path",{attributes:{d:u,fill:e},namespace:this._svgNamespace},[])},f.prototype._createNorth=function(t){var e=m.h("div.BearingNorth",[]);return m.h("div.BearingNorthContainer",{style:{transform:"rotateZ("+this._spatial.radToDeg(-t)+"deg)"}},[e])},f.prototype._createBackground=function(t){return m.h("div.BearingIndicatorBackground",{style:{transform:"rotateZ("+this._spatial.radToDeg(-t)+"deg)"}},[m.h("div.BearingIndicatorBackgroundCircle",[]),m.h("div.BearingIndicatorBackgroundArrowContainer",[m.h("div.BearingIndicatorBackgroundArrow",[])])])},f.prototype._computeProjectedPoints=function(t){return l.Geo.computeProjectedPoints(t,[[1,0]],[[0,.5]],12,this._viewportCoords)},f.prototype._computeHorizontalFov=function(t){var e=this,r=t.map(function(t){return e._coordToFov(t[0])});return Math.min.apply(Math,r)},f.prototype._coordToFov=function(t){return this._spatial.radToDeg(2*Math.atan(t))},f.prototype._interpolate=function(t,e,r){return(1-r)*t+r*e},f.componentName="bearing",f);function f(t,e,r){var n=o.call(this,t,e,r)||this;return n._spatial=new l.Spatial,n._viewportCoords=new h.default,n._svgNamespace="http://www.w3.org/2000/svg",n._distinctThreshold=Math.PI/360,n._animationSpeed=.075,n._unitBezier=new s(.74,.67,.38,.96),n}r.BearingComponent=p,c.ComponentService.register(p),r.default=p},{"../Component":291,"../Geo":294,"../geo/ViewportCoords":414,"./utils/ComponentSize":398,"@mapbox/unitbezier":2,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],308:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,_=t("rxjs"),b=t("rxjs/operators"),x=t("../Edge"),a=t("../Component"),s=(o=a.Component,i(u,o),u.prototype.setDepth=function(t){this.configure({depth:t})},u.prototype._activate=function(){var v=this;this._sequenceSubscription=_.combineLatest(this._navigator.stateService.currentNode$.pipe(b.switchMap(function(t){return t.sequenceEdges$}),b.filter(function(t){return t.cached})),this._configuration$).pipe(b.switchMap(function(t){var e=t[0],r=t[1],n=Math.max(0,Math.min(4,r.depth.sequence)),i=v._cache$(e.edges,x.EdgeDirection.Next,n),o=v._cache$(e.edges,x.EdgeDirection.Prev,n);return _.merge(i,o).pipe(b.catchError(function(t,e){return console.error("Failed to cache sequence edges.",t),_.empty()}))})).subscribe(function(){}),this._spatialSubscription=_.combineLatest(this._navigator.stateService.currentNode$.pipe(b.switchMap(function(t){return _.combineLatest(_.of(t),t.spatialEdges$.pipe(b.filter(function(t){return t.cached})))})),this._configuration$).pipe(b.switchMap(function(t){var e=t[0],r=e[0],n=e[1],i=t[1],o=n.edges,a=i.depth,s=Math.max(0,Math.min(2,a.pano)),u=r.pano?0:Math.max(0,Math.min(3,a.step)),c=r.pano?0:Math.max(0,Math.min(1,a.turn)),l=v._cache$(o,x.EdgeDirection.Pano,s),h=v._cache$(o,x.EdgeDirection.StepForward,u),p=v._cache$(o,x.EdgeDirection.StepBackward,u),f=v._cache$(o,x.EdgeDirection.StepLeft,u),d=v._cache$(o,x.EdgeDirection.StepRight,u),m=v._cache$(o,x.EdgeDirection.TurnLeft,c),g=v._cache$(o,x.EdgeDirection.TurnRight,c),y=v._cache$(o,x.EdgeDirection.TurnU,c);return _.merge(h,p,f,d,l,m,g,y).pipe(b.catchError(function(t,e){return console.error("Failed to cache spatial edges.",t),_.empty()}))})).subscribe(function(){})},u.prototype._deactivate=function(){this._sequenceSubscription.unsubscribe(),this._spatialSubscription.unsubscribe()},u.prototype._getDefaultConfiguration=function(){return{depth:{pano:1,sequence:2,step:1,turn:0}}},u.prototype._cache$=function(t,s,e){var u=this;return _.zip(_.of(t),_.of(e)).pipe(b.expand(function(t){var e=t[0],r=t[1],n=[];if(0<r)for(var i=0,o=e;i<o.length;i++){var a=o[i];a.data.direction===s&&n.push(_.zip(u._navigator.graphService.cacheNode$(a.to).pipe(b.mergeMap(function(t){return u._nodeToEdges$(t,s)})),_.of(r-1)))}return _.from(n).pipe(b.mergeAll())}),b.skip(1))},u.prototype._nodeToEdges$=function(t,e){return(-1<[x.EdgeDirection.Next,x.EdgeDirection.Prev].indexOf(e)?t.sequenceEdges$:t.spatialEdges$).pipe(b.first(function(t){return t.cached}),b.map(function(t){return t.edges}))},u.componentName="cache",u);function u(t,e,r){return o.call(this,t,e,r)||this}r.CacheComponent=s,a.ComponentService.register(s),r.default=s},{"../Component":291,"../Edge":292,rxjs:43,"rxjs/operators":241}],309:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs/operators"),s=t("rxjs"),u=t("../Utils"),c=(o=u.EventEmitter,i(l,o),Object.defineProperty(l.prototype,"activated",{get:function(){return this._activated},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"activated$",{get:function(){return this._activated$},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"defaultConfiguration",{get:function(){return this._getDefaultConfiguration()},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"configuration$",{get:function(){return this._configuration$},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),l.prototype.activate=function(t){this._activated||(void 0!==t&&this._configurationSubject$.next(t),this._activated=!0,this._activate(),this._activated$.next(!0))},l.prototype.configure=function(t){this._configurationSubject$.next(t)},l.prototype.deactivate=function(){this._activated&&(this._activated=!1,this._deactivate(),this._container.domRenderer.clear(this._name),this._container.glRenderer.clear(this._name),this._activated$.next(!1))},l.prototype.resize=function(){},l.componentName="not_worthy",l);function l(t,e,r){var n=o.call(this)||this;return n._activated$=new s.BehaviorSubject(!1),n._configurationSubject$=new s.Subject,n._activated=!1,n._container=e,n._name=t,n._navigator=r,n._configuration$=n._configurationSubject$.pipe(a.startWith(n.defaultConfiguration),a.scan(function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}),a.publishReplay(1),a.refCount()),n._configuration$.subscribe(function(){}),n}r.Component=c,r.default=c},{"../Utils":301,rxjs:43,"rxjs/operators":241}],310:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Error"),i=(o.register=function(t){void 0===o.registeredComponents[t.componentName]&&(o.registeredComponents[t.componentName]=t)},o.registerCover=function(t){o.registeredCoverComponent=t},Object.defineProperty(o.prototype,"coverActivated",{get:function(){return this._coverActivated},enumerable:!0,configurable:!0}),o.prototype.activateCover=function(){if(!this._coverActivated)for(var t in this._coverActivated=!0,this._components)if(this._components.hasOwnProperty(t)){var e=this._components[t];e.active&&e.component.deactivate()}},o.prototype.deactivateCover=function(){if(this._coverActivated)for(var t in this._coverActivated=!1,this._components)if(this._components.hasOwnProperty(t)){var e=this._components[t];e.active&&e.component.activate()}},o.prototype.activate=function(t){this._checkName(t),this._components[t].active=!0,this._coverActivated||this.get(t).activate()},o.prototype.configure=function(t,e){this._checkName(t),this.get(t).configure(e)},o.prototype.deactivate=function(t){this._checkName(t),this._components[t].active=!1,this._coverActivated||this.get(t).deactivate()},o.prototype.get=function(t){return this._components[t].component},o.prototype.getCover=function(){return this._coverComponent},o.prototype._checkName=function(t){if(!(t in this._components))throw new n.ArgumentMapillaryError("Component does not exist: "+t)},o.registeredComponents={},o);function o(t,e){for(var r in this._components={},o.registeredComponents)if(o.registeredComponents.hasOwnProperty(r)){var n=o.registeredComponents[r];this._components[r]={active:!1,component:new n(r,t,e)}}this._coverComponent=new o.registeredCoverComponent("cover",t,e),this._coverComponent.activate(),this._coverActivated=!0}r.ComponentService=i,r.default=i},{"../Error":293}],311:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,s=t("rxjs"),u=t("rxjs/operators"),c=t("virtual-dom"),l=t("../Component"),a=t("../Utils"),h=t("../Viewer"),p=(o=l.Component,i(f,o),f.prototype._activate=function(){var a=this;this._configuration$.pipe(u.distinctUntilChanged(void 0,function(t){return t.state}),u.switchMap(function(t){return s.combineLatest(s.of(t.state),a._navigator.stateService.currentNode$)}),u.switchMap(function(t){var e=t[0],r=t[1],n=s.combineLatest(s.of(r.key),r.image$.pipe(u.filter(function(t){return!!t}),u.map(function(t){return t.src})));return e===l.CoverState.Visible?n.pipe(u.first()):n}),u.distinctUntilChanged(function(t,e){var r=t[0],n=t[1],i=e[0],o=e[1];return r===i&&n===o}),u.map(function(t){return{key:t[0],src:t[1]}})).subscribe(this._configurationSubject$),this._renderSubscription=s.combineLatest(this._configuration$,this._container.renderService.size$).pipe(u.map(function(t){var e=t[0],r=t[1];if(!e.key)return{name:a._name,vnode:c.h("div",[])};var n=r.width<=640||r.height<=480?".CoverCompact":"";if(e.state===l.CoverState.Hidden){var i=c.h("div.CoverContainer.CoverDone"+n,[a._getCoverBackgroundVNode(e)]);return{name:a._name,vnode:i}}var o=c.h("div.CoverContainer"+n,[a._getCoverButtonVNode(e)]);return{name:a._name,vnode:o}})).subscribe(this._container.domRenderer.render$)},f.prototype._deactivate=function(){this._renderSubscription.unsubscribe(),this._keySubscription.unsubscribe()},f.prototype._getDefaultConfiguration=function(){return{state:l.CoverState.Visible}},f.prototype._getCoverButtonVNode=function(t){var e=this,r=t.state===l.CoverState.Loading?"div.Cover.CoverLoading":"div.Cover",n=c.h("div.CoverButton",[c.h("div.CoverButtonIcon",[])]),i=c.h("a.CoverLogo",{href:a.Urls.explore,target:"_blank"},[]),o=c.h("div.CoverIndicator",{onclick:function(){e.configure({state:l.CoverState.Loading})}},[]);return c.h(r,[this._getCoverBackgroundVNode(t),o,n,i])},f.prototype._getCoverBackgroundVNode=function(t){var e={style:{backgroundImage:"url("+(null!=t.src?t.src:a.Urls.thumbnail(t.key,h.ImageSize.Size640))+")"}},r=[];return t.state===l.CoverState.Loading&&r.push(c.h("div.Spinner",{},[])),c.h("div.CoverBackground",e,r)},f.componentName="cover",f);function f(t,e,r){return o.call(this,t,e,r)||this}r.CoverComponent=p,l.ComponentService.registerCover(p),r.default=p},{"../Component":291,"../Utils":301,"../Viewer":302,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],312:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs"),s=t("rxjs/operators"),u=t("virtual-dom"),c=t("../Component"),l=(o=c.Component,i(h,o),h.prototype._activate=function(){var i=this;this._disposable=a.combineLatest(this._navigator.stateService.currentState$,this._open$,this._navigator.imageLoadingService.loadstatus$).pipe(s.map(function(t){var e=t[0],r=t[1],n=t[2];return{name:i._name,vnode:i._getDebugVNode(r,i._getDebugInfo(e,n))}})).subscribe(this._container.domRenderer.render$)},h.prototype._deactivate=function(){this._disposable.unsubscribe()},h.prototype._getDefaultConfiguration=function(){return{}},h.prototype._getDebugInfo=function(t,e){var r=[];r.push(u.h("h2","Node")),t.state.currentNode&&r.push(u.h("p","currentNode: "+t.state.currentNode.key)),t.state.previousNode&&r.push(u.h("p","previousNode: "+t.state.previousNode.key)),r.push(u.h("h2","Loading"));var n=0,i=0,o=0;for(var a in e)if(e.hasOwnProperty(a)){var s=e[a];n+=s.loaded,s.loaded!==s.total?o++:i++}return r.push(u.h("p","Loaded Images: "+i)),r.push(u.h("p","Loading Images: "+o)),r.push(u.h("p","Total bytes loaded: "+n)),r.push(u.h("h2","Camera")),r.push(u.h("p","camera.position.x: "+t.state.camera.position.x)),r.push(u.h("p","camera.position.y: "+t.state.camera.position.y)),r.push(u.h("p","camera.position.z: "+t.state.camera.position.z)),r.push(u.h("p","camera.lookat.x: "+t.state.camera.lookat.x)),r.push(u.h("p","camera.lookat.y: "+t.state.camera.lookat.y)),r.push(u.h("p","camera.lookat.z: "+t.state.camera.lookat.z)),r.push(u.h("p","camera.up.x: "+t.state.camera.up.x)),r.push(u.h("p","camera.up.y: "+t.state.camera.up.y)),r.push(u.h("p","camera.up.z: "+t.state.camera.up.z)),r},h.prototype._getDebugVNode=function(t,e){return t?u.h("div.Debug",{},[u.h("h2",{},["Debug"]),this._getDebugVNodeButton(t),u.h("pre",{},e)]):this._getDebugVNodeButton(t)},h.prototype._getDebugVNodeButton=function(t){var e=t?"Disable Debug":"D",r=t?"":".DebugButtonFixed";return t?u.h("button.DebugButton"+r,{onclick:this._closeDebugElement.bind(this)},[e]):u.h("button.DebugButton"+r,{onclick:this._openDebugElement.bind(this)},[e])},h.prototype._closeDebugElement=function(t){this._open$.next(!1)},h.prototype._openDebugElement=function(){this._open$.next(!0)},h.componentName="debug",h);function h(){var t=null!==o&&o.apply(this,arguments)||this;return t._open$=new a.BehaviorSubject(!1),t}r.DebugComponent=l,c.ComponentService.register(l),r.default=l},{"../Component":291,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],313:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs"),s=t("rxjs/operators"),u=t("virtual-dom"),c=t("../Component"),l=t("../Utils"),h=(o=c.Component,i(p,o),p.prototype._activate=function(){var e=this,t=this._container.domRenderer.element$.pipe(s.map(function(t){return e._dom.document.getElementById(e._canvasId)}),s.filter(function(t){return!!t}),s.map(function(t){var e=t.parentElement,r=e.offsetWidth;return[t,{height:e.offsetHeight,width:r}]}),s.distinctUntilChanged(function(t,e){return t.height===e.height&&t.width===e.width},function(t){return t[0],t[1]}));this.drawSubscription=a.combineLatest(t,this._navigator.stateService.currentNode$).subscribe(function(t){var e=t[0],r=e[0],n=e[1],i=t[1];r.width=n.width,r.height=n.height,r.getContext("2d").drawImage(i.image,0,0,n.width,n.height)}),this._container.domRenderer.renderAdaptive$.next({name:this._name,vnode:u.h("canvas#"+this._canvasId,[])})},p.prototype._deactivate=function(){this.drawSubscription.unsubscribe()},p.prototype._getDefaultConfiguration=function(){return{}},p.componentName="image",p);function p(t,e,r,n){var i=o.call(this,t,e,r)||this;return i._canvasId=e.id+"-"+i._name,i._dom=n||new l.DOM,i}r.ImageComponent=h,c.ComponentService.register(h),r.default=h},{"../Component":291,"../Utils":301,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],314:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,s=t("rxjs"),u=t("rxjs/operators"),a=t("virtual-dom"),c=t("../Component"),l=(o=c.Component,i(h,o),h.prototype._activate=function(){var a=this;this._loadingSubscription=this._navigator.loadingService.loading$.pipe(u.switchMap(function(t){return t?a._navigator.imageLoadingService.loadstatus$:s.of({})}),u.map(function(t){var e=0,r=0;for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];i.loaded!==i.total&&(r+=i.loaded,e+=i.total)}var o=100;return 0!==e&&(o=r/e*100),{name:a._name,vnode:a._getBarVNode(o)}})).subscribe(this._container.domRenderer.render$)},h.prototype._deactivate=function(){this._loadingSubscription.unsubscribe()},h.prototype._getDefaultConfiguration=function(){return{}},h.prototype._getBarVNode=function(t){var e={};return 100!==t?(e.width=t.toFixed(0)+"%",e.opacity="1"):(e.width="100%",e.opacity="0"),a.h("div.Loading",{style:{}},[a.h("div.LoadingBar",{style:e},[])])},h.componentName="loading",h);function h(t,e,r){return o.call(this,t,e,r)||this}r.LoadingComponent=l,c.ComponentService.register(l),r.default=l},{"../Component":291,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],315:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs"),s=t("rxjs/operators"),c=t("virtual-dom"),u=t("../Edge"),l=t("../Error"),h=t("../Component"),p=(o=h.Component,i(f,o),f.prototype._activate=function(){var u=this;this._renderSubscription=a.combineLatest(this._navigator.stateService.currentNode$,this._configuration$).pipe(s.switchMap(function(t){var e=t[0],r=t[1],n=r.sequence?e.sequenceEdges$.pipe(s.map(function(t){return t.edges.map(function(t){return t.data.direction})})):a.of([]),i=!e.pano&&r.spatial?e.spatialEdges$.pipe(s.map(function(t){return t.edges.map(function(t){return t.data.direction})})):a.of([]);return a.combineLatest(n,i).pipe(s.map(function(t){var e=t[0],r=t[1];return e.concat(r)}))}),s.map(function(t){var e=u._createArrowRow(u._seqNames,t),r=u._createArrowRow(u._spaTopNames,t),n=u._createArrowRow(u._spaBottomNames,t),i=c.h("div.NavigationSequence",e),o=c.h("div.NavigationSpatialTop",r),a=c.h("div.NavigationSpatialBottom",n),s=c.h("div.NavigationSpatial",[o,a]);return{name:u._name,vnode:c.h("div.NavigationContainer",[i,s])}})).subscribe(this._container.domRenderer.render$)},f.prototype._deactivate=function(){this._renderSubscription.unsubscribe()},f.prototype._getDefaultConfiguration=function(){return{sequence:!0,spatial:!0}},f.prototype._createArrowRow=function(t,e){var r=[];for(var n in t)if(t.hasOwnProperty(n)){var i=u.EdgeDirection[n];-1!==e.indexOf(i)?r.push(this._createVNode(i,t[n],"visible")):r.push(this._createVNode(i,t[n],"hidden"))}return r},f.prototype._createVNode=function(e,t,r){var n=this;return c.h("span.Direction.Direction"+t,{onclick:function(t){n._navigator.moveDir$(e).subscribe(void 0,function(t){t instanceof l.AbortMapillaryError||console.error(t)})},style:{visibility:r}},[])},f.componentName="navigation",f);function f(t,e,r){var n=o.call(this,t,e,r)||this;return n._seqNames={},n._seqNames[u.EdgeDirection[u.EdgeDirection.Prev]]="Prev",n._seqNames[u.EdgeDirection[u.EdgeDirection.Next]]="Next",n._spaTopNames={},n._spaTopNames[u.EdgeDirection[u.EdgeDirection.TurnLeft]]="Turnleft",n._spaTopNames[u.EdgeDirection[u.EdgeDirection.StepLeft]]="Left",n._spaTopNames[u.EdgeDirection[u.EdgeDirection.StepForward]]="Forward",n._spaTopNames[u.EdgeDirection[u.EdgeDirection.StepRight]]="Right",n._spaTopNames[u.EdgeDirection[u.EdgeDirection.TurnRight]]="Turnright",n._spaBottomNames={},n._spaBottomNames[u.EdgeDirection[u.EdgeDirection.TurnU]]="Turnaround",n._spaBottomNames[u.EdgeDirection[u.EdgeDirection.StepBackward]]="Backward",n}r.NavigationComponent=p,h.ComponentService.register(p),r.default=p},{"../Component":291,"../Edge":292,"../Error":293,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],316:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs"),s=t("rxjs/operators"),u=t("virtual-dom"),c=t("../Component"),l=function(){},h=function(){},p=function(){this.nodeInstructions=[],this.nodeInstructionsOrdered=[]},f=(o=c.Component,i(d,o),d.prototype._activate=function(){var o=this,t=this._navigator.stateService.currentState$.pipe(s.filter(function(t){return t.id%2==0}),s.filter(function(t){return t.state.nodesAhead<15}),s.distinctUntilChanged(void 0,function(t){return t.state.lastNode.key})),e=a.combineLatest(this.configuration$.pipe(s.mergeMap(function(t){return a.from(t.paths)}),s.distinct(function(t){return t.sequenceKey}),s.mergeMap(function(e){return o._navigator.apiV3.sequenceByKey$([e.sequenceKey]).pipe(s.map(function(t){return t[e.sequenceKey]}))})),this.configuration$).pipe(s.map(function(t){for(var e=t[0],r=0,n=[],i=0,o=t[1].paths;i<o.length;i++){var a=o[i];if(a.sequenceKey===e.key){for(var s=[],u=!1,c=0,l=e.keys;c<l.length;c++){var h=l[c];if(a.startKey===h&&(u=!0),u){for(var p=null,f=0,d=a.infoKeys;f<d.length;f++){var m=d[f];m.key===h&&(p=m.description)}s.push({description:p,key:h})}a.stopKey===h&&(u=!1)}n.push({nodeInstructions:s,place:r})}r++}return n}),s.scan(function(t,e){for(var r=0,n=e;r<n.length;r++){var i=n[r];t.nodeInstructionsOrdered[i.place]=i.nodeInstructions}for(var o in t.nodeInstructionsOrdered)if(t.nodeInstructionsOrdered.hasOwnProperty(o))for(var a=0,s=t.nodeInstructionsOrdered[o];a<s.length;a++){var u=s[a];t.nodeInstructions.push(u)}return t},new p)),r=a.combineLatest(t,e,this.configuration$).pipe(s.map(function(t){var e=t[0],r=t[1];return{conf:t[2],frame:e,routeTrack:r}}),s.scan(function(t,e){return void 0===e.conf.playing||e.conf.playing?(t.routeTrack=e.routeTrack,t.currentNode=e.frame.state.currentNode,t.lastNode=e.frame.state.lastNode,t.playing=!0):(o._navigator.stateService.cutNodes(),t.playing=!1),t},new h),s.filter(function(t){return t.playing}),s.filter(function(t){for(var e=0,r=t.routeTrack.nodeInstructions;e<r.length;e++){var n=r[e];if(n&&n.key===t.lastNode.key)return!0}return!1}),s.distinctUntilChanged(void 0,function(t){return t.lastNode.key}),s.mergeMap(function(t){for(var e=0,r=0,n=t.routeTrack.nodeInstructions;r<n.length&&n[r].key!==t.lastNode.key;r++)e++;var i=t.routeTrack.nodeInstructions[e+1];return i?o._navigator.graphService.cacheNode$(i.key):a.of(null)}));this._disposable=a.combineLatest(r,this.configuration$).pipe(s.map(function(t){var e=t[0];return{conf:t[1],node:e}}),s.filter(function(t){return null!==t.node&&t.conf.playing}),s.pluck("node")).subscribe(this._navigator.stateService.appendNode$),this._disposableDescription=a.combineLatest(this._navigator.stateService.currentNode$,e,this.configuration$).pipe(s.map(function(t){var e=t[0],r=t[1],n=t[2];if(void 0!==n.playing&&!n.playing)return"quit";for(var i=null,o=0,a=r.nodeInstructions;o<a.length;o++){var s=a[o];if(s.key===e.key){i=s.description;break}}return i}),s.scan(function(t,e){return e!==t.description&&null!==e?(t.description=e,t.showsLeft=6):t.showsLeft--,"quit"===e&&(t.description=null),t},new l),s.map(function(t){return 0<t.showsLeft&&t.description?{name:o._name,vnode:o._getRouteAnnotationNode(t.description)}:{name:o._name,vnode:u.h("div",[])}})).subscribe(this._container.domRenderer.render$)},d.prototype._deactivate=function(){this._disposable.unsubscribe(),this._disposableDescription.unsubscribe()},d.prototype._getDefaultConfiguration=function(){return{}},d.prototype.play=function(){this.configure({playing:!0})},d.prototype.stop=function(){this.configure({playing:!1})},d.prototype._getRouteAnnotationNode=function(t){return u.h("div.RouteFrame",{},[u.h("p",{textContent:t},[])])},d.componentName="route",d);function d(t,e,r){return o.call(this,t,e,r)||this}r.RouteComponent=f,c.ComponentService.register(f),r.default=f},{"../Component":291,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],317:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs"),s=t("rxjs/operators"),u=t("../Component"),c=(o=u.Component,i(l,o),l.prototype._activate=function(){var t=this;this._sequenceSubscription=this._navigator.stateService.currentNode$.pipe(s.scan(function(t,e){var r=e.sequenceKey;return t.report=[],r in t.reported||(t.report=[r],t.reported[r]=!0),t},{report:[],reported:{}}),s.filter(function(t){return 0<t.report.length}),s.mergeMap(function(r){return t._navigator.apiV3.sequenceViewAdd$(r.report).pipe(s.catchError(function(t,e){return console.error("Failed to report sequence stats ("+r.report+")",t),a.empty()}))})).subscribe(function(){}),this._imageSubscription=this._navigator.stateService.currentNode$.pipe(s.map(function(t){return t.key})).pipe(s.buffer(this._navigator.stateService.currentNode$.pipe(s.debounceTime(5e3,this._scheduler))),s.scan(function(t,e){t.report=[];for(var r=0,n=e;r<n.length;r++){var i=n[r];i in t.reported||(t.report.push(i),t.reported[i]=!0)}return t},{report:[],reported:{}}),s.filter(function(t){return 0<t.report.length}),s.mergeMap(function(r){return t._navigator.apiV3.imageViewAdd$(r.report).pipe(s.catchError(function(t,e){return console.error("Failed to report image stats ("+r.report+")",t),a.empty()}))})).subscribe(function(){})},l.prototype._deactivate=function(){this._sequenceSubscription.unsubscribe(),this._imageSubscription.unsubscribe()},l.prototype._getDefaultConfiguration=function(){return{}},l.componentName="stats",l);function l(t,e,r,n){var i=o.call(this,t,e,r)||this;return i._scheduler=n,i}r.StatsComponent=c,u.ComponentService.register(c),r.default=c},{"../Component":291,rxjs:43,"rxjs/operators":241}],318:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("virtual-dom"),s=t("rxjs"),u=t("rxjs/operators"),c=t("../../Component"),l=(o=c.Component,i(h,o),Object.defineProperty(h.prototype,"hoveredKey$",{get:function(){return this._hoveredKey$},enumerable:!0,configurable:!0}),h.prototype.setHighlightKey=function(t){this.configure({highlightKey:t})},h.prototype.setMinWidth=function(t){this.configure({minWidth:t})},h.prototype.setMaxWidth=function(t){this.configure({maxWidth:t})},h.prototype._activate=function(){var n=this;this._configurationSubscription=this._configuration$.subscribe(function(t){n._renderer.setConfiguration(t)}),this._resizeSubscription=this._container.renderService.size$.subscribe(function(t){n._renderer.resize(t)}),this._nodeSubscription=this._navigator.stateService.currentNode$.pipe(u.tap(function(t){n._container.domRenderer.render$.next({name:n._name,vnode:a.h("div",{},[])}),n._renderer.setNode(t)}),u.withLatestFrom(this._configuration$),u.switchMap(function(t){var r=t[0],e=t[1];return s.combineLatest(r.spatialEdges$,e.distinguishSequence?n._navigator.graphService.cacheSequence$(r.sequenceKey).pipe(u.catchError(function(t,e){return console.error("Failed to cache sequence ("+r.sequenceKey+")",t),s.of(null)})):s.of(null))})).subscribe(function(t){var e=t[0],r=t[1];n._renderer.setEdges(e,r)}),this._renderCameraSubscription=this._container.renderService.renderCameraFrame$.pipe(u.tap(function(t){n._renderer.setRenderCamera(t)}),u.map(function(){return n._renderer}),u.filter(function(t){return t.needsRender}),u.map(function(t){return{name:n._name,vnode:t.render(n._navigator)}})).subscribe(this._container.domRenderer.render$),this._hoveredKeySubscription=s.combineLatest(this._container.domRenderer.element$,this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$.pipe(u.startWith(null)),this._container.mouseService.mouseUp$.pipe(u.startWith(null))).pipe(u.map(function(t){for(var e=t[0].getElementsByClassName("DirectionsPerspective"),r=0;r<e.length;r++){var n=e.item(r).querySelector(":hover");if(null!=n&&n.hasAttribute("data-key"))return n.getAttribute("data-key")}return null}),u.distinctUntilChanged()).subscribe(this._hoveredKeySubject$),this._emitHoveredKeySubscription=this._hoveredKey$.subscribe(function(t){n.fire(h.hoveredkeychanged,t)})},h.prototype._deactivate=function(){this._configurationSubscription.unsubscribe(),this._emitHoveredKeySubscription.unsubscribe(),this._hoveredKeySubscription.unsubscribe(),this._nodeSubscription.unsubscribe(),this._renderCameraSubscription.unsubscribe()},h.prototype._getDefaultConfiguration=function(){return{distinguishSequence:!1,maxWidth:460,minWidth:260}},h.componentName="direction",h.hoveredkeychanged="hoveredkeychanged",h);function h(t,e,r,n){var i=o.call(this,t,e,r)||this;return i._renderer=n||new c.DirectionDOMRenderer(i.defaultConfiguration,{height:e.element.offsetHeight,width:e.element.offsetWidth}),i._hoveredKeySubject$=new s.Subject,i._hoveredKey$=i._hoveredKeySubject$.pipe(u.share()),i}r.DirectionComponent=l,c.ComponentService.register(l),r.default=l},{"../../Component":291,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],319:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../../Geo"),i=(Object.defineProperty(o.prototype,"minWidth",{get:function(){return this._minWidth},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"maxWidth",{get:function(){return this._maxWidth},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"containerWidth",{get:function(){return this._containerWidth},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"containerWidthCss",{get:function(){return this._containerWidthCss},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"containerMarginCss",{get:function(){return this._containerMarginCss},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"containerLeftCss",{get:function(){return this._containerLeftCss},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"containerHeight",{get:function(){return this._containerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"containerHeightCss",{get:function(){return this._containerHeightCss},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"containerBottomCss",{get:function(){return this._containerBottomCss},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"stepCircleSize",{get:function(){return this._stepCircleSize},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"stepCircleSizeCss",{get:function(){return this._stepCircleSizeCss},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"stepCircleMarginCss",{get:function(){return this._stepCircleMarginCss},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"turnCircleSize",{get:function(){return this._turnCircleSize},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"turnCircleSizeCss",{get:function(){return this._turnCircleSizeCss},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"outerRadius",{get:function(){return this._outerRadius},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"innerRadius",{get:function(){return this._innerRadius},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"shadowOffset",{get:function(){return this._shadowOffset},enumerable:!0,configurable:!0}),o.prototype.configure=function(t){this._configure(t),this._reset()},o.prototype.resize=function(t){this._resize(t),this._reset()},o.prototype.angleToCoordinates=function(t){return[Math.cos(t),Math.sin(t)]},o.prototype.relativeAngleToCoordiantes=function(t,e){var r=this._spatial.wrapAngle(t-e);return this.angleToCoordinates(r)},o.prototype._configure=function(t){this._minWidth=t.minWidth,this._maxWidth=this._getMaxWidth(t.minWidth,t.maxWidth)},o.prototype._resize=function(t){this._elementWidth=t.width,this._elementHeight=t.height},o.prototype._reset=function(){this._containerWidth=this._getContainerWidth(this._elementWidth,this._elementHeight),this._containerHeight=this._getContainerHeight(this.containerWidth),this._stepCircleSize=this._getStepCircleDiameter(this._containerHeight),this._turnCircleSize=this._getTurnCircleDiameter(this.containerHeight),this._outerRadius=this._getOuterRadius(this._containerHeight),this._innerRadius=this._getInnerRadius(this._containerHeight),this._shadowOffset=3,this._containerWidthCss=this._numberToCssPixels(this._containerWidth),this._containerMarginCss=this._numberToCssPixels(-.5*this._containerWidth),this._containerLeftCss=this._numberToCssPixels(Math.floor(.5*this._elementWidth)),this._containerHeightCss=this._numberToCssPixels(this._containerHeight),this._containerBottomCss=this._numberToCssPixels(Math.floor(-.08*this._containerHeight)),this._stepCircleSizeCss=this._numberToCssPixels(this._stepCircleSize),this._stepCircleMarginCss=this._numberToCssPixels(-.5*this._stepCircleSize),this._turnCircleSizeCss=this._numberToCssPixels(this._turnCircleSize)},o.prototype._getContainerWidth=function(t,e){var r=(t-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),n=(e-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight),i=Math.max(0,Math.min(1,Math.min(r,n)));return i=.04*Math.round(25*i),this._minWidth+i*(this._maxWidth-this._minWidth)},o.prototype._getContainerHeight=function(t){return.77*t},o.prototype._getStepCircleDiameter=function(t){return.34*t},o.prototype._getTurnCircleDiameter=function(t){return.3*t},o.prototype._getOuterRadius=function(t){return.31*t},o.prototype._getInnerRadius=function(t){return.125*t},o.prototype._numberToCssPixels=function(t){return t+"px"},o.prototype._getMaxWidth=function(t,e){return e<t?t:e},o);function o(t,e){this._spatial=new n.Spatial,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._configure(t),this._resize(e),this._reset()}r.DirectionDOMCalculator=i,r.default=i},{"../../Geo":294}],320:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var _=t("virtual-dom"),n=t("../../Component"),h=t("../../Edge"),u=t("../../Error"),i=t("../../Geo"),o=(Object.defineProperty(a.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:!0,configurable:!0}),a.prototype.render=function(t){this._needsRender=!1;var e=this._rotation,r=[],n=[];return this._node.pano?r=r.concat(this._createPanoArrows(t,e)):(r=(r=r.concat(this._createPerspectiveToPanoArrows(t,e))).concat(this._createStepArrows(t,e)),n=n.concat(this._createTurnArrows(t))),this._getContainer(r,n,e)},a.prototype.setEdges=function(t,e){this._setEdges(t,e),this._setNeedsRender()},a.prototype.setNode=function(t){this._node=t,this._clearEdges(),this._setNeedsRender()},a.prototype.setRenderCamera=function(t){var e=t.rotation;Math.abs(e.phi-this._rotation.phi)<this._epsilon||(this._rotation=e,this._setNeedsRender())},a.prototype.setConfiguration=function(t){var e=!1;this._highlightKey===t.highlightKey&&this._distinguishSequence===t.distinguishSequence||(this._highlightKey=t.highlightKey,this._distinguishSequence=t.distinguishSequence,e=!0),this._calculator.minWidth===t.minWidth&&this._calculator.maxWidth===t.maxWidth||(this._calculator.configure(t),e=!0),e&&this._setNeedsRender()},a.prototype.resize=function(t){this._calculator.resize(t),this._setNeedsRender()},a.prototype._setNeedsRender=function(){null!=this._node&&(this._needsRender=!0)},a.prototype._clearEdges=function(){this._stepEdges=[],this._turnEdges=[],this._panoEdges=[],this._sequenceEdgeKeys=[]},a.prototype._setEdges=function(t,e){this._stepEdges=[],this._turnEdges=[],this._panoEdges=[],this._sequenceEdgeKeys=[];for(var r=0,n=t.edges;r<n.length;r++){var i=(s=n[r]).data.direction;-1<this._stepDirections.indexOf(i)?this._stepEdges.push(s):-1<this._turnDirections.indexOf(i)?this._turnEdges.push(s):s.data.direction===h.EdgeDirection.Pano&&this._panoEdges.push(s)}if(this._distinguishSequence&&null!=e)for(var o=0,a=this._panoEdges.concat(this._stepEdges).concat(this._turnEdges);o<a.length;o++)for(var s,u=(s=a[o]).to,c=0,l=e.keys;c<l.length;c++)if(l[c]===u){this._sequenceEdgeKeys.push(u);break}},a.prototype._createPanoArrows=function(t,e){for(var r=[],n=0,i=this._panoEdges;n<i.length;n++){var o=i[n];r.push(this._createVNodeByKey(t,o.to,o.data.worldMotionAzimuth,e,this._calculator.outerRadius,"DirectionsArrowPano"))}for(var a=0,s=this._stepEdges;a<s.length;a++){var u=s[a];r.push(this._createPanoToPerspectiveArrow(t,u.to,u.data.worldMotionAzimuth,e,u.data.direction))}return r},a.prototype._createPanoToPerspectiveArrow=function(t,e,r,n,i){var o=Math.PI/8,a=n.phi;switch(i){case h.EdgeDirection.StepBackward:a=n.phi-Math.PI;break;case h.EdgeDirection.StepLeft:a=n.phi+Math.PI/2;break;case h.EdgeDirection.StepRight:a=n.phi-Math.PI/2}return Math.abs(this._spatial.wrapAngle(r-a))<o?this._createVNodeByKey(t,e,r,n,this._calculator.outerRadius,"DirectionsArrowStep"):this._createVNodeDisabled(e,r,n)},a.prototype._createPerspectiveToPanoArrows=function(t,e){for(var r=[],n=0,i=this._panoEdges;n<i.length;n++){var o=i[n];r.push(this._createVNodeByKey(t,o.to,o.data.worldMotionAzimuth,e,this._calculator.innerRadius,"DirectionsArrowPano",!0))}return r},a.prototype._createStepArrows=function(t,e){for(var r=[],n=0,i=this._stepEdges;n<i.length;n++){var o=i[n];r.push(this._createVNodeByDirection(t,o.to,o.data.worldMotionAzimuth,e,o.data.direction))}return r},a.prototype._createTurnArrows=function(t){for(var e=[],r=0,n=this._turnEdges;r<n.length;r++){var i=n[r],o=i.data.direction,a=this._turnNames[o];e.push(this._createVNodeByTurn(t,i.to,a,o))}return e},a.prototype._createVNodeByKey=function(e,r,t,n,i,o,a){return this._createVNode(r,t,n,i,o,"DirectionsCircle",function(t){e.moveToKey$(r).subscribe(void 0,function(t){t instanceof u.AbortMapillaryError||console.error(t)})},a)},a.prototype._createVNodeByDirection=function(e,t,r,n,i){return this._createVNode(t,r,n,this._calculator.outerRadius,"DirectionsArrowStep","DirectionsCircle",function(t){e.moveDir$(i).subscribe(void 0,function(t){t instanceof u.AbortMapillaryError||console.error(t)})})},a.prototype._createVNodeByTurn=function(e,t,r,n){var i={height:this._calculator.turnCircleSizeCss,transform:"rotate(0)",width:this._calculator.turnCircleSizeCss};switch(n){case h.EdgeDirection.TurnLeft:i.left="5px",i.top="5px";break;case h.EdgeDirection.TurnRight:i.right="5px",i.top="5px";break;case h.EdgeDirection.TurnU:i.left="5px",i.bottom="5px"}var o={attributes:{"data-key":t},onclick:function(t){e.moveDir$(n).subscribe(void 0,function(t){t instanceof u.AbortMapillaryError||console.error(t)})},style:i},a="TurnCircle";-1<this._sequenceEdgeKeys.indexOf(t)&&(a+="Sequence"),this._highlightKey===t&&(a+="Highlight");var s=_.h("div."+r,{},[]);return _.h("div."+a,o,[s])},a.prototype._createVNodeDisabled=function(t,e,r){return this._createVNode(t,e,r,this._calculator.outerRadius,"DirectionsArrowDisabled","DirectionsCircleDisabled")},a.prototype._createVNode=function(t,e,r,n,i,o,a,s){var u=this._calculator.angleToCoordinates(e-r.phi),c=Math.round(-n*u[1]+.5*this._calculator.containerWidth),l=Math.round(-n*u[0]+.5*this._calculator.containerHeight),h=this._calculator.relativeAngleToCoordiantes(e,r.phi),p=this._calculator.shadowOffset,f="drop-shadow("+-p*h[1]+"px "+p*h[0]+"px 1px rgba(0,0,0,0.8))",d={style:{"-webkit-filter":f,filter:f}},m=_.h("div."+i,d,[]),g=-this._spatial.radToDeg(e-r.phi),y=s?"translate("+c+"px, "+l+"px) rotate("+g+"deg) translateZ(-0.01px)":"translate("+c+"px, "+l+"px) rotate("+g+"deg)",v={attributes:{"data-key":t},onclick:a,style:{height:this._calculator.stepCircleSizeCss,marginLeft:this._calculator.stepCircleMarginCss,marginTop:this._calculator.stepCircleMarginCss,transform:y,width:this._calculator.stepCircleSizeCss}};return-1<this._sequenceEdgeKeys.indexOf(t)&&(o+="Sequence"),this._highlightKey===t&&(o+="Highlight"),_.h("div."+o,v,[m])},a.prototype._getContainer=function(t,e,r){var n=this._isEdge?"rotateX(60deg)":"perspective("+this._calculator.containerWidthCss+") rotateX(60deg)",i={oncontextmenu:function(t){t.preventDefault()},style:{bottom:this._calculator.containerBottomCss,height:this._calculator.containerHeightCss,left:this._calculator.containerLeftCss,marginLeft:this._calculator.containerMarginCss,transform:n,width:this._calculator.containerWidthCss}};return _.h("div.DirectionsPerspective",i,e.concat(t))},a);function a(t,e){this._isEdge=!1,this._spatial=new i.Spatial,this._calculator=new n.DirectionDOMCalculator(t,e),this._node=null,this._rotation={phi:0,theta:0},this._epsilon=.5*Math.PI/180,this._highlightKey=null,this._distinguishSequence=!1,this._needsRender=!1,this._stepEdges=[],this._turnEdges=[],this._panoEdges=[],this._sequenceEdgeKeys=[],this._stepDirections=[h.EdgeDirection.StepForward,h.EdgeDirection.StepBackward,h.EdgeDirection.StepLeft,h.EdgeDirection.StepRight],this._turnDirections=[h.EdgeDirection.TurnLeft,h.EdgeDirection.TurnRight,h.EdgeDirection.TurnU],this._turnNames={},this._turnNames[h.EdgeDirection.TurnLeft]="TurnLeft",this._turnNames[h.EdgeDirection.TurnRight]="TurnRight",this._turnNames[h.EdgeDirection.TurnU]="TurnAround";var r=!!document.documentMode;this._isEdge=!r&&!!window.StyleMedia}r.DirectionDOMRenderer=o,r.default=o},{"../../Component":291,"../../Edge":292,"../../Error":293,"../../Geo":294,"virtual-dom":247}],321:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,f=t("rxjs"),d=t("rxjs/operators"),a=t("../../Component"),s=t("../../Viewer"),u=t("../../Render"),c=t("../../Tiles"),l=t("../../Utils"),m=t("../../geo/ViewportCoords"),g=t("../../geo/Spatial"),h=(o=a.Component,i(p,o),p.prototype._activate=function(){var p=this;this._rendererSubscription=this._renderer$.pipe(d.map(function(t){var e={name:p._name,render:{frameId:t.frameId,needsRender:t.needsRender,render:t.render.bind(t),stage:u.GLRenderStage.Background}};return t.clearNeedsRender(),e})).subscribe(this._container.glRenderer.render$),this._rendererCreator$.next(null),this._stateSubscription=this._navigator.stateService.currentState$.pipe(d.map(function(e){return function(t){return t.updateFrame(e),t}})).subscribe(this._rendererOperation$);var e=this._navigator.stateService.currentState$.pipe(d.distinctUntilChanged(void 0,function(t){return t.state.currentNode.key}),d.withLatestFrom(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),d.map(function(t){var e=t[0],r=t[1],n=t[2],i=e.state,o=Math.max(n.width,n.height),a=i.currentNode,s=i.currentTransform,u=2048<o?2048:1024<o?1024:512;return new c.TextureProvider(a.key,s.basicWidth,s.basicHeight,u,a.image,p._imageTileLoader,new c.ImageTileStore,r)}),d.publishReplay(1),d.refCount());this._textureProviderSubscription=e.subscribe(function(){}),this._setTextureProviderSubscription=e.pipe(d.map(function(e){return function(t){return t.setTextureProvider(e.key,e),t}})).subscribe(this._rendererOperation$),this._setTileSizeSubscription=this._container.renderService.size$.pipe(d.switchMap(function(t){return f.combineLatest(e,f.of(t)).pipe(d.first())})).subscribe(function(t){var e=t[0],r=t[1],n=Math.max(r.width,r.height),i=2048<n?2048:1024<n?1024:512;e.setTileSize(i)}),this._abortTextureProviderSubscription=e.pipe(d.pairwise()).subscribe(function(t){t[0].abort()});var t=f.combineLatest(this._container.renderService.renderCameraFrame$,this._container.renderService.size$.pipe(d.debounceTime(250))).pipe(d.map(function(t){var e=t[0],r=t[1];return[e.camera.position.clone(),e.camera.lookat.clone(),e.zoom.valueOf(),r.height.valueOf(),r.width.valueOf()]}),d.pairwise(),d.skipWhile(function(t){return t[1][2]-t[0][2]<0||0===t[1][2]}),d.map(function(t){var e=t[0][0].equals(t[1][0]),r=t[0][1].equals(t[1][1]),n=t[0][2]===t[1][2],i=t[0][3]===t[1][3],o=t[0][4]===t[1][4];return e&&r&&n&&i&&o}),d.distinctUntilChanged(),d.filter(function(t){return t}),d.switchMap(function(t){return p._container.renderService.renderCameraFrame$.pipe(d.first())}),d.withLatestFrom(this._container.renderService.size$,this._navigator.stateService.currentTransform$));this._setRegionOfInterestSubscription=e.pipe(d.switchMap(function(o){return t.pipe(d.map(function(t){var e=t[0],r=t[1],n=t[2],i=(new m.default).viewportToBasic(0,0,n,e.perspective);if(!(i[0]<0||i[1]<0||1<i[0]||1<i[1]))return[p._roiCalculator.computeRegionOfInterest(e,r,n),o]}),d.filter(function(t){return!!t}))}),d.filter(function(t){return!t[1].disposed})).subscribe(function(t){var e=t[0];t[1].setRegionOfInterest(e)});var n=e.pipe(d.switchMap(function(t){return t.hasTexture$}),d.startWith(!1),d.publishReplay(1),d.refCount());this._hasTextureSubscription=n.subscribe(function(){});var r=this._navigator.stateService.currentState$.pipe(d.filter(function(t){return 0===t.state.nodesAhead}),d.map(function(t){return t.state.currentNode}),d.distinctUntilChanged(void 0,function(t){return t.key}),d.debounceTime(1e3),d.withLatestFrom(n),d.filter(function(t){return!t[1]}),d.map(function(t){return t[0]}),d.filter(function(t){return t.pano?l.Settings.maxImageSize>l.Settings.basePanoramaSize:l.Settings.maxImageSize>l.Settings.baseImageSize}),d.switchMap(function(r){var t=r.pano?l.Settings.basePanoramaSize:l.Settings.baseImageSize;return Math.max(r.image.width,r.image.height)>t?f.empty():r.cacheImage$(l.Settings.maxImageSize).pipe(d.map(function(t){return[t.image,t]})).pipe(d.takeUntil(n.pipe(d.filter(function(t){return t}))),d.catchError(function(t,e){return console.error("Failed to fetch high res image ("+r.key+")",t),f.empty()}))})).pipe(d.publish(),d.refCount());this._updateBackgroundSubscription=r.pipe(d.withLatestFrom(e)).subscribe(function(t){t[0][1].key!==t[1].key||t[1].disposed||t[1].updateBackground(t[0][0])}),this._updateTextureImageSubscription=r.pipe(d.map(function(e){return function(t){return t.updateTextureImage(e[0],e[1]),t}})).subscribe(this._rendererOperation$),this._clearPeripheryPlaneSubscription=this._navigator.panService.panNodes$.pipe(d.filter(function(t){return 0===t.length}),d.map(function(){return function(t){return t.clearPeripheryPlanes(),t}})).subscribe(this._rendererOperation$);var i=this._navigator.panService.panNodes$.pipe(d.switchMap(function(t){return f.from(t).pipe(d.mergeMap(function(t){var e=t[0],r=t[1];return f.combineLatest(p._navigator.graphService.cacheNode$(e.key).pipe(d.catchError(function(t){return console.error("Failed to cache periphery node ("+e.key+")",t),f.empty()})),f.of(r))}))}),d.share());this._addPeripheryPlaneSubscription=i.pipe(d.map(function(t){var e=t[0],r=t[1];return function(t){return t.addPeripheryPlane(e,r),t}})).subscribe(this._rendererOperation$),this._updatePeripheryPlaneTextureSubscription=i.pipe(d.mergeMap(function(t){var e=t[0];return s.ImageSize.Size2048>Math.max(e.image.width,e.image.height)?e.cacheImage$(s.ImageSize.Size2048).pipe(d.catchError(function(){return f.empty()})):f.empty()}),d.map(function(e){return function(t){return t.updateTextureImage(e.image,e),t}})).subscribe(this._rendererOperation$);var o=this._navigator.stateService.currentState$.pipe(d.map(function(t){return t.state.alpha<1}),d.distinctUntilChanged()),a=f.combineLatest(this._container.mouseService.active$,this._container.touchService.active$,this._navigator.stateService.inMotion$,o).pipe(d.map(function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return!(e||r||n||i)}),d.filter(function(t){return t}));this._moveToPeripheryNodeSubscription=this._navigator.panService.panNodes$.pipe(d.switchMap(function(i){return a.pipe(d.withLatestFrom(p._container.renderService.renderCamera$,p._navigator.stateService.currentNode$,p._navigator.stateService.currentTransform$),d.mergeMap(function(t){var e=t[1],r=t[2],n=t[3];return f.of([e,r,n,i])}))}),d.switchMap(function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=e.camera.lookat.clone().sub(e.camera.position),a=[(new g.default).viewingDirection(r.rotation).angleTo(o),void 0],s=(new m.default).viewportToBasic(0,0,n,e.perspective);0<=s[0]&&s[0]<=1&&0<=s[1]&&s[1]<=1&&(a[0]=Number.NEGATIVE_INFINITY);for(var u=0,c=i;u<c.length;u++){var l=c[u][0],h=(new g.default).viewingDirection(l.rotation).angleTo(o);h<a[0]&&(a[0]=h,a[1]=l.key)}return a[1]?p._navigator.moveToKey$(a[1]).pipe(d.catchError(function(){return f.empty()})):f.empty()})).subscribe()},p.prototype._deactivate=function(){this._rendererDisposer$.next(null),this._abortTextureProviderSubscription.unsubscribe(),this._hasTextureSubscription.unsubscribe(),this._rendererSubscription.unsubscribe(),this._setRegionOfInterestSubscription.unsubscribe(),this._setTextureProviderSubscription.unsubscribe(),this._setTileSizeSubscription.unsubscribe(),this._stateSubscription.unsubscribe(),this._textureProviderSubscription.unsubscribe(),this._updateBackgroundSubscription.unsubscribe(),this._updateTextureImageSubscription.unsubscribe(),this._clearPeripheryPlaneSubscription.unsubscribe(),this._addPeripheryPlaneSubscription.unsubscribe(),this._updatePeripheryPlaneTextureSubscription.unsubscribe(),this._moveToPeripheryNodeSubscription.unsubscribe()},p.prototype._getDefaultConfiguration=function(){return{}},p.componentName="imagePlane",p);function p(t,e,r){var n=o.call(this,t,e,r)||this;return n._imageTileLoader=new c.ImageTileLoader(l.Urls.tileScheme,l.Urls.tileDomain,l.Urls.origin),n._roiCalculator=new c.RegionOfInterestCalculator,n._rendererOperation$=new f.Subject,n._rendererCreator$=new f.Subject,n._rendererDisposer$=new f.Subject,n._renderer$=n._rendererOperation$.pipe(d.scan(function(t,e){return e(t)},null),d.filter(function(t){return null!=t}),d.distinctUntilChanged(void 0,function(t){return t.frameId})),n._rendererCreator$.pipe(d.map(function(){return function(t){if(null!=t)throw new Error("Multiple image plane states can not be created at the same time");return new a.ImagePlaneGLRenderer}})).subscribe(n._rendererOperation$),n._rendererDisposer$.pipe(d.map(function(){return function(t){return t.dispose(),null}})).subscribe(n._rendererOperation$),n}r.ImagePlaneComponent=h,a.ComponentService.register(h),r.default=h},{"../../Component":291,"../../Render":297,"../../Tiles":300,"../../Utils":301,"../../Viewer":302,"../../geo/Spatial":412,"../../geo/ViewportCoords":414,rxjs:43,"rxjs/operators":241}],322:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../../Component"),i=(Object.defineProperty(o.prototype,"frameId",{get:function(){return this._frameId},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:!0,configurable:!0}),o.prototype.indicateNeedsRender=function(){this._needsRender=!0},o.prototype.addPeripheryPlane=function(t,e){var r=this._factory.createMesh(t,e),n={};n[t.key]=r,this._scene.addPeripheryPlanes(n),this._needsRender=!0},o.prototype.clearPeripheryPlanes=function(){this._scene.setPeripheryPlanes({}),this._needsRender=!0},o.prototype.updateFrame=function(t){this._updateFrameId(t.id),this._needsRender=this._updateAlpha(t.state.alpha)||this._needsRender,this._needsRender=this._updateAlphaOld(t.state.alpha)||this._needsRender,this._needsRender=this._updateImagePlanes(t.state)||this._needsRender},o.prototype.setTextureProvider=function(t,e){var r=this;if(t===this._currentKey){var n=e.textureCreated$.subscribe(function(t){r._updateTexture(t)}),i=e.textureUpdated$.subscribe(function(t){r._needsRender=!0});t in this._providerDisposers&&((0,this._providerDisposers[t])(),delete this._providerDisposers[t]),this._providerDisposers[t]=function(){n.unsubscribe(),i.unsubscribe(),e.dispose()}}},o.prototype.updateTextureImage=function(t,e){this._needsRender=!0;var r=this._extend({},this._scene.planes,this._scene.planesOld,this._scene.planesPeriphery);for(var n in r)if(r.hasOwnProperty(n)&&n===e.key){var i=r[n].material.uniforms.projectorTex.value;i.image=t,i.needsUpdate=!0}},o.prototype.render=function(t,e){var r=this._scene.planes,n=this._scene.planesOld,i=this._scene.planesPeriphery,o=Object.keys(n).length?1:this._alpha,a=Object.keys(n).length?1:Math.floor(this._alpha);for(var s in r)r.hasOwnProperty(s)&&(r[s].material.uniforms.opacity.value=o);for(var s in n)n.hasOwnProperty(s)&&(n[s].material.uniforms.opacity.value=this._alphaOld);for(var s in i)i.hasOwnProperty(s)&&(i[s].material.uniforms.opacity.value=a);for(var s in e.render(this._scene.scenePeriphery,t),e.render(this._scene.scene,t),e.render(this._scene.sceneOld,t),r)r.hasOwnProperty(s)&&(r[s].material.uniforms.opacity.value=this._alpha);e.render(this._scene.scene,t)},o.prototype.clearNeedsRender=function(){this._needsRender=!1},o.prototype.dispose=function(){this._scene.clear()},o.prototype._updateFrameId=function(t){this._frameId=t},o.prototype._updateAlpha=function(t){return t!==this._alpha&&(this._alpha=t,!0)},o.prototype._updateAlphaOld=function(t){return!(t<1||0===this._alphaOld||(this._alphaOld=Math.max(0,this._alphaOld-this._fadeOutSpeed),0))},o.prototype._updateImagePlanes=function(t){if(null==t.currentNode||t.currentNode.key===this._currentKey)return!1;var e=null!=t.previousNode?t.previousNode.key:null,r=t.currentNode.key;if(this._previousKey!==e&&this._previousKey!==r&&this._previousKey in this._providerDisposers&&((0,this._providerDisposers[this._previousKey])(),delete this._providerDisposers[this._previousKey]),null!=e){if(e!==this._currentKey&&e!==this._previousKey){var n=this._factory.createMesh(t.previousNode,t.previousTransform),i={};i[e]=n,this._scene.updateImagePlanes(i)}this._previousKey=e}this._currentKey=r;var o=this._factory.createMesh(t.currentNode,t.currentTransform),a={};return a[r]=o,this._scene.updateImagePlanes(a),this._alphaOld=1,!0},o.prototype._updateTexture=function(t){this._needsRender=!0;var e=this._scene.planes;for(var r in e)if(e.hasOwnProperty(r)){var n=e[r].material,i=n.uniforms.projectorTex.value;n.uniforms.projectorTex.value=null,i.dispose(),n.uniforms.projectorTex.value=t}},o.prototype._extend=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var n=0,i=e;n<i.length;n++){var o=i[n];for(var a in o)o.hasOwnProperty(a)&&(t[a]=o[a])}return t},o);function o(){this._factory=new n.MeshFactory,this._scene=new n.MeshScene,this._alpha=0,this._alphaOld=0,this._fadeOutSpeed=.05,this._currentKey=null,this._previousKey=null,this._providerDisposers={},this._frameId=0,this._needsRender=!1}r.ImagePlaneGLRenderer=i,r.default=i},{"../../Component":291}],323:[function(t,e,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),(n=r.CoverState||(r.CoverState={}))[n.Hidden=0]="Hidden",n[n.Loading=1]="Loading",n[n.Visible=2]="Visible"},{}],324:[function(t,e,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),(n=r.SliderMode||(r.SliderMode={}))[n.Motion=0]="Motion",n[n.Stationary=1]="Stationary"},{}],325:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./ICoverConfiguration");r.CoverState=n.CoverState;var i=t("./ISliderConfiguration");r.SliderMode=i.SliderMode},{"./ICoverConfiguration":323,"./ISliderConfiguration":324}],326:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs/operators"),s=t("../../Component"),l=t("../../Edge"),u=(o=s.HandlerBase,i(c,o),c.prototype._enable=function(){var c=this;this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(a.withLatestFrom(this._navigator.playService.playing$,this._navigator.playService.direction$,this._navigator.playService.speed$,this._navigator.stateService.currentNode$.pipe(a.switchMap(function(t){return t.sequenceEdges$})))).subscribe(function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4];if(!(e.altKey||e.ctrlKey||e.metaKey)){switch(e.key){case"D":if(!e.shiftKey)return;var a=r?null:n===l.EdgeDirection.Next?l.EdgeDirection.Prev:n===l.EdgeDirection.Prev?l.EdgeDirection.Next:null;null!=a&&c._navigator.playService.setDirection(a);break;case" ":if(e.shiftKey)return;if(r)c._navigator.playService.stop();else for(var s=0,u=o.edges;s<u.length;s++)u[s].data.direction===n&&c._navigator.playService.play();break;case"<":c._navigator.playService.setSpeed(i-.05);break;case">":c._navigator.playService.setSpeed(i+.05);break;default:return}e.preventDefault()}})},c.prototype._disable=function(){this._keyDownSubscription.unsubscribe()},c.prototype._getConfiguration=function(t){return{keyZoom:t}},c);function c(){return null!==o&&o.apply(this,arguments)||this}r.KeyPlayHandler=u,r.default=u},{"../../Component":291,"../../Edge":292,"rxjs/operators":241}],327:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs/operators"),s=t("../../Component"),u=t("../../Edge"),c=t("../../Error"),l=(o=s.HandlerBase,i(h,o),h.prototype._enable=function(){var s=this,t=this._navigator.stateService.currentNode$.pipe(a.switchMap(function(t){return t.sequenceEdges$}));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(a.withLatestFrom(t)).subscribe(function(t){var e=t[0],r=t[1],n=null;switch(e.keyCode){case 38:n=u.EdgeDirection.Next;break;case 40:n=u.EdgeDirection.Prev;break;default:return}if(e.preventDefault(),e.altKey&&!e.shiftKey&&r.cached)for(var i=0,o=r.edges;i<o.length;i++){var a=o[i];if(a.data.direction===n)return void s._navigator.moveToKey$(a.to).subscribe(void 0,function(t){t instanceof c.AbortMapillaryError||console.error(t)})}})},h.prototype._disable=function(){this._keyDownSubscription.unsubscribe()},h.prototype._getConfiguration=function(t){return{keySequenceNavigation:t}},h);function h(){return null!==o&&o.apply(this,arguments)||this}r.KeySequenceNavigationHandler=l,r.default=l},{"../../Component":291,"../../Edge":292,"../../Error":293,"rxjs/operators":241}],328:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs/operators"),s=t("../../Component"),v=t("../../Edge"),u=t("../../Error"),c=(o=s.HandlerBase,i(l,o),l.prototype._enable=function(){var y=this,t=this._navigator.stateService.currentNode$.pipe(a.switchMap(function(t){return t.spatialEdges$}));this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(a.withLatestFrom(t,this._navigator.stateService.currentState$)).subscribe(function(t){var e=t[0],r=t[1],n=t[2],i=n.state.currentNode.pano,o=null;switch(e.keyCode){case 37:o=e.shiftKey&&!i?v.EdgeDirection.TurnLeft:v.EdgeDirection.StepLeft;break;case 38:o=e.shiftKey&&!i?v.EdgeDirection.Pano:v.EdgeDirection.StepForward;break;case 39:o=e.shiftKey&&!i?v.EdgeDirection.TurnRight:v.EdgeDirection.StepRight;break;case 40:o=e.shiftKey&&!i?v.EdgeDirection.TurnU:v.EdgeDirection.StepBackward;break;default:return}if(e.preventDefault(),!(e.altKey||!r.cached||e.shiftKey&&i))if(i){var a={};a[v.EdgeDirection.StepBackward]=Math.PI,a[v.EdgeDirection.StepForward]=0,a[v.EdgeDirection.StepLeft]=Math.PI/2,a[v.EdgeDirection.StepRight]=-Math.PI/2;for(var s=y._rotationFromCamera(n.state.camera).phi,u=y._spatial.wrapAngle(s+a[o]),c=Math.PI/4,l=r.edges.filter(function(t){return t.data.direction===v.EdgeDirection.Pano||t.data.direction===o}),h=Number.MAX_VALUE,p=null,f=0,d=l;f<d.length;f++){var m=d[f],g=Math.abs(y._spatial.wrapAngle(m.data.worldMotionAzimuth-u));g<Math.min(h,c)&&(h=g,p=m.to)}if(null==p)return;y._moveToKey(p)}else y._moveDir(o,r)})},l.prototype._disable=function(){this._keyDownSubscription.unsubscribe()},l.prototype._getConfiguration=function(t){return{keySpatialNavigation:t}},l.prototype._moveDir=function(t,e){for(var r=0,n=e.edges;r<n.length;r++){var i=n[r];if(i.data.direction===t)return void this._moveToKey(i.to)}},l.prototype._moveToKey=function(t){this._navigator.moveToKey$(t).subscribe(void 0,function(t){t instanceof u.AbortMapillaryError||console.error(t)})},l.prototype._rotationFromCamera=function(t){var e=t.lookat.clone().sub(t.position),r=e.clone().dot(t.up),n=e.clone().sub(t.up.clone().multiplyScalar(r));return{phi:Math.atan2(n.y,n.x),theta:Math.PI/2-this._spatial.angleToPlane(e.toArray(),[0,0,1])}},l);function l(t,e,r,n){var i=o.call(this,t,e,r)||this;return i._spatial=n,i}r.KeySpatialNavigationHandler=c,r.default=c},{"../../Component":291,"../../Edge":292,"../../Error":293,"rxjs/operators":241}],329:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs/operators"),s=t("../../Component"),u=(o=s.HandlerBase,i(c,o),c.prototype._enable=function(){var s=this;this._keyDownSubscription=this._container.keyboardService.keyDown$.pipe(a.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe(function(t){var e=t[0],r=t[1],n=t[2];if(!(e.altKey||e.shiftKey||e.ctrlKey||e.metaKey)){var i=0;switch(e.key){case"+":i=1;break;case"-":i=-1;break;default:return}e.preventDefault();var o=s._viewportCoords.unprojectFromViewport(0,0,r.perspective),a=n.projectBasic(o.toArray());s._navigator.stateService.zoomIn(i,a)}})},c.prototype._disable=function(){this._keyDownSubscription.unsubscribe()},c.prototype._getConfiguration=function(t){return{keyZoom:t}},c);function c(t,e,r,n){var i=o.call(this,t,e,r)||this;return i._viewportCoords=n,i}r.KeyZoomHandler=u,r.default=u},{"../../Component":291,"rxjs/operators":241}],330:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../../Component"),s=t("../../Geo"),u=(o=a.Component,i(c,o),Object.defineProperty(c.prototype,"keyPlay",{get:function(){return this._keyPlayHandler},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keySequenceNavigation",{get:function(){return this._keySequenceNavigationHandler},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keySpatialNavigation",{get:function(){return this._keySpatialNavigationHandler},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keyZoom",{get:function(){return this._keyZoomHandler},enumerable:!0,configurable:!0}),c.prototype._activate=function(){var e=this;this._configurationSubscription=this._configuration$.subscribe(function(t){t.keyPlay?e._keyPlayHandler.enable():e._keyPlayHandler.disable(),t.keySequenceNavigation?e._keySequenceNavigationHandler.enable():e._keySequenceNavigationHandler.disable(),t.keySpatialNavigation?e._keySpatialNavigationHandler.enable():e._keySpatialNavigationHandler.disable(),t.keyZoom?e._keyZoomHandler.enable():e._keyZoomHandler.disable()})},c.prototype._deactivate=function(){this._configurationSubscription.unsubscribe(),this._keyPlayHandler.disable(),this._keySequenceNavigationHandler.disable(),this._keySpatialNavigationHandler.disable(),this._keyZoomHandler.disable()},c.prototype._getDefaultConfiguration=function(){return{keyPlay:!0,keySequenceNavigation:!0,keySpatialNavigation:!0,keyZoom:!0}},c.componentName="keyboard",c);function c(t,e,r){var n=o.call(this,t,e,r)||this;return n._keyPlayHandler=new a.KeyPlayHandler(n,e,r),n._keySequenceNavigationHandler=new a.KeySequenceNavigationHandler(n,e,r),n._keySpatialNavigationHandler=new a.KeySpatialNavigationHandler(n,e,r,new s.Spatial),n._keyZoomHandler=new a.KeyZoomHandler(n,e,r,new s.ViewportCoords),n}r.KeyboardComponent=u,a.ComponentService.register(u),r.default=u},{"../../Component":291,"../../Geo":294}],331:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./MarkerComponent");r.MarkerComponent=n.MarkerComponent;var i=t("./marker/SimpleMarker");r.SimpleMarker=i.SimpleMarker;var o=t("./marker/CircleMarker");r.CircleMarker=o.CircleMarker},{"./MarkerComponent":332,"./marker/CircleMarker":335,"./marker/SimpleMarker":337}],332:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,p=t("rxjs"),f=t("rxjs/operators"),C=t("three"),a=t("when"),s=t("../../Component"),d=t("../../Render"),u=t("../../Graph"),c=t("../../Geo"),l=(o=s.Component,i(M,o),M.prototype.add=function(t){this._markerSet.add(t)},M.prototype.get=function(t){return this._markerSet.get(t)},M.prototype.getAll=function(){return this._markerSet.getAll()},M.prototype.getMarkerIdAt=function(n){var i=this;return a.promise(function(e,r){i._container.renderService.renderCamera$.pipe(f.first(),f.map(function(t){var e=i._viewportCoords.canvasToViewport(n[0],n[1],i._container.element);return i._markerScene.intersectObjects(e,t.perspective)})).subscribe(function(t){e(t)},function(t){r(t)})})},M.prototype.has=function(t){return this._markerSet.has(t)},M.prototype.remove=function(t){this._markerSet.remove(t)},M.prototype.removeAll=function(){this._markerSet.removeAll()},M.prototype._activate=function(){var E=this,t=this._navigator.stateService.currentState$.pipe(f.map(function(t){return t.state.camera.position.z+E._relativeGroundAltitude}),f.distinctUntilChanged(function(t,e){return Math.abs(t-e)<.01}),f.publishReplay(1),f.refCount()),e=p.combineLatest(t,this._navigator.stateService.reference$).pipe(f.first(),f.map(function(){}),f.publishReplay(1),f.refCount()),r=this._configuration$.pipe(f.map(function(t){return{visibleBBoxSize:Math.max(1,Math.min(200,t.visibleBBoxSize))}})),n=this._navigator.stateService.currentNode$.pipe(f.map(function(t){return t.latLon}),f.publishReplay(1),f.refCount()),i=p.combineLatest(r,n).pipe(f.map(function(t){var e=t[0],r=t[1];return E._graphCalculator.boundingBoxCorners(r,e.visibleBBoxSize/2)}),f.publishReplay(1),f.refCount()),o=p.combineLatest(p.concat(p.of(this._markerSet),this._markerSet.changed$),i).pipe(f.map(function(t){var e=t[0],r=t[1];return e.search(r)}));this._setChangedSubscription=e.pipe(f.switchMap(function(){return o.pipe(f.withLatestFrom(E._navigator.stateService.reference$,t))})).subscribe(function(t){for(var e=t[0],r=t[1],n=t[2],i=E._geoCoords,o=E._markerScene,a=o.markers,s=Object.assign({},a),u=0,c=e;u<c.length;u++){var l=c[u];if(l.id in a)delete s[l.id];else{var h=i.geodeticToEnu(l.latLon.lat,l.latLon.lon,r.alt+n,r.lat,r.lon,r.alt);o.add(l,h)}}for(var p in s)s.hasOwnProperty(p)&&o.remove(p)}),this._markersUpdatedSubscription=e.pipe(f.switchMap(function(){return E._markerSet.updated$.pipe(f.withLatestFrom(i,E._navigator.stateService.reference$,t))})).subscribe(function(t){for(var e=t[0],r=t[1],n=r[0],i=r[1],o=t[2],a=t[3],s=E._geoCoords,u=E._markerScene,c=0,l=e;c<l.length;c++){var h=l[c],p=u.has(h.id),f=h.latLon.lat>n.lat&&h.latLon.lat<i.lat&&h.latLon.lon>n.lon&&h.latLon.lon<i.lon;if(f){var d=s.geodeticToEnu(h.latLon.lat,h.latLon.lon,o.alt+a,o.lat,o.lon,o.alt);u.add(h,d)}else!f&&p&&u.remove(h.id)}}),this._referenceSubscription=this._navigator.stateService.reference$.pipe(f.skip(1),f.withLatestFrom(t)).subscribe(function(t){for(var e=t[0],r=t[1],n=E._geoCoords,i=E._markerScene,o=0,a=i.getAll();o<a.length;o++){var s=a[o],u=n.geodeticToEnu(s.latLon.lat,s.latLon.lon,e.alt+r,e.lat,e.lon,e.alt);i.update(s.id,u)}}),this._adjustHeightSubscription=t.pipe(f.skip(1),f.withLatestFrom(this._navigator.stateService.reference$,n)).subscribe(function(t){for(var e=t[0],r=t[1],n=t[2],i=E._geoCoords,o=E._markerScene,a=i.geodeticToEnu(n.lat,n.lon,r.alt+e,r.lat,r.lon,r.alt),s=0,u=o.getAll();s<u.length;s++){var c=u[s],l=i.geodeticToEnu(c.latLon.lat,c.latLon.lon,r.alt+e,r.lat,r.lon,r.alt),h=l[0]-a[0],p=l[1]-a[1],f=Math.sqrt(h*h+p*p);50<f||o.lerpAltitude(c.id,e,Math.min(1,Math.max(0,1.2-1.2*f/50)))}}),this._renderSubscription=this._navigator.stateService.currentState$.pipe(f.map(function(t){var e=E._markerScene;return{name:E._name,render:{frameId:t.id,needsRender:e.needsRender,render:e.render.bind(e),stage:d.GLRenderStage.Foreground}}})).subscribe(this._container.glRenderer.render$);var a=p.combineLatest(this._container.renderService.renderCamera$,this._container.mouseService.mouseMove$).pipe(f.map(function(t){var e=t[0],r=t[1],n=E._container.element,i=E._viewportCoords.canvasPosition(r,n),o=i[0],a=i[1],s=E._viewportCoords.canvasToViewport(o,a,n);return E._markerScene.intersectObjects(s,e.perspective)}),f.publishReplay(1),f.refCount()),s=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(f.map(function(t){return!0})),u=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragEnd$).pipe(f.map(function(t){return!1})),c=p.merge(s,u).pipe(f.startWith(!1));this._dragEventSubscription=p.merge(s.pipe(f.withLatestFrom(a)),p.combineLatest(u,p.of(null))).pipe(f.startWith([!1,null]),f.pairwise()).subscribe(function(t){var e=t[0],r=t[1],n=r[0],i=n?M.dragstart:M.dragend,o=n?r[1]:e[1],a={marker:E._markerScene.get(o),target:E,type:i};E.fire(i,a)});var l=p.merge(this._container.mouseService.mouseDown$.pipe(f.map(function(t){return!0})),this._container.mouseService.documentMouseUp$.pipe(f.map(function(t){return!1}))).pipe(f.startWith(!1));this._mouseClaimSubscription=p.combineLatest(this._container.mouseService.active$,a.pipe(f.distinctUntilChanged()),l,c).pipe(f.map(function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return!e&&null!=r&&n||i}),f.distinctUntilChanged()).subscribe(function(t){t?(E._container.mouseService.claimMouse(E._name,1),E._container.mouseService.claimWheel(E._name,1)):(E._container.mouseService.unclaimMouse(E._name),E._container.mouseService.unclaimWheel(E._name))});var h=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$).pipe(f.withLatestFrom(a,this._container.renderService.renderCamera$),f.map(function(t){var e=t[0],r=t[1],n=t[2],i=E._markerScene.get(r),o=E._container.element,a=E._viewportCoords.projectToCanvas(i.geometry.position.toArray(),o,n.perspective),s=a[0],u=a[1],c=E._viewportCoords.canvasPosition(e,o);return[i,[c[0]-s,c[1]-u],n]}),f.publishReplay(1),f.refCount());this._updateMarkerSubscription=this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$).pipe(f.withLatestFrom(h,this._navigator.stateService.reference$,r)).subscribe(function(t){var e=t[0],r=t[1],n=r[0],i=r[1],o=r[2],a=t[2],s=t[3];if(E._markerScene.has(n.id)){var u=E._container.element,c=E._viewportCoords.canvasPosition(e,u),l=c[0],h=c[1],p=l-i[0],f=h-i[1],d=E._viewportCoords.canvasToViewport(p,f,u),m=d[0],g=d[1],y=new C.Vector3(m,g,1).unproject(o.perspective).sub(o.perspective.position).normalize(),v=Math.min(E._relativeGroundAltitude/y.z,s.visibleBBoxSize/2-.1);if(!(v<0)){var _=y.clone().multiplyScalar(v).add(o.perspective.position);_.z=o.perspective.position.z+E._relativeGroundAltitude;var b=E._geoCoords.enuToGeodetic(_.x,_.y,_.z,a.lat,a.lon,a.alt),x=b[0],w=b[1];E._markerScene.update(n.id,_.toArray(),{lat:x,lon:w}),E._markerSet.update(n);var S={marker:n,target:E,type:M.changed};E.fire(M.changed,S)}}})},M.prototype._deactivate=function(){this._adjustHeightSubscription.unsubscribe(),this._dragEventSubscription.unsubscribe(),this._markersUpdatedSubscription.unsubscribe(),this._mouseClaimSubscription.unsubscribe(),this._referenceSubscription.unsubscribe(),this._renderSubscription.unsubscribe(),this._setChangedSubscription.unsubscribe(),this._updateMarkerSubscription.unsubscribe(),this._markerScene.clear()},M.prototype._getDefaultConfiguration=function(){return{visibleBBoxSize:100}},M.componentName="marker",M.changed="changed",M.dragstart="dragstart",M.dragend="dragend",M);function M(t,e,r){var n=o.call(this,t,e,r)||this;return n._relativeGroundAltitude=-2,n._geoCoords=new c.GeoCoords,n._graphCalculator=new u.GraphCalculator,n._markerScene=new s.MarkerScene,n._markerSet=new s.MarkerSet,n._viewportCoords=new c.ViewportCoords,n}r.MarkerComponent=l,s.ComponentService.register(l),r.default=l},{"../../Component":291,"../../Geo":294,"../../Graph":295,"../../Render":297,rxjs:43,"rxjs/operators":241,three:242,when:288}],333:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t("three"),n=(Object.defineProperty(i.prototype,"markers",{get:function(){return this._markers},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:!0,configurable:!0}),i.prototype.add=function(t,e){t.id in this._markers&&this._dispose(t.id),t.createGeometry(e),this._scene.add(t.geometry);for(var r=0,n=(this._markers[t.id]=t).getInteractiveObjects();r<n.length;r++){var i=n[r];this._interactiveObjects.push(i),this._objectMarkers[i.uuid]=t.id}this._needsRender=!0},i.prototype.clear=function(){for(var t in this._markers)this._markers.hasOwnProperty&&this._dispose(t);this._needsRender=!0},i.prototype.get=function(t){return this._markers[t]},i.prototype.getAll=function(){var e=this;return Object.keys(this._markers).map(function(t){return e._markers[t]})},i.prototype.has=function(t){return t in this._markers},i.prototype.intersectObjects=function(t,e){var r=t[0],n=t[1];this._raycaster.setFromCamera(new s.Vector2(r,n),e);for(var i=0,o=this._raycaster.intersectObjects(this._interactiveObjects);i<o.length;i++){var a=o[i];if(a.object.uuid in this._objectMarkers)return this._objectMarkers[a.object.uuid]}return null},i.prototype.lerpAltitude=function(t,e,r){t in this._markers&&(this._markers[t].lerpAltitude(e,r),this._needsRender=!0)},i.prototype.remove=function(t){t in this._markers&&(this._dispose(t),this._needsRender=!0)},i.prototype.render=function(t,e){e.render(this._scene,t),this._needsRender=!1},i.prototype.update=function(t,e,r){t in this._markers&&(this._markers[t].updatePosition(e,r),this._needsRender=!0)},i.prototype._dispose=function(t){var e=this._markers[t];this._scene.remove(e.geometry);for(var r=0,n=e.getInteractiveObjects();r<n.length;r++){var i=n[r],o=this._interactiveObjects.indexOf(i);-1!==o?this._interactiveObjects.splice(o,1):console.warn("Object does not exist ("+i.id+") for "+t),delete this._objectMarkers[i.uuid]}e.disposeGeometry(),delete this._markers[t]},i);function i(t,e){this._needsRender=!1,this._interactiveObjects=[],this._markers={},this._objectMarkers={},this._raycaster=e||new s.Raycaster,this._scene=t||new s.Scene}r.MarkerScene=n,r.default=n},{three:242}],334:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rbush"),i=t("rxjs"),o=(Object.defineProperty(a.prototype,"changed$",{get:function(){return this._indexChanged$},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"updated$",{get:function(){return this._updated$},enumerable:!0,configurable:!0}),a.prototype.add=function(t){for(var e=[],r=this._hash,n=this._index,i=0,o=t;i<o.length;i++){var a=o[i],s=a.id;s in r&&(n.remove(r[s]),e.push(a));var u={lat:a.latLon.lat,lon:a.latLon.lon,marker:a};r[s]=u,n.insert(u)}0<e.length&&this._updated$.next(e),t.length>e.length&&this._indexChanged$.next(this)},a.prototype.has=function(t){return t in this._hash},a.prototype.get=function(t){return this.has(t)?this._hash[t].marker:void 0},a.prototype.getAll=function(){return this._index.all().map(function(t){return t.marker})},a.prototype.remove=function(t){for(var e=this._hash,r=this._index,n=!1,i=0,o=t;i<o.length;i++){var a=o[i];if(a in e){var s=e[a];r.remove(s),delete e[a],n=!0}}n&&this._indexChanged$.next(this)},a.prototype.removeAll=function(){this._hash={},this._index.clear(),this._indexChanged$.next(this)},a.prototype.search=function(t){var e=t[0],r=t[1];return this._index.search({maxX:r.lon,maxY:r.lat,minX:e.lon,minY:e.lat}).map(function(t){return t.marker})},a.prototype.update=function(t){var e=this._hash,r=this._index,n=t.id;if(n in e){r.remove(e[n]);var i={lat:t.latLon.lat,lon:t.latLon.lon,marker:t};e[n]=i,r.insert(i)}},a);function a(){this._hash={},this._index=n(16,[".lon",".lat",".lon",".lat"]),this._indexChanged$=new i.Subject,this._updated$=new i.Subject}r.MarkerSet=o,r.default=o},{rbush:42,rxjs:43}],335:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("three"),s=t("../../../Component"),u=(o=s.Marker,i(c,o),c.prototype._createGeometry=function(t){var e=new a.Mesh(new a.CircleGeometry(this._radius,16),new a.MeshBasicMaterial({color:this._color,opacity:this._opacity,transparent:!0}));e.up.fromArray([0,0,1]),e.renderOrder=-1;var r=new a.Object3D;r.add(e),r.position.fromArray(t),this._geometry=r},c.prototype._disposeGeometry=function(){for(var t=0,e=this._geometry.children;t<e.length;t++){var r=e[t];r.geometry.dispose(),r.material.dispose()}},c.prototype._getInteractiveObjects=function(){return[]},c);function c(t,e,r){var n=o.call(this,t,e)||this;return r=r||{},n._color=null!=r.color?r.color:16777215,n._opacity=null!=r.opacity?r.opacity:.4,n._radius=null!=r.radius?r.radius:1,n}r.CircleMarker=u,r.default=u},{"../../../Component":291,three:242}],336:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"latLon",{get:function(){return this._latLon},enumerable:!0,configurable:!0}),i.prototype.createGeometry=function(t){this._geometry||(this._createGeometry(t),this._geometry.updateMatrixWorld(!0))},i.prototype.disposeGeometry=function(){this._geometry&&(this._disposeGeometry(),this._geometry=void 0)},i.prototype.getInteractiveObjects=function(){return this._geometry?this._getInteractiveObjects():[]},i.prototype.lerpAltitude=function(t,e){this._geometry&&(this._geometry.position.z=(1-e)*this._geometry.position.z+e*t)},i.prototype.updatePosition=function(t,e){e&&(this._latLon.lat=e.lat,this._latLon.lon=e.lon),this._geometry&&(this._geometry.position.fromArray(t),this._geometry.updateMatrixWorld(!0))},i);function i(t,e){this._id=t,this._latLon=e}r.Marker=n,r.default=n},{}],337:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,w=t("three"),a=t("../../../Component"),s=(o=a.Marker,i(u,o),u.prototype._createGeometry=function(t){var e=this._radius,r=new w.Mesh(this._markerGeometry(e,8,8),new w.MeshBasicMaterial({color:this._color,opacity:this._opacity,transparent:!0}));r.renderOrder=1;var n=new w.Mesh(new w.SphereGeometry(e/2,8,8),new w.MeshBasicMaterial({color:this._ballColor,opacity:this._ballOpacity,transparent:!0}));n.position.z=this._markerHeight(e);var i=new w.Object3D;i.add(n),i.add(r),i.position.fromArray(t),this._geometry=i},u.prototype._disposeGeometry=function(){for(var t=0,e=this._geometry.children;t<e.length;t++){var r=e[t];r.geometry.dispose(),r.material.dispose()}},u.prototype._getInteractiveObjects=function(){return this._interactive?[this._geometry.children[0]]:[]},u.prototype._markerHeight=function(t){var e=Math.tan(Math.PI-this._circleToRayAngle);return t*Math.sqrt(1+e*e)},u.prototype._markerGeometry=function(t,e,r){var n=new w.Geometry;e=Math.max(3,Math.floor(e)||8),r=Math.max(2,Math.floor(r)||6);for(var i=this._markerHeight(t),o=[],a=0;a<=r;++a){for(var s=[],u=0;u<=e;++u){var c=u/e*Math.PI*2,l=a/r*Math.PI,h=void 0;if(l<this._circleToRayAngle)h=t;else{var p=Math.tan(l-this._circleToRayAngle);h=t*Math.sqrt(1+p*p)}var f=new w.Vector3;f.x=h*Math.cos(c)*Math.sin(l),f.y=h*Math.sin(c)*Math.sin(l),f.z=h*Math.cos(l)+i,n.vertices.push(f),s.push(n.vertices.length-1)}o.push(s)}for(a=0;a<r;++a)for(u=0;u<e;++u){var d=o[a][u+1],m=o[a][u],g=o[a+1][u],y=o[a+1][u+1],v=n.vertices[d].clone().normalize(),_=n.vertices[m].clone().normalize(),b=n.vertices[g].clone().normalize(),x=n.vertices[y].clone().normalize();n.faces.push(new w.Face3(d,m,y,[v,_,x])),n.faces.push(new w.Face3(m,g,y,[_.clone(),b,x.clone()]))}return n.computeFaceNormals(),n.boundingSphere=new w.Sphere(new w.Vector3,t+i),n},u);function u(t,e,r){var n=o.call(this,t,e)||this;return r=r||{},n._ballColor=null!=r.ballColor?r.ballColor:16711680,n._ballOpacity=null!=r.ballOpacity?r.ballOpacity:.8,n._circleToRayAngle=2,n._color=null!=r.color?r.color:16711680,n._interactive=!!r.interactive,n._opacity=null!=r.opacity?r.opacity:.4,n._radius=null!=r.radius?r.radius:1,n}r.SimpleMarker=s,r.default=s},{"../../../Component":291,three:242}],338:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a,o=t("rxjs"),s=t("rxjs/operators"),x=t("../../Component"),u=(a=x.HandlerBase,i(c,a),c.prototype._enable=function(){var b=this,t=this._navigator.stateService.currentState$.pipe(s.map(function(t){return t.state.alpha<1}),s.distinctUntilChanged());this._bounceSubscription=o.combineLatest(t,this._navigator.stateService.inTranslation$,this._container.mouseService.active$,this._container.touchService.active$).pipe(s.map(function(t){return t[0]||t[1]||t[2]||t[3]}),s.distinctUntilChanged(),s.switchMap(function(t){return t?o.empty():o.combineLatest(b._container.renderService.renderCamera$,b._navigator.stateService.currentTransform$.pipe(s.first()))}),s.withLatestFrom(this._navigator.panService.panNodes$)).subscribe(function(t){var e=t[0],r=e[0],n=e[1],i=t[1];if((n.hasValidScale||!(r.camera.focal<.1))&&0!==r.perspective.aspect&&r.perspective.aspect!==Number.POSITIVE_INFINITY){var o=x.ImageBoundary.viewportDistances(n,r.perspective,b._viewportCoords),a=b._viewportCoords.viewportToBasic(0,0,n,r.perspective);(a[0]<0||1<a[0])&&0<i.length&&(o[0]=o[2]=0);for(var s=0,u=i;s<u.length;s++)for(var c=u[s][1],l=x.ImageBoundary.viewportDistances(c,r.perspective,b._viewportCoords),h=1;h<o.length;h+=2)l[h]<o[h]&&(o[h]=l[h]);if(!(Math.max.apply(Math,o)<.01)){var p=o[1]-o[3],f=o[0]-o[2],d=b._viewportCoords.unprojectFromViewport(0,0,r.perspective).sub(r.perspective.position),m=b._viewportCoords.unprojectFromViewport(p,0,r.perspective).sub(r.perspective.position),g=b._viewportCoords.unprojectFromViewport(0,f,r.perspective).sub(r.perspective.position),y=(0<p?1:-1)*m.angleTo(d),v=(0<f?1:-1)*g.angleTo(d),_=Math.PI/60;y=b._spatial.clamp(.1*y,-_,_),v=b._spatial.clamp(.1*v,-_,_),b._navigator.stateService.rotateUnbounded({phi:y,theta:v})}}})},c.prototype._disable=function(){this._bounceSubscription.unsubscribe()},c.prototype._getConfiguration=function(){return{}},c);function c(t,e,r,n,i){var o=a.call(this,t,e,r)||this;return o._spatial=i,o._viewportCoords=n,o}r.BounceHandler=u,r.default=u},{"../../Component":291,rxjs:43,"rxjs/operators":241}],339:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs"),s=t("rxjs/operators"),u=t("../../Component"),c=(o=u.HandlerBase,i(l,o),l.prototype._enable=function(){var h=this;this._zoomSubscription=a.merge(this._container.mouseService.filtered$(this._component.name,this._container.mouseService.dblClick$),this._container.touchService.doubleTap$.pipe(s.map(function(t){var e=t.touches[0];return{clientX:e.clientX,clientY:e.clientY,shiftKey:t.shiftKey}}))).pipe(s.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe(function(t){var e=t[0],r=t[1],n=t[2],i=h._container.element,o=h._viewportCoords.canvasPosition(e,i),a=o[0],s=o[1],u=h._viewportCoords.unprojectFromCanvas(a,s,i,r.perspective),c=n.projectBasic(u.toArray()),l=e.shiftKey?-1:1;h._navigator.stateService.zoomIn(l,c)})},l.prototype._disable=function(){this._zoomSubscription.unsubscribe()},l.prototype._getConfiguration=function(t){return{doubleClickZoom:t}},l);function l(t,e,r,n){var i=o.call(this,t,e,r)||this;return i._viewportCoords=n,i}r.DoubleClickZoomHandler=c,r.default=c},{"../../Component":291,rxjs:43,"rxjs/operators":241}],340:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a,s=t("rxjs"),u=t("rxjs/operators"),C=t("../../Component"),o=(a=C.HandlerBase,i(c,a),c.prototype._enable=function(){var E=this,t=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragStart$).pipe(u.map(function(){return!0}),u.share()),e=this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$).pipe(u.map(function(){return!1}),u.share());this._activeMouseSubscription=s.merge(t,e).subscribe(this._container.mouseService.activate$);var r=s.merge(t,e).pipe(u.switchMap(function(t){return t?E._container.mouseService.documentMouseMove$:s.empty()}));this._preventDefaultSubscription=s.merge(r,this._container.touchService.touchMove$).subscribe(function(t){t.preventDefault()});var n=this._container.touchService.singleTouchDragStart$.pipe(u.map(function(){return!0})),i=this._container.touchService.singleTouchDragEnd$.pipe(u.map(function(){return!1}));this._activeTouchSubscription=s.merge(n,i).subscribe(this._container.touchService.activate$);var o=this._navigator.stateService.currentState$.pipe(u.map(function(t){return t.state.currentNode.fullPano||t.state.nodesAhead<1}),u.distinctUntilChanged(),u.switchMap(function(t){if(!t)return s.empty();var e=C.MouseOperator.filteredPairwiseMouseDrag$(E._component.name,E._container.mouseService),r=s.merge(E._container.touchService.singleTouchDragStart$,E._container.touchService.singleTouchDrag$,E._container.touchService.singleTouchDragEnd$.pipe(u.map(function(){return null}))).pipe(u.map(function(t){return null!=t&&0<t.touches.length?t.touches[0]:null}),u.pairwise(),u.filter(function(t){return null!=t[0]&&null!=t[1]}));return s.merge(e,r)}),u.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,this._navigator.panService.panNodes$),u.map(function(t){for(var e=t[0],r=t[1],n=t[2],i=t[3],o=e[0],a=e[1],s=a.clientX-o.clientX,u=a.clientY-o.clientY,c=E._container.element,l=E._viewportCoords.canvasPosition(a,c),h=l[0],p=l[1],f=E._viewportCoords.unprojectFromCanvas(h,p,c,r.perspective).sub(r.perspective.position),d=E._viewportCoords.unprojectFromCanvas(h-s,p,c,r.perspective).sub(r.perspective.position),m=E._viewportCoords.unprojectFromCanvas(h,p-u,c,r.perspective).sub(r.perspective.position),g=(0<s?1:-1)*d.angleTo(f),y=(0<u?-1:1)*m.angleTo(f),v=C.ImageBoundary.viewportDistances(n,r.perspective,E._viewportCoords),_=0,b=i;_<b.length;_++)for(var x=b[_][1],w=C.ImageBoundary.viewportDistances(x,r.perspective,E._viewportCoords),S=0;S<v.length;S++)w[S]<v[S]&&(v[S]=w[S]);return 0<v[0]&&y<0&&(y/=Math.max(1,200*v[0])),0<v[2]&&0<y&&(y/=Math.max(1,200*v[2])),0<v[1]&&g<0&&(g/=Math.max(1,200*v[1])),0<v[3]&&0<g&&(g/=Math.max(1,200*v[3])),{phi:g,theta:y}}),u.share());this._rotateWithoutInertiaSubscription=o.subscribe(function(t){E._navigator.stateService.rotateWithoutInertia(t)}),this._rotateSubscription=o.pipe(u.scan(function(t,e){return E._drainBuffer(t),t.push([Date.now(),e]),t},[]),u.sample(s.merge(this._container.mouseService.filtered$(this._component.name,this._container.mouseService.mouseDragEnd$),this._container.touchService.singleTouchDragEnd$)),u.map(function(t){for(var e=E._drainBuffer(t.slice()),r={phi:0,theta:0},n=0,i=e;n<i.length;n++){var o=i[n];r.phi+=o[1].phi,r.theta+=o[1].theta}var a=e.length;0<a&&(r.phi/=a,r.theta/=a);var s=Math.PI/18;return r.phi=E._spatial.clamp(r.phi,-s,s),r.theta=E._spatial.clamp(r.theta,-s,s),r})).subscribe(function(t){E._navigator.stateService.rotate(t)})},c.prototype._disable=function(){this._activeMouseSubscription.unsubscribe(),this._activeTouchSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._rotateSubscription.unsubscribe(),this._rotateWithoutInertiaSubscription.unsubscribe(),this._activeMouseSubscription=null,this._activeTouchSubscription=null,this._preventDefaultSubscription=null,this._rotateSubscription=null},c.prototype._getConfiguration=function(t){return{dragPan:t}},c.prototype._drainBuffer=function(t){for(var e=Date.now();0<t.length&&50<e-t[0][0];)t.shift();return t},c);function c(t,e,r,n,i){var o=a.call(this,t,e,r)||this;return o._spatial=i,o._viewportCoords=n,o}r.DragPanHandler=o,r.default=o},{"../../Component":291,rxjs:43,"rxjs/operators":241}],341:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a,d=t("three"),o=t("rxjs"),s=t("rxjs/operators"),u=t("../../Component"),l=t("../../State"),c=(a=u.HandlerBase,i(h,a),h.prototype._enable=function(){var c=this,t=this._navigator.stateService.state$.pipe(s.map(function(t){return t===l.State.Earth}),s.share());this._preventDefaultSubscription=t.pipe(s.switchMap(function(t){return t?c._container.mouseService.mouseWheel$:o.empty()})).subscribe(function(t){t.preventDefault()}),this._truckSubscription=t.pipe(s.switchMap(function(t){return t?u.MouseOperator.filteredPairwiseMouseDrag$(c._component.name,c._container.mouseService).pipe(s.filter(function(t){var e=t[0],r=t[1];return!(e.ctrlKey&&r.ctrlKey)})):o.empty()}),s.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),s.map(function(t){var e=t[0],r=e[0],n=e[1],i=t[1],o=[0,0,1],a=t[2].unprojectBasic([.5,.5],0);a[2]-=2;var s=c._planeIntersection(n,o,a,i.perspective,c._container.element),u=c._planeIntersection(r,o,a,i.perspective,c._container.element);return s&&u?(new d.Vector3).subVectors(s,u).multiplyScalar(-1).toArray():null}),s.filter(function(t){return!!t})).subscribe(function(t){c._navigator.stateService.truck(t)}),this._orbitSubscription=t.pipe(s.switchMap(function(t){return t?u.MouseOperator.filteredPairwiseMouseDrag$(c._component.name,c._container.mouseService).pipe(s.filter(function(t){var e=t[0],r=t[1];return e.ctrlKey&&r.ctrlKey})):o.empty()}),s.map(function(t){var e=t[0],r=t[1],n=c._eventToViewport(r,c._container.element),i=n[0],o=n[1],a=c._eventToViewport(e,c._container.element),s=a[0],u=a[1];return{phi:(s-i)*Math.PI,theta:(o-u)*Math.PI/2}})).subscribe(function(t){c._navigator.stateService.orbit(t)}),this._dollySubscription=t.pipe(s.switchMap(function(t){return t?c._container.mouseService.filteredWheel$(c._component.name,c._container.mouseService.mouseWheel$):o.empty()}),s.map(function(t){var e=t.deltaY;return 1===t.deltaMode?e*=40:2===t.deltaMode&&(e*=800),-e/c._viewportCoords.containerToCanvas(c._container.element)[1]})).subscribe(function(t){c._navigator.stateService.dolly(t)})},h.prototype._disable=function(){this._dollySubscription.unsubscribe(),this._orbitSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._truckSubscription.unsubscribe()},h.prototype._getConfiguration=function(){return{}},h.prototype._eventToViewport=function(t,e){var r=this._viewportCoords.canvasPosition(t,e);return this._viewportCoords.canvasToViewport(r[0],r[1],e)},h.prototype._planeIntersection=function(t,e,r,n,i){var o=this._viewportCoords.canvasPosition(t,i),a=o[0],s=o[1],u=this._viewportCoords.unprojectFromCanvas(a,s,i,n).sub(n.position).normalize();if(Math.abs(this._spatial.angleToPlane(u.toArray(),e))<Math.PI/90)return null;var c=n.position.clone(),l=(new d.Vector3).fromArray(e),h=(new d.Vector3).fromArray(r),p=(new d.Vector3).subVectors(h,c).dot(l)/u.clone().dot(l),f=(new d.Vector3).addVectors(c,u.multiplyScalar(p));return 0<this._viewportCoords.worldToCamera(f.toArray(),n)[2]?null:f},h);function h(t,e,r,n,i){var o=a.call(this,t,e,r)||this;return o._spatial=i,o._viewportCoords=n,o}r.EarthControlHandler=c,r.default=c},{"../../Component":291,"../../State":298,rxjs:43,"rxjs/operators":241,three:242}],342:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var z=t("../../../src/Geo");function F(t,e){return-1<=t&&t<=1&&-1<=e&&e<=1}function B(t,e){return 0<=t&&t<=1&&0<=e&&e<=1}r.viewportDistances=function(e,r,n){for(var t=function(t){for(var e=[],r=[[0,0],[1,0],[1,1],[0,1]],n=[[1,0],[0,1],[-1,0],[0,-1]],i=0;i<4;++i)for(var o=r[i],a=n[i],s=0;s<t;++s)e.push([o[0]+a[0]*s/t,o[1]+a[1]*s/t]);return e}(100).map(function(t){return n.basicToViewportSafe(t[0],t[1],e,r)}),i=[],o=[{x:-1,y:1},{x:1,y:1},{x:1,y:-1},{x:-1,y:-1}],a=[!1,!1,!1,!1],s=0;s<t.length;s++){var u=t[s],c=t[(s+1)%t.length];if(null!==u)if(null!==c){var l=u[0],h=u[1],p=c[0],f=c[1];if(F(l,h))if(F(p,f))i.push(u);else for(var d=0;d<4;d++){var m={p1:{x:l,y:h},p2:{x:p,y:f}},g={p1:o[d],p2:o[(d+1)%4]};if(z.Lines.segmentsIntersect(m,g)){var y=z.Lines.segmentIntersection(m,g);i.push(u,[y.x,y.y]),a[d]=!0}}}else F(u[0],u[1])&&i.push(u)}var v=n.viewportToBasic(-1,1,e,r),_=v[0],b=v[1],x=n.viewportToBasic(1,1,e,r),w=x[0],S=x[1],E=n.viewportToBasic(1,-1,e,r),C=E[0],M=E[1],T=n.viewportToBasic(-1,-1,e,r),P=T[0],O=T[1];B(_,b)&&(a[3]=a[0]=!0),B(w,S)&&(a[0]=a[1]=!0),B(C,M)&&(a[1]=a[2]=!0),B(P,O)&&(a[2]=a[3]=!0);for(var A=[-1,-1,1,1],I=0,L=i;I<L.length;I++){var R=L[I],N=R[0],k=R[1];N>A[1]&&(A[1]=N),N<A[3]&&(A[3]=N),k>A[0]&&(A[0]=k),k<A[2]&&(A[2]=k)}var D=[1,1,-1,-1],j=[];for(d=0;d<4;d++)a[d]?j.push(0):j.push(Math.abs(D[d]-A[d]));return j}},{"../../../src/Geo":294}],343:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a,s=t("../../Component"),u=t("../../Geo"),o=(a=s.Component,i(c,a),Object.defineProperty(c.prototype,"doubleClickZoom",{get:function(){return this._doubleClickZoomHandler},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"dragPan",{get:function(){return this._dragPanHandler},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scrollZoom",{get:function(){return this._scrollZoomHandler},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"touchZoom",{get:function(){return this._touchZoomHandler},enumerable:!0,configurable:!0}),c.prototype._activate=function(){var e=this;this._bounceHandler.enable(),this._earthControlHandler.enable(),this._configurationSubscription=this._configuration$.subscribe(function(t){t.doubleClickZoom?e._doubleClickZoomHandler.enable():e._doubleClickZoomHandler.disable(),t.dragPan?e._dragPanHandler.enable():e._dragPanHandler.disable(),t.scrollZoom?e._scrollZoomHandler.enable():e._scrollZoomHandler.disable(),t.touchZoom?e._touchZoomHandler.enable():e._touchZoomHandler.disable()}),this._container.mouseService.claimMouse(this._name,0)},c.prototype._deactivate=function(){this._container.mouseService.unclaimMouse(this._name),this._configurationSubscription.unsubscribe(),this._bounceHandler.disable(),this._doubleClickZoomHandler.disable(),this._dragPanHandler.disable(),this._earthControlHandler.disable(),this._scrollZoomHandler.disable(),this._touchZoomHandler.disable()},c.prototype._getDefaultConfiguration=function(){return{doubleClickZoom:!1,dragPan:!0,scrollZoom:!0,touchZoom:!0}},c.componentName="mouse",c);function c(t,e,r){var n=a.call(this,t,e,r)||this,i=new u.Spatial,o=new u.ViewportCoords;return n._bounceHandler=new s.BounceHandler(n,e,r,o,i),n._doubleClickZoomHandler=new s.DoubleClickZoomHandler(n,e,r,o),n._dragPanHandler=new s.DragPanHandler(n,e,r,o,i),n._earthControlHandler=new s.EarthControlHandler(n,e,r,o,i),n._scrollZoomHandler=new s.ScrollZoomHandler(n,e,r,o),n._touchZoomHandler=new s.TouchZoomHandler(n,e,r,o),n}r.MouseComponent=o,s.ComponentService.register(o),r.default=o},{"../../Component":291,"../../Geo":294}],344:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs/operators"),s=t("../../Component"),u=(o=s.HandlerBase,i(c,o),c.prototype._enable=function(){var p=this;this._container.mouseService.claimWheel(this._component.name,0),this._preventDefaultSubscription=this._container.mouseService.mouseWheel$.subscribe(function(t){t.preventDefault()}),this._zoomSubscription=this._container.mouseService.filteredWheel$(this._component.name,this._container.mouseService.mouseWheel$).pipe(a.withLatestFrom(this._navigator.stateService.currentState$,function(t,e){return[t,e]}),a.filter(function(t){var e=t[1].state;return e.currentNode.fullPano||e.nodesAhead<1}),a.map(function(t){return t[0]}),a.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$,function(t,e,r){return[t,e,r]})).subscribe(function(t){var e=t[0],r=t[1],n=t[2],i=p._container.element,o=p._viewportCoords.canvasPosition(e,i),a=o[0],s=o[1],u=p._viewportCoords.unprojectFromCanvas(a,s,i,r.perspective),c=n.projectBasic(u.toArray()),l=e.deltaY;1===e.deltaMode?l*=40:2===e.deltaMode&&(l*=800);var h=-3*l/p._viewportCoords.containerToCanvas(i)[1];p._navigator.stateService.zoomIn(h,c)})},c.prototype._disable=function(){this._container.mouseService.unclaimWheel(this._component.name),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null},c.prototype._getConfiguration=function(t){return{scrollZoom:t}},c);function c(t,e,r,n){var i=o.call(this,t,e,r)||this;return i._viewportCoords=n,i}r.ScrollZoomHandler=u,r.default=u},{"../../Component":291,"rxjs/operators":241}],345:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs"),s=t("rxjs/operators"),u=t("../../Component"),c=(o=u.HandlerBase,i(l,o),l.prototype._enable=function(){var d=this;this._preventDefaultSubscription=this._container.touchService.pinch$.subscribe(function(t){t.originalEvent.preventDefault()});var t=this._container.touchService.pinchStart$.pipe(s.map(function(t){return!0})),e=this._container.touchService.pinchEnd$.pipe(s.map(function(t){return!1}));this._activeSubscription=a.merge(t,e).subscribe(this._container.touchService.activate$),this._zoomSubscription=this._container.touchService.pinch$.pipe(s.withLatestFrom(this._navigator.stateService.currentState$),s.filter(function(t){var e=t[1].state;return e.currentNode.fullPano||e.nodesAhead<1}),s.map(function(t){return t[0]}),s.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe(function(t){var e=t[0],r=t[1],n=t[2],i=d._container.element,o=d._viewportCoords.canvasPosition(e,i),a=o[0],s=o[1],u=d._viewportCoords.unprojectFromCanvas(a,s,i,r.perspective),c=n.projectBasic(u.toArray()),l=d._viewportCoords.containerToCanvas(i),h=l[0],p=l[1],f=3*e.distanceChange/Math.min(h,p);d._navigator.stateService.zoomIn(f,c)})},l.prototype._disable=function(){this._activeSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._zoomSubscription.unsubscribe(),this._preventDefaultSubscription=null,this._zoomSubscription=null},l.prototype._getConfiguration=function(t){return{touchZoom:t}},l);function l(t,e,r,n){var i=o.call(this,t,e,r)||this;return i._viewportCoords=n,i}r.TouchZoomHandler=c,r.default=c},{"../../Component":291,rxjs:43,"rxjs/operators":241}],346:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./popup/Popup");r.Popup=n.Popup;var i=t("./PopupComponent");r.PopupComponent=i.PopupComponent},{"./PopupComponent":347,"./popup/Popup":348}],347:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,s=t("rxjs"),u=t("rxjs/operators"),a=t("../../Component"),c=t("../../Utils"),l=(o=a.Component,i(h,o),h.prototype.add=function(t){for(var e=0,r=t;e<r.length;e++){var n=r[e];-1===this._popups.indexOf(n)&&(this._popups.push(n),this._activated&&n.setParentContainer(this._popupContainer))}this._added$.next(t),this._popups$.next(this._popups)},h.prototype.getAll=function(){return this._popups.slice()},h.prototype.remove=function(t){for(var e=0,r=t;e<r.length;e++){var n=r[e];this._remove(n)}this._popups$.next(this._popups)},h.prototype.removeAll=function(){for(var t=0,e=this._popups.slice();t<e.length;t++){var r=e[t];this._remove(r)}this._popups$.next(this._popups)},h.prototype._activate=function(){var a=this;this._popupContainer=this._dom.createElement("div","mapillary-js-popup-container",this._container.element);for(var t=0,e=this._popups;t<e.length;t++)e[t].setParentContainer(this._popupContainer);this._updateAllSubscription=s.combineLatest(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$).subscribe(function(t){for(var e=t[0],r=t[1],n=t[2],i=0,o=a._popups;i<o.length;i++)o[i].update(e,r,n)});var r=this._popups$.pipe(u.startWith(this._popups),u.switchMap(function(t){return s.from(t).pipe(u.mergeMap(function(t){return t.changed$}))}),u.map(function(t){return[t]}));this._updateAddedChangedSubscription=s.merge(this._added$,r).pipe(u.withLatestFrom(this._container.renderService.renderCamera$,this._container.renderService.size$,this._navigator.stateService.currentTransform$)).subscribe(function(t){for(var e=t[0],r=t[1],n=t[2],i=t[3],o=0,a=e;o<a.length;o++)a[o].update(r,n,i)})},h.prototype._deactivate=function(){this._updateAllSubscription.unsubscribe(),this._updateAddedChangedSubscription.unsubscribe();for(var t=0,e=this._popups;t<e.length;t++)e[t].remove();this._container.element.removeChild(this._popupContainer),delete this._popupContainer},h.prototype._getDefaultConfiguration=function(){return{}},h.prototype._remove=function(t){var e=this._popups.indexOf(t);if(-1!==e){var r=this._popups.splice(e,1)[0];this._activated&&r.remove()}},h.componentName="popup",h);function h(t,e,r,n){var i=o.call(this,t,e,r)||this;return i._dom=n||new c.DOM,i._popups=[],i._added$=new s.Subject,i._popups$=new s.Subject,i}r.PopupComponent=l,a.ComponentService.register(l),r.default=l},{"../../Component":291,"../../Utils":301,rxjs:43,"rxjs/operators":241}],348:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rxjs"),i=t("../../../Geo"),o=t("../../../Utils"),_=t("../../../Viewer"),a=(Object.defineProperty(s.prototype,"changed$",{get:function(){return this._notifyChanged$},enumerable:!0,configurable:!0}),s.prototype.remove=function(){this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._container&&(this._container.parentNode.removeChild(this._container),delete this._container),this._parentContainer&&delete this._parentContainer},s.prototype.setBasicPoint=function(t){this._point=t.slice(),this._rect=null,this._notifyChanged$.next(this)},s.prototype.setBasicRect=function(t){this._rect=t.slice(),this._point=null,this._notifyChanged$.next(this)},s.prototype.setDOMContent=function(t){this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content);var e="mapillaryjs-popup-content"+(!0===this._options.clean?"-clean":"")+(!0===this._options.capturePointer?" mapillaryjs-popup-capture-pointer":"");this._content=this._dom.createElement("div",e,this._container),this._content.appendChild(t),this._notifyChanged$.next(this)},s.prototype.setHTML=function(t){var e,r=this._dom.document.createDocumentFragment(),n=this._dom.createElement("body");for(n.innerHTML=t;e=n.firstChild;)r.appendChild(e);this.setDOMContent(r)},s.prototype.setText=function(t){this.setDOMContent(this._dom.document.createTextNode(t))},s.prototype.setParentContainer=function(t){this._parentContainer=t},s.prototype.update=function(t,e,r){var n;if(this._parentContainer&&this._content&&(this._point||this._rect)){if(!this._container){if(this._container=this._dom.createElement("div","mapillaryjs-popup",this._parentContainer),!0!==this._options.clean&&this._options.float!==_.Alignment.Center){var i="mapillaryjs-popup-tip"+(!0===this._options.capturePointer?" mapillaryjs-popup-capture-pointer":"");this._tip=this._dom.createElement("div",i,this._container),this._dom.createElement("div","mapillaryjs-popup-tip-inner",this._tip)}this._container.appendChild(this._content),this._parentContainer.appendChild(this._container),null!=this._options.opacity&&(this._container.style.opacity=this._options.opacity.toString())}var o=null,a=this._alignmentToPopupAligment(this._options.position),s=this._alignmentToPopupAligment(this._options.float),u=this._container.classList;if(null!=this._point)o=this._viewportCoords.basicToCanvasSafe(this._point[0],this._point[1],{offsetHeight:e.height,offsetWidth:e.width},r,t.perspective);else{for(var c=null,l=0,h=["center","top","bottom","left","right","top-left","top-right","bottom-left","bottom-right"];l<h.length;l++){var p=h[l];if(u.contains("mapillaryjs-popup-float-"+p)){c=p;break}}o=(n=this._rectToPixel(this._rect,a,c,t,e,r))[0],a=n[1],s=s||a}if(null!=o){if(this._container.style.display="",!s){var f=this._container.offsetWidth,d=this._container.offsetHeight,m=this._pixelToFloats(o,e,f,d);s=0===m.length?"top":m.join("-")}var g=this._normalizeOffset(this._options.offset);o=[o[0]+g[s][0],o[1]+g[s][1]],o=[Math.round(o[0]),Math.round(o[1])];var y={bottom:"translate(-50%,0)","bottom-left":"translate(-100%,0)","bottom-right":"translate(0,0)",center:"translate(-50%,-50%)",left:"translate(-100%,-50%)",right:"translate(0,-50%)",top:"translate(-50%,-100%)","top-left":"translate(-100%,-100%)","top-right":"translate(0,-100%)"};for(var v in y)y.hasOwnProperty(v)&&u.remove("mapillaryjs-popup-float-"+v);u.add("mapillaryjs-popup-float-"+s),this._container.style.transform=y[s]+" translate("+o[0]+"px,"+o[1]+"px)"}else this._container.style.display="none"}},s.prototype._rectToPixel=function(t,e,r,n,i,o){if(!e){for(var a=this._container.offsetWidth,s=this._container.offsetHeight,u={bottom:[0,s/2],"bottom-left":[-a/2,s/2],"bottom-right":[a/2,s/2],left:[-a/2,0],right:[a/2,0],top:[0,-s/2],"top-left":[-a/2,-s/2],"top-right":[a/2,-s/2]},c=[0,null,null],l=0,h=["top","bottom","left","right"];l<h.length;l++){var p=h[l],f=this._pointFromRectPosition(t,p),d=this._viewportCoords.basicToCanvasSafe(f[0],f[1],{offsetHeight:i.height,offsetWidth:i.width},o,n.perspective);if(null!=d){var m=u[p],g=[d[0]+m[0],d[1]+m[1]],y=null!=r&&r===p?1:.7;if(0===this._pixelToFloats(g,i,a/y,s/(2*y)).length&&0<d[0]&&d[0]<i.width&&0<d[1]&&d[1]<i.height)return[d,p];var v=Math.max(g[0]-a/2,0),_=Math.min(g[0]+a/2,i.width),b=Math.max(g[1]-s/2,0),x=Math.min(g[1]+s/2,i.height),w=y*Math.max(0,_-v)*Math.max(0,x-b);w>c[0]&&(c[0]=w,c[1]=d,c[2]=p)}}if(0<c[0])return[c[1],c[2]]}var S=this._pointFromRectPosition(t,e);return[this._viewportCoords.basicToCanvasSafe(S[0],S[1],{offsetHeight:i.height,offsetWidth:i.width},o,n.perspective),null!=e?e:"top"]},s.prototype._alignmentToPopupAligment=function(t){switch(t){case _.Alignment.Bottom:return"bottom";case _.Alignment.BottomLeft:return"bottom-left";case _.Alignment.BottomRight:return"bottom-right";case _.Alignment.Center:return"center";case _.Alignment.Left:return"left";case _.Alignment.Right:return"right";case _.Alignment.Top:return"top";case _.Alignment.TopLeft:return"top-left";case _.Alignment.TopRight:return"top-right";default:return null}},s.prototype._normalizeOffset=function(t){if(null==t)return this._normalizeOffset(0);if("number"!=typeof t)return{bottom:t.bottom||[0,0],"bottom-left":t.bottomLeft||[0,0],"bottom-right":t.bottomRight||[0,0],center:t.center||[0,0],left:t.left||[0,0],right:t.right||[0,0],top:t.top||[0,0],"top-left":t.topLeft||[0,0],"top-right":t.topRight||[0,0]};var e=t,r=(0<=e?1:-1)*Math.round(Math.sqrt(.5*Math.pow(e,2)));return{bottom:[0,e],"bottom-left":[-r,r],"bottom-right":[r,r],center:[0,0],left:[-e,0],right:[e,0],top:[0,-e],"top-left":[-r,-r],"top-right":[r,-r]}},s.prototype._pixelToFloats=function(t,e,r,n){var i=[];return t[1]<n?i.push("bottom"):t[1]>e.height-n&&i.push("top"),t[0]<r/2?i.push("right"):t[0]>e.width-r/2&&i.push("left"),i},s.prototype._pointFromRectPosition=function(t,e){var r=t[0],n=t[0]<t[2]?t[2]:t[2]+1,i=t[1],o=t[3];switch(e){case"bottom":return[(r+n)/2,o];case"bottom-left":return[r,o];case"bottom-right":return[n,o];case"center":return[(r+n)/2,(i+o)/2];case"left":return[r,(i+o)/2];case"right":return[n,(i+o)/2];case"top":return[(r+n)/2,i];case"top-left":return[r,i];case"top-right":return[n,i];default:return[(r+n)/2,o]}},s);function s(t,e,r){this._options={},t=t||{},this._options.capturePointer=!1!==t.capturePointer||t.capturePointer,this._options.clean=t.clean,this._options.float=t.float,this._options.offset=t.offset,this._options.opacity=t.opacity,this._options.position=t.position,this._dom=r||new o.DOM,this._viewportCoords=e||new i.ViewportCoords,this._notifyChanged$=new n.Subject}r.Popup=a,r.default=a},{"../../../Geo":294,"../../../Utils":301,"../../../Viewer":302,rxjs:43}],349:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a,u=t("rxjs"),c=t("rxjs/operators"),s=t("../../Component"),o=t("../../Edge"),l=t("../../Graph"),h=(a=s.Component,i(p,a),Object.defineProperty(p.prototype,"hoveredKey$",{get:function(){return this._hoveredKey$},enumerable:!0,configurable:!0}),p.prototype.play=function(){this.configure({playing:!0})},p.prototype.stop=function(){this.configure({playing:!1})},p.prototype.setDirection=function(t){this.configure({direction:t})},p.prototype.setHighlightKey=function(t){this.configure({highlightKey:t})},p.prototype.setMaxWidth=function(t){this.configure({maxWidth:t})},p.prototype.setMinWidth=function(t){this.configure({minWidth:t})},p.prototype.setVisible=function(t){this.configure({visible:t})},p.prototype._activate=function(){var s=this;this._sequenceDOMRenderer.activate();var e=this._navigator.stateService.currentNode$.pipe(c.switchMap(function(t){return t.sequenceEdges$}),c.publishReplay(1),c.refCount()),t=this._navigator.stateService.currentNode$.pipe(c.distinctUntilChanged(void 0,function(t){return t.sequenceKey}),c.switchMap(function(t){return u.concat(u.of(null),s._navigator.graphService.cacheSequence$(t.sequenceKey).pipe(c.retry(3),c.catchError(function(t){return console.error("Failed to cache sequence",t),u.of(null)})))}),c.startWith(null),c.publishReplay(1),c.refCount());this._sequenceSubscription=t.subscribe();var i=this._sequenceDOMRenderer.index$.pipe(c.withLatestFrom(t),c.map(function(t){var e=t[0],r=t[1];return null!=r?r.keys[e]:null}),c.filter(function(t){return!!t}),c.distinctUntilChanged(),c.publish(),c.refCount());this._moveSubscription=u.merge(i.pipe(c.debounceTime(100,this._scheduler)),i.pipe(c.auditTime(400,this._scheduler))).pipe(c.distinctUntilChanged(),c.switchMap(function(t){return s._navigator.moveToKey$(t).pipe(c.catchError(function(t){return u.empty()}))})).subscribe(),this._setSequenceGraphModeSubscription=this._sequenceDOMRenderer.changingPositionChanged$.pipe(c.filter(function(t){return t})).subscribe(function(){s._navigator.graphService.setGraphMode(l.GraphMode.Sequence)}),this._setSpatialGraphModeSubscription=this._sequenceDOMRenderer.changingPositionChanged$.pipe(c.filter(function(t){return!t})).subscribe(function(){s._navigator.graphService.setGraphMode(l.GraphMode.Spatial)}),this._navigator.graphService.graphMode$.pipe(c.switchMap(function(t){return t===l.GraphMode.Spatial?s._navigator.stateService.currentNode$.pipe(c.take(2)):u.empty()}),c.filter(function(t){return!t.spatialEdges.cached}),c.switchMap(function(t){return s._navigator.graphService.cacheNode$(t.key).pipe(c.catchError(function(t){return u.empty()}))})).subscribe(),this._stopSubscription=this._sequenceDOMRenderer.changingPositionChanged$.pipe(c.filter(function(t){return t})).subscribe(function(){s._navigator.playService.stop()}),this._cacheSequenceNodesSubscription=u.combineLatest(this._navigator.graphService.graphMode$,this._sequenceDOMRenderer.changingPositionChanged$.pipe(c.startWith(!1),c.distinctUntilChanged())).pipe(c.withLatestFrom(this._navigator.stateService.currentNode$),c.switchMap(function(t){var e=t[0],r=e[0],n=e[1],i=t[1];return n&&r===l.GraphMode.Sequence?s._navigator.graphService.cacheSequenceNodes$(i.sequenceKey,i.key).pipe(c.retry(3),c.catchError(function(t){return console.error("Failed to cache sequence nodes.",t),u.empty()})):u.empty()})).subscribe();var r=t.pipe(c.switchMap(function(r){if(!r)return u.of({index:null,max:null});var n=!0;return s._sequenceDOMRenderer.changingPositionChanged$.pipe(c.startWith(!1),c.distinctUntilChanged(),c.switchMap(function(t){var e=!t&&n?0:1;return n=!1,t?i:s._navigator.stateService.currentNode$.pipe(c.map(function(t){return t.key}),c.distinctUntilChanged(),c.skip(e))}),c.map(function(t){var e=r.keys.indexOf(t);return-1===e?{index:null,max:null}:{index:e,max:r.keys.length-1}}))}));this._renderSubscription=u.combineLatest(e,this._configuration$,this._containerWidth$,this._sequenceDOMRenderer.changed$.pipe(c.startWith(this._sequenceDOMRenderer)),this._navigator.playService.speed$,r).pipe(c.map(function(t){var e=t[0],r=t[1],n=t[2],i=(t[3],t[4]),o=t[5],a=s._sequenceDOMRenderer.render(e,r,n,i,o.index,o.max,s,s._navigator);return{name:s._name,vnode:a}})).subscribe(this._container.domRenderer.render$),this._setSpeedSubscription=this._sequenceDOMRenderer.speed$.subscribe(function(t){s._navigator.playService.setSpeed(t)}),this._setDirectionSubscription=this._configuration$.pipe(c.map(function(t){return t.direction}),c.distinctUntilChanged()).subscribe(function(t){s._navigator.playService.setDirection(t)}),this._containerWidthSubscription=u.combineLatest(this._container.renderService.size$,this._configuration$.pipe(c.distinctUntilChanged(function(t,e){return t[0]===e[0]&&t[1]===e[1]},function(t){return[t.minWidth,t.maxWidth]}))).pipe(c.map(function(t){var e=t[0],r=t[1];return s._sequenceDOMRenderer.getContainerWidth(e,r)})).subscribe(this._containerWidth$),this._playingSubscription=this._configuration$.pipe(c.map(function(t){return t.playing}),c.distinctUntilChanged()).subscribe(function(t){t?s._navigator.playService.play():s._navigator.playService.stop()}),this._hoveredKeySubscription=this._sequenceDOMRenderer.mouseEnterDirection$.pipe(c.switchMap(function(i){var t=e.pipe(c.map(function(t){for(var e=0,r=t.edges;e<r.length;e++){var n=r[e];if(n.data.direction===i)return n.to}return null}),c.takeUntil(s._sequenceDOMRenderer.mouseLeaveDirection$));return u.concat(t,u.of(null))}),c.distinctUntilChanged()).subscribe(this._hoveredKeySubject$),this._emitHoveredKeySubscription=this._hoveredKey$.subscribe(function(t){s.fire(p.hoveredkeychanged,t)})},p.prototype._deactivate=function(){this._emitHoveredKeySubscription.unsubscribe(),this._renderSubscription.unsubscribe(),this._playingSubscription.unsubscribe(),this._containerWidthSubscription.unsubscribe(),this._hoveredKeySubscription.unsubscribe(),this._setSpeedSubscription.unsubscribe(),this._setDirectionSubscription.unsubscribe(),this._setSequenceGraphModeSubscription.unsubscribe(),this._setSpatialGraphModeSubscription.unsubscribe(),this._sequenceSubscription.unsubscribe(),this._moveSubscription.unsubscribe(),this._cacheSequenceNodesSubscription.unsubscribe(),this._stopSubscription.unsubscribe(),this._sequenceDOMRenderer.deactivate()},p.prototype._getDefaultConfiguration=function(){return{direction:o.EdgeDirection.Next,maxWidth:108,minWidth:70,playing:!1,visible:!0}},p.componentName="sequence",p.playingchanged="playingchanged",p.hoveredkeychanged="hoveredkeychanged",p);function p(t,e,r,n,i){var o=a.call(this,t,e,r)||this;return o._sequenceDOMRenderer=n||new s.SequenceDOMRenderer(e),o._scheduler=i,o._containerWidth$=new u.Subject,o._hoveredKeySubject$=new u.Subject,o._hoveredKey$=o._hoveredKeySubject$.pipe(c.share()),o._navigator.playService.playing$.pipe(c.skip(1),c.withLatestFrom(o._configuration$)).subscribe(function(t){var e=t[0],r=t[1];o.fire(p.playingchanged,e),e!==r.playing&&(e?o.play():o.stop())}),o._navigator.playService.direction$.pipe(c.skip(1),c.withLatestFrom(o._configuration$)).subscribe(function(t){var e=t[0];e!==t[1].direction&&o.setDirection(e)}),o}r.SequenceComponent=h,s.ComponentService.register(h),r.default=h},{"../../Component":291,"../../Edge":292,"../../Graph":295,rxjs:43,"rxjs/operators":241}],350:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rxjs"),i=t("rxjs/operators"),b=t("virtual-dom"),x=t("../../Component"),w=t("../../Edge"),f=t("../../Error"),o=(Object.defineProperty(a.prototype,"changed$",{get:function(){return this._notifyChanged$},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"changingPositionChanged$",{get:function(){return this._notifyChangingPositionChanged$},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"speed$",{get:function(){return this._notifySpeedChanged$},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"index$",{get:function(){return this._notifyIndexChanged$},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"mouseEnterDirection$",{get:function(){return this._mouseEnterDirection$},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"mouseLeaveDirection$",{get:function(){return this._mouseLeaveDirection$},enumerable:!0,configurable:!0}),a.prototype.activate=function(){var e=this;this._changingSubscription||(this._changingSubscription=n.merge(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(i.filter(function(t){return 0===t.touches.length}))).subscribe(function(t){e._changingSpeed&&(e._changingSpeed=!1),e._changingPosition&&e._setChangingPosition(!1)}))},a.prototype.deactivate=function(){this._changingSubscription&&(this._changingSpeed=!1,this._changingPosition=!1,this._expandControls=!1,this._mode=x.SequenceMode.Default,this._changingSubscription.unsubscribe(),this._changingSubscription=null)},a.prototype.render=function(t,e,r,n,i,o,a,s){if(!1===e.visible)return b.h("div.SequenceContainer",{},[]);var u=this._createStepper(t,e,r,a,s),c=this._createSequenceControls(r),l=this._createPlaybackControls(r,n,a,e),h=this._createTimelineControls(r,i,o);return b.h("div.SequenceContainer",[u,c,l,h])},a.prototype.getContainerWidth=function(t,e){var r=e.minWidth,n=e.maxWidth;n<r&&(n=r);var i=(t.width-this._minThresholdWidth)/(this._maxThresholdWidth-this._minThresholdWidth),o=(t.height-this._minThresholdHeight)/(this._maxThresholdHeight-this._minThresholdHeight);return r+Math.max(0,Math.min(1,Math.min(i,o)))*(n-r)},a.prototype._createPositionInput=function(t,e){var r=this;function n(t){r._index=Number(t.target.value),r._notifyIndexChanged$.next(r._index)}function i(t){t.stopPropagation(),r._setChangingPosition(!0)}function o(t){!0===r._changingPosition&&t.stopPropagation()}this._index=t;var a=this._container.domContainer.getBoundingClientRect(),s={max:null!=e?e:1,min:0,onchange:n,oninput:n,onkeydown:function(t){"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key&&"ArrowUp"!==t.key||t.preventDefault()},onmousedown:i,onmousemove:o,ontouchmove:o,ontouchstart:i,style:{width:Math.max(276,Math.min(410,5+.8*a.width))-65+"px"},type:"range",value:null!=t?t:0},u=null==t||null==e||e<=1;u&&(s.disabled="true");var c=b.h("input.SequencePosition",s,[]),l=u?".SequencePositionContainerDisabled":".SequencePositionContainer";return b.h("div"+l,[c])},a.prototype._createSpeedInput=function(t){var e=this;function r(t){e._speed=Number(t.target.value)/1e3,e._notifySpeedChanged$.next(e._speed)}function n(t){e._changingSpeed=!0,t.stopPropagation()}function i(t){!0===e._changingSpeed&&t.stopPropagation()}this._speed=t;var o=this._container.domContainer.getBoundingClientRect(),a=Math.max(276,Math.min(410,5+.8*o.width))-160,s=b.h("input.SequenceSpeed",{max:1e3,min:0,onchange:r,oninput:r,onkeydown:function(t){"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key&&"ArrowUp"!==t.key||t.preventDefault()},onmousedown:n,onmousemove:i,ontouchmove:i,ontouchstart:n,style:{width:a+"px"},type:"range",value:1e3*t},[]);return b.h("div.SequenceSpeedContainer",[s])},a.prototype._createPlaybackControls=function(t,e,r,n){var i=this;if(this._mode!==x.SequenceMode.Playback)return b.h("div.SequencePlayback",[]);var o=b.h("div.SequenceSwitchIcon.SequenceIconVisible",[]),a=n.direction===w.EdgeDirection.Next?w.EdgeDirection.Prev:w.EdgeDirection.Next,s=n.playing,u={onclick:function(){s||r.setDirection(a)}},c=n.playing?".SequenceSwitchButtonDisabled":".SequenceSwitchButton",l=b.h("div"+c,u,[o]),h=b.h("div.SequenceSlowIcon.SequenceIconVisible",[]),p=b.h("div.SequenceSlowContainer",[h]),f=b.h("div.SequenceFastIcon.SequenceIconVisible",[]),d=b.h("div.SequenceFastContainer",[f]),m=b.h("div.SequenceCloseIcon.SequenceIconVisible",[]),g={onclick:function(){i._mode=x.SequenceMode.Default,i._notifyChanged$.next(i)}},y=b.h("div.SequenceCloseButton",g,[m]),v=[l,p,this._createSpeedInput(e),d,y],_={style:{top:Math.round(t/this._stepperDefaultWidth*this._defaultHeight+10)+"px"}};return b.h("div.SequencePlayback",_,v)},a.prototype._createPlayingButton=function(t,e,r,n){var i=r.direction===w.EdgeDirection.Next&&null!=t||r.direction===w.EdgeDirection.Prev&&null!=e,o={onclick:r.playing?function(t){n.stop()}:i?function(t){n.play()}:null},a={className:r.playing?"Stop":i?"Play":"PlayDisabled"};r.direction===w.EdgeDirection.Prev&&(a.style={transform:"rotate(180deg) translate(50%, 50%)"});var s=b.h("div.SequenceComponentIcon",a,[]),u=i?"SequencePlay":"SequencePlayDisabled";return b.h("div."+u,o,[s])},a.prototype._createSequenceControls=function(t){var e=this,r=Math.round(8/this._stepperDefaultWidth*t),n={onclick:function(){e._expandControls=!e._expandControls,e._mode=x.SequenceMode.Default,e._notifyChanged$.next(e)},style:{"border-bottom-right-radius":r+"px","border-top-right-radius":r+"px"}},i=b.h("div.SequenceExpanderBar",[]),o=b.h("div.SequenceExpanderButton",n,[i]),a=this._mode===x.SequenceMode.Playback?".SequenceFastIconGrey.SequenceIconVisible":".SequenceFastIcon",s=b.h("div"+a,[]),u={onclick:function(){e._mode=e._mode===x.SequenceMode.Playback?x.SequenceMode.Default:x.SequenceMode.Playback,e._notifyChanged$.next(e)}},c=b.h("div.SequencePlaybackButton",u,[s]),l=this._mode===x.SequenceMode.Timeline?".SequenceTimelineIconGrey.SequenceIconVisible":".SequenceTimelineIcon",h=b.h("div"+l,[]),p={onclick:function(){e._mode=e._mode===x.SequenceMode.Timeline?x.SequenceMode.Default:x.SequenceMode.Timeline,e._notifyChanged$.next(e)}},f=b.h("div.SequenceTimelineButton",p,[h]),d={style:{height:this._defaultHeight/this._stepperDefaultWidth*t+"px",transform:"translate("+(t/2+2)+"px, 0)",width:this._controlsDefaultWidth/this._stepperDefaultWidth*t+"px"}},m=".SequenceControls"+(this._expandControls?".SequenceControlsExpanded":"");return b.h("div"+m,d,[c,f,o])},a.prototype._createSequenceArrows=function(t,e,r,n,i){var o=this,a={onclick:null!=t?function(t){i.moveDir$(w.EdgeDirection.Next).subscribe(void 0,function(t){t instanceof f.AbortMapillaryError||console.error(t)})}:null,onmouseenter:function(t){o._mouseEnterDirection$.next(w.EdgeDirection.Next)},onmouseleave:function(t){o._mouseLeaveDirection$.next(w.EdgeDirection.Next)}},s=Math.round(8/this._stepperDefaultWidth*r),u={onclick:null!=e?function(t){i.moveDir$(w.EdgeDirection.Prev).subscribe(void 0,function(t){t instanceof f.AbortMapillaryError||console.error(t)})}:null,onmouseenter:function(t){o._mouseEnterDirection$.next(w.EdgeDirection.Prev)},onmouseleave:function(t){o._mouseLeaveDirection$.next(w.EdgeDirection.Prev)},style:{"border-bottom-left-radius":s+"px","border-top-left-radius":s+"px"}},c=this._getStepClassName(w.EdgeDirection.Next,t,n.highlightKey),l=this._getStepClassName(w.EdgeDirection.Prev,e,n.highlightKey),h=b.h("div.SequenceComponentIcon",[]),p=b.h("div.SequenceComponentIcon",[]);return[b.h("div."+l,u,[p]),b.h("div."+c,a,[h])]},a.prototype._createStepper=function(t,e,r,n,i){for(var o=null,a=null,s=0,u=t.edges;s<u.length;s++){var c=u[s];c.data.direction===w.EdgeDirection.Next&&(o=c.to),c.data.direction===w.EdgeDirection.Prev&&(a=c.to)}var l=this._createPlayingButton(o,a,e,n),h=this._createSequenceArrows(o,a,r,e,i);h.splice(1,0,l);var p={oncontextmenu:function(t){t.preventDefault()},style:{height:this._defaultHeight/this._stepperDefaultWidth*r+"px",width:r+"px"}};return b.h("div.SequenceStepper",p,h)},a.prototype._createTimelineControls=function(t,e,r){var n=this;if(this._mode!==x.SequenceMode.Timeline)return b.h("div.SequenceTimeline",[]);var i=this._createPositionInput(e,r),o=b.h("div.SequenceCloseIcon.SequenceIconVisible",[]),a={onclick:function(){n._mode=x.SequenceMode.Default,n._notifyChanged$.next(n)}},s=b.h("div.SequenceCloseButton",a,[o]),u={style:{top:Math.round(t/this._stepperDefaultWidth*this._defaultHeight+10)+"px"}};return b.h("div.SequenceTimeline",u,[i,s])},a.prototype._getStepClassName=function(t,e,r){var n=t===w.EdgeDirection.Next?"SequenceStepNext":"SequenceStepPrev";return null==e?n+="Disabled":r===e&&(n+="Highlight"),n},a.prototype._setChangingPosition=function(t){this._changingPosition=t,this._notifyChangingPositionChanged$.next(t)},a);function a(t){this._container=t,this._minThresholdWidth=320,this._maxThresholdWidth=1480,this._minThresholdHeight=240,this._maxThresholdHeight=820,this._stepperDefaultWidth=108,this._controlsDefaultWidth=88,this._defaultHeight=30,this._expandControls=!1,this._mode=x.SequenceMode.Default,this._speed=.5,this._changingSpeed=!1,this._index=null,this._changingPosition=!1,this._mouseEnterDirection$=new n.Subject,this._mouseLeaveDirection$=new n.Subject,this._notifyChanged$=new n.Subject,this._notifyChangingPositionChanged$=new n.Subject,this._notifySpeedChanged$=new n.Subject,this._notifyIndexChanged$=new n.Subject}r.SequenceDOMRenderer=o,r.default=o},{"../../Component":291,"../../Edge":292,"../../Error":293,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],351:[function(t,e,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),(i=n=r.SequenceMode||(r.SequenceMode={}))[i.Default=0]="Default",i[i.Playback=1]="Playback",i[i.Timeline=2]="Timeline",r.default=n},{}],352:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});t("path");var n=(i.equirectangular={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float phiLength;\nuniform float phiShift;\nuniform float thetaLength;\nuniform float thetaShift;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lon = atan(b.x, b.z);\n    float x = (lon - phiShift) / phiLength + 0.5;\n    float y = (lat - thetaShift) / thetaLength + 0.5;\n    vec4 baseColor = texture2D(projectorTex, vec2(x, y));\n    baseColor.a = opacity;\n    gl_FragColor = baseColor;\n}",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},i.equirectangularCurtain={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float curtain;\nuniform float opacity;\nuniform float phiLength;\nuniform float phiShift;\nuniform float thetaLength;\nuniform float thetaShift;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vec3 b = normalize(vRstq.xyz);\n    float lat = -asin(b.y);\n    float lon = atan(b.x, b.z);\n    float x = (lon - phiShift) / phiLength + 0.5;\n    float y = (lat - thetaShift) / thetaLength + 0.5;\n\n    bool inverted = curtain < 0.5;\n\n    float curtainMin = inverted ? curtain + 0.5 : curtain - 0.5;\n    float curtainMax = curtain;\n\n    bool insideCurtain = inverted ?\n        x > curtainMin || x < curtainMax :\n        x > curtainMin && x < curtainMax;\n\n    vec4 baseColor;\n    if (insideCurtain) {\n        baseColor = texture2D(projectorTex, vec2(x, y));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},i.perspective={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.z;\n    float y = vRstq.y / vRstq.z;\n    float r2 = x * x + y * y;\n\n    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {\n        r2 = radial_peak * radial_peak;\n    }\n\n    float d = 1.0 + k1 * r2 + k2 * r2 * r2;\n    float u = scale_x * focal * d * x + 0.5;\n    float v = - scale_y * focal * d * y + 0.5;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},i.perspectiveCurtain={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x / vRstq.z;\n    float y = vRstq.y / vRstq.z;\n    float r2 = x * x + y * y;\n\n    if (radial_peak > 0. && r2 > radial_peak * sqrt(r2)) {\n        r2 = radial_peak * radial_peak;\n    }\n\n    float d = 1.0 + k1 * r2 + k2 * r2 * r2;\n    float u = scale_x * focal * d * x + 0.5;\n    float v = - scale_y * focal * d * y + 0.5;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},i.fisheye={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x;\n    float y = vRstq.y;\n    float z = vRstq.z;\n\n    float r = sqrt(x * x + y * y);\n    float theta = atan(r, z);\n\n    if (radial_peak > 0. && theta > radial_peak) {\n        theta = radial_peak;\n    }\n\n    float theta2 = theta * theta;\n    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));\n    float s = focal * theta_d / r;\n\n    float u = scale_x * s * x + 0.5;\n    float v = -scale_y * s * y + 0.5;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},i.fisheyeCurtain={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float focal;\nuniform float k1;\nuniform float k2;\nuniform float scale_x;\nuniform float scale_y;\nuniform float radial_peak;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float x = vRstq.x;\n    float y = vRstq.y;\n    float z = vRstq.z;\n\n    float r2 = sqrt(x * x + y * y);\n    float theta = atan(r2, z);\n\n    if (radial_peak > 0. && theta > radial_peak) {\n        theta = radial_peak;\n    }\n\n    float theta2 = theta * theta;\n    float theta_d = theta * (1.0 + theta2 * (k1 + theta2 * k2));\n    float s = focal * theta_d / r2;\n\n    float u = scale_x * s * x + 0.5;\n    float v = -scale_y * s * y + 0.5;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},i.perspectiveDistorted={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float u = vRstq.x / vRstq.w;\n    float v = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if (u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},i.perspectiveDistortedCurtain={fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D projectorTex;\nuniform float opacity;\nuniform float curtain;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    float u = vRstq.x / vRstq.w;\n    float v = vRstq.y / vRstq.w;\n\n    vec4 baseColor;\n    if ((u < curtain || curtain >= 1.0) && u >= 0. && u <= 1. && v >= 0. && v <= 1.) {\n        baseColor = texture2D(projectorTex, vec2(u, v));\n        baseColor.a = opacity;\n    } else {\n        baseColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }\n\n    gl_FragColor = baseColor;\n}\n",vertex:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform mat4 projectorMat;\n\nvarying vec4 vRstq;\n\nvoid main()\n{\n    vRstq = projectorMat * vec4(position, 1.0);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},i);function i(){}r.Shaders=n},{path:39}],353:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,f=t("rxjs"),d=t("rxjs/operators"),m=t("../../Component"),a=t("../../Geo"),g=t("../../State"),y=t("../../Render"),v=t("../../Tiles"),_=t("../../Utils"),s=(o=m.Component,i(u,o),u.prototype.setInitialPosition=function(t){this.configure({initialPosition:t})},u.prototype.setKeys=function(t){this.configure({keys:t})},u.prototype.setSliderMode=function(t){this.configure({mode:t})},u.prototype.setSliderVisible=function(t){this.configure({sliderVisible:t})},u.prototype._activate=function(){var D=this;this._modeSubcription=this._domRenderer.mode$.subscribe(function(t){D.setSliderMode(t)}),this._glRenderSubscription=this._glRenderer$.pipe(d.map(function(t){return{name:D._name,render:{frameId:t.frameId,needsRender:t.needsRender,render:t.render.bind(t),stage:y.GLRenderStage.Background}}})).subscribe(this._container.glRenderer.render$);var t=f.concat(this.configuration$.pipe(d.map(function(t){return null!=t.initialPosition?t.initialPosition:1}),d.first()),this._domRenderer.position$),e=this.configuration$.pipe(d.map(function(t){return t.mode}),d.distinctUntilChanged()),r=this._navigator.stateService.currentState$.pipe(d.map(function(t){return t.state.motionless}),d.distinctUntilChanged()),n=this._navigator.stateService.currentState$.pipe(d.map(function(t){return t.state.currentNode.fullPano}),d.distinctUntilChanged()),i=f.combineLatest(this._configuration$.pipe(d.map(function(t){return t.sliderVisible})),this._navigator.stateService.currentState$.pipe(d.map(function(t){return!(null==t.state.currentNode||null==t.state.previousNode||t.state.currentNode.pano&&!t.state.currentNode.fullPano||t.state.previousNode.pano&&!t.state.previousNode.fullPano||t.state.currentNode.fullPano&&!t.state.previousNode.fullPano)}),d.distinctUntilChanged())).pipe(d.map(function(t){var e=t[0],r=t[1];return e&&r}),d.distinctUntilChanged());this._waitSubscription=f.combineLatest(e,r,n,i).pipe(d.withLatestFrom(this._navigator.stateService.state$)).subscribe(function(t){var e=t[0],r=e[0],n=e[1],i=e[2],o=e[3],a=t[1],s=o&&(n||r===m.SliderMode.Stationary||i);s&&a!==g.State.WaitingInteractively?D._navigator.stateService.waitInteractively():s||a===g.State.Waiting||D._navigator.stateService.wait()}),this._moveSubscription=f.combineLatest(t,e,r,n,i).subscribe(function(t){var e=t[0],r=t[1],n=t[2],i=t[3];t[4],n||r===m.SliderMode.Stationary||i?D._navigator.stateService.moveTo(1):D._navigator.stateService.moveTo(e)}),this._domRenderSubscription=f.combineLatest(t,e,r,n,i,this._container.renderService.size$).pipe(d.map(function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4];return t[5],{name:D._name,vnode:D._domRenderer.render(e,r,n,i,o)}})).subscribe(this._container.domRenderer.render$),this._glRendererCreator$.next(null),this._updateCurtainSubscription=f.combineLatest(t,n,i,this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(d.map(function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4];if(!r)return n?e:1;var a=D._viewportCoords.viewportToBasic(-1.15,0,o,i.perspective),s=D._viewportCoords.viewportToBasic(1.15,0,o,i.perspective),u=s[0]<a[0]?s[0]+1:s[0],c=a[0]+e*(u-a[0]);return 1<c?c-1:c}),d.map(function(e){return function(t){return t.updateCurtain(e),t}})).subscribe(this._glRendererOperation$),this._stateSubscription=f.combineLatest(this._navigator.stateService.currentState$,e).pipe(d.map(function(t){var e=t[0],r=t[1];return function(t){return t.update(e,r),t}})).subscribe(this._glRendererOperation$),this._setKeysSubscription=this._configuration$.pipe(d.filter(function(t){return null!=t.keys}),d.switchMap(function(t){return f.zip(f.zip(D._catchCacheNode$(t.keys.background),D._catchCacheNode$(t.keys.foreground)).pipe(d.map(function(t){return{background:t[0],foreground:t[1]}})),D._navigator.stateService.currentState$.pipe(d.first())).pipe(d.map(function(t){return{nodes:t[0],state:t[1].state}}))})).subscribe(function(t){null!=t.state.currentNode&&null!=t.state.previousNode&&t.state.currentNode.key===t.nodes.foreground.key&&t.state.previousNode.key===t.nodes.background.key||(t.state.currentNode.key!==t.nodes.background.key?t.state.currentNode.key!==t.nodes.foreground.key||1!==t.state.trajectory.length?(D._navigator.stateService.setNodes([t.nodes.background]),D._navigator.stateService.setNodes([t.nodes.foreground])):D._navigator.stateService.prependNodes([t.nodes.background]):D._navigator.stateService.setNodes([t.nodes.foreground]))},function(t){console.error(t)}),this._navigator.stateService.currentState$.pipe(d.map(function(t){return t.state.previousNode}),d.filter(function(t){return null!=t}),d.distinctUntilChanged(void 0,function(t){return t.key}));var o=this._navigator.stateService.currentState$.pipe(d.distinctUntilChanged(void 0,function(t){return t.state.currentNode.key}),d.withLatestFrom(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),d.map(function(t){var e=t[0],r=t[1],n=t[2],i=e.state,o=Math.max(n.width,n.height),a=i.currentNode,s=i.currentTransform,u=2048<o?2048:1024<o?1024:512;return new v.TextureProvider(a.key,s.basicWidth,s.basicHeight,u,a.image,D._imageTileLoader,new v.ImageTileStore,r)}),d.publishReplay(1),d.refCount());this._textureProviderSubscription=o.subscribe(function(){}),this._setTextureProviderSubscription=o.pipe(d.map(function(e){return function(t){return t.setTextureProvider(e.key,e),t}})).subscribe(this._glRendererOperation$),this._setTileSizeSubscription=this._container.renderService.size$.pipe(d.switchMap(function(t){return f.combineLatest(o,f.of(t)).pipe(d.first())})).subscribe(function(t){var e=t[0],r=t[1],n=Math.max(r.width,r.height),i=2048<n?2048:1024<n?1024:512;e.setTileSize(i)}),this._abortTextureProviderSubscription=o.pipe(d.pairwise()).subscribe(function(t){t[0].abort()});var a=f.combineLatest(this._container.renderService.renderCameraFrame$,this._container.renderService.size$.pipe(d.debounceTime(250))).pipe(d.map(function(t){var e=t[0],r=t[1];return[e.camera.position.clone(),e.camera.lookat.clone(),e.zoom.valueOf(),r.height.valueOf(),r.width.valueOf()]}),d.pairwise(),d.skipWhile(function(t){return t[1][2]-t[0][2]<0||0===t[1][2]}),d.map(function(t){var e=t[0][0].equals(t[1][0]),r=t[0][1].equals(t[1][1]),n=t[0][2]===t[1][2],i=t[0][3]===t[1][3],o=t[0][4]===t[1][4];return e&&r&&n&&i&&o}),d.distinctUntilChanged(),d.filter(function(t){return t}),d.switchMap(function(t){return D._container.renderService.renderCameraFrame$.pipe(d.first())}),d.withLatestFrom(this._container.renderService.size$,this._navigator.stateService.currentTransform$));this._setRegionOfInterestSubscription=o.pipe(d.switchMap(function(i){return a.pipe(d.map(function(t){var e=t[0],r=t[1],n=t[2];return[D._roiCalculator.computeRegionOfInterest(e,r,n),i]}))}),d.filter(function(t){return!t[1].disposed})).subscribe(function(t){var e=t[0];t[1].setRegionOfInterest(e)});var s=o.pipe(d.switchMap(function(t){return t.hasTexture$}),d.startWith(!1),d.publishReplay(1),d.refCount());this._hasTextureSubscription=s.subscribe(function(){});var u=this._navigator.stateService.currentState$.pipe(d.filter(function(t){return 0===t.state.nodesAhead}),d.map(function(t){return t.state.currentNode}),d.distinctUntilChanged(void 0,function(t){return t.key}),d.debounceTime(1e3),d.withLatestFrom(s),d.filter(function(t){return!t[1]}),d.map(function(t){return t[0]}),d.filter(function(t){return t.pano?_.Settings.maxImageSize>_.Settings.basePanoramaSize:_.Settings.maxImageSize>_.Settings.baseImageSize}),d.switchMap(function(r){var t=r.pano?_.Settings.basePanoramaSize:_.Settings.baseImageSize;return Math.max(r.image.width,r.image.height)>t?f.empty():r.cacheImage$(_.Settings.maxImageSize).pipe(d.map(function(t){return[t.image,t]})).pipe(d.takeUntil(s.pipe(d.filter(function(t){return t}))),d.catchError(function(t,e){return console.error("Failed to fetch high res image ("+r.key+")",t),f.empty()}))})).pipe(d.publish(),d.refCount());this._updateBackgroundSubscription=u.pipe(d.withLatestFrom(o)).subscribe(function(t){t[0][1].key!==t[1].key||t[1].disposed||t[1].updateBackground(t[0][0])}),this._updateTextureImageSubscription=u.pipe(d.map(function(e){return function(t){return t.updateTextureImage(e[0],e[1]),t}})).subscribe(this._glRendererOperation$);var c=this._navigator.stateService.currentState$.pipe(d.filter(function(t){return!!t.state.previousNode}),d.distinctUntilChanged(void 0,function(t){return t.state.previousNode.key}),d.withLatestFrom(this._container.glRenderer.webGLRenderer$,this._container.renderService.size$),d.map(function(t){var e=t[0],r=t[1],n=t[2],i=e.state,o=Math.max(n.width,n.height),a=i.previousNode,s=i.previousTransform,u=2048<o?2048:1024<o?1024:512;return new v.TextureProvider(a.key,s.basicWidth,s.basicHeight,u,a.image,D._imageTileLoader,new v.ImageTileStore,r)}),d.publishReplay(1),d.refCount());this._textureProviderSubscriptionPrev=c.subscribe(function(){}),this._setTextureProviderSubscriptionPrev=c.pipe(d.map(function(e){return function(t){return t.setTextureProviderPrev(e.key,e),t}})).subscribe(this._glRendererOperation$),this._setTileSizeSubscriptionPrev=this._container.renderService.size$.pipe(d.switchMap(function(t){return f.combineLatest(c,f.of(t)).pipe(d.first())})).subscribe(function(t){var e=t[0],r=t[1],n=Math.max(r.width,r.height),i=2048<n?2048:1024<n?1024:512;e.setTileSize(i)}),this._abortTextureProviderSubscriptionPrev=c.pipe(d.pairwise()).subscribe(function(t){t[0].abort()});var l=f.combineLatest(this._container.renderService.renderCameraFrame$,this._container.renderService.size$.pipe(d.debounceTime(250))).pipe(d.map(function(t){var e=t[0],r=t[1];return[e.camera.position.clone(),e.camera.lookat.clone(),e.zoom.valueOf(),r.height.valueOf(),r.width.valueOf()]}),d.pairwise(),d.skipWhile(function(t){return t[1][2]-t[0][2]<0||0===t[1][2]}),d.map(function(t){var e=t[0][0].equals(t[1][0]),r=t[0][1].equals(t[1][1]),n=t[0][2]===t[1][2],i=t[0][3]===t[1][3],o=t[0][4]===t[1][4];return e&&r&&n&&i&&o}),d.distinctUntilChanged(),d.filter(function(t){return t}),d.switchMap(function(t){return D._container.renderService.renderCameraFrame$.pipe(d.first())}),d.withLatestFrom(this._container.renderService.size$,this._navigator.stateService.currentTransform$));this._setRegionOfInterestSubscriptionPrev=c.pipe(d.switchMap(function(i){return l.pipe(d.map(function(t){var e=t[0],r=t[1],n=t[2];return[D._roiCalculator.computeRegionOfInterest(e,r,n),i]}))}),d.filter(function(t){return!t[1].disposed}),d.withLatestFrom(this._navigator.stateService.currentState$)).subscribe(function(t){var e=t[0],r=e[0],n=e[1],i=t[1],o=null;if(i.state.previousNode.fullPano)if(i.state.currentNode.fullPano){var a=D._spatial.viewingDirection(i.state.currentNode.rotation),s=D._spatial.viewingDirection(i.state.previousNode.rotation),u=D._spatial.angleBetweenVector2(a.x,a.y,s.x,s.y)/(2*Math.PI);o={bbox:k={maxX:D._spatial.wrap(r.bbox.maxX+u,0,1),maxY:r.bbox.maxY,minX:D._spatial.wrap(r.bbox.minX+u,0,1),minY:r.bbox.minY},pixelHeight:r.pixelHeight,pixelWidth:r.pixelWidth}}else{a=D._spatial.viewingDirection(i.state.currentNode.rotation),s=D._spatial.viewingDirection(i.state.previousNode.rotation);var c=D._spatial.angleBetweenVector2(a.x,a.y,s.x,s.y)/(2*Math.PI),l=D._spatial.angleToPlane(a.toArray(),[0,0,1]),h=(D._spatial.angleToPlane(s.toArray(),[0,0,1])-l)/(2*Math.PI),p=i.state.currentTransform,f=Math.max(p.basicWidth,p.basicHeight),d=0<f?2*Math.atan(.5*p.basicWidth/(f*p.focal)):Math.PI/3,m=0<f?2*Math.atan(.5*p.basicHeight/(f*p.focal)):Math.PI/3,g=d/(2*Math.PI),y=m/Math.PI,v=(r.bbox.maxX-r.bbox.minX)*g,_=(r.bbox.maxY-r.bbox.minY)*y,b=r.pixelWidth*g,x=r.pixelHeight*y,w=(r.bbox.minX+r.bbox.maxX)/2-.5,S=(r.bbox.minY+r.bbox.maxY)/2-.5,E=.5+c+g*w-v/2,C=.5+c+g*w+v/2,M=.5+h+y*S-_/2,T=.5+h+y*S+_/2;o={bbox:k={maxX:D._spatial.wrap(C,0,1),maxY:T,minX:D._spatial.wrap(E,0,1),minY:M},pixelHeight:x,pixelWidth:b}}else{var P=i.state.currentTransform.basicAspect,O=i.state.previousTransform.basicAspect,A=D._getBasicCorners(P,O),I=A[0],L=I[0],R=I[1],N=A[1],k=(v=N[0]-L,_=N[1]-R,b=r.pixelWidth/v,x=r.pixelHeight/_,E=(v-1)/(2*v)+r.bbox.minX/v,C=(v-1)/(2*v)+r.bbox.maxX/v,M=(_-1)/(2*_)+r.bbox.minY/_,{maxX:C,maxY:T=(_-1)/(2*_)+r.bbox.maxY/_,minX:E,minY:M});D._clipBoundingBox(k),o={bbox:k,pixelHeight:x,pixelWidth:b}}n.setRegionOfInterest(o)});var h=c.pipe(d.switchMap(function(t){return t.hasTexture$}),d.startWith(!1),d.publishReplay(1),d.refCount());this._hasTextureSubscriptionPrev=h.subscribe(function(){});var p=this._navigator.stateService.currentState$.pipe(d.filter(function(t){return 0===t.state.nodesAhead&&!!t.state.previousNode}),d.map(function(t){return t.state.previousNode}),d.distinctUntilChanged(void 0,function(t){return t.key}),d.debounceTime(1e3),d.withLatestFrom(h),d.filter(function(t){return!t[1]}),d.map(function(t){return t[0]}),d.filter(function(t){return t.pano?_.Settings.maxImageSize>_.Settings.basePanoramaSize:_.Settings.maxImageSize>_.Settings.baseImageSize}),d.switchMap(function(r){var t=r.pano?_.Settings.basePanoramaSize:_.Settings.baseImageSize;return Math.max(r.image.width,r.image.height)>t?f.empty():r.cacheImage$(_.Settings.maxImageSize).pipe(d.map(function(t){return[t.image,t]})).pipe(d.takeUntil(h.pipe(d.filter(function(t){return t}))),d.catchError(function(t,e){return console.error("Failed to fetch high res image ("+r.key+")",t),f.empty()}))})).pipe(d.publish(),d.refCount());this._updateBackgroundSubscriptionPrev=p.pipe(d.withLatestFrom(c)).subscribe(function(t){t[0][1].key!==t[1].key||t[1].disposed||t[1].updateBackground(t[0][0])}),this._updateTextureImageSubscriptionPrev=p.pipe(d.map(function(e){return function(t){return t.updateTextureImage(e[0],e[1]),t}})).subscribe(this._glRendererOperation$)},u.prototype._deactivate=function(){var e=this;this._waitSubscription.unsubscribe(),this._navigator.stateService.state$.pipe(d.first()).subscribe(function(t){t!==g.State.Traversing&&e._navigator.stateService.traverse()}),this._glRendererDisposer$.next(null),this._domRenderer.deactivate(),this._modeSubcription.unsubscribe(),this._setKeysSubscription.unsubscribe(),this._stateSubscription.unsubscribe(),this._glRenderSubscription.unsubscribe(),this._domRenderSubscription.unsubscribe(),this._moveSubscription.unsubscribe(),this._updateCurtainSubscription.unsubscribe(),this._textureProviderSubscription.unsubscribe(),this._setTextureProviderSubscription.unsubscribe(),this._setTileSizeSubscription.unsubscribe(),this._abortTextureProviderSubscription.unsubscribe(),this._setRegionOfInterestSubscription.unsubscribe(),this._hasTextureSubscription.unsubscribe(),this._updateBackgroundSubscription.unsubscribe(),this._updateTextureImageSubscription.unsubscribe(),this._textureProviderSubscriptionPrev.unsubscribe(),this._setTextureProviderSubscriptionPrev.unsubscribe(),this._setTileSizeSubscriptionPrev.unsubscribe(),this._abortTextureProviderSubscriptionPrev.unsubscribe(),this._setRegionOfInterestSubscriptionPrev.unsubscribe(),this._hasTextureSubscriptionPrev.unsubscribe(),this._updateBackgroundSubscriptionPrev.unsubscribe(),this._updateTextureImageSubscriptionPrev.unsubscribe(),this.configure({keys:null})},u.prototype._getDefaultConfiguration=function(){return{initialPosition:1,mode:m.SliderMode.Motion,sliderVisible:!0}},u.prototype._catchCacheNode$=function(r){return this._navigator.graphService.cacheNode$(r).pipe(d.catchError(function(t,e){return console.error("Failed to cache slider node ("+r+")",t),f.empty()}))},u.prototype._getBasicCorners=function(t,e){var r,n;return n=e<t?(r=.5)*t/e:(r=.5*e/t,.5),[[.5-r,.5-n],[.5+r,.5+n]]},u.prototype._clipBoundingBox=function(t){t.minX=Math.max(0,Math.min(1,t.minX)),t.maxX=Math.max(0,Math.min(1,t.maxX)),t.minY=Math.max(0,Math.min(1,t.minY)),t.maxY=Math.max(0,Math.min(1,t.maxY))},u.componentName="slider",u);function u(t,e,r,n){var i=o.call(this,t,e,r)||this;return i._viewportCoords=n||new a.ViewportCoords,i._domRenderer=new m.SliderDOMRenderer(e),i._imageTileLoader=new v.ImageTileLoader(_.Urls.tileScheme,_.Urls.tileDomain,_.Urls.origin),i._roiCalculator=new v.RegionOfInterestCalculator,i._spatial=new a.Spatial,i._glRendererOperation$=new f.Subject,i._glRendererCreator$=new f.Subject,i._glRendererDisposer$=new f.Subject,i._glRenderer$=i._glRendererOperation$.pipe(d.scan(function(t,e){return e(t)},null),d.filter(function(t){return null!=t}),d.distinctUntilChanged(void 0,function(t){return t.frameId})),i._glRendererCreator$.pipe(d.map(function(){return function(t){if(null!=t)throw new Error("Multiple slider states can not be created at the same time");return new m.SliderGLRenderer}})).subscribe(i._glRendererOperation$),i._glRendererDisposer$.pipe(d.map(function(){return function(t){return t.dispose(),null}})).subscribe(i._glRendererOperation$),i}r.SliderComponent=s,m.ComponentService.register(s),r.default=s},{"../../Component":291,"../../Geo":294,"../../Render":297,"../../State":298,"../../Tiles":300,"../../Utils":301,rxjs:43,"rxjs/operators":241}],354:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rxjs"),i=t("rxjs/operators"),c=t("virtual-dom"),o=t("../../Component"),a=(Object.defineProperty(s.prototype,"mode$",{get:function(){return this._notifyModeChanged$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"position$",{get:function(){return this._notifyPositionChanged$},enumerable:!0,configurable:!0}),s.prototype.activate=function(){var e=this;this._stopInteractionSubscription||(this._stopInteractionSubscription=n.merge(this._container.mouseService.documentMouseUp$,this._container.touchService.touchEnd$.pipe(i.filter(function(t){return 0===t.touches.length}))).subscribe(function(t){e._interacting&&(e._interacting=!1)}))},s.prototype.deactivate=function(){this._stopInteractionSubscription&&(this._interacting=!1,this._stopInteractionSubscription.unsubscribe(),this._stopInteractionSubscription=null)},s.prototype.render=function(t,e,r,n,i){var o=[];if(i){o.push(c.h("div.SliderBorder",[]));var a=!(r||n);a&&(o.push(this._createModeButton(e)),o.push(this._createModeButton2d(e))),o.push(this._createPositionInput(t,a))}var s=this._container.domContainer.getBoundingClientRect(),u=Math.max(215,Math.min(400,s.width-100));return c.h("div.SliderContainer",{style:{width:u+"px"}},o)},s.prototype._createModeButton=function(t){var e=this,r={onclick:function(){t!==o.SliderMode.Motion&&e._notifyModeChanged$.next(o.SliderMode.Motion)}},n=t===o.SliderMode.Stationary?"SliderModeButtonDisabled":"SliderModeButton";return c.h("div."+n,r,[c.h("div.SliderModeIcon",[])])},s.prototype._createModeButton2d=function(t){var e=this,r={onclick:function(){t!==o.SliderMode.Stationary&&e._notifyModeChanged$.next(o.SliderMode.Stationary)}},n=t===o.SliderMode.Motion?"SliderModeButton2dDisabled":"SliderModeButton2d";return c.h("div."+n,r,[c.h("div.SliderModeIcon2d",[])])},s.prototype._createPositionInput=function(t,e){function r(t){o._notifyPositionChanged$.next(Number(t.target.value)/1e3)}function n(t){o._interacting=!0,t.stopPropagation()}function i(t){o._interacting&&t.stopPropagation()}var o=this,a=this._container.domContainer.getBoundingClientRect(),s=Math.max(215,Math.min(400,a.width-105))-84+(e?0:52),u=c.h("input.SliderPosition",{max:1e3,min:0,onchange:r,oninput:r,onkeydown:function(t){"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key&&"ArrowUp"!==t.key||t.preventDefault()},onmousedown:n,onmousemove:i,ontouchmove:i,ontouchstart:n,style:{width:s+"px"},type:"range",value:1e3*t},[]);return c.h("div.SliderPositionContainer",[u])},s);function s(t){this._container=t,this._interacting=!1,this._notifyModeChanged$=new n.Subject,this._notifyPositionChanged$=new n.Subject,this._stopInteractionSubscription=null}r.SliderDOMRenderer=a,r.default=a},{"../../Component":291,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],355:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var M=t("../../Component"),T=t("../../Geo"),n=(Object.defineProperty(i.prototype,"disabled",{get:function(){return this._disabled},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frameId",{get:function(){return this._frameId},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:!0,configurable:!0}),i.prototype.setTextureProvider=function(t,e){this._setTextureProvider(t,this._currentKey,e,this._currentProviderDisposers,this._updateTexture.bind(this))},i.prototype.setTextureProviderPrev=function(t,e){this._setTextureProvider(t,this._previousKey,e,this._previousProviderDisposers,this._updateTexturePrev.bind(this))},i.prototype.update=function(t,e){this._updateFrameId(t.id),this._updateImagePlanes(t.state,e)},i.prototype.updateCurtain=function(t){this._curtain!==t&&(this._curtain=t,this._updateCurtain(),this._needsRender=!0)},i.prototype.updateTexture=function(t,e){var r=e.key===this._currentKey?this._scene.planes:e.key===this._previousKey?this._scene.planesOld:{};if(0!==Object.keys(r).length)for(var n in this._needsRender=!0,r)if(r.hasOwnProperty(n)){var i=r[n].material.uniforms.projectorTex.value;i.image=t,i.needsUpdate=!0}},i.prototype.updateTextureImage=function(t,e){if(this._currentKey===e.key){this._needsRender=!0;var r=this._scene.planes;for(var n in r)if(r.hasOwnProperty(n)){var i=r[n].material.uniforms.projectorTex.value;i.image=t,i.needsUpdate=!0}}},i.prototype.render=function(t,e){this.disabled||e.render(this._scene.sceneOld,t),e.render(this._scene.scene,t),this._needsRender=!1},i.prototype.dispose=function(){for(var t in this._scene.clear(),this._currentProviderDisposers)this._currentProviderDisposers.hasOwnProperty(t)&&this._currentProviderDisposers[t]();for(var t in this._previousProviderDisposers)this._previousProviderDisposers.hasOwnProperty(t)&&this._previousProviderDisposers[t]();this._currentProviderDisposers={},this._previousProviderDisposers={}},i.prototype._getBasicCorners=function(t,e){var r,n;return n=e<t?(r=.5)*t/e:(r=.5*e/t,.5),[[.5-r,.5-n],[.5+r,.5+n]]},i.prototype._setDisabled=function(t){this._disabled=null==t.currentNode||null==t.previousNode||t.currentNode.pano&&!t.currentNode.fullPano||t.previousNode.pano&&!t.previousNode.fullPano||t.currentNode.fullPano&&!t.previousNode.fullPano},i.prototype._setTextureProvider=function(t,e,r,n,i){var o=this;if(t===e){var a=r.textureCreated$.subscribe(i),s=r.textureUpdated$.subscribe(function(t){o._needsRender=!0});t in n&&((0,n[t])(),delete n[t]),n[t]=function(){a.unsubscribe(),s.unsubscribe(),r.dispose()}}},i.prototype._updateCurtain=function(){var t=this._scene.planes;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e].material;r.uniforms.curtain&&(r.uniforms.curtain.value=this._curtain)}},i.prototype._updateFrameId=function(t){this._frameId=t},i.prototype._updateImagePlanes=function(t,e){var r=null!=t.currentNode&&this._currentKey!==t.currentNode.key,n=null!=t.previousNode&&this._previousKey!==t.previousNode.key,i=this._mode!==e;if(r||n||i){this._setDisabled(t),this._needsRender=!0,this._mode=e;var o=t.motionless||e===M.SliderMode.Stationary||t.currentNode.pano;if((this.disabled||n)&&this._previousKey in this._previousProviderDisposers&&(this._previousProviderDisposers[this._previousKey](),delete this._previousProviderDisposers[this._previousKey]),this.disabled)this._scene.setImagePlanesOld({});else if(n||i){var a=t.previousNode;this._previousKey=a.key;var s=t.currentTransform.rt.elements,u=[s[12],s[13],s[14]],c=t.currentTransform.basicAspect,l=t.previousTransform.basicAspect,h=l<c?[1,l/c]:[c/l,1],p=t.currentNode.rotation,f=t.currentNode.width,d=t.currentNode.height;a.fullPano&&(p=t.previousNode.rotation,u=this._spatial.rotate(this._spatial.opticalCenter(t.currentNode.rotation,u).toArray(),p).multiplyScalar(-1).toArray(),f=t.previousNode.width,d=t.previousNode.height);var m=new T.Transform(t.currentNode.orientation,f,d,t.currentNode.focal,t.currentNode.scale,a.gpano,p,u,a.image,h),g=void 0;if(a.fullPano)g=this._factory.createMesh(a,o||t.currentNode.fullPano?m:t.previousTransform);else if(o){var y=this._getBasicCorners(c,l),v=y[0],_=v[0],b=v[1],x=y[1],w=x[0],S=x[1];g=this._factory.createFlatMesh(t.previousNode,m,_,w,b,S)}else g=this._factory.createMesh(t.previousNode,t.previousTransform);var E={};E[a.key]=g,this._scene.setImagePlanesOld(E)}if(r||i){this._currentKey in this._currentProviderDisposers&&(this._currentProviderDisposers[this._currentKey](),delete this._currentProviderDisposers[this._currentKey]),this._currentKey=t.currentNode.key;var C={};t.currentNode.fullPano?C[t.currentNode.key]=this._factory.createCurtainMesh(t.currentNode,t.currentTransform):t.currentNode.pano&&!t.currentNode.fullPano?C[t.currentNode.key]=this._factory.createMesh(t.currentNode,t.currentTransform):C[t.currentNode.key]=o?this._factory.createDistortedCurtainMesh(t.currentNode,t.currentTransform):this._factory.createCurtainMesh(t.currentNode,t.currentTransform),this._scene.setImagePlanes(C),this._updateCurtain()}}},i.prototype._updateTexture=function(t){this._needsRender=!0;var e=this._scene.planes;for(var r in e)if(e.hasOwnProperty(r)){var n=e[r].material,i=n.uniforms.projectorTex.value;n.uniforms.projectorTex.value=null,i.dispose(),n.uniforms.projectorTex.value=t}},i.prototype._updateTexturePrev=function(t){this._needsRender=!0;var e=this._scene.planesOld;for(var r in e)if(e.hasOwnProperty(r)){var n=e[r].material,i=n.uniforms.projectorTex.value;n.uniforms.projectorTex.value=null,i.dispose(),n.uniforms.projectorTex.value=t}},i);function i(){this._factory=new M.MeshFactory,this._scene=new M.MeshScene,this._spatial=new T.Spatial,this._currentKey=null,this._previousKey=null,this._disabled=!1,this._curtain=1,this._frameId=0,this._needsRender=!1,this._mode=null,this._currentProviderDisposers={},this._previousProviderDisposers={}}r.SliderGLRenderer=n,r.default=n},{"../../Component":291,"../../Geo":294}],356:[function(t,e,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),(i=n=r.CameraVisualizationMode||(r.CameraVisualizationMode={}))[i.Default=0]="Default",i[i.Cluster=1]="Cluster",i[i.ConnectedComponent=2]="ConnectedComponent",i[i.Sequence=3]="Sequence",r.default=n},{}],357:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./CameraVisualizationMode");r.CameraVisualizationMode=n.CameraVisualizationMode},{"./CameraVisualizationMode":356}],358:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("latlon-geohash"),a=t("pako"),s=t("rxjs"),u=t("rxjs/operators"),c=t("../../Error"),l=t("../../Utils"),n=(i.prototype.cacheClusterReconstructions$=function(e){var r=this;if(!this.hasTile(e))throw new Error("Cannot cache reconstructions of a non-existing tile.");if(this.hasClusterReconstructions(e))throw new Error("Cannot cache reconstructions that already exists.");if(this.isCachingClusterReconstructions(e))return this._cachingClusterReconstructions$[e];var t=this.getTile(e).filter(function(t){return!!t.clusterKey}).map(function(t){return t.clusterKey}).filter(function(t,e,r){return r.indexOf(t)===e});return this._tileClusters[e]=t,this._cacheRequests[e]=[],this._cachingClusterReconstructions$[e]=s.from(t).pipe(u.mergeMap(function(t){return r._hasClusterReconstruction(t)?s.of(r._getClusterReconstruction(t)):r._getClusterReconstruction$(t,r._cacheRequests[e]).pipe(u.catchError(function(t){return t instanceof c.AbortMapillaryError||console.error(t),s.empty()}))},6),u.filter(function(){return e in r._tileClusters}),u.tap(function(t){r._hasClusterReconstruction(t.key)||(r._clusterReconstructions[t.key]=t),t.key in r._clusterReconstructionTiles||(r._clusterReconstructionTiles[t.key]=[]),-1===r._clusterReconstructionTiles[t.key].indexOf(e)&&r._clusterReconstructionTiles[t.key].push(e)}),u.finalize(function(){e in r._cachingClusterReconstructions$&&delete r._cachingClusterReconstructions$[e],e in r._cacheRequests&&delete r._cacheRequests[e]}),u.publish(),u.refCount()),this._cachingClusterReconstructions$[e]},i.prototype.cacheTile$=function(r){var n=this;if(8!==r.length)throw new Error("Hash needs to be level 8.");if(this.hasTile(r))throw new Error("Cannot cache tile that already exists.");if(this.isCachingTile(r))return this._cachingTiles$[r];var t=o.bounds(r),e={lat:t.sw.lat,lon:t.sw.lon},i={lat:t.ne.lat,lon:t.ne.lon};return this._cachingTiles$[r]=this._graphService.cacheBoundingBox$(e,i).pipe(u.catchError(function(t){return console.error(t),s.empty()}),u.map(function(t){return t.map(function(t){return n._createNodeData(t)})}),u.filter(function(){return!(r in n._tiles)}),u.tap(function(t){var e;n._tiles[r]=[],(e=n._tiles[r]).push.apply(e,t),delete n._cachingTiles$[r]}),u.finalize(function(){r in n._cachingTiles$&&delete n._cachingTiles$[r]}),u.publish(),u.refCount()),this._cachingTiles$[r]},i.prototype.isCachingClusterReconstructions=function(t){return t in this._cachingClusterReconstructions$},i.prototype.isCachingTile=function(t){return t in this._cachingTiles$},i.prototype.hasClusterReconstructions=function(t){if(t in this._cachingClusterReconstructions$||!(t in this._tileClusters))return!1;for(var e=0,r=this._tileClusters[t];e<r.length;e++)if(!(r[e]in this._clusterReconstructions))return!1;return!0},i.prototype.hasTile=function(t){return!(t in this._cachingTiles$)&&t in this._tiles},i.prototype.getClusterReconstructions=function(t){var e=this;return t in this._tileClusters?this._tileClusters[t].map(function(t){return e._clusterReconstructions[t]}).filter(function(t){return!!t}):[]},i.prototype.getTile=function(t){return t in this._tiles?this._tiles[t]:[]},i.prototype.uncache=function(t){for(var e=0,r=Object.keys(this._cacheRequests);e<r.length;e++){var n=r[e];if(!t||-1===t.indexOf(n)){for(var i=0,o=this._cacheRequests[n];i<o.length;i++)o[i].abort();delete this._cacheRequests[n]}}for(var a=0,s=Object.keys(this._tileClusters);a<s.length;a++)if(n=s[a],!t||-1===t.indexOf(n)){for(var u=0,c=this._tileClusters[n];u<c.length;u++){var l=c[u];if(l in this._clusterReconstructionTiles){var h=this._clusterReconstructionTiles[l].indexOf(n);-1!==h&&(this._clusterReconstructionTiles[l].splice(h,1),0<this._clusterReconstructionTiles[l].length||(delete this._clusterReconstructionTiles[l],delete this._clusterReconstructions[l]))}}delete this._tileClusters[n]}for(var p=0,f=Object.keys(this._tiles);p<f.length;p++)n=f[p],t&&-1!==t.indexOf(n)||delete this._tiles[n]},i.prototype._createNodeData=function(t){return{alt:t.alt,cameraProjection:t.cameraProjection,clusterKey:t.clusterKey,focal:t.focal,gpano:t.gpano,height:t.height,k1:t.ck1,k2:t.ck2,key:t.key,lat:t.latLon.lat,lon:t.latLon.lon,mergeCC:t.mergeCC,orientation:t.orientation,originalLat:t.originalLatLon.lat,originalLon:t.originalLatLon.lon,rotation:[t.rotation[0],t.rotation[1],t.rotation[2]],scale:t.scale,sequenceKey:t.sequenceKey,width:t.width}},i.prototype._getClusterReconstruction=function(t){return this._clusterReconstructions[t]},i.prototype._getClusterReconstruction$=function(o,t){return s.Observable.create(function(n){var i=new XMLHttpRequest;i.open("GET",l.Urls.clusterReconstruction(o),!0),i.responseType="arraybuffer",i.timeout=15e3,i.onload=function(){if(i.response){var t=a.inflate(i.response,{to:"string"}),e=JSON.parse(t);e.length<1&&n.error(new Error("No cluster reconstruction exists ("+o+")"));var r=e[0];r.key=o,n.next(r),n.complete()}else n.error(new Error("Cluster reconstruction retreival failed ("+o+")"))},i.onerror=function(){n.error(new Error("Failed to get cluster reconstruction ("+o+")"))},i.ontimeout=function(){n.error(new Error("Cluster reconstruction request timed out ("+o+")"))},i.onabort=function(){n.error(new c.AbortMapillaryError("Cluster reconstruction request was aborted ("+o+")"))},t.push(i),i.send(null)})},i.prototype._hasClusterReconstruction=function(t){return t in this._clusterReconstructions},i);function i(t){this._graphService=t,this._tiles={},this._cacheRequests={},this._clusterReconstructions={},this._clusterReconstructionTiles={},this._tileClusters={},this._cachingTiles$={},this._cachingClusterReconstructions$={}}r.SpatialDataCache=n,r.default=n},{"../../Error":293,"../../Utils":301,"latlon-geohash":21,pako:23,rxjs:43,"rxjs/operators":241}],359:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,d=t("latlon-geohash"),l=t("rxjs"),h=t("rxjs/operators"),a=t("../../Component"),s=t("../../Geo"),u=t("../../Render"),p=t("../../viewer/PlayService"),f=t("../../state/State"),m=t("./CameraVisualizationMode"),c=(o=a.Component,i(g,o),g.prototype._activate=function(){var c=this;this._earthControlsSubscription=this._configuration$.pipe(h.map(function(t){return t.earthControls}),h.distinctUntilChanged(),h.withLatestFrom(this._navigator.stateService.state$)).subscribe(function(t){var e=t[0],r=t[1];e&&r!==f.default.Earth?c._navigator.stateService.earth():e||r!==f.default.Earth||c._navigator.stateService.traverse()});var t=this._container.renderService.bearing$.pipe(h.map(function(t){var e="";return(292.5<t||t<=67.5)&&(e+="n"),112.5<t&&t<=247.5&&(e+="s"),22.5<t&&t<=157.5&&(e+="e"),202.5<t&&t<=337.5&&(e+="w"),e}),h.distinctUntilChanged(),h.publishReplay(1),h.refCount()),e=this._navigator.stateService.reference$.pipe(h.tap(function(){c._scene.uncache()}),h.switchMap(function(){return c._navigator.stateService.currentNode$.pipe(h.map(function(t){return d.encode(t.latLon.lat,t.latLon.lon,8)}),h.distinctUntilChanged())}),h.publishReplay(1),h.refCount()),r=l.combineLatest(this._navigator.playService.playing$,this._navigator.playService.speed$).pipe(h.map(function(t){var e=t[0],r=t[1];return e&&r>p.default.sequenceSpeed}),h.distinctUntilChanged(),h.publishReplay(1),h.refCount()),n=l.combineLatest(this._navigator.stateService.state$.pipe(h.map(function(t){return t===f.default.Earth}),h.distinctUntilChanged()),e,r,t).pipe(h.distinctUntilChanged(function(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=e[0],s=e[1],u=e[2],c=e[3];return r===a&&(r?n===s&&i===u:n===s&&i===u&&o===c)}),h.concatMap(function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e?n?l.of([r]):l.of(c._adjacentComponent(r,4)):n?l.of([r,d.neighbours(r)[i]]):l.of(c._computeTiles(r,i))}),h.publish(),h.refCount()).pipe(h.switchMap(function(t){return l.from(t).pipe(h.mergeMap(function(t){var e=c._cache.hasTile(t)?l.of(c._cache.getTile(t)):c._cache.cacheTile$(t);return l.combineLatest(l.of(t),e)},6))}),h.publish(),h.refCount());this._addTileSubscription=n.pipe(h.withLatestFrom(this._navigator.stateService.reference$)).subscribe(function(t){var e=t[0][0],r=t[1];c._scene.hasTile(e)||c._scene.addTile(c._computeTileBBox(e,r),e)}),this._addNodeSubscription=n.pipe(h.withLatestFrom(this._navigator.stateService.reference$)).subscribe(function(t){for(var e=t[0],r=e[0],n=e[1],i=t[1],o=0,a=n;o<a.length;o++){var s=a[o];c._scene.hasNode(s.key,r)||c._scene.addNode(s,c._createTransform(s,i),c._computeOriginalPosition(s,i),r)}}),this._addReconstructionSubscription=n.pipe(h.concatMap(function(t){var e,r=t[0];return e=c._cache.hasClusterReconstructions(r)?l.from(c._cache.getClusterReconstructions(r)):c._cache.isCachingClusterReconstructions(r)?c._cache.cacheClusterReconstructions$(r).pipe(h.last(null,{}),h.switchMap(function(){return l.from(c._cache.getClusterReconstructions(r))})):c._cache.hasTile(r)?c._cache.cacheClusterReconstructions$(r):l.empty(),l.combineLatest(l.of(r),e)}),h.withLatestFrom(this._navigator.stateService.reference$)).subscribe(function(t){var e=t[0],r=e[0],n=e[1],i=t[1];c._scene.hasClusterReconstruction(n.key,r)||c._scene.addClusterReconstruction(n,c._computeTranslation(n,i),r)}),this._cameraVisibilitySubscription=this._configuration$.pipe(h.map(function(t){return t.camerasVisible}),h.distinctUntilChanged()).subscribe(function(t){c._scene.setCameraVisibility(t)}),this._pointVisibilitySubscription=this._configuration$.pipe(h.map(function(t){return t.pointsVisible}),h.distinctUntilChanged()).subscribe(function(t){c._scene.setPointVisibility(t)}),this._positionVisibilitySubscription=this._configuration$.pipe(h.map(function(t){return t.positionsVisible}),h.distinctUntilChanged()).subscribe(function(t){c._scene.setPositionVisibility(t)}),this._tileVisibilitySubscription=this._configuration$.pipe(h.map(function(t){return t.tilesVisible}),h.distinctUntilChanged()).subscribe(function(t){c._scene.setTileVisibility(t)}),this._ccToModeSubscription=this._configuration$.pipe(h.map(function(t){return!0===t.connectedComponents?m.default.ConnectedComponent:m.default.Default}),h.distinctUntilChanged()).subscribe(function(t){c.configure({cameraVisualizationMode:t})}),this._cameraVisualizationModeSubscription=this._configuration$.pipe(h.map(function(t){return t.cameraVisualizationMode}),h.distinctUntilChanged()).subscribe(function(t){c._scene.setCameraVisualizationMode(t)}),this._uncacheSubscription=e.subscribe(function(t){var e=c._adjacentComponent(t,4);c._scene.uncache(e),c._cache.uncache(e)}),this._moveSubscription=this._navigator.playService.playing$.pipe(h.switchMap(function(t){return t?l.empty():c._container.mouseService.dblClick$}),h.withLatestFrom(this._container.renderService.renderCamera$),h.switchMap(function(t){var e=t[0],r=t[1],n=c._container.element,i=c._viewportCoords.canvasPosition(e,n),o=i[0],a=i[1],s=c._viewportCoords.canvasToViewport(o,a,n),u=c._scene.intersectObjects(s,r.perspective);return u?c._navigator.moveToKey$(u).pipe(h.catchError(function(){return l.empty()})):l.empty()})).subscribe(),this._renderSubscription=this._navigator.stateService.currentState$.pipe(h.map(function(t){var e=c._scene;return{name:c._name,render:{frameId:t.id,needsRender:e.needsRender,render:e.render.bind(e),stage:u.GLRenderStage.Foreground}}})).subscribe(this._container.glRenderer.render$)},g.prototype._deactivate=function(){var e=this;this._cache.uncache(),this._scene.uncache(),this._addNodeSubscription.unsubscribe(),this._addReconstructionSubscription.unsubscribe(),this._addTileSubscription.unsubscribe(),this._cameraVisibilitySubscription.unsubscribe(),this._earthControlsSubscription.unsubscribe(),this._moveSubscription.unsubscribe(),this._pointVisibilitySubscription.unsubscribe(),this._positionVisibilitySubscription.unsubscribe(),this._renderSubscription.unsubscribe(),this._tileVisibilitySubscription.unsubscribe(),this._uncacheSubscription.unsubscribe(),this._cameraVisualizationModeSubscription.unsubscribe(),this._ccToModeSubscription.unsubscribe(),this._navigator.stateService.state$.pipe(h.first()).subscribe(function(t){t===f.default.Earth&&e._navigator.stateService.traverse()})},g.prototype._getDefaultConfiguration=function(){return{cameraVisualizationMode:m.default.Default,camerasVisible:!1,connectedComponents:!1,pointsVisible:!0,positionsVisible:!1,tilesVisible:!1}},g.prototype._adjacentComponent=function(t,e){var r=new Set;return r.add(t),this._adjacentComponentRecursive(r,[t],0,e),this._setToArray(r)},g.prototype._adjacentComponentRecursive=function(t,e,r,n){if(r!==n){for(var i=[],o=0,a=e;o<a.length;o++){var s=a[o],u=d.neighbours(s);for(var c in u)u.hasOwnProperty(c)&&i.push(u[c])}for(var l=[],h=0,p=i;h<p.length;h++){var f=p[h];t.has(f)||(t.add(f),l.push(f))}this._adjacentComponentRecursive(t,l,r+1,n)}},g.prototype._computeOriginalPosition=function(t,e){return this._geoCoords.geodeticToEnu(t.originalLat,t.originalLon,t.alt,e.lat,e.lon,e.alt)},g.prototype._computeTileBBox=function(t,e){var r=d.bounds(t);return[this._geoCoords.geodeticToEnu(r.sw.lat,r.sw.lon,0,e.lat,e.lon,e.alt),this._geoCoords.geodeticToEnu(r.ne.lat,r.ne.lon,0,e.lat,e.lon,e.alt)]},g.prototype._createTransform=function(t,e){var r=s.Geo.computeTranslation({alt:t.alt,lat:t.lat,lon:t.lon},t.rotation,e);return new s.Transform(t.orientation,t.width,t.height,t.focal,t.scale,t.gpano,t.rotation,r,void 0,void 0,t.k1,t.k2,t.cameraProjection)},g.prototype._computeTiles=function(t,e){var r=new Set;return this._computeTilesRecursive(r,t,e,["n","ne","e","se","s","sw","w","nw"],0,2),this._setToArray(r)},g.prototype._computeTilesRecursive=function(t,e,r,n,i,o){if(t.add(e),i!==o)for(var a=d.neighbours(e),s=n.indexOf(r),u=n.length,c=0,l=[a[n[this._modulo(s-1,u)]],a[r],a[n[this._modulo(s+1,u)]]];c<l.length;c++){var h=l[c];this._computeTilesRecursive(t,h,r,n,i+1,o)}},g.prototype._computeTranslation=function(t,e){return this._geoCoords.geodeticToEnu(t.reference_lla.latitude,t.reference_lla.longitude,t.reference_lla.altitude,e.lat,e.lon,e.alt)},g.prototype._modulo=function(t,e){return(t%e+e)%e},g.prototype._setToArray=function(t){var e=[];return t.forEach(function(t){e.push(t)}),e},g.componentName="spatialData",g);function g(t,e,r){var n=o.call(this,t,e,r)||this;return n._cache=new a.SpatialDataCache(r.graphService),n._scene=new a.SpatialDataScene(n._getDefaultConfiguration()),n._viewportCoords=new s.ViewportCoords,n._geoCoords=new s.GeoCoords,n}r.SpatialDataComponent=c,a.ComponentService.register(c),r.default=c},{"../../Component":291,"../../Geo":294,"../../Render":297,"../../state/State":438,"../../viewer/PlayService":468,"./CameraVisualizationMode":356,"latlon-geohash":21,rxjs:43,"rxjs/operators":241}],360:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var d=t("three"),h=t("./CameraVisualizationMode"),n=(Object.defineProperty(i.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:!0,configurable:!0}),i.prototype.addClusterReconstruction=function(t,e,r){if(!this.hasClusterReconstruction(t.key,r)){var n=t.key;n in this._clusterReconstructions||(this._clusterReconstructions[n]={points:new d.Object3D,tiles:[]},this._clusterReconstructions[n].points.visible=this._pointsVisible,this._clusterReconstructions[n].points.add(this._createClusterPoints(t,e)),this._scene.add(this._clusterReconstructions[n].points)),-1===this._clusterReconstructions[n].tiles.indexOf(r)&&this._clusterReconstructions[n].tiles.push(r),r in this._tileClusterReconstructions||(this._tileClusterReconstructions[r]={keys:[]}),-1===this._tileClusterReconstructions[r].keys.indexOf(n)&&this._tileClusterReconstructions[r].keys.push(n),this._needsRender=!0}},i.prototype.addNode=function(t,e,r,n){var i=t.key,o=t.clusterKey,a=t.sequenceKey,s=t.mergeCC?t.mergeCC.toString():"";if(!this.hasNode(i,n)){n in this._nodes||(this._nodes[n]={cameraKeys:{},cameras:new d.Object3D,clusters:{},connectedComponents:{},keys:[],positions:new d.Object3D,sequences:{}},this._nodes[n].cameras.visible=this._camerasVisible,this._nodes[n].positions.visible=this._positionsVisible,this._scene.add(this._nodes[n].cameras,this._nodes[n].positions)),s in this._nodes[n].connectedComponents||(this._nodes[n].connectedComponents[s]=[]),o in this._nodes[n].clusters||(this._nodes[n].clusters[o]=[]),a in this._nodes[n].sequences||(this._nodes[n].sequences[a]=[]);var u=this._createCamera(e);this._nodes[n].cameras.add(u);for(var c=0,l=u.children;c<l.length;c++){var h=l[c];this._nodes[n].cameraKeys[h.uuid]=i,this._interactiveObjects.push(h)}this._nodes[n].connectedComponents[s].push(u),this._nodes[n].clusters[o].push(u),this._nodes[n].sequences[a].push(u);var p=this._getId(o,s,a,this._cameraVisualizationMode),f=this._getColor(p,this._cameraVisualizationMode);this._setCameraColor(f,u),this._nodes[n].positions.add(this._createPosition(e,r)),this._nodes[n].keys.push(i),this._needsRender=!0}},i.prototype.addTile=function(t,e){if(!this.hasTile(e)){var r=t[0],n=t[1],i=new d.Geometry;i.vertices.push((new d.Vector3).fromArray(r),new d.Vector3(r[0],n[1],(r[2]+n[2])/2),(new d.Vector3).fromArray(n),new d.Vector3(n[0],r[1],(r[2]+n[2])/2),(new d.Vector3).fromArray(r));var o=new d.Line(i,new d.LineBasicMaterial);this._tiles[e]=new d.Object3D,this._tiles[e].visible=this._tilesVisible,this._tiles[e].add(o),this._scene.add(this._tiles[e]),this._needsRender=!0}},i.prototype.uncache=function(t){for(var e=0,r=Object.keys(this._tileClusterReconstructions);e<r.length;e++){var n=r[e];t&&-1!==t.indexOf(n)||this._disposeReconstruction(n)}for(var i=0,o=Object.keys(this._nodes);i<o.length;i++)n=o[i],t&&-1!==t.indexOf(n)||this._disposeNodes(n);for(var a=0,s=Object.keys(this._tiles);a<s.length;a++)n=s[a],t&&-1!==t.indexOf(n)||this._disposeTile(n);this._needsRender=!0},i.prototype.hasClusterReconstruction=function(t,e){return t in this._clusterReconstructions&&-1!==this._clusterReconstructions[t].tiles.indexOf(e)},i.prototype.hasTile=function(t){return t in this._tiles},i.prototype.hasNode=function(t,e){return e in this._nodes&&-1!==this._nodes[e].keys.indexOf(t)},i.prototype.intersectObjects=function(t,e){var r=t[0],n=t[1];if(!this._camerasVisible)return null;this._raycaster.setFromCamera(new d.Vector2(r,n),e);for(var i=0,o=this._raycaster.intersectObjects(this._interactiveObjects);i<o.length;i++){var a=o[i];for(var s in this._nodes)if(this._nodes.hasOwnProperty(s)&&a.object.uuid in this._nodes[s].cameraKeys)return this._nodes[s].cameraKeys[a.object.uuid]}return null},i.prototype.setCameraVisibility=function(t){if(t!==this._camerasVisible){for(var e in this._nodes)this._nodes.hasOwnProperty(e)&&(this._nodes[e].cameras.visible=t);this._camerasVisible=t,this._needsRender=!0}},i.prototype.setPointVisibility=function(t){if(t!==this._pointsVisible){for(var e in this._clusterReconstructions)this._clusterReconstructions.hasOwnProperty(e)&&(this._clusterReconstructions[e].points.visible=t);this._pointsVisible=t,this._needsRender=!0}},i.prototype.setPositionVisibility=function(t){if(t!==this._positionsVisible){for(var e in this._nodes)this._nodes.hasOwnProperty(e)&&(this._nodes[e].positions.visible=t);this._positionsVisible=t,this._needsRender=!0}},i.prototype.setTileVisibility=function(t){if(t!==this._tilesVisible){for(var e in this._tiles)this._tiles.hasOwnProperty(e)&&(this._tiles[e].visible=t);this._tilesVisible=t,this._needsRender=!0}},i.prototype.setCameraVisualizationMode=function(t){if(t!==this._cameraVisualizationMode){for(var e in this._nodes)if(this._nodes.hasOwnProperty(e)){var r=void 0;if(t===h.default.Cluster)r=this._nodes[e].clusters;else if(t===h.default.ConnectedComponent)r=this._nodes[e].connectedComponents;else{if(t!==h.default.Sequence){for(var n=0,i=this._nodes[e].cameras.children;n<i.length;n++){var o=i[n],a=this._getColor("",t);this._setCameraColor(a,o)}continue}r=this._nodes[e].sequences}for(var s in r)if(r.hasOwnProperty(s)){a=this._getColor(s,t);for(var u=0,c=r[s];u<c.length;u++){var l=c[u];this._setCameraColor(a,l)}}}this._cameraVisualizationMode=t,this._needsRender=!0}},i.prototype.render=function(t,e){e.render(this._scene,t),this._needsRender=!1},i.prototype._arrayToFloatArray=function(t,e){for(var r=t.length,n=new Float32Array(r*e),i=0;i<r;i++){var o=t[i],a=3*i;n[0+a]=o[0],n[1+a]=o[1],n[2+a]=o[2]}return n},i.prototype._createAxis=function(t){var e=t.unprojectBasic([.5,0],.22),r=t.unprojectBasic([.5,1],.16),n=new d.BufferGeometry;return n.addAttribute("position",new d.BufferAttribute(this._arrayToFloatArray([e,r],3),3)),new d.Line(n,new d.LineBasicMaterial)},i.prototype._createCamera=function(t){return t.gpano?this._createPanoCamera(t):this._createPrespectiveCamera(t)},i.prototype._createDiagonals=function(t,e){var r=t.unprojectBasic([0,0],0,!0),n=[r,t.unprojectBasic([0,0],e,!0),r,t.unprojectBasic([1,0],e,!0),r,t.unprojectBasic([1,1],e,!0),r,t.unprojectBasic([0,1],e,!0)],i=new d.BufferGeometry;return i.addAttribute("position",new d.BufferAttribute(this._arrayToFloatArray(n,3),3)),new d.LineSegments(i,new d.LineBasicMaterial)},i.prototype._createFrame=function(e,r){var t=[];t.push.apply(t,this._subsample([0,1],[0,0],20)),t.push.apply(t,this._subsample([0,0],[1,0],20)),t.push.apply(t,this._subsample([1,0],[1,1],20));var n=t.map(function(t){return e.unprojectBasic(t,r,!0)}),i=new d.BufferGeometry;return i.addAttribute("position",new d.BufferAttribute(this._arrayToFloatArray(n,3),3)),new d.Line(i,new d.LineBasicMaterial)},i.prototype._createLatitude=function(t,e,r){for(var n=new Float32Array(3*(e+1)),i=0;i<=e;i++){var o=r.unprojectBasic([i/e,t],.16),a=3*i;n[0+a]=o[0],n[1+a]=o[1],n[2+a]=o[2]}var s=new d.BufferGeometry;return s.addAttribute("position",new d.BufferAttribute(n,3)),new d.Line(s,new d.LineBasicMaterial)},i.prototype._createLongitude=function(t,e,r){for(var n=new Float32Array(3*(e+1)),i=0;i<=e;i++){var o=r.unprojectBasic([t,i/e],.16),a=3*i;n[0+a]=o[0],n[1+a]=o[1],n[2+a]=o[2]}var s=new d.BufferGeometry;return s.addAttribute("position",new d.BufferAttribute(n,3)),new d.Line(s,new d.LineBasicMaterial)},i.prototype._createPanoCamera=function(t){var e=new d.Object3D;return e.children.push(this._createAxis(t)),e.children.push(this._createLatitude(.5,10,t)),e.children.push(this._createLongitude(0,6,t)),e.children.push(this._createLongitude(.25,6,t)),e.children.push(this._createLongitude(.5,6,t)),e.children.push(this._createLongitude(.75,6,t)),e},i.prototype._createClusterPoints=function(e,t){for(var r=Object.keys(e.points).map(function(t){return e.points[t]}),n=r.length,i=new Float32Array(3*n),o=new Float32Array(3*n),a=0;a<n;a++){var s=3*a,u=r[a].coordinates,c=new d.Vector3(u[0],u[1],u[2]).add((new d.Vector3).fromArray(t));i[0+s]=c.x,i[1+s]=c.y,i[2+s]=c.z;var l=r[a].color;o[0+s]=l[0]/255,o[1+s]=l[1]/255,o[2+s]=l[2]/255}var h=new d.BufferGeometry;h.addAttribute("position",new d.BufferAttribute(i,3)),h.addAttribute("color",new d.BufferAttribute(o,3));var p=new d.PointsMaterial({size:.1,vertexColors:d.VertexColors});return new d.Points(h,p)},i.prototype._createPosition=function(t,e){var r=[e,t.unprojectBasic([0,0],0)],n=new d.BufferGeometry;return n.addAttribute("position",new d.BufferAttribute(this._arrayToFloatArray(r,3),3)),new d.Line(n,new d.LineBasicMaterial({color:new d.Color(1,0,0)}))},i.prototype._createPrespectiveCamera=function(t){var e=new d.Object3D;return e.children.push(this._createDiagonals(t,.2)),e.children.push(this._createFrame(t,.2)),e},i.prototype._disposeCameras=function(t){for(var e=this._nodes[t].cameras,r=0,n=e.children.slice();r<n.length;r++){for(var i=n[r],o=0,a=i.children;o<a.length;o++){var s=a[o];s.geometry.dispose(),s.material.dispose();var u=this._interactiveObjects.indexOf(s);-1!==u?this._interactiveObjects.splice(u,1):console.warn("Object does not exist ("+s.id+") for "+t)}e.remove(i)}this._scene.remove(e)},i.prototype._disposePoints=function(t){for(var e=0,r=this._tileClusterReconstructions[t].keys;e<r.length;e++){var n=r[e];if(n in this._clusterReconstructions){var i=this._clusterReconstructions[n].tiles.indexOf(t);if(-1!==i&&(this._clusterReconstructions[n].tiles.splice(i,1),!(0<this._clusterReconstructions[n].tiles.length))){for(var o=0,a=this._clusterReconstructions[n].points.children.slice();o<a.length;o++){var s=a[o];s.geometry.dispose(),s.material.dispose()}this._scene.remove(this._clusterReconstructions[n].points),delete this._clusterReconstructions[n]}}}},i.prototype._disposePositions=function(t){for(var e=this._nodes[t].positions,r=0,n=e.children.slice();r<n.length;r++){var i=n[r];i.geometry.dispose(),i.material.dispose(),e.remove(i)}this._scene.remove(e)},i.prototype._disposeNodes=function(t){this._disposeCameras(t),this._disposePositions(t),delete this._nodes[t]},i.prototype._disposeReconstruction=function(t){this._disposePoints(t),delete this._tileClusterReconstructions[t]},i.prototype._disposeTile=function(t){for(var e=this._tiles[t],r=0,n=e.children.slice();r<n.length;r++){var i=n[r];i.geometry.dispose(),i.material.dispose(),e.remove(i)}this._scene.remove(e),delete this._tiles[t]},i.prototype._getColor=function(t,e){return e!==h.default.Default&&0<t.length?this._getCameraColor(t):"#FFFFFF"},i.prototype._getCameraColor=function(t){return t in this._cameraColors||(this._cameraColors[t]=this._randomColor()),this._cameraColors[t]},i.prototype._getId=function(t,e,r,n){switch(n){case h.default.Cluster:return t;case h.default.ConnectedComponent:return e;case h.default.Sequence:return r;default:return""}},i.prototype._interpolate=function(t,e,r){return t+r*(e-t)},i.prototype._randomColor=function(){return"hsl("+Math.floor(360*Math.random())+", 100%, 65%)"},i.prototype._setCameraColor=function(t,e){for(var r=0,n=e.children;r<n.length;r++)n[r].material.color=new d.Color(t)},i.prototype._subsample=function(t,e,r){if(r<1)return[t,e];for(var n=[],i=0;i<=r+1;i++){for(var o=[],a=0;a<3;a++)o.push(this._interpolate(t[a],e[a],i/(r+1)));n.push(o)}return n},i);function i(t,e,r){this._scene=e||new d.Scene,this._raycaster=r||new d.Raycaster(void 0,void 0,.8),this._cameraColors={},this._needsRender=!1,this._interactiveObjects=[],this._nodes={},this._tiles={},this._tileClusterReconstructions={},this._clusterReconstructions={},this._cameraVisualizationMode=t.cameraVisualizationMode?t.cameraVisualizationMode:h.default.Default,this._cameraVisualizationMode===h.default.Default&&!0===t.connectedComponents&&(this._cameraVisualizationMode=h.default.ConnectedComponent),this._camerasVisible=t.camerasVisible,this._pointsVisible=t.pointsVisible,this._positionsVisible=t.positionsVisible,this._tilesVisible=t.tilesVisible}r.SpatialDataScene=n,r.default=n},{"./CameraVisualizationMode":356,three:242}],361:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./error/GeometryTagError");r.GeometryTagError=n.GeometryTagError;var i=t("./geometry/PointGeometry");r.PointGeometry=i.PointGeometry;var o=t("./geometry/PointsGeometry");r.PointsGeometry=o.PointsGeometry;var a=t("./geometry/RectGeometry");r.RectGeometry=a.RectGeometry;var s=t("./geometry/PolygonGeometry");r.PolygonGeometry=s.PolygonGeometry;var u=t("./tag/OutlineTag");r.OutlineTag=u.OutlineTag;var c=t("./tag/ExtremePointTag");r.ExtremePointTag=c.ExtremePointTag;var l=t("./tag/SpotTag");r.SpotTag=l.SpotTag;var h=t("./tag/TagDomain");r.TagDomain=h.TagDomain;var p=t("./TagComponent");r.TagComponent=p.TagComponent;var f=t("./TagMode");r.TagMode=f.TagMode},{"./TagComponent":362,"./TagMode":365,"./error/GeometryTagError":369,"./geometry/PointGeometry":371,"./geometry/PointsGeometry":372,"./geometry/PolygonGeometry":373,"./geometry/RectGeometry":374,"./tag/ExtremePointTag":388,"./tag/OutlineTag":392,"./tag/SpotTag":395,"./tag/TagDomain":397}],362:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,s=t("rxjs"),u=t("rxjs/operators"),a=t("when"),c=t("../../Component"),l=t("../../Geo"),h=t("../../Render"),p=(o=c.Component,i(f,o),f.prototype.add=function(r){var n=this;this._activated?this._navigator.stateService.currentTransform$.pipe(u.first()).subscribe(function(t){n._tagSet.add(r,t);var e=r.map(function(t){return n._tagSet.get(t.id)});n._tagScene.add(e)}):this._tagSet.addDeactivated(r)},f.prototype.calculateRect=function(n){var t=this;return a.promise(function(e,r){t._navigator.stateService.currentTransform$.pipe(u.first(),u.map(function(t){return n.getRect2d(t)})).subscribe(function(t){e(t)},function(t){r(t)})})},f.prototype.create=function(){this._tagCreator.replayedTag$.pipe(u.first(),u.filter(function(t){return!!t})).subscribe(function(t){t.create()})},f.prototype.changeMode=function(t){this.configure({mode:t})},f.prototype.get=function(t){if(this._activated){var e=this._tagSet.get(t);return void 0!==e?e.tag:void 0}return this._tagSet.getDeactivated(t)},f.prototype.getAll=function(){return this.activated?this._tagSet.getAll().map(function(t){return t.tag}):this._tagSet.getAllDeactivated()},f.prototype.getTagIdsAt=function(n){var i=this;return a.promise(function(e,r){i._container.renderService.renderCamera$.pipe(u.first(),u.map(function(t){var e=i._viewportCoords.canvasToViewport(n[0],n[1],i._container.element);return i._tagScene.intersectObjects(e,t.perspective)})).subscribe(function(t){e(t)},function(t){r(t)})})},f.prototype.has=function(t){return this._activated?this._tagSet.has(t):this._tagSet.hasDeactivated(t)},f.prototype.remove=function(t){this._activated?(this._tagSet.remove(t),this._tagScene.remove(t)):this._tagSet.removeDeactivated(t)},f.prototype.removeAll=function(){this._activated?(this._tagSet.removeAll(),this._tagScene.removeAll()):this._tagSet.removeAllDeactivated()},f.prototype._activate=function(){var a=this;this._editVertexHandler.enable();var t=s.from(Object.keys(this._createHandlers)).pipe(u.map(function(t){return a._createHandlers[t]}),u.filter(function(t){return!!t}),u.mergeMap(function(t){return t.geometryCreated$}),u.share());this._fireGeometryCreatedSubscription=t.subscribe(function(t){a.fire(f.geometrycreated,t)}),this._fireCreateGeometryEventSubscription=this._tagCreator.tag$.pipe(u.skipWhile(function(t){return null==t}),u.distinctUntilChanged()).subscribe(function(t){var e=null!=t?f.creategeometrystart:f.creategeometryend;a.fire(e,a)}),this._handlerStopCreateSubscription=t.subscribe(function(){a.changeMode(c.TagMode.Default)}),this._handlerEnablerSubscription=this._creatingConfiguration$.subscribe(function(t){a._disableCreateHandlers();var e=c.TagMode[t.mode],r=a._createHandlers[e];r&&r.enable()}),this._fireTagsChangedSubscription=this._renderTags$.subscribe(function(){a.fire(f.tagschanged,a)}),this._stopCreateSubscription=this._tagCreator.tag$.pipe(u.switchMap(function(t){return null!=t?t.aborted$.pipe(u.map(function(){return null})):s.empty()})).subscribe(function(){a.changeMode(c.TagMode.Default)}),this._setGLCreateTagSubscription=this._tagCreator.tag$.subscribe(function(t){a._tagScene.hasCreateTag()&&a._tagScene.removeCreateTag(),null!=t&&a._tagScene.addCreateTag(t)}),this._createGLObjectsChangedSubscription=this._createGLObjectsChanged$.subscribe(function(t){a._tagScene.updateCreateTagObjects(t)}),this._updateGLObjectsSubscription=this._renderTagGLChanged$.subscribe(function(t){a._tagScene.updateObjects(t)}),this._updateTagSceneSubscription=this._tagChanged$.subscribe(function(){a._tagScene.update()}),this._domSubscription=s.combineLatest(this._renderTags$.pipe(u.startWith([]),u.tap(function(){a._container.domRenderer.render$.next({name:a._name,vnode:a._tagDomRenderer.clear()})})),this._container.renderService.renderCamera$,this._container.spriteService.spriteAtlas$,this._container.renderService.size$,this._tagChanged$.pipe(u.startWith(null)),s.merge(this._tagCreator.tag$,this._createGeometryChanged$).pipe(u.startWith(null))).pipe(u.map(function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[5];return{name:a._name,vnode:a._tagDomRenderer.render(e,o,n,r.perspective,i)}})).subscribe(this._container.domRenderer.render$),this._glSubscription=this._navigator.stateService.currentState$.pipe(u.map(function(t){var e=a._tagScene;return{name:a._name,render:{frameId:t.id,needsRender:e.needsRender,render:e.render.bind(e),stage:h.GLRenderStage.Foreground}}})).subscribe(this._container.glRenderer.render$),this._navigator.stateService.currentTransform$.pipe(u.first()).subscribe(function(t){a._tagSet.activate(t),a._tagScene.add(a._tagSet.getAll())})},f.prototype._deactivate=function(){this._editVertexHandler.disable(),this._disableCreateHandlers(),this._tagScene.clear(),this._tagSet.deactivate(),this._tagCreator.delete$.next(null),this._updateGLObjectsSubscription.unsubscribe(),this._updateTagSceneSubscription.unsubscribe(),this._stopCreateSubscription.unsubscribe(),this._setGLCreateTagSubscription.unsubscribe(),this._createGLObjectsChangedSubscription.unsubscribe(),this._domSubscription.unsubscribe(),this._glSubscription.unsubscribe(),this._fireCreateGeometryEventSubscription.unsubscribe(),this._fireGeometryCreatedSubscription.unsubscribe(),this._fireTagsChangedSubscription.unsubscribe(),this._handlerStopCreateSubscription.unsubscribe(),this._handlerEnablerSubscription.unsubscribe(),this._container.element.classList.remove("component-tag-create")},f.prototype._getDefaultConfiguration=function(){return{createColor:16777215,indicatePointsCompleter:!0,mode:c.TagMode.Default}},f.prototype._disableCreateHandlers=function(){var t=this._createHandlers;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r&&r.disable()}},f.componentName="tag",f.creategeometryend="creategeometryend",f.creategeometrystart="creategeometrystart",f.modechanged="modechanged",f.geometrycreated="geometrycreated",f.tagschanged="tagschanged",f);function f(t,e,r){var n=o.call(this,t,e,r)||this;return n._tagDomRenderer=new c.TagDOMRenderer,n._tagScene=new c.TagScene,n._tagSet=new c.TagSet,n._tagCreator=new c.TagCreator(n,r),n._viewportCoords=new l.ViewportCoords,n._createHandlers={CreatePoint:new c.CreatePointHandler(n,e,r,n._viewportCoords,n._tagCreator),CreatePoints:new c.CreatePointsHandler(n,e,r,n._viewportCoords,n._tagCreator),CreatePolygon:new c.CreatePolygonHandler(n,e,r,n._viewportCoords,n._tagCreator),CreateRect:new c.CreateRectHandler(n,e,r,n._viewportCoords,n._tagCreator),CreateRectDrag:new c.CreateRectDragHandler(n,e,r,n._viewportCoords,n._tagCreator),Default:void 0},n._editVertexHandler=new c.EditVertexHandler(n,e,r,n._viewportCoords,n._tagSet),n._renderTags$=n._tagSet.changed$.pipe(u.map(function(t){var e=t.getAll();return e.sort(function(t,e){var r=t.tag.id,n=e.tag.id;return r<n?-1:n<r?1:0}),e}),u.share()),n._tagChanged$=n._renderTags$.pipe(u.switchMap(function(t){return s.from(t).pipe(u.mergeMap(function(t){return s.merge(t.tag.changed$,t.tag.geometryChanged$)}))}),u.share()),n._renderTagGLChanged$=n._renderTags$.pipe(u.switchMap(function(t){return s.from(t).pipe(u.mergeMap(function(t){return t.glObjectsChanged$}))}),u.share()),n._createGeometryChanged$=n._tagCreator.tag$.pipe(u.switchMap(function(t){return null!=t?t.geometryChanged$:s.empty()}),u.share()),n._createGLObjectsChanged$=n._tagCreator.tag$.pipe(u.switchMap(function(t){return null!=t?t.glObjectsChanged$:s.empty()}),u.share()),n._creatingConfiguration$=n._configuration$.pipe(u.distinctUntilChanged(function(t,e){return t.mode===e.mode},function(t){return{createColor:t.createColor,mode:t.mode}}),u.publishReplay(1),u.refCount()),n._creatingConfiguration$.subscribe(function(t){n.fire(f.modechanged,t.mode)}),n}r.TagComponent=p,c.ComponentService.register(p),r.default=p},{"../../Component":291,"../../Geo":294,"../../Render":297,rxjs:43,"rxjs/operators":241,when:288}],363:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rxjs/operators"),i=t("rxjs"),o=t("../../Component"),a=(Object.defineProperty(s.prototype,"createRect$",{get:function(){return this._createRect$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"createPolygon$",{get:function(){return this._createPolygon$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"createPoints$",{get:function(){return this._createPoints$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"delete$",{get:function(){return this._delete$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"tag$",{get:function(){return this._tag$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"replayedTag$",{get:function(){return this._replayedTag$},enumerable:!0,configurable:!0}),s);function s(t,e){this._component=t,this._navigator=e,this._tagOperation$=new i.Subject,this._createPoints$=new i.Subject,this._createPolygon$=new i.Subject,this._createRect$=new i.Subject,this._delete$=new i.Subject,this._tag$=this._tagOperation$.pipe(n.scan(function(t,e){return e(t)},null),n.share()),this._replayedTag$=this._tag$.pipe(n.publishReplay(1),n.refCount()),this._replayedTag$.subscribe(),this._createPoints$.pipe(n.withLatestFrom(this._component.configuration$,this._navigator.stateService.currentTransform$),n.map(function(t){var e=t[0],r=t[1],n=t[2];return function(){var t=new o.PointsGeometry([[e[0],e[1]],[e[0],e[1]]]);return new o.ExtremePointCreateTag(t,{color:r.createColor,indicateCompleter:r.indicatePointsCompleter},n)}})).subscribe(this._tagOperation$),this._createRect$.pipe(n.withLatestFrom(this._component.configuration$,this._navigator.stateService.currentTransform$),n.map(function(t){var e=t[0],r=t[1],n=t[2];return function(){var t=new o.RectGeometry([e[0],e[1],e[0],e[1]]);return new o.OutlineCreateTag(t,{color:r.createColor},n)}})).subscribe(this._tagOperation$),this._createPolygon$.pipe(n.withLatestFrom(this._component.configuration$,this._navigator.stateService.currentTransform$),n.map(function(t){var e=t[0],r=t[1],n=t[2];return function(){var t=new o.PolygonGeometry([[e[0],e[1]],[e[0],e[1]],[e[0],e[1]]]);return new o.OutlineCreateTag(t,{color:r.createColor},n)}})).subscribe(this._tagOperation$),this._delete$.pipe(n.map(function(){return function(){return null}})).subscribe(this._tagOperation$)}r.TagCreator=a,r.default=a},{"../../Component":291,rxjs:43,"rxjs/operators":241}],364:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var c=t("virtual-dom"),n=(i.prototype.render=function(t,e,r,n,i){for(var o=[],a=0,s=t;a<s.length;a++){var u=s[a];o=o.concat(u.getDOMObjects(r,n,i))}return null!=e&&(o=o.concat(e.getDOMObjects(n,i))),c.h("div.TagContainer",{},o)},i.prototype.clear=function(){return c.h("div",{},[])},i);function i(){}r.TagDOMRenderer=n},{"virtual-dom":247}],365:[function(t,e,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),(i=n=r.TagMode||(r.TagMode={}))[i.Default=0]="Default",i[i.CreatePoint=1]="CreatePoint",i[i.CreatePoints=2]="CreatePoints",i[i.CreatePolygon=3]="CreatePolygon",i[i.CreateRect=4]="CreateRect",i[i.CreateRectDrag=5]="CreateRectDrag",r.default=n},{}],366:[function(t,e,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),(i=n=r.TagOperation||(r.TagOperation={}))[i.None=0]="None",i[i.Centroid=1]="Centroid",i[i.Vertex=2]="Vertex",r.default=n},{}],367:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var u=t("three"),n=(Object.defineProperty(i.prototype,"needsRender",{get:function(){return this._needsRender},enumerable:!0,configurable:!0}),i.prototype.add=function(t){for(var e=0,r=t;e<r.length;e++){var n=r[e];n.tag.id in this._tags&&this._remove(n.tag.id),this._add(n)}this._needsRender=!0},i.prototype.addCreateTag=function(t){for(var e=0,r=t.glObjects;e<r.length;e++){var n=r[e];this._scene.add(n)}this._createTag={tag:t,objects:t.glObjects},this._needsRender=!0},i.prototype.clear=function(){for(var t=0,e=Object.keys(this._tags);t<e.length;t++){var r=e[t];this._remove(r)}this._needsRender=!1},i.prototype.get=function(t){return this.has(t)?this._tags[t].tag:void 0},i.prototype.has=function(t){return t in this._tags},i.prototype.hasCreateTag=function(){return null!=this._createTag},i.prototype.intersectObjects=function(t,e){var r=t[0],n=t[1];this._raycaster.setFromCamera(new u.Vector2(r,n),e);for(var i=[],o=0,a=this._raycaster.intersectObjects(this._retrievableObjects);o<a.length;o++){var s=a[o];s.object.uuid in this._objectTags&&i.push(this._objectTags[s.object.uuid])}return i},i.prototype.remove=function(t){for(var e=0,r=t;e<r.length;e++){var n=r[e];this._remove(n)}this._needsRender=!0},i.prototype.removeAll=function(){for(var t=0,e=Object.keys(this._tags);t<e.length;t++){var r=e[t];this._remove(r)}this._needsRender=!0},i.prototype.removeCreateTag=function(){if(null!=this._createTag){for(var t=0,e=this._createTag.objects;t<e.length;t++){var r=e[t];this._scene.remove(r)}this._createTag.tag.dispose(),this._createTag=null,this._needsRender=!0}},i.prototype.render=function(t,e){e.render(this._scene,t),this._needsRender=!1},i.prototype.update=function(){this._needsRender=!0},i.prototype.updateCreateTagObjects=function(t){if(this._createTag.tag!==t)throw new Error("Create tags do not have the same reference.");for(var e=0,r=this._createTag.objects;e<r.length;e++){var n=r[e];this._scene.remove(n)}for(var i=0,o=t.glObjects;i<o.length;i++)n=o[i],this._scene.add(n);this._createTag.objects=t.glObjects,this._needsRender=!0},i.prototype.updateObjects=function(t){var e=t.tag.id;if(this._tags[e].tag!==t)throw new Error("Tags do not have the same reference.");var r=this._tags[e];this._removeObjects(r),delete this._tags[e],this._add(t),this._needsRender=!0},i.prototype._add=function(t){var e=t.tag.id,r={tag:t,objects:[],retrievableObjects:[]};this._tags[e]=r;for(var n=0,i=t.getGLObjects();n<i.length;n++){var o=i[n];r.objects.push(o),this._scene.add(o)}for(var a=0,s=t.getRetrievableObjects();a<s.length;a++){var u=s[a];r.retrievableObjects.push(u),this._retrievableObjects.push(u),this._objectTags[u.uuid]=t.tag.id}},i.prototype._remove=function(t){var e=this._tags[t];this._removeObjects(e),e.tag.dispose(),delete this._tags[t]},i.prototype._removeObjects=function(t){for(var e=0,r=t.objects;e<r.length;e++){var n=r[e];this._scene.remove(n)}for(var i=0,o=t.retrievableObjects;i<o.length;i++){var a=o[i],s=this._retrievableObjects.indexOf(a);-1!==s&&this._retrievableObjects.splice(s,1)}},i);function i(t,e){this._createTag=null,this._needsRender=!1,this._raycaster=e||new u.Raycaster,this._scene=t||new u.Scene,this._objectTags={},this._retrievableObjects=[],this._tags={}}r.TagScene=n,r.default=n},{three:242}],368:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rxjs"),i=t("../../Component"),o=t("./tag/ExtremePointTag"),a=t("./tag/ExtremePointRenderTag"),s=(Object.defineProperty(u.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"changed$",{get:function(){return this._notifyChanged$},enumerable:!0,configurable:!0}),u.prototype.activate=function(t){if(!this._active){for(var e in this._hashDeactivated)if(this._hashDeactivated.hasOwnProperty(e)){var r=this._hashDeactivated[e];this._add(r,t)}this._hashDeactivated={},this._active=!0,this._notifyChanged$.next(this)}},u.prototype.deactivate=function(){if(this._active){for(var t in this._hash)this._hash.hasOwnProperty(t)&&(this._hashDeactivated[t]=this._hash[t].tag);this._hash={},this._active=!1}},u.prototype.add=function(t,e){this._assertActivationState(!0);for(var r=0,n=t;r<n.length;r++){var i=n[r];this._add(i,e)}this._notifyChanged$.next(this)},u.prototype.addDeactivated=function(t){this._assertActivationState(!1);for(var e=0,r=t;e<r.length;e++){var n=r[e];if(!(n instanceof i.OutlineTag||n instanceof i.SpotTag||n instanceof o.default))throw new Error("Tag type not supported");this._hashDeactivated[n.id]=n}},u.prototype.get=function(t){return this.has(t)?this._hash[t]:void 0},u.prototype.getAll=function(){var e=this._hash;return Object.keys(e).map(function(t){return e[t]})},u.prototype.getAllDeactivated=function(){var e=this._hashDeactivated;return Object.keys(e).map(function(t){return e[t]})},u.prototype.getDeactivated=function(t){return this.hasDeactivated(t)?this._hashDeactivated[t]:void 0},u.prototype.has=function(t){return t in this._hash},u.prototype.hasDeactivated=function(t){return t in this._hashDeactivated},u.prototype.remove=function(t){this._assertActivationState(!0);for(var e=this._hash,r=0,n=t;r<n.length;r++){var i=n[r];i in e&&delete e[i]}this._notifyChanged$.next(this)},u.prototype.removeAll=function(){this._assertActivationState(!0),this._hash={},this._notifyChanged$.next(this)},u.prototype.removeAllDeactivated=function(){this._assertActivationState(!1),this._hashDeactivated={}},u.prototype.removeDeactivated=function(t){this._assertActivationState(!1);for(var e=this._hashDeactivated,r=0,n=t;r<n.length;r++){var i=n[r];i in e&&delete e[i]}},u.prototype._add=function(t,e){if(t instanceof i.OutlineTag)this._hash[t.id]=new i.OutlineRenderTag(t,e);else if(t instanceof i.SpotTag)this._hash[t.id]=new i.SpotRenderTag(t,e);else{if(!(t instanceof o.default))throw new Error("Tag type not supported");this._hash[t.id]=new a.default(t,e)}},u.prototype._assertActivationState=function(t){if(t!==this._active)throw new Error("Tag set not in correct state for operation.")},u);function u(){this._active=!1,this._hash={},this._hashDeactivated={},this._notifyChanged$=new n.Subject}r.TagSet=s,r.default=s},{"../../Component":291,"./tag/ExtremePointRenderTag":387,"./tag/ExtremePointTag":388,rxjs:43}],369:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../../../Error"),s=(o=a.MapillaryError,i(u,o),u);function u(t){var e=o.call(this,null!=t?t:"The provided geometry value is incorrect")||this;return Object.setPrototypeOf(e,u.prototype),e.name="GeometryTagError",e}r.GeometryTagError=s,r.default=a.MapillaryError},{"../../../Error":293}],370:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rxjs"),i=(Object.defineProperty(o.prototype,"changed$",{get:function(){return this._notifyChanged$},enumerable:!0,configurable:!0}),o);function o(){this._notifyChanged$=new n.Subject}r.Geometry=i,r.default=i},{rxjs:43}],371:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../../../Component"),s=(o=a.Geometry,i(u,o),Object.defineProperty(u.prototype,"point",{get:function(){return this._point},enumerable:!0,configurable:!0}),u.prototype.getCentroid2d=function(){return this._point.slice()},u.prototype.getCentroid3d=function(t){return t.unprojectBasic(this._point,200)},u.prototype.setCentroid2d=function(t,e){var r=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._point[0]=r[0],this._point[1]=r[1],this._notifyChanged$.next(this)},u);function u(t){var e=o.call(this)||this,r=t[0],n=t[1];if(r<0||1<r||n<0||1<n)throw new a.GeometryTagError("Basic coordinates must be on the interval [0, 1].");return e._point=t.slice(),e}r.PointGeometry=s,r.default=s},{"../../../Component":291}],372:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../../../Component"),s=(o=a.Geometry,i(u,o),Object.defineProperty(u.prototype,"points",{get:function(){return this._points},enumerable:!0,configurable:!0}),u.prototype.addPoint2d=function(t){var e=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._points.push(e),this._notifyChanged$.next(this)},u.prototype.getPoint2d=function(t){return this._points[t].slice()},u.prototype.removePoint2d=function(t){if(t<0||t>=this._points.length||this._points.length<3)throw new a.GeometryTagError("Index for removed point must be valid.");this._points.splice(t,1),this._notifyChanged$.next(this)},u.prototype.setVertex2d=function(t,e,r){this.setPoint2d(t,e,r)},u.prototype.setPoint2d=function(t,e,r){var n=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];this._points[t]=n,this._notifyChanged$.next(this)},u.prototype.getPoints3d=function(t){return this._getPoints3d(this._points,t)},u.prototype.getPoint3d=function(t,e){return e.unprojectBasic(this._points[t],200)},u.prototype.getPoints2d=function(){return this._points.slice()},u.prototype.getCentroid2d=function(t){if(!t)throw new a.GeometryTagError("Get centroid must be called with a transform for points geometries.");var e=this.getRect2d(t),r=e[0],n=e[1],i=e[2];return[r<i?(r+i)/2:(r+i+1)/2%1,(n+e[3])/2]},u.prototype.getCentroid3d=function(t){var e=this.getCentroid2d();return t.unprojectBasic(e,200)},u.prototype.getRect2d=function(t){for(var e=1,r=0,n=1,i=0,o=this._points,a=0,s=o;a<s.length;a++){var u=s[a];u[0]<e&&(e=u[0]),u[0]>r&&(r=u[0]),u[1]<n&&(n=u[1]),u[1]>i&&(i=u[1])}if(t.fullPano){for(var c=[],l=0;l<o.length;l++)c[l]=l;c.sort(function(t,e){return o[t][0]<o[e][0]?-1:o[t][0]>o[e][0]?1:t<e?-1:1});var h=o[c[0]][0]+1-o[c[c.length-1]][0],p=0;for(l=0;l<c.length-1;l++){var f=c[l],d=c[l+1],m=o[d][0]-o[f][0];h<m&&(h=m,p=l+1)}0<p&&(e=o[c[p]][0],r=o[c[p-1]][0])}return[e,n,r,i]},u.prototype.setCentroid2d=function(t,e){throw new Error("Not implemented")},u.prototype._getPoints3d=function(t,e){return t.map(function(t){return e.unprojectBasic(t,200)})},u);function u(t){var e=o.call(this)||this;if(t.length<2)throw new a.GeometryTagError("A points geometry must have two or more positions.");e._points=[];for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i[0]<0||1<i[0]||i[1]<0||1<i[1])throw new a.GeometryTagError("Basic coordinates of points must be on the interval [0, 1].");e._points.push(i.slice())}return e}r.PointsGeometry=s,r.default=s},{"../../../Component":291}],373:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var p,f=t("../../../Component"),o=(p=f.VertexGeometry,i(a,p),Object.defineProperty(a.prototype,"polygon",{get:function(){return this._polygon},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"holes",{get:function(){return this._holes},enumerable:!0,configurable:!0}),a.prototype.addVertex2d=function(t){var e=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))];this._polygon.splice(this._polygon.length-1,0,e),this._notifyChanged$.next(this)},a.prototype.getVertex2d=function(t){return this._polygon[t].slice()},a.prototype.removeVertex2d=function(t){if(t<0||t>=this._polygon.length||this._polygon.length<4)throw new f.GeometryTagError("Index for removed vertex must be valid.");if(0<t&&t<this._polygon.length-1)this._polygon.splice(t,1);else{this._polygon.splice(0,1),this._polygon.pop();var e=this._polygon[0].slice();this._polygon.push(e)}this._notifyChanged$.next(this)},a.prototype.setVertex2d=function(t,e,r){var n=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))];0===t||t===this._polygon.length-1?(this._polygon[0]=n.slice(),this._polygon[this._polygon.length-1]=n.slice()):this._polygon[t]=n.slice(),this._notifyChanged$.next(this)},a.prototype.setCentroid2d=function(t,e){for(var r=this._polygon.map(function(t){return t[0]}),n=this._polygon.map(function(t){return t[1]}),i=Math.min.apply(Math,r),o=Math.max.apply(Math,r),a=Math.min.apply(Math,n),s=Math.max.apply(Math,n),u=this.getCentroid2d(),c=-i,l=1-o,h=-a,p=1-s,f=Math.max(c,Math.min(l,t[0]-u[0])),d=Math.max(h,Math.min(p,t[1]-u[1])),m=0,g=this._polygon;m<g.length;m++){var y=g[m];y[0]+=f,y[1]+=d}this._notifyChanged$.next(this)},a.prototype.getPoints3d=function(t){return this._getPoints3d(this._subsample(this._polygon),t)},a.prototype.getVertex3d=function(t,e){return e.unprojectBasic(this._polygon[t],200)},a.prototype.getVertices2d=function(){return this._polygon.slice()},a.prototype.getVertices3d=function(t){return this._getPoints3d(this._polygon,t)},a.prototype.getHolePoints3d=function(e){var r=this;return this._holes.map(function(t){return r._getPoints3d(r._subsample(t),e)})},a.prototype.getHoleVertices3d=function(e){var r=this;return this._holes.map(function(t){return r._getPoints3d(t,e)})},a.prototype.getCentroid2d=function(){for(var t=this._polygon,e=0,r=0,n=0,i=0;i<t.length-1;i++){var o=t[i][0],a=t[i][1],s=t[i+1][0],u=t[i+1][1],c=o*u-s*a;e+=c,r+=(o+s)*c,n+=(a+u)*c}return[r/=6*(e/=2),n/=6*e]},a.prototype.getCentroid3d=function(t){var e=this.getCentroid2d();return t.unprojectBasic(e,200)},a.prototype.get3dDomainTriangles3d=function(e){var r=this;return this._triangulate(this._project(this._polygon,e),this.getVertices3d(e),this._holes.map(function(t){return r._project(t,e)}),this.getHoleVertices3d(e))},a.prototype.getTriangles3d=function(e){var r=this;if(e.fullPano)return this._triangulatePano(this._polygon.slice(),this.holes.slice(),e);var t=this._project(this._subsample(this._polygon),e),n=this.getPoints3d(e),i=this._holes.map(function(t){return r._project(r._subsample(t),e)}),o=this.getHolePoints3d(e);return this._triangulate(t,n,i,o)},a.prototype.getPoleOfInaccessibility2d=function(){return this._getPoleOfInaccessibility2d(this._polygon.slice())},a.prototype.getPoleOfInaccessibility3d=function(t){var e=this._getPoleOfInaccessibility2d(this._polygon.slice());return t.unprojectBasic(e,200)},a.prototype._getPoints3d=function(t,e){return t.map(function(t){return e.unprojectBasic(t,200)})},a);function a(t,e){var r=p.call(this)||this,n=t.length;if(n<3)throw new f.GeometryTagError("A polygon must have three or more positions.");if(t[0][0]!==t[n-1][0]||t[0][1]!==t[n-1][1])throw new f.GeometryTagError("First and last positions must be equivalent.");r._polygon=[];for(var i=0,o=t;i<o.length;i++){if((h=o[i])[0]<0||1<h[0]||h[1]<0||1<h[1])throw new f.GeometryTagError("Basic coordinates of polygon must be on the interval [0, 1].");r._polygon.push(h.slice())}if(r._holes=[],null==e)return r;for(var a=0;a<e.length;a++){var s=e[a],u=s.length;if(u<3)throw new f.GeometryTagError("A polygon hole must have three or more positions.");if(s[0][0]!==s[u-1][0]||s[0][1]!==s[u-1][1])throw new f.GeometryTagError("First and last positions of hole must be equivalent.");r._holes.push([]);for(var c=0,l=s;c<l.length;c++){var h;if((h=l[c])[0]<0||1<h[0]||h[1]<0||1<h[1])throw new f.GeometryTagError("Basic coordinates of hole must be on the interval [0, 1].");r._holes[a].push(h.slice())}}return r}r.PolygonGeometry=o,r.default=o},{"../../../Component":291}],374:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../../../Component"),s=(o=a.VertexGeometry,i(u,o),Object.defineProperty(u.prototype,"anchorIndex",{get:function(){return this._anchorIndex},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"inverted",{get:function(){return this._inverted},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"rect",{get:function(){return this._rect},enumerable:!0,configurable:!0}),u.prototype.initializeAnchorIndexing=function(t){if(void 0!==this._anchorIndex)throw new Error("Anchor indexing is already initialized.");if(t<0||3<t)throw new Error("Invalid anchor index: "+t+".");this._anchorIndex=void 0===t?0:t},u.prototype.terminateAnchorIndexing=function(){this._anchorIndex=void 0},u.prototype.setOppositeVertex2d=function(t,e){if(void 0===this._anchorIndex)throw new Error("Anchor indexing needs to be initialized.");var r=[Math.max(0,Math.min(1,t[0])),Math.max(0,Math.min(1,t[1]))],n=this._rect.slice(),i=0===this._anchorIndex?[n[0],n[3]]:1===this._anchorIndex?[n[0],n[1]]:2===this._anchorIndex?[n[2],n[1]]:[n[2],n[3]];if(e.fullPano){var o=this._anchorIndex<2?r[0]-n[2]:r[0]-n[0];!this._inverted&&this._anchorIndex<2&&r[0]<.25&&.75<n[2]&&o<-.5?(this._inverted=!0,this._anchorIndex=r[1]<i[1]?0:1):!this._inverted&&2<=this._anchorIndex&&r[0]<.25&&.75<n[2]&&o<-.5?(this._inverted=!0,this._anchorIndex=r[1]<i[1]?0:1):this._inverted&&2<=this._anchorIndex&&r[0]<.25&&.75<n[0]&&o<-.5?(this._inverted=!1,this._anchorIndex=r[0]<i[0]?r[1]<i[1]?3:2:r[1]<i[1]?0:1):!this._inverted&&2<=this._anchorIndex&&.75<r[0]&&n[0]<.25&&.5<o?(this._inverted=!0,this._anchorIndex=r[1]<i[1]?3:2):!this._inverted&&this._anchorIndex<2&&.75<r[0]&&n[0]<.25&&.5<o?(this._inverted=!0,this._anchorIndex=r[1]<i[1]?3:2):this._inverted&&this._anchorIndex<2&&.75<r[0]&&n[2]<.25&&.5<o?(this._inverted=!1,this._anchorIndex=r[0]<i[0]?r[1]<i[1]?3:2:r[1]<i[1]?0:1):this._inverted&&this._anchorIndex<2&&r[0]>n[0]?(this._inverted=!1,this._anchorIndex=r[1]<i[1]?0:1):this._inverted&&2<=this._anchorIndex&&r[0]<n[2]?(this._inverted=!1,this._anchorIndex=r[1]<i[1]?3:2):this._inverted?this._anchorIndex<2?this._anchorIndex=r[1]<i[1]?0:1:this._anchorIndex=r[1]<i[1]?3:2:this._anchorIndex=i[0]<=r[0]&&r[1]<i[1]?0:i[0]<=r[0]&&i[1]<=r[1]?1:r[0]<i[0]&&i[1]<=r[1]?2:3;var a=[];0===this._anchorIndex?(a[0]=i[0],a[1]=r[1],a[2]=r[0],a[3]=i[1]):1===this._anchorIndex?(a[0]=i[0],a[1]=i[1],a[2]=r[0],a[3]=r[1]):2===this._anchorIndex?(a[0]=r[0],a[1]=i[1],a[2]=i[0],a[3]=r[1]):(a[0]=r[0],a[1]=r[1],a[2]=i[0],a[3]=i[1]),(!this._inverted&&a[0]>a[2]||this._inverted&&a[0]<a[2])&&(a[0]=n[0],a[2]=n[2]),a[1]>a[3]&&(a[1]=n[1],a[3]=n[3]),this._rect[0]=a[0],this._rect[1]=a[1],this._rect[2]=a[2],this._rect[3]=a[3]}else this._anchorIndex=i[0]<=r[0]&&r[1]<i[1]?0:i[0]<=r[0]&&i[1]<=r[1]?1:r[0]<i[0]&&i[1]<=r[1]?2:3,a=[],0===this._anchorIndex?(a[0]=i[0],a[1]=r[1],a[2]=r[0],a[3]=i[1]):1===this._anchorIndex?(a[0]=i[0],a[1]=i[1],a[2]=r[0],a[3]=r[1]):2===this._anchorIndex?(a[0]=r[0],a[1]=i[1],a[2]=i[0],a[3]=r[1]):(a[0]=r[0],a[1]=r[1],a[2]=i[0],a[3]=i[1]),a[0]>a[2]&&(a[0]=n[0],a[2]=n[2]),a[1]>a[3]&&(a[1]=n[1],a[3]=n[3]),this._rect[0]=a[0],this._rect[1]=a[1],this._rect[2]=a[2],this._rect[3]=a[3];this._notifyChanged$.next(this)},u.prototype.setVertex2d=function(t,e,r){var n=this._rect.slice(),i=[Math.max(0,Math.min(1,e[0])),Math.max(0,Math.min(1,e[1]))],o=[];if(0===t?(o[0]=i[0],o[1]=n[1],o[2]=n[2],o[3]=i[1]):1===t?(o[0]=i[0],o[1]=i[1],o[2]=n[2],o[3]=n[3]):2===t?(o[0]=n[0],o[1]=i[1],o[2]=i[0],o[3]=n[3]):3===t&&(o[0]=n[0],o[1]=n[1],o[2]=i[0],o[3]=i[1]),r.fullPano){var a=t<2&&.75<i[0]&&n[0]<.25||2<=t&&this._inverted&&.75<i[0]&&n[2]<.25,s=t<2&&this._inverted&&i[0]<.25&&.75<n[0]||2<=t&&i[0]<.25&&.75<n[2];a||s?this._inverted=!this._inverted:(o[0]-n[0]<-.25&&(o[0]=n[0]),.25<o[2]-n[2]&&(o[2]=n[2])),(!this._inverted&&o[0]>o[2]||this._inverted&&o[0]<o[2])&&(o[0]=n[0],o[2]=n[2])}else o[0]>o[2]&&(o[0]=n[0],o[2]=n[2]);o[1]>o[3]&&(o[1]=n[1],o[3]=n[3]),this._rect[0]=o[0],this._rect[1]=o[1],this._rect[2]=o[2],this._rect[3]=o[3],this._notifyChanged$.next(this)},u.prototype.setCentroid2d=function(t,e){var r=this._rect.slice(),n=r[0],i=this._inverted?r[2]+1:r[2],o=r[1],a=r[3],s=n+(i-n)/2,u=o+(a-o)/2,c=0;if(null!=e.gpano&&e.gpano.CroppedAreaImageWidthPixels===e.gpano.FullPanoWidthPixels)c=this._inverted?t[0]+1-s:t[0]-s;else{var l=-n,h=1-i;c=Math.max(l,Math.min(h,t[0]-s))}var p=-o,f=1-a,d=Math.max(p,Math.min(f,t[1]-u));this._rect[0]=r[0]+c,this._rect[1]=r[1]+d,this._rect[2]=r[2]+c,this._rect[3]=r[3]+d,this._rect[0]<0?(this._rect[0]+=1,this._inverted=!this._inverted):1<this._rect[0]&&(this._rect[0]-=1,this._inverted=!this._inverted),this._rect[2]<0?(this._rect[2]+=1,this._inverted=!this._inverted):1<this._rect[2]&&(this._rect[2]-=1,this._inverted=!this._inverted),this._notifyChanged$.next(this)},u.prototype.getPoints3d=function(e){return this._getPoints2d().map(function(t){return e.unprojectBasic(t,200)})},u.prototype.getVertex2d=function(t){return this._rectToVertices2d(this._rect)[t]},u.prototype.getNonAdjustedVertex2d=function(t){return this._rectToNonAdjustedVertices2d(this._rect)[t]},u.prototype.getVertex3d=function(t,e){return e.unprojectBasic(this._rectToVertices2d(this._rect)[t],200)},u.prototype.getVertices2d=function(){return this._rectToVertices2d(this._rect)},u.prototype.getVertices3d=function(e){return this._rectToVertices2d(this._rect).map(function(t){return e.unprojectBasic(t,200)})},u.prototype.getCentroid2d=function(){var t=this._rect;return[(t[0]+(this._inverted?t[2]+1:t[2]))/2,(t[1]+t[3])/2]},u.prototype.getCentroid3d=function(t){var e=this.getCentroid2d();return t.unprojectBasic(e,200)},u.prototype.getPoleOfInaccessibility2d=function(){return this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect))},u.prototype.getPoleOfInaccessibility3d=function(t){var e=this._getPoleOfInaccessibility2d(this._rectToVertices2d(this._rect));return t.unprojectBasic(e,200)},u.prototype.getTriangles3d=function(t){return t.fullPano?[]:this._triangulate(this._project(this._getPoints2d(),t),this.getPoints3d(t))},u.prototype.validate=function(t){var e=this._rect;return!(!this._inverted&&t[0]<e[0]||.25<t[0]-e[2]||t[1]<e[1])},u.prototype._getPoints2d=function(){for(var t=this._rectToVertices2d(this._rect),e=t.length-1,r=[],n=0;n<e;++n)for(var i=t[n][0],o=t[n][1],a=(t[n+1][0]-i)/9,s=(t[n+1][1]-o)/9,u=0;u<10;++u){var c=[i+u*a,o+u*s];r.push(c)}return r},u.prototype._rectToVertices2d=function(t){return[[t[0],t[3]],[t[0],t[1]],[this._inverted?t[2]+1:t[2],t[1]],[this._inverted?t[2]+1:t[2],t[3]],[t[0],t[3]]]},u.prototype._rectToNonAdjustedVertices2d=function(t){return[[t[0],t[3]],[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]]},u);function u(t){var e=o.call(this)||this;if(t[1]>t[3])throw new a.GeometryTagError("Basic Y coordinates values can not be inverted.");for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i<0||1<i)throw new a.GeometryTagError("Basic coordinates must be on the interval [0, 1].")}return e._anchorIndex=void 0,e._rect=t.slice(0,4),e._inverted=e._rect[0]>e._rect[2],e}r.RectGeometry=s,r.default=s},{"../../../Component":291}],375:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,y=t("earcut"),x=t("martinez-polygon-clipping"),a=t("@mapbox/polylabel"),s=t("three"),u=t("../../../Component"),c=(o=u.Geometry,i(l,o),l.prototype._getPoleOfInaccessibility2d=function(t){return a([t],.03)},l.prototype._project=function(t,e){var r=this._createCamera(e.upVector().toArray(),e.unprojectSfM([0,0],0),e.unprojectSfM([0,0],10));return this._deunproject(t,e,r)},l.prototype._subsample=function(t,e){void 0===e&&(e=this._subsampleThreshold);for(var r=[],n=t.length,i=0;i<n;i++){var o=t[i],a=t[(i+1)%n];r.push(o);for(var s=Math.sqrt(Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)),u=Math.floor(s/e),c=1/(u+1),l=1;l<=u;l++){var h=l*c,p=[(1-h)*o[0]+h*a[0],(1-h)*o[1]+h*a[1]];r.push(p)}}return r},l.prototype._triangulate=function(t,e,r,n){for(var i=[t.slice(0,-1)],o=0,a=null!=r?r:[];o<a.length;o++){var s=a[o];i.push(s.slice(0,-1))}for(var u=e.slice(0,-1),c=0,l=null!=n?n:[];c<l.length;c++){var h=l[c];u=u.concat(h.slice(0,-1))}for(var p=y.default.flatten(i),f=y.default(p.vertices,p.holes,p.dimensions),d=[],m=0;m<f.length;++m){var g=u[f[m]];d.push(g[0]),d.push(g[1]),d.push(g[2])}return d},l.prototype._triangulatePano=function(t,e,r){for(var n=[],i=0;i<3;i++)for(var o=0;o<3;o++){var a=i/3+(0===i?-1e-9:1e-9),s=o/3+(0===o?-1e-9:1e-9),u=(i+1)/3+1e-9,c=(o+1)/3+1e-9,l=[[a,s],[a,c],[u,c],[u,s],[a,s]],h=[(2*i+1)/6,(2*o+1)/6];n.push.apply(n,this._triangulateSubarea(t,e,l,h,r))}return n},l.prototype._unproject=function(t,e,r){return void 0===r&&(r=200),t.map(function(t){return e.unprojectBasic(t,r)})},l.prototype._createCamera=function(t,e,r){var n=new s.Camera;return n.up.copy((new s.Vector3).fromArray(t)),n.position.copy((new s.Vector3).fromArray(e)),n.lookAt((new s.Vector3).fromArray(r)),n.updateMatrix(),n.updateMatrixWorld(!0),n},l.prototype._deunproject=function(t,n,i){return t.map(function(t){var e=n.unprojectBasic(t,1e4),r=new s.Vector3(e[0],e[1],e[2]).applyMatrix4(i.matrixWorldInverse);return[r.x/r.z,r.y/r.z]})},l.prototype._triangulateSubarea=function(t,e,r,n,i){var o=x.intersection([t].concat(e),[r]);if(!o)return[];for(var a=[],s=this._subsampleThreshold,u=this._createCamera(i.upVector().toArray(),i.unprojectSfM([0,0],0),i.unprojectBasic(n,10)),c=0,l=o;c<l.length;c++){for(var h=l[c],p=this._subsample(h[0],s),f=this._deunproject(p,i,u),d=this._unproject(p,i),m=[],g=[],y=1;y<h.length;y++){var v=this._subsample(h[y],s),_=this._deunproject(v,i,u),b=this._unproject(v,i);m.push(_),g.push(b)}a.push.apply(a,this._triangulate(f,d,m,g))}return a},l);function l(){var t=o.call(this)||this;return t._subsampleThreshold=.005,t}r.VertexGeometry=c,r.default=c},{"../../../Component":291,"@mapbox/polylabel":1,earcut:8,"martinez-polygon-clipping":22,three:242}],376:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a,o=t("rxjs/operators"),s=t("rxjs"),u=t("../../../Component"),c=(a=u.TagHandlerBase,i(l,a),Object.defineProperty(l.prototype,"geometryCreated$",{get:function(){return this._geometryCreated$},enumerable:!0,configurable:!0}),l.prototype._enable=function(){this._enableCreate(),this._container.element.classList.add("component-tag-create")},l.prototype._disable=function(){this._container.element.classList.remove("component-tag-create"),this._disableCreate()},l.prototype._validateBasic=function(t){var e=t[0],r=t[1];return 0<=e&&e<=1&&0<=r&&r<=1},l.prototype._mouseEventToBasic$=function(t){var i=this;return t.pipe(o.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$),o.map(function(t){var e=t[0],r=t[1],n=t[2];return i._mouseEventToBasic(e,i._container.element,r,n)}))},l);function l(t,e,r,n,i){var o=a.call(this,t,e,r,n)||this;return o._tagCreator=i,o._geometryCreated$=new s.Subject,o}r.CreateHandlerBase=c,r.default=c},{"../../../Component":291,rxjs:43,"rxjs/operators":241}],377:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs/operators"),s=t("../../../Component"),u=(o=s.CreateHandlerBase,i(c,o),c.prototype._enableCreate=function(){this._container.mouseService.deferPixels(this._name,4),this._geometryCreatedSubscription=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(a.filter(this._validateBasic),a.map(function(t){return new s.PointGeometry(t)})).subscribe(this._geometryCreated$)},c.prototype._disableCreate=function(){this._container.mouseService.undeferPixels(this._name),this._geometryCreatedSubscription.unsubscribe()},c.prototype._getNameExtension=function(){return"create-point"},c);function c(){return null!==o&&o.apply(this,arguments)||this}r.CreatePointHandler=u,r.default=u},{"../../../Component":291,"rxjs/operators":241}],378:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../../../Component"),s=(o=a.CreateVertexHandler,i(u,o),u.prototype._addPoint=function(t,e){t.geometry.addPoint2d(e)},Object.defineProperty(u.prototype,"_create$",{get:function(){return this._tagCreator.createPoints$},enumerable:!0,configurable:!0}),u.prototype._getNameExtension=function(){return"create-points"},u.prototype._setVertex2d=function(t,e,r){t.geometry.setPoint2d(t.geometry.points.length-1,e,r)},u);function u(){return null!==o&&o.apply(this,arguments)||this}r.CreatePointsHandler=s,r.default=s},{"../../../Component":291}],379:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../../../Component"),s=(o=a.CreateVertexHandler,i(u,o),u.prototype._addPoint=function(t,e){t.addPoint(e)},Object.defineProperty(u.prototype,"_create$",{get:function(){return this._tagCreator.createPolygon$},enumerable:!0,configurable:!0}),u.prototype._getNameExtension=function(){return"create-polygon"},u.prototype._setVertex2d=function(t,e,r){t.geometry.setVertex2d(t.geometry.polygon.length-2,e,r)},u);function u(){return null!==o&&o.apply(this,arguments)||this}r.CreatePolygonHandler=s,r.default=s},{"../../../Component":291}],380:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs"),s=t("rxjs/operators"),u=t("../../../Component"),c=(o=u.CreateHandlerBase,i(l,o),l.prototype._enableCreate=function(){var o=this;this._container.mouseService.claimMouse(this._name,2),this._deleteSubscription=this._navigator.stateService.currentTransform$.pipe(s.map(function(t){return null}),s.skip(1)).subscribe(this._tagCreator.delete$),this._createSubscription=this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDragStart$)).pipe(s.filter(this._validateBasic)).subscribe(this._tagCreator.createRect$),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(s.filter(function(t){return!!t})).subscribe(function(t){t.geometry.initializeAnchorIndexing()});var e=a.combineLatest(a.merge(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseMove$),this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseMove$)),this._container.renderService.renderCamera$).pipe(s.withLatestFrom(this._navigator.stateService.currentTransform$),s.map(function(t){var e=t[0],r=e[0],n=e[1],i=t[1];return o._mouseEventToBasic(r,o._container.element,n,i)}));this._setVertexSubscription=this._tagCreator.tag$.pipe(s.switchMap(function(t){return t?a.combineLatest(a.of(t),e,o._navigator.stateService.currentTransform$):a.empty()})).subscribe(function(t){var e=t[0],r=t[1],n=t[2];e.geometry.setOppositeVertex2d(r,n)});var r=this._container.mouseService.mouseDragEnd$.pipe(s.withLatestFrom(this._mouseEventToBasic$(this._container.mouseService.filtered$(this._name,this._container.mouseService.mouseDrag$)).pipe(s.filter(this._validateBasic)),function(t,e){return e}),s.share());this._addPointSubscription=this._tagCreator.tag$.pipe(s.switchMap(function(t){return t?a.combineLatest(a.of(t),r):a.empty()})).subscribe(function(t){var e=t[0],r=t[1],n=e.geometry;n.validate(r)||(r=n.getNonAdjustedVertex2d(3)),e.addPoint(r)}),this._geometryCreatedSubscription=this._tagCreator.tag$.pipe(s.switchMap(function(t){return t?t.created$.pipe(s.map(function(t){return t.geometry})):a.empty()})).subscribe(this._geometryCreated$)},l.prototype._disableCreate=function(){this._container.mouseService.unclaimMouse(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreatedSubscription.unsubscribe(),this._initializeAnchorIndexingSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()},l.prototype._getNameExtension=function(){return"create-rect-drag"},l);function l(){return null!==o&&o.apply(this,arguments)||this}r.CreateRectDragHandler=c,r.default=c},{"../../../Component":291,rxjs:43,"rxjs/operators":241}],381:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs/operators"),s=t("../../../Component"),u=(o=s.CreateVertexHandler,i(c,o),Object.defineProperty(c.prototype,"_create$",{get:function(){return this._tagCreator.createRect$},enumerable:!0,configurable:!0}),c.prototype._addPoint=function(t,e){var r=t.geometry;r.validate(e)||(e=r.getNonAdjustedVertex2d(3)),t.addPoint(e)},c.prototype._enable=function(){o.prototype._enable.call(this),this._initializeAnchorIndexingSubscription=this._tagCreator.tag$.pipe(a.filter(function(t){return!!t})).subscribe(function(t){t.geometry.initializeAnchorIndexing()})},c.prototype._disable=function(){o.prototype._disable.call(this),this._initializeAnchorIndexingSubscription.unsubscribe()},c.prototype._getNameExtension=function(){return"create-rect"},c.prototype._setVertex2d=function(t,e,r){t.geometry.setOppositeVertex2d(e,r)},c);function c(){return null!==o&&o.apply(this,arguments)||this}r.CreateRectHandler=u,r.default=u},{"../../../Component":291,"rxjs/operators":241}],382:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,s=t("rxjs"),u=t("rxjs/operators"),a=t("../../../Component"),c=(o=a.CreateHandlerBase,i(l,o),l.prototype._enableCreate=function(){var a=this;this._container.mouseService.deferPixels(this._name,4);var t=this._navigator.stateService.currentTransform$.pipe(u.map(function(){}),u.publishReplay(1),u.refCount());this._deleteSubscription=t.pipe(u.skip(1)).subscribe(this._tagCreator.delete$);var e=this._mouseEventToBasic$(this._container.mouseService.proximateClick$).pipe(u.share());this._createSubscription=t.pipe(u.switchMap(function(){return e.pipe(u.filter(a._validateBasic),u.take(1))})).subscribe(this._create$),this._setVertexSubscription=this._tagCreator.tag$.pipe(u.switchMap(function(t){return t?s.combineLatest(s.of(t),s.merge(a._container.mouseService.mouseMove$,a._container.mouseService.domMouseMove$),a._container.renderService.renderCamera$,a._navigator.stateService.currentTransform$):s.empty()})).subscribe(function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=a._mouseEventToBasic(r,a._container.element,n,i);a._setVertex2d(e,o,i)}),this._addPointSubscription=this._tagCreator.tag$.pipe(u.switchMap(function(t){return t?s.combineLatest(s.of(t),e):s.empty()})).subscribe(function(t){var e=t[0],r=t[1];a._addPoint(e,r)}),this._geometryCreateSubscription=this._tagCreator.tag$.pipe(u.switchMap(function(t){return t?t.created$.pipe(u.map(function(t){return t.geometry})):s.empty()})).subscribe(this._geometryCreated$)},l.prototype._disableCreate=function(){this._container.mouseService.undeferPixels(this._name),this._tagCreator.delete$.next(null),this._addPointSubscription.unsubscribe(),this._createSubscription.unsubscribe(),this._deleteSubscription.unsubscribe(),this._geometryCreateSubscription.unsubscribe(),this._setVertexSubscription.unsubscribe()},l);function l(){return null!==o&&o.apply(this,arguments)||this}r.CreateVertexHandler=c,r.default=c},{"../../../Component":291,rxjs:43,"rxjs/operators":241}],383:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a,o=t("rxjs"),u=t("rxjs/operators"),c=t("../../../Component"),s=(a=c.TagHandlerBase,i(l,a),l.prototype._enable=function(){var s=this,t=this._tagSet.changed$.pipe(u.map(function(t){return t.getAll()}),u.switchMap(function(t){return o.from(t).pipe(u.mergeMap(function(t){return t.interact$}))}),u.switchMap(function(t){return o.concat(o.of(t),s._container.mouseService.documentMouseUp$.pipe(u.map(function(){return{offsetX:0,offsetY:0,operation:c.TagOperation.None,tag:null}}),u.first()))}),u.share());o.merge(this._container.mouseService.mouseMove$,this._container.mouseService.domMouseMove$).pipe(u.share()),this._claimMouseSubscription=t.pipe(u.switchMap(function(t){return t.tag?s._container.mouseService.domMouseDragStart$:o.empty()})).subscribe(function(){s._container.mouseService.claimMouse(s._name,3)}),this._cursorSubscription=t.pipe(u.map(function(t){return t.cursor}),u.distinctUntilChanged()).subscribe(function(t){for(var e=0,r=["crosshair","move","nesw-resize","nwse-resize"];e<r.length;e++){var n=r[e];s._container.element.classList.remove("component-tag-edit-"+n)}t&&s._container.element.classList.add("component-tag-edit-"+t)}),this._unclaimMouseSubscription=this._container.mouseService.filtered$(this._name,this._container.mouseService.domMouseDragEnd$).subscribe(function(t){s._container.mouseService.unclaimMouse(s._name)}),this._preventDefaultSubscription=t.pipe(u.switchMap(function(t){return t.tag?s._container.mouseService.documentMouseMove$:o.empty()})).subscribe(function(t){t.preventDefault()}),this._updateGeometrySubscription=t.pipe(u.switchMap(function(t){if(t.operation===c.TagOperation.None||!t.tag)return o.empty();var e=s._container.mouseService.filtered$(s._name,s._container.mouseService.domMouseDrag$).pipe(u.filter(function(t){return s._viewportCoords.insideElement(t,s._container.element)}));return o.combineLatest(e,s._container.renderService.renderCamera$).pipe(u.withLatestFrom(o.of(t),s._navigator.stateService.currentTransform$,function(t,e,r){return[t[0],t[1],e,r]}))})).subscribe(function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=s._mouseEventToBasic(e,s._container.element,r,i,n.offsetX,n.offsetY),a=n.tag.geometry;n.operation===c.TagOperation.Centroid?a.setCentroid2d(o,i):n.operation===c.TagOperation.Vertex&&a.setVertex2d(n.vertexIndex,o,i)})},l.prototype._disable=function(){this._claimMouseSubscription.unsubscribe(),this._cursorSubscription.unsubscribe(),this._preventDefaultSubscription.unsubscribe(),this._unclaimMouseSubscription.unsubscribe(),this._updateGeometrySubscription.unsubscribe()},l.prototype._getNameExtension=function(){return"edit-vertex"},l);function l(t,e,r,n,i){var o=a.call(this,t,e,r,n)||this;return o._tagSet=i,o}r.EditVertexHandler=s,r.default=s},{"../../../Component":291,rxjs:43,"rxjs/operators":241}],384:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../../../Component"),s=(o=a.HandlerBase,i(u,o),u.prototype._getConfiguration=function(t){return{}},u.prototype._mouseEventToBasic=function(t,e,r,n,i,o){i=null!=i?i:0,o=null!=o?o:0;var a=this._viewportCoords.canvasPosition(t,e),s=a[0],u=a[1];return this._viewportCoords.canvasToBasic(s-i,u-o,e,n,r.perspective)},u);function u(t,e,r,n){var i=o.call(this,t,e,r)||this;return i._name=i._component.name+"-"+i._getNameExtension(),i._viewportCoords=n,i}r.TagHandlerBase=s,r.default=s},{"../../../Component":291}],385:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rxjs/operators"),o=t("three"),i=t("rxjs"),a=t("../../../Geo"),s=(Object.defineProperty(u.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"glObjects",{get:function(){return this._glObjects},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"aborted$",{get:function(){return this._aborted$},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"created$",{get:function(){return this._created$},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"glObjectsChanged$",{get:function(){return this._glObjectsChanged$},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"geometryChanged$",{get:function(){var t=this;return this._geometry.changed$.pipe(n.map(function(){return t}))},enumerable:!0,configurable:!0}),u.prototype.dispose=function(){this._geometryChangedSubscription.unsubscribe()},u.prototype._canvasToTransform=function(t){return"translate(-50%,-50%) translate("+Math.round(t[0])+"px,"+Math.round(t[1])+"px)"},u.prototype._colorToBackground=function(t){return"#"+("000000"+t.toString(16)).substr(-6)},u.prototype._createOutine=function(t,e){var r=this._getLinePositions(t),n=new o.BufferGeometry;n.addAttribute("position",new o.BufferAttribute(r,3));var i=new o.LineBasicMaterial({color:e,linewidth:1});return new o.Line(n,i)},u.prototype._disposeLine=function(t){null!=t&&(t.geometry.dispose(),t.material.dispose())},u.prototype._getLinePositions=function(t){for(var e=t.length,r=new Float32Array(3*e),n=0;n<e;++n){var i=3*n,o=t[n];r[i]=o[0],r[1+i]=o[1],r[2+i]=o[2]}return r},u);function u(t,e,r){var n=this;this._geometry=t,this._transform=e,this._viewportCoords=r||new a.ViewportCoords,this._aborted$=new i.Subject,this._created$=new i.Subject,this._glObjectsChanged$=new i.Subject,this._geometryChangedSubscription=this._geometry.changed$.subscribe(function(){n._onGeometryChanged(),n._glObjectsChanged$.next(n)})}r.CreateTag=s,r.default=s},{"../../../Geo":294,rxjs:43,"rxjs/operators":241,three:242}],386:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,v=t("virtual-dom"),a=t("../Tag"),s=t("../../../Component"),u=(o=s.CreateTag,i(c,o),c.prototype.create=function(){this._geometry.points.length<3||(this._geometry.removePoint2d(this._geometry.points.length-1),this._created$.next(this))},c.prototype.dispose=function(){o.prototype.dispose.call(this),this._disposeObjects()},c.prototype.getDOMObjects=function(c,t){for(var l=this,h={offsetHeight:t.height,offsetWidth:t.width},p=[],f=this._geometry.getPoints2d(),d=f.length,e=function(t){var e=t,r=f[t],n=r[0],i=r[1],o=m._viewportCoords.basicToCanvasSafe(n,i,h,m._transform,c);if(!o)return"continue";var a=m._canvasToTransform(o),s={onclick:0===t&&d<3?function(t){t.stopPropagation(),l._aborted$.next(l)}:function(t){t.stopPropagation(),l._geometry.removePoint2d(e)},style:{transform:a}};p.push(v.h("div.TagInteractor",s,[]));var u={style:{background:m._colorToBackground(m._options.color),transform:a}};p.push(v.h("div.TagVertex",u,[]))},m=this,r=0;r<d-1;r++)e(r);if(2<d&&!0===this._options.indicateCompleter){var n=this._geometry.getCentroid2d(this._transform),i=n[0],o=n[1],a=this._viewportCoords.basicToCanvasSafe(i,o,h,this._transform,c);if(a){var s=this._canvasToTransform(a),u={onclick:function(t){t.stopPropagation(),l._geometry.removePoint2d(l._geometry.points.length-1),l._created$.next(l)},style:{transform:s}};p.push(v.h("div.TagCompleter.TagLarger",u,[]));var g={style:{background:this._colorToBackground(this._options.color),transform:s}};p.push(v.h("div.TagVertex.TagLarger",g,[]));var y={style:{transform:s}};p.push(v.h("div.TagDot",y,[]))}}return p},c.prototype._onGeometryChanged=function(){this._disposeObjects(),this._rectGeometry=new a.RectGeometry(this._geometry.getRect2d(this._transform)),this._createGlObjects()},c.prototype._createGlObjects=function(){this._glObjects=[];var t=this._rectGeometry.getPoints3d(this._transform);this._outline=this._createOutine(t,this._options.color),this._glObjects.push(this._outline)},c.prototype._disposeObjects=function(){this._disposeLine(this._outline),this._outline=null,this._glObjects=null},c);function c(t,e,r,n){var i=o.call(this,t,r,n)||this;return i._options={color:null==e.color?16777215:e.color,indicateCompleter:null==e.indicateCompleter||e.indicateCompleter},i._rectGeometry=new a.RectGeometry(i._geometry.getRect2d(r)),i._createGlObjects(),i}r.ExtremePointCreateTag=u},{"../../../Component":291,"../Tag":361,"virtual-dom":247}],387:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("three"),g=t("virtual-dom"),y=t("../../../Component"),s=(o=y.OutlineRenderTagBase,i(u,o),u.prototype.dispose=function(){o.prototype.dispose.call(this),this._disposeFill(),this._disposeOutline()},u.prototype.getDOMObjects=function(t,e,r){var n=[],i={offsetHeight:r.height,offsetWidth:r.width};if(!this._tag.editable)return n;for(var o=this._colorToCss(this._tag.lineColor),a=this._tag.geometry.getPoints2d(),s=0;s<a.length;s++){var u=a[s],c=u[0],l=u[1],h=this._viewportCoords.basicToCanvasSafe(c,l,i,this._transform,e);if(null!=h){var p=this._interact(y.TagOperation.Vertex,"crosshair",s),f="translate(-50%, -50%) translate("+Math.round(h[0])+"px,"+Math.round(h[1])+"px)",d={onmousedown:p,style:{background:o,transform:f,cursor:"crosshair"}};if(n.push(g.h("div.TagResizer",d,[])),this._tag.indicateVertices){var m={style:{background:o,transform:f}};n.push(g.h("div.TagVertex",m,[]))}}}return n},u.prototype.getGLObjects=function(){var t=[];return null!=this._fill&&t.push(this._fill),null!=this._outline&&t.push(this._outline),t},u.prototype.getRetrievableObjects=function(){return null!=this._fill?[this._fill]:[]},u.prototype._onGeometryChanged=function(){this._rectGeometry=new y.RectGeometry(this._tag.geometry.getRect2d(this._transform)),null!=this._fill&&this._updateFillGeometry(),null!=this._outline&&this._updateOulineGeometry()},u.prototype._onTagChanged=function(){var t=!1;return null!=this._fill&&this._updateFillMaterial(this._fill.material),null==this._outline?1<=this._tag.lineWidth&&(this._outline=this._createOutline(),t=!0):this._updateOutlineMaterial(),t},u.prototype._getPoints3d=function(){return this._rectGeometry.getPoints3d(this._transform)},u.prototype._getTriangles=function(){return this._rectGeometry.getTriangles3d(this._transform)},u.prototype._updateFillMaterial=function(t){t.color=new a.Color(this._tag.fillColor),t.opacity=this._tag.fillOpacity,t.needsUpdate=!0},u.prototype._updateLineBasicMaterial=function(t){t.color=new a.Color(this._tag.lineColor),t.linewidth=Math.max(this._tag.lineWidth,1),t.visible=1<=this._tag.lineWidth&&0<this._tag.lineOpacity,t.opacity=this._tag.lineOpacity,t.transparent=this._tag.lineOpacity<1,t.needsUpdate=!0},u.prototype._updateOutlineMaterial=function(){var t=this._outline.material;this._updateLineBasicMaterial(t)},u);function u(t,e){var r=o.call(this,t,e)||this;return r._rectGeometry=new y.RectGeometry(r._tag.geometry.getRect2d(e)),r._fill=e.gpano?null:r._createFill(),r._outline=1<=r._tag.lineWidth?r._createOutline():null,r}r.ExtremePointRenderTag=s,r.default=s},{"../../../Component":291,three:242,"virtual-dom":247}],388:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../../../Component"),s=(o=a.Tag,i(u,o),Object.defineProperty(u.prototype,"editable",{get:function(){return this._editable},set:function(t){this._editable=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"fillColor",{get:function(){return this._fillColor},set:function(t){this._fillColor=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"fillOpacity",{get:function(){return this._fillOpacity},set:function(t){this._fillOpacity=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"indicateVertices",{get:function(){return this._indicateVertices},set:function(t){this._indicateVertices=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"lineColor",{get:function(){return this._lineColor},set:function(t){this._lineColor=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"lineOpacity",{get:function(){return this._lineOpacity},set:function(t){this._lineOpacity=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),u.prototype.setOptions=function(t){this._editable=null==t.editable?this._editable:t.editable,this._indicateVertices=null==t.indicateVertices?this._indicateVertices:t.indicateVertices,this._lineColor=null==t.lineColor?this._lineColor:t.lineColor,this._lineWidth=null==t.lineWidth?this._lineWidth:t.lineWidth,this._fillColor=null==t.fillColor?this._fillColor:t.fillColor,this._fillOpacity=null==t.fillOpacity?this._fillOpacity:t.fillOpacity,this._notifyChanged$.next(this)},u);function u(t,e,r){var n=o.call(this,t,e)||this;return r=r||{},n._editable=null!=r.editable&&r.editable,n._fillColor=null==r.fillColor?16777215:r.fillColor,n._fillOpacity=null==r.fillOpacity?0:r.fillOpacity,n._indicateVertices=null==r.indicateVertices||r.indicateVertices,n._lineColor=null==r.lineColor?16777215:r.lineColor,n._lineOpacity=null==r.lineOpacity?1:r.lineOpacity,n._lineWidth=null==r.lineWidth?1:r.lineWidth,n}r.ExtremePointTag=s,r.default=s},{"../../../Component":291}],389:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,A=t("virtual-dom"),I=t("../../../Component"),a=(o=I.CreateTag,i(s,o),s.prototype.create=function(){if(this._geometry instanceof I.RectGeometry)this._created$.next(this);else if(this._geometry instanceof I.PolygonGeometry){var t=this._geometry;t.removeVertex2d(t.polygon.length-2),this._created$.next(this)}},s.prototype.dispose=function(){o.prototype.dispose.call(this),this._disposeLine(this._outline),this._disposeObjects()},s.prototype.getDOMObjects=function(t,e){function r(t){t.stopPropagation(),n._aborted$.next(n)}var n=this,i=[],o={offsetHeight:e.height,offsetWidth:e.width};if(this._geometry instanceof I.RectGeometry){var a=this._geometry.anchorIndex,s=void 0===a?1:a,u=this._geometry.getVertex2d(s),c=u[0],l=u[1],h=this._viewportCoords.basicToCanvasSafe(c,l,o,this._transform,t);if(null!=h){var p={style:{background:this._colorToBackground(this._options.color),transform:T=this._canvasToTransform(h)}},f={onclick:r,style:{transform:T}};i.push(A.h("div.TagInteractor",f,[])),i.push(A.h("div.TagVertex",p,[]))}}else if(this._geometry instanceof I.PolygonGeometry){var d=this._geometry,m=d.getVertex2d(0),g=m[0],y=m[1],v=this._viewportCoords.basicToCanvasSafe(g,y,o,this._transform,t);if(null!=v){f={onclick:4<d.polygon.length?function(t){t.stopPropagation(),d.removeVertex2d(d.polygon.length-2),n._created$.next(n)}:r,style:{transform:T=this._canvasToTransform(v)}};var _=4<d.polygon.length?"TagCompleter":"TagInteractor";i.push(A.h("div."+_,f,[]))}if(3<d.polygon.length){var b=d.getVertex2d(d.polygon.length-3),x=b[0],w=b[1],S=this._viewportCoords.basicToCanvasSafe(x,w,o,this._transform,t);null!=S&&(f={onclick:function(t){t.stopPropagation(),d.removeVertex2d(d.polygon.length-3)},style:{transform:T=this._canvasToTransform(S)}},i.push(A.h("div.TagInteractor",f,[])))}var E=d.polygon.slice();E.splice(-2,2);for(var C=0,M=E;C<M.length;C++){var T,P=M[C],O=this._viewportCoords.basicToCanvasSafe(P[0],P[1],o,this._transform,t);if(null!=O)p={style:{background:this._colorToBackground(this._options.color),transform:T=this._canvasToTransform(O)}},i.push(A.h("div.TagVertex",p,[]))}}return i},s.prototype.addPoint=function(t){if(this._geometry instanceof I.RectGeometry){if(!this._geometry.validate(t))return;this._created$.next(this)}else this._geometry instanceof I.PolygonGeometry&&this._geometry.addVertex2d(t)},s.prototype._onGeometryChanged=function(){this._disposeLine(this._outline),this._disposeObjects(),this._createGlObjects()},s.prototype._disposeObjects=function(){this._outline=null,this._glObjects=[]},s.prototype._createGlObjects=function(){var t=this._geometry instanceof I.RectGeometry?this._geometry.getPoints3d(this._transform):this._geometry.getVertices3d(this._transform);this._outline=this._createOutine(t,this._options.color),this._glObjects=[this._outline]},s);function s(t,e,r,n){var i=o.call(this,t,r,n)||this;return i._options={color:null==e.color?16777215:e.color},i._createGlObjects(),i}r.OutlineCreateTag=a,r.default=a},{"../../../Component":291,"virtual-dom":247}],390:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("three"),k=t("virtual-dom"),D=t("../../../Component"),s=(o=D.OutlineRenderTagBase,i(u,o),u.prototype.dispose=function(){o.prototype.dispose.call(this),this._disposeFill(),this._disposeHoles(),this._disposeOutline()},u.prototype.getDOMObjects=function(t,e,r){var n=this,i=[],o=this._tag.geometry instanceof D.RectGeometry,a=!this._transform.gpano,s={offsetHeight:r.height,offsetWidth:r.width};if(null!=this._tag.icon&&(o||a)){var u=this._tag.geometry instanceof D.RectGeometry?this._tag.geometry.getVertex2d(this._tag.iconIndex):this._tag.geometry.getPoleOfInaccessibility2d(),c=u[0],l=u[1],h=this._viewportCoords.basicToCanvasSafe(c,l,s,this._transform,e);if(null!=h){var p=function(){n._interact$.next({offsetX:0,offsetY:0,operation:D.TagOperation.None,tag:n._tag})};if(t.loaded){var f=t.getDOMSprite(this._tag.icon,this._tag.iconFloat),d={onclick:function(t){t.stopPropagation(),n._tag.click$.next(n._tag)},onmousedown:p,style:{transform:x="translate("+Math.round(h[0])+"px,"+Math.round(h[1])+"px)"}};i.push(k.h("div.TagSymbol",d,[f]))}}}else if(null!=this._tag.text&&(o||a)){var m=this._tag.geometry instanceof D.RectGeometry?this._tag.geometry.getVertex2d(3):this._tag.geometry.getPoleOfInaccessibility2d(),g=m[0],y=m[1],v=this._viewportCoords.basicToCanvasSafe(g,y,s,this._transform,e);if(null!=v){var _=Math.round(v[0]),b=Math.round(v[1]),x=this._tag.geometry instanceof D.RectGeometry?"translate("+_+"px,"+b+"px)":"translate(-50%, -50%) translate("+_+"px,"+b+"px)";d={onmousedown:p=function(){n._interact$.next({offsetX:0,offsetY:0,operation:D.TagOperation.None,tag:n._tag})},style:{color:this._colorToCss(this._tag.textColor),transform:x},textContent:this._tag.text},i.push(k.h("span.TagSymbol",d,[]))}}if(!this._tag.editable)return i;var w=this._colorToCss(this._tag.lineColor);if(this._tag.geometry instanceof D.RectGeometry){var S=this._tag.geometry.getCentroid2d(),E=S[0],C=S[1],M=this._viewportCoords.basicToCanvasSafe(E,C,s,this._transform,e);null!=M&&(d={onmousedown:p=this._interact(D.TagOperation.Centroid,"move"),style:{background:w,transform:x="translate(-50%, -50%) translate("+Math.round(M[0])+"px,"+Math.round(M[1])+"px)"}},i.push(k.h("div.TagMover",d,[])))}for(var T=this._tag.geometry.getVertices2d(),P=0;P<T.length-1;P++)if(!o||!(null!=this._tag.icon&&P===this._tag.iconIndex||null==this._tag.icon&&null!=this._tag.text&&3===P)){var O=T[P],A=O[0],I=O[1],L=this._viewportCoords.basicToCanvasSafe(A,I,s,this._transform,e);if(null!=L){var R=o?P%2==0?"nesw-resize":"nwse-resize":"crosshair";if(d={onmousedown:p=this._interact(D.TagOperation.Vertex,R,P),style:{background:w,transform:x="translate(-50%, -50%) translate("+Math.round(L[0])+"px,"+Math.round(L[1])+"px)",cursor:R}},i.push(k.h("div.TagResizer",d,[])),this._tag.indicateVertices){var N={style:{background:w,transform:x}};i.push(k.h("div.TagVertex",N,[]))}}}return i},u.prototype.getGLObjects=function(){var t=[];null!=this._fill&&t.push(this._fill);for(var e=0,r=this._holes;e<r.length;e++){var n=r[e];t.push(n)}return null!=this._outline&&t.push(this._outline),t},u.prototype.getRetrievableObjects=function(){return null!=this._fill?[this._fill]:[]},u.prototype._onGeometryChanged=function(){null!=this._fill&&this._updateFillGeometry(),0<this._holes.length&&this._updateHoleGeometries(),null!=this._outline&&this._updateOulineGeometry()},u.prototype._onTagChanged=function(){var t=!1;return null!=this._fill&&this._updateFillMaterial(this._fill.material),null==this._outline?1<=this._tag.lineWidth&&(this._holes=this._createHoles(),this._outline=this._createOutline(),t=!0):(this._updateHoleMaterials(),this._updateOutlineMaterial()),t},u.prototype._getPoints3d=function(){return this._in3dDomain()?this._tag.geometry.getVertices3d(this._transform):this._tag.geometry.getPoints3d(this._transform)},u.prototype._getTriangles=function(){return this._in3dDomain()?this._tag.geometry.get3dDomainTriangles3d(this._transform):this._tag.geometry.getTriangles3d(this._transform)},u.prototype._updateFillMaterial=function(t){t.color=new a.Color(this._tag.fillColor),t.opacity=this._tag.fillOpacity,t.needsUpdate=!0},u.prototype._updateLineBasicMaterial=function(t){t.color=new a.Color(this._tag.lineColor),t.linewidth=Math.max(this._tag.lineWidth,1),t.visible=1<=this._tag.lineWidth&&0<this._tag.lineOpacity,t.opacity=this._tag.lineOpacity,t.transparent=this._tag.lineOpacity<1,t.needsUpdate=!0},u.prototype._createHoles=function(){var t=[];if(this._tag.geometry instanceof D.PolygonGeometry)for(var e=0,r=this._getHoles3d();e<r.length;e++){var n=r[e],i=this._createLine(n);t.push(i)}return t},u.prototype._disposeHoles=function(){for(var t=0,e=this._holes;t<e.length;t++){var r=e[t];r.geometry.dispose(),r.material.dispose()}this._holes=[]},u.prototype._getHoles3d=function(){var t=this._tag.geometry;return this._in3dDomain()?t.getHoleVertices3d(this._transform):t.getHolePoints3d(this._transform)},u.prototype._in3dDomain=function(){return this._tag.geometry instanceof D.PolygonGeometry&&this._tag.domain===D.TagDomain.ThreeDimensional},u.prototype._updateHoleGeometries=function(){var t=this._getHoles3d();if(t.length!==this._holes.length)throw new Error("Changing the number of holes is not supported.");for(var e=0;e<this._holes.length;e++){var r=t[e],n=this._holes[e];this._updateLine(n,r)}},u.prototype._updateHoleMaterials=function(){for(var t=0,e=this._holes;t<e.length;t++){var r=e[t];this._updateLineBasicMaterial(r.material)}},u.prototype._updateOutlineMaterial=function(){this._updateLineBasicMaterial(this._outline.material)},u);function u(t,e){var r=o.call(this,t,e)||this;return r._fill=e.gpano?e.fullPano&&t.domain===D.TagDomain.TwoDimensional&&t.geometry instanceof D.PolygonGeometry?r._createFill():null:r._createFill(),r._holes=1<=r._tag.lineWidth?r._createHoles():[],r._outline=1<=r._tag.lineWidth?r._createOutline():null,r}r.OutlineRenderTag=s},{"../../../Component":291,three:242,"virtual-dom":247}],391:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("three"),s=t("../../../Component"),u=(o=s.RenderTag,i(c,o),c.prototype.dispose=function(){this._changedSubscription.unsubscribe(),this._geometryChangedSubscription.unsubscribe()},c.prototype._colorToCss=function(t){return"#"+("000000"+t.toString(16)).substr(-6)},c.prototype._createFill=function(){var t=this._getTriangles(),e=new Float32Array(t),r=new a.BufferGeometry;r.addAttribute("position",new a.BufferAttribute(e,3)),r.computeBoundingSphere();var n=new a.MeshBasicMaterial({side:a.DoubleSide,transparent:!0});return this._updateFillMaterial(n),new a.Mesh(r,n)},c.prototype._createLine=function(t){var e=this._getLinePositions(t),r=new a.BufferGeometry;r.addAttribute("position",new a.BufferAttribute(e,3)),r.computeBoundingSphere();var n=new a.LineBasicMaterial;this._updateLineBasicMaterial(n);var i=new a.Line(r,n);return i.renderOrder=1,i},c.prototype._createOutline=function(){return this._createLine(this._getPoints3d())},c.prototype._disposeFill=function(){null!=this._fill&&(this._fill.geometry.dispose(),this._fill.material.dispose(),this._fill=null)},c.prototype._disposeOutline=function(){null!=this._outline&&(this._outline.geometry.dispose(),this._outline.material.dispose(),this._outline=null)},c.prototype._getLinePositions=function(t){for(var e=t.length,r=new Float32Array(3*e),n=0;n<e;++n){var i=3*n,o=t[n];r[0+i]=o[0],r[1+i]=o[1],r[2+i]=o[2]}return r},c.prototype._interact=function(n,i,o){var a=this;return function(t){var e=t.offsetX-t.target.offsetWidth/2,r=t.offsetY-t.target.offsetHeight/2;a._interact$.next({cursor:i,offsetX:e,offsetY:r,operation:n,tag:a._tag,vertexIndex:o})}},c.prototype._updateFillGeometry=function(){var t=this._getTriangles(),e=new Float32Array(t),r=this._fill.geometry,n=r.getAttribute("position");n.array.length===e.length?(n.set(e),n.needsUpdate=!0):(r.removeAttribute("position"),r.addAttribute("position",new a.BufferAttribute(e,3))),r.computeBoundingSphere()},c.prototype._updateLine=function(t,e){var r=this._getLinePositions(e),n=t.geometry,i=n.getAttribute("position");i.set(r),i.needsUpdate=!0,n.computeBoundingSphere()},c.prototype._updateOulineGeometry=function(){this._updateLine(this._outline,this._getPoints3d())},c);function c(t,e){var r=o.call(this,t,e)||this;return r._geometryChangedSubscription=r._tag.geometry.changed$.subscribe(function(){r._onGeometryChanged()}),r._changedSubscription=r._tag.changed$.subscribe(function(){r._onTagChanged()&&r._glObjectsChanged$.next(r)}),r}r.OutlineRenderTagBase=u,r.default=u},{"../../../Component":291,three:242}],392:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a,s=t("rxjs"),u=t("../../../Component"),c=t("../../../Viewer"),o=(a=u.Tag,i(l,a),Object.defineProperty(l.prototype,"click$",{get:function(){return this._click$},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"domain",{get:function(){return this._domain},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"editable",{get:function(){return this._editable},set:function(t){this._twoDimensionalPolygon(this._domain,this._geometry)||(this._editable=t,this._notifyChanged$.next(this))},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"fillColor",{get:function(){return this._fillColor},set:function(t){this._fillColor=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"fillOpacity",{get:function(){return this._fillOpacity},set:function(t){this._fillOpacity=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"icon",{get:function(){return this._icon},set:function(t){this._icon=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"iconFloat",{get:function(){return this._iconFloat},set:function(t){this._iconFloat=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"iconIndex",{get:function(){return this._iconIndex},set:function(t){this._iconIndex=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"indicateVertices",{get:function(){return this._indicateVertices},set:function(t){this._indicateVertices=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"lineColor",{get:function(){return this._lineColor},set:function(t){this._lineColor=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"lineOpacity",{get:function(){return this._lineOpacity},set:function(t){this._lineOpacity=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"textColor",{get:function(){return this._textColor},set:function(t){this._textColor=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),l.prototype.setOptions=function(t){var e=this._twoDimensionalPolygon(this._domain,this._geometry);this._editable=e||null==t.editable?this._editable:t.editable,this._icon=void 0===t.icon?this._icon:t.icon,this._iconFloat=null==t.iconFloat?this._iconFloat:t.iconFloat,this._iconIndex=null==t.iconIndex?this._iconIndex:t.iconIndex,this._indicateVertices=null==t.indicateVertices?this._indicateVertices:t.indicateVertices,this._lineColor=null==t.lineColor?this._lineColor:t.lineColor,this._lineWidth=null==t.lineWidth?this._lineWidth:t.lineWidth,this._fillColor=null==t.fillColor?this._fillColor:t.fillColor,this._fillOpacity=null==t.fillOpacity?this._fillOpacity:t.fillOpacity,this._text=void 0===t.text?this._text:t.text,this._textColor=null==t.textColor?this._textColor:t.textColor,this._notifyChanged$.next(this)},l.prototype._twoDimensionalPolygon=function(t,e){return t!==u.TagDomain.ThreeDimensional&&e instanceof u.PolygonGeometry},l.click="click",l);function l(t,e,r){var n=a.call(this,t,e)||this,i=null!=(r=r||{}).domain&&e instanceof u.PolygonGeometry?r.domain:u.TagDomain.TwoDimensional,o=n._twoDimensionalPolygon(i,e);return n._domain=i,n._editable=null!=r.editable&&!o&&r.editable,n._fillColor=null==r.fillColor?16777215:r.fillColor,n._fillOpacity=null==r.fillOpacity?0:r.fillOpacity,n._icon=void 0===r.icon?null:r.icon,n._iconFloat=null==r.iconFloat?c.Alignment.Center:r.iconFloat,n._iconIndex=null==r.iconIndex?3:r.iconIndex,n._indicateVertices=null==r.indicateVertices||r.indicateVertices,n._lineColor=null==r.lineColor?16777215:r.lineColor,n._lineOpacity=null==r.lineOpacity?1:r.lineOpacity,n._lineWidth=null==r.lineWidth?1:r.lineWidth,n._text=void 0===r.text?null:r.text,n._textColor=null==r.textColor?16777215:r.textColor,n._click$=new s.Subject,n._click$.subscribe(function(t){n.fire(l.click,n)}),n}r.OutlineTag=o,r.default=o},{"../../../Component":291,"../../../Viewer":302,rxjs:43}],393:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rxjs"),i=t("../../../Geo"),o=(Object.defineProperty(a.prototype,"glObjectsChanged$",{get:function(){return this._glObjectsChanged$},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"interact$",{get:function(){return this._interact$},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"tag",{get:function(){return this._tag},enumerable:!0,configurable:!0}),a);function a(t,e,r){this._tag=t,this._transform=e,this._viewportCoords=r||new i.ViewportCoords,this._glObjectsChanged$=new n.Subject,this._interact$=new n.Subject}r.RenderTag=o,r.default=o},{"../../../Geo":294,rxjs:43}],394:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,w=t("virtual-dom"),S=t("../../../Component"),E=t("../../../Viewer"),a=(o=S.RenderTag,i(s,o),s.prototype.dispose=function(){},s.prototype.getDOMObjects=function(t,e,r){var n=this,i=this._tag,o={offsetHeight:r.height,offsetWidth:r.width},a=[],s=i.geometry.getCentroid2d(),u=s[0],c=s[1],l=this._viewportCoords.basicToCanvasSafe(u,c,o,this._transform,e);if(null!=l){var h=function(t){n._interact$.next({offsetX:0,offsetY:0,operation:S.TagOperation.None,tag:i})},p=Math.round(l[0]),f=Math.round(l[1]);if(null!=i.icon){if(t.loaded){var d=t.getDOMSprite(i.icon,E.Alignment.Bottom),m={onmousedown:h,style:{pointerEvents:"all",transform:"translate("+p+"px,"+(f+8)+"px)"}};a.push(w.h("div",m,[d]))}}else if(null!=i.text){var g="translate(-50%,0%) translate("+p+"px,"+(f+8)+"px)";m={onmousedown:h,style:{color:this._colorToCss(i.textColor),transform:g},textContent:i.text},a.push(w.h("span.TagSymbol",m,[]))}var y=this._interact(S.TagOperation.Centroid,i,"move"),v=this._colorToCss(i.color),_="translate(-50%,-50%) translate("+p+"px,"+f+"px)";if(i.editable){var b={onmousedown:y,style:{background:v,transform:_}};a.push(w.h("div.TagSpotInteractor",b,[]))}var x={style:{background:v,transform:_}};a.push(w.h("div.TagVertex",x,[]))}return a},s.prototype.getGLObjects=function(){return[]},s.prototype.getRetrievableObjects=function(){return[]},s.prototype._colorToCss=function(t){return"#"+("000000"+t.toString(16)).substr(-6)},s.prototype._interact=function(n,i,o,a){var s=this;return function(t){var e=t.offsetX-t.target.offsetWidth/2,r=t.offsetY-t.target.offsetHeight/2;s._interact$.next({cursor:o,offsetX:e,offsetY:r,operation:n,tag:i,vertexIndex:a})}},s);function s(){return null!==o&&o.apply(this,arguments)||this}r.SpotRenderTag=a},{"../../../Component":291,"../../../Viewer":302,"virtual-dom":247}],395:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../../../Component"),s=(o=a.Tag,i(u,o),Object.defineProperty(u.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"editable",{get:function(){return this._editable},set:function(t){this._editable=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"icon",{get:function(){return this._icon},set:function(t){this._icon=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"textColor",{get:function(){return this._textColor},set:function(t){this._textColor=t,this._notifyChanged$.next(this)},enumerable:!0,configurable:!0}),u.prototype.setOptions=function(t){this._color=null==t.color?this._color:t.color,this._editable=null==t.editable?this._editable:t.editable,this._icon=void 0===t.icon?this._icon:t.icon,this._text=void 0===t.text?this._text:t.text,this._textColor=null==t.textColor?this._textColor:t.textColor,this._notifyChanged$.next(this)},u);function u(t,e,r){var n=o.call(this,t,e)||this;return r=r||{},n._color=null==r.color?16777215:r.color,n._editable=null!=r.editable&&r.editable,n._icon=void 0===r.icon?null:r.icon,n._text=void 0===r.text?null:r.text,n._textColor=null==r.textColor?16777215:r.textColor,n}r.SpotTag=s,r.default=s},{"../../../Component":291}],396:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs/operators"),s=t("rxjs"),u=t("../../../Utils"),c=(o=u.EventEmitter,i(l,o),Object.defineProperty(l.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"changed$",{get:function(){return this._notifyChanged$},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"geometryChanged$",{get:function(){var e=this;return this._geometry.changed$.pipe(a.map(function(t){return e}),a.share())},enumerable:!0,configurable:!0}),l.changed="changed",l.geometrychanged="geometrychanged",l);function l(t,e){var r=o.call(this)||this;return r._id=t,r._geometry=e,r._notifyChanged$=new s.Subject,r._notifyChanged$.subscribe(function(t){r.fire(l.changed,r)}),r._geometry.changed$.subscribe(function(t){r.fire(l.geometrychanged,r)}),r}r.Tag=c,r.default=c},{"../../../Utils":301,rxjs:43,"rxjs/operators":241}],397:[function(t,e,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),(i=n=r.TagDomain||(r.TagDomain={}))[i.TwoDimensional=0]="TwoDimensional",i[i.ThreeDimensional=1]="ThreeDimensional",r.default=n},{}],398:[function(t,e,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),(i=n=r.ComponentSize||(r.ComponentSize={}))[i.Automatic=0]="Automatic",i[i.Large=1]="Large",i[i.Small=2]="Small",r.default=n},{}],399:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),i.prototype.enable=function(){!this._enabled&&this._component.activated&&(this._enable(),this._enabled=!0,this._component.configure(this._getConfiguration(!0)))},i.prototype.disable=function(){this._enabled&&(this._disable(),this._enabled=!1,this._component.activated&&this._component.configure(this._getConfiguration(!1)))},i);function i(t,e,r){this._component=t,this._container=e,this._navigator=r,this._enabled=!1}r.HandlerBase=n,r.default=n},{}],400:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var _=t("three"),c=t("../../Component"),n=(i.prototype.createMesh=function(t,e){return t.pano?this._createImageSphere(t,e):"fisheye"===e.cameraProjection?this._createImagePlaneFisheye(t,e):this._createImagePlane(t,e)},i.prototype.createFlatMesh=function(t,e,r,n,i,o){var a=this._createTexture(t.image),s=this._createDistortedPlaneMaterialParameters(e,a),u=new _.ShaderMaterial(s),c=this._getFlatImagePlaneGeoFromBasic(e,r,n,i,o);return new _.Mesh(c,u)},i.prototype.createCurtainMesh=function(t,e){if(t.pano&&!t.fullPano)throw new Error("Cropped panoramas cannot have curtain.");return t.pano?this._createSphereCurtainMesh(t,e):"fisheye"===e.cameraProjection?this._createCurtainMeshFisheye(t,e):this._createCurtainMesh(t,e)},i.prototype.createDistortedCurtainMesh=function(t,e){if(t.pano)throw new Error("Cropped panoramas cannot have curtain.");return this._createDistortedCurtainMesh(t,e)},i.prototype._createCurtainMesh=function(t,e){var r=this._createTexture(t.image),n=this._createCurtainPlaneMaterialParameters(e,r),i=new _.ShaderMaterial(n),o=this._useMesh(e,t)?this._getImagePlaneGeo(e,t):this._getRegularFlatImagePlaneGeo(e);return new _.Mesh(o,i)},i.prototype._createCurtainMeshFisheye=function(t,e){var r=this._createTexture(t.image),n=this._createCurtainPlaneMaterialParametersFisheye(e,r),i=new _.ShaderMaterial(n),o=this._useMesh(e,t)?this._getImagePlaneGeoFisheye(e,t):this._getRegularFlatImagePlaneGeo(e);return new _.Mesh(o,i)},i.prototype._createDistortedCurtainMesh=function(t,e){var r=this._createTexture(t.image),n=this._createDistortedCurtainPlaneMaterialParameters(e,r),i=new _.ShaderMaterial(n),o=this._getRegularFlatImagePlaneGeo(e);return new _.Mesh(o,i)},i.prototype._createSphereCurtainMesh=function(t,e){var r=this._createTexture(t.image),n=this._createCurtainSphereMaterialParameters(e,r),i=new _.ShaderMaterial(n);return this._useMesh(e,t)?new _.Mesh(this._getImageSphereGeo(e,t),i):new _.Mesh(this._getFlatImageSphereGeo(e),i)},i.prototype._createImageSphere=function(t,e){var r=this._createTexture(t.image),n=this._createSphereMaterialParameters(e,r),i=new _.ShaderMaterial(n);return this._useMesh(e,t)?new _.Mesh(this._getImageSphereGeo(e,t),i):new _.Mesh(this._getFlatImageSphereGeo(e),i)},i.prototype._createImagePlane=function(t,e){var r=this._createTexture(t.image),n=this._createPlaneMaterialParameters(e,r),i=new _.ShaderMaterial(n),o=this._useMesh(e,t)?this._getImagePlaneGeo(e,t):this._getRegularFlatImagePlaneGeo(e);return new _.Mesh(o,i)},i.prototype._createImagePlaneFisheye=function(t,e){var r=this._createTexture(t.image),n=this._createPlaneMaterialParametersFisheye(e,r),i=new _.ShaderMaterial(n),o=this._useMesh(e,t)?this._getImagePlaneGeoFisheye(e,t):this._getRegularFlatImagePlaneGeoFisheye(e);return new _.Mesh(o,i)},i.prototype._createSphereMaterialParameters=function(t,e){var r=t.gpano,n=(r.FullPanoWidthPixels-r.CroppedAreaImageWidthPixels)/2,i=2*Math.PI*(r.CroppedAreaLeftPixels-n)/r.FullPanoWidthPixels,o=2*Math.PI*r.CroppedAreaImageWidthPixels/r.FullPanoWidthPixels,a=(r.FullPanoHeightPixels-r.CroppedAreaImageHeightPixels)/2,s=Math.PI*(a-r.CroppedAreaTopPixels)/r.FullPanoHeightPixels,u=Math.PI*r.CroppedAreaImageHeightPixels/r.FullPanoHeightPixels;return{depthWrite:!1,fragmentShader:c.Shaders.equirectangular.fragment,side:_.DoubleSide,transparent:!0,uniforms:{opacity:{type:"f",value:1},phiLength:{type:"f",value:o},phiShift:{type:"f",value:i},projectorMat:{type:"m4",value:t.rt},projectorTex:{type:"t",value:e},thetaLength:{type:"f",value:u},thetaShift:{type:"f",value:s}},vertexShader:c.Shaders.equirectangular.vertex}},i.prototype._createCurtainSphereMaterialParameters=function(t,e){var r=t.gpano,n=(r.FullPanoWidthPixels-r.CroppedAreaImageWidthPixels)/2,i=2*Math.PI*(r.CroppedAreaLeftPixels-n)/r.FullPanoWidthPixels,o=2*Math.PI*r.CroppedAreaImageWidthPixels/r.FullPanoWidthPixels,a=(r.FullPanoHeightPixels-r.CroppedAreaImageHeightPixels)/2,s=Math.PI*(a-r.CroppedAreaTopPixels)/r.FullPanoHeightPixels,u=Math.PI*r.CroppedAreaImageHeightPixels/r.FullPanoHeightPixels;return{depthWrite:!1,fragmentShader:c.Shaders.equirectangularCurtain.fragment,side:_.DoubleSide,transparent:!0,uniforms:{curtain:{type:"f",value:1},opacity:{type:"f",value:1},phiLength:{type:"f",value:o},phiShift:{type:"f",value:i},projectorMat:{type:"m4",value:t.rt},projectorTex:{type:"t",value:e},thetaLength:{type:"f",value:u},thetaShift:{type:"f",value:s}},vertexShader:c.Shaders.equirectangularCurtain.vertex}},i.prototype._createPlaneMaterialParameters=function(t,e){return{depthWrite:!1,fragmentShader:c.Shaders.perspective.fragment,side:_.DoubleSide,transparent:!0,uniforms:{focal:{type:"f",value:t.focal},k1:{type:"f",value:t.ck1},k2:{type:"f",value:t.ck2},opacity:{type:"f",value:1},projectorMat:{type:"m4",value:t.basicRt},projectorTex:{type:"t",value:e},radial_peak:{type:"f",value:t.radialPeak?t.radialPeak:0},scale_x:{type:"f",value:Math.max(t.basicHeight,t.basicWidth)/t.basicWidth},scale_y:{type:"f",value:Math.max(t.basicWidth,t.basicHeight)/t.basicHeight}},vertexShader:c.Shaders.perspective.vertex}},i.prototype._createPlaneMaterialParametersFisheye=function(t,e){return{depthWrite:!1,fragmentShader:c.Shaders.fisheye.fragment,side:_.DoubleSide,transparent:!0,uniforms:{focal:{type:"f",value:t.focal},k1:{type:"f",value:t.ck1},k2:{type:"f",value:t.ck2},opacity:{type:"f",value:1},projectorMat:{type:"m4",value:t.basicRt},projectorTex:{type:"t",value:e},radial_peak:{type:"f",value:t.radialPeak?t.radialPeak:0},scale_x:{type:"f",value:Math.max(t.basicHeight,t.basicWidth)/t.basicWidth},scale_y:{type:"f",value:Math.max(t.basicWidth,t.basicHeight)/t.basicHeight}},vertexShader:c.Shaders.fisheye.vertex}},i.prototype._createCurtainPlaneMaterialParametersFisheye=function(t,e){return{depthWrite:!1,fragmentShader:c.Shaders.fisheyeCurtain.fragment,side:_.DoubleSide,transparent:!0,uniforms:{curtain:{type:"f",value:1},focal:{type:"f",value:t.focal},k1:{type:"f",value:t.ck1},k2:{type:"f",value:t.ck2},opacity:{type:"f",value:1},projectorMat:{type:"m4",value:t.basicRt},projectorTex:{type:"t",value:e},radial_peak:{type:"f",value:t.radialPeak?t.radialPeak:0},scale_x:{type:"f",value:Math.max(t.basicHeight,t.basicWidth)/t.basicWidth},scale_y:{type:"f",value:Math.max(t.basicWidth,t.basicHeight)/t.basicHeight}},vertexShader:c.Shaders.fisheyeCurtain.vertex}},i.prototype._createCurtainPlaneMaterialParameters=function(t,e){return{depthWrite:!1,fragmentShader:c.Shaders.perspectiveCurtain.fragment,side:_.DoubleSide,transparent:!0,uniforms:{curtain:{type:"f",value:1},focal:{type:"f",value:t.focal},k1:{type:"f",value:t.ck1},k2:{type:"f",value:t.ck2},opacity:{type:"f",value:1},projectorMat:{type:"m4",value:t.basicRt},projectorTex:{type:"t",value:e},radial_peak:{type:"f",value:t.radialPeak?t.radialPeak:0},scale_x:{type:"f",value:Math.max(t.basicHeight,t.basicWidth)/t.basicWidth},scale_y:{type:"f",value:Math.max(t.basicWidth,t.basicHeight)/t.basicHeight}},vertexShader:c.Shaders.perspectiveCurtain.vertex}},i.prototype._createDistortedCurtainPlaneMaterialParameters=function(t,e){return{depthWrite:!1,fragmentShader:c.Shaders.perspectiveDistortedCurtain.fragment,side:_.DoubleSide,transparent:!0,uniforms:{curtain:{type:"f",value:1},opacity:{type:"f",value:1},projectorMat:{type:"m4",value:t.projectorMatrix()},projectorTex:{type:"t",value:e}},vertexShader:c.Shaders.perspectiveDistortedCurtain.vertex}},i.prototype._createDistortedPlaneMaterialParameters=function(t,e){return{depthWrite:!1,fragmentShader:c.Shaders.perspectiveDistorted.fragment,side:_.DoubleSide,transparent:!0,uniforms:{opacity:{type:"f",value:1},projectorMat:{type:"m4",value:t.projectorMatrix()},projectorTex:{type:"t",value:e}},vertexShader:c.Shaders.perspectiveDistorted.vertex}},i.prototype._createTexture=function(t){var e=new _.Texture(t);return e.minFilter=_.LinearFilter,e.needsUpdate=!0,e},i.prototype._useMesh=function(t,e){return e.mesh.vertices.length&&t.hasValidScale},i.prototype._getImageSphereGeo=function(t,e){for(var r=(new _.Matrix4).getInverse(t.srt),n=5*t.scale,i=this._imageSphereRadius*t.scale,o=e.mesh.vertices,a=o.length/3,s=new Float32Array(o.length),u=0;u<a;++u){var c=3*u,l=o[0+c],h=o[1+c],p=o[2+c],f=Math.sqrt(l*l+h*h+p*p),d=Math.max(n,Math.min(f,i))/f,m=new _.Vector3(l*d,h*d,p*d);m.applyMatrix4(r),s[0+c]=m.x,s[1+c]=m.y,s[2+c]=m.z}var g=e.mesh.faces,y=new Uint16Array(g.length);for(u=0;u<g.length;++u)y[u]=g[u];var v=new _.BufferGeometry;return v.addAttribute("position",new _.BufferAttribute(s,3)),v.setIndex(new _.BufferAttribute(y,1)),v},i.prototype._getImagePlaneGeo=function(t,e){for(var r=(new _.Matrix4).getInverse(t.srt),n=5*t.scale,i=this._imagePlaneDepth*t.scale,o=e.mesh.vertices,a=o.length/3,s=new Float32Array(o.length),u=0;u<a;++u){var c=3*u,l=o[0+c],h=o[1+c],p=o[2+c];u<4&&(l*=3,h*=3);var f=Math.max(n,Math.min(p,i)),d=f/p,m=new _.Vector3(l*d,h*d,f);m.applyMatrix4(r),s[0+c]=m.x,s[1+c]=m.y,s[2+c]=m.z}var g=e.mesh.faces,y=new Uint16Array(g.length);for(u=0;u<g.length;++u)y[u]=g[u];var v=new _.BufferGeometry;return v.addAttribute("position",new _.BufferAttribute(s,3)),v.setIndex(new _.BufferAttribute(y,1)),v},i.prototype._getImagePlaneGeoFisheye=function(t,e){for(var r=(new _.Matrix4).getInverse(t.srt),n=5*t.scale,i=this._imagePlaneDepth*t.scale,o=e.mesh.vertices,a=o.length/3,s=new Float32Array(o.length),u=0;u<a;++u){var c=3*u,l=o[0+c],h=o[1+c],p=o[2+c],f=Math.sqrt(l*l+h*h+p*p),d=Math.max(n,Math.min(f,i))/f,m=new _.Vector3(l*d,h*d,p*d);m.applyMatrix4(r),s[0+c]=m.x,s[1+c]=m.y,s[2+c]=m.z}var g=e.mesh.faces,y=new Uint16Array(g.length);for(u=0;u<g.length;++u)y[u]=g[u];var v=new _.BufferGeometry;return v.addAttribute("position",new _.BufferAttribute(s,3)),v.setIndex(new _.BufferAttribute(y,1)),v},i.prototype._getFlatImageSphereGeo=function(t){var e=t.gpano,r=2*Math.PI*e.CroppedAreaLeftPixels/e.FullPanoWidthPixels,n=2*Math.PI*e.CroppedAreaImageWidthPixels/e.FullPanoWidthPixels,i=Math.PI*(e.FullPanoHeightPixels-e.CroppedAreaImageHeightPixels-e.CroppedAreaTopPixels)/e.FullPanoHeightPixels,o=Math.PI*e.CroppedAreaImageHeightPixels/e.FullPanoHeightPixels,a=new _.SphereGeometry(this._imageSphereRadius,20,40,r-Math.PI/2,n,i,o);return a.applyMatrix((new _.Matrix4).getInverse(t.rt)),a},i.prototype._getRegularFlatImagePlaneGeo=function(t){var e=t.width,r=t.height,n=Math.max(e,r),i=e/2/n,o=r/2/n;return this._getFlatImagePlaneGeo(t,i,o)},i.prototype._getFlatImagePlaneGeo=function(t,e,r){var n=[];return n.push(t.unprojectSfM([-e,-r],this._imagePlaneDepth)),n.push(t.unprojectSfM([e,-r],this._imagePlaneDepth)),n.push(t.unprojectSfM([e,r],this._imagePlaneDepth)),n.push(t.unprojectSfM([-e,r],this._imagePlaneDepth)),this._createFlatGeometry(n)},i.prototype._getRegularFlatImagePlaneGeoFisheye=function(t){var e=t.width,r=t.height,n=Math.max(e,r),i=e/2/n,o=r/2/n;return this._getFlatImagePlaneGeoFisheye(t,i,o)},i.prototype._getFlatImagePlaneGeoFisheye=function(t,e,r){var n=[];return n.push(t.unprojectSfM([-e,-r],this._imagePlaneDepth)),n.push(t.unprojectSfM([e,-r],this._imagePlaneDepth)),n.push(t.unprojectSfM([e,r],this._imagePlaneDepth)),n.push(t.unprojectSfM([-e,r],this._imagePlaneDepth)),this._createFlatGeometry(n)},i.prototype._getFlatImagePlaneGeoFromBasic=function(t,e,r,n,i){var o=[];return o.push(t.unprojectBasic([e,n],this._imagePlaneDepth)),o.push(t.unprojectBasic([r,n],this._imagePlaneDepth)),o.push(t.unprojectBasic([r,i],this._imagePlaneDepth)),o.push(t.unprojectBasic([e,i],this._imagePlaneDepth)),this._createFlatGeometry(o)},i.prototype._createFlatGeometry=function(t){for(var e=new Float32Array(12),r=0;r<t.length;r++){var n=3*r;e[0+n]=t[r][0],e[1+n]=t[r][1],e[2+n]=t[r][2]}var i=new Uint16Array(6);i[0]=0,i[1]=1,i[2]=3,i[3]=1,i[4]=2,i[5]=3;var o=new _.BufferGeometry;return o.addAttribute("position",new _.BufferAttribute(e,3)),o.setIndex(new _.BufferAttribute(i,1)),o},i);function i(t,e){this._imagePlaneDepth=null!=t?t:200,this._imageSphereRadius=null!=e?e:200}r.MeshFactory=n,r.default=n},{"../../Component":291,three:242}],401:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("three"),i=(Object.defineProperty(o.prototype,"planes",{get:function(){return this._planes},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"planesOld",{get:function(){return this._planesOld},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"planesPeriphery",{get:function(){return this._planesPeriphery},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sceneOld",{get:function(){return this._sceneOld},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"scenePeriphery",{get:function(){return this._scenePeriphery},enumerable:!0,configurable:!0}),o.prototype.updateImagePlanes=function(t){for(var e in this._dispose(this._planesOld,this.sceneOld),this._planes)if(this._planes.hasOwnProperty(e)){var r=this._planes[e];this._scene.remove(r),this._sceneOld.add(r)}for(var e in t)t.hasOwnProperty(e)&&this._scene.add(t[e]);this._planesOld=this._planes,this._planes=t},o.prototype.addImagePlanes=function(t){for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];this._scene.add(r),this._planes[e]=r}},o.prototype.addImagePlanesOld=function(t){for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];this._sceneOld.add(r),this._planesOld[e]=r}},o.prototype.setImagePlanes=function(t){this._clear(),this.addImagePlanes(t)},o.prototype.addPeripheryPlanes=function(t){for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];this._scenePeriphery.add(r),this._planesPeriphery[e]=r}},o.prototype.setPeripheryPlanes=function(t){this._clearPeriphery(),this.addPeripheryPlanes(t)},o.prototype.setImagePlanesOld=function(t){this._clearOld(),this.addImagePlanesOld(t)},o.prototype.clear=function(){this._clear(),this._clearOld()},o.prototype._clear=function(){this._dispose(this._planes,this._scene),this._planes={}},o.prototype._clearOld=function(){this._dispose(this._planesOld,this._sceneOld),this._planesOld={}},o.prototype._clearPeriphery=function(){this._dispose(this._planesPeriphery,this._scenePeriphery),this._planesPeriphery={}},o.prototype._dispose=function(t,e){for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];e.remove(n),n.geometry.dispose(),n.material.dispose();var i=n.material.uniforms.projectorTex.value;null!=i&&i.dispose()}},o);function o(){this._planes={},this._planesOld={},this._planesPeriphery={},this._scene=new n.Scene,this._sceneOld=new n.Scene,this._scenePeriphery=new n.Scene}r.MeshScene=i,r.default=i},{three:242}],402:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("rxjs"),a=t("rxjs/operators"),n=(i.filteredPairwiseMouseDrag$=function(n,i){return i.filtered$(n,i.mouseDragStart$).pipe(a.switchMap(function(t){var e=o.concat(o.of(t),i.filtered$(n,i.mouseDrag$)),r=i.filtered$(n,i.mouseDragEnd$).pipe(a.map(function(){return null}));return o.merge(e,r).pipe(a.takeWhile(function(t){return!!t}),a.startWith(null))}),a.pairwise(),a.filter(function(t){return null!=t[0]&&null!=t[1]}))},i);function i(){}r.MouseOperator=n,r.default=n},{rxjs:43,"rxjs/operators":241}],403:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("rxjs"),s=t("rxjs/operators"),p=t("virtual-dom"),u=t("../../Component"),c=t("../../Geo"),f=t("../../State"),d=t("../utils/ComponentSize"),l=(o=u.Component,i(h,o),h.prototype._activate=function(){var h=this;this._renderSubscription=a.combineLatest(this._navigator.stateService.currentState$,this._navigator.stateService.state$,this._configuration$,this._container.renderService.size$).pipe(s.map(function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=e.state.zoom,a=p.h("div.ZoomInIcon",[]),s=3<=o||r===f.State.Waiting?p.h("div.ZoomInButtonDisabled",[a]):p.h("div.ZoomInButton",{onclick:function(){h._zoomDelta$.next(1)}},[a]),u=p.h("div.ZoomOutIcon",[]),c=o<=0||r===f.State.Waiting?p.h("div.ZoomOutButtonDisabled",[u]):p.h("div.ZoomOutButton",{onclick:function(){h._zoomDelta$.next(-1)}},[u]),l=n.size===d.default.Small||n.size===d.default.Automatic&&i.width<640?".ZoomCompact":"";return{name:h._name,vnode:p.h("div.ZoomContainer"+l,{oncontextmenu:function(t){t.preventDefault()}},[s,c])}})).subscribe(this._container.domRenderer.render$),this._zoomSubscription=this._zoomDelta$.pipe(s.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$)).subscribe(function(t){var e=t[0],r=t[1],n=t[2],i=h._viewportCoords.unprojectFromViewport(0,0,r.perspective),o=n.projectBasic(i.toArray());h._navigator.stateService.zoomIn(e,o)})},h.prototype._deactivate=function(){this._renderSubscription.unsubscribe(),this._zoomSubscription.unsubscribe()},h.prototype._getDefaultConfiguration=function(){return{size:d.default.Automatic}},h.componentName="zoom",h);function h(t,e,r){var n=o.call(this,t,e,r)||this;return n._viewportCoords=new c.ViewportCoords,n._zoomDelta$=new a.Subject,n}r.ZoomComponent=l,u.ComponentService.register(l),r.default=l},{"../../Component":291,"../../Geo":294,"../../State":298,"../utils/ComponentSize":398,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],404:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./MapillaryError"),s=(o=a.MapillaryError,i(u,o),u);function u(t){var e=o.call(this,null!=t?t:"The request was aborted.")||this;return Object.setPrototypeOf(e,u.prototype),e.name="AbortMapillaryError",e}r.AbortMapillaryError=s,r.default=s},{"./MapillaryError":407}],405:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./MapillaryError"),s=(o=a.MapillaryError,i(u,o),u);function u(t){var e=o.call(this,null!=t?t:"The argument is not valid.")||this;return Object.setPrototypeOf(e,u.prototype),e.name="ArgumentMapillaryError",e}r.ArgumentMapillaryError=s,r.default=s},{"./MapillaryError":407}],406:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("./MapillaryError"),s=(o=a.MapillaryError,i(u,o),u);function u(t){var e=o.call(this,t)||this;return Object.setPrototypeOf(e,u.prototype),e.name="GraphMapillaryError",e}r.GraphMapillaryError=s,r.default=s},{"./MapillaryError":407}],407:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=(o=Error,i(s,o),s);function s(t){var e=o.call(this,t)||this;return Object.setPrototypeOf(e,s.prototype),e.name="MapillaryError",e}r.MapillaryError=a,r.default=a},{}],408:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("three"),i=(Object.defineProperty(o.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lookat",{get:function(){return this._lookat},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"up",{get:function(){return this._up},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"focal",{get:function(){return this._focal},set:function(t){this._focal=t},enumerable:!0,configurable:!0}),o.prototype.lerpCameras=function(t,e,r){this._position.subVectors(e.position,t.position).multiplyScalar(r).add(t.position),this._lookat.subVectors(e.lookat,t.lookat).multiplyScalar(r).add(t.lookat),this._up.subVectors(e.up,t.up).multiplyScalar(r).add(t.up),this._focal=(1-r)*t.focal+r*e.focal},o.prototype.copy=function(t){this._position.copy(t.position),this._lookat.copy(t.lookat),this._up.copy(t.up),this._focal=t.focal},o.prototype.clone=function(){var t=new o;return t.position.copy(this._position),t.lookat.copy(this._lookat),t.up.copy(this._up),t.focal=this._focal,t},o.prototype.diff=function(t){var e=this._position.distanceToSquared(t.position),r=this._lookat.distanceToSquared(t.lookat),n=this._up.distanceToSquared(t.up),i=100*Math.abs(this._focal-t.focal);return Math.max(e,r,n,i)},o.prototype._getFocal=function(t){if(null==t.gpano)return t.focal;var e=Math.PI*t.gpano.CroppedAreaImageHeightPixels/t.gpano.FullPanoHeightPixels,r=.5/Math.tan(e/2);return Math.min(1/(2*(Math.sqrt(2)-1)),Math.max(.5,r))},o);function o(t){null!=t?(this._position=(new n.Vector3).fromArray(t.unprojectSfM([0,0],0)),this._lookat=(new n.Vector3).fromArray(t.unprojectSfM([0,0],10)),this._up=t.upVector(),this._focal=this._getFocal(t)):(this._position=new n.Vector3(0,0,0),this._lookat=new n.Vector3(0,0,1),this._up=new n.Vector3(0,-1,0),this._focal=1)}r.Camera=i},{three:242}],409:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var h=t("three"),n=t("../Geo"),o=new n.GeoCoords,a=new n.Spatial;r.computeTranslation=function(t,e,r){var n=o.geodeticToEnu(t.lat,t.lon,t.alt,r.lat,r.lon,r.alt),i=a.rotate(n,e);return[-i.x,-i.y,-i.z]},r.computeProjectedPoints=function(n,t,e,r,i){for(var o=[],a=0;a<t.length;++a)for(var s=t[a],u=e[a],c=0;c<=r;++c)o.push([s[0]+u[0]*c/r,s[1]+u[1]*c/r]);var l=new h.Camera;return l.up.copy(n.upVector()),l.position.copy((new h.Vector3).fromArray(n.unprojectSfM([0,0],0))),l.lookAt((new h.Vector3).fromArray(n.unprojectSfM([0,0],10))),l.updateMatrix(),l.updateMatrixWorld(!0),o.map(function(t){var e=n.unprojectBasic(t,1e4),r=i.worldToCamera(e,l);return[Math.abs(r[0]/r[2]),Math.abs(r[1]/r[2])]})}},{"../Geo":294,three:242}],410:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(i.prototype.geodeticToEnu=function(t,e,r,n,i,o){var a=this.geodeticToEcef(t,e,r);return this.ecefToEnu(a[0],a[1],a[2],n,i,o)},i.prototype.enuToGeodetic=function(t,e,r,n,i,o){var a=this.enuToEcef(t,e,r,n,i,o);return this.ecefToGeodetic(a[0],a[1],a[2])},i.prototype.ecefToEnu=function(t,e,r,n,i,o){var a=this.geodeticToEcef(n,i,o),s=[t-a[0],e-a[1],r-a[2]];n=n*Math.PI/180,i=i*Math.PI/180;var u=Math.cos(n),c=Math.sin(n),l=Math.cos(i),h=Math.sin(i);return[-h*s[0]+l*s[1],-c*l*s[0]-c*h*s[1]+u*s[2],u*l*s[0]+u*h*s[1]+c*s[2]]},i.prototype.enuToEcef=function(t,e,r,n,i,o){var a=this.geodeticToEcef(n,i,o);n=n*Math.PI/180,i=i*Math.PI/180;var s=Math.cos(n),u=Math.sin(n),c=Math.cos(i),l=Math.sin(i);return[-l*t-u*c*e+s*c*r+a[0],c*t-u*l*e+s*l*r+a[1],s*e+u*r+a[2]]},i.prototype.geodeticToEcef=function(t,e,r){var n=this._wgs84a,i=this._wgs84b;t=t*Math.PI/180,e=e*Math.PI/180;var o=Math.cos(t),a=Math.sin(t),s=Math.cos(e),u=Math.sin(e),c=n*n,l=i*i,h=1/Math.sqrt(c*o*o+l*a*a),p=(c*h+r)*o;return[p*s,p*u,(l*h+r)*a]},i.prototype.ecefToGeodetic=function(t,e,r){var n=this._wgs84a,i=this._wgs84b,o=n*n,a=i*i,s=o-a,u=Math.sqrt(s/o),c=Math.sqrt(s/a),l=Math.sqrt(t*t+e*e),h=Math.atan2(r*n,l*i),p=Math.sin(h),f=Math.cos(h),d=Math.atan2(e,t),m=Math.atan2(r+c*c*i*p*p*p,l-u*u*n*f*f*f),g=Math.sin(m),y=l/Math.cos(m)-n/Math.sqrt(1-u*u*g*g);return[180*m/Math.PI,180*d/Math.PI,y]},i);function i(){this._wgs84a=6378137,this._wgs84b=6356752.31424518}r.GeoCoords=n,r.default=n},{}],411:[function(t,e,r){"use strict";function a(t,e){return t.x<=Math.max(e.p1.x,e.p2.x)&&t.x>=Math.min(e.p1.x,e.p2.x)&&t.y>=Math.max(e.p1.y,e.p2.y)&&t.y>=Math.min(e.p1.y,e.p2.y)}function h(t,e){var r=t.p2.x-t.p1.x,n=t.p2.y-t.p1.y,i=e.p2.x-e.p1.x,o=e.p2.y-e.p1.y,a=r*o-n*i;return a*a<1e-10*(r*r+n*n)*(i*i+o*o)}function s(t,e,r){return function(t){return 0<t?1:t<0?-1:0}((e.y-t.y)*(r.x-e.x)-(r.y-e.y)*(e.x-t.x))}Object.defineProperty(r,"__esModule",{value:!0}),r.segmentsIntersect=function(t,e){if(h(t,e))return!1;var r=s(t.p1,t.p2,e.p1),n=s(t.p1,t.p2,e.p2),i=s(e.p1,e.p2,t.p1),o=s(e.p1,e.p2,t.p2);return r!==n&&i!==o||(!(0!==r||!a(e.p1,t))||(!(0!==n||!a(e.p2,t))||(!(0!==i||!a(t.p1,e))||!(0!==o||!a(t.p2,e)))))},r.segmentIntersection=function(t,e){if(!h(t,e)){var r=t.p1.x,n=t.p2.x,i=t.p1.y,o=t.p2.y,a=e.p1.x,s=e.p2.x,u=e.p1.y,c=e.p2.y,l=(r-n)*(u-c)-(i-o)*(a-s);return{x:((r*o-i*n)*(a-s)-(r-n)*(a*c-u*s))/l,y:((r*o-i*n)*(u-c)-(i-o)*(a*c-u*s))/l}}}},{}],412:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=t("three"),n=(i.prototype.azimuthalToBearing=function(t){return-t+Math.PI/2},i.prototype.degToRad=function(t){return Math.PI*t/180},i.prototype.radToDeg=function(t){return 180*t/Math.PI},i.prototype.rotationMatrix=function(t){var e=new a.Vector3(t[0],t[1],t[2]),r=e.length();return 0<r&&e.normalize(),(new a.Matrix4).makeRotationAxis(e,r)},i.prototype.rotate=function(t,e){var r=new a.Vector3(t[0],t[1],t[2]),n=this.rotationMatrix(e);return r.applyMatrix4(n),r},i.prototype.opticalCenter=function(t,e){var r=[-t[0],-t[1],-t[2]],n=[-e[0],-e[1],-e[2]];return this.rotate(n,r)},i.prototype.viewingDirection=function(t){var e=[-t[0],-t[1],-t[2]];return this.rotate([0,0,1],e)},i.prototype.wrap=function(t,e,r){if(r<e)throw new Error("Invalid arguments: max must be larger than min.");for(var n=r-e;r<t||t<e;)r<t?t-=n:t<e&&(t+=n);return t},i.prototype.wrapAngle=function(t){return this.wrap(t,-Math.PI,Math.PI)},i.prototype.clamp=function(t,e,r){return t<e?e:r<t?r:t},i.prototype.angleBetweenVector2=function(t,e,r,n){var i=Math.atan2(n,r)-Math.atan2(e,t);return this.wrapAngle(i)},i.prototype.angleDifference=function(t,e){var r=e-t;return this.wrapAngle(r)},i.prototype.relativeRotationAngle=function(t,e){var r=this.rotationMatrix([-t[0],-t[1],-t[2]]),n=this.rotationMatrix(e),i=r.multiply(n).elements,o=i[0]+i[5]+i[10];return Math.acos(Math.max(Math.min((o-1)/2,1),-1))},i.prototype.angleToPlane=function(t,e){var r=(new a.Vector3).fromArray(t),n=r.length();if(n<this._epsilon)return 0;var i=r.dot((new a.Vector3).fromArray(e));return Math.asin(i/n)},i.prototype.azimuthal=function(t,e){var r=(new a.Vector3).fromArray(t),n=(new a.Vector3).fromArray(e),i=r.clone().dot(n),o=r.clone().sub(n.clone().multiplyScalar(i));return Math.atan2(o.y,o.x)},i.prototype.distanceFromLatLon=function(t,e,r,n){var i=this.degToRad(r-t),o=this.degToRad(n-e),a=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.degToRad(t))*Math.cos(this.degToRad(r))*Math.sin(o/2)*Math.sin(o/2);return 12742e3*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))},i);function i(){this._epsilon=1e-9}r.Spatial=n,r.default=n},{three:242}],413:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var v=t("three"),n=(Object.defineProperty(i.prototype,"ck1",{get:function(){return this._ck1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ck2",{get:function(){return this._ck2},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraProjection",{get:function(){return this._cameraProjection},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"basicAspect",{get:function(){return this._basicAspect},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"basicHeight",{get:function(){return this._basicHeight},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"basicRt",{get:function(){return this._basicRt},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"basicWidth",{get:function(){return this._basicWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"focal",{get:function(){return this._focal},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fullPano",{get:function(){return null!=this._gpano&&0===this._gpano.CroppedAreaLeftPixels&&0===this._gpano.CroppedAreaTopPixels&&this._gpano.CroppedAreaImageWidthPixels===this._gpano.FullPanoWidthPixels&&this._gpano.CroppedAreaImageHeightPixels===this._gpano.FullPanoHeightPixels},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"gpano",{get:function(){return this._gpano},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientation",{get:function(){return this._orientation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rt",{get:function(){return this._rt},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"srt",{get:function(){return this._srt},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasValidScale",{get:function(){return.01<this._scale&&this._scale<50},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"radialPeak",{get:function(){return this._radialPeak},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),i.prototype.upVector=function(){var t=this._rt.elements;switch(this._orientation){case 1:return new v.Vector3(-t[1],-t[5],-t[9]);case 3:return new v.Vector3(t[1],t[5],t[9]);case 6:return new v.Vector3(-t[0],-t[4],-t[8]);case 8:return new v.Vector3(t[0],t[4],t[8]);default:return new v.Vector3(-t[1],-t[5],-t[9])}},i.prototype.projectorMatrix=function(){var t=this._normalizedToTextureMatrix(),e=this._focal,r=(new v.Matrix4).set(e,0,0,0,0,e,0,0,0,0,0,0,0,0,1,0);return t.multiply(r),t.multiply(this._rt),t},i.prototype.projectBasic=function(t){var e=this.projectSfM(t);return this._sfmToBasic(e)},i.prototype.unprojectBasic=function(t,e,r){var n=this._basicToSfm(t);return this.unprojectSfM(n,e,r)},i.prototype.projectSfM=function(t){var e=new v.Vector4(t[0],t[1],t[2],1);return e.applyMatrix4(this._rt),this._bearingToSfm([e.x,e.y,e.z])},i.prototype.unprojectSfM=function(t,e,r){var n=this._sfmToBearing(t),i=r&&!this.gpano?new v.Vector4(e*n[0]/n[2],e*n[1]/n[2],e,1):new v.Vector4(e*n[0],e*n[1],e*n[2],1);return i.applyMatrix4((new v.Matrix4).getInverse(this._rt)),[i.x/i.w,i.y/i.w,i.z/i.w]},i.prototype._sfmToBearing=function(t){if(this._fullPano()){var e=2*t[0]*Math.PI,r=2*-t[1]*Math.PI;return[Math.cos(r)*Math.sin(e),-Math.sin(r),l=Math.cos(r)*Math.cos(e)]}if(this._gpano){var n=Math.max(this.gpano.CroppedAreaImageWidthPixels,this.gpano.CroppedAreaImageHeightPixels),i=[t[0]*n+this.gpano.CroppedAreaImageWidthPixels/2+this.gpano.CroppedAreaLeftPixels,t[1]*n+this.gpano.CroppedAreaImageHeightPixels/2+this.gpano.CroppedAreaTopPixels];return e=2*Math.PI*(i[0]/this.gpano.FullPanoWidthPixels-.5),r=-Math.PI*(i[1]/this.gpano.FullPanoHeightPixels-.5),[Math.cos(r)*Math.sin(e),-Math.sin(r),l=Math.cos(r)*Math.cos(e)]}if("fisheye"===this._cameraProjection){var o=[t[0]/this._focal,t[1]/this._focal],a=o[0],s=o[1],u=Math.sqrt(a*a+s*s),c=u/(p=this._distortionFromDistortedRadius(u,this._ck1,this._ck2,this._radialPeak)),l=Math.cos(c),h=Math.sin(c);return[h*a/u,h*s/u,l]}var p,f=[t[0]/this._focal,t[1]/this._focal],d=(a=f[0],s=f[1],Math.sqrt(a*a+s*s)),m=a/(p=this._distortionFromDistortedRadius(d,this._ck1,this._ck2,this._radialPeak)),g=s/p,y=new v.Vector3(m,g,1);return y.normalize(),[y.x,y.y,y.z]},i.prototype._distortionFromDistortedRadius=function(t,e,r,n){for(var i=1,o=0;o<10;o++){var a=t/i;n<a&&(a=n),i=1+e*Math.pow(a,2)+r*Math.pow(a,4)}return i},i.prototype._bearingToSfm=function(t){if(this._fullPano()){var e=t[0],r=t[1],n=t[2],i=Math.atan2(e,n),o=Math.atan2(-r,Math.sqrt(e*e+n*n));return[i/(2*Math.PI),-o/(2*Math.PI)]}if(this._gpano){e=t[0],r=t[1],n=t[2],i=Math.atan2(e,n),o=Math.atan2(-r,Math.sqrt(e*e+n*n));var a=[(i/(2*Math.PI)+.5)*this.gpano.FullPanoWidthPixels,(-o/Math.PI+.5)*this.gpano.FullPanoHeightPixels],s=Math.max(this.gpano.CroppedAreaImageWidthPixels,this.gpano.CroppedAreaImageHeightPixels);return[(a[0]-this.gpano.CroppedAreaLeftPixels-this.gpano.CroppedAreaImageWidthPixels/2)/s,(a[1]-this.gpano.CroppedAreaTopPixels-this.gpano.CroppedAreaImageHeightPixels/2)/s]}if("fisheye"===this._cameraProjection){if(0<t[2]){e=t[0],r=t[1],n=t[2];var u=Math.sqrt(e*e+r*r),c=Math.atan2(u,n);c>this._radialPeak&&(c=this._radialPeak);var l=1+Math.pow(c,2)*(this._ck1+Math.pow(c,2)*this._ck2),h=this._focal*l*c/u;return[h*e,h*r]}return[t[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,t[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]}if(0<t[2]){var p=[t[0]/t[2],t[1]/t[2]],f=p[0],d=p[1],m=f*f+d*d,g=Math.pow(this._radialPeak,2);g<m&&(m=g);var y=1+this._ck1*m+this._ck2*Math.pow(m,2);return[this._focal*y*f,this._focal*y*d]}return[t[0]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,t[1]<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY]},i.prototype._basicToSfm=function(t){var e,r;switch(this._orientation){case 1:e=t[0],r=t[1];break;case 3:e=1-t[0],r=1-t[1];break;case 6:e=t[1],r=1-t[0];break;case 8:e=1-t[1],r=t[0];break;default:e=t[0],r=t[1]}var n=this._width,i=this._height,o=Math.max(n,i);return[e*n/o-n/o/2,r*i/o-i/o/2]},i.prototype._sfmToBasic=function(t){var e,r,n=this._width,i=this._height,o=Math.max(n,i),a=(t[0]+n/o/2)/n*o,s=(t[1]+i/o/2)/i*o;switch(this._orientation){case 1:e=a,r=s;break;case 3:e=1-a,r=1-s;break;case 6:e=1-s,r=a;break;case 8:e=s,r=1-a;break;default:e=a,r=s}return[e,r]},i.prototype._fullPano=function(){return null!=this.gpano&&0===this.gpano.CroppedAreaLeftPixels&&0===this.gpano.CroppedAreaTopPixels&&this.gpano.CroppedAreaImageWidthPixels===this.gpano.FullPanoWidthPixels&&this.gpano.CroppedAreaImageHeightPixels===this.gpano.FullPanoHeightPixels},i.prototype._getValue=function(t,e){return null!=t&&0<t?t:e},i.prototype._getRt=function(t,e){var r=new v.Vector3(t[0],t[1],t[2]),n=r.length();0<n&&r.normalize();var i=new v.Matrix4;return i.makeRotationAxis(r,n),i.setPosition(new v.Vector3(e[0],e[1],e[2])),i},i.prototype._getSrt=function(t,e){var r=t.clone(),n=r.elements;return n[12]=e*n[12],n[13]=e*n[13],n[14]=e*n[14],r.scale(new v.Vector3(e,e,e)),r},i.prototype._getBasicRt=function(t,e){var r=new v.Vector3(0,0,1),n=0;switch(e){case 3:n=Math.PI;break;case 6:n=Math.PI/2;break;case 8:n=3*Math.PI/2}return(new v.Matrix4).makeRotationAxis(r,n).multiply(t)},i.prototype._getRadialPeak=function(t,e){var r=5*e,n=3*t,i=Math.pow(n,2)-4*r*1;if(!(i<0)){var o=(-n-Math.sqrt(i))/2/r,a=(-n+Math.sqrt(i))/2/r,s=Math.min(o,a),u=Math.max(o,a);return 0<s?Math.sqrt(s):0<u?Math.sqrt(u):void 0}},i.prototype._normalizedToTextureMatrix=function(){var t=Math.max(this._width,this._height),e=this._orientation<5?this._textureScale[0]:this._textureScale[1],r=this._orientation<5?this._textureScale[1]:this._textureScale[0],n=t/this._width*e,i=t/this._height*r;switch(this._orientation){case 1:return(new v.Matrix4).set(n,0,0,.5,0,-i,0,.5,0,0,1,0,0,0,0,1);case 3:return(new v.Matrix4).set(-n,0,0,.5,0,i,0,.5,0,0,1,0,0,0,0,1);case 6:return(new v.Matrix4).set(0,-i,0,.5,-n,0,0,.5,0,0,1,0,0,0,0,1);case 8:return(new v.Matrix4).set(0,i,0,.5,n,0,0,.5,0,0,1,0,0,0,0,1);default:return(new v.Matrix4).set(n,0,0,.5,0,-i,0,.5,0,0,1,0,0,0,0,1)}},i);function i(t,e,r,n,i,o,a,s,u,c,l,h,p){this._orientation=this._getValue(t,1);var f=null!=u?u.width:4,d=null!=u?u.height:3,m=this._orientation<5;this._width=this._getValue(e,m?f:d),this._height=this._getValue(r,m?d:f),this._basicAspect=m?this._width/this._height:this._height/this._width,this._basicWidth=m?e:r,this._basicHeight=m?r:e,this._focal=this._getValue(n,1),this._scale=this._getValue(i,0),this._gpano=null!=o?o:null,this._rt=this._getRt(a,s),this._srt=this._getSrt(this._rt,this._scale),this._basicRt=this._getBasicRt(this._rt,t),this._textureScale=c||[1,1],this._ck1=l||0,this._ck2=h||0,this._cameraProjection=p||(o?"equirectangular":"perspective"),this._radialPeak=this._getRadialPeak(this._ck1,this._ck2)}r.Transform=n},{three:242}],414:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("three"),n=(i.prototype.basicToCanvas=function(t,e,r,n,i){var o=n.unprojectBasic([t,e],this._unprojectDepth);return this.projectToCanvas(o,r,i)},i.prototype.basicToCanvasSafe=function(t,e,r,n,i){var o=this.basicToViewportSafe(t,e,n,i);return null===o?null:this.viewportToCanvas(o[0],o[1],r)},i.prototype.basicToViewport=function(t,e,r,n){var i=r.unprojectBasic([t,e],this._unprojectDepth);return this.projectToViewport(i,n)},i.prototype.basicToViewportSafe=function(t,e,r,n){var i=r.unprojectBasic([t,e],this._unprojectDepth);return 0<this.worldToCamera(i,n)[2]?null:this.projectToViewport(i,n)},i.prototype.cameraToViewport=function(t,e){var r=(new o.Vector3).fromArray(t).applyMatrix4(e.projectionMatrix);return[r.x,r.y]},i.prototype.canvasPosition=function(t,e){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]},i.prototype.canvasToBasic=function(t,e,r,n,i){var o=this.unprojectFromCanvas(t,e,r,i).toArray();return n.projectBasic(o)},i.prototype.canvasToViewport=function(t,e,r){var n=this.containerToCanvas(r);return[2*t/n[0]-1,1-2*e/n[1]]},i.prototype.containerToCanvas=function(t){return[t.offsetWidth,t.offsetHeight]},i.prototype.getBasicDistances=function(t,e){var r=this.viewportToBasic(-1,1,t,e),n=this.viewportToBasic(1,1,t,e),i=this.viewportToBasic(1,-1,t,e),o=this.viewportToBasic(-1,-1,t,e),a=0,s=0,u=0,c=0;return r[1]<0&&n[1]<0&&(a=r[1]>n[1]?-r[1]:-n[1]),1<n[0]&&1<i[0]&&(s=n[0]<i[0]?n[0]-1:i[0]-1),1<i[1]&&1<o[1]&&(u=i[1]<o[1]?i[1]-1:o[1]-1),o[0]<0&&r[0]<0&&(c=o[0]>r[0]?-o[0]:-r[0]),[a,s,u,c]},i.prototype.getPixelDistances=function(t,e,r){var n,i=this.viewportToBasic(-1,1,e,r),o=this.viewportToBasic(1,1,e,r),a=this.viewportToBasic(1,-1,e,r),s=this.viewportToBasic(-1,-1,e,r),u=0,c=0,l=0,h=0,p=this.containerToCanvas(t),f=p[0],d=p[1];if(i[1]<0&&o[1]<0){var m=i[1]>o[1]?i[0]:o[0];u=0<(n=this.basicToCanvas(m,0,t,e,r))[1]?n[1]:0}if(1<o[0]&&1<a[0]){var g=o[0]<a[0]?o[1]:a[1];c=(n=this.basicToCanvas(1,g,t,e,r))[0]<f?f-n[0]:0}1<a[1]&&1<s[1]&&(m=a[1]<s[1]?a[0]:s[0],l=(n=this.basicToCanvas(m,1,t,e,r))[1]<d?d-n[1]:0),s[0]<0&&i[0]<0&&(g=s[0]>i[0]?s[1]:i[1],h=0<(n=this.basicToCanvas(0,g,t,e,r))[0]?n[0]:0);return[u,c,l,h]},i.prototype.insideElement=function(t,e){var r=e.getBoundingClientRect(),n=r.left+e.clientLeft,i=n+e.clientWidth,o=r.top+e.clientTop,a=o+e.clientHeight;return t.clientX>n&&t.clientX<i&&t.clientY>o&&t.clientY<a},i.prototype.projectToCanvas=function(t,e,r){var n=this.projectToViewport(t,r);return this.viewportToCanvas(n[0],n[1],e)},i.prototype.projectToCanvasSafe=function(t,e,r){if(0<this.worldToCamera(t,r)[2])return null;var n=this.projectToViewport(t,r);return this.viewportToCanvas(n[0],n[1],e)},i.prototype.projectToViewport=function(t,e){var r=new o.Vector3(t[0],t[1],t[2]).project(e);return[r.x,r.y]},i.prototype.unprojectFromCanvas=function(t,e,r,n){var i=this.canvasToViewport(t,e,r);return this.unprojectFromViewport(i[0],i[1],n)},i.prototype.unprojectFromViewport=function(t,e,r){return new o.Vector3(t,e,1).unproject(r)},i.prototype.viewportToBasic=function(t,e,r,n){var i=new o.Vector3(t,e,1).unproject(n).toArray();return r.projectBasic(i)},i.prototype.viewportToCanvas=function(t,e,r){var n=this.containerToCanvas(r);return[n[0]*(t+1)/2,-n[1]*(e-1)/2]},i.prototype.worldToCamera=function(t,e){return new o.Vector3(t[0],t[1],t[2]).applyMatrix4(e.matrixWorldInverse).toArray()},i);function i(){this._unprojectDepth=200}r.ViewportCoords=n,r.default=n},{three:242}],415:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(i.prototype.createFilter=function(t){return new Function("node","return "+this._compile(t)+";")},i.prototype._compile=function(t){if(null==t||t.length<=1)return"true";var e=t[0];return"("+("=="===e?this._compileComparisonOp("===",t[1],t[2],!1):"!="===e?this._compileComparisonOp("!==",t[1],t[2],!1):">"===e||">="===e||"<"===e||"<="===e?this._compileComparisonOp(e,t[1],t[2],!0):"in"===e?this._compileInOp(t[1],t.slice(2)):"!in"===e?this._compileNegation(this._compileInOp(t[1],t.slice(2))):"all"===e?this._compileLogicalOp(t.slice(1),"&&"):"true")+")"},i.prototype._compare=function(t,e){return t<e?-1:e<t?1:0},i.prototype._compileComparisonOp=function(t,e,r,n){var i=this._compilePropertyReference(e),o=JSON.stringify(r);return(n?"typeof "+i+"===typeof "+o+"&&":"")+i+t+o},i.prototype._compileInOp=function(t,e){var r=this._compare;return JSON.stringify(e.sort(r))+".indexOf("+this._compilePropertyReference(t)+")!==-1"},i.prototype._compileLogicalOp=function(t,e){var r=this._compile.bind(this);return t.map(r).join(e)},i.prototype._compileNegation=function(t){return"!("+t+")"},i.prototype._compilePropertyReference=function(t){return"node["+JSON.stringify(t)+"]"},i);function i(){}r.FilterCreator=n,r.default=n},{}],416:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var p=t("rxjs"),f=t("rxjs/operators"),a=t("rbush"),s=t("../Edge"),d=t("../Error"),m=t("../Graph"),n=(Object.defineProperty(i.prototype,"changed$",{get:function(){return this._changed$},enumerable:!0,configurable:!0}),i.prototype.cacheBoundingBox$=function(c,l){var h=this,t=this._graphCalculator.encodeHsFromBoundingBox(c,l).filter(function(t){return!(t in h._cachedTiles)}).map(function(t){return t in h._cachingTiles$?h._cachingTiles$[t]:h._cacheTile$(t)});return 0===t.length&&t.push(p.of(this)),p.from(t).pipe(f.mergeAll(),f.last(),f.mergeMap(function(t){for(var e=[],r=[],n=0,i=h._nodeIndex.search({maxX:l.lat,maxY:l.lon,minX:c.lat,minY:c.lon}).map(function(t){return t.node});n<i.length;n++){var o=i[n];o.full?e.push(o):r.push(o.key)}for(var a=[];0<r.length;)a.push(r.splice(0,200));var s=p.of(e),u=a.map(function(t){return h._apiV3.imageByKeyFill$(t).pipe(f.map(function(t){var e=[];for(var r in t)if(t.hasOwnProperty(r)&&h.hasNode(r)){var n=h.getNode(r);n.full||h._makeFull(n,t[r]),e.push(n)}return e}))});return p.merge(s,p.from(u).pipe(f.mergeAll()))}),f.reduce(function(t,e){return t.concat(e)}))},i.prototype.cacheFill$=function(e){var r=this;if(e in this._cachingFull$)throw new d.GraphMapillaryError("Cannot fill node while caching full ("+e+").");if(!this.hasNode(e))throw new d.GraphMapillaryError("Cannot fill node that does not exist in graph ("+e+").");if(e in this._cachingFill$)return this._cachingFill$[e];var n=this.getNode(e);if(n.full)throw new d.GraphMapillaryError("Cannot fill node that is already full ("+e+").");return this._cachingFill$[e]=this._apiV3.imageByKeyFill$([e]).pipe(f.tap(function(t){n.full||r._makeFull(n,t[e]),delete r._cachingFill$[e]}),f.map(function(t){return r}),f.finalize(function(){e in r._cachingFill$&&delete r._cachingFill$[e],r._changed$.next(r)}),f.publish(),f.refCount()),this._cachingFill$[e]},i.prototype.cacheFull$=function(i){var o=this;if(i in this._cachingFull$)return this._cachingFull$[i];if(this.hasNode(i))throw new d.GraphMapillaryError("Cannot cache full node that already exist in graph ("+i+").");return this._cachingFull$[i]=this._apiV3.imageByKeyFull$([i]).pipe(f.tap(function(t){var e=t[i];if(o.hasNode(i))(r=o.getNode(i)).full||o._makeFull(r,e);else{if(null==e.sequence_key)throw new d.GraphMapillaryError("Node has no sequence key ("+i+").");var r=new m.Node(e);o._makeFull(r,e);var n=o._graphCalculator.encodeH(r.originalLatLon,o._tilePrecision);o._preStore(n,r),o._setNode(r),delete o._cachingFull$[i]}}),f.map(function(t){return o}),f.finalize(function(){i in o._cachingFull$&&delete o._cachingFull$[i],o._changed$.next(o)}),f.publish(),f.refCount()),this._cachingFull$[i]},i.prototype.cacheNodeSequence$=function(t){if(!this.hasNode(t))throw new d.GraphMapillaryError("Cannot cache sequence edges of node that does not exist in graph ("+t+").");var e=this.getNode(t);if(e.sequenceKey in this._sequences)throw new d.GraphMapillaryError("Sequence already cached ("+t+"), ("+e.sequenceKey+").");return this._cacheSequence$(e.sequenceKey)},i.prototype.cacheSequence$=function(t){if(t in this._sequences)throw new d.GraphMapillaryError("Sequence already cached ("+t+")");return this._cacheSequence$(t)},i.prototype.cacheSequenceEdges=function(t){var e=this.getNode(t);if(!(e.sequenceKey in this._sequences))throw new d.GraphMapillaryError("Sequence is not cached ("+t+"), ("+e.sequenceKey+")");var r=this._sequences[e.sequenceKey].sequence,n=this._edgeCalculator.computeSequenceEdges(e,r);e.cacheSequenceEdges(n)},i.prototype.cacheSequenceNodes$=function(t,e){var o=this;if(!this.hasSequence(t))throw new d.GraphMapillaryError("Cannot cache sequence nodes of sequence that does not exist in graph ("+t+").");if(this.hasSequenceNodes(t))throw new d.GraphMapillaryError("Sequence nodes already cached ("+t+").");var r=this.getSequence(t);if(r.key in this._cachingSequenceNodes$)return this._cachingSequenceNodes$[r.key];var n=[],i=r.keys.slice();if(e&&50<i.length){var a=i.indexOf(e),s=Math.max(0,Math.min(a-25,i.length-50));n.push(i.splice(s,50))}for(;0<i.length;)n.push(i.splice(0,200));var u=n.length,c=p.from(n).pipe(f.mergeMap(function(t){return o._apiV3.imageByKeyFull$(t).pipe(f.tap(function(t){for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];if(o.hasNode(e))(n=o.getNode(r.key)).full||o._makeFull(n,r);else{null==r.sequence_key&&console.warn("Sequence missing, discarding node ("+r.key+")");var n=new m.Node(r);o._makeFull(n,r);var i=o._graphCalculator.encodeH(n.originalLatLon,o._tilePrecision);o._preStore(i,n),o._setNode(n)}}u--}),f.map(function(t){return o}))},6),f.last(),f.finalize(function(){delete o._cachingSequenceNodes$[r.key],0===u&&(o._cachedSequenceNodes[r.key]=!0)}),f.publish(),f.refCount());return this._cachingSequenceNodes$[r.key]=c},i.prototype.cacheSpatialArea$=function(o){var a=this;if(!this.hasNode(o))throw new d.GraphMapillaryError("Cannot cache spatial area of node that does not exist in graph ("+o+").");if(o in this._cachedSpatialEdges)throw new d.GraphMapillaryError("Node already spatially cached ("+o+").");if(!(o in this._requiredSpatialArea))throw new d.GraphMapillaryError("Spatial area not determined ("+o+").");var s=this._requiredSpatialArea[o];if(0===Object.keys(s.cacheNodes).length)throw new d.GraphMapillaryError("Spatial nodes already cached ("+o+").");if(o in this._cachingSpatialArea$)return this._cachingSpatialArea$[o];for(var t=[];0<s.cacheKeys.length;)t.push(s.cacheKeys.splice(0,200));for(var u=t.length,e=[],r=function(i){var t=n._apiV3.imageByKeyFill$(i).pipe(f.tap(function(t){for(var e in t)if(t.hasOwnProperty(e)){var r=s.cacheNodes[e];if(r.full)delete s.cacheNodes[e];else{var n=t[e];a._makeFull(r,n),delete s.cacheNodes[e]}}0==--u&&delete a._cachingSpatialArea$[o]}),f.map(function(t){return a}),f.catchError(function(t){for(var e=0,r=i;e<r.length;e++){var n=r[e];n in s.all&&delete s.all[n],n in s.cacheNodes&&delete s.cacheNodes[n]}throw 0==--u&&delete a._cachingSpatialArea$[o],t}),f.finalize(function(){0===Object.keys(s.cacheNodes).length&&a._changed$.next(a)}),f.publish(),f.refCount());e.push(t)},n=this,i=0,c=t;i<c.length;i++)r(c[i]);return this._cachingSpatialArea$[o]=e},i.prototype.cacheSpatialEdges=function(t){if(t in this._cachedSpatialEdges)throw new d.GraphMapillaryError("Spatial edges already cached ("+t+").");var e=this.getNode(t),r=this._sequences[e.sequenceKey].sequence,n=[],i=r.findPrevKey(e.key);null!=i&&n.push(i);var o=r.findNextKey(e.key);null!=o&&n.push(o);var a=this._requiredSpatialArea[t].all,s=[],u=this._filter;for(var c in a)if(a.hasOwnProperty(c)){var l=a[c];u(l)&&s.push(l)}var h=this._edgeCalculator.getPotentialEdges(e,s,n),p=this._edgeCalculator.computeStepEdges(e,h,i,o);p=(p=(p=(p=p.concat(this._edgeCalculator.computeTurnEdges(e,h))).concat(this._edgeCalculator.computePanoEdges(e,h))).concat(this._edgeCalculator.computePerspectiveToPanoEdges(e,h))).concat(this._edgeCalculator.computeSimilarEdges(e,h)),e.cacheSpatialEdges(p),this._cachedSpatialEdges[t]=e,delete this._requiredSpatialArea[t],delete this._cachedNodeTiles[t]},i.prototype.cacheTiles$=function(n){var i=this;if(n in this._cachedNodeTiles)throw new d.GraphMapillaryError("Tiles already cached ("+n+").");if(n in this._cachedSpatialEdges)throw new d.GraphMapillaryError("Spatial edges already cached so tiles considered cached ("+n+").");if(!(n in this._requiredNodeTiles))throw new d.GraphMapillaryError("Tiles have not been determined ("+n+").");var o=this._requiredNodeTiles[n];if(0===o.cache.length&&0===o.caching.length)throw new d.GraphMapillaryError("Tiles already cached ("+n+").");if(!this.hasNode(n))throw new d.GraphMapillaryError("Cannot cache tiles of node that does not exist in graph ("+n+").");var t=o.cache.slice();o.caching=this._requiredNodeTiles[n].caching.concat(t),o.cache=[];for(var e=[],r=function(r){var t=r in a._cachingTiles$?a._cachingTiles$[r]:a._cacheTile$(r);e.push(t.pipe(f.tap(function(t){var e=o.caching.indexOf(r);-1<e&&o.caching.splice(e,1),0===o.caching.length&&0===o.cache.length&&(delete i._requiredNodeTiles[n],i._cachedNodeTiles[n]=!0)}),f.catchError(function(t){var e=o.caching.indexOf(r);throw-1<e&&o.caching.splice(e,1),0===o.caching.length&&0===o.cache.length&&(delete i._requiredNodeTiles[n],i._cachedNodeTiles[n]=!0),t}),f.finalize(function(){i._changed$.next(i)}),f.publish(),f.refCount()))},a=this,s=0,u=o.caching;s<u.length;s++)r(u[s]);return e},i.prototype.initializeCache=function(t){if(t in this._cachedNodes)throw new d.GraphMapillaryError("Node already in cache ("+t+").");var e=this.getNode(t);e.initializeCache(new m.NodeCache);var r=(new Date).getTime();this._cachedNodes[t]={accessed:r,node:e},this._updateCachedTileAccess(t,r)},i.prototype.isCachingFill=function(t){return t in this._cachingFill$},i.prototype.isCachingFull=function(t){return t in this._cachingFull$},i.prototype.isCachingNodeSequence=function(t){return this.getNode(t).sequenceKey in this._cachingSequences$},i.prototype.isCachingSequence=function(t){return t in this._cachingSequences$},i.prototype.isCachingSequenceNodes=function(t){return t in this._cachingSequenceNodes$},i.prototype.isCachingTiles=function(t){return t in this._requiredNodeTiles&&0===this._requiredNodeTiles[t].cache.length&&0<this._requiredNodeTiles[t].caching.length},i.prototype.hasInitializedCache=function(t){return t in this._cachedNodes},i.prototype.hasNode=function(t){var e=(new Date).getTime();return this._updateCachedNodeAccess(t,e),this._updateCachedTileAccess(t,e),t in this._nodes},i.prototype.hasNodeSequence=function(t){var e=this.getNode(t).sequenceKey,r=e in this._sequences;return r&&(this._sequences[e].accessed=(new Date).getTime()),r},i.prototype.hasSequence=function(t){var e=t in this._sequences;return e&&(this._sequences[t].accessed=(new Date).getTime()),e},i.prototype.hasSequenceNodes=function(t){return t in this._cachedSequenceNodes},i.prototype.hasSpatialArea=function(t){if(!this.hasNode(t))throw new d.GraphMapillaryError("Spatial area nodes cannot be determined if node not in graph ("+t+").");if(t in this._cachedSpatialEdges)return!0;if(t in this._requiredSpatialArea)return 0===Object.keys(this._requiredSpatialArea[t].cacheNodes).length;for(var e=this.getNode(t),r=this._graphCalculator.boundingBoxCorners(e.latLon,this._tileThreshold),n={all:{},cacheKeys:[],cacheNodes:{}},i=0,o=this._nodeIndex.search({maxX:r[1].lat,maxY:r[1].lon,minX:r[0].lat,minY:r[0].lon});i<o.length;i++){var a=o[i];n.all[a.node.key]=a.node,a.node.full||(n.cacheKeys.push(a.node.key),n.cacheNodes[a.node.key]=a.node)}return 0===(this._requiredSpatialArea[t]=n).cacheKeys.length},i.prototype.hasTiles=function(t){var e=this;if(t in this._cachedNodeTiles)return!0;if(t in this._cachedSpatialEdges)return!0;if(!this.hasNode(t))throw new d.GraphMapillaryError("Node does not exist in graph ("+t+").");var r={cache:[],caching:[]};if(t in this._requiredNodeTiles)r=this._requiredNodeTiles[t];else{var n=this.getNode(t);r.cache=this._graphCalculator.encodeHs(n.latLon,this._tilePrecision,this._tileThreshold).filter(function(t){return!(t in e._cachedTiles)}),0<r.cache.length&&(this._requiredNodeTiles[t]=r)}return 0===r.cache.length&&0===r.caching.length},i.prototype.getNode=function(t){var e=(new Date).getTime();return this._updateCachedNodeAccess(t,e),this._updateCachedTileAccess(t,e),this._nodes[t]},i.prototype.getSequence=function(t){var e=this._sequences[t];return e.accessed=(new Date).getTime(),e.sequence},i.prototype.resetSpatialEdges=function(){for(var t=0,e=Object.keys(this._cachedSpatialEdges);t<e.length;t++){var r=e[t];this._cachedSpatialEdges[r].resetSpatialEdges(),delete this._cachedSpatialEdges[r]}},i.prototype.reset=function(t){for(var e=[],r=0,n=t;r<n.length;r++){var i=n[r];if(!this.hasNode(i))throw new Error("Node does not exist "+i);(l=this.getNode(i)).resetSequenceEdges(),l.resetSpatialEdges(),e.push(l)}for(var o=0,a=Object.keys(this._cachedNodes);o<a.length;o++){var s=a[o];-1===t.indexOf(s)&&(this._cachedNodes[s].node.dispose(),delete this._cachedNodes[s])}this._cachedNodeTiles={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._nodes={},this._nodeToTile={},this._preStored={};for(var u=0,c=e;u<c.length;u++){var l=c[u];this._nodes[l.key]=l;var h=this._graphCalculator.encodeH(l.originalLatLon,this._tilePrecision);this._preStore(h,l)}this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._nodeIndexTiles={},this._nodeIndex.clear()},i.prototype.setFilter=function(t){this._filter=this._filterCreator.createFilter(t)},i.prototype.uncache=function(t,e){var r={};this._addNewKeys(r,this._cachingFull$),this._addNewKeys(r,this._cachingFill$),this._addNewKeys(r,this._cachingSpatialArea$),this._addNewKeys(r,this._requiredNodeTiles),this._addNewKeys(r,this._requiredSpatialArea);for(var n=0,i=t;n<i.length;n++)(a=i[n])in r||(r[a]=!0);var o={};for(var a in r)if(r.hasOwnProperty(a))for(var s=this._nodes[a],u=0,c=this._graphCalculator.encodeHs(s.latLon);u<c.length;u++){var l=c[u];l in o||(o[l]=!0)}var h=[];for(var p in this._cachedTiles)!this._cachedTiles.hasOwnProperty(p)||p in o||h.push([p,this._cachedTiles[p]]);for(var f=0,d=h.sort(function(t,e){return e[1].accessed-t[1].accessed}).slice(this._configuration.maxUnusedTiles).map(function(t){return t[0]});f<d.length;f++){var m=d[f];this._uncacheTile(m,e)}var g=[],y=[];for(var p in this._preStored)if(this._preStored.hasOwnProperty(p)&&!(p in this._cachingTiles$)){var v=this._preStored[p];for(var a in v)!v.hasOwnProperty(a)||a in r||v[a].sequenceKey!==e&&(a in this._cachedNodes?g.push([this._cachedNodes[a],p]):y.push([a,p]))}var _=g.sort(function(t,e){var r=t[0],n=(t[1],e[0]);return e[1],n.accessed-r.accessed}).slice(this._configuration.maxUnusedPreStoredNodes).map(function(t){var e=t[0],r=t[1];return[e.node.key,r]});this._uncachePreStored(y),this._uncachePreStored(_);var b=[];for(var a in this._cachedNodes)!this._cachedNodes.hasOwnProperty(a)||a in r||b.push(this._cachedNodes[a]);for(var x=0,w=b.sort(function(t,e){return e.accessed-t.accessed}).slice(this._configuration.maxUnusedNodes);x<w.length;x++){var S=w[x];S.node.uncache(),a=S.node.key,delete this._cachedNodes[a],a in this._cachedNodeTiles&&delete this._cachedNodeTiles[a],a in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[a]}var E=[];for(var C in this._sequences)!this._sequences.hasOwnProperty(C)||C in this._cachingSequences$||C===e||E.push(this._sequences[C]);for(var M=0,T=E.sort(function(t,e){return e.accessed-t.accessed}).slice(this._configuration.maxSequences);M<T.length;M++){var P=T[M];C=P.sequence.key,delete this._sequences[C],C in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[C],P.sequence.dispose()}},i.prototype._addNewKeys=function(t,e){for(var r in e)e.hasOwnProperty(r)&&this.hasNode(r)&&(r in t||(t[r]=!0))},i.prototype._cacheSequence$=function(e){var r=this;return e in this._cachingSequences$||(this._cachingSequences$[e]=this._apiV3.sequenceByKey$([e]).pipe(f.tap(function(t){e in r._sequences||(r._sequences[e]={accessed:(new Date).getTime(),sequence:new m.Sequence(t[e])}),delete r._cachingSequences$[e]}),f.map(function(t){return r}),f.finalize(function(){e in r._cachingSequences$&&delete r._cachingSequences$[e],r._changed$.next(r)}),f.publish(),f.refCount())),this._cachingSequences$[e]},i.prototype._cacheTile$=function(l){var h=this;return this._cachingTiles$[l]=this._apiV3.imagesByH$([l]).pipe(f.tap(function(t){var e=t[l];if(!(l in h._cachedTiles)){h._nodeIndexTiles[l]=[],h._cachedTiles[l]={accessed:(new Date).getTime(),nodes:[]};var r=h._cachedTiles[l].nodes,n=h._removeFromPreStore(l);for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];if(null==o)break;if(null!=o.sequence_key)if(null!=n&&o.key in n){var a=n[o.key];delete n[o.key],r.push(a);var s={lat:a.latLon.lat,lon:a.latLon.lon,node:a};h._nodeIndex.insert(s),h._nodeIndexTiles[l].push(s),h._nodeToTile[a.key]=l}else{var u=new m.Node(o);r.push(u);var c={lat:u.latLon.lat,lon:u.latLon.lon,node:u};h._nodeIndex.insert(c),h._nodeIndexTiles[l].push(c),h._nodeToTile[u.key]=l,h._setNode(u)}else console.warn("Sequence missing, discarding node ("+o.key+")")}delete h._cachingTiles$[l]}}),f.map(function(t){return h}),f.catchError(function(t){throw delete h._cachingTiles$[l],t}),f.publish(),f.refCount()),this._cachingTiles$[l]},i.prototype._makeFull=function(t,e){null==e.calt&&(e.calt=this._defaultAlt),null==e.c_rotation&&(e.c_rotation=this._graphCalculator.rotationFromCompass(e.ca,e.orientation)),t.makeFull(e)},i.prototype._preStore=function(t,e){t in this._preStored||(this._preStored[t]={}),this._preStored[t][e.key]=e},i.prototype._removeFromPreStore=function(t){var e=null;return t in this._preStored&&(e=this._preStored[t],delete this._preStored[t]),e},i.prototype._setNode=function(t){var e=t.key;if(this.hasNode(e))throw new d.GraphMapillaryError("Node already exist ("+e+").");this._nodes[e]=t},i.prototype._uncacheTile=function(t,e){for(var r=0,n=this._cachedTiles[t].nodes;r<n.length;r++){var i=n[r],o=i.key;delete this._nodeToTile[o],o in this._cachedNodes&&delete this._cachedNodes[o],o in this._cachedNodeTiles&&delete this._cachedNodeTiles[o],o in this._cachedSpatialEdges&&delete this._cachedSpatialEdges[o],i.sequenceKey===e?(this._preStore(t,i),i.uncache()):(delete this._nodes[o],i.sequenceKey in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[i.sequenceKey],i.dispose())}for(var a=0,s=this._nodeIndexTiles[t];a<s.length;a++){var u=s[a];this._nodeIndex.remove(u)}delete this._nodeIndexTiles[t],delete this._cachedTiles[t]},i.prototype._uncachePreStored=function(t){for(var e={},r=0,n=t;r<n.length;r++){var i=n[r],o=i[0],a=i[1];o in this._nodes&&delete this._nodes[o],o in this._cachedNodes&&delete this._cachedNodes[o];var s=this._preStored[a][o];s.sequenceKey in this._cachedSequenceNodes&&delete this._cachedSequenceNodes[s.sequenceKey],delete this._preStored[a][o],s.dispose(),e[a]=!0}for(var a in e)e.hasOwnProperty(a)&&0===Object.keys(this._preStored[a]).length&&delete this._preStored[a]},i.prototype._updateCachedTileAccess=function(t,e){t in this._nodeToTile&&(this._cachedTiles[this._nodeToTile[t]].accessed=e)},i.prototype._updateCachedNodeAccess=function(t,e){t in this._cachedNodes&&(this._cachedNodes[t].accessed=e)},i);function i(t,e,r,n,i,o){this._apiV3=t,this._cachedNodes={},this._cachedNodeTiles={},this._cachedSequenceNodes={},this._cachedSpatialEdges={},this._cachedTiles={},this._cachingFill$={},this._cachingFull$={},this._cachingSequenceNodes$={},this._cachingSequences$={},this._cachingSpatialArea$={},this._cachingTiles$={},this._changed$=new p.Subject,this._defaultAlt=2,this._edgeCalculator=null!=n?n:new s.EdgeCalculator,this._filterCreator=null!=i?i:new m.FilterCreator,this._filter=this._filterCreator.createFilter(void 0),this._graphCalculator=null!=r?r:new m.GraphCalculator,this._configuration=null!=o?o:{maxSequences:50,maxUnusedNodes:100,maxUnusedPreStoredNodes:30,maxUnusedTiles:20},this._nodes={},this._nodeIndex=null!=e?e:a(16,[".lat",".lon",".lat",".lon"]),this._nodeIndexTiles={},this._nodeToTile={},this._preStored={},this._requiredNodeTiles={},this._requiredSpatialArea={},this._sequences={},this._tilePrecision=7,this._tileThreshold=20}r.Graph=n,r.default=n},{"../Edge":292,"../Error":293,"../Graph":295,rbush:42,rxjs:43,"rxjs/operators":241}],417:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var g=t("latlon-geohash"),c=t("three"),s=t("../Error"),n=t("../Geo"),i=(o.prototype.encodeH=function(t,e){return void 0===e&&(e=7),g.encode(t.lat,t.lon,e)},o.prototype.encodeHs=function(t,e,r){void 0===e&&(e=7),void 0===r&&(r=20);var n=g.encode(t.lat,t.lon,e),i=g.bounds(n),o=i.ne,a=i.sw,s=g.neighbours(n),u=[0,0,0],c=this._geoCoords.geodeticToEnu(o.lat,o.lon,0,a.lat,a.lon,0),l=this._geoCoords.geodeticToEnu(t.lat,t.lon,0,a.lat,a.lon,0),h=l[0]-u[0]<r,p=c[0]-l[0]<r,f=l[1]-u[1]<r,d=c[1]-l[1]<r,m=[n];return d&&m.push(s.n),d&&h&&m.push(s.nw),h&&m.push(s.w),h&&f&&m.push(s.sw),f&&m.push(s.s),f&&p&&m.push(s.se),p&&m.push(s.e),p&&d&&m.push(s.ne),m},o.prototype.encodeHsFromBoundingBox=function(t,e,r){if(void 0===r&&(r=7),e.lat<=t.lat||e.lon<=t.lon)throw new s.GraphMapillaryError("North east needs to be top right of south west");var n=(t.lat+e.lat)/2,i=(t.lon+e.lon)/2,o=this._geoCoords.geodeticToEnu(e.lat,e.lon,0,n,i,0),a=Math.max(o[0],o[1]);return this.encodeHs({lat:n,lon:i},r,a)},o.prototype.boundingBoxCorners=function(t,e){var r=this._geoCoords.enuToGeodetic(-e,-e,0,t.lat,t.lon,0),n=this._geoCoords.enuToGeodetic(e,e,0,t.lat,t.lon,0);return[{lat:r[0],lon:r[1]},{lat:n[0],lon:n[1]}]},o.prototype.rotationFromCompass=function(t,e){var r=0,n=0,i=0;switch(e){case 1:r=Math.PI/2;break;case 3:r=-Math.PI/2,i=Math.PI;break;case 6:n=-Math.PI/2,i=-Math.PI/2;break;case 8:n=Math.PI/2,i=Math.PI/2}var o=(new c.Matrix4).makeRotationZ(i),a=new c.Euler(r,n,t*Math.PI/180,"XYZ"),s=(new c.Matrix4).makeRotationFromEuler(a),u=(new c.Vector4).setAxisAngleFromRotationMatrix(s.multiply(o));return u.multiplyScalar(u.w).toArray().slice(0,3)},o);function o(t){this._geoCoords=null!=t?t:new n.GeoCoords}r.GraphCalculator=i,r.default=i},{"../Error":293,"../Geo":294,"latlon-geohash":21,three:242}],418:[function(t,e,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),(i=n=r.GraphMode||(r.GraphMode={}))[i.Sequence=0]="Sequence",i[i.Spatial=1]="Spatial",r.default=n},{}],419:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var u=t("rxjs"),c=t("rxjs/operators"),l=t("../Graph"),n=(Object.defineProperty(i.prototype,"graphMode$",{get:function(){return this._graphMode$},enumerable:!0,configurable:!0}),i.prototype.cacheBoundingBox$=function(e,r){return this._graph$.pipe(c.first(),c.mergeMap(function(t){return t.cacheBoundingBox$(e,r)}))},i.prototype.cacheNode$=function(r){var e=this,n=new u.Subject;this._firstGraphSubjects$.push(n);var t=n.pipe(c.publishReplay(1),c.refCount()),i=t.pipe(c.map(function(t){return t.getNode(r)}),c.mergeMap(function(t){return t.assetsCached?u.of(t):t.cacheAssets$()}),c.publishReplay(1),c.refCount());i.subscribe(function(t){e._imageLoadingService.loadnode$.next(t)},function(t){console.error("Failed to cache node ("+r+")",t)});var o=this._graph$.pipe(c.first(),c.mergeMap(function(t){return t.isCachingFull(r)||!t.hasNode(r)?t.cacheFull$(r):t.isCachingFill(r)||!t.getNode(r).full?t.cacheFill$(r):u.of(t)}),c.tap(function(t){t.hasInitializedCache(r)||t.initializeCache(r)}),c.finalize(function(){null!=o&&(e._removeFromArray(o,e._initializeCacheSubscriptions),e._removeFromArray(n,e._firstGraphSubjects$))})).subscribe(function(t){n.next(t),n.complete()},function(t){n.error(t)});o.closed||this._initializeCacheSubscriptions.push(o);var a=t.pipe(c.mergeMap(function(t){return t.isCachingNodeSequence(r)||!t.hasNodeSequence(r)?t.cacheNodeSequence$(r):u.of(t)}),c.publishReplay(1),c.refCount()).pipe(c.tap(function(t){t.getNode(r).sequenceEdges.cached||t.cacheSequenceEdges(r)}),c.finalize(function(){null!=a&&e._removeFromArray(a,e._sequenceSubscriptions)})).subscribe(function(t){},function(t){console.error("Failed to cache sequence edges ("+r+").",t)});if(a.closed||this._sequenceSubscriptions.push(a),this._graphMode===l.GraphMode.Spatial){var s=t.pipe(c.expand(function(t){return t.hasTiles(r)?u.empty():u.from(t.cacheTiles$(r)).pipe(c.mergeMap(function(t){return t.pipe(c.mergeMap(function(t){return t.isCachingTiles(r)?u.empty():u.of(t)}),c.catchError(function(t,e){return console.error("Failed to cache tile data ("+r+").",t),u.empty()}))}))}),c.last(),c.mergeMap(function(t){return t.hasSpatialArea(r)?u.of(t):u.from(t.cacheSpatialArea$(r)).pipe(c.mergeMap(function(t){return t.pipe(c.catchError(function(t,e){return console.error("Failed to cache spatial nodes ("+r+").",t),u.empty()}))}))}),c.last(),c.mergeMap(function(t){return t.hasNodeSequence(r)?u.of(t):t.cacheNodeSequence$(r)}),c.tap(function(t){t.getNode(r).spatialEdges.cached||t.cacheSpatialEdges(r)}),c.finalize(function(){null!=s&&e._removeFromArray(s,e._spatialSubscriptions)})).subscribe(function(t){},function(t){console.error("Failed to cache spatial edges ("+r+").",t)});s.closed||this._spatialSubscriptions.push(s)}return i.pipe(c.first(function(t){return t.assetsCached}))},i.prototype.cacheSequence$=function(e){return this._graph$.pipe(c.first(),c.mergeMap(function(t){return t.isCachingSequence(e)||!t.hasSequence(e)?t.cacheSequence$(e):u.of(t)}),c.map(function(t){return t.getSequence(e)}))},i.prototype.cacheSequenceNodes$=function(e,r){return this._graph$.pipe(c.first(),c.mergeMap(function(t){return t.isCachingSequence(e)||!t.hasSequence(e)?t.cacheSequence$(e):u.of(t)}),c.mergeMap(function(t){return t.isCachingSequenceNodes(e)||!t.hasSequenceNodes(e)?t.cacheSequenceNodes$(e,r):u.of(t)}),c.map(function(t){return t.getSequence(e)}))},i.prototype.setFilter$=function(e){return this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(c.first(),c.tap(function(t){t.resetSpatialEdges(),t.setFilter(e)}),c.map(function(t){}))},i.prototype.setGraphMode=function(t){this._graphMode!==t&&(t===l.GraphMode.Sequence&&this._resetSubscriptions(this._spatialSubscriptions),this._graphMode=t,this._graphModeSubject$.next(this._graphMode))},i.prototype.reset$=function(e){return this._abortSubjects(this._firstGraphSubjects$),this._resetSubscriptions(this._initializeCacheSubscriptions),this._resetSubscriptions(this._sequenceSubscriptions),this._resetSubscriptions(this._spatialSubscriptions),this._graph$.pipe(c.first(),c.tap(function(t){t.reset(e)}),c.map(function(t){}))},i.prototype.uncache$=function(e,r){return this._graph$.pipe(c.first(),c.tap(function(t){t.uncache(e,r)}),c.map(function(t){}))},i.prototype._abortSubjects=function(t){for(var e=0,r=t.slice();e<r.length;e++){var n=r[e];this._removeFromArray(n,t),n.error(new Error("Cache node request was aborted."))}},i.prototype._removeFromArray=function(t,e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)},i.prototype._resetSubscriptions=function(t){for(var e=0,r=t.slice();e<r.length;e++){var n=r[e];this._removeFromArray(n,t),n.closed||n.unsubscribe()}},i);function i(t,e){this._graph$=u.concat(u.of(t),t.changed$).pipe(c.publishReplay(1),c.refCount()),this._graph$.subscribe(function(){}),this._graphMode=l.GraphMode.Spatial,this._graphModeSubject$=new u.Subject,this._graphMode$=this._graphModeSubject$.pipe(c.startWith(this._graphMode),c.publishReplay(1),c.refCount()),this._graphMode$.subscribe(function(){}),this._imageLoadingService=e,this._firstGraphSubjects$=[],this._initializeCacheSubscriptions=[],this._sequenceSubscriptions=[],this._spatialSubscriptions=[]}r.GraphService=n,r.default=n},{"../Graph":295,rxjs:43,"rxjs/operators":241}],420:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rxjs/operators"),i=t("rxjs"),o=(Object.defineProperty(a.prototype,"loadnode$",{get:function(){return this._loadnode$},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"loadstatus$",{get:function(){return this._loadstatus$},enumerable:!0,configurable:!0}),a);function a(){this._loadnode$=new i.Subject,this._loadstatus$=this._loadnode$.pipe(n.scan(function(t,e){var r=t[0],n=!1;return 0===e.loadStatus.total||e.loadStatus.loaded===e.loadStatus.total?e.key in r&&(delete r[e.key],n=!0):(r[e.key]=e.loadStatus,n=!0),[r,n]},[{},!1]),n.filter(function(t){t[0];return t[1]}),n.map(function(t){return t[0]}),n.publishReplay(1),n.refCount()),this._loadstatus$.subscribe(function(){})}r.ImageLoadingService=o},{rxjs:43,"rxjs/operators":241}],421:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("pbf"),i=(o.read=function(t){return new n(t).readFields(o._readMeshField,{faces:[],vertices:[]})},o._readMeshField=function(t,e,r){1===t?e.vertices.push(r.readFloat()):2===t&&e.faces.push(r.readVarint())},o);function o(){}r.MeshReader=i},{pbf:40}],422:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rxjs/operators"),i=(Object.defineProperty(o.prototype,"assetsCached",{get:function(){return null!=this._core&&null!=this._fill&&null!=this._cache&&null!=this._cache.image&&null!=this._cache.mesh},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"alt",{get:function(){return this._fill.calt},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"ca",{get:function(){return null!=this._fill.cca?this._fill.cca:this._fill.ca},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"cameraProjection",{get:function(){return this._fill.camera_projection_type},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"capturedAt",{get:function(){return this._fill.captured_at},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"cameraUuid",{get:function(){return this._fill.captured_with_camera_uuid},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"clusterKey",{get:function(){return this._fill.cluster_key},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"ck1",{get:function(){return this._fill.ck1},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"ck2",{get:function(){return this._fill.ck2},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"computedCA",{get:function(){return this._fill.cca},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"computedLatLon",{get:function(){return this._core.cl},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"focal",{get:function(){return this._fill.cfocal},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"full",{get:function(){return null!=this._fill},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"fullPano",{get:function(){return null!=this._fill.gpano&&0===this._fill.gpano.CroppedAreaLeftPixels&&0===this._fill.gpano.CroppedAreaTopPixels&&this._fill.gpano.CroppedAreaImageWidthPixels===this._fill.gpano.FullPanoWidthPixels&&this._fill.gpano.CroppedAreaImageHeightPixels===this._fill.gpano.FullPanoHeightPixels},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"gpano",{get:function(){return this._fill.gpano},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"height",{get:function(){return this._fill.height},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"image",{get:function(){return this._cache.image},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"image$",{get:function(){return this._cache.image$},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"key",{get:function(){return this._core.key},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"latLon",{get:function(){return null!=this._core.cl?this._core.cl:this._core.l},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"loadStatus",{get:function(){return this._cache.loadStatus},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"merged",{get:function(){return null!=this._fill&&null!=this._fill.merge_version&&0<this._fill.merge_version},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"mergeCC",{get:function(){return this._fill.merge_cc},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"mergeVersion",{get:function(){return this._fill.merge_version},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"mesh",{get:function(){return this._cache.mesh},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"organizationKey",{get:function(){return this._fill.organization_key},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"orientation",{get:function(){return this._fill.orientation},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"originalCA",{get:function(){return this._fill.ca},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"originalLatLon",{get:function(){return this._core.l},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"pano",{get:function(){return null!=this._fill.gpano&&null!=this._fill.gpano.FullPanoWidthPixels},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"private",{get:function(){return this._fill.private},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"projectKey",{get:function(){return null!=this._fill.project?this._fill.project.key:null},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"rotation",{get:function(){return this._fill.c_rotation},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"scale",{get:function(){return this._fill.atomic_scale},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sequenceKey",{get:function(){return this._core.sequence_key},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sequenceEdges",{get:function(){return this._cache.sequenceEdges},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sequenceEdges$",{get:function(){return this._cache.sequenceEdges$},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"spatialEdges",{get:function(){return this._cache.spatialEdges},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"spatialEdges$",{get:function(){return this._cache.spatialEdges$},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"userKey",{get:function(){return this._fill.user.key},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"username",{get:function(){return this._fill.user.username},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"width",{get:function(){return this._fill.width},enumerable:!0,configurable:!0}),o.prototype.cacheAssets$=function(){var t=this;return this._cache.cacheAssets$(this.key,this.pano,this.merged).pipe(n.map(function(){return t}))},o.prototype.cacheImage$=function(t){var e=this;return this._cache.cacheImage$(this.key,t).pipe(n.map(function(){return e}))},o.prototype.cacheSequenceEdges=function(t){this._cache.cacheSequenceEdges(t)},o.prototype.cacheSpatialEdges=function(t){this._cache.cacheSpatialEdges(t)},o.prototype.dispose=function(){null!=this._cache&&(this._cache.dispose(),this._cache=null),this._core=null,this._fill=null},o.prototype.initializeCache=function(t){if(null!=this._cache)throw new Error("Node cache already initialized ("+this.key+").");this._cache=t},o.prototype.makeFull=function(t){if(null==t)throw new Error("Fill can not be null.");this._fill=t},o.prototype.resetSequenceEdges=function(){this._cache.resetSequenceEdges()},o.prototype.resetSpatialEdges=function(){this._cache.resetSpatialEdges()},o.prototype.uncache=function(){null!=this._cache&&(this._cache.dispose(),this._cache=null)},o);function o(t){this._cache=null,this._core=t,this._fill=null}r.Node=i,r.default=i},{"rxjs/operators":241}],423:[function(r,t,n){(function(o){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=r("rxjs"),a=r("rxjs/operators"),u=r("../Graph"),c=r("../Utils"),t=(Object.defineProperty(e.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"image$",{get:function(){return this._image$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadStatus",{get:function(){return this._loadStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sequenceEdges",{get:function(){return this._sequenceEdges},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sequenceEdges$",{get:function(){return this._sequenceEdges$},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spatialEdges",{get:function(){return this._spatialEdges},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spatialEdges$",{get:function(){return this._spatialEdges$},enumerable:!0,configurable:!0}),e.prototype.cacheAssets$=function(t,e,r){var n=this;if(null!=this._cachingAssets$)return this._cachingAssets$;var i=e?c.Settings.basePanoramaSize:c.Settings.baseImageSize;return this._cachingAssets$=s.combineLatest(this._cacheImage$(t,i),this._cacheMesh$(t,r)).pipe(a.map(function(t){var e=t[0],r=t[1];return n._loadStatus.loaded=0,n._loadStatus.total=0,r&&(n._mesh=r.object,n._loadStatus.loaded+=r.loaded.loaded,n._loadStatus.total+=r.loaded.total),e&&(n._image=e.object,n._loadStatus.loaded+=e.loaded.loaded,n._loadStatus.total+=e.loaded.total),n}),a.finalize(function(){n._cachingAssets$=null}),a.publishReplay(1),a.refCount()),this._cachingAssets$.pipe(a.first(function(t){return!!t._image})).subscribe(function(t){n._imageChanged$.next(n._image)},function(t){}),this._cachingAssets$},e.prototype.cacheImage$=function(t,e){var r=this;if(null!=this._image&&e<=Math.max(this._image.width,this._image.height))return s.of(this);var n=this._cacheImage$(t,e).pipe(a.first(function(t){return null!=t.object}),a.tap(function(t){r._disposeImage(),r._image=t.object}),a.map(function(t){return r}),a.publishReplay(1),a.refCount());return n.subscribe(function(t){r._imageChanged$.next(r._image)},function(t){}),n},e.prototype.cacheSequenceEdges=function(t){this._sequenceEdges={cached:!0,edges:t},this._sequenceEdgesChanged$.next(this._sequenceEdges)},e.prototype.cacheSpatialEdges=function(t){this._spatialEdges={cached:!0,edges:t},this._spatialEdgesChanged$.next(this._spatialEdges)},e.prototype.dispose=function(){this._iamgeSubscription.unsubscribe(),this._sequenceEdgesSubscription.unsubscribe(),this._spatialEdgesSubscription.unsubscribe(),this._disposeImage(),this._mesh=null,this._loadStatus.loaded=0,this._loadStatus.total=0,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$.next(null),this._sequenceEdgesChanged$.next(this._sequenceEdges),this._spatialEdgesChanged$.next(this._spatialEdges),this._disposed=!0,null!=this._imageRequest&&this._imageRequest.abort(),null!=this._meshRequest&&this._meshRequest.abort()},e.prototype.resetSequenceEdges=function(){this._sequenceEdges={cached:!1,edges:[]},this._sequenceEdgesChanged$.next(this._sequenceEdges)},e.prototype.resetSpatialEdges=function(){this._spatialEdges={cached:!1,edges:[]},this._spatialEdgesChanged$.next(this._spatialEdges)},e.prototype._cacheImage$=function(o,t){var a=this;return s.Observable.create(function(n){var i=new XMLHttpRequest;i.open("GET",c.Urls.thumbnail(o,t,c.Urls.origin),!0),i.responseType="arraybuffer",i.timeout=15e3,i.onload=function(e){if(200!==i.status)return a._imageRequest=null,void n.error(new Error("Failed to fetch image ("+o+"). Status: "+i.status+", "+i.statusText));var r=new Image;r.crossOrigin="Anonymous",r.onload=function(t){if(a._imageRequest=null,a._disposed)return window.URL.revokeObjectURL(r.src),void n.error(new Error("Image load was aborted ("+o+")"));n.next({loaded:{loaded:e.loaded,total:e.total},object:r}),n.complete()},r.onerror=function(t){a._imageRequest=null,n.error(new Error("Failed to load image ("+o+")"))};var t=new Blob([i.response]);r.src=window.URL.createObjectURL(t)},i.onprogress=function(t){a._disposed||n.next({loaded:{loaded:t.loaded,total:t.total},object:null})},i.onerror=function(t){a._imageRequest=null,n.error(new Error("Failed to fetch image ("+o+")"))},i.ontimeout=function(t){a._imageRequest=null,n.error(new Error("Image request timed out ("+o+")"))},i.onabort=function(t){a._imageRequest=null,n.error(new Error("Image request was aborted ("+o+")"))},(a._imageRequest=i).send(null)})},e.prototype._cacheMesh$=function(e,t){var i=this;return s.Observable.create(function(r){if(!t)return r.next(i._createEmptyMeshLoadStatus()),void r.complete();var n=new XMLHttpRequest;n.open("GET",c.Urls.protoMesh(e),!0),n.responseType="arraybuffer",n.timeout=15e3,n.onload=function(t){if(i._meshRequest=null,!i._disposed){var e=200===n.status?u.MeshReader.read(new o(n.response)):{faces:[],vertices:[]};r.next({loaded:{loaded:t.loaded,total:t.total},object:e}),r.complete()}},n.onprogress=function(t){i._disposed||r.next({loaded:{loaded:t.loaded,total:t.total},object:null})},n.onerror=function(t){i._meshRequest=null,console.error("Failed to cache mesh ("+e+")"),r.next(i._createEmptyMeshLoadStatus()),r.complete()},n.ontimeout=function(t){i._meshRequest=null,console.error("Mesh request timed out ("+e+")"),r.next(i._createEmptyMeshLoadStatus()),r.complete()},n.onabort=function(t){i._meshRequest=null,r.error(new Error("Mesh request was aborted ("+e+")"))},(i._meshRequest=n).send(null)})},e.prototype._createEmptyMeshLoadStatus=function(){return{loaded:{loaded:0,total:0},object:{faces:[],vertices:[]}}},e.prototype._disposeImage=function(){null!=this._image&&window.URL.revokeObjectURL(this._image.src),this._image=null},e);function e(){this._disposed=!1,this._image=null,this._loadStatus={loaded:0,total:0},this._mesh=null,this._sequenceEdges={cached:!1,edges:[]},this._spatialEdges={cached:!1,edges:[]},this._imageChanged$=new s.Subject,this._image$=this._imageChanged$.pipe(a.startWith(null),a.publishReplay(1),a.refCount()),this._iamgeSubscription=this._image$.subscribe(),this._sequenceEdgesChanged$=new s.Subject,this._sequenceEdges$=this._sequenceEdgesChanged$.pipe(a.startWith(this._sequenceEdges),a.publishReplay(1),a.refCount()),this._sequenceEdgesSubscription=this._sequenceEdges$.subscribe(function(){}),this._spatialEdgesChanged$=new s.Subject,this._spatialEdges$=this._spatialEdgesChanged$.pipe(a.startWith(this._spatialEdges),a.publishReplay(1),a.refCount()),this._spatialEdgesSubscription=this._spatialEdges$.subscribe(function(){}),this._cachingAssets$=null}n.NodeCache=t,n.default=t}).call(this,r("buffer").Buffer)},{"../Graph":295,"../Utils":301,buffer:7,rxjs:43,"rxjs/operators":241}],424:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(Object.defineProperty(i.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keys",{get:function(){return this._keys},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){this._key=null,this._keys=null},i.prototype.findNextKey=function(t){var e=this._keys.indexOf(t);return e+1>=this._keys.length||-1===e?null:this._keys[e+1]},i.prototype.findPrevKey=function(t){var e=this._keys.indexOf(t);return 0===e||-1===e?null:this._keys[e-1]},i);function i(t){this._key=t.key,this._keys=t.keys}r.Sequence=n,r.default=n},{}],425:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var S=t("three"),G=t("../../Edge"),q=t("../../Error"),n=t("../../Geo"),i=(o.prototype.getPotentialEdges=function(t,e,r){if(!t.full)throw new q.ArgumentMapillaryError("Node has to be full.");if(!t.merged)return[];for(var n=this._spatial.viewingDirection(t.rotation),i=this._spatial.angleToPlane(n.toArray(),[0,0,1]),o=[],a=0,s=e;a<s.length;a++){var u=s[a];if(u.merged&&u.key!==t.key){var c=this._geoCoords.geodeticToEnu(u.latLon.lat,u.latLon.lon,u.alt,t.latLon.lat,t.latLon.lon,t.alt),l=new S.Vector3(c[0],c[1],c[2]),h=l.length();if(!(h>this._settings.maxDistance&&r.indexOf(u.key)<0)){var p=this._spatial.angleBetweenVector2(n.x,n.y,l.x,l.y),f=this._spatial.angleToPlane(l.toArray(),[0,0,1]),d=this._spatial.viewingDirection(u.rotation),m=this._spatial.angleBetweenVector2(n.x,n.y,d.x,d.y),g=this._spatial.angleToPlane(d.toArray(),[0,0,1])-i,y=this._spatial.relativeRotationAngle(t.rotation,u.rotation),v=this._spatial.angleBetweenVector2(1,0,l.x,l.y),_=null!=u.sequenceKey&&null!=t.sequenceKey&&u.sequenceKey===t.sequenceKey,b=null==u.mergeCC&&null==t.mergeCC||u.mergeCC===t.mergeCC,x=u.userKey===t.userKey,w={capturedAt:u.capturedAt,croppedPano:u.pano&&!u.fullPano,directionChange:m,distance:h,fullPano:u.fullPano,key:u.key,motionChange:p,rotation:y,sameMergeCC:b,sameSequence:_,sameUser:x,sequenceKey:u.sequenceKey,verticalDirectionChange:g,verticalMotion:f,worldMotionAzimuth:v};o.push(w)}}}return o},o.prototype.computeSequenceEdges=function(t,e){if(!t.full)throw new q.ArgumentMapillaryError("Node has to be full.");if(t.sequenceKey!==e.key)throw new q.ArgumentMapillaryError("Node and sequence does not correspond.");var r=[],n=e.findNextKey(t.key);null!=n&&r.push({data:{direction:G.EdgeDirection.Next,worldMotionAzimuth:Number.NaN},from:t.key,to:n});var i=e.findPrevKey(t.key);return null!=i&&r.push({data:{direction:G.EdgeDirection.Prev,worldMotionAzimuth:Number.NaN},from:t.key,to:i}),r},o.prototype.computeSimilarEdges=function(e,t){var r=this;if(!e.full)throw new q.ArgumentMapillaryError("Node has to be full.");for(var n=e.fullPano,i={},o=0,a=t;o<a.length;o++)if(null!=(d=a[o]).sequenceKey&&!d.sameSequence){if(n){if(!d.fullPano)continue}else if(!d.fullPano&&Math.abs(d.directionChange)>this._settings.similarMaxDirectionChange)continue;d.distance>this._settings.similarMaxDistance||d.sameUser&&Math.abs(d.capturedAt-e.capturedAt)<this._settings.similarMinTimeDifference||(null==i[d.sequenceKey]&&(i[d.sequenceKey]=[]),i[d.sequenceKey].push(d))}var s=[],u=e.fullPano?function(t){return t.distance}:function(t){return r._coefficients.similarDistance*t.distance+r._coefficients.similarRotation*t.rotation};for(var c in i)if(i.hasOwnProperty(c)){for(var l=Number.MAX_VALUE,h=null,p=0,f=i[c];p<f.length;p++){var d,m=u(d=f[p]);m<l&&(l=m,h=d)}null!=h&&s.push(h)}return s.map(function(t){return{data:{direction:G.EdgeDirection.Similar,worldMotionAzimuth:t.worldMotionAzimuth},from:e.key,to:t.key}})},o.prototype.computeStepEdges=function(t,e,r,n){if(!t.full)throw new q.ArgumentMapillaryError("Node has to be full.");var i=[];if(t.pano)return i;for(var o in this._directions.steps)if(this._directions.steps.hasOwnProperty(o)){for(var a=this._directions.steps[o],s=Number.MAX_VALUE,u=null,c=null,l=0,h=e;l<h.length;l++){var p=h[l];if(!(p.croppedPano||p.fullPano||Math.abs(p.directionChange)>this._settings.stepMaxDirectionChange)){var f=this._spatial.angleDifference(a.motionChange,p.motionChange),d=this._spatial.angleDifference(p.directionChange,f),m=Math.max(Math.abs(f),Math.abs(d));if(!(Math.abs(m)>this._settings.stepMaxDrift)){var g=p.key;if(!a.useFallback||g!==r&&g!==n||(c=p),!(p.distance>this._settings.stepMaxDistance)){f=Math.sqrt(f*f+p.verticalMotion*p.verticalMotion);var y=this._coefficients.stepPreferredDistance*Math.abs(p.distance-this._settings.stepPreferredDistance)/this._settings.stepMaxDistance+this._coefficients.stepMotion*f/this._settings.stepMaxDrift+this._coefficients.stepRotation*p.rotation/this._settings.stepMaxDirectionChange+this._coefficients.stepSequencePenalty*(p.sameSequence?0:1)+this._coefficients.stepMergeCCPenalty*(p.sameMergeCC?0:1);y<s&&(s=y,u=p)}}}}null!=(u=null==u?c:u)&&i.push({data:{direction:a.direction,worldMotionAzimuth:u.worldMotionAzimuth},from:t.key,to:u.key})}return i},o.prototype.computeTurnEdges=function(t,e){if(!t.full)throw new q.ArgumentMapillaryError("Node has to be full.");var r=[];if(t.pano)return r;for(var n in this._directions.turns)if(this._directions.turns.hasOwnProperty(n)){for(var i=this._directions.turns[n],o=Number.MAX_VALUE,a=null,s=0,u=e;s<u.length;s++){var c=u[s];if(!(c.croppedPano||c.fullPano||c.distance>this._settings.turnMaxDistance)){var l=i.direction!==G.EdgeDirection.TurnU&&c.distance<this._settings.turnMaxRigDistance&&Math.abs(c.directionChange)>this._settings.turnMinRigDirectionChange,h=this._spatial.angleDifference(i.directionChange,c.directionChange),p=void 0;if(l&&0<c.directionChange*i.directionChange&&Math.abs(c.directionChange)<Math.abs(i.directionChange))p=-Math.PI/2+Math.abs(c.directionChange);else{if(Math.abs(h)>this._settings.turnMaxDirectionChange)continue;var f=i.motionChange?this._spatial.angleDifference(i.motionChange,c.motionChange):0;f=Math.sqrt(f*f+c.verticalMotion*c.verticalMotion),p=this._coefficients.turnDistance*c.distance/this._settings.turnMaxDistance+this._coefficients.turnMotion*f/Math.PI+this._coefficients.turnSequencePenalty*(c.sameSequence?0:1)+this._coefficients.turnMergeCCPenalty*(c.sameMergeCC?0:1)}p<o&&(o=p,a=c)}}null!=a&&r.push({data:{direction:i.direction,worldMotionAzimuth:a.worldMotionAzimuth},from:t.key,to:a.key})}return r},o.prototype.computePerspectiveToPanoEdges=function(t,e){if(!t.full)throw new q.ArgumentMapillaryError("Node has to be full.");if(t.pano)return[];for(var r=Number.MAX_VALUE,n=null,i=0,o=e;i<o.length;i++){var a=o[i];if(a.fullPano){var s=this._coefficients.panoPreferredDistance*Math.abs(a.distance-this._settings.panoPreferredDistance)/this._settings.panoMaxDistance+this._coefficients.panoMotion*Math.abs(a.motionChange)/Math.PI+this._coefficients.panoMergeCCPenalty*(a.sameMergeCC?0:1);s<r&&(r=s,n=a)}}return null==n?[]:[{data:{direction:G.EdgeDirection.Pano,worldMotionAzimuth:n.worldMotionAzimuth},from:t.key,to:n.key}]},o.prototype.computePanoEdges=function(t,e){if(!t.full)throw new q.ArgumentMapillaryError("Node has to be full.");if(!t.fullPano)return[];for(var r=[],n=[],i=[],o=0,a=e;o<a.length;o++)if(!((b=a[o]).distance>this._settings.panoMaxDistance))if(b.fullPano){if(b.distance<this._settings.panoMinDistance)continue;n.push(b)}else{if(b.croppedPano)continue;for(var s in this._directions.panos)if(this._directions.panos.hasOwnProperty(s)){var u=this._directions.panos[s],c=this._spatial.angleDifference(b.directionChange,b.motionChange),l=this._spatial.angleDifference(u.directionChange,c);if(!(Math.abs(l)>this._settings.panoMaxStepTurnChange)){i.push([u.direction,b]);break}}}for(var h=Math.PI/this._settings.panoMaxItems,p=[],f=[],d=0;d<this._settings.panoMaxItems;d++){for(var m=d/this._settings.panoMaxItems*2*Math.PI,g=Number.MAX_VALUE,y=null,v=0,_=n;v<_.length;v++){var b=_[v],x=this._spatial.angleDifference(m,b.motionChange);if(!(Math.abs(x)>h)){for(var w=Number.MAX_VALUE,S=0,E=p;S<E.length;S++){var C=E[S],M=Math.abs(this._spatial.angleDifference(C,b.motionChange));M<w&&(w=M)}w<=h||(D=this._coefficients.panoPreferredDistance*Math.abs(b.distance-this._settings.panoPreferredDistance)/this._settings.panoMaxDistance+this._coefficients.panoMotion*Math.abs(x)/h+this._coefficients.panoSequencePenalty*(b.sameSequence?0:1)+this._coefficients.panoMergeCCPenalty*(b.sameMergeCC?0:1))<g&&(g=D,y=b)}}null!=y?(p.push(y.motionChange),r.push({data:{direction:G.EdgeDirection.Pano,worldMotionAzimuth:y.worldMotionAzimuth},from:t.key,to:y.key})):f.push(m)}var T={};T[G.EdgeDirection.Pano]=p,T[G.EdgeDirection.StepForward]=[],T[G.EdgeDirection.StepLeft]=[],T[G.EdgeDirection.StepBackward]=[],T[G.EdgeDirection.StepRight]=[];for(var P=0,O=f;P<O.length;P++){var A=O[P],I=[];for(var s in this._directions.panos)if(this._directions.panos.hasOwnProperty(s)){u=this._directions.panos[s];for(var L=T[G.EdgeDirection.Pano].concat(T[u.direction]).concat(T[u.prev]).concat(T[u.next]),R=(g=Number.MAX_VALUE,y=null,0),N=i;R<N.length;R++)if((b=N[R])[0]===u.direction){var k=this._spatial.angleDifference(A,b[1].motionChange);if(!(Math.abs(k)>h)){for(var D,j=Number.MAX_VALUE,z=0,F=L;z<F.length;z++)C=F[z],(w=Math.abs(this._spatial.angleDifference(C,b[1].motionChange)))<j&&(j=w);j<=h||(D=this._coefficients.panoPreferredDistance*Math.abs(b[1].distance-this._settings.panoPreferredDistance)/this._settings.panoMaxDistance+this._coefficients.panoMotion*Math.abs(k)/h+this._coefficients.panoMergeCCPenalty*(b[1].sameMergeCC?0:1))<g&&(g=D,y=b)}}null!=y&&(I.push(y),r.push({data:{direction:y[0],worldMotionAzimuth:y[1].worldMotionAzimuth},from:t.key,to:y[1].key}))}for(var B=0,U=I;B<U.length;B++){var V=U[B];T[V[0]].push(V[1].motionChange)}}return r},o);function o(t,e,r){this._spatial=new n.Spatial,this._geoCoords=new n.GeoCoords,this._settings=null!=t?t:new G.EdgeCalculatorSettings,this._directions=null!=e?e:new G.EdgeCalculatorDirections,this._coefficients=null!=r?r:new G.EdgeCalculatorCoefficients}r.EdgeCalculator=i,r.default=i},{"../../Edge":292,"../../Error":293,"../../Geo":294,three:242}],426:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});function n(){this.panoPreferredDistance=2,this.panoMotion=2,this.panoSequencePenalty=1,this.panoMergeCCPenalty=4,this.stepPreferredDistance=4,this.stepMotion=3,this.stepRotation=4,this.stepSequencePenalty=2,this.stepMergeCCPenalty=6,this.similarDistance=2,this.similarRotation=3,this.turnDistance=4,this.turnMotion=2,this.turnSequencePenalty=1,this.turnMergeCCPenalty=4}r.EdgeCalculatorCoefficients=n,r.default=n},{}],427:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});function n(){this.steps={},this.turns={},this.panos={},this.steps[i.EdgeDirection.StepForward]={direction:i.EdgeDirection.StepForward,motionChange:0,useFallback:!0},this.steps[i.EdgeDirection.StepBackward]={direction:i.EdgeDirection.StepBackward,motionChange:Math.PI,useFallback:!0},this.steps[i.EdgeDirection.StepLeft]={direction:i.EdgeDirection.StepLeft,motionChange:Math.PI/2,useFallback:!1},this.steps[i.EdgeDirection.StepRight]={direction:i.EdgeDirection.StepRight,motionChange:-Math.PI/2,useFallback:!1},this.turns[i.EdgeDirection.TurnLeft]={direction:i.EdgeDirection.TurnLeft,directionChange:Math.PI/2,motionChange:Math.PI/4},this.turns[i.EdgeDirection.TurnRight]={direction:i.EdgeDirection.TurnRight,directionChange:-Math.PI/2,motionChange:-Math.PI/4},this.turns[i.EdgeDirection.TurnU]={direction:i.EdgeDirection.TurnU,directionChange:Math.PI,motionChange:null},this.panos[i.EdgeDirection.StepForward]={direction:i.EdgeDirection.StepForward,directionChange:0,next:i.EdgeDirection.StepLeft,prev:i.EdgeDirection.StepRight},this.panos[i.EdgeDirection.StepBackward]={direction:i.EdgeDirection.StepBackward,directionChange:Math.PI,next:i.EdgeDirection.StepRight,prev:i.EdgeDirection.StepLeft},this.panos[i.EdgeDirection.StepLeft]={direction:i.EdgeDirection.StepLeft,directionChange:Math.PI/2,next:i.EdgeDirection.StepBackward,prev:i.EdgeDirection.StepForward},this.panos[i.EdgeDirection.StepRight]={direction:i.EdgeDirection.StepRight,directionChange:-Math.PI/2,next:i.EdgeDirection.StepForward,prev:i.EdgeDirection.StepBackward}}var i=t("../../Edge");r.EdgeCalculatorDirections=n},{"../../Edge":292}],428:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(Object.defineProperty(i.prototype,"maxDistance",{get:function(){return Math.max(this.panoMaxDistance,this.similarMaxDistance,this.stepMaxDistance,this.turnMaxDistance)},enumerable:!0,configurable:!0}),i);function i(){this.panoMinDistance=.1,this.panoMaxDistance=20,this.panoPreferredDistance=5,this.panoMaxItems=4,this.panoMaxStepTurnChange=Math.PI/8,this.rotationMaxDistance=this.turnMaxRigDistance,this.rotationMaxDirectionChange=Math.PI/6,this.rotationMaxVerticalDirectionChange=Math.PI/8,this.similarMaxDirectionChange=Math.PI/8,this.similarMaxDistance=12,this.similarMinTimeDifference=432e5,this.stepMaxDistance=20,this.stepMaxDirectionChange=Math.PI/6,this.stepMaxDrift=Math.PI/6,this.stepPreferredDistance=4,this.turnMaxDistance=15,this.turnMaxDirectionChange=2*Math.PI/9,this.turnMaxRigDistance=.65,this.turnMinRigDirectionChange=Math.PI/6}r.EdgeCalculatorSettings=n,r.default=n},{}],429:[function(t,e,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),(n=r.EdgeDirection||(r.EdgeDirection={}))[n.Next=0]="Next",n[n.Prev=1]="Prev",n[n.StepLeft=2]="StepLeft",n[n.StepRight=3]="StepRight",n[n.StepForward=4]="StepForward",n[n.StepBackward=5]="StepBackward",n[n.TurnLeft=6]="TurnLeft",n[n.TurnRight=7]="TurnRight",n[n.TurnU=8]="TurnU",n[n.Pano=9]="Pano",n[n.Similar=10]="Similar"},{}],430:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("rxjs"),o=t("rxjs/operators"),a=t("virtual-dom"),s=t("rxjs"),u=t("../Render"),n=(Object.defineProperty(c.prototype,"element$",{get:function(){return this._element$},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"render$",{get:function(){return this._render$},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"renderAdaptive$",{get:function(){return this._renderAdaptive$},enumerable:!0,configurable:!0}),c.prototype.clear=function(t){this._renderAdaptive$.next({name:t,vnode:null}),this._render$.next({name:t,vnode:null})},c);function c(t,e,r){this._adaptiveOperation$=new s.Subject,this._render$=new s.Subject,this._renderAdaptive$=new s.Subject,this._renderService=e,this._currentFrame$=r;var n=a.create(a.h("div.domRenderer",[]));t.appendChild(n),this._offset$=this._adaptiveOperation$.pipe(o.scan(function(t,e){return e(t)},{elementHeight:t.offsetHeight,elementWidth:t.offsetWidth,imageAspect:0,renderMode:u.RenderMode.Fill}),o.filter(function(t){return 0<t.imageAspect&&0<t.elementWidth&&0<t.elementHeight}),o.map(function(t){var e=t.elementWidth/t.elementHeight,r=t.imageAspect/e,n=0,i=0;return t.renderMode===u.RenderMode.Letterbox?t.imageAspect>e?n=t.elementHeight*(1-1/r)/2:i=t.elementWidth*(1-r)/2:t.imageAspect>e?i=-t.elementWidth*(r-1)/2:n=-t.elementHeight*(1/r-1)/2,{bottom:n,left:i,right:i,top:n}})),this._currentFrame$.pipe(o.filter(function(t){return null!=t.state.currentNode}),o.distinctUntilChanged(function(t,e){return t===e},function(t){return t.state.currentNode.key}),o.map(function(t){return t.state.currentTransform.basicAspect}),o.map(function(e){return function(t){return t.imageAspect=e,t}})).subscribe(this._adaptiveOperation$),i.combineLatest(this._renderAdaptive$.pipe(o.scan(function(t,e){return null==e.vnode?delete t[e.name]:t[e.name]=e.vnode,t},{})),this._offset$).pipe(o.map(function(t){var e=[],r=t[0];for(var n in r)r.hasOwnProperty(n)&&e.push(r[n]);var i=t[1],o={style:{bottom:i.bottom+"px",left:i.left+"px","pointer-events":"none",position:"absolute",right:i.right+"px",top:i.top+"px"}};return{name:"adaptiveDomRenderer",vnode:a.h("div.adaptiveDomRenderer",o,e)}})).subscribe(this._render$),this._vNode$=this._render$.pipe(o.scan(function(t,e){return null==e.vnode?delete t[e.name]:t[e.name]=e.vnode,t},{}),o.map(function(t){var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(t[r]);return a.h("div.domRenderer",e)})),this._vPatch$=this._vNode$.pipe(o.scan(function(t,e){return t.vpatch=a.diff(t.vnode,e),t.vnode=e,t},{vnode:a.h("div.domRenderer",[]),vpatch:null}),o.pluck("vpatch")),this._element$=this._vPatch$.pipe(o.scan(function(t,e){return a.patch(t,e)},n),o.publishReplay(1),o.refCount()),this._element$.subscribe(function(){}),this._renderService.size$.pipe(o.map(function(e){return function(t){return t.elementWidth=e.width,t.elementHeight=e.height,t}})).subscribe(this._adaptiveOperation$),this._renderService.renderMode$.pipe(o.map(function(e){return function(t){return t.renderMode=e,t}})).subscribe(this._adaptiveOperation$)}r.DOMRenderer=n,r.default=n},{"../Render":297,rxjs:43,"rxjs/operators":241,"virtual-dom":247}],431:[function(t,e,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),(i=n=r.GLRenderStage||(r.GLRenderStage={}))[i.Background=0]="Background",i[i.Foreground=1]="Foreground",r.default=n},{}],432:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var l=t("rxjs"),h=t("rxjs/operators"),p=t("three"),f=t("../Render"),d=t("../Utils"),n=(Object.defineProperty(i.prototype,"render$",{get:function(){return this._render$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"webGLRenderer$",{get:function(){return this._webGLRenderer$},enumerable:!0,configurable:!0}),i.prototype.clear=function(t){this._clear$.next(t)},i.prototype._renderFrameSubscribe=function(){var e=this;this._render$.pipe(h.first(),h.map(function(t){return function(t){return t.needsRender=!0,t}})).subscribe(function(t){e._renderCameraOperation$.next(t)}),this._renderFrameSubscription=this._render$.pipe(h.first(),h.mergeMap(function(t){return e._renderService.renderCameraFrame$})).subscribe(this._renderFrame$)},i);function i(i,o,t){var a=this;this._renderFrame$=new l.Subject,this._renderCameraOperation$=new l.Subject,this._render$=new l.Subject,this._clear$=new l.Subject,this._renderOperation$=new l.Subject,this._rendererOperation$=new l.Subject,this._eraserOperation$=new l.Subject,this._renderService=o,this._dom=t||new d.DOM,this._renderer$=this._rendererOperation$.pipe(h.scan(function(t,e){return e(t)},{needsRender:!1,renderer:null}),h.filter(function(t){return!!t.renderer})),this._renderCollection$=this._renderOperation$.pipe(h.scan(function(t,e){return e(t)},{}),h.share()),this._renderCamera$=this._renderCameraOperation$.pipe(h.scan(function(t,e){return e(t)},{frameId:-1,needsRender:!1,perspective:null})),this._eraser$=this._eraserOperation$.pipe(h.startWith(function(t){return t}),h.scan(function(t,e){return e(t)},{needsRender:!1})),l.combineLatest(this._renderer$,this._renderCollection$,this._renderCamera$,this._eraser$).pipe(h.map(function(t){var e=t[0],r=t[1];return{camera:t[2],eraser:t[3],renderer:e,renders:Object.keys(r).map(function(t){return r[t]})}}),h.filter(function(t){for(var e=t.renderer.needsRender||t.camera.needsRender||t.eraser.needsRender,r=t.camera.frameId,n=0,i=t.renders;n<i.length;n++){var o=i[n];if(o.frameId!==r)return!1;e=e||o.needsRender}return e}),h.distinctUntilChanged(function(t,e){return t===e},function(t){return t.eraser.needsRender?-1:t.camera.frameId})).subscribe(function(t){t.renderer.needsRender=!1,t.camera.needsRender=!1,t.eraser.needsRender=!1;for(var e=t.camera.perspective,r=[],n=[],i=0,o=t.renders;i<o.length;i++){(h=o[i]).stage===f.GLRenderStage.Background?r.push(h.render):h.stage===f.GLRenderStage.Foreground&&n.push(h.render)}var a=t.renderer.renderer;a.clear();for(var s=0,u=r;s<u.length;s++){(h=u[s])(e,a)}a.clearDepth();for(var c=0,l=n;c<l.length;c++){var h;(h=l[c])(e,a)}}),this._renderFrame$.pipe(h.map(function(e){return function(t){return t.frameId=e.frameId,t.perspective=e.perspective,!0===e.changed&&(t.needsRender=!0),t}})).subscribe(this._renderCameraOperation$),this._renderFrameSubscribe();var e=this._render$.pipe(h.map(function(e){return function(t){return t[e.name]=e.render,t}})),r=this._clear$.pipe(h.map(function(e){return function(t){return delete t[e],t}}));l.merge(e,r).subscribe(this._renderOperation$),this._webGLRenderer$=this._render$.pipe(h.first(),h.map(function(t){var e=a._dom.createElement("canvas","mapillary-js-canvas");e.style.position="absolute",e.setAttribute("tabindex","0"),i.appendChild(e);var r=o.element,n=new p.WebGLRenderer({canvas:e});return n.setPixelRatio(window.devicePixelRatio),n.setSize(r.offsetWidth,r.offsetHeight),n.setClearColor(new p.Color(2105376),1),n.autoClear=!1,n}),h.publishReplay(1),h.refCount()),this._webGLRenderer$.subscribe(function(){});var n=this._webGLRenderer$.pipe(h.first(),h.map(function(e){return function(t){return t.needsRender=!0,t.renderer=e,t}})),s=this._renderService.size$.pipe(h.map(function(e){return function(t){return null==t.renderer||(t.renderer.setSize(e.width,e.height),t.needsRender=!0),t}})),u=this._clear$.pipe(h.map(function(t){return function(t){return null==t.renderer||(t.needsRender=!0),t}}));l.merge(n,s,u).subscribe(this._rendererOperation$);var c=this._renderCollection$.pipe(h.filter(function(t){return 0===Object.keys(t).length}),h.share());c.subscribe(function(t){null!=a._renderFrameSubscription&&(a._renderFrameSubscription.unsubscribe(),a._renderFrameSubscription=null,a._renderFrameSubscribe())}),c.pipe(h.map(function(t){return function(t){return t.needsRender=!0,t}})).subscribe(this._eraserOperation$)}r.GLRenderer=n,r.default=n},{"../Render":297,"../Utils":301,rxjs:43,"rxjs/operators":241,three:242}],433:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("three"),i=t("../Geo"),a=t("../Render"),s=t("../State"),o=(Object.defineProperty(u.prototype,"alpha",{get:function(){return this._alpha},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"changed",{get:function(){return this._frameId===this._changedForFrame},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"frameId",{get:function(){return this._frameId},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"perspective",{get:function(){return this._perspective},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"renderMode",{get:function(){return this._renderMode},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"rotation",{get:function(){return this._rotation},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"zoom",{get:function(){return this._zoom},enumerable:!0,configurable:!0}),u.prototype.getTilt=function(){return 90-this._spatial.radToDeg(this._rotation.theta)},u.prototype.fovToZoom=function(t){t=Math.min(90,Math.max(0,t));var e=this._computeCurrentFov(0),r=1===this._alpha?e:this._interpolateFov(e,this._computePreviousFov(0),this._alpha),n=Math.tan(r/2*Math.PI/180),i=Math.tan(t/2*Math.PI/180);return Math.log(n/i)/Math.log(2)},u.prototype.setFrame=function(t){var e=t.state;e.state!==this._state&&(this._state=e.state,this._changed=!0);var r=e.currentNode.key,n=e.previousNode?e.previousNode.key:null;r!==this._currentNodeId&&(this._currentNodeId=r,this._currentPano=!!e.currentTransform.gpano,this._currentProjectedPoints=this._computeProjectedPoints(e.currentTransform),this._changed=!0),n!==this._previousNodeId&&(this._previousNodeId=n,this._previousPano=!!e.previousTransform.gpano,this._previousProjectedPoints=this._computeProjectedPoints(e.previousTransform),this._changed=!0);var i=e.zoom;i!==this._zoom&&(this._zoom=i,this._changed=!0),this._changed&&(this._currentFov=this._computeCurrentFov(this.zoom),this._previousFov=this._computePreviousFov(this._zoom));var o=e.alpha;!this._changed&&o===this._alpha||(this._alpha=o,this._perspective.fov=this._state===s.State.Earth?60:this._interpolateFov(this._currentFov,this._previousFov,this._alpha),this._changed=!0);var a=e.camera;1e-9<this._camera.diff(a)&&(this._camera.copy(a),this._rotation=this._computeRotation(a),this._perspective.up.copy(a.up),this._perspective.position.copy(a.position),this._perspective.lookAt(a.lookat),this._perspective.updateMatrix(),this._perspective.updateMatrixWorld(!1),this._changed=!0),this._changed&&this._perspective.updateProjectionMatrix(),this._setFrameId(t.id)},u.prototype.setRenderMode=function(t){this._renderMode=t,this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0},u.prototype.setSize=function(t){this._perspective.aspect=this._computeAspect(t.width,t.height),this._perspective.fov=this._computeFov(),this._perspective.updateProjectionMatrix(),this._changed=!0},u.prototype._computeAspect=function(t,e){return 0===t?0:t/e},u.prototype._computeCurrentFov=function(t){return 0===this._perspective.aspect?0:this._currentNodeId?this._currentPano?this._yToFov(1,t):this._computeVerticalFov(this._currentProjectedPoints,this._renderMode,t,this.perspective.aspect):this._initialFov},u.prototype._computeFov=function(){return this._currentFov=this._computeCurrentFov(this._zoom),this._previousFov=this._computePreviousFov(this._zoom),this._interpolateFov(this._currentFov,this._previousFov,this._alpha)},u.prototype._computePreviousFov=function(t){return 0===this._perspective.aspect?0:this._currentNodeId?this._previousNodeId?this._previousPano?this._yToFov(1,t):this._computeVerticalFov(this._previousProjectedPoints,this._renderMode,t,this.perspective.aspect):this._currentFov:this._initialFov},u.prototype._computeProjectedPoints=function(t){return i.Geo.computeProjectedPoints(t,[[.5,0],[1,0]],[[.5,0],[0,.5]],100,this._viewportCoords)},u.prototype._computeRequiredVerticalFov=function(t,e,r){var n=Math.max(t[0]/r,t[1]);return this._yToFov(n,e)},u.prototype._computeRotation=function(t){var e=t.lookat.clone().sub(t.position),r=t.up.clone();return{phi:this._spatial.azimuthal(e.toArray(),r.toArray()),theta:Math.PI/2-this._spatial.angleToPlane(e.toArray(),[0,0,1])}},u.prototype._computeVerticalFov=function(t,e,r,n){var i=this,o=t.map(function(t){return i._computeRequiredVerticalFov(t,r,n)});return e===a.RenderMode.Fill?.995*Math.min.apply(Math,o):Math.max.apply(Math,o)},u.prototype._yToFov=function(t,e){return 2*Math.atan(t/Math.pow(2,e))*180/Math.PI},u.prototype._interpolateFov=function(t,e,r){return r*t+(1-r)*e},u.prototype._setFrameId=function(t){this._frameId=t,this._changed&&(this._changed=!1,this._changedForFrame=t)},u);function u(t,e,r){this._spatial=new i.Spatial,this._viewportCoords=new i.ViewportCoords,this._initialFov=50,this._alpha=-1,this._renderMode=r,this._zoom=0,this._frameId=-1,this._changed=!1,this._changedForFrame=-1,this._currentNodeId=null,this._previousNodeId=null,this._currentPano=!1,this._previousPano=!1,this._state=null,this._currentProjectedPoints=[],this._previousProjectedPoints=[],this._currentFov=this._initialFov,this._previousFov=this._initialFov,this._camera=new i.Camera,this._perspective=new n.PerspectiveCamera(this._initialFov,this._computeAspect(t,e),.16,1e4),this._perspective.matrixAutoUpdate=!1,this._rotation={phi:0,theta:0}}r.RenderCamera=o,r.default=o},{"../Geo":294,"../Render":297,"../State":298,three:242}],434:[function(t,e,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),(i=n=r.RenderMode||(r.RenderMode={}))[i.Letterbox=0]="Letterbox",i[i.Fill=1]="Fill",r.default=n},{}],435:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("rxjs/operators"),a=t("rxjs"),s=t("../Geo"),u=t("../Render"),n=(Object.defineProperty(i.prototype,"bearing$",{get:function(){return this._bearing$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"resize$",{get:function(){return this._resize$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"size$",{get:function(){return this._size$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderMode$",{get:function(){return this._renderMode$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderCameraFrame$",{get:function(){return this._renderCameraFrame$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderCamera$",{get:function(){return this._renderCamera$},enumerable:!0,configurable:!0}),i);function i(t,e,r,n){var i=this;this._element=t,this._currentFrame$=e,this._spatial=new s.Spatial,r=null!=r?r:u.RenderMode.Fill,this._resize$=new a.Subject,this._renderCameraOperation$=new a.Subject,this._size$=new a.BehaviorSubject({height:this._element.offsetHeight,width:this._element.offsetWidth}),this._resize$.pipe(o.map(function(){return{height:i._element.offsetHeight,width:i._element.offsetWidth}})).subscribe(this._size$),this._renderMode$=new a.BehaviorSubject(r),this._renderCameraHolder$=this._renderCameraOperation$.pipe(o.startWith(function(t){return t}),o.scan(function(t,e){return e(t)},n||new u.RenderCamera(this._element.offsetWidth,this._element.offsetHeight,r)),o.publishReplay(1),o.refCount()),this._renderCameraFrame$=this._currentFrame$.pipe(o.withLatestFrom(this._renderCameraHolder$),o.tap(function(t){var e=t[0];t[1].setFrame(e)}),o.map(function(t){return t[1]}),o.publishReplay(1),o.refCount()),this._renderCamera$=this._renderCameraFrame$.pipe(o.filter(function(t){return t.changed}),o.publishReplay(1),o.refCount()),this._bearing$=this._renderCamera$.pipe(o.map(function(t){var e=i._spatial.radToDeg(i._spatial.azimuthalToBearing(t.rotation.phi));return i._spatial.wrap(e,0,360)}),o.publishReplay(1),o.refCount()),this._size$.pipe(o.skip(1),o.map(function(e){return function(t){return t.setSize(e),t}})).subscribe(this._renderCameraOperation$),this._renderMode$.pipe(o.skip(1),o.map(function(e){return function(t){return t.setRenderMode(e),t}})).subscribe(this._renderCameraOperation$),this._bearing$.subscribe(function(){}),this._renderCameraHolder$.subscribe(function(){}),this._size$.subscribe(function(){}),this._renderMode$.subscribe(function(){}),this._renderCamera$.subscribe(function(){}),this._renderCameraFrame$.subscribe(function(){})}r.RenderService=n,r.default=n},{"../Geo":294,"../Render":297,rxjs:43,"rxjs/operators":241}],436:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(Object.defineProperty(i.prototype,"cancelAnimationFrame",{get:function(){return this._cancelAnimationFrame},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"requestAnimationFrame",{get:function(){return this._requestAnimationFrame},enumerable:!0,configurable:!0}),i);function i(e){e.requestAnimationFrame?(this._cancelAnimationFrame=e.cancelAnimationFrame.bind(e),this._requestAnimationFrame=e.requestAnimationFrame.bind(e)):e.mozRequestAnimationFrame?(this._cancelAnimationFrame=e.mozCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.mozRequestAnimationFrame.bind(e)):e.webkitRequestAnimationFrame?(this._cancelAnimationFrame=e.webkitCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.webkitRequestAnimationFrame.bind(e)):e.msRequestAnimationFrame?(this._cancelAnimationFrame=e.msCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.msRequestAnimationFrame.bind(e)):e.oRequestAnimationFrame?(this._cancelAnimationFrame=e.oCancelAnimationFrame.bind(e),this._requestAnimationFrame=e.oRequestAnimationFrame.bind(e)):(this._cancelAnimationFrame=e.clearTimeout.bind(e),this._requestAnimationFrame=function(t){return e.setTimeout(t,1e3/60)})}r.FrameGenerator=n,r.default=n},{}],437:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(Object.defineProperty(i.prototype,"phi",{get:function(){return this._phi},set:function(t){this._phi=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"theta",{get:function(){return this._theta},set:function(t){this._theta=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isZero",{get:function(){return 0===this._phi&&0===this._theta},enumerable:!0,configurable:!0}),i.prototype.copy=function(t){this._phi=t.phi,this._theta=t.theta},i.prototype.lerp=function(t,e){this._phi=(1-e)*this._phi+e*t.phi,this._theta=(1-e)*this._theta+e*t.theta},i.prototype.multiply=function(t){this._phi*=t,this._theta*=t},i.prototype.threshold=function(t){this._phi=Math.abs(this._phi)>t?this._phi:0,this._theta=Math.abs(this._theta)>t?this._theta:0},i.prototype.lengthSquared=function(){return this._phi*this._phi+this._theta*this._theta},i.prototype.reset=function(){this._phi=0,this._theta=0},i);function i(t,e){this._phi=t,this._theta=e}r.RotationDelta=n,r.default=n},{}],438:[function(t,e,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),(i=n=r.State||(r.State={}))[i.Earth=0]="Earth",i[i.Traversing=1]="Traversing",i[i.Waiting=2]="Waiting",i[i.WaitingInteractively=3]="WaitingInteractively",r.default=n},{}],439:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../State"),i=t("../Geo"),o=(a.prototype.earth=function(){this._state=this._state.earth()},a.prototype.traverse=function(){this._state=this._state.traverse()},a.prototype.wait=function(){this._state=this._state.wait()},a.prototype.waitInteractively=function(){this._state=this._state.waitInteractively()},Object.defineProperty(a.prototype,"state",{get:function(){if(this._state instanceof n.EarthState)return n.State.Earth;if(this._state instanceof n.TraversingState)return n.State.Traversing;if(this._state instanceof n.WaitingState)return n.State.Waiting;if(this._state instanceof n.InteractiveWaitingState)return n.State.WaitingInteractively;throw new Error("Invalid state")},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"reference",{get:function(){return this._state.reference},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"alpha",{get:function(){return this._state.alpha},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"camera",{get:function(){return this._state.camera},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"zoom",{get:function(){return this._state.zoom},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"currentNode",{get:function(){return this._state.currentNode},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"previousNode",{get:function(){return this._state.previousNode},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"currentCamera",{get:function(){return this._state.currentCamera},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"currentTransform",{get:function(){return this._state.currentTransform},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"previousTransform",{get:function(){return this._state.previousTransform},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"trajectory",{get:function(){return this._state.trajectory},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"currentIndex",{get:function(){return this._state.currentIndex},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"lastNode",{get:function(){return this._state.trajectory[this._state.trajectory.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"nodesAhead",{get:function(){return this._state.trajectory.length-1-this._state.currentIndex},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"motionless",{get:function(){return this._state.motionless},enumerable:!0,configurable:!0}),a.prototype.getCenter=function(){return this._state.getCenter()},a.prototype.setCenter=function(t){this._state.setCenter(t)},a.prototype.setZoom=function(t){this._state.setZoom(t)},a.prototype.update=function(t){this._state.update(t)},a.prototype.append=function(t){this._state.append(t)},a.prototype.prepend=function(t){this._state.prepend(t)},a.prototype.remove=function(t){this._state.remove(t)},a.prototype.clear=function(){this._state.clear()},a.prototype.clearPrior=function(){this._state.clearPrior()},a.prototype.cut=function(){this._state.cut()},a.prototype.set=function(t){this._state.set(t)},a.prototype.rotate=function(t){this._state.rotate(t)},a.prototype.rotateUnbounded=function(t){this._state.rotateUnbounded(t)},a.prototype.rotateWithoutInertia=function(t){this._state.rotateWithoutInertia(t)},a.prototype.rotateBasic=function(t){this._state.rotateBasic(t)},a.prototype.rotateBasicUnbounded=function(t){this._state.rotateBasicUnbounded(t)},a.prototype.rotateBasicWithoutInertia=function(t){this._state.rotateBasicWithoutInertia(t)},a.prototype.rotateToBasic=function(t){this._state.rotateToBasic(t)},a.prototype.move=function(t){this._state.move(t)},a.prototype.moveTo=function(t){this._state.moveTo(t)},a.prototype.zoomIn=function(t,e){this._state.zoomIn(t,e)},a.prototype.setSpeed=function(t){this._state.setSpeed(t)},a.prototype.setTransitionMode=function(t){this._state.setTransitionMode(t)},a.prototype.dolly=function(t){this._state.dolly(t)},a.prototype.orbit=function(t){this._state.orbit(t)},a.prototype.truck=function(t){this._state.truck(t)},a);function a(t){this._state=new n.TraversingState({alpha:1,camera:new i.Camera,currentIndex:-1,reference:{alt:0,lat:0,lon:0},trajectory:[],transitionMode:null==t?n.TransitionMode.Default:t,zoom:0})}r.StateContext=o},{"../Geo":294,"../State":298}],440:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("rxjs"),o=t("rxjs/operators"),a=t("../State"),n=(Object.defineProperty(s.prototype,"currentState$",{get:function(){return this._currentState$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"currentNode$",{get:function(){return this._currentNode$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"currentKey$",{get:function(){return this._currentKey$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"currentNodeExternal$",{get:function(){return this._currentNodeExternal$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"currentCamera$",{get:function(){return this._currentCamera$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"currentTransform$",{get:function(){return this._currentTransform$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"state$",{get:function(){return this._state$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"reference$",{get:function(){return this._reference$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"inMotion$",{get:function(){return this._inMotion$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"inTranslation$",{get:function(){return this._inTranslation$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"appendNode$",{get:function(){return this._appendNode$},enumerable:!0,configurable:!0}),s.prototype.earth=function(){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.earth()})},s.prototype.traverse=function(){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.traverse()})},s.prototype.wait=function(){this._invokeContextOperation(function(t){t.wait()})},s.prototype.waitInteractively=function(){this._invokeContextOperation(function(t){t.waitInteractively()})},s.prototype.appendNodes=function(e){this._invokeContextOperation(function(t){t.append(e)})},s.prototype.prependNodes=function(e){this._invokeContextOperation(function(t){t.prepend(e)})},s.prototype.removeNodes=function(e){this._invokeContextOperation(function(t){t.remove(e)})},s.prototype.clearNodes=function(){this._invokeContextOperation(function(t){t.clear()})},s.prototype.clearPriorNodes=function(){this._invokeContextOperation(function(t){t.clearPrior()})},s.prototype.cutNodes=function(){this._invokeContextOperation(function(t){t.cut()})},s.prototype.setNodes=function(e){this._invokeContextOperation(function(t){t.set(e)})},s.prototype.rotate=function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.rotate(e)})},s.prototype.rotateUnbounded=function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.rotateUnbounded(e)})},s.prototype.rotateWithoutInertia=function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.rotateWithoutInertia(e)})},s.prototype.rotateBasic=function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.rotateBasic(e)})},s.prototype.rotateBasicUnbounded=function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.rotateBasicUnbounded(e)})},s.prototype.rotateBasicWithoutInertia=function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.rotateBasicWithoutInertia(e)})},s.prototype.rotateToBasic=function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.rotateToBasic(e)})},s.prototype.move=function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.move(e)})},s.prototype.moveTo=function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.moveTo(e)})},s.prototype.dolly=function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.dolly(e)})},s.prototype.orbit=function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.orbit(e)})},s.prototype.truck=function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.truck(e)})},s.prototype.zoomIn=function(e,r){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.zoomIn(e,r)})},s.prototype.getCenter=function(){return this._lastState$.pipe(o.first(),o.map(function(t){return t.state.getCenter()}))},s.prototype.getZoom=function(){return this._lastState$.pipe(o.first(),o.map(function(t){return t.state.zoom}))},s.prototype.setCenter=function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.setCenter(e)})},s.prototype.setSpeed=function(e){this._invokeContextOperation(function(t){t.setSpeed(e)})},s.prototype.setTransitionMode=function(e){this._invokeContextOperation(function(t){t.setTransitionMode(e)})},s.prototype.setZoom=function(e){this._inMotionOperation$.next(!0),this._invokeContextOperation(function(t){t.setZoom(e)})},s.prototype.start=function(){null==this._frameId&&(this._start$.next(null),this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId))},s.prototype.stop=function(){null!=this._frameId&&(this._frameGenerator.cancelAnimationFrame(this._frameId),this._frameId=null)},s.prototype._invokeContextOperation=function(e){this._contextOperation$.next(function(t){return e(t),t})},s.prototype._frame=function(t){this._frameId=this._frameGenerator.requestAnimationFrame(this._frame.bind(this)),this._frame$.next(this._frameId)},s);function s(t){var e=this;this._appendNode$=new i.Subject,this._start$=new i.Subject,this._frame$=new i.Subject,this._fpsSampleRate=30,this._contextOperation$=new i.BehaviorSubject(function(t){return t}),this._context$=this._contextOperation$.pipe(o.scan(function(t,e){return e(t)},new a.StateContext(t)),o.publishReplay(1),o.refCount()),this._state$=this._context$.pipe(o.map(function(t){return t.state}),o.distinctUntilChanged(),o.publishReplay(1),o.refCount()),this._fps$=this._start$.pipe(o.switchMap(function(){return e._frame$.pipe(o.bufferCount(1,e._fpsSampleRate),o.map(function(t){return(new Date).getTime()}),o.pairwise(),o.map(function(t){return Math.max(20,1e3*e._fpsSampleRate/(t[1]-t[0]))}),o.startWith(60))}),o.share()),this._currentState$=this._frame$.pipe(o.withLatestFrom(this._fps$,this._context$,function(t,e,r){return[t,e,r]}),o.filter(function(t){return null!=t[2].currentNode}),o.tap(function(t){t[2].update(t[1])}),o.map(function(t){return{fps:t[1],id:t[0],state:t[2]}}),o.share()),this._lastState$=this._currentState$.pipe(o.publishReplay(1),o.refCount());var r=this._currentState$.pipe(o.distinctUntilChanged(void 0,function(t){return t.state.currentNode.key}),o.publishReplay(1),o.refCount()),n=new i.Subject;r.subscribe(n),this._currentKey$=new i.BehaviorSubject(null),n.pipe(o.map(function(t){return t.state.currentNode.key})).subscribe(this._currentKey$),this._currentNode$=n.pipe(o.map(function(t){return t.state.currentNode}),o.publishReplay(1),o.refCount()),this._currentCamera$=n.pipe(o.map(function(t){return t.state.currentCamera}),o.publishReplay(1),o.refCount()),this._currentTransform$=n.pipe(o.map(function(t){return t.state.currentTransform}),o.publishReplay(1),o.refCount()),this._reference$=n.pipe(o.map(function(t){return t.state.reference}),o.distinctUntilChanged(function(t,e){return t.lat===e.lat&&t.lon===e.lon},function(t){return{lat:t.lat,lon:t.lon}}),o.publishReplay(1),o.refCount()),this._currentNodeExternal$=r.pipe(o.map(function(t){return t.state.currentNode}),o.publishReplay(1),o.refCount()),this._appendNode$.pipe(o.map(function(e){return function(t){return t.append([e]),t}})).subscribe(this._contextOperation$),this._inMotionOperation$=new i.Subject,r.pipe(o.map(function(t){return!0})).subscribe(this._inMotionOperation$),this._inMotionOperation$.pipe(o.distinctUntilChanged(),o.filter(function(t){return t}),o.switchMap(function(t){return e._currentState$.pipe(o.filter(function(t){return 0===t.state.nodesAhead}),o.map(function(t){return[t.state.camera.clone(),t.state.zoom]}),o.pairwise(),o.map(function(t){var e=t[0][0],r=t[1][0],n=t[0][1],i=t[1][1];return 1e-5<e.diff(r)||1e-5<Math.abs(n-i)}),o.first(function(t){return!t}))})).subscribe(this._inMotionOperation$),this._inMotion$=this._inMotionOperation$.pipe(o.distinctUntilChanged(),o.publishReplay(1),o.refCount()),this._inTranslationOperation$=new i.Subject,r.pipe(o.map(function(t){return!0})).subscribe(this._inTranslationOperation$),this._inTranslationOperation$.pipe(o.distinctUntilChanged(),o.filter(function(t){return t}),o.switchMap(function(t){return e._currentState$.pipe(o.filter(function(t){return 0===t.state.nodesAhead}),o.map(function(t){return t.state.camera.position.clone()}),o.pairwise(),o.map(function(t){return 0!==t[0].distanceToSquared(t[1])}),o.first(function(t){return!t}))})).subscribe(this._inTranslationOperation$),this._inTranslation$=this._inTranslationOperation$.pipe(o.distinctUntilChanged(),o.publishReplay(1),o.refCount()),this._state$.subscribe(function(){}),this._currentNode$.subscribe(function(){}),this._currentCamera$.subscribe(function(){}),this._currentTransform$.subscribe(function(){}),this._reference$.subscribe(function(){}),this._currentNodeExternal$.subscribe(function(){}),this._lastState$.subscribe(function(){}),this._inMotion$.subscribe(function(){}),this._inTranslation$.subscribe(function(){}),this._frameId=null,this._frameGenerator=new a.FrameGenerator(window)}r.StateService=n},{"../State":298,rxjs:43,"rxjs/operators":241}],441:[function(t,e,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),(i=n=r.TransitionMode||(r.TransitionMode={}))[i.Default=0]="Default",i[i.Instantaneous=1]="Instantaneous",r.default=n},{}],442:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,u=t("three"),a=t("../../State"),s=(o=a.StateBase,i(c,o),c.prototype.traverse=function(){return new a.TraversingState(this)},c.prototype.wait=function(){return new a.WaitingState(this)},c.prototype.waitInteractively=function(){return new a.InteractiveWaitingState(this)},c.prototype.dolly=function(t){var e=this._camera,r=(new u.Vector3).copy(e.position).sub(e.lookat),n=r.length()*Math.pow(2,-t),i=Math.max(1,Math.min(n,1e3));r.normalize(),r.multiplyScalar(i),e.position.copy(e.lookat).add(r)},c.prototype.orbit=function(t){var e=this._camera,r=(new u.Quaternion).setFromUnitVectors(e.up,new u.Vector3(0,0,1)),n=r.clone().inverse(),i=new u.Vector3;i.copy(e.position).sub(e.lookat),i.applyQuaternion(r);var o=i.length(),a=Math.atan2(i.y,i.x);a+=t.phi;var s=Math.atan2(Math.sqrt(i.x*i.x+i.y*i.y),i.z);s+=t.theta,s=Math.max(.1,Math.min(Math.PI-.1,s)),i.x=Math.sin(s)*Math.cos(a),i.y=Math.sin(s)*Math.sin(a),i.z=Math.cos(s),i.applyQuaternion(n),e.position.copy(e.lookat).add(i.multiplyScalar(o))},c.prototype.truck=function(t){this._camera.position.add((new u.Vector3).fromArray(t)),this._camera.lookat.add((new u.Vector3).fromArray(t))},c.prototype.update=function(){},c);function c(t){var e=o.call(this,t)||this,r=e._camera.lookat.clone().sub(e._camera.position).normalize();return e._camera.lookat.copy(e._camera.position),e._camera.position.z=t.camera.position.z+20,e._camera.position.x=t.camera.position.x-16*r.x,e._camera.position.y=t.camera.position.y-16*r.y,e._camera.up.set(0,0,1),e}r.EarthState=s,r.default=s},{"../../State":298,three:242}],443:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,p=t("three"),a=t("../../State"),s=(o=a.StateBase,i(u,o),u.prototype.rotate=function(t){null!=this._currentNode&&(0===t.phi&&0===t.theta||(this._desiredZoom=this._zoom,this._desiredLookat=null,(this._requestedBasicRotation=null)!=this._requestedRotationDelta?(this._requestedRotationDelta.phi=this._requestedRotationDelta.phi+t.phi,this._requestedRotationDelta.theta=this._requestedRotationDelta.theta+t.theta):this._requestedRotationDelta=new a.RotationDelta(t.phi,t.theta)))},u.prototype.rotateUnbounded=function(t){if(null!=this._currentNode&&(this._requestedBasicRotation=null,this._requestedRotationDelta=null,this._applyRotation(t,this._currentCamera),this._applyRotation(t,this._previousCamera),this._desiredLookat)){var e=(new p.Quaternion).setFromUnitVectors(this._currentCamera.up,new p.Vector3(0,0,1)),r=e.clone().inverse(),n=(new p.Vector3).copy(this._desiredLookat).sub(this._camera.position).applyQuaternion(e),i=n.length(),o=Math.atan2(n.y,n.x);o+=t.phi;var a=Math.atan2(Math.sqrt(n.x*n.x+n.y*n.y),n.z);a+=t.theta,a=Math.max(.1,Math.min(Math.PI-.1,a)),n.x=Math.sin(a)*Math.cos(o),n.y=Math.sin(a)*Math.sin(o),n.z=Math.cos(a),n.applyQuaternion(r),this._desiredLookat.copy(this._camera.position).add(n.multiplyScalar(i))}},u.prototype.rotateWithoutInertia=function(t){if(null!=this._currentNode){this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedBasicRotation=null,this._requestedRotationDelta=null;var e=Math.PI/(10*Math.pow(2,this._zoom)),r={phi:this._spatial.clamp(t.phi,-e,e),theta:this._spatial.clamp(t.theta,-e,e)};this._applyRotation(r,this._currentCamera),this._applyRotation(r,this._previousCamera)}},u.prototype.rotateBasic=function(t){if(null!=this._currentNode)if(this._desiredZoom=this._zoom,this._desiredLookat=null,(this._requestedRotationDelta=null)!=this._requestedBasicRotation){this._requestedBasicRotation[0]+=t[0],this._requestedBasicRotation[1]+=t[1];var e=.05/Math.pow(2,this._zoom);this._requestedBasicRotation[0]=this._spatial.clamp(this._requestedBasicRotation[0],-e,e),this._requestedBasicRotation[1]=this._spatial.clamp(this._requestedBasicRotation[1],-e,e)}else this._requestedBasicRotation=t.slice()},u.prototype.rotateBasicUnbounded=function(t){null!=this._currentNode&&(null!=this._requestedBasicRotationUnbounded?(this._requestedBasicRotationUnbounded[0]+=t[0],this._requestedBasicRotationUnbounded[1]+=t[1]):this._requestedBasicRotationUnbounded=t.slice())},u.prototype.rotateBasicWithoutInertia=function(t){if(null!=this._currentNode){this._desiredZoom=this._zoom,this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null;var e=.05/Math.pow(2,this._zoom),r=t.slice();r[0]=this._spatial.clamp(r[0],-e,e),r[1]=this._spatial.clamp(r[1],-e,e),this._applyRotationBasic(r)}},u.prototype.rotateToBasic=function(t){if(null!=this._currentNode){this._desiredZoom=this._zoom,this._desiredLookat=null,t[0]=this._spatial.clamp(t[0],0,1),t[1]=this._spatial.clamp(t[1],0,1);var e=this.currentTransform.unprojectBasic(t,this._lookatDepth);this._currentCamera.lookat.fromArray(e)}},u.prototype.zoomIn=function(t,e){if(null!=this._currentNode){this._desiredZoom=Math.max(this._minZoom,Math.min(this._maxZoom,this._desiredZoom+t));var r=this.currentTransform.projectBasic(this._currentCamera.lookat.toArray()),n=r[0],i=r[1],o=Math.pow(2,this._zoom),a=Math.pow(2,this._desiredZoom),s=e[0],u=e[1];null!=this.currentTransform.gpano&&this.currentTransform.gpano.CroppedAreaImageWidthPixels===this.currentTransform.gpano.FullPanoWidthPixels&&(.5<s-n?s-=1:.5<n-s&&(s=1+s));var c=s-o/a*(s-n),l=u-o/a*(u-i),h=this.currentTransform.gpano;l=this._currentNode.fullPano?(c=this._spatial.wrap(c+this._basicRotation[0],0,1),this._spatial.clamp(l+this._basicRotation[1],.05,.95)):null!=h&&this.currentTransform.gpano.CroppedAreaImageWidthPixels===this.currentTransform.gpano.FullPanoWidthPixels?(c=this._spatial.wrap(c+this._basicRotation[0],0,1),this._spatial.clamp(l+this._basicRotation[1],0,1)):(c=this._spatial.clamp(c,0,1),this._spatial.clamp(l,0,1)),this._desiredLookat=(new p.Vector3).fromArray(this.currentTransform.unprojectBasic([c,l],this._lookatDepth))}},u.prototype.setCenter=function(t){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._desiredZoom=this._zoom;var e=[this._spatial.clamp(t[0],0,1),this._spatial.clamp(t[1],0,1)];if(null!=this._currentNode){this._desiredCenter=null;var r=(new p.Vector3).fromArray(this.currentTransform.unprojectBasic(e,this._lookatDepth)),n=null!=this.previousTransform?this.previousTransform:this.currentTransform,i=(new p.Vector3).fromArray(n.unprojectBasic(e,this._lookatDepth));this._currentCamera.lookat.copy(r),this._previousCamera.lookat.copy(i)}else this._desiredCenter=e},u.prototype.setZoom=function(t){this._desiredLookat=null,this._requestedRotationDelta=null,this._requestedBasicRotation=null,this._zoom=this._spatial.clamp(t,this._minZoom,this._maxZoom),this._desiredZoom=this._zoom},u.prototype._applyRotation=function(t,e){if(null!=e){var r=(new p.Quaternion).setFromUnitVectors(e.up,new p.Vector3(0,0,1)),n=r.clone().inverse(),i=new p.Vector3;i.copy(e.lookat).sub(e.position),i.applyQuaternion(r);var o=i.length(),a=Math.atan2(i.y,i.x);a+=t.phi;var s=Math.atan2(Math.sqrt(i.x*i.x+i.y*i.y),i.z);s+=t.theta,s=Math.max(.1,Math.min(Math.PI-.1,s)),i.x=Math.sin(s)*Math.cos(a),i.y=Math.sin(s)*Math.sin(a),i.z=Math.cos(s),i.applyQuaternion(n),e.lookat.copy(e.position).add(i.multiplyScalar(o))}},u.prototype._applyRotationBasic=function(t){var e=this._currentNode,r=null!=this._previousNode?this.previousNode:this.currentNode,n=this._currentCamera,i=this._previousCamera,o=this.currentTransform,a=null!=this.previousTransform?this.previousTransform:this.currentTransform,s=o.projectBasic(n.lookat.toArray()),u=a.projectBasic(i.lookat.toArray()),c=o.gpano,l=a.gpano;e.fullPano?(s[0]=this._spatial.wrap(s[0]+t[0],0,1),s[1]=this._spatial.clamp(s[1]+t[1],.05,.95)):(null!=c&&o.gpano.CroppedAreaImageWidthPixels===o.gpano.FullPanoWidthPixels?s[0]=this._spatial.wrap(s[0]+t[0],0,1):s[0]=this._spatial.clamp(s[0]+t[0],0,1),s[1]=this._spatial.clamp(s[1]+t[1],0,1)),r.fullPano?(u[0]=this._spatial.wrap(u[0]+t[0],0,1),u[1]=this._spatial.clamp(u[1]+t[1],.05,.95)):null!=l&&a.gpano.CroppedAreaImageWidthPixels===a.gpano.FullPanoWidthPixels?(u[0]=this._spatial.wrap(u[0]+t[0],0,1),u[1]=this._spatial.clamp(u[1]+t[1],0,1)):(u[0]=this._spatial.clamp(u[0]+t[0],0,1),u[1]=this._spatial.clamp(s[1]+t[1],0,1));var h=o.unprojectBasic(s,this._lookatDepth);n.lookat.fromArray(h);var p=a.unprojectBasic(u,this._lookatDepth);i.lookat.fromArray(p)},u.prototype._updateZoom=function(t){var e=this._desiredZoom-this._zoom,r=0<e?1:e<0?-1:0;0!=e&&(Math.abs(e)<.002?(this._zoom=this._desiredZoom,null!=this._desiredLookat&&(this._desiredLookat=null)):this._zoom+=r*Math.max(Math.abs(5*t*e),.002))},u.prototype._updateLookat=function(t){if(null!==this._desiredLookat){var e=this._desiredLookat.distanceToSquared(this._currentCamera.lookat);Math.abs(e)<1e-6?(this._currentCamera.lookat.copy(this._desiredLookat),this._desiredLookat=null):this._currentCamera.lookat.lerp(this._desiredLookat,5*t)}},u.prototype._updateRotation=function(){if(null!=this._requestedRotationDelta)return this._rotationDelta.lengthSquared()<this._requestedRotationDelta.lengthSquared()?this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationIncreaseAlpha):this._rotationDelta.lerp(this._requestedRotationDelta,this._rotationDecreaseAlpha),void(this._requestedRotationDelta=null);if(!this._rotationDelta.isZero){var t=this.currentNode.fullPano?1:this._alpha;this._rotationDelta.multiply(this._rotationAcceleration*t),this._rotationDelta.threshold(this._rotationThreshold)}},u.prototype._updateRotationBasic=function(){if(null!=this._requestedBasicRotation){var t=this._basicRotation[0],e=this._basicRotation[1],r=this._requestedBasicRotation[0],n=this._requestedBasicRotation[1];return Math.abs(r)>Math.abs(t)?this._basicRotation[0]=(1-this._rotationIncreaseAlpha)*t+this._rotationIncreaseAlpha*r:this._basicRotation[0]=(1-this._rotationDecreaseAlpha)*t+this._rotationDecreaseAlpha*r,Math.abs(n)>Math.abs(e)?this._basicRotation[1]=(1-this._rotationIncreaseAlpha)*e+this._rotationIncreaseAlpha*n:this._basicRotation[1]=(1-this._rotationDecreaseAlpha)*e+this._rotationDecreaseAlpha*n,void(this._requestedBasicRotation=null)}if(null!=this._requestedBasicRotationUnbounded){if(r=this._requestedBasicRotationUnbounded[0],n=this._requestedBasicRotationUnbounded[1],0<Math.abs(r)&&(this._basicRotation[0]=(1-this._unboundedRotationAlpha)*this._basicRotation[0]+this._unboundedRotationAlpha*r),0<Math.abs(n)&&(this._basicRotation[1]=(1-this._unboundedRotationAlpha)*this._basicRotation[1]+this._unboundedRotationAlpha*n),null!=this._desiredLookat){var i=this.currentTransform.projectBasic(this._desiredLookat.toArray());i[0]+=r,i[1]+=n,this._desiredLookat=(new p.Vector3).fromArray(this.currentTransform.unprojectBasic(i,this._lookatDepth))}this._requestedBasicRotationUnbounded=null}0===this._basicRotation[0]&&0===this._basicRotation[1]||(this._basicRotation[0]=this._rotationAcceleration*this._basicRotation[0],this._basicRotation[1]=this._rotationAcceleration*this._basicRotation[1],Math.abs(this._basicRotation[0])<this._rotationThreshold/Math.pow(2,this._zoom)&&Math.abs(this._basicRotation[1])<this._rotationThreshold/Math.pow(2,this._zoom)&&(this._basicRotation=[0,0]))},u.prototype._clearRotation=function(){this._currentNode.fullPano||(null!=this._requestedRotationDelta&&(this._requestedRotationDelta=null),this._rotationDelta.isZero||this._rotationDelta.reset(),null!=this._requestedBasicRotation&&(this._requestedBasicRotation=null),(0<this._basicRotation[0]||0<this._basicRotation[1])&&(this._basicRotation=[0,0]))},u.prototype._setDesiredCenter=function(){if(null!=this._desiredCenter){var t=(new p.Vector3).fromArray(this.currentTransform.unprojectBasic(this._desiredCenter,this._lookatDepth)).sub(this._currentCamera.position);this._currentCamera.lookat.copy(this._currentCamera.position.clone().add(t)),this._previousCamera.lookat.copy(this._previousCamera.position.clone().add(t)),this._desiredCenter=null}},u.prototype._setDesiredZoom=function(){this._desiredZoom=this._currentNode.fullPano||null==this._previousNode?this._zoom:0},u);function u(t){var e=o.call(this,t)||this;return e._animationSpeed=.025,e._rotationDelta=new a.RotationDelta(0,0),e._requestedRotationDelta=null,e._basicRotation=[0,0],e._requestedBasicRotation=null,e._requestedBasicRotationUnbounded=null,e._rotationAcceleration=.86,e._rotationIncreaseAlpha=.97,e._rotationDecreaseAlpha=.9,e._rotationThreshold=.001,e._unboundedRotationAlpha=.8,e._desiredZoom=t.zoom,e._minZoom=0,e._maxZoom=3,e._lookatDepth=10,e._desiredLookat=null,e._desiredCenter=null,e}r.InteractiveStateBase=s,r.default=s},{"../../State":298,three:242}],444:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../../State"),s=(o=a.InteractiveStateBase,i(u,o),u.prototype.traverse=function(){return new a.TraversingState(this)},u.prototype.wait=function(){return new a.WaitingState(this)},u.prototype.prepend=function(t){o.prototype.prepend.call(this,t),this._motionless=this._motionlessTransition()},u.prototype.set=function(t){o.prototype.set.call(this,t),this._motionless=this._motionlessTransition()},u.prototype.move=function(t){this._alpha=Math.max(0,Math.min(1,this._alpha+t))},u.prototype.moveTo=function(t){this._alpha=Math.max(0,Math.min(1,t))},u.prototype.update=function(t){this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),0===this._basicRotation[0]&&0===this._basicRotation[1]||this._applyRotationBasic(this._basicRotation);var e=this._animationSpeed*(60/t);this._updateZoom(e),this._updateLookat(e),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)},u.prototype._getAlpha=function(){return this._motionless?Math.round(this._alpha):this._alpha},u.prototype._setCurrentCamera=function(){o.prototype._setCurrentCamera.call(this),this._adjustCameras()},u.prototype._adjustCameras=function(){if(null!=this._previousNode){if(this._currentNode.fullPano){var t=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(t.clone().add(this._currentCamera.position))}this._previousNode.fullPano&&(t=this._currentCamera.lookat.clone().sub(this._currentCamera.position),this._previousCamera.lookat.copy(t.clone().add(this._previousCamera.position)))}},u);function u(t){var e=o.call(this,t)||this;return e._adjustCameras(),e._motionless=e._motionlessTransition(),e}r.InteractiveWaitingState=s,r.default=s},{"../../State":298}],445:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=t("../../Error"),s=t("../../Geo"),n=t("../../State"),i=(Object.defineProperty(o.prototype,"reference",{get:function(){return this._reference},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"alpha",{get:function(){return this._getAlpha()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"zoom",{get:function(){return this._zoom},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"trajectory",{get:function(){return this._trajectory},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"currentIndex",{get:function(){return this._currentIndex},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"currentNode",{get:function(){return this._currentNode},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"previousNode",{get:function(){return this._previousNode},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"currentCamera",{get:function(){return this._currentCamera},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"currentTransform",{get:function(){return 0<this._trajectoryTransforms.length?this._trajectoryTransforms[this.currentIndex]:null},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"previousTransform",{get:function(){return 1<this._trajectoryTransforms.length&&0<this.currentIndex?this._trajectoryTransforms[this.currentIndex-1]:null},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"motionless",{get:function(){return this._motionless},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"transitionMode",{get:function(){return this._transitionMode},enumerable:!0,configurable:!0}),o.prototype.earth=function(){throw new Error("Not implemented")},o.prototype.traverse=function(){throw new Error("Not implemented")},o.prototype.wait=function(){throw new Error("Not implemented")},o.prototype.waitInteractively=function(){throw new Error("Not implemented")},o.prototype.move=function(t){},o.prototype.moveTo=function(t){},o.prototype.rotate=function(t){},o.prototype.rotateUnbounded=function(t){},o.prototype.rotateWithoutInertia=function(t){},o.prototype.rotateBasic=function(t){},o.prototype.rotateBasicUnbounded=function(t){},o.prototype.rotateBasicWithoutInertia=function(t){},o.prototype.rotateToBasic=function(t){},o.prototype.setSpeed=function(t){},o.prototype.zoomIn=function(t,e){},o.prototype.update=function(t){},o.prototype.setCenter=function(t){},o.prototype.setZoom=function(t){},o.prototype.dolly=function(t){},o.prototype.orbit=function(t){},o.prototype.truck=function(t){},o.prototype.append=function(t){if(t.length<1)throw Error("Trajectory can not be empty");this._currentIndex<0?this.set(t):(this._trajectory=this._trajectory.concat(t),this._appendToTrajectories(t))},o.prototype.prepend=function(t){if(t.length<1)throw Error("Trajectory can not be empty");this._trajectory=t.slice().concat(this._trajectory),this._currentIndex+=t.length,this._setCurrentNode(),this._setReference(this._currentNode)?this._setTrajectories():this._prependToTrajectories(t),this._setCurrentCamera()},o.prototype.remove=function(t){if(t<0)throw Error("n must be a positive integer");if(this._currentIndex-1<t)throw Error("Current and previous nodes can not be removed");for(var e=0;e<t;e++)this._trajectory.shift(),this._trajectoryTransforms.shift(),this._trajectoryCameras.shift(),this._currentIndex--;this._setCurrentNode()},o.prototype.clearPrior=function(){0<this._currentIndex&&this.remove(this._currentIndex-1)},o.prototype.clear=function(){this.cut(),0<this._currentIndex&&this.remove(this._currentIndex-1)},o.prototype.cut=function(){for(;this._trajectory.length-1>this._currentIndex;)this._trajectory.pop(),this._trajectoryTransforms.pop(),this._trajectoryCameras.pop()},o.prototype.set=function(t){this._setTrajectory(t),this._setCurrentNode(),this._setReference(this._currentNode),this._setTrajectories(),this._setCurrentCamera()},o.prototype.getCenter=function(){return null!=this._currentNode?this.currentTransform.projectBasic(this._camera.lookat.toArray()):[.5,.5]},o.prototype.setTransitionMode=function(t){this._transitionMode=t},o.prototype._getAlpha=function(){return 1},o.prototype._setCurrent=function(){this._setCurrentNode(),this._setReference(this._currentNode)&&this._setTrajectories(),this._setCurrentCamera()},o.prototype._setCurrentCamera=function(){this._currentCamera=this._trajectoryCameras[this._currentIndex].clone(),this._previousCamera=0<this._currentIndex?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()},o.prototype._motionlessTransition=function(){return null!=this._currentNode&&null!=this._previousNode&&(this._transitionMode===n.TransitionMode.Instantaneous||!(this._currentNode.merged&&this._previousNode.merged&&this._withinOriginalDistance()&&this._sameConnectedComponent()))},o.prototype._setReference=function(t){return!(Math.abs(t.latLon.lat-this.reference.lat)<this._referenceThreshold&&Math.abs(t.latLon.lon-this.reference.lon)<this._referenceThreshold||null!=this._previousNode&&!this._motionlessTransition()||(this._reference.lat=t.latLon.lat,this._reference.lon=t.latLon.lon,this._reference.alt=t.alt,0))},o.prototype._setCurrentNode=function(){this._currentNode=0<this._trajectory.length?this._trajectory[this._currentIndex]:null,this._previousNode=0<this._currentIndex?this._trajectory[this._currentIndex-1]:null},o.prototype._setTrajectory=function(t){if(t.length<1)throw new a.ArgumentMapillaryError("Trajectory can not be empty");null!=this._currentNode?(this._trajectory=[this._currentNode].concat(t),this._currentIndex=1):(this._trajectory=t.slice(),this._currentIndex=0)},o.prototype._setTrajectories=function(){this._trajectoryTransforms.length=0,this._trajectoryCameras.length=0,this._appendToTrajectories(this._trajectory)},o.prototype._appendToTrajectories=function(t){for(var e=0,r=t;e<r.length;e++){var n=r[e];if(!n.assetsCached)throw new a.ArgumentMapillaryError("Assets must be cached when node is added to trajectory");var i=this._nodeToTranslation(n,this.reference),o=new s.Transform(n.orientation,n.width,n.height,n.focal,n.scale,n.gpano,n.rotation,i,n.image,void 0,n.ck1,n.ck2,n.cameraProjection);this._trajectoryTransforms.push(o),this._trajectoryCameras.push(new s.Camera(o))}},o.prototype._prependToTrajectories=function(t){for(var e=0,r=t.reverse();e<r.length;e++){var n=r[e];if(!n.assetsCached)throw new a.ArgumentMapillaryError("Assets must be cached when added to trajectory");var i=this._nodeToTranslation(n,this.reference),o=new s.Transform(n.orientation,n.width,n.height,n.focal,n.scale,n.gpano,n.rotation,i,n.image,void 0,n.ck1,n.ck2,n.cameraProjection);this._trajectoryTransforms.unshift(o),this._trajectoryCameras.unshift(new s.Camera(o))}},o.prototype._nodeToTranslation=function(t,e){return s.Geo.computeTranslation({alt:t.alt,lat:t.latLon.lat,lon:t.latLon.lon},t.rotation,e)},o.prototype._sameConnectedComponent=function(){var t=this._currentNode,e=this._previousNode;return!!t&&!!e&&t.mergeCC===e.mergeCC},o.prototype._withinOriginalDistance=function(){var t=this._currentNode,e=this._previousNode;return!t||!e||this._spatial.distanceFromLatLon(t.originalLatLon.lat,t.originalLatLon.lon,e.originalLatLon.lat,e.originalLatLon.lon)<25},o);function o(t){this._spatial=new s.Spatial,this._geoCoords=new s.GeoCoords,this._referenceThreshold=.01,this._transitionMode=t.transitionMode,this._reference=t.reference,this._alpha=t.alpha,this._camera=t.camera.clone(),this._zoom=t.zoom,this._currentIndex=t.currentIndex,this._trajectory=t.trajectory.slice(),this._trajectoryTransforms=[],this._trajectoryCameras=[];for(var e=0,r=this._trajectory;e<r.length;e++){var n=r[e],i=this._nodeToTranslation(n,this._reference),o=new s.Transform(n.orientation,n.width,n.height,n.focal,n.scale,n.gpano,n.rotation,i,n.image,void 0,n.ck1,n.ck2,n.cameraProjection);this._trajectoryTransforms.push(o),this._trajectoryCameras.push(new s.Camera(o))}this._currentNode=0<this._trajectory.length?this._trajectory[this._currentIndex]:null,this._previousNode=1<this._trajectory.length&&0<this.currentIndex?this._trajectory[this._currentIndex-1]:null,this._currentCamera=0<this._trajectoryCameras.length?this._trajectoryCameras[this._currentIndex].clone():new s.Camera,this._previousCamera=1<this._trajectoryCameras.length&&0<this.currentIndex?this._trajectoryCameras[this._currentIndex-1].clone():this._currentCamera.clone()}r.StateBase=i},{"../../Error":293,"../../Geo":294,"../../State":298}],446:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("@mapbox/unitbezier"),s=t("../../State"),u=(o=s.InteractiveStateBase,i(c,o),c.prototype.earth=function(){return new s.EarthState(this)},c.prototype.wait=function(){return new s.WaitingState(this)},c.prototype.waitInteractively=function(){return new s.InteractiveWaitingState(this)},c.prototype.append=function(t){var e=0===this._trajectory.length;e&&this._resetTransition(),o.prototype.append.call(this,t),e&&(this._setDesiredCenter(),this._setDesiredZoom())},c.prototype.prepend=function(t){var e=0===this._trajectory.length;e&&this._resetTransition(),o.prototype.prepend.call(this,t),e&&(this._setDesiredCenter(),this._setDesiredZoom())},c.prototype.set=function(t){o.prototype.set.call(this,t),this._desiredLookat=null,this._resetTransition(),this._clearRotation(),this._setDesiredCenter(),this._setDesiredZoom(),this._trajectory.length<3&&(this._useBezier=!0)},c.prototype.setSpeed=function(t){this._speedCoefficient=this._spatial.clamp(t,0,10)},c.prototype.update=function(t){1===this._alpha&&this._currentIndex+this._alpha<this._trajectory.length&&(this._currentIndex+=1,this._useBezier=this._trajectory.length<3&&this._currentIndex+1===this._trajectory.length,this._setCurrent(),this._resetTransition(),this._clearRotation(),this._desiredZoom=this._currentNode.fullPano?this._zoom:0,this._desiredLookat=null);var e=this._animationSpeed*(60/t);this._baseAlpha=Math.min(1,this._baseAlpha+this._speedCoefficient*e),this._useBezier?this._alpha=this._unitBezier.solve(this._baseAlpha):this._alpha=this._baseAlpha,this._updateRotation(),this._rotationDelta.isZero||(this._applyRotation(this._rotationDelta,this._previousCamera),this._applyRotation(this._rotationDelta,this._currentCamera)),this._updateRotationBasic(),0===this._basicRotation[0]&&0===this._basicRotation[1]||this._applyRotationBasic(this._basicRotation),this._updateZoom(e),this._updateLookat(e),this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)},c.prototype._getAlpha=function(){return this._motionless?Math.ceil(this._alpha):this._alpha},c.prototype._setCurrentCamera=function(){o.prototype._setCurrentCamera.call(this),this._adjustCameras()},c.prototype._adjustCameras=function(){if(null!=this._previousNode){var t=this._camera.lookat.clone().sub(this._camera.position);this._previousCamera.lookat.copy(t.clone().add(this._previousCamera.position)),this._currentNode.fullPano&&this._currentCamera.lookat.copy(t.clone().add(this._currentCamera.position))}},c.prototype._resetTransition=function(){this._alpha=0,this._baseAlpha=0,this._motionless=this._motionlessTransition()},c);function c(t){var e=o.call(this,t)||this;return e._adjustCameras(),e._motionless=e._motionlessTransition(),e._baseAlpha=e._alpha,e._speedCoefficient=1,e._unitBezier=new a(.74,.67,.38,.96),e._useBezier=!1,e}r.TraversingState=u,r.default=u},{"../../State":298,"@mapbox/unitbezier":2}],447:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var o,a=t("../../State"),s=(o=a.StateBase,i(u,o),u.prototype.traverse=function(){return new a.TraversingState(this)},u.prototype.waitInteractively=function(){return new a.InteractiveWaitingState(this)},u.prototype.prepend=function(t){o.prototype.prepend.call(this,t),this._motionless=this._motionlessTransition()},u.prototype.set=function(t){o.prototype.set.call(this,t),this._motionless=this._motionlessTransition()},u.prototype.move=function(t){this._alpha=Math.max(0,Math.min(1,this._alpha+t))},u.prototype.moveTo=function(t){this._alpha=Math.max(0,Math.min(1,t))},u.prototype.update=function(t){this._camera.lerpCameras(this._previousCamera,this._currentCamera,this.alpha)},u.prototype._getAlpha=function(){return this._motionless?Math.round(this._alpha):this._alpha},u.prototype._setCurrentCamera=function(){o.prototype._setCurrentCamera.call(this),this._adjustCameras()},u.prototype._adjustCameras=function(){if(null!=this._previousNode){if(this._currentNode.fullPano){var t=this._camera.lookat.clone().sub(this._camera.position);this._currentCamera.lookat.copy(t.clone().add(this._currentCamera.position))}this._previousNode.fullPano&&(t=this._currentCamera.lookat.clone().sub(this._currentCamera.position),this._previousCamera.lookat.copy(t.clone().add(this._previousCamera.position)))}},u);function u(t){var e=o.call(this,t)||this;return e._zoom=0,e._adjustCameras(),e._motionless=e._motionlessTransition(),e}r.WaitingState=s,r.default=s},{"../../State":298}],448:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rxjs"),i=(o.prototype.getTile=function(i,o,a,s,u,t,e){var r="/"+i+"/"+o+","+a+","+s+","+u+"/"+t+","+e+"/0/default.jpg",c=this._scheme+"://"+this._host+r+this._origin,l=null;return[n.Observable.create(function(n){(l=new XMLHttpRequest).open("GET",c,!0),l.responseType="arraybuffer",l.timeout=15e3,l.onload=function(t){if(200===l.status){var e=new Image;e.crossOrigin="Anonymous",e.onload=function(t){n.next(e),n.complete()},e.onerror=function(t){n.error(new Error("Failed to load tile image ("+i+": "+o+","+a+","+s+","+u+")"))};var r=new Blob([l.response]);e.src=window.URL.createObjectURL(r)}else n.error(new Error("Failed to fetch tile ("+i+": "+o+","+a+","+s+","+u+"). Status: "+l.status+", "+l.statusText))},l.onerror=function(t){n.error(new Error("Failed to fetch tile ("+i+": "+o+","+a+","+s+","+u+")"))},l.ontimeout=function(t){n.error(new Error("Tile request timed out ("+i+": "+o+","+a+","+s+","+u+")"))},l.onabort=function(t){n.error(new Error("Tile request was aborted ("+i+": "+o+","+a+","+s+","+u+")"))},l.send(null)}),function(){null!=l&&l.abort()}]},o);function o(t,e,r){this._scheme=t,this._host=e,this._origin=null!=r?"?origin="+r:""}r.ImageTileLoader=i,r.default=i},{rxjs:43}],449:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(i.prototype.addImage=function(t,e,r){r in this._images||(this._images[r]={}),this._images[r][e]=t},i.prototype.dispose=function(){for(var t=0,e=Object.keys(this._images);t<e.length;t++){for(var r=e[t],n=this._images[r],i=0,o=Object.keys(n);i<o.length;i++){var a=o[i];window.URL.revokeObjectURL(n[a].src),delete n[a]}delete this._images[r]}},i.prototype.getImage=function(t,e){return this._images[e][t]},i.prototype.hasImage=function(t,e){return e in this._images&&t in this._images[e]},i);function i(){this._images={}}r.ImageTileStore=n,r.default=n},{}],450:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Geo"),i=(o.prototype.computeRegionOfInterest=function(t,e,r){var n=this._viewportBoundaryPoints(4),i=this._viewportPointsBoundingBox(n,t,r);this._clipBoundingBox(i);var o=2/e.width,a=2/e.height,s=[[-.5*o,.5*a],[.5*o,.5*a],[.5*o,-.5*a],[-.5*o,-.5*a]],u=this._viewportPointsBoundingBox(s,t,r);return{bbox:i,pixelHeight:u.maxY-u.minY,pixelWidth:u.maxX-u.minX+(u.minX<u.maxX?0:1)}},o.prototype._viewportBoundaryPoints=function(t){for(var e=[],r=[[-1,1],[1,1],[1,-1],[-1,-1]],n=[[2,0],[0,-2],[-2,0],[0,2]],i=0;i<4;++i)for(var o=r[i],a=n[i],s=0;s<t;++s)e.push([o[0]+a[0]*s/t,o[1]+a[1]*s/t]);return e},o.prototype._viewportPointsBoundingBox=function(t,e,r){var n=this,i=t.map(function(t){return n._viewportCoords.viewportToBasic(t[0],t[1],r,e.perspective)});return null!=r.gpano?this._boundingBoxPano(i):this._boundingBox(i)},o.prototype._boundingBox=function(t){for(var e={maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY,minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY},r=0;r<t.length;++r)e.minX=Math.min(e.minX,t[r][0]),e.maxX=Math.max(e.maxX,t[r][0]),e.minY=Math.min(e.minY,t[r][1]),e.maxY=Math.max(e.maxY,t[r][1]);return e},o.prototype._boundingBoxPano=function(t){for(var r=this,e=[],n=[],i=0;i<t.length;++i)e.push(t[i][0]),n.push(t[i][1]);e.sort(function(t,e){return r._sign(t-e)}),n.sort(function(t,e){return r._sign(t-e)});var o=this._intervalPano(e);return{maxX:o[1],maxY:n[n.length-1],minX:o[0],minY:n[0]}},o.prototype._intervalPano=function(t){for(var e=0,r=-1,n=0;n<t.length-1;++n){var i=t[n+1]-t[n];e<i&&(e=i,r=n)}return e<t[0]+1-t[t.length-1]?[t[0],t[t.length-1]]:[t[r+1],t[r]]},o.prototype._clipBoundingBox=function(t){t.minX=Math.max(0,Math.min(1,t.minX)),t.maxX=Math.max(0,Math.min(1,t.maxX)),t.minY=Math.max(0,Math.min(1,t.minY)),t.maxY=Math.max(0,Math.min(1,t.maxY))},o.prototype._sign=function(t){return 0<t?1:t<0?-1:0},o);function o(){this._viewportCoords=new n.ViewportCoords}r.RegionOfInterestCalculator=i,r.default=i},{"../Geo":294}],451:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var u=t("rxjs/operators"),y=t("three"),c=t("rxjs"),n=(Object.defineProperty(i.prototype,"disposed",{get:function(){return this._disposed},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasTexture$",{get:function(){return this._has$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textureUpdated$",{get:function(){return this._updated$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textureCreated$",{get:function(){return this._created$},enumerable:!0,configurable:!0}),i.prototype.abort=function(){for(var t in this._tileSubscriptions)this._tileSubscriptions.hasOwnProperty(t)&&this._tileSubscriptions[t].unsubscribe();this._tileSubscriptions={};for(var e=0,r=this._abortFunctions;e<r.length;e++)(0,r[e])();this._abortFunctions=[]},i.prototype.dispose=function(){this._disposed?console.warn("Texture already disposed ("+this._key+")"):(this.abort(),null!=this._renderTarget&&(this._renderTarget.dispose(),this._renderTarget=null),this._imageTileStore.dispose(),this._imageTileStore=null,this._background=null,this._camera=null,this._imageTileLoader=null,this._renderer=null,this._roi=null,this._createdSubscription.unsubscribe(),this._hasSubscription.unsubscribe(),this._disposed=!0)},i.prototype.setRegionOfInterest=function(t){if(!(this._width<=0||this._height<=0)){this._roi=t;var e=1/this._roi.pixelWidth,r=1/this._roi.pixelHeight,n=Math.max(r,e),i=Math.max(0,Math.min(this._maxLevel,Math.ceil(Math.log(n)/Math.log(2))));if(i!==this._currentLevel){this.abort(),this._currentLevel=i,this._currentLevel in this._renderedTiles||(this._renderedTiles[this._currentLevel]=[]),this._renderedCurrentLevelTiles={};for(var o=0,a=this._renderedTiles[this._currentLevel];o<a.length;o++){var s=a[o];this._renderedCurrentLevelTiles[this._tileKey(this._tileSize,s)]=!0}}var u=this._getTileCoords([this._roi.bbox.minX,this._roi.bbox.minY]),c=this._getTileCoords([this._roi.bbox.maxX,this._roi.bbox.maxY]),l=this._getTiles(u,c);if(null==this._camera){this._camera=new y.OrthographicCamera(-this._width/2,this._width/2,this._height/2,-this._height/2,-1,1),this._camera.position.z=1;var h=this._renderer.getContext(),p=h.getParameter(h.MAX_TEXTURE_SIZE),f=Math.max(this._width,this._height),d=f<p?1:p/f,m=Math.floor(d*this._width),g=Math.floor(d*this._height);this._renderTarget=new y.WebGLRenderTarget(m,g,{depthBuffer:!1,format:y.RGBFormat,magFilter:y.LinearFilter,minFilter:y.LinearFilter,stencilBuffer:!1}),this._renderToTarget(0,0,this._width,this._height,this._background),this._createdSubject$.next(this._renderTarget.texture),this._hasSubject$.next(!0)}this._fetchTiles(l)}},i.prototype.setTileSize=function(t){this._tileSize=t},i.prototype.updateBackground=function(t){this._background=t},i.prototype._fetchTile=function(e,r,n,i,o,a,t,s){var u=this,c=this._imageTileLoader.getTile(this._key,n,i,o,a,t,s),l=c[0],h=c[1];this._abortFunctions.push(h);var p=this._tileKey(this._tileSize,e),f=l.subscribe(function(t){u._renderToTarget(n,i,o,a,t),u._removeFromDictionary(p,u._tileSubscriptions),u._removeFromArray(h,u._abortFunctions),u._setTileRendered(e,u._currentLevel),u._imageTileStore.addImage(t,p,r),u._updated$.next(!0)},function(t){u._removeFromDictionary(p,u._tileSubscriptions),u._removeFromArray(h,u._abortFunctions),console.error(t)});f.closed||(this._tileSubscriptions[p]=f)},i.prototype._fetchTiles=function(t){for(var e=this._tileSize*Math.pow(2,this._maxLevel-this._currentLevel),r=0,n=t;r<n.length;r++){var i=n[r],o=this._tileKey(this._tileSize,i);if(!(o in this._renderedCurrentLevelTiles||o in this._tileSubscriptions)){var a=e*i[0],s=e*i[1],u=a+e>this._width?this._width-a:e,c=s+e>this._height?this._height-s:e;if(this._imageTileStore.hasImage(o,this._currentLevel))this._renderToTarget(a,s,u,c,this._imageTileStore.getImage(o,this._currentLevel)),this._setTileRendered(i,this._currentLevel),this._updated$.next(!0);else{var l=Math.floor(u/e*this._tileSize),h=Math.floor(c/e*this._tileSize);this._fetchTile(i,this._currentLevel,a,s,u,c,l,h)}}}},i.prototype._getTileCoords=function(t){var e=this._tileSize*Math.pow(2,this._maxLevel-this._currentLevel),r=Math.ceil(this._width/e)-1,n=Math.ceil(this._height/e)-1;return[Math.min(Math.floor(this._width*t[0]/e),r),Math.min(Math.floor(this._height*t[1]/e),n)]},i.prototype._getTiles=function(t,e){var r=[];if(t[0]>e[0]){for(var n=this._tileSize*Math.pow(2,this._maxLevel-this._currentLevel),i=Math.ceil(this._width/n)-1,o=t[0];o<=i;o++)r.push(o);for(o=0;o<=e[0];o++)r.push(o)}else for(o=t[0];o<=e[0];o++)r.push(o);for(var a=[],s=0,u=r;s<u.length;s++){o=u[s];for(var c=t[1];c<=e[1];c++)a.push([o,c])}return a},i.prototype._removeFromArray=function(t,e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)},i.prototype._removeFromDictionary=function(t,e){t in e&&delete e[t]},i.prototype._renderToTarget=function(t,e,r,n,i){var o=new y.Texture(i);o.minFilter=y.LinearFilter,o.needsUpdate=!0;var a=new y.PlaneGeometry(r,n),s=new y.MeshBasicMaterial({map:o,side:y.FrontSide}),u=new y.Mesh(a,s);u.position.x=-this._width/2+t+r/2,u.position.y=this._height/2-e-n/2;var c=new y.Scene;c.add(u),this._renderer.render(c,this._camera,this._renderTarget),this._renderer.setRenderTarget(void 0),c.remove(u),a.dispose(),s.dispose(),o.dispose()},i.prototype._setTileRendered=function(t,e){for(var r=0,n=Object.keys(this._renderedTiles).map(function(t){return parseInt(t,10)}).filter(function(t){return t!==e});r<n.length;r++){var i=n[r],o=Math.pow(2,i-e);if(i<e){for(var a=Math.floor(o*t[0]),s=Math.floor(o*t[1]),u=0,c=this._renderedTiles[i].slice();u<c.length;u++)if((y=c[u])[0]===a&&y[1]===s){var l=this._renderedTiles[i].indexOf(y);this._renderedTiles[i].splice(l,1)}}else for(var h=o*t[0],p=h+o-1,f=o*t[1],d=f+o-1,m=0,g=this._renderedTiles[i].slice();m<g.length;m++){var y;(y=g[m])[0]>=h&&y[0]<=p&&y[1]>=f&&y[1]<=d&&(l=this._renderedTiles[i].indexOf(y),this._renderedTiles[i].splice(l,1))}0===this._renderedTiles[i].length&&delete this._renderedTiles[i]}this._renderedTiles[e].push(t),this._renderedCurrentLevelTiles[this._tileKey(this._tileSize,t)]=!0},i.prototype._tileKey=function(t,e){return t+"-"+e[0]+"-"+e[1]},i);function i(t,e,r,n,i,o,a,s){this._disposed=!1,this._key=t,(e<=0||r<=0)&&console.warn("Original image size ("+e+", "+r+") is invalid ("+t+"). Tiles will not be loaded."),this._width=e,this._height=r,this._maxLevel=Math.ceil(Math.log(Math.max(r,e))/Math.log(2)),this._currentLevel=-1,this._tileSize=n,this._updated$=new c.Subject,this._createdSubject$=new c.Subject,this._created$=this._createdSubject$.pipe(u.publishReplay(1),u.refCount()),this._createdSubscription=this._created$.subscribe(function(){}),this._hasSubject$=new c.Subject,this._has$=this._hasSubject$.pipe(u.startWith(!1),u.publishReplay(1),u.refCount()),this._hasSubscription=this._has$.subscribe(function(){}),this._abortFunctions=[],this._tileSubscriptions={},this._renderedCurrentLevelTiles={},this._renderedTiles={},this._background=i,this._camera=null,this._imageTileLoader=o,this._imageTileStore=a,this._renderer=s,this._renderTarget=null,this._roi=null}r.TextureProvider=n,r.default=n},{rxjs:43,"rxjs/operators":241,three:242}],452:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(Object.defineProperty(i.prototype,"document",{get:function(){return this._document},enumerable:!0,configurable:!0}),i.prototype.createElement=function(t,e,r){var n=this._document.createElement(t);return e&&(n.className=e),r&&r.appendChild(n),n},i);function i(t){this._document=t||document}r.DOM=n,r.default=n},{}],453:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(i.prototype.on=function(t,e){this._events[t]=this._events[t]||[],this._events[t].push(e)},i.prototype.off=function(t,e){if(t)if(this._listens(t))delete this._events[t];else{var r=this._events[t].indexOf(e);0<=r&&this._events[t].splice(r,1),this._events[t].length&&delete this._events[t]}else this._events={}},i.prototype.fire=function(t,e){if(this._listens(t))for(var r=0,n=this._events[t];r<n.length;r++)n[r].call(this,e)},i.prototype._listens=function(t){return!(!this._events||!this._events[t])},i);function i(){this._events={}}r.EventEmitter=n,r.default=n},{}],454:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("../Viewer"),i=(o.setOptions=function(t){o._baseImageSize=null!=t.baseImageSize?t.baseImageSize:n.ImageSize.Size640,o._basePanoramaSize=null!=t.basePanoramaSize?t.basePanoramaSize:n.ImageSize.Size2048,o._maxImageSize=null!=t.maxImageSize?t.maxImageSize:n.ImageSize.Size2048},Object.defineProperty(o,"baseImageSize",{get:function(){return o._baseImageSize},enumerable:!0,configurable:!0}),Object.defineProperty(o,"basePanoramaSize",{get:function(){return o._basePanoramaSize},enumerable:!0,configurable:!0}),Object.defineProperty(o,"maxImageSize",{get:function(){return o._maxImageSize},enumerable:!0,configurable:!0}),o);function o(){}r.Settings=i,r.default=i},{"../Viewer":302}],455:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isBrowser=function(){return"undefined"!=typeof window&&"undefined"!=typeof document},r.isArraySupported=function(){return!!(Array.prototype&&Array.prototype.filter&&Array.prototype.indexOf&&Array.prototype.map&&Array.prototype.reverse)},r.isFunctionSupported=function(){return!(!Function.prototype||!Function.prototype.bind)},r.isJSONSupported=function(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON},r.isObjectSupported=function(){return!(!Object.keys||!Object.assign)},r.isBlobSupported=function(){return"Blob"in window&&"URL"in window};var n=void 0;function i(){var t={alpha:!1,antialias:!1,depth:!0,failIfMajorPerformanceCaveat:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!0},e=document.createElement("canvas"),r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);if(!r)return!1;for(var n=r.getSupportedExtensions(),i=0,o=["OES_standard_derivatives"];i<o.length;i++){var a=o[i];if(-1===n.indexOf(a))return!1}return!0}r.isWebGLSupportedCached=function(){return void 0===n&&(n=i()),n},r.isWebGLSupported=i},{}],456:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=(Object.defineProperty(i,"explore",{get:function(){return i._scheme+"://"+i._exploreHost},enumerable:!0,configurable:!0}),Object.defineProperty(i,"origin",{get:function(){return i._origin},enumerable:!0,configurable:!0}),Object.defineProperty(i,"tileScheme",{get:function(){return i._scheme},enumerable:!0,configurable:!0}),Object.defineProperty(i,"tileDomain",{get:function(){return i._imageTileHost},enumerable:!0,configurable:!0}),i.clusterReconstruction=function(t){return i._scheme+"://"+i._clusterReconstructionHost+"/"+t+"/v1.0/aligned.jsonz"},i.exporeImage=function(t){return i._scheme+"://"+i._exploreHost+"/app/?pKey="+t+"&focus=photo"},i.exporeUser=function(t){return i._scheme+"://"+i._exploreHost+"/app/user/"+t},i.falcorModel=function(t){return i._scheme+"://"+i._apiHost+"/v3/model.json?client_id="+t},i.protoMesh=function(t){return i._scheme+"://"+i._meshHost+"/v2/mesh/"+t},i.thumbnail=function(t,e,r){return i._scheme+"://"+i._imageHost+"/"+t+"/thumb-"+e+".jpg"+(r?"?origin="+r:"")},i.setOptions=function(t){t&&(t.apiHost&&(i._apiHost=t.apiHost),t.clusterReconstructionHost&&(i._clusterReconstructionHost=t.clusterReconstructionHost),t.exploreHost&&(i._exploreHost=t.exploreHost),t.imageHost&&(i._imageHost=t.imageHost),t.imageTileHost&&(i._imageTileHost=t.imageTileHost),t.meshHost&&(i._meshHost=t.meshHost),t.scheme&&(i._scheme=t.scheme))},i._apiHost="a.mapillary.com",i._clusterReconstructionHost="cluster-reconstructions.mapillary.com",i._exploreHost="www.mapillary.com",i._imageHost="images.mapillary.com",i._imageTileHost="loris.mapillary.com",i._meshHost="meshes.mapillary.com",i._origin="mapillary.webgl",i._scheme="https",i);function i(){}r.Urls=n,r.default=n},{}],457:[function(t,e,r){"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),(i=n=r.Alignment||(r.Alignment={}))[i.Bottom=0]="Bottom",i[i.BottomLeft=1]="BottomLeft",i[i.BottomRight=2]="BottomRight",i[i.Center=3]="Center",i[i.Left=4]="Left",i[i.Right=5]="Right",i[i.Top=6]="Top",i[i.TopLeft=7]="TopLeft",i[i.TopRight=8]="TopRight",r.default=n},{}],458:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rxjs"),i=t("rxjs/operators"),a=t("../Graph"),o=(Object.defineProperty(s.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),s.prototype.start=function(){var o=this;this._started||(this._uncacheSubscription=this._stateService.currentState$.pipe(i.distinctUntilChanged(void 0,function(t){return t.state.currentNode.key}),i.map(function(t){var e=t.state.trajectory;return[e.map(function(t){return t.key}),e[e.length-1].sequenceKey]}),i.bufferCount(1,5),i.withLatestFrom(this._graphService.graphMode$),i.switchMap(function(t){var e=t[0],r=t[1],n=e[0][0],i=r===a.GraphMode.Sequence?e[0][1]:void 0;return o._graphService.uncache$(n,i)})).subscribe(function(){}),this._cacheNodeSubscription=this._graphService.graphMode$.pipe(i.skip(1),i.withLatestFrom(this._stateService.currentState$),i.switchMap(function(t){var e=t[0],r=t[1];return e===a.GraphMode.Sequence?o._keyToEdges(r.state.currentNode.key,function(t){return t.sequenceEdges$}):n.from(r.state.trajectory.map(function(t){return t.key}).slice(r.state.currentIndex)).pipe(i.mergeMap(function(t){return o._keyToEdges(t,function(t){return t.spatialEdges$})},6))})).subscribe(function(){}),this._started=!0)},s.prototype.stop=function(){this._started&&(this._uncacheSubscription.unsubscribe(),this._uncacheSubscription=null,this._cacheNodeSubscription.unsubscribe(),this._cacheNodeSubscription=null,this._started=!1)},s.prototype._keyToEdges=function(e,t){return this._graphService.cacheNode$(e).pipe(i.switchMap(t),i.first(function(t){return t.cached}),i.timeout(15e3),i.catchError(function(t){return console.error("Failed to cache edges ("+e+").",t),n.empty()}))},s);function s(t,e){this._graphService=t,this._stateService=e,this._started=!1}r.CacheService=o,r.default=o},{"../Graph":295,rxjs:43,"rxjs/operators":241}],459:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t("rxjs/operators"),u=t("../Component"),n=(Object.defineProperty(i.prototype,"navigable",{get:function(){return this._navigable},enumerable:!0,configurable:!0}),i.prototype.get=function(t){return this._componentService.get(t)},i.prototype.activate=function(t){this._componentService.activate(t)},i.prototype.activateCover=function(){this._coverComponent.configure({state:u.CoverState.Visible})},i.prototype.deactivate=function(t){this._componentService.deactivate(t)},i.prototype.deactivateCover=function(){this._coverComponent.configure({state:u.CoverState.Loading})},i.prototype._initializeComponents=function(){var t=this._options;this._uFalse(t.background,"background"),this._uFalse(t.debug,"debug"),this._uFalse(t.image,"image"),this._uFalse(t.marker,"marker"),this._uFalse(t.navigation,"navigation"),this._uFalse(t.popup,"popup"),this._uFalse(t.route,"route"),this._uFalse(t.slider,"slider"),this._uFalse(t.spatialData,"spatialData"),this._uFalse(t.tag,"tag"),this._uTrue(t.attribution,"attribution"),this._uTrue(t.bearing,"bearing"),this._uTrue(t.cache,"cache"),this._uTrue(t.direction,"direction"),this._uTrue(t.imagePlane,"imagePlane"),this._uTrue(t.keyboard,"keyboard"),this._uTrue(t.loading,"loading"),this._uTrue(t.mouse,"mouse"),this._uTrue(t.sequence,"sequence"),this._uTrue(t.stats,"stats"),this._uTrue(t.zoom,"zoom")},i.prototype._initilizeCoverComponent=function(){var t=this._options;this._coverComponent.configure({key:this._key}),void 0===t.cover||t.cover?this.activateCover():this.deactivateCover()},i.prototype._setNavigable=function(t){this._navigable!==t&&(this._navigable=t,this._observer.navigable$.next(t))},i.prototype._subscribeCoverComponent=function(){var n=this;this._coverComponent.configuration$.pipe(s.distinctUntilChanged(void 0,function(t){return t.state})).subscribe(function(r){r.state===u.CoverState.Loading?n._navigator.stateService.currentKey$.pipe(s.first(),s.switchMap(function(t){var e=null==t||t!==r.key;return e&&n._setNavigable(!1),e?n._navigator.moveToKey$(r.key):n._navigator.stateService.currentNode$.pipe(s.first())})).subscribe(function(){n._navigator.stateService.start(),n._navigator.cacheService.start(),n._navigator.panService.start(),n._observer.startEmit(),n._coverComponent.configure({state:u.CoverState.Hidden}),n._componentService.deactivateCover(),n._setNavigable(!0)},function(t){console.error("Failed to deactivate cover.",t),n._coverComponent.configure({state:u.CoverState.Visible})}):r.state===u.CoverState.Visible&&(n._observer.stopEmit(),n._navigator.stateService.stop(),n._navigator.cacheService.stop(),n._navigator.playService.stop(),n._navigator.panService.stop(),n._componentService.activateCover(),n._setNavigable(null==r.key))})},i.prototype._uFalse=function(t,e){void 0!==t?"boolean"!=typeof t?(this._componentService.configure(e,t),this._componentService.activate(e)):t?this._componentService.activate(e):this._componentService.deactivate(e):this._componentService.deactivate(e)},i.prototype._uTrue=function(t,e){void 0!==t?"boolean"!=typeof t?(this._componentService.configure(e,t),this._componentService.activate(e)):t?this._componentService.activate(e):this._componentService.deactivate(e):this._componentService.activate(e)},i);function i(t,e,r,n,i,o){var a=this;this._container=t,this._observer=r,this._navigator=e,this._options=null!=i?i:{},this._key=n,this._navigable=null==n,this._componentService=o||new u.ComponentService(this._container,this._navigator),this._coverComponent=this._componentService.getCover(),this._initializeComponents(),n?(this._initilizeCoverComponent(),this._subscribeCoverComponent()):this._navigator.movedToKey$.pipe(s.first(function(t){return null!=t})).subscribe(function(t){a._key=t,a._componentService.deactivateCover(),a._coverComponent.configure({key:a._key,state:u.CoverState.Hidden}),a._subscribeCoverComponent(),a._navigator.stateService.start(),a._navigator.cacheService.start(),a._navigator.panService.start(),a._observer.startEmit()})}r.ComponentController=n},{"../Component":291,"rxjs/operators":241}],460:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=t("../Render"),o=t("../Utils"),a=t("../Viewer"),n=(Object.defineProperty(s.prototype,"element",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"canvasContainer",{get:function(){return this._canvasContainer},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"domContainer",{get:function(){return this._domContainer},enumerable:!0,configurable:!0}),s);function s(t,e,r,n){if(this.id=t,this._dom=n||new o.DOM,this._container=this._dom.document.getElementById(t),!this._container)throw new Error("Container '"+t+"' not found.");this._container.classList.add("mapillary-js"),this._canvasContainer=this._dom.createElement("div","mapillary-js-interactive",this._container),this._domContainer=this._dom.createElement("div","mapillary-js-dom",this._container),this.renderService=new i.RenderService(this._container,e.currentState$,r.renderMode),this.glRenderer=new i.GLRenderer(this._canvasContainer,this.renderService,this._dom),this.domRenderer=new i.DOMRenderer(this._domContainer,this.renderService,e.currentState$),this.keyboardService=new a.KeyboardService(this._canvasContainer),this.mouseService=new a.MouseService(this._container,this._canvasContainer,this._domContainer,document),this.touchService=new a.TouchService(this._canvasContainer,this._domContainer),this.spriteService=new a.SpriteService(r.sprite)}r.Container=n,r.default=n},{"../Render":297,"../Utils":301,"../Viewer":302}],461:[function(t,e,r){"use strict";var n;Object.defineProperty(r,"__esModule",{value:!0}),(n=r.ImageSize||(r.ImageSize={}))[n.Size320=320]="Size320",n[n.Size640=640]="Size640",n[n.Size1024=1024]="Size1024",n[n.Size2048=2048]="Size2048"},{}],462:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rxjs"),i=(Object.defineProperty(o.prototype,"keyDown$",{get:function(){return this._keyDown$},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"keyUp$",{get:function(){return this._keyUp$},enumerable:!0,configurable:!0}),o);function o(t){this._keyDown$=n.fromEvent(t,"keydown"),this._keyUp$=n.fromEvent(t,"keyup")}r.KeyboardService=i,r.default=i},{rxjs:43}],463:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("rxjs/operators"),i=t("rxjs"),o=(Object.defineProperty(a.prototype,"loading$",{get:function(){return this._loaders$.pipe(n.map(function(t){for(var e in t)if(t.hasOwnProperty(e)&&t[e])return!0;return!1}),n.debounceTime(100),n.distinctUntilChanged())},enumerable:!0,configurable:!0}),a.prototype.taskLoading$=function(e){return this._loaders$.pipe(n.map(function(t){return!!t[e]}),n.debounceTime(100),n.distinctUntilChanged())},a.prototype.startLoading=function(t){this._loadersSubject$.next({loading:!0,task:t})},a.prototype.stopLoading=function(t){this._loadersSubject$.next({loading:!1,task:t})},a);function a(){this._loadersSubject$=new i.Subject,this._loaders$=this._loadersSubject$.pipe(n.scan(function(t,e){return void 0!==e.task&&(t[e.task]=e.loading),t},{}),n.startWith({}),n.publishReplay(1),n.refCount())}r.LoadingService=o,r.default=o},{rxjs:43,"rxjs/operators":241}],464:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var u=t("rxjs"),c=t("rxjs/operators"),n=(Object.defineProperty(i.prototype,"active$",{get:function(){return this._active$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"activate$",{get:function(){return this._activeSubject$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"documentMouseMove$",{get:function(){return this._documentMouseMove$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"documentMouseUp$",{get:function(){return this._documentMouseUp$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"domMouseDragStart$",{get:function(){return this._domMouseDragStart$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"domMouseDrag$",{get:function(){return this._domMouseDrag$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"domMouseDragEnd$",{get:function(){return this._domMouseDragEnd$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"domMouseDown$",{get:function(){return this._domMouseDown$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"domMouseMove$",{get:function(){return this._domMouseMove$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mouseOwner$",{get:function(){return this._mouseOwner$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mouseDown$",{get:function(){return this._mouseDown$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mouseMove$",{get:function(){return this._mouseMove$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mouseLeave$",{get:function(){return this._mouseLeave$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mouseOut$",{get:function(){return this._mouseOut$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mouseOver$",{get:function(){return this._mouseOver$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mouseUp$",{get:function(){return this._mouseUp$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"click$",{get:function(){return this._click$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dblClick$",{get:function(){return this._dblClick$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"contextMenu$",{get:function(){return this._consistentContextMenu$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mouseWheel$",{get:function(){return this._mouseWheel$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mouseDragStart$",{get:function(){return this._mouseDragStart$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mouseDrag$",{get:function(){return this._mouseDrag$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mouseDragEnd$",{get:function(){return this._mouseDragEnd$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"proximateClick$",{get:function(){return this._proximateClick$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"staticClick$",{get:function(){return this._staticClick$},enumerable:!0,configurable:!0}),i.prototype.claimMouse=function(t,e){this._claimMouse$.next({name:t,zindex:e})},i.prototype.unclaimMouse=function(t){this._claimMouse$.next({name:t,zindex:null})},i.prototype.deferPixels=function(t,e){this._deferPixelClaims$.next({name:t,deferPixels:e})},i.prototype.undeferPixels=function(t){this._deferPixelClaims$.next({name:t,deferPixels:null})},i.prototype.claimWheel=function(t,e){this._claimWheel$.next({name:t,zindex:e})},i.prototype.unclaimWheel=function(t){this._claimWheel$.next({name:t,zindex:null})},i.prototype.filtered$=function(t,e){return this._filtered(t,e,this._mouseOwner$)},i.prototype.filteredWheel$=function(t,e){return this._filtered(t,e,this._wheelOwner$)},i.prototype._createDeferredMouseMove$=function(n,t){return t.pipe(c.map(function(t){var e=t.clientX-n.clientX,r=t.clientY-n.clientY;return[t,Math.sqrt(e*e+r*r)]}),c.withLatestFrom(this._deferPixels$),c.filter(function(t){var e=t[0],r=(e[0],e[1]);return t[1]<r}),c.map(function(t){var e=t[0],r=e[0];return e[1],t[1],r}))},i.prototype._createMouseDrag$=function(t,e){var r=this;return t.pipe(c.map(function(t){return t[0],t[1]}),c.switchMap(function(t){return u.concat(u.of(t),r._documentMouseMove$).pipe(c.takeUntil(e))}))},i.prototype._createMouseDragEnd$=function(t,e){return t.pipe(c.switchMap(function(t){return e.pipe(c.first())}))},i.prototype._createMouseDragStart$=function(t){return t.pipe(c.map(function(t){var e=t[0];return t[1],e}))},i.prototype._createMouseDragInitiate$=function(t,e,r){var n=this;return t.pipe(c.filter(function(t){return 0===t.button}),c.switchMap(function(t){return u.combineLatest(u.of(t),r?n._createDeferredMouseMove$(t,n._documentMouseMove$):n._documentMouseMove$).pipe(c.takeUntil(e),c.take(1))}))},i.prototype._createOwner$=function(t){return t.pipe(c.scan(function(t,e){return null==e.zindex?delete t[e.name]:t[e.name]=e.zindex,t},{}),c.map(function(t){var e=null,r=-1;for(var n in t)t.hasOwnProperty(n)&&t[n]>r&&(r=t[n],e=n);return e}),c.startWith(null))},i.prototype._filtered=function(e,t,r){return t.pipe(c.withLatestFrom(r),c.filter(function(t){return t[0],t[1]===e}),c.map(function(t){var e=t[0];return t[1],e}))},i);function i(t,i,e,r){var n=this;this._activeSubject$=new u.BehaviorSubject(!1),this._active$=this._activeSubject$.pipe(c.distinctUntilChanged(),c.publishReplay(1),c.refCount()),this._claimMouse$=new u.Subject,this._claimWheel$=new u.Subject,this._deferPixelClaims$=new u.Subject,this._deferPixels$=this._deferPixelClaims$.pipe(c.scan(function(t,e){return null==e.deferPixels?delete t[e.name]:t[e.name]=e.deferPixels,t},{}),c.map(function(t){var e=-1;for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];e<n&&(e=n)}return e}),c.startWith(-1),c.publishReplay(1),c.refCount()),this._deferPixels$.subscribe(function(){}),this._documentMouseMove$=u.fromEvent(r,"mousemove"),this._documentMouseUp$=u.fromEvent(r,"mouseup"),this._mouseDown$=u.fromEvent(i,"mousedown"),this._mouseLeave$=u.fromEvent(i,"mouseleave"),this._mouseMove$=u.fromEvent(i,"mousemove"),this._mouseUp$=u.fromEvent(i,"mouseup"),this._mouseOut$=u.fromEvent(i,"mouseout"),this._mouseOver$=u.fromEvent(i,"mouseover"),this._domMouseDown$=u.fromEvent(e,"mousedown"),this._domMouseMove$=u.fromEvent(e,"mousemove"),this._click$=u.fromEvent(i,"click"),this._contextMenu$=u.fromEvent(i,"contextmenu"),this._dblClick$=u.merge(u.fromEvent(t,"click"),u.fromEvent(i,"dblclick")).pipe(c.bufferCount(3,1),c.filter(function(t){var e=t[0],r=t[1],n=t[2];return"click"===e.type&&"click"===r.type&&"dblclick"===n.type&&e.target.parentNode===i&&r.target.parentNode===i}),c.map(function(t){return t[2]}),c.share()),u.merge(this._domMouseDown$,this._domMouseMove$,this._dblClick$,this._contextMenu$).subscribe(function(t){t.preventDefault()}),this._mouseWheel$=u.merge(u.fromEvent(i,"wheel"),u.fromEvent(e,"wheel")).pipe(c.share()),this._consistentContextMenu$=u.merge(this._mouseDown$,this._mouseMove$,this._mouseOut$,this._mouseUp$,this._contextMenu$).pipe(c.bufferCount(3,1),c.filter(function(t){return"mousedown"===t[0].type&&"contextmenu"===t[1].type&&"mouseup"===t[2].type}),c.map(function(t){return t[1]}),c.share());var o=u.merge(u.fromEvent(window,"blur"),this._documentMouseUp$.pipe(c.filter(function(t){return 0===t.button}))).pipe(c.share()),a=this._createMouseDragInitiate$(this._mouseDown$,o,!0).pipe(c.share());this._mouseDragStart$=this._createMouseDragStart$(a).pipe(c.share()),this._mouseDrag$=this._createMouseDrag$(a,o).pipe(c.share()),this._mouseDragEnd$=this._createMouseDragEnd$(this._mouseDragStart$,o).pipe(c.share());var s=this._createMouseDragInitiate$(this._domMouseDown$,o,!1).pipe(c.share());this._domMouseDragStart$=this._createMouseDragStart$(s).pipe(c.share()),this._domMouseDrag$=this._createMouseDrag$(s,o).pipe(c.share()),this._domMouseDragEnd$=this._createMouseDragEnd$(this._domMouseDragStart$,o).pipe(c.share()),this._proximateClick$=this._mouseDown$.pipe(c.switchMap(function(t){return n._click$.pipe(c.takeUntil(n._createDeferredMouseMove$(t,n._documentMouseMove$)),c.take(1))}),c.share()),this._staticClick$=this._mouseDown$.pipe(c.switchMap(function(t){return n._click$.pipe(c.takeUntil(n._documentMouseMove$),c.take(1))}),c.share()),this._mouseDragStart$.subscribe(),this._mouseDrag$.subscribe(),this._mouseDragEnd$.subscribe(),this._domMouseDragStart$.subscribe(),this._domMouseDrag$.subscribe(),this._domMouseDragEnd$.subscribe(),this._staticClick$.subscribe(),this._mouseOwner$=this._createOwner$(this._claimMouse$).pipe(c.publishReplay(1),c.refCount()),this._wheelOwner$=this._createOwner$(this._claimWheel$).pipe(c.publishReplay(1),c.refCount()),this._mouseOwner$.subscribe(function(){}),this._wheelOwner$.subscribe(function(){})}r.MouseService=n,r.default=n},{rxjs:43,"rxjs/operators":241}],465:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var h=t("rxjs"),o=t("rxjs/operators"),p=t("../API"),f=t("../Graph"),n=t("../Edge"),i=t("../Error"),d=t("../State"),m=t("../Viewer"),g=t("./PanService"),a=(Object.defineProperty(s.prototype,"apiV3",{get:function(){return this._apiV3},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"cacheService",{get:function(){return this._cacheService},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"graphService",{get:function(){return this._graphService},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"imageLoadingService",{get:function(){return this._imageLoadingService},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"loadingService",{get:function(){return this._loadingService},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"movedToKey$",{get:function(){return this._movedToKey$},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"panService",{get:function(){return this._panService},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"playService",{get:function(){return this._playService},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"stateService",{get:function(){return this._stateService},enumerable:!0,configurable:!0}),s.prototype.moveToKey$=function(t){this._abortRequest("to key "+t),this._loadingService.startLoading(this._loadingName);var e=this._moveToKey$(t);return this._makeRequest$(e)},s.prototype.moveDir$=function(i){var e=this;this._abortRequest("in dir "+n.EdgeDirection[i]),this._loadingService.startLoading(this._loadingName);var t=this.stateService.currentNode$.pipe(o.first(),o.mergeMap(function(t){return(-1<[n.EdgeDirection.Next,n.EdgeDirection.Prev].indexOf(i)?t.sequenceEdges$:t.spatialEdges$).pipe(o.first(),o.map(function(t){for(var e=0,r=t.edges;e<r.length;e++){var n=r[e];if(n.data.direction===i)return n.to}return null}))}),o.mergeMap(function(t){return null==t?(e._loadingService.stopLoading(e._loadingName),h.throwError(new Error("Direction ("+i+") does not exist for current node."))):e._moveToKey$(t)}));return this._makeRequest$(t)},s.prototype.moveCloseTo$=function(e,r){var n=this;this._abortRequest("to lat "+e+", lon "+r),this._loadingService.startLoading(this._loadingName);var t=this.apiV3.imageCloseTo$(e,r).pipe(o.mergeMap(function(t){return null==t?(n._loadingService.stopLoading(n._loadingName),h.throwError(new Error("No image found close to lat "+e+", lon "+r+"."))):n._moveToKey$(t.key)}));return this._makeRequest$(t)},s.prototype.setFilter$=function(e){var r=this;return this._stateService.clearNodes(),this._movedToKey$.pipe(o.first(),o.mergeMap(function(t){return null!=t?r._trajectoryKeys$().pipe(o.mergeMap(function(t){return r._graphService.setFilter$(e).pipe(o.mergeMap(function(){return r._cacheKeys$(t)}))}),o.last()):r._keyRequested$.pipe(o.first(),o.mergeMap(function(t){return null!=t?r._graphService.setFilter$(e).pipe(o.mergeMap(function(){return r._graphService.cacheNode$(t)})):r._graphService.setFilter$(e).pipe(o.map(function(){}))}))}),o.map(function(t){}))},s.prototype.setToken$=function(e){var r=this;return this._abortRequest("to set token"),this._stateService.clearNodes(),this._movedToKey$.pipe(o.first(),o.tap(function(t){r._apiV3.setToken(e)}),o.mergeMap(function(t){return null==t?r._graphService.reset$([]):r._trajectoryKeys$().pipe(o.mergeMap(function(t){return r._graphService.reset$(t).pipe(o.mergeMap(function(){return r._cacheKeys$(t)}))}),o.last(),o.map(function(t){}))}))},s.prototype._cacheKeys$=function(t){var e=this,r=t.map(function(t){return e._graphService.cacheNode$(t)});return h.from(r).pipe(o.mergeAll())},s.prototype._abortRequest=function(t){null!=this._requestSubscription&&(this._requestSubscription.unsubscribe(),this._requestSubscription=null),null!=this._nodeRequestSubscription&&(this._nodeRequestSubscription.unsubscribe(),this._nodeRequestSubscription=null),null!=this._request$&&(this._request$.isStopped||this._request$.hasError||this._request$.error(new i.AbortMapillaryError("Request aborted by a subsequent request "+t+".")),this._request$=null)},s.prototype._makeRequest$=function(t){var e=this,r=new h.ReplaySubject(1);return this._requestSubscription=r.subscribe(void 0,function(){}),this._request$=r,this._nodeRequestSubscription=t.subscribe(function(t){e._request$=null,r.next(t),r.complete()},function(t){e._request$=null,r.error(t)}),r},s.prototype._moveToKey$=function(t){var e=this;return this._keyRequested$.next(t),this._graphService.cacheNode$(t).pipe(o.tap(function(t){e._stateService.setNodes([t]),e._movedToKey$.next(t.key)}),o.finalize(function(){e._loadingService.stopLoading(e._loadingName)}))},s.prototype._trajectoryKeys$=function(){return this._stateService.currentState$.pipe(o.first(),o.map(function(t){return t.state.trajectory.map(function(t){return t.key})}))},s);function s(t,e,r,n,i,o,a,s,u,c,l){this._apiV3=null!=n?n:new p.APIv3(t,r),this._imageLoadingService=null!=o?o:new f.ImageLoadingService,this._graphService=null!=i?i:new f.GraphService(new f.Graph(this.apiV3),this._imageLoadingService),this._loadingService=null!=a?a:new m.LoadingService,this._loadingName="navigator",this._stateService=null!=s?s:new d.StateService(e.transitionMode),this._cacheService=null!=u?u:new m.CacheService(this._graphService,this._stateService),this._playService=null!=c?c:new m.PlayService(this._graphService,this._stateService),this._panService=null!=l?l:new g.PanService(this._graphService,this._stateService,e.combinedPanning),this._keyRequested$=new h.BehaviorSubject(null),this._movedToKey$=new h.BehaviorSubject(null),this._request$=null,this._requestSubscription=null,this._nodeRequestSubscription=null}r.Navigator=a,r.default=a},{"../API":290,"../Edge":292,"../Error":293,"../Graph":295,"../State":298,"../Viewer":302,"./PanService":467,rxjs:43,"rxjs/operators":241}],466:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t("rxjs"),c=t("rxjs/operators"),i=t("../Viewer"),n=(Object.defineProperty(o.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"navigable$",{get:function(){return this._navigable$},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"projection",{get:function(){return this._projection},enumerable:!0,configurable:!0}),o.prototype.project$=function(o){var a=this;return s.combineLatest(this._container.renderService.renderCamera$,this._navigator.stateService.currentNode$,this._navigator.stateService.reference$).pipe(c.first(),c.map(function(t){var e=t[0],r=t[1],n=t[2];if(1e3<a._projection.distanceBetweenLatLons(o,r.latLon))return null;var i=a._projection.latLonToCanvas(o,a._container.element,e,n);return i?[Math.round(i[0]),Math.round(i[1])]:null}))},o.prototype.projectBasic$=function(i){var o=this;return s.combineLatest(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(c.first(),c.map(function(t){var e=t[0],r=t[1],n=o._projection.basicToCanvas(i,o._container.element,e,r);return n?[Math.round(n[0]),Math.round(n[1])]:null}))},o.prototype.startEmit=function(){var u=this;if(!this._started){this._started=!0,this._currentNodeSubscription=this._navigator.stateService.currentNodeExternal$.subscribe(function(t){u._eventEmitter.fire(i.Viewer.nodechanged,t)}),this._sequenceEdgesSubscription=this._navigator.stateService.currentNodeExternal$.pipe(c.switchMap(function(t){return t.sequenceEdges$})).subscribe(function(t){u._eventEmitter.fire(i.Viewer.sequenceedgeschanged,t)}),this._spatialEdgesSubscription=this._navigator.stateService.currentNodeExternal$.pipe(c.switchMap(function(t){return t.spatialEdges$})).subscribe(function(t){u._eventEmitter.fire(i.Viewer.spatialedgeschanged,t)}),this._moveSubscription=s.combineLatest(this._navigator.stateService.inMotion$,this._container.mouseService.active$,this._container.touchService.active$).pipe(c.map(function(t){return t[0]||t[1]||t[2]}),c.distinctUntilChanged()).subscribe(function(t){t?u._eventEmitter.fire(i.Viewer.movestart,null):u._eventEmitter.fire(i.Viewer.moveend,null)}),this._bearingSubscription=this._container.renderService.bearing$.pipe(c.auditTime(100),c.distinctUntilChanged(function(t,e){return Math.abs(e-t)<1})).subscribe(function(t){u._eventEmitter.fire(i.Viewer.bearingchanged,t)});var t=this._container.mouseService.active$.pipe(c.switchMap(function(t){return t?s.empty():u._container.mouseService.mouseMove$}));this._viewerMouseEventSubscription=s.merge(this._mapMouseEvent$(i.Viewer.click,this._container.mouseService.staticClick$),this._mapMouseEvent$(i.Viewer.contextmenu,this._container.mouseService.contextMenu$),this._mapMouseEvent$(i.Viewer.dblclick,this._container.mouseService.dblClick$),this._mapMouseEvent$(i.Viewer.mousedown,this._container.mouseService.mouseDown$),this._mapMouseEvent$(i.Viewer.mousemove,t),this._mapMouseEvent$(i.Viewer.mouseout,this._container.mouseService.mouseOut$),this._mapMouseEvent$(i.Viewer.mouseover,this._container.mouseService.mouseOver$),this._mapMouseEvent$(i.Viewer.mouseup,this._container.mouseService.mouseUp$)).pipe(c.withLatestFrom(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$),c.map(function(t){var e=t[0],r=e[0],n=e[1],i=t[1],o=t[2],a=t[3],s=u._projection.eventToUnprojection(n,u._container.element,i,o,a);return{basicPoint:s.basicPoint,latLon:s.latLon,originalEvent:n,pixelPoint:s.pixelPoint,target:u._eventEmitter,type:r}})).subscribe(function(t){u._eventEmitter.fire(t.type,t)}),this._positionSubscription=this._container.renderService.renderCamera$.pipe(c.distinctUntilChanged(function(t,e){var r=t[0],n=t[1],i=e[0],o=e[1];return u._closeTo(r,i,.01)&&u._closeTo(n,o,.01)},function(t){return t.camera.position.toArray()})).subscribe(function(){u._eventEmitter.fire(i.Viewer.positionchanged,{target:u._eventEmitter,type:i.Viewer.positionchanged})}),this._povSubscription=this._container.renderService.renderCamera$.pipe(c.distinctUntilChanged(function(t,e){var r=t[0],n=t[1],i=e[0],o=e[1];return u._closeTo(r,i,.001)&&u._closeTo(n,o,.001)},function(t){return[t.rotation.phi,t.rotation.theta]})).subscribe(function(){u._eventEmitter.fire(i.Viewer.povchanged,{target:u._eventEmitter,type:i.Viewer.povchanged})}),this._fovSubscription=this._container.renderService.renderCamera$.pipe(c.distinctUntilChanged(function(t,e){return u._closeTo(t,e,.01)},function(t){return t.perspective.fov})).subscribe(function(){u._eventEmitter.fire(i.Viewer.fovchanged,{target:u._eventEmitter,type:i.Viewer.fovchanged})})}},o.prototype.stopEmit=function(){this.started&&(this._started=!1,this._bearingSubscription.unsubscribe(),this._currentNodeSubscription.unsubscribe(),this._fovSubscription.unsubscribe(),this._moveSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._povSubscription.unsubscribe(),this._sequenceEdgesSubscription.unsubscribe(),this._spatialEdgesSubscription.unsubscribe(),this._viewerMouseEventSubscription.unsubscribe(),this._bearingSubscription=null,this._currentNodeSubscription=null,this._fovSubscription=null,this._moveSubscription=null,this._positionSubscription=null,this._povSubscription=null,this._sequenceEdgesSubscription=null,this._spatialEdgesSubscription=null,this._viewerMouseEventSubscription=null)},o.prototype.unproject$=function(i){var o=this;return s.combineLatest(this._container.renderService.renderCamera$,this._navigator.stateService.reference$,this._navigator.stateService.currentTransform$).pipe(c.first(),c.map(function(t){var e=t[0],r=t[1],n=t[2];return o._projection.canvasToUnprojection(i,o._container.element,e,r,n).latLon}))},o.prototype.unprojectBasic$=function(n){var i=this;return s.combineLatest(this._container.renderService.renderCamera$,this._navigator.stateService.currentTransform$).pipe(c.first(),c.map(function(t){var e=t[0],r=t[1];return i._projection.canvasToBasic(n,i._container.element,e,r)}))},o.prototype._closeTo=function(t,e,r){return Math.abs(t-e)<=r},o.prototype._mapMouseEvent$=function(e,t){return t.pipe(c.map(function(t){return[e,t]}))},o);function o(t,e,r){var n=this;this._container=r,this._eventEmitter=t,this._navigator=e,this._projection=new i.Projection,this._started=!1,this._navigable$=new s.Subject,this._navigable$.subscribe(function(t){n._eventEmitter.fire(i.Viewer.navigablechanged,t)}),this._navigator.loadingService.loading$.subscribe(function(t){n._eventEmitter.fire(i.Viewer.loadingchanged,t)})}r.Observer=n,r.default=n},{"../Viewer":302,rxjs:43,"rxjs/operators":241}],467:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s,n,u=t("rxjs"),c=t("rxjs/operators"),O=t("../geo/Geo"),l=t("../geo/GeoCoords"),h=t("../graph/GraphCalculator"),p=t("../geo/Spatial"),i=t("../geo/Transform"),f=t("../geo/ViewportCoords");(n=s=s||{})[n.Disabled=0]="Disabled",n[n.Enabled=1]="Enabled",n[n.Started=2]="Started";var o=(Object.defineProperty(a.prototype,"panNodes$",{get:function(){return this._panNodes$},enumerable:!0,configurable:!0}),a.prototype.enable=function(){this._mode===s.Disabled&&(this._mode=s.Enabled,this.start())},a.prototype.disable=function(){this._mode!==s.Disabled&&(this.stop(),this._mode=s.Disabled)},a.prototype.start=function(){var P=this;if(this._mode===s.Enabled){var e=this._stateService.currentNode$.pipe(c.switchMap(function(o){if(!o.merged)return u.of([]);var t=u.of(o),e=P._graphCalculator.boundingBoxCorners(o.latLon,20),r=P._graphService.cacheBoundingBox$(e[0],e[1]).pipe(c.catchError(function(t){return console.error("Failed to cache periphery bounding box ("+o.key+")",t),u.empty()}),c.map(function(t){if(o.pano)return[];for(var e=[],r=0,n=t;r<n.length;r++){var i=n[r];i.key!==o.key&&i.mergeCC===o.mergeCC&&(i.pano||4<P._distance(i,o)||e.push(i))}return e}));return u.combineLatest(t,r).pipe(c.withLatestFrom(P._stateService.reference$),c.map(function(t){for(var e=t[0],r=e[0],n=e[1],i=t[1],o=P._spatial.viewingDirection(r.rotation),a=O.computeTranslation({lat:r.latLon.lat,lon:r.latLon.lon,alt:r.alt},r.rotation,i),s=P._createTransform(r,a),u=P._spatial.wrap(P._spatial.azimuthal(o.toArray(),s.upVector().toArray()),0,2*Math.PI),c=P._computeProjectedPoints(s),l=P._computeHorizontalFov(c)/180*Math.PI,h=Math.PI/8,p=void 0,f=void 0,d=0,m=n;d<m.length;d++){var g=m[d],y=O.computeTranslation({lat:g.latLon.lat,lon:g.latLon.lon,alt:g.alt},g.rotation,i),v=P._createTransform(g,y),_=P._computeProjectedPoints(v),b=P._computeHorizontalFov(_)/180*Math.PI,x=P._spatial.viewingDirection(g.rotation),w=P._spatial.wrap(P._spatial.azimuthal(x.toArray(),v.upVector().toArray()),0,2*Math.PI),S=P._spatial.angleBetweenVector2(o.x,o.y,x.x,x.y),E=Number.NEGATIVE_INFINITY;E=0<S?w<u?u-2*Math.PI+l/2-(w-b/2):u+l/2-(w-b/2):u<w?w+b/2-(u+2*Math.PI-l/2):w+b/2-(u-l/2);var C=Math.abs(b-E),M=P._distance(g,r)+Math.min(P._timeDifference(g,r),4)+20*Math.abs(E-h)+Math.min(5,1/Math.min(b/l,1))+(0<E?-2*C:0);0<E&&E<.5*l&&E<.5*b&&.5*l<C&&(0<S?p?M<p[0]&&(p=[M,g,v,b]):p=[M,g,v,b]:f?M<f[0]&&(f=[M,g,v,b]):f=[M,g,v,b])}var T=[];return p&&T.push([p[1],p[2],p[3]]),f&&T.push([f[1],f[2],f[3]]),T}),c.startWith([]))}));this._panNodesSubscription=this._stateService.currentState$.pipe(c.map(function(t){return 0<t.state.nodesAhead}),c.distinctUntilChanged(),c.switchMap(function(t){return t?u.of([]):e})).subscribe(function(t){P._panNodesSubject$.next(t)}),this._mode=s.Started}},a.prototype.stop=function(){this._mode===s.Started&&(this._panNodesSubscription.unsubscribe(),this._panNodesSubject$.next([]),this._mode=s.Enabled)},a.prototype._distance=function(t,e){var r=this._geoCoords.geodeticToEnu(t.latLon.lat,t.latLon.lon,t.alt,e.latLon.lat,e.latLon.lon,e.alt),n=r[0],i=r[1],o=r[2];return Math.sqrt(n*n+i*i+o*o)},a.prototype._timeDifference=function(t,e){return Math.abs(t.capturedAt-e.capturedAt)/2592e6},a.prototype._createTransform=function(t,e){return new i.Transform(t.orientation,t.width,t.height,t.focal,t.scale,t.gpano,t.rotation,e,t.assetsCached?t.image:void 0,void 0,t.ck1,t.ck2,t.cameraProjection)},a.prototype._computeProjectedPoints=function(t){return O.computeProjectedPoints(t,[[1,0]],[[0,.5]],20,this._viewportCoords)},a.prototype._computeHorizontalFov=function(t){var e=this,r=t.map(function(t){return e._coordToFov(t[0])});return Math.min.apply(Math,r)},a.prototype._coordToFov=function(t){return 2*Math.atan(t)*180/Math.PI},a);function a(t,e,r,n,i,o,a){this._graphService=t,this._stateService=e,this._geoCoords=n||new l.default,this._graphCalculator=i||new h.default(this._geoCoords),this._spatial=o||new p.default,this._viewportCoords=a||new f.default,this._mode=!1!==r?s.Enabled:s.Disabled,this._panNodesSubject$=new u.Subject,this._panNodes$=this._panNodesSubject$.pipe(c.startWith([]),c.publishReplay(1),c.refCount()),this._panNodes$.subscribe()}r.PanService=o},{"../geo/Geo":409,"../geo/GeoCoords":410,"../geo/Spatial":412,"../geo/Transform":413,"../geo/ViewportCoords":414,"../graph/GraphCalculator":417,rxjs:43,"rxjs/operators":241}],468:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var h=t("rxjs"),p=t("rxjs/operators"),s=t("../Edge"),u=t("../Graph"),n=(Object.defineProperty(i.prototype,"playing",{get:function(){return this._playing},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"direction$",{get:function(){return this._direction$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playing$",{get:function(){return this._playing$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"speed$",{get:function(){return this._speed$},enumerable:!0,configurable:!0}),i.prototype.play=function(){var l=this;if(!this._playing){this._stateService.cutNodes();var t=this._setSpeed(this._speed);this._stateService.setSpeed(t),this._graphModeSubscription=this._speed$.pipe(p.map(function(t){return i.sequenceSpeed<t?u.GraphMode.Sequence:u.GraphMode.Spatial}),p.distinctUntilChanged()).subscribe(function(t){l._graphService.setGraphMode(t)}),this._cacheSubscription=h.combineLatest(this._stateService.currentNode$.pipe(p.map(function(t){return[t.sequenceKey,t.key]}),p.distinctUntilChanged(void 0,function(t){var e=t[0];return t[1],e})),this._graphService.graphMode$,this._direction$).pipe(p.switchMap(function(t){var e=t[0],r=e[0],n=e[1],i=t[1],o=t[2];if(o!==s.EdgeDirection.Next&&o!==s.EdgeDirection.Prev)return h.of([void 0,o]);var a=(i===u.GraphMode.Sequence?l._graphService.cacheSequenceNodes$(r,n):l._graphService.cacheSequence$(r)).pipe(p.retry(3),p.catchError(function(t){return console.error(t),h.of(void 0)}));return h.combineLatest(a,h.of(o))}),p.switchMap(function(t){var e=t[0],r=t[1];if(void 0===e)return h.empty();var c=e.keys.slice();return r===s.EdgeDirection.Prev&&c.reverse(),l._stateService.currentState$.pipe(p.map(function(t){return[t.state.trajectory[t.state.trajectory.length-1].key,t.state.nodesAhead]}),p.scan(function(t,e){var r=t[0],n=(t[1],e[0]),i=e[1];void 0===r&&(r=n);var o=c.length-1;if(i>=l._nodesAhead||c[o]===r)return[r,[]];var a=c.indexOf(n),s=c.indexOf(r)+1,u=Math.min(o,a+l._nodesAhead-i)+1;return u<=s?[r,[]]:[c[u-1],c.slice(s,u)]},[void 0,[]]),p.mergeMap(function(t){t[0];var e=t[1];return h.from(e)}))}),p.mergeMap(function(t){return l._graphService.cacheNode$(t).pipe(p.catchError(function(){return h.empty()}))},6)).subscribe(),this._playingSubscription=this._stateService.currentState$.pipe(p.filter(function(t){return t.state.nodesAhead<l._nodesAhead}),p.distinctUntilChanged(void 0,function(t){return t.state.lastNode.key}),p.map(function(t){for(var e=t.state.lastNode,r=t.state.trajectory,n=void 0,i=r.length-2;0<=i;i--){var o=r[i];if(o.sequenceKey!==e.sequenceKey)break;if(o.capturedAt!==e.capturedAt){n=o.capturedAt<e.capturedAt;break}}return[t.state.lastNode,n]}),p.withLatestFrom(this._direction$),p.switchMap(function(t){var e=t[0],r=e[0],n=e[1],i=t[1];return h.zip((-1<[s.EdgeDirection.Next,s.EdgeDirection.Prev].indexOf(i)?r.sequenceEdges$:r.spatialEdges$).pipe(p.first(function(t){return t.cached}),p.timeout(15e3)),h.of(i)).pipe(p.map(function(t){for(var e=t[0],r=t[1],n=0,i=e.edges;n<i.length;n++){var o=i[n];if(o.data.direction===r)return o.to}return null}),p.switchMap(function(t){return null!=t?l._graphService.cacheNode$(t):l._bridge$(r,n).pipe(p.filter(function(t){return!!t}))}))})).subscribe(function(t){l._stateService.appendNodes([t])},function(t){console.error(t),l.stop()}),this._clearSubscription=this._stateService.currentNode$.pipe(p.bufferCount(1,10)).subscribe(function(t){l._stateService.clearPriorNodes()}),this._setPlaying(!0);var e=this._stateService.currentState$.pipe(p.map(function(t){return t.state}),p.distinctUntilChanged(function(t,e){var r=t[0],n=t[1],i=e[0],o=e[1];return r===i&&n===o},function(t){return[t.currentNode.key,t.lastNode.key]}),p.filter(function(t){return t.currentNode.key===t.lastNode.key&&t.currentIndex===t.trajectory.length-1}),p.map(function(t){return t.currentNode}));this._stopSubscription=h.combineLatest(e,this._direction$).pipe(p.switchMap(function(t){var e=t[0],r=t[1],n=(-1<[s.EdgeDirection.Next,s.EdgeDirection.Prev].indexOf(r)?e.sequenceEdges$:e.spatialEdges$).pipe(p.first(function(t){return t.cached}),p.timeout(15e3),p.catchError(function(t){return console.error(t),h.of({cached:!1,edges:[]})}));return h.combineLatest(h.of(r),n).pipe(p.map(function(t){for(var e=t[0],r=0,n=t[1].edges;r<n.length;r++)if(n[r].data.direction===e)return!0;return!1}))}),p.mergeMap(function(t){return t||!l._bridging$?h.of(t):l._bridging$.pipe(p.map(function(t){return null!=t}),p.catchError(function(t){return console.error(t),h.of(!1)}))}),p.first(function(t){return!t})).subscribe(void 0,void 0,function(){l.stop()}),this._stopSubscription.closed&&(this._stopSubscription=null)}},i.prototype.setDirection=function(t){this._directionSubject$.next(t)},i.prototype.setSpeed=function(t){if((t=Math.max(0,Math.min(1,t)))!==this._speed){var e=this._setSpeed(t);this._playing&&this._stateService.setSpeed(e),this._speedSubject$.next(this._speed)}},i.prototype.stop=function(){this._playing&&(this._stopSubscription&&(this._stopSubscription.closed||this._stopSubscription.unsubscribe(),this._stopSubscription=null),this._graphModeSubscription.unsubscribe(),this._graphModeSubscription=null,this._cacheSubscription.unsubscribe(),this._cacheSubscription=null,this._playingSubscription.unsubscribe(),this._playingSubscription=null,this._clearSubscription.unsubscribe(),this._clearSubscription=null,this._stateService.setSpeed(1),this._stateService.cutNodes(),this._graphService.setGraphMode(u.GraphMode.Spatial),this._setPlaying(!1))},i.prototype._bridge$=function(a,s){var u=this;if(void 0===s)return h.of(null);var t=this._graphCalculator.boundingBoxCorners(a.latLon,25);return this._bridging$=this._graphService.cacheBoundingBox$(t[0],t[1]).pipe(p.mergeMap(function(t){for(var e=null,r=0,n=t;r<n.length;r++){var i=n[r];if(i.sequenceKey!==a.sequenceKey&&i.cameraUuid&&i.cameraUuid===a.cameraUuid&&i.capturedAt!==a.capturedAt&&i.capturedAt>a.capturedAt===s){var o=Math.abs(i.capturedAt-a.capturedAt);15e3<o||(!e||o<Math.abs(e.capturedAt-a.capturedAt))&&(e=i)}}return e?u._graphService.cacheNode$(e.key):h.of(null)}),p.finalize(function(){u._bridging$=null}),p.publish(),p.refCount()),this._bridging$},i.prototype._mapSpeed=function(t){var e=2*t-1;return Math.pow(10,e)-.2*e},i.prototype._mapNodesAhead=function(t){return Math.round(Math.max(10,Math.min(50,8+6*t)))},i.prototype._setPlaying=function(t){this._playing=t,this._playingSubject$.next(t)},i.prototype._setSpeed=function(t){this._speed=t;var e=this._mapSpeed(this._speed);return this._nodesAhead=this._mapNodesAhead(e),e},i.sequenceSpeed=.54,i);function i(t,e,r){this._graphService=t,this._stateService=e,this._graphCalculator=r||new u.GraphCalculator,this._directionSubject$=new h.Subject,this._direction$=this._directionSubject$.pipe(p.startWith(s.EdgeDirection.Next),p.publishReplay(1),p.refCount()),this._direction$.subscribe(),this._playing=!1,this._playingSubject$=new h.Subject,this._playing$=this._playingSubject$.pipe(p.startWith(this._playing),p.publishReplay(1),p.refCount()),this._playing$.subscribe(),this._speed=.5,this._speedSubject$=new h.Subject,this._speed$=this._speedSubject$.pipe(p.startWith(this._speed),p.publishReplay(1),p.refCount()),this._speed$.subscribe(),this._nodesAhead=this._mapNodesAhead(this._mapSpeed(this._speed)),this._bridging$=null}r.PlayService=n,r.default=n},{"../Edge":292,"../Graph":295,rxjs:43,"rxjs/operators":241}],469:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var y=t("three"),n=t("../Geo"),i=t("../geo/Spatial"),o=(a.prototype.basicToCanvas=function(t,e,r,n){return this._viewportCoords.basicToCanvasSafe(t[0],t[1],e,n,r.perspective)},a.prototype.canvasToBasic=function(t,e,r,n){var i=this._viewportCoords.canvasToBasic(t[0],t[1],e,n,r.perspective);return(i[0]<0||1<i[0]||i[1]<0||1<i[1])&&(i=null),i},a.prototype.eventToUnprojection=function(t,e,r,n,i){var o=this._viewportCoords.canvasPosition(t,e);return this.canvasToUnprojection(o,e,r,n,i)},a.prototype.canvasToUnprojection=function(t,e,r,n,i){var o=t[0],a=t[1],s=this._viewportCoords.canvasToViewport(o,a,e),u=s[0],c=s[1],l=new y.Vector3(u,c,1).unproject(r.perspective),h=i.projectBasic(l.toArray());(h[0]<0||1<h[0]||h[1]<0||1<h[1])&&(h=null);var p=l.clone().sub(r.camera.position).normalize(),f=-2/p.z,d=null;if(0<f&&f<100&&h){var m=p.clone().multiplyScalar(f).add(r.camera.position),g=this._geoCoords.enuToGeodetic(m.x,m.y,m.z,n.lat,n.lon,n.alt).slice(0,2);d={lat:g[0],lon:g[1]}}return{basicPoint:h,latLon:d,pixelPoint:[o,a]}},a.prototype.cameraToLatLon=function(t,e){var r=t.camera.position,n=this._geoCoords.enuToGeodetic(r.x,r.y,r.z,e.lat,e.lon,e.alt);return{lat:n[0],lon:n[1]}},a.prototype.latLonToCanvas=function(t,e,r,n){var i=this._geoCoords.geodeticToEnu(t.lat,t.lon,0,n.lat,n.lon,n.alt);return this._viewportCoords.projectToCanvasSafe(i,e,r.perspective)},a.prototype.distanceBetweenLatLons=function(t,e){return this._spatial.distanceFromLatLon(t.lat,t.lon,e.lat,e.lon)},a);function a(t,e,r){this._geoCoords=t||new n.GeoCoords,this._spatial=r||new i.default,this._viewportCoords=e||new n.ViewportCoords}r.Projection=o,r.default=o},{"../Geo":294,"../geo/Spatial":412,three:242}],470:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("rxjs/operators"),a=t("three"),f=t("virtual-dom"),s=t("rxjs"),d=t("../Viewer"),u=(Object.defineProperty(n.prototype,"json",{set:function(t){this._json=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"image",{set:function(t){this._image=t,this._texture=new a.Texture(this._image),this._texture.minFilter=a.NearestFilter},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loaded",{get:function(){return!(!this._image||!this._json)},enumerable:!0,configurable:!0}),n.prototype.getGLSprite=function(t){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");var e=this._json[t];if(!e)return console.warn("Sprite with key"+t+"does not exist in sprite definition."),new a.Object3D;var r=this._texture.clone();r.needsUpdate=!0;var n=this._image.width,i=this._image.height;r.offset.x=e.x/n,r.offset.y=(i-e.y-e.height)/i,r.repeat.x=e.width/n,r.repeat.y=e.height/i;var o=new a.SpriteMaterial({map:r});return new a.Sprite(o)},n.prototype.getDOMSprite=function(t,e){if(!this.loaded)throw new Error("Sprites cannot be retrieved before the atlas is loaded.");null==e&&(e=d.Alignment.Center);var r=this._json[t];if(!r)return console.warn("Sprite with key"+t+"does not exist in sprite definition."),f.h("div",{},[]);var n=r.y,i=r.x+r.width,o=r.y+r.height,a=r.x,s=-r.x,u=-r.y,c=this._image.height,l=this._image.width;switch(e){case d.Alignment.Bottom:case d.Alignment.Center:case d.Alignment.Top:s-=r.width/2;break;case d.Alignment.BottomLeft:case d.Alignment.Left:case d.Alignment.TopLeft:s-=r.width;break;case d.Alignment.BottomRight:case d.Alignment.Right:case d.Alignment.TopRight:}switch(e){case d.Alignment.Center:case d.Alignment.Left:case d.Alignment.Right:u-=r.height/2;break;case d.Alignment.Top:case d.Alignment.TopLeft:case d.Alignment.TopRight:u-=r.height;break;case d.Alignment.Bottom:case d.Alignment.BottomLeft:case d.Alignment.BottomRight:}var h=1/r.pixelRatio;n*=h,i*=h,o*=h,a*=h,s*=h,u*=h,c*=h,l*=h;var p={src:this._image.src,style:{clip:"rect("+n+"px, "+i+"px, "+o+"px, "+a+"px)",height:c+"px",left:s+"px",position:"absolute",top:u+"px",width:l+"px"}};return f.h("img",p,[])},n);function n(){}var i=(Object.defineProperty(c.prototype,"spriteAtlas$",{get:function(){return this._spriteAtlas$},enumerable:!0,configurable:!0}),c);function c(e){var r=this;if(this._retina=1<window.devicePixelRatio,this._spriteAtlasOperation$=new s.Subject,this._spriteAtlas$=this._spriteAtlasOperation$.pipe(o.startWith(function(t){return t}),o.scan(function(t,e){return e(t)},new u),o.publishReplay(1),o.refCount()),this._spriteAtlas$.subscribe(function(){}),null!=e){var n=this._retina?"@2x":"",i=new XMLHttpRequest;i.open("GET",e+n+".png",!0),i.responseType="arraybuffer",i.onload=function(){var e=new Image;e.onload=function(){r._spriteAtlasOperation$.next(function(t){return t.image=e,t})};var t=new Blob([i.response]);e.src=window.URL.createObjectURL(t)},i.onerror=function(t){console.error(new Error("Failed to fetch sprite sheet ("+e+n+".png)"))},i.send();var t=new XMLHttpRequest;t.open("GET",e+n+".json",!0),t.responseType="text",t.onload=function(){var e=JSON.parse(t.response);r._spriteAtlasOperation$.next(function(t){return t.json=e,t})},t.onerror=function(t){console.error(new Error("Failed to fetch sheet ("+e+n+".json)"))},t.send()}}r.SpriteService=i,r.default=i},{"../Viewer":302,rxjs:43,"rxjs/operators":241,three:242,"virtual-dom":247}],471:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var u=t("rxjs"),c=t("rxjs/operators"),n=(Object.defineProperty(i.prototype,"active$",{get:function(){return this._active$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"activate$",{get:function(){return this._activeSubject$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"doubleTap$",{get:function(){return this._doubleTap$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"touchStart$",{get:function(){return this._touchStart$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"touchMove$",{get:function(){return this._touchMove$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"touchEnd$",{get:function(){return this._touchEnd$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"touchCancel$",{get:function(){return this._touchCancel$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"singleTouchDragStart$",{get:function(){return this._singleTouchDragStart$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"singleTouchDrag$",{get:function(){return this._singleTouchDrag$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"singleTouchDragEnd$",{get:function(){return this._singleTouchDragEnd$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pinch$",{get:function(){return this._pinchChange$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pinchStart$",{get:function(){return this._pinchStart$},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pinchEnd$",{get:function(){return this._pinchEnd$},enumerable:!0,configurable:!0}),i);function i(t,e){var r=this;this._activeSubject$=new u.BehaviorSubject(!1),this._active$=this._activeSubject$.pipe(c.distinctUntilChanged(),c.publishReplay(1),c.refCount()),u.fromEvent(e,"touchmove").subscribe(function(t){t.preventDefault()}),this._touchStart$=u.fromEvent(t,"touchstart"),this._touchMove$=u.fromEvent(t,"touchmove"),this._touchEnd$=u.fromEvent(t,"touchend"),this._touchCancel$=u.fromEvent(t,"touchcancel");var n=this._touchStart$.pipe(c.filter(function(t){return 1===t.touches.length&&1===t.targetTouches.length}),c.share());this._doubleTap$=n.pipe(c.bufferWhen(function(){return n.pipe(c.first(),c.switchMap(function(t){return u.merge(u.timer(300),n).pipe(c.take(1))}))}),c.filter(function(t){return 2===t.length}),c.map(function(t){return t[t.length-1]}),c.share()),this._doubleTap$.subscribe(function(t){t.preventDefault()}),this._singleTouchMove$=this._touchMove$.pipe(c.filter(function(t){return 1===t.touches.length&&1===t.targetTouches.length}),c.share());var i=u.merge(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(c.filter(function(t){return 1===t.touches.length&&1===t.targetTouches.length})),o=u.merge(this._touchStart$,this._touchEnd$,this._touchCancel$).pipe(c.filter(function(t){return 1<=t.touches.length})),a=u.merge(this._touchEnd$,this._touchCancel$).pipe(c.filter(function(t){return 0===t.touches.length}));this._singleTouchDragStart$=i.pipe(c.mergeMap(function(t){return r._singleTouchMove$.pipe(c.takeUntil(u.merge(a,o)),c.take(1))})),this._singleTouchDragEnd$=i.pipe(c.mergeMap(function(t){return u.merge(a,o).pipe(c.first())})),this._singleTouchDrag$=i.pipe(c.switchMap(function(t){return r._singleTouchMove$.pipe(c.skip(1),c.takeUntil(u.merge(o,a)))}));var s=u.merge(this._touchStart$,this._touchEnd$,this._touchCancel$);this._pinchStart$=s.pipe(c.filter(function(t){return 2===t.touches.length&&2===t.targetTouches.length})),this._pinchEnd$=s.pipe(c.filter(function(t){return 2!==t.touches.length||2!==t.targetTouches.length})),this._pinchOperation$=new u.Subject,this._pinch$=this._pinchOperation$.pipe(c.scan(function(t,e){return e(t)},{changeX:0,changeY:0,clientX:0,clientY:0,distance:0,distanceChange:0,distanceX:0,distanceY:0,originalEvent:null,pageX:0,pageY:0,screenX:0,screenY:0,touch1:null,touch2:null})),this._touchMove$.pipe(c.filter(function(t){return 2===t.touches.length&&2===t.targetTouches.length}),c.map(function(g){return function(t){var e=g.touches[0],r=g.touches[1],n=Math.min(e.clientX,r.clientX),i=Math.max(e.clientX,r.clientX),o=Math.min(e.clientY,r.clientY),a=n+(i-n)/2,s=o+(Math.max(e.clientY,r.clientY)-o)/2,u=a+e.pageX-e.clientX,c=s+e.pageY-e.clientY,l=a+e.screenX-e.clientX,h=s+e.screenY-e.clientY,p=Math.abs(e.clientX-r.clientX),f=Math.abs(e.clientY-r.clientY),d=Math.sqrt(p*p+f*f),m=d-t.distance;return{changeX:p-t.distanceX,changeY:f-t.distanceY,clientX:a,clientY:s,distance:d,distanceChange:m,distanceX:p,distanceY:f,originalEvent:g,pageX:u,pageY:c,screenX:l,screenY:h,touch1:e,touch2:r}}})).subscribe(this._pinchOperation$),this._pinchChange$=this._pinchStart$.pipe(c.switchMap(function(t){return r._pinch$.pipe(c.skip(1),c.takeUntil(r._pinchEnd$))}))}r.TouchService=n},{rxjs:43,"rxjs/operators":241}],472:[function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(r,"__esModule",{value:!0});var a,o=t("rxjs"),s=t("rxjs/operators"),u=t("when"),c=t("../Viewer"),l=t("../Utils"),h=(a=l.EventEmitter,i(p,a),Object.defineProperty(p.prototype,"isNavigable",{get:function(){return this._componentController.navigable},enumerable:!0,configurable:!0}),p.prototype.activateCombinedPanning=function(){this._navigator.panService.enable()},p.prototype.activateComponent=function(t){this._componentController.activate(t)},p.prototype.activateCover=function(){this._componentController.activateCover()},p.prototype.deactivateCombinedPanning=function(){this._navigator.panService.disable()},p.prototype.deactivateComponent=function(t){this._componentController.deactivate(t)},p.prototype.deactivateCover=function(){this._componentController.deactivateCover()},p.prototype.getBearing=function(){var t=this;return u.promise(function(e,r){t._container.renderService.bearing$.pipe(s.first()).subscribe(function(t){e(t)},function(t){r(t)})})},p.prototype.getCanvasContainer=function(){return this._container.canvasContainer},p.prototype.getCenter=function(){var t=this;return u.promise(function(e,r){t._navigator.stateService.getCenter().subscribe(function(t){e(t)},function(t){r(t)})})},p.prototype.getComponent=function(t){return this._componentController.get(t)},p.prototype.getContainer=function(){return this._container.element},p.prototype.getFieldOfView=function(){var t=this;return u.promise(function(e,r){t._container.renderService.renderCamera$.pipe(s.first()).subscribe(function(t){e(t.perspective.fov)},function(t){r(t)})})},p.prototype.getPointOfView=function(){var t=this;return u.promise(function(n,e){o.combineLatest(t._container.renderService.renderCamera$,t._container.renderService.bearing$).pipe(s.first()).subscribe(function(t){var e=t[0],r=t[1];n({bearing:r,tilt:e.getTilt()})},function(t){e(t)})})},p.prototype.getPosition=function(){var i=this;return u.promise(function(n,e){o.combineLatest(i._container.renderService.renderCamera$,i._navigator.stateService.reference$).pipe(s.first()).subscribe(function(t){var e=t[0],r=t[1];n(i._observer.projection.cameraToLatLon(e,r))},function(t){e(t)})})},p.prototype.getZoom=function(){var t=this;return u.promise(function(e,r){t._navigator.stateService.getZoom().subscribe(function(t){e(t)},function(t){r(t)})})},p.prototype.moveCloseTo=function(t,e){var n=this.isNavigable?this._navigator.moveCloseTo$(t,e):o.throwError(new Error("Calling moveCloseTo is not supported when viewer is not navigable."));return u.promise(function(e,r){n.subscribe(function(t){e(t)},function(t){r(t)})})},p.prototype.moveDir=function(t){var n=this.isNavigable?this._navigator.moveDir$(t):o.throwError(new Error("Calling moveDir is not supported when viewer is not navigable."));return u.promise(function(e,r){n.subscribe(function(t){e(t)},function(t){r(t)})})},p.prototype.moveToKey=function(t){var n=this.isNavigable?this._navigator.moveToKey$(t):o.throwError(new Error("Calling moveToKey is not supported when viewer is not navigable."));return u.promise(function(e,r){n.subscribe(function(t){e(t)},function(t){r(t)})})},p.prototype.project=function(t){var n=this;return u.promise(function(e,r){n._observer.project$(t).subscribe(function(t){e(t)},function(t){r(t)})})},p.prototype.projectFromBasic=function(t){var n=this;return u.promise(function(e,r){n._observer.projectBasic$(t).subscribe(function(t){e(t)},function(t){r(t)})})},p.prototype.resize=function(){this._container.renderService.resize$.next(null)},p.prototype.setAuthToken=function(t){var r=this.isNavigable?this._navigator.setToken$(t):o.throwError(new Error("Calling setAuthToken is not supported when viewer is not navigable."));return u.promise(function(t,e){r.subscribe(function(){t(void 0)},function(t){e(t)})})},p.prototype.setCenter=function(t){this._navigator.stateService.setCenter(t)},p.prototype.setFilter=function(r){var n=this;return u.promise(function(t,e){n._navigator.setFilter$(r).subscribe(function(){t(void 0)},function(t){e(t)})})},p.prototype.setFieldOfView=function(r){var n=this;this._container.renderService.renderCamera$.pipe(s.first()).subscribe(function(t){var e=t.fovToZoom(r);n._navigator.stateService.setZoom(e)})},p.prototype.setRenderMode=function(t){this._container.renderService.renderMode$.next(t)},p.prototype.setTransitionMode=function(t){this._navigator.stateService.setTransitionMode(t)},p.prototype.setZoom=function(t){this._navigator.stateService.setZoom(t)},p.prototype.unproject=function(t){var n=this;return u.promise(function(e,r){n._observer.unproject$(t).subscribe(function(t){e(t)},function(t){r(t)})})},p.prototype.unprojectToBasic=function(t){var n=this;return u.promise(function(e,r){n._observer.unprojectBasic$(t).subscribe(function(t){e(t)},function(t){r(t)})})},p.bearingchanged="bearingchanged",p.click="click",p.contextmenu="contextmenu",p.dblclick="dblclick",p.fovchanged="fovchanged",p.loadingchanged="loadingchanged",p.mousedown="mousedown",p.mousemove="mousemove",p.mouseout="mouseout",p.mouseover="mouseover",p.mouseup="mouseup",p.moveend="moveend",p.movestart="movestart",p.navigablechanged="navigablechanged",p.nodechanged="nodechanged",p.positionchanged="positionchanged",p.povchanged="povchanged",p.sequenceedgeschanged="sequenceedgeschanged",p.spatialedgeschanged="spatialedgeschanged",p);function p(t,e,r,n,i){var o=a.call(this)||this;return n=null!=n?n:{},l.Settings.setOptions(n),l.Urls.setOptions(n.url),o._navigator=new c.Navigator(e,n,i),o._container=new c.Container(t,o._navigator.stateService,n),o._observer=new c.Observer(o,o._navigator,o._container),o._componentController=new c.ComponentController(o._container,o._navigator,o._observer,r,n.component),o}r.Viewer=h},{"../Utils":301,"../Viewer":302,rxjs:43,"rxjs/operators":241,when:288}]},{},[296])(296)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(t,r,n){(function(Q){var t,e;t=this,e=function(){"use strict";var r="undefined"!=typeof window&&"undefined"!=typeof document&&"undefined"!=typeof navigator,n=function(){for(var t=["Edge","Trident","Firefox"],e=0;e<t.length;e+=1)if(r&&0<=navigator.userAgent.indexOf(t[e]))return 1;return 0}();var o=r&&window.Promise?function(t){var e=!1;return function(){e||(e=!0,window.Promise.resolve().then(function(){e=!1,t()}))}}:function(t){var e=!1;return function(){e||(e=!0,setTimeout(function(){e=!1,t()},n))}};function a(t){return t&&"[object Function]"==={}.toString.call(t)}function b(t,e){if(1!==t.nodeType)return[];var r=t.ownerDocument.defaultView.getComputedStyle(t,null);return e?r[e]:r}function d(t){return"HTML"===t.nodeName?t:t.parentNode||t.host}function m(t){if(!t)return document.body;switch(t.nodeName){case"HTML":case"BODY":return t.ownerDocument.body;case"#document":return t.body}var e=b(t),r=e.overflow,n=e.overflowX,i=e.overflowY;return/(auto|scroll|overlay)/.test(r+i+n)?t:m(d(t))}function g(t){return t&&t.referenceNode?t.referenceNode:t}var e=r&&!(!window.MSInputMethodContext||!document.documentMode),i=r&&/MSIE 10/.test(navigator.userAgent);function y(t){return 11===t?e:10===t?i:e||i}function _(t){if(!t)return document.documentElement;for(var e=y(10)?document.body:null,r=t.offsetParent||null;r===e&&t.nextElementSibling;)r=(t=t.nextElementSibling).offsetParent;var n=r&&r.nodeName;return n&&"BODY"!==n&&"HTML"!==n?-1!==["TH","TD","TABLE"].indexOf(r.nodeName)&&"static"===b(r,"position")?_(r):r:t?t.ownerDocument.documentElement:document.documentElement}function u(t){return null!==t.parentNode?u(t.parentNode):t}function v(t,e){if(!(t&&t.nodeType&&e&&e.nodeType))return document.documentElement;var r=t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING,n=r?t:e,i=r?e:t,o=document.createRange();o.setStart(n,0),o.setEnd(i,0);var a=o.commonAncestorContainer;if(t!==a&&e!==a||n.contains(i))return function(t){var e=t.nodeName;return"BODY"!==e&&("HTML"===e||_(t.firstElementChild)===t)}(a)?a:_(a);var s=u(t);return s.host?v(s.host,e):v(t,u(e).host)}function x(t,e){var r="top"===(1<arguments.length&&void 0!==e?e:"top")?"scrollTop":"scrollLeft",n=t.nodeName;if("BODY"!==n&&"HTML"!==n)return t[r];var i=t.ownerDocument.documentElement;return(t.ownerDocument.scrollingElement||i)[r]}function h(t,e){var r="x"===e?"Left":"Top",n="Left"==r?"Right":"Bottom";return parseFloat(t["border"+r+"Width"])+parseFloat(t["border"+n+"Width"])}function s(t,e,r,n){return Math.max(e["offset"+t],e["scroll"+t],r["client"+t],r["offset"+t],r["scroll"+t],y(10)?parseInt(r["offset"+t])+parseInt(n["margin"+("Height"===t?"Top":"Left")])+parseInt(n["margin"+("Height"===t?"Bottom":"Right")]):0)}function w(t){var e=t.body,r=t.documentElement,n=y(10)&&getComputedStyle(r);return{height:s("Height",e,r,n),width:s("Width",e,r,n)}}var t=function(t,e,r){return e&&c(t.prototype,e),r&&c(t,r),t};function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function S(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var E=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t};function C(t){return E({},t,{right:t.left+t.width,bottom:t.top+t.height})}function M(t){var e={};try{if(y(10)){e=t.getBoundingClientRect();var r=x(t,"top"),n=x(t,"left");e.top+=r,e.left+=n,e.bottom+=r,e.right+=n}else e=t.getBoundingClientRect()}catch(t){}var i={left:e.left,top:e.top,width:e.right-e.left,height:e.bottom-e.top},o="HTML"===t.nodeName?w(t.ownerDocument):{},a=o.width||t.clientWidth||i.width,s=o.height||t.clientHeight||i.height,u=t.offsetWidth-a,c=t.offsetHeight-s;if(u||c){var l=b(t);u-=h(l,"x"),c-=h(l,"y"),i.width-=u,i.height-=c}return C(i)}function T(t,e,r){var n=2<arguments.length&&void 0!==r&&r,i=y(10),o="HTML"===e.nodeName,a=M(t),s=M(e),u=m(t),c=b(e),l=parseFloat(c.borderTopWidth),h=parseFloat(c.borderLeftWidth);n&&o&&(s.top=Math.max(s.top,0),s.left=Math.max(s.left,0));var p=C({top:a.top-s.top-l,left:a.left-s.left-h,width:a.width,height:a.height});if(p.marginTop=0,p.marginLeft=0,!i&&o){var f=parseFloat(c.marginTop),d=parseFloat(c.marginLeft);p.top-=l-f,p.bottom-=l-f,p.left-=h-d,p.right-=h-d,p.marginTop=f,p.marginLeft=d}return(i&&!n?e.contains(u):e===u&&"BODY"!==u.nodeName)&&(p=function(t,e,r){var n=2<arguments.length&&void 0!==r&&r,i=x(e,"top"),o=x(e,"left"),a=n?-1:1;return t.top+=i*a,t.bottom+=i*a,t.left+=o*a,t.right+=o*a,t}(p,e)),p}function P(t){if(!t||!t.parentElement||y())return document.documentElement;for(var e=t.parentElement;e&&"none"===b(e,"transform");)e=e.parentElement;return e||document.documentElement}function f(t,e,r,n,i){var o=4<arguments.length&&void 0!==i&&i,a={top:0,left:0},s=o?P(t):v(t,g(e));if("viewport"===n)a=function(t,e){var r=1<arguments.length&&void 0!==e&&e,n=t.ownerDocument.documentElement,i=T(t,n),o=Math.max(n.clientWidth,window.innerWidth||0),a=Math.max(n.clientHeight,window.innerHeight||0),s=r?0:x(n),u=r?0:x(n,"left");return C({top:s-i.top+i.marginTop,left:u-i.left+i.marginLeft,width:o,height:a})}(s,o);else{var u=void 0;"scrollParent"===n?"BODY"===(u=m(d(e))).nodeName&&(u=t.ownerDocument.documentElement):u="window"===n?t.ownerDocument.documentElement:n;var c=T(u,s,o);if("HTML"!==u.nodeName||function t(e){var r=e.nodeName;if("BODY"===r||"HTML"===r)return!1;if("fixed"===b(e,"position"))return!0;var n=d(e);return!!n&&t(n)}(s))a=c;else{var l=w(t.ownerDocument),h=l.height,p=l.width;a.top+=c.top-c.marginTop,a.bottom=h+c.top,a.left+=c.left-c.marginLeft,a.right=p+c.left}}var f="number"==typeof(r=r||0);return a.left+=f?r:r.left||0,a.top+=f?r:r.top||0,a.right-=f?r:r.right||0,a.bottom-=f?r:r.bottom||0,a}function l(t,e,n,r,i,o){var a=5<arguments.length&&void 0!==o?o:0;if(-1===t.indexOf("auto"))return t;var s=f(n,r,a,i),u={top:{width:s.width,height:e.top-s.top},right:{width:s.right-e.right,height:s.height},bottom:{width:s.width,height:s.bottom-e.bottom},left:{width:e.left-s.left,height:s.height}},c=Object.keys(u).map(function(t){return E({key:t},u[t],{area:function(t){return t.width*t.height}(u[t])})}).sort(function(t,e){return e.area-t.area}),l=c.filter(function(t){var e=t.width,r=t.height;return e>=n.clientWidth&&r>=n.clientHeight}),h=0<l.length?l[0].key:c[0].key,p=t.split("-")[1];return h+(p?"-"+p:"")}function p(t,e,r,n){var i=3<arguments.length&&void 0!==n?n:null;return T(r,i?P(e):v(e,g(r)),i)}function O(t){var e=t.ownerDocument.defaultView.getComputedStyle(t),r=parseFloat(e.marginTop||0)+parseFloat(e.marginBottom||0),n=parseFloat(e.marginLeft||0)+parseFloat(e.marginRight||0);return{width:t.offsetWidth+n,height:t.offsetHeight+r}}function A(t){var e={left:"right",right:"left",bottom:"top",top:"bottom"};return t.replace(/left|right|bottom|top/g,function(t){return e[t]})}function I(t,e,r){r=r.split("-")[0];var n=O(t),i={width:n.width,height:n.height},o=-1!==["right","left"].indexOf(r),a=o?"top":"left",s=o?"left":"top",u=o?"height":"width",c=o?"width":"height";return i[a]=e[a]+e[u]/2-n[u]/2,i[s]=r===s?e[s]-n[c]:e[A(s)],i}function L(t,e){return Array.prototype.find?t.find(e):t.filter(e)[0]}function R(t,r,e){return(void 0===e?t:t.slice(0,function(t,e,r){if(Array.prototype.findIndex)return t.findIndex(function(t){return t[e]===r});var n=L(t,function(t){return t[e]===r});return t.indexOf(n)}(t,"name",e))).forEach(function(t){t.function&&console.warn("`modifier.function` is deprecated, use `modifier.fn`!");var e=t.function||t.fn;t.enabled&&a(e)&&(r.offsets.popper=C(r.offsets.popper),r.offsets.reference=C(r.offsets.reference),r=e(r,t))}),r}function N(t,r){return t.some(function(t){var e=t.name;return t.enabled&&e===r})}function k(t){for(var e=[!1,"ms","Webkit","Moz","O"],r=t.charAt(0).toUpperCase()+t.slice(1),n=0;n<e.length;n++){var i=e[n],o=i?""+i+r:t;if(void 0!==document.body.style[o])return o}return null}function D(t){var e=t.ownerDocument;return e?e.defaultView:window}function j(t,e,r,n){r.updateBound=n,D(t).addEventListener("resize",r.updateBound,{passive:!0});var i=m(t);return function t(e,r,n,i){var o="BODY"===e.nodeName,a=o?e.ownerDocument.defaultView:e;a.addEventListener(r,n,{passive:!0}),o||t(m(a.parentNode),r,n,i),i.push(a)}(i,"scroll",r.updateBound,r.scrollParents),r.scrollElement=i,r.eventsEnabled=!0,r}function z(){this.state.eventsEnabled&&(cancelAnimationFrame(this.scheduleUpdate),this.state=function(t,e){return D(t).removeEventListener("resize",e.updateBound),e.scrollParents.forEach(function(t){t.removeEventListener("scroll",e.updateBound)}),e.updateBound=null,e.scrollParents=[],e.scrollElement=null,e.eventsEnabled=!1,e}(this.reference,this.state))}function F(t){return""!==t&&!isNaN(parseFloat(t))&&isFinite(t)}function B(r,n){Object.keys(n).forEach(function(t){var e="";-1!==["width","height","top","right","bottom","left"].indexOf(t)&&F(n[t])&&(e="px"),r.style[t]=n[t]+e})}var U=r&&/Firefox/i.test(navigator.userAgent);function V(t,e,r){var n=L(t,function(t){return t.name===e}),i=!!n&&t.some(function(t){return t.name===r&&t.enabled&&t.order<n.order});if(!i){var o="`"+e+"`",a="`"+r+"`";console.warn(a+" modifier is required by "+o+" modifier in order to work, be sure to include it before "+o+"!")}return i}var G=["auto-start","auto","auto-end","top-start","top","top-end","right-start","right","right-end","bottom-end","bottom","bottom-start","left-end","left","left-start"],q=G.slice(3);function H(t,e){var r=1<arguments.length&&void 0!==e&&e,n=q.indexOf(t),i=q.slice(n+1).concat(q.slice(0,n));return r?i.reverse():i}var $="flip",W="clockwise",X="counterclockwise";function Y(t,i,o,e){var a=[0,0],s=-1!==["right","left"].indexOf(e),r=t.split(/(\+|\-)/).map(function(t){return t.trim()}),n=r.indexOf(L(r,function(t){return-1!==t.search(/,|\s/)}));r[n]&&-1===r[n].indexOf(",")&&console.warn("Offsets separated by white space(s) are deprecated, use a comma (,) instead.");var u=/\s*,\s*|\s+/,c=-1!==n?[r.slice(0,n).concat([r[n].split(u)[0]]),[r[n].split(u)[1]].concat(r.slice(n+1))]:[r];return(c=c.map(function(t,e){var r=(1===e?!s:s)?"height":"width",n=!1;return t.reduce(function(t,e){return""===t[t.length-1]&&-1!==["+","-"].indexOf(e)?(t[t.length-1]=e,n=!0,t):n?(t[t.length-1]+=e,n=!1,t):t.concat(e)},[]).map(function(t){return function(t,e,r,n){var i=t.match(/((?:\-|\+)?\d*\.?\d*)(.*)/),o=+i[1],a=i[2];if(!o)return t;if(0!==a.indexOf("%"))return"vh"!==a&&"vw"!==a?o:("vh"===a?Math.max(document.documentElement.clientHeight,window.innerHeight||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0))/100*o;var s=void 0;switch(a){case"%p":s=r;break;case"%":case"%r":default:s=n}return C(s)[e]/100*o}(t,r,i,o)})})).forEach(function(r,n){r.forEach(function(t,e){F(t)&&(a[n]+=t*("-"===r[e-1]?-1:1))})}),a}var Z={placement:"bottom",positionFixed:!1,eventsEnabled:!0,removeOnDestroy:!1,onCreate:function(){},onUpdate:function(){},modifiers:{shift:{order:100,enabled:!0,fn:function(t){var e=t.placement,r=e.split("-")[0],n=e.split("-")[1];if(n){var i=t.offsets,o=i.reference,a=i.popper,s=-1!==["bottom","top"].indexOf(r),u=s?"left":"top",c=s?"width":"height",l={start:S({},u,o[u]),end:S({},u,o[u]+o[c]-a[c])};t.offsets.popper=E({},a,l[n])}return t}},offset:{order:200,enabled:!0,fn:function(t,e){var r=e.offset,n=t.placement,i=t.offsets,o=i.popper,a=i.reference,s=n.split("-")[0],u=void 0;return u=F(+r)?[+r,0]:Y(r,o,a,s),"left"===s?(o.top+=u[0],o.left-=u[1]):"right"===s?(o.top+=u[0],o.left+=u[1]):"top"===s?(o.left+=u[0],o.top-=u[1]):"bottom"===s&&(o.left+=u[0],o.top+=u[1]),t.popper=o,t},offset:0},preventOverflow:{order:300,enabled:!0,fn:function(t,n){var e=n.boundariesElement||_(t.instance.popper);t.instance.reference===e&&(e=_(e));var r=k("transform"),i=t.instance.popper.style,o=i.top,a=i.left,s=i[r];i.top="",i.left="",i[r]="";var u=f(t.instance.popper,t.instance.reference,n.padding,e,t.positionFixed);i.top=o,i.left=a,i[r]=s,n.boundaries=u;var c=n.priority,l=t.offsets.popper,h={primary:function(t){var e=l[t];return l[t]<u[t]&&!n.escapeWithReference&&(e=Math.max(l[t],u[t])),S({},t,e)},secondary:function(t){var e="right"===t?"left":"top",r=l[e];return l[t]>u[t]&&!n.escapeWithReference&&(r=Math.min(l[e],u[t]-("right"===t?l.width:l.height))),S({},e,r)}};return c.forEach(function(t){var e=-1!==["left","top"].indexOf(t)?"primary":"secondary";l=E({},l,h[e](t))}),t.offsets.popper=l,t},priority:["left","right","top","bottom"],padding:5,boundariesElement:"scrollParent"},keepTogether:{order:400,enabled:!0,fn:function(t){var e=t.offsets,r=e.popper,n=e.reference,i=t.placement.split("-")[0],o=Math.floor,a=-1!==["top","bottom"].indexOf(i),s=a?"right":"bottom",u=a?"left":"top",c=a?"width":"height";return r[s]<o(n[u])&&(t.offsets.popper[u]=o(n[u])-r[c]),r[u]>o(n[s])&&(t.offsets.popper[u]=o(n[s])),t}},arrow:{order:500,enabled:!0,fn:function(t,e){var r;if(!V(t.instance.modifiers,"arrow","keepTogether"))return t;var n=e.element;if("string"==typeof n){if(!(n=t.instance.popper.querySelector(n)))return t}else if(!t.instance.popper.contains(n))return console.warn("WARNING: `arrow.element` must be child of its popper element!"),t;var i=t.placement.split("-")[0],o=t.offsets,a=o.popper,s=o.reference,u=-1!==["left","right"].indexOf(i),c=u?"height":"width",l=u?"Top":"Left",h=l.toLowerCase(),p=u?"left":"top",f=u?"bottom":"right",d=O(n)[c];s[f]-d<a[h]&&(t.offsets.popper[h]-=a[h]-(s[f]-d)),s[h]+d>a[f]&&(t.offsets.popper[h]+=s[h]+d-a[f]),t.offsets.popper=C(t.offsets.popper);var m=s[h]+s[c]/2-d/2,g=b(t.instance.popper),y=parseFloat(g["margin"+l]),v=parseFloat(g["border"+l+"Width"]),_=m-t.offsets.popper[h]-y-v;return _=Math.max(Math.min(a[c]-d,_),0),t.arrowElement=n,t.offsets.arrow=(S(r={},h,Math.round(_)),S(r,p,""),r),t},element:"[x-arrow]"},flip:{order:600,enabled:!0,fn:function(m,g){if(N(m.instance.modifiers,"inner"))return m;if(m.flipped&&m.placement===m.originalPlacement)return m;var y=f(m.instance.popper,m.instance.reference,g.padding,g.boundariesElement,m.positionFixed),v=m.placement.split("-")[0],_=A(v),b=m.placement.split("-")[1]||"",x=[];switch(g.behavior){case $:x=[v,_];break;case W:x=H(v);break;case X:x=H(v,!0);break;default:x=g.behavior}return x.forEach(function(t,e){if(v!==t||x.length===e+1)return m;v=m.placement.split("-")[0],_=A(v);var r=m.offsets.popper,n=m.offsets.reference,i=Math.floor,o="left"===v&&i(r.right)>i(n.left)||"right"===v&&i(r.left)<i(n.right)||"top"===v&&i(r.bottom)>i(n.top)||"bottom"===v&&i(r.top)<i(n.bottom),a=i(r.left)<i(y.left),s=i(r.right)>i(y.right),u=i(r.top)<i(y.top),c=i(r.bottom)>i(y.bottom),l="left"===v&&a||"right"===v&&s||"top"===v&&u||"bottom"===v&&c,h=-1!==["top","bottom"].indexOf(v),p=!!g.flipVariations&&(h&&"start"===b&&a||h&&"end"===b&&s||!h&&"start"===b&&u||!h&&"end"===b&&c),f=!!g.flipVariationsByContent&&(h&&"start"===b&&s||h&&"end"===b&&a||!h&&"start"===b&&c||!h&&"end"===b&&u),d=p||f;(o||l||d)&&(m.flipped=!0,(o||l)&&(v=x[e+1]),d&&(b=function(t){return"end"===t?"start":"start"===t?"end":t}(b)),m.placement=v+(b?"-"+b:""),m.offsets.popper=E({},m.offsets.popper,I(m.instance.popper,m.offsets.reference,m.placement)),m=R(m.instance.modifiers,m,"flip"))}),m},behavior:"flip",padding:5,boundariesElement:"viewport",flipVariations:!1,flipVariationsByContent:!1},inner:{order:700,enabled:!1,fn:function(t){var e=t.placement,r=e.split("-")[0],n=t.offsets,i=n.popper,o=n.reference,a=-1!==["left","right"].indexOf(r),s=-1===["top","left"].indexOf(r);return i[a?"left":"top"]=o[r]-(s?i[a?"width":"height"]:0),t.placement=A(e),t.offsets.popper=C(i),t}},hide:{order:800,enabled:!0,fn:function(t){if(!V(t.instance.modifiers,"hide","preventOverflow"))return t;var e=t.offsets.reference,r=L(t.instance.modifiers,function(t){return"preventOverflow"===t.name}).boundaries;if(e.bottom<r.top||e.left>r.right||e.top>r.bottom||e.right<r.left){if(!0===t.hide)return t;t.hide=!0,t.attributes["x-out-of-boundaries"]=""}else{if(!1===t.hide)return t;t.hide=!1,t.attributes["x-out-of-boundaries"]=!1}return t}},computeStyle:{order:850,enabled:!0,fn:function(t,e){var r=e.x,n=e.y,i=t.offsets.popper,o=L(t.instance.modifiers,function(t){return"applyStyle"===t.name}).gpuAcceleration;void 0!==o&&console.warn("WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!");var a=void 0!==o?o:e.gpuAcceleration,s=_(t.instance.popper),u=M(s),c={position:i.position},l=function(t,e){function r(t){return t}var n=t.offsets,i=n.popper,o=n.reference,a=Math.round,s=Math.floor,u=a(o.width),c=a(i.width),l=-1!==["left","right"].indexOf(t.placement),h=-1!==t.placement.indexOf("-"),p=e?l||h||u%2==c%2?a:s:r,f=e?a:r;return{left:p(u%2==1&&c%2==1&&!h&&e?i.left-1:i.left),top:f(i.top),bottom:f(i.bottom),right:p(i.right)}}(t,window.devicePixelRatio<2||!U),h="bottom"===r?"top":"bottom",p="right"===n?"left":"right",f=k("transform"),d=void 0,m=void 0;if(m="bottom"==h?"HTML"===s.nodeName?-s.clientHeight+l.bottom:-u.height+l.bottom:l.top,d="right"==p?"HTML"===s.nodeName?-s.clientWidth+l.right:-u.width+l.right:l.left,a&&f)c[f]="translate3d("+d+"px, "+m+"px, 0)",c[h]=0,c[p]=0,c.willChange="transform";else{var g="bottom"==h?-1:1,y="right"==p?-1:1;c[h]=m*g,c[p]=d*y,c.willChange=h+", "+p}var v={"x-placement":t.placement};return t.attributes=E({},v,t.attributes),t.styles=E({},c,t.styles),t.arrowStyles=E({},t.offsets.arrow,t.arrowStyles),t},gpuAcceleration:!0,x:"bottom",y:"right"},applyStyle:{order:900,enabled:!0,fn:function(t){return B(t.instance.popper,t.styles),function(e,r){Object.keys(r).forEach(function(t){!1!==r[t]?e.setAttribute(t,r[t]):e.removeAttribute(t)})}(t.instance.popper,t.attributes),t.arrowElement&&Object.keys(t.arrowStyles).length&&B(t.arrowElement,t.arrowStyles),t},onLoad:function(t,e,r,n,i){var o=p(i,e,t,r.positionFixed),a=l(r.placement,o,e,t,r.modifiers.flip.boundariesElement,r.modifiers.flip.padding);return e.setAttribute("x-placement",a),B(e,{position:r.positionFixed?"fixed":"absolute"}),r},gpuAcceleration:void 0}}},K=(t(J,[{key:"update",value:function(){return function(){if(!this.state.isDestroyed){var t={instance:this,styles:{},arrowStyles:{},attributes:{},flipped:!1,offsets:{}};t.offsets.reference=p(this.state,this.popper,this.reference,this.options.positionFixed),t.placement=l(this.options.placement,t.offsets.reference,this.popper,this.reference,this.options.modifiers.flip.boundariesElement,this.options.modifiers.flip.padding),t.originalPlacement=t.placement,t.positionFixed=this.options.positionFixed,t.offsets.popper=I(this.popper,t.offsets.reference,t.placement),t.offsets.popper.position=this.options.positionFixed?"fixed":"absolute",t=R(this.modifiers,t),this.state.isCreated?this.options.onUpdate(t):(this.state.isCreated=!0,this.options.onCreate(t))}}.call(this)}},{key:"destroy",value:function(){return function(){return this.state.isDestroyed=!0,N(this.modifiers,"applyStyle")&&(this.popper.removeAttribute("x-placement"),this.popper.style.position="",this.popper.style.top="",this.popper.style.left="",this.popper.style.right="",this.popper.style.bottom="",this.popper.style.willChange="",this.popper.style[k("transform")]=""),this.disableEventListeners(),this.options.removeOnDestroy&&this.popper.parentNode.removeChild(this.popper),this}.call(this)}},{key:"enableEventListeners",value:function(){return function(){this.state.eventsEnabled||(this.state=j(this.reference,this.options,this.state,this.scheduleUpdate))}.call(this)}},{key:"disableEventListeners",value:function(){return z.call(this)}}]),J);function J(t,e){var r=this,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,J),this.scheduleUpdate=function(){return requestAnimationFrame(r.update)},this.update=o(this.update.bind(this)),this.options=E({},J.Defaults,n),this.state={isDestroyed:!1,isCreated:!1,scrollParents:[]},this.reference=t&&t.jquery?t[0]:t,this.popper=e&&e.jquery?e[0]:e,this.options.modifiers={},Object.keys(E({},J.Defaults.modifiers,n.modifiers)).forEach(function(t){r.options.modifiers[t]=E({},J.Defaults.modifiers[t]||{},n.modifiers?n.modifiers[t]:{})}),this.modifiers=Object.keys(this.options.modifiers).map(function(t){return E({name:t},r.options.modifiers[t])}).sort(function(t,e){return t.order-e.order}),this.modifiers.forEach(function(t){t.enabled&&a(t.onLoad)&&t.onLoad(r.reference,r.popper,r.options,t,r.state)}),this.update();var i=this.options.eventsEnabled;i&&this.enableEventListeners(),this.state.eventsEnabled=i}return K.Utils=("undefined"!=typeof window?window:Q).PopperUtils,K.placements=G,K.Defaults=Z,K},"object"==typeof n&&void 0!==r?r.exports=e():"function"==typeof define&&define.amd?define(e):t.Popper=e()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(t,e,r){var n,i,o=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(t){n=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var c,l=[],h=!1,p=-1;function f(){h&&c&&(h=!1,c.length?l=c.concat(l):p=-1,l.length&&d())}function d(){if(!h){var t=u(f);h=!0;for(var e=l.length;e;){for(c=l,l=[];++p<e;)c&&c[p].run();p=-1,e=l.length}c=null,h=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function g(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];l.push(new m(t,e)),1!==l.length||h||u(d)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],9:[function(t,e,r){var n,i;n=this,i=function(o){"use strict";o=o&&o.hasOwnProperty("default")?o.default:o;var t=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t};function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},i={container:!1,delay:0,html:!1,placement:"top",title:"",template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",offset:0,arrowSelector:".tooltip-arrow, .tooltip__arrow",innerSelector:".tooltip-inner, .tooltip__inner"},e=(t(s,[{key:"_create",value:function(t,e,r,n){var i=window.document.createElement("div");i.innerHTML=e.trim();var o=i.childNodes[0];o.id="tooltip_"+Math.random().toString(36).substr(2,10),o.setAttribute("aria-hidden","false");var a=i.querySelector(this.options.innerSelector);return this._addTitleContent(t,r,n,a),o}},{key:"_addTitleContent",value:function(t,e,r,n){1===e.nodeType||11===e.nodeType?r&&n.appendChild(e):function(t){return t&&"[object Function]"==={}.toString.call(t)}(e)?this._addTitleContent(t,e.call(t),r,n):r?n.innerHTML=e:n.textContent=e}},{key:"_show",value:function(t,e){if(this._isOpen&&!this._isOpening)return this;if(this._isOpen=!0,this._tooltipNode)return this._tooltipNode.style.visibility="visible",this._tooltipNode.setAttribute("aria-hidden","false"),this.popperInstance.update(),this;var r=t.getAttribute("title")||e.title;if(!r)return this;var n=this._create(t,e.template,r,e.html);t.setAttribute("aria-describedby",n.id);var i=this._findContainer(e.container,t);return this._append(n,i),this._popperOptions=a({},e.popperOptions,{placement:e.placement}),this._popperOptions.modifiers=a({},this._popperOptions.modifiers,{arrow:a({},this._popperOptions.modifiers&&this._popperOptions.modifiers.arrow,{element:e.arrowSelector}),offset:a({},this._popperOptions.modifiers&&this._popperOptions.modifiers.offset,{offset:e.offset||this._popperOptions.modifiers&&this._popperOptions.modifiers.offset&&this._popperOptions.modifiers.offset.offset||e.offset})}),e.boundariesElement&&(this._popperOptions.modifiers.preventOverflow={boundariesElement:e.boundariesElement}),this.popperInstance=new o(t,n,this._popperOptions),this._tooltipNode=n,this}},{key:"_hide",value:function(){return this._isOpen&&(this._isOpen=!1,this._tooltipNode.style.visibility="hidden",this._tooltipNode.setAttribute("aria-hidden","true")),this}},{key:"_dispose",value:function(){var n=this;return this._events.forEach(function(t){var e=t.func,r=t.event;n.reference.removeEventListener(r,e)}),this._events=[],this._tooltipNode&&(this._hide(),this.popperInstance.destroy(),this.popperInstance.options.removeOnDestroy||(this._tooltipNode.parentNode.removeChild(this._tooltipNode),this._tooltipNode=null)),this}},{key:"_findContainer",value:function(t,e){return"string"==typeof t?t=window.document.querySelector(t):!1===t&&(t=e.parentNode),t}},{key:"_append",value:function(t,e){e.appendChild(t)}},{key:"_setEventListeners",value:function(n,t,i){var o=this,e=[],r=[];t.forEach(function(t){switch(t){case"hover":e.push("mouseenter"),r.push("mouseleave");break;case"focus":e.push("focus"),r.push("blur");break;case"click":e.push("click"),r.push("click")}}),e.forEach(function(t){function e(t){!0!==o._isOpening&&(t.usedByTooltip=!0,o._scheduleShow(n,i.delay,i,t))}o._events.push({event:t,func:e}),n.addEventListener(t,e)}),r.forEach(function(t){function r(t){!0!==t.usedByTooltip&&o._scheduleHide(n,i.delay,i,t)}o._events.push({event:t,func:r}),n.addEventListener(t,r),"click"===t&&i.closeOnClickOutside&&document.addEventListener("mousedown",function(t){if(o._isOpening){var e=o.popperInstance.popper;n.contains(t.target)||e.contains(t.target)||r(t)}},!0)})}},{key:"_scheduleShow",value:function(t,e,r){var n=this;this._isOpening=!0;var i=e&&e.show||e||0;this._showTimeout=window.setTimeout(function(){return n._show(t,r)},i)}},{key:"_scheduleHide",value:function(t,e,r,n){var i=this;this._isOpening=!1;var o=e&&e.hide||e||0;window.clearTimeout(this._showTimeout),window.setTimeout(function(){if(!1!==i._isOpen&&document.body.contains(i._tooltipNode)){if("mouseleave"===n.type&&i._setTooltipNodeEvent(n,t,e,r))return;i._hide(t,r)}},o)}},{key:"_updateTitleContent",value:function(t){if(void 0!==this._tooltipNode){var e=this._tooltipNode.querySelector(this.options.innerSelector);this._clearTitleContent(e,this.options.html,this.reference.getAttribute("title")||this.options.title),this._addTitleContent(this.reference,t,this.options.html,e),this.options.title=t,this.popperInstance.update()}else void 0!==this.options.title&&(this.options.title=t)}},{key:"_clearTitleContent",value:function(t,e,r){1===r.nodeType||11===r.nodeType?e&&t.removeChild(r):e?t.innerHTML="":t.textContent=""}}]),s);function s(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),u.call(this),e=a({},i,e),t.jquery&&(t=t[0]),this.reference=t;var r="string"==typeof(this.options=e).trigger?e.trigger.split(" ").filter(function(t){return-1!==["click","hover","focus"].indexOf(t)}):[];this._isOpen=!1,this._popperOptions={},this._setEventListeners(t,r,e)}var u=function(){var a=this;this.show=function(){return a._show(a.reference,a.options)},this.hide=function(){return a._hide()},this.dispose=function(){return a._dispose()},this.toggle=function(){return a._isOpen?a.hide():a.show()},this.updateTitleContent=function(t){return a._updateTitleContent(t)},this._events=[],this._setTooltipNodeEvent=function(n,i,t,o){var e=n.relatedreference||n.toElement||n.relatedTarget;return!!a._tooltipNode.contains(e)&&(a._tooltipNode.addEventListener(n.type,function t(e){var r=e.relatedreference||e.toElement||e.relatedTarget;a._tooltipNode.removeEventListener(n.type,t),i.contains(r)||a._scheduleHide(i,o.delay,o,e)}),!0)}};return e},"object"==typeof r&&void 0!==e?e.exports=i(t("popper.js")):"function"==typeof define&&define.amd?define(["popper.js"],i):n.Tooltip=i(n.Popper)},{"popper.js":7}],10:[function(t,e,r){var n,i;n=this,i=function(){var r,n,l;return this,r=function(t,e){return t.substring(0,e.length)===e},n=function(t,e){return t.substring(t.length-e.length)===e},(l=function(t){return t instanceof l?t:this instanceof l?void(this._wrapped=t):new l(t)}).delimiter=" ",l.isArray=function(t){return!(!t||t.constructor!==Array)},l.trim=function(t,e){for(e=e||" ";r(t,e);)t=t.substring(1);for(;n(t,e);)t=t.substring(0,t.length-1);return t},l.Wkt=function(t){this.delimiter=l.delimiter||" ",this.wrapVertices=!0,this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+|\+/,numeric:/-*\d+(\.*\d+)?/,comma:/\s*,\s*/,parenComma:/\)\s*,\s*\(/,coord:/-*\d+\.*\d+ -*\d+\.*\d+/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,ogcTypes:/^(multi)?(point|line|polygon|box)?(string)?$/i,crudeJson:/^{.*"(type|coordinates|geometries|features)":.*}$/},this._stripWhitespaceAndParens=function(t){return t.trim().replace(/^\(?(.*?)\)?$/,"$1")},this.components=void 0,t&&"string"==typeof t?this.read(t):t&&this.fromObject(t)},l.Wkt.prototype.isCollection=function(){switch(this.type.slice(0,5)){case"multi":case"polyg":return!0;default:return!1}},l.Wkt.prototype.sameCoords=function(t,e){return t.x===e.x&&t.y===e.y},l.Wkt.prototype.fromObject=function(t){var e;return e=t.hasOwnProperty("type")&&t.hasOwnProperty("coordinates")?this.fromJson(t):this.deconstruct.call(this,t),this.components=e.components,this.isRectangle=e.isRectangle||!1,this.type=e.type,this},l.Wkt.prototype.toObject=function(t){var e=this.construct[this.type].call(this,t);return"object"!=typeof e||l.isArray(e)||(e.properties=this.properties),e},l.Wkt.prototype.toString=function(t){return this.write()},l.Wkt.prototype.fromJson=function(t){var e,r,n,i,o,a;if(this.type=t.type.toLowerCase(),this.components=[],t.hasOwnProperty("geometry"))return this.fromJson(t.geometry),this.properties=t.properties,this;if(i=t.coordinates,l.isArray(i[0])){for(e in i)if(i.hasOwnProperty(e))if(l.isArray(i[e][0])){for(r in a=[],i[e])if(i[e].hasOwnProperty(r))if(l.isArray(i[e][r][0])){for(n in o=[],i[e][r])i[e][r].hasOwnProperty(n)&&o.push({x:i[e][r][n][0],y:i[e][r][n][1]});a.push(o)}else a.push({x:i[e][r][0],y:i[e][r][1]});this.components.push(a)}else"multipoint"===this.type?this.components.push([{x:i[e][0],y:i[e][1]}]):this.components.push({x:i[e][0],y:i[e][1]})}else this.components.push({x:i[0],y:i[1]});return this},l.Wkt.prototype.toJson=function(){var t,e,r,n,i,o,a;if(t=this.components,e={coordinates:[],type:function(){var t,e,r;for(t in r=[],e=this.regExes.ogcTypes.exec(this.type).slice(1))e.hasOwnProperty(t)&&void 0!==e[t]&&r.push(e[t].toLowerCase().slice(0,1).toUpperCase()+e[t].toLowerCase().slice(1));return r}.call(this).join("")},"box"===this.type.toLowerCase()){for(r in e.type="Polygon",e.bbox=[],t)t.hasOwnProperty(r)&&(e.bbox=e.bbox.concat([t[r].x,t[r].y]));return e.coordinates=[[[t[0].x,t[0].y],[t[0].x,t[1].y],[t[1].x,t[1].y],[t[1].x,t[0].y],[t[0].x,t[0].y]]],e}for(r in t)if(t.hasOwnProperty(r))if(l.isArray(t[r])){for(n in a=[],t[r])if(t[r].hasOwnProperty(n))if(l.isArray(t[r][n])){for(i in o=[],t[r][n])t[r][n].hasOwnProperty(i)&&o.push([t[r][n][i].x,t[r][n][i].y]);a.push(o)}else 1<t[r].length?a.push([t[r][n].x,t[r][n].y]):a=a.concat([t[r][n].x,t[r][n].y]);e.coordinates.push(a)}else 1<t.length?e.coordinates.push([t[r].x,t[r].y]):e.coordinates=e.coordinates.concat([t[r].x,t[r].y]);return e},l.Wkt.prototype.merge=function(t){var e=this.type.slice(0,5);if(this.type!==t.type&&this.type.slice(5,this.type.length)!==t.type)throw TypeError("The input geometry types must agree or the calling this.Wkt.Wkt instance must be a multigeometry of the other");switch(e){case"point":this.components=[this.components.concat(t.components)];break;case"multi":this.components=this.components.concat("multi"===t.type.slice(0,5)?t.components:[t.components]);break;default:this.components=[this.components,t.components]}return"multi"!==e&&(this.type="multi"+this.type),this},l.Wkt.prototype.read=function(t){var e;if(e=this.regExes.typeStr.exec(t))this.type=e[1].toLowerCase(),this.base=e[2],this.ingest[this.type]&&(this.components=this.ingest[this.type].apply(this,[this.base]));else{if(!this.regExes.crudeJson.test(t))throw console.log("Invalid WKT string provided to read()"),{name:"WKTError",message:"Invalid WKT string provided to read()"};if("object"!=typeof JSON||"function"!=typeof JSON.parse)throw console.log("JSON.parse() is not available; cannot parse GeoJSON strings"),{name:"JSONError",message:"JSON.parse() is not available; cannot parse GeoJSON strings"};this.fromJson(JSON.parse(t))}return this},l.Wkt.prototype.write=function(t){var e,r,n;for(t=t||this.components,(r=[]).push(this.type.toUpperCase()+"("),e=0;e<t.length;e+=1){if(this.isCollection()&&0<e&&r.push(","),!this.extract[this.type])return null;n=this.extract[this.type].apply(this,[t[e]]),this.isCollection()&&"multipoint"!==this.type?r.push("("+n+")"):(r.push(n),e!==t.length-1&&"multipoint"!==this.type&&r.push(","))}return r.push(")"),r.join("")},l.Wkt.prototype.extract={point:function(t){return String(t.x)+this.delimiter+String(t.y)},multipoint:function(t){var e,r,n=[];for(e=0;e<t.length;e+=1)r=this.extract.point.apply(this,[t[e]]),this.wrapVertices&&(r="("+r+")"),n.push(r);return n.join(",")},linestring:function(t){return this.extract.point.apply(this,[t])},multilinestring:function(t){var e,r=[];if(t.length)for(e=0;e<t.length;e+=1)r.push(this.extract.linestring.apply(this,[t[e]]));else r.push(this.extract.point.apply(this,[t]));return r.join(",")},polygon:function(t){return this.extract.multilinestring.apply(this,[t])},multipolygon:function(t){var e,r=[];for(e=0;e<t.length;e+=1)r.push("("+this.extract.polygon.apply(this,[t[e]])+")");return r.join(",")},box:function(t){return this.extract.linestring.apply(this,[t])},geometrycollection:function(t){console.log("The geometrycollection WKT type is not yet supported.")}},l.Wkt.prototype.ingest={point:function(t){var e=l.trim(t).split(this.regExes.spaces);return[{x:parseFloat(this.regExes.numeric.exec(e[0])[0]),y:parseFloat(this.regExes.numeric.exec(e[1])[0])}]},multipoint:function(t){var e,r,n;for(r=[],n=l.trim(t).split(this.regExes.comma),e=0;e<n.length;e+=1)r.push(this.ingest.point.apply(this,[n[e]]));return r},linestring:function(t){var e,r,n;for(r=this.ingest.multipoint.apply(this,[t]),n=[],e=0;e<r.length;e+=1)n=n.concat(r[e]);return n},multilinestring:function(t){var e,r,n,i;for(r=[],1===(i=l.trim(t).split(this.regExes.doubleParenComma)).length&&(i=l.trim(t).split(this.regExes.parenComma)),e=0;e<i.length;e+=1)n=this._stripWhitespaceAndParens(i[e]),r.push(this.ingest.linestring.apply(this,[n]));return r},polygon:function(t){var e,r,n,i,o,a;for(a=l.trim(t).split(this.regExes.parenComma),n=[],e=0;e<a.length;e+=1){for(o=this._stripWhitespaceAndParens(a[e]).split(this.regExes.comma),i=[],r=0;r<o.length;r+=1){var s=o[r].split(this.regExes.spaces);if(2<s.length&&(s=s.filter(function(t){return""!=t})),2===s.length){var u=s[0],c=s[1];i.push({x:parseFloat(u),y:parseFloat(c)})}}n.push(i)}return n},box:function(t){var e,r,n;for(r=this.ingest.multipoint.apply(this,[t]),n=[],e=0;e<r.length;e+=1)n=n.concat(r[e]);return n},multipolygon:function(t){var e,r,n,i;for(r=[],i=l.trim(t).split(this.regExes.doubleParenComma),e=0;e<i.length;e+=1)n=this._stripWhitespaceAndParens(i[e]),r.push(this.ingest.polygon.apply(this,[n]));return r},geometrycollection:function(t){console.log("The geometrycollection WKT type is not yet supported.")}},l},"function"==typeof define&&define.amd?define(function(){return i()}):void 0!==e&&"object"==typeof r?e.exports=i():n.Wkt=i()},{}],11:[function(t,e,r){window.$=window.jQuery=t("jquery");window.FastClick=t("fastclick"),window.mapboxgl=t("mapbox-gl"),window.Wkt=t("wicket"),window.turf=t("@turf/turf"),t("@popperjs/core"),window.Tooltip=t("tooltip.js"),window.Mapillary=t("mapillary-js")},{"@popperjs/core":1,"@turf/turf":2,fastclick:3,jquery:4,"mapbox-gl":5,"mapillary-js":6,"tooltip.js":9,wicket:10}]},{},[11]);