!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).trailviewer={})}(this,(function(e){"use strict";var t,n={exports:{}},i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}n.exports=a,n.exports.once=function(e,t){return new Promise((function(n,i){function o(n){e.removeListener(t,r),i(n)}function r(){"function"==typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}g(e,t,r,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&g(e,"error",t,n)}(e,o,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var s=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var o,r,a,s;if(l(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),a=r[t]),void 0===a)a=r[t]=n,++e._eventsCount;else if("function"==typeof a?a=r[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),(o=h(e))>0&&a.length>o&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,s=c,console&&console.warn&&console.warn(s)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=u.bind(i);return o.listener=n,i.wrapFn=o,o}function f(e,t,n){var i=e._events;if(void 0===i)return[];var o=i[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):m(o,o.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function g(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(r){i.once&&e.removeEventListener(t,o),n(r)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return h(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=r[e];if(void 0===l)return!1;if("function"==typeof l)o(l,this,t);else{var h=l.length,c=m(l,h);for(n=0;n<h;++n)o(c[n],this,t)}return!0},a.prototype.addListener=function(e,t){return c(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return c(this,e,t,!0)},a.prototype.once=function(e,t){return l(t),this.on(e,d(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,d(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,i,o,r,a;if(l(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){a=n[r].listener,o=r;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,r=Object.keys(n);for(i=0;i<r.length;++i)"removeListener"!==(o=r[i])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};var v=n.exports;function w(){return function(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var n=e.shift();e[0]=n+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var i=0;i<e.length;i++){var o=e[i];if("string"!=typeof o)throw new TypeError("Url must be a string. Received "+o);""!==o&&(i>0&&(o=o.replace(/^[\/]+/,"")),o=i<e.length-1?o.replace(/[\/]+$/,""):o.replace(/[\/]+$/,"/"),t.push(o))}var r=t.join("/"),a=(r=r.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return a.shift()+(a.length>0?"?":"")+a.join("&")}("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}window.libpannellum=function(e,t,n){function i(i,c){function u(e,t){return 1==e.level&&1!=t.level?-1:1==t.level&&1!=e.level?1:t.timestamp-e.timestamp}function d(e,t){return e.level!=t.level?e.level-t.level:e.diff-t.diff}function f(e,t,n,i,o,r,a){this.vertices=e,this.side=t,this.level=n,this.x=i,this.y=o,e=(e="object"==typeof r?r.tileKey:r).replace("%s",t).replace("%l0",n-1).replace("%l",n).replace("%x",i).replace("%y",o),this.path="object"==typeof r?r[e]:e,this.parentPath=a}function p(e,t,n,i,o,r){var a;a=b(e,(h=n.vertices).slice(0,3));var s=b(e,h.slice(3,6)),l=b(e,h.slice(6,9)),h=b(e,h.slice(9,12));if(-4==(c=a[0]+s[0]+l[0]+h[0])||4==c?a=!1:a=-4!=(c=a[1]+s[1]+l[1]+h[1])&&4!=c&&4!=a[2]+s[2]+l[2]+h[2],a){var c=[],u=[],d=2,m=[],g=0;for(h=0;4>h;h++)a=_(t,n.vertices.slice(3*h,3*(h+1))),c.push(a[0]*a[3]),u.push(a[1]*a[3]),a=a[2]*a[3],d=Math.min(d,a),m.push(1>=Math.abs(c[h])&&1>=Math.abs(u[h])&&0<a),g+=m[h];if(l=k.cubeResolution*Math.pow(2,n.level-k.maxLevel),a=Math.ceil(l*k.invTileResolution)-1,s=l%k.tileResolution*2,0===(l=2*l%k.tileResolution)&&(l=k.tileResolution),0===s&&(s=2*k.tileResolution),1<n.level&&0<d&&0<g){for(h=d=0;4>h;h++)if(g=(h+1)%4,m[h]||m[g]){var v=(c[g]-c[h])*I.drawingBufferWidth/2;g=(u[g]-u[h])*I.drawingBufferHeight/2;l<k.tileResolution&&(n.x==a?v*=k.tileResolution/l:n.y==a&&(g*=k.tileResolution/l)),s<=k.tileResolution&&(n.x==a&&(v*=2),n.y==a&&(g*=2)),d=Math.max(d,Math.sqrt(v*v+g*g))}if(d<=k.tileResolution/2)return}for(h=(c=n.vertices)[0]+c[3]+c[6]+c[9],u=c[1]+c[4]+c[7]+c[10],m=c[2]+c[5]+c[8]+c[11],d=Math.sqrt(h*h+u*u+m*m),m=Math.asin(m/d),h=Math.atan2(u,h)-o,h+=h>Math.PI?-2*Math.PI:h<-Math.PI?2*Math.PI:0,h=Math.abs(h),n.diff=Math.acos(Math.sin(i)*Math.sin(m)+Math.cos(i)*Math.cos(m)*Math.cos(h)),h=!1,u=0;u<R.nodeCache.length;u++)if(R.nodeCache[u].path==n.path){h=!0,R.nodeCache[u].timestamp=R.nodeCacheTimestamp++,R.nodeCache[u].diff=n.diff,R.currentNodes.push(R.nodeCache[u]);break}if(h||(n.timestamp=R.nodeCacheTimestamp++,R.currentNodes.push(n),R.nodeCache.push(n)),n.level<k.maxLevel){m=.5,n.x!=a&&n.y!=a||(m=1-k.tileResolution/(k.tileResolution+l));u=[],v=g=d=m;var w=h=1-m,y=h,x=h;for(l<k.tileResolution&&(n.x==a&&n.y!=a?(y=g=.5,("d"==n.side||"u"==n.side)&&(x=v=.5)):n.x!=a&&n.y==a&&(w=d=.5,"l"==n.side||"r"==n.side)&&(x=v=.5)),s<=k.tileResolution&&(n.x==a&&(d=0,w=1,"l"==n.side||"r"==n.side)&&(v=0,x=1),n.y==a&&(g=0,y=1,"d"==n.side||"u"==n.side)&&(v=0,x=1)),l=new f(l=new Float32Array([c[0],c[1],c[2],c[0]*d+c[3]*w,c[1]*m+c[4]*h,c[2]*v+c[5]*x,c[0]*d+c[6]*w,c[1]*g+c[7]*y,c[2]*v+c[8]*x,c[0]*m+c[9]*h,c[1]*g+c[10]*y,c[2]*v+c[11]*x]),n.side,n.level+1,2*n.x,2*n.y,k.fullpath,n.path),u.push(l),n.x==a&&s<=k.tileResolution||(l=new f(l=new Float32Array([c[0]*d+c[3]*w,c[1]*m+c[4]*h,c[2]*v+c[5]*x,c[3],c[4],c[5],c[3]*m+c[6]*h,c[4]*g+c[7]*y,c[5]*v+c[8]*x,c[0]*d+c[6]*w,c[1]*g+c[7]*y,c[2]*v+c[8]*x]),n.side,n.level+1,2*n.x+1,2*n.y,k.fullpath,n.path),u.push(l)),n.x==a&&s<=k.tileResolution||n.y==a&&s<=k.tileResolution||(l=new f(l=new Float32Array([c[0]*d+c[6]*w,c[1]*g+c[7]*y,c[2]*v+c[8]*x,c[3]*m+c[6]*h,c[4]*g+c[7]*y,c[5]*v+c[8]*x,c[6],c[7],c[8],c[9]*d+c[6]*w,c[10]*m+c[7]*h,c[11]*v+c[8]*x]),n.side,n.level+1,2*n.x+1,2*n.y+1,k.fullpath,n.path),u.push(l)),n.y==a&&s<=k.tileResolution||(l=new f(l=new Float32Array([c[0]*m+c[9]*h,c[1]*g+c[10]*y,c[2]*v+c[11]*x,c[0]*d+c[6]*w,c[1]*g+c[7]*y,c[2]*v+c[8]*x,c[9]*d+c[6]*w,c[10]*m+c[7]*h,c[11]*v+c[8]*x,c[9],c[10],c[11]]),n.side,n.level+1,2*n.x,2*n.y+1,k.fullpath,n.path),u.push(l)),g=0;g<u.length;g++)p(e,t,u[g],i,o)}}}function m(){return new Float32Array([-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1])}function g(e,t,n){var i=Math.sin(t);return t=Math.cos(t),"x"==n?new Float32Array([e[0],t*e[1]+i*e[2],t*e[2]-i*e[1],e[3],t*e[4]+i*e[5],t*e[5]-i*e[4],e[6],t*e[7]+i*e[8],t*e[8]-i*e[7]]):"y"==n?new Float32Array([t*e[0]-i*e[2],e[1],t*e[2]+i*e[0],t*e[3]-i*e[5],e[4],t*e[5]+i*e[3],t*e[6]-i*e[8],e[7],t*e[8]+i*e[6]]):"z"==n?new Float32Array([t*e[0]+i*e[1],t*e[1]-i*e[0],e[2],t*e[3]+i*e[4],t*e[4]-i*e[3],e[5],t*e[6]+i*e[7],t*e[7]-i*e[6],e[8]]):void 0}function v(e){return new Float32Array([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]])}function w(e,t,n,i){return e=2*Math.atan(Math.tan(e/2)*I.drawingBufferHeight/I.drawingBufferWidth),e=1/Math.tan(e/2),new Float32Array([e/t,0,0,0,0,e,0,0,0,0,(i+n)/(n-i),2*i*n/(n-i),0,0,-1,0])}function y(e,t){return new Float32Array([e[0]*t[0],e[0]*t[1],e[0]*t[2],0,e[5]*t[4],e[5]*t[5],e[5]*t[6],0,e[10]*t[8],e[10]*t[9],e[10]*t[10],e[11],-t[8],-t[9],-t[10],0])}function _(e,t){return new Float32Array([e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[4]*t[0]+e[5]*t[1]+e[6]*t[2],e[11]+e[8]*t[0]+e[9]*t[1]+e[10]*t[2],1/(e[12]*t[0]+e[13]*t[1]+e[14]*t[2])])}function b(e,t){var n=(o=_(e,t))[0]*o[3],i=o[1]*o[3],o=o[2]*o[3],r=[0,0,0];return-1>n&&(r[0]=-1),1<n&&(r[0]=1),-1>i&&(r[1]=-1),1<i&&(r[1]=1),(-1>o||1<o)&&(r[2]=1),r}function x(){console.log("Reducing canvas size due to error 1286!"),L.width=Math.round(L.width/2),L.height=Math.round(L.height/2)}function E(e,t){return Math.pow((Math.abs(e)-t)/t,2)*(0<e-t?1:-1)}function M(e,t){for(var n=Math.floor(e.length/t),i=[],o=0;o<n;o++){for(var r=0,a=0;a<t;a++)r=83*r+K.indexOf(e[o*t+a]);i.push(r)}return i}function P(e,t,n){var i=Math.floor(Math.sqrt(e.length))-1,o=Array(i+1),r=Array(i+1);r[0]=0,o[0]=1,r[1]=Math.sin(n),o[1]=Math.cos(n);for(var a=2;a<=i;a++)r[a]=2*r[a-1]*o[1]-r[a-2],o[a]=2*o[a-1]*o[1]-o[a-2];var s=n=0;for(a=1;a<=i+1;a++)s+=a;for(;0<=i;i--){var l=Math.floor((i+1)*i/2);for(n+=0!=l?e[l]*t[l-1]:e[l],a=1;a<=i;a++)n+=(e[++l]*o[a]+e[l+s-i-1]*r[a])*t[l-1]}return Math.round(n)}function T(e){if(1>ee.length)for(var t=J.length/32,n=0;32>n;n++){ee.push([]);for(var i=0;i<t;i++)ee[n].push(E(M(J[n*t+i],1),41)*Q)}M(e[0],1);i=255*(E(M(e[1],1),41)+1)/2;var o=M(e.slice(2),2);e=[];t=[];var r=[];for(n=0;n<o.length;n++){var a,s=o[n];a=i;var l=Math.floor(s/19)%19,h=s%19;a=[s=E(Math.floor(s/361),9)*a,l=E(l,9)*a,a*=E(h,9)],e.push(a[0]),t.push(a[1]),r.push(a[2])}for(o=.03125*Math.PI,a=[],n=31;0<=n;n--)for(i=0;64>i;i++)a.push(P(e,ee[n],(i+.5)*o)),a.push(P(t,ee[n],(i+.5)*o)),a.push(P(r,ee[n],(i+.5)*o)),a.push(255);return new ImageData(new Uint8ClampedArray(a),64,32)}var L;i&&((L=t.createElement("canvas")).style.width=L.style.height="100%",i.appendChild(L));var R,I,C,A,S,N,O,F,D,U,B,k,H,z,G,Y,q,V,X="fbudlr".split(""),W="frblud".split("");c&&(I=c),this.init=function(e,c,u,d,f,p,g){function v(e){if(_){var t=e*e*4,n=new Uint8ClampedArray(t),i=g.backgroundColor?g.backgroundColor:[0,0,0];i[0]*=255,i[1]*=255,i[2]*=255;for(var o=0;o<t;o++)n[o++]=i[0],n[o++]=i[1],n[o++]=i[2];for(e=new ImageData(n,e,e),w=0;6>w;w++)0==k[w].width&&(k[w]=e)}}if(c===n&&(c="equirectangular"),"equirectangular"!=c&&"cubemap"!=c&&"multires"!=c)throw console.log("Error: invalid image type specified!"),{type:"config error"};if(H=c,k=e,V=g||{},R){if(C&&(I.detachShader(R,C),I.deleteShader(C)),A&&(I.detachShader(R,A),I.deleteShader(A)),I.bindBuffer(I.ARRAY_BUFFER,null),I.bindBuffer(I.ELEMENT_ARRAY_BUFFER,null),R.texture&&I.deleteTexture(R.texture),R.nodeCache)for(e=0;e<R.nodeCache.length;e++)I.deleteTexture(R.nodeCache[e].texture);if(R.textureLoads)for(Z=[];0<R.textureLoads.length;)R.textureLoads.shift()(!1);I.deleteProgram(R),R=n}S&&(N&&(I.detachShader(S,N),I.deleteShader(N)),O&&(I.detachShader(S,O),I.deleteShader(O)),I.deleteProgram(S),S=n),B=n;var w,y,_=!1;if("cubemap"==H)for(w=0;6>w;w++)0<k[w].width?(y===n&&(y=k[w].width),y!=k[w].width&&console.log("Cube faces have inconsistent widths: "+y+" vs. "+k[w].width)):_=!0;if("cubemap"==H&&0!=(y&y-1)&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 10_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./))||(I||(I=L.getContext("experimental-webgl",{alpha:!1,depth:!1})),I&&1286==I.getError()&&x()),!I&&("multires"==H&&k.hasOwnProperty("fallbackPath")||"cubemap"==H)&&("WebkitAppearance"in t.documentElement.style||navigator.userAgent.match(/Trident.*rv[ :]*11\./)||-1!==navigator.appVersion.indexOf("MSIE 10"))){D&&i.removeChild(D),(D=t.createElement("div")).className="pnlm-world",u=k.basePath?k.basePath+k.fallbackPath:k.fallbackPath;var b=0;d=function(){var e=t.createElement("canvas");e.className="pnlm-face pnlm-"+W[this.side]+"face",D.appendChild(e);var n=e.getContext("2d");e.style.width=this.width+4+"px",e.style.height=this.height+4+"px",e.width=this.width+4,e.height=this.height+4,n.drawImage(this,2,2);var i,o,r=n.getImageData(0,0,e.width,e.height),a=r.data;for(i=2;i<e.width-2;i++)for(o=0;4>o;o++)a[4*(i+e.width)+o]=a[4*(i+2*e.width)+o],a[4*(i+e.width*(e.height-2))+o]=a[4*(i+e.width*(e.height-3))+o];for(i=2;i<e.height-2;i++)for(o=0;4>o;o++)a[4*(i*e.width+1)+o]=a[4*(i*e.width+2)+o],a[4*((i+1)*e.width-2)+o]=a[4*((i+1)*e.width-3)+o];for(o=0;4>o;o++)a[4*(e.width+1)+o]=a[4*(2*e.width+2)+o],a[4*(2*e.width-2)+o]=a[4*(3*e.width-3)+o],a[4*(e.width*(e.height-2)+1)+o]=a[4*(e.width*(e.height-3)+2)+o],a[4*(e.width*(e.height-1)-2)+o]=a[4*(e.width*(e.height-2)-3)+o];for(i=1;i<e.width-1;i++)for(o=0;4>o;o++)a[4*i+o]=a[4*(i+e.width)+o],a[4*(i+e.width*(e.height-1))+o]=a[4*(i+e.width*(e.height-2))+o];for(i=1;i<e.height-1;i++)for(o=0;4>o;o++)a[i*e.width*4+o]=a[4*(i*e.width+1)+o],a[4*((i+1)*e.width-1)+o]=a[4*((i+1)*e.width-2)+o];for(o=0;4>o;o++)a[o]=a[4*(e.width+1)+o],a[4*(e.width-1)+o]=a[4*(2*e.width-2)+o],a[e.width*(e.height-1)*4+o]=a[4*(e.width*(e.height-2)+1)+o],a[4*(e.width*e.height-1)+o]=a[4*(e.width*(e.height-1)-2)+o];n.putImageData(r,0,0),E.call(this)};var E=function(){0<this.width?(F===n&&(F=this.width),F!=this.width&&console.log("Fallback faces have inconsistent widths: "+F+" vs. "+this.width)):_=!0,6==++b&&(F=this.width,i.appendChild(D),p())};_=!1;for(w=0;6>w;w++)(f=new Image).crossOrigin=V.crossOrigin?V.crossOrigin:"anonymous",f.side=w,f.onload=d,f.onerror=E,f.src="multires"==H?u.replace("%s",W[w])+(k.extension?"."+k.extension:""):k[w].src;v(F)}else{if(!I)throw console.log("Error: no WebGL support detected!"),{type:"no webgl"};for("cubemap"==H&&v(y),k.fullpath=k.basePath?k.basePath+k.path:k.path,k.invTileResolution=1/k.tileResolution,e=m(),U=[],w=0;6>w;w++)U[w]=e.slice(12*w,12*w+12),e=m();if(e=0,"equirectangular"==H){if(e=I.getParameter(I.MAX_TEXTURE_SIZE),Math.max(k.width/2,k.height)>e)throw console.log("Error: The image is too big; it's "+k.width+"px wide, but this device's maximum supported size is "+2*e+"px."),{type:"webgl size error",width:k.width,maxWidth:2*e}}else if("cubemap"==H&&y>I.getParameter(I.MAX_CUBE_MAP_TEXTURE_SIZE))throw console.log("Error: The image is too big; it's "+y+"px wide, but this device's maximum supported size is "+e+"px."),{type:"webgl size error",width:y,maxWidth:e};g!==n&&(y=isNaN(g.horizonPitch)?0:Number(g.horizonPitch),c=isNaN(g.horizonRoll)?0:Number(g.horizonRoll),0!=y||0!=c)&&(B=[y,c]);var M=I.TEXTURE_2D;if(I.viewport(0,0,I.drawingBufferWidth,I.drawingBufferHeight),I.getShaderPrecisionFormat&&(y=I.getShaderPrecisionFormat(I.FRAGMENT_SHADER,I.HIGH_FLOAT))&&1>y.precision&&(a=a.replace("highp","mediump")),C=I.createShader(I.VERTEX_SHADER),y=o,"multires"==H&&(y=r),I.shaderSource(C,y),I.compileShader(C),A=I.createShader(I.FRAGMENT_SHADER),y=l,"cubemap"==H?(M=I.TEXTURE_CUBE_MAP,y=s):"multires"==H&&(y=h),I.shaderSource(A,y),I.compileShader(A),R=I.createProgram(),I.attachShader(R,C),I.attachShader(R,A),I.linkProgram(R),I.getShaderParameter(C,I.COMPILE_STATUS)||console.log(I.getShaderInfoLog(C)),I.getShaderParameter(A,I.COMPILE_STATUS)||console.log(I.getShaderInfoLog(A)),I.getProgramParameter(R,I.LINK_STATUS)||console.log(I.getProgramInfoLog(R)),I.useProgram(R),R.drawInProgress=!1,null!==g.backgroundColor){var P=g.backgroundColor?g.backgroundColor:[0,0,0];I.clearColor(P[0],P[1],P[2],1),I.clear(I.COLOR_BUFFER_BIT)}if(R.texCoordLocation=I.getAttribLocation(R,"a_texCoord"),I.enableVertexAttribArray(R.texCoordLocation),"multires"!=H)z||(z=I.createBuffer()),I.bindBuffer(I.ARRAY_BUFFER,z),I.bufferData(I.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),I.STATIC_DRAW),I.vertexAttribPointer(R.texCoordLocation,2,I.FLOAT,!1,0,0),R.aspectRatio=I.getUniformLocation(R,"u_aspectRatio"),I.uniform1f(R.aspectRatio,I.drawingBufferWidth/I.drawingBufferHeight),R.psi=I.getUniformLocation(R,"u_psi"),R.theta=I.getUniformLocation(R,"u_theta"),R.f=I.getUniformLocation(R,"u_f"),R.h=I.getUniformLocation(R,"u_h"),R.v=I.getUniformLocation(R,"u_v"),R.vo=I.getUniformLocation(R,"u_vo"),R.rot=I.getUniformLocation(R,"u_rot"),I.uniform1f(R.h,u/(2*Math.PI)),I.uniform1f(R.v,d/Math.PI),I.uniform1f(R.vo,f/Math.PI*2),"equirectangular"==H&&(R.backgroundColor=I.getUniformLocation(R,"u_backgroundColor"),I.uniform4fv(R.backgroundColor,P.concat([1]))),R.texture=I.createTexture(),I.bindTexture(M,R.texture),"cubemap"==H?(I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,k[1]),I.texImage2D(I.TEXTURE_CUBE_MAP_NEGATIVE_X,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,k[3]),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_Y,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,k[4]),I.texImage2D(I.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,k[5]),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_Z,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,k[0]),I.texImage2D(I.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,k[2])):k.width<=e?(I.uniform1i(I.getUniformLocation(R,"u_splitImage"),0),I.texImage2D(M,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,k)):(I.uniform1i(I.getUniformLocation(R,"u_splitImage"),1),(d=t.createElement("canvas")).width=k.width/2,d.height=k.height,(d=d.getContext("2d")).drawImage(k,0,0),f=d.getImageData(0,0,k.width/2,k.height),I.texImage2D(M,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,f),R.texture2=I.createTexture(),I.activeTexture(I.TEXTURE1),I.bindTexture(M,R.texture2),I.uniform1i(I.getUniformLocation(R,"u_image1"),1),d.drawImage(k,-k.width/2,0),f=d.getImageData(0,0,k.width/2,k.height),I.texImage2D(M,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,f),I.texParameteri(M,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(M,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(M,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(M,I.TEXTURE_MAG_FILTER,I.LINEAR),I.activeTexture(I.TEXTURE0)),"cubemap"!=H&&k.width&&k.width<=e&&u==2*Math.PI&&0==(k.width&k.width-1)?I.texParameteri(M,I.TEXTURE_WRAP_S,I.REPEAT):I.texParameteri(M,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(M,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(M,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(M,I.TEXTURE_MAG_FILTER,I.LINEAR);else if(R.vertPosLocation=I.getAttribLocation(R,"a_vertCoord"),I.enableVertexAttribArray(R.vertPosLocation),G||(G=I.createBuffer()),Y||(Y=I.createBuffer()),q||(q=I.createBuffer()),I.bindBuffer(I.ARRAY_BUFFER,Y),I.bufferData(I.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),I.STATIC_DRAW),I.vertexAttribPointer(R.texCoordLocation,2,I.FLOAT,!1,0,0),I.bindBuffer(I.ELEMENT_ARRAY_BUFFER,q),I.bufferData(I.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),I.STATIC_DRAW),I.bindBuffer(I.ARRAY_BUFFER,G),I.vertexAttribPointer(R.vertPosLocation,3,I.FLOAT,!1,0,0),R.perspUniform=I.getUniformLocation(R,"u_perspMatrix"),R.cubeUniform=I.getUniformLocation(R,"u_cubeMatrix"),R.currentNodes=[],R.nodeCache=[],R.nodeCacheTimestamp=0,R.textureLoads=[],k.shtHash||k.equirectangularThumbnail){N=I.createShader(I.VERTEX_SHADER),I.shaderSource(N,o),I.compileShader(N),O=I.createShader(I.FRAGMENT_SHADER),I.shaderSource(O,l),I.compileShader(O),S=I.createProgram(),I.attachShader(S,N),I.attachShader(S,O),I.linkProgram(S),I.getShaderParameter(N,I.COMPILE_STATUS)||console.log(I.getShaderInfoLog(N)),I.getShaderParameter(O,I.COMPILE_STATUS)||console.log(I.getShaderInfoLog(O)),I.getProgramParameter(S,I.LINK_STATUS)||console.log(I.getProgramInfoLog(S)),I.useProgram(S),S.texCoordLocation=I.getAttribLocation(S,"a_texCoord"),I.enableVertexAttribArray(S.texCoordLocation),z||(z=I.createBuffer()),I.bindBuffer(I.ARRAY_BUFFER,z),I.bufferData(I.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),I.STATIC_DRAW),I.vertexAttribPointer(S.texCoordLocation,2,I.FLOAT,!1,0,0),S.aspectRatio=I.getUniformLocation(S,"u_aspectRatio"),I.uniform1f(S.aspectRatio,I.drawingBufferWidth/I.drawingBufferHeight),S.psi=I.getUniformLocation(S,"u_psi"),S.theta=I.getUniformLocation(S,"u_theta"),S.f=I.getUniformLocation(S,"u_f"),S.h=I.getUniformLocation(S,"u_h"),S.v=I.getUniformLocation(S,"u_v"),S.vo=I.getUniformLocation(S,"u_vo"),S.rot=I.getUniformLocation(S,"u_rot"),I.uniform1f(S.h,1),S.texture=I.createTexture(),I.bindTexture(M,S.texture);var X,j,$,K=function(){I.useProgram(S),I.uniform1i(I.getUniformLocation(S,"u_splitImage"),0),I.texImage2D(M,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,X),I.texParameteri(M,I.TEXTURE_WRAP_S,I.REPEAT),I.texParameteri(M,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(M,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(M,I.TEXTURE_MAG_FILTER,I.LINEAR),I.uniform1f(S.v,j),I.uniform1f(S.vo,$),I.useProgram(R)};if(k.shtHash&&(X=T(k.shtHash),j=(2+1/31)/2,$=1-(2+1/31)/2,K()),k.equirectangularThumbnail)if("string"==typeof k.equirectangularThumbnail){if("data:"!=k.equirectangularThumbnail.slice(0,5))throw console.log("Error: thumbnail string is not a data URI!"),{type:"config error"};(X=new Image).onload=function(){j=1,$=0,K()},X.src=k.equirectangularThumbnail}else X=k.equirectangularThumbnail,j=1,$=0,K();I.bindBuffer(I.ARRAY_BUFFER,G),I.vertexAttribPointer(R.vertPosLocation,3,I.FLOAT,!1,0,0),I.useProgram(R)}if(0!==(u=I.getError()))throw console.log("Error: Something went wrong with WebGL!",u),{type:"webgl error"};p()}},this.destroy=function(){if(i!==n&&(L!==n&&i.contains(L)&&i.removeChild(L),D!==n&&i.contains(D)&&i.removeChild(D)),I){var e=I.getExtension("WEBGL_lose_context");e&&e.loseContext()}},this.resize=function(){var t=e.devicePixelRatio||1;L.width=L.clientWidth*t,L.height=L.clientHeight*t,I&&(1286==I.getError()&&x(),I.viewport(0,0,I.drawingBufferWidth,I.drawingBufferHeight),"multires"!=H?I.uniform1f(R.aspectRatio,L.clientWidth/L.clientHeight):k.shtHash&&(I.useProgram(S),I.uniform1f(S.aspectRatio,L.clientWidth/L.clientHeight),I.useProgram(R)))},L&&this.resize(),this.setPose=function(e,t){e=isNaN(e)?0:Number(e),t=isNaN(t)?0:Number(t),B=0==e&&0==t?n:[e,t]},this.render=function(t,i,o,r){var a,s,l=0;if(r===n&&(r={}),r.roll&&(l=r.roll),r.dynamic)var h=r.dynamic;if(B!==n){a=B[0],s=B[1];var c=t,m=i,_=Math.cos(s)*Math.sin(t)*Math.sin(a)+Math.cos(t)*(Math.cos(a)*Math.cos(i)+Math.sin(s)*Math.sin(a)*Math.sin(i)),b=-Math.sin(t)*Math.sin(s)+Math.cos(t)*Math.cos(s)*Math.sin(i);t=Math.cos(s)*Math.cos(a)*Math.sin(t)+Math.cos(t)*(-Math.cos(i)*Math.sin(a)+Math.cos(a)*Math.sin(s)*Math.sin(i)),t=Math.asin(Math.max(Math.min(t,1),-1)),i=Math.atan2(b,_),a=[Math.cos(c)*(Math.sin(s)*Math.sin(a)*Math.cos(m)-Math.cos(a)*Math.sin(m)),Math.cos(c)*Math.cos(s)*Math.cos(m),Math.cos(c)*(Math.cos(a)*Math.sin(s)*Math.cos(m)+Math.sin(m)*Math.sin(a))],s=[-Math.cos(t)*Math.sin(i),Math.cos(t)*Math.cos(i)],s=Math.acos(Math.max(Math.min((a[0]*s[0]+a[1]*s[1])/(Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])*Math.sqrt(s[0]*s[0]+s[1]*s[1])),1),-1)),0>a[2]&&(s=2*Math.PI-s),l+=s}if(r.hook&&r.hook({gl:I,program:R,previewProgram:S,imageType:H,texCoordBuffer:z,cubeVertBuf:G,cubeVertTexCoordBuf:Y,cubeVertIndBuf:q}),I||"multires"!=H&&"cubemap"!=H){if("multires"!=H)a=2*Math.atan(Math.tan(.5*o)/(I.drawingBufferWidth/I.drawingBufferHeight)),a=1/Math.tan(.5*a),I.uniform1f(R.psi,i),I.uniform1f(R.theta,t),I.uniform1f(R.rot,l),I.uniform1f(R.f,a),!0===h&&"equirectangular"==H&&(I.bindTexture(I.TEXTURE_2D,R.texture),I.texImage2D(I.TEXTURE_2D,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,k)),I.drawArrays(I.TRIANGLES,0,6);else{if((h=void 0!==k.shtHash||void 0!==k.equirectangularThumbnail)&&(I.useProgram(S),I.bindBuffer(I.ARRAY_BUFFER,z),I.vertexAttribPointer(S.texCoordLocation,2,I.FLOAT,!1,0,0),I.bindTexture(I.TEXTURE_2D,S.texture),a=2*Math.atan(Math.tan(.5*o)/(I.drawingBufferWidth/I.drawingBufferHeight)),a=1/Math.tan(.5*a),I.uniform1f(S.psi,i),I.uniform1f(S.theta,t),I.uniform1f(S.rot,l),I.uniform1f(S.f,a),I.drawArrays(I.TRIANGLES,0,6),I.bindBuffer(I.ARRAY_BUFFER,G),I.vertexAttribPointer(R.vertPosLocation,3,I.FLOAT,!1,0,0),I.useProgram(R)),c=w(o,I.drawingBufferWidth/I.drawingBufferHeight,.1,100),a=w(o,I.drawingBufferWidth/I.drawingBufferHeight,-100,100),s=g(s=new Float32Array([1,0,0,0,1,0,0,0,1]),-l,"z"),s=g(s,-t,"x"),s=g(s,i,"y"),s=new Float32Array([s[0],s[1],s[2],0,s[3],s[4],s[5],0,s[6],s[7],s[8],0,0,0,0,1]),I.uniformMatrix4fv(R.perspUniform,!1,v(c)),I.uniformMatrix4fv(R.cubeUniform,!1,v(s)),l=y(c,s),a=y(a,s),R.nodeCache.sort(u),200<R.nodeCache.length&&R.nodeCache.length>R.currentNodes.length+50)for(s=R.nodeCache.splice(200,R.nodeCache.length-200),c=0;c<s.length;c++)I.deleteTexture(s[c].texture);for(R.currentNodes=[],s=0;6>s;s++)p(l,a,c=new f(U[s],X[s],1,0,0,k.fullpath,null),t,i);for(R.currentNodes.sort(d),t=Z.length-1;0<=t;t--)-1===R.currentNodes.indexOf(Z[t].node)&&(Z[t].node.textureLoad=!1,Z.splice(t,1));if(0===Z.length)for(t=0;t<R.currentNodes.length;t++)if(!(i=R.currentNodes[t]).texture&&!i.textureLoad){i.textureLoad=!0,setTimeout(j,0,i);break}if(0<R.textureLoads.length&&R.textureLoads.shift()(!0),t=!h,!R.drawInProgress){for(R.drawInProgress=!0,t&&I.clear(I.COLOR_BUFFER_BIT),t={},i=0;i<R.currentNodes.length;i++)t[R.currentNodes[i].parentPath]===n&&(t[R.currentNodes[i].parentPath]=0),t[R.currentNodes[i].parentPath]+=!(1<R.currentNodes[i].textureLoaded);for(i=0;i<R.currentNodes.length;i++)1<R.currentNodes[i].textureLoaded&&(I.bufferData(I.ARRAY_BUFFER,R.currentNodes[i].vertices,I.STATIC_DRAW),I.bindTexture(I.TEXTURE_2D,R.currentNodes[i].texture),I.drawElements(I.TRIANGLES,6,I.UNSIGNED_SHORT,0));R.drawInProgress=!1}}if(r.returnImage!==n)return e.createImageBitmap&&"ImageBitmap"==r.returnImage?createImageBitmap(L):0==r.returnImage.toString().indexOf("image/")?L.toDataURL(r.returnImage):L.toDataURL("image/jpg",.5)}else for(r={f:"translate3d(-"+((s=F/2)+2)+"px, -"+(s+2)+"px, -"+s+"px)",b:"translate3d("+(s+2)+"px, -"+(s+2)+"px, "+s+"px) rotateX(180deg) rotateZ(180deg)",u:"translate3d(-"+(s+2)+"px, -"+s+"px, "+(s+2)+"px) rotateX(270deg)",d:"translate3d(-"+(s+2)+"px, "+s+"px, -"+(s+2)+"px) rotateX(90deg)",l:"translate3d(-"+s+"px, -"+(s+2)+"px, "+(s+2)+"px) rotateX(180deg) rotateY(90deg) rotateZ(180deg)",r:"translate3d("+s+"px, -"+(s+2)+"px, -"+(s+2)+"px) rotateY(270deg)"},i="perspective("+(o=(a=1/Math.tan(o/2))*L.clientWidth/2+"px")+") translateZ("+o+") rotateX("+t+"rad) rotateY("+i+"rad) ",o=Object.keys(r),t=0;6>t;t++)(l=D.querySelector(".pnlm-"+o[t]+"face"))&&(l.style.webkitTransform=i+r[o[t]],l.style.transform=i+r[o[t]])},this.isLoading=function(){if(I&&"multires"==H)for(var e=0;e<R.currentNodes.length;e++)if(!R.currentNodes[e].textureLoaded)return!0;return!1},this.isBaseLoaded=function(){if(6<=R.currentNodes.length){for(var e=0;6>e;e++)if(!R.currentNodes[e].textureLoaded)return!1;return!0}return!1},this.getCanvas=function(){return L};var j,Z=[],$=function(){function e(){var e=this;this.texture=this.callback=null,this.image=new Image,this.image.crossOrigin=n||"anonymous";var t=function(){R.textureLoads.push((function(t){t&&(0<e.image.width&&0<e.image.height?(t=e.image,I.bindTexture(I.TEXTURE_2D,e.texture),I.texImage2D(I.TEXTURE_2D,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,t),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.bindTexture(I.TEXTURE_2D,null),e.callback(e.texture,!0)):e.callback(e.texture,!1)),Z.length?(t=Z.shift(),e.loadTexture(t.src,t.texture,t.callback)):o[i++]=e}))};this.image.addEventListener("load",t),this.image.addEventListener("error",t)}function t(e,t,n,i){this.node=e,this.src=t,this.texture=n,this.callback=i}var n,i=4,o={};e.prototype.loadTexture=function(e,t,n){this.texture=t,this.callback=n,this.image.src=e};for(var r=0;r<i;r++)o[r]=new e;return function(e,r,a,s){return n=s,s=I.createTexture(),i?o[--i].loadTexture(r,s,a):Z.push(new t(e,r,s,a)),s}}();j=function(e){$(e,e.path+(k.extension?"."+k.extension:""),(function(t,n){e.texture=t,e.textureLoaded=n?2:1}),V.crossOrigin)};var K="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~",J="Bf[ff4fff|ffff0fffffBo@Ri5xag{Jmdf2+WiefCs@Ll7+Vi]Btag6[NmdgCv=Ho9;Qk;7zWiF_GsahDy:ErE?Mn$5+SkS_AyWiD#-CuJ[Iqp6;Nnx?7*SlE$*BxR@FtPA?Jq+%7:NnF*zAzn?CwIG@Ft-Y9?IrG+vA%w:AzGR?Cx*IF@EuI,nA+$*9%Gu:A#xCR?ByJ-VB-*wA+J**9*ZBv:9%L.QD.*aB.O.v9-MF+$8,O:MG:*OD;a:UB:IO:n9:Q:KJ;#IG=u-KE=Hs:MC?T:IO=wEL?#%FJ@K**FI@Y;HV=pDU?*sCS@S.uCR[m;Hp=VDq?*SCs@s.QCt[r:Iw=OEz?#IF$@#*HF%@u:K$;KI+=uEK-=*sCM:?w:M+:HO.;aCU;:%OCn?:z.Q..Ha;.ODv?-yFG$@,$-V;-Hw=+JH*?*lBP:?%%,n=+J*?%GQ:=#NCt?;y++v=%O:=zGt?:xHI,@-u,*z=zX?:wI+@,tEY??%r-$*;xt@,tP=?$qG%[:xn.#-:u$[%qp];xnN?[*sl.y:-r-?yn$^+sks_=yoi:v=*o?;uk;[zoi,_+skh:s@zl[+pi];tkg][xmhg;o@ti^xkg{$mhf|+oigf;f[ff_fff|ffff~fffff",Q=3.317,ee=[]}var o="attribute vec2 a_texCoord;varying vec2 v_texCoord;void main() {gl_Position = vec4(a_texCoord, 0.0, 1.0);v_texCoord = a_texCoord;}",r="attribute vec3 a_vertCoord;attribute vec2 a_texCoord;uniform mat4 u_cubeMatrix;uniform mat4 u_perspMatrix;varying mediump vec2 v_texCoord;void main(void) {gl_Position = u_perspMatrix * u_cubeMatrix * vec4(a_vertCoord, 1.0);v_texCoord = a_texCoord;}",a="precision highp float;\nuniform float u_aspectRatio;\nuniform float u_psi;\nuniform float u_theta;\nuniform float u_f;\nuniform float u_h;\nuniform float u_v;\nuniform float u_vo;\nuniform float u_rot;\nconst float PI = 3.14159265358979323846264;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nuniform bool u_splitImage;\nuniform samplerCube u_imageCube;\nvarying vec2 v_texCoord;\nuniform vec4 u_backgroundColor;\nvoid main() {\nfloat x = v_texCoord.x * u_aspectRatio;\nfloat y = v_texCoord.y;\nfloat sinrot = sin(u_rot);\nfloat cosrot = cos(u_rot);\nfloat rot_x = x * cosrot - y * sinrot;\nfloat rot_y = x * sinrot + y * cosrot;\nfloat sintheta = sin(u_theta);\nfloat costheta = cos(u_theta);\nfloat a = u_f * costheta - rot_y * sintheta;\nfloat root = sqrt(rot_x * rot_x + a * a);\nfloat lambda = atan(rot_x / root, a / root) + u_psi;\nfloat phi = atan((rot_y * costheta + u_f * sintheta) / root);",s=a+"float cosphi = cos(phi);\ngl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));\n}",l=a+"lambda = mod(lambda + PI, PI * 2.0) - PI;\nvec2 coord = vec2(lambda / PI, phi / (PI / 2.0));\nif(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)\ngl_FragColor = u_backgroundColor;\nelse {\nif(u_splitImage) {\nif(coord.x < 0.0)\ngl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / u_h, (-coord.y + u_v + u_vo) / (u_v * 2.0)));\nelse\ngl_FragColor = texture2D(u_image1, vec2((coord.x + u_h) / u_h - 1.0, (-coord.y + u_v + u_vo) / (u_v * 2.0)));\n} else {\ngl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));\n}\n}\n}",h="varying mediump vec2 v_texCoord;uniform sampler2D u_sampler;void main(void) {gl_FragColor = texture2D(u_sampler, v_texCoord);}";return{renderer:function(e,t,n){return new i(e,t)}}}(window,document),window.pannellum=function(e,t,n){function i(i,o){function r(){if((c=t.createElement("div")).innerHTML="\x3c!--[if lte IE 9]><i></i><![endif]--\x3e",1==c.getElementsByTagName("i").length)l();else{var i;if(ae=J.hfov,se=J.pitch,"cubemap"==J.type){for(ie=[],c=0;6>c;c++)ie.push(new Image),ie[c].crossOrigin=J.crossOrigin;ze.load.lbox.style.display="block",ze.load.lbar.style.display="none"}else if("multires"==J.type)c=JSON.parse(JSON.stringify(J.multiRes)),J.basePath&&J.multiRes.basePath&&!/^(?:[a-z]+:)?\/\//i.test(J.multiRes.basePath)?c.basePath=J.basePath+J.multiRes.basePath:J.multiRes.basePath?c.basePath=J.multiRes.basePath:J.basePath&&(c.basePath=J.basePath),ie=c;else if(!0===J.dynamic)ie=J.panorama;else{if(J.panorama===n)return void l(J.strings.noPanoramaError);ie=new Image}if("cubemap"==J.type)for(var o=6,r=function(){0===--o&&s()},h=function(e){var n=t.createElement("a");n.href=e.target.src,n.textContent=n.href,l(J.strings.fileAccessError.replace("%s",n.outerHTML))},c=0;c<ie.length;c++)"null"==(i=J.cubeMap[c])?(console.log("Will use background instead of missing cubemap face "+c),r()):(J.basePath&&!a(i)&&(i=J.basePath+i),ie[c].onload=r,ie[c].onerror=h,ie[c].src=$(i));else if("multires"==J.type)s();else if(i="",J.basePath&&(i=J.basePath),!0!==J.dynamic){if(J.panorama instanceof Image||J.panorama instanceof ImageData||e.ImageBitmap&&J.panorama instanceof ImageBitmap)return ie=J.panorama,void s();i=a(J.panorama)?J.panorama:i+J.panorama,ie.onload=function(){e.URL.revokeObjectURL(this.src),s()},(he=new XMLHttpRequest).onloadend=function(){if(200!=he.status){var o=t.createElement("a");o.href=i,o.textContent=o.href,l(J.strings.fileAccessError.replace("%s",o.outerHTML))}else(function(i,o){var r=new FileReader;r.addEventListener("loadend",(function(){var a=r.result;navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)&&((0>(c=a.indexOf("ÿÂ"))||65536<c)&&l(J.strings.iOS8WebGLError));if(-1<(c=a.indexOf("<x:xmpmeta"))&&!0!==J.ignoreGPanoXMP){var s=a.substring(c,a.indexOf("</x:xmpmeta>")+12),h=function(e){var t;return 0<=s.indexOf(e+'="')?t=(t=s.substring(s.indexOf(e+'="')+e.length+2)).substring(0,t.indexOf('"')):0<=s.indexOf(e+">")&&(t=(t=s.substring(s.indexOf(e+">")+e.length+1)).substring(0,t.indexOf("<"))),t!==n?Number(t):null},c=(a=h("GPano:FullPanoWidthPixels"),h("GPano:CroppedAreaImageWidthPixels")),u=h("GPano:FullPanoHeightPixels"),d=h("GPano:CroppedAreaImageHeightPixels"),f=h("GPano:CroppedAreaTopPixels"),p=h("GPano:PoseHeadingDegrees"),m=h("GPano:PosePitchDegrees"),g=h("GPano:PoseRollDegrees"),v=h("GPano:InitialViewPitchDegrees"),w=h("GPano:InitialViewHeadingDegrees");h=h("GPano:InitialHorizontalFOVDegrees");null!==a&&null!==c&&null!==u&&null!==d&&null!==f&&(0>Ie.indexOf("haov")&&(J.haov=c/a*360),0>Ie.indexOf("vaov")&&(J.vaov=d/u*180),0>Ie.indexOf("vOffset")&&(J.vOffset=-180*((f+d/2)/u-.5)),null!==p&&0>Ie.indexOf("northOffset")&&(J.northOffset=p,!1!==J.compass&&(J.compass=!0)),null!==m&&null!==g&&(0>Ie.indexOf("horizonPitch")&&(J.horizonPitch=m),0>Ie.indexOf("horizonRoll")&&(J.horizonRoll=g)),null!=v&&0>Ie.indexOf("pitch")&&(J.pitch=v),null!=w&&0>Ie.indexOf("yaw")&&(J.yaw=w),null!=h&&0>Ie.indexOf("hfov")&&(J.hfov=h))}ie.src=e.URL.createObjectURL(i),ie.onerror=function(){(e.fetch?e.fetch(t.location.href).then((function(e){return e.headers.get("Content-Security-Policy")})):null).then((function(e){e&&e.split(";").find((function(e){if(e=e.match(/img-src(.*)/))return!e[1].includes("blob")}))&&(console.log("CSP blocks blobs; reverting to URL."),ie.crossOrigin=J.crossOrigin,ie.src=o)}))}})),r.readAsBinaryString!==n?r.readAsBinaryString(i):r.readAsText(i)})(this.response,i),ze.load.msg.innerHTML=""},he.onprogress=function(e){var t,n;e.lengthComputable?(ze.load.lbarFill.style.width=e.loaded/e.total*100+"%",1e6<e.total?(t="MB",n=(e.loaded/1e6).toFixed(2),e=(e.total/1e6).toFixed(2)):1e3<e.total?(t="kB",n=(e.loaded/1e3).toFixed(1),e=(e.total/1e3).toFixed(1)):(t="B",n=e.loaded,e=e.total),ze.load.msg.innerHTML=n+" / "+e+" "+t):(ze.load.lbox.style.display="block",ze.load.lbar.style.display="none")};try{he.open("GET",i,!0)}catch(e){l(J.strings.malformedURLError)}he.responseType="blob",he.setRequestHeader("Accept","image/*,*/*;q=0.9"),he.withCredentials="use-credentials"===J.crossOrigin,he.send()}J.draggable&&Fe.classList.add("pnlm-grab"),Fe.classList.remove("pnlm-grabbing"),Ce=!0===J.dynamicUpdate,J.dynamic&&Ce&&(ie=J.panorama,s())}}function a(e){return/^(?:[a-z]+:)?\/\//i.test(e)||"/"==e[0]||"blob:"==e.slice(0,5)}function s(){Q||(Q=new libpannellum.renderer(De)),be||(be=!0,Ue.addEventListener("mousedown",d,!1),t.addEventListener("mousemove",m,!1),t.addEventListener("mouseup",g,!1),J.mouseZoom&&(Fe.addEventListener("mousewheel",E,!1),Fe.addEventListener("DOMMouseScroll",E,!1)),J.doubleClickZoom&&Ue.addEventListener("dblclick",f,!1),i.addEventListener("mozfullscreenchange",z,!1),i.addEventListener("webkitfullscreenchange",z,!1),i.addEventListener("msfullscreenchange",z,!1),i.addEventListener("fullscreenchange",z,!1),"function"==typeof ResizeObserver?(le=new ResizeObserver(I)).observe(i):(e.addEventListener("resize",I,!1),e.addEventListener("orientationchange",I,!1)),J.disableKeyboardCtrl||(i.addEventListener("keydown",M,!1),i.addEventListener("keyup",T,!1),i.addEventListener("blur",P,!1)),t.addEventListener("mouseleave",g,!1),""===t.documentElement.style.pointerAction&&""===t.documentElement.style.touchAction?(Ue.addEventListener("pointerdown",_,!1),Ue.addEventListener("pointermove",b,!1),Ue.addEventListener("pointerup",x,!1),Ue.addEventListener("pointerleave",x,!1)):(Ue.addEventListener("touchstart",v,!1),Ue.addEventListener("touchmove",w,!1),Ue.addEventListener("touchend",y,!1)),e.navigator.pointerEnabled&&(i.style.touchAction="none")),function(){try{var e={};J.horizonPitch!==n&&(e.horizonPitch=J.horizonPitch*Math.PI/180),J.horizonRoll!==n&&(e.horizonRoll=J.horizonRoll*Math.PI/180),J.backgroundColor!==n&&(e.backgroundColor=J.backgroundColor),Q.init(ie,J.type,J.haov*Math.PI/180,J.vaov*Math.PI/180,J.vOffset*Math.PI/180,O,e)}catch(e){if(!0!==J.dynamic&&(ie=n),"webgl error"==e.type||"no webgl"==e.type)l();else{if("webgl size error"!=e.type)throw l(J.strings.unknownError),e;l(J.strings.textureSizeError.replace("%s",e.width).replace("%s",e.maxWidth))}}}(),Y(J.hfov),setTimeout((function(){}),500)}function l(e){e===n&&(e=J.strings.genericWebGLError),ze.errorMsg.innerHTML="<p>"+e+"</p>",Ye.load.style.display="none",ze.load.box.style.display="none",ze.errorMsg.style.display="table",_e=!0,ne=n,De.style.display="none",K("error",e)}function h(e){ze.interactionMsg.style.opacity=1,ze.interactionMsg.innerHTML="<p>"+e+"</p>",ze.interactionMsg.style.display="table",K("messageshown"),clearTimeout(ze.interactionMsg.timeout),ze.interactionMsg.removeEventListener("transitionend",c),ze.interactionMsg.timeout=setTimeout((function(){ze.interactionMsg.style.opacity=0,ze.interactionMsg.addEventListener("transitionend",c)}),2e3)}function c(){ze.interactionMsg.style.opacity=0,ze.interactionMsg.style.display="none",K("messagecleared")}function u(e){var t=i.getBoundingClientRect(),n={};return n.x=(e.clientX||e.pageX)-t.left,n.y=(e.clientY||e.pageY)-t.top,n}function d(e){if(e.preventDefault(),i.focus(),ne&&J.draggable&&!J.draggingHotSpot){var t=u(e);if(J.hotSpotDebug){var n=p(e);console.log("Pitch: "+n[0]+", Yaw: "+n[1]+", Center Pitch: "+J.pitch+", Center Yaw: "+J.yaw+", HFOV: "+J.hfov)}q(),W(),J.roll=0,xe.hfov=0,ue=!0,de=Date.now(),fe=t.x,pe=t.y,ge=J.yaw,ve=J.pitch,Fe.classList.add("pnlm-grabbing"),Fe.classList.remove("pnlm-grab"),K("mousedown",e),C()}}function f(e){J.minHfov===J.hfov?ce.setHfov(ae,1e3):(e=p(e),ce.lookAt(e[0],e[1],J.minHfov,1e3))}function p(e){var t=u(e),n=(e=Q.getCanvas()).clientWidth,i=e.clientHeight;e=t.x/n*2-1;i=(1-t.y/i*2)*i/n;var o=1/Math.tan(J.hfov*Math.PI/360),r=Math.sin(J.pitch*Math.PI/180),a=Math.cos(J.pitch*Math.PI/180);t=o*a-i*r,n=Math.sqrt(e*e+t*t),i=180*Math.atan((i*a+o*r)/n)/Math.PI;return-180>(e=180*Math.atan2(e/n,t/n)/Math.PI+J.yaw)&&(e+=360),180<e&&(e-=360),[i,e]}function m(e){if(te)D(te,e);else if(ue&&ne){de=Date.now();var t=(n=Q.getCanvas()).clientWidth,n=n.clientHeight;e=u(e);var i=180*(Math.atan(fe/t*2-1)-Math.atan(e.x/t*2-1))/Math.PI*J.hfov/90+ge;xe.yaw=(i-J.yaw)%360*.2,J.yaw=i,t=360*Math.atan(Math.tan(J.hfov/360*Math.PI)*n/t)/Math.PI,t=180*(Math.atan(e.y/n*2-1)-Math.atan(pe/n*2-1))/Math.PI*t/90+ve,xe.pitch=.2*(t-J.pitch),J.pitch=t}}function g(e){te&&te.dragHandlerFunc&&te.dragHandlerFunc(e,te.dragHandlerArgs),te=null,ue&&(ue=!1,15<Date.now()-de&&(xe.pitch=xe.yaw=0),Fe.classList.add("pnlm-grab"),Fe.classList.remove("pnlm-grabbing"),de=Date.now(),K("mouseup",e))}function v(e){if(ne&&J.draggable&&!te){q(),W(),J.roll=0,xe.hfov=0;var t=u(e.targetTouches[0]);if(fe=t.x,pe=t.y,2==e.targetTouches.length){var n=u(e.targetTouches[1]);fe+=.5*(n.x-t.x),pe+=.5*(n.y-t.y),me=Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y))}ue=!0,de=Date.now(),ge=J.yaw,ve=J.pitch,K("touchstart",e),C()}}function w(e){if(J.draggable&&(J.dragConfirm||e.preventDefault(),ne&&(de=Date.now()),ue&&ne)){var t=(o=u(e.targetTouches[0])).x,n=o.y;if(2==e.targetTouches.length&&-1!=me){var i=u(e.targetTouches[1]),o=(t=t+.5*(i.x-o.x),n=n+.5*(i.y-o.y),Math.sqrt((o.x-i.x)*(o.x-i.x)+(o.y-i.y)*(o.y-i.y)));Y(J.hfov+.1*(me-o)),me=o}o=J.hfov/360*J.touchPanSpeedCoeffFactor,ye||"both"!=J.dragConfirm&&"yaw"!=J.dragConfirm||2==e.targetTouches.length?(t=(fe-t)*o+ge,xe.yaw=(t-J.yaw)%360*.2,J.yaw=t):fe!=t&&("yaw"==J.dragConfirm?h(J.strings.twoTouchXActivate):h(J.strings.twoTouchActivate)),ye||"both"!=J.dragConfirm&&"pitch"!=J.dragConfirm||2==e.targetTouches.length?(n=(n-pe)*o+ve,xe.pitch=.2*(n-J.pitch),J.pitch=n):pe!=n&&("pitch"==J.dragConfirm?h(J.strings.twoTouchYActivate):h(J.strings.twoTouchActivate)),"yaw"!=J.dragConfirm&&"pitch"!=J.dragConfirm&&"both"!=J.dragConfirm||2!=e.targetTouches.length||(c(),e.preventDefault())}}function y(){te=null,ue=!1,150<Date.now()-de&&(xe.pitch=xe.yaw=0),me=-1,de=Date.now(),K("touchend",event)}function _(e){"touch"==e.pointerType&&ne&&J.draggable&&(Xe.push(e.pointerId),We.push({clientX:e.clientX,clientY:e.clientY}),e.targetTouches=We,v(e),e.preventDefault())}function b(e){if("touch"==e.pointerType)if(te)D(te,e);else if(J.draggable)for(var t=0;t<Xe.length;t++)if(e.pointerId==Xe[t]){We[t].clientX=e.clientX,We[t].clientY=e.clientY,e.targetTouches=We,w(e),e.preventDefault();break}}function x(e){if(te&&te.dragHandlerFunc&&te.dragHandlerFunc(e,te.dragHandlerArgs),te=null,"touch"==e.pointerType){for(var t=!1,i=0;i<Xe.length;i++)e.pointerId==Xe[i]&&(Xe[i]=n),Xe[i]&&(t=!0);t||(Xe=[],We=[],y()),e.preventDefault()}}function E(e){ne&&("fullscreenonly"!=J.mouseZoom||ye)&&(ye||"ctrl"!=J.mouseZoom||e.ctrlKey?(c(),e.preventDefault(),q(),de=Date.now(),e.wheelDeltaY?(Y(J.hfov-.05*e.wheelDeltaY),xe.hfov=0>e.wheelDelta?1:-1):e.wheelDelta?(Y(J.hfov-.05*e.wheelDelta),xe.hfov=0>e.wheelDelta?1:-1):e.detail&&(Y(J.hfov+1.5*e.detail),xe.hfov=0<e.detail?1:-1),C()):(e=-1!=navigator.platform.indexOf("Mac")?"control":"ctrl",h(J.strings.ctrlZoomActivate.replace("%s",'<kbd class="pnlm-outline">'+e+"</kbd>"))))}function M(e){q(),de=Date.now(),W(),J.roll=0;var t=e.which||e.keycode;0>J.capturedKeyNumbers.indexOf(t)||!(ye||16!=t&&17!=t||"ctrl"!=J.mouseZoom)||(e.preventDefault(),27==t?ye&&H():L(t,!0))}function P(){for(var e=0;10>e;e++)we[e]=!1}function T(e){var t=e.which||e.keycode;0>J.capturedKeyNumbers.indexOf(t)||(e.preventDefault(),L(t,!1))}function L(e,t){var n=!1;switch(e){case 109:case 189:case 17:case 173:we[0]!=t&&(n=!0),we[0]=t;break;case 107:case 187:case 16:case 61:we[1]!=t&&(n=!0),we[1]=t;break;case 38:we[2]!=t&&(n=!0),we[2]=t;break;case 87:we[6]!=t&&(n=!0),we[6]=t;break;case 40:we[3]!=t&&(n=!0),we[3]=t;break;case 83:we[7]!=t&&(n=!0),we[7]=t;break;case 37:we[4]!=t&&(n=!0),we[4]=t;break;case 65:we[8]!=t&&(n=!0),we[8]=t;break;case 39:we[5]!=t&&(n=!0),we[5]=t;break;case 68:we[9]!=t&&(n=!0),we[9]=t}n&&t&&(oe="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),C())}function R(e){var t=Le[e],n=Math.min(1,Math.max((Date.now()-t.startTime)/1e3/(t.duration/1e3),0));n=t.startPosition+J.animationTimingFunction(n)*(t.endPosition-t.startPosition);(t.endPosition>t.startPosition&&n>=t.endPosition||t.endPosition<t.startPosition&&n<=t.endPosition||t.endPosition===t.startPosition)&&(n=t.endPosition,xe[e]=0,delete Le[e]),J[e]=n}function I(){z("resize")}function C(){Ee||(Ee=!0,A())}function A(){if(!Ne)if(function(){var e;if(ne){var t=Q.getCanvas();!1!==J.autoRotate&&(360<J.yaw?J.yaw-=360:-360>J.yaw&&(J.yaw+=360)),e=J.yaw;var i=0;if(J.avoidShowingBackground){var o=J.hfov/2,r=180*Math.atan2(Math.tan(o/180*Math.PI),t.width/t.height)/Math.PI;J.vaov>J.haov?Math.min(Math.cos((J.pitch-o)/180*Math.PI),Math.cos((J.pitch+o)/180*Math.PI)):i=o*(1-Math.min(Math.cos((J.pitch-r)/180*Math.PI),Math.cos((J.pitch+r)/180*Math.PI)))}r=-180;var a=180;360>(o=J.maxYaw-J.minYaw)&&(r=J.minYaw+J.hfov/2+i,a=J.maxYaw-J.hfov/2-i,o<J.hfov&&(r=a=(r+a)/2),J.yaw=Math.max(r,Math.min(a,J.yaw))),!1===J.autoRotate&&(360<J.yaw?J.yaw-=360:-360>J.yaw&&(J.yaw+=360)),!1!==J.autoRotate&&e!=J.yaw&&oe!==n&&(J.autoRotate*=-1),e=2*Math.atan(Math.tan(J.hfov/180*Math.PI*.5)/(t.width/t.height))/Math.PI*180,t=J.minPitch+e/2,i=J.maxPitch-e/2,J.maxPitch-J.minPitch<e&&(t=i=(t+i)/2),isNaN(t)&&(t=-90),isNaN(i)&&(i=90),J.pitch=Math.max(t,Math.min(i,J.pitch)),Q.render(J.pitch*Math.PI/180,J.yaw*Math.PI/180,J.hfov*Math.PI/180,{roll:J.roll*Math.PI/180,dynamic:Ce}),Ae&&(Ae=Ce=!1),J.hotSpots.forEach(U),J.compass&&(Ve.style.transform="rotate("+(-J.yaw-J.northOffset)+"deg)",Ve.style.webkitTransform="rotate("+(-J.yaw-J.northOffset)+"deg)")}}(),re&&clearTimeout(re),ue||!0===Me)requestAnimationFrame(A);else if(we[0]||we[1]||we[2]||we[3]||we[4]||we[5]||we[6]||we[7]||we[8]||we[9]||J.autoRotate||Le.pitch||Le.yaw||Le.hfov||.01<Math.abs(xe.yaw)||.01<Math.abs(xe.pitch)||.01<Math.abs(xe.hfov))(function(){if(ne){var e,t=!1,i=J.pitch,o=J.yaw,r=J.hfov;e="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),oe===n&&(oe=e);var a=(e-oe)*J.hfov/1200;if(a=Math.min(a,10),we[0]&&!0===J.keyboardZoom&&(Y(J.hfov+(.8*xe.hfov+.4)*a),t=!0),we[1]&&!0===J.keyboardZoom&&(Y(J.hfov+(.8*xe.hfov-.2)*a),t=!0),(we[2]||we[6])&&(J.pitch+=(.8*xe.pitch+.2)*a,t=!0),(we[3]||we[7])&&(J.pitch+=(.8*xe.pitch-.2)*a,t=!0),(we[4]||we[8])&&(J.yaw+=(.8*xe.yaw-.2)*a,t=!0),(we[5]||we[9])&&(J.yaw+=(.8*xe.yaw+.2)*a,t=!0),t&&(de=Date.now()),J.autoRotate){if(.001<e-oe){t=(e-oe)/1e3;var s=(xe.yaw/t*a-.2*J.autoRotate)*t;s=(0<-J.autoRotate?1:-1)*Math.min(Math.abs(J.autoRotate*t),Math.abs(s)),J.yaw+=s}J.autoRotateStopDelay&&(J.autoRotateStopDelay-=e-oe,0>=J.autoRotateStopDelay&&(J.autoRotateStopDelay=!1,Te=J.autoRotate,J.autoRotate=0))}Le.pitch&&(R("pitch"),i=J.pitch),Le.yaw&&(R("yaw"),o=J.yaw),Le.hfov&&(R("hfov"),r=J.hfov),0<a&&!J.autoRotate&&(t=1-J.friction,we[4]||we[5]||we[8]||we[9]||Le.yaw||(J.yaw+=xe.yaw*a*t),we[2]||we[3]||we[6]||we[7]||Le.pitch||(J.pitch+=xe.pitch*a*t),we[0]||we[1]||Le.hfov||(90<J.hfov&&(t*=1-(J.hfov-90)/90),Y(J.hfov+xe.hfov*a*t))),oe=e,0<a&&(xe.yaw=.8*xe.yaw+(J.yaw-o)/a*.2,xe.pitch=.8*xe.pitch+(J.pitch-i)/a*.2,xe.hfov=.8*xe.hfov+(J.hfov-r)/a*.2,i=J.autoRotate?Math.abs(J.autoRotate):5,xe.yaw=Math.min(i,Math.max(xe.yaw,-i)),xe.pitch=Math.min(i,Math.max(xe.pitch,-i)),xe.hfov=Math.min(i,Math.max(xe.hfov,-i))),we[0]&&we[1]&&(xe.hfov=0),(we[2]||we[6])&&(we[3]||we[7])&&(xe.pitch=0),(we[4]||we[8])&&(we[5]||we[9])&&(xe.yaw=0)}})(),0<=J.autoRotateInactivityDelay&&Te&&Date.now()-de>J.autoRotateInactivityDelay&&!J.autoRotate&&(J.autoRotate=Te,ce.lookAt(se,n,ae,3e3)),requestAnimationFrame(A);else if(Q&&(Q.isLoading()||!0===J.dynamic&&Ce))requestAnimationFrame(A);else{ce.getPitch&&ce.getYaw&&ce.getHfov&&K("animatefinished",{pitch:ce.getPitch(),yaw:ce.getYaw(),hfov:ce.getHfov()}),Ee=!1,oe=n;var e=J.autoRotateInactivityDelay-(Date.now()-de);0<e?re=setTimeout((function(){J.autoRotate=Te,ce.lookAt(se,n,ae,3e3),C()}),e):0<=J.autoRotateInactivityDelay&&Te&&(J.autoRotate=Te,ce.lookAt(se,n,ae,3e3),C())}}function S(e,t,n,i){this.w=e,this.x=t,this.y=n,this.z=i}function N(t){var n;n=t.alpha;var i=t.beta;t=t.gamma,i=[i?i*Math.PI/180/2:0,t?t*Math.PI/180/2:0,n?n*Math.PI/180/2:0],n=[Math.cos(i[0]),Math.cos(i[1]),Math.cos(i[2])],i=[Math.sin(i[0]),Math.sin(i[1]),Math.sin(i[2])],n=(n=new S(n[0]*n[1]*n[2]-i[0]*i[1]*i[2],i[0]*n[1]*n[2]-n[0]*i[1]*i[2],n[0]*i[1]*n[2]+i[0]*n[1]*i[2],n[0]*n[1]*i[2]+i[0]*i[1]*n[2])).multiply(new S(Math.sqrt(.5),-Math.sqrt(.5),0,0)),i=e.orientation?-e.orientation*Math.PI/180/2:0,n=n.multiply(new S(Math.cos(i),0,-Math.sin(i),0)).toEulerAngles(),"number"==typeof Me&&10>Me?Me+=1:10===Me?(Pe=n[2]/Math.PI*180+J.yaw,Me=!0,requestAnimationFrame(A)):(J.pitch=n[0]/Math.PI*180,J.roll=-n[1]/Math.PI*180,J.yaw=-n[2]/Math.PI*180+Pe)}function O(){if(J.sceneFadeDuration&&Q.fadeImg!==n){Q.fadeImg.style.opacity=0;var e=Q.fadeImg;delete Q.fadeImg,setTimeout((function(){De.removeChild(e),K("scenechangefadedone")}),J.sceneFadeDuration)}Ve.style.display=J.compass?"inline":"none",Se||(J.hotSpots?(J.hotSpots=J.hotSpots.sort((function(e,t){return e.pitch<t.pitch})),J.hotSpots.forEach(F)):J.hotSpots=[],Se=!0,J.hotSpots.forEach(U)),ze.load.box.style.display="none",ee!==n&&(De.removeChild(ee),ee=n),ne=!0,!0!==J.dynamic&&(ie=n),C(),K("load")}function F(e){e.pitch=Number(e.pitch)||0,e.yaw=Number(e.yaw)||0;var n=t.createElement("div");n.tabIndex=-1,n.className="pnlm-hotspot-base",n.className=e.cssClass?n.className+" "+e.cssClass:n.className+" pnlm-hotspot pnlm-sprite pnlm-"+Z(e.type);var i,o=t.createElement("span");if(e.text&&(o.innerHTML=Z(e.text)),e.video){i=t.createElement("video");var r=e.video;J.basePath&&!a(r)&&(r=J.basePath+r),i.src=$(r),i.controls=!0,i.style.width=e.width+"px",Fe.appendChild(n),o.appendChild(i)}else if(e.image){r=e.image,J.basePath&&!a(r)&&(r=J.basePath+r),(i=t.createElement("a")).href=$(e.URL?e.URL:r,!0),J.targetBlank&&(i.target="_blank",i.rel="noopener"),o.appendChild(i);var s=t.createElement("img");s.src=$(r),s.style.width=e.width+"px",s.style.paddingTop="5px",Fe.appendChild(n),i.appendChild(s),o.style.maxWidth="initial"}else if(e.URL){if((i=t.createElement("a")).href=$(e.URL,!0),e.attributes)for(r in e.attributes)i.setAttribute(r,e.attributes[r]);else J.targetBlank&&(i.target="_blank",i.rel="noopener");Fe.appendChild(i),n.className+=" pnlm-pointer",o.className+=" pnlm-pointer",i.appendChild(n)}else e.sceneId&&(n.onclick=function(){return n.clicked||(n.clicked=!0,X(e.sceneId,e.targetPitch,e.targetYaw,e.targetHfov)),!1},n.className+=" pnlm-pointer",o.className+=" pnlm-pointer"),Fe.appendChild(n);e.createTooltipFunc?e.createTooltipFunc(n,e.createTooltipArgs):(e.text||e.video||e.image)&&(n.classList.add("pnlm-tooltip"),n.appendChild(o),o.style.width=o.scrollWidth-20+"px",o.style.marginLeft=-(o.scrollWidth-n.offsetWidth)/2+"px",o.style.marginTop=-o.scrollHeight-12+"px"),e.clickHandlerFunc&&(n.addEventListener("click",(function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)}),"false"),""===t.documentElement.style.pointerAction&&""===t.documentElement.style.touchAction?n.addEventListener("pointerup",(function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)}),!1):n.addEventListener("touchend",(function(t){e.clickHandlerFunc(t,e.clickHandlerArgs)}),!1),n.className+=" pnlm-pointer",o.className+=" pnlm-pointer"),e.draggable&&(n.addEventListener("mousedown",(function(t){e.dragHandlerFunc&&e.dragHandlerFunc(t,e.dragHandlerArgs),te=e})),""===t.documentElement.style.pointerAction&&""===t.documentElement.style.touchAction&&n.addEventListener("pointerdown",(function(t){e.dragHandlerFunc&&e.dragHandlerFunc(t,e.dragHandlerArgs),te=e})),n.addEventListener("touchmove",(function(t){D(e,t.targetTouches[0])})),n.addEventListener("touchend",(function(t){e.dragHandlerFunc&&e.dragHandlerFunc(t,e.dragHandlerArgs),te=null}))),e.div=n}function D(e,t){var n=p(t);e.pitch=n[0],e.yaw=n[1],U(e)}function U(e){var t=Math.sin(e.pitch*Math.PI/180),n=Math.cos(e.pitch*Math.PI/180),i=Math.sin(J.pitch*Math.PI/180),o=Math.cos(J.pitch*Math.PI/180),r=Math.cos((-e.yaw+J.yaw)*Math.PI/180),a=t*i+n*r*o;if(90>=e.yaw&&-90<e.yaw&&0>=a||(90<e.yaw||-90>=e.yaw)&&0>=a)e.div.style.visibility="hidden";else{var s=Math.sin((-e.yaw+J.yaw)*Math.PI/180),l=Math.tan(J.hfov*Math.PI/360);e.div.style.visibility="visible";var h=(c=Q.getCanvas()).clientWidth,c=c.clientHeight;t=[-h/l*s*n/a/2,-h/l*(t*o-n*r*i)/a/2],n=Math.sin(J.roll*Math.PI/180),i=Math.cos(J.roll*Math.PI/180);(t=[t[0]*i-t[1]*n,t[0]*n+t[1]*i])[0]+=(h-e.div.offsetWidth)/2,t[1]+=(c-e.div.offsetHeight)/2,h="translate("+t[0]+"px, "+t[1]+"px) translateZ(9999px) rotate("+J.roll+"deg)",e.scale&&(h="number"==typeof e.scale?h+" scale("+e.scale+")":h+" scale("+ae/J.hfov/a+")"),e.div.style.webkitTransform=h,e.div.style.MozTransform=h,e.div.style.transform=h}}function B(e){J={};var t,n,i="haov vaov vOffset northOffset horizonPitch horizonRoll".split(" ");for(t in Ie=[],Oe)Oe.hasOwnProperty(t)&&(J[t]=Oe[t]);for(t in o.default)if(o.default.hasOwnProperty(t))if("strings"==t)for(n in o.default.strings)o.default.strings.hasOwnProperty(n)&&(J.strings[n]=Z(o.default.strings[n]));else J[t]=o.default[t],0<=i.indexOf(t)&&Ie.push(t);if(null!==e&&""!==e&&o.scenes&&o.scenes[e]){var r=o.scenes[e];for(t in r)if(r.hasOwnProperty(t))if("strings"==t)for(n in r.strings)r.strings.hasOwnProperty(n)&&(J.strings[n]=Z(r.strings[n]));else J[t]=r[t],0<=i.indexOf(t)&&Ie.push(t);J.scene=e}for(t in o)if(o.hasOwnProperty(t))if("strings"==t)for(n in o.strings)o.strings.hasOwnProperty(n)&&(J.strings[n]=Z(o.strings[n]));else J[t]=o[t],0<=i.indexOf(t)&&Ie.push(t)}function k(e){if((e=e||!1)&&"preview"in J){var i=J.preview;J.basePath&&!a(i)&&(i=J.basePath+i),(ee=t.createElement("div")).className="pnlm-preview-img",ee.style.backgroundImage="url('"+$(i).replace(/"/g,"%22").replace(/'/g,"%27")+"')",De.appendChild(ee)}i=J.title;var o=J.author;for(var s in e&&("previewTitle"in J&&(J.title=J.previewTitle),"previewAuthor"in J&&(J.author=J.previewAuthor)),J.hasOwnProperty("title")||(ze.title.innerHTML=""),J.hasOwnProperty("author")||(ze.author.innerHTML=""),J.hasOwnProperty("title")||J.hasOwnProperty("author")||(ze.container.style.display="none"),J.targetBlank&&(ke.rel="noopener",ke.target="_blank"),Ye.load.innerHTML="<div><p>"+J.strings.loadButtonLabel+"</p></div>",ze.load.boxp.innerHTML=J.strings.loadingLabel,J)if(J.hasOwnProperty(s))switch(s){case"title":ze.title.innerHTML=Z(J[s]),ze.container.style.display="inline";break;case"author":var l=Z(J[s]);J.authorURL&&((l=t.createElement("a")).href=$(J.authorURL,!0),J.targetBlank&&(l.target="_blank",l.rel="noopener"),l.innerHTML=Z(J[s]),l=l.outerHTML),ze.author.innerHTML=J.strings.bylineLabel.replace("%s",l),ze.container.style.display="inline";break;case"hfov":Y(Number(J[s]));break;case"autoLoad":!0===J[s]&&Q===n&&(ze.load.box.style.display="inline",Ye.load.style.display="none",r());break;case"showZoomCtrl":Ye.zoom.style.display=J[s]&&0!=J.showControls?"block":"none";break;case"showFullscreenCtrl":Ye.fullscreen.style.display=J[s]&&0!=J.showControls&&("fullscreen"in t||"mozFullScreen"in t||"webkitIsFullScreen"in t||"msFullscreenElement"in t)?"block":"none";break;case"hotSpotDebug":Ge.style.display=J[s]?"block":"none";break;case"showControls":J[s]||(Ye.orientation.style.display="none",Ye.zoom.style.display="none",Ye.fullscreen.style.display="none");break;case"orientationOnByDefault":J[s]&&j()}e&&(i?J.title=i:delete J.title,o?J.author=o:delete J.author)}function H(){if(ne&&!_e)if(ye)t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen();else try{i.requestFullscreen?i.requestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.msRequestFullscreen?i.msRequestFullscreen():i.webkitRequestFullScreen()}catch(e){}}function z(e){t.fullscreenElement||t.fullscreen||t.mozFullScreen||t.webkitIsFullScreen||t.msFullscreenElement?(Ye.fullscreen.classList.add("pnlm-fullscreen-toggle-button-active"),ye=!0):(Ye.fullscreen.classList.remove("pnlm-fullscreen-toggle-button-active"),ye=!1),"resize"!==e&&K("fullscreenchange",ye),Q.resize(),Y(J.hfov),C()}function G(e){var t=J.minHfov;if("multires"==J.type&&Q&&!J.multiResMinHfov&&(t=Math.min(t,Q.getCanvas().width/(J.multiRes.cubeResolution/90*.9))),t>J.maxHfov)return console.log("HFOV bounds do not make sense (minHfov > maxHfov)."),J.hfov;var n=J.hfov;n=e<t?t:e>J.maxHfov?J.maxHfov:e;return J.avoidShowingBackground&&Q&&!isNaN(J.maxPitch-J.minPitch)&&(e=Q.getCanvas(),n=Math.min(n,360*Math.atan(Math.tan((J.maxPitch-J.minPitch)/360*Math.PI)/e.height*e.width)/Math.PI)),n}function Y(e){J.hfov=G(e),K("zoomchange",J.hfov)}function q(){Le={},Te=J.autoRotate?J.autoRotate:Te,J.autoRotate=!1}function V(){_e&&(ze.load.box.style.display="none",ze.errorMsg.style.display="none",_e=!1,De.style.display="block",K("errorcleared")),ne=!1,c(),Ye.load.style.display="none",ze.load.box.style.display="inline",r()}function X(e,i,r,a,s){var l,h,c;if(ne||(s=!0),ne=!1,Le={},J.sceneFadeDuration&&!s&&(s=Q.render(J.pitch*Math.PI/180,J.yaw*Math.PI/180,J.hfov*Math.PI/180,{returnImage:"ImageBitmap"}))!==n)return(l=s.then?t.createElement("canvas"):new Image).className="pnlm-fade-img",l.style.transition="opacity "+J.sceneFadeDuration/1e3+"s",l.style.width="100%",l.style.height="100%",s.then?s.then((function(t){l.width=t.width,l.height=t.height,l.getContext("2d").drawImage(t,0,0),X(e,i,r,a,!0)})):(l.onload=function(){X(e,i,r,a,!0)},l.src=s),De.appendChild(l),void(Q.fadeImg=l);s="same"===i?J.pitch:i,h="same"===r?J.yaw:"sameAzimuth"===r?J.yaw+(J.northOffset||0)-(o.scenes[e].northOffset||0):r,c="same"===a?J.hfov:a,function(){var e=J.hotSpots;if(Se=!1,delete J.hotSpots,e)for(var t=0;t<e.length;t++){var n=e[t].div;if(n){for(;n.parentNode&&n.parentNode!=Fe;)n=n.parentNode;Fe.removeChild(n)}delete e[t].div}}(),B(e),xe.yaw=xe.pitch=xe.hfov=0,k(),s!==n&&(J.pitch=s),h!==n&&(J.yaw=h),c!==n&&(J.hfov=c),K("scenechange",e),V()}function W(){e.removeEventListener("deviceorientation",N),Ye.orientation.classList.remove("pnlm-orientation-button-active"),Me=!1}function j(){qe&&("undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(t){"granted"==t&&(Me=1,e.addEventListener("deviceorientation",N),Ye.orientation.classList.add("pnlm-orientation-button-active"))})):(Me=1,e.addEventListener("deviceorientation",N),Ye.orientation.classList.add("pnlm-orientation-button-active")))}function Z(e){return o.escapeHTML?String(e).split(/&/g).join("&amp;").split('"').join("&quot;").split("'").join("&#39;").split("<").join("&lt;").split(">").join("&gt;").split("/").join("&#x2f;").split("\n").join("<br>"):String(e).split("\n").join("<br>")}function $(e,t){try{var n=decodeURIComponent(function(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,(function(e,t){return"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""}))}(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return"about:blank"}return 0===n.indexOf("javascript:")||0===n.indexOf("vbscript:")?(console.log("Script URL removed."),"about:blank"):t&&0===n.indexOf("data:")?(console.log("Data URI removed from link."),"about:blank"):e}function K(e){if(e in Re)for(var t=Re[e].length;0<t;t--)Re[e][Re[e].length-t].apply(null,[].slice.call(arguments,1))}var J,Q,ee,te,ne,ie,oe,re,ae,se,le,he,ce=this,ue=!1,de=Date.now(),fe=0,pe=0,me=-1,ge=0,ve=0,we=Array(10),ye=!1,_e=!1,be=!1,xe={yaw:0,pitch:0,hfov:0},Ee=!1,Me=!1,Pe=0,Te=0,Le={},Re={},Ie=[],Ce=!1,Ae=!1,Se=!1,Ne=!1,Oe={hfov:100,minHfov:50,multiResMinHfov:!1,maxHfov:120,pitch:0,minPitch:n,maxPitch:n,yaw:0,minYaw:-180,maxYaw:180,roll:0,haov:360,vaov:180,vOffset:0,autoRotate:!1,autoRotateInactivityDelay:-1,autoRotateStopDelay:n,type:"equirectangular",northOffset:0,showFullscreenCtrl:!0,dynamic:!1,dynamicUpdate:!1,doubleClickZoom:!0,keyboardZoom:!0,mouseZoom:!0,showZoomCtrl:!0,autoLoad:!1,showControls:!0,orientationOnByDefault:!1,hotSpotDebug:!1,backgroundColor:[0,0,0],avoidShowingBackground:!1,animationTimingFunction:function(e){return.5>e?2*e*e:(4-2*e)*e-1},draggable:!0,dragConfirm:!1,disableKeyboardCtrl:!1,crossOrigin:"anonymous",targetBlank:!1,touchPanSpeedCoeffFactor:1,capturedKeyNumbers:[16,17,27,37,38,39,40,61,65,68,83,87,107,109,173,187,189],friction:.15,strings:{loadButtonLabel:"Click to<br>Load<br>Panorama",loadingLabel:"Loading...",bylineLabel:"by %s",noPanoramaError:"No panorama image was specified.",fileAccessError:"The file %s could not be accessed.",malformedURLError:"There is something wrong with the panorama URL.",iOS8WebGLError:"Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).",genericWebGLError:"Your browser does not have the necessary WebGL support to display this panorama.",textureSizeError:"This panorama is too big for your device! It's %spx wide, but your device only supports images up to %spx wide. Try another device. (If you're the author, try scaling down the image.)",unknownError:"Unknown error. Check developer console.",twoTouchActivate:"Use two fingers together to pan the panorama.",twoTouchXActivate:"Use two fingers together to pan the panorama horizontally.",twoTouchYActivate:"Use two fingers together to pan the panorama vertically.",ctrlZoomActivate:"Use %s + scroll to zoom the panorama."}};(i="string"==typeof i?t.getElementById(i):i).classList.add("pnlm-container"),i.tabIndex=0;var Fe=t.createElement("div");Fe.className="pnlm-ui",i.appendChild(Fe);var De=t.createElement("div");De.className="pnlm-render-container",i.appendChild(De);var Ue=t.createElement("div");Ue.className="pnlm-dragfix",Fe.appendChild(Ue);var Be=t.createElement("span");Be.className="pnlm-about-msg";var ke=t.createElement("a");ke.href="https://pannellum.org/",ke.textContent="Pannellum",Be.appendChild(ke);var He=t.createElement("span");He.textContent=" 6175668",Be.appendChild(He),Fe.appendChild(Be),Ue.addEventListener("contextmenu",(function e(t){var n=u(t);Be.style.left=n.x+"px",Be.style.top=n.y+"px",clearTimeout(e.t1),clearTimeout(e.t2),Be.style.display="block",Be.style.opacity=1,e.t1=setTimeout((function(){Be.style.opacity=0}),2e3),e.t2=setTimeout((function(){Be.style.display="none"}),2500),t.preventDefault()}));var ze={},Ge=t.createElement("div");Ge.className="pnlm-sprite pnlm-hot-spot-debug-indicator",Fe.appendChild(Ge),ze.container=t.createElement("div"),ze.container.className="pnlm-panorama-info",ze.title=t.createElement("div"),ze.title.className="pnlm-title-box",ze.container.appendChild(ze.title),ze.author=t.createElement("div"),ze.author.className="pnlm-author-box",ze.container.appendChild(ze.author),Fe.appendChild(ze.container),ze.load={},ze.load.box=t.createElement("div"),ze.load.box.className="pnlm-load-box",ze.load.boxp=t.createElement("p"),ze.load.box.appendChild(ze.load.boxp),ze.load.lbox=t.createElement("div"),ze.load.lbox.className="pnlm-lbox",ze.load.lbox.innerHTML='<div class="pnlm-loading"></div>',ze.load.box.appendChild(ze.load.lbox),ze.load.lbar=t.createElement("div"),ze.load.lbar.className="pnlm-lbar",ze.load.lbarFill=t.createElement("div"),ze.load.lbarFill.className="pnlm-lbar-fill",ze.load.lbar.appendChild(ze.load.lbarFill),ze.load.box.appendChild(ze.load.lbar),ze.load.msg=t.createElement("p"),ze.load.msg.className="pnlm-lmsg",ze.load.box.appendChild(ze.load.msg),Fe.appendChild(ze.load.box),ze.errorMsg=t.createElement("div"),ze.errorMsg.className="pnlm-error-msg pnlm-info-box",Fe.appendChild(ze.errorMsg),ze.interactionMsg=t.createElement("div"),ze.interactionMsg.className="pnlm-interaction-msg pnlm-info-box",Fe.appendChild(ze.interactionMsg);var Ye={};Ye.container=t.createElement("div"),Ye.container.className="pnlm-controls-container",Fe.appendChild(Ye.container),Ye.load=t.createElement("button"),Ye.load.className="pnlm-load-button",Ye.load.addEventListener("click",(function(){k(),V()})),Fe.appendChild(Ye.load),Ye.zoom=t.createElement("div"),Ye.zoom.className="pnlm-zoom-controls pnlm-controls",Ye.zoomIn=t.createElement("div"),Ye.zoomIn.className="pnlm-zoom-in pnlm-sprite pnlm-control",Ye.zoomIn.addEventListener("click",(function(){ne&&(Y(J.hfov-5),C())})),Ye.zoom.appendChild(Ye.zoomIn),Ye.zoomOut=t.createElement("div"),Ye.zoomOut.className="pnlm-zoom-out pnlm-sprite pnlm-control",Ye.zoomOut.addEventListener("click",(function(){ne&&(Y(J.hfov+5),C())})),Ye.zoom.appendChild(Ye.zoomOut),Ye.container.appendChild(Ye.zoom),Ye.fullscreen=t.createElement("div"),Ye.fullscreen.addEventListener("click",H),Ye.fullscreen.className="pnlm-fullscreen-toggle-button pnlm-sprite pnlm-fullscreen-toggle-button-inactive pnlm-controls pnlm-control",(t.fullscreenEnabled||t.mozFullScreenEnabled||t.webkitFullscreenEnabled||t.msFullscreenEnabled)&&Ye.container.appendChild(Ye.fullscreen),Ye.orientation=t.createElement("div"),Ye.orientation.addEventListener("click",(function(e){Me?W():j()})),Ye.orientation.addEventListener("mousedown",(function(e){e.stopPropagation()})),Ye.orientation.addEventListener("touchstart",(function(e){e.stopPropagation()})),Ye.orientation.addEventListener("pointerdown",(function(e){e.stopPropagation()})),Ye.orientation.className="pnlm-orientation-button pnlm-orientation-button-inactive pnlm-sprite pnlm-controls pnlm-control";var qe=!1;e.DeviceOrientationEvent&&"https:"==location.protocol&&(0<=navigator.userAgent.toLowerCase().indexOf("mobi")||0<=navigator.userAgent.indexOf("Mac")&&navigator.maxTouchPoints&&0<navigator.maxTouchPoints)&&(Ye.container.appendChild(Ye.orientation),qe=!0);var Ve=t.createElement("div");Ve.className="pnlm-compass pnlm-controls pnlm-control",Fe.appendChild(Ve),o.firstScene?B(o.firstScene):o.default&&o.default.firstScene?B(o.default.firstScene):B(null),k(!0);var Xe=[],We=[];S.prototype.multiply=function(e){return new S(this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z,this.x*e.w+this.w*e.x+this.y*e.z-this.z*e.y,this.y*e.w+this.w*e.y+this.z*e.x-this.x*e.z,this.z*e.w+this.w*e.z+this.x*e.y-this.y*e.x)},S.prototype.toEulerAngles=function(){return[Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),Math.asin(2*(this.w*this.y-this.z*this.x)),Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z))]},this.isLoaded=function(){return Boolean(ne)},this.getPitch=function(){return J.pitch},this.setPitch=function(e,t,i,o){return de=Date.now(),1e-6>=Math.abs(e-J.pitch)?("function"==typeof i&&i(o),this):((t=t==n?1e3:Number(t))?(Le.pitch={startTime:Date.now(),startPosition:J.pitch,endPosition:e,duration:t},"function"==typeof i&&setTimeout((function(){i(o)}),t)):J.pitch=e,C(),this)},this.getPitchBounds=function(){return[J.minPitch,J.maxPitch]},this.setPitchBounds=function(e){return J.minPitch=Math.max(-90,Math.min(e[0],90)),J.maxPitch=Math.max(-90,Math.min(e[1],90)),this},this.getYaw=function(){return(J.yaw+540)%360-180},this.setYaw=function(e,t,i,o){return de=Date.now(),1e-6>=Math.abs(e-J.yaw)?("function"==typeof i&&i(o),this):(e=(e+180)%360-180,(t=t==n?1e3:Number(t))?(180<J.yaw-e?e+=360:180<e-J.yaw&&(e-=360),Le.yaw={startTime:Date.now(),startPosition:J.yaw,endPosition:e,duration:t},"function"==typeof i&&setTimeout((function(){i(o)}),t)):J.yaw=e,C(),this)},this.getYawBounds=function(){return[J.minYaw,J.maxYaw]},this.setYawBounds=function(e){return J.minYaw=Math.max(-360,Math.min(e[0],360)),J.maxYaw=Math.max(-360,Math.min(e[1],360)),this},this.getHfov=function(){return J.hfov},this.setHfov=function(e,t,i,o){return de=Date.now(),1e-6>=Math.abs(e-J.hfov)?("function"==typeof i&&i(o),this):((t=t==n?1e3:Number(t))?(Le.hfov={startTime:Date.now(),startPosition:J.hfov,endPosition:G(e),duration:t},"function"==typeof i&&setTimeout((function(){i(o)}),t)):Y(e),C(),this)},this.getHfovBounds=function(){return[J.minHfov,J.maxHfov]},this.setHfovBounds=function(e){return J.minHfov=Math.max(0,e[0]),J.maxHfov=Math.max(0,e[1]),this},this.lookAt=function(e,t,i,o,r,a){return o=o==n?1e3:Number(o),e!==n&&1e-6<Math.abs(e-J.pitch)&&(this.setPitch(e,o,r,a),r=n),t!==n&&1e-6<Math.abs(t-J.yaw)&&(this.setYaw(t,o,r,a),r=n),i!==n&&1e-6<Math.abs(i-J.hfov)&&(this.setHfov(i,o,r,a),r=n),"function"==typeof r&&r(a),this},this.getNorthOffset=function(){return J.northOffset},this.setNorthOffset=function(e){return J.northOffset=Math.min(360,Math.max(0,e)),C(),this},this.getHorizonRoll=function(){return J.horizonRoll},this.setHorizonRoll=function(e){return J.horizonRoll=Math.min(90,Math.max(-90,e)),Q.setPose(J.horizonPitch*Math.PI/180,J.horizonRoll*Math.PI/180),C(),this},this.getHorizonPitch=function(){return J.horizonPitch},this.setHorizonPitch=function(e){return J.horizonPitch=Math.min(90,Math.max(-90,e)),Q.setPose(J.horizonPitch*Math.PI/180,J.horizonRoll*Math.PI/180),C(),this},this.startAutoRotate=function(e,t,i,o){return e=e||Te||1,t=t===n?se:t,i=i===n?ae:i,J.autoRotate=e,o!==n&&(J.autoRotateInactivityDelay=o),ce.lookAt(t,n,i,3e3),C(),this},this.stopAutoRotate=function(){return Te=J.autoRotate?J.autoRotate:Te,J.autoRotate=!1,J.autoRotateInactivityDelay=-1,this},this.stopMovement=function(){q(),xe={yaw:0,pitch:0,hfov:0}},this.getRenderer=function(){return Q},this.setUpdate=function(e){return(Ce=!0===e)&&(Ae=!1,Q===n?s():C()),this},this.updateOnce=function(){return Ce=Ae=!0,Q===n?s():C(),this},this.mouseEventToCoords=function(e){return p(e)},this.loadScene=function(e,t,n,i){return!1!==ne&&X(e,t,n,i),this},this.getScene=function(){return J.scene},this.addScene=function(e,t){return o.scenes[e]=t,this},this.removeScene=function(e){return!(J.scene==e||!o.scenes.hasOwnProperty(e))&&(delete o.scenes[e],!0)},this.toggleFullscreen=function(){return H(),this},this.getConfig=function(){return J},this.getContainer=function(){return i},this.addHotSpot=function(e,t){if(t===n&&J.scene===n)J.hotSpots.push(e);else{var i=t!==n?t:J.scene;if(!o.scenes.hasOwnProperty(i))throw"Invalid scene ID!";o.scenes[i].hasOwnProperty("hotSpots")||(o.scenes[i].hotSpots=[],i==J.scene&&(J.hotSpots=o.scenes[i].hotSpots)),o.scenes[i].hotSpots.push(e)}return t!==n&&J.scene!=t||(F(e),ne&&U(e)),this},this.removeHotSpot=function(e,t){if(t===n||J.scene==t){if(!J.hotSpots)return!1;for(var i=0;i<J.hotSpots.length;i++)if(J.hotSpots[i].hasOwnProperty("id")&&J.hotSpots[i].id==e){for(var r=J.hotSpots[i].div;r.parentNode!=Fe;)r=r.parentNode;return Fe.removeChild(r),delete J.hotSpots[i].div,J.hotSpots.splice(i,1),!0}}else{if(!o.scenes.hasOwnProperty(t))return!1;if(!o.scenes[t].hasOwnProperty("hotSpots"))return!1;for(i=0;i<o.scenes[t].hotSpots.length;i++)if(o.scenes[t].hotSpots[i].hasOwnProperty("id")&&o.scenes[t].hotSpots[i].id==e)return o.scenes[t].hotSpots.splice(i,1),!0}},this.resize=function(){Q&&I()},this.isOrientationSupported=function(){return qe||!1},this.stopOrientation=function(){W()},this.startOrientation=function(){j()},this.isOrientationActive=function(){return Boolean(Me)},this.on=function(e,t){return Re[e]=Re[e]||[],Re[e].push(t),this},this.off=function(e,t){if(!e)return Re={},this;if(t){var n=Re[e].indexOf(t);0<=n&&Re[e].splice(n,1),0==Re[e].length&&delete Re[e]}else delete Re[e];return this},this.destroy=function(){if(Ne=!0,clearTimeout(re),he&&he.abort(),Array.isArray(ie))for(var n=0;6>n;n++)ie[n].src="";Q&&Q.destroy(),be&&(t.removeEventListener("mousemove",m,!1),t.removeEventListener("mouseup",g,!1),i.removeEventListener("mozfullscreenchange",z,!1),i.removeEventListener("webkitfullscreenchange",z,!1),i.removeEventListener("msfullscreenchange",z,!1),i.removeEventListener("fullscreenchange",z,!1),le?le.disconnect():(e.removeEventListener("resize",I,!1),e.removeEventListener("orientationchange",I,!1)),i.removeEventListener("keydown",M,!1),i.removeEventListener("keyup",T,!1),i.removeEventListener("blur",P,!1),t.removeEventListener("mouseleave",g,!1)),i.innerHTML="",i.classList.remove("pnlm-container")}}return{viewer:function(e,t){return new i(e,t)}}}(window,document);const y={target:"trailview_panorama",initial:"c96ba6029cad464e9a4b7f9a6b8ac0d5",baseUrl:"https://trailview.cmparks.net",navArrowMinAngle:-25,navArrowMaxAngle:-20,imageFetchType:"standard",filterSequences:void 0,filterGroups:void 0};function _(e,t){return e-Math.floor(e/t)*t}e.TrailViewerBase=class{_options=y;_panViewer;_geo={latitude:0,longitude:0};_prevNorthOffset=0;_prevYaw=0;_currImg;_sceneList=[];_hotSpotList=[];_prevImg;_emitter;_sequencesData;_navArrowInfos=[];_destroyed=!1;_neighbors=[];_pitchCorrectionOverride;constructor(e=y){return this._emitter=new v.EventEmitter,this._options=e,fetch(w(this._options.baseUrl,"/api/sequences"),{method:"GET"}).then((async e=>{const t=await e.json();if(!t.success)throw new Error("Failed to fetch sequence data");this._sequencesData=t.data,await this._initViewer(this._options.initial),this._currImg&&this.goToImageID(this._currImg.id,!0)})),this}on(e,t){this._emitter.on(e,t)}overridePitchCorrection(e){this._pitchCorrectionOverride=e,void 0!==this._currImg&&this.goToImageID(this._currImg.id,!0)}_updateNavArrows(e=!1){const t=document.getElementsByClassName("trailview-nav-arrow");if(void 0!==this._panViewer){for(const e of t){const t=_(360-((n=this._panViewer.getYaw())<0&&(n=360+n),n)+e.yaw,360);e.style.transform=`scale(80%) translate(-50%, -50%) rotateZ(${t}deg) translateY(-100px)`}let e=(this._panViewer.getPitch()+90)/2.5;e>80?e=80:e<0&&(e=0);const i=document.getElementById("trailview-nav-container");null!==i&&(i.style.transform=`translate(-50%, 0) translateZ(100px) perspective(300px) rotateX(${e}deg)`)}var n;e||!1!==this._destroyed||requestAnimationFrame(this._updateNavArrows.bind(this,!1))}getCurrentImageID(){if(this._currImg)return this._currImg.id}getFlipped(){return this._currImg?this._currImg.flipped:void 0}getCurrentSequenceId(){return this._currImg?this._currImg.sequenceId:void 0}getPanViewer(){return this._panViewer}_createViewerConfig(e){return{default:{firstScene:e,sceneFadeDuration:1500,compass:!1,autoLoad:!0,showControls:!1,crossOrigin:"use-credentials"},scenes:{}}}_addSceneToConfig(e,t){if(!this._sequencesData)throw new Error("Cannot add scene to config as sequence data is undefined");if(!this._sequencesData.find((e=>e.id===t.sequenceId)))throw new Error(`Cannot add scene to config as sequence not found with id: ${t.sequenceId}`);return e.scenes[String(t.id)]={horizonPitch:t.pitchCorrection,hfov:120,yaw:0,northOffset:t.bearing,type:"multires",multiRes:{basePath:w(this._options.baseUrl,"/api/panImage",`/${t.id}`),path:"/%l/%s%y_%x",extension:"jpg",tileResolution:512,maxLevel:3,cubeResolution:1832}},e}_addImageToViewer(e,t){this._sceneList.push(e.id);let n=e.pitchCorrection,i=180;e.flipped||(n*=-1,i=0);let o=e.bearing;if(e.flipped||(o=_(o+180,360)),!this._sequencesData)return void console.warn("Cannot add scene to viewer as sequence data is undefined");if(!this._sequencesData.find((t=>t.id===e.sequenceId)))return void console.warn(`Cannot find sequence with id: ${e.sequenceId}`);const r={horizonPitch:n,hfov:120,yaw:i,northOffset:o,type:"multires",multiRes:{basePath:w(this._options.baseUrl,"/api/panImage",`/${e.id}`),path:"/%l/%s%y_%x",fallbackPath:"/fallback/%s",extension:"jpg",tileResolution:512,maxLevel:3,cubeResolution:1832,shtHash:t}};null!=t&&(r.multiRes.shtHash=t),void 0!==this._panViewer&&this._panViewer.addScene(e.id,r)}resize(){this._panViewer?.resize()}_createNavArrows(){const e=document.getElementById("trailview-nav-container");if(null===e)return;const t=document.getElementsByClassName("trailview-nav-arrow");for(let n=t.length-1;n>=0;--n)e.removeChild(t[n]);this._navArrowInfos.forEach((t=>{const n=document.createElement("img");n.classList.add("trailview-nav-arrow"),n.src=w(this._options.baseUrl,"/assets/img/arrow.png"),n.yaw=t.yaw,n.imageId=t.id,n.draggable=!1,n.alt="Navigation arrow",n.addEventListener("click",(e=>{this.goToImageID(e.target.imageId)})),e.appendChild(n)}))}async _addNeighborsToViewer(e,t=!1){this._navArrowInfos=[];for(let n=0;n<e.length;n++){void 0!==this._pitchCorrectionOverride&&(e[n].pitchCorrection=this._pitchCorrectionOverride),this._addImageToViewer(e[n],e[n].shtHash);const i=this._options.navArrowMinAngle,o=this._options.navArrowMaxAngle,r=-(o-i-e[n].distance*(o-i)/9)+o;let a=e[n].neighborBearing;t||(a=_(e[n].neighborBearing+180,360)),this._navArrowInfos.push({id:e[n].id,pitch:r,yaw:a})}this._createNavArrows()}_customMod(e,t){return e-Math.floor(e/t)*t}async _getNeighbors(e){const t=new URL(w(this._options.baseUrl,"/api/neighbors",this._options.imageFetchType,e.id));if(void 0!==this._options.filterSequences){let e="";for(let t=0;t<this._options.filterSequences.length;t++)e+=this._options.filterSequences[t],t!==this._options.filterSequences.length-1&&(e+=",");t.searchParams.set("s",e)}if(void 0!==this._options.filterGroups){let e="";for(let t=0;t<this._options.filterGroups.length;t++)e+=this._options.filterGroups[t],t!==this._options.filterGroups.length-1&&(e+=",");t.searchParams.set("g",e)}const n=await fetch(t),i=await n.json();if(!0!==i.success)throw new Error("Failed to retrieve neighbors");return i.data}async _initViewer(e){let t;if("string"==typeof e)t=e;else{const n=await fetch(w(this._options.baseUrl,"api/near/",e.latitude.toString(),e.longitude.toString(),this._options.imageFetchType)),i=await n.json();if(!0!==i.success)throw new Error("Failed to fetch nearest image");t=i.data.id}let n=this._createViewerConfig(t);const i=await fetch(w(this._options.baseUrl,"/api/images",this._options.imageFetchType,t)),o=await i.json();if(!0!==o.success)throw new Error("Unable to fetch initial image");this._currImg=o.data,this._currImg&&(n=this._addSceneToConfig(n,this._currImg),n=this._addSceneToConfig(n,this._currImg),this._sceneList.push(this._currImg.id)),this._panViewer=pannellum.viewer(this._options.target,n),this._panViewer.on("scenechange",(e=>{this._onImageChange(e)})),this._onImageChange(this._panViewer.getScene()),void 0!==this._currImg&&(this._currImg.flipped?this._panViewer.setYaw(180,!1):this._panViewer.setYaw(0,!1)),this._neighbors=await this._getNeighbors(this._currImg);for(let e=0;e<this._hotSpotList.length;e++)this._panViewer.removeHotSpot(this._hotSpotList[e]);void 0!==this._currImg&&this._addNeighborsToViewer(this._neighbors,this._currImg.flipped),this._createNavContainer(),this._emitter.emit("init-done")}_createNavContainer(){const e=document.createElement("div");e.id="trailview-nav-container",document.getElementById(this._options.target)?.appendChild(e),this._updateNavArrows()}async _onImageChange(e){if(void 0===e)return;if(void 0===this._panViewer)return;this._prevYaw=this._panViewer.getYaw();const t=((this._prevNorthOffset-this._panViewer.getNorthOffset())%360+this._prevYaw)%360;if(this._panViewer.setYaw(t,!1),this._prevNorthOffset=this._panViewer.getNorthOffset(),void 0===this._currImg)throw new Error("Current image is undefined");if(this._geo.latitude=this._currImg.latitude,this._geo.longitude=this._currImg.longitude,void 0!==this._prevImg)for(let e=0;e<this._hotSpotList.length;e++)this._panViewer.removeHotSpot(this._hotSpotList[e],this._prevImg.id);this._hotSpotList=[];const n=document.getElementsByClassName("pnlm-hotspot-base");for(let e=0;e<n.length;e++)n[e].remove();this._neighbors=await this._getNeighbors(this._currImg);const i=[e];for(let e=0;e<this._neighbors.length;e++)i.push(this._neighbors[e].id);for(let e=0;e<this._sceneList.length;e++)i.includes(this._sceneList[e])||this._panViewer.removeScene(this._sceneList[e]);this._sceneList=i,this._prevImg=this._currImg,this._addNeighborsToViewer(this._neighbors,this._currImg.flipped),this._emitter.emit("image-change",this._currImg)}getImageGeo(){return this._geo}destroy(){this._destroyed=!0,void 0!==this._panViewer&&this._panViewer.destroy()}getBearing(){return void 0!==this._panViewer?(this._panViewer.getNorthOffset()+this._panViewer.getYaw()+180)%360:void 0}async goToImageID(e,t=!1){if(void 0===this._panViewer)return;let n=this._neighbors.find((t=>t.id===e));if(t){for(let e=0;e<this._sceneList.length;e++)this._panViewer.removeScene(this._sceneList[e]);this._sceneList=[],this._neighbors=[]}if(void 0===n){const t=await fetch(w(this._options.baseUrl,"/api/images",this._options.imageFetchType,e)),i=await t.json();if(!0!==i.success)throw new Error("Unable to fetch image data");n=i.data,void 0!==this._pitchCorrectionOverride&&(n.pitchCorrection=this._pitchCorrectionOverride),this._addImageToViewer(n,i.preview)}return this._currImg=n,this._panViewer.loadScene(n.id,"same","same","same"),this}},e.defaultBaseOptions=y}));
//# sourceMappingURL=trailviewer-base.umd.js.map
