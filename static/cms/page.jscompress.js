function openMarkerDirections(e,t){clearDirections();$("#dialog_marker_directions").data("location_type",e);$("#dialog_marker_directions").data("location_id",t);$("#dialog_marker_directions").dialog("open")}function getMarkerDirections(){var e=$("#marker_directions_address").val();if(!e)return;if(e==$("#marker_directions_address").attr("placeholder"))return;var t={};t.address=e;t.bing_key=BING_API_KEY;t.bbox=GEOCODE_BIAS_BOX;$("#dialog_wait").dialog("open");$.get("../../../../ajax/geocode",t,function(t){$("#dialog_wait").dialog("close");if(!t)return alert("We couldn't find that address or city.\nPlease try again.");var n=t.lat;var r=t.lng;var i=t.title;var s={};s.type=$("#dialog_marker_directions").data("location_type");s.gid=$("#dialog_marker_directions").data("location_id");s.lat=n;s.lng=r;s.via="car";$.get("../../../../ajax/geocode_for_directions",s,function(t){var i=t.lat;var s=t.lng;if(!MAX_BOUNDS.contains(new L.LatLng(n,r))){var o={saddr:e,daddr:"loc:"+i+","+s,sll:n+","+r,dll:i+","+s};var u="https://maps.google.com/maps"+"?"+$.param(o);var a=$("#directions_steps");a.empty();a.append($("<div></div>").html("The address you have chosen is outside of the covered area. Click the link below to go to Google Maps for directions."));a.append($("<a></a>").text("Click here for directions from Google Maps").prop("href",u).prop("target","_blank"));return}var f={bing_key:BING_API_KEY,sourcelat:n,sourcelng:r,targetlat:i,targetlng:s,tofrom:"to",via:"car"};$.get("../../../../ajax/directions",f,function(e){if(!e||!e.wkt)return alert("Could not find directions.");clearDirections();DIRECTIONS_LINE=L.WKTtoFeature(e.wkt,DIRECTIONS_LINE_STYLE);MARKER_START.setLatLng(new L.LatLng(e.start.lat,e.start.lng));MARKER_END.setLatLng(new L.LatLng(e.end.lat,e.end.lng));MAP.addLayer(DIRECTIONS_LINE);MAP.addLayer(MARKER_START);MAP.addLayer(MARKER_END);MAP.closePopup();var t=L.WSENtoBounds(e.bounds.west,e.bounds.south,e.bounds.east,e.bounds.north);t=t.pad(.25);MAP.fitBounds(t);$("#dialog_marker_directions").dialog("option","height",500);$("#dialog_marker_directions").dialog("option","position","center");var n=$("#marker_directions_steps");for(var r=0,i=e.steps.length;r<i;r++){var s=e.steps[r];var o=$("<li></li>");var u=s.stepnumber?s.stepnumber+". "+(s.turnword?s.turnword:"")+" "+s.text:s.turnword+" "+s.text;o.append($("<span></span>").addClass("directions_step_title").text(u));if(s.distance&&s.duration){var a=s.distance+", "+s.duration;o.append($("<span></span>").addClass("directions_step_details").text(a))}n.append(o)}var f=$("<span></span>").addClass("directions_step_title").html("<b>Total:</b> "+e.totals.distance+", "+e.totals.duration);n.append($("<li></li>").addClass("directions_total").append(f))},"json")},"json")},"json")}function getDrivingDirections(){var e=$("#directions_address").val();if(!e)return;if(e==$("#directions_address").attr("placeholder"))return;var t=MARKERS[0].lat;var n=MARKERS[0].lng;var r={};r.address=e;r.bing_key=BING_API_KEY;r.bbox=GEOCODE_BIAS_BOX;$.get("../../../../ajax/geocode",r,function(r){if(!r)return alert("We couldn't find that address or city.\nPlease try again.");var i=r.lat;var s=r.lng;var o=r.title;if(!MAX_BOUNDS.contains(new L.LatLng(i,s))){var u={saddr:e,daddr:"loc:"+t+","+n,sll:i+","+s,dll:t+","+n};var a="https://maps.google.com/maps"+"?"+$.param(u);var f=$("#directions_steps");f.empty();f.append($("<div></div>").html("The address you have chosen is outside of the covered area. Click the link below to go to Google Maps for directions."));f.append($("<a></a>").text("Click here for directions from Google Maps").prop("href",a).prop("target","_blank"));return}var l={bing_key:BING_API_KEY,sourcelat:i,sourcelng:s,targetlat:t,targetlng:n,tofrom:"to",via:"car"};$.get("../../../../ajax/directions",l,function(e){if(!e||!e.wkt)return alert("Could not find directions.");clearDirections();DIRECTIONS_LINE=L.WKTtoFeature(e.wkt,DIRECTIONS_LINE_STYLE);MARKER_START.setLatLng(new L.LatLng(e.start.lat,e.start.lng));MARKER_END.setLatLng(new L.LatLng(e.end.lat,e.end.lng));MAP.addLayer(DIRECTIONS_LINE);MAP.addLayer(MARKER_START);MAP.addLayer(MARKER_END);var t=L.WSENtoBounds(e.bounds.west,e.bounds.south,e.bounds.east,e.bounds.north);t=t.pad(.25);MAP.fitBounds(t);$("#dialog_directions").dialog("option","height",500);$("#dialog_directions").dialog("option","position","center");var n=$("#directions_steps");for(var r=0,i=e.steps.length;r<i;r++){var s=e.steps[r];var o=$("<li></li>");var u=s.stepnumber?s.stepnumber+". "+(s.turnword?s.turnword:"")+" "+s.text:s.turnword+" "+s.text;o.append($("<span></span>").addClass("directions_step_title").text(u));if(s.distance&&s.duration){var a=s.distance+", "+s.duration;o.append($("<span></span>").addClass("directions_step_details").text(a))}n.append(o)}var f=$("<span></span>").addClass("directions_step_title").html("<b>Total:</b> "+e.totals.distance+", "+e.totals.duration);n.append($("<li></li>").addClass("directions_total").append(f))},"json")},"json")}function clearDirections(){$("#directions_steps").empty();$("#dialog_directions").dialog("option","height",175);$("#dialog_directions").dialog("option","position","center");$("#marker_directions_steps").empty();$("#dialog_marker_directions").dialog("option","height",175);$("#dialog_marker_directions").dialog("option","position","center");if(DIRECTIONS_LINE){MAP.removeLayer(DIRECTIONS_LINE);DIRECTIONS_LINE=null}if(MAP.hasLayer(MARKER_START)){MARKER_START.setLatLng(new L.LatLng(0,0));MAP.removeLayer(MARKER_START)}if(MAP.hasLayer(MARKER_END)){MARKER_END.setLatLng(new L.LatLng(0,0));MAP.removeLayer(MARKER_END)}}function wmsGetFeatureInfoByPoint(e){var t=20;var n=MAP.layerPointToLatLng(new L.Point(e.x-t,e.y+t));var r=MAP.layerPointToLatLng(new L.Point(e.x+t,e.y-t));var i={w:n.lng,s:n.lat,e:r.lng,n:r.lat};var s=MAP.layerPointToLatLng(new L.Point(e.x,e.y));wmsGetFeatureInfoByLatLngBBOX(i,s)}function wmsGetFeatureInfoByLatLng(e){var t={w:e.lng,s:e.lat,e:e.lng,n:e.lat};var n=e;wmsGetFeatureInfoByLatLngBBOX(t,n)}function wmsGetFeatureInfoByLatLngBBOX(e,t){var n=e;$.get("/cms/query",n,function(e){if(!e)return;var n=new L.Popup({maxWidth:999,maxHeight:999});n.setLatLng(t);n.setContent(e);MAP.openPopup(n)},"html")}var BBOX_SOUTHWEST=new L.LatLng(41.11816,-82.08504);var BBOX_NORTHEAST=new L.LatLng(41.70009,-81.28029);var MAX_BOUNDS=new L.LatLngBounds(BBOX_SOUTHWEST,BBOX_NORTHEAST);var BING_API_KEY="AjBuYw8goYn_CWiqk65Rbf_Cm-j1QFPH-gGfOxjBipxuEB2N3n9yACKu5s8Dl18N";var GEOCODE_BIAS_BOX="41.202048178648,-81.9627793163304,41.5885467839419,-81.386224018357";var SUBDOMAINS=["1","2","3"];var BASEMAP=new L.TileLayer("http://maps{s}.clemetparks.com/tilestache/tilestache.cgi/basemap/{z}/{x}/{y}.jpg",{subdomains:SUBDOMAINS});var LABELS=new L.TileLayer.WMS("http://maps{s}.clemetparks.com/gwc",{layers:"group_overlays",format:"image/png",transparent:"TRUE",subdomains:SUBDOMAINS});var MARKER_ICON=L.Icon.extend({iconUrl:"/static/cms/marker.png",iconSize:new L.Point(30,34)});var HIGHLIGHT_LINE=null;var HIGHLIGHT_LINE_STYLE={color:"#006600",weight:2,opacity:.5,clickable:false,fill:false};var DIRECTIONS_LINE=null;var DIRECTIONS_LINE_STYLE={color:"#0000FF",weight:5,opacity:1,clickable:false};var ICON_FROM=L.Icon.extend({iconUrl:"/static/desktop/measure1.png"});var ICON_TO=L.Icon.extend({iconUrl:"/static/desktop/measure2.png"});var MARKER_START=new L.Marker(new L.LatLng(0,0),{clickable:false,icon:new ICON_FROM});var MARKER_END=new L.Marker(new L.LatLng(0,0),{clickable:false,icon:new ICON_TO});var MIN_ZOOM=10;var MAX_ZOOM=17;$(window).load(function(){if(!$("#map_canvas").length)return;MAP=new L.Map("map_canvas",{attributionControl:false,zoomControl:true,dragging:true,closePopupOnClick:false,crs:L.CRS.EPSG3857,minZoom:MIN_ZOOM,maxZoom:MAX_ZOOM,layers:[BASEMAP,LABELS]});var e=[];for(var t=0,n=MARKERS.length;t<n;t++){var r=MARKERS[t];var i=new MARKER_ICON;var s=new L.LatLng(r.lat,r.lng);var o=new L.Marker(s,{clickable:true,icon:i});MAP.addLayer(o);var u="";if(r.imageurl)u+='<img src="'+r.imageurl+'" class="picture" />';u+='<p class="title">'+r.title+"</p>";u+=r.description;if(r.externalurl)u+="<br/>"+'<a id="link_moreinfo" target="_top" href="'+r.externalurl+'">More Info</a>';if(r.mapquerystring)u+="<br/>"+'<a id="link_fullmap" target="_blank" href="/desktop/map?'+r.mapquerystring+'">View on full map</a>'+' <a id="link_mobilemap" target="_blank" href="/mobile/map?'+r.mapquerystring+'">(mobile)</a>';u+="<br/>"+'<span class="fakelink" onClick="openMarkerDirections(\''+r.type+"','"+r.id+"');\">Get Directions</span>";o.htmlcontent=u;o.on("click",function(){MAP.closePopup();var e=new L.Popup({minWidth:300,maxWidth:400});e.setLatLng(this.getLatLng());e.setContent(this.htmlcontent);MAP.openPopup(e)});e[e.length]=s}if(e.length>1){e=new L.LatLngBounds(e);e=e.pad(.25)}else{var a=.05;e=new L.LatLngBounds(new L.LatLng(e[0].lat-a,e[0].lng-a),new L.LatLng(e[0].lat+a,e[0].lng+a))}MAP.fitBounds(e);if(MARKERS.length==1&&MARKERS[0].wkt){var f=MARKERS[0];HIGHLIGHT_LINE=L.WKTtoFeature(f.wkt,HIGHLIGHT_LINE_STYLE);MAP.addLayer(HIGHLIGHT_LINE);LABELS.bringToFront();var e=new L.LatLngBounds(new L.LatLng(f.boxs,f.boxw),new L.LatLng(f.boxn,f.boxe));MAP.fitBounds(e)}MAP.on("click",function(e){if($(".leaflet-popup").length)return MAP.closePopup();wmsGetFeatureInfoByPoint(e.layerPoint)})});$(window).load(function(){$("#marker_directions_address").keydown(function(e){if(e.keyCode!=13)return;getMarkerDirections()});$("#dialog_marker_directions").dialog({modal:false,closeOnEscape:true,autoOpen:false,resizable:false,width:400,height:175,position:"center",title:"Get Bing driving directions",buttons:{"Get Directions":function(){getMarkerDirections()},Clear:function(){$("#directions_address").val("");$("#directions_address").blur();clearDirections()},Close:function(){$(this).dialog("close")}}});$("#dialog_wait").dialog({modal:true,closeOnEscape:false,autoOpen:false,resizable:false,width:"auto",height:"auto",title:"",buttons:{}})});$(window).load(function(){if(!$("#social").length)return;$("#share_facebook").click(function(){var e=$("#social").attr("shareurl");var t=$("#social").attr("sharetitle");var e="http://www.facebook.com/share.php?u="+encodeURIComponent(e);window.open(e)});$("#share_twitter").click(function(){var e=$("#social").attr("shareurl");var t=$("#social").attr("sharetitle");var e="http://twitter.com/home?status="+t+" "+encodeURIComponent(e);window.open(e)});$("#dialog_embed").dialog({modal:true,closeOnEscape:true,autoOpen:false,width:500,height:500,buttons:{Close:function(){$(this).dialog("close")}}});$("#share_embed").click(function(){var e=$("#social").attr("shareurl");var t=$("#social").attr("sharetitle");var n=$(window).width();var r=$(window).height();var i='<iframe style="width:'+n+"px;height:"+r+'px;" src="'+e+'"></iframe>';$("#dialog_embed").dialog("open");$("#textbox_embed").val(i);$("#textbox_url").val(e)});$("#textbox_embed").focus(function(){$(this).select()});$("#textbox_url").focus(function(){$(this).select()})});$(window).load(function(){$("#dialog_directions").dialog({modal:false,closeOnEscape:true,autoOpen:false,resizable:false,width:400,height:175,position:"center",title:"Get Bing driving directions",buttons:{"Get Directions":function(){getDrivingDirections()},Clear:function(){$("#directions_address").val("");$("#directions_address").blur();clearDirections()},Close:function(){$(this).dialog("close")}}});$("#directions_address").keydown(function(e){if(e.keyCode!=13)return;var t=$("#dialog_directions").dialog("option","buttons")["Get Directions"];t()});$("#directions_button").click(function(){$("#dialog_directions").dialog("open")});$("#directions_address").focus(function(){if($(this).val()==$(this).attr("placeholder"))$(this).val("")});$("#directions_address").blur(function(){if($(this).val()=="")$(this).val($(this).attr("placeholder"))})});$(window).load(function(){if(!$("#searchbyname").length)return;$("#searchbyname").change(function(){var e=$(this).val();if(!e)return;e=e.split(",");e=new L.LatLngBounds(new L.LatLng(e[1],e[0]),new L.LatLng(e[3],e[2]));MAP.closePopup();MAP.fitBounds(e)})});$(window).load(function(){var e=$("#image").width();$("#rightmargin").width(e)})