<?php $this->page_title = 'Loops'; ?>

<p class="lead">Generating and managing loops: the basics...</p>

<p>
Featured Loops and Routes (or Loops for short) are managed via the Administration panel: <a target="_blank" href="<?= ssl_url('administration/loops') ?>"><?= ssl_url('administration/loops') ?></a>
</p>

<ul>
  <li><b>Random Loops</b> vs <b>Manual Loops</b> -- A loop whose <code>source</code> field is &quot;Random&quot; will be shown under the  Random Loops page; all others are shown on the Manual Loops page. This provides a separation from those Loops which were generated by an   admin, versus those generated randomly. (more on that topic later)</li>
  <li><b>Status = Published</b> -- In the front-facing app, when a user searches for Features Routes and Loops, only Loops whose status is  Published will be shown. This allows the admin to disable loops which are still being thought out.</li>
  <li><b>Autoloop</b> -- This is used to manually generate a random loop from a given Lat/Lon (Manual) or from a CSV file of Lat/Lon pairs (CSV). (more on this later)</li>
</ul>

<p>A Loop consists of several components:</p>

<ul>
  <li>A name, description, paved and use type -- These are filled in by the admin. Sorry, but this is a manual process.</li>
  <li>Source and Edited By -- These indicate who is responsible for the Loop. A common value for Source is &quot;Random&quot; indicating  that it was randomly generated from a starting point. (more on this later)</li>
  <li>Directions and the time/distance summary -- These are automatically filled in as part of the Recalculate process.</li>
  <li>An elevation profile -- This is a graphical representation of the elevation as one follows the route. Internally, the elevation   profile is identical to that described in the directions API on the programming documentation page.</li>
  <li>Waypoints -- Waypoint 0 is the starting location. Additional waypoints can be laid down to help shape the generated Loop. <i>Note   that your waypoints may not fall exactly onto the generated path.</i></li>
  <li>WKT -- The plotted route on the map, is stored in OGC WKT so it can be rendered to browsers in the future.</li>
  <li>Loop? -- This dictates whether the generated route is a Loop or a one-way path.</li>
  <li>Filter -- This determines which trails view will be used for finding a route: hiking, bicycle, et cetera. <i>There are situations   where a Loop cannot be made with a given trail use type, e.g. specifying equestrian trails in an area with few/no equestrian trails, may  not result in a usable Loop.</i></li>
  <li>Trim? -- This affects whether backtracking segments should be removed from the route, such as where a waypoint would have you walk down a path then do a U-turn. <i>This has known side effects on trailhead segments, and for some complex manually-generated routes may remove whole legs of the trip.</i></li>
</ul>


<h2>Generating a Loop / Random Waypoints</h2>

<ol>
  <li>Go into the Administration panel and into Loops.</li>
  <li>Select &quot;Create a new loop&quot;</li>
  <li>Pan and center your map until you find the location for your desired trailhead. You may use the geocoder to search for an address or  landmark via Google.</li>
  <li>Click on the &quot;add&quot; link next to Waypoint 0. Drag the marker into its desired location.</li>
  <li>Continue adding waypoints and dragging them into place. You may use the Generate Random button to have the server pick some random  waypoints around Waypoint 0. <i>The Desired Route Length is a gross approximation, affecting the average distance between waypoints.</i>   <i>Random waypoints are random, and may not always make sense.</i></li>
  <li>Click Recalculate to have the server calculate the route between your waypoints. It will also populate the directions, the elevation  profile, et cetera.</li>
  <li>When you're done, click Save Changes to save the Loop.</li>
  <li>Remember, your Loop will only be visible to the public when you set its Status to Published.</li>
</ol>

<h2>Random Waypoint and Loop Generation</h2>

<p>At this time (August 2012) the generation of random loops is quite primitive.</p>

<p>Routing between waypoints, can result in a situation where the user is instructed to walk up a trail to a waypoint, then do a U-turn to go to the next waypoint. We call these &quot;spurs&quot; The current implemenatation of removing spurs, is unsuitable for situations where a loop is not in fact a loop but a line, e.g. the same trail is the only way back, most notably at the trailhead. In these cases, spur removal can remove large parts of a route.</p>